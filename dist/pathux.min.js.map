{"version":3,"file":"pathux.min.js","sources":["../scripts/path-controller/util/polyfill.js","../scripts/path-controller/util/nstructjs_es6.js","../scripts/path-controller/util/mobile-detect.js","../scripts/path-controller/extern/lz-string/lz-string.js","../scripts/path-controller/util/util.js","../scripts/path-controller/util/vectormath.js","../scripts/path-controller/toolsys/toolprop_abstract.js","../scripts/path-controller/units/units.js","../scripts/path-controller/config/config.js","../scripts/path-controller/util/simple_events.js","../scripts/path-controller/util/events.js","../scripts/path-controller/curve/curve1d_base.js","../scripts/path-controller/curve/curve1d_bspline.js","../scripts/path-controller/curve/curve1d_basic.js","../scripts/path-controller/curve/ease.js","../scripts/path-controller/curve/curve1d_anim.js","../scripts/path-controller/curve/curve1d.js","../scripts/path-controller/toolsys/toolprop.js","../scripts/core/ui_consts.js","../scripts/screen/area_wrangler.js","../scripts/path-controller/util/math.js","../scripts/config/const.js","../scripts/core/ui_theme.js","../scripts/core/anim.js","../scripts/path-controller/util/parseutil.js","../scripts/path-controller/controller/controller_base.js","../scripts/path-controller/toolsys/toolsys.js","../scripts/path-controller/toolsys/toolpath.js","../scripts/path-controller/controller/controller_abstract.js","../scripts/path-controller/controller/controller_ops.js","../scripts/path-controller/controller/controller.js","../scripts/path-controller/util/colorutils.js","../scripts/core/theme.js","../scripts/icon_enum.js","../scripts/core/aspect.js","../scripts/core/ui_base.js","../scripts/widgets/ui_button.js","../scripts/widgets/ui_textbox.js","../scripts/widgets/ui_widgets.js","../scripts/path-controller/util/html5_fileapi.js","../scripts/path-controller/controller/context.js","../scripts/path-controller/util/solver.js","../scripts/path-controller/util/graphpack.js","../scripts/widgets/ui_menu.js","../scripts/core/ui.js","../scripts/widgets/ui_noteframe.js","../scripts/widgets/ui_richedit.js","../scripts/widgets/ui_widgets2.js","../scripts/screen/FrameManager_ops.js","../scripts/screen/FrameManager_mesh.js","../scripts/screen/ScreenArea.js","../scripts/widgets/theme_editor.js","../scripts/widgets/ui_numsliders.js","../scripts/xmlpage/xmlpage.js","../scripts/path-controller/curve/curve1d_utils.js","../scripts/widgets/ui_curvewidget.js","../scripts/widgets/ui_panel.js","../scripts/widgets/ui_colorpicker2.js","../scripts/widgets/ui_tabs.js","../scripts/widgets/ui_table.js","../scripts/widgets/ui_listbox.js","../scripts/widgets/ui_progress.js","../scripts/widgets/ui_lasttool.js","../scripts/platforms/platform_base.js","../scripts/platforms/platform.js","../scripts/platforms/electron/electron_api.js","../scripts/util/ScreenOverdraw.js","../scripts/widgets/ui_treeview.js","../scripts/widgets/dragbox.js","../scripts/screen/AreaDocker.js","../scripts/screen/FrameManager.js","../scripts/widgets/ui_dialog.js","../scripts/simple/editor.js","../scripts/simple/iconsheet.js","../scripts/simple/icons.js","../scripts/simple/file.js","../scripts/simple/menubar.js","../scripts/simple/app_ops.js","../scripts/simple/app.js","../scripts/simple/context_class.js","../scripts/platforms/web/web_api.js","../scripts/pathux.js"],"sourcesContent":["if (typeof window === \"undefined\" && typeof global !== \"undefined\") {\r\n  global.window = global;\r\n}\r\n\r\n(function () {\r\n  let visitgen = 0;\r\n\r\n  window.destroyAllCSS = function () {\r\n    visitgen++;\r\n\r\n    let visit = (n) => {\r\n      if (n.__visit === visitgen) {\r\n        return;\r\n      }\r\n\r\n      n.__visit = visitgen;\r\n      if (n.tagName === \"STYLE\") {\r\n        n.textContents = '';\r\n      }\r\n\r\n      if (n.style) {\r\n        for (let k in n.style) {\r\n          try {\r\n            n.style[k] = \"\";\r\n          } catch (error) {\r\n\r\n          }\r\n        }\r\n      }\r\n\r\n      if (!n.childNodes) {\r\n        return;\r\n      }\r\n\r\n      for (let c of n.childNodes) {\r\n        visit(c);\r\n      }\r\n    }\r\n\r\n    visit(document.head);\r\n    visit(document.body);\r\n\r\n    for (let sheet of document.styleSheets) {\r\n      for (let i = 0; i < sheet.rules.length; i++) {\r\n        sheet.removeRule(sheet.rules[0]);\r\n      }\r\n    }\r\n  }\r\n})();\r\n\r\nwindow.eventDebugModule = (function () {\r\n  \"use strict\";\r\n\r\n  return {\r\n    start() {\r\n      window.debugEventLists = {}\r\n      window.debugEventList = [];\r\n\r\n      this._addEventListener = EventTarget.prototype.addEventListener;\r\n      this._removeEventListener = EventTarget.prototype.removeEventListener;\r\n      this._dispatchEvent = EventTarget.prototype.dispatchEvent;\r\n\r\n      EventTarget.prototype.addEventListener = this.onadd;\r\n      EventTarget.prototype.removeEventListener = this.onrem;\r\n      EventTarget.prototype.dispatchEvent = this.ondispatch;\r\n    },\r\n\r\n    add(type, data) {\r\n      if (!(type in debugEventLists)) {\r\n        debugEventLists[type] = [];\r\n      }\r\n\r\n      debugEventLists[type].push(data);\r\n    },\r\n\r\n    ondispatch() {\r\n      let a = arguments;\r\n\r\n      eventDebugModule.add(\"Dispatch\", {\r\n        event    : a[0],\r\n        thisvar  : a[4],\r\n        line     : a[5],\r\n        filename : a[6].replace(/\\\\/g, \"/\"),\r\n        filepath : location.origin + a[6].replace(/\\\\/g, \"/\") + \":\" + a[5],\r\n        ownerpath: a[7]\r\n      });\r\n\r\n      return eventDebugModule._dispatchEvent.apply(this, arguments);\r\n    },\r\n\r\n    onadd() {\r\n      let a = arguments;\r\n\r\n      eventDebugModule.add(\"Add\", {\r\n        type     : a[0],\r\n        cb       : a[1],\r\n        args     : a[2],\r\n        thisvar  : a[4],\r\n        line     : a[5],\r\n        filename : a[6].replace(/\\\\/g, \"/\"),\r\n        filepath : location.origin + a[6].replace(/\\\\/g, \"/\") + \":\" + a[5],\r\n        ownerpath: a[7]\r\n      });\r\n\r\n\r\n      return eventDebugModule._addEventListener.apply(this, arguments);\r\n    },\r\n\r\n    pruneConnected() {\r\n      for (let k in debugEventLists) {\r\n        let list = debugEventLists[k];\r\n\r\n        for (let i = 0; i < list.length; i++) {\r\n          let e = list[i];\r\n\r\n          if (!e.thisvar || !(e.thisvar instanceof Node)) {\r\n            continue;\r\n          }\r\n\r\n          if (!e.thisvar.isConnected) {\r\n            list[i] = list[list.length - 1];\r\n            list[list.length - 1] = undefined;\r\n            list.length--;\r\n            i--;\r\n          }\r\n        }\r\n      }\r\n    },\r\n\r\n\r\n    onrem() {\r\n      let a = arguments;\r\n\r\n      eventDebugModule.add(\"Rem\", {\r\n        type     : a[0],\r\n        cb       : a[1],\r\n        args     : a[2],\r\n        thisvar  : a[4],\r\n        line     : a[5],\r\n        filename : a[6].replace(/\\\\/g, \"/\"),\r\n        filepath : location.origin + a[6].replace(/\\\\/g, \"/\") + \":\" + a[5],\r\n        ownerpath: a[7]\r\n      });\r\n\r\n\r\n      return eventDebugModule._removeEventListener.apply(this, arguments);\r\n    }\r\n  }\r\n})();\r\n\r\nif (typeof _debug_event_listeners !== \"undefined\" && _debug_event_listeners) {\r\n  eventDebugModule.start();\r\n}\r\n\r\n/*\r\nif (navigator.userAgent.toLowerCase().search(\"chrome\") >= 0) {\r\n  console.warn(\"Patching Google Chrome scrollbar bug\");\r\n\r\n  let cb = (e) => {\r\n    if (e.touches.length == 1) {\r\n      let e2 = Object.create(e);\r\n      e2.pageX = e.touches[0].pageX;\r\n      e2.pageY = e.touches[0].pageY;\r\n      e2.x = e2.screenX = e2.pageX;\r\n      e2.y = e2.screenY = e2.pageY;\r\n      e2.button = 0;\r\n      e2.buttons = 1;\r\n\r\n      let type;\r\n      if (e.type === \"touchstart\")\r\n        type = \"mousedown\";\r\n      else \r\n        type = \"mousemove\";\r\n\r\n      console.log(e2);\r\n        //console.log(e.target);\r\n      e2 = new MouseEvent(type, e);\r\n      e.target.dispatchEvent(e2);\r\n    }\r\n  };\r\n\r\n  window.addEventListener(\"touchstart\", (e) => cb(e));\r\n  window.addEventListener(\"touchmove\", (e) => cb(e));\r\n\r\n  document.addEventListener(\"touchstart\", (e) => cb(e));\r\n  document.addEventListener(\"touchmove\", (e) => cb(e));\r\n}\r\n//*/\r\n\r\nif (window._disable_all_listeners) {\r\n  console.warn(\"Disabling all event listeners\");\r\n  EventTarget.prototype.addEventListener = () => {\r\n  };\r\n  EventSource.prototype.addEventListener = () => {\r\n  };\r\n}\r\n\r\nif (typeof visualViewport === \"undefined\") {\r\n  (function () {\r\n    class MyVisualViewport {\r\n      get width() {\r\n        return window.innerWidth;\r\n      }\r\n\r\n      get height() {\r\n        return window.innerHeight;\r\n      }\r\n\r\n      get offsetLeft() {\r\n        return 0;\r\n      }\r\n\r\n      get offsetTop() {\r\n        return 0;\r\n      }\r\n\r\n      get pageLeft() {\r\n        return 0;\r\n      }\r\n\r\n      get pageTop() {\r\n        return 0;\r\n      }\r\n\r\n      get scale() {\r\n        return 1.0;\r\n      }\r\n    }\r\n\r\n    window.visualViewport = new MyVisualViewport();\r\n  })();\r\n}\r\n\r\nif (Array.prototype.set === undefined) {\r\n  /**\r\n   * A version of TypedArray.prototype.set for Array\r\n   * Unliked typed array version the array will be\r\n   * resized if the source array range extends past\r\n   * the array length.\r\n   *\r\n   * array.set(array) array.set(array, src_offset) array.set(array, src_offset, count)\r\n   * array.set(array, src_offset, dest_offset, count\r\n   * @param array\r\n   */\r\n  Array.prototype.set = function set(array) {\r\n    if (arguments.length === 0) {\r\n      //WASM somehow manages to call this\r\n      return;\r\n    }\r\n\r\n    let src, dst, count;\r\n\r\n    if (arguments.length === 0) {\r\n      src = 0;\r\n      dst = 0;\r\n      count = array.length;\r\n    } else if (arguments.length === 1) {\r\n      count = array.length;\r\n      src = arguments[1];\r\n      dst = 0;\r\n    } else if (arguments.length === 2) {\r\n      src = arguments[1];\r\n      count = arguments[2];\r\n    } else if (arguments.length === 3) {\r\n      src = arguments[1];\r\n      dst = arguments[2];\r\n      count = arguments[3];\r\n    }\r\n\r\n    src = src === undefined ? 0 : src;\r\n    dst = dst === undefined ? 0 : dst;\r\n    count = count === undefined ? array.length : count;\r\n\r\n    if (count < 0) {\r\n      throw new RangeError(\"Count must be >= zero\");\r\n    }\r\n\r\n    let len = Math.min(src + count, array.length) - src;\r\n\r\n    if (dst + len > this.length) {\r\n      this.length = dst + len;\r\n    }\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      this[dst + i] = array[src + i];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  Object.defineProperty(Array.prototype, \"set\", {\r\n    enumerable  : false,\r\n    configurable: true,\r\n  });\r\n\r\n  if (Float64Array.prototype.set === undefined) {\r\n    Float64Array.prototype.set = Array.prototype.set;\r\n    Float32Array.prototype.set = Array.prototype.set;\r\n    Uint8Array.prototype.set = Array.prototype.set;\r\n    Uint8ClampedArray.prototype.set = Array.prototype.set;\r\n    Int32Array.prototype.set = Array.prototype.set;\r\n    Int16Array.prototype.set = Array.prototype.set;\r\n    Int8Array.prototype.set = Array.prototype.set;\r\n  }\r\n}\r\n\r\nif (Array.prototype.reject === undefined) {\r\n  Array.prototype.reject = function reject(func) {\r\n    return this.filter((item) => !func(item));\r\n  }\r\n\r\n  Object.defineProperty(Array.prototype, \"reject\", {\r\n    enumerable  : false,\r\n    configurable: true,\r\n  });\r\n}\r\n\r\nif (window.Symbol == undefined) { //eek!\r\n  window.Symbol = {\r\n    iterator: \"$__iterator__$\",\r\n    keystr  : \"$__keystr__$\"\r\n  }\r\n} else if (Symbol.keystr === undefined) {\r\n  Symbol.keystr = Symbol(\"keystr\");\r\n}\r\n\r\n/* use util.list\r\nwindow.list = function list(iter) {\r\n  var ret = [];\r\n\r\n  if (typeof iter == \"string\") {\r\n    iter = new String();\r\n  }\r\n\r\n  if (Symbol.iterator in iter) {\r\n    for (var item of iter) {\r\n      ret.push(item);\r\n    }\r\n  } else {\r\n    iter.forEach(function (item) {\r\n      ret.push(item);\r\n    }, this);\r\n  }\r\n\r\n  return ret;\r\n};*/\r\n\r\n//XXX surely browser vendors have fixed this by now. . .\r\n/*Override array iterator to not allocate too much*/\r\n\r\n/*\r\nfunction ArrayIter(array) {\r\n  this.array = array;\r\n  this.i = 0;\r\n  this.ret = {done : false, value : undefined};\r\n}\r\n\r\nArrayIter.prototype[Symbol.iterator] = function() {\r\n  return this;\r\n}\r\n\r\nArrayIter.prototype.next = function() {\r\n  var ret = this.ret;\r\n  \r\n  if (this.i >= this.array.length) {\r\n    ret.done = true;\r\n    ret.value = undefined;\r\n    return ret;\r\n  }\r\n  \r\n  ret.value = this.array[this.i++];\r\n  return ret;\r\n};//*/\r\n\r\n\r\n//Array.prototype[Symbol.iterator] = function() {\r\n//  return new ArrayIter(this);\r\n//}\r\n\r\nif (Math.fract === undefined) {\r\n  Math.fract = function fract(f) {\r\n    return f - Math.floor(f);\r\n  };\r\n}\r\n\r\nif (Math.tent === undefined) {\r\n  Math.tent = function tent(f) {\r\n    return 1.0 - Math.abs(Math.fract(f) - 0.5)*2.0;\r\n  };\r\n}\r\n\r\nif (Math.sign === undefined) {\r\n  Math.sign = function sign(f) {\r\n    return (f > 0.0)*2.0 - 1.0;\r\n  };\r\n}\r\n\r\nif (Array.prototype.pop_i === undefined) {\r\n  Array.prototype.pop_i = function (idx) {\r\n    if (idx < 0 || idx >= this.length) {\r\n      throw new Error(\"Index out of range\");\r\n    }\r\n\r\n    while (idx < this.length) {\r\n      this[idx] = this[idx + 1];\r\n      idx++;\r\n    }\r\n\r\n    this.length -= 1;\r\n  }\r\n\r\n  Object.defineProperty(Array.prototype, \"pop_i\", {\r\n    enumerable  : false,\r\n    configurable: true,\r\n  });\r\n}\r\n\r\nif (Array.prototype.remove === undefined) {\r\n  Array.prototype.remove = function (item, suppress_error) {\r\n    var i = this.indexOf(item);\r\n\r\n    if (i < 0) {\r\n      if (suppress_error)\r\n        console.trace(\"Warning: item not in array\", item);\r\n      else\r\n        throw new Error(\"Error: item not in array \" + item);\r\n\r\n      return;\r\n    }\r\n\r\n    this.pop_i(i);\r\n  }\r\n\r\n  Object.defineProperty(Array.prototype, \"remove\", {\r\n    enumerable  : false,\r\n    configurable: true,\r\n  });\r\n}\r\n\r\nif (String.prototype.contains === undefined) {\r\n  String.prototype.contains = function (substr) {\r\n    return String.search(substr) >= 0;\r\n  }\r\n}\r\n\r\nString.prototype[Symbol.keystr] = function () {\r\n  return this;\r\n};\r\n\r\nNumber.prototype[Symbol.keystr] = Boolean.prototype[Symbol.keystr] = function () {\r\n  return \"\" + this;\r\n};\r\n\r\nArray.prototype[Symbol.keystr] = function () {\r\n  let key = \"\";\r\n  for (let item of this) {\r\n    key += item[Symbol.keystr]() + \":\";\r\n  }\r\n\r\n  return key;\r\n};\r\n","let colormap = {\r\n  \"black\"   : 30,\r\n  \"red\"     : 31,\r\n  \"green\"   : 32,\r\n  \"yellow\"  : 33,\r\n  \"blue\"    : 34,\r\n  \"magenta\" : 35,\r\n  \"cyan\"    : 36,\r\n  \"white\"   : 37,\r\n  \"reset\"   : 0,\r\n  \"grey\"    : 2,\r\n  \"orange\"  : 202,\r\n  \"pink\"    : 198,\r\n  \"brown\"   : 314,\r\n  \"lightred\": 91,\r\n  \"peach\"   : 210\r\n};\r\n\r\nfunction tab(n, chr = ' ') {\r\n  let t = '';\r\n\r\n  for (let i = 0; i < n; i++) {\r\n    t += chr;\r\n  }\r\n\r\n  return t;\r\n}\r\n\r\nlet termColorMap = {};\r\nfor (let k in colormap) {\r\n  termColorMap[k] = colormap[k];\r\n  termColorMap[colormap[k]] = k;\r\n}\r\n\r\nfunction termColor(s, c) {\r\n  if (typeof s === \"symbol\") {\r\n    s = s.toString();\r\n  } else {\r\n    s = \"\" + s;\r\n  }\r\n\r\n  if (c in colormap)\r\n    c = colormap[c];\r\n\r\n  if (c > 107) {\r\n    let s2 = '\\u001b[38;5;' + c + \"m\";\r\n    return s2 + s + '\\u001b[0m'\r\n  }\r\n\r\n  return '\\u001b[' + c + 'm' + s + '\\u001b[0m'\r\n};\r\n\r\nfunction termPrint() {\r\n  //let console = window.console;\r\n\r\n  let s = '';\r\n  for (let i = 0; i < arguments.length; i++) {\r\n    if (i > 0) {\r\n      s += ' ';\r\n    }\r\n    s += arguments[i];\r\n  }\r\n\r\n  let re1a = /\\u001b\\[[1-9][0-9]?m/;\r\n  let re1b = /\\u001b\\[[1-9][0-9];[0-9][0-9]?;[0-9]+m/;\r\n  let re2 = /\\u001b\\[0m/;\r\n\r\n  let endtag = '\\u001b[0m';\r\n\r\n  function tok(s, type) {\r\n    return {\r\n      type : type,\r\n      value: s\r\n    }\r\n  }\r\n\r\n  let tokdef = [\r\n    [re1a, \"start\"],\r\n    [re1b, \"start\"],\r\n    [re2, \"end\"]\r\n  ];\r\n\r\n  let s2 = s;\r\n\r\n  let i = 0;\r\n  let tokens = [];\r\n\r\n  while (s2.length > 0) {\r\n    let ok = false;\r\n\r\n    let mintk = undefined, mini = undefined;\r\n    let minslice = undefined, mintype = undefined;\r\n\r\n    for (let tk of tokdef) {\r\n      let i = s2.search(tk[0]);\r\n\r\n      if (i >= 0 && (mini === undefined || i < mini)) {\r\n        minslice = s2.slice(i, s2.length).match(tk[0])[0];\r\n        mini = i;\r\n        mintype = tk[1];\r\n        mintk = tk;\r\n        ok = true;\r\n      }\r\n    }\r\n\r\n    if (!ok) {\r\n      break;\r\n    }\r\n\r\n    if (mini > 0) {\r\n      let chunk = s2.slice(0, mini);\r\n      tokens.push(tok(chunk, \"chunk\"));\r\n    }\r\n\r\n    s2 = s2.slice(mini+minslice.length, s2.length);\r\n    let t = tok(minslice, mintype);\r\n\r\n    tokens.push(t);\r\n  }\r\n\r\n  if (s2.length > 0) {\r\n    tokens.push(tok(s2, \"chunk\"));\r\n  }\r\n\r\n  let stack = [];\r\n  let cur;\r\n\r\n  let out = '';\r\n\r\n  for (let t of tokens) {\r\n    if (t.type === \"chunk\") {\r\n      out += t.value;\r\n    } else if (t.type === \"start\") {\r\n      stack.push(cur);\r\n      cur = t.value;\r\n\r\n      out += t.value;\r\n    } else if (t.type === \"end\") {\r\n      cur = stack.pop();\r\n      if (cur) {\r\n        out += cur;\r\n      } else {\r\n        out += endtag;\r\n      }\r\n    }\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\nfunction list(iter) {\r\n  let ret = [];\r\n\r\n  for (let item of iter) {\r\n    ret.push(item);\r\n  }\r\n\r\n  return ret;\r\n}\n\nvar util = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  tab: tab,\n  termColorMap: termColorMap,\n  termColor: termColor,\n  termPrint: termPrint,\n  list: list\n});\n\n\"use strict\";\r\n\r\nfunction print_lines(ld, lineno, col, printColors, token) {\r\n  let buf = '';\r\n  let lines = ld.split(\"\\n\");\r\n  let istart = Math.max(lineno - 5, 0);\r\n  let iend = Math.min(lineno + 3, lines.length);\r\n\r\n  let color = printColors ? (c) => c : termColor;\r\n\r\n  for (let i = istart; i < iend; i++) {\r\n    let l = \"\" + (i + 1);\r\n    while (l.length < 3) {\r\n      l = \" \" + l;\r\n    }\r\n\r\n    l += `: ${lines[i]}\\n`;\r\n\r\n    if (i === lineno && token && token.value.length === 1) {\r\n      l = l.slice(0, col + 5) + color(l[col + 5], \"yellow\") + l.slice(col + 6, l.length);\r\n    }\r\n    buf += l;\r\n    if (i === lineno) {\r\n      let colstr = '     ';\r\n      for (let i = 0; i < col; i++) {\r\n        colstr += ' ';\r\n      }\r\n      colstr += color(\"^\", \"red\");\r\n\r\n      buf += colstr + \"\\n\";\r\n    }\r\n  }\r\n\r\n  buf = \"------------------\\n\" + buf + \"\\n==================\\n\";\r\n  return buf;\r\n}\r\n\r\nclass token {\r\n  constructor(type, val, lexpos, lineno, lexer, parser, col) {\r\n    this.type = type;\r\n    this.value = val;\r\n    this.lexpos = lexpos;\r\n    this.lineno = lineno;\r\n    this.col = col;\r\n    this.lexer = lexer;\r\n    this.parser = parser;\r\n  }\r\n\r\n  toString() {\r\n    if (this.value !== undefined)\r\n      return \"token(type=\" + this.type + \", value='\" + this.value + \"')\";\r\n    else\r\n      return \"token(type=\" + this.type + \")\";\r\n  }\r\n}\r\n\r\nclass tokdef {\r\n  constructor(name, regexpr, func, example) {\r\n    this.name = name;\r\n    this.re = regexpr;\r\n    this.func = func;\r\n    this.example = example;\r\n\r\n    if (example === undefined && regexpr) {\r\n      let s = \"\" + regexpr;\r\n      if (s.startsWith(\"/\") && s.endsWith(\"/\")) {\r\n        s = s.slice(1, s.length - 1);\r\n      }\r\n\r\n      if (s.startsWith(\"\\\\\")) {\r\n        s = s.slice(1, s.length);\r\n      }\r\n      s = s.trim();\r\n\r\n      if (s.length === 1) {\r\n        this.example = s;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nclass PUTIL_ParseError extends Error {\r\n  constructor(msg) {\r\n    super();\r\n  }\r\n}\r\n\r\nclass lexer {\r\n  constructor(tokdef, errfunc) {\r\n    this.tokdef = tokdef;\r\n    this.tokens = new Array();\r\n    this.lexpos = 0;\r\n    this.lexdata = \"\";\r\n    this.colmap = undefined;\r\n    this.lineno = 0;\r\n    this.printTokens = false;\r\n    this.linestart = 0;\r\n    this.errfunc = errfunc;\r\n    this.linemap = undefined;\r\n    this.tokints = {};\r\n    for (let i = 0; i < tokdef.length; i++) {\r\n      this.tokints[tokdef[i].name] = i;\r\n    }\r\n    this.statestack = [[\"__main__\", 0]];\r\n    this.states = {\"__main__\": [tokdef, errfunc]};\r\n    this.statedata = 0;\r\n\r\n    this.logger = function () {\r\n      console.log(...arguments);\r\n    };\r\n  }\r\n\r\n  add_state(name, tokdef, errfunc) {\r\n    if (errfunc === undefined) {\r\n      errfunc = function (lexer) {\r\n        return true;\r\n      };\r\n    }\r\n    this.states[name] = [tokdef, errfunc];\r\n  }\r\n\r\n  tok_int(name) {\r\n  }\r\n\r\n  push_state(state, statedata) {\r\n    this.statestack.push([state, statedata]);\r\n    state = this.states[state];\r\n    this.statedata = statedata;\r\n    this.tokdef = state[0];\r\n    this.errfunc = state[1];\r\n  }\r\n\r\n  pop_state() {\r\n    let item = this.statestack[this.statestack.length - 1];\r\n    let state = this.states[item[0]];\r\n    this.tokdef = state[0];\r\n    this.errfunc = state[1];\r\n    this.statedata = item[1];\r\n  }\r\n\r\n  input(str) {\r\n    let linemap = this.linemap = new Array(str.length);\r\n    let lineno = 0;\r\n    let col = 0;\r\n    let colmap = this.colmap = new Array(str.length);\r\n\r\n    for (let i = 0; i < str.length; i++, col++) {\r\n      let c = str[i];\r\n\r\n      linemap[i] = lineno;\r\n      colmap[i] = col;\r\n\r\n      if (c === \"\\n\") {\r\n        lineno++;\r\n        col = 0;\r\n      }\r\n    }\r\n\r\n    while (this.statestack.length > 1) {\r\n      this.pop_state();\r\n    }\r\n    this.lexdata = str;\r\n    this.lexpos = 0;\r\n    this.lineno = 0;\r\n    this.tokens = new Array();\r\n    this.peeked_tokens = [];\r\n  }\r\n\r\n  error() {\r\n    if (this.errfunc !== undefined && !this.errfunc(this))\r\n      return;\r\n\r\n    let safepos = Math.min(this.lexpos, this.lexdata.length - 1);\r\n    let line = this.linemap[safepos];\r\n    let col = this.colmap[safepos];\r\n\r\n    let s = print_lines(this.lexdata, line, col, true);\r\n\r\n    this.logger(\"  \" + s);\r\n    this.logger(\"Syntax error near line \" + (this.lineno + 1));\r\n\r\n    let next = Math.min(this.lexpos + 8, this.lexdata.length);\r\n\r\n    throw new PUTIL_ParseError(\"Parse error\");\r\n  }\r\n\r\n  peek() {\r\n    let tok = this.next(true);\r\n    if (tok === undefined)\r\n      return undefined;\r\n    this.peeked_tokens.push(tok);\r\n    return tok;\r\n  }\r\n\r\n  peeknext() {\r\n    if (this.peeked_tokens.length > 0) {\r\n      return this.peeked_tokens[0];\r\n    }\r\n\r\n    return this.peek();\r\n  }\r\n\r\n  at_end() {\r\n    return this.lexpos >= this.lexdata.length && this.peeked_tokens.length === 0;\r\n  }\r\n\r\n  //ignore_peek is optional, false\r\n  next(ignore_peek) {\r\n    if (!ignore_peek && this.peeked_tokens.length > 0) {\r\n      let tok = this.peeked_tokens[0];\r\n      this.peeked_tokens.shift();\r\n\r\n      if (!ignore_peek && this.printTokens) {\r\n        this.logger(\"\" + tok);\r\n      }\r\n\r\n      return tok;\r\n    }\r\n\r\n    if (this.lexpos >= this.lexdata.length)\r\n      return undefined;\r\n\r\n    let ts = this.tokdef;\r\n    let tlen = ts.length;\r\n    let lexdata = this.lexdata.slice(this.lexpos, this.lexdata.length);\r\n    let results = [];\r\n\r\n    for (var i = 0; i < tlen; i++) {\r\n      let t = ts[i];\r\n      if (t.re === undefined)\r\n        continue;\r\n      let res = t.re.exec(lexdata);\r\n      if (res !== null && res !== undefined && res.index === 0) {\r\n        results.push([t, res]);\r\n      }\r\n    }\r\n\r\n    let max_res = 0;\r\n    let theres = undefined;\r\n    for (var i = 0; i < results.length; i++) {\r\n      let res = results[i];\r\n      if (res[1][0].length > max_res) {\r\n        theres = res;\r\n        max_res = res[1][0].length;\r\n      }\r\n    }\r\n\r\n    if (theres === undefined) {\r\n      this.error();\r\n      return;\r\n    }\r\n\r\n    let def = theres[0];\r\n    let col = this.colmap[Math.min(this.lexpos, this.lexdata.length - 1)];\r\n\r\n    if (this.lexpos < this.lexdata.length) {\r\n      this.lineno = this.linemap[this.lexpos];\r\n    }\r\n\r\n    let tok = new token(def.name, theres[1][0], this.lexpos, this.lineno, this, undefined, col);\r\n    this.lexpos += tok.value.length;\r\n\r\n    if (def.func) {\r\n      tok = def.func(tok);\r\n      if (tok === undefined) {\r\n        return this.next();\r\n      }\r\n    }\r\n\r\n    if (!ignore_peek && this.printTokens) {\r\n      this.logger(\"\" + tok);\r\n    }\r\n    return tok;\r\n  }\r\n}\r\n\r\nclass parser {\r\n  constructor(lexer, errfunc) {\r\n    this.lexer = lexer;\r\n    this.errfunc = errfunc;\r\n    this.start = undefined;\r\n\r\n    this.logger = function () {\r\n      console.log(...arguments);\r\n    };\r\n  }\r\n\r\n  parse(data, err_on_unconsumed) {\r\n    if (err_on_unconsumed === undefined)\r\n      err_on_unconsumed = true;\r\n\r\n    if (data !== undefined)\r\n      this.lexer.input(data);\r\n\r\n    let ret = this.start(this);\r\n\r\n    if (err_on_unconsumed && !this.lexer.at_end() && this.lexer.next() !== undefined) {\r\n      this.error(undefined, \"parser did not consume entire input\");\r\n    }\r\n    return ret;\r\n  }\r\n\r\n  input(data) {\r\n    this.lexer.input(data);\r\n  }\r\n\r\n  error(token, msg) {\r\n    let estr;\r\n\r\n    if (msg === undefined)\r\n      msg = \"\";\r\n    if (token === undefined)\r\n      estr = \"Parse error at end of input: \" + msg;\r\n    else\r\n      estr = `Parse error at line ${token.lineno + 1}:${token.col + 1}: ${msg}`;\r\n\r\n    let buf = \"\";\r\n    let ld = this.lexer.lexdata;\r\n    let lineno = token ? token.lineno : this.lexer.linemap[this.lexer.linemap.length - 1];\r\n    let col = token ? token.col : 0;\r\n\r\n    ld = ld.replace(/\\r/g, '');\r\n\r\n    this.logger(print_lines(ld, lineno, col, true, token));\r\n    this.logger(estr);\r\n\r\n    if (this.errfunc && !this.errfunc(token)) {\r\n      return;\r\n    }\r\n    throw new PUTIL_ParseError(estr);\r\n  }\r\n\r\n  peek() {\r\n    let tok = this.lexer.peek();\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n    return tok;\r\n  }\r\n\r\n  peeknext() {\r\n    let tok = this.lexer.peeknext();\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n    return tok;\r\n  }\r\n\r\n  next() {\r\n    let tok = this.lexer.next();\r\n\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n    return tok;\r\n  }\r\n\r\n  optional(type) {\r\n    let tok = this.peeknext();\r\n    if (tok === undefined)\r\n      return false;\r\n    if (tok.type === type) {\r\n      this.next();\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  at_end() {\r\n    return this.lexer.at_end();\r\n  }\r\n\r\n  expect(type, msg) {\r\n    let tok = this.next();\r\n\r\n    if (msg === undefined) {\r\n      msg = type;\r\n\r\n      for (let tk of this.lexer.tokdef) {\r\n        if (tk.name === type && tk.example) {\r\n          msg = tk.example;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (tok === undefined || tok.type !== type) {\r\n      this.error(tok, \"Expected \" + msg);\r\n    }\r\n    return tok.value;\r\n  }\r\n}\r\n\r\nfunction test_parser() {\r\n  let basic_types = new Set([\"int\", \"float\", \"double\", \"vec2\", \"vec3\", \"vec4\", \"mat4\", \"string\"]);\r\n  let reserved_tokens = new Set([\"int\", \"float\", \"double\", \"vec2\", \"vec3\", \"vec4\", \"mat4\", \"string\", \"static_string\",\r\n                                 \"array\"]);\r\n\r\n  function tk(name, re, func) {\r\n    return new tokdef(name, re, func);\r\n  }\r\n\r\n  let tokens = [tk(\"ID\", /[a-zA-Z]+[a-zA-Z0-9_]*/, function (t) {\r\n    if (reserved_tokens.has(t.value)) {\r\n      t.type = t.value.toUpperCase();\r\n    }\r\n    return t;\r\n  }), tk(\"OPEN\", /\\{/), tk(\"CLOSE\", /}/), tk(\"COLON\", /:/), tk(\"JSCRIPT\", /\\|/, function (t) {\r\n    let js = \"\";\r\n    let lexer = t.lexer;\r\n    while (lexer.lexpos < lexer.lexdata.length) {\r\n      let c = lexer.lexdata[lexer.lexpos];\r\n      if (c === \"\\n\")\r\n        break;\r\n      js += c;\r\n      lexer.lexpos++;\r\n    }\r\n    if (js.endsWith(\";\")) {\r\n      js = js.slice(0, js.length - 1);\r\n      lexer.lexpos--;\r\n    }\r\n    t.value = js;\r\n    return t;\r\n  }), tk(\"LPARAM\", /\\(/), tk(\"RPARAM\", /\\)/), tk(\"COMMA\", /,/), tk(\"NUM\", /[0-9]/), tk(\"SEMI\", /;/),\r\n                tk(\"NEWLINE\", /\\n/, function (t) {\r\n                  t.lexer.lineno += 1;\r\n                }), tk(\"SPACE\", / |\\t/, function (t) {\r\n    })];\r\n\r\n  for (let rt of reserved_tokens) {\r\n    tokens.push(tk(rt.toUpperCase()));\r\n  }\r\n\r\n  let a = `\r\n  Loop {\r\n    eid : int;\r\n    flag : int;\r\n    index : int;\r\n    type : int;\r\n\r\n    co : vec3;\r\n    no : vec3;\r\n    loop : int | eid(loop);\r\n    edges : array(e, int) | e.eid;\r\n\r\n    loops :, array(Loop);\r\n  }\r\n  `;\r\n\r\n\r\n  function errfunc(lexer) {\r\n    return true;\r\n  }\r\n\r\n  let lex = new lexer(tokens, errfunc);\r\n  console.log(\"Testing lexical scanner...\");\r\n  lex.input(a);\r\n  let token;\r\n  while (token = lex.next()) {\r\n    console.log(token.toString());\r\n  }\r\n  let parse = new parser(lex);\r\n  parse.input(a);\r\n\r\n  function p_Array(p) {\r\n    p.expect(\"ARRAY\");\r\n    p.expect(\"LPARAM\");\r\n    let arraytype = p_Type(p);\r\n    let itername = \"\";\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = arraytype;\r\n      arraytype = p_Type(p);\r\n    }\r\n    p.expect(\"RPARAM\");\r\n    return {type: \"array\", data: {type: arraytype, iname: itername}}\r\n  }\r\n\r\n  function p_Type(p) {\r\n    let tok = p.peek();\r\n    if (tok.type === \"ID\") {\r\n      p.next();\r\n      return {type: \"struct\", data: \"\\\"\" + tok.value + \"\\\"\"}\r\n    } else if (basic_types.has(tok.type.toLowerCase())) {\r\n      p.next();\r\n      return {type: tok.type.toLowerCase()}\r\n    } else if (tok.type === \"ARRAY\") {\r\n      return p_Array(p);\r\n    } else {\r\n      p.error(tok, \"invalid type \" + tok.type);\r\n    }\r\n  }\r\n\r\n  function p_Field(p) {\r\n    let field = {};\r\n    console.log(\"-----\", p.peek().type);\r\n    field.name = p.expect(\"ID\", \"struct field name\");\r\n    p.expect(\"COLON\");\r\n    field.type = p_Type(p);\r\n    field.set = undefined;\r\n    field.get = undefined;\r\n    let tok = p.peek();\r\n    if (tok.type === \"JSCRIPT\") {\r\n      field.get = tok.value;\r\n      p.next();\r\n    }\r\n    tok = p.peek();\r\n    if (tok.type === \"JSCRIPT\") {\r\n      field.set = tok.value;\r\n      p.next();\r\n    }\r\n    p.expect(\"SEMI\");\r\n    return field;\r\n  }\r\n\r\n  function p_Struct(p) {\r\n    let st = {};\r\n    st.name = p.expect(\"ID\", \"struct name\");\r\n    st.fields = [];\r\n    p.expect(\"OPEN\");\r\n    while (1) {\r\n      if (p.at_end()) {\r\n        p.error(undefined);\r\n      } else if (p.optional(\"CLOSE\")) {\r\n        break;\r\n      } else {\r\n        st.fields.push(p_Field(p));\r\n      }\r\n    }\r\n    return st;\r\n  }\r\n\r\n  let ret = p_Struct(parse);\r\n  console.log(JSON.stringify(ret));\r\n}\r\n\r\n//test_parser();\n\nvar struct_parseutil = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  token: token,\n  tokdef: tokdef,\n  PUTIL_ParseError: PUTIL_ParseError,\n  lexer: lexer,\n  parser: parser\n});\n\n\"use strict\";\r\n\r\nclass NStruct {\r\n  constructor(name) {\r\n    this.fields = [];\r\n    this.id = -1;\r\n    this.name = name;\r\n  }\r\n}\r\n\r\n//the discontinuous id's are to make sure\r\n//the version I originally wrote (which had a few application-specific types)\r\n//and this one do not become totally incompatible.\r\nconst StructEnum = {\r\n  INT          : 0,\r\n  FLOAT        : 1,\r\n  DOUBLE       : 2,\r\n  STRING       : 7,\r\n  STATIC_STRING: 8, //fixed-length string\r\n  STRUCT       : 9,\r\n  TSTRUCT      : 10,\r\n  ARRAY        : 11,\r\n  ITER         : 12,\r\n  SHORT        : 13,\r\n  BYTE         : 14,\r\n  BOOL         : 15,\r\n  ITERKEYS     : 16,\r\n  UINT         : 17,\r\n  USHORT       : 18,\r\n  STATIC_ARRAY : 19,\r\n  SIGNED_BYTE  : 20\r\n};\r\n\r\nconst ArrayTypes = new Set([\r\n  StructEnum.STATIC_ARRAY, StructEnum.ARRAY, StructEnum.ITERKEYS, StructEnum.ITER\r\n]);\r\n\r\nconst ValueTypes = new Set([\r\n  StructEnum.INT,\r\n  StructEnum.FLOAT,\r\n  StructEnum.DOUBLE,\r\n  StructEnum.STRING,\r\n  StructEnum.STATIC_STRING,\r\n  StructEnum.SHORT,\r\n  StructEnum.BYTE,\r\n  StructEnum.BOOL,\r\n  StructEnum.UINT,\r\n  StructEnum.USHORT,\r\n  StructEnum.SIGNED_BYTE\r\n\r\n]);\r\n\r\nlet StructTypes = {\r\n  \"int\"          : StructEnum.INT,\r\n  \"uint\"         : StructEnum.UINT,\r\n  \"ushort\"       : StructEnum.USHORT,\r\n  \"float\"        : StructEnum.FLOAT,\r\n  \"double\"       : StructEnum.DOUBLE,\r\n  \"string\"       : StructEnum.STRING,\r\n  \"static_string\": StructEnum.STATIC_STRING,\r\n  \"struct\"       : StructEnum.STRUCT,\r\n  \"abstract\"     : StructEnum.TSTRUCT,\r\n  \"array\"        : StructEnum.ARRAY,\r\n  \"iter\"         : StructEnum.ITER,\r\n  \"short\"        : StructEnum.SHORT,\r\n  \"byte\"         : StructEnum.BYTE,\r\n  \"bool\"         : StructEnum.BOOL,\r\n  \"iterkeys\"     : StructEnum.ITERKEYS,\r\n  \"sbyte\"        : StructEnum.SIGNED_BYTE\r\n};\r\n\r\nlet StructTypeMap = {};\r\n\r\nfor (let k in StructTypes) {\r\n  StructTypeMap[StructTypes[k]] = k;\r\n}\r\n\r\nfunction gen_tabstr(t) {\r\n  let s = \"\";\r\n  for (let i = 0; i < t; i++) {\r\n    s += \"  \";\r\n  }\r\n  return s;\r\n}\r\n\r\nfunction stripComments(buf) {\r\n  let s = '';\r\n\r\n  const MAIN = 0, COMMENT = 1, STR = 2;\r\n\r\n  let p, n;\r\n  let strs = new Set([\"'\", '\"', \"`\"]);\r\n  let mode = MAIN;\r\n  let strlit;\r\n  let escape = false;\r\n\r\n  for (let i = 0; i < buf.length; i++) {\r\n    let p = i > 0 ? buf[i - 1] : undefined;\r\n    let c = buf[i];\r\n    let n = i < buf.length - 1 ? buf[i + 1] : undefined;\r\n\r\n    switch (mode) {\r\n      case MAIN:\r\n        if (c === \"/\" && n === \"/\") {\r\n          mode = COMMENT;\r\n          continue;\r\n        }\r\n\r\n        if (strs.has(c)) {\r\n          strlit = c;\r\n          mode = STR;\r\n        }\r\n\r\n        s += c;\r\n\r\n        break;\r\n      case COMMENT:\r\n        if (n === \"\\n\") {\r\n          mode = MAIN;\r\n        }\r\n        break;\r\n      case STR:\r\n        if (c === strlit && !escape) {\r\n          mode = MAIN;\r\n        }\r\n\r\n        s += c;\r\n        break;\r\n    }\r\n\r\n    if (c === \"\\\\\") {\r\n      escape ^= true;\r\n    } else {\r\n      escape = false;\r\n    }\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nfunction StructParser() {\r\n  let basic_types = new Set([\r\n    \"int\", \"float\", \"double\", \"string\", \"short\", \"byte\", \"sbyte\", \"bool\", \"uint\", \"ushort\"\r\n  ]);\r\n\r\n  let reserved_tokens = new Set([\r\n    \"int\", \"float\", \"double\", \"string\", \"static_string\", \"array\",\r\n    \"iter\", \"abstract\", \"short\", \"byte\", \"sbyte\", \"bool\", \"iterkeys\", \"uint\", \"ushort\",\r\n    \"static_array\"\r\n  ]);\r\n\r\n  function tk(name, re, func) {\r\n    return new tokdef(name, re, func);\r\n  }\r\n\r\n  let tokens = [\r\n    tk(\"ID\", /[a-zA-Z_$]+[a-zA-Z0-9_\\.$]*/, function (t) {\r\n\r\n      if (reserved_tokens.has(t.value)) {\r\n        t.type = t.value.toUpperCase();\r\n      }\r\n      return t;\r\n    }, \"identifier\"),\r\n    tk(\"OPEN\", /\\{/),\r\n    tk(\"EQUALS\", /=/),\r\n    tk(\"CLOSE\", /}/),\r\n    tk(\"STRLIT\", /\\\"[^\"]*\\\"/, t => {\r\n      t.value = t.value.slice(1, t.value.length - 1);\r\n      return t;\r\n    }),\r\n    tk(\"STRLIT\", /\\'[^']*\\'/, t => {\r\n      t.value = t.value.slice(1, t.value.length - 1);\r\n      return t;\r\n    }),\r\n    tk(\"COLON\", /:/),\r\n    tk(\"SOPEN\", /\\[/),\r\n    tk(\"SCLOSE\", /\\]/),\r\n    tk(\"JSCRIPT\", /\\|/, function (t) {\r\n      let js = \"\";\r\n      let lexer = t.lexer;\r\n      let p;\r\n\r\n      while (lexer.lexpos < lexer.lexdata.length) {\r\n        let c = lexer.lexdata[lexer.lexpos];\r\n        if (c === \"\\n\")\r\n          break;\r\n\r\n        if (c === \"/\" && p === \"/\") {\r\n          js = js.slice(0, js.length - 1);\r\n          lexer.lexpos--;\r\n\r\n          break;\r\n        }\r\n\r\n        js += c;\r\n        lexer.lexpos++;\r\n        p = c;\r\n      }\r\n\r\n      while (js.trim().endsWith(\";\")) {\r\n        js = js.slice(0, js.length - 1);\r\n        lexer.lexpos--;\r\n      }\r\n      t.value = js.trim();\r\n      return t;\r\n    }),\r\n    tk(\"COMMENT\", /\\/\\/.*[\\n\\r]/),\r\n    tk(\"LPARAM\", /\\(/),\r\n    tk(\"RPARAM\", /\\)/),\r\n    tk(\"COMMA\", /,/),\r\n    tk(\"NUM\", /[0-9]+/, undefined, \"number\"),\r\n    tk(\"SEMI\", /;/),\r\n    tk(\"NEWLINE\", /\\n/, function (t) {\r\n      t.lexer.lineno += 1;\r\n    }, \"newline\"),\r\n    tk(\"SPACE\", / |\\t/, function (t) {\r\n    }, \"whitespace\")\r\n  ];\r\n\r\n  reserved_tokens.forEach(function (rt) {\r\n    tokens.push(tk(rt.toUpperCase()));\r\n  });\r\n\r\n  function errfunc(lexer) {\r\n    return true;\r\n  }\r\n\r\n  class Lexer extends lexer {\r\n    input(str) {\r\n      //str = stripComments(str);\r\n      return super.input(str);\r\n    }\r\n  }\r\n\r\n  let lex = new Lexer(tokens, errfunc);\r\n  let parser$1 = new parser(lex);\r\n\r\n  function p_Static_String(p) {\r\n    p.expect(\"STATIC_STRING\");\r\n    p.expect(\"SOPEN\");\r\n    let num = p.expect(\"NUM\");\r\n    p.expect(\"SCLOSE\");\r\n    return {type: StructEnum.STATIC_STRING, data: {maxlength: num}}\r\n  }\r\n\r\n  function p_DataRef(p) {\r\n    p.expect(\"DATAREF\");\r\n    p.expect(\"LPARAM\");\r\n    let tname = p.expect(\"ID\");\r\n    p.expect(\"RPARAM\");\r\n    return {type: StructEnum.DATAREF, data: tname}\r\n  }\r\n\r\n  function p_Array(p) {\r\n    p.expect(\"ARRAY\");\r\n    p.expect(\"LPARAM\");\r\n    let arraytype = p_Type(p);\r\n\r\n    let itername = \"\";\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = arraytype.data.replace(/\"/g, \"\");\r\n      arraytype = p_Type(p);\r\n    }\r\n\r\n    p.expect(\"RPARAM\");\r\n    return {type: StructEnum.ARRAY, data: {type: arraytype, iname: itername}}\r\n  }\r\n\r\n  function p_Iter(p) {\r\n    p.expect(\"ITER\");\r\n    p.expect(\"LPARAM\");\r\n\r\n    let arraytype = p_Type(p);\r\n    let itername = \"\";\r\n\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = arraytype.data.replace(/\"/g, \"\");\r\n      arraytype = p_Type(p);\r\n    }\r\n\r\n    p.expect(\"RPARAM\");\r\n    return {type: StructEnum.ITER, data: {type: arraytype, iname: itername}}\r\n  }\r\n\r\n  function p_StaticArray(p) {\r\n    p.expect(\"STATIC_ARRAY\");\r\n    p.expect(\"SOPEN\");\r\n    let arraytype = p_Type(p);\r\n    let itername = \"\";\r\n\r\n    p.expect(\"COMMA\");\r\n    let size = p.expect(\"NUM\");\r\n\r\n    if (size < 0 || Math.abs(size - Math.floor(size)) > 0.000001) {\r\n      console.log(Math.abs(size - Math.floor(size)));\r\n      p.error(\"Expected an integer\");\r\n    }\r\n\r\n    size = Math.floor(size);\r\n\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = p_Type(p).data;\r\n    }\r\n\r\n    p.expect(\"SCLOSE\");\r\n    return {type: StructEnum.STATIC_ARRAY, data: {type: arraytype, size: size, iname: itername}}\r\n  }\r\n\r\n  function p_IterKeys(p) {\r\n    p.expect(\"ITERKEYS\");\r\n    p.expect(\"LPARAM\");\r\n\r\n    let arraytype = p_Type(p);\r\n    let itername = \"\";\r\n\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = arraytype.data.replace(/\"/g, \"\");\r\n      arraytype = p_Type(p);\r\n    }\r\n\r\n    p.expect(\"RPARAM\");\r\n    return {type: StructEnum.ITERKEYS, data: {type: arraytype, iname: itername}}\r\n  }\r\n\r\n  function p_Abstract(p) {\r\n    p.expect(\"ABSTRACT\");\r\n    p.expect(\"LPARAM\");\r\n    let type = p.expect(\"ID\");\r\n\r\n    let jsonKeyword = \"_structName\";\r\n\r\n    if (p.optional(\"COMMA\")) {\r\n      jsonKeyword = p.expect(\"STRLIT\");\r\n    }\r\n\r\n    p.expect(\"RPARAM\");\r\n\r\n    return {\r\n      type: StructEnum.TSTRUCT,\r\n      data: type,\r\n      jsonKeyword\r\n    }\r\n  }\r\n\r\n  function p_Type(p) {\r\n    let tok = p.peeknext();\r\n\r\n    if (tok.type === \"ID\") {\r\n      p.next();\r\n      return {type: StructEnum.STRUCT, data: tok.value}\r\n    } else if (basic_types.has(tok.type.toLowerCase())) {\r\n      p.next();\r\n      return {type: StructTypes[tok.type.toLowerCase()]}\r\n    } else if (tok.type === \"ARRAY\") {\r\n      return p_Array(p);\r\n    } else if (tok.type === \"ITER\") {\r\n      return p_Iter(p);\r\n    } else if (tok.type === \"ITERKEYS\") {\r\n      return p_IterKeys(p);\r\n    } else if (tok.type === \"STATIC_ARRAY\") {\r\n      return p_StaticArray(p);\r\n    } else if (tok.type === \"STATIC_STRING\") {\r\n      return p_Static_String(p);\r\n    } else if (tok.type === \"ABSTRACT\") {\r\n      return p_Abstract(p);\r\n    } else if (tok.type === \"DATAREF\") {\r\n      return p_DataRef(p);\r\n    } else {\r\n      p.error(tok, \"invalid type \" + tok.type);\r\n    }\r\n  }\r\n\r\n  function p_ID_or_num(p) {\r\n    let t = p.peeknext();\r\n\r\n    if (t.type === \"NUM\") {\r\n      p.next();\r\n      return t.value;\r\n    } else {\r\n      return p.expect(\"ID\", \"struct field name\");\r\n    }\r\n  }\r\n\r\n  function p_Field(p) {\r\n    let field = {};\r\n\r\n    field.name = p_ID_or_num(p);\r\n    p.expect(\"COLON\");\r\n\r\n    field.type = p_Type(p);\r\n    field.set = undefined;\r\n    field.get = undefined;\r\n\r\n    let check = 0;\r\n\r\n    let tok = p.peeknext();\r\n\r\n    if (tok && tok.type === \"JSCRIPT\") {\r\n      field.get = tok.value;\r\n      check = 1;\r\n\r\n      p.next();\r\n      tok = p.peeknext();\r\n    }\r\n\r\n    if (tok && tok.type === \"JSCRIPT\") {\r\n      check = 1;\r\n      field.set = tok.value;\r\n\r\n      p.next();\r\n    }\r\n\r\n    p.expect(\"SEMI\");\r\n\r\n    tok = p.peeknext();\r\n\r\n    if (tok && tok.type === \"COMMENT\") {\r\n      field.comment = tok.value;\r\n      p.next();\r\n    } else {\r\n      field.comment = \"\";\r\n    }\r\n\r\n    return field;\r\n  }\r\n\r\n  function p_Struct(p) {\r\n    let name = p.expect(\"ID\", \"struct name\");\r\n\r\n    let st = new NStruct(name);\r\n\r\n    let tok = p.peeknext();\r\n    let id = -1;\r\n\r\n    if (tok.type === \"ID\" && tok.value === \"id\") {\r\n      p.next();\r\n      p.expect(\"EQUALS\");\r\n      st.id = p.expect(\"NUM\");\r\n    }\r\n\r\n    p.expect(\"OPEN\");\r\n    while (1) {\r\n      if (p.at_end()) {\r\n        p.error(undefined);\r\n      } else if (p.optional(\"CLOSE\")) {\r\n        break;\r\n      } else {\r\n        st.fields.push(p_Field(p));\r\n      }\r\n    }\r\n\r\n    return st;\r\n  }\r\n\r\n  parser$1.start = p_Struct;\r\n  return parser$1;\r\n}\r\n\r\nconst struct_parse = StructParser();\n\nvar struct_parser = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  NStruct: NStruct,\n  StructEnum: StructEnum,\n  ArrayTypes: ArrayTypes,\n  ValueTypes: ValueTypes,\n  StructTypes: StructTypes,\n  StructTypeMap: StructTypeMap,\n  stripComments: stripComments,\n  struct_parse: struct_parse\n});\n\n/** dead file */\n\nvar struct_typesystem = /*#__PURE__*/Object.freeze({\n  __proto__: null\n});\n\n\"use strict\";\r\n\r\nvar STRUCT_ENDIAN = true; //little endian\r\n\r\nfunction setBinaryEndian(mode) {\r\n  STRUCT_ENDIAN = !!mode;\r\n}\r\n\r\nlet temp_dataview = new DataView(new ArrayBuffer(16));\r\nlet uint8_view = new Uint8Array(temp_dataview.buffer);\r\n\r\nclass unpack_context {\r\n  constructor() {\r\n    this.i = 0;\r\n  }\r\n}\r\n\r\nfunction pack_byte(array, val) {\r\n  array.push(val);\r\n}\r\n\r\nfunction pack_sbyte(array, val) {\r\n  if (val < 0) {\r\n    val = 256 + val;\r\n  }\r\n\r\n  array.push(val);\r\n}\r\n\r\nfunction pack_bytes(array, bytes) {\r\n  for (let i = 0; i < bytes.length; i++) {\r\n    array.push(bytes[i]);\r\n  }\r\n}\r\n\r\nfunction pack_int(array, val) {\r\n  temp_dataview.setInt32(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n  array.push(uint8_view[2]);\r\n  array.push(uint8_view[3]);\r\n}\r\n\r\nfunction pack_uint(array, val) {\r\n  temp_dataview.setUint32(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n  array.push(uint8_view[2]);\r\n  array.push(uint8_view[3]);\r\n}\r\n\r\nfunction pack_ushort(array, val) {\r\n  temp_dataview.setUint16(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n}\r\n\r\nfunction pack_float(array, val) {\r\n  temp_dataview.setFloat32(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n  array.push(uint8_view[2]);\r\n  array.push(uint8_view[3]);\r\n}\r\n\r\nfunction pack_double(array, val) {\r\n  temp_dataview.setFloat64(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n  array.push(uint8_view[2]);\r\n  array.push(uint8_view[3]);\r\n  array.push(uint8_view[4]);\r\n  array.push(uint8_view[5]);\r\n  array.push(uint8_view[6]);\r\n  array.push(uint8_view[7]);\r\n}\r\n\r\nfunction pack_short(array, val) {\r\n  temp_dataview.setInt16(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n}\r\n\r\nfunction encode_utf8(arr, str) {\r\n  for (let i = 0; i < str.length; i++) {\r\n    let c = str.charCodeAt(i);\r\n\r\n    while (c !== 0) {\r\n      let uc = c & 127;\r\n      c = c >> 7;\r\n\r\n      if (c !== 0)\r\n        uc |= 128;\r\n\r\n      arr.push(uc);\r\n    }\r\n  }\r\n}\r\n\r\nfunction decode_utf8(arr) {\r\n  let str = \"\";\r\n  let i = 0;\r\n\r\n  while (i < arr.length) {\r\n    let c = arr[i];\r\n    let sum = c & 127;\r\n    let j = 0;\r\n    let lasti = i;\r\n\r\n    while (i < arr.length && (c & 128)) {\r\n      j += 7;\r\n      i++;\r\n      c = arr[i];\r\n\r\n      c = (c & 127) << j;\r\n      sum |= c;\r\n    }\r\n\r\n    if (sum === 0) break;\r\n\r\n    str += String.fromCharCode(sum);\r\n    i++;\r\n  }\r\n\r\n  return str;\r\n}\r\n\r\nfunction test_utf8() {\r\n  let s = \"a\" + String.fromCharCode(8800) + \"b\";\r\n  let arr = [];\r\n\r\n  encode_utf8(arr, s);\r\n  let s2 = decode_utf8(arr);\r\n\r\n  if (s !== s2) {\r\n    throw new Error(\"UTF-8 encoding/decoding test failed\");\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction truncate_utf8(arr, maxlen) {\r\n  let len = Math.min(arr.length, maxlen);\r\n\r\n  let last_codepoint = 0;\r\n  let last2 = 0;\r\n\r\n  let incode = false;\r\n  let i = 0;\r\n  let code = 0;\r\n  while (i < len) {\r\n    incode = arr[i] & 128;\r\n\r\n    if (!incode) {\r\n      last2 = last_codepoint + 1;\r\n      last_codepoint = i + 1;\r\n    }\r\n\r\n    i++;\r\n  }\r\n\r\n  if (last_codepoint < maxlen)\r\n    arr.length = last_codepoint;\r\n  else\r\n    arr.length = last2;\r\n\r\n  return arr;\r\n}\r\n\r\nlet _static_sbuf_ss = new Array(2048);\r\n\r\nfunction pack_static_string(data, str, length) {\r\n  if (length === undefined)\r\n    throw new Error(\"'length' paremter is not optional for pack_static_string()\");\r\n\r\n  let arr = length < 2048 ? _static_sbuf_ss : new Array();\r\n  arr.length = 0;\r\n\r\n  encode_utf8(arr, str);\r\n  truncate_utf8(arr, length);\r\n\r\n  for (let i = 0; i < length; i++) {\r\n    if (i >= arr.length) {\r\n      data.push(0);\r\n    } else {\r\n      data.push(arr[i]);\r\n    }\r\n  }\r\n}\r\n\r\nlet _static_sbuf = new Array(32);\r\n\r\n/*strings are packed as 32-bit unicode codepoints*/\r\nfunction pack_string(data, str) {\r\n  _static_sbuf.length = 0;\r\n  encode_utf8(_static_sbuf, str);\r\n\r\n  pack_int(data, _static_sbuf.length);\r\n\r\n  for (let i = 0; i < _static_sbuf.length; i++) {\r\n    data.push(_static_sbuf[i]);\r\n  }\r\n}\r\n\r\nfunction unpack_bytes(dview, uctx, len) {\r\n  let ret = new DataView(dview.buffer.slice(uctx.i, uctx.i + len));\r\n  uctx.i += len;\r\n\r\n  return ret;\r\n}\r\n\r\nfunction unpack_byte(dview, uctx) {\r\n  return dview.getUint8(uctx.i++);\r\n}\r\n\r\nfunction unpack_sbyte(dview, uctx) {\r\n  return dview.getInt8(uctx.i++);\r\n}\r\n\r\nfunction unpack_int(dview, uctx) {\r\n  uctx.i += 4;\r\n  return dview.getInt32(uctx.i - 4, STRUCT_ENDIAN);\r\n}\r\n\r\nfunction unpack_uint(dview, uctx) {\r\n  uctx.i += 4;\r\n  return dview.getUint32(uctx.i - 4, STRUCT_ENDIAN);\r\n}\r\n\r\nfunction unpack_ushort(dview, uctx) {\r\n  uctx.i += 2;\r\n  return dview.getUint16(uctx.i - 2, STRUCT_ENDIAN);\r\n}\r\n\r\nfunction unpack_float(dview, uctx) {\r\n  uctx.i += 4;\r\n  return dview.getFloat32(uctx.i - 4, STRUCT_ENDIAN);\r\n}\r\n\r\nfunction unpack_double(dview, uctx) {\r\n  uctx.i += 8;\r\n  return dview.getFloat64(uctx.i - 8, STRUCT_ENDIAN);\r\n}\r\n\r\nfunction unpack_short(dview, uctx) {\r\n  uctx.i += 2;\r\n  return dview.getInt16(uctx.i - 2, STRUCT_ENDIAN);\r\n}\r\n\r\nlet _static_arr_us = new Array(32);\r\n\r\nfunction unpack_string(data, uctx) {\r\n  let slen = unpack_int(data, uctx);\r\n\r\n  if (!slen) {\r\n    return \"\";\r\n  }\r\n\r\n  let str = \"\";\r\n  let arr = slen < 2048 ? _static_arr_us : new Array(slen);\r\n\r\n  arr.length = slen;\r\n  for (let i = 0; i < slen; i++) {\r\n    arr[i] = unpack_byte(data, uctx);\r\n  }\r\n\r\n  return decode_utf8(arr);\r\n}\r\n\r\nlet _static_arr_uss = new Array(2048);\r\n\r\nfunction unpack_static_string(data, uctx, length) {\r\n  let str = \"\";\r\n\r\n  if (length === undefined)\r\n    throw new Error(\"'length' cannot be undefined in unpack_static_string()\");\r\n\r\n  let arr = length < 2048 ? _static_arr_uss : new Array(length);\r\n  arr.length = 0;\r\n\r\n  let done = false;\r\n  for (let i = 0; i < length; i++) {\r\n    let c = unpack_byte(data, uctx);\r\n\r\n    if (c === 0) {\r\n      done = true;\r\n    }\r\n\r\n    if (!done && c !== 0) {\r\n      arr.push(c);\r\n      //arr.length++;\r\n    }\r\n  }\r\n\r\n  truncate_utf8(arr, length);\r\n  return decode_utf8(arr);\r\n}\n\nvar struct_binpack = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  get STRUCT_ENDIAN () { return STRUCT_ENDIAN; },\n  setBinaryEndian: setBinaryEndian,\n  temp_dataview: temp_dataview,\n  uint8_view: uint8_view,\n  unpack_context: unpack_context,\n  pack_byte: pack_byte,\n  pack_sbyte: pack_sbyte,\n  pack_bytes: pack_bytes,\n  pack_int: pack_int,\n  pack_uint: pack_uint,\n  pack_ushort: pack_ushort,\n  pack_float: pack_float,\n  pack_double: pack_double,\n  pack_short: pack_short,\n  encode_utf8: encode_utf8,\n  decode_utf8: decode_utf8,\n  test_utf8: test_utf8,\n  pack_static_string: pack_static_string,\n  pack_string: pack_string,\n  unpack_bytes: unpack_bytes,\n  unpack_byte: unpack_byte,\n  unpack_sbyte: unpack_sbyte,\n  unpack_int: unpack_int,\n  unpack_uint: unpack_uint,\n  unpack_ushort: unpack_ushort,\n  unpack_float: unpack_float,\n  unpack_double: unpack_double,\n  unpack_short: unpack_short,\n  unpack_string: unpack_string,\n  unpack_static_string: unpack_static_string\n});\n\nlet warninglvl = 2;\r\nlet debug = 0;\r\n\r\nlet _static_envcode_null = \"\";\r\nlet packer_debug, packer_debug_start, packer_debug_end;\r\nlet packdebug_tablevel = 0;\r\n\r\nfunction _get_pack_debug() {\r\n  return {\r\n    packer_debug, packer_debug_start, packer_debug_end,\r\n    debug, warninglvl\r\n  }\r\n}\r\n\r\nclass cachering extends Array {\r\n  constructor(cb, tot) {\r\n    super();\r\n    this.length = tot;\r\n    this.cur = 0;\r\n\r\n    for (let i = 0; i < tot; i++) {\r\n      this[i] = cb();\r\n    }\r\n  }\r\n\r\n  static fromConstructor(cls, tot) {\r\n    return new cachering(() => new cls(), tot);\r\n  }\r\n\r\n  next() {\r\n    let ret = this[this.cur];\r\n\r\n    this.cur = (this.cur + 1)%this.length;\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nfunction gen_tabstr$1(tot) {\r\n  let ret = \"\";\r\n\r\n  for (let i = 0; i < tot; i++) {\r\n    ret += \" \";\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nfunction setWarningMode2(t) {\r\n  if (typeof t !== \"number\" || isNaN(t)) {\r\n    throw new Error(\"Expected a single number (>= 0) argument to setWarningMode\");\r\n  }\r\n\r\n  warninglvl = t;\r\n}\r\n\r\nfunction setDebugMode2(t) {\r\n  debug = t;\r\n\r\n  if (debug) {\r\n    packer_debug = function () {\r\n      let tab = gen_tabstr$1(packdebug_tablevel);\r\n\r\n      if (arguments.length > 0) {\r\n        console.warn(tab, ...arguments);\r\n      } else {\r\n        console.warn(\"Warning: undefined msg\");\r\n      }\r\n    };\r\n    packer_debug_start = function (funcname) {\r\n      packer_debug(\"Start \" + funcname);\r\n      packdebug_tablevel++;\r\n    };\r\n\r\n    packer_debug_end = function (funcname) {\r\n      packdebug_tablevel--;\r\n\r\n      if (funcname) {\r\n        packer_debug(\"Leave \" + funcname);\r\n      }\r\n    };\r\n  } else {\r\n    packer_debug = function () {\r\n    };\r\n    packer_debug_start = function () {\r\n    };\r\n    packer_debug_end = function () {\r\n    };\r\n  }\r\n}\r\n\r\nsetDebugMode2(debug);\r\n\r\nconst StructFieldTypes = [];\r\nconst StructFieldTypeMap = {};\r\n\r\nfunction packNull(manager, data, field, type) {\r\n  StructFieldTypeMap[type.type].packNull(manager, data, field, type);\r\n}\r\n\r\nfunction toJSON(manager, val, obj, field, type) {\r\n  return StructFieldTypeMap[type.type].toJSON(manager, val, obj, field, type);\r\n}\r\n\r\nfunction fromJSON(manager, val, obj, field, type, instance) {\r\n  return StructFieldTypeMap[type.type].fromJSON(manager, val, obj, field, type, instance);\r\n}\r\n\r\nfunction formatJSON(manager, val, obj, field, type, instance, tlvl = 0) {\r\n  return StructFieldTypeMap[type.type].formatJSON(manager, val, obj, field, type, instance, tlvl);\r\n}\r\n\r\nfunction validateJSON(manager, val, obj, field, type, instance, _abstractKey) {\r\n  return StructFieldTypeMap[type.type].validateJSON(manager, val, obj, field, type, instance, _abstractKey);\r\n}\r\n\r\n\r\nfunction unpack_field(manager, data, type, uctx) {\r\n  let name;\r\n\r\n  if (debug) {\r\n    name = StructFieldTypeMap[type.type].define().name;\r\n    packer_debug_start(\"R \" + name);\r\n  }\r\n\r\n  let ret = StructFieldTypeMap[type.type].unpack(manager, data, type, uctx);\r\n\r\n  if (debug) {\r\n    packer_debug_end();\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nlet fakeFields = new cachering(() => {\r\n  return {type: undefined, get: undefined, set: undefined}\r\n}, 256);\r\n\r\nfunction fmt_type(type) {\r\n  return StructFieldTypeMap[type.type].format(type);\r\n}\r\n\r\nfunction do_pack(manager, data, val, obj, field, type) {\r\n  let name;\r\n\r\n  if (debug) {\r\n    name = StructFieldTypeMap[type.type].define().name;\r\n    packer_debug_start(\"W \" + name);\r\n  }\r\n\r\n  let typeid = type;\r\n  if (typeof typeid !== \"number\") {\r\n    typeid = typeid.type;\r\n  }\r\n\r\n  let ret = StructFieldTypeMap[typeid].pack(manager, data, val, obj, field, type);\r\n\r\n  if (debug) {\r\n    packer_debug_end();\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nlet _ws_env = [[undefined, undefined]];\r\n\r\nclass StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    this.pack(manager, data, 0, 0, field, type);\r\n  }\r\n\r\n  static format(type) {\r\n    return this.define().name;\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    return val;\r\n  }\r\n\r\n  static fromJSON(manager, val, obj, field, type, instance) {\r\n    return val;\r\n  }\r\n\r\n  static formatJSON(manager, val, obj, field, type, instance, tlvl) {\r\n    return JSON.stringify(val);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance, _abstractKey) {\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   return false to override default\r\n   helper js for packing\r\n   */\r\n  static useHelperJS(field) {\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   Define field class info.\r\n\r\n   Example:\r\n   <pre>\r\n   static define() {return {\r\n    type : StructEnum.INT,\r\n    name : \"int\"\r\n  }}\r\n   </pre>\r\n   */\r\n  static define() {\r\n    return {\r\n      type: -1,\r\n      name: \"(error)\"\r\n    }\r\n  }\r\n\r\n  /**\r\n   Register field packer/unpacker class.  Will throw an error if define() method is bad.\r\n   */\r\n  static register(cls) {\r\n    if (StructFieldTypes.indexOf(cls) >= 0) {\r\n      throw new Error(\"class already registered\");\r\n    }\r\n\r\n    if (cls.define === StructFieldType.define) {\r\n      throw new Error(\"you forgot to make a define() static method\");\r\n    }\r\n\r\n    if (cls.define().type === undefined) {\r\n      throw new Error(\"cls.define().type was undefined!\");\r\n    }\r\n\r\n    if (cls.define().type in StructFieldTypeMap) {\r\n      throw new Error(\"type \" + cls.define().type + \" is used by another StructFieldType subclass\");\r\n    }\r\n\r\n    StructFieldTypes.push(cls);\r\n    StructFieldTypeMap[cls.define().type] = cls;\r\n  }\r\n}\r\n\r\nclass StructIntField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_int(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_int(data, uctx);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (typeof val !== \"number\" || val !== Math.floor(val)) {\r\n      return \"\" + val + \" is not an integer\";\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.INT,\r\n      name: \"int\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructIntField);\r\n\r\nclass StructFloatField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_float(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_float(data, uctx);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance, _abstractKey) {\r\n    if (typeof val !== \"number\") {\r\n      return \"Not a float: \" + val;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.FLOAT,\r\n      name: \"float\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructFloatField);\r\n\r\nclass StructDoubleField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_double(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_double(data, uctx);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (typeof val !== \"number\") {\r\n      return \"Not a double: \" + val;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.DOUBLE,\r\n      name: \"double\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructDoubleField);\r\n\r\nclass StructStringField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    val = !val ? \"\" : val;\r\n\r\n    pack_string(data, val);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (typeof val !== \"string\") {\r\n      return \"Not a string: \" + val;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    this.pack(manager, data, \"\", 0, field, type);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_string(data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.STRING,\r\n      name: \"string\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructStringField);\r\n\r\nclass StructStaticStringField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    val = !val ? \"\" : val;\r\n\r\n    pack_static_string(data, val, type.data.maxlength);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (typeof val !== \"string\") {\r\n      return \"Not a string: \" + val;\r\n    }\r\n\r\n\r\n    if (val.length > type.data.maxlength) {\r\n      return \"String is too big; limit is \" + type.data.maxlength + \"; string:\" + val;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static format(type) {\r\n    return `static_string[${type.data.maxlength}]`;\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    this.pack(manager, data, \"\", 0, field, type);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_static_string(data, uctx, type.data.maxlength);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.STATIC_STRING,\r\n      name: \"static_string\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructStaticStringField);\r\n\r\nclass StructStructField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    packer_debug(\"struct\", stt.name);\r\n\r\n    manager.write_struct(data, val, stt);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance, _abstractKey) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    if (!val) {\r\n      return \"Expected \" + stt.name + \" object\";\r\n    }\r\n\r\n    return manager.validateJSONIntern(val, stt, _abstractKey);\r\n  }\r\n\r\n  static format(type) {\r\n    return type.data;\r\n  }\r\n\r\n  static fromJSON(manager, val, obj, field, type, instance) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    return manager.readJSON(val, stt, instance);\r\n  }\r\n\r\n  static formatJSON(manager, val, obj, field, type, instance, tlvl) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    return manager.formatJSON_intern(val, stt, field, tlvl);\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    let stt = manager.get_struct(type.data);\r\n    return manager.writeJSON(val, stt);\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, dest) {\r\n    let cls2 = manager.get_struct_cls(type.data);\r\n\r\n    packer_debug(\"struct\", cls2 ? cls2.name : \"(error)\");\r\n    return manager.read_object(data, cls2, uctx, dest);\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    packer_debug(\"struct\", type);\r\n\r\n    for (let field2 of stt.fields) {\r\n      let type2 = field2.type;\r\n\r\n      packNull(manager, data, field2, type2);\r\n    }\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let cls2 = manager.get_struct_cls(type.data);\r\n    packer_debug(\"struct\", cls2 ? cls2.name : \"(error)\");\r\n\r\n    return manager.read_object(data, cls2, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.STRUCT,\r\n      name: \"struct\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructStructField);\r\n\r\nclass StructTStructField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    let cls = manager.get_struct_cls(type.data);\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    const keywords = manager.constructor.keywords;\r\n\r\n    //make sure inheritance is correct\r\n    if (val.constructor.structName !== type.data && (val instanceof cls)) {\r\n      //if (DEBUG.Struct) {\r\n      //    console.log(val.constructor.structName+\" inherits from \"+cls.structName);\r\n      //}\r\n      stt = manager.get_struct(val.constructor.structName);\r\n    } else if (val.constructor.structName === type.data) {\r\n      stt = manager.get_struct(type.data);\r\n    } else {\r\n      console.trace();\r\n      throw new Error(\"Bad struct \" + val.constructor.structName + \" passed to write_struct\");\r\n    }\r\n\r\n    packer_debug(\"int \" + stt.id);\r\n\r\n    pack_int(data, stt.id);\r\n    manager.write_struct(data, val, stt);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance, _abstractKey) {\r\n    let key = type.jsonKeyword;\r\n\r\n    if (typeof val !== \"object\") {\r\n      return typeof val + \" is not an object\";\r\n    }\r\n\r\n    let stt = manager.get_struct(val[key]);\r\n    let cls = manager.get_struct_cls(stt.name);\r\n    let parentcls = manager.get_struct_cls(type.data);\r\n\r\n    let ok = false;\r\n\r\n    do {\r\n      if (cls === parentcls) {\r\n        ok = true;\r\n        break;\r\n      }\r\n\r\n      cls = cls.prototype.__proto__.constructor;\r\n    } while (cls && cls !== Object);\r\n\r\n    if (!ok) {\r\n      return stt.name + \" is not a child class off \" + type.data;\r\n    }\r\n\r\n    return manager.validateJSONIntern(val, stt, type.jsonKeyword);\r\n  }\r\n\r\n\r\n  static fromJSON(manager, val, obj, field, type, instance) {\r\n    let key = type.jsonKeyword;\r\n\r\n    let stt = manager.get_struct(val[key]);\r\n\r\n    return manager.readJSON(val, stt, instance);\r\n  }\r\n\r\n  static formatJSON(manager, val, obj, field, type, instance, tlvl) {\r\n    let key = type.jsonKeyword;\r\n\r\n    let stt = manager.get_struct(val[key]);\r\n\r\n    return manager.formatJSON_intern(val, stt, field, tlvl);\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    const keywords = manager.constructor.keywords;\r\n\r\n    let stt = manager.get_struct(val.constructor.structName);\r\n    let ret = manager.writeJSON(val, stt);\r\n\r\n    ret[type.jsonKeyword] = \"\" + stt.name;\r\n\r\n    return ret;\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    pack_int(data, stt.id);\r\n    packNull(manager, data, field, {type: StructEnum.STRUCT, data: type.data});\r\n  }\r\n\r\n  static format(type) {\r\n    return \"abstract(\" + type.data + \")\";\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, dest) {\r\n    let id = unpack_int(data, uctx);\r\n\r\n    packer_debug(\"-int \" + id);\r\n    if (!(id in manager.struct_ids)) {\r\n      packer_debug(\"tstruct id: \" + id);\r\n      console.trace();\r\n      console.log(id);\r\n      console.log(manager.struct_ids);\r\n      throw new Error(\"Unknown struct type \" + id + \".\");\r\n    }\r\n\r\n    let cls2 = manager.get_struct_id(id);\r\n\r\n    packer_debug(\"struct name: \" + cls2.name);\r\n\r\n    cls2 = manager.struct_cls[cls2.name];\r\n\r\n    return manager.read_object(data, cls2, uctx, dest);\r\n    //packer_debug(\"ret\", ret);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let id = unpack_int(data, uctx);\r\n\r\n    packer_debug(\"-int \" + id);\r\n    if (!(id in manager.struct_ids)) {\r\n      packer_debug(\"tstruct id: \" + id);\r\n      console.trace();\r\n      console.log(id);\r\n      console.log(manager.struct_ids);\r\n      throw new Error(\"Unknown struct type \" + id + \".\");\r\n    }\r\n\r\n    let cls2 = manager.get_struct_id(id);\r\n\r\n    packer_debug(\"struct name: \" + cls2.name);\r\n    cls2 = manager.struct_cls[cls2.name];\r\n\r\n    return manager.read_object(data, cls2, uctx);\r\n    //packer_debug(\"ret\", ret);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.TSTRUCT,\r\n      name: \"tstruct\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructTStructField);\r\n\r\n/** out is just a [string], an array of dimen 1 whose sole entry is the output string. */\r\nfunction formatArrayJson(manager, val, obj, field, type, type2, instance, tlvl, array = val) {\r\n  if (array === undefined || array === null || typeof array !== \"object\" || !array[Symbol.iterator]) {\r\n    console.log(obj);\r\n    console.log(array);\r\n    throw new Error(`Expected an array for ${field.name}`);\r\n  }\r\n\r\n  if (ValueTypes.has(type2.type)) {\r\n    return JSON.stringify(array);\r\n  }\r\n\r\n  let s = '[';\r\n  if (manager.formatCtx.addComments && field.comment.trim()) {\r\n    s += \" \" + field.comment.trim();\r\n  }\r\n\r\n  s += \"\\n\";\r\n\r\n  for (let i = 0; i < array.length; i++) {\r\n    let item = array[i];\r\n\r\n    s += tab(tlvl + 1) + formatJSON(manager, item, val, field, type2, instance, tlvl + 1) + \",\\n\";\r\n  }\r\n\r\n  s += tab(tlvl) + \"]\";\r\n\r\n  return s;\r\n}\r\n\r\nclass StructArrayField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    if (val === undefined) {\r\n      console.trace();\r\n      console.log(\"Undefined array fed to struct struct packer!\");\r\n      console.log(\"Field: \", field);\r\n      console.log(\"Type: \", type);\r\n      console.log(\"\");\r\n      packer_debug(\"int 0\");\r\n      pack_int(data, 0);\r\n      return;\r\n    }\r\n\r\n    packer_debug(\"int \" + val.length);\r\n    pack_int(data, val.length);\r\n\r\n    let d = type.data;\r\n\r\n    let itername = d.iname;\r\n    let type2 = d.type;\r\n\r\n    let env = _ws_env;\r\n    for (let i = 0; i < val.length; i++) {\r\n      let val2 = val[i];\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n      }\r\n\r\n      //XXX not sure I really need this fakeField stub here. . .\r\n      let fakeField = fakeFields.next();\r\n      fakeField.type = type2;\r\n      do_pack(manager, data, val2, obj, fakeField, type2);\r\n    }\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    pack_int(data, 0);\r\n  }\r\n\r\n  static format(type) {\r\n    if (type.data.iname !== \"\" && type.data.iname !== undefined) {\r\n      return \"array(\" + type.data.iname + \", \" + fmt_type(type.data.type) + \")\";\r\n    } else {\r\n      return \"array(\" + fmt_type(type.data.type) + \")\";\r\n    }\r\n  }\r\n\r\n  static useHelperJS(field) {\r\n    return !field.type.data.iname;\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance, _abstractKey) {\r\n    if (!val) {\r\n      return \"not an array: \" + val;\r\n    }\r\n\r\n    for (let i = 0; i < val.length; i++) {\r\n      let ret = validateJSON(manager, val[i], val, field, type.data.type, undefined, _abstractKey);\r\n\r\n      if (typeof ret === \"string\" || !ret) {\r\n        return ret;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static fromJSON(manager, val, obj, field, type, instance) {\r\n    let ret = instance || [];\r\n\r\n    ret.length = 0;\r\n\r\n    for (let i = 0; i < val.length; i++) {\r\n      let val2 = fromJSON(manager, val[i], val, field, type.data.type, undefined);\r\n\r\n      if (val2 === undefined) {\r\n        console.log(val2);\r\n        console.error(\"eeek\");\r\n        process.exit();\r\n      }\r\n\r\n      ret.push(val2);\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  static formatJSON(manager, val, obj, field, type, instance, tlvl) {\r\n    //export function formatArrayJson(manager, val, obj, field, type, type2, instance, tlvl, array=val) {\r\n\r\n    return formatArrayJson(manager, val, obj, field, type, type.data.type, instance, tlvl);\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    val = val || [];\r\n    let json = [];\r\n\r\n    let itername = type.data.iname;\r\n\r\n    for (let i = 0; i < val.length; i++) {\r\n      let val2 = val[i];\r\n      let env = _ws_env;\r\n\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n\r\n        //console.log(\"VAL2\", val2, toJSON(manager, val2, val, field, type.data.type));\r\n      }\r\n\r\n      json.push(toJSON(manager, val2, val, field, type.data.type));\r\n    }\r\n\r\n    return json;\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, dest) {\r\n    let len = unpack_int(data, uctx);\r\n    dest.length = 0;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      dest.push(unpack_field(manager, data, type.data.type, uctx));\r\n    }\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let len = unpack_int(data, uctx);\r\n    packer_debug(\"-int \" + len);\r\n\r\n    let arr = new Array(len);\r\n    for (let i = 0; i < len; i++) {\r\n      arr[i] = unpack_field(manager, data, type.data.type, uctx);\r\n    }\r\n\r\n    return arr;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.ARRAY,\r\n      name: \"array\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructArrayField);\r\n\r\nclass StructIterField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    //this was originally implemented to use ES6 iterators.\r\n    function forEach(cb, thisvar) {\r\n      if (val && val[Symbol.iterator]) {\r\n        for (let item of val) {\r\n          cb.call(thisvar, item);\r\n        }\r\n      } else if (val && val.forEach) {\r\n        val.forEach(function (item) {\r\n          cb.call(thisvar, item);\r\n        });\r\n      } else {\r\n        console.trace();\r\n        console.log(\"Undefined iterable list fed to struct struct packer!\", val);\r\n        console.log(\"Field: \", field);\r\n        console.log(\"Type: \", type);\r\n        console.log(\"\");\r\n      }\r\n    }\r\n\r\n    /* save space for length */\r\n    let starti = data.length;\r\n    data.length += 4;\r\n\r\n    let d = type.data, itername = d.iname, type2 = d.type;\r\n    let env = _ws_env;\r\n\r\n    let i = 0;\r\n    forEach(function (val2) {\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n      }\r\n\r\n      //XXX not sure I really need this fakeField stub here. . .\r\n      let fakeField = fakeFields.next();\r\n      fakeField.type = type2;\r\n      do_pack(manager, data, val2, obj, fakeField, type2);\r\n\r\n      i++;\r\n    }, this);\r\n\r\n    /* write length */\r\n    temp_dataview.setInt32(0, i, STRUCT_ENDIAN);\r\n\r\n    data[starti++] = uint8_view[0];\r\n    data[starti++] = uint8_view[1];\r\n    data[starti++] = uint8_view[2];\r\n    data[starti++] = uint8_view[3];\r\n  }\r\n\r\n  static formatJSON(manager, val, obj, field, type, instance, tlvl) {\r\n    return formatArrayJson(manager, val, obj, field, type, type.data.type, instance, tlvl, list(val));\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    return StructArrayField.validateJSON(...arguments);\r\n  }\r\n\r\n  static fromJSON() {\r\n    return StructArrayField.fromJSON(...arguments);\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    val = val || [];\r\n    let json = [];\r\n\r\n    let itername = type.data.iname;\r\n\r\n    for (let val2 of val) {\r\n      let env = _ws_env;\r\n\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n\r\n        //console.log(\"VAL2\", val2, toJSON(manager, val2, val, field, type.data.type));\r\n      }\r\n\r\n      json.push(toJSON(manager, val2, val, field, type.data.type));\r\n    }\r\n\r\n    return json;\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    pack_int(data, 0);\r\n  }\r\n\r\n  static useHelperJS(field) {\r\n    return !field.type.data.iname;\r\n  }\r\n\r\n  static format(type) {\r\n    if (type.data.iname !== \"\" && type.data.iname !== undefined) {\r\n      return \"iter(\" + type.data.iname + \", \" + fmt_type(type.data.type) + \")\";\r\n    } else {\r\n      return \"iter(\" + fmt_type(type.data.type) + \")\";\r\n    }\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, arr) {\r\n    let len = unpack_int(data, uctx);\r\n    packer_debug(\"-int \" + len);\r\n\r\n    arr.length = 0;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      arr.push(unpack_field(manager, data, type.data.type, uctx));\r\n    }\r\n\r\n    return arr;\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let len = unpack_int(data, uctx);\r\n    packer_debug(\"-int \" + len);\r\n\r\n    let arr = new Array(len);\r\n    for (let i = 0; i < len; i++) {\r\n      arr[i] = unpack_field(manager, data, type.data.type, uctx);\r\n    }\r\n\r\n    return arr;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.ITER,\r\n      name: \"iter\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructIterField);\r\n\r\nclass StructShortField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_short(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_short(data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.SHORT,\r\n      name: \"short\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructShortField);\r\n\r\nclass StructByteField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_byte(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_byte(data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.BYTE,\r\n      name: \"byte\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructByteField);\r\n\r\nclass StructSignedByteField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_sbyte(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_sbyte(data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.SIGNED_BYTE,\r\n      name: \"sbyte\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructSignedByteField);\r\n\r\nclass StructBoolField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_byte(data, !!val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return !!unpack_byte(data, uctx);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (val === 0 || val === 1 || val === true || val === false || val === \"true\" || val === \"false\") {\r\n      return true;\r\n    }\r\n\r\n    return \"\" + val + \" is not a bool\";\r\n  }\r\n\r\n  static fromJSON(manager, val, obj, field, type, instance) {\r\n    if (val === \"false\") {\r\n      val = false;\r\n    }\r\n\r\n    return !!val;\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    return !!val;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.BOOL,\r\n      name: \"bool\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructBoolField);\r\n\r\nclass StructIterKeysField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    //this was originally implemented to use ES6 iterators.\r\n    if ((typeof val !== \"object\" && typeof val !== \"function\") || val === null) {\r\n      console.warn(\"Bad object fed to iterkeys in struct packer!\", val);\r\n      console.log(\"Field: \", field);\r\n      console.log(\"Type: \", type);\r\n      console.log(\"\");\r\n\r\n      pack_int(data, 0);\r\n      return;\r\n    }\r\n\r\n    let len = 0.0;\r\n    for (let k in val) {\r\n      len++;\r\n    }\r\n\r\n    packer_debug(\"int \" + len);\r\n    pack_int(data, len);\r\n\r\n    let d = type.data, itername = d.iname, type2 = d.type;\r\n    let env = _ws_env;\r\n\r\n    let i = 0;\r\n    for (let val2 in val) {\r\n      if (i >= len) {\r\n        if (warninglvl > 0)\r\n          console.warn(\"Warning: object keys magically replaced on us\", val, i);\r\n        return;\r\n      }\r\n\r\n      if (itername && itername.trim().length > 0 && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n      } else {\r\n        val2 = val[val2]; //fetch value\r\n      }\r\n\r\n      let f2 = {type: type2, get: undefined, set: undefined};\r\n      do_pack(manager, data, val2, obj, f2, type2);\r\n\r\n      i++;\r\n    }\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    return StructArrayField.validateJSON(...arguments);\r\n  }\r\n\r\n  static fromJSON() {\r\n    return StructArrayField.fromJSON(...arguments);\r\n  }\r\n\r\n  static formatJSON(manager, val, obj, field, type, instance, tlvl) {\r\n    return formatArrayJson(manager, val, obj, field, type, type.data.type, instance, tlvl, list(val));\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    val = val || [];\r\n    let json = [];\r\n\r\n    let itername = type.data.iname;\r\n\r\n    for (let k in val) {\r\n      let val2 = val[k];\r\n      let env = _ws_env;\r\n\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n\r\n        //console.log(\"VAL2\", val2, toJSON(manager, val2, val, field, type.data.type));\r\n      }\r\n\r\n      json.push(toJSON(manager, val2, val, field, type.data.type));\r\n    }\r\n\r\n    return json;\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    pack_int(data, 0);\r\n  }\r\n\r\n  static useHelperJS(field) {\r\n    return !field.type.data.iname;\r\n  }\r\n\r\n  static format(type) {\r\n    if (type.data.iname !== \"\" && type.data.iname !== undefined) {\r\n      return \"iterkeys(\" + type.data.iname + \", \" + fmt_type(type.data.type) + \")\";\r\n    } else {\r\n      return \"iterkeys(\" + fmt_type(type.data.type) + \")\";\r\n    }\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, arr) {\r\n    let len = unpack_int(data, uctx);\r\n    packer_debug(\"-int \" + len);\r\n\r\n    arr.length = 0;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      arr.push(unpack_field(manager, data, type.data.type, uctx));\r\n    }\r\n\r\n    return arr;\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let len = unpack_int(data, uctx);\r\n    packer_debug(\"-int \" + len);\r\n\r\n    let arr = new Array(len);\r\n    for (let i = 0; i < len; i++) {\r\n      arr[i] = unpack_field(manager, data, type.data.type, uctx);\r\n    }\r\n\r\n    return arr;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.ITERKEYS,\r\n      name: \"iterkeys\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructIterKeysField);\r\n\r\nclass StructUintField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_uint(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_uint(data, uctx);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (typeof val !== \"number\" || val !== Math.floor(val)) {\r\n      return \"\" + val + \" is not an integer\";\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.UINT,\r\n      name: \"uint\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructUintField);\r\n\r\n\r\nclass StructUshortField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_ushort(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_ushort(data, uctx);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (typeof val !== \"number\" || val !== Math.floor(val)) {\r\n      return \"\" + val + \" is not an integer\";\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.USHORT,\r\n      name: \"ushort\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructUshortField);\r\n\r\n//let writeEmpty = writeEmpty = function writeEmpty(stt) {\r\n//}\r\n\r\nclass StructStaticArrayField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    if (type.data.size === undefined) {\r\n      throw new Error(\"type.data.size was undefined\");\r\n    }\r\n\r\n    let itername = type.data.iname;\r\n\r\n    if (val === undefined || !val.length) {\r\n      this.packNull(manager, data, field, type);\r\n      return;\r\n    }\r\n\r\n    for (let i = 0; i < type.data.size; i++) {\r\n      let i2 = Math.min(i, Math.min(val.length - 1, type.data.size));\r\n      let val2 = val[i2];\r\n\r\n      //*\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        let env = _ws_env;\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n      }\r\n\r\n      do_pack(manager, data, val2, val, field, type.data.type);\r\n    }\r\n  }\r\n\r\n  static useHelperJS(field) {\r\n    return !field.type.data.iname;\r\n  }\r\n\r\n  static validateJSON() {\r\n    return StructArrayField.validateJSON(...arguments);\r\n  }\r\n\r\n  static fromJSON() {\r\n    return StructArrayField.fromJSON(...arguments);\r\n  }\r\n\r\n  static formatJSON(manager, val, obj, field, type, instance, tlvl) {\r\n    return formatArrayJson(manager, val, obj, field, type, type.data.type, instance, tlvl, list(val));\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    let size = type.data.size;\r\n    for (let i = 0; i < size; i++) {\r\n      packNull(manager, data, field, type.data.type);\r\n    }\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    return StructArrayField.toJSON(...arguments);\r\n  }\r\n\r\n  static format(type) {\r\n    let type2 = StructFieldTypeMap[type.data.type.type].format(type.data.type);\r\n\r\n    let ret = `static_array[${type2}, ${type.data.size}`;\r\n\r\n    if (type.data.iname) {\r\n      ret += `, ${type.data.iname}`;\r\n    }\r\n    ret += `]`;\r\n\r\n    return ret;\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, ret) {\r\n    packer_debug(\"-size: \" + type.data.size);\r\n\r\n    ret.length = 0;\r\n\r\n    for (let i = 0; i < type.data.size; i++) {\r\n      ret.push(unpack_field(manager, data, type.data.type, uctx));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    packer_debug(\"-size: \" + type.data.size);\r\n\r\n    let ret = [];\r\n\r\n    for (let i = 0; i < type.data.size; i++) {\r\n      ret.push(unpack_field(manager, data, type.data.type, uctx));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.STATIC_ARRAY,\r\n      name: \"static_array\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructStaticArrayField);\n\nvar _sintern2 = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  _get_pack_debug: _get_pack_debug,\n  setWarningMode2: setWarningMode2,\n  setDebugMode2: setDebugMode2,\n  StructFieldTypes: StructFieldTypes,\n  StructFieldTypeMap: StructFieldTypeMap,\n  packNull: packNull,\n  toJSON: toJSON,\n  fromJSON: fromJSON,\n  formatJSON: formatJSON,\n  validateJSON: validateJSON,\n  do_pack: do_pack,\n  StructFieldType: StructFieldType,\n  formatArrayJson: formatArrayJson\n});\n\nvar structEval = eval;\r\n\r\nfunction setStructEval(val) {\r\n  structEval = val;\r\n}\n\nvar _struct_eval = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  get structEval () { return structEval; },\n  setStructEval: setStructEval\n});\n\nconst TokSymbol = Symbol(\"token-info\");\r\n\r\nfunction buildJSONParser() {\r\n  let tk = (name, re, func, example) => new tokdef(name, re, func, example);\r\n\r\n  let parse;\r\n\r\n  let nint = \"[+-]?[0-9]+\";\r\n  let nhex = \"[+-]?0x[0-9a-fA-F]+\";\r\n  let nfloat1 = \"[+-]?[0-9]+\\\\.[0-9]*\";\r\n  let nfloat2 = \"[+-]?[0-9]*\\\\.[0-9]+\";\r\n  let nfloat3 = \"[+-]?[0-9]+\\\\.[0-9]+\";\r\n  let nfloatexp = \"[+-]?[0-9]+\\\\.[0-9]+[eE][+-]?[0-9]+\";\r\n\r\n  let nfloat = `(${nfloat1})|(${nfloat2})|(${nfloatexp})`;\r\n  let num = `(${nint})|(${nfloat})|(${nhex})`;\r\n  let numre = new RegExp(num);\r\n\r\n  let numreTest = new RegExp(`(${num})$`);\r\n\r\n  //nfloat3 has to be its own regexp, the parser\r\n  //always chooses the token handler that parses the most input,\r\n  //and we don't want the partial 0. and .0 handles to split\r\n  //e.g. 3.5 into 3 and 0.5\r\n  nfloat3 = new RegExp(nfloat3);\r\n  nfloatexp = new RegExp(nfloatexp);\r\n\r\n  let tests = [\"1.234234\", \".23432\", \"-234.\", \"1e-17\", \"-0x23423ff\", \"+23423\", \"-4.263256414560601e-14\"];\r\n  for (let test of tests) {\r\n    if (!numreTest.test(test)) {\r\n      console.error(\"Error! Number regexp failed:\", test);\r\n    }\r\n  }\r\n\r\n  let tokens = [\r\n    tk(\"BOOL\", /true|false/),\r\n    tk(\"WS\", /[ \\r\\t\\n]/, t => undefined), //drop token\r\n    tk(\"STRLIT\", /[\"']/, t => {\r\n      let lex = t.lexer;\r\n      let char = t.value;\r\n      let i = lex.lexpos;\r\n      let lexdata = lex.lexdata;\r\n\r\n      let escape = 0;\r\n      t.value = \"\";\r\n      let prev;\r\n\r\n      while (i < lexdata.length) {\r\n        let c = lexdata[i];\r\n\r\n        t.value += c;\r\n\r\n        if (c === \"\\\\\") {\r\n          escape ^= true;\r\n        } else if (!escape && c === char) {\r\n          break;\r\n        } else {\r\n          escape = false;\r\n        }\r\n\r\n        i++;\r\n      }\r\n\r\n      lex.lexpos = i + 1;\r\n\r\n      if (t.value.length > 0) {\r\n        t.value = t.value.slice(0, t.value.length - 1);\r\n      }\r\n\r\n      return t;\r\n    }),\r\n    tk(\"LSBRACKET\", /\\[/),\r\n    tk(\"RSBRACKET\", /]/),\r\n    tk(\"LBRACE\", /{/),\r\n    tk(\"RBRACE\", /}/),\r\n    tk(\"NULL\", /null/),\r\n    tk(\"COMMA\", /,/),\r\n    tk(\"COLON\", /:/),\r\n    tk(\"NUM\", numre, t => (t.value = parseFloat(t.value), t)),\r\n    tk(\"NUM\", nfloat3, t => (t.value = parseFloat(t.value), t)),\r\n    tk(\"NUM\", nfloatexp, t => (t.value = parseFloat(t.value), t)),\r\n  ];\r\n\r\n  function tokinfo(t) {\r\n    return {\r\n      lexpos: t.lexpos,\r\n      lineno: t.lineno,\r\n      col   : t.col,\r\n      fields: {},\r\n    };\r\n  }\r\n\r\n  function p_Array(p) {\r\n    p.expect(\"LSBRACKET\");\r\n    let t = p.peeknext();\r\n    let first = true;\r\n\r\n    let ret = [];\r\n\r\n    ret[TokSymbol] = tokinfo(t);\r\n\r\n    while (t && t.type !== \"RSBRACKET\") {\r\n      if (!first) {\r\n        p.expect(\"COMMA\");\r\n      }\r\n\r\n      ret[TokSymbol].fields[ret.length] = tokinfo(t);\r\n      ret.push(p_Start(p));\r\n\r\n      first = false;\r\n      t = p.peeknext();\r\n    }\r\n    p.expect(\"RSBRACKET\");\r\n\r\n    return ret;\r\n  }\r\n\r\n  function p_Object(p) {\r\n    p.expect(\"LBRACE\");\r\n\r\n    let obj = {};\r\n\r\n    let first = true;\r\n    let t = p.peeknext();\r\n\r\n    obj[TokSymbol] = tokinfo(t);\r\n    while (t && t.type !== \"RBRACE\") {\r\n      if (!first) {\r\n        p.expect(\"COMMA\");\r\n      }\r\n\r\n      let key = p.expect(\"STRLIT\");\r\n      p.expect(\"COLON\");\r\n\r\n      let val = p_Start(p, true);\r\n\r\n      obj[key] = val;\r\n      first = false;\r\n\r\n      t = p.peeknext();\r\n      obj[TokSymbol].fields[key] = tokinfo(t);\r\n    }\r\n\r\n    p.expect(\"RBRACE\");\r\n\r\n    return obj;\r\n  }\r\n\r\n  function p_Start(p, throwError = true) {\r\n    let t = p.peeknext();\r\n    if (t.type === \"LSBRACKET\") {\r\n      return p_Array(p);\r\n    } else if (t.type === \"LBRACE\") {\r\n      return p_Object(p);\r\n    } else if (t.type === \"STRLIT\" || t.type === \"NUM\" || t.type === \"NULL\" || t.type === \"BOOL\") {\r\n      return p.next().value;\r\n    } else {\r\n      p.error(t, \"Unknown token\");\r\n    }\r\n  }\r\n\r\n  function p_Error(token, msg) {\r\n    throw new PUTIL_ParseError(\"Parse Error\");\r\n  }\r\n\r\n  let lex = new lexer(tokens);\r\n  lex.linestart = 0;\r\n  parse = new parser(lex, p_Error);\r\n  parse.start = p_Start;\r\n  //lex.printTokens = true;\r\n\r\n  return parse;\r\n}\r\n\r\nvar jsonParser = buildJSONParser();\r\n\r\n/*\r\nbuildJSONParser().parse(`\r\n{\r\n                \"alteredX\": -110.95731659202336,\r\n                \"alteredY\": -359.9154922611667,\r\n                \"alteredZ\": -4.263256414560601e-14\r\n}\r\n`.trim()) //*/\r\n\r\nfunction printContext(buf, tokinfo, printColors=true) {\r\n  let lines = buf.split(\"\\n\");\r\n\r\n  if (!tokinfo) {\r\n    return '';\r\n  }\r\n\r\n  let lineno = tokinfo.lineno;\r\n  let col = tokinfo.col;\r\n\r\n  let istart = Math.max(lineno-50, 0);\r\n  let iend = Math.min(lineno+2, lines.length-1);\r\n\r\n  let s = '';\r\n\r\n  if (printColors) {\r\n    s += termColor(\"  /* pretty-printed json */\\n\", \"blue\");\r\n  } else {\r\n    s += \"/* pretty-printed json */\\n\";\r\n  }\r\n\r\n  for (let i=istart; i<iend; i++) {\r\n    let l = lines[i];\r\n\r\n    let idx = \"\" + i;\r\n    while (idx.length < 3) {\r\n      idx = \" \" + idx;\r\n    }\r\n\r\n    if (i === lineno && printColors) {\r\n      s += termColor(`${idx}: ${l}\\n`, \"yellow\");\r\n    } else {\r\n      s += `${idx}: ${l}\\n`;\r\n    }\r\n\r\n    if (i === lineno) {\r\n      let l2 = '';\r\n      for (let j=0; j<col+5; j++) {\r\n        l2 += \" \";\r\n      }\r\n\r\n      s += l2 + \"^\\n\";\r\n    }\r\n  }\r\n\r\n  return s;\r\n}\n\nvar nGlobal;\r\n\r\nif (typeof globalThis !== \"undefined\") {\r\n  nGlobal = globalThis;\r\n} else if (typeof window !== \"undefined\") {\r\n  nGlobal = window;\r\n} else if (typeof global !== \"undefined\") {\r\n  nGlobal = global;\r\n} else if (typeof globals !== \"undefined\") {\r\n  nGlobal = globals;\r\n} else if (typeof self !== \"undefined\") {\r\n  nGlobal = self;\r\n}\r\n\r\nconst DEBUG = {};\r\n\r\nfunction updateDEBUG() {\r\n  for (let k in Object.keys(DEBUG)) {\r\n    delete DEBUG[k];\r\n  }\r\n\r\n  if (typeof nGlobal.DEBUG === \"object\") {\r\n    for (let k in nGlobal.DEBUG) {\r\n      DEBUG[k] = nGlobal.DEBUG[k];\r\n    }\r\n  }\r\n}\n\n\"use strict\";\r\n\r\n//needed to avoid a rollup bug in configurable mode\r\nvar sintern2 = _sintern2;\r\nvar struct_eval = _struct_eval;\r\n\r\nlet warninglvl$1 = 2;\r\n\r\nvar truncateDollarSign = true;\r\nvar manager;\r\n\r\nclass JSONError extends Error {};\r\n\r\nfunction printCodeLines(code) {\r\n  let lines = code.split(String.fromCharCode(10));\r\n  let buf = '';\r\n\r\n  for (let i = 0; i < lines.length; i++) {\r\n    let line = \"\" + (i + 1) + \":\";\r\n\r\n    while (line.length < 3) {\r\n      line += \" \";\r\n    }\r\n\r\n    line += \" \" + lines[i];\r\n    buf += line + String.fromCharCode(10);\r\n  }\r\n\r\n  return buf;\r\n}\r\n\r\nfunction printEvalError(code) {\r\n  console.log(\"== CODE ==\");\r\n  console.log(printCodeLines(code));\r\n\r\n  /* Node suppresses the real error line number in error.stack for some reason.\r\n   * Get it by retriggering the error for real.\r\n   */\r\n  eval(code);\r\n}\r\n\r\nfunction setTruncateDollarSign(v) {\r\n  truncateDollarSign = !!v;\r\n}\r\n\r\nfunction _truncateDollarSign(s) {\r\n  let i = s.search(\"$\");\r\n\r\n  if (i > 0) {\r\n    return s.slice(0, i).trim();\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nfunction unmangle(name) {\r\n  if (truncateDollarSign) {\r\n    return _truncateDollarSign(name);\r\n  } else {\r\n    return name;\r\n  }\r\n}\r\n\r\nlet _static_envcode_null$1 = \"\";\r\n\r\n//truncate webpack-mangled names\r\n\r\nfunction gen_tabstr$2(tot) {\r\n  let ret = \"\";\r\n\r\n  for (let i = 0; i < tot; i++) {\r\n    ret += \" \";\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nlet packer_debug$1, packer_debug_start$1, packer_debug_end$1;\r\n\r\nfunction update_debug_data() {\r\n  let ret = _get_pack_debug();\r\n\r\n  packer_debug$1 = ret.packer_debug;\r\n  packer_debug_start$1 = ret.packer_debug_start;\r\n  packer_debug_end$1 = ret.packer_debug_end;\r\n  warninglvl$1 = ret.warninglvl;\r\n}\r\n\r\nupdate_debug_data();\r\n\r\nfunction setWarningMode(t) {\r\n  sintern2.setWarningMode2(t);\r\n\r\n  if (typeof t !== \"number\" || isNaN(t)) {\r\n    throw new Error(\"Expected a single number (>= 0) argument to setWarningMode\");\r\n  }\r\n\r\n  warninglvl$1 = t;\r\n}\r\n\r\nfunction setDebugMode(t) {\r\n  sintern2.setDebugMode2(t);\r\n  update_debug_data();\r\n}\r\n\r\nlet _ws_env$1 = [[undefined, undefined]];\r\n\r\nfunction define_empty_class(scls, name) {\r\n  let cls = function () {\r\n  };\r\n\r\n  cls.prototype = Object.create(Object.prototype);\r\n  cls.constructor = cls.prototype.constructor = cls;\r\n\r\n  let keywords = scls.keywords;\r\n\r\n  cls.STRUCT = name + \" {\\n  }\\n\";\r\n  cls.structName = name;\r\n\r\n  cls.prototype.loadSTRUCT = function (reader) {\r\n    reader(this);\r\n  };\r\n\r\n  cls.newSTRUCT = function () {\r\n    return new this();\r\n  };\r\n\r\n  return cls;\r\n}\r\n\r\nlet haveCodeGen;\r\n\r\n//$KEYWORD_CONFIG_START\r\n\r\nclass STRUCT {\r\n  constructor() {\r\n    this.idgen = 0;\r\n    this.allowOverriding = true;\r\n\r\n    this.structs = {};\r\n    this.struct_cls = {};\r\n    this.struct_ids = {};\r\n\r\n    this.compiled_code = {};\r\n    this.null_natives = {};\r\n\r\n    this.define_null_native(\"Object\", Object);\r\n\r\n    this.jsonUseColors = true;\r\n    this.jsonBuf = '';\r\n    this.formatCtx = {};\r\n  }\r\n\r\n  static inherit(child, parent, structName = child.name) {\r\n    const keywords = this.keywords;\r\n\r\n    if (!parent.STRUCT) {\r\n      return structName + \"{\\n\";\r\n    }\r\n\r\n    let stt = struct_parse.parse(parent.STRUCT);\r\n    let code = structName + \"{\\n\";\r\n    code += STRUCT.fmt_struct(stt, true, false, true);\r\n    return code;\r\n  }\r\n\r\n  /** invoke loadSTRUCT methods on parent objects.  note that\r\n   reader() is only called once.  it is called however.*/\r\n  static Super(obj, reader) {\r\n    if (warninglvl$1 > 0)\r\n      console.warn(\"deprecated\");\r\n\r\n    reader(obj);\r\n\r\n    function reader2(obj) {\r\n    }\r\n\r\n    let cls = obj.constructor;\r\n    let bad = cls === undefined || cls.prototype === undefined || cls.prototype.__proto__ === undefined;\r\n\r\n    if (bad) {\r\n      return;\r\n    }\r\n\r\n    let parent = cls.prototype.__proto__.constructor;\r\n    bad = bad || parent === undefined;\r\n\r\n    if (!bad && parent.prototype.loadSTRUCT && parent.prototype.loadSTRUCT !== obj.loadSTRUCT) { //parent.prototype.hasOwnProperty(\"loadSTRUCT\")) {\r\n      parent.prototype.loadSTRUCT.call(obj, reader2);\r\n    }\r\n  }\r\n\r\n  /** deprecated.  used with old fromSTRUCT interface. */\r\n  static chain_fromSTRUCT(cls, reader) {\r\n    if (warninglvl$1 > 0)\r\n      console.warn(\"Using deprecated (and evil) chain_fromSTRUCT method, eek!\");\r\n\r\n    let proto = cls.prototype;\r\n    let parent = cls.prototype.prototype.constructor;\r\n\r\n    let obj = parent.fromSTRUCT(reader);\r\n    let obj2 = new cls();\r\n\r\n    let keys = Object.keys(obj).concat(Object.getOwnPropertySymbols(obj));\r\n    //let keys=Object.keys(proto);\r\n\r\n    for (let i = 0; i < keys.length; i++) {\r\n      let k = keys[i];\r\n\r\n      try {\r\n        obj2[k] = obj[k];\r\n      } catch (error) {\r\n        if (warninglvl$1 > 0)\r\n          console.warn(\"  failed to set property\", k);\r\n      }\r\n      //let k=keys[i];\r\n      //if (k==\"__proto__\")\r\n      // continue;\r\n      //obj[k] = proto[k];\r\n    }\r\n\r\n    /*\r\n    if (proto.toString !== Object.prototype.toString)\r\n      obj2.toString = proto.toString;\r\n    //*/\r\n\r\n    return obj2;\r\n  }\r\n\r\n  //defined_classes is an array of class constructors\r\n  //with STRUCT scripts, *OR* another STRUCT instance\r\n  //\r\n\r\n  static formatStruct(stt, internal_only, no_helper_js) {\r\n    return this.fmt_struct(stt, internal_only, no_helper_js);\r\n  }\r\n\r\n  static fmt_struct(stt, internal_only, no_helper_js, addComments) {\r\n    if (internal_only === undefined)\r\n      internal_only = false;\r\n    if (no_helper_js === undefined)\r\n      no_helper_js = false;\r\n\r\n    let s = \"\";\r\n    if (!internal_only) {\r\n      s += stt.name;\r\n      if (stt.id !== -1)\r\n        s += \" id=\" + stt.id;\r\n      s += \" {\\n\";\r\n    }\r\n    let tab = \"  \";\r\n\r\n    function fmt_type(type) {\r\n      return StructFieldTypeMap[type.type].format(type);\r\n\r\n      if (type.type === StructEnum.ARRAY || type.type === StructEnum.ITER || type.type === StructEnum.ITERKEYS) {\r\n        if (type.data.iname !== \"\" && type.data.iname !== undefined) {\r\n          return \"array(\" + type.data.iname + \", \" + fmt_type(type.data.type) + \")\";\r\n        } else {\r\n          return \"array(\" + fmt_type(type.data.type) + \")\";\r\n        }\r\n      } else if (type.type === StructEnum.STATIC_STRING) {\r\n        return \"static_string[\" + type.data.maxlength + \"]\";\r\n      } else if (type.type === StructEnum.STRUCT) {\r\n        return type.data;\r\n      } else if (type.type === StructEnum.TSTRUCT) {\r\n        return \"abstract(\" + type.data + \")\";\r\n      } else {\r\n        return StructTypeMap[type.type];\r\n      }\r\n    }\r\n\r\n    let fields = stt.fields;\r\n    for (let i = 0; i < fields.length; i++) {\r\n      let f = fields[i];\r\n      s += tab + f.name + \" : \" + fmt_type(f.type);\r\n      if (!no_helper_js && f.get !== undefined) {\r\n        s += \" | \" + f.get.trim();\r\n      }\r\n      s += \";\";\r\n\r\n      if (addComments && f.comment.trim()) {\r\n        s += f.comment.trim();\r\n      }\r\n\r\n      s += \"\\n\";\r\n    }\r\n    if (!internal_only)\r\n      s += \"}\";\r\n    return s;\r\n  }\r\n\r\n  static setClassKeyword(keyword, nameKeyword = undefined) {\r\n    if (!nameKeyword) {\r\n      nameKeyword = keyword.toLowerCase() + \"Name\";\r\n    }\r\n\r\n    this.keywords = {\r\n      script: keyword,\r\n      name  : nameKeyword,\r\n      load  : \"load\" + keyword,\r\n      new   : \"new\" + keyword,\r\n      after : \"after\" + keyword,\r\n      from  : \"from\" + keyword\r\n    };\r\n  }\r\n\r\n  define_null_native(name, cls) {\r\n    const keywords = this.constructor.keywords;\r\n    let obj = define_empty_class(this.constructor, name);\r\n\r\n    let stt = struct_parse.parse(obj.STRUCT);\r\n\r\n    stt.id = this.idgen++;\r\n\r\n    this.structs[name] = stt;\r\n    this.struct_cls[name] = cls;\r\n    this.struct_ids[stt.id] = stt;\r\n\r\n    this.null_natives[name] = 1;\r\n  }\r\n\r\n  validateStructs(onerror) {\r\n    function getType(type) {\r\n      switch (type.type) {\r\n        case StructEnum.ITERKEYS:\r\n        case StructEnum.ITER:\r\n        case StructEnum.STATIC_ARRAY:\r\n        case StructEnum.ARRAY:\r\n          return getType(type.data.type);\r\n        case StructEnum.TSTRUCT:\r\n          return type;\r\n        case StructEnum.STRUCT:\r\n        default:\r\n          return type;\r\n      }\r\n    }\r\n\r\n    function formatType(type) {\r\n      let ret = {};\r\n\r\n      ret.type = type.type;\r\n\r\n      if (typeof ret.type === \"number\") {\r\n        for (let k in StructEnum) {\r\n          if (StructEnum[k] === ret.type) {\r\n            ret.type = k;\r\n            break;\r\n          }\r\n        }\r\n      } else if (typeof ret.type === \"object\") {\r\n        ret.type = formatType(ret.type);\r\n      }\r\n\r\n      if (typeof type.data === \"object\") {\r\n        ret.data = formatType(type.data);\r\n      } else {\r\n        ret.data = type.data;\r\n      }\r\n\r\n      return ret;\r\n    }\r\n\r\n    function throwError(stt, field, msg) {\r\n      let buf = STRUCT.formatStruct(stt);\r\n\r\n      console.error(buf + \"\\n\\n\" + msg);\r\n\r\n      if (onerror) {\r\n        onerror(msg, stt, field);\r\n      } else {\r\n        throw new Error(msg);\r\n      }\r\n    }\r\n\r\n    for (let k in this.structs) {\r\n      let stt = this.structs[k];\r\n\r\n      for (let field of stt.fields) {\r\n        if (field.name === \"this\") {\r\n          let type = field.type.type;\r\n\r\n          if (ValueTypes.has(type)) {\r\n            throwError(stt, field, \"'this' cannot be used with value types\");\r\n          }\r\n        }\r\n\r\n        let type = getType(field.type);\r\n\r\n        if (type.type !== StructEnum.STRUCT && type.type !== StructEnum.TSTRUCT) {\r\n          continue;\r\n        }\r\n\r\n        if (!(type.data in this.structs)) {\r\n          let msg = stt.name + \":\" + field.name + \": Unknown struct \" + type.data + \".\";\r\n          throwError(stt, field, msg);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  forEach(func, thisvar) {\r\n    for (let k in this.structs) {\r\n      let stt = this.structs[k];\r\n\r\n      if (thisvar !== undefined)\r\n        func.call(thisvar, stt);\r\n      else\r\n        func(stt);\r\n    }\r\n  }\r\n\r\n  //defaults to structjs.manager\r\n  parse_structs(buf, defined_classes) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    if (defined_classes === undefined) {\r\n      defined_classes = manager;\r\n    }\r\n\r\n    if (defined_classes instanceof STRUCT) {\r\n      let struct2 = defined_classes;\r\n      defined_classes = [];\r\n\r\n      for (let k in struct2.struct_cls) {\r\n        defined_classes.push(struct2.struct_cls[k]);\r\n      }\r\n    }\r\n\r\n    if (defined_classes === undefined) {\r\n      defined_classes = [];\r\n\r\n      for (let k in manager.struct_cls) {\r\n        defined_classes.push(manager.struct_cls[k]);\r\n      }\r\n    }\r\n\r\n    let clsmap = {};\r\n\r\n    for (let i = 0; i < defined_classes.length; i++) {\r\n      let cls = defined_classes[i];\r\n\r\n      if (!cls.structName && cls.STRUCT) {\r\n        let stt = struct_parse.parse(cls.STRUCT.trim());\r\n        cls.structName = stt.name;\r\n      } else if (!cls.structName && cls.name !== \"Object\") {\r\n        if (warninglvl$1 > 0)\r\n          console.log(\"Warning, bad class in registered class list\", unmangle(cls.name), cls);\r\n        continue;\r\n      }\r\n\r\n      clsmap[cls.structName] = defined_classes[i];\r\n    }\r\n\r\n    struct_parse.input(buf);\r\n\r\n    while (!struct_parse.at_end()) {\r\n      let stt = struct_parse.parse(undefined, false);\r\n\r\n      if (!(stt.name in clsmap)) {\r\n        if (!(stt.name in this.null_natives))\r\n          if (warninglvl$1 > 0)\r\n            console.log(\"WARNING: struct \" + stt.name + \" is missing from class list.\");\r\n\r\n        let dummy = define_empty_class(this.constructor, stt.name);\r\n\r\n        dummy.STRUCT = STRUCT.fmt_struct(stt);\r\n        dummy.structName = stt.name;\r\n\r\n        dummy.prototype.structName = dummy.name;\r\n\r\n        this.struct_cls[dummy.structName] = dummy;\r\n        this.structs[dummy.structName] = stt;\r\n\r\n        if (stt.id !== -1)\r\n          this.struct_ids[stt.id] = stt;\r\n      } else {\r\n        this.struct_cls[stt.name] = clsmap[stt.name];\r\n        this.structs[stt.name] = stt;\r\n\r\n        if (stt.id !== -1)\r\n          this.struct_ids[stt.id] = stt;\r\n      }\r\n\r\n      let tok = struct_parse.peek();\r\n      while (tok && (tok.value === \"\\n\" || tok.value === \"\\r\" || tok.value === \"\\t\" || tok.value === \" \")) {\r\n        tok = struct_parse.peek();\r\n      }\r\n    }\r\n  }\r\n\r\n  /** adds all structs referenced by cls inside of srcSTRUCT\r\n   *  to this */\r\n  registerGraph(srcSTRUCT, cls) {\r\n    if (!cls.structName) {\r\n      console.warn(\"class was not in srcSTRUCT\");\r\n      return this.register(cls);\r\n    }\r\n\r\n    let recStruct;\r\n\r\n    let recArray = (t) => {\r\n      switch (t.type) {\r\n        case StructEnum.ARRAY:\r\n          return recArray(t.data.type);\r\n        case StructEnum.ITERKEYS:\r\n          return recArray(t.data.type);\r\n        case StructEnum.STATIC_ARRAY:\r\n          return recArray(t.data.type);\r\n        case StructEnum.ITER:\r\n          return recArray(t.data.type);\r\n        case StructEnum.STRUCT:\r\n        case StructEnum.TSTRUCT: {\r\n          let st = srcSTRUCT.structs[t.data];\r\n          let cls = srcSTRUCT.struct_cls[st.name];\r\n\r\n          return recStruct(st, cls);\r\n        }\r\n      }\r\n    };\r\n\r\n    recStruct = (st, cls) => {\r\n      if (!(cls.structName in this.structs)) {\r\n        this.add_class(cls, cls.structName);\r\n      }\r\n\r\n      for (let f of st.fields) {\r\n        if (f.type.type === StructEnum.STRUCT || f.type.type === StructEnum.TSTRUCT) {\r\n          let st2 = srcSTRUCT.structs[f.type.data];\r\n          let cls2 = srcSTRUCT.struct_cls[st2.name];\r\n\r\n          recStruct(st2, cls2);\r\n        } else if (f.type.type === StructEnum.ARRAY) {\r\n          recArray(f.type);\r\n        } else if (f.type.type === StructEnum.ITER) {\r\n          recArray(f.type);\r\n        } else if (f.type.type === StructEnum.ITERKEYS) {\r\n          recArray(f.type);\r\n        } else if (f.type.type === StructEnum.STATIC_ARRAY) {\r\n          recArray(f.type);\r\n        }\r\n      }\r\n    };\r\n\r\n    let st = srcSTRUCT.structs[cls.structName];\r\n    recStruct(st, cls);\r\n  }\r\n\r\n  register(cls, structName) {\r\n    return this.add_class(cls, structName);\r\n  }\r\n\r\n  unregister(cls) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    if (!cls || !cls.structName || !(cls.structName in this.struct_cls)) {\r\n      console.warn(\"Class not registered with nstructjs\", cls);\r\n      return;\r\n    }\r\n\r\n\r\n    let st = this.structs[cls.structName];\r\n\r\n    delete this.structs[cls.structName];\r\n    delete this.struct_cls[cls.structName];\r\n    delete this.struct_ids[st.id];\r\n  }\r\n\r\n  add_class(cls, structName) {\r\n    //do not register Object\r\n    if (cls === Object) {\r\n      return;\r\n    }\r\n\r\n    const keywords = this.constructor.keywords;\r\n    if (cls.STRUCT) {\r\n      let bad = false;\r\n\r\n      let p = cls;\r\n      while (p) {\r\n        p = p.__proto__;\r\n\r\n        if (p && p.STRUCT && p.STRUCT === cls.STRUCT) {\r\n          bad = true;\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (bad) {\r\n        console.warn(\"Generating \" + keywords.script + \" script for derived class \" + unmangle(cls.name));\r\n        if (!structName) {\r\n          structName = unmangle(cls.name);\r\n        }\r\n\r\n        cls.STRUCT = STRUCT.inherit(cls, p) + \"\\n}\";\r\n      }\r\n    }\r\n\r\n    if (!cls.STRUCT) {\r\n      throw new Error(\"class \" + unmangle(cls.name) + \" has no \" + keywords.script + \" script\");\r\n    }\r\n\r\n    let stt = struct_parse.parse(cls.STRUCT);\r\n\r\n    stt.name = unmangle(stt.name);\r\n\r\n    cls.structName = stt.name;\r\n\r\n    //create default newSTRUCT\r\n    if (cls.newSTRUCT === undefined) {\r\n      cls.newSTRUCT = function () {\r\n        return new this();\r\n      };\r\n    }\r\n\r\n    if (structName !== undefined) {\r\n      stt.name = cls.structName = structName;\r\n    } else if (cls.structName === undefined) {\r\n      cls.structName = stt.name;\r\n    } else {\r\n      stt.name = cls.structName;\r\n    }\r\n\r\n    if (cls.structName in this.structs) {\r\n      console.warn(\"Struct \" + unmangle(cls.structName) + \" is already registered\", cls);\r\n\r\n      if (!this.allowOverriding) {\r\n        throw new Error(\"Struct \" + unmangle(cls.structName) + \" is already registered\");\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    if (stt.id === -1)\r\n      stt.id = this.idgen++;\r\n\r\n    this.structs[cls.structName] = stt;\r\n    this.struct_cls[cls.structName] = cls;\r\n    this.struct_ids[stt.id] = stt;\r\n  }\r\n\r\n  isRegistered(cls) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    if (!cls.hasOwnProperty(\"structName\")) {\r\n      return false;\r\n    }\r\n\r\n    return cls === this.struct_cls[cls.structName];\r\n  }\r\n\r\n  get_struct_id(id) {\r\n    return this.struct_ids[id];\r\n  }\r\n\r\n  get_struct(name) {\r\n    if (!(name in this.structs)) {\r\n      console.warn(\"Unknown struct\", name);\r\n      throw new Error(\"Unknown struct \" + name);\r\n    }\r\n    return this.structs[name];\r\n  }\r\n\r\n  get_struct_cls(name) {\r\n    if (!(name in this.struct_cls)) {\r\n      console.trace();\r\n      throw new Error(\"Unknown struct \" + name);\r\n    }\r\n    return this.struct_cls[name];\r\n  }\r\n\r\n  _env_call(code, obj, env) {\r\n    let envcode = _static_envcode_null$1;\r\n    if (env !== undefined) {\r\n      envcode = \"\";\r\n      for (let i = 0; i < env.length; i++) {\r\n        envcode = \"let \" + env[i][0] + \" = env[\" + i.toString() + \"][1];\\n\" + envcode;\r\n      }\r\n    }\r\n    let fullcode = \"\";\r\n    if (envcode !== _static_envcode_null$1)\r\n      fullcode = envcode + code;\r\n    else\r\n      fullcode = code;\r\n    let func;\r\n\r\n    //fullcode = fullcode.replace(/\\bthis\\b/, \"obj\");\r\n\r\n    if (!(fullcode in this.compiled_code)) {\r\n      let code2 = \"func = function(obj, env) { \" + envcode + \"return \" + code + \"}\";\r\n      try {\r\n        func = struct_eval.structEval(code2);\r\n      } catch (err) {\r\n        console.warn(err.stack);\r\n\r\n        console.warn(code2);\r\n        console.warn(\" \");\r\n        throw err;\r\n      }\r\n      this.compiled_code[fullcode] = func;\r\n    } else {\r\n      func = this.compiled_code[fullcode];\r\n    }\r\n    try {\r\n      return func.call(obj, obj, env);\r\n    } catch (err) {\r\n      console.warn(err.stack);\r\n\r\n      let code2 = \"func = function(obj, env) { \" + envcode + \"return \" + code + \"}\";\r\n      console.warn(code2);\r\n      console.warn(\" \");\r\n      throw err;\r\n    }\r\n  }\r\n\r\n  write_struct(data, obj, stt) {\r\n    function use_helper_js(field) {\r\n      let type = field.type.type;\r\n      let cls = StructFieldTypeMap[type];\r\n      return cls.useHelperJS(field);\r\n    }\r\n\r\n    let fields = stt.fields;\r\n    let thestruct = this;\r\n    for (let i = 0; i < fields.length; i++) {\r\n      let f = fields[i];\r\n      let t1 = f.type;\r\n      let t2 = t1.type;\r\n\r\n      if (use_helper_js(f)) {\r\n        let val;\r\n        let type = t2;\r\n        if (f.get !== undefined) {\r\n          val = thestruct._env_call(f.get, obj);\r\n        } else {\r\n          val = f.name === \"this\" ? obj : obj[f.name];\r\n        }\r\n\r\n        if (DEBUG.tinyeval) {\r\n          console.log(\"\\n\\n\\n\", f.get, \"Helper JS Ret\", val, \"\\n\\n\\n\");\r\n        }\r\n\r\n        sintern2.do_pack(this, data, val, obj, f, t1);\r\n      } else {\r\n        let val = f.name === \"this\" ? obj : obj[f.name];\r\n        sintern2.do_pack(this, data, val, obj, f, t1);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   @param data : array to write data into,\r\n   @param obj  : structable object\r\n   */\r\n  write_object(data, obj) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    let cls = obj.constructor.structName;\r\n    let stt = this.get_struct(cls);\r\n\r\n    if (data === undefined) {\r\n      data = [];\r\n    }\r\n\r\n    this.write_struct(data, obj, stt);\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   Read an object from binary data\r\n\r\n   @param data : DataView or Uint8Array instance\r\n   @param cls_or_struct_id : Structable class\r\n   @param uctx : internal parameter\r\n   @return {cls_or_struct_id} Instance of cls_or_struct_id\r\n   */\r\n  readObject(data, cls_or_struct_id, uctx) {\r\n    if (data instanceof Uint8Array || data instanceof Uint8ClampedArray) {\r\n      data = new DataView(data.buffer);\r\n    } else if (data instanceof Array) {\r\n      data = new DataView(new Uint8Array(data).buffer);\r\n    }\r\n\r\n    return this.read_object(data, cls_or_struct_id, uctx);\r\n  }\r\n\r\n  /**\r\n   @param data array to write data into,\r\n   @param obj structable object\r\n   */\r\n  writeObject(data, obj) {\r\n    return this.write_object(data, obj);\r\n  }\r\n\r\n  writeJSON(obj, stt = undefined) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    let cls = obj.constructor;\r\n    stt = stt || this.get_struct(cls.structName);\r\n\r\n    function use_helper_js(field) {\r\n      let type = field.type.type;\r\n      let cls = StructFieldTypeMap[type];\r\n      return cls.useHelperJS(field);\r\n    }\r\n\r\n    let toJSON = sintern2.toJSON;\r\n\r\n    let fields = stt.fields;\r\n    let thestruct = this;\r\n    let json = {};\r\n\r\n    for (let i = 0; i < fields.length; i++) {\r\n      let f = fields[i];\r\n      let val;\r\n      let t1 = f.type;\r\n\r\n      let json2;\r\n\r\n      if (use_helper_js(f)) {\r\n        if (f.get !== undefined) {\r\n          val = thestruct._env_call(f.get, obj);\r\n        } else {\r\n          val = f.name === \"this\" ? obj : obj[f.name];\r\n        }\r\n\r\n        if (DEBUG.tinyeval) {\r\n          console.log(\"\\n\\n\\n\", f.get, \"Helper JS Ret\", val, \"\\n\\n\\n\");\r\n        }\r\n\r\n        json2 = toJSON(this, val, obj, f, t1);\r\n      } else {\r\n        val = f.name === \"this\" ? obj : obj[f.name];\r\n        json2 = toJSON(this, val, obj, f, t1);\r\n      }\r\n\r\n      if (f.name !== 'this') {\r\n        json[f.name] = json2;\r\n      } else { //f.name was 'this'?\r\n        let isArray = Array.isArray(json2);\r\n        isArray = isArray || f.type.type === StructTypes.ARRAY;\r\n        isArray = isArray || f.type.type === StructTypes.STATIC_ARRAY;\r\n\r\n        if (isArray) {\r\n          json.length = json2.length;\r\n\r\n          for (let i = 0; i < json2.length; i++) {\r\n            json[i] = json2[i];\r\n          }\r\n        } else {\r\n          Object.assign(json, json2);\r\n        }\r\n      }\r\n    }\r\n\r\n    return json;\r\n  }\r\n\r\n  /**\r\n   @param data : DataView or Uint8Array instance\r\n   @param cls_or_struct_id : Structable class\r\n   @param uctx : internal parameter\r\n   */\r\n  read_object(data, cls_or_struct_id, uctx, objInstance) {\r\n    const keywords = this.constructor.keywords;\r\n    let cls, stt;\r\n\r\n    if (data instanceof Array) {\r\n      data = new DataView(new Uint8Array(data).buffer);\r\n    }\r\n\r\n    if (typeof cls_or_struct_id === \"number\") {\r\n      cls = this.struct_cls[this.struct_ids[cls_or_struct_id].name];\r\n    } else {\r\n      cls = cls_or_struct_id;\r\n    }\r\n\r\n    if (cls === undefined) {\r\n      throw new Error(\"bad cls_or_struct_id \" + cls_or_struct_id);\r\n    }\r\n\r\n    stt = this.structs[cls.structName];\r\n\r\n    if (uctx === undefined) {\r\n      uctx = new unpack_context();\r\n\r\n      packer_debug$1(\"\\n\\n=Begin reading \" + cls.structName + \"=\");\r\n    }\r\n    let thestruct = this;\r\n\r\n    let this2 = this;\r\n\r\n    function unpack_field(type) {\r\n      return StructFieldTypeMap[type.type].unpack(this2, data, type, uctx);\r\n    }\r\n\r\n    function unpack_into(type, dest) {\r\n      return StructFieldTypeMap[type.type].unpackInto(this2, data, type, uctx, dest);\r\n    }\r\n\r\n    let was_run = false;\r\n\r\n    function makeLoader(stt) {\r\n      return function load(obj) {\r\n        if (was_run) {\r\n          return;\r\n        }\r\n\r\n        was_run = true;\r\n\r\n        let fields = stt.fields;\r\n        let flen = fields.length;\r\n\r\n        for (let i = 0; i < flen; i++) {\r\n          let f = fields[i];\r\n\r\n          if (f.name === 'this') {\r\n            //load data into obj directly\r\n            unpack_into(f.type, obj);\r\n          } else {\r\n            obj[f.name] = unpack_field(f.type);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    let load = makeLoader(stt);\r\n\r\n    if (cls.prototype.loadSTRUCT !== undefined) {\r\n      let obj = objInstance;\r\n\r\n      if (!obj && cls.newSTRUCT !== undefined) {\r\n        obj = cls.newSTRUCT(load);\r\n      } else if (!obj) {\r\n        obj = new cls();\r\n      }\r\n\r\n      obj.loadSTRUCT(load);\r\n\r\n      if (!was_run) {\r\n        console.warn(\"\" + cls.structName + \".prototype.loadSTRUCT() did not execute its loader callback!\");\r\n        load(obj);\r\n      }\r\n\r\n      return obj;\r\n    } else if (cls.fromSTRUCT !== undefined) {\r\n      if (warninglvl$1 > 1)\r\n        console.warn(\"Warning: class \" + unmangle(cls.name) + \" is using deprecated fromSTRUCT interface; use newSTRUCT/loadSTRUCT instead\");\r\n      return cls.fromSTRUCT(load);\r\n    } else { //default case, make new instance and then call load() on it\r\n      let obj = objInstance;\r\n\r\n      if (!obj && cls.newSTRUCT !== undefined) {\r\n        obj = cls.newSTRUCT(load);\r\n      } else if (!obj) {\r\n        obj = new cls();\r\n      }\r\n\r\n      load(obj);\r\n\r\n      return obj;\r\n    }\r\n  }\r\n\r\n  validateJSON(json, cls_or_struct_id, useInternalParser = true, useColors = true, consoleLogger = function () {\r\n    console.log(...arguments);\r\n  }, _abstractKey                                        = \"_structName\") {\r\n    if (cls_or_struct_id === undefined) {\r\n      throw new Error(this.constructor.name + \".prototype.validateJSON: Expected at least two arguments\");\r\n    }\r\n\r\n    try {\r\n      json = JSON.stringify(json, undefined, 2);\r\n\r\n      this.jsonBuf = json;\r\n      this.jsonUseColors = useColors;\r\n      this.jsonLogger = consoleLogger;\r\n\r\n      //add token annotations\r\n      jsonParser.logger = this.jsonLogger;\r\n\r\n      if (useInternalParser) {\r\n        json = jsonParser.parse(json);\r\n      } else {\r\n        json = JSON.parse(json);\r\n      }\r\n\r\n      this.validateJSONIntern(json, cls_or_struct_id, _abstractKey);\r\n\r\n    } catch (error) {\r\n      if (!(error instanceof JSONError)) {\r\n        console.error(error.stack);\r\n      }\r\n\r\n      this.jsonLogger(error.message);\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  validateJSONIntern(json, cls_or_struct_id, _abstractKey = \"_structName\") {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    let cls, stt;\r\n\r\n    if (typeof cls_or_struct_id === \"number\") {\r\n      cls = this.struct_cls[this.struct_ids[cls_or_struct_id].name];\r\n    } else if (cls_or_struct_id instanceof NStruct) {\r\n      cls = this.get_struct_cls(cls_or_struct_id.name);\r\n    } else {\r\n      cls = cls_or_struct_id;\r\n    }\r\n\r\n    if (cls === undefined) {\r\n      throw new Error(\"bad cls_or_struct_id \" + cls_or_struct_id);\r\n    }\r\n\r\n    stt = this.structs[cls.structName];\r\n\r\n    if (stt === undefined) {\r\n      throw new Error(\"unknown class \" + cls);\r\n    }\r\n\r\n    let fields = stt.fields;\r\n    let flen = fields.length;\r\n\r\n    let keys = new Set();\r\n    keys.add(_abstractKey);\r\n\r\n    let keyTestJson = json;\r\n\r\n    for (let i = 0; i < flen; i++) {\r\n      let f = fields[i];\r\n\r\n      let val;\r\n\r\n      let tokinfo;\r\n\r\n      if (f.name === 'this') {\r\n        val = json;\r\n        keyTestJson = {\r\n          \"this\": json\r\n        };\r\n\r\n        keys.add(\"this\");\r\n        tokinfo = json[TokSymbol];\r\n      } else {\r\n        val = json[f.name];\r\n        keys.add(f.name);\r\n\r\n        tokinfo = json[TokSymbol] ? json[TokSymbol].fields[f.name] : undefined;\r\n        if (!tokinfo) {\r\n          let f2 = fields[Math.max(i - 1, 0)];\r\n          tokinfo = TokSymbol[TokSymbol] ? json[TokSymbol].fields[f2.name] : undefined;\r\n        }\r\n\r\n        if (!tokinfo) {\r\n          tokinfo = json[TokSymbol];\r\n        }\r\n      }\r\n\r\n      if (val === undefined) {\r\n        //console.warn(\"nstructjs.readJSON: Missing field \" + f.name + \" in struct \" + stt.name);\r\n        //continue;\r\n      }\r\n\r\n      let instance = f.name === 'this' ? val : json;\r\n\r\n      let ret = sintern2.validateJSON(this, val, json, f, f.type, instance, _abstractKey);\r\n\r\n      if (!ret || typeof ret === \"string\") {\r\n        let msg = typeof ret === \"string\" ? \": \" + ret : \"\";\r\n\r\n        if (tokinfo) {\r\n          this.jsonLogger(printContext(this.jsonBuf, tokinfo, this.jsonUseColors));\r\n        }\r\n\r\n        //console.error(cls.STRUCT);\r\n\r\n        if (val === undefined) {\r\n          throw new JSONError(\"Missing json field \" + f.name + msg);\r\n        } else {\r\n          throw new JSONError(\"Invalid json field \" + f.name + msg);\r\n        }\r\n\r\n        return false;\r\n      }\r\n    }\r\n\r\n    for (let k in keyTestJson) {\r\n      if (typeof json[k] === \"symbol\") {\r\n        //ignore symbols\r\n        continue;\r\n      }\r\n\r\n      if (!keys.has(k)) {\r\n        this.jsonLogger(cls.STRUCT);\r\n        throw new JSONError(\"Unknown json field \" + k);\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  readJSON(json, cls_or_struct_id, objInstance = undefined) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    let cls, stt;\r\n\r\n    if (typeof cls_or_struct_id === \"number\") {\r\n      cls = this.struct_cls[this.struct_ids[cls_or_struct_id].name];\r\n    } else if (cls_or_struct_id instanceof NStruct) {\r\n      cls = this.get_struct_cls(cls_or_struct_id.name);\r\n    } else {\r\n      cls = cls_or_struct_id;\r\n    }\r\n\r\n    if (cls === undefined) {\r\n      throw new Error(\"bad cls_or_struct_id \" + cls_or_struct_id);\r\n    }\r\n\r\n    stt = this.structs[cls.structName];\r\n\r\n    packer_debug$1(\"\\n\\n=Begin reading \" + cls.structName + \"=\");\r\n    let thestruct = this;\r\n    let this2 = this;\r\n    let was_run = false;\r\n    let fromJSON = sintern2.fromJSON;\r\n\r\n    function makeLoader(stt) {\r\n      return function load(obj) {\r\n        if (was_run) {\r\n          return;\r\n        }\r\n\r\n        was_run = true;\r\n\r\n        let fields = stt.fields;\r\n        let flen = fields.length;\r\n\r\n        for (let i = 0; i < flen; i++) {\r\n          let f = fields[i];\r\n\r\n          let val;\r\n\r\n          if (f.name === 'this') {\r\n            val = json;\r\n          } else {\r\n            val = json[f.name];\r\n          }\r\n\r\n          if (val === undefined) {\r\n            console.warn(\"nstructjs.readJSON: Missing field \" + f.name + \" in struct \" + stt.name);\r\n            continue;\r\n          }\r\n\r\n          let instance = f.name === 'this' ? obj : objInstance;\r\n\r\n          let ret = fromJSON(this2, val, obj, f, f.type, instance);\r\n\r\n          if (f.name !== 'this') {\r\n            obj[f.name] = ret;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    let load = makeLoader(stt);\r\n\r\n    if (cls.prototype.loadSTRUCT !== undefined) {\r\n      let obj = objInstance;\r\n\r\n      if (!obj && cls.newSTRUCT !== undefined) {\r\n        obj = cls.newSTRUCT(load);\r\n      } else if (!obj) {\r\n        obj = new cls();\r\n      }\r\n\r\n      obj.loadSTRUCT(load);\r\n      return obj;\r\n    } else if (cls.fromSTRUCT !== undefined) {\r\n      if (warninglvl$1 > 1)\r\n        console.warn(\"Warning: class \" + unmangle(cls.name) + \" is using deprecated fromSTRUCT interface; use newSTRUCT/loadSTRUCT instead\");\r\n      return cls.fromSTRUCT(load);\r\n    } else { //default case, make new instance and then call load() on it\r\n      let obj = objInstance;\r\n\r\n      if (!obj && cls.newSTRUCT !== undefined) {\r\n        obj = cls.newSTRUCT(load);\r\n      } else if (!obj) {\r\n        obj = new cls();\r\n      }\r\n\r\n      load(obj);\r\n\r\n      return obj;\r\n    }\r\n  }\r\n\r\n  formatJSON_intern(json, stt, field, tlvl = 0) {\r\n    const keywords = this.constructor.keywords;\r\n    const addComments = this.formatCtx.addComments;\r\n\r\n    let s = '{';\r\n\r\n    if (addComments && field && field.comment.trim()) {\r\n      s += \" \" + field.comment.trim();\r\n    }\r\n\r\n    s += \"\\n\";\r\n\r\n    for (let f of stt.fields) {\r\n      let value = json[f.name];\r\n\r\n      s += tab(tlvl + 1) + f.name + \": \";\r\n\r\n      s += sintern2.formatJSON(this, value, json, f, f.type, undefined, tlvl + 1);\r\n      s += \",\";\r\n\r\n      let basetype = f.type.type;\r\n\r\n      if (ArrayTypes.has(basetype)) {\r\n        basetype = f.type.data.type.type;\r\n      }\r\n\r\n      const addComment = ValueTypes.has(basetype) && addComments && f.comment.trim();\r\n\r\n      if (addComment) {\r\n        s += \" \" + f.comment.trim();\r\n      }\r\n\r\n      s += \"\\n\";\r\n    }\r\n\r\n    s += tab(tlvl) + \"}\";\r\n    return s;\r\n  }\r\n\r\n  formatJSON(json, cls, addComments = true, validate = true) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    let s = '';\r\n\r\n    if (validate) {\r\n      this.validateJSON(json, cls);\r\n    }\r\n\r\n    let stt = this.structs[cls.structName];\r\n\r\n    this.formatCtx = {\r\n      addComments,\r\n      validate\r\n    };\r\n\r\n    return this.formatJSON_intern(json, stt);\r\n  }\r\n};\r\n//$KEYWORD_CONFIG_END\r\n\r\nif (haveCodeGen) {\r\n  var StructClass;\r\n\r\n  try {\r\n    eval(code);\r\n  } catch (error) {\r\n    printEvalError(code);\r\n  }\r\n\r\n  StructClass.keywords = {\r\n    name  : \"structName\",\r\n    script: \"STRUCT\",\r\n    load  : \"loadSTRUCT\",\r\n    from  : \"fromSTRUCT\",\r\n    new   : \"newSTRUCT\",\r\n  };\r\n\r\n  STRUCT = StructClass;\r\n}\r\n\r\nSTRUCT.setClassKeyword(\"STRUCT\");\r\n\r\nfunction deriveStructManager(keywords = {\r\n  script: \"STRUCT\",\r\n  name  : undefined, //script.toLowerCase + \"Name\"\r\n  load  : undefined, //\"load\" + script\r\n  new   : undefined, //\"new\" + script\r\n  from  : undefined, //\"from\" + script\r\n}) {\r\n\r\n  if (!keywords.name) {\r\n    keywords.name = keywords.script.toLowerCase() + \"Name\";\r\n  }\r\n\r\n  if (!keywords.load) {\r\n    keywords.load = \"load\" + keywords.script;\r\n  }\r\n\r\n  if (!keywords.new) {\r\n    keywords.new = \"new\" + keywords.script;\r\n  }\r\n\r\n  if (!keywords.from) {\r\n    keywords.from = \"from\" + keywords.script;\r\n  }\r\n\r\n  if (!haveCodeGen) {\r\n    class NewSTRUCT extends STRUCT {\r\n\r\n    }\r\n\r\n    NewSTRUCT.keywords = keywords;\r\n    return NewSTRUCT;\r\n  } else {\r\n    var StructClass;\r\n    var _json_parser = jsonParser;\r\n    var _util = util;\r\n\r\n    let code2 = code;\r\n    code2 = code2.replace(/\\[keywords.script\\]/g, \".\" + keywords.script);\r\n    code2 = code2.replace(/\\[keywords.name\\]/g, \".\" + keywords.name);\r\n    code2 = code2.replace(/\\bjsonParser\\b/g, \"_json_parser\");\r\n    code2 = code2.replace(/\\butil\\b/g, \"_util\");\r\n\r\n    //console.log(\"\\n\\n\");\r\n    //console.log(printCodeLines(code2));\r\n    //console.log(\"\\n\\n\");\r\n\r\n    try {\r\n      eval(code2);\r\n    } catch (error) {\r\n      printEvalError(code2);\r\n    }\r\n\r\n    StructClass.keywords = keywords;\r\n    return StructClass;\r\n  }\r\n}\r\n\r\n//main struct script manager\r\nmanager = new STRUCT();\r\n\r\n/**\r\n * Write all defined structs out to a string.\r\n *\r\n * @param nManager STRUCT instance, defaults to nstructjs.manager\r\n * @param include_code include save code snippets\r\n * */\r\nfunction write_scripts(nManager = manager, include_code = false) {\r\n  let buf = \"\";\r\n\r\n  /* prevent code generation bugs in configurable mode */\r\n  let nl = String.fromCharCode(10);\r\n  let tab = String.fromCharCode(9);\r\n\r\n  nManager.forEach(function (stt) {\r\n    buf += STRUCT.fmt_struct(stt, false, !include_code) + nl;\r\n  });\r\n\r\n  let buf2 = buf;\r\n  buf = \"\";\r\n\r\n  for (let i = 0; i < buf2.length; i++) {\r\n    let c = buf2[i];\r\n    if (c === nl) {\r\n      buf += nl;\r\n      let i2 = i;\r\n      while (i < buf2.length && (buf2[i] === \" \" || buf2[i] === tab || buf2[i] === nl)) {\r\n        i++;\r\n      }\r\n      if (i !== i2)\r\n        i--;\r\n    } else {\r\n      buf += c;\r\n    }\r\n  }\r\n\r\n  return buf;\r\n}\n\n\"use strict\";\r\n\r\nlet nbtoa, natob;\r\n\r\nif (typeof btoa === \"undefined\") {\r\n  nbtoa = function btoa(str) {\r\n    let buffer = new Buffer(\"\" + str, 'binary');\r\n    return buffer.toString('base64');\r\n  };\r\n\r\n  natob = function atob(str) {\r\n    return new Buffer(str, 'base64').toString('binary');\r\n  };\r\n} else {\r\n  natob = atob;\r\n  nbtoa = btoa;\r\n}\r\n\r\n/*\r\nfile format:\r\n  magic signature              : 4 bytes\r\n  file version major           : 2 bytes\r\n  file version minor           : 1 bytes\r\n  file version micro           : 1 bytes\r\n  length of struct scripts     : 4 bytes\r\n  struct scripts for this file : ...\r\n  \r\n  block:\r\n    magic signature for block              : 4 bytes\r\n    length of data  (not including header) : 4 bytes\r\n    id of struct type                      : 4 bytes\r\n    \r\n    data                                   : ...\r\n*/\r\n\r\nfunction versionToInt(v) {\r\n  v = versionCoerce(v);\r\n  let mul = 64;\r\n  return ~~(v.major*mul*mul*mul + v.minor*mul*mul + v.micro*mul);\r\n}\r\n\r\nlet ver_pat = /[0-9]+\\.[0-9]+\\.[0-9]+$/;\r\n\r\nfunction versionCoerce(v) {\r\n  if (!v) {\r\n    throw new Error(\"empty version: \" + v);\r\n  }\r\n\r\n  if (typeof v === \"string\") {\r\n    if (!ver_pat.exec(v)) {\r\n      throw new Error(\"invalid version string \" + v);\r\n    }\r\n\r\n    let ver = v.split(\".\");\r\n    return {\r\n      major : parseInt(ver[0]),\r\n      minor : parseInt(ver[1]),\r\n      micro : parseInt(ver[2])\r\n    }\r\n  } else if (Array.isArray(v)) {\r\n    return {\r\n      major : v[0],\r\n      minor : v[1],\r\n      micro : v[2]\r\n    }\r\n  } else if (typeof v === \"object\") {\r\n    let test = (k) => k in v && typeof v[k] === \"number\";\r\n\r\n    if (!test(\"major\") || !test(\"minor\") || !test(\"micro\")) {\r\n      throw new Error(\"invalid version object: \" + v);\r\n    }\r\n\r\n    return v;\r\n  } else {\r\n    throw new Error(\"invalid version \" + v);\r\n  }\r\n}\r\n\r\nfunction versionLessThan(a, b) {\r\n  return versionToInt(a) < versionToInt(b);\r\n}\r\n\r\nclass FileParams {\r\n  constructor() {\r\n    this.magic = \"STRT\";\r\n    this.ext = \".bin\";\r\n    this.blocktypes = [\"DATA\"];\r\n\r\n    this.version = {\r\n      major: 0,\r\n      minor: 0,\r\n      micro: 1\r\n    };\r\n  }\r\n}\r\n\r\n//used to define blocks\r\nclass Block {\r\n  constructor(type_magic, data) {\r\n    this.type = type_magic;\r\n    this.data = data;\r\n  }\r\n}\r\n\r\nclass FileeError extends Error {\r\n}\r\n\r\nclass FileHelper {\r\n  //params can be FileParams instance, or object literal\r\n  //(it will convert to FileParams)\r\n  constructor(params) {\r\n    if (params === undefined) {\r\n      params = new FileParams();\r\n    } else {\r\n      let fp = new FileParams();\r\n\r\n      for (let k in params) {\r\n        fp[k] = params[k];\r\n      }\r\n      params = fp;\r\n    }\r\n\r\n    this.version = params.version;\r\n    this.blocktypes = params.blocktypes;\r\n    this.magic = params.magic;\r\n    this.ext = params.ext;\r\n    this.struct = undefined;\r\n    this.unpack_ctx = undefined;\r\n  }\r\n\r\n  read(dataview) {\r\n    this.unpack_ctx = new unpack_context();\r\n\r\n    let magic = unpack_static_string(dataview, this.unpack_ctx, 4);\r\n\r\n    if (magic !== this.magic) {\r\n      throw new FileError(\"corrupted file\");\r\n    }\r\n\r\n    this.version = {};\r\n    this.version.major = unpack_short(dataview, this.unpack_ctx);\r\n    this.version.minor = unpack_byte(dataview, this.unpack_ctx);\r\n    this.version.micro = unpack_byte(dataview, this.unpack_ctx);\r\n\r\n    let struct = this.struct = new STRUCT();\r\n\r\n    let scripts = unpack_string(dataview, this.unpack_ctx);\r\n    this.struct.parse_structs(scripts, manager);\r\n\r\n    let blocks = [];\r\n    let dviewlen = dataview.buffer.byteLength;\r\n\r\n    while (this.unpack_ctx.i < dviewlen) {\r\n      //console.log(\"reading block. . .\", this.unpack_ctx.i, dviewlen);\r\n\r\n      let type = unpack_static_string(dataview, this.unpack_ctx, 4);\r\n      let datalen = unpack_int(dataview, this.unpack_ctx);\r\n      let bstruct = unpack_int(dataview, this.unpack_ctx);\r\n      let bdata;\r\n\r\n      //console.log(type, datalen, bstruct);\r\n\r\n      if (bstruct === -2) { //string data, e.g. JSON\r\n        bdata = unpack_static_string(dataview, this.unpack_ctx, datalen);\r\n      } else {\r\n        bdata = unpack_bytes(dataview, this.unpack_ctx, datalen);\r\n        bdata = struct.read_object(bdata, bstruct, new unpack_context());\r\n      }\r\n\r\n      let block = new Block();\r\n      block.type = type;\r\n      block.data = bdata;\r\n\r\n      blocks.push(block);\r\n    }\r\n\r\n    this.blocks = blocks;\r\n    return blocks;\r\n  }\r\n\r\n  doVersions(old) {\r\n    let blocks = this.blocks;\r\n\r\n    if (versionLessThan(old, \"0.0.1\")) {\r\n      //do something\r\n    }\r\n  }\r\n\r\n  write(blocks) {\r\n    this.struct = manager;\r\n    this.blocks = blocks;\r\n\r\n    let data = [];\r\n\r\n    pack_static_string(data, this.magic, 4);\r\n    pack_short(data, this.version.major);\r\n    pack_byte(data, this.version.minor & 255);\r\n    pack_byte(data, this.version.micro & 255);\r\n\r\n    let scripts = write_scripts();\r\n    pack_string(data, scripts);\r\n\r\n    let struct = this.struct;\r\n\r\n    for (let block of blocks) {\r\n      if (typeof block.data === \"string\") { //string data, e.g. JSON\r\n        pack_static_string(data, block.type, 4);\r\n        pack_int(data, block.data.length);\r\n        pack_int(data, -2); //flag as string data\r\n        pack_static_string(data, block.data, block.data.length);\r\n        continue;\r\n      }\r\n\r\n      let structName = block.data.constructor.structName;\r\n      if (structName === undefined || !(structName in struct.structs)) {\r\n        throw new Error(\"Non-STRUCTable object \" + block.data);\r\n      }\r\n\r\n      let data2 = [];\r\n      let stt = struct.structs[structName];\r\n\r\n      struct.write_object(data2, block.data);\r\n\r\n      pack_static_string(data, block.type, 4);\r\n      pack_int(data, data2.length);\r\n      pack_int(data, stt.id);\r\n\r\n      pack_bytes(data, data2);\r\n    }\r\n\r\n    return new DataView(new Uint8Array(data).buffer);\r\n  }\r\n\r\n  writeBase64(blocks) {\r\n    let dataview = this.write(blocks);\r\n\r\n    let str = \"\";\r\n    let bytes = new Uint8Array(dataview.buffer);\r\n\r\n    for (let i = 0; i < bytes.length; i++) {\r\n      str += String.fromCharCode(bytes[i]);\r\n    }\r\n\r\n    return nbtoa(str);\r\n  }\r\n\r\n  makeBlock(type, data) {\r\n    return new Block(type, data);\r\n  }\r\n\r\n  readBase64(base64) {\r\n    let data = natob(base64);\r\n    let data2 = new Uint8Array(data.length);\r\n\r\n    for (let i = 0; i < data.length; i++) {\r\n      data2[i] = data.charCodeAt(i);\r\n    }\r\n\r\n    return this.read(new DataView(data2.buffer));\r\n  }\r\n}\n\nvar struct_filehelper = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  versionToInt: versionToInt,\n  versionCoerce: versionCoerce,\n  versionLessThan: versionLessThan,\n  FileParams: FileParams,\n  Block: Block,\n  FileeError: FileeError,\n  FileHelper: FileHelper\n});\n\n/** truncate webpack mangled names. defaults to true\r\n *  so Mesh$1 turns into Mesh */\r\nfunction truncateDollarSign$1(value = true) {\r\n  setTruncateDollarSign(value);\r\n}\r\n\r\nfunction validateStructs(onerror) {\r\n  return manager.validateStructs(onerror);\r\n}\r\n\r\n/**\r\n true means little endian, false means big endian\r\n */\r\nfunction setEndian(mode) {\r\n  let ret = STRUCT_ENDIAN;\r\n\r\n  setBinaryEndian(mode);\r\n\r\n  return ret;\r\n}\r\n\r\nfunction consoleLogger() {\r\n  console.log(...arguments);\r\n}\r\n\r\n/** Validate json\r\n *\r\n * @param json\r\n * @param cls\r\n * @param useInternalParser If true (the default) an internal parser will be used that generates nicer error messages\r\n * @param printColors\r\n * @param logger\r\n * @returns {*}\r\n */\r\nfunction validateJSON$1(json, cls, useInternalParser, printColors = true, logger = consoleLogger) {\r\n  return manager.validateJSON(json, cls, useInternalParser, printColors, logger);\r\n}\r\n\r\nfunction getEndian() {\r\n  return STRUCT_ENDIAN;\r\n}\r\n\r\nfunction setAllowOverriding(t) {\r\n  return manager.allowOverriding = !!t;\r\n}\r\n\r\nfunction isRegistered(cls) {\r\n  return manager.isRegistered(cls);\r\n}\r\n\r\n/** Register a class with nstructjs **/\r\nfunction register(cls, structName) {\r\n  return manager.register(cls, structName);\r\n}\r\n\r\nfunction unregister(cls) {\r\n  manager.unregister(cls);\r\n}\r\n\r\nfunction inherit(child, parent, structName = child.name) {\r\n\r\n  return STRUCT.inherit(...arguments);\r\n}\r\n\r\n/**\r\n @param data : DataView\r\n */\r\nfunction readObject(data, cls, __uctx = undefined) {\r\n  return manager.readObject(data, cls, __uctx);\r\n}\r\n\r\n/**\r\n @param data : Array instance to write bytes to\r\n */\r\nfunction writeObject(data, obj) {\r\n  return manager.writeObject(data, obj);\r\n}\r\n\r\nfunction writeJSON(obj) {\r\n  return manager.writeJSON(obj);\r\n}\r\n\r\nfunction formatJSON$1(json, cls, addComments = true, validate = true) {\r\n  return manager.formatJSON(json, cls, addComments, validate);\r\n}\r\n\r\nfunction readJSON(json, class_or_struct_id) {\r\n  return manager.readJSON(json, class_or_struct_id);\r\n}\n\nexport { JSONError, STRUCT, _truncateDollarSign, struct_binpack as binpack, consoleLogger, deriveStructManager, struct_filehelper as filehelper, formatJSON$1 as formatJSON, getEndian, inherit, isRegistered, manager, struct_parser as parser, struct_parseutil as parseutil, readJSON, readObject, register, setAllowOverriding, setDebugMode, setEndian, setTruncateDollarSign, setWarningMode, truncateDollarSign$1 as truncateDollarSign, struct_typesystem as typesystem, unpack_context, unregister, validateJSON$1 as validateJSON, validateStructs, writeJSON, writeObject, write_scripts };\n","// THIS FILE IS GENERATED - DO NOT EDIT!\r\n/*!mobile-detect v1.4.4 2019-09-21*/\r\n/*global module:false, define:false*/\r\n/*jshint latedef:false*/\r\n/*!@license Copyright 2013, Heinrich Goebl, License: MIT, see https://github.com/hgoebl/mobile-detect.js*/\r\n(function (define, undefined) {\r\ndefine(function () {\r\n    'use strict';\r\n\r\n    var impl = {};\r\n\r\n    impl.mobileDetectRules = {\r\n    \"phones\": {\r\n        \"iPhone\": \"\\\\biPhone\\\\b|\\\\biPod\\\\b\",\r\n        \"BlackBerry\": \"BlackBerry|\\\\bBB10\\\\b|rim[0-9]+|\\\\b(BBA100|BBB100|BBD100|BBE100|BBF100|STH100)\\\\b-[0-9]+\",\r\n        \"HTC\": \"HTC|HTC.*(Sensation|Evo|Vision|Explorer|6800|8100|8900|A7272|S510e|C110e|Legend|Desire|T8282)|APX515CKT|Qtek9090|APA9292KT|HD_mini|Sensation.*Z710e|PG86100|Z715e|Desire.*(A8181|HD)|ADR6200|ADR6400L|ADR6425|001HT|Inspire 4G|Android.*\\\\bEVO\\\\b|T-Mobile G1|Z520m|Android [0-9.]+; Pixel\",\r\n        \"Nexus\": \"Nexus One|Nexus S|Galaxy.*Nexus|Android.*Nexus.*Mobile|Nexus 4|Nexus 5|Nexus 6\",\r\n        \"Dell\": \"Dell[;]? (Streak|Aero|Venue|Venue Pro|Flash|Smoke|Mini 3iX)|XCD28|XCD35|\\\\b001DL\\\\b|\\\\b101DL\\\\b|\\\\bGS01\\\\b\",\r\n        \"Motorola\": \"Motorola|DROIDX|DROID BIONIC|\\\\bDroid\\\\b.*Build|Android.*Xoom|HRI39|MOT-|A1260|A1680|A555|A853|A855|A953|A955|A956|Motorola.*ELECTRIFY|Motorola.*i1|i867|i940|MB200|MB300|MB501|MB502|MB508|MB511|MB520|MB525|MB526|MB611|MB612|MB632|MB810|MB855|MB860|MB861|MB865|MB870|ME501|ME502|ME511|ME525|ME600|ME632|ME722|ME811|ME860|ME863|ME865|MT620|MT710|MT716|MT720|MT810|MT870|MT917|Motorola.*TITANIUM|WX435|WX445|XT300|XT301|XT311|XT316|XT317|XT319|XT320|XT390|XT502|XT530|XT531|XT532|XT535|XT603|XT610|XT611|XT615|XT681|XT701|XT702|XT711|XT720|XT800|XT806|XT860|XT862|XT875|XT882|XT883|XT894|XT901|XT907|XT909|XT910|XT912|XT928|XT926|XT915|XT919|XT925|XT1021|\\\\bMoto E\\\\b|XT1068|XT1092|XT1052\",\r\n        \"Samsung\": \"\\\\bSamsung\\\\b|SM-G950F|SM-G955F|SM-G9250|GT-19300|SGH-I337|BGT-S5230|GT-B2100|GT-B2700|GT-B2710|GT-B3210|GT-B3310|GT-B3410|GT-B3730|GT-B3740|GT-B5510|GT-B5512|GT-B5722|GT-B6520|GT-B7300|GT-B7320|GT-B7330|GT-B7350|GT-B7510|GT-B7722|GT-B7800|GT-C3010|GT-C3011|GT-C3060|GT-C3200|GT-C3212|GT-C3212I|GT-C3262|GT-C3222|GT-C3300|GT-C3300K|GT-C3303|GT-C3303K|GT-C3310|GT-C3322|GT-C3330|GT-C3350|GT-C3500|GT-C3510|GT-C3530|GT-C3630|GT-C3780|GT-C5010|GT-C5212|GT-C6620|GT-C6625|GT-C6712|GT-E1050|GT-E1070|GT-E1075|GT-E1080|GT-E1081|GT-E1085|GT-E1087|GT-E1100|GT-E1107|GT-E1110|GT-E1120|GT-E1125|GT-E1130|GT-E1160|GT-E1170|GT-E1175|GT-E1180|GT-E1182|GT-E1200|GT-E1210|GT-E1225|GT-E1230|GT-E1390|GT-E2100|GT-E2120|GT-E2121|GT-E2152|GT-E2220|GT-E2222|GT-E2230|GT-E2232|GT-E2250|GT-E2370|GT-E2550|GT-E2652|GT-E3210|GT-E3213|GT-I5500|GT-I5503|GT-I5700|GT-I5800|GT-I5801|GT-I6410|GT-I6420|GT-I7110|GT-I7410|GT-I7500|GT-I8000|GT-I8150|GT-I8160|GT-I8190|GT-I8320|GT-I8330|GT-I8350|GT-I8530|GT-I8700|GT-I8703|GT-I8910|GT-I9000|GT-I9001|GT-I9003|GT-I9010|GT-I9020|GT-I9023|GT-I9070|GT-I9082|GT-I9100|GT-I9103|GT-I9220|GT-I9250|GT-I9300|GT-I9305|GT-I9500|GT-I9505|GT-M3510|GT-M5650|GT-M7500|GT-M7600|GT-M7603|GT-M8800|GT-M8910|GT-N7000|GT-S3110|GT-S3310|GT-S3350|GT-S3353|GT-S3370|GT-S3650|GT-S3653|GT-S3770|GT-S3850|GT-S5210|GT-S5220|GT-S5229|GT-S5230|GT-S5233|GT-S5250|GT-S5253|GT-S5260|GT-S5263|GT-S5270|GT-S5300|GT-S5330|GT-S5350|GT-S5360|GT-S5363|GT-S5369|GT-S5380|GT-S5380D|GT-S5560|GT-S5570|GT-S5600|GT-S5603|GT-S5610|GT-S5620|GT-S5660|GT-S5670|GT-S5690|GT-S5750|GT-S5780|GT-S5830|GT-S5839|GT-S6102|GT-S6500|GT-S7070|GT-S7200|GT-S7220|GT-S7230|GT-S7233|GT-S7250|GT-S7500|GT-S7530|GT-S7550|GT-S7562|GT-S7710|GT-S8000|GT-S8003|GT-S8500|GT-S8530|GT-S8600|SCH-A310|SCH-A530|SCH-A570|SCH-A610|SCH-A630|SCH-A650|SCH-A790|SCH-A795|SCH-A850|SCH-A870|SCH-A890|SCH-A930|SCH-A950|SCH-A970|SCH-A990|SCH-I100|SCH-I110|SCH-I400|SCH-I405|SCH-I500|SCH-I510|SCH-I515|SCH-I600|SCH-I730|SCH-I760|SCH-I770|SCH-I830|SCH-I910|SCH-I920|SCH-I959|SCH-LC11|SCH-N150|SCH-N300|SCH-R100|SCH-R300|SCH-R351|SCH-R400|SCH-R410|SCH-T300|SCH-U310|SCH-U320|SCH-U350|SCH-U360|SCH-U365|SCH-U370|SCH-U380|SCH-U410|SCH-U430|SCH-U450|SCH-U460|SCH-U470|SCH-U490|SCH-U540|SCH-U550|SCH-U620|SCH-U640|SCH-U650|SCH-U660|SCH-U700|SCH-U740|SCH-U750|SCH-U810|SCH-U820|SCH-U900|SCH-U940|SCH-U960|SCS-26UC|SGH-A107|SGH-A117|SGH-A127|SGH-A137|SGH-A157|SGH-A167|SGH-A177|SGH-A187|SGH-A197|SGH-A227|SGH-A237|SGH-A257|SGH-A437|SGH-A517|SGH-A597|SGH-A637|SGH-A657|SGH-A667|SGH-A687|SGH-A697|SGH-A707|SGH-A717|SGH-A727|SGH-A737|SGH-A747|SGH-A767|SGH-A777|SGH-A797|SGH-A817|SGH-A827|SGH-A837|SGH-A847|SGH-A867|SGH-A877|SGH-A887|SGH-A897|SGH-A927|SGH-B100|SGH-B130|SGH-B200|SGH-B220|SGH-C100|SGH-C110|SGH-C120|SGH-C130|SGH-C140|SGH-C160|SGH-C170|SGH-C180|SGH-C200|SGH-C207|SGH-C210|SGH-C225|SGH-C230|SGH-C417|SGH-C450|SGH-D307|SGH-D347|SGH-D357|SGH-D407|SGH-D415|SGH-D780|SGH-D807|SGH-D980|SGH-E105|SGH-E200|SGH-E315|SGH-E316|SGH-E317|SGH-E335|SGH-E590|SGH-E635|SGH-E715|SGH-E890|SGH-F300|SGH-F480|SGH-I200|SGH-I300|SGH-I320|SGH-I550|SGH-I577|SGH-I600|SGH-I607|SGH-I617|SGH-I627|SGH-I637|SGH-I677|SGH-I700|SGH-I717|SGH-I727|SGH-i747M|SGH-I777|SGH-I780|SGH-I827|SGH-I847|SGH-I857|SGH-I896|SGH-I897|SGH-I900|SGH-I907|SGH-I917|SGH-I927|SGH-I937|SGH-I997|SGH-J150|SGH-J200|SGH-L170|SGH-L700|SGH-M110|SGH-M150|SGH-M200|SGH-N105|SGH-N500|SGH-N600|SGH-N620|SGH-N625|SGH-N700|SGH-N710|SGH-P107|SGH-P207|SGH-P300|SGH-P310|SGH-P520|SGH-P735|SGH-P777|SGH-Q105|SGH-R210|SGH-R220|SGH-R225|SGH-S105|SGH-S307|SGH-T109|SGH-T119|SGH-T139|SGH-T209|SGH-T219|SGH-T229|SGH-T239|SGH-T249|SGH-T259|SGH-T309|SGH-T319|SGH-T329|SGH-T339|SGH-T349|SGH-T359|SGH-T369|SGH-T379|SGH-T409|SGH-T429|SGH-T439|SGH-T459|SGH-T469|SGH-T479|SGH-T499|SGH-T509|SGH-T519|SGH-T539|SGH-T559|SGH-T589|SGH-T609|SGH-T619|SGH-T629|SGH-T639|SGH-T659|SGH-T669|SGH-T679|SGH-T709|SGH-T719|SGH-T729|SGH-T739|SGH-T746|SGH-T749|SGH-T759|SGH-T769|SGH-T809|SGH-T819|SGH-T839|SGH-T919|SGH-T929|SGH-T939|SGH-T959|SGH-T989|SGH-U100|SGH-U200|SGH-U800|SGH-V205|SGH-V206|SGH-X100|SGH-X105|SGH-X120|SGH-X140|SGH-X426|SGH-X427|SGH-X475|SGH-X495|SGH-X497|SGH-X507|SGH-X600|SGH-X610|SGH-X620|SGH-X630|SGH-X700|SGH-X820|SGH-X890|SGH-Z130|SGH-Z150|SGH-Z170|SGH-ZX10|SGH-ZX20|SHW-M110|SPH-A120|SPH-A400|SPH-A420|SPH-A460|SPH-A500|SPH-A560|SPH-A600|SPH-A620|SPH-A660|SPH-A700|SPH-A740|SPH-A760|SPH-A790|SPH-A800|SPH-A820|SPH-A840|SPH-A880|SPH-A900|SPH-A940|SPH-A960|SPH-D600|SPH-D700|SPH-D710|SPH-D720|SPH-I300|SPH-I325|SPH-I330|SPH-I350|SPH-I500|SPH-I600|SPH-I700|SPH-L700|SPH-M100|SPH-M220|SPH-M240|SPH-M300|SPH-M305|SPH-M320|SPH-M330|SPH-M350|SPH-M360|SPH-M370|SPH-M380|SPH-M510|SPH-M540|SPH-M550|SPH-M560|SPH-M570|SPH-M580|SPH-M610|SPH-M620|SPH-M630|SPH-M800|SPH-M810|SPH-M850|SPH-M900|SPH-M910|SPH-M920|SPH-M930|SPH-N100|SPH-N200|SPH-N240|SPH-N300|SPH-N400|SPH-Z400|SWC-E100|SCH-i909|GT-N7100|GT-N7105|SCH-I535|SM-N900A|SGH-I317|SGH-T999L|GT-S5360B|GT-I8262|GT-S6802|GT-S6312|GT-S6310|GT-S5312|GT-S5310|GT-I9105|GT-I8510|GT-S6790N|SM-G7105|SM-N9005|GT-S5301|GT-I9295|GT-I9195|SM-C101|GT-S7392|GT-S7560|GT-B7610|GT-I5510|GT-S7582|GT-S7530E|GT-I8750|SM-G9006V|SM-G9008V|SM-G9009D|SM-G900A|SM-G900D|SM-G900F|SM-G900H|SM-G900I|SM-G900J|SM-G900K|SM-G900L|SM-G900M|SM-G900P|SM-G900R4|SM-G900S|SM-G900T|SM-G900V|SM-G900W8|SHV-E160K|SCH-P709|SCH-P729|SM-T2558|GT-I9205|SM-G9350|SM-J120F|SM-G920F|SM-G920V|SM-G930F|SM-N910C|SM-A310F|GT-I9190|SM-J500FN|SM-G903F|SM-J330F\",\r\n        \"LG\": \"\\\\bLG\\\\b;|LG[- ]?(C800|C900|E400|E610|E900|E-900|F160|F180K|F180L|F180S|730|855|L160|LS740|LS840|LS970|LU6200|MS690|MS695|MS770|MS840|MS870|MS910|P500|P700|P705|VM696|AS680|AS695|AX840|C729|E970|GS505|272|C395|E739BK|E960|L55C|L75C|LS696|LS860|P769BK|P350|P500|P509|P870|UN272|US730|VS840|VS950|LN272|LN510|LS670|LS855|LW690|MN270|MN510|P509|P769|P930|UN200|UN270|UN510|UN610|US670|US740|US760|UX265|UX840|VN271|VN530|VS660|VS700|VS740|VS750|VS910|VS920|VS930|VX9200|VX11000|AX840A|LW770|P506|P925|P999|E612|D955|D802|MS323|M257)|LM-G710\",\r\n        \"Sony\": \"SonyST|SonyLT|SonyEricsson|SonyEricssonLT15iv|LT18i|E10i|LT28h|LT26w|SonyEricssonMT27i|C5303|C6902|C6903|C6906|C6943|D2533\",\r\n        \"Asus\": \"Asus.*Galaxy|PadFone.*Mobile\",\r\n        \"NokiaLumia\": \"Lumia [0-9]{3,4}\",\r\n        \"Micromax\": \"Micromax.*\\\\b(A210|A92|A88|A72|A111|A110Q|A115|A116|A110|A90S|A26|A51|A35|A54|A25|A27|A89|A68|A65|A57|A90)\\\\b\",\r\n        \"Palm\": \"PalmSource|Palm\",\r\n        \"Vertu\": \"Vertu|Vertu.*Ltd|Vertu.*Ascent|Vertu.*Ayxta|Vertu.*Constellation(F|Quest)?|Vertu.*Monika|Vertu.*Signature\",\r\n        \"Pantech\": \"PANTECH|IM-A850S|IM-A840S|IM-A830L|IM-A830K|IM-A830S|IM-A820L|IM-A810K|IM-A810S|IM-A800S|IM-T100K|IM-A725L|IM-A780L|IM-A775C|IM-A770K|IM-A760S|IM-A750K|IM-A740S|IM-A730S|IM-A720L|IM-A710K|IM-A690L|IM-A690S|IM-A650S|IM-A630K|IM-A600S|VEGA PTL21|PT003|P8010|ADR910L|P6030|P6020|P9070|P4100|P9060|P5000|CDM8992|TXT8045|ADR8995|IS11PT|P2030|P6010|P8000|PT002|IS06|CDM8999|P9050|PT001|TXT8040|P2020|P9020|P2000|P7040|P7000|C790\",\r\n        \"Fly\": \"IQ230|IQ444|IQ450|IQ440|IQ442|IQ441|IQ245|IQ256|IQ236|IQ255|IQ235|IQ245|IQ275|IQ240|IQ285|IQ280|IQ270|IQ260|IQ250\",\r\n        \"Wiko\": \"KITE 4G|HIGHWAY|GETAWAY|STAIRWAY|DARKSIDE|DARKFULL|DARKNIGHT|DARKMOON|SLIDE|WAX 4G|RAINBOW|BLOOM|SUNSET|GOA(?!nna)|LENNY|BARRY|IGGY|OZZY|CINK FIVE|CINK PEAX|CINK PEAX 2|CINK SLIM|CINK SLIM 2|CINK +|CINK KING|CINK PEAX|CINK SLIM|SUBLIM\",\r\n        \"iMobile\": \"i-mobile (IQ|i-STYLE|idea|ZAA|Hitz)\",\r\n        \"SimValley\": \"\\\\b(SP-80|XT-930|SX-340|XT-930|SX-310|SP-360|SP60|SPT-800|SP-120|SPT-800|SP-140|SPX-5|SPX-8|SP-100|SPX-8|SPX-12)\\\\b\",\r\n        \"Wolfgang\": \"AT-B24D|AT-AS50HD|AT-AS40W|AT-AS55HD|AT-AS45q2|AT-B26D|AT-AS50Q\",\r\n        \"Alcatel\": \"Alcatel\",\r\n        \"Nintendo\": \"Nintendo (3DS|Switch)\",\r\n        \"Amoi\": \"Amoi\",\r\n        \"INQ\": \"INQ\",\r\n        \"OnePlus\": \"ONEPLUS\",\r\n        \"GenericPhone\": \"Tapatalk|PDA;|SAGEM|\\\\bmmp\\\\b|pocket|\\\\bpsp\\\\b|symbian|Smartphone|smartfon|treo|up.browser|up.link|vodafone|\\\\bwap\\\\b|nokia|Series40|Series60|S60|SonyEricsson|N900|MAUI.*WAP.*Browser\"\r\n    },\r\n    \"tablets\": {\r\n        \"iPad\": \"iPad|iPad.*Mobile\",\r\n        \"NexusTablet\": \"Android.*Nexus[\\\\s]+(7|9|10)\",\r\n        \"GoogleTablet\": \"Android.*Pixel C\",\r\n        \"SamsungTablet\": \"SAMSUNG.*Tablet|Galaxy.*Tab|SC-01C|GT-P1000|GT-P1003|GT-P1010|GT-P3105|GT-P6210|GT-P6800|GT-P6810|GT-P7100|GT-P7300|GT-P7310|GT-P7500|GT-P7510|SCH-I800|SCH-I815|SCH-I905|SGH-I957|SGH-I987|SGH-T849|SGH-T859|SGH-T869|SPH-P100|GT-P3100|GT-P3108|GT-P3110|GT-P5100|GT-P5110|GT-P6200|GT-P7320|GT-P7511|GT-N8000|GT-P8510|SGH-I497|SPH-P500|SGH-T779|SCH-I705|SCH-I915|GT-N8013|GT-P3113|GT-P5113|GT-P8110|GT-N8010|GT-N8005|GT-N8020|GT-P1013|GT-P6201|GT-P7501|GT-N5100|GT-N5105|GT-N5110|SHV-E140K|SHV-E140L|SHV-E140S|SHV-E150S|SHV-E230K|SHV-E230L|SHV-E230S|SHW-M180K|SHW-M180L|SHW-M180S|SHW-M180W|SHW-M300W|SHW-M305W|SHW-M380K|SHW-M380S|SHW-M380W|SHW-M430W|SHW-M480K|SHW-M480S|SHW-M480W|SHW-M485W|SHW-M486W|SHW-M500W|GT-I9228|SCH-P739|SCH-I925|GT-I9200|GT-P5200|GT-P5210|GT-P5210X|SM-T311|SM-T310|SM-T310X|SM-T210|SM-T210R|SM-T211|SM-P600|SM-P601|SM-P605|SM-P900|SM-P901|SM-T217|SM-T217A|SM-T217S|SM-P6000|SM-T3100|SGH-I467|XE500|SM-T110|GT-P5220|GT-I9200X|GT-N5110X|GT-N5120|SM-P905|SM-T111|SM-T2105|SM-T315|SM-T320|SM-T320X|SM-T321|SM-T520|SM-T525|SM-T530NU|SM-T230NU|SM-T330NU|SM-T900|XE500T1C|SM-P605V|SM-P905V|SM-T337V|SM-T537V|SM-T707V|SM-T807V|SM-P600X|SM-P900X|SM-T210X|SM-T230|SM-T230X|SM-T325|GT-P7503|SM-T531|SM-T330|SM-T530|SM-T705|SM-T705C|SM-T535|SM-T331|SM-T800|SM-T700|SM-T537|SM-T807|SM-P907A|SM-T337A|SM-T537A|SM-T707A|SM-T807A|SM-T237|SM-T807P|SM-P607T|SM-T217T|SM-T337T|SM-T807T|SM-T116NQ|SM-T116BU|SM-P550|SM-T350|SM-T550|SM-T9000|SM-P9000|SM-T705Y|SM-T805|GT-P3113|SM-T710|SM-T810|SM-T815|SM-T360|SM-T533|SM-T113|SM-T335|SM-T715|SM-T560|SM-T670|SM-T677|SM-T377|SM-T567|SM-T357T|SM-T555|SM-T561|SM-T713|SM-T719|SM-T813|SM-T819|SM-T580|SM-T355Y?|SM-T280|SM-T817A|SM-T820|SM-W700|SM-P580|SM-T587|SM-P350|SM-P555M|SM-P355M|SM-T113NU|SM-T815Y|SM-T585|SM-T285|SM-T825|SM-W708|SM-T835|SM-T830|SM-T837V|SM-T720|SM-T510|SM-T387V\",\r\n        \"Kindle\": \"Kindle|Silk.*Accelerated|Android.*\\\\b(KFOT|KFTT|KFJWI|KFJWA|KFOTE|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|WFJWAE|KFSAWA|KFSAWI|KFASWI|KFARWI|KFFOWI|KFGIWI|KFMEWI)\\\\b|Android.*Silk\\/[0-9.]+ like Chrome\\/[0-9.]+ (?!Mobile)\",\r\n        \"SurfaceTablet\": \"Windows NT [0-9.]+; ARM;.*(Tablet|ARMBJS)\",\r\n        \"HPTablet\": \"HP Slate (7|8|10)|HP ElitePad 900|hp-tablet|EliteBook.*Touch|HP 8|Slate 21|HP SlateBook 10\",\r\n        \"AsusTablet\": \"^.*PadFone((?!Mobile).)*$|Transformer|TF101|TF101G|TF300T|TF300TG|TF300TL|TF700T|TF700KL|TF701T|TF810C|ME171|ME301T|ME302C|ME371MG|ME370T|ME372MG|ME172V|ME173X|ME400C|Slider SL101|\\\\bK00F\\\\b|\\\\bK00C\\\\b|\\\\bK00E\\\\b|\\\\bK00L\\\\b|TX201LA|ME176C|ME102A|\\\\bM80TA\\\\b|ME372CL|ME560CG|ME372CG|ME302KL| K010 | K011 | K017 | K01E |ME572C|ME103K|ME170C|ME171C|\\\\bME70C\\\\b|ME581C|ME581CL|ME8510C|ME181C|P01Y|PO1MA|P01Z|\\\\bP027\\\\b|\\\\bP024\\\\b|\\\\bP00C\\\\b\",\r\n        \"BlackBerryTablet\": \"PlayBook|RIM Tablet\",\r\n        \"HTCtablet\": \"HTC_Flyer_P512|HTC Flyer|HTC Jetstream|HTC-P715a|HTC EVO View 4G|PG41200|PG09410\",\r\n        \"MotorolaTablet\": \"xoom|sholest|MZ615|MZ605|MZ505|MZ601|MZ602|MZ603|MZ604|MZ606|MZ607|MZ608|MZ609|MZ615|MZ616|MZ617\",\r\n        \"NookTablet\": \"Android.*Nook|NookColor|nook browser|BNRV200|BNRV200A|BNTV250|BNTV250A|BNTV400|BNTV600|LogicPD Zoom2\",\r\n        \"AcerTablet\": \"Android.*; \\\\b(A100|A101|A110|A200|A210|A211|A500|A501|A510|A511|A700|A701|W500|W500P|W501|W501P|W510|W511|W700|G100|G100W|B1-A71|B1-710|B1-711|A1-810|A1-811|A1-830)\\\\b|W3-810|\\\\bA3-A10\\\\b|\\\\bA3-A11\\\\b|\\\\bA3-A20\\\\b|\\\\bA3-A30\",\r\n        \"ToshibaTablet\": \"Android.*(AT100|AT105|AT200|AT205|AT270|AT275|AT300|AT305|AT1S5|AT500|AT570|AT700|AT830)|TOSHIBA.*FOLIO\",\r\n        \"LGTablet\": \"\\\\bL-06C|LG-V909|LG-V900|LG-V700|LG-V510|LG-V500|LG-V410|LG-V400|LG-VK810\\\\b\",\r\n        \"FujitsuTablet\": \"Android.*\\\\b(F-01D|F-02F|F-05E|F-10D|M532|Q572)\\\\b\",\r\n        \"PrestigioTablet\": \"PMP3170B|PMP3270B|PMP3470B|PMP7170B|PMP3370B|PMP3570C|PMP5870C|PMP3670B|PMP5570C|PMP5770D|PMP3970B|PMP3870C|PMP5580C|PMP5880D|PMP5780D|PMP5588C|PMP7280C|PMP7280C3G|PMP7280|PMP7880D|PMP5597D|PMP5597|PMP7100D|PER3464|PER3274|PER3574|PER3884|PER5274|PER5474|PMP5097CPRO|PMP5097|PMP7380D|PMP5297C|PMP5297C_QUAD|PMP812E|PMP812E3G|PMP812F|PMP810E|PMP880TD|PMT3017|PMT3037|PMT3047|PMT3057|PMT7008|PMT5887|PMT5001|PMT5002\",\r\n        \"LenovoTablet\": \"Lenovo TAB|Idea(Tab|Pad)( A1|A10| K1|)|ThinkPad([ ]+)?Tablet|YT3-850M|YT3-X90L|YT3-X90F|YT3-X90X|Lenovo.*(S2109|S2110|S5000|S6000|K3011|A3000|A3500|A1000|A2107|A2109|A1107|A5500|A7600|B6000|B8000|B8080)(-|)(FL|F|HV|H|)|TB-X103F|TB-X304X|TB-X304F|TB-X304L|TB-X505F|TB-X505L|TB-X505X|TB-X605F|TB-X605L|TB-8703F|TB-8703X|TB-8703N|TB-8704N|TB-8704F|TB-8704X|TB-8704V|TB-7304F|TB-7304I|TB-7304X|Tab2A7-10F|Tab2A7-20F|TB2-X30L|YT3-X50L|YT3-X50F|YT3-X50M|YT-X705F|YT-X703F|YT-X703L|YT-X705L|YT-X705X|TB2-X30F|TB2-X30L|TB2-X30M|A2107A-F|A2107A-H|TB3-730F|TB3-730M|TB3-730X|TB-7504F|TB-7504X\",\r\n        \"DellTablet\": \"Venue 11|Venue 8|Venue 7|Dell Streak 10|Dell Streak 7\",\r\n        \"YarvikTablet\": \"Android.*\\\\b(TAB210|TAB211|TAB224|TAB250|TAB260|TAB264|TAB310|TAB360|TAB364|TAB410|TAB411|TAB420|TAB424|TAB450|TAB460|TAB461|TAB464|TAB465|TAB467|TAB468|TAB07-100|TAB07-101|TAB07-150|TAB07-151|TAB07-152|TAB07-200|TAB07-201-3G|TAB07-210|TAB07-211|TAB07-212|TAB07-214|TAB07-220|TAB07-400|TAB07-485|TAB08-150|TAB08-200|TAB08-201-3G|TAB08-201-30|TAB09-100|TAB09-211|TAB09-410|TAB10-150|TAB10-201|TAB10-211|TAB10-400|TAB10-410|TAB13-201|TAB274EUK|TAB275EUK|TAB374EUK|TAB462EUK|TAB474EUK|TAB9-200)\\\\b\",\r\n        \"MedionTablet\": \"Android.*\\\\bOYO\\\\b|LIFE.*(P9212|P9514|P9516|S9512)|LIFETAB\",\r\n        \"ArnovaTablet\": \"97G4|AN10G2|AN7bG3|AN7fG3|AN8G3|AN8cG3|AN7G3|AN9G3|AN7dG3|AN7dG3ST|AN7dG3ChildPad|AN10bG3|AN10bG3DT|AN9G2\",\r\n        \"IntensoTablet\": \"INM8002KP|INM1010FP|INM805ND|Intenso Tab|TAB1004\",\r\n        \"IRUTablet\": \"M702pro\",\r\n        \"MegafonTablet\": \"MegaFon V9|\\\\bZTE V9\\\\b|Android.*\\\\bMT7A\\\\b\",\r\n        \"EbodaTablet\": \"E-Boda (Supreme|Impresspeed|Izzycomm|Essential)\",\r\n        \"AllViewTablet\": \"Allview.*(Viva|Alldro|City|Speed|All TV|Frenzy|Quasar|Shine|TX1|AX1|AX2)\",\r\n        \"ArchosTablet\": \"\\\\b(101G9|80G9|A101IT)\\\\b|Qilive 97R|Archos5|\\\\bARCHOS (70|79|80|90|97|101|FAMILYPAD|)(b|c|)(G10| Cobalt| TITANIUM(HD|)| Xenon| Neon|XSK| 2| XS 2| PLATINUM| CARBON|GAMEPAD)\\\\b\",\r\n        \"AinolTablet\": \"NOVO7|NOVO8|NOVO10|Novo7Aurora|Novo7Basic|NOVO7PALADIN|novo9-Spark\",\r\n        \"NokiaLumiaTablet\": \"Lumia 2520\",\r\n        \"SonyTablet\": \"Sony.*Tablet|Xperia Tablet|Sony Tablet S|SO-03E|SGPT12|SGPT13|SGPT114|SGPT121|SGPT122|SGPT123|SGPT111|SGPT112|SGPT113|SGPT131|SGPT132|SGPT133|SGPT211|SGPT212|SGPT213|SGP311|SGP312|SGP321|EBRD1101|EBRD1102|EBRD1201|SGP351|SGP341|SGP511|SGP512|SGP521|SGP541|SGP551|SGP621|SGP641|SGP612|SOT31|SGP771|SGP611|SGP612|SGP712\",\r\n        \"PhilipsTablet\": \"\\\\b(PI2010|PI3000|PI3100|PI3105|PI3110|PI3205|PI3210|PI3900|PI4010|PI7000|PI7100)\\\\b\",\r\n        \"CubeTablet\": \"Android.*(K8GT|U9GT|U10GT|U16GT|U17GT|U18GT|U19GT|U20GT|U23GT|U30GT)|CUBE U8GT\",\r\n        \"CobyTablet\": \"MID1042|MID1045|MID1125|MID1126|MID7012|MID7014|MID7015|MID7034|MID7035|MID7036|MID7042|MID7048|MID7127|MID8042|MID8048|MID8127|MID9042|MID9740|MID9742|MID7022|MID7010\",\r\n        \"MIDTablet\": \"M9701|M9000|M9100|M806|M1052|M806|T703|MID701|MID713|MID710|MID727|MID760|MID830|MID728|MID933|MID125|MID810|MID732|MID120|MID930|MID800|MID731|MID900|MID100|MID820|MID735|MID980|MID130|MID833|MID737|MID960|MID135|MID860|MID736|MID140|MID930|MID835|MID733|MID4X10\",\r\n        \"MSITablet\": \"MSI \\\\b(Primo 73K|Primo 73L|Primo 81L|Primo 77|Primo 93|Primo 75|Primo 76|Primo 73|Primo 81|Primo 91|Primo 90|Enjoy 71|Enjoy 7|Enjoy 10)\\\\b\",\r\n        \"SMiTTablet\": \"Android.*(\\\\bMID\\\\b|MID-560|MTV-T1200|MTV-PND531|MTV-P1101|MTV-PND530)\",\r\n        \"RockChipTablet\": \"Android.*(RK2818|RK2808A|RK2918|RK3066)|RK2738|RK2808A\",\r\n        \"FlyTablet\": \"IQ310|Fly Vision\",\r\n        \"bqTablet\": \"Android.*(bq)?.*\\\\b(Elcano|Curie|Edison|Maxwell|Kepler|Pascal|Tesla|Hypatia|Platon|Newton|Livingstone|Cervantes|Avant|Aquaris ([E|M]10|M8))\\\\b|Maxwell.*Lite|Maxwell.*Plus\",\r\n        \"HuaweiTablet\": \"MediaPad|MediaPad 7 Youth|IDEOS S7|S7-201c|S7-202u|S7-101|S7-103|S7-104|S7-105|S7-106|S7-201|S7-Slim|M2-A01L|BAH-L09|BAH-W09|AGS-L09|CMR-AL19\",\r\n        \"NecTablet\": \"\\\\bN-06D|\\\\bN-08D\",\r\n        \"PantechTablet\": \"Pantech.*P4100\",\r\n        \"BronchoTablet\": \"Broncho.*(N701|N708|N802|a710)\",\r\n        \"VersusTablet\": \"TOUCHPAD.*[78910]|\\\\bTOUCHTAB\\\\b\",\r\n        \"ZyncTablet\": \"z1000|Z99 2G|z930|z990|z909|Z919|z900\",\r\n        \"PositivoTablet\": \"TB07STA|TB10STA|TB07FTA|TB10FTA\",\r\n        \"NabiTablet\": \"Android.*\\\\bNabi\",\r\n        \"KoboTablet\": \"Kobo Touch|\\\\bK080\\\\b|\\\\bVox\\\\b Build|\\\\bArc\\\\b Build\",\r\n        \"DanewTablet\": \"DSlide.*\\\\b(700|701R|702|703R|704|802|970|971|972|973|974|1010|1012)\\\\b\",\r\n        \"TexetTablet\": \"NaviPad|TB-772A|TM-7045|TM-7055|TM-9750|TM-7016|TM-7024|TM-7026|TM-7041|TM-7043|TM-7047|TM-8041|TM-9741|TM-9747|TM-9748|TM-9751|TM-7022|TM-7021|TM-7020|TM-7011|TM-7010|TM-7023|TM-7025|TM-7037W|TM-7038W|TM-7027W|TM-9720|TM-9725|TM-9737W|TM-1020|TM-9738W|TM-9740|TM-9743W|TB-807A|TB-771A|TB-727A|TB-725A|TB-719A|TB-823A|TB-805A|TB-723A|TB-715A|TB-707A|TB-705A|TB-709A|TB-711A|TB-890HD|TB-880HD|TB-790HD|TB-780HD|TB-770HD|TB-721HD|TB-710HD|TB-434HD|TB-860HD|TB-840HD|TB-760HD|TB-750HD|TB-740HD|TB-730HD|TB-722HD|TB-720HD|TB-700HD|TB-500HD|TB-470HD|TB-431HD|TB-430HD|TB-506|TB-504|TB-446|TB-436|TB-416|TB-146SE|TB-126SE\",\r\n        \"PlaystationTablet\": \"Playstation.*(Portable|Vita)\",\r\n        \"TrekstorTablet\": \"ST10416-1|VT10416-1|ST70408-1|ST702xx-1|ST702xx-2|ST80208|ST97216|ST70104-2|VT10416-2|ST10216-2A|SurfTab\",\r\n        \"PyleAudioTablet\": \"\\\\b(PTBL10CEU|PTBL10C|PTBL72BC|PTBL72BCEU|PTBL7CEU|PTBL7C|PTBL92BC|PTBL92BCEU|PTBL9CEU|PTBL9CUK|PTBL9C)\\\\b\",\r\n        \"AdvanTablet\": \"Android.* \\\\b(E3A|T3X|T5C|T5B|T3E|T3C|T3B|T1J|T1F|T2A|T1H|T1i|E1C|T1-E|T5-A|T4|E1-B|T2Ci|T1-B|T1-D|O1-A|E1-A|T1-A|T3A|T4i)\\\\b \",\r\n        \"DanyTechTablet\": \"Genius Tab G3|Genius Tab S2|Genius Tab Q3|Genius Tab G4|Genius Tab Q4|Genius Tab G-II|Genius TAB GII|Genius TAB GIII|Genius Tab S1\",\r\n        \"GalapadTablet\": \"Android.*\\\\bG1\\\\b(?!\\\\))\",\r\n        \"MicromaxTablet\": \"Funbook|Micromax.*\\\\b(P250|P560|P360|P362|P600|P300|P350|P500|P275)\\\\b\",\r\n        \"KarbonnTablet\": \"Android.*\\\\b(A39|A37|A34|ST8|ST10|ST7|Smart Tab3|Smart Tab2)\\\\b\",\r\n        \"AllFineTablet\": \"Fine7 Genius|Fine7 Shine|Fine7 Air|Fine8 Style|Fine9 More|Fine10 Joy|Fine11 Wide\",\r\n        \"PROSCANTablet\": \"\\\\b(PEM63|PLT1023G|PLT1041|PLT1044|PLT1044G|PLT1091|PLT4311|PLT4311PL|PLT4315|PLT7030|PLT7033|PLT7033D|PLT7035|PLT7035D|PLT7044K|PLT7045K|PLT7045KB|PLT7071KG|PLT7072|PLT7223G|PLT7225G|PLT7777G|PLT7810K|PLT7849G|PLT7851G|PLT7852G|PLT8015|PLT8031|PLT8034|PLT8036|PLT8080K|PLT8082|PLT8088|PLT8223G|PLT8234G|PLT8235G|PLT8816K|PLT9011|PLT9045K|PLT9233G|PLT9735|PLT9760G|PLT9770G)\\\\b\",\r\n        \"YONESTablet\": \"BQ1078|BC1003|BC1077|RK9702|BC9730|BC9001|IT9001|BC7008|BC7010|BC708|BC728|BC7012|BC7030|BC7027|BC7026\",\r\n        \"ChangJiaTablet\": \"TPC7102|TPC7103|TPC7105|TPC7106|TPC7107|TPC7201|TPC7203|TPC7205|TPC7210|TPC7708|TPC7709|TPC7712|TPC7110|TPC8101|TPC8103|TPC8105|TPC8106|TPC8203|TPC8205|TPC8503|TPC9106|TPC9701|TPC97101|TPC97103|TPC97105|TPC97106|TPC97111|TPC97113|TPC97203|TPC97603|TPC97809|TPC97205|TPC10101|TPC10103|TPC10106|TPC10111|TPC10203|TPC10205|TPC10503\",\r\n        \"GUTablet\": \"TX-A1301|TX-M9002|Q702|kf026\",\r\n        \"PointOfViewTablet\": \"TAB-P506|TAB-navi-7-3G-M|TAB-P517|TAB-P-527|TAB-P701|TAB-P703|TAB-P721|TAB-P731N|TAB-P741|TAB-P825|TAB-P905|TAB-P925|TAB-PR945|TAB-PL1015|TAB-P1025|TAB-PI1045|TAB-P1325|TAB-PROTAB[0-9]+|TAB-PROTAB25|TAB-PROTAB26|TAB-PROTAB27|TAB-PROTAB26XL|TAB-PROTAB2-IPS9|TAB-PROTAB30-IPS9|TAB-PROTAB25XXL|TAB-PROTAB26-IPS10|TAB-PROTAB30-IPS10\",\r\n        \"OvermaxTablet\": \"OV-(SteelCore|NewBase|Basecore|Baseone|Exellen|Quattor|EduTab|Solution|ACTION|BasicTab|TeddyTab|MagicTab|Stream|TB-08|TB-09)|Qualcore 1027\",\r\n        \"HCLTablet\": \"HCL.*Tablet|Connect-3G-2.0|Connect-2G-2.0|ME Tablet U1|ME Tablet U2|ME Tablet G1|ME Tablet X1|ME Tablet Y2|ME Tablet Sync\",\r\n        \"DPSTablet\": \"DPS Dream 9|DPS Dual 7\",\r\n        \"VistureTablet\": \"V97 HD|i75 3G|Visture V4( HD)?|Visture V5( HD)?|Visture V10\",\r\n        \"CrestaTablet\": \"CTP(-)?810|CTP(-)?818|CTP(-)?828|CTP(-)?838|CTP(-)?888|CTP(-)?978|CTP(-)?980|CTP(-)?987|CTP(-)?988|CTP(-)?989\",\r\n        \"MediatekTablet\": \"\\\\bMT8125|MT8389|MT8135|MT8377\\\\b\",\r\n        \"ConcordeTablet\": \"Concorde([ ]+)?Tab|ConCorde ReadMan\",\r\n        \"GoCleverTablet\": \"GOCLEVER TAB|A7GOCLEVER|M1042|M7841|M742|R1042BK|R1041|TAB A975|TAB A7842|TAB A741|TAB A741L|TAB M723G|TAB M721|TAB A1021|TAB I921|TAB R721|TAB I720|TAB T76|TAB R70|TAB R76.2|TAB R106|TAB R83.2|TAB M813G|TAB I721|GCTA722|TAB I70|TAB I71|TAB S73|TAB R73|TAB R74|TAB R93|TAB R75|TAB R76.1|TAB A73|TAB A93|TAB A93.2|TAB T72|TAB R83|TAB R974|TAB R973|TAB A101|TAB A103|TAB A104|TAB A104.2|R105BK|M713G|A972BK|TAB A971|TAB R974.2|TAB R104|TAB R83.3|TAB A1042\",\r\n        \"ModecomTablet\": \"FreeTAB 9000|FreeTAB 7.4|FreeTAB 7004|FreeTAB 7800|FreeTAB 2096|FreeTAB 7.5|FreeTAB 1014|FreeTAB 1001 |FreeTAB 8001|FreeTAB 9706|FreeTAB 9702|FreeTAB 7003|FreeTAB 7002|FreeTAB 1002|FreeTAB 7801|FreeTAB 1331|FreeTAB 1004|FreeTAB 8002|FreeTAB 8014|FreeTAB 9704|FreeTAB 1003\",\r\n        \"VoninoTablet\": \"\\\\b(Argus[ _]?S|Diamond[ _]?79HD|Emerald[ _]?78E|Luna[ _]?70C|Onyx[ _]?S|Onyx[ _]?Z|Orin[ _]?HD|Orin[ _]?S|Otis[ _]?S|SpeedStar[ _]?S|Magnet[ _]?M9|Primus[ _]?94[ _]?3G|Primus[ _]?94HD|Primus[ _]?QS|Android.*\\\\bQ8\\\\b|Sirius[ _]?EVO[ _]?QS|Sirius[ _]?QS|Spirit[ _]?S)\\\\b\",\r\n        \"ECSTablet\": \"V07OT2|TM105A|S10OT1|TR10CS1\",\r\n        \"StorexTablet\": \"eZee[_']?(Tab|Go)[0-9]+|TabLC7|Looney Tunes Tab\",\r\n        \"VodafoneTablet\": \"SmartTab([ ]+)?[0-9]+|SmartTabII10|SmartTabII7|VF-1497|VFD 1400\",\r\n        \"EssentielBTablet\": \"Smart[ ']?TAB[ ]+?[0-9]+|Family[ ']?TAB2\",\r\n        \"RossMoorTablet\": \"RM-790|RM-997|RMD-878G|RMD-974R|RMT-705A|RMT-701|RME-601|RMT-501|RMT-711\",\r\n        \"iMobileTablet\": \"i-mobile i-note\",\r\n        \"TolinoTablet\": \"tolino tab [0-9.]+|tolino shine\",\r\n        \"AudioSonicTablet\": \"\\\\bC-22Q|T7-QC|T-17B|T-17P\\\\b\",\r\n        \"AMPETablet\": \"Android.* A78 \",\r\n        \"SkkTablet\": \"Android.* (SKYPAD|PHOENIX|CYCLOPS)\",\r\n        \"TecnoTablet\": \"TECNO P9|TECNO DP8D\",\r\n        \"JXDTablet\": \"Android.* \\\\b(F3000|A3300|JXD5000|JXD3000|JXD2000|JXD300B|JXD300|S5800|S7800|S602b|S5110b|S7300|S5300|S602|S603|S5100|S5110|S601|S7100a|P3000F|P3000s|P101|P200s|P1000m|P200m|P9100|P1000s|S6600b|S908|P1000|P300|S18|S6600|S9100)\\\\b\",\r\n        \"iJoyTablet\": \"Tablet (Spirit 7|Essentia|Galatea|Fusion|Onix 7|Landa|Titan|Scooby|Deox|Stella|Themis|Argon|Unique 7|Sygnus|Hexen|Finity 7|Cream|Cream X2|Jade|Neon 7|Neron 7|Kandy|Scape|Saphyr 7|Rebel|Biox|Rebel|Rebel 8GB|Myst|Draco 7|Myst|Tab7-004|Myst|Tadeo Jones|Tablet Boing|Arrow|Draco Dual Cam|Aurix|Mint|Amity|Revolution|Finity 9|Neon 9|T9w|Amity 4GB Dual Cam|Stone 4GB|Stone 8GB|Andromeda|Silken|X2|Andromeda II|Halley|Flame|Saphyr 9,7|Touch 8|Planet|Triton|Unique 10|Hexen 10|Memphis 4GB|Memphis 8GB|Onix 10)\",\r\n        \"FX2Tablet\": \"FX2 PAD7|FX2 PAD10\",\r\n        \"XoroTablet\": \"KidsPAD 701|PAD[ ]?712|PAD[ ]?714|PAD[ ]?716|PAD[ ]?717|PAD[ ]?718|PAD[ ]?720|PAD[ ]?721|PAD[ ]?722|PAD[ ]?790|PAD[ ]?792|PAD[ ]?900|PAD[ ]?9715D|PAD[ ]?9716DR|PAD[ ]?9718DR|PAD[ ]?9719QR|PAD[ ]?9720QR|TelePAD1030|Telepad1032|TelePAD730|TelePAD731|TelePAD732|TelePAD735Q|TelePAD830|TelePAD9730|TelePAD795|MegaPAD 1331|MegaPAD 1851|MegaPAD 2151\",\r\n        \"ViewsonicTablet\": \"ViewPad 10pi|ViewPad 10e|ViewPad 10s|ViewPad E72|ViewPad7|ViewPad E100|ViewPad 7e|ViewSonic VB733|VB100a\",\r\n        \"VerizonTablet\": \"QTAQZ3|QTAIR7|QTAQTZ3|QTASUN1|QTASUN2|QTAXIA1\",\r\n        \"OdysTablet\": \"LOOX|XENO10|ODYS[ -](Space|EVO|Xpress|NOON)|\\\\bXELIO\\\\b|Xelio10Pro|XELIO7PHONETAB|XELIO10EXTREME|XELIOPT2|NEO_QUAD10\",\r\n        \"CaptivaTablet\": \"CAPTIVA PAD\",\r\n        \"IconbitTablet\": \"NetTAB|NT-3702|NT-3702S|NT-3702S|NT-3603P|NT-3603P|NT-0704S|NT-0704S|NT-3805C|NT-3805C|NT-0806C|NT-0806C|NT-0909T|NT-0909T|NT-0907S|NT-0907S|NT-0902S|NT-0902S\",\r\n        \"TeclastTablet\": \"T98 4G|\\\\bP80\\\\b|\\\\bX90HD\\\\b|X98 Air|X98 Air 3G|\\\\bX89\\\\b|P80 3G|\\\\bX80h\\\\b|P98 Air|\\\\bX89HD\\\\b|P98 3G|\\\\bP90HD\\\\b|P89 3G|X98 3G|\\\\bP70h\\\\b|P79HD 3G|G18d 3G|\\\\bP79HD\\\\b|\\\\bP89s\\\\b|\\\\bA88\\\\b|\\\\bP10HD\\\\b|\\\\bP19HD\\\\b|G18 3G|\\\\bP78HD\\\\b|\\\\bA78\\\\b|\\\\bP75\\\\b|G17s 3G|G17h 3G|\\\\bP85t\\\\b|\\\\bP90\\\\b|\\\\bP11\\\\b|\\\\bP98t\\\\b|\\\\bP98HD\\\\b|\\\\bG18d\\\\b|\\\\bP85s\\\\b|\\\\bP11HD\\\\b|\\\\bP88s\\\\b|\\\\bA80HD\\\\b|\\\\bA80se\\\\b|\\\\bA10h\\\\b|\\\\bP89\\\\b|\\\\bP78s\\\\b|\\\\bG18\\\\b|\\\\bP85\\\\b|\\\\bA70h\\\\b|\\\\bA70\\\\b|\\\\bG17\\\\b|\\\\bP18\\\\b|\\\\bA80s\\\\b|\\\\bA11s\\\\b|\\\\bP88HD\\\\b|\\\\bA80h\\\\b|\\\\bP76s\\\\b|\\\\bP76h\\\\b|\\\\bP98\\\\b|\\\\bA10HD\\\\b|\\\\bP78\\\\b|\\\\bP88\\\\b|\\\\bA11\\\\b|\\\\bA10t\\\\b|\\\\bP76a\\\\b|\\\\bP76t\\\\b|\\\\bP76e\\\\b|\\\\bP85HD\\\\b|\\\\bP85a\\\\b|\\\\bP86\\\\b|\\\\bP75HD\\\\b|\\\\bP76v\\\\b|\\\\bA12\\\\b|\\\\bP75a\\\\b|\\\\bA15\\\\b|\\\\bP76Ti\\\\b|\\\\bP81HD\\\\b|\\\\bA10\\\\b|\\\\bT760VE\\\\b|\\\\bT720HD\\\\b|\\\\bP76\\\\b|\\\\bP73\\\\b|\\\\bP71\\\\b|\\\\bP72\\\\b|\\\\bT720SE\\\\b|\\\\bC520Ti\\\\b|\\\\bT760\\\\b|\\\\bT720VE\\\\b|T720-3GE|T720-WiFi\",\r\n        \"OndaTablet\": \"\\\\b(V975i|Vi30|VX530|V701|Vi60|V701s|Vi50|V801s|V719|Vx610w|VX610W|V819i|Vi10|VX580W|Vi10|V711s|V813|V811|V820w|V820|Vi20|V711|VI30W|V712|V891w|V972|V819w|V820w|Vi60|V820w|V711|V813s|V801|V819|V975s|V801|V819|V819|V818|V811|V712|V975m|V101w|V961w|V812|V818|V971|V971s|V919|V989|V116w|V102w|V973|Vi40)\\\\b[\\\\s]+|V10 \\\\b4G\\\\b\",\r\n        \"JaytechTablet\": \"TPC-PA762\",\r\n        \"BlaupunktTablet\": \"Endeavour 800NG|Endeavour 1010\",\r\n        \"DigmaTablet\": \"\\\\b(iDx10|iDx9|iDx8|iDx7|iDxD7|iDxD8|iDsQ8|iDsQ7|iDsQ8|iDsD10|iDnD7|3TS804H|iDsQ11|iDj7|iDs10)\\\\b\",\r\n        \"EvolioTablet\": \"ARIA_Mini_wifi|Aria[ _]Mini|Evolio X10|Evolio X7|Evolio X8|\\\\bEvotab\\\\b|\\\\bNeura\\\\b\",\r\n        \"LavaTablet\": \"QPAD E704|\\\\bIvoryS\\\\b|E-TAB IVORY|\\\\bE-TAB\\\\b\",\r\n        \"AocTablet\": \"MW0811|MW0812|MW0922|MTK8382|MW1031|MW0831|MW0821|MW0931|MW0712\",\r\n        \"MpmanTablet\": \"MP11 OCTA|MP10 OCTA|MPQC1114|MPQC1004|MPQC994|MPQC974|MPQC973|MPQC804|MPQC784|MPQC780|\\\\bMPG7\\\\b|MPDCG75|MPDCG71|MPDC1006|MP101DC|MPDC9000|MPDC905|MPDC706HD|MPDC706|MPDC705|MPDC110|MPDC100|MPDC99|MPDC97|MPDC88|MPDC8|MPDC77|MP709|MID701|MID711|MID170|MPDC703|MPQC1010\",\r\n        \"CelkonTablet\": \"CT695|CT888|CT[\\\\s]?910|CT7 Tab|CT9 Tab|CT3 Tab|CT2 Tab|CT1 Tab|C820|C720|\\\\bCT-1\\\\b\",\r\n        \"WolderTablet\": \"miTab \\\\b(DIAMOND|SPACE|BROOKLYN|NEO|FLY|MANHATTAN|FUNK|EVOLUTION|SKY|GOCAR|IRON|GENIUS|POP|MINT|EPSILON|BROADWAY|JUMP|HOP|LEGEND|NEW AGE|LINE|ADVANCE|FEEL|FOLLOW|LIKE|LINK|LIVE|THINK|FREEDOM|CHICAGO|CLEVELAND|BALTIMORE-GH|IOWA|BOSTON|SEATTLE|PHOENIX|DALLAS|IN 101|MasterChef)\\\\b\",\r\n        \"MediacomTablet\": \"M-MPI10C3G|M-SP10EG|M-SP10EGP|M-SP10HXAH|M-SP7HXAH|M-SP10HXBH|M-SP8HXAH|M-SP8MXA\",\r\n        \"MiTablet\": \"\\\\bMI PAD\\\\b|\\\\bHM NOTE 1W\\\\b\",\r\n        \"NibiruTablet\": \"Nibiru M1|Nibiru Jupiter One\",\r\n        \"NexoTablet\": \"NEXO NOVA|NEXO 10|NEXO AVIO|NEXO FREE|NEXO GO|NEXO EVO|NEXO 3G|NEXO SMART|NEXO KIDDO|NEXO MOBI\",\r\n        \"LeaderTablet\": \"TBLT10Q|TBLT10I|TBL-10WDKB|TBL-10WDKBO2013|TBL-W230V2|TBL-W450|TBL-W500|SV572|TBLT7I|TBA-AC7-8G|TBLT79|TBL-8W16|TBL-10W32|TBL-10WKB|TBL-W100\",\r\n        \"UbislateTablet\": \"UbiSlate[\\\\s]?7C\",\r\n        \"PocketBookTablet\": \"Pocketbook\",\r\n        \"KocasoTablet\": \"\\\\b(TB-1207)\\\\b\",\r\n        \"HisenseTablet\": \"\\\\b(F5281|E2371)\\\\b\",\r\n        \"Hudl\": \"Hudl HT7S3|Hudl 2\",\r\n        \"TelstraTablet\": \"T-Hub2\",\r\n        \"GenericTablet\": \"Android.*\\\\b97D\\\\b|Tablet(?!.*PC)|BNTV250A|MID-WCDMA|LogicPD Zoom2|\\\\bA7EB\\\\b|CatNova8|A1_07|CT704|CT1002|\\\\bM721\\\\b|rk30sdk|\\\\bEVOTAB\\\\b|M758A|ET904|ALUMIUM10|Smartfren Tab|Endeavour 1010|Tablet-PC-4|Tagi Tab|\\\\bM6pro\\\\b|CT1020W|arc 10HD|\\\\bTP750\\\\b|\\\\bQTAQZ3\\\\b|WVT101|TM1088|KT107\"\r\n    },\r\n    \"oss\": {\r\n        \"AndroidOS\": \"Android\",\r\n        \"BlackBerryOS\": \"blackberry|\\\\bBB10\\\\b|rim tablet os\",\r\n        \"PalmOS\": \"PalmOS|avantgo|blazer|elaine|hiptop|palm|plucker|xiino\",\r\n        \"SymbianOS\": \"Symbian|SymbOS|Series60|Series40|SYB-[0-9]+|\\\\bS60\\\\b\",\r\n        \"WindowsMobileOS\": \"Windows CE.*(PPC|Smartphone|Mobile|[0-9]{3}x[0-9]{3})|Windows Mobile|Windows Phone [0-9.]+|WCE;\",\r\n        \"WindowsPhoneOS\": \"Windows Phone 10.0|Windows Phone 8.1|Windows Phone 8.0|Windows Phone OS|XBLWP7|ZuneWP7|Windows NT 6.[23]; ARM;\",\r\n        \"iOS\": \"\\\\biPhone.*Mobile|\\\\biPod|\\\\biPad|AppleCoreMedia\",\r\n        \"iPadOS\": \"CPU OS 13\",\r\n        \"MeeGoOS\": \"MeeGo\",\r\n        \"MaemoOS\": \"Maemo\",\r\n        \"JavaOS\": \"J2ME\\/|\\\\bMIDP\\\\b|\\\\bCLDC\\\\b\",\r\n        \"webOS\": \"webOS|hpwOS\",\r\n        \"badaOS\": \"\\\\bBada\\\\b\",\r\n        \"BREWOS\": \"BREW\"\r\n    },\r\n    \"uas\": {\r\n        \"Chrome\": \"\\\\bCrMo\\\\b|CriOS|Android.*Chrome\\/[.0-9]* (Mobile)?\",\r\n        \"Dolfin\": \"\\\\bDolfin\\\\b\",\r\n        \"Opera\": \"Opera.*Mini|Opera.*Mobi|Android.*Opera|Mobile.*OPR\\/[0-9.]+$|Coast\\/[0-9.]+\",\r\n        \"Skyfire\": \"Skyfire\",\r\n        \"Edge\": \"Mobile Safari\\/[.0-9]* Edge\",\r\n        \"IE\": \"IEMobile|MSIEMobile\",\r\n        \"Firefox\": \"fennec|firefox.*maemo|(Mobile|Tablet).*Firefox|Firefox.*Mobile|FxiOS\",\r\n        \"Bolt\": \"bolt\",\r\n        \"TeaShark\": \"teashark\",\r\n        \"Blazer\": \"Blazer\",\r\n        \"Safari\": \"Version.*Mobile.*Safari|Safari.*Mobile|MobileSafari\",\r\n        \"WeChat\": \"\\\\bMicroMessenger\\\\b\",\r\n        \"UCBrowser\": \"UC.*Browser|UCWEB\",\r\n        \"baiduboxapp\": \"baiduboxapp\",\r\n        \"baidubrowser\": \"baidubrowser\",\r\n        \"DiigoBrowser\": \"DiigoBrowser\",\r\n        \"Mercury\": \"\\\\bMercury\\\\b\",\r\n        \"ObigoBrowser\": \"Obigo\",\r\n        \"NetFront\": \"NF-Browser\",\r\n        \"GenericBrowser\": \"NokiaBrowser|OviBrowser|OneBrowser|TwonkyBeamBrowser|SEMC.*Browser|FlyFlow|Minimo|NetFront|Novarra-Vision|MQQBrowser|MicroMessenger\",\r\n        \"PaleMoon\": \"Android.*PaleMoon|Mobile.*PaleMoon\"\r\n    },\r\n    \"props\": {\r\n        \"Mobile\": \"Mobile\\/[VER]\",\r\n        \"Build\": \"Build\\/[VER]\",\r\n        \"Version\": \"Version\\/[VER]\",\r\n        \"VendorID\": \"VendorID\\/[VER]\",\r\n        \"iPad\": \"iPad.*CPU[a-z ]+[VER]\",\r\n        \"iPhone\": \"iPhone.*CPU[a-z ]+[VER]\",\r\n        \"iPod\": \"iPod.*CPU[a-z ]+[VER]\",\r\n        \"Kindle\": \"Kindle\\/[VER]\",\r\n        \"Chrome\": [\r\n            \"Chrome\\/[VER]\",\r\n            \"CriOS\\/[VER]\",\r\n            \"CrMo\\/[VER]\"\r\n        ],\r\n        \"Coast\": [\r\n            \"Coast\\/[VER]\"\r\n        ],\r\n        \"Dolfin\": \"Dolfin\\/[VER]\",\r\n        \"Firefox\": [\r\n            \"Firefox\\/[VER]\",\r\n            \"FxiOS\\/[VER]\"\r\n        ],\r\n        \"Fennec\": \"Fennec\\/[VER]\",\r\n        \"Edge\": \"Edge\\/[VER]\",\r\n        \"IE\": [\r\n            \"IEMobile\\/[VER];\",\r\n            \"IEMobile [VER]\",\r\n            \"MSIE [VER];\",\r\n            \"Trident\\/[0-9.]+;.*rv:[VER]\"\r\n        ],\r\n        \"NetFront\": \"NetFront\\/[VER]\",\r\n        \"NokiaBrowser\": \"NokiaBrowser\\/[VER]\",\r\n        \"Opera\": [\r\n            \" OPR\\/[VER]\",\r\n            \"Opera Mini\\/[VER]\",\r\n            \"Version\\/[VER]\"\r\n        ],\r\n        \"Opera Mini\": \"Opera Mini\\/[VER]\",\r\n        \"Opera Mobi\": \"Version\\/[VER]\",\r\n        \"UCBrowser\": [\r\n            \"UCWEB[VER]\",\r\n            \"UC.*Browser\\/[VER]\"\r\n        ],\r\n        \"MQQBrowser\": \"MQQBrowser\\/[VER]\",\r\n        \"MicroMessenger\": \"MicroMessenger\\/[VER]\",\r\n        \"baiduboxapp\": \"baiduboxapp\\/[VER]\",\r\n        \"baidubrowser\": \"baidubrowser\\/[VER]\",\r\n        \"SamsungBrowser\": \"SamsungBrowser\\/[VER]\",\r\n        \"Iron\": \"Iron\\/[VER]\",\r\n        \"Safari\": [\r\n            \"Version\\/[VER]\",\r\n            \"Safari\\/[VER]\"\r\n        ],\r\n        \"Skyfire\": \"Skyfire\\/[VER]\",\r\n        \"Tizen\": \"Tizen\\/[VER]\",\r\n        \"Webkit\": \"webkit[ \\/][VER]\",\r\n        \"PaleMoon\": \"PaleMoon\\/[VER]\",\r\n        \"Gecko\": \"Gecko\\/[VER]\",\r\n        \"Trident\": \"Trident\\/[VER]\",\r\n        \"Presto\": \"Presto\\/[VER]\",\r\n        \"Goanna\": \"Goanna\\/[VER]\",\r\n        \"iOS\": \" \\\\bi?OS\\\\b [VER][ ;]{1}\",\r\n        \"Android\": \"Android [VER]\",\r\n        \"BlackBerry\": [\r\n            \"BlackBerry[\\\\w]+\\/[VER]\",\r\n            \"BlackBerry.*Version\\/[VER]\",\r\n            \"Version\\/[VER]\"\r\n        ],\r\n        \"BREW\": \"BREW [VER]\",\r\n        \"Java\": \"Java\\/[VER]\",\r\n        \"Windows Phone OS\": [\r\n            \"Windows Phone OS [VER]\",\r\n            \"Windows Phone [VER]\"\r\n        ],\r\n        \"Windows Phone\": \"Windows Phone [VER]\",\r\n        \"Windows CE\": \"Windows CE\\/[VER]\",\r\n        \"Windows NT\": \"Windows NT [VER]\",\r\n        \"Symbian\": [\r\n            \"SymbianOS\\/[VER]\",\r\n            \"Symbian\\/[VER]\"\r\n        ],\r\n        \"webOS\": [\r\n            \"webOS\\/[VER]\",\r\n            \"hpwOS\\/[VER];\"\r\n        ]\r\n    },\r\n    \"utils\": {\r\n        \"Bot\": \"Googlebot|facebookexternalhit|Google-AMPHTML|s~amp-validator|AdsBot-Google|Google Keyword Suggestion|Facebot|YandexBot|YandexMobileBot|bingbot|ia_archiver|AhrefsBot|Ezooms|GSLFbot|WBSearchBot|Twitterbot|TweetmemeBot|Twikle|PaperLiBot|Wotbox|UnwindFetchor|Exabot|MJ12bot|YandexImages|TurnitinBot|Pingdom|contentkingapp\",\r\n        \"MobileBot\": \"Googlebot-Mobile|AdsBot-Google-Mobile|YahooSeeker\\/M1A1-R2D2\",\r\n        \"DesktopMode\": \"WPDesktop\",\r\n        \"TV\": \"SonyDTV|HbbTV\",\r\n        \"WebKit\": \"(webkit)[ \\/]([\\\\w.]+)\",\r\n        \"Console\": \"\\\\b(Nintendo|Nintendo WiiU|Nintendo 3DS|Nintendo Switch|PLAYSTATION|Xbox)\\\\b\",\r\n        \"Watch\": \"SM-V700\"\r\n    }\r\n};\r\n\r\n    // following patterns come from http://detectmobilebrowsers.com/\r\n    impl.detectMobileBrowsers = {\r\n        fullPattern: /(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i,\r\n        shortPattern: /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i,\r\n        tabletPattern: /android|ipad|playbook|silk/i\r\n    };\r\n\r\n    var hasOwnProp = Object.prototype.hasOwnProperty,\r\n        isArray;\r\n\r\n    impl.FALLBACK_PHONE = 'UnknownPhone';\r\n    impl.FALLBACK_TABLET = 'UnknownTablet';\r\n    impl.FALLBACK_MOBILE = 'UnknownMobile';\r\n\r\n    isArray = ('isArray' in Array) ?\r\n        Array.isArray : function (value) { return Object.prototype.toString.call(value) === '[object Array]'; };\r\n\r\n    function equalIC(a, b) {\r\n        return a != null && b != null && a.toLowerCase() === b.toLowerCase();\r\n    }\r\n\r\n    function containsIC(array, value) {\r\n        var valueLC, i, len = array.length;\r\n        if (!len || !value) {\r\n            return false;\r\n        }\r\n        valueLC = value.toLowerCase();\r\n        for (i = 0; i < len; ++i) {\r\n            if (valueLC === array[i].toLowerCase()) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function convertPropsToRegExp(object) {\r\n        for (var key in object) {\r\n            if (hasOwnProp.call(object, key)) {\r\n                object[key] = new RegExp(object[key], 'i');\r\n            }\r\n        }\r\n    }\r\n\r\n    function prepareUserAgent(userAgent) {\r\n        return (userAgent || '').substr(0, 500); // mitigate vulnerable to ReDoS\r\n    }\r\n\r\n    (function init() {\r\n        var key, values, value, i, len, verPos, mobileDetectRules = impl.mobileDetectRules;\r\n        for (key in mobileDetectRules.props) {\r\n            if (hasOwnProp.call(mobileDetectRules.props, key)) {\r\n                values = mobileDetectRules.props[key];\r\n                if (!isArray(values)) {\r\n                    values = [values];\r\n                }\r\n                len = values.length;\r\n                for (i = 0; i < len; ++i) {\r\n                    value = values[i];\r\n                    verPos = value.indexOf('[VER]');\r\n                    if (verPos >= 0) {\r\n                        value = value.substring(0, verPos) + '([\\\\w._\\\\+]+)' + value.substring(verPos + 5);\r\n                    }\r\n                    values[i] = new RegExp(value, 'i');\r\n                }\r\n                mobileDetectRules.props[key] = values;\r\n            }\r\n        }\r\n        convertPropsToRegExp(mobileDetectRules.oss);\r\n        convertPropsToRegExp(mobileDetectRules.phones);\r\n        convertPropsToRegExp(mobileDetectRules.tablets);\r\n        convertPropsToRegExp(mobileDetectRules.uas);\r\n        convertPropsToRegExp(mobileDetectRules.utils);\r\n\r\n        // copy some patterns to oss0 which are tested first (see issue#15)\r\n        mobileDetectRules.oss0 = {\r\n            WindowsPhoneOS: mobileDetectRules.oss.WindowsPhoneOS,\r\n            WindowsMobileOS: mobileDetectRules.oss.WindowsMobileOS\r\n        };\r\n    }());\r\n\r\n    /**\r\n     * Test userAgent string against a set of rules and find the first matched key.\r\n     * @param {Object} rules (key is String, value is RegExp)\r\n     * @param {String} userAgent the navigator.userAgent (or HTTP-Header 'User-Agent').\r\n     * @returns {String|null} the matched key if found, otherwise <tt>null</tt>\r\n     * @private\r\n     */\r\n    impl.findMatch = function(rules, userAgent) {\r\n        for (var key in rules) {\r\n            if (hasOwnProp.call(rules, key)) {\r\n                if (rules[key].test(userAgent)) {\r\n                    return key;\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * Test userAgent string against a set of rules and return an array of matched keys.\r\n     * @param {Object} rules (key is String, value is RegExp)\r\n     * @param {String} userAgent the navigator.userAgent (or HTTP-Header 'User-Agent').\r\n     * @returns {Array} an array of matched keys, may be empty when there is no match, but not <tt>null</tt>\r\n     * @private\r\n     */\r\n    impl.findMatches = function(rules, userAgent) {\r\n        var result = [];\r\n        for (var key in rules) {\r\n            if (hasOwnProp.call(rules, key)) {\r\n                if (rules[key].test(userAgent)) {\r\n                    result.push(key);\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n\r\n    /**\r\n     * Check the version of the given property in the User-Agent.\r\n     *\r\n     * @param {String} propertyName\r\n     * @param {String} userAgent\r\n     * @return {String} version or <tt>null</tt> if version not found\r\n     * @private\r\n     */\r\n    impl.getVersionStr = function (propertyName, userAgent) {\r\n        var props = impl.mobileDetectRules.props, patterns, i, len, match;\r\n        if (hasOwnProp.call(props, propertyName)) {\r\n            patterns = props[propertyName];\r\n            len = patterns.length;\r\n            for (i = 0; i < len; ++i) {\r\n                match = patterns[i].exec(userAgent);\r\n                if (match !== null) {\r\n                    return match[1];\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * Check the version of the given property in the User-Agent.\r\n     * Will return a float number. (eg. 2_0 will return 2.0, 4.3.1 will return 4.31)\r\n     *\r\n     * @param {String} propertyName\r\n     * @param {String} userAgent\r\n     * @return {Number} version or <tt>NaN</tt> if version not found\r\n     * @private\r\n     */\r\n    impl.getVersion = function (propertyName, userAgent) {\r\n        var version = impl.getVersionStr(propertyName, userAgent);\r\n        return version ? impl.prepareVersionNo(version) : NaN;\r\n    };\r\n\r\n    /**\r\n     * Prepare the version number.\r\n     *\r\n     * @param {String} version\r\n     * @return {Number} the version number as a floating number\r\n     * @private\r\n     */\r\n    impl.prepareVersionNo = function (version) {\r\n        var numbers;\r\n\r\n        numbers = version.split(/[a-z._ \\/\\-]/i);\r\n        if (numbers.length === 1) {\r\n            version = numbers[0];\r\n        }\r\n        if (numbers.length > 1) {\r\n            version = numbers[0] + '.';\r\n            numbers.shift();\r\n            version += numbers.join('');\r\n        }\r\n        return Number(version);\r\n    };\r\n\r\n    impl.isMobileFallback = function (userAgent) {\r\n        return impl.detectMobileBrowsers.fullPattern.test(userAgent) ||\r\n            impl.detectMobileBrowsers.shortPattern.test(userAgent.substr(0,4));\r\n    };\r\n\r\n    impl.isTabletFallback = function (userAgent) {\r\n        return impl.detectMobileBrowsers.tabletPattern.test(userAgent);\r\n    };\r\n\r\n    impl.prepareDetectionCache = function (cache, userAgent, maxPhoneWidth) {\r\n        if (cache.mobile !== undefined) {\r\n            return;\r\n        }\r\n        var phone, tablet, phoneSized;\r\n\r\n        // first check for stronger tablet rules, then phone (see issue#5)\r\n        tablet = impl.findMatch(impl.mobileDetectRules.tablets, userAgent);\r\n        if (tablet) {\r\n            cache.mobile = cache.tablet = tablet;\r\n            cache.phone = null;\r\n            return; // unambiguously identified as tablet\r\n        }\r\n\r\n        phone = impl.findMatch(impl.mobileDetectRules.phones, userAgent);\r\n        if (phone) {\r\n            cache.mobile = cache.phone = phone;\r\n            cache.tablet = null;\r\n            return; // unambiguously identified as phone\r\n        }\r\n\r\n        // our rules haven't found a match -> try more general fallback rules\r\n        if (impl.isMobileFallback(userAgent)) {\r\n            phoneSized = MobileDetect.isPhoneSized(maxPhoneWidth);\r\n            if (phoneSized === undefined) {\r\n                cache.mobile = impl.FALLBACK_MOBILE;\r\n                cache.tablet = cache.phone = null;\r\n            } else if (phoneSized) {\r\n                cache.mobile = cache.phone = impl.FALLBACK_PHONE;\r\n                cache.tablet = null;\r\n            } else {\r\n                cache.mobile = cache.tablet = impl.FALLBACK_TABLET;\r\n                cache.phone = null;\r\n            }\r\n        } else if (impl.isTabletFallback(userAgent)) {\r\n            cache.mobile = cache.tablet = impl.FALLBACK_TABLET;\r\n            cache.phone = null;\r\n        } else {\r\n            // not mobile at all!\r\n            cache.mobile = cache.tablet = cache.phone = null;\r\n        }\r\n    };\r\n\r\n    // t is a reference to a MobileDetect instance\r\n    impl.mobileGrade = function (t) {\r\n        // impl note:\r\n        // To keep in sync w/ Mobile_Detect.php easily, the following code is tightly aligned to the PHP version.\r\n        // When changes are made in Mobile_Detect.php, copy this method and replace:\r\n        //     $this-> / t.\r\n        //     self::MOBILE_GRADE_(.) / '$1'\r\n        //     , self::VERSION_TYPE_FLOAT / (nothing)\r\n        //     isIOS() / os('iOS')\r\n        //     [reg] / (nothing)   <-- jsdelivr complaining about unescaped unicode character U+00AE\r\n        var $isMobile = t.mobile() !== null;\r\n\r\n        if (\r\n            // Apple iOS 3.2-5.1 - Tested on the original iPad (4.3 / 5.0), iPad 2 (4.3), iPad 3 (5.1), original iPhone (3.1), iPhone 3 (3.2), 3GS (4.3), 4 (4.3 / 5.0), and 4S (5.1)\r\n            t.os('iOS') && t.version('iPad')>=4.3 ||\r\n            t.os('iOS') && t.version('iPhone')>=3.1 ||\r\n            t.os('iOS') && t.version('iPod')>=3.1 ||\r\n\r\n            // Android 2.1-2.3 - Tested on the HTC Incredible (2.2), original Droid (2.2), HTC Aria (2.1), Google Nexus S (2.3). Functional on 1.5 & 1.6 but performance may be sluggish, tested on Google G1 (1.5)\r\n            // Android 3.1 (Honeycomb)  - Tested on the Samsung Galaxy Tab 10.1 and Motorola XOOM\r\n            // Android 4.0 (ICS)  - Tested on a Galaxy Nexus. Note: transition performance can be poor on upgraded devices\r\n            // Android 4.1 (Jelly Bean)  - Tested on a Galaxy Nexus and Galaxy 7\r\n            ( t.version('Android')>2.1 && t.is('Webkit') ) ||\r\n\r\n            // Windows Phone 7-7.5 - Tested on the HTC Surround (7.0) HTC Trophy (7.5), LG-E900 (7.5), Nokia Lumia 800\r\n            t.version('Windows Phone OS')>=7.0 ||\r\n\r\n            // Blackberry 7 - Tested on BlackBerry Torch 9810\r\n            // Blackberry 6.0 - Tested on the Torch 9800 and Style 9670\r\n            t.is('BlackBerry') && t.version('BlackBerry')>=6.0 ||\r\n            // Blackberry Playbook (1.0-2.0) - Tested on PlayBook\r\n            t.match('Playbook.*Tablet') ||\r\n\r\n            // Palm WebOS (1.4-2.0) - Tested on the Palm Pixi (1.4), Pre (1.4), Pre 2 (2.0)\r\n            ( t.version('webOS')>=1.4 && t.match('Palm|Pre|Pixi') ) ||\r\n            // Palm WebOS 3.0  - Tested on HP TouchPad\r\n            t.match('hp.*TouchPad') ||\r\n\r\n            // Firefox Mobile (12 Beta) - Tested on Android 2.3 device\r\n            ( t.is('Firefox') && t.version('Firefox')>=12 ) ||\r\n\r\n            // Chrome for Android - Tested on Android 4.0, 4.1 device\r\n            ( t.is('Chrome') && t.is('AndroidOS') && t.version('Android')>=4.0 ) ||\r\n\r\n            // Skyfire 4.1 - Tested on Android 2.3 device\r\n            ( t.is('Skyfire') && t.version('Skyfire')>=4.1 && t.is('AndroidOS') && t.version('Android')>=2.3 ) ||\r\n\r\n            // Opera Mobile 11.5-12: Tested on Android 2.3\r\n            ( t.is('Opera') && t.version('Opera Mobi')>11 && t.is('AndroidOS') ) ||\r\n\r\n            // Meego 1.2 - Tested on Nokia 950 and N9\r\n            t.is('MeeGoOS') ||\r\n\r\n            // Tizen (pre-release) - Tested on early hardware\r\n            t.is('Tizen') ||\r\n\r\n            // Samsung Bada 2.0 - Tested on a Samsung Wave 3, Dolphin browser\r\n            // @todo: more tests here!\r\n            t.is('Dolfin') && t.version('Bada')>=2.0 ||\r\n\r\n            // UC Browser - Tested on Android 2.3 device\r\n            ( (t.is('UC Browser') || t.is('Dolfin')) && t.version('Android')>=2.3 ) ||\r\n\r\n            // Kindle 3 and Fire  - Tested on the built-in WebKit browser for each\r\n            ( t.match('Kindle Fire') ||\r\n                t.is('Kindle') && t.version('Kindle')>=3.0 ) ||\r\n\r\n            // Nook Color 1.4.1 - Tested on original Nook Color, not Nook Tablet\r\n            t.is('AndroidOS') && t.is('NookTablet') ||\r\n\r\n            // Chrome Desktop 11-21 - Tested on OS X 10.7 and Windows 7\r\n            t.version('Chrome')>=11 && !$isMobile ||\r\n\r\n            // Safari Desktop 4-5 - Tested on OS X 10.7 and Windows 7\r\n            t.version('Safari')>=5.0 && !$isMobile ||\r\n\r\n            // Firefox Desktop 4-13 - Tested on OS X 10.7 and Windows 7\r\n            t.version('Firefox')>=4.0 && !$isMobile ||\r\n\r\n            // Internet Explorer 7-9 - Tested on Windows XP, Vista and 7\r\n            t.version('MSIE')>=7.0 && !$isMobile ||\r\n\r\n            // Opera Desktop 10-12 - Tested on OS X 10.7 and Windows 7\r\n            // @reference: http://my.opera.com/community/openweb/idopera/\r\n            t.version('Opera')>=10 && !$isMobile\r\n\r\n            ){\r\n            return 'A';\r\n        }\r\n\r\n        if (\r\n            t.os('iOS') && t.version('iPad')<4.3 ||\r\n            t.os('iOS') && t.version('iPhone')<3.1 ||\r\n            t.os('iOS') && t.version('iPod')<3.1 ||\r\n\r\n            // Blackberry 5.0: Tested on the Storm 2 9550, Bold 9770\r\n            t.is('Blackberry') && t.version('BlackBerry')>=5 && t.version('BlackBerry')<6 ||\r\n\r\n            //Opera Mini (5.0-6.5) - Tested on iOS 3.2/4.3 and Android 2.3\r\n            ( t.version('Opera Mini')>=5.0 && t.version('Opera Mini')<=6.5 &&\r\n                (t.version('Android')>=2.3 || t.is('iOS')) ) ||\r\n\r\n            // Nokia Symbian^3 - Tested on Nokia N8 (Symbian^3), C7 (Symbian^3), also works on N97 (Symbian^1)\r\n            t.match('NokiaN8|NokiaC7|N97.*Series60|Symbian/3') ||\r\n\r\n            // @todo: report this (tested on Nokia N71)\r\n            t.version('Opera Mobi')>=11 && t.is('SymbianOS')\r\n            ){\r\n            return 'B';\r\n        }\r\n\r\n        if (\r\n        // Blackberry 4.x - Tested on the Curve 8330\r\n            t.version('BlackBerry')<5.0 ||\r\n            // Windows Mobile - Tested on the HTC Leo (WinMo 5.2)\r\n            t.match('MSIEMobile|Windows CE.*Mobile') || t.version('Windows Mobile')<=5.2\r\n\r\n            ){\r\n            return 'C';\r\n        }\r\n\r\n        //All older smartphone platforms and featurephones - Any device that doesn't support media queries\r\n        //will receive the basic, C grade experience.\r\n        return 'C';\r\n    };\r\n\r\n    impl.detectOS = function (ua) {\r\n        return impl.findMatch(impl.mobileDetectRules.oss0, ua) ||\r\n            impl.findMatch(impl.mobileDetectRules.oss, ua);\r\n    };\r\n\r\n    impl.getDeviceSmallerSide = function () {\r\n        return window.screen.width < window.screen.height ?\r\n            window.screen.width :\r\n            window.screen.height;\r\n    };\r\n\r\n    /**\r\n     * Constructor for MobileDetect object.\r\n     * <br>\r\n     * Such an object will keep a reference to the given user-agent string and cache most of the detect queries.<br>\r\n     * <div style=\"background-color: #d9edf7; border: 1px solid #bce8f1; color: #3a87ad; padding: 14px; border-radius: 2px; margin-top: 20px\">\r\n     *     <strong>Find information how to download and install:</strong>\r\n     *     <a href=\"https://github.com/hgoebl/mobile-detect.js/\">github.com/hgoebl/mobile-detect.js/</a>\r\n     * </div>\r\n     *\r\n     * @example <pre>\r\n     *     var md = new MobileDetect(window.navigator.userAgent);\r\n     *     if (md.mobile()) {\r\n     *         location.href = (md.mobileGrade() === 'A') ? '/mobile/' : '/lynx/';\r\n     *     }\r\n     * </pre>\r\n     *\r\n     * @param {string} userAgent typically taken from window.navigator.userAgent or http_header['User-Agent']\r\n     * @param {number} [maxPhoneWidth=600] <strong>only for browsers</strong> specify a value for the maximum\r\n     *        width of smallest device side (in logical \"CSS\" pixels) until a device detected as mobile will be handled\r\n     *        as phone.\r\n     *        This is only used in cases where the device cannot be classified as phone or tablet.<br>\r\n     *        See <a href=\"http://developer.android.com/guide/practices/screens_support.html\">Declaring Tablet Layouts\r\n     *        for Android</a>.<br>\r\n     *        If you provide a value < 0, then this \"fuzzy\" check is disabled.\r\n     * @constructor\r\n     * @global\r\n     */\r\n    function MobileDetect(userAgent, maxPhoneWidth) {\r\n        this.ua = prepareUserAgent(userAgent);\r\n        this._cache = {};\r\n        //600dp is typical 7\" tablet minimum width\r\n        this.maxPhoneWidth = maxPhoneWidth || 600;\r\n    }\r\n\r\n    MobileDetect.prototype = {\r\n        constructor: MobileDetect,\r\n\r\n        /**\r\n         * Returns the detected phone or tablet type or <tt>null</tt> if it is not a mobile device.\r\n         * <br>\r\n         * For a list of possible return values see {@link MobileDetect#phone} and {@link MobileDetect#tablet}.<br>\r\n         * <br>\r\n         * If the device is not detected by the regular expressions from Mobile-Detect, a test is made against\r\n         * the patterns of <a href=\"http://detectmobilebrowsers.com/\">detectmobilebrowsers.com</a>. If this test\r\n         * is positive, a value of <code>UnknownPhone</code>, <code>UnknownTablet</code> or\r\n         * <code>UnknownMobile</code> is returned.<br>\r\n         * When used in browser, the decision whether phone or tablet is made based on <code>screen.width/height</code>.<br>\r\n         * <br>\r\n         * When used server-side (node.js), there is no way to tell the difference between <code>UnknownTablet</code>\r\n         * and <code>UnknownMobile</code>, so you will get <code>UnknownMobile</code> here.<br>\r\n         * Be aware that since v1.0.0 in this special case you will get <code>UnknownMobile</code> only for:\r\n         * {@link MobileDetect#mobile}, not for {@link MobileDetect#phone} and {@link MobileDetect#tablet}.\r\n         * In versions before v1.0.0 all 3 methods returned <code>UnknownMobile</code> which was tedious to use.\r\n         * <br>\r\n         * In most cases you will use the return value just as a boolean.\r\n         *\r\n         * @returns {String} the key for the phone family or tablet family, e.g. \"Nexus\".\r\n         * @function MobileDetect#mobile\r\n         */\r\n        mobile: function () {\r\n            impl.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth);\r\n            return this._cache.mobile;\r\n        },\r\n\r\n        /**\r\n         * Returns the detected phone type/family string or <tt>null</tt>.\r\n         * <br>\r\n         * The returned tablet (family or producer) is one of following keys:<br>\r\n         * <br><tt>iPhone, BlackBerry, HTC, Nexus, Dell, Motorola, Samsung, LG, Sony, Asus,\r\n         * NokiaLumia, Micromax, Palm, Vertu, Pantech, Fly, Wiko, iMobile, SimValley,\r\n         * Wolfgang, Alcatel, Nintendo, Amoi, INQ, OnePlus, GenericPhone</tt><br>\r\n         * <br>\r\n         * If the device is not detected by the regular expressions from Mobile-Detect, a test is made against\r\n         * the patterns of <a href=\"http://detectmobilebrowsers.com/\">detectmobilebrowsers.com</a>. If this test\r\n         * is positive, a value of <code>UnknownPhone</code> or <code>UnknownMobile</code> is returned.<br>\r\n         * When used in browser, the decision whether phone or tablet is made based on <code>screen.width/height</code>.<br>\r\n         * <br>\r\n         * When used server-side (node.js), there is no way to tell the difference between <code>UnknownTablet</code>\r\n         * and <code>UnknownMobile</code>, so you will get <code>null</code> here, while {@link MobileDetect#mobile}\r\n         * will return <code>UnknownMobile</code>.<br>\r\n         * Be aware that since v1.0.0 in this special case you will get <code>UnknownMobile</code> only for:\r\n         * {@link MobileDetect#mobile}, not for {@link MobileDetect#phone} and {@link MobileDetect#tablet}.\r\n         * In versions before v1.0.0 all 3 methods returned <code>UnknownMobile</code> which was tedious to use.\r\n         * <br>\r\n         * In most cases you will use the return value just as a boolean.\r\n         *\r\n         * @returns {String} the key of the phone family or producer, e.g. \"iPhone\"\r\n         * @function MobileDetect#phone\r\n         */\r\n        phone: function () {\r\n            impl.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth);\r\n            return this._cache.phone;\r\n        },\r\n\r\n        /**\r\n         * Returns the detected tablet type/family string or <tt>null</tt>.\r\n         * <br>\r\n         * The returned tablet (family or producer) is one of following keys:<br>\r\n         * <br><tt>iPad, NexusTablet, GoogleTablet, SamsungTablet, Kindle, SurfaceTablet,\r\n         * HPTablet, AsusTablet, BlackBerryTablet, HTCtablet, MotorolaTablet, NookTablet,\r\n         * AcerTablet, ToshibaTablet, LGTablet, FujitsuTablet, PrestigioTablet,\r\n         * LenovoTablet, DellTablet, YarvikTablet, MedionTablet, ArnovaTablet,\r\n         * IntensoTablet, IRUTablet, MegafonTablet, EbodaTablet, AllViewTablet,\r\n         * ArchosTablet, AinolTablet, NokiaLumiaTablet, SonyTablet, PhilipsTablet,\r\n         * CubeTablet, CobyTablet, MIDTablet, MSITablet, SMiTTablet, RockChipTablet,\r\n         * FlyTablet, bqTablet, HuaweiTablet, NecTablet, PantechTablet, BronchoTablet,\r\n         * VersusTablet, ZyncTablet, PositivoTablet, NabiTablet, KoboTablet, DanewTablet,\r\n         * TexetTablet, PlaystationTablet, TrekstorTablet, PyleAudioTablet, AdvanTablet,\r\n         * DanyTechTablet, GalapadTablet, MicromaxTablet, KarbonnTablet, AllFineTablet,\r\n         * PROSCANTablet, YONESTablet, ChangJiaTablet, GUTablet, PointOfViewTablet,\r\n         * OvermaxTablet, HCLTablet, DPSTablet, VistureTablet, CrestaTablet,\r\n         * MediatekTablet, ConcordeTablet, GoCleverTablet, ModecomTablet, VoninoTablet,\r\n         * ECSTablet, StorexTablet, VodafoneTablet, EssentielBTablet, RossMoorTablet,\r\n         * iMobileTablet, TolinoTablet, AudioSonicTablet, AMPETablet, SkkTablet,\r\n         * TecnoTablet, JXDTablet, iJoyTablet, FX2Tablet, XoroTablet, ViewsonicTablet,\r\n         * VerizonTablet, OdysTablet, CaptivaTablet, IconbitTablet, TeclastTablet,\r\n         * OndaTablet, JaytechTablet, BlaupunktTablet, DigmaTablet, EvolioTablet,\r\n         * LavaTablet, AocTablet, MpmanTablet, CelkonTablet, WolderTablet, MediacomTablet,\r\n         * MiTablet, NibiruTablet, NexoTablet, LeaderTablet, UbislateTablet,\r\n         * PocketBookTablet, KocasoTablet, HisenseTablet, Hudl, TelstraTablet,\r\n         * GenericTablet</tt><br>\r\n         * <br>\r\n         * If the device is not detected by the regular expressions from Mobile-Detect, a test is made against\r\n         * the patterns of <a href=\"http://detectmobilebrowsers.com/\">detectmobilebrowsers.com</a>. If this test\r\n         * is positive, a value of <code>UnknownTablet</code> or <code>UnknownMobile</code> is returned.<br>\r\n         * When used in browser, the decision whether phone or tablet is made based on <code>screen.width/height</code>.<br>\r\n         * <br>\r\n         * When used server-side (node.js), there is no way to tell the difference between <code>UnknownTablet</code>\r\n         * and <code>UnknownMobile</code>, so you will get <code>null</code> here, while {@link MobileDetect#mobile}\r\n         * will return <code>UnknownMobile</code>.<br>\r\n         * Be aware that since v1.0.0 in this special case you will get <code>UnknownMobile</code> only for:\r\n         * {@link MobileDetect#mobile}, not for {@link MobileDetect#phone} and {@link MobileDetect#tablet}.\r\n         * In versions before v1.0.0 all 3 methods returned <code>UnknownMobile</code> which was tedious to use.\r\n         * <br>\r\n         * In most cases you will use the return value just as a boolean.\r\n         *\r\n         * @returns {String} the key of the tablet family or producer, e.g. \"SamsungTablet\"\r\n         * @function MobileDetect#tablet\r\n         */\r\n        tablet: function () {\r\n            impl.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth);\r\n            return this._cache.tablet;\r\n        },\r\n\r\n        /**\r\n         * Returns the (first) detected user-agent string or <tt>null</tt>.\r\n         * <br>\r\n         * The returned user-agent is one of following keys:<br>\r\n         * <br><tt>Chrome, Dolfin, Opera, Skyfire, Edge, IE, Firefox, Bolt, TeaShark, Blazer,\r\n         * Safari, WeChat, UCBrowser, baiduboxapp, baidubrowser, DiigoBrowser, Mercury,\r\n         * ObigoBrowser, NetFront, GenericBrowser, PaleMoon</tt><br>\r\n         * <br>\r\n         * In most cases calling {@link MobileDetect#userAgent} will be sufficient. But there are rare\r\n         * cases where a mobile device pretends to be more than one particular browser. You can get the\r\n         * list of all matches with {@link MobileDetect#userAgents} or check for a particular value by\r\n         * providing one of the defined keys as first argument to {@link MobileDetect#is}.\r\n         *\r\n         * @returns {String} the key for the detected user-agent or <tt>null</tt>\r\n         * @function MobileDetect#userAgent\r\n         */\r\n        userAgent: function () {\r\n            if (this._cache.userAgent === undefined) {\r\n                this._cache.userAgent = impl.findMatch(impl.mobileDetectRules.uas, this.ua);\r\n            }\r\n            return this._cache.userAgent;\r\n        },\r\n\r\n        /**\r\n         * Returns all detected user-agent strings.\r\n         * <br>\r\n         * The array is empty or contains one or more of following keys:<br>\r\n         * <br><tt>Chrome, Dolfin, Opera, Skyfire, Edge, IE, Firefox, Bolt, TeaShark, Blazer,\r\n         * Safari, WeChat, UCBrowser, baiduboxapp, baidubrowser, DiigoBrowser, Mercury,\r\n         * ObigoBrowser, NetFront, GenericBrowser, PaleMoon</tt><br>\r\n         * <br>\r\n         * In most cases calling {@link MobileDetect#userAgent} will be sufficient. But there are rare\r\n         * cases where a mobile device pretends to be more than one particular browser. You can get the\r\n         * list of all matches with {@link MobileDetect#userAgents} or check for a particular value by\r\n         * providing one of the defined keys as first argument to {@link MobileDetect#is}.\r\n         *\r\n         * @returns {Array} the array of detected user-agent keys or <tt>[]</tt>\r\n         * @function MobileDetect#userAgents\r\n         */\r\n        userAgents: function () {\r\n            if (this._cache.userAgents === undefined) {\r\n                this._cache.userAgents = impl.findMatches(impl.mobileDetectRules.uas, this.ua);\r\n            }\r\n            return this._cache.userAgents;\r\n        },\r\n\r\n        /**\r\n         * Returns the detected operating system string or <tt>null</tt>.\r\n         * <br>\r\n         * The operating system is one of following keys:<br>\r\n         * <br><tt>AndroidOS, BlackBerryOS, PalmOS, SymbianOS, WindowsMobileOS, WindowsPhoneOS,\r\n         * iOS, iPadOS, MeeGoOS, MaemoOS, JavaOS, webOS, badaOS, BREWOS</tt><br>\r\n         *\r\n         * @returns {String} the key for the detected operating system.\r\n         * @function MobileDetect#os\r\n         */\r\n        os: function () {\r\n            if (this._cache.os === undefined) {\r\n                this._cache.os = impl.detectOS(this.ua);\r\n            }\r\n            return this._cache.os;\r\n        },\r\n\r\n        /**\r\n         * Get the version (as Number) of the given property in the User-Agent.\r\n         * <br>\r\n         * Will return a float number. (eg. 2_0 will return 2.0, 4.3.1 will return 4.31)\r\n         *\r\n         * @param {String} key a key defining a thing which has a version.<br>\r\n         *        You can use one of following keys:<br>\r\n         * <br><tt>Mobile, Build, Version, VendorID, iPad, iPhone, iPod, Kindle, Chrome, Coast,\r\n         * Dolfin, Firefox, Fennec, Edge, IE, NetFront, NokiaBrowser, Opera, Opera Mini,\r\n         * Opera Mobi, UCBrowser, MQQBrowser, MicroMessenger, baiduboxapp, baidubrowser,\r\n         * SamsungBrowser, Iron, Safari, Skyfire, Tizen, Webkit, PaleMoon, Gecko, Trident,\r\n         * Presto, Goanna, iOS, Android, BlackBerry, BREW, Java, Windows Phone OS, Windows\r\n         * Phone, Windows CE, Windows NT, Symbian, webOS</tt><br>\r\n         *\r\n         * @returns {Number} the version as float or <tt>NaN</tt> if User-Agent doesn't contain this version.\r\n         *          Be careful when comparing this value with '==' operator!\r\n         * @function MobileDetect#version\r\n         */\r\n        version: function (key) {\r\n            return impl.getVersion(key, this.ua);\r\n        },\r\n\r\n        /**\r\n         * Get the version (as String) of the given property in the User-Agent.\r\n         * <br>\r\n         *\r\n         * @param {String} key a key defining a thing which has a version.<br>\r\n         *        You can use one of following keys:<br>\r\n         * <br><tt>Mobile, Build, Version, VendorID, iPad, iPhone, iPod, Kindle, Chrome, Coast,\r\n         * Dolfin, Firefox, Fennec, Edge, IE, NetFront, NokiaBrowser, Opera, Opera Mini,\r\n         * Opera Mobi, UCBrowser, MQQBrowser, MicroMessenger, baiduboxapp, baidubrowser,\r\n         * SamsungBrowser, Iron, Safari, Skyfire, Tizen, Webkit, PaleMoon, Gecko, Trident,\r\n         * Presto, Goanna, iOS, Android, BlackBerry, BREW, Java, Windows Phone OS, Windows\r\n         * Phone, Windows CE, Windows NT, Symbian, webOS</tt><br>\r\n         *\r\n         * @returns {String} the \"raw\" version as String or <tt>null</tt> if User-Agent doesn't contain this version.\r\n         *\r\n         * @function MobileDetect#versionStr\r\n         */\r\n        versionStr: function (key) {\r\n            return impl.getVersionStr(key, this.ua);\r\n        },\r\n\r\n        /**\r\n         * Global test key against userAgent, os, phone, tablet and some other properties of userAgent string.\r\n         *\r\n         * @param {String} key the key (case-insensitive) of a userAgent, an operating system, phone or\r\n         *        tablet family.<br>\r\n         *        For a complete list of possible values, see {@link MobileDetect#userAgent},\r\n         *        {@link MobileDetect#os}, {@link MobileDetect#phone}, {@link MobileDetect#tablet}.<br>\r\n         *        Additionally you have following keys:<br>\r\n         * <br><tt>Bot, MobileBot, DesktopMode, TV, WebKit, Console, Watch</tt><br>\r\n         *\r\n         * @returns {boolean} <tt>true</tt> when the given key is one of the defined keys of userAgent, os, phone,\r\n         *                    tablet or one of the listed additional keys, otherwise <tt>false</tt>\r\n         * @function MobileDetect#is\r\n         */\r\n        is: function (key) {\r\n            return containsIC(this.userAgents(), key) ||\r\n                   equalIC(key, this.os()) ||\r\n                   equalIC(key, this.phone()) ||\r\n                   equalIC(key, this.tablet()) ||\r\n                   containsIC(impl.findMatches(impl.mobileDetectRules.utils, this.ua), key);\r\n        },\r\n\r\n        /**\r\n         * Do a quick test against navigator::userAgent.\r\n         *\r\n         * @param {String|RegExp} pattern the pattern, either as String or RegExp\r\n         *                        (a string will be converted to a case-insensitive RegExp).\r\n         * @returns {boolean} <tt>true</tt> when the pattern matches, otherwise <tt>false</tt>\r\n         * @function MobileDetect#match\r\n         */\r\n        match: function (pattern) {\r\n            if (!(pattern instanceof RegExp)) {\r\n                pattern = new RegExp(pattern, 'i');\r\n            }\r\n            return pattern.test(this.ua);\r\n        },\r\n\r\n        /**\r\n         * Checks whether the mobile device can be considered as phone regarding <code>screen.width</code>.\r\n         * <br>\r\n         * Obviously this method makes sense in browser environments only (not for Node.js)!\r\n         * @param {number} [maxPhoneWidth] the maximum logical pixels (aka. CSS-pixels) to be considered as phone.<br>\r\n         *        The argument is optional and if not present or falsy, the value of the constructor is taken.\r\n         * @returns {boolean|undefined} <code>undefined</code> if screen size wasn't detectable, else <code>true</code>\r\n         *          when screen.width is less or equal to maxPhoneWidth, otherwise <code>false</code>.<br>\r\n         *          Will always return <code>undefined</code> server-side.\r\n         */\r\n        isPhoneSized: function (maxPhoneWidth) {\r\n            return MobileDetect.isPhoneSized(maxPhoneWidth || this.maxPhoneWidth);\r\n        },\r\n\r\n        /**\r\n         * Returns the mobile grade ('A', 'B', 'C').\r\n         *\r\n         * @returns {String} one of the mobile grades ('A', 'B', 'C').\r\n         * @function MobileDetect#mobileGrade\r\n         */\r\n        mobileGrade: function () {\r\n            if (this._cache.grade === undefined) {\r\n                this._cache.grade = impl.mobileGrade(this);\r\n            }\r\n            return this._cache.grade;\r\n        }\r\n    };\r\n\r\n    // environment-dependent\r\n    if (typeof window !== 'undefined' && window.screen) {\r\n        MobileDetect.isPhoneSized = function (maxPhoneWidth) {\r\n            return maxPhoneWidth < 0 ? undefined : impl.getDeviceSmallerSide() <= maxPhoneWidth;\r\n        };\r\n    } else {\r\n        MobileDetect.isPhoneSized = function () {};\r\n    }\r\n\r\n    // should not be replaced by a completely new object - just overwrite existing methods\r\n    MobileDetect._impl = impl;\r\n    \r\n    MobileDetect.version = '1.4.4 2019-09-21';\r\n\r\n    return MobileDetect;\r\n}); // end of call of define()\r\n})((function (undefined) {\r\n    if (typeof module !== 'undefined' && module.exports) {\r\n        return function (factory) { module.exports = factory(); };\r\n    } else if (typeof define === 'function' && define.amd) {\r\n        return define;\r\n    } else if (typeof window !== 'undefined') {\r\n        return function (factory) { window.MobileDetect = factory(); };\r\n    } else {\r\n        // please file a bug if you get this error!\r\n        throw new Error('unknown environment');\r\n    }\r\n})());","// Copyright (c) 2013 Pieroxy <pieroxy@pieroxy.net>\r\n// This work is free. You can redistribute it and/or modify it\r\n// under the terms of the WTFPL, Version 2\r\n// For more information see LICENSE.txt or http://www.wtfpl.net/\r\n//\r\n// For more information, the home page:\r\n// http://pieroxy.net/blog/pages/lz-string/testing.html\r\n//\r\n// LZ-based compression algorithm, version 1.4.4\r\n\r\n// private property\r\nlet f = String.fromCharCode;\r\nlet keyStrBase64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\r\nlet keyStrUriSafe = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$\";\r\nlet baseReverseDic = {};\r\n\r\nfunction getBaseValue(alphabet, character) {\r\n  if (!baseReverseDic[alphabet]) {\r\n    baseReverseDic[alphabet] = {};\r\n    for (let i = 0; i < alphabet.length; i++) {\r\n      baseReverseDic[alphabet][alphabet.charAt(i)] = i;\r\n    }\r\n  }\r\n  return baseReverseDic[alphabet][character];\r\n}\r\n\r\nfunction getInput(input) {\r\n  if (input === null) {\r\n    return '';\r\n  } else if (input === '') {\r\n    return null;\r\n  }\r\n\r\n  if (typeof input === \"string\") {\r\n    return input;\r\n  }\r\n\r\n  if (input instanceof ArrayBuffer) {\r\n    input = new Uint8Array(input);\r\n  }\r\n\r\n  let s = '';\r\n  for (let i = 0; i < input.length; i++) {\r\n    s += String.fromCharCode(input[i]);\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nexport default {\r\n  compressToBase64: function (input) {\r\n    input = getInput(input);\r\n\r\n    if (!input) return \"\";\r\n\r\n    let res = this._compress(input, 6, function (a) {\r\n      return keyStrBase64.charAt(a);\r\n    });\r\n    switch (res.length%4) { // To produce valid Base64\r\n      default: // When could this happen ?\r\n      case 0 :\r\n        return res;\r\n      case 1 :\r\n        return res + \"===\";\r\n      case 2 :\r\n        return res + \"==\";\r\n      case 3 :\r\n        return res + \"=\";\r\n    }\r\n  },\r\n\r\n  decompressFromBase64: function (input) {\r\n    if (input === null) return \"\";\r\n    if (input === \"\") return null;\r\n\r\n    input = getInput(input);\r\n    return this._decompress(input.length, 32, function (index) {\r\n      return getBaseValue(keyStrBase64, input.charAt(index));\r\n    });\r\n  },\r\n\r\n  compressToUTF16: function (input) {\r\n    if (input === null) return \"\";\r\n\r\n    input = getInput(input);\r\n    return this._compress(input, 15, function (a) {\r\n      return f(a + 32);\r\n    }) + \" \";\r\n  },\r\n\r\n  decompressFromUTF16: function (compressed) {\r\n    if (compressed === null) return \"\";\r\n    if (compressed === \"\") return null;\r\n\r\n    compressed = getInput(compressed);\r\n    return this._decompress(compressed.length, 16384, function (index) {\r\n      return compressed.charCodeAt(index) - 32;\r\n    });\r\n  },\r\n\r\n  //compress into uint8array (UCS-2 big endian format)\r\n  compressToUint8Array: function (uncompressed) {\r\n    uncompressed = getInput(uncompressed);\r\n\r\n    let compressed = this.compress(uncompressed);\r\n    let buf = new Uint8Array(compressed.length*2); // 2 bytes per character\r\n\r\n    for (let i = 0, TotalLen = compressed.length; i < TotalLen; i++) {\r\n      let current_value = compressed.charCodeAt(i);\r\n      buf[i*2] = current_value>>>8;\r\n      buf[i*2 + 1] = current_value%256;\r\n    }\r\n    return buf;\r\n  },\r\n\r\n  //decompress from uint8array (UCS-2 big endian format)\r\n  decompressFromUint8Array: function (compressed) {\r\n    if (compressed === null || compressed === undefined) {\r\n      return this.decompress(compressed);\r\n    } else {\r\n      compressed = getInput(compressed);\r\n\r\n      let buf = new Array(compressed.length/2); // 2 bytes per character\r\n      for (let i = 0, TotalLen = buf.length; i < TotalLen; i++) {\r\n        buf[i] = compressed[i*2]*256 + compressed[i*2 + 1];\r\n      }\r\n\r\n      let result = [];\r\n      buf.forEach(function (c) {\r\n        result.push(f(c));\r\n      });\r\n      return this.decompress(result.join(''));\r\n\r\n    }\r\n\r\n  },\r\n\r\n\r\n  //compress into a string that is already URI encoded\r\n  compressToEncodedURIComponent: function (input) {\r\n    if (input === null) return \"\";\r\n    return this._compress(input, 6, function (a) {\r\n      return keyStrUriSafe.charAt(a);\r\n    });\r\n  },\r\n\r\n  //decompress from an output of compressToEncodedURIComponent\r\n  decompressFromEncodedURIComponent: function (input) {\r\n    if (input === null) return \"\";\r\n    if (input === \"\") return null;\r\n    input = input.replace(/ /g, \"+\");\r\n    return this._decompress(input.length, 32, function (index) {\r\n      return getBaseValue(keyStrUriSafe, input.charAt(index));\r\n    });\r\n  },\r\n\r\n  compress : function (uncompressed) {\r\n    return this._compress(uncompressed, 16, function (a) {\r\n      return f(a);\r\n    });\r\n  },\r\n\r\n  _compress: function (uncompressed, bitsPerChar, getCharFromInt) {\r\n    uncompressed = getInput(uncompressed);\r\n\r\n    if (uncompressed === null) return \"\";\r\n    let i, value, context_dictionary = {}, context_dictionaryToCreate = {}, context_c = \"\", context_wc = \"\",\r\n        context_w                                                                                      = \"\", context_enlargeIn = 2, // Compensate for the first entry which should not count\r\n        context_dictSize                                                                               = 3, context_numBits = 2, context_data                                        = [], context_data_val = 0,\r\n        context_data_position                                                                          = 0, ii;\r\n\r\n    for (ii = 0; ii < uncompressed.length; ii += 1) {\r\n      context_c = uncompressed.charAt(ii);\r\n      if (!Object.prototype.hasOwnProperty.call(context_dictionary, context_c)) {\r\n        context_dictionary[context_c] = context_dictSize++;\r\n        context_dictionaryToCreate[context_c] = true;\r\n      }\r\n\r\n      context_wc = context_w + context_c;\r\n      if (Object.prototype.hasOwnProperty.call(context_dictionary, context_wc)) {\r\n        context_w = context_wc;\r\n      } else {\r\n        if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate, context_w)) {\r\n          if (context_w.charCodeAt(0) < 256) {\r\n            for (i = 0; i < context_numBits; i++) {\r\n              context_data_val = (context_data_val<<1);\r\n              if (context_data_position === bitsPerChar - 1) {\r\n                context_data_position = 0;\r\n                context_data.push(getCharFromInt(context_data_val));\r\n                context_data_val = 0;\r\n              } else {\r\n                context_data_position++;\r\n              }\r\n            }\r\n            value = context_w.charCodeAt(0);\r\n            for (i = 0; i < 8; i++) {\r\n              context_data_val = (context_data_val<<1) | (value & 1);\r\n              if (context_data_position === bitsPerChar - 1) {\r\n                context_data_position = 0;\r\n                context_data.push(getCharFromInt(context_data_val));\r\n                context_data_val = 0;\r\n              } else {\r\n                context_data_position++;\r\n              }\r\n              value = value>>1;\r\n            }\r\n          } else {\r\n            value = 1;\r\n            for (i = 0; i < context_numBits; i++) {\r\n              context_data_val = (context_data_val<<1) | value;\r\n              if (context_data_position == bitsPerChar - 1) {\r\n                context_data_position = 0;\r\n                context_data.push(getCharFromInt(context_data_val));\r\n                context_data_val = 0;\r\n              } else {\r\n                context_data_position++;\r\n              }\r\n              value = 0;\r\n            }\r\n            value = context_w.charCodeAt(0);\r\n            for (i = 0; i < 16; i++) {\r\n              context_data_val = (context_data_val<<1) | (value & 1);\r\n              if (context_data_position === bitsPerChar - 1) {\r\n                context_data_position = 0;\r\n                context_data.push(getCharFromInt(context_data_val));\r\n                context_data_val = 0;\r\n              } else {\r\n                context_data_position++;\r\n              }\r\n              value = value>>1;\r\n            }\r\n          }\r\n          context_enlargeIn--;\r\n          if (context_enlargeIn === 0) {\r\n            context_enlargeIn = Math.pow(2, context_numBits);\r\n            context_numBits++;\r\n          }\r\n          delete context_dictionaryToCreate[context_w];\r\n        } else {\r\n          value = context_dictionary[context_w];\r\n          for (i = 0; i < context_numBits; i++) {\r\n            context_data_val = (context_data_val<<1) | (value & 1);\r\n            if (context_data_position === bitsPerChar - 1) {\r\n              context_data_position = 0;\r\n              context_data.push(getCharFromInt(context_data_val));\r\n              context_data_val = 0;\r\n            } else {\r\n              context_data_position++;\r\n            }\r\n            value = value>>1;\r\n          }\r\n\r\n\r\n        }\r\n        context_enlargeIn--;\r\n        if (context_enlargeIn === 0) {\r\n          context_enlargeIn = Math.pow(2, context_numBits);\r\n          context_numBits++;\r\n        }\r\n        // Add wc to the dictionary.\r\n        context_dictionary[context_wc] = context_dictSize++;\r\n        context_w = String(context_c);\r\n      }\r\n    }\r\n\r\n    // Output the code for w.\r\n    if (context_w !== \"\") {\r\n      if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate, context_w)) {\r\n        if (context_w.charCodeAt(0) < 256) {\r\n          for (i = 0; i < context_numBits; i++) {\r\n            context_data_val = (context_data_val<<1);\r\n            if (context_data_position === bitsPerChar - 1) {\r\n              context_data_position = 0;\r\n              context_data.push(getCharFromInt(context_data_val));\r\n              context_data_val = 0;\r\n            } else {\r\n              context_data_position++;\r\n            }\r\n          }\r\n          value = context_w.charCodeAt(0);\r\n          for (i = 0; i < 8; i++) {\r\n            context_data_val = (context_data_val<<1) | (value & 1);\r\n            if (context_data_position === bitsPerChar - 1) {\r\n              context_data_position = 0;\r\n              context_data.push(getCharFromInt(context_data_val));\r\n              context_data_val = 0;\r\n            } else {\r\n              context_data_position++;\r\n            }\r\n            value = value>>1;\r\n          }\r\n        } else {\r\n          value = 1;\r\n          for (i = 0; i < context_numBits; i++) {\r\n            context_data_val = (context_data_val<<1) | value;\r\n            if (context_data_position === bitsPerChar - 1) {\r\n              context_data_position = 0;\r\n              context_data.push(getCharFromInt(context_data_val));\r\n              context_data_val = 0;\r\n            } else {\r\n              context_data_position++;\r\n            }\r\n            value = 0;\r\n          }\r\n          value = context_w.charCodeAt(0);\r\n          for (i = 0; i < 16; i++) {\r\n            context_data_val = (context_data_val<<1) | (value & 1);\r\n            if (context_data_position === bitsPerChar - 1) {\r\n              context_data_position = 0;\r\n              context_data.push(getCharFromInt(context_data_val));\r\n              context_data_val = 0;\r\n            } else {\r\n              context_data_position++;\r\n            }\r\n            value = value>>1;\r\n          }\r\n        }\r\n        context_enlargeIn--;\r\n        if (context_enlargeIn === 0) {\r\n          context_enlargeIn = Math.pow(2, context_numBits);\r\n          context_numBits++;\r\n        }\r\n        delete context_dictionaryToCreate[context_w];\r\n      } else {\r\n        value = context_dictionary[context_w];\r\n        for (i = 0; i < context_numBits; i++) {\r\n          context_data_val = (context_data_val<<1) | (value & 1);\r\n          if (context_data_position === bitsPerChar - 1) {\r\n            context_data_position = 0;\r\n            context_data.push(getCharFromInt(context_data_val));\r\n            context_data_val = 0;\r\n          } else {\r\n            context_data_position++;\r\n          }\r\n          value = value>>1;\r\n        }\r\n\r\n\r\n      }\r\n      context_enlargeIn--;\r\n      if (context_enlargeIn === 0) {\r\n        context_enlargeIn = Math.pow(2, context_numBits);\r\n        context_numBits++;\r\n      }\r\n    }\r\n\r\n    // Mark the end of the stream\r\n    value = 2;\r\n    for (i = 0; i < context_numBits; i++) {\r\n      context_data_val = (context_data_val<<1) | (value & 1);\r\n      if (context_data_position === bitsPerChar - 1) {\r\n        context_data_position = 0;\r\n        context_data.push(getCharFromInt(context_data_val));\r\n        context_data_val = 0;\r\n      } else {\r\n        context_data_position++;\r\n      }\r\n      value = value>>1;\r\n    }\r\n\r\n    // Flush the last char\r\n    while (true) {\r\n      context_data_val = (context_data_val<<1);\r\n      if (context_data_position === bitsPerChar - 1) {\r\n        context_data.push(getCharFromInt(context_data_val));\r\n        break;\r\n      } else context_data_position++;\r\n    }\r\n    return context_data.join('');\r\n  },\r\n\r\n  decompress: function (compressed) {\r\n    if (compressed === null) return \"\";\r\n    if (compressed === \"\") return null;\r\n\r\n    compressed = getInput(compressed);\r\n\r\n    return this._decompress(compressed.length, 32768, function (index) {\r\n      return compressed.charCodeAt(index);\r\n    });\r\n  },\r\n\r\n  _decompress: function (length, resetValue, getNextValue) {\r\n    let dictionary = [], next, enlargeIn = 4, dictSize = 4, numBits = 3, entry = \"\", result = [], i, w,\r\n        bits, resb,\r\n        maxpower, power, c, data                                                            = {val: getNextValue(0), position: resetValue, index: 1};\r\n\r\n    for (i = 0; i < 3; i += 1) {\r\n      dictionary[i] = i;\r\n    }\r\n\r\n    bits = 0;\r\n    maxpower = Math.pow(2, 2);\r\n    power = 1;\r\n    while (power !== maxpower) {\r\n      resb = data.val & data.position;\r\n      data.position >>= 1;\r\n      if (data.position === 0) {\r\n        data.position = resetValue;\r\n        data.val = getNextValue(data.index++);\r\n      }\r\n      bits |= (resb > 0 ? 1 : 0)*power;\r\n      power <<= 1;\r\n    }\r\n\r\n    switch (next = bits) {\r\n      case 0:\r\n        bits = 0;\r\n        maxpower = Math.pow(2, 8);\r\n        power = 1;\r\n        while (power !== maxpower) {\r\n          resb = data.val & data.position;\r\n          data.position >>= 1;\r\n          if (data.position === 0) {\r\n            data.position = resetValue;\r\n            data.val = getNextValue(data.index++);\r\n          }\r\n          bits |= (resb > 0 ? 1 : 0)*power;\r\n          power <<= 1;\r\n        }\r\n        c = f(bits);\r\n        break;\r\n      case 1:\r\n        bits = 0;\r\n        maxpower = Math.pow(2, 16);\r\n        power = 1;\r\n        while (power !== maxpower) {\r\n          resb = data.val & data.position;\r\n          data.position >>= 1;\r\n          if (data.position === 0) {\r\n            data.position = resetValue;\r\n            data.val = getNextValue(data.index++);\r\n          }\r\n          bits |= (resb > 0 ? 1 : 0)*power;\r\n          power <<= 1;\r\n        }\r\n        c = f(bits);\r\n        break;\r\n      case 2:\r\n        return \"\";\r\n    }\r\n    dictionary[3] = c;\r\n    w = c;\r\n    result.push(c);\r\n    while (true) {\r\n      if (data.index > length) {\r\n        return \"\";\r\n      }\r\n\r\n      bits = 0;\r\n      maxpower = Math.pow(2, numBits);\r\n      power = 1;\r\n      while (power !== maxpower) {\r\n        resb = data.val & data.position;\r\n        data.position >>= 1;\r\n        if (data.position === 0) {\r\n          data.position = resetValue;\r\n          data.val = getNextValue(data.index++);\r\n        }\r\n        bits |= (resb > 0 ? 1 : 0)*power;\r\n        power <<= 1;\r\n      }\r\n\r\n      switch (c = bits) {\r\n        case 0:\r\n          bits = 0;\r\n          maxpower = Math.pow(2, 8);\r\n          power = 1;\r\n          while (power !== maxpower) {\r\n            resb = data.val & data.position;\r\n            data.position >>= 1;\r\n            if (data.position === 0) {\r\n              data.position = resetValue;\r\n              data.val = getNextValue(data.index++);\r\n            }\r\n            bits |= (resb > 0 ? 1 : 0)*power;\r\n            power <<= 1;\r\n          }\r\n\r\n          dictionary[dictSize++] = f(bits);\r\n          c = dictSize - 1;\r\n          enlargeIn--;\r\n          break;\r\n        case 1:\r\n          bits = 0;\r\n          maxpower = Math.pow(2, 16);\r\n          power = 1;\r\n          while (power !== maxpower) {\r\n            resb = data.val & data.position;\r\n            data.position >>= 1;\r\n            if (data.position === 0) {\r\n              data.position = resetValue;\r\n              data.val = getNextValue(data.index++);\r\n            }\r\n            bits |= (resb > 0 ? 1 : 0)*power;\r\n            power <<= 1;\r\n          }\r\n          dictionary[dictSize++] = f(bits);\r\n          c = dictSize - 1;\r\n          enlargeIn--;\r\n          break;\r\n        case 2:\r\n          return result.join('');\r\n      }\r\n\r\n      if (enlargeIn === 0) {\r\n        enlargeIn = Math.pow(2, numBits);\r\n        numBits++;\r\n      }\r\n\r\n      if (dictionary[c]) {\r\n        entry = dictionary[c];\r\n      } else {\r\n        if (c === dictSize) {\r\n          entry = w + w.charAt(0);\r\n        } else {\r\n          return null;\r\n        }\r\n      }\r\n      result.push(entry);\r\n\r\n      // Add w+entry[0] to the dictionary.\r\n      dictionary[dictSize++] = w + entry.charAt(0);\r\n      enlargeIn--;\r\n\r\n      w = entry;\r\n\r\n      if (enlargeIn === 0) {\r\n        enlargeIn = Math.pow(2, numBits);\r\n        numBits++;\r\n      }\r\n\r\n    }\r\n  }\r\n};\r\n","import './polyfill.js';\r\nimport './struct.js';\r\nimport './mobile-detect.js';\r\nimport nstructjs from './struct.js';\r\n\r\nlet f64tmp = new Float64Array(1);\r\nlet u16tmp = new Uint16Array(f64tmp.buffer);\r\n\r\nexport function isDenormal(f) {\r\n  f64tmp[0] = f;\r\n\r\n  let a = u16tmp[0], b = u16tmp[1], c = u16tmp[2], d = u16tmp[3];\r\n\r\n  //zero? check both positive and negative zero\r\n  if (a === 0 && b === 0 && c === 0 && (d === 0 || d === 32768)) {\r\n    return false;\r\n  }\r\n\r\n  let test = d & ~(1<<15);\r\n  test = test>>4;\r\n\r\n  //window.console.log(u16tmp[0], u16tmp[1], u16tmp[2], u16tmp[3], \"|\", test);\r\n\r\n  return test === 0;\r\n}\r\n\r\nglobalThis._isDenormal = isDenormal;\r\n\r\n\r\nlet colormap = {\r\n  \"black\"   : 30,\r\n  \"red\"     : 31,\r\n  \"green\"   : 32,\r\n  \"yellow\"  : 33,\r\n  \"blue\"    : 34,\r\n  \"magenta\" : 35,\r\n  \"cyan\"    : 36,\r\n  \"teal\"    : 36,\r\n  \"white\"   : 37,\r\n  \"reset\"   : 0,\r\n  \"grey\"    : 2,\r\n  \"gray\"    : 2,\r\n  \"orange\"  : 202,\r\n  \"pink\"    : 198,\r\n  \"brown\"   : 314,\r\n  \"lightred\": 91,\r\n  \"peach\"   : 210\r\n}\r\n\r\nexport let termColorMap = {};\r\nfor (let k in colormap) {\r\n  termColorMap[k] = colormap[k];\r\n  termColorMap[colormap[k]] = k;\r\n}\r\n\r\nexport function termColor(s, c, d = 0) {\r\n  if (typeof s === \"symbol\") {\r\n    s = s.toString();\r\n  } else {\r\n    s = \"\" + s;\r\n  }\r\n\r\n  if (c in colormap)\r\n    c = colormap[c]\r\n\r\n  if (c > 107) {\r\n    let s2 = '\\u001b[38;5;' + c + \"m\"\r\n    return s2 + s + '\\u001b[39m'\r\n  }\r\n\r\n  return '\\u001b[' + c + 'm' + s + '\\u001b[39m';\r\n};\r\n\r\nexport function termPrint() {\r\n  //let console = window.console;\r\n\r\n  let s = '';\r\n  for (let i = 0; i < arguments.length; i++) {\r\n    if (i > 0) {\r\n      s += ' ';\r\n    }\r\n    s += arguments[i];\r\n  }\r\n\r\n  let re1a = /\\u001b\\[[1-9][0-9]?m/;\r\n  let re1b = /\\u001b\\[[1-9][0-9];[0-9][0-9]?;[0-9]+m/\r\n  let re2 = /\\u001b\\[39m/;\r\n\r\n  let endtag = '\\u001b[39m';\r\n\r\n  function tok(s, type) {\r\n    return {\r\n      type : type,\r\n      value: s\r\n    }\r\n  }\r\n\r\n  let tokdef = [\r\n    [re1a, \"start\"],\r\n    [re1b, \"start\"],\r\n    [re2, \"end\"]\r\n  ];\r\n\r\n  let s2 = s;\r\n\r\n  let i = 0;\r\n  let tokens = [];\r\n\r\n  while (s2.length > 0) {\r\n    let ok = false;\r\n\r\n    let mintk = undefined, mini = undefined;\r\n    let minslice = undefined, mintype = undefined;\r\n\r\n    for (let tk of tokdef) {\r\n      let i = s2.search(tk[0]);\r\n\r\n      if (i >= 0 && (mini === undefined || i < mini)) {\r\n        minslice = s2.slice(i, s2.length).match(tk[0])[0];\r\n        mini = i;\r\n        mintype = tk[1];\r\n        mintk = tk;\r\n        ok = true;\r\n      }\r\n    }\r\n\r\n    if (!ok) {\r\n      break;\r\n    }\r\n\r\n    if (mini > 0) {\r\n      let chunk = s2.slice(0, mini);\r\n      tokens.push(tok(chunk, \"chunk\"));\r\n    }\r\n\r\n    s2 = s2.slice(mini + minslice.length, s2.length);\r\n    let t = tok(minslice, mintype);\r\n\r\n    tokens.push(t);\r\n  }\r\n\r\n  if (s2.length > 0) {\r\n    tokens.push(tok(s2, \"chunk\"));\r\n  }\r\n\r\n  let stack = [];\r\n  let cur;\r\n\r\n  let out = '';\r\n\r\n  for (let t of tokens) {\r\n    if (t.type === \"chunk\") {\r\n      out += t.value;\r\n    } else if (t.type === \"start\") {\r\n      stack.push(cur);\r\n      cur = t.value;\r\n\r\n      out += t.value;\r\n    } else if (t.type === \"end\") {\r\n      cur = stack.pop();\r\n      if (cur) {\r\n        out += cur;\r\n      } else {\r\n        out += endtag;\r\n      }\r\n    }\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\nglobalThis.termColor = termColor;\r\n\r\nexport class MovingAvg extends Array {\r\n  constructor(size = 64) {\r\n    super();\r\n\r\n    this.length = size;\r\n    this.cur = 0;\r\n    this.used = 0;\r\n    this.sum = 0;\r\n  }\r\n\r\n  reset() {\r\n    this.cur = this.used = this.sum = 0.0;\r\n\r\n    return this;\r\n  }\r\n\r\n  add(val) {\r\n    if (this.used < this.length) {\r\n      this[this.cur] = val;\r\n      this.used++;\r\n    } else {\r\n      this.sum -= this[this.cur];\r\n      this[this.cur] = val;\r\n    }\r\n\r\n    this.sum += val;\r\n    this.cur = (this.cur + 1)%this.length;\r\n\r\n    return this.sample();\r\n  }\r\n\r\n  sample() {\r\n    return this.used ? this.sum/this.used : 0.0;\r\n  }\r\n}\r\n\r\nexport let timers = {};\r\n\r\nexport function pollTimer(id, interval) {\r\n  if (!(id in timers)) {\r\n    timers[id] = time_ms();\r\n  }\r\n\r\n  if (time_ms() - timers[id] >= interval) {\r\n    timers[id] = time_ms();\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nlet mdetect = undefined;\r\nlet mret = undefined;\r\n\r\nexport function isMobile() {\r\n  if (!window.MobileDetect) {\r\n    return;\r\n  }\r\n\r\n  if (mret === undefined) {\r\n    mdetect = new MobileDetect(navigator.userAgent);\r\n    let ret = mdetect.mobile();\r\n\r\n    if (typeof ret === \"string\") {\r\n      ret = ret.toLowerCase();\r\n    }\r\n\r\n    mret = ret;\r\n  }\r\n\r\n  return mret;\r\n}\r\n\r\nexport class SmartConsoleContext {\r\n  constructor(name, console) {\r\n    this.name = name;\r\n\r\n    let c = [random(), random(), random()];\r\n    let sum = Math.sqrt(c[0]*c[0] + c[1]*c[1] + c[2]*c[2]);\r\n    sum = 255/sum;\r\n\r\n    let r = ~~(c[0]*sum);\r\n    let g = ~~(c[1]*sum);\r\n    let b = ~~(c[2]*sum);\r\n\r\n    this.color = `rgb(${r},${g},${b})`;\r\n    this.__console = console;\r\n\r\n    //minimum time between prints of same message\r\n    this.timeInterval = 375;\r\n\r\n    //minimum time in general\r\n    this.timeIntervalAll = 245;\r\n\r\n    this._last = 0;\r\n    this.last = 0;\r\n    this.last2 = 0;\r\n    this._data = {};\r\n    this._data_length = 0;\r\n    this.maxCache = 256;\r\n  }\r\n\r\n\r\n  hash(args) {\r\n    let sum = 0;\r\n    let mul = (1<<19) - 1, off = (1<<27) - 1;\r\n    let i = 0;\r\n\r\n    function dohash(h) {\r\n      h = (h*mul + off + i*mul*0.25) & mul;\r\n\r\n      i++;\r\n      sum = sum ^ h;\r\n    }\r\n\r\n    let visit = new WeakSet();\r\n\r\n    let recurse = (n) => {\r\n      if (typeof n === \"string\") {\r\n        dohash(strhash(n));\r\n      } else if (typeof n === \"undefined\" || n === null) {\r\n        dohash(0);\r\n      } else if (typeof n === \"object\") {\r\n        if (visit.has(n)) {\r\n          return;\r\n        }\r\n\r\n        visit.add(n);\r\n\r\n        let keys = getAllKeys(n);\r\n\r\n        for (let k of keys) {\r\n          let v;\r\n\r\n          if (typeof k !== \"string\") {\r\n            continue;\r\n          }\r\n\r\n          try {\r\n            v = n[k];\r\n          } catch (error) {\r\n            continue;\r\n          }\r\n\r\n          recurse(v);\r\n        }\r\n      } else if (typeof n === \"function\") {\r\n        dohash(strhash(\"\" + n.name));\r\n      }\r\n    };\r\n\r\n    //let str = \"\";\r\n\r\n    for (let i = 0; i < args.length; i++) {\r\n      recurse(args[i]);\r\n      //str += args[i] + \" \";\r\n    }\r\n\r\n    //window.console.log(\"HASH\", sum, str);\r\n    return sum;\r\n  }\r\n\r\n  clearCache() {\r\n    this._data_length = 0;\r\n    this._data = {};\r\n    return this;\r\n  }\r\n\r\n  _getData(args) {\r\n    let key = this.hash(args);\r\n\r\n    if (!(key in this._data)) {\r\n      if (this._data_length > this.maxCache) {\r\n        this.clearCache();\r\n      }\r\n\r\n      this._data[key] = {\r\n        time : 0,\r\n        count: 0\r\n      };\r\n\r\n      this._data_length++;\r\n    }\r\n\r\n    return this._data[key];\r\n  }\r\n\r\n  _check(args) {\r\n    if (this.timeIntervalAll > 0 && time_ms() - this.last2 < this.timeIntervalAll) {\r\n      return false;\r\n    }\r\n\r\n    this.last2 = time_ms();\r\n\r\n    return true;\r\n    /*\r\n    this.last2 = time_ms();\r\n\r\n    let d = this._getData(args);\r\n    let last = this.last;\r\n\r\n    this.last = d;\r\n\r\n    if (d !== last) {\r\n      d.count = 0;\r\n      d.time = time_ms();\r\n      return true;\r\n    }\r\n\r\n    if (time_ms() - d.time > this.timeInterval) {\r\n      d.time = time_ms();\r\n      return true;\r\n    }\r\n\r\n    return false;*/\r\n  }\r\n\r\n  log() {\r\n    if (this._check(arguments)) {\r\n      window.console.log(\"%c\", \"color:\" + this.color, ...arguments);\r\n    }\r\n  }\r\n\r\n  warn() {\r\n    if (this._check(arguments)) {\r\n      window.console.log(\"%c\" + this.name, \"color : \" + this.color, ...arguments);\r\n    }\r\n  }\r\n\r\n  trace() {\r\n    if (this._check(arguments)) {\r\n      window.console.trace(...arguments);\r\n    }\r\n  }\r\n\r\n  error() {\r\n    if (this._check(arguments)) {\r\n      window.console.error(...arguments);\r\n    }\r\n  }\r\n}\r\n\r\nexport class SmartConsole {\r\n  constructor() {\r\n    this.contexts = {};\r\n  }\r\n\r\n  context(name) {\r\n    if (!(name in this.contexts)) {\r\n      this.contexts[name] = new SmartConsoleContext(name, this);\r\n    }\r\n\r\n    return this.contexts[name];\r\n  }\r\n\r\n  log() {\r\n    let c = this.context(\"default\");\r\n    return c.log(...arguments);\r\n  }\r\n\r\n  warn() {\r\n    let c = this.context(\"default\");\r\n    return c.warn(...arguments);\r\n  }\r\n\r\n  trace() {\r\n    let c = this.context(\"default\");\r\n    return c.trace(...arguments);\r\n  }\r\n\r\n  error() {\r\n    let c = this.context(\"default\");\r\n    return c.error(...arguments);\r\n  }\r\n}\r\n\r\nexport const console = new SmartConsole();\r\n\r\nglobalThis.tm = 0.0;\r\n\r\nlet EmptySlot = {};\r\n\r\nexport function getClassParent(cls) {\r\n  let p = cls.prototype;\r\n\r\n  if (p) p = p.__proto__;\r\n  if (p) p = p.constructor\r\n  ;\r\n  return p;\r\n}\r\n\r\n//make global for debugging purposes in console\r\n//window._getClassParent = getClassParent;\r\n\r\nexport function list(iterable) {\r\n  let ret = [];\r\n\r\n  for (let item of iterable) {\r\n    ret.push(item);\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n\r\n/** Count items in list; if searchItem is not undefined then a count\r\n *  of the number of times searchItem occurs will be returned.*/\r\nexport function count(iterable, searchItem=undefined) {\r\n  let count = 0;\r\n\r\n  if (searchItem !== undefined) {\r\n    for (let item of iterable) {\r\n      if (item === searchItem) {\r\n        count++;\r\n      }\r\n    }\r\n  } else {\r\n    for (let item of iterable) {\r\n      count++;\r\n    }\r\n  }\r\n\r\n  return count;\r\n}\r\n\r\n/*\r\n* returns all object keys, including\r\n* inherited ones\r\n* */\r\nexport function getAllKeys(obj) {\r\n  let keys = new Set();\r\n\r\n  if (typeof obj !== \"object\" && typeof obj !== \"function\") {\r\n    throw new Error(\"must pass an object ot getAllKeys; object was: \" + obj);\r\n  }\r\n\r\n  let p;\r\n\r\n  while (p && p !== Object) {\r\n    for (let k in Object.getOwnPropertyDescriptors(obj)) {\r\n      if (k === \"__proto__\")\r\n        continue;\r\n\r\n      keys.add(k);\r\n    }\r\n\r\n    for (let k of Object.getOwnPropertySymbols(obj)) {\r\n      keys.add(k);\r\n    }\r\n\r\n    p = p.__proto__;\r\n  }\r\n\r\n  let cls = obj.constructor;\r\n  if (!cls)\r\n    return keys;\r\n\r\n  while (cls) {\r\n    let proto = cls.prototype;\r\n    if (!proto) {\r\n      cls = getClassParent(cls);\r\n      continue;\r\n    }\r\n\r\n    for (let k in proto) {\r\n      keys.add(k);\r\n    }\r\n\r\n    for (let k in Object.getOwnPropertyDescriptors(proto)) {\r\n      keys.add(k);\r\n    }\r\n\r\n    cls = getClassParent(cls);\r\n  }\r\n\r\n  return keys;\r\n}\r\n\r\n//globalThis._getAllKeys = getAllKeys;\r\n\r\nexport function btoa(buf) {\r\n  if (buf instanceof ArrayBuffer) {\r\n    buf = new Uint8Array(buf);\r\n  }\r\n\r\n  if (typeof buf === \"string\" || buf instanceof String) {\r\n    return window.btoa(buf);\r\n  }\r\n\r\n  let ret = \"\";\r\n  for (let i = 0; i < buf.length; i++) {\r\n    ret += String.fromCharCode(buf[i]);\r\n  }\r\n\r\n  return btoa(ret);\r\n};\r\n\r\nexport function formatNumberUI(val, isInt = false, decimals = 5) {\r\n  if (val === undefined || val === null) {\r\n    val = \"0\";\r\n  } else if (isNaN(val)) {\r\n    val = \"NaN\";\r\n  } else if (val === -Infinity) {\r\n    val = \"-\" + String.fromCharCode(0x221E);\r\n  } else if (val === Infinity) {\r\n    val = \"+\" + String.fromCharCode(0x221E);\r\n  } else if (!isInt) {\r\n    val = val.toFixed(decimals);\r\n  } else {\r\n    val = \"\" + Math.floor(val);\r\n  }\r\n\r\n  return val;\r\n}\r\n\r\n//window.formatNumberUI = formatNumberUI;\r\n\r\nexport function atob(buf) {\r\n  let data = window.atob(buf);\r\n  let ret = [];\r\n\r\n  for (let i = 0; i < data.length; i++) {\r\n    ret.push(data.charCodeAt(i));\r\n  }\r\n\r\n  return new Uint8Array(ret);\r\n}\r\n\r\nexport function time_ms() {\r\n  if (window.performance)\r\n    return window.performance.now();\r\n  else\r\n    return new Date().getMilliseconds();\r\n}\r\n\r\nexport function color2css(c) {\r\n  let ret = c.length === 3 ? \"rgb(\" : \"rgba(\";\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    if (i > 0)\r\n      ret += \",\";\r\n\r\n    ret += ~~(c[i]*255);\r\n  }\r\n\r\n  if (c.length === 4)\r\n    ret += \",\" + c[3];\r\n  ret += \")\";\r\n\r\n  return ret;\r\n}\r\n\r\nexport function merge(obja, objb) {\r\n  return Object.assign({}, obja, objb);\r\n  /*\r\n  let ret = {};\r\n\r\n  for (let k in obja) {\r\n    ret[k] = obja[k];\r\n  }\r\n\r\n  for (let k in objb) {\r\n    ret[k] = objb[k];\r\n  }\r\n\r\n  return ret;\r\n  //*/\r\n};\r\n\r\nconst debug_cacherings = false;\r\n\r\nif (debug_cacherings) {\r\n  window._cacherings = [];\r\n\r\n  window._clear_all_cacherings = function (kill_all = false) {\r\n    function copy(obj) {\r\n      if (typeof obj.copy === \"function\") {\r\n        return obj.copy();\r\n      } else if (obj.constructor === Object) {\r\n        let ret = {};\r\n\r\n        for (let k of Reflect.ownKeys(obj)) {\r\n          let v;\r\n\r\n          try {\r\n            v = obj[k];\r\n          } catch (error) {\r\n            continue;\r\n          }\r\n\r\n          if (typeof v !== \"object\") {\r\n            ret[k] = v;\r\n          } else {\r\n            ret[k] = copy(v);\r\n          }\r\n        }\r\n\r\n        return ret;\r\n      } else {\r\n        return new obj.constructor();\r\n      }\r\n    }\r\n\r\n    for (let ch of window._cacherings) {\r\n      let obj = ch[0];\r\n      let len = ch.length;\r\n\r\n      ch.length = 0;\r\n      ch.cur = 0;\r\n\r\n      if (kill_all) {\r\n        continue;\r\n      }\r\n\r\n      for (let i = 0; i < len; i++) {\r\n        ch.push(copy(obj));\r\n      }\r\n    }\r\n  }\r\n\r\n  window._nonvector_cacherings = function () {\r\n    for (let ch of window._cacherings) {\r\n      if (ch.length === 0) {\r\n        continue;\r\n      }\r\n\r\n      let name = ch[0].constructor.name;\r\n      let ok = !name.startsWith(\"Vector\") && !name.startsWith(\"Quat\");\r\n      ok = ok && !name.startsWith(\"TriEditor\");\r\n      ok = ok && !name.startsWith(\"QuadEditor\");\r\n      ok = ok && !name.startsWith(\"PointEditor\");\r\n      ok = ok && !name.startsWith(\"LineEditor\");\r\n\r\n      if (ok) {\r\n        console.log(name, ch);\r\n      }\r\n    }\r\n  }\r\n\r\n  window._stale_cacherings = function () {\r\n    let ret = _cacherings.concat([]);\r\n\r\n    ret.sort((a, b) => a.gen - b.gen);\r\n    return ret;\r\n  }\r\n}\r\n\r\nexport class cachering extends Array {\r\n  constructor(func, size, isprivate = false) {\r\n    super()\r\n\r\n    this.private = isprivate;\r\n    this.cur = 0;\r\n\r\n    if (!isprivate && debug_cacherings) {\r\n      this.gen = 0;\r\n      window._cacherings.push(this);\r\n    }\r\n\r\n    for (let i = 0; i < size; i++) {\r\n      this.push(func());\r\n    }\r\n  }\r\n\r\n  static fromConstructor(cls, size, isprivate = false) {\r\n    let func = function () {\r\n      return new cls();\r\n    }\r\n\r\n    return new cachering(func, size, isprivate);\r\n  }\r\n\r\n  next() {\r\n    if (debug_cacherings) {\r\n      this.gen++;\r\n    }\r\n\r\n    let ret = this[this.cur];\r\n    this.cur = (this.cur + 1)%this.length;\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nexport class SetIter {\r\n  constructor(set) {\r\n    this.set = set;\r\n    this.i = 0;\r\n    this.ret = {done: false, value: undefined};\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return this;\r\n  }\r\n\r\n  next() {\r\n    let ret = this.ret;\r\n\r\n    while (this.i < this.set.items.length && this.set.items[this.i] === EmptySlot) {\r\n      this.i++;\r\n    }\r\n\r\n    if (this.i >= this.set.items.length) {\r\n      ret.done = true;\r\n      ret.value = undefined;\r\n\r\n      return ret;\r\n    }\r\n\r\n\r\n    ret.value = this.set.items[this.i++];\r\n    return ret;\r\n  }\r\n}\r\n\r\n/**\r\n Set\r\n\r\n Stores objects in a set; each object is converted to a value via\r\n a [Symbol.keystr] method, and if that value already exists in the set\r\n then the object is not added.\r\n\r\n\r\n * */\r\nexport class set {\r\n  constructor(input) {\r\n    this.items = [];\r\n    this.keys = {};\r\n    this.freelist = [];\r\n\r\n    this.length = 0;\r\n\r\n    if (typeof input === \"string\") {\r\n      input = new String(input);\r\n    }\r\n\r\n    if (input !== undefined) {\r\n      if (Symbol.iterator in input) {\r\n        for (let item of input) {\r\n          this.add(item);\r\n        }\r\n      } else if (\"forEach\" in input) {\r\n        input.forEach(function (item) {\r\n          this.add(item);\r\n        }, this);\r\n      } else if (input instanceof Array) {\r\n        for (let i = 0; i < input.length; i++) {\r\n          this.add(input[i]);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  get size() {\r\n    return this.length;\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return new SetIter(this);\r\n  }\r\n\r\n  equals(setb) {\r\n    for (let item of this) {\r\n      if (!setb.has(item)) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    for (let item of setb) {\r\n      if (!this.has(item)) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  clear() {\r\n    this.items.length = 0;\r\n    this.keys = {};\r\n    this.freelist.length = 0;\r\n    this.length = 0;\r\n\r\n    return this;\r\n  }\r\n\r\n  filter(f, thisvar) {\r\n    let i = 0;\r\n    let ret = new set();\r\n\r\n    for (let item of this) {\r\n      if (f.call(thisvar, item, i++, this)) {\r\n        ret.add(item);\r\n      }\r\n    }\r\n\r\n    return ret;\r\n\r\n  }\r\n\r\n  map(f, thisvar) {\r\n    let ret = new set();\r\n\r\n    let i = 0;\r\n\r\n    for (let item of this) {\r\n      ret.add(f.call(thisvar, item, i++, this));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  reduce(f, initial) {\r\n    if (initial === undefined) {\r\n      for (let item of this) {\r\n        initial = item;\r\n        break;\r\n      }\r\n    }\r\n\r\n    let i = 0;\r\n    for (let item of this) {\r\n      initial = f(initial, item, i++, this);\r\n    }\r\n\r\n    return initial;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new set();\r\n    for (let item of this) {\r\n      ret.add(item);\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  add(item) {\r\n    let key = item[Symbol.keystr]();\r\n\r\n    if (key in this.keys) return;\r\n\r\n    if (this.freelist.length > 0) {\r\n      let i = this.freelist.pop();\r\n\r\n      this.keys[key] = i;\r\n      this.items[i] = item;\r\n    } else {\r\n      let i = this.items.length;\r\n\r\n      this.keys[key] = i;\r\n      this.items.push(item);\r\n    }\r\n\r\n    this.length++;\r\n  }\r\n\r\n  delete(item, ignore_existence = true) {\r\n    this.remove(item, ignore_existence);\r\n  }\r\n\r\n  remove(item, ignore_existence) {\r\n    let key = item[Symbol.keystr]();\r\n\r\n    if (!(key in this.keys)) {\r\n      if (!ignore_existence) {\r\n        console.warn(\"Warning, item\", item, \"is not in set\");\r\n      }\r\n      return;\r\n    }\r\n\r\n    let i = this.keys[key];\r\n    this.freelist.push(i);\r\n    this.items[i] = EmptySlot;\r\n\r\n    delete this.keys[key];\r\n\r\n    this.length--;\r\n  }\r\n\r\n  has(item) {\r\n    return item[Symbol.keystr]() in this.keys;\r\n  }\r\n\r\n  forEach(func, thisvar) {\r\n    for (let i = 0; i < this.items.length; i++) {\r\n      let item = this.items[i];\r\n\r\n      if (item === EmptySlot)\r\n        continue;\r\n\r\n      thisvar !== undefined ? func.call(thisvar, item) : func(item);\r\n    }\r\n  }\r\n}\r\n\r\nexport class HashIter {\r\n  constructor(hash) {\r\n    this.hash = hash;\r\n    this.i = 0;\r\n    this.ret = {done: false, value: undefined};\r\n  }\r\n\r\n  next() {\r\n    let items = this.hash._items;\r\n\r\n    if (this.i >= items.length) {\r\n      this.ret.done = true;\r\n      this.ret.value = undefined;\r\n\r\n      return this.ret;\r\n    }\r\n\r\n    do {\r\n      this.i += 2;\r\n    } while (this.i < items.length && items[i] === _hash_null);\r\n\r\n    return this.ret;\r\n  }\r\n}\r\n\r\nlet _hash_null = {};\r\n\r\nexport class hashtable {\r\n  constructor() {\r\n    this._items = [];\r\n    this._keys = {};\r\n    this.length = 0;\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return new HashIter(this);\r\n  }\r\n\r\n  set(key, val) {\r\n    let key2 = key[Symbol.keystr]();\r\n\r\n    let i;\r\n    if (!(key2 in this._keys)) {\r\n      i = this._items.length;\r\n\r\n      try {\r\n        this._items.push(0);\r\n        this._items.push(0);\r\n      } catch (error) {\r\n        console.log(\":::\", this._items.length, key, key2, val)\r\n        throw error;\r\n      }\r\n\r\n      this._keys[key2] = i;\r\n      this.length++;\r\n    } else {\r\n      i = this._keys[key2];\r\n    }\r\n\r\n    this._items[i] = key;\r\n    this._items[i + 1] = val;\r\n  }\r\n\r\n  remove(key) {\r\n    let key2 = key[Symbol.keystr]();\r\n\r\n    if (!(key2 in this._keys)) {\r\n      console.warn(\"Warning, key not in hashtable:\", key, key2);\r\n      return;\r\n    }\r\n\r\n    let i = this._keys[key2];\r\n\r\n    this._items[i] = _hash_null;\r\n    this._items[i + 1] = _hash_null;\r\n\r\n    delete this._keys[key2];\r\n    this.length--;\r\n  }\r\n\r\n  has(key) {\r\n    let key2 = key[Symbol.keystr]();\r\n\r\n    return key2 in this._keys;\r\n  }\r\n\r\n  get(key) {\r\n    let key2 = key[Symbol.keystr]();\r\n\r\n    if (!(key2 in this._keys)) {\r\n      console.warn(\"Warning, item not in hash\", key, key2);\r\n      return undefined;\r\n    }\r\n\r\n    return this._items[this._keys[key2] + 1];\r\n  }\r\n\r\n  add(key, val) {\r\n    return this.set(key, val);\r\n  }\r\n\r\n  keys() {\r\n    let ret = [];\r\n\r\n    for (let i = 0; i < this._items.length; i += 2) {\r\n      let key = this._items[i];\r\n\r\n      if (key !== _hash_null) {\r\n        ret.push(key);\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  values() {\r\n    let ret = [];\r\n\r\n    for (let i = 0; i < this._items.length; i += 2) {\r\n      let item = this._items[i + 1];\r\n\r\n      if (item !== _hash_null) {\r\n        ret.push(item);\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  forEach(cb, thisvar) {\r\n    if (thisvar === undefined)\r\n      thisvar = self;\r\n\r\n    for (let k in this._keys) {\r\n      let i = this._keys[k];\r\n\r\n      cb.call(thisvar, k, this._items[i]);\r\n    }\r\n  }\r\n}\r\n\r\nlet IDGenInternalIDGen = 0;\r\n\r\nexport class IDGen {\r\n  constructor() {\r\n    this.__cur = 1;\r\n\r\n    this._debug = false;\r\n    this._internalID = IDGenInternalIDGen++;\r\n  }\r\n\r\n  /*\r\n  get _cur() {\r\n    return this.__cur;\r\n  }\r\n\r\n  set _cur(v) {\r\n    if (this._debug && pollTimer(\"_idgen_debug\", 450)) {\r\n      window.console.warn(\"_cur access\", v);\r\n    }\r\n\r\n    this.__cur = v;\r\n  }\r\n\r\n  // */\r\n\r\n  get cur() {\r\n    return this.__cur;\r\n  }\r\n\r\n  set cur(v) {\r\n    if (isNaN(v) || !isFinite(v)) {\r\n      throw new Error(\"NaN error in util.IDGen\");\r\n    }\r\n\r\n    this.__cur = v;\r\n  }\r\n\r\n  get _cur() {\r\n    return this.cur;\r\n  }\r\n\r\n  set _cur(v) {\r\n    window.console.warn(\"Deprecated use of IDGen._cur\");\r\n    this.cur = v;\r\n  }\r\n\r\n  static fromJSON(obj) {\r\n    let ret = new IDGen();\r\n\r\n    ret.cur = obj.cur === undefined ? obj._cur : obj.cur;\r\n\r\n    return ret;\r\n  }\r\n\r\n  next() {\r\n    return this.cur++;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new IDGen();\r\n    ret.cur = this.cur;\r\n\r\n    return ret;\r\n  }\r\n\r\n  max_cur(id) {\r\n    this.cur = Math.max(this.cur, id + 1);\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      cur: this.cur\r\n    };\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n  }\r\n}\r\n\r\nIDGen.STRUCT = `\r\nIDGen {\r\n  cur : int;\r\n}\r\n`;\r\nnstructjs.register(IDGen);\r\n\r\n\r\nfunction get_callstack(err) {\r\n  return (\"\"+err.stack).split(\"\\n\");\r\n}\r\n\r\nexport function print_stack(err) {\r\n  if (!err) {\r\n    window.console.trace();\r\n  } else {\r\n    window.console.log(err.stack);\r\n  }\r\n}\r\n\r\n\r\nglobalThis.get_callstack = get_callstack;\r\nglobalThis.print_stack = print_stack;\r\n\r\nexport function fetch_file(path) {\r\n  let url = location.origin + \"/\" + path\r\n\r\n  let req = new XMLHttpRequest(\r\n  );\r\n\r\n  return new Promise(function (accept, reject) {\r\n    req.open(\"GET\", url)\r\n    req.onreadystatechange = function (e) {\r\n      if (req.status === 200 && req.readyState === 4) {\r\n        accept(req.response);\r\n      } else if (req.status >= 400) {\r\n        reject(req.status, req.statusText);\r\n      }\r\n    }\r\n    req.send();\r\n  });\r\n}\r\n\r\n//from:https://en.wikipedia.org/wiki/Mersenne_Twister\r\nfunction _int32(x) {\r\n  // Get the 31 least significant bits.\r\n  return ~~(((1<<30) - 1) & (~~x))\r\n}\r\n\r\nexport class MersenneRandom {\r\n  constructor(seed) {\r\n    // Initialize the index to 0\r\n    this.index = 624;\r\n    this.mt = new Uint32Array(624);\r\n\r\n    this.seed(seed);\r\n  }\r\n\r\n  random() {\r\n    return this.extract_number()/(1<<30);\r\n  }\r\n\r\n  /** normal-ish distribution */\r\n  nrandom(n=3) {\r\n    let ret = 0.0;\r\n\r\n    for (let i=0; i<n; i++) {\r\n      ret += this.random();\r\n    }\r\n\r\n    return ret / n;\r\n  }\r\n\r\n  seed(seed) {\r\n    seed = ~~(seed*8192);\r\n\r\n    // Initialize the index to 0\r\n    this.index = 624;\r\n    this.mt.fill(0, 0, this.mt.length);\r\n\r\n    this.mt[0] = seed;  // Initialize the initial state to the seed\r\n\r\n    for (let i = 1; i < 624; i++) {\r\n      this.mt[i] = _int32(\r\n        1812433253*(this.mt[i - 1] ^ this.mt[i - 1]>>30) + i);\r\n    }\r\n  }\r\n\r\n  extract_number() {\r\n    if (this.index >= 624)\r\n      this.twist();\r\n\r\n    let y = this.mt[this.index];\r\n\r\n    // Right shift by 11 bits\r\n    y = y ^ y>>11;\r\n    // Shift y left by 7 and take the bitwise and of 2636928640\r\n    y = y ^ y<<7 & 2636928640;\r\n    // Shift y left by 15 and take the bitwise and of y and 4022730752\r\n    y = y ^ y<<15 & 4022730752;\r\n    // Right shift by 18 bits\r\n    y = y ^ y>>18;\r\n\r\n    this.index = this.index + 1;\r\n\r\n    return _int32(y);\r\n  }\r\n\r\n  twist() {\r\n    for (let i = 0; i < 624; i++) {\r\n      // Get the most significant bit and add it to the less significant\r\n      // bits of the next number\r\n      let y = _int32((this.mt[i] & 0x80000000) +\r\n        (this.mt[(i + 1)%624] & 0x7fffffff));\r\n      this.mt[i] = this.mt[(i + 397)%624] ^ y>>1;\r\n\r\n      if (y%2 !== 0)\r\n        this.mt[i] = this.mt[i] ^ 0x9908b0df;\r\n    }\r\n\r\n    this.index = 0;\r\n  }\r\n}\r\n\r\nlet _mt = new MersenneRandom(0);\r\n\r\nexport function random() {\r\n  return _mt.extract_number()/(1<<30);\r\n}\r\n\r\nexport function seed(n) {\r\n//  console.trace(\"seed called\");\r\n  _mt.seed(n);\r\n}\r\n\r\nlet smallstr_hashes = {};\r\n\r\n\r\nconst MAXINT = Math.pow(2, 31) - 1;\r\n\r\nexport function strhash(str) {\r\n  if (str.length <= 64) {\r\n    let hash = smallstr_hashes[str];\r\n\r\n    if (hash !== undefined) {\r\n      return hash;\r\n    }\r\n  }\r\n\r\n  let hash = 0;\r\n\r\n  for (let i = 0; i < str.length; i++) {\r\n    let ch = str.charCodeAt(i);\r\n\r\n    hash = hash < 0 ? -hash : hash;\r\n\r\n    hash ^= (ch*1103515245 + 12345) & MAXINT;\r\n  }\r\n\r\n  if (str.length <= 64) {\r\n    smallstr_hashes[str] = hash;\r\n  }\r\n\r\n  return hash;\r\n}\r\n\r\nlet hashsizes = [\r\n  /*2, 5, 11, 19, 37, 67, 127, */223, 383, 653, 1117, 1901, 3251,\r\n                                 5527, 9397, 15991, 27191, 46229, 78593, 133631, 227177, 38619,\r\n                                 656587, 1116209, 1897561, 3225883, 5484019, 9322861, 15848867,\r\n                                 26943089, 45803279, 77865577, 132371489, 225031553\r\n];\r\n\r\nlet FTAKEN = 0, FKEY = 1, FVAL = 2, FTOT = 3;\r\n\r\nexport class FastHash extends Array {\r\n  constructor() {\r\n    super();\r\n\r\n    this.cursize = 0;\r\n    this.size = hashsizes[this.cursize];\r\n    this.used = 0;\r\n\r\n    this.length = this.size*FTOT;\r\n    this.fill(0, 0, this.length);\r\n  }\r\n\r\n  resize(size) {\r\n    let table = this.slice(0, this.length);\r\n\r\n    this.length = size*FTOT;\r\n    this.size = size;\r\n    this.fill(0, 0, this.length);\r\n\r\n    for (let i = 0; i < table.length; i += FTOT) {\r\n      if (!table[i + FTAKEN]) continue;\r\n\r\n      let key = table[i + FKEY], val = table[i + FVAL];\r\n      this.set(key, val);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  get(key) {\r\n    let hash = typeof key === \"string\" ? strhash(key) : key;\r\n    hash = typeof hash === \"object\" ? hash.valueOf() : hash;\r\n\r\n    let probe = 0;\r\n\r\n    let h = (hash + probe)%this.size;\r\n\r\n    let _i = 0;\r\n    while (_i++ < 50000 && this[h*FTOT + FTAKEN]) {\r\n      if (this[h*FTOT + FKEY] === key) {\r\n        return this[h*FTOT + FVAL];\r\n      }\r\n\r\n      probe = (probe + 1)*2;\r\n      h = (hash + probe)%this.size;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  has(key) {\r\n    let hash = typeof key === \"string\" ? strhash(key) : key;\r\n    hash = typeof hash === \"object\" ? hash.valueOf() : hash;\r\n\r\n    let probe = 0;\r\n\r\n    let h = (hash + probe)%this.size;\r\n\r\n    let _i = 0;\r\n    while (_i++ < 50000 && this[h*FTOT + FTAKEN]) {\r\n      if (this[h*FTOT + FKEY] === key) {\r\n        return true;\r\n      }\r\n\r\n      probe = (probe + 1)*2;\r\n      h = (hash + probe)%this.size;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  set(key, val) {\r\n    let hash = typeof key === \"string\" ? strhash(key) : key;\r\n    hash = typeof hash === \"object\" ? hash.valueOf() : hash;\r\n\r\n    if (this.used > this.size/3) {\r\n      this.resize(hashsizes[this.cursize++]);\r\n    }\r\n\r\n    let probe = 0;\r\n\r\n    let h = (hash + probe)%this.size;\r\n\r\n    let _i = 0;\r\n    while (_i++ < 50000 && this[h*FTOT + FTAKEN]) {\r\n      if (this[h*FTOT + FKEY] === key) {\r\n        this[h*FTOT + FVAL] = val;\r\n        return;\r\n      }\r\n\r\n      probe = (probe + 1)*2;\r\n      h = (hash + probe)%this.size;\r\n    }\r\n\r\n    this[h*FTOT + FTAKEN] = 1;\r\n    this[h*FTOT + FKEY] = key;\r\n    this[h*FTOT + FVAL] = val;\r\n\r\n    this.used++;\r\n  }\r\n}\r\n\r\nexport function test_fasthash() {\r\n  let h = new FastHash();\r\n  console.log(\"bleh hash:\", strhash(\"bleh\"));\r\n\r\n  h.set(\"bleh\", 1);\r\n  h.set(\"bleh\", 2);\r\n  h.set(\"bleh\", 3);\r\n\r\n  console.log(h);\r\n\r\n  return h;\r\n};\r\n\r\nexport class ImageReader {\r\n  load_image() {\r\n    let input = document.createElement(\"input\");\r\n    input.type = \"file\";\r\n\r\n    let doaccept;\r\n\r\n    let promise = new Promise((accept, reject) => {\r\n      doaccept = accept;\r\n    });\r\n\r\n    input.addEventListener(\"change\", function (e) {\r\n      let files = this.files;\r\n      console.log(\"got file\", e, files)\r\n\r\n      if (files.length === 0) return;\r\n\r\n      let reader = new FileReader();\r\n      let this2 = this;\r\n\r\n      reader.onload = (e) => {\r\n        let data = e.target.result;\r\n        let image = new Image();\r\n\r\n        image.src = data;\r\n        image.onload = (e) => {\r\n          console.log(\"got image\", image.width, image.height);\r\n\r\n          let canvas = document.createElement(\"canvas\");\r\n          let g = canvas.getContext(\"2d\");\r\n\r\n          canvas.width = image.width;\r\n          canvas.height = image.height;\r\n\r\n          g.drawImage(image, 0, 0);\r\n          let idata = g.getImageData(0, 0, image.width, image.height);\r\n\r\n          doaccept(idata);\r\n        }\r\n      };\r\n\r\n      reader.readAsDataURL(files[0]);\r\n    });\r\n\r\n    input.click();\r\n    return promise;\r\n  }\r\n\r\n  example() {\r\n    this.load_image().then((idata) => {\r\n      console.log(idata);\r\n    });\r\n  }\r\n};\r\n\r\nlet digestcache;\r\n\r\n/** NOT CRYPTOGRAPHIC */\r\nexport class HashDigest {\r\n  constructor() {\r\n    this.i = 0;\r\n    this.hash = 0;\r\n  }\r\n\r\n  static cachedDigest() {\r\n    return digestcache.next().reset();\r\n  }\r\n\r\n  reset() {\r\n    this.i = 0;\r\n    this.hash = 0;\r\n\r\n    return this;\r\n  }\r\n\r\n  get() {\r\n    return this.hash;\r\n  }\r\n\r\n  add(v) {\r\n    if (typeof v === \"string\") {\r\n      v = strhash(v);\r\n    }\r\n\r\n    if (typeof v === \"object\" && Array.isArray(v)) {\r\n      for (let i=0; i<v.length; i++) {\r\n        this.add(v[i]);\r\n      }\r\n\r\n      return this;\r\n    }\r\n\r\n    if (v >= -5 && v <= 5) {\r\n      v *= 32;\r\n    }\r\n\r\n    //try to deal with subdecimal floating point error\r\n\r\n    let f = Math.fract(v)*(1024*512);\r\n    f = (~~f)/(1024*512);\r\n    v = Math.floor(v) + f;\r\n\r\n    //glibc linear congruel generator\r\n    this.i = ((this.i + (~~v))*1103515245 + 12345) & ((1<<29) - 1);\r\n    //according to wikipedia only the top 16 bits are random\r\n    //this.i = this.i>>16;\r\n\r\n    let v2 = (v*1024*1024) & ((1<<29) - 1)\r\n    v = v | v2;\r\n\r\n    v = ~~v;\r\n\r\n    this.hash ^= v ^ this.i;\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nwindow._test_hash2 = () => {\r\n  let h = new HashDigest();\r\n\r\n  let tests = [\r\n    [0, 0, 0, 0],\r\n    [0, 0, 0],\r\n    [0, 0],\r\n    [0],\r\n    [1],\r\n    [2],\r\n    [3],\r\n    [strhash(\"yay\")],\r\n    [strhash(\"yay\"), strhash(\"yay\")],\r\n    [strhash(\"yay\"), strhash(\"yay\"), strhash(\"yay\")]\r\n  ]\r\n\r\n  for (let test of tests) {\r\n    let h = new HashDigest();\r\n    for (let f of test) {\r\n      h.add(f);\r\n    }\r\n\r\n    window.console.log(h.get());\r\n  }\r\n  for (let i = 0; i < 50; i++) {\r\n    h.add(0);\r\n    //window.console.log(h.i/((1<<30)-1), h.hash);\r\n  }\r\n}\r\n\r\ndigestcache = cachering.fromConstructor(HashDigest, 512);\r\n\r\n//globalThis._HashDigest = HashDigest;\r\n\r\nexport function hashjoin(hash, val) {\r\n  let sum = 0;\r\n  let mul = (1<<19) - 1, off = (1<<27) - 1;\r\n  let i = 0;\r\n\r\n  h = (h*mul + off + i*mul*0.25) & mul;\r\n}\r\n\r\nlet NullItem = {};\r\n\r\nexport class MapIter {\r\n  constructor(ownermap) {\r\n    this.ret = {done: true, value: undefined};\r\n    this.value = new Array(2);\r\n    this.i = 0;\r\n    this.map = ownermap;\r\n    this.done = true;\r\n  }\r\n\r\n  finish() {\r\n    if (!this.done) {\r\n      this.done = true;\r\n      this.map.itercur--;\r\n    }\r\n  }\r\n\r\n  next() {\r\n    let ret = this.ret;\r\n    let i = this.i;\r\n    let map = this.map, list = map._list;\r\n    //window.console.log(this)\r\n\r\n    while (i < list.length && list[i] === NullItem) {\r\n      i += 2;\r\n    }\r\n\r\n    //window.console.log(\"  --\", i, list[i], list[i+1]);\r\n\r\n    if (i >= list.length) {\r\n      ret.done = true;\r\n      ret.value = undefined;\r\n\r\n      this.finish();\r\n      return ret;\r\n    }\r\n\r\n    this.i = i + 2;\r\n\r\n    ret.value = this.value;\r\n    ret.value[0] = list[i];\r\n    ret.value[1] = list[i + 1];\r\n    ret.done = false;\r\n\r\n    return ret;\r\n  }\r\n\r\n  return() {\r\n    this.finish();\r\n\r\n    return this.ret;\r\n  }\r\n\r\n  reset() {\r\n    this.i = 0;\r\n    this.value[0] = undefined;\r\n    this.value[1] = undefined;\r\n    this.done = false;\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nexport class map {\r\n  constructor() {\r\n    this._items = {};\r\n    this._list = [];\r\n\r\n    this.size = 0;\r\n\r\n    this.iterstack = new Array(8);\r\n    this.itercur = 0;\r\n    for (let i = 0; i < this.iterstack.length; i++) {\r\n      this.iterstack[i] = new MapIter(this);\r\n    }\r\n\r\n    this.freelist = [];\r\n  }\r\n\r\n  has(key) {\r\n    return key[Symbol.keystr]() in this._items;\r\n  }\r\n\r\n  set(key, v) {\r\n    let k = key[Symbol.keystr]();\r\n\r\n    let i = this._items[k];\r\n\r\n    if (i === undefined) {\r\n      if (this.freelist.length > 0) {\r\n        i = this.freelist.pop();\r\n      } else {\r\n        i = this._list.length;\r\n        this._list.length += 2;\r\n      }\r\n\r\n      this.size++;\r\n    }\r\n\r\n    this._list[i] = key;\r\n    this._list[i + 1] = v;\r\n\r\n    this._items[k] = i;\r\n  }\r\n\r\n  keys() {\r\n    let this2 = this;\r\n    return (function* () {\r\n      for (let [key, val] of this2) {\r\n        yield key;\r\n      }\r\n    })()\r\n  }\r\n\r\n  values() {\r\n    let this2 = this;\r\n    return (function* () {\r\n      for (let [key, val] of this2) {\r\n        yield val;\r\n      }\r\n    })()\r\n  }\r\n\r\n  get(k) {\r\n    k = k[Symbol.keystr]();\r\n\r\n    let i = this._items[k];\r\n    if (i !== undefined) {\r\n      return this._list[i + 1];\r\n    }\r\n  }\r\n\r\n  delete(k) {\r\n    k = k[Symbol.keystr]();\r\n\r\n    if (!(k in this._items)) {\r\n      return false;\r\n    }\r\n\r\n    let i = this._items[k];\r\n\r\n    this.freelist.push(i);\r\n\r\n    this._list[i] = NullItem;\r\n    this._list[i + 1] = NullItem;\r\n\r\n    delete this._items[k];\r\n    this.size--;\r\n\r\n    return true;\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    let ret = this.iterstack[this.itercur].reset();\r\n    this.itercur++;\r\n\r\n    if (this.itercur === this.iterstack.length) {\r\n      this.iterstack.push(new MapIter(this));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n}\r\n\r\nglobalThis._test_map = function () {\r\n  let m = new map();\r\n\r\n  m.set(\"1\", 2);\r\n  m.set(11, 3);\r\n  m.set(\"5\", 4);\r\n  m.set(\"3\", 5);\r\n  m.set(\"3\", 6);\r\n  m.delete(\"3\");\r\n\r\n  for (let [key, item] of m) {\r\n    for (let [key2, item2] of m) {\r\n      window.console.log(key, item, key2, item2);\r\n    }\r\n    break;\r\n  }\r\n\r\n  console.log(\"itercur\", m.itercur);\r\n\r\n  return m;\r\n}\r\n\r\nfunction validateId(id) {\r\n  let bad = typeof id !== \"number\";\r\n  bad = bad || id !== ~~id;\r\n  bad = bad || isNaN(id);\r\n\r\n  if (bad) {\r\n    throw new Error(\"bad number \" + id);\r\n  }\r\n\r\n  return bad;\r\n}\r\n\r\nlet UndefinedTag = {};\r\n\r\nexport class IDMap extends Array {\r\n  constructor() {\r\n    super();\r\n\r\n    this._keys = new Set();\r\n    this.size = 0;\r\n  }\r\n\r\n  has(id) {\r\n    validateId(id);\r\n\r\n    if (id < 0 || id >= this.length) {\r\n      return false;\r\n    }\r\n\r\n    return this[id] !== undefined;\r\n  }\r\n\r\n  set(id, val) {\r\n    validateId(id);\r\n\r\n    if (id < 0) {\r\n      console.warn(\"got -1 id in IDMap\");\r\n      return;\r\n    }\r\n\r\n    if (id >= this.length) {\r\n      this.length = id + 1;\r\n    }\r\n\r\n    if (val === undefined) {\r\n      val = UndefinedTag;\r\n    }\r\n\r\n    let ret = false;\r\n\r\n    if (this[id] === undefined) {\r\n      this.size++;\r\n      this._keys.add(id);\r\n      ret = true;\r\n    }\r\n\r\n    this[id] = val;\r\n    return ret;\r\n  }\r\n\r\n  /* we allow -1, which always returns undefined*/\r\n  get(id) {\r\n    validateId(id);\r\n\r\n    if (id === -1) {\r\n      return undefined;\r\n    } else if (id < 0) {\r\n      console.warn(\"id was negative\");\r\n      return undefined;\r\n    }\r\n\r\n    let ret = id < this.length ? this[id] : undefined;\r\n    ret = ret === UndefinedTag ? undefined : ret;\r\n\r\n    return ret;\r\n  }\r\n\r\n  delete(id) {\r\n    if (!this.has(id)) {\r\n      return false;\r\n    }\r\n\r\n    this._keys.remove(id);\r\n    this[id] = undefined;\r\n    this.size--;\r\n\r\n    return true;\r\n  }\r\n\r\n  keys() {\r\n    let this2 = this;\r\n    return (function* () {\r\n      for (let id of this2._keys) {\r\n        yield id;\r\n      }\r\n    })();\r\n  }\r\n\r\n  values() {\r\n    let this2 = this;\r\n    return (function* () {\r\n      for (let id of this2._keys) {\r\n        yield this2[id];\r\n      }\r\n    })();\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    let this2 = this;\r\n    let iteritem = [0, 0];\r\n\r\n    return (function* () {\r\n      for (let id of this2._keys) {\r\n        iteritem[0] = id;\r\n        iteritem[1] = this2[id];\r\n\r\n        if (iteritem[1] === UndefinedTag) {\r\n          iteritem[1] = undefined;\r\n        }\r\n\r\n        yield iteritem;\r\n      }\r\n    })();\r\n  }\r\n}\r\n\r\nglobalThis._test_idmap = function () {\r\n  let map = new IDMap();\r\n\r\n  for (let i = 0; i < 5; i++) {\r\n    let id = ~~(Math.random()*55);\r\n\r\n    map.set(id, \"yay\" + i);\r\n  }\r\n\r\n  for (let [key, val] of map) {\r\n    window.console.log(key, val, map.has(key), map.get(key));\r\n  }\r\n\r\n  return map;\r\n}\r\n\r\nlet HW = 0, HELEM = 1, HTOT = 2;\r\n\r\nfunction heaplog() {\r\n  //window.console.log(...arguments);\r\n}\r\n\r\nexport class MinHeapQueue {\r\n  constructor(iter, iterw = iter) {\r\n    this.heap = [];\r\n    this.freelist = [];\r\n    this.length = 0;\r\n    this.end = 0;\r\n\r\n    if (iter) {\r\n      let witer = iterw[Symbol.iterator]();\r\n\r\n      for (let item of iter) {\r\n        let w = witer.next().value;\r\n        this.push(item, w);\r\n      }\r\n    }\r\n  }\r\n\r\n  push(e, w) {\r\n    if (typeof w !== \"number\") {\r\n      throw new Error(\"w must be a number\");\r\n    }\r\n\r\n    if (isNaN(w)) {\r\n      throw new Error(\"NaN\");\r\n    }\r\n\r\n    this.length++;\r\n    let depth = Math.ceil(Math.log(this.length)/Math.log(2.0));\r\n    let tot = Math.pow(2, depth) + 1;\r\n\r\n    heaplog(depth, tot);\r\n\r\n    if (this.heap.length < tot*HTOT) {\r\n      let start = this.heap.length/HTOT;\r\n\r\n      for (let i = start; i < tot; i++) {\r\n        this.freelist.push(i*HTOT);\r\n      }\r\n    }\r\n\r\n    let heap = this.heap;\r\n    heap.length = tot*HTOT;\r\n\r\n    let n = this.freelist.pop();\r\n\r\n    heaplog(\"freelist\", this.freelist);\r\n    this.end = Math.max(this.end, n);\r\n\r\n    heap[n] = w;\r\n    heap[n + 1] = e;\r\n\r\n    while (n > 0) {\r\n      n /= HTOT;\r\n\r\n      let p = (n - 1)>>1;\r\n      n *= HTOT;\r\n      p *= HTOT;\r\n\r\n      if (heap[p] === undefined || heap[p] > w) {\r\n        if (n === this.end) {\r\n          this.end = p;\r\n        }\r\n\r\n        heap[n] = heap[p];\r\n        heap[n + 1] = heap[p + 1];\r\n\r\n        heap[p] = w;\r\n        heap[p + 1] = e;\r\n\r\n        n = p;\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  pop() {\r\n    if (this.length === 0) {\r\n      return undefined;\r\n      //throw new Error(\"heap is empty\");\r\n    }\r\n\r\n    let heap = this.heap;\r\n\r\n    if (this.end === 0) {\r\n      let ret = heap[1];\r\n      this.freelist.push(0);\r\n      heap[0] = undefined;\r\n\r\n      this.length = 0;\r\n\r\n      return ret;\r\n    }\r\n\r\n    let ret = heap[1];\r\n\r\n    let end = this.end;\r\n\r\n    function swap(n1, n2) {\r\n      let t = heap[n1];\r\n      heap[n1] = heap[n2];\r\n      heap[n2] = t;\r\n\r\n      t = heap[n1 + 1];\r\n      heap[n1 + 1] = heap[n2 + 1];\r\n      heap[n2 + 1] = t;\r\n    }\r\n\r\n    heaplog(\"end\", end);\r\n    heaplog(heap.concat([]));\r\n\r\n    heap[0] = heap[end];\r\n    heap[1] = heap[end + 1];\r\n    heap[end] = undefined;\r\n    heap[end + 1] = undefined;\r\n\r\n    let n = 0;\r\n    while (n < heap.length) {\r\n      n /= HTOT;\r\n\r\n      let n1 = n*2 + 1;\r\n      let n2 = n*2 + 2;\r\n\r\n      n1 = ~~(n1*HTOT);\r\n      n2 = ~~(n2*HTOT);\r\n      n = ~~(n*HTOT);\r\n\r\n      heaplog(\"  \", heap[n], heap[n1], heap[n2]);\r\n\r\n      if (heap[n1] !== undefined && heap[n2] !== undefined) {\r\n        if (heap[n1] > heap[n2]) {\r\n          let t = n1;\r\n          n1 = n2;\r\n          n2 = t;\r\n        }\r\n\r\n        if (heap[n] > heap[n1]) {\r\n          swap(n, n1);\r\n          n = n1;\r\n        } else if (heap[n] > heap[n2]) {\r\n          swap(n, n2);\r\n          n = n2;\r\n        } else {\r\n          break;\r\n        }\r\n      } else if (heap[n1] !== undefined) {\r\n        if (heap[n] > heap[n1]) {\r\n          swap(n, n1);\r\n          n = n1;\r\n        } else {\r\n          break;\r\n        }\r\n      } else if (heap[n2] !== undefined) {\r\n        if (heap[n] > heap[n2]) {\r\n          swap(n, n2);\r\n          n = n2;\r\n        } else {\r\n          break;\r\n        }\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n\r\n    this.freelist.push(this.end);\r\n\r\n    heap[this.end] = undefined;\r\n    heap[this.end + 1] = undefined;\r\n\r\n    while (this.end > 0 && heap[this.end] === undefined) {\r\n      this.end -= HTOT;\r\n    }\r\n\r\n    this.length--;\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nglobalThis.testHeapQueue = function (list1 = [1, 8, -3, 11, 33]) {\r\n  let h = new MinHeapQueue(list1);\r\n\r\n  window.console.log(h.heap.concat([]));\r\n\r\n  let list = [];\r\n  let len = h.length;\r\n\r\n  for (let i = 0; i < len; i++) {\r\n    list.push(h.pop());\r\n  }\r\n\r\n  window.console.log(h.heap.concat([]));\r\n\r\n  return list;\r\n}\r\n\r\nexport class Queue {\r\n  constructor(n = 32) {\r\n    n = Math.max(n, 8);\r\n\r\n    this.initialSize = n;\r\n\r\n    this.queue = new Array(n);\r\n    this.a = 0;\r\n    this.b = 0;\r\n    this.length = 0;\r\n  }\r\n\r\n  enqueue(item) {\r\n    let qlen = this.queue.length;\r\n\r\n    let b = this.b;\r\n\r\n    this.queue[b] = item;\r\n    this.b = (this.b + 1)%qlen;\r\n\r\n    if (this.length >= qlen || this.a === this.b) {\r\n      let newsize = qlen<<1;\r\n      let queue = new Array(newsize);\r\n\r\n      for (let i = 0; i < qlen; i++) {\r\n        let i2 = (i + this.a)%qlen;\r\n\r\n        queue[i] = this.queue[i2];\r\n      }\r\n\r\n      this.a = 0;\r\n      this.b = qlen;\r\n      this.queue = queue;\r\n    }\r\n\r\n    this.length++;\r\n  }\r\n\r\n  clear(clearData = true) {\r\n    this.queue.length = this.initialSize;\r\n\r\n    if (clearData) {\r\n      for (let i = 0; i < this.queue.length; i++) {\r\n        this.queue[i] = undefined;\r\n      }\r\n    }\r\n\r\n    this.a = this.b = 0;\r\n    this.length = 0;\r\n\r\n    return this;\r\n  }\r\n\r\n  dequeue() {\r\n    if (this.length === 0) {\r\n      return undefined;\r\n    }\r\n    this.length--;\r\n\r\n    let ret = this.queue[this.a];\r\n\r\n    this.queue[this.a] = undefined;\r\n\r\n    this.a = (this.a + 1)%this.queue.length;\r\n    return ret;\r\n  }\r\n}\r\n\r\nglobalThis._testQueue = function (steps = 15, samples = 15) {\r\n  let queue = new Queue(3);\r\n\r\n  for (let i = 0; i < steps; i++) {\r\n    let list = [];\r\n\r\n    for (let j = 0; j < samples; j++) {\r\n      let item = {f: Math.random()};\r\n      list.push(item);\r\n\r\n      queue.enqueue(item);\r\n    }\r\n\r\n    let j = 0;\r\n\r\n    while (queue.length > 0) {\r\n      let item = queue.dequeue();\r\n\r\n      if (item !== list[j]) {\r\n        console.log(item, list);\r\n        throw new Error(\"got wrong item\", item);\r\n      }\r\n\r\n      j++;\r\n\r\n      if (j > 10000) {\r\n        console.error(\"Infinite loop error\");\r\n        break;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n\r\nexport class ArrayPool {\r\n  constructor() {\r\n    this.pools = new Map();\r\n    this.map = new Array(1024);\r\n  }\r\n\r\n  get(n, clear) {\r\n    let pool;\r\n\r\n    if (n < 1024) {\r\n      pool = this.map[n];\r\n    } else {\r\n      pool = this.pools.get(n);\r\n    }\r\n\r\n    if (!pool) {\r\n      let tot;\r\n\r\n      if (n > 512) {\r\n        tot = 32;\r\n      } else if (n > 256) {\r\n        tot = 64;\r\n      } else if (n > 128) {\r\n        tot = 256;\r\n      } else if (n > 64) {\r\n        tot = 512;\r\n      } else {\r\n        tot = 1024;\r\n      }\r\n\r\n      pool = new cachering(() => new Array(n), tot);\r\n      if (n < 1024) {\r\n        this.map[n] = pool;\r\n      }\r\n      this.pools.set(n, pool);\r\n\r\n      return this.get(n, clear);\r\n    }\r\n\r\n    let ret = pool.next();\r\n    if (ret.length !== n) {\r\n      console.warn(\"Array length was set\", n, ret);\r\n      ret.length = n;\r\n    }\r\n\r\n    if (clear) {\r\n      for (let i = 0; i < n; i++) {\r\n        ret[i] = undefined;\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\n/** jsFiddle-friendly */\r\nexport class DivLogger {\r\n  constructor(elemId, maxLines=16) {\r\n    this.elemId = elemId;\r\n    this.elem = undefined;\r\n    this.lines = new Array();\r\n    this.maxLines = maxLines;\r\n  }\r\n\r\n  push(line) {\r\n    if (this.lines.length > this.maxLines) {\r\n      this.lines.shift();\r\n      this.lines.push(line);\r\n    } else {\r\n      this.lines.push(line);\r\n    }\r\n\r\n    this.update();\r\n  }\r\n\r\n  update() {\r\n    let buf = this.lines.join(`<br>`);\r\n    buf = buf.replace(/[ \\t]/g, \"&nbsp;\");\r\n\r\n    if (!this.elem) {\r\n      this.elem = document.getElementById(this.elemId);\r\n    }\r\n\r\n    this.elem.innerHTML = buf;\r\n  }\r\n\r\n  toString(obj, depth=0) {\r\n    let s = '';\r\n\r\n    let tab = '';\r\n    for (let i=0; i<depth; i++) {\r\n      tab += '$TAB';\r\n    }\r\n\r\n    if (typeof obj === \"symbol\") {\r\n      return `[${obj.description}]`;\r\n    }\r\n\r\n    const DEPTH_LIMIT = 1;\r\n    const CHAR_LIMIT = 100;\r\n\r\n    if (typeof obj === \"object\" && Array.isArray(obj)) {\r\n      s = \"[$NL\";\r\n      for (let i=0; i<obj.length; i++) {\r\n        let v = obj[i];\r\n\r\n        if (depth >= DEPTH_LIMIT) {\r\n          v = typeof v;\r\n        } else {\r\n          v = this.toString(v, depth+1);\r\n        }\r\n\r\n        s += tab + \"$TAB\";\r\n        s += v + (i !== obj.length - 1 ? \",\" : \"\") + \"$NL\";\r\n      }\r\n\r\n      let keys = Reflect.ownKeys(obj);\r\n      for (let i=0; i<keys.length; i++) {\r\n        let k = keys[i];\r\n        let n;\r\n\r\n        let k2 = this.toString(k);\r\n\r\n        if (typeof k !== \"symbol\" && !isNaN(n = parseInt(k))) {\r\n          if (n >= 0 && n < obj.length) {\r\n            continue;\r\n          }\r\n        }\r\n\r\n        let v;\r\n        try {\r\n          v = obj[k];\r\n        } catch (error) {\r\n          v = \"(error)\";\r\n        }\r\n\r\n        s += tab + `$TAB${k2} : ${v}`;\r\n\r\n        if (i < keys.length-1) {\r\n          s += \",\";\r\n        }\r\n\r\n        if (!s.endsWith(\"$NL\") && !s.endsWith(\"\\n\")) {\r\n          s += \"$NL\";\r\n        }\r\n      }\r\n      s += \"$TAB]$NL\";\r\n\r\n      if (s.length < CHAR_LIMIT) {\r\n        s = s.replace(/\\$NL/g, \"\");\r\n        s = s.replace(/(\\$TAB)+/g, \" \");\r\n      } else {\r\n        s = s.replace(/\\$NL/g, \"\\n\");\r\n        s = s.replace(/\\$TAB/g, \"  \");\r\n      }\r\n    } else if (typeof obj === \"object\") {\r\n      s = '{$NL';\r\n\r\n      let keys = Reflect.ownKeys(obj);\r\n      for (let i=0; i<keys.length; i++) {\r\n        let k = keys[i];\r\n        let k2 = this.toString(k);\r\n\r\n        let v;\r\n        try {\r\n          v = obj[k];\r\n        } catch (error) {\r\n          v = '(error)';\r\n        }\r\n\r\n        if (depth >= DEPTH_LIMIT) {\r\n          v = typeof v;\r\n        } else {\r\n          v = this.toString(v, depth+1);\r\n        }\r\n\r\n        s += tab + `$TAB${k2} : ${v}`;\r\n\r\n        if (i < keys.length-1) {\r\n          s += \",\";\r\n        }\r\n\r\n        if (!s.endsWith(\"$NL\") && !s.endsWith(\"\\n\")) {\r\n          s += \"$NL\";\r\n        }\r\n      }\r\n      s += tab + \"}$NL\";\r\n\r\n      if (s.length < CHAR_LIMIT) {\r\n        s = s.replace(/\\$NL/g, \"\");\r\n        s = s.replace(/(\\$TAB)+/g, \" \");\r\n      } else {\r\n        s = s.replace(/\\$NL/g, \"\\n\");\r\n        s = s.replace(/\\$TAB/g, \"  \");\r\n      }\r\n    } else if (typeof obj === \"undefined\") {\r\n      s = 'undefined';\r\n    } else if (typeof obj === \"function\") {\r\n      s = 'function ' + obj.name;\r\n    } else {\r\n      s = \"\" + obj;\r\n    }\r\n\r\n    return s;\r\n  }\r\n}\r\n\r\nexport const PendingTimeoutPromises = new Set();\r\n\r\nexport class TimeoutPromise {\r\n  constructor(callback, timeout=3000, silent=false) {\r\n    if (!callback) {\r\n      return;\r\n    }\r\n\r\n    this.silent = silent;\r\n    this.timeout = timeout;\r\n\r\n    let accept2 = this._accept2.bind(this);\r\n    let reject2 = this._reject2.bind(this);\r\n\r\n    this.time = time_ms();\r\n\r\n    this.rejected = false;\r\n\r\n    this._promise = new Promise((accept, reject) => {\r\n      this._accept = accept;\r\n      this._reject = reject;\r\n\r\n      callback(accept2, reject2);\r\n    });\r\n\r\n    PendingTimeoutPromises.add(this);\r\n  }\r\n\r\n  _accept2(val) {\r\n    if (this.bad) {\r\n      if (!this.silent) {\r\n        this._reject(new Error(\"Timeout\"));\r\n      }\r\n    } else {\r\n      return this._accept(val);\r\n    }\r\n  }\r\n\r\n  static wrapPromise(promise, timeout=3000, callback) {\r\n    let p = new TimeoutPromise();\r\n\r\n    p._promise = promise;\r\n\r\n    p._accept = callback;\r\n    p._reject = function(error) {\r\n      throw error;\r\n    }\r\n\r\n    p.then(val => {\r\n      p._accept2(val);\r\n    }).catch(error => {\r\n      p._reject2(error);\r\n    });\r\n\r\n    return p;\r\n  }\r\n\r\n  _reject2(error) {\r\n    this._reject(error);\r\n  }\r\n\r\n  then(callback) {\r\n    let cb = (val) => {\r\n      let ret = callback(val);\r\n\r\n      if (ret instanceof Promise) {\r\n        ret = TimeoutPromise.wrapPromise(ret, this.timeout, callback);\r\n      }\r\n\r\n      return ret;\r\n    }\r\n\r\n    this._promise.then(cb);\r\n    return this;\r\n  }\r\n\r\n  catch(callback) {\r\n    this._promise.catch(callback);\r\n    return this;\r\n  }\r\n\r\n  finally(callback) {\r\n    this._promise.catch(callback);\r\n    return this;\r\n  }\r\n\r\n  get bad() {\r\n    return time_ms() - this.time > this.timeout;\r\n  }\r\n}\r\n\r\nwindow.setInterval(() => {\r\n  let bad = [];\r\n\r\n  for (let promise of PendingTimeoutPromises) {\r\n    if (promise.bad) {\r\n      bad.push(promise);\r\n    }\r\n  }\r\n\r\n  for (let promise of bad) {\r\n    PendingTimeoutPromises.delete(promise);\r\n  }\r\n\r\n  for (let promise of bad) {\r\n    try {\r\n      promise._reject(new Error(\"Timeout\"));\r\n    } catch (error) {\r\n      print_stack(error);\r\n    }\r\n  }\r\n}, 250);\r\n\r\nimport lzstring from '../extern/lz-string/lz-string.js';\r\n\r\nexport function compress(data) {\r\n  return lzstring.compressToUint8Array(data);\r\n}\r\n\r\nexport function decompress(data) {\r\n  if (data instanceof DataView) {\r\n    data = data.buffer;\r\n  }\r\n\r\n  if (data instanceof ArrayBuffer) {\r\n    data = new Uint8Array(data);\r\n  }\r\n\r\n  return lzstring.decompressFromUint8Array(data);\r\n}\r\n","import * as util from './util.js';\r\nimport nstructjs from './struct.js';\r\n\r\nexport const EulerOrders = {\r\n  XYZ: 0,\r\n  XZY: 1,\r\n  YXZ: 2,\r\n  YZX: 3,\r\n  ZXY: 4,\r\n  ZYX: 5\r\n};\r\n\r\n/**\r\n * @param mode one of 'es', 'commonjs', 'rjs'\r\n */\r\nwindow.makeCompiledVectormathCode = function (mode = \"es\") {\r\n  let s = \"\";\r\n  let es6exports = mode === \"es\";\r\n\r\n  function doExports(name) {\r\n    if (es6exports) {\r\n      return \"export\";\r\n    } else {\r\n      return `var ${name} = exports.${name} =`;\r\n    }\r\n  }\r\n\r\n  let classes = [Vector2, Vector3, Vector4, a];\r\n  let lens = {\r\n    Vector2: 2,\r\n    Vector3: 3,\r\n    Vector4: 4,\r\n    Quat   : 4\r\n  };\r\n\r\n  let modecode = \"\";\r\n\r\n  let nstructjscode = `\r\n  let g = typeof window !== \"undefined\" ? window : \"undefined\";\r\n  \r\n  g = g || (typeof global !== \"undefined\" ? global : \"undefined\");\r\n  g = g || (typeof self !== \"undefined\" ? self : \"undefined\");\r\n  g = g || (typeof globals !== \"undefined\" ? globals : \"undefined\");\r\n\r\n  if (typeof nstructjs === \"undefined\") {\r\n    //add nstructjs stub\r\n    g.nstructjs = {\r\n      register : function() {}\r\n    }\r\n  }\r\n  `\r\n\r\n  if (mode !== \"rjs\") {\r\n    if (mode === \"commonjs\") {\r\n      modecode = `if (typeof module !== \"undefined\" && typeof exports === \"undefined\") {\r\n      if (module.exports === undefined) {\r\n        module.exports = {};\r\n      }\r\n      \r\n      g.exports = module.exports;\r\n    } else if (typeof module === \"undefined\") {\r\n      g.exports = g.vectormath = {};\r\n    }\\n`;\r\n    }\r\n\r\n    s += `{\r\n      ${nstructjscode}\r\n    ${modecode}\r\n  }`;\r\n  }\r\n\r\n  s += `\r\nclass cachering extends Array {\r\n  constructor(func, size) {\r\n    super()\r\n\r\n    this.cur = 0;\r\n\r\n    for (var i=0; i<size; i++) {\r\n      this.push(func());\r\n    }\r\n  }\r\n\r\n  static fromConstructor(cls, size) {\r\n    var func = function() {\r\n      return new cls();\r\n    }\r\n\r\n    return new cachering(func, size);\r\n  }\r\n\r\n  next() {\r\n    var ret = this[this.cur];\r\n    this.cur = (this.cur+1)%this.length;\r\n\r\n    return ret;\r\n  }\r\n}\r\n`;\r\n  s += `\r\n\r\nvar M_SQRT2 = Math.sqrt(2.0);\r\nvar FLT_EPSILON = 2.22e-16;  \r\nvar sin=Math.sin, cos=Math.cos, abs=Math.abs, log=Math.log,\r\n    asin=Math.asin, exp=Math.exp, acos=Math.acos, fract=Math.fract,\r\n    sign=Math.sign, tent=Math.tent, atan2=Math.atan2, atan=Math.atan,\r\n    pow=Math.pow, sqrt=Math.sqrt, floor=Math.floor, ceil=Math.ceil,\r\n    min=Math.min, max=Math.max, PI=Math.PI, E=2.718281828459045;\r\n\r\nvar DOT_NORM_SNAP_LIMIT = 0.00000000001;\r\n\r\n${doExports(\"BaseVector\")} class BaseVector extends Array {\r\n  constructor() {\r\n    super();\r\n    \r\n    this.vec = undefined; //for compatibility with old files\r\n  }\r\n\r\n  copy() {\r\n    return new this.constructor(this);\r\n  }\r\n\r\n  load(data) {\r\n    throw new Error(\"Implement me!\");\r\n  }\r\n  \r\n  vectorLength() {\r\n    return sqrt(this.dot(this));\r\n  }\r\n  \r\n  normalize() {\r\n    var l = this.vectorLength();\r\n    if (l > 0.00000001) {\r\n      this.mulScalar(1.0/l);\r\n    }\r\n    \r\n    return this;\r\n  }\r\n}\r\n  \r\n`;\r\n\r\n  function indent(s, pad = \"  \") {\r\n    let l = s.split(\"\\n\");\r\n    let s2 = \"\";\r\n\r\n    for (let l2 of l) {\r\n      s2 += pad + l2 + \"\\n\";\r\n    }\r\n\r\n    return s2;\r\n  }\r\n\r\n  let i = 0;\r\n  for (let cls of classes) {\r\n    s += doExports(cls.name) + \" class \" + cls.name + \" extends BaseVector {\\n\";\r\n\r\n    let keys = Reflect.ownKeys(cls.prototype);\r\n\r\n    for (let k of keys) {\r\n      let v = cls.prototype[k];\r\n\r\n      if (typeof v !== \"function\") {\r\n        continue;\r\n      }\r\n\r\n      if (typeof k === \"symbol\") {\r\n        k = \"  [\" + k.toString() + \"]\";\r\n      }\r\n\r\n      v = (\"\" + v).trim();\r\n      if (v.startsWith(\"function(\") || v.startsWith(\"function (\")) {\r\n        v = k + v.slice(8, v.length).trim();\r\n      } else if (v.startsWith(\"function\")) {\r\n        v = v.slice(8, v.length).trim();\r\n      }\r\n\r\n      if (v.endsWith(\";}\")) {\r\n        v = v.slice(0, v.length - 1) + \"\\n  }\\n\";\r\n      }\r\n\r\n      let zero = \"\";\r\n      let l = lens[cls.name];\r\n\r\n      for (let j = 0; j < l; j++) {\r\n        if (j > 0) {\r\n          zero += \" = \";\r\n        }\r\n        zero += `this[${j}]`;\r\n      }\r\n\r\n      zero += \" = 0.0\";\r\n\r\n      if (k === \"constructor\") {\r\n        s += `  constructor(data) {\r\n    super(${l});\r\n        \r\n    this.vec = undefined; //for compatibility with old files\r\n    \r\n    if (arguments.length > 1) {\r\n      throw new Error(\"unexpected argument\");\r\n    }\r\n\r\n    //this.length = ${l};\r\n    ${zero};\r\n\r\n    if (data !== undefined) {\r\n      this.load(data);\r\n    }\r\n  }\r\n`;\r\n      } else {\r\n        s += indent(v);\r\n      }\r\n\r\n      s += \"\\n\";\r\n      i++;\r\n    }\r\n    s += \"}\\n\\n\"\r\n\r\n    s += `${cls.name}.STRUCT = \\`${cls.STRUCT}\\`;\\n`;\r\n    s += `nstructjs.register(${cls.name});\\n\\n`;\r\n  }\r\n\r\n  s += \"\\n\\n\" + (\"\" + internal_matrix).trim() + \"\\n\";\r\n  s += \"\\n\" + doExports(\"Matrix4\") + Matrix4;\r\n\r\n  s += `\\n  Matrix4.STRUCT = \\`${Matrix4.STRUCT}\\`;\\n`;\r\n  s += \"nstructjs.register(Matrix4)\\n\";\r\n\r\n  s += `\r\n  var _quat_vs3_temps = cachering.fromConstructor(Vector3, 64);\r\n  var _v3nd4_n1_normalizedDot4 = new Vector3();\r\n  var _v3nd4_n2_normalizedDot4 = new Vector3();\r\n  var _v3nd_n1_normalizedDot = new Vector3();\r\n  var _v3nd_n2_normalizedDot = new Vector3();\r\n\r\n  var $_v3nd4_n1_normalizedDot4 = new Vector3();\r\n  var $_v3nd4_n2_normalizedDot4 = new Vector3();\r\n  var $_v3nd_n1_normalizedDot = new Vector3();\r\n  var $_v3nd_n2_normalizedDot = new Vector3();\r\n\r\n  var lookat_cache_vs3 = cachering.fromConstructor(Vector3, 64);\r\n  var lookat_cache_vs4 = cachering.fromConstructor(Vector4, 64);\r\n\r\n  var makenormalcache = cachering.fromConstructor(Vector3, 64);\r\n`;\r\n\r\n  if (mode === \"rjs\") {\r\n    s = `define([], function() {\r\n  \"use strict\";\r\n\r\n  let exports = {};\r\n\r\n  {\r\n    ${nstructjscode}\r\n  }\r\n  ${indent(s)}\r\n\r\n  return exports;\r\n});\r\n`;\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nvar sin                                                          = Math.sin, cos                                          = Math.cos, abs                          = Math.abs, log = Math.log,\r\n    asin                                                         = Math.asin, exp                                        = Math.exp, acos = Math.acos, fract = Math.fract,\r\n    sign = Math.sign, tent = Math.tent, atan2 = Math.atan2, atan = Math.atan,\r\n    pow                                                          = Math.pow, sqrt = Math.sqrt, floor                      = Math.floor, ceil = Math.ceil,\r\n    min                                                          = Math.min, max = Math.max, PI = Math.PI, E = 2.718281828459045;\r\n\r\nvar DOT_NORM_SNAP_LIMIT = 0.00000000001;\r\nvar M_SQRT2 = Math.sqrt(2.0);\r\nvar FLT_EPSILON = 2.22e-16;\r\n\r\nvar basic_funcs = {\r\n  equals   : [[\"b\"], \"this[X] === b[X]\", \"&&\"],\r\n  /*dot is made manually so it's safe for acos\r\n  dot     : [[\"b\"], \"this[X]*b[X]\", \"+\"],\r\n   */\r\n  zero     : [[], \"0.0;\"],\r\n  negate   : [[], \"-this[X];\"],\r\n  combine  : [[\"b\", \"u\", \"v\"], \"this[X]*u + this[X]*v;\"],\r\n  interp   : [[\"b\", \"t\"], \"this[X] + (b[X] - this[X])*t;\"],\r\n  add      : [[\"b\"], \"this[X] + b[X];\"],\r\n  addFac   : [[\"b\", \"F\"], \"this[X] + b[X]*F;\"],\r\n  fract    : [[], \"Math.fract(this[X]);\"],\r\n  sub      : [[\"b\"], \"this[X] - b[X];\"],\r\n  mul      : [[\"b\"], \"this[X] * b[X];\"],\r\n  div      : [[\"b\"], \"this[X] / b[X];\"],\r\n  mulScalar: [[\"b\"], \"this[X] * b;\"],\r\n  divScalar: [[\"b\"], \"this[X] / b;\"],\r\n  addScalar: [[\"b\"], \"this[X] + b;\"],\r\n  subScalar: [[\"b\"], \"this[X] - b;\"],\r\n  minScalar: [[\"b\"], \"Math.min(this[X], b);\"],\r\n  maxScalar: [[\"b\"], \"Math.max(this[X], b);\"],\r\n  ceil     : [[], \"Math.ceil(this[X])\"],\r\n  floor    : [[], \"Math.floor(this[X])\"],\r\n  abs      : [[], \"Math.abs(this[X])\"],\r\n  min      : [[\"b\"], \"Math.min(this[X], b[X])\"],\r\n  max      : [[\"b\"], \"Math.max(this[X], b[X])\"],\r\n  clamp    : [[\"MIN\", \"MAX\"], \"min(max(this[X], MAX), MIN)\"],\r\n};\r\n\r\nfunction bounded_acos(fac) {\r\n  if (fac <= -1.0)\r\n    return Math.pi;\r\n  else if (fac >= 1.0)\r\n    return 0.0;\r\n  else\r\n    return Math.acos(fac);\r\n}\r\n\r\nfunction make_norm_safe_dot(cls) {\r\n  var _dot = cls.prototype.dot;\r\n\r\n  cls.prototype._dot = _dot;\r\n  cls.prototype.dot = function (b) {\r\n    var ret = _dot.call(this, b);\r\n\r\n    if (ret >= 1.0 - DOT_NORM_SNAP_LIMIT && ret <= 1.0 + DOT_NORM_SNAP_LIMIT)\r\n      return 1.0;\r\n    if (ret >= -1.0 - DOT_NORM_SNAP_LIMIT && ret <= -1.0 + DOT_NORM_SNAP_LIMIT)\r\n      return -1.0;\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nfunction getBaseVector(parent) {\r\n  return class BaseVector extends parent {\r\n    constructor() {\r\n      super(...arguments);\r\n\r\n      this.vec = undefined; //for compatibility with old nstructjs-saved files\r\n\r\n      //this.xyzw = this.init_swizzle(4);\r\n      //this.xyz = this.init_swizzle(3);\r\n      //this.xy = this.init_swizzle(2);\r\n    }\r\n\r\n    static inherit(cls, vectorsize) {\r\n      make_norm_safe_dot(cls);\r\n\r\n      var f;\r\n\r\n      var vectorDotDistance = \"f = function vectorDotDistance(b) {\\n\";\r\n      for (var i = 0; i < vectorsize; i++) {\r\n        vectorDotDistance += \"  let d\" + i + \" = this[\" + i + \"]-b[\" + i + \"];\\n\\n  \";\r\n      }\r\n\r\n      vectorDotDistance += \"  return \"\r\n      for (var i = 0; i < vectorsize; i++) {\r\n        if (i > 0)\r\n          vectorDotDistance += \" + \";\r\n        vectorDotDistance += \"d\" + i + \"*d\" + i;\r\n      }\r\n      vectorDotDistance += \";\\n\"\r\n      vectorDotDistance += \"};\";\r\n      cls.prototype.vectorDotDistance = eval(vectorDotDistance);\r\n\r\n      var f;\r\n      var vectorDistance = \"f = function vectorDistance(b) {\\n\";\r\n      for (var i = 0; i < vectorsize; i++) {\r\n        vectorDistance += `  let d${i} = this[${i}] - (b[${i}]||0);\\n\\n  `;\r\n        //vectorDistance += \"  let d\"+i+\" = this[\"+i+\"]-(b[\"+i+\"]||0);\\n\\n  \";\r\n      }\r\n\r\n      vectorDistance += \"  return Math.sqrt(\"\r\n      for (var i = 0; i < vectorsize; i++) {\r\n        if (i > 0)\r\n          vectorDistance += \" + \";\r\n        vectorDistance += \"d\" + i + \"*d\" + i;\r\n      }\r\n      vectorDistance += \");\\n\"\r\n      vectorDistance += \"};\";\r\n      cls.prototype.vectorDistance = eval(vectorDistance);\r\n\r\n      var vectorDistanceSqr = \"f = function vectorDistanceSqr(b) {\\n\";\r\n      for (var i = 0; i < vectorsize; i++) {\r\n        vectorDistanceSqr += `  let d${i} = this[${i}] - (b[${i}]||0);\\n\\n  `;\r\n        //vectorDistanceSqr += \"  let d\"+i+\" = this[\"+i+\"]-(b[\"+i+\"]||0);\\n\\n  \";\r\n      }\r\n\r\n      vectorDistanceSqr += \"  return (\"\r\n      for (var i = 0; i < vectorsize; i++) {\r\n        if (i > 0)\r\n          vectorDistanceSqr += \" + \";\r\n        vectorDistanceSqr += \"d\" + i + \"*d\" + i;\r\n      }\r\n      vectorDistanceSqr += \");\\n\"\r\n      vectorDistanceSqr += \"};\";\r\n      cls.prototype.vectorDistanceSqr = eval(vectorDistanceSqr);\r\n\r\n\r\n      for (var k in basic_funcs) {\r\n        var func = basic_funcs[k];\r\n        var args = func[0];\r\n        var line = func[1];\r\n        var f;\r\n\r\n        var code = \"f = function \" + k + \"(\"\r\n        for (var i = 0; i < args.length; i++) {\r\n          if (i > 0)\r\n            code += \", \";\r\n\r\n          line = line.replace(args[i], args[i].toLowerCase());\r\n          code += args[i].toLowerCase();\r\n        }\r\n        code += \") {\\n\";\r\n\r\n        if (func.length > 2) {\r\n          //make summation\r\n          code += \"  return \";\r\n\r\n          for (var i = 0; i < vectorsize; i++) {\r\n            if (i > 0)\r\n              code += func[2];\r\n\r\n            code += \"(\" + line.replace(/X/g, \"\" + i) + \")\";\r\n          }\r\n          code += \";\\n\";\r\n        } else {\r\n          for (var i = 0; i < vectorsize; i++) {\r\n            var line2 = line.replace(/X/g, \"\" + i);\r\n            code += \"  this[\" + i + \"] = \" + line2 + \";\\n\";\r\n          }\r\n          code += \"  return this;\\n\"\r\n        }\r\n\r\n        code += \"}\\n\";\r\n\r\n        //console.log(code);\r\n        var f = eval(code);\r\n\r\n        cls.prototype[k] = f;\r\n        //console.log(k, f);\r\n      }\r\n    }\r\n\r\n    copy() {\r\n      return new this.constructor(this);\r\n    }\r\n\r\n    load(data) {\r\n      throw new Error(\"Implement me!\");\r\n    }\r\n\r\n    init_swizzle(size) {\r\n      var ret = {};\r\n      var cls = size === 4 ? Vector4 : (size === 3 ? Vector3 : Vector2);\r\n\r\n      for (var k in cls.prototype) {\r\n        var v = cls.prototype[k];\r\n        if (typeof v !== \"function\" && !(v instanceof Function))\r\n          continue;\r\n\r\n        ret[k] = v.bind(this);\r\n      }\r\n\r\n      return ret;\r\n    }\r\n\r\n    vectorLength() {\r\n      return sqrt(this.dot(this));\r\n    }\r\n\r\n    swapAxes(axis1, axis2) {\r\n      let t = this[axis1];\r\n      this[axis1] = this[axis2];\r\n      this[axis2] = t;\r\n\r\n      return this;\r\n    }\r\n\r\n    normalize() {\r\n      /*\r\n      for (let i=0; i<this.length; i++) {\r\n        if (util.isDenormal(this[i])) {\r\n          console.error(\"Denormal error\", i, this[i]);\r\n          this[i] = 0.0;\r\n        }\r\n      }\r\n      //*/\r\n\r\n      let l = this.vectorLength();\r\n\r\n      /*\r\n      if (util.isDenormal(l)) {\r\n        console.error(\"Denormal error\", l);\r\n      }\r\n      //*/\r\n\r\n      if (l > 0.00000001) {\r\n        this.mulScalar(1.0/l);\r\n      }\r\n\r\n      return this;\r\n    }\r\n  }\r\n}\r\n\r\nexport const BaseVector = getBaseVector(Array);\r\nexport const F64BaseVector = getBaseVector(Float64Array);\r\nexport const F32BaseVector = getBaseVector(Float32Array);\r\n\r\nfunction myclamp(f, a, b) {\r\n  return Math.min(Math.max(f, a), b);\r\n}\r\n\r\nexport class Vector4 extends BaseVector {\r\n  constructor(data) {\r\n    super(4);\r\n\r\n    if (arguments.length > 1) {\r\n      throw new Error(\"unexpected argument\");\r\n    }\r\n\r\n    this[0] = this[1] = this[2] = this[3] = 0.0;\r\n\r\n    if (data !== undefined) {\r\n      this.load(data);\r\n    }\r\n  }\r\n\r\n  toCSS() {\r\n    let r = ~~(this[0]*255);\r\n    let g = ~~(this[1]*255);\r\n    let b = ~~(this[2]*255);\r\n    let a = this[3];\r\n    return `rgba(${r},${g},${b},${a})`\r\n  }\r\n\r\n  loadXYZW(x, y, z, w) {\r\n    this[0] = x;\r\n    this[1] = y;\r\n    this[2] = z;\r\n    this[3] = w;\r\n\r\n    return this;\r\n  }\r\n\r\n  loadXYZ(x, y, z) {\r\n    this[0] = x;\r\n    this[1] = y;\r\n    this[2] = z;\r\n\r\n    return this;\r\n  }\r\n\r\n  load(data) {\r\n    if (data === undefined)\r\n      return this;\r\n\r\n    this[0] = data[0];\r\n    this[1] = data[1];\r\n    this[2] = data[2];\r\n    this[3] = data[3];\r\n\r\n    return this;\r\n  }\r\n\r\n  dot(b) {\r\n    return this[0]*b[0] + this[1]*b[1] + this[2]*b[2] + this[3]*b[3];\r\n  }\r\n\r\n  mulVecQuat(q) {\r\n    let t0 = -q[1] * this[0] - q[2] * this[1] - q[3] * this[2];\r\n    let t1 = q[0] * this[0] + q[2] * this[2] - q[3] * this[1];\r\n    let t2 = q[0] * this[1] + q[3] * this[0] - q[1] * this[2];\r\n\r\n    this[2] = q[0] * this[2] + q[1] * this[1] - q[2] * this[0];\r\n    this[0] = t1;\r\n    this[1] = t2;\r\n\r\n    t1 = t0 * -q[1] + this[0] * q[0] - this[1] * q[3] + this[2] * q[2];\r\n    t2 = t0 * -q[2] + this[1] * q[0] - this[2] * q[1] + this[0] * q[3];\r\n\r\n    this[2] = t0 * -q[3] + this[2] * q[0] - this[0] * q[2] + this[1] * q[1];\r\n    this[0] = t1;\r\n    this[1] = t2;\r\n\r\n    return this;\r\n  }\r\n\r\n  multVecMatrix(matrix) {\r\n    var x = this[0];\r\n    var y = this[1];\r\n    var z = this[2];\r\n    var w = this[3];\r\n\r\n    this[0] = w*matrix.$matrix.m41 + x*matrix.$matrix.m11 + y*matrix.$matrix.m21 + z*matrix.$matrix.m31;\r\n    this[1] = w*matrix.$matrix.m42 + x*matrix.$matrix.m12 + y*matrix.$matrix.m22 + z*matrix.$matrix.m32;\r\n    this[2] = w*matrix.$matrix.m43 + x*matrix.$matrix.m13 + y*matrix.$matrix.m23 + z*matrix.$matrix.m33;\r\n    this[3] = w*matrix.$matrix.m44 + x*matrix.$matrix.m14 + y*matrix.$matrix.m24 + z*matrix.$matrix.m34;\r\n\r\n    return this[3];\r\n  }\r\n\r\n  cross(v) {\r\n    var x = this[1]*v[2] - this[2]*v[1];\r\n    var y = this[2]*v[0] - this[0]*v[2];\r\n    var z = this[0]*v[1] - this[1]*v[0];\r\n\r\n    this[0] = x;\r\n    this[1] = y;\r\n    this[2] = z;\r\n\r\n    return this;\r\n  }\r\n\r\n  preNormalizedAngle(v2) {\r\n    let th = this.dot(v2)*0.99999;\r\n    return Math.acos(th);\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    if (typeof this.vec !== \"undefined\") {\r\n      this.load(this.vec);\r\n      this.vec = undefined;\r\n    }\r\n  }\r\n};\r\nVector4.STRUCT = `\r\nvec4 {\r\n  0 : float;\r\n  1 : float;\r\n  2 : float;\r\n  3 : float;\r\n}\r\n`;\r\nnstructjs.manager.add_class(Vector4);\r\n\r\n\r\nvar _v3nd_n1_normalizedDot, _v3nd_n2_normalizedDot;\r\nvar _v3nd4_n1_normalizedDot4, _v3nd4_n2_normalizedDot4;\r\n\r\nexport class Vector3 extends F64BaseVector {\r\n  constructor(data) {\r\n    super(3);\r\n\r\n    if (arguments.length > 1) {\r\n      throw new Error(\"unexpected argument\");\r\n    }\r\n\r\n    this[0] = this[1] = this[2] = 0.0;\r\n\r\n    if (data !== undefined) {\r\n      this.load(data);\r\n    }\r\n\r\n    if (this.constructor === Vector3) {\r\n      Object.preventExtensions(this);\r\n    }\r\n  }\r\n\r\n  //normalizedDot4\r\n  static normalizedDot4(v1, v2, v3, v4) {\r\n    $_v3nd4_n1_normalizedDot4.load(v2).sub(v1).normalize();\r\n    $_v3nd4_n2_normalizedDot4.load(v4).sub(v3).normalize();\r\n\r\n    return $_v3nd4_n1_normalizedDot4.dot($_v3nd4_n2_normalizedDot4);\r\n  }\r\n\r\n  static normalizedDot3(v1, center, v2) {\r\n    $_v3nd4_n1_normalizedDot3.load(v1).sub(center).normalize();\r\n    $_v3nd4_n2_normalizedDot3.load(v2).sub(center).normalize();\r\n\r\n    return $_v3nd4_n1_normalizedDot3.dot($_v3nd4_n2_normalizedDot3);\r\n  }\r\n\r\n  toCSS() {\r\n    let r = ~~(this[0]*255);\r\n    let g = ~~(this[1]*255);\r\n    let b = ~~(this[2]*255);\r\n    return `rgb(${r},${g},${b})`\r\n  }\r\n\r\n  loadXYZ(x, y, z) {\r\n    this[0] = x;\r\n    this[1] = y;\r\n    this[2] = z;\r\n\r\n    return this;\r\n  }\r\n\r\n  loadXY(x, y) {\r\n    this[0] = x;\r\n    this[1] = y;\r\n\r\n    return this;\r\n  }\r\n\r\n  toJSON() {\r\n    return [this[0], this[1], this[2]];\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    return this.load(obj);\r\n  }\r\n\r\n  initVector3() {\r\n    this.length = 3;\r\n    this[0] = this[1] = this[2] = 0;\r\n    return this;\r\n  }\r\n\r\n  load(data) {\r\n    if (data === undefined)\r\n      return this;\r\n\r\n    //if (isNaN(data[0]) || isNaN(data[1]) || isNaN(data[2])) {\r\n    //  throw new Error(\"NaN\");\r\n    //}\r\n\r\n    this[0] = data[0];\r\n    this[1] = data[1];\r\n    this[2] = data[2];\r\n\r\n    return this;\r\n  }\r\n\r\n  dot(b) {\r\n    return this[0]*b[0] + this[1]*b[1] + this[2]*b[2];\r\n  }\r\n\r\n  normalizedDot(v) {\r\n    $_v3nd_n1_normalizedDot.load(this);\r\n    $_v3nd_n2_normalizedDot.load(v);\r\n    $_v3nd_n1_normalizedDot.normalize();\r\n    $_v3nd_n2_normalizedDot.normalize();\r\n    return $_v3nd_n1_normalizedDot.dot($_v3nd_n2_normalizedDot);\r\n  }\r\n\r\n  mulVecQuat(q) {\r\n    let t0 = -q[1] * this[0] - q[2] * this[1] - q[3] * this[2];\r\n    let t1 = q[0] * this[0] + q[2] * this[2] - q[3] * this[1];\r\n    let t2 = q[0] * this[1] + q[3] * this[0] - q[1] * this[2];\r\n\r\n    this[2] = q[0] * this[2] + q[1] * this[1] - q[2] * this[0];\r\n    this[0] = t1;\r\n    this[1] = t2;\r\n\r\n    t1 = t0 * -q[1] + this[0] * q[0] - this[1] * q[3] + this[2] * q[2];\r\n    t2 = t0 * -q[2] + this[1] * q[0] - this[2] * q[1] + this[0] * q[3];\r\n\r\n    this[2] = t0 * -q[3] + this[2] * q[0] - this[0] * q[2] + this[1] * q[1];\r\n    this[0] = t1;\r\n    this[1] = t2;\r\n\r\n    return this;\r\n  }\r\n\r\n  multVecMatrix(matrix, ignore_w) {\r\n    if (ignore_w === undefined) {\r\n      ignore_w = false;\r\n    }\r\n    var x = this[0];\r\n    var y = this[1];\r\n    var z = this[2];\r\n    this[0] = matrix.$matrix.m41 + x*matrix.$matrix.m11 + y*matrix.$matrix.m21 + z*matrix.$matrix.m31;\r\n    this[1] = matrix.$matrix.m42 + x*matrix.$matrix.m12 + y*matrix.$matrix.m22 + z*matrix.$matrix.m32;\r\n    this[2] = matrix.$matrix.m43 + x*matrix.$matrix.m13 + y*matrix.$matrix.m23 + z*matrix.$matrix.m33;\r\n    var w = matrix.$matrix.m44 + x*matrix.$matrix.m14 + y*matrix.$matrix.m24 + z*matrix.$matrix.m34;\r\n\r\n    if (!ignore_w && w !== 1 && w !== 0 && matrix.isPersp) {\r\n      this[0] /= w;\r\n      this[1] /= w;\r\n      this[2] /= w;\r\n    }\r\n    return w;\r\n  }\r\n\r\n  cross(v) {\r\n    var x = this[1]*v[2] - this[2]*v[1];\r\n    var y = this[2]*v[0] - this[0]*v[2];\r\n    var z = this[0]*v[1] - this[1]*v[0];\r\n\r\n    this[0] = x;\r\n    this[1] = y;\r\n    this[2] = z;\r\n\r\n    return this;\r\n  }\r\n\r\n  //axis is optional, 0\r\n  rot2d(A, axis) {\r\n    var x = this[0];\r\n    var y = this[1];\r\n\r\n    if (axis === 1) {\r\n      this[0] = x*cos(A) + y*sin(A);\r\n      this[1] = y*cos(A) - x*sin(A);\r\n    } else {\r\n      this[0] = x*cos(A) - y*sin(A);\r\n      this[1] = y*cos(A) + x*sin(A);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  preNormalizedAngle(v2) {\r\n    let th = this.dot(v2)*0.99999;\r\n    return Math.acos(th);\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    if (typeof this.vec !== \"undefined\") {\r\n      this.load(this.vec);\r\n      this.vec = undefined;\r\n    }\r\n  }\r\n}\r\n\r\nVector3.STRUCT = `\r\nvec3 {\r\n  0 : float;\r\n  1 : float;\r\n  2 : float;\r\n}\r\n`;\r\nnstructjs.manager.add_class(Vector3);\r\n\r\nexport class Vector2 extends BaseVector {\r\n  constructor(data) {\r\n    super(2);\r\n\r\n    if (arguments.length > 1) {\r\n      throw new Error(\"unexpected argument\");\r\n    }\r\n\r\n    this[0] = this[1] = 0.0;\r\n\r\n    if (data !== undefined) {\r\n      this.load(data);\r\n    }\r\n  }\r\n\r\n  initVector2(co) {\r\n    this.length = 2;\r\n\r\n    if (co !== undefined) {\r\n      this[0] = co[0];\r\n      this[1] = co[1];\r\n    } else {\r\n      this[0] = this[1] = 0.0;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  loadXY(x, y) {\r\n    this[0] = x;\r\n    this[1] = y;\r\n\r\n    return this;\r\n  }\r\n\r\n  toJSON() {\r\n    return [this[0], this[1]];\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    return this.load(obj);\r\n  }\r\n\r\n  loadXY(x, y) {\r\n    this[0] = x;\r\n    this[1] = y;\r\n\r\n    return this;\r\n  }\r\n\r\n  load(data) {\r\n    if (data === undefined)\r\n      return this;\r\n\r\n    this[0] = data[0];\r\n    this[1] = data[1];\r\n\r\n    return this;\r\n  }\r\n\r\n  //axis is optional, 0\r\n  rot2d(A, axis) {\r\n    var x = this[0];\r\n    var y = this[1];\r\n\r\n    if (axis === 1) {\r\n      this[0] = x*cos(A) + y*sin(A);\r\n      this[1] = y*cos(A) - x*sin(A);\r\n    } else {\r\n      this[0] = x*cos(A) - y*sin(A);\r\n      this[1] = y*cos(A) + x*sin(A);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  dot(b) {\r\n    return this[0]*b[0] + this[1]*b[1];\r\n  }\r\n\r\n  multVecMatrix(matrix) {\r\n    var x = this[0];\r\n    var y = this[1];\r\n\r\n    var w = 1.0;\r\n\r\n    this[0] = w*matrix.$matrix.m41 + x*matrix.$matrix.m11 + y*matrix.$matrix.m21;\r\n    this[1] = w*matrix.$matrix.m42 + x*matrix.$matrix.m12 + y*matrix.$matrix.m22;\r\n\r\n    if (matrix.isPersp) {\r\n      let w2 = w*matrix.$matrix.m44 + x*matrix.$matrix.m14 + y*matrix.$matrix.m24;\r\n\r\n      if (w2  !==  0.0) {\r\n        this[0] /= w2;\r\n        this[1] /= w2;\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  mulVecQuat(q) {\r\n    let t0 = -q[1] * this[0] - q[2] * this[1];\r\n    let t1 = q[0] * this[0] - q[3] * this[1];\r\n    let t2 = q[0] * this[1] + q[3] * this[0];\r\n\r\n    let z  = q[1] * this[1] - q[2] * this[0];\r\n    this[0] = t1;\r\n    this[1] = t2;\r\n\r\n    t1 = t0 * -q[1] + this[0] * q[0] - this[1] * q[3] + z * q[2];\r\n    t2 = t0 * -q[2] + this[1] * q[0] - z * q[1] + this[0] * q[3];\r\n\r\n    this[0] = t1;\r\n    this[1] = t2;\r\n\r\n    return this;\r\n  }\r\n\r\n  vectorLengthSqr() {\r\n    return this.dot(this);\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    if (typeof this.vec !== undefined) {\r\n      this.load(this.vec);\r\n      this.vec = undefined;\r\n    }\r\n  }\r\n};\r\nVector2.STRUCT = `\r\nvec2 {\r\n  0 : float;\r\n  1 : float;\r\n}\r\n`;\r\nnstructjs.manager.add_class(Vector2);\r\n\r\nlet _quat_vs3_temps = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport class Quat extends Vector4 {\r\n  makeUnitQuat() {\r\n    this[0] = 1.0;\r\n    this[1] = this[2] = this[3] = 0.0;\r\n  }\r\n\r\n  isZero() {\r\n    return (this[0] === 0 && this[1] === 0 && this[2] === 0 && this[3] === 0);\r\n  }\r\n\r\n  mulQuat(qt) {\r\n    var a = this[0]*qt[0] - this[1]*qt[1] - this[2]*qt[2] - this[3]*qt[3];\r\n    var b = this[0]*qt[1] + this[1]*qt[0] + this[2]*qt[3] - this[3]*qt[2];\r\n    var c = this[0]*qt[2] + this[2]*qt[0] + this[3]*qt[1] - this[1]*qt[3];\r\n    this[3] = this[0]*qt[3] + this[3]*qt[0] + this[1]*qt[2] - this[2]*qt[1];\r\n    this[0] = a;\r\n    this[1] = b;\r\n    this[2] = c;\r\n  }\r\n\r\n  conjugate() {\r\n    this[1] = -this[1];\r\n    this[2] = -this[2];\r\n    this[3] = -this[3];\r\n  }\r\n\r\n  dotWithQuat(q2) {\r\n    return this[0]*q2[0] + this[1]*q2[1] + this[2]*q2[2] + this[3]*q2[3];\r\n  }\r\n\r\n  invert() {\r\n    var f = this.dot(this);\r\n\r\n    if (f === 0.0)\r\n      return;\r\n\r\n    conjugate_qt(q);\r\n    this.mulscalar(1.0/f);\r\n  }\r\n\r\n  sub(q2) {\r\n    var nq2 = new Quat();\r\n\r\n    nq2[0] = -q2[0];\r\n    nq2[1] = q2[1];\r\n    nq2[2] = q2[2];\r\n    nq2[3] = q2[3];\r\n\r\n    this.mul(nq2);\r\n  }\r\n\r\n  mulScalarWithFactor(fac) {\r\n    var angle = fac*bounded_acos(this[0]);\r\n    var co = Math.cos(angle);\r\n    var si = Math.sin(angle);\r\n\r\n    this[0] = co;\r\n\r\n    var last3 = Vector3([this[1], this[2], this[3]]);\r\n    last3.normalize();\r\n    last3.mulScalar(si);\r\n    this[1] = last3[0];\r\n    this[2] = last3[1];\r\n    this[3] = last3[2];\r\n    return this;\r\n  }\r\n\r\n  toMatrix(m) {\r\n    if (m === undefined) {\r\n      m = new Matrix4();\r\n    }\r\n\r\n    var q0 = M_SQRT2*this[0];\r\n    var q1 = M_SQRT2*this[1];\r\n    var q2 = M_SQRT2*this[2];\r\n    var q3 = M_SQRT2*this[3];\r\n    var qda = q0*q1;\r\n    var qdb = q0*q2;\r\n    var qdc = q0*q3;\r\n    var qaa = q1*q1;\r\n    var qab = q1*q2;\r\n    var qac = q1*q3;\r\n    var qbb = q2*q2;\r\n    var qbc = q2*q3;\r\n    var qcc = q3*q3;\r\n    m.$matrix.m11 = (1.0 - qbb - qcc);\r\n    m.$matrix.m12 = (qdc + qab);\r\n    m.$matrix.m13 = (-qdb + qac);\r\n    m.$matrix.m14 = 0.0;\r\n    m.$matrix.m21 = (-qdc + qab);\r\n    m.$matrix.m22 = (1.0 - qaa - qcc);\r\n    m.$matrix.m23 = (qda + qbc);\r\n    m.$matrix.m24 = 0.0;\r\n    m.$matrix.m31 = (qdb + qac);\r\n    m.$matrix.m32 = (-qda + qbc);\r\n    m.$matrix.m33 = (1.0 - qaa - qbb);\r\n    m.$matrix.m34 = 0.0;\r\n    m.$matrix.m41 = m.$matrix.m42 = m.$matrix.m43 = 0.0;\r\n    m.$matrix.m44 = 1.0;\r\n\r\n    return m;\r\n  }\r\n\r\n  matrixToQuat(wmat) {\r\n    var mat = temp_mats.next();\r\n    mat.load(wmat);\r\n\r\n    mat.$matrix.m41 = mat.$matrix.m42 = mat.$matrix.m43 = 0;\r\n    mat.$matrix.m44 = 1.0;\r\n\r\n    var r1 = new Vector3([mat.$matrix.m11, mat.$matrix.m12, mat.$matrix.m13]);\r\n    var r2 = new Vector3([mat.$matrix.m21, mat.$matrix.m22, mat.$matrix.m23]);\r\n    var r3 = new Vector3([mat.$matrix.m31, mat.$matrix.m32, mat.$matrix.m33]);\r\n\r\n    r1.normalize();\r\n    r2.normalize();\r\n    r3.normalize();\r\n\r\n    mat.$matrix.m11 = r1[0];\r\n    mat.$matrix.m12 = r1[1];\r\n    mat.$matrix.m13 = r1[2];\r\n    mat.$matrix.m21 = r2[0];\r\n    mat.$matrix.m22 = r2[1];\r\n    mat.$matrix.m23 = r2[2];\r\n    mat.$matrix.m31 = r3[0];\r\n    mat.$matrix.m32 = r3[1];\r\n    mat.$matrix.m33 = r3[2];\r\n    var tr = 0.25*(1.0 + mat.$matrix.m11 + mat.$matrix.m22 + mat.$matrix.m33);\r\n    var s = 0;\r\n    if (tr > FLT_EPSILON) {\r\n      s = Math.sqrt(tr);\r\n      this[0] = s;\r\n      s = 1.0/(4.0*s);\r\n      this[1] = ((mat.$matrix.m23 - mat.$matrix.m32)*s);\r\n      this[2] = ((mat.$matrix.m31 - mat.$matrix.m13)*s);\r\n      this[3] = ((mat.$matrix.m12 - mat.$matrix.m21)*s);\r\n    } else {\r\n      if (mat.$matrix.m11 > mat.$matrix.m22 && mat.$matrix.m11 > mat.$matrix.m33) {\r\n        s = 2.0*Math.sqrt(1.0 + mat.$matrix.m11 - mat.$matrix.m22 - mat.$matrix.m33);\r\n        this[1] = (0.25*s);\r\n        s = 1.0/s;\r\n        this[0] = ((mat.$matrix.m32 - mat.$matrix.m23)*s);\r\n        this[2] = ((mat.$matrix.m21 + mat.$matrix.m12)*s);\r\n        this[3] = ((mat.$matrix.m31 + mat.$matrix.m13)*s);\r\n      } else if (mat.$matrix.m22 > mat.$matrix.m33) {\r\n        s = 2.0*Math.sqrt(1.0 + mat.$matrix.m22 - mat.$matrix.m11 - mat.$matrix.m33);\r\n        this[2] = (0.25*s);\r\n        s = 1.0/s;\r\n        this[0] = ((mat.$matrix.m31 - mat.$matrix.m13)*s);\r\n        this[1] = ((mat.$matrix.m21 + mat.$matrix.m12)*s);\r\n        this[3] = ((mat.$matrix.m32 + mat.$matrix.m23)*s);\r\n      } else {\r\n        s = 2.0*Math.sqrt(1.0 + mat.$matrix.m33 - mat.$matrix.m11 - mat.$matrix.m22);\r\n        this[3] = (0.25*s);\r\n        s = 1.0/s;\r\n        this[0] = ((mat.$matrix.m21 - mat.$matrix.m12)*s);\r\n        this[1] = ((mat.$matrix.m31 + mat.$matrix.m13)*s);\r\n        this[2] = ((mat.$matrix.m32 + mat.$matrix.m23)*s);\r\n      }\r\n    }\r\n    this.normalize();\r\n  }\r\n\r\n  normalize() {\r\n    var len = Math.sqrt(this.dot(this));\r\n\r\n    if (len !== 0.0) {\r\n      this.mulScalar(1.0/len);\r\n    } else {\r\n      this[1] = 1.0;\r\n      this[0] = this[2] = this[3] = 0.0;\r\n    }\r\n    return this;\r\n  }\r\n\r\n  axisAngleToQuat(axis, angle) {\r\n    let nor = _quat_vs3_temps.next().load(axis);\r\n    nor.normalize();\r\n\r\n    if (nor.dot(nor) !== 0.0) {\r\n      var phi = angle/2.0;\r\n      var si = Math.sin(phi);\r\n      this[0] = Math.cos(phi);\r\n      this[1] = nor[0]*si;\r\n      this[2] = nor[1]*si;\r\n      this[3] = nor[2]*si;\r\n    } else {\r\n      this.makeUnitQuat();\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  rotationBetweenVecs(v1, v2, fac = 1.0) {\r\n    v1 = new Vector3(v1);\r\n    v2 = new Vector3(v2);\r\n    v1.normalize();\r\n    v2.normalize();\r\n\r\n    if (Math.abs(v1.dot(v2)) > 0.9999) {\r\n      this.makeUnitQuat();\r\n      return this;\r\n    }\r\n\r\n    let axis = new Vector3(v1);\r\n    axis.cross(v2);\r\n\r\n    let angle = v1.preNormalizedAngle(v2)*fac;\r\n\r\n    this.axisAngleToQuat(axis, angle);\r\n\r\n    return this;\r\n  }\r\n\r\n  quatInterp(quat2, t) {\r\n    let quat = new Quat();\r\n    let cosom = this[0]*quat2[0] + this[1]*quat2[1] + this[2]*quat2[2] + this[3]*quat2[3];\r\n    if (cosom < 0.0) {\r\n      cosom = -cosom;\r\n      quat[0] = -this[0];\r\n      quat[1] = -this[1];\r\n      quat[2] = -this[2];\r\n      quat[3] = -this[3];\r\n    } else {\r\n      quat[0] = this[0];\r\n      quat[1] = this[1];\r\n      quat[2] = this[2];\r\n      quat[3] = this[3];\r\n    }\r\n\r\n    let omega, sinom, sc1, sc2;\r\n    if ((1.0 - cosom) > 0.0001) {\r\n      omega = Math.acos(cosom);\r\n      sinom = Math.sin(omega);\r\n      sc1 = Math.sin((1.0 - t)*omega)/sinom;\r\n      sc2 = Math.sin(t*omega)/sinom;\r\n    } else {\r\n      sc1 = 1.0 - t;\r\n      sc2 = t;\r\n    }\r\n    this[0] = sc1*quat[0] + sc2*quat2[0];\r\n    this[1] = sc1*quat[1] + sc2*quat2[1];\r\n    this[2] = sc1*quat[2] + sc2*quat2[2];\r\n    this[3] = sc1*quat[3] + sc2*quat2[3];\r\n\r\n    return this;\r\n  }\r\n};\r\n\r\nQuat.STRUCT = nstructjs.inherit(Quat, Vector4, 'quat') + `\r\n}\r\n`;\r\nnstructjs.register(Quat);\r\n\r\n_v3nd4_n1_normalizedDot4 = new Vector3();\r\n_v3nd4_n2_normalizedDot4 = new Vector3();\r\n_v3nd_n1_normalizedDot = new Vector3();\r\n_v3nd_n2_normalizedDot = new Vector3();\r\n\r\nBaseVector.inherit(Vector4, 4);\r\nF64BaseVector.inherit(Vector3, 3);\r\nBaseVector.inherit(Vector2, 2);\r\n\r\nlookat_cache_vs3 = util.cachering.fromConstructor(Vector3, 64);\r\nlookat_cache_vs4 = util.cachering.fromConstructor(Vector4, 64);\r\n\r\nmakenormalcache = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nvar $_v3nd_n1_normalizedDot = new Vector3();\r\nvar $_v3nd_n2_normalizedDot = new Vector3();\r\nvar $_v3nd4_n1_normalizedDot4 = new Vector3();\r\nvar $_v3nd4_n2_normalizedDot4 = new Vector3();\r\nvar $_v3nd4_n1_normalizedDot3 = new Vector3();\r\nvar $_v3nd4_n2_normalizedDot3 = new Vector3();\r\n\r\nvar M_SQRT2 = Math.sqrt(2.0);\r\nvar FLT_EPSILON = 2.22e-16;\r\n\r\nclass internal_matrix {\r\n  constructor() {\r\n    this.m11 = 1.0;\r\n    this.m12 = 0.0;\r\n    this.m13 = 0.0;\r\n    this.m14 = 0.0;\r\n    this.m21 = 0.0;\r\n    this.m22 = 1.0;\r\n    this.m23 = 0.0;\r\n    this.m24 = 0.0;\r\n    this.m31 = 0.0;\r\n    this.m32 = 0.0;\r\n    this.m33 = 1.0;\r\n    this.m34 = 0.0;\r\n    this.m41 = 0.0;\r\n    this.m42 = 0.0;\r\n    this.m43 = 0.0;\r\n    this.m44 = 1.0;\r\n  }\r\n}\r\n\r\nvar lookat_cache_vs3;\r\nvar lookat_cache_vs4;\r\nvar lookat_cache_ms;\r\nvar euler_rotate_mats;\r\nvar makenormalcache;\r\nvar temp_mats;\r\n\r\nlet preMultTemp;\r\n\r\nexport class Matrix4 {\r\n  constructor(m) {\r\n    this.$matrix = new internal_matrix();\r\n    this.isPersp = false;\r\n\r\n    if (typeof m === 'object') {\r\n      if (\"length\" in m && m.length >= 16) {\r\n        this.load(m);\r\n      } else if (m instanceof Matrix4) {\r\n        this.load(m);\r\n      }\r\n    }\r\n  }\r\n\r\n  static fromJSON() {\r\n    var mat = new Matrix4();\r\n    mat.load(json.items);\r\n    mat.isPersp = json.isPersp;\r\n    return mat;\r\n  }\r\n\r\n  copy() {\r\n    return this.clone();\r\n  }\r\n\r\n  clone() {\r\n    return new Matrix4(this);\r\n  }\r\n\r\n  addToHashDigest(hash) {\r\n    let m = this.$matrix;\r\n\r\n    hash.add(m.m11);\r\n    hash.add(m.m12);\r\n    hash.add(m.m13);\r\n    hash.add(m.m14);\r\n\r\n    hash.add(m.m21);\r\n    hash.add(m.m22);\r\n    hash.add(m.m23);\r\n    hash.add(m.m24);\r\n\r\n    hash.add(m.m31);\r\n    hash.add(m.m32);\r\n    hash.add(m.m33);\r\n    hash.add(m.m34);\r\n\r\n    hash.add(m.m41);\r\n    hash.add(m.m42);\r\n    hash.add(m.m43);\r\n    hash.add(m.m44);\r\n\r\n    return this;\r\n  }\r\n\r\n  equals(m) {\r\n    let m1 = this.$matrix;\r\n    let m2 = m.$matrix;\r\n\r\n    let ok = 1;\r\n\r\n    ok = ok && m1.m11 === m2.m11;\r\n    ok = ok && m1.m12 === m2.m12;\r\n    ok = ok && m1.m13 === m2.m13;\r\n    ok = ok && m1.m14 === m2.m14;\r\n\r\n    ok = ok && m1.m21 === m2.m21;\r\n    ok = ok && m1.m22 === m2.m22;\r\n    ok = ok && m1.m23 === m2.m23;\r\n    ok = ok && m1.m24 === m2.m24;\r\n\r\n    ok = ok && m1.m31 === m2.m31;\r\n    ok = ok && m1.m32 === m2.m32;\r\n    ok = ok && m1.m33 === m2.m33;\r\n    ok = ok && m1.m34 === m2.m34;\r\n\r\n    ok = ok && m1.m41 === m2.m41;\r\n    ok = ok && m1.m42 === m2.m42;\r\n    ok = ok && m1.m43 === m2.m43;\r\n    ok = ok && m1.m44 === m2.m44;\r\n\r\n    return ok;\r\n  }\r\n\r\n  loadColumn(i, vec) {\r\n    let m = this.$matrix;\r\n    let have4 = vec.length > 3;\r\n\r\n    switch (i) {\r\n      case 0:\r\n        m.m11 = vec[0];\r\n        m.m21 = vec[1];\r\n        m.m31 = vec[2];\r\n        if (have4) {\r\n          m.m41 = vec[3];\r\n        }\r\n        break;\r\n      case 1:\r\n        m.m12 = vec[0];\r\n        m.m22 = vec[1];\r\n        m.m32 = vec[2];\r\n        if (have4) {\r\n          m.m42 = vec[3];\r\n        }\r\n        break;\r\n      case 2:\r\n        m.m13 = vec[0];\r\n        m.m23 = vec[1];\r\n        m.m33 = vec[2];\r\n        if (have4) {\r\n          m.m43 = vec[3];\r\n        }\r\n        break;\r\n      case 3:\r\n        m.m14 = vec[0];\r\n        m.m24 = vec[1];\r\n        m.m34 = vec[2];\r\n        if (have4) {\r\n          m.m44 = vec[3];\r\n        }\r\n        break;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  copyColumnTo(i, vec) {\r\n    let m = this.$matrix;\r\n    let have4 = vec.length > 3;\r\n\r\n    switch (i) {\r\n      case 0:\r\n        vec[0] = m.m11;\r\n        vec[1] = m.m21;\r\n        vec[2] = m.m31;\r\n        if (have4) {\r\n          vec[3] = m.m41;\r\n        }\r\n        break;\r\n      case 1:\r\n        vec[0] = m.m12;\r\n        vec[1] = m.m22;\r\n        vec[2] = m.m32;\r\n        if (have4) {\r\n          vec[3] = m.m42;\r\n        }\r\n        break;\r\n      case 2:\r\n        vec[0] = m.m13;\r\n        vec[1] = m.m23;\r\n        vec[2] = m.m33;\r\n        if (have4) {\r\n          vec[3] = m.m43;\r\n        }\r\n        break;\r\n      case 3:\r\n        vec[0] = m.m14;\r\n        vec[1] = m.m24;\r\n        vec[2] = m.m34;\r\n        if (have4) {\r\n          vec[3] = m.m44;\r\n        }\r\n        break;\r\n    }\r\n\r\n    return vec;\r\n  }\r\n\r\n  copyColumn(i) {\r\n    return this.copyColumnTo(i, new Vector3());\r\n  }\r\n\r\n  load() {\r\n    if (arguments.length === 1 && typeof arguments[0] === 'object') {\r\n      var matrix;\r\n      if (arguments[0] instanceof Matrix4) {\r\n        matrix = arguments[0].$matrix;\r\n        this.isPersp = arguments[0].isPersp;\r\n        this.$matrix.m11 = matrix.m11;\r\n        this.$matrix.m12 = matrix.m12;\r\n        this.$matrix.m13 = matrix.m13;\r\n        this.$matrix.m14 = matrix.m14;\r\n        this.$matrix.m21 = matrix.m21;\r\n        this.$matrix.m22 = matrix.m22;\r\n        this.$matrix.m23 = matrix.m23;\r\n        this.$matrix.m24 = matrix.m24;\r\n        this.$matrix.m31 = matrix.m31;\r\n        this.$matrix.m32 = matrix.m32;\r\n        this.$matrix.m33 = matrix.m33;\r\n        this.$matrix.m34 = matrix.m34;\r\n        this.$matrix.m41 = matrix.m41;\r\n        this.$matrix.m42 = matrix.m42;\r\n        this.$matrix.m43 = matrix.m43;\r\n        this.$matrix.m44 = matrix.m44;\r\n        return this;\r\n      } else\r\n        matrix = arguments[0];\r\n      if (\"length\" in matrix && matrix.length >= 16) {\r\n        this.$matrix.m11 = matrix[0];\r\n        this.$matrix.m12 = matrix[1];\r\n        this.$matrix.m13 = matrix[2];\r\n        this.$matrix.m14 = matrix[3];\r\n        this.$matrix.m21 = matrix[4];\r\n        this.$matrix.m22 = matrix[5];\r\n        this.$matrix.m23 = matrix[6];\r\n        this.$matrix.m24 = matrix[7];\r\n        this.$matrix.m31 = matrix[8];\r\n        this.$matrix.m32 = matrix[9];\r\n        this.$matrix.m33 = matrix[10];\r\n        this.$matrix.m34 = matrix[11];\r\n        this.$matrix.m41 = matrix[12];\r\n        this.$matrix.m42 = matrix[13];\r\n        this.$matrix.m43 = matrix[14];\r\n        this.$matrix.m44 = matrix[15];\r\n        return this;\r\n      }\r\n    }\r\n\r\n    this.makeIdentity();\r\n\r\n    return this;\r\n  }\r\n\r\n  toJSON() {\r\n    return {isPersp: this.isPersp, items: this.getAsArray()}\r\n  }\r\n\r\n  getAsArray() {\r\n    return [this.$matrix.m11, this.$matrix.m12, this.$matrix.m13, this.$matrix.m14, this.$matrix.m21, this.$matrix.m22,\r\n            this.$matrix.m23, this.$matrix.m24, this.$matrix.m31, this.$matrix.m32, this.$matrix.m33, this.$matrix.m34,\r\n            this.$matrix.m41, this.$matrix.m42, this.$matrix.m43, this.$matrix.m44];\r\n  }\r\n\r\n  getAsFloat32Array() {\r\n    return new Float32Array(this.getAsArray());\r\n  }\r\n\r\n  setUniform(ctx, loc, transpose) {\r\n    if (Matrix4.setUniformArray === undefined) {\r\n      Matrix4.setUniformWebGLArray = new Float32Array(16);\r\n      Matrix4.setUniformArray = new Array(16);\r\n    }\r\n\r\n    Matrix4.setUniformArray[0] = this.$matrix.m11;\r\n    Matrix4.setUniformArray[1] = this.$matrix.m12;\r\n    Matrix4.setUniformArray[2] = this.$matrix.m13;\r\n    Matrix4.setUniformArray[3] = this.$matrix.m14;\r\n    Matrix4.setUniformArray[4] = this.$matrix.m21;\r\n    Matrix4.setUniformArray[5] = this.$matrix.m22;\r\n    Matrix4.setUniformArray[6] = this.$matrix.m23;\r\n    Matrix4.setUniformArray[7] = this.$matrix.m24;\r\n    Matrix4.setUniformArray[8] = this.$matrix.m31;\r\n    Matrix4.setUniformArray[9] = this.$matrix.m32;\r\n    Matrix4.setUniformArray[10] = this.$matrix.m33;\r\n    Matrix4.setUniformArray[11] = this.$matrix.m34;\r\n    Matrix4.setUniformArray[12] = this.$matrix.m41;\r\n    Matrix4.setUniformArray[13] = this.$matrix.m42;\r\n    Matrix4.setUniformArray[14] = this.$matrix.m43;\r\n    Matrix4.setUniformArray[15] = this.$matrix.m44;\r\n\r\n    Matrix4.setUniformWebGLArray.set(Matrix4.setUniformArray);\r\n\r\n    ctx.uniformMatrix4fv(loc, transpose, Matrix4.setUniformWebGLArray);\r\n\r\n    return this;\r\n  }\r\n\r\n  makeIdentity() {\r\n    this.$matrix.m11 = 1;\r\n    this.$matrix.m12 = 0;\r\n    this.$matrix.m13 = 0;\r\n    this.$matrix.m14 = 0;\r\n    this.$matrix.m21 = 0;\r\n    this.$matrix.m22 = 1;\r\n    this.$matrix.m23 = 0;\r\n    this.$matrix.m24 = 0;\r\n    this.$matrix.m31 = 0;\r\n    this.$matrix.m32 = 0;\r\n    this.$matrix.m33 = 1;\r\n    this.$matrix.m34 = 0;\r\n    this.$matrix.m41 = 0;\r\n    this.$matrix.m42 = 0;\r\n    this.$matrix.m43 = 0;\r\n    this.$matrix.m44 = 1;\r\n\r\n    //drop isPersp\r\n    this.isPersp = false;\r\n\r\n    return this;\r\n  }\r\n\r\n  transpose() {\r\n    var tmp = this.$matrix.m12;\r\n    this.$matrix.m12 = this.$matrix.m21;\r\n    this.$matrix.m21 = tmp;\r\n    tmp = this.$matrix.m13;\r\n    this.$matrix.m13 = this.$matrix.m31;\r\n    this.$matrix.m31 = tmp;\r\n    tmp = this.$matrix.m14;\r\n    this.$matrix.m14 = this.$matrix.m41;\r\n    this.$matrix.m41 = tmp;\r\n    tmp = this.$matrix.m23;\r\n    this.$matrix.m23 = this.$matrix.m32;\r\n    this.$matrix.m32 = tmp;\r\n    tmp = this.$matrix.m24;\r\n    this.$matrix.m24 = this.$matrix.m42;\r\n    this.$matrix.m42 = tmp;\r\n    tmp = this.$matrix.m34;\r\n    this.$matrix.m34 = this.$matrix.m43;\r\n    this.$matrix.m43 = tmp;\r\n\r\n    return this;\r\n  }\r\n\r\n  determinant() {\r\n    return this._determinant4x4();\r\n  }\r\n\r\n  invert() {\r\n    var det = this._determinant4x4();\r\n\r\n    if (Math.abs(det) < 1e-08)\r\n      return null;\r\n\r\n    this._makeAdjoint();\r\n\r\n    this.$matrix.m11 /= det;\r\n    this.$matrix.m12 /= det;\r\n    this.$matrix.m13 /= det;\r\n    this.$matrix.m14 /= det;\r\n    this.$matrix.m21 /= det;\r\n    this.$matrix.m22 /= det;\r\n    this.$matrix.m23 /= det;\r\n    this.$matrix.m24 /= det;\r\n    this.$matrix.m31 /= det;\r\n    this.$matrix.m32 /= det;\r\n    this.$matrix.m33 /= det;\r\n    this.$matrix.m34 /= det;\r\n    this.$matrix.m41 /= det;\r\n    this.$matrix.m42 /= det;\r\n    this.$matrix.m43 /= det;\r\n    this.$matrix.m44 /= det;\r\n\r\n    return this;\r\n  }\r\n\r\n  translate(x, y, z) {\r\n    if (typeof x === 'object' && \"length\" in x) {\r\n      var t = x;\r\n\r\n      x = t[0];\r\n      y = t[1];\r\n      z = t[2];\r\n    }\r\n\r\n    x = x === undefined ? 0 : x;\r\n    y = y === undefined ? 0 : y;\r\n    z = z === undefined ? 0 : z;\r\n\r\n    var matrix = temp_mats.next().makeIdentity();\r\n\r\n    matrix.$matrix.m41 = x;\r\n    matrix.$matrix.m42 = y;\r\n    matrix.$matrix.m43 = z;\r\n\r\n    this.multiply(matrix);\r\n    return this;\r\n  }\r\n\r\n  preTranslate(x, y, z) {\r\n    if (typeof x === 'object' && \"length\" in x) {\r\n      var t = x;\r\n\r\n      x = t[0];\r\n      y = t[1];\r\n      z = t[2];\r\n    }\r\n\r\n    x = x === undefined ? 0 : x;\r\n    y = y === undefined ? 0 : y;\r\n    z = z === undefined ? 0 : z;\r\n\r\n    var matrix = temp_mats.next().makeIdentity();\r\n\r\n    matrix.$matrix.m41 = x;\r\n    matrix.$matrix.m42 = y;\r\n    matrix.$matrix.m43 = z;\r\n\r\n    this.preMultiply(matrix);\r\n    return this;\r\n  }\r\n\r\n  scale(x, y, z, w = 1.0) {\r\n    if (typeof x === 'object' && \"length\" in x) {\r\n      var t = x;\r\n      x = t[0];\r\n      y = t[1];\r\n      z = t[2];\r\n    } else {\r\n      if (x === undefined)\r\n        x = 1;\r\n\r\n      if (z === undefined) {\r\n        if (y === undefined) {\r\n          y = x;\r\n          z = x;\r\n        } else {\r\n          z = x;\r\n        }\r\n      } else if (y === undefined) {\r\n        y = x;\r\n      }\r\n    }\r\n\r\n\r\n    var matrix = temp_mats.next().makeIdentity();\r\n    matrix.$matrix.m11 = x;\r\n    matrix.$matrix.m22 = y;\r\n    matrix.$matrix.m33 = z;\r\n    matrix.$matrix.m44 = w;\r\n    this.multiply(matrix);\r\n    return this\r\n  }\r\n\r\n  preScale(x, y, z, w = 1.0) {\r\n    let mat = temp_mats.next().makeIdentity();\r\n    mat.scale(x, y, z, w);\r\n\r\n    this.preMultiply(mat);\r\n    return this\r\n  }\r\n\r\n  /*\r\n  on factor;\r\n  off period;\r\n\r\n  c1 := cx; comment: cos(thx);\r\n  s1 := sx; comment: sin(thx);\r\n\r\n  c2 := cy; comment: cos(thy);\r\n  s2 := sy; comment: sin(thy);\r\n\r\n  c3 := cz; comment: cos(thz);\r\n  s3 := sz; comment: sin(thz);\r\n\r\n  cx := cos(thx);\r\n  sx := sin(thx);\r\n  cy := cos(thy);\r\n  sy := sin(thy);\r\n  cz := cos(thz);\r\n  sz := sin(thz);\r\n\r\n  imat := mat((1, 0, 0, 0),\r\n              (0, 1, 0, 0),\r\n              (0, 0, 1, 0),\r\n              (0, 0, 0, 1));\r\n\r\n  xmat :=mat((1,  0,  0,  0),\r\n             (0, c1, -s1, 0),\r\n             (0, s1,  c1, 0),\r\n             (0,  0,  0,  0));\r\n\r\n  ymat :=mat((c2, 0, s2, 0),\r\n             (0,  1,  0,  0),\r\n             (-s2, 0,  c2, 0),\r\n             (0,  0,  0,  0));\r\n\r\n  zmat :=mat(( c3, -s3, 0, 0),\r\n             (s3, c3, 0, 0),\r\n             ( 0,  0,  1, 0),\r\n             ( 0,  0,  0, 0));\r\n\r\n  mmat := mat((m11, m21, m31, 0),\r\n              (m12, m22, m32, 0),\r\n              (m13, m23, m33, 0),\r\n              (0,   0,   0,   0));\r\n\r\n  fmat := zmat * ymat * xmat;\r\n\r\n  f1 := m11**2 + m12**2 + m13**2 - 1.0;\r\n  f2 := m21**2 + m22**2 + m23**2 - 1.0;\r\n  f3 := m31**2 + m32**2 + m33**2 - 1.0;\r\n\r\n  tmat := fmat * mmat;\r\n  f1 := tmat(1, 1) - 1.0;\r\n  f2 := tmat(2, 2) - 1.0;\r\n  f3 := tmat(3, 3) - 1.0;\r\n\r\n  operator myasin;\r\n\r\n  fthy := asin(mmat(3, 1));\r\n  f1 := mmat(3,1)**2 + mmat(2,1)**2 + mmat(1,1)**2 = 1.0;\r\n\r\n  fmat2 := sub(thy=fthy, fmat);\r\n\r\n  fmat3 := fmat2 * (tp mmat);\r\n  ffz := solve(fmat2(1, 1) - m11, thz);\r\n  ffx := solve(fmat2(3, 3) - m33, thx);\r\n\r\n  fthz := part(ffz, 1, 2);\r\n  fthx := part(ffx, 1, 2);\r\n\r\n  sub(thx=fthx, thy=fthy, thz=fthz, fmat);\r\n\r\n(cos(thy)*cos(thz),         cos(thx)*sin(thz)-cos(thz)*sin(thx)*sin(thy),  -(cos(thx)*cos(thz)*sin(thy)+sin(thx)*sin(thz)), 0),\r\n\r\n(-cos(thy)*sin(thz),        cos(thx)*cos(thz) + sin(thx)*sin(thy)*sin(thz),  cos(thx)*sin(thy)*sin(thz)-cos(thz)*sin(thx), 0),\r\n\r\n(sin(thy),                  cos(thy)*sin(thx),                               cos(thx)*cos(thy),  0),\r\n\r\n    (0,0,0,1))\r\n\r\n  */\r\n\r\n  euler_rotate_order(x, y, z, order = EulerOrders.XYZ) {\r\n    if (y === undefined) {\r\n      y = 0.0;\r\n    }\r\n    if (z === undefined) {\r\n      z = 0.0;\r\n    }\r\n\r\n    x = -x;\r\n    y = -y;\r\n    z = -z;\r\n\r\n    let xmat = euler_rotate_mats.next().makeIdentity();\r\n\r\n    let m = xmat.$matrix;\r\n\r\n    let c = Math.cos(x), s = Math.sin(x);\r\n\r\n    m.m22 = c;\r\n    m.m23 = s;\r\n    m.m32 = -s;\r\n    m.m33 = c;\r\n\r\n    let ymat = euler_rotate_mats.next().makeIdentity();\r\n    c = Math.cos(y);\r\n    s = Math.sin(y);\r\n    m = ymat.$matrix;\r\n\r\n    m.m11 = c;\r\n    m.m13 = -s;\r\n    m.m31 = s;\r\n    m.m33 = c;\r\n\r\n    let zmat = euler_rotate_mats.next().makeIdentity();\r\n    c = Math.cos(z);\r\n    s = Math.sin(z);\r\n    m = zmat.$matrix;\r\n\r\n    m.m11 = c;\r\n    m.m12 = s;\r\n    m.m21 = -s;\r\n    m.m22 = c;\r\n\r\n    let a, b;\r\n\r\n    switch (order) {\r\n      case EulerOrders.XYZ:\r\n        a = xmat;\r\n        b = ymat;\r\n        c = zmat;\r\n        break;\r\n      case EulerOrders.XZY:\r\n        a = xmat;\r\n        b = zmat;\r\n        c = ymat;\r\n        break;\r\n      case EulerOrders.YXZ:\r\n        a = ymat;\r\n        b = xmat;\r\n        c = zmat;\r\n        break;\r\n      case EulerOrders.YZX:\r\n        a = ymat;\r\n        b = zmat;\r\n        c = xmat;\r\n        break;\r\n      case EulerOrders.ZXY:\r\n        a = zmat;\r\n        b = xmat;\r\n        c = ymat;\r\n        break;\r\n      case EulerOrders.ZYX:\r\n        a = zmat;\r\n        b = ymat;\r\n        c = xmat;\r\n        break;\r\n    }\r\n\r\n    b.preMultiply(c);\r\n    b.multiply(a);\r\n\r\n    this.preMultiply(b);\r\n\r\n    return this;\r\n  }\r\n\r\n  euler_rotate(x, y, z) {\r\n    if (y === undefined) {\r\n      y = 0.0;\r\n    }\r\n    if (z === undefined) {\r\n      z = 0.0;\r\n    }\r\n    window.Matrix4 = Matrix4;\r\n\r\n    var xmat = euler_rotate_mats.next().makeIdentity();\r\n    var m = xmat.$matrix;\r\n\r\n    var c = Math.cos(x), s = Math.sin(x);\r\n\r\n    m.m22 = c;\r\n    m.m23 = s;\r\n    m.m32 = -s;\r\n    m.m33 = c;\r\n\r\n    var ymat = euler_rotate_mats.next().makeIdentity();\r\n    c = Math.cos(y);\r\n    s = Math.sin(y);\r\n    var m = ymat.$matrix;\r\n\r\n    m.m11 = c;\r\n    m.m13 = -s;\r\n    m.m31 = s;\r\n    m.m33 = c;\r\n\r\n    ymat.multiply(xmat);\r\n\r\n    var zmat = euler_rotate_mats.next().makeIdentity();\r\n    c = Math.cos(z);\r\n    s = Math.sin(z);\r\n    var m = zmat.$matrix;\r\n\r\n    m.m11 = c;\r\n    m.m12 = s;\r\n    m.m21 = -s;\r\n    m.m22 = c;\r\n\r\n    zmat.multiply(ymat);\r\n\r\n    //console.log(\"\"+ymat);\r\n    //this.multiply(zmat);\r\n    this.preMultiply(zmat);\r\n\r\n    return this;\r\n  }\r\n\r\n  toString() {\r\n    var s = \"\"\r\n    var m = this.$matrix;\r\n\r\n    function dec(d) {\r\n      var ret = d.toFixed(3);\r\n\r\n      if (ret[0] !== \"-\") //make room for negative signs\r\n        ret = \" \" + ret\r\n      return ret\r\n    }\r\n\r\n    s = dec(m.m11) + \", \" + dec(m.m12) + \", \" + dec(m.m13) + \", \" + dec(m.m14) + \"\\n\";\r\n    s += dec(m.m21) + \", \" + dec(m.m22) + \", \" + dec(m.m23) + \", \" + dec(m.m24) + \"\\n\";\r\n    s += dec(m.m31) + \", \" + dec(m.m32) + \", \" + dec(m.m33) + \", \" + dec(m.m34) + \"\\n\";\r\n    s += dec(m.m41) + \", \" + dec(m.m42) + \", \" + dec(m.m43) + \", \" + dec(m.m44) + \"\\n\";\r\n\r\n    return s\r\n  }\r\n\r\n  rotate(angle, x, y, z) {\r\n    if (typeof x === 'object' && \"length\" in x) {\r\n      var t = x;\r\n      x = t[0];\r\n      y = t[1];\r\n      z = t[2];\r\n    } else {\r\n      if (arguments.length === 1) {\r\n        x = y = 0;\r\n        z = 1;\r\n      } else if (arguments.length === 3) {\r\n        this.rotate(angle, 1, 0, 0);\r\n        this.rotate(x, 0, 1, 0);\r\n        this.rotate(y, 0, 0, 1);\r\n        return;\r\n      }\r\n    }\r\n\r\n    angle /= 2;\r\n    var sinA = Math.sin(angle);\r\n    var cosA = Math.cos(angle);\r\n    var sinA2 = sinA*sinA;\r\n    var len = Math.sqrt(x*x + y*y + z*z);\r\n\r\n    if (len === 0) {\r\n      x = 0;\r\n      y = 0;\r\n      z = 1;\r\n    } else if (len !== 1) {\r\n      x /= len;\r\n      y /= len;\r\n      z /= len;\r\n    }\r\n\r\n    var mat = temp_mats.next().makeIdentity();\r\n\r\n    if (x === 1 && y === 0 && z === 0) {\r\n      mat.$matrix.m11 = 1;\r\n      mat.$matrix.m12 = 0;\r\n      mat.$matrix.m13 = 0;\r\n      mat.$matrix.m21 = 0;\r\n      mat.$matrix.m22 = 1 - 2*sinA2;\r\n      mat.$matrix.m23 = 2*sinA*cosA;\r\n      mat.$matrix.m31 = 0;\r\n      mat.$matrix.m32 = -2*sinA*cosA;\r\n      mat.$matrix.m33 = 1 - 2*sinA2;\r\n      mat.$matrix.m14 = mat.$matrix.m24 = mat.$matrix.m34 = 0;\r\n      mat.$matrix.m41 = mat.$matrix.m42 = mat.$matrix.m43 = 0;\r\n      mat.$matrix.m44 = 1;\r\n    } else if (x === 0 && y === 1 && z === 0) {\r\n      mat.$matrix.m11 = 1 - 2*sinA2;\r\n      mat.$matrix.m12 = 0;\r\n      mat.$matrix.m13 = -2*sinA*cosA;\r\n      mat.$matrix.m21 = 0;\r\n      mat.$matrix.m22 = 1;\r\n      mat.$matrix.m23 = 0;\r\n      mat.$matrix.m31 = 2*sinA*cosA;\r\n      mat.$matrix.m32 = 0;\r\n      mat.$matrix.m33 = 1 - 2*sinA2;\r\n      mat.$matrix.m14 = mat.$matrix.m24 = mat.$matrix.m34 = 0;\r\n      mat.$matrix.m41 = mat.$matrix.m42 = mat.$matrix.m43 = 0;\r\n      mat.$matrix.m44 = 1;\r\n    } else if (x === 0 && y === 0 && z === 1) {\r\n      mat.$matrix.m11 = 1 - 2*sinA2;\r\n      mat.$matrix.m12 = 2*sinA*cosA;\r\n      mat.$matrix.m13 = 0;\r\n      mat.$matrix.m21 = -2*sinA*cosA;\r\n      mat.$matrix.m22 = 1 - 2*sinA2;\r\n      mat.$matrix.m23 = 0;\r\n      mat.$matrix.m31 = 0;\r\n      mat.$matrix.m32 = 0;\r\n      mat.$matrix.m33 = 1;\r\n      mat.$matrix.m14 = mat.$matrix.m24 = mat.$matrix.m34 = 0;\r\n      mat.$matrix.m41 = mat.$matrix.m42 = mat.$matrix.m43 = 0;\r\n      mat.$matrix.m44 = 1;\r\n    } else {\r\n      var x2 = x*x;\r\n      var y2 = y*y;\r\n      var z2 = z*z;\r\n      mat.$matrix.m11 = 1 - 2*(y2 + z2)*sinA2;\r\n      mat.$matrix.m12 = 2*(x*y*sinA2 + z*sinA*cosA);\r\n      mat.$matrix.m13 = 2*(x*z*sinA2 - y*sinA*cosA);\r\n      mat.$matrix.m21 = 2*(y*x*sinA2 - z*sinA*cosA);\r\n      mat.$matrix.m22 = 1 - 2*(z2 + x2)*sinA2;\r\n      mat.$matrix.m23 = 2*(y*z*sinA2 + x*sinA*cosA);\r\n      mat.$matrix.m31 = 2*(z*x*sinA2 + y*sinA*cosA);\r\n      mat.$matrix.m32 = 2*(z*y*sinA2 - x*sinA*cosA);\r\n      mat.$matrix.m33 = 1 - 2*(x2 + y2)*sinA2;\r\n      mat.$matrix.m14 = mat.$matrix.m24 = mat.$matrix.m34 = 0;\r\n      mat.$matrix.m41 = mat.$matrix.m42 = mat.$matrix.m43 = 0;\r\n      mat.$matrix.m44 = 1;\r\n    }\r\n    this.multiply(mat);\r\n\r\n    return this;\r\n  }\r\n\r\n  normalize() {\r\n    let m = this.$matrix;\r\n\r\n    let v1 = new Vector4([m.m11, m.m12, m.m13, m.m14]);\r\n    let v2 = new Vector4([m.m21, m.m22, m.m23, m.m24]);\r\n    let v3 = new Vector4([m.m31, m.m32, m.m33, m.m34]);\r\n    let v4 = new Vector4([m.m41, m.m42, m.m43, m.m44]);\r\n\r\n    v1.normalize();\r\n    v2.normalize();\r\n    v3.normalize();\r\n\r\n    let flat = new Array().concat(v1).concat(v2).concat(v3).concat(v4);\r\n    this.load(flat);\r\n\r\n    return this;\r\n  }\r\n\r\n  clearTranslation(set_w_to_one = false) {\r\n    let m = this.$matrix;\r\n\r\n    m.m41 = m.m42 = m.m43 = 0.0;\r\n\r\n    if (set_w_to_one) {\r\n      m.m44 = 1.0;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  setTranslation(x, y, z, resetW = true) {\r\n    if (typeof x === \"object\") {\r\n      y = x[1];\r\n      z = x[2];\r\n      x = x[0];\r\n    }\r\n\r\n    let m = this.$matrix;\r\n\r\n    m.m41 = x;\r\n    m.m42 = y;\r\n    m.m43 = z;\r\n\r\n    if (resetW) {\r\n      m.m44 = 1.0;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  //this is really like the lookAt method, isn't it.\r\n  makeNormalMatrix(normal, up = undefined) {\r\n    if (normal === undefined) {\r\n      throw new Error(\"normal cannot be undefined\");\r\n    }\r\n\r\n    let n = makenormalcache.next().load(normal).normalize();\r\n\r\n    if (up === undefined) {\r\n      up = makenormalcache.next().zero();\r\n\r\n      if (Math.abs(n[2]) > 0.95) {\r\n        up[1] = 1.0;\r\n      } else {\r\n        up[2] = 1.0;\r\n      }\r\n    }\r\n\r\n    up = makenormalcache.next().load(up);\r\n\r\n    up.normalize();\r\n\r\n    if (up.dot(normal) > 0.99) {\r\n      this.makeIdentity();\r\n      return this;\r\n    } else if (up.dot(normal) < -0.99) {\r\n      this.makeIdentity();\r\n      this.scale(1.0, 1.0, -1.0);\r\n      return this;\r\n    }\r\n\r\n    let x = makenormalcache.next();\r\n    let y = makenormalcache.next();\r\n\r\n    x.load(n).cross(up).normalize();\r\n    y.load(x).cross(n).normalize();\r\n    //y.negate();\r\n\r\n    this.makeIdentity();\r\n    let m = this.$matrix;\r\n\r\n    m.m11 = x[0];\r\n    m.m12 = x[1];\r\n    m.m13 = x[2];\r\n\r\n    m.m21 = y[0];\r\n    m.m22 = y[1];\r\n    m.m23 = y[2];\r\n\r\n    m.m31 = n[0];\r\n    m.m32 = n[1];\r\n    m.m33 = n[2];\r\n    m.m44 = 1.0;\r\n\r\n    return this;\r\n  }\r\n\r\n  preMultiply(mat) {\r\n    preMultTemp.load(mat);\r\n    preMultTemp.multiply(this);\r\n\r\n    this.load(preMultTemp);\r\n\r\n    return this;\r\n  }\r\n\r\n  multiply(mat) {\r\n    let mm = this.$matrix;\r\n    let mm2 = mat.$matrix;\r\n\r\n    let m11 = (mm2.m11*mm.m11 + mm2.m12*mm.m21 + mm2.m13*mm.m31 + mm2.m14*mm.m41);\r\n    let m12 = (mm2.m11*mm.m12 + mm2.m12*mm.m22 + mm2.m13*mm.m32 + mm2.m14*mm.m42);\r\n    let m13 = (mm2.m11*mm.m13 + mm2.m12*mm.m23 + mm2.m13*mm.m33 + mm2.m14*mm.m43);\r\n    let m14 = (mm2.m11*mm.m14 + mm2.m12*mm.m24 + mm2.m13*mm.m34 + mm2.m14*mm.m44);\r\n    let m21 = (mm2.m21*mm.m11 + mm2.m22*mm.m21 + mm2.m23*mm.m31 + mm2.m24*mm.m41);\r\n    let m22 = (mm2.m21*mm.m12 + mm2.m22*mm.m22 + mm2.m23*mm.m32 + mm2.m24*mm.m42);\r\n    let m23 = (mm2.m21*mm.m13 + mm2.m22*mm.m23 + mm2.m23*mm.m33 + mm2.m24*mm.m43);\r\n    let m24 = (mm2.m21*mm.m14 + mm2.m22*mm.m24 + mm2.m23*mm.m34 + mm2.m24*mm.m44);\r\n    let m31 = (mm2.m31*mm.m11 + mm2.m32*mm.m21 + mm2.m33*mm.m31 + mm2.m34*mm.m41);\r\n    let m32 = (mm2.m31*mm.m12 + mm2.m32*mm.m22 + mm2.m33*mm.m32 + mm2.m34*mm.m42);\r\n    let m33 = (mm2.m31*mm.m13 + mm2.m32*mm.m23 + mm2.m33*mm.m33 + mm2.m34*mm.m43);\r\n    let m34 = (mm2.m31*mm.m14 + mm2.m32*mm.m24 + mm2.m33*mm.m34 + mm2.m34*mm.m44);\r\n    let m41 = (mm2.m41*mm.m11 + mm2.m42*mm.m21 + mm2.m43*mm.m31 + mm2.m44*mm.m41);\r\n    let m42 = (mm2.m41*mm.m12 + mm2.m42*mm.m22 + mm2.m43*mm.m32 + mm2.m44*mm.m42);\r\n    let m43 = (mm2.m41*mm.m13 + mm2.m42*mm.m23 + mm2.m43*mm.m33 + mm2.m44*mm.m43);\r\n    let m44 = (mm2.m41*mm.m14 + mm2.m42*mm.m24 + mm2.m43*mm.m34 + mm2.m44*mm.m44);\r\n\r\n    mm.m11 = m11;\r\n    mm.m12 = m12;\r\n    mm.m13 = m13;\r\n    mm.m14 = m14;\r\n    mm.m21 = m21;\r\n    mm.m22 = m22;\r\n    mm.m23 = m23;\r\n    mm.m24 = m24;\r\n    mm.m31 = m31;\r\n    mm.m32 = m32;\r\n    mm.m33 = m33;\r\n    mm.m34 = m34;\r\n    mm.m41 = m41;\r\n    mm.m42 = m42;\r\n    mm.m43 = m43;\r\n    mm.m44 = m44;\r\n\r\n    return this;\r\n  }\r\n\r\n  divide(divisor) {\r\n    this.$matrix.m11 /= divisor;\r\n    this.$matrix.m12 /= divisor;\r\n    this.$matrix.m13 /= divisor;\r\n    this.$matrix.m14 /= divisor;\r\n    this.$matrix.m21 /= divisor;\r\n    this.$matrix.m22 /= divisor;\r\n    this.$matrix.m23 /= divisor;\r\n    this.$matrix.m24 /= divisor;\r\n    this.$matrix.m31 /= divisor;\r\n    this.$matrix.m32 /= divisor;\r\n    this.$matrix.m33 /= divisor;\r\n    this.$matrix.m34 /= divisor;\r\n    this.$matrix.m41 /= divisor;\r\n    this.$matrix.m42 /= divisor;\r\n    this.$matrix.m43 /= divisor;\r\n    this.$matrix.m44 /= divisor;\r\n\r\n    return this;\r\n  }\r\n\r\n  ortho(left, right, bottom, top, near, far) {\r\n    console.warn(\"Matrix4.ortho() is deprecated, use .orthographic() instead\");\r\n\r\n    var tx = (left + right)/(left - right);\r\n    var ty = (top + bottom)/(top - bottom);\r\n    var tz = (far + near)/(far - near);\r\n    var matrix = temp_mats.next().makeIdentity();\r\n\r\n    matrix.$matrix.m11 = 2/(left - right);\r\n    matrix.$matrix.m12 = 0;\r\n    matrix.$matrix.m13 = 0;\r\n    matrix.$matrix.m14 = 0;\r\n    matrix.$matrix.m21 = 0;\r\n    matrix.$matrix.m22 = 2/(top - bottom);\r\n    matrix.$matrix.m23 = 0;\r\n    matrix.$matrix.m24 = 0;\r\n    matrix.$matrix.m31 = 0;\r\n    matrix.$matrix.m32 = 0;\r\n    matrix.$matrix.m33 = -2/(far - near);\r\n    matrix.$matrix.m34 = 0;\r\n    matrix.$matrix.m41 = tx;\r\n    matrix.$matrix.m42 = ty;\r\n    matrix.$matrix.m43 = tz;\r\n    matrix.$matrix.m44 = 1;\r\n\r\n    this.multiply(matrix);\r\n\r\n    return this;\r\n  }\r\n\r\n  frustum(left, right, bottom, top, near, far) {\r\n    var matrix = temp_mats.next().makeIdentity();\r\n\r\n    var A = (right + left)/(right - left);\r\n    var B = (top + bottom)/(top - bottom);\r\n    var C = -(far + near)/(far - near);\r\n    var D = -(2*far*near)/(far - near);\r\n\r\n    matrix.$matrix.m11 = (2*near)/(right - left);\r\n    matrix.$matrix.m12 = 0;\r\n    matrix.$matrix.m13 = 0;\r\n    matrix.$matrix.m14 = 0;\r\n    matrix.$matrix.m21 = 0;\r\n    matrix.$matrix.m22 = 2*near/(top - bottom);\r\n    matrix.$matrix.m23 = 0;\r\n    matrix.$matrix.m24 = 0;\r\n    matrix.$matrix.m31 = A;\r\n    matrix.$matrix.m32 = B;\r\n    matrix.$matrix.m33 = C;\r\n    matrix.$matrix.m34 = -1;\r\n    matrix.$matrix.m41 = 0;\r\n    matrix.$matrix.m42 = 0;\r\n    matrix.$matrix.m43 = D;\r\n    matrix.$matrix.m44 = 0;\r\n\r\n    this.isPersp = true;\r\n    this.multiply(matrix);\r\n\r\n    return this;\r\n  }\r\n\r\n  orthographic(scale, aspect, near, far) {\r\n    let mat = temp_mats.next().makeIdentity();\r\n\r\n    let zscale = far - near;\r\n\r\n    mat.scale(2.0/aspect, 2.0, -1.0/scale/zscale, 1.0/scale);\r\n    mat.translate(0.0, 0.0, 0.5*zscale - near);\r\n\r\n    this.isPersp = true; //we still make use of auto homogenous divide in BaseVector.multVecMatrix\r\n    this.multiply(mat);\r\n\r\n    return mat;\r\n  }\r\n\r\n  perspective(fovy, aspect, zNear, zFar) {\r\n    var top = Math.tan(fovy*Math.PI/360)*zNear;\r\n    var bottom = -top;\r\n    var left = aspect*bottom;\r\n    var right = aspect*top;\r\n\r\n    this.frustum(left, right, bottom, top, zNear, zFar);\r\n\r\n    return this;\r\n  }\r\n\r\n  lookat(pos, target, up) {\r\n    var matrix = lookat_cache_ms.next();\r\n    matrix.makeIdentity();\r\n\r\n    var vec = lookat_cache_vs3.next().load(pos).sub(target);\r\n    var len = vec.vectorLength();\r\n    vec.normalize();\r\n\r\n    var zvec = vec;\r\n    var yvec = lookat_cache_vs3.next().load(up).normalize();\r\n    var xvec = lookat_cache_vs3.next().load(yvec).cross(zvec).normalize();\r\n\r\n    let mm = matrix.$matrix;\r\n\r\n    mm.m11 = xvec[0];\r\n    mm.m12 = yvec[0];\r\n    mm.m13 = zvec[0];\r\n    mm.m14 = 0;\r\n    mm.m21 = xvec[1];\r\n    mm.m22 = yvec[1];\r\n    mm.m23 = zvec[1];\r\n    mm.m24 = 0;\r\n    mm.m31 = xvec[2];\r\n    mm.m32 = yvec[2];\r\n    mm.m33 = zvec[2];\r\n\r\n    //*\r\n    mm.m11 = xvec[0];\r\n    mm.m12 = xvec[1];\r\n    mm.m13 = xvec[2];\r\n    mm.m14 = 0;\r\n    mm.m21 = yvec[0];\r\n    mm.m22 = yvec[1];\r\n    mm.m23 = yvec[2];\r\n    mm.m24 = 0;\r\n    mm.m31 = zvec[0];\r\n    mm.m32 = zvec[1];\r\n    mm.m33 = zvec[2];\r\n    mm.m34 = 0;\r\n    mm.m41 = pos[0];\r\n    mm.m42 = pos[1];\r\n    mm.m43 = pos[2];\r\n    mm.m44 = 1;\r\n    //*/\r\n\r\n    this.multiply(matrix);\r\n\r\n\r\n    return this;\r\n  }\r\n\r\n  makeRotationOnly() {\r\n    var m = this.$matrix;\r\n\r\n    m.m41 = m.m42 = m.m43 = 0.0;\r\n    m.m44 = 1.0;\r\n\r\n    let l1 = Math.sqrt(m.m11*m.m11 + m.m12*m.m12 + m.m13*m.m13);\r\n    let l2 = Math.sqrt(m.m21*m.m21 + m.m22*m.m22 + m.m23*m.m23);\r\n    let l3 = Math.sqrt(m.m31*m.m31 + m.m32*m.m32 + m.m33*m.m33);\r\n\r\n    if (l1) {\r\n      m.m11 /= l1;\r\n      m.m12 /= l1;\r\n      m.m13 /= l1;\r\n    }\r\n\r\n    if (l2) {\r\n      m.m21 /= l2;\r\n      m.m22 /= l2;\r\n      m.m23 /= l2;\r\n    }\r\n\r\n    if (l3) {\r\n      m.m31 /= l3;\r\n      m.m32 /= l3;\r\n      m.m33 /= l3;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  alignAxis(axis, vec) {\r\n    vec = new Vector3(vec);\r\n    vec.normalize();\r\n\r\n    let mat = this.inputs.transformMatrix.getValue();\r\n    let m = mat.$matrix;\r\n\r\n    let mat2 = new Matrix4(mat);\r\n    let loc = new Vector3(), scale = new Vector3(), rot = new Vector3();\r\n\r\n    //we don't use rot\r\n    mat2.decompose(loc, rot, scale);\r\n\r\n    mat2.makeRotationOnly();\r\n    let axes = mat2.getAsVecs();\r\n\r\n    let axis2 = (axis + 1) % 3;\r\n    let axis3 = (axis + 2) % 3;\r\n\r\n    axes[axis].load(vec)\r\n    axes[axis2].cross(axes[axis]).cross(axes[axis])\r\n    axes[axis3].load(axes[axis]).cross(axes[axis2])\r\n\r\n    axes[0][3] = 1.0;\r\n    axes[1][3] = 1.0;\r\n    axes[2][3] = 1.0;\r\n\r\n    axes[0].normalize();\r\n    axes[1].normalize();\r\n    axes[2].normalize();\r\n\r\n    this.loadFromVecs(axes);\r\n    this.scale(scale[0], scale[1], scale[2]);\r\n\r\n    m.m41 = loc[0];\r\n    m.m42 = loc[1];\r\n    m.m43 = loc[2];\r\n\r\n    return this;\r\n  }\r\n\r\n  decompose(_translate, _rotate, _scale, _skew, _perspective, order = EulerOrders.XYZ) {\r\n    if (this.$matrix.m44 === 0)\r\n      return false;\r\n\r\n    let mat = temp_mats.next().load(this);\r\n    let m = mat.$matrix;\r\n\r\n    let t = _translate, r = _rotate, s = _scale;\r\n    if (t) {\r\n      t[0] = m.m41;\r\n      t[1] = m.m42;\r\n      t[2] = m.m43;\r\n    }\r\n\r\n    let l1 = Math.sqrt(m.m11*m.m11 + m.m12*m.m12 + m.m13*m.m13);\r\n    let l2 = Math.sqrt(m.m21*m.m21 + m.m22*m.m22 + m.m23*m.m23);\r\n    let l3 = Math.sqrt(m.m31*m.m31 + m.m32*m.m32 + m.m33*m.m33);\r\n\r\n    if (l1) {\r\n      m.m11 /= l1;\r\n      m.m12 /= l1;\r\n      m.m13 /= l1;\r\n    }\r\n    if (l2) {\r\n      m.m21 /= l2;\r\n      m.m22 /= l2;\r\n      m.m23 /= l2;\r\n    }\r\n    if (l3) {\r\n      m.m31 /= l3;\r\n      m.m32 /= l3;\r\n      m.m33 /= l3;\r\n    }\r\n\r\n    if (s) {\r\n      s[0] = l1;\r\n      s[1] = l2;\r\n      s[2] = l3;\r\n    }\r\n\r\n    if (r) { //THREE.js code\r\n      let clamp = myclamp;\r\n\r\n      let rmat = temp_mats.next().load(this);\r\n      rmat.normalize();\r\n\r\n      m = rmat.$matrix;\r\n\r\n      // assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n      let m11 = m.m11, m12 = m.m12, m13 = m.m13, m14 = m.m14;\r\n      let m21 = m.m21, m22 = m.m22, m23 = m.m23, m24 = m.m24;\r\n      let m31 = m.m31, m32 = m.m32, m33 = m.m33, m34 = m.m34;\r\n      //let m41 = m.m41, m42 = m.m42, m43 = m.m43, m44 = m.m44;\r\n\r\n      if (order === EulerOrders.XYZ) {\r\n\r\n        r[1] = Math.asin(clamp(m13, -1, 1));\r\n\r\n        if (Math.abs(m13) < 0.9999999) {\r\n\r\n          r[0] = Math.atan2(-m23, m33);\r\n          r[2] = Math.atan2(-m12, m11);\r\n\r\n        } else {\r\n\r\n          r[0] = Math.atan2(m32, m22);\r\n          r[2] = 0;\r\n\r\n        }\r\n\r\n      } else if (order === EulerOrders.YXZ) {\r\n\r\n        r[0] = Math.asin(-clamp(m23, -1, 1));\r\n\r\n        if (Math.abs(m23) < 0.9999999) {\r\n\r\n          r[1] = Math.atan2(m13, m33);\r\n          r[2] = Math.atan2(m21, m22);\r\n\r\n        } else {\r\n\r\n          r[1] = Math.atan2(-m31, m11);\r\n          r[2] = 0;\r\n\r\n        }\r\n\r\n      } else if (order === EulerOrders.ZXY) {\r\n\r\n        r[0] = Math.asin(clamp(m32, -1, 1));\r\n\r\n        if (Math.abs(m32) < 0.9999999) {\r\n\r\n          r[1] = Math.atan2(-m31, m33);\r\n          r[2] = Math.atan2(-m12, m22);\r\n\r\n        } else {\r\n\r\n          r[1] = 0;\r\n          r[2] = Math.atan2(m21, m11);\r\n\r\n        }\r\n\r\n      } else if (order === EulerOrders.ZYX) {\r\n\r\n        r[1] = Math.asin(-clamp(m31, -1, 1));\r\n\r\n        if (Math.abs(m31) < 0.9999999) {\r\n\r\n          r[0] = Math.atan2(m32, m33);\r\n          r[2] = Math.atan2(m21, m11);\r\n\r\n        } else {\r\n\r\n          r[0] = 0;\r\n          r[2] = Math.atan2(-m12, m22);\r\n\r\n        }\r\n\r\n      } else if (order === EulerOrders.YZX) {\r\n\r\n        r[2] = Math.asin(clamp(m21, -1, 1));\r\n\r\n        if (Math.abs(m21) < 0.9999999) {\r\n\r\n          r[0] = Math.atan2(-m23, m22);\r\n          r[1] = Math.atan2(-m31, m11);\r\n\r\n        } else {\r\n\r\n          r[0] = 0;\r\n          r[1] = Math.atan2(m13, m33);\r\n\r\n        }\r\n\r\n      } else if (order === EulerOrders.XZY) {\r\n\r\n        r[2] = Math.asin(-clamp(m12, -1, 1));\r\n\r\n        if (Math.abs(m12) < 0.9999999) {\r\n\r\n          r[0] = Math.atan2(m32, m22);\r\n          r[1] = Math.atan2(m13, m11);\r\n\r\n        } else {\r\n\r\n          r[0] = Math.atan2(-m23, m33);\r\n          r[1] = 0;\r\n\r\n        }\r\n\r\n      } else {\r\n        console.warn('unsupported euler order:', order);\r\n      }\r\n      //r[0] = Math.atan2(m.m23, m.m33);\r\n      //r[1] = Math.atan2(-m.m13, Math.sqrt(m.m23*m.m23 + m.m33*m.m33));\r\n      //r[2] = Math.atan2(m.m12, m.m11);\r\n    }\r\n  }\r\n\r\n  _determinant2x2(a, b, c, d) {\r\n    return a*d - b*c;\r\n  }\r\n\r\n  _determinant3x3(a1, a2, a3, b1, b2, b3, c1, c2, c3) {\r\n    return a1*this._determinant2x2(b2, b3, c2, c3) - b1*this._determinant2x2(a2, a3, c2, c3) + c1*this._determinant2x2(a2, a3, b2, b3);\r\n  }\r\n\r\n  determinant() {\r\n    return this._determinant4x4();\r\n  }\r\n\r\n  _determinant4x4() {\r\n    var a1 = this.$matrix.m11;\r\n    var b1 = this.$matrix.m12;\r\n    var c1 = this.$matrix.m13;\r\n    var d1 = this.$matrix.m14;\r\n    var a2 = this.$matrix.m21;\r\n    var b2 = this.$matrix.m22;\r\n    var c2 = this.$matrix.m23;\r\n    var d2 = this.$matrix.m24;\r\n    var a3 = this.$matrix.m31;\r\n    var b3 = this.$matrix.m32;\r\n    var c3 = this.$matrix.m33;\r\n    var d3 = this.$matrix.m34;\r\n    var a4 = this.$matrix.m41;\r\n    var b4 = this.$matrix.m42;\r\n    var c4 = this.$matrix.m43;\r\n    var d4 = this.$matrix.m44;\r\n    return a1*this._determinant3x3(b2, b3, b4, c2, c3, c4, d2, d3, d4) - b1*this._determinant3x3(a2, a3, a4, c2, c3, c4, d2, d3, d4) + c1*this._determinant3x3(a2, a3, a4, b2, b3, b4, d2, d3, d4) - d1*this._determinant3x3(a2, a3, a4, b2, b3, b4, c2, c3, c4);\r\n  }\r\n\r\n  _makeAdjoint() {\r\n    var a1 = this.$matrix.m11;\r\n    var b1 = this.$matrix.m12;\r\n    var c1 = this.$matrix.m13;\r\n    var d1 = this.$matrix.m14;\r\n    var a2 = this.$matrix.m21;\r\n    var b2 = this.$matrix.m22;\r\n    var c2 = this.$matrix.m23;\r\n    var d2 = this.$matrix.m24;\r\n    var a3 = this.$matrix.m31;\r\n    var b3 = this.$matrix.m32;\r\n    var c3 = this.$matrix.m33;\r\n    var d3 = this.$matrix.m34;\r\n    var a4 = this.$matrix.m41;\r\n    var b4 = this.$matrix.m42;\r\n    var c4 = this.$matrix.m43;\r\n    var d4 = this.$matrix.m44;\r\n\r\n    this.$matrix.m11 = this._determinant3x3(b2, b3, b4, c2, c3, c4, d2, d3, d4);\r\n    this.$matrix.m21 = -this._determinant3x3(a2, a3, a4, c2, c3, c4, d2, d3, d4);\r\n    this.$matrix.m31 = this._determinant3x3(a2, a3, a4, b2, b3, b4, d2, d3, d4);\r\n    this.$matrix.m41 = -this._determinant3x3(a2, a3, a4, b2, b3, b4, c2, c3, c4);\r\n    this.$matrix.m12 = -this._determinant3x3(b1, b3, b4, c1, c3, c4, d1, d3, d4);\r\n    this.$matrix.m22 = this._determinant3x3(a1, a3, a4, c1, c3, c4, d1, d3, d4);\r\n    this.$matrix.m32 = -this._determinant3x3(a1, a3, a4, b1, b3, b4, d1, d3, d4);\r\n    this.$matrix.m42 = this._determinant3x3(a1, a3, a4, b1, b3, b4, c1, c3, c4);\r\n    this.$matrix.m13 = this._determinant3x3(b1, b2, b4, c1, c2, c4, d1, d2, d4);\r\n    this.$matrix.m23 = -this._determinant3x3(a1, a2, a4, c1, c2, c4, d1, d2, d4);\r\n    this.$matrix.m33 = this._determinant3x3(a1, a2, a4, b1, b2, b4, d1, d2, d4);\r\n    this.$matrix.m43 = -this._determinant3x3(a1, a2, a4, b1, b2, b4, c1, c2, c4);\r\n    this.$matrix.m14 = -this._determinant3x3(b1, b2, b3, c1, c2, c3, d1, d2, d3);\r\n    this.$matrix.m24 = this._determinant3x3(a1, a2, a3, c1, c2, c3, d1, d2, d3);\r\n    this.$matrix.m34 = -this._determinant3x3(a1, a2, a3, b1, b2, b3, d1, d2, d3);\r\n    this.$matrix.m44 = this._determinant3x3(a1, a2, a3, b1, b2, b3, c1, c2, c3);\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    this.load(this.mat);\r\n    this.__mat = this.mat;\r\n    //delete this.mat;\r\n  }\r\n}\r\n\r\nMatrix4.STRUCT = `\r\nmat4 {\r\n  mat      : array(float) | this.getAsArray();\r\n  isPersp  : int          | this.isPersp;\r\n}\r\n`;\r\nnstructjs.register(Matrix4);\r\n\r\npreMultTemp = new Matrix4();\r\n\r\nwindow.testmat = (x = 0, y = 0, z = Math.PI*0.5) => {\r\n  let m1 = new Matrix4();\r\n  m1.euler_rotate(x, y, z);\r\n  //m1.scale(2.0, 0.5, 3.0);\r\n\r\n  let t = [0, 0, 0], r = [0, 0, 0], s = [0, 0, 0]\r\n\r\n  m1.decompose(t, r, s);\r\n\r\n  window.console.log(\"\\n\");\r\n  window.console.log(t);\r\n  window.console.log(r);\r\n  window.console.log(s);\r\n\r\n\r\n  let mat = m1.clone();\r\n  mat.transpose();\r\n  mat.multiply(m1);\r\n\r\n  console.log(mat.toString());\r\n  return r;\r\n}\r\n\r\nlookat_cache_ms = util.cachering.fromConstructor(Matrix4, 64);\r\neuler_rotate_mats = util.cachering.fromConstructor(Matrix4, 64);\r\ntemp_mats = util.cachering.fromConstructor(Matrix4, 64);\r\n","\"use strict\";\r\n\r\n/*\r\nthis file is a skeleton that defines the contract\r\nthat any tool property library must implement to interface with path.ux.\r\n*/\r\n\r\n//maps prop type names to integers\r\nimport * as util from \"../util/util.js\";\r\n\r\nexport let PropTypes = {\r\n  INT        : 1,\r\n  STRING     : 2,\r\n  BOOL       : 4,\r\n  ENUM       : 8,\r\n  FLAG       : 16,\r\n  FLOAT      : 32,\r\n  VEC2       : 64,\r\n  VEC3       : 128,\r\n  VEC4       : 256,\r\n  MATRIX4    : 512,\r\n  QUAT       : 1024,\r\n  PROPLIST   : 4096,\r\n  STRSET     : 8192,\r\n  CURVE      : 8192<<1,\r\n  FLOAT_ARRAY: 8192<<2,\r\n  REPORT     : 8192<<3\r\n  //ITER : 8192<<1\r\n};\r\n\r\nexport const PropSubTypes = {\r\n  COLOR: 1\r\n};\r\n\r\n//flags\r\nexport const PropFlags = {\r\n  SELECT                : 1,\r\n  PRIVATE               : 2,\r\n  LABEL                 : 4,\r\n  USE_ICONS             : 64, /* Implies FORCE_ENUM_CHECKBOXES (for enum/flag properties). */\r\n  USE_CUSTOM_GETSET     : 128, //used by controller.js interface\r\n  SAVE_LAST_VALUE       : 256,\r\n  READ_ONLY             : 512,\r\n  SIMPLE_SLIDER         : 1<<10,\r\n  FORCE_ROLLER_SLIDER   : 1<<11,\r\n  USE_BASE_UNDO         : 1<<12, //internal to simple_controller.js\r\n  EDIT_AS_BASE_UNIT     : 1<<13, //user textbox input should be interpreted in display unit\r\n  NO_UNDO               : 1<<14,\r\n  USE_CUSTOM_PROP_GETTER: 1<<15, //hrm, not sure I need this\r\n  FORCE_ENUM_CHECKBOXES : 1<<16,/* Use a strip of checkboxes, also applies to flag properties. */\r\n  NO_DEFAULT            : 1<<17,\r\n};\r\n\r\nexport class ToolPropertyIF {\r\n  constructor(type, subtype, apiname, uiname, description, flag, icon) {\r\n    this.data = undefined;\r\n\r\n    this.type = type;\r\n    this.subtype = subtype;\r\n\r\n    this.apiname = apiname;\r\n    this.uiname = uiname;\r\n    this.description = description;\r\n    this.flag = flag;\r\n    this.icon = icon;\r\n  }\r\n\r\n  equals(b) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  copyTo(b) {\r\n\r\n  }\r\n\r\n  copy() {\r\n\r\n  }\r\n\r\n  _fire(type, arg1, arg2) {\r\n  }\r\n\r\n  on(type, cb) {\r\n  }\r\n\r\n  off(type, cb) {\r\n  }\r\n\r\n  getValue() {\r\n  }\r\n\r\n  setValue(val) {\r\n  }\r\n\r\n  setStep(step) {\r\n  }\r\n\r\n  setRange(min, max) {\r\n  }\r\n\r\n  setUnit(unit) {\r\n  }\r\n\r\n  //some clients have seperate ui range\r\n  setUIRange(min, max) {\r\n  }\r\n\r\n  setIcon(icon) {\r\n  }\r\n}\r\n\r\nexport class StringPropertyIF extends ToolPropertyIF {\r\n  constructor() {\r\n    super(PropTypes.STRING);\r\n  }\r\n}\r\n\r\nexport class NumPropertyIF extends ToolPropertyIF {\r\n};\r\n\r\nexport class IntPropertyIF extends ToolPropertyIF {\r\n  constructor() {\r\n    super(PropTypes.INT);\r\n  }\r\n\r\n  setRadix(radix) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n}\r\n\r\nexport class FloatPropertyIF extends ToolPropertyIF {\r\n  constructor() {\r\n    super(PropTypes.FLOAT);\r\n  }\r\n\r\n  setDecimalPlaces(n) {\r\n  }\r\n}\r\n\r\nexport class EnumPropertyIF extends ToolPropertyIF {\r\n  constructor(value, valid_values) {\r\n    super(PropTypes.ENUM);\r\n\r\n    this.values = {}\r\n    this.keys = {};\r\n    this.ui_value_names = {};\r\n    this.iconmap = {};\r\n\r\n    if (valid_values === undefined) return this;\r\n\r\n    if (valid_values instanceof Array || valid_values instanceof String) {\r\n      for (var i = 0; i < valid_values.length; i++) {\r\n        this.values[valid_values[i]] = valid_values[i];\r\n        this.keys[valid_values[i]] = valid_values[i];\r\n      }\r\n    } else {\r\n      for (var k in valid_values) {\r\n        this.values[k] = valid_values[k];\r\n        this.keys[valid_values[k]] = k;\r\n      }\r\n    }\r\n\r\n    for (var k in this.values) {\r\n      var uin = k[0].toUpperCase() + k.slice(1, k.length);\r\n\r\n      uin = uin.replace(/\\_/g, \" \");\r\n      this.ui_value_names[k] = uin;\r\n    }\r\n  }\r\n\r\n  addIcons(iconmap) {\r\n    if (this.iconmap === undefined) {\r\n      this.iconmap = {};\r\n    }\r\n    for (var k in iconmap) {\r\n      this.iconmap[k] = iconmap[k];\r\n    }\r\n  }\r\n}\r\n\r\nexport class FlagPropertyIF extends EnumPropertyIF {\r\n  constructor(valid_values) {\r\n    super(PropTypes.FLAG);\r\n  }\r\n}\r\n\r\nexport class Vec2PropertyIF extends ToolPropertyIF {\r\n  constructor(valid_values) {\r\n    super(PropTypes.VEC2);\r\n  }\r\n}\r\n\r\nexport class Vec3PropertyIF extends ToolPropertyIF {\r\n  constructor(valid_values) {\r\n    super(PropTypes.VEC3);\r\n  }\r\n}\r\n\r\nexport class Vec4PropertyIF extends ToolPropertyIF {\r\n  constructor(valid_values) {\r\n    super(PropTypes.VEC4);\r\n  }\r\n}\r\n\r\n/**\r\n * List of other tool props (all of one type)\r\n */\r\nexport class ListPropertyIF extends ToolPropertyIF {\r\n  /*\r\n  * Prop must be a ToolProperty subclass instance\r\n  * */\r\n  constructor(prop) {\r\n    super(PropTypes.PROPLIST);\r\n\r\n    this.prop = prop;\r\n  }\r\n\r\n  get length() {\r\n  }\r\n\r\n  set length(val) {\r\n  }\r\n\r\n  copyTo(b) {\r\n  }\r\n\r\n  copy() {\r\n  }\r\n\r\n  /**\r\n   * clear list\r\n   * */\r\n  clear() {\r\n\r\n  }\r\n\r\n  push(item = this.prop.copy()) {\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n  }\r\n}\r\n\r\n//like FlagsProperty but uses strings\r\nexport class StringSetPropertyIF extends ToolPropertyIF {\r\n  constructor(value = undefined, definition = []) {\r\n    super(PropTypes.STRSET);\r\n  }\r\n\r\n  /*\r\n  * Values can be a string, undefined/null, or a list/set/object-literal of strings.\r\n  * If destructive is true, then existing set will be cleared.\r\n  * */\r\n  setValue(values, destructive = true, soft_fail = true) {\r\n  }\r\n\r\n  getValue() {\r\n  }\r\n\r\n  addIcons(iconmap) {\r\n  }\r\n\r\n\r\n  addUINames(map) {\r\n  }\r\n\r\n  addDescriptions(map) {\r\n  }\r\n\r\n  copyTo(b) {\r\n  }\r\n\r\n  copy() {\r\n  }\r\n}\r\n\r\nexport class Curve1DPropertyIF extends ToolPropertyIF {\r\n  constructor(curve, uiname) {\r\n    super(PropTypes.CURVE);\r\n\r\n    this.data = curve;\r\n  }\r\n\r\n  getValue() {\r\n    return this.curve;\r\n  }\r\n\r\n  setValue(curve) {\r\n    if (curve === undefined) {\r\n      return;\r\n    }\r\n\r\n    let json = JSON.parse(JSON.stringify(curve));\r\n    this.data.load(json);\r\n  }\r\n\r\n  copyTo(b) {\r\n    b.setValue(this.data);\r\n  }\r\n}\r\n\r\n","/**\r\n * Unit system.\r\n *\r\n * Provides an API to convert units,\r\n * e.g. `convert(0.5, \"foot\", \"meter\")`\r\n *\r\n * Path.ux widgets typically have `baseUnit`\r\n * and `displayUnit` properties. `baseUnit`\r\n * is the unit of the real stored value,\r\n * while `displayUnit` is what he user sees\r\n * and edits.\r\n *\r\n * Units:\r\n * # none           No unit\r\n * # meter          Meter       (distance)\r\n * # inch           Inch        (distance)\r\n * # foot           Foot        (distance)\r\n * # square_foot    Square Feet (area)\r\n * # mile           Mile        (distance)\r\n * # degree         Degrees     (angle)\r\n * # radian         Radians     (angle)\r\n * # pixel          Pixel       (distance)\r\n * # percent        Percent\r\n *\r\n */\r\n\r\n/*\r\nall units convert to meters\r\n*/\r\n\r\nconst FLT_EPSILONE = 1.192092895507812e-07;\r\n\r\nfunction myfloor(f) {\r\n  return Math.floor(f + FLT_EPSILONE*2.0);\r\n}\r\n\r\nfunction normString(s) {\r\n  //remove all whitespace\r\n  s = s.replace(/ /g, \"\").replace(/\\t/g, \"\");\r\n  return s.toLowerCase();\r\n}\r\n\r\nfunction myToFixed(f, decimals) {\r\n  if (typeof f !== \"number\") {\r\n    return \"(error)\";\r\n  }\r\n\r\n  f = f.toFixed(decimals);\r\n  while (f.endsWith(\"0\") && f.search(/\\./) >= 0) {\r\n    f = f.slice(0, f.length - 1);\r\n  }\r\n\r\n  if (f.endsWith(\".\")) {\r\n    f = f.slice(0, f.length - 1);\r\n  }\r\n\r\n  if (f.length === 0)\r\n    f = \"0\";\r\n\r\n  return f.trim();\r\n}\r\n\r\nexport const Units = [];\r\n\r\nexport class Unit {\r\n  static getUnit(name) {\r\n    if (name === \"none\" || name === undefined) {\r\n      return undefined;\r\n    }\r\n\r\n    for (let cls of Units) {\r\n      if (cls.unitDefine().name === name) {\r\n        return cls;\r\n      }\r\n    }\r\n\r\n    throw new Error(\"Unknown unit \" + name);\r\n  }\r\n\r\n  static register(cls) {\r\n    Units.push(cls);\r\n  }\r\n\r\n  //subclassed static methods start here\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"\",\r\n      uiname : \"\",\r\n      type   : \"\", //e.g. distance\r\n      icon   : -1,\r\n      pattern: undefined //a re literal to validate strings\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n\r\n  }\r\n\r\n  static validate(string) {\r\n    string = normString(string);\r\n    let def = this.unitDefine();\r\n\r\n    let m = string.match(def.pattern);\r\n    if (!m)\r\n      return false;\r\n\r\n    return m[0] === string;\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n\r\n  }\r\n\r\n  static fromInternal(value) {\r\n\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n\r\n  }\r\n}\r\n\r\nexport class MeterUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"meter\",\r\n      uiname : \"Meter\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d*)?m$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    if (string.endsWith(\"m\")) {\r\n      string = string.slice(0, string.length - 1);\r\n    }\r\n\r\n    return parseFloat(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n    return \"\" + myToFixed(value, decimals) + \" m\";\r\n  }\r\n}\r\n\r\nUnit.register(MeterUnit);\r\n\r\nexport class InchUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"inch\",\r\n      uiname : \"Inch\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d*)?(in|inch)$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = string.toLowerCase();\r\n    let i = string.indexOf(\"i\");\r\n\r\n    if (i >= 0) {\r\n      string = string.slice(0, i);\r\n    }\r\n\r\n    return parseInt(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value*0.0254;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value/0.0254;\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n    return \"\" + myToFixed(value, decimals) + \"in\";\r\n  }\r\n}\r\n\r\nUnit.register(InchUnit);\r\n\r\nlet foot_re = /((-?\\d+(\\.\\d*)?ft)(-?\\d+(\\.\\d*)?(in|inch))?)|(-?\\d+(\\.\\d*)?(in|inch))$/\r\n\r\nexport class FootUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"foot\",\r\n      uiname : \"Foot\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: foot_re\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    let i = string.search(\"ft\");\r\n    let parts = [];\r\n    let vft = 0.0, vin = 0.0;\r\n\r\n    if (i >= 0) {\r\n      parts = string.split(\"ft\");\r\n      let j = parts[1].search(\"in\");\r\n\r\n      if (j >= 0) {\r\n        parts = [parts[0]].concat(parts[1].split(\"in\"));\r\n        vin = parseFloat(parts[1]);\r\n      }\r\n\r\n      vft = parseFloat(parts[0]);\r\n    } else {\r\n      string = string.replace(/in/g, \"\");\r\n      vin = parseFloat(string);\r\n    }\r\n\r\n    return vin/12.0 + vft;\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value*0.3048;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value/0.3048;\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n    let vft = myfloor(value);\r\n    let vin = ((value + FLT_EPSILONE*2)*12)%12;\r\n\r\n    if (vft === 0.0) {\r\n      return myToFixed(vin, decimals) + \" in\";\r\n    }\r\n\r\n    let s = \"\" + vft + \" ft\";\r\n    if (vin !== 0.0) {\r\n      s += \" \" + myToFixed(vin, decimals) + \" in\";\r\n    }\r\n\r\n    return s;\r\n  }\r\n}\r\n\r\nUnit.register(FootUnit);\r\n\r\n\r\nlet square_foot_re = /((-?\\d+(\\.\\d*)?ft(\\u00b2)?)(-?\\d+(\\.\\d*)?(in|inch)(\\u00b2)?)?)|(-?\\d+(\\.\\d*)?(in|inch)(\\u00b2)?)$/\r\n\r\nexport class SquareFootUnit extends FootUnit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"square_foot\",\r\n      uiname : \"Square Feet\",\r\n      type   : \"area\",\r\n      icon   : -1,\r\n      pattern: square_foot_re\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = string.replace(/\\u00b2/g, \"\");\r\n    return super.parse(string);\r\n  }\r\n\r\n\r\n  static buildString(value, decimals = 2) {\r\n    let vft = myfloor(value);\r\n    let vin = ((value + FLT_EPSILONE*2)*12)%12;\r\n\r\n    if (vft === 0.0) {\r\n      return myToFixed(vin, decimals) + \" in\\u00b2\";\r\n    }\r\n\r\n    let s = \"\" + vft + \" ft\\u00b2\";\r\n    if (vin !== 0.0) {\r\n      s += \" \" + myToFixed(vin, decimals) + \" in\\u00b2\";\r\n    }\r\n\r\n    return s;\r\n  }\r\n}\r\n\r\nUnit.register(SquareFootUnit);\r\n\r\n\r\nexport class MileUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"mile\",\r\n      uiname : \"Mile\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d+)?miles$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    string = string.replace(/miles/, \"\");\r\n    return parseFloat(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value*1609.34;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value/1609.34;\r\n  }\r\n\r\n  static buildString(value, decimals = 3) {\r\n    return \"\" + myToFixed(value, decimals) + \" miles\";\r\n  }\r\n}\r\n\r\nUnit.register(MileUnit);\r\n\r\nexport class DegreeUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"degree\",\r\n      uiname : \"Degrees\",\r\n      type   : \"angle\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d+)?(\\u00B0|degree|deg|d|degree|degrees)$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    if (string.search(\"d\") >= 0) {\r\n      string = string.slice(0, string.search(\"d\")).trim();\r\n    } else if (string.search(\"\\u00B0\") >= 0) {\r\n      string = string.slice(0, string.search(\"\\u00B0\")).trim();\r\n    }\r\n\r\n    return parseFloat(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value/180.0*Math.PI;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value*180.0/Math.PI;\r\n  }\r\n\r\n  static buildString(value, decimals = 3) {\r\n    return \"\" + myToFixed(value, decimals) + \" \\u00B0\";\r\n  }\r\n};\r\nUnit.register(DegreeUnit);\r\n\r\nexport class RadianUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"radian\",\r\n      uiname : \"Radians\",\r\n      type   : \"angle\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d+)?(r|rad|radian|radians)$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    if (string.search(\"r\") >= 0) {\r\n      string = string.slice(0, string.search(\"r\")).trim();\r\n    }\r\n\r\n    return parseFloat(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static buildString(value, decimals = 3) {\r\n    return \"\" + myToFixed(value, decimals) + \" r\";\r\n  }\r\n};\r\n\r\nUnit.register(RadianUnit);\r\n\r\nexport function setBaseUnit(unit) {\r\n  Unit.baseUnit = unit;\r\n}\r\n\r\nwindow._getBaseUnit = () => Unit.baseUnit;\r\n\r\nexport function setMetric(val) {\r\n  Unit.isMetric = val;\r\n}\r\n\r\nUnit.isMetric = true;\r\nUnit.baseUnit = \"meter\";\r\n\r\nlet numre1 = /[+\\-]?[0-9]+(\\.[0-9]*)?$/\r\nlet numre2 = /[+\\-]?[0-9]?(\\.[0-9]*)+$/\r\nlet hexre1 = /[+\\-]?[0-9a-fA-F]+h$/\r\nlet hexre2 = /[+\\-]?0x[0-9a-fA-F]+$/\r\nlet binre = /[+\\-]?0b[01]+$/\r\nlet expre = /[+\\-]?[0-9]+(\\.[0-9]*)?[eE]\\-?[0-9]+$/\r\nlet intre = /[+\\-]?[0-9]+$/\r\n\r\nfunction isnumber(s) {\r\n  s = (\"\" + s).trim();\r\n\r\n  function test(re) {\r\n    return s.search(re) === 0;\r\n  }\r\n\r\n  return test(intre) || test(numre1) || test(numre2) || test(hexre1) || test(hexre2) || test(binre) || test(expre);\r\n}\r\n\r\n\r\nexport function parseValueIntern(string, baseUnit = undefined) {\r\n  string = string.trim();\r\n  if (string[0] === \".\") {\r\n    string = \"0\" + string;\r\n  }\r\n\r\n  if (typeof baseUnit === \"string\") {\r\n    let base = Unit.getUnit(baseUnit);\r\n\r\n    if (base === undefined && baseUnit !== \"none\") {\r\n      console.warn(\"Unknown unit \" + baseUnit);\r\n      return NaN;\r\n    }\r\n\r\n    baseUnit = base;\r\n  }\r\n\r\n  //unannotated string?\r\n  if (isnumber(string)) {\r\n    //assume base unit\r\n    let f = parseFloat(string);\r\n\r\n    return f;\r\n  }\r\n\r\n  if (baseUnit === undefined) {\r\n    console.warn(\"No base unit in units.js:parseValueIntern\");\r\n  }\r\n\r\n  for (let unit of Units) {\r\n    let def = unit.unitDefine();\r\n\r\n    if (unit.validate(string)) {\r\n      console.log(unit);\r\n      let value = unit.parse(string);\r\n\r\n      if (baseUnit) {\r\n        value = unit.toInternal(value);\r\n        return baseUnit.fromInternal(value);\r\n      } else {\r\n        return value;\r\n      }\r\n    }\r\n  }\r\n\r\n  return NaN;\r\n}\r\n\r\n/* if displayUnit is undefined, final value will be converted from displayUnit to baseUnit */\r\nexport function parseValue(string, baseUnit = undefined, displayUnit = undefined) {\r\n  displayUnit = Unit.getUnit(displayUnit);\r\n  baseUnit = Unit.getUnit(baseUnit);\r\n\r\n  let f = parseValueIntern(string, displayUnit || baseUnit);\r\n\r\n  if (displayUnit) {\r\n    f = displayUnit.toInternal(f);\r\n  }\r\n\r\n  if (baseUnit) {\r\n    f = baseUnit.fromInternal(f);\r\n  }\r\n\r\n  return f;\r\n}\r\n\r\nexport function isNumber(string) {\r\n  if (isnumber(string)) {\r\n    return true;\r\n  }\r\n\r\n  for (let unit of Units) {\r\n    let def = unit.unitDefine();\r\n\r\n    if (unit.validate(string)) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nexport class PixelUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"pixel\",\r\n      uiname : \"Pixel\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d*)?px$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    if (string.endsWith(\"px\")) {\r\n      string = string.slice(0, string.length - 2).trim();\r\n    }\r\n\r\n    return parseFloat(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n    return \"\" + myToFixed(value, decimals) + \"px\";\r\n  }\r\n}\r\n\r\nUnit.register(PixelUnit);\r\n\r\nexport class PercentUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"percent\",\r\n      uiname : \"Percent\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: /[0-9]+(\\.[0-9]+)?[ \\t]*%/\r\n    }\r\n  }\r\n\r\n  static toInternal(value) {\r\n    return value/100.0;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value*100.0;\r\n  }\r\n\r\n  static parse(string) {\r\n    return parseFloat(string.replace(/%/g, \"\"));\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n    return (value).toFixed(decimals) + \"%\";\r\n  }\r\n}\r\n\r\nUnit.register(PercentUnit);\r\n\r\n\r\nexport function convert(value, unita, unitb) {\r\n  /* Note: getUnit throws on invalid units *except* for\r\n   *       'none' where it returns undefined.\r\n   */\r\n\r\n  if (typeof unita === \"string\") {\r\n    unita = Unit.getUnit(unita);\r\n  }\r\n\r\n  if (typeof unitb === \"string\") {\r\n    unitb = Unit.getUnit(unitb);\r\n  }\r\n\r\n  if (unita && unitb) {\r\n    return unitb.fromInternal(unita.toInternal(value));\r\n  } else if (unitb) {\r\n    return unitb.fromInternal(value); /* unita was 'none' */\r\n  } else if (unita) {\r\n    return unita.toInternal(value);\r\n  } else {\r\n    return value;\r\n  }\r\n}\r\n\r\nwindow.unitConvert = convert;\r\n\r\n/**\r\n *\r\n * @param value Value (note: is not converted to internal unit)\r\n * @param unit: Unit to use, should be a string referencing unit type, see unitDefine().name\r\n * @returns {*}\r\n */\r\nexport function buildString(value, baseUnit = Unit.baseUnit, decimalPlaces = 3, displayUnit = Unit.baseUnit) {\r\n  if (typeof baseUnit === \"string\" && baseUnit !== \"none\") {\r\n    baseUnit = Unit.getUnit(baseUnit);\r\n  }\r\n  if (typeof displayUnit === \"string\" && displayUnit !== \"none\") {\r\n    displayUnit = Unit.getUnit(displayUnit);\r\n  }\r\n\r\n\r\n  if (displayUnit !== baseUnit) {\r\n    value = convert(value, baseUnit, displayUnit);\r\n  }\r\n\r\n  if (displayUnit !== \"none\") {\r\n    return displayUnit.buildString(value, decimalPlaces);\r\n  } else {\r\n    return myToFixed(value, decimalPlaces);\r\n  }\r\n}\r\n\r\nwindow._parseValueTest = parseValue;\r\nwindow._buildStringTest = buildString;\r\n","export let config = {\r\n  doubleClickTime : 500,\r\n\r\n  //auto load 1d bspline templates, can hurt startup time\r\n  autoLoadSplineTemplates : true,\r\n\r\n  //timeout for press-and-hold (touch) version of double clicking\r\n  doubleClickHoldTime : 750,\r\n  DEBUG : {\r\n\r\n  }\r\n};\r\n\r\nexport function setConfig(obj) {\r\n  for (let k in obj) {\r\n    config[k] = obj[k];\r\n  }\r\n}\r\n\r\nexport default config;\r\n","import * as util from \"./util.js\";\r\nimport cconst from '../config/config.js';\r\nimport {Vector2} from './vectormath.js';\r\n\r\nexport let modalstack = [];\r\nlet singleMouseCBs = {};\r\n\r\nfunction debugDomEvents() {\r\n  let cbsymbol = Symbol(\"event-callback\");\r\n  let thsymbol = Symbol(\"debug-info\");\r\n\r\n  let idgen = 0;\r\n\r\n  function init(et) {\r\n    if (!et[thsymbol]) {\r\n      et[thsymbol] = idgen++;\r\n    }\r\n  }\r\n\r\n  function getkey(et, type, options) {\r\n    init(et);\r\n    return \"\" + et[thsymbol] + \":\" + type + \":\" + JSON.stringify(options);\r\n  }\r\n\r\n  let addEventListener = EventTarget.prototype.addEventListener;\r\n  let removeEventListener = EventTarget.prototype.removeEventListener;\r\n\r\n  EventTarget.prototype.addEventListener = function (type, cb, options) {\r\n    init(this);\r\n\r\n    if (!cb[cbsymbol]) {\r\n      cb[cbsymbol] = new Set();\r\n    }\r\n\r\n    let key = getkey(this, type, options);\r\n    cb[cbsymbol].add(key);\r\n\r\n    return addEventListener.call(this, type, cb, options);\r\n  }\r\n\r\n  EventTarget.prototype.removeEventListener = function (type, cb, options) {\r\n    init(this);\r\n\r\n    if (!cb[cbsymbol]) {\r\n      console.error(\"Invalid callback in removeEventListener for\", type, this, cb);\r\n      return;\r\n    }\r\n\r\n    let key = getkey(this, type, options);\r\n\r\n    if (!cb[cbsymbol].has(key)) {\r\n      console.error(\"Callback not in removeEventListener;\", type, this, cb);\r\n      return;\r\n    }\r\n\r\n    cb[cbsymbol].delete(key);\r\n\r\n    return removeEventListener.call(this, type, cb, options);\r\n  }\r\n}\r\n\r\nfunction singletonMouseEvents() {\r\n  let keys = [\"mousedown\", \"mouseup\", \"mousemove\"];\r\n  for (let k of keys) {\r\n    singleMouseCBs[k] = new Set();\r\n  }\r\n\r\n  let ddd = -1.0;\r\n  window.testSingleMouseUpEvent = (type = \"mousedown\") => {\r\n    let id = ddd++;\r\n    singleMouseEvent(() => {\r\n      console.log(\"mouse event\", id);\r\n    }, type)\r\n  };\r\n\r\n  let _mpos = new Vector2();\r\n\r\n  function doSingleCbs(e, type) {\r\n    let list = singleMouseCBs[type];\r\n    singleMouseCBs[type] = new Set();\r\n\r\n    if (e.type !== \"touchend\" && e.type !== \"touchcancel\") {\r\n      _mpos[0] = e.touches && e.touches.length > 0 ? e.touches[0].pageX : e.x;\r\n      _mpos[1] = e.touches && e.touches.length > 0 ? e.touches[0].pageY : e.y;\r\n    }\r\n\r\n    if (e.touches) {\r\n      e = copyEvent(e);\r\n\r\n      e.type = type;\r\n      if (e.touches.length > 0) {\r\n        e.x = e.pageX = e.touches[0].pageX;\r\n        e.y = e.pageY = e.touches[0].pageY;\r\n      } else {\r\n        e.x = _mpos[0];\r\n        e.y = _mpos[1];\r\n      }\r\n    }\r\n\r\n    for (let cb of list) {\r\n      try {\r\n        cb(e);\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        console.warn(\"Error in event callback\");\r\n      }\r\n    }\r\n  }\r\n\r\n  window.addEventListener(\"mouseup\", (e) => {\r\n    doSingleCbs(e, \"mouseup\");\r\n  }, {capture: true});\r\n  window.addEventListener(\"touchcancel\", (e) => {\r\n    doSingleCbs(e, \"mouseup\");\r\n  }, {capture: true});\r\n  document.addEventListener(\"touchend\", (e) => {\r\n    doSingleCbs(e, \"mouseup\");\r\n  }, {capture: true});\r\n\r\n  document.addEventListener(\"mousedown\", (e) => {\r\n    doSingleCbs(e, \"mousedown\");\r\n  }, {capture: true});\r\n  document.addEventListener(\"touchstart\", (e) => {\r\n    doSingleCbs(e, \"mousedown\");\r\n  }, {capture: true});\r\n\r\n  document.addEventListener(\"mousemove\", (e) => {\r\n    doSingleCbs(e, \"mousemove\");\r\n  }, {capture: true});\r\n  document.addEventListener(\"touchmove\", (e) => {\r\n    doSingleCbs(e, \"mousemove\");\r\n  }, {capture: true});\r\n\r\n  return {\r\n    singleMouseEvent(cb, type) {\r\n      if (!(type in singleMouseCBs)) {\r\n        throw new Error(\"not a mouse event\");\r\n      }\r\n\r\n      singleMouseCBs[type].add(cb);\r\n    }\r\n  };\r\n}\r\n\r\nsingletonMouseEvents = singletonMouseEvents();\r\n\r\n/**\r\n * adds a mouse event callback that only gets called once\r\n * */\r\nexport function singleMouseEvent(cb, type) {\r\n  return singletonMouseEvents.singleMouseEvent(cb, type);\r\n}\r\n\r\n\r\n/*tests if either the left mouse button is down,\r\n* or a touch event has happened and e.touches.length == 1*/\r\nexport function isLeftClick(e) {\r\n  if (e.touches !== undefined) {\r\n    return e.touches.length === 1;\r\n  }\r\n\r\n  return e.button === 0;\r\n}\r\n\r\nexport class DoubleClickHandler {\r\n  constructor() {\r\n    this.down = 0;\r\n    this.last = 0;\r\n    this.dblEvent = undefined;\r\n\r\n    this.start_mpos = new Vector2();\r\n\r\n    this._on_mouseup = this._on_mouseup.bind(this);\r\n    this._on_mousemove = this._on_mousemove.bind(this);\r\n  }\r\n\r\n  _on_mouseup(e) {\r\n    //console.log(\"mup\", e);\r\n    this.mdown = false;\r\n  }\r\n\r\n  _on_mousemove(e) {\r\n    let mpos = new Vector2();\r\n    mpos[0] = e.x;\r\n    mpos[1] = e.y;\r\n\r\n    let dist = mpos.vectorDistance(this.start_mpos)*devicePixelRatio;\r\n\r\n    if (dist > 11) {\r\n      //console.log(\"cancel\", dist);\r\n      this.mdown = false;\r\n    }\r\n\r\n    if (this.mdown) {\r\n      singleMouseEvent(this._on_mousemove, \"mousemove\");\r\n    }\r\n\r\n    this.update();\r\n  }\r\n\r\n  mousedown(e) {\r\n    //console.log(\"mdown\", e.x, e.y);\r\n\r\n    if (!this.last) {\r\n      this.last = 0;\r\n    }\r\n    if (!this.down) {\r\n      this.down = 0;\r\n    }\r\n    if (!this.up) {\r\n      this.up = 0;\r\n    }\r\n\r\n    if (isMouseDown(e)) {\r\n      this.mdown = true;\r\n\r\n      let cpy = Object.assign({}, e);\r\n\r\n      this.start_mpos[0] = e.x;\r\n      this.start_mpos[1] = e.y;\r\n\r\n      singleMouseEvent(this._on_mousemove, \"mousemove\");\r\n\r\n      if (e.type.search(\"touch\") >= 0 && e.touches.length > 0) {\r\n        cpy.x = cpy.pageX = e.touches[0].pageX;\r\n        cpy.y = cpy.pageY = e.touches[1].pageY;\r\n      } else {\r\n        cpy.x = cpy.pageX = e.x;\r\n        cpy.y = cpy.pageY = e.y;\r\n      }\r\n\r\n      //stupid real MouseEvent class zeros .x/.y\r\n      //continue using hackish copyEvent for now...\r\n\r\n      this.dblEvent = copyEvent(e);\r\n      this.dblEvent.type = \"dblclick\";\r\n\r\n      this.last = this.down;\r\n      this.down = util.time_ms();\r\n\r\n      if (this.down - this.last < cconst.doubleClickTime) {\r\n        this.mdown = false;\r\n        this.ondblclick(this.dblEvent);\r\n\r\n        this.down = this.last = 0.0;\r\n      } else {\r\n        singleMouseEvent(this._on_mouseup, \"mouseup\");\r\n      }\r\n    } else {\r\n      this.mdown = false;\r\n    }\r\n  }\r\n\r\n  //you may override this\r\n  ondblclick(e) {\r\n\r\n  }\r\n\r\n  update() {\r\n    if (modalstack.length > 0) {\r\n      //cancel double click requests\r\n      this.mdown = false;\r\n    }\r\n\r\n    if (this.mdown && util.time_ms() - this.down > cconst.doubleClickHoldTime) {\r\n      this.mdown = false;\r\n      this.ondblclick(this.dblEvent);\r\n    }\r\n  }\r\n\r\n  abort() {\r\n    this.last = this.down = 0;\r\n  }\r\n}\r\n\r\nexport function isMouseDown(e) {\r\n  let mdown = 0;\r\n\r\n  if (e.touches !== undefined) {\r\n    mdown = e.touches.length > 0;\r\n  } else {\r\n    mdown = e.buttons;\r\n  }\r\n\r\n  mdown = mdown & 1;\r\n\r\n  return mdown;\r\n}\r\n\r\nexport function pathDebugEvent(e, extra) {\r\n  e.__prevdef = e.preventDefault;\r\n  e.__stopprop = e.stopPropagation;\r\n\r\n  e.preventDefault = function () {\r\n    console.warn(\"preventDefault\", extra);\r\n    return this.__prevdef();\r\n  };\r\n\r\n  e.stopPropagation = function () {\r\n    console.warn(\"stopPropagation\", extra);\r\n    return this.__stopprop();\r\n  }\r\n}\r\n\r\n/** Returns true if event came from a touchscreen or pen device */\r\nexport function eventWasTouch(e) {\r\n  let ret = e.sourceCapabilities && e.sourceCapabilities.firesTouchEvents;\r\n  ret = ret || e.was_touch;\r\n  ret = ret || e instanceof TouchEvent;\r\n  ret = ret || e.touches !== undefined;\r\n\r\n  if (e instanceof PointerEvent) {\r\n    ret = ret || (e.pointerType === \"pen\" || e.pointerType === \"touch\");\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nexport function copyEvent(e) {\r\n  let ret = {};\r\n  let keys = [];\r\n\r\n  for (let k in e) {\r\n    keys.push(k);\r\n  }\r\n\r\n  keys = keys.concat(Object.getOwnPropertySymbols(e));\r\n  keys = keys.concat(Object.getOwnPropertyNames(e));\r\n\r\n  for (let k of keys) {\r\n    let v;\r\n\r\n    try {\r\n      v = e[k];\r\n    } catch (error) {\r\n      console.warn(\"read error for event key\", k);\r\n      continue;\r\n    }\r\n\r\n    if (typeof v == \"function\") {\r\n      ret[k] = v.bind(e);\r\n    } else {\r\n      ret[k] = v;\r\n    }\r\n  }\r\n\r\n  ret.original = e;\r\n\r\n  return ret;\r\n}\r\n\r\nlet Screen;\r\n\r\nexport function _setScreenClass(cls) {\r\n  Screen = cls;\r\n}\r\n\r\nfunction findScreen() {\r\n  let rec = (n) => {\r\n    for (let n2 of n.childNodes) {\r\n      if (n2 && typeof n2 === \"object\" && n2 instanceof Screen) {\r\n        return n2;\r\n      }\r\n    }\r\n\r\n    for (let n2 of n.childNodes) {\r\n      let ret = rec(n2);\r\n      if (ret) {\r\n        return ret;\r\n      }\r\n    }\r\n  };\r\n\r\n  return rec(document.body);\r\n}\r\n\r\nwindow._findScreen = findScreen;\r\n\r\nlet ContextAreaClass;\r\n\r\nexport function _setModalAreaClass(cls) {\r\n  ContextAreaClass = cls;\r\n}\r\n\r\nexport function pushPointerModal(obj, elem, pointerId, autoStopPropagation = true) {\r\n  return pushModalLight(obj, autoStopPropagation, elem, pointerId);\r\n}\r\n\r\nexport function pushModalLight(obj, autoStopPropagation = true, elem, pointerId) {\r\n  let keys;\r\n\r\n  if (pointerId === undefined) {\r\n    keys = new Set([\r\n      \"keydown\", \"keyup\", \"mousedown\", \"mouseup\", \"touchstart\", \"touchend\",\r\n      \"touchcancel\", \"mousewheel\", \"mousemove\", \"mouseover\", \"mouseout\", \"mouseenter\",\r\n      \"mouseleave\", \"dragstart\", \"drag\", \"dragend\", \"dragexit\", \"dragleave\", \"dragover\",\r\n      \"dragenter\", \"drop\", \"pointerdown\", \"pointermove\", \"pointerup\", \"pointercancel\",\r\n      \"pointerstart\", \"pointerend\", \"pointerleave\", \"pointerexit\", \"pointerenter\",\r\n      \"pointerover\"\r\n    ]);\r\n  } else {\r\n    keys = new Set([\r\n      \"keydown\", \"keyup\", \"keypress\", \"mousewheel\"\r\n    ]);\r\n  }\r\n\r\n  let ret = {\r\n    keys     : keys,\r\n    handlers : {},\r\n    last_mpos: [0, 0]\r\n  };\r\n\r\n  let touchmap = {\r\n    \"touchstart\" : \"mousedown\",\r\n    \"touchmove\"  : \"mousemove\",\r\n    \"touchend\"   : \"mouseup\",\r\n    \"touchcancel\": \"mouseup\"\r\n  };\r\n\r\n  let mpos = [0, 0];\r\n\r\n  let screen = findScreen();\r\n  if (screen) {\r\n    mpos[0] = screen.mpos[0];\r\n    mpos[1] = screen.mpos[1];\r\n    screen = undefined;\r\n  }\r\n\r\n  function handleAreaContext() {\r\n    let screen = findScreen();\r\n    if (screen) {\r\n      let sarea = screen.findScreenArea(mpos[0], mpos[1]);\r\n      if (sarea && sarea.area) {\r\n        sarea.area.push_ctx_active();\r\n        sarea.area.pop_ctx_active();\r\n      }\r\n    }\r\n  }\r\n\r\n  function make_default_touchhandler(type, state) {\r\n    return function (e) {\r\n      if (cconst.DEBUG.domEvents) {\r\n        pathDebugEvent(e);\r\n      }\r\n\r\n      if (touchmap[type] in ret.handlers) {\r\n        let type2 = touchmap[type];\r\n\r\n        let e2 = copyEvent(e);\r\n\r\n        e2.was_touch = true;\r\n        e2.type = type2;\r\n        e2.button = type == \"touchcancel\" ? 1 : 0;\r\n        e2.touches = e.touches;\r\n\r\n        if (e.touches.length > 0) {\r\n          let t = e.touches[0];\r\n\r\n          mpos[0] = t.pageX;\r\n          mpos[1] = t.pageY;\r\n\r\n          e2.pageX = e2.x = t.pageX;\r\n          e2.pageY = e2.y = t.pageY;\r\n          e2.clientX = t.clientX;\r\n          e2.clientY = t.clientY;\r\n          e2.x = t.clientX;\r\n          e2.y = t.clientY;\r\n\r\n          ret.last_mpos[0] = e2.x;\r\n          ret.last_mpos[1] = e2.y;\r\n        } else {\r\n          e2.x = e2.clientX = e2.pageX = e2.screenX = ret.last_mpos[0];\r\n          e2.y = e2.clientY = e2.pageY = e2.screenY = ret.last_mpos[1];\r\n        }\r\n\r\n        e2.was_touch = true;\r\n\r\n        handleAreaContext();\r\n        //console.log(e2.x, e2.y);\r\n        ret.handlers[type2](e2);\r\n      }\r\n\r\n      if (autoStopPropagation) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n    }\r\n  }\r\n\r\n  function make_handler(type, key) {\r\n    return function (e) {\r\n      if (cconst.DEBUG.domEvents) {\r\n        pathDebugEvent(e);\r\n      }\r\n\r\n      if (typeof key !== \"string\") {\r\n        //console.warn(\"key was undefined\", key, type);\r\n        return;\r\n      }\r\n\r\n      if (key.startsWith(\"mouse\")) {\r\n        mpos[0] = e.pageX;\r\n        mpos[1] = e.pageY;\r\n      } else if (key.startsWith(\"pointer\")) {\r\n        mpos[0] = e.x;\r\n        mpos[1] = e.y;\r\n      }\r\n\r\n      handleAreaContext();\r\n\r\n      if (key !== undefined)\r\n        obj[key](e);\r\n\r\n      if (autoStopPropagation) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n    }\r\n  }\r\n\r\n  let found = {};\r\n\r\n  for (let k of keys) {\r\n    let key;\r\n\r\n    if (obj[k])\r\n      key = k;\r\n    else if (obj[\"on\" + k])\r\n      key = \"on\" + k;\r\n    else if (obj[\"on_\" + k])\r\n      key = \"on_\" + k;\r\n    else if (k in touchmap)\r\n      continue; //default touch event handlers will be done seperately\r\n    else\r\n      key = undefined; //make handler that still blocks events\r\n\r\n    //check we don't override other mouse pointer event handlers\r\n    if (key === undefined && k.search(\"pointer\") === 0) {\r\n      continue;\r\n    }\r\n\r\n    if (key !== undefined) {\r\n      found[k] = 1;\r\n    }\r\n\r\n    let handler = make_handler(k, key);\r\n    ret.handlers[k] = handler;\r\n\r\n    let settings = handler.settings = {passive: false, capture: true};\r\n    window.addEventListener(k, handler, settings);\r\n  }\r\n\r\n  for (let k in touchmap) {\r\n    if (!(k in found)) {\r\n      //console.log(\"making touch handler for\", '\"' + k + '\"', ret.handlers[k]);\r\n\r\n      ret.handlers[k] = make_default_touchhandler(k, ret);\r\n\r\n      let settings = ret.handlers[k].settings = {passive: false, capture: true};\r\n      window.addEventListener(k, ret.handlers[k], settings);\r\n    }\r\n  }\r\n\r\n  if (pointerId !== undefined) {\r\n    ret.pointer = {\r\n      elem, pointerId\r\n    };\r\n\r\n    function make_pointer(k) {\r\n      let k2 = \"on_\" + k;\r\n\r\n      ret.pointer[k] = function (e) {\r\n        if (obj[k2] !== undefined) {\r\n          obj[k2](e);\r\n        }\r\n\r\n        if (autoStopPropagation) {\r\n          e.stopPropagation();\r\n          e.preventDefault();\r\n        }\r\n      }\r\n    }\r\n\r\n    make_pointer(\"pointerdown\");\r\n    make_pointer(\"pointermove\");\r\n    make_pointer(\"pointerup\");\r\n    make_pointer(\"pointerstart\");\r\n    make_pointer(\"pointerend\");\r\n    make_pointer(\"pointerleave\");\r\n    make_pointer(\"pointerenter\");\r\n    make_pointer(\"pointerout\");\r\n    make_pointer(\"pointerover\");\r\n    make_pointer(\"pointerexit\");\r\n    make_pointer(\"pointercancel\");\r\n\r\n    for (let k in ret.pointer) {\r\n      if (k !== \"elem\" && k !== \"pointerId\") {\r\n        elem.addEventListener(k, ret.pointer[k]);\r\n      }\r\n    }\r\n\r\n    try {\r\n      elem.setPointerCapture(pointerId)\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n\r\n      console.log(\"attempting fallback\");\r\n\r\n      for (let k in ret.pointer) {\r\n        if (k !== \"elem\" && k !== \"pointerId\") {\r\n          elem.removeEventListener(k, ret.pointer[k]);\r\n        }\r\n      }\r\n\r\n      delete ret.pointer;\r\n\r\n      modalstack.push(ret);\r\n      popModalLight(ret);\r\n\r\n      for (let k in obj) {\r\n        if (k === \"pointercancel\" || k === \"pointerend\" || k === \"pointerstart\") {\r\n          continue;\r\n        }\r\n\r\n        if (k.startsWith(\"pointer\")) {\r\n          let k2 = k.replace(/pointer/, \"mouse\");\r\n          if (k2 in obj) {\r\n            console.warn(\"warning, existing mouse handler\", k2);\r\n            continue;\r\n          }\r\n\r\n          let v = obj[k];\r\n          obj[k] = undefined;\r\n\r\n          obj[k2] = v;\r\n        }\r\n      }\r\n\r\n      console.log(obj);\r\n\r\n      return pushModalLight(obj, autoStopPropagation);\r\n    }\r\n  }\r\n\r\n  modalstack.push(ret);\r\n  ContextAreaClass.lock();\r\n\r\n  if (cconst.DEBUG.modalEvents) {\r\n    console.warn(\"pushModalLight\", ret.pointer ? \"(pointer events)\" : \"\");\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n/* Trace all calls to EventTarget.prototype.[add/rem]EventListener */\r\nif (0) {\r\n  window._print_evt_debug = false;\r\n\r\n  function evtprint() {\r\n    if (window.window._print_evt_debug) {\r\n      console.warn(...arguments);\r\n    }\r\n  }\r\n\r\n  let addevent = EventTarget.prototype.addEventListener;\r\n  let remevent = EventTarget.prototype.removeEventListener;\r\n\r\n  const funckey = Symbol(\"eventfunc\");\r\n\r\n  EventTarget.prototype.addEventListener = function (name, func, args) {\r\n    //if (name.startsWith(\"key\")) {\r\n    evtprint(\"listener added\", name, func.name, args);\r\n    //}\r\n\r\n    let func2 = function (e) {\r\n      let proxy = new Proxy(e, {\r\n        get(target, p, receiver) {\r\n          if (p === \"preventDefault\") {\r\n            return function () {\r\n              evtprint(\"preventDefault\", name, arguments);\r\n              return e.preventDefault(...arguments);\r\n            }\r\n          } else if (p === \"stopPropagation\") {\r\n            return function () {\r\n              evtprint(\"stopPropagation\", name, arguments);\r\n              return e.preventDefault(...arguments);\r\n            }\r\n          }\r\n\r\n          return e[p];\r\n        }\r\n      });\r\n\r\n      return func.call(this, proxy);\r\n    }\r\n\r\n    func[funckey] = func2;\r\n\r\n    return addevent.call(this, name, func2, args);\r\n  }\r\n\r\n  EventTarget.prototype.removeEventListener = function (name, func, args) {\r\n    //if (name.startsWith(\"key\")) {\r\n    evtprint(\"listener removed\", name, func.name, args);\r\n    //}\r\n\r\n    func = func[funckey];\r\n\r\n    return remevent.call(this, name, func, args);\r\n  }\r\n}\r\n\r\nexport function popModalLight(state) {\r\n  if (state === undefined) {\r\n    console.warn(\"Bad call to popModalLight: state was undefined\");\r\n    return;\r\n  }\r\n\r\n  if (state !== modalstack[modalstack.length - 1]) {\r\n    if (modalstack.indexOf(state) < 0) {\r\n      console.warn(\"Error in popModalLight; modal handler not found\");\r\n      return;\r\n    } else {\r\n      console.warn(\"Error in popModalLight; called in wrong order\");\r\n    }\r\n  }\r\n\r\n  for (let k in state.handlers) {\r\n    //console.log(k);\r\n    window.removeEventListener(k, state.handlers[k], state.handlers[k].settings);\r\n  }\r\n\r\n  state.handlers = {};\r\n  modalstack.remove(state);\r\n  ContextAreaClass.unlock();\r\n\r\n  if (cconst.DEBUG.modalEvents) {\r\n    console.warn(\"popModalLight\", modalstack, state.pointer ? \"(pointer events)\" : \"\");\r\n  }\r\n\r\n  if (state.pointer) {\r\n    let elem = state.pointer.elem;\r\n\r\n    try {\r\n      elem.releasePointerCapture(state.pointer.pointerId);\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n    }\r\n\r\n    for (let k in state.pointer) {\r\n      if (k !== \"elem\" && k !== \"pointerId\") {\r\n        elem.removeEventListener(k, state.pointer[k]);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport function haveModal() {\r\n  return modalstack.length > 0;\r\n}\r\n\r\nwindow._haveModal = haveModal; //for debugging console\r\n\r\nexport var keymap_latin_1 = {\r\n  \"Space\" : 32,\r\n  \"Escape\": 27,\r\n  \"Enter\" : 13,\r\n  \"Return\": 13,\r\n  \"Up\"    : 38,\r\n  \"Down\"  : 40,\r\n  \"Left\"  : 37,\r\n  \"Right\" : 39,\r\n\r\n  \"Num0\"     : 96,\r\n  \"Num1\"     : 97,\r\n  \"Num2\"     : 98,\r\n  \"Num3\"     : 99,\r\n  \"Num4\"     : 100,\r\n  \"Num5\"     : 101,\r\n  \"Num6\"     : 102,\r\n  \"Num7\"     : 103,\r\n  \"Num8\"     : 104,\r\n  \"Num9\"     : 105,\r\n  \"Home\"     : 36,\r\n  \"End\"      : 35,\r\n  \"Delete\"   : 46,\r\n  \"Backspace\": 8,\r\n  \"Insert\"   : 45,\r\n  \"PageUp\"   : 33,\r\n  \"PageDown\" : 34,\r\n  \"Tab\"      : 9,\r\n  \"-\"        : 189,\r\n  \"=\"        : 187,\r\n  \".\"        : 190,\r\n  \"/\"        : 191,\r\n  \",\"        : 188,\r\n  \";\"        : 186,\r\n  \"'\"        : 222,\r\n  \"[\"        : 219,\r\n  \"]\"        : 221,\r\n  \"NumPlus\"  : 107,\r\n  \"NumMinus\" : 109,\r\n  \"Shift\"    : 16,\r\n  \"Ctrl\"     : 17,\r\n  \"Control\"  : 17,\r\n  \"Alt\"      : 18\r\n}\r\n\r\nfor (var i = 0; i < 26; i++) {\r\n  keymap_latin_1[String.fromCharCode(i + 65)] = i + 65\r\n}\r\nfor (var i = 0; i < 10; i++) {\r\n  keymap_latin_1[String.fromCharCode(i + 48)] = i + 48\r\n}\r\n\r\nfor (var k in keymap_latin_1) {\r\n  if (!(k in keymap_latin_1)) {\r\n    keymap_latin_1[keymap_latin_1[k]] = k;\r\n  }\r\n}\r\n\r\nvar keymap_latin_1_rev = {}\r\nfor (var k in keymap_latin_1) {\r\n  keymap_latin_1_rev[keymap_latin_1[k]] = k\r\n}\r\n\r\nexport var keymap = keymap_latin_1;\r\nexport var reverse_keymap = keymap_latin_1_rev;\r\n\r\nexport class HotKey {\r\n  /**action can be a callback or a toolpath string*/\r\n  constructor(key, modifiers, action, uiname) {\r\n    this.action = action;\r\n    this.mods = modifiers;\r\n    this.key = keymap[key];\r\n    this.uiname = uiname;\r\n  }\r\n\r\n  exec(ctx) {\r\n    if (typeof this.action == \"string\") {\r\n      ctx.api.execTool(ctx, this.action);\r\n    } else {\r\n      this.action(ctx);\r\n    }\r\n  }\r\n\r\n  buildString() {\r\n    let s = \"\";\r\n\r\n    for (let i = 0; i < this.mods.length; i++) {\r\n      if (i > 0) {\r\n        s += \" + \";\r\n      }\r\n\r\n      let k = this.mods[i].toLowerCase();\r\n      k = k[0].toUpperCase() + k.slice(1, k.length).toLowerCase();\r\n\r\n      s += k;\r\n    }\r\n\r\n    if (this.mods.length > 0) {\r\n      s += \"+\";\r\n    }\r\n\r\n    s += reverse_keymap[this.key];\r\n\r\n    return s.trim();\r\n  }\r\n}\r\n\r\nexport class KeyMap extends Array {\r\n  /**\r\n   *\r\n   * @param pathid{string} Id of keymap, used when patching hotkeys, when\r\n   *                       that is implemented\r\n   * */\r\n  constructor(hotkeys = [], pathid = \"undefined\") {\r\n    super();\r\n\r\n    this.pathid = pathid;\r\n\r\n    for (let hk of hotkeys) {\r\n      this.add(hk);\r\n    }\r\n  }\r\n\r\n  handle(ctx, e) {\r\n    let mods = new util.set();\r\n    if (e.shiftKey)\r\n      mods.add(\"shift\");\r\n    if (e.altKey)\r\n      mods.add(\"alt\");\r\n    if (e.ctrlKey) {\r\n      mods.add(\"ctrl\");\r\n    }\r\n    if (e.commandKey) {\r\n      mods.add(\"command\");\r\n    }\r\n\r\n    for (let hk of this) {\r\n      let ok = e.keyCode === hk.key;\r\n      if (!ok) continue;\r\n\r\n      let count = 0;\r\n      for (let m of hk.mods) {\r\n        m = m.toLowerCase().trim();\r\n\r\n        if (!mods.has(m)) {\r\n          ok = false;\r\n          break;\r\n        }\r\n\r\n        count++;\r\n      }\r\n\r\n      if (count !== mods.length) {\r\n        ok = false;\r\n      }\r\n\r\n      if (ok) {\r\n        try {\r\n          hk.exec(ctx);\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n          console.log(\"failed to execute a hotkey\", keymap[e.keyCode]);\r\n        }\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n\r\n  add(hk) {\r\n    this.push(hk);\r\n  }\r\n\r\n  push(hk) {\r\n    super.push(hk);\r\n  }\r\n}\r\n\r\n","\"use strict\";\r\n\r\nimport * as util from './util.js';\r\nimport * as simple_events from './simple_events.js';\r\n\r\nexport {keymap, reverse_keymap, keymap_latin_1} from './simple_events.js';\r\n\r\nexport class EventDispatcher {\r\n  constructor() {\r\n    this._cbs = {};\r\n  }\r\n\r\n  _fireEvent(type, data) {\r\n    let stop = false;\r\n\r\n    data = {\r\n      stopPropagation() {\r\n        stop = true;\r\n      },\r\n\r\n      data : data\r\n    };\r\n\r\n    if (type in this._cbs) {\r\n      for (let cb of this._cbs[type]) {\r\n        cb(data);\r\n        if (stop) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  on(type, cb) {\r\n    if (!(type in this._cbs)) {\r\n      this._cbs[type] = [];\r\n    }\r\n\r\n    this._cbs[type].push(cb);\r\n    return this;\r\n  }\r\n\r\n  off(type, cb) {\r\n    if (!(type in this._cbs)) {\r\n      console.warn(\"event handler not in list\", type, cb);\r\n      return this;\r\n    }\r\n\r\n    let stack = this._cbs[type];\r\n    if (stack.indexOf(cb) < 0) {\r\n      console.warn(\"event handler not in list\", type, cb);\r\n      return this;\r\n    }\r\n\r\n    stack.remove(cb);\r\n    return this;\r\n  }\r\n}\r\nexport function copyMouseEvent(e) {\r\n  let ret = {};\r\n  \r\n  function bind(func, obj) {\r\n    return function() {\r\n      return this._orig.apply(func, arguments);\r\n    }\r\n  }\r\n  \r\n  let exclude = new Set([\r\n    //\"prototype\",\r\n    //\"constructor\",\r\n    \"__proto__\"\r\n  ]);\r\n  \r\n  ret._orig = e;\r\n  \r\n  for (let k in e) {\r\n    let v = e[k];\r\n    \r\n    if (exclude.has(k)) {\r\n      continue;\r\n    }\r\n    \r\n    if (typeof v == \"function\") {\r\n      v = bind(v);\r\n    }\r\n    \r\n    ret[k] = v;\r\n  }\r\n\r\n  ret.ctrlKey = e.ctrlKey;\r\n  ret.shiftKey = e.shiftKey;\r\n  ret.altKey = e.altKey;\r\n\r\n  for (let i=0; i<2; i++) {\r\n    let key = i ? \"targetTouches\" : \"touches\";\r\n\r\n    if (e[key]) {\r\n      ret[key] = [];\r\n\r\n      for (let t of e[key]) {\r\n        let t2 = {};\r\n        ret[key].push(t2);\r\n\r\n        for (let k in t) {\r\n          t2[k] = t[k];\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nexport const DomEventTypes = {\r\n  on_mousemove   : 'mousemove',\r\n  on_mousedown   : 'mousedown',\r\n  on_mouseup     : 'mouseup',\r\n  on_touchstart  : 'touchstart',\r\n  on_touchcancel : 'touchcanel',\r\n  on_touchmove   : 'touchmove',\r\n  on_touchend    : 'touchend',\r\n  on_mousewheel  : 'mousewheel',\r\n  on_keydown     : 'keydown',\r\n  on_keyup       : 'keyup',\r\n  on_pointerdown : 'pointerdown',\r\n  on_pointermove : 'pointermove',\r\n  on_pointercancel : 'pointercancel',\r\n  on_pointerup   : 'pointerup',\r\n\r\n  //on_keypress    : 'keypress'\r\n};\r\n\r\nfunction getDom(dom, eventtype) {\r\n  if (eventtype.startsWith(\"key\"))\r\n    return window;\r\n  return dom;\r\n}\r\n\r\nexport let modalStack = [];\r\nexport function isModalHead(owner) {\r\n  return modalStack.length === 0 ||\r\n         modalStack[modalStack.length-1] === owner;\r\n}\r\n\r\nexport class EventHandler {\r\n  constructor() {\r\n    this._modalstate = undefined;\r\n  }\r\n  pushPointerModal(dom, pointerId) {\r\n    if (this._modalstate) {\r\n      console.warn(\"pushPointerModal called twiced!\");\r\n      return;\r\n    }\r\n    \r\n    this._modalstate = simple_events.pushPointerModal(this, dom, pointerId);\r\n  }\r\n  pushModal(dom, _is_root) {\r\n    if (this._modalstate) {\r\n      console.warn(\"pushModal called twiced!\");\r\n      return;\r\n    }\r\n    \r\n    this._modalstate = simple_events.pushModalLight(this);\r\n  }\r\n  \r\n  popModal() {\r\n    if (this._modalstate !== undefined) {\r\n      let modalstate = this._modalstate;\r\n\r\n      //window.setTimeout(() => {\r\n        simple_events.popModalLight(modalstate);\r\n      //});\r\n\r\n      this._modalstate = undefined;\r\n    }\r\n  }\r\n}\r\n\r\nexport function pushModal(dom, handlers) {\r\n  console.warn(\"Deprecated call to pathux.events.pushModal; use api in simple_events.js instead\");\r\n  let h = new EventHandler();\r\n  \r\n  for (let k in handlers) {\r\n    h[k] = handlers[k];\r\n  }\r\n  \r\n  handlers.popModal = () => {\r\n    return h.popModal(dom);\r\n  }\r\n  \r\n  h.pushModal(dom, false);\r\n  \r\n  return h;\r\n}\r\n","import nstructjs from \"../util/struct.js\";\r\nimport * as util from '../util/util.js';\r\n\r\nexport const CurveConstructors = [];\r\nexport const CURVE_VERSION = 1.1;\r\n\r\nexport const CurveFlags = {\r\n  SELECT: 1\r\n};\r\n\r\n\r\nexport const TangentModes = {\r\n  SMOOTH: 1,\r\n  BREAK : 2\r\n};\r\n\r\nexport function getCurve(type, throw_on_error = true) {\r\n  for (let cls of CurveConstructors) {\r\n    if (cls.name === type)\r\n      return cls;\r\n    if (cls.define().name === type)\r\n      return cls;\r\n  }\r\n\r\n  if (throw_on_error) {\r\n    throw new Error(\"Unknown curve type \" + type)\r\n  } else {\r\n    console.warn(\"Unknown curve type\", type);\r\n    return getCurve(\"ease\");\r\n  }\r\n}\r\n\r\nlet _udigest = new util.HashDigest();\r\n\r\nexport class CurveTypeData {\r\n  constructor() {\r\n    this.type = this.constructor.define().typeName;\r\n    this.parent = undefined;\r\n  }\r\n\r\n  get hasGUI() {\r\n    throw new Error(\"get hasGUI(): implement me!\");\r\n  }\r\n\r\n  static register(cls) {\r\n    if (cls.define === CurveTypeData.define) {\r\n      throw new Error(\"missing define() static method\");\r\n    }\r\n\r\n    let def = cls.define();\r\n\r\n    if (!def.name) {\r\n      throw new Error(cls.name + \".define() result is missing 'name' field\");\r\n    }\r\n\r\n    if (!def.typeName) {\r\n      throw new Error(cls.name + \".define() is missing .typeName, which should equal class name; needed for minificaiton\");\r\n    }\r\n\r\n    CurveConstructors.push(cls);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      uiname  : \"Some Curve\",\r\n      name    : \"somecurve\",\r\n      typeName: CurveTypeData\r\n    }\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    let d = digest;\r\n\r\n    d.add(this.type);\r\n\r\n    return d.get();\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      type: this.type\r\n    }\r\n  }\r\n\r\n  equals(b) {\r\n    return this.type === b.type;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    this.type = obj.type;\r\n\r\n    return this;\r\n  }\r\n\r\n  redraw() {\r\n    if (this.parent)\r\n      this.parent.redraw();\r\n  }\r\n\r\n  makeGUI(container) {\r\n\r\n  }\r\n\r\n  killGUI(container) {\r\n    container.clear();\r\n  }\r\n\r\n  evaluate(s) {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  integrate(s1, quadSteps = 64) {\r\n    let ret = 0.0, ds = s1/quadSteps;\r\n\r\n    for (let i = 0, s = 0; i < quadSteps; i++, s += ds) {\r\n      ret += this.evaluate(s)*ds;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  derivative(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.evaluate(s) - this.evaluate(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.evaluate(s + df) - this.evaluate(s))/df;\r\n    } else {\r\n      return (this.evaluate(s + df) - this.evaluate(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  derivative2(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.derivative(s) - this.derivative(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.derivative(s + df) - this.derivative(s))/df;\r\n    } else {\r\n      return (this.derivative(s + df) - this.derivative(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  inverse(y) {\r\n    let steps = 9;\r\n    let ds = 1.0/steps, s = 0.0;\r\n    let best = undefined;\r\n    let ret = undefined;\r\n\r\n    for (let i = 0; i < steps; i++, s += ds) {\r\n      let s1 = s, s2 = s + ds;\r\n\r\n      let mid;\r\n\r\n      for (let j = 0; j < 11; j++) {\r\n        let y1 = this.evaluate(s1);\r\n        let y2 = this.evaluate(s2);\r\n        mid = (s1 + s2)*0.5;\r\n\r\n        if (Math.abs(y1 - y) < Math.abs(y2 - y)) {\r\n          s2 = mid;\r\n        } else {\r\n          s1 = mid;\r\n        }\r\n      }\r\n\r\n      let ymid = this.evaluate(mid);\r\n\r\n      if (best === undefined || Math.abs(y - ymid) < best) {\r\n        best = Math.abs(y - ymid);\r\n        ret = mid;\r\n      }\r\n    }\r\n\r\n    return ret === undefined ? 0.0 : ret;\r\n  }\r\n\r\n  onActive(parent, draw_transform) {\r\n  }\r\n\r\n  onInactive(parent, draw_transform) {\r\n  }\r\n\r\n  reset() {\r\n\r\n  }\r\n\r\n  destroy() {\r\n  }\r\n\r\n  update() {\r\n    if (this.parent)\r\n      this.parent._on_change();\r\n  }\r\n\r\n  draw(canvas, g, draw_transform) {\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n  }\r\n}\r\n\r\nCurveTypeData.STRUCT = `\r\nCurveTypeData {\r\n  type : string;\r\n}\r\n`;\r\nnstructjs.register(CurveTypeData);\r\n\r\n\r\nconst unitRange = [0, 1];\r\n\r\nexport function evalHermiteTable(table, t, range = unitRange) {\r\n  t = (t - range[0])/(range[1] - range[0]);\r\n\r\n  let s = t*(table.length/4);\r\n  let i = Math.floor(s);\r\n\r\n  s -= i;\r\n  i *= 4;\r\n\r\n  let a = table[i] + (table[i + 1] - table[i])*s;\r\n  let b = table[i + 2] + (table[i + 3] - table[i + 2])*s;\r\n\r\n  return a + (b - a)*s;\r\n  //return table[i] + (table[i + 3] - table[i])*s;\r\n}\r\n\r\nexport function genHermiteTable(evaluate, steps, range = [0, 1]) {\r\n  //console.log(\"building spline approx\");\r\n\r\n  let table = new Array(steps);\r\n\r\n  let [min, max] = range;\r\n\r\n  let eps = 0.0001;\r\n  let dt = ((max - min) - eps*4.001)/(steps - 1);\r\n  let t = min + eps*4;\r\n  let lastdv1, lastf3;\r\n\r\n  for (let j = 0; j < steps; j++, t += dt) {\r\n    //let f1 = evaluate(t - eps*2);\r\n    let f2 = evaluate(t - eps);\r\n    let f3 = evaluate(t);\r\n    let f4 = evaluate(t + eps);\r\n    //let f5 = evaluate(t + eps*2);\r\n\r\n    let dv1 = (f4 - f2)/(eps*2);\r\n    dv1 /= steps;\r\n\r\n    if (j > 0) {\r\n      let j2 = j - 1;\r\n\r\n      table[j2*4] = lastf3;\r\n      table[j2*4 + 1] = lastf3 + lastdv1/3.0;\r\n      table[j2*4 + 2] = f3 - dv1/3.0;\r\n      table[j2*4 + 3] = f3;\r\n    }\r\n\r\n    lastdv1 = dv1;\r\n    lastf3 = f3;\r\n  }\r\n\r\n  return table;\r\n}\r\n","\"use strict\";\r\n\r\nimport nstructjs from \"../util/struct.js\";\r\nimport config from '../config/config.js';\r\n\r\nimport * as util from '../util/util.js';\r\n//import * as ui_base from './ui_base.js';\r\nimport * as vectormath from '../util/vectormath.js';\r\n//import {EventDispatcher} from \"../util/events.js\";\r\n\r\nlet Vector2 = vectormath.Vector2;\r\n\r\nexport const SplineTemplates = {\r\n  CONSTANT      : 0,\r\n  LINEAR        : 1,\r\n  SHARP         : 2,\r\n  SQRT          : 3,\r\n  SMOOTH        : 4,\r\n  SMOOTHER      : 5,\r\n  SHARPER       : 6,\r\n  SPHERE        : 7,\r\n  REVERSE_LINEAR: 8,\r\n  GUASSIAN      : 9\r\n};\r\n\r\nconst templates = {\r\n  [SplineTemplates.CONSTANT]      : [\r\n    [1, 1], [1, 1]\r\n  ],\r\n  [SplineTemplates.LINEAR]        : [\r\n    [0, 0], [1, 1]\r\n  ],\r\n  [SplineTemplates.SHARP]         : [\r\n    [0, 0], [0.9999, 0.0001], [1, 1]\r\n  ],\r\n  [SplineTemplates.SQRT]          : [\r\n    [0, 0], [0.05, 0.25], [0.15, 0.45], [0.33, 0.65], [1, 1]\r\n  ],\r\n  [SplineTemplates.SMOOTH]        : [\r\n    \"DEG\", 3, [0, 0], [1.0/3.0, 0], [2.0/3.0, 1.0], [1, 1]\r\n  ],\r\n  [SplineTemplates.SMOOTHER]      : [\r\n    \"DEG\", 6, [0, 0], [1.0/2.25, 0], [2.0/3.0, 1.0], [1, 1]\r\n  ],\r\n  [SplineTemplates.SHARPER]       : [\r\n    [0, 0], [0.3, 0.03], [0.7, 0.065], [0.9, 0.16], [1, 1]\r\n  ],\r\n  [SplineTemplates.SPHERE]        : [\r\n    [0, 0], [0.01953, 0.23438], [0.08203, 0.43359], [0.18359, 0.625], [0.35938, 0.81641], [0.625, 0.97656], [1, 1]\r\n  ],\r\n  [SplineTemplates.REVERSE_LINEAR]: [\r\n    [0, 1], [1, 0]\r\n  ],\r\n  [SplineTemplates.GUASSIAN]      : [\r\n    \"DEG\", 5, [0, 0], [0.17969, 0.007], [0.48958, 0.01172], [0.77995, 0.99609], [1, 1]\r\n  ]\r\n};\r\n\r\n//is initialized below\r\nexport const SplineTemplateIcons = {};\r\n\r\nlet RecalcFlags = {\r\n  BASIS: 1,\r\n  FULL : 2,\r\n  ALL  : 3,\r\n\r\n  //private flag\r\n  FULL_BASIS: 4\r\n}\r\n\r\nexport function mySafeJSONStringify(obj) {\r\n  return JSON.stringify(obj.toJSON(), function (key) {\r\n    let v = this[key];\r\n\r\n    if (typeof v === \"number\") {\r\n      if (v !== Math.floor(v)) {\r\n        v = parseFloat(v.toFixed(5));\r\n      } else {\r\n        v = v;\r\n      }\r\n    }\r\n\r\n    return v;\r\n  });\r\n}\r\n\r\nexport function mySafeJSONParse(buf) {\r\n  return JSON.parse(buf, (key, val) => {\r\n\r\n  });\r\n};\r\n\r\nwindow.mySafeJSONStringify = mySafeJSONStringify;\r\n\r\n\r\nlet bin_cache = {};\r\nwindow._bin_cache = bin_cache;\r\n\r\nlet eval2_rets = util.cachering.fromConstructor(Vector2, 32);\r\n\r\n/*\r\n  I hate these stupid curve widgets.  This horrible one here works by\r\n  root-finding the x axis on a two dimensional b-spline (which works\r\n  surprisingly well).\r\n*/\r\n\r\nfunction bez3(a, b, c, t) {\r\n  let r1 = a + (b - a)*t;\r\n  let r2 = b + (c - b)*t;\r\n\r\n  return r1 + (r2 - r1)*t;\r\n}\r\n\r\nfunction bez4(a, b, c, d, t) {\r\n  let r1 = bez3(a, b, c, t);\r\n  let r2 = bez3(b, c, d, t);\r\n\r\n  return r1 + (r2 - r1)*t;\r\n}\r\n\r\nexport function binomial(n, i) {\r\n  if (i > n) {\r\n    throw new Error(\"Bad call to binomial(n, i), i was > than n\");\r\n  }\r\n\r\n  if (i === 0 || i === n) {\r\n    return 1;\r\n  }\r\n\r\n  let key = \"\" + n + \",\" + i;\r\n\r\n  if (key in bin_cache)\r\n    return bin_cache[key];\r\n\r\n  let ret = binomial(n - 1, i - 1) + bin(n - 1, i);\r\n  bin_cache[key] = ret;\r\n\r\n  return ret;\r\n}\r\n\r\nwindow.bin = binomial;\r\n\r\nimport {CurveFlags, TangentModes, CurveTypeData} from './curve1d_base.js';\r\n\r\nexport class Curve1DPoint extends Vector2 {\r\n  constructor(co) {\r\n    super(co);\r\n\r\n    this.rco = new Vector2(co);\r\n    this.sco = new Vector2(co);\r\n\r\n    //for transform\r\n    this.startco = new Vector2();\r\n    this.eid = -1;\r\n    this.flag = 0;\r\n\r\n    this.tangent = TangentModes.SMOOTH;\r\n\r\n    Object.seal(this);\r\n  }\r\n\r\n  set deg(v) {\r\n    console.warn(\"old file data detected\");\r\n  }\r\n\r\n  static fromJSON(obj) {\r\n    let ret = new Curve1DPoint(obj);\r\n\r\n    ret.eid = obj.eid;\r\n    ret.flag = obj.flag;\r\n    ret.tangent = obj.tangent;\r\n\r\n    ret.rco.load(obj.rco);\r\n\r\n    return ret;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new Curve1DPoint(this);\r\n\r\n    ret.tangent = this.tangent;\r\n    ret.flag = this.flag;\r\n    ret.eid = this.eid;\r\n\r\n    ret.startco.load(this.startco);\r\n    ret.rco.load(this.rco);\r\n    ret.sco.load(this.sco);\r\n\r\n    return ret;\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      0: this[0],\r\n      1: this[1],\r\n\r\n      eid    : this.eid,\r\n      flag   : this.flag,\r\n      tangent: this.tangent,\r\n\r\n      rco: this.rco\r\n    };\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    this.sco.load(this);\r\n    this.rco.load(this);\r\n\r\n    splineCache.update(this);\r\n  }\r\n};\r\nCurve1DPoint.STRUCT = `\r\nCurve1DPoint {\r\n  0       : float;\r\n  1       : float;\r\n  eid     : int;\r\n  flag    : int;\r\n  tangent : int;\r\n  rco     : vec2;\r\n}\r\n`;\r\nnstructjs.register(Curve1DPoint);\r\n\r\nlet _udigest = new util.HashDigest();\r\n\r\nclass BSplineCache {\r\n  constructor() {\r\n    this.curves = [];\r\n    this.map = new Map();\r\n    this.maxCurves = 32;\r\n    this.gen = 0;\r\n  }\r\n\r\n  limit() {\r\n    if (this.curves.length <= this.maxCurves) {\r\n      return;\r\n    }\r\n\r\n    this.curves.sort((a, b) => b.cache_w - a.cache_w);\r\n    while (this.curves.length > this.maxCurves) {\r\n      let curve = this.curves.pop();\r\n      this.map.delete(curve.calcHashKey());\r\n    }\r\n  }\r\n\r\n  has(curve) {\r\n    let curve2 = this.map.get(curve.calcHashKey());\r\n    return curve2 && curve2.equals(curve);\r\n  }\r\n\r\n  get(curve) {\r\n    let key = curve.calcHashKey();\r\n    curve._last_cache_key = key;\r\n\r\n    let curve2 = this.map.get(key);\r\n    if (curve2 && curve2.equals(curve)) {\r\n      curve2.cache_w = this.gen++;\r\n      return curve2;\r\n    }\r\n\r\n    curve2 = curve.copy();\r\n    curve2._last_cache_key = key;\r\n\r\n    curve2.updateKnots();\r\n    curve2.regen_basis();\r\n    curve2.regen_hermite();\r\n\r\n    this.map.set(curve2);\r\n    this.curves.push(curve2);\r\n\r\n    curve2.cache_w = this.gen++;\r\n\r\n    this.limit();\r\n\r\n    return curve2;\r\n  }\r\n\r\n  _remove(key) {\r\n    let curve = this.map.get(key);\r\n    this.map.delete(key);\r\n    this.curves.remove(curve);\r\n  }\r\n\r\n  update(curve) {\r\n    let key = curve._last_cache_key;\r\n\r\n    if (this.map.has(key)) {\r\n      this._remove(curve);\r\n      this.get(curve);\r\n    }\r\n  }\r\n}\r\n\r\nlet splineCache = new BSplineCache();\r\nwindow._splineCache = splineCache;\r\n\r\nclass BSplineCurve extends CurveTypeData {\r\n  constructor() {\r\n    super();\r\n\r\n    this._degOffset = 0;\r\n    this.cache_w = 0;\r\n    this._last_cache_key = 0;\r\n\r\n    this._last_update_key = \"\";\r\n\r\n    this.fastmode = false;\r\n    this.points = [];\r\n    this.length = 0;\r\n    this.interpolating = false;\r\n\r\n    this._ps = [];\r\n    this.hermite = [];\r\n    this.fastmode = false;\r\n\r\n    this.deg = 6;\r\n    this.recalc = RecalcFlags.ALL;\r\n    this.basis_tables = [];\r\n    this.eidgen = new util.IDGen();\r\n\r\n    this.add(0, 0);\r\n    this.add(1, 1);\r\n\r\n    this.mpos = new Vector2();\r\n\r\n    this.on_mousedown = this.on_mousedown.bind(this);\r\n    this.on_mousemove = this.on_mousemove.bind(this);\r\n    this.on_mouseup = this.on_mouseup.bind(this);\r\n    this.on_keydown = this.on_keydown.bind(this);\r\n    this.on_touchstart = this.on_touchstart.bind(this);\r\n    this.on_touchmove = this.on_touchmove.bind(this);\r\n    this.on_touchend = this.on_touchend.bind(this);\r\n    this.on_touchcancel = this.on_touchcancel.bind(this);\r\n  }\r\n\r\n  get hasGUI() {\r\n    return this.uidata !== undefined;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      uiname  : \"B-Spline\",\r\n      name    : \"bspline\",\r\n      typeName: \"BSplineCurve\"\r\n    }\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    let d = digest;\r\n\r\n    super.calcHashKey(d);\r\n\r\n    d.add(this.deg);\r\n    d.add(this.interpolating);\r\n\r\n    for (let p of this.points) {\r\n      let x = ~~(p[0]*1024);\r\n      let y = ~~(p[1]*1024);\r\n\r\n      d.add(x);\r\n      d.add(y);\r\n      d.add(p.tangent); //is an enum\r\n    }\r\n\r\n    return d.get();\r\n  }\r\n\r\n  copyTo(b) {\r\n    b.deg = this.deg;\r\n    b.interpolating = this.interpolating;\r\n    b.fastmode = this.fastmode;\r\n\r\n    for (let p of this.points) {\r\n      let p2 = p.copy();\r\n\r\n      b.points.push(p2);\r\n    }\r\n\r\n    return b;\r\n  }\r\n\r\n  copy() {\r\n    let curve = new BSplineCurve();\r\n    this.copyTo(curve);\r\n    return curve;\r\n  }\r\n\r\n  equals(b) {\r\n    if (b.type !== this.type) {\r\n      return false;\r\n    }\r\n\r\n    let bad = this.points.length !== b.points.length;\r\n\r\n    bad = bad || this.deg !== b.deg;\r\n    bad = bad || this.interpolating !== b.interpolating;\r\n\r\n    if (bad) {\r\n      return false;\r\n    }\r\n\r\n    for (let i = 0; i < this.points.length; i++) {\r\n      let p1 = this.points[i];\r\n      let p2 = b.points[i];\r\n\r\n      let dist = p1.vectorDistance(p2);\r\n\r\n      if (p1.vectorDistance(p2) > 0.00001) {\r\n        return false;\r\n      }\r\n\r\n      if (p1.tangent !== p2.tangent) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  remove(p) {\r\n    let ret = this.points.remove(p);\r\n    this.length = this.points.length;\r\n\r\n    return ret;\r\n  }\r\n\r\n  add(x, y, no_update = false) {\r\n    let p = new Curve1DPoint();\r\n    this.recalc = RecalcFlags.ALL;\r\n\r\n    p.eid = this.eidgen.next();\r\n\r\n    p[0] = x;\r\n    p[1] = y;\r\n\r\n    p.sco.load(p);\r\n    p.rco.load(p);\r\n\r\n    this.points.push(p);\r\n    if (!no_update) {\r\n      this.update();\r\n    }\r\n\r\n    this.length = this.points.length;\r\n\r\n    return p;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  _sortPoints() {\r\n    if (!this.interpolating) {\r\n      for (let i = 0; i < this.points.length; i++) {\r\n        this.points[i].rco.load(this.points[i]);\r\n      }\r\n    }\r\n\r\n    this.points.sort(function (a, b) {\r\n      return a[0] - b[0];\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  updateKnots(recalc = true, points = this.points) {\r\n    if (recalc) {\r\n      this.recalc = RecalcFlags.ALL;\r\n    }\r\n\r\n    this._sortPoints();\r\n\r\n    this._ps = [];\r\n    if (points.length < 2) {\r\n      return;\r\n    }\r\n    let a = points[0][0], b = points[points.length - 1][0];\r\n\r\n    let degExtra = this.deg;\r\n    this._degOffset = -this.deg;\r\n\r\n    for (let i = 0; i < points.length - 1; i++) {\r\n      this._ps.push(points[i]);\r\n    }\r\n\r\n    if (degExtra) {\r\n      let last = points.length - 1;\r\n      for (let i = 0; i < degExtra; i++) {\r\n        let p = points[last].copy();\r\n        this._ps.push(p);\r\n      }\r\n    }\r\n\r\n    if (!this.interpolating) {\r\n      for (let i = 0; i < this._ps.length; i++) {\r\n        this._ps[i].rco.load(this._ps[i]);\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < points.length; i++) {\r\n      let p = points[i];\r\n      let x = p[0], y = p[1];//this.evaluate(x);\r\n\r\n      p.sco[0] = x;\r\n      p.sco[1] = y;\r\n    }\r\n  }\r\n\r\n  toJSON() {\r\n    this._sortPoints();\r\n\r\n    let ret = super.toJSON();\r\n\r\n    ret = Object.assign(ret, {\r\n      points       : this.points.map(p => p.toJSON()),\r\n      deg          : this.deg,\r\n      interpolating: this.interpolating,\r\n      eidgen       : this.eidgen.toJSON()\r\n    });\r\n\r\n    return ret;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    this.interpolating = obj.interpolating;\r\n    this.deg = obj.deg;\r\n\r\n    this.length = 0;\r\n    this.points = [];\r\n    this._ps = [];\r\n\r\n    if (obj.range) {\r\n      /* Will be version patched later. */\r\n      this.range = [new Vector2(obj.range[0]), new Vector2(obj.range[1])];\r\n    }\r\n\r\n    this.hightlight = undefined;\r\n    this.eidgen = util.IDGen.fromJSON(obj.eidgen);\r\n    this.recalc = RecalcFlags.ALL;\r\n    this.mpos = [0, 0];\r\n\r\n    for (let i = 0; i < obj.points.length; i++) {\r\n      this.points.push(Curve1DPoint.fromJSON(obj.points[i]));\r\n    }\r\n\r\n    this.updateKnots();\r\n    this.redraw();\r\n\r\n    return this;\r\n  }\r\n\r\n  basis(t, i) {\r\n    if (this.recalc & RecalcFlags.FULL_BASIS) {\r\n      return this._basis(t, i);\r\n    }\r\n\r\n    if (this.recalc & RecalcFlags.BASIS) {\r\n      this.regen_basis();\r\n      this.recalc &= ~RecalcFlags.BASIS;\r\n    }\r\n\r\n    i = Math.min(Math.max(i, 0), this._ps.length - 1);\r\n    t = Math.min(Math.max(t, 0.0), 1.0)*0.999999999;\r\n\r\n    let table = this.basis_tables[i];\r\n\r\n    let s = t*(table.length/4)*0.99999;\r\n\r\n    let j = ~~s;\r\n    s -= j;\r\n\r\n    j *= 4;\r\n\r\n    //return table[j] + (table[j + 3] - table[j])*s; //linear\r\n    return bez4(table[j], table[j + 1], table[j + 2], table[j + 3], s); //cubic\r\n  }\r\n\r\n  reset(empty = false) {\r\n    this.length = 0;\r\n    this.points = [];\r\n    this._ps = [];\r\n\r\n    if (!empty) {\r\n      this.add(0, 0, true);\r\n      this.add(1, 1, true);\r\n    }\r\n\r\n    this.recalc = 1;\r\n    this.updateKnots();\r\n    this.update();\r\n\r\n    return this;\r\n  }\r\n\r\n  regen_hermite(steps) {\r\n    if (splineCache.has(this)) {\r\n      console.log(\"loading spline approx from cached bspline data\");\r\n\r\n      this.hermite = splineCache.get(this).hermite;\r\n      return;\r\n    }\r\n\r\n    if (steps === undefined) {\r\n      steps = this.fastmode ? 120 : 340;\r\n    }\r\n\r\n    if (this.interpolating) {\r\n      steps *= 2;\r\n    }\r\n\r\n    this.hermite = new Array(steps);\r\n    let table = this.hermite;\r\n\r\n    let eps = 0.00001;\r\n    let dt = (1.0 - eps*4.001)/(steps - 1);\r\n    let t = eps*4;\r\n    let lastdv1, lastf3;\r\n\r\n    for (let j = 0; j < steps; j++, t += dt) {\r\n      let f1 = this._evaluate(t - eps*2);\r\n      let f2 = this._evaluate(t - eps);\r\n      let f3 = this._evaluate(t);\r\n      let f4 = this._evaluate(t + eps);\r\n      let f5 = this._evaluate(t + eps*2);\r\n\r\n      let dv1 = (f4 - f2)/(eps*2);\r\n      dv1 /= steps;\r\n\r\n      if (j > 0) {\r\n        let j2 = j - 1;\r\n\r\n        table[j2*4] = lastf3;\r\n        table[j2*4 + 1] = lastf3 + lastdv1/3.0;\r\n        table[j2*4 + 2] = f3 - dv1/3.0;\r\n        table[j2*4 + 3] = f3;\r\n      }\r\n\r\n      lastdv1 = dv1;\r\n      lastf3 = f3;\r\n    }\r\n  }\r\n\r\n  solve_interpolating() {\r\n    //this.recalc |= RecalcFlags.FULL_BASIS;\r\n\r\n    for (let p of this._ps) {\r\n      p.rco.load(p);\r\n    }\r\n\r\n    let points = this.points.concat(this.points);\r\n\r\n\r\n    this._evaluate2(0.5);\r\n\r\n    let error1 = (p) => {\r\n      //return p.vectorDistance(this._evaluate2(p[0]));\r\n      return this._evaluate(p[0]) - p[1];\r\n    }\r\n\r\n    let error = (p) => {\r\n      return error1(p);\r\n\r\n      /*\r\n      let err = 0.0;\r\n      for (let p of this.points) {\r\n        //err += error1(p)**2;\r\n        err += Math.abs(error1(p));\r\n      }\r\n\r\n      //return Math.sqrt(err);\r\n      return err;\r\n      //*/\r\n    };\r\n\r\n    let err = 0.0;\r\n    let g = new Vector2();\r\n\r\n    for (let step = 0; step < 25; step++) {\r\n      err = 0.0;\r\n\r\n      for (let p of this._ps) {\r\n        let r1 = error(p);\r\n        const df = 0.000001;\r\n\r\n        err += Math.abs(r1);\r\n\r\n        if (p === this._ps[this._ps.length - 1]) {\r\n          continue;\r\n        }\r\n\r\n        g.zero();\r\n\r\n        for (let i = 0; i < 2; i++) {\r\n          let orig = p.rco[i];\r\n          p.rco[i] += df;\r\n          let r2 = error(p);\r\n          p.rco[i] = orig;\r\n\r\n          g[i] = (r2 - r1)/df;\r\n        }\r\n\r\n        let totgs = g.dot(g);\r\n\r\n        if (totgs < 0.00000001) {\r\n          continue;\r\n        }\r\n\r\n        r1 /= totgs;\r\n        let k = 0.5;\r\n\r\n        p.rco[0] += -r1*g[0]*k;\r\n        p.rco[1] += -r1*g[1]*k;\r\n      }\r\n\r\n      let th = this.fastmode ? 0.001 : 0.00005;\r\n      if (err < th) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    //this.recalc &= ~RecalcFlags.FULL_BASIS;\r\n  }\r\n\r\n  regen_basis() {\r\n    if (splineCache.has(this)) {\r\n      console.log(\"loading from cached bspline data\");\r\n\r\n      this.basis_tables = splineCache.get(this).basis_tables;\r\n      return;\r\n    }\r\n\r\n    //let steps = this.fastmode && !this.interpolating ? 64 : 128;\r\n    let steps = this.fastmode ? 64 : 128;\r\n\r\n    if (this.interpolating) {\r\n      steps *= 2;\r\n    }\r\n\r\n    this.basis_tables = new Array(this._ps.length);\r\n\r\n    for (let i = 0; i < this._ps.length; i++) {\r\n      let table = this.basis_tables[i] = new Array((steps - 1)*4);\r\n\r\n      let eps = 0.00001;\r\n      let dt = (1.0 - eps*8)/(steps - 1);\r\n      let t = eps*4;\r\n      let lastdv1 = 0.0, lastf3 = 0.0;\r\n\r\n      for (let j = 0; j < steps; j++, t += dt) {\r\n\r\n        let f3 = this._basis(t, i);\r\n        let dv1;\r\n\r\n        if (0) {\r\n          //let f1 = this._basis(t - eps*2, i);\r\n          let f2 = this._basis(t - eps, i);\r\n          let f4 = this._basis(t + eps, i);\r\n          //let f5 = this._basis(t + eps*2, i);\r\n\r\n          dv1 = (f4 - f2)/(eps*2);\r\n        } else {\r\n          dv1 = this._dbasis(t, i);\r\n        }\r\n\r\n        if (isNaN(dv1)) {\r\n          console.log(\"NaN!\");\r\n          debugger;\r\n          dv1 = this._dbasis(t, i);\r\n        }\r\n        //dv1 = 0.0;\r\n\r\n        //dv1 = 0.0;\r\n        dv1 /= steps;\r\n\r\n        if (j > 0) {\r\n          let j2 = j - 1;\r\n\r\n          table[j2*4] = lastf3;\r\n          table[j2*4 + 1] = lastf3 + lastdv1/3.0;\r\n          table[j2*4 + 2] = f3 - dv1/3.0;\r\n          table[j2*4 + 3] = f3;\r\n        }\r\n\r\n        lastdv1 = dv1;\r\n        lastf3 = f3;\r\n      }\r\n    }\r\n  }\r\n\r\n  _dbasis(t, i) {\r\n    let len = this._ps.length;\r\n    let ps = this._ps;\r\n\r\n    function safe_inv(n) {\r\n      return n === 0 ? 0 : 1.0/n;\r\n    }\r\n\r\n    /*\r\n    on factor;\r\n\r\n    operator bas;\r\n\r\n    a := (s - ki) / (knn - ki);\r\n    b := (knn1 - s) / (knn1 - kn);\r\n\r\n    f := a*bas(s, j, n-1) + b*bas(s, j+1, n-1);\r\n    df(f, s);\r\n    */\r\n\r\n    function bas(s, i, n) {\r\n      let kn = Math.min(Math.max(i + 1, 0), len - 1);\r\n      let knn = Math.min(Math.max(i + n, 0), len - 1);\r\n      let knn1 = Math.min(Math.max(i + n + 1, 0), len - 1);\r\n      let ki = Math.min(Math.max(i, 0), len - 1);\r\n\r\n      if (n === 0) {\r\n        return s >= ps[ki].rco[0] && s < ps[kn].rco[0] ? 1 : 0;\r\n      } else {\r\n\r\n        let a = (s - ps[ki].rco[0])*safe_inv(ps[knn].rco[0] - ps[ki].rco[0] + 0.0001);\r\n        let b = (ps[knn1].rco[0] - s)*safe_inv(ps[knn1].rco[0] - ps[kn].rco[0] + 0.0001);\r\n\r\n        return a*bas(s, i, n - 1) + b*bas(s, i + 1, n - 1);\r\n      }\r\n    }\r\n\r\n    function dbas(s, j, n) {\r\n      let kn = Math.min(Math.max(j + 1, 0), len - 1);\r\n      let knn = Math.min(Math.max(j + n, 0), len - 1);\r\n      let knn1 = Math.min(Math.max(j + n + 1, 0), len - 1);\r\n      let ki = Math.min(Math.max(j, 0), len - 1);\r\n\r\n      kn = ps[kn].rco[0];\r\n      knn = ps[knn].rco[0];\r\n      knn1 = ps[knn1].rco[0];\r\n      ki = ps[ki].rco[0];\r\n\r\n      if (n === 0) {\r\n        return 0;\r\n        //return s >= ki && s < kn ? 1 : 0;\r\n      } else {\r\n        let div = ((ki - knn)*(kn - knn1));\r\n\r\n        if (div === 0.0) {\r\n          //debugger;\r\n          return 0.0;\r\n        }\r\n\r\n        return (((ki - s)*dbas(s, j, n - 1) - bas(s, j, n - 1))*(kn - knn1) - ((knn1 -\r\n          s)*dbas(s, j + 1, n - 1) - bas(s, j + 1, n - 1))*(ki - knn))/div;\r\n      }\r\n    }\r\n\r\n    let deg = this.deg;\r\n    return dbas(t, i + this._degOffset, deg);\r\n  }\r\n\r\n  _basis(t, i) {\r\n    let len = this._ps.length;\r\n    let ps = this._ps;\r\n\r\n    function safe_inv(n) {\r\n      return n === 0 ? 0 : 1.0/n;\r\n    }\r\n\r\n    function bas(s, i, n) {\r\n      let kp = Math.min(Math.max(i - 1, 0), len - 1);\r\n      let kn = Math.min(Math.max(i + 1, 0), len - 1);\r\n      let knn = Math.min(Math.max(i + n, 0), len - 1);\r\n      let knn1 = Math.min(Math.max(i + n + 1, 0), len - 1);\r\n      let ki = Math.min(Math.max(i, 0), len - 1);\r\n\r\n      if (n === 0) {\r\n        return s >= ps[ki].rco[0] && s < ps[kn].rco[0] ? 1 : 0;\r\n      } else {\r\n\r\n        let a = (s - ps[ki].rco[0])*safe_inv(ps[knn].rco[0] - ps[ki].rco[0] + 0.0001);\r\n        let b = (ps[knn1].rco[0] - s)*safe_inv(ps[knn1].rco[0] - ps[kn].rco[0] + 0.0001);\r\n\r\n        return a*bas(s, i, n - 1) + b*bas(s, i + 1, n - 1);\r\n      }\r\n    }\r\n\r\n    let p = this._ps[i].rco, nk, pk;\r\n    let deg = this.deg;\r\n\r\n    let b = bas(t, i + this._degOffset, deg);\r\n\r\n    return b;\r\n  }\r\n\r\n  evaluate(t) {\r\n    let a = this.points[0].rco, b = this.points[this.points.length - 1].rco;\r\n\r\n    if (t < a[0]) return a[1];\r\n    if (t > b[0]) return b[1];\r\n\r\n    if (this.points.length === 2) {\r\n      t = (t - a[0])/(b[0] - a[0]);\r\n      return a[1] + (b[1] - a[1])*t;\r\n    }\r\n\r\n    if (this.recalc) {\r\n      this.regen_basis();\r\n\r\n      if (this.interpolating) {\r\n        this.solve_interpolating();\r\n      }\r\n\r\n      this.regen_hermite();\r\n      this.recalc = 0;\r\n    }\r\n\r\n    t *= 0.999999;\r\n\r\n    let table = this.hermite;\r\n    let s = t*(table.length/4);\r\n\r\n    let i = Math.floor(s);\r\n    s -= i;\r\n\r\n    i *= 4;\r\n\r\n    return table[i] + (table[i + 3] - table[i])*s;\r\n  }\r\n\r\n  /* Root find t on the x axis of the curve.  This\r\n   * is more intuitive for the user.\r\n   */\r\n  _evaluate(t) {\r\n    let start_t = t;\r\n\r\n    if (this.points.length === 0) {\r\n      return 0;\r\n    }\r\n\r\n    let xmin = this.points[0].rco[0];\r\n    let xmax = this.points[this.points.length - 1].rco[0];\r\n\r\n    let steps = this.fastmode ? 16 : 32;\r\n    let s = xmin, ds = (xmax - xmin)/(steps - 1);\r\n\r\n    let miny;\r\n    let mins;\r\n    let mindx;\r\n\r\n    for (let i = 0; i < steps; i++, s += ds) {\r\n      let p = this._evaluate2(s);\r\n\r\n      let dx = Math.abs(p[0] - start_t);\r\n      if (mindx === undefined || dx < mindx) {\r\n        mindx = dx;\r\n        miny = p[1];\r\n        mins = s;\r\n      }\r\n    }\r\n\r\n    let start = mins - ds, end = mins + ds;\r\n    s = mins;\r\n\r\n    for (let i = 0; i < 16; i++) {\r\n      let p = this._evaluate2(s);\r\n\r\n      if (p[0] > start_t) {\r\n        end = s;\r\n      } else {\r\n        start = s;\r\n      }\r\n\r\n      s = (start + end)*0.5;\r\n      miny = p[1];\r\n    }\r\n\r\n    if (miny === undefined) {\r\n      miny = 0;\r\n    }\r\n    return miny;\r\n\r\n    /* newton-raphson\r\n    //t = mins;\r\n    t = s;\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let df = 0.0001;\r\n      let ret1 = this._evaluate2(t < 0.5 ? t : t - df);\r\n      let ret2 = this._evaluate2(t < 0.5 ? t + df : t);\r\n\r\n      let f1 = Math.abs(ret1[0] - start_t);\r\n      let f2 = Math.abs(ret2[0] - start_t);\r\n      let g = (f2 - f1)/df;\r\n\r\n      if (f1 === f2) break;\r\n\r\n      //if (f1 < 0.0005) break;\r\n\r\n      if (f1 === 0.0 || g === 0.0)\r\n        return this._evaluate2(t)[1];\r\n\r\n      let fac = -(f1/g)*0.5;\r\n      if (fac === 0.0) {\r\n        fac = 0.01;\r\n      } else if (Math.abs(fac) > 0.1) {\r\n        fac = 0.1*Math.sign(fac);\r\n      }\r\n\r\n      t += fac;\r\n      let eps = 0.00001;\r\n      t = Math.min(Math.max(t, eps), 1.0 - eps);\r\n    }\r\n\r\n    return this._evaluate2(t)[1];\r\n    */\r\n  }\r\n\r\n  _evaluate2(t) {\r\n    let ret = eval2_rets.next();\r\n\r\n    t *= 0.9999999;\r\n\r\n    let sumx = 0;\r\n    let sumy = 0;\r\n\r\n    let totbasis = 0;\r\n\r\n    for (let i = 0; i < this._ps.length; i++) {\r\n      let p = this._ps[i].rco;\r\n      let b = this.basis(t, i);\r\n\r\n      sumx += b*p[0];\r\n      sumy += b*p[1];\r\n\r\n      totbasis += b;\r\n    }\r\n\r\n    if (totbasis !== 0.0) {\r\n      sumx /= totbasis;\r\n      sumy /= totbasis;\r\n    }\r\n\r\n    ret[0] = sumx;\r\n    ret[1] = sumy;\r\n\r\n    return ret;\r\n  }\r\n\r\n  _wrapTouchEvent(e) {\r\n    return {\r\n      x              : e.touches.length ? e.touches[0].pageX : this.mpos[0],\r\n      y              : e.touches.length ? e.touches[0].pageY : this.mpos[1],\r\n      button         : 0,\r\n      shiftKey       : e.shiftKey,\r\n      altKey         : e.altKey,\r\n      ctrlKey        : e.ctrlKey,\r\n      isTouch        : true,\r\n      commandKey     : e.commandKey,\r\n      stopPropagation: () => e.stopPropagation(),\r\n      preventDefault : () => e.preventDefault()\r\n    };\r\n  }\r\n\r\n  on_touchstart(e) {\r\n    this.mpos[0] = e.touches[0].pageX;\r\n    this.mpos[1] = e.touches[0].pageY;\r\n\r\n    let e2 = this._wrapTouchEvent(e);\r\n\r\n    this.on_mousemove(e2);\r\n    this.on_mousedown(e2);\r\n  }\r\n\r\n  loadTemplate(templ) {\r\n    if (templ === undefined || !templates[templ]) {\r\n      console.warn(\"Unknown bspline template\", templ);\r\n      return;\r\n    }\r\n\r\n    templ = templates[templ];\r\n\r\n    this.reset(true);\r\n    this.deg = 3.0;\r\n\r\n    for (let i = 0; i < templ.length; i++) {\r\n      let p = templ[i];\r\n\r\n      if (p === \"DEG\") {\r\n        this.deg = templ[i + 1];\r\n        i++;\r\n        continue;\r\n      }\r\n\r\n      this.add(p[0], p[1], true);\r\n    }\r\n\r\n    this.recalc = 1;\r\n    this.updateKnots();\r\n    this.update();\r\n    this.redraw();\r\n  }\r\n\r\n  on_touchmove(e) {\r\n    this.mpos[0] = e.touches[0].pageX;\r\n    this.mpos[1] = e.touches[0].pageY;\r\n\r\n    let e2 = this._wrapTouchEvent(e);\r\n    this.on_mousemove(e2);\r\n  }\r\n\r\n  on_touchend(e) {\r\n    this.on_mouseup(this._wrapTouchEvent(e));\r\n  }\r\n\r\n  on_touchcancel(e) {\r\n    this.on_touchend(e);\r\n  }\r\n\r\n  makeGUI(container, canvas, drawTransform) {\r\n    this.uidata = {\r\n      start_mpos : new Vector2(),\r\n      transpoints: [],\r\n\r\n      dom         : container,\r\n      canvas      : canvas,\r\n      g           : canvas.g,\r\n      transforming: false,\r\n      draw_trans  : drawTransform\r\n    };\r\n\r\n    canvas.addEventListener(\"touchstart\", this.on_touchstart);\r\n    canvas.addEventListener(\"touchmove\", this.on_touchmove);\r\n    canvas.addEventListener(\"touchend\", this.on_touchend);\r\n    canvas.addEventListener(\"touchcancel\", this.on_touchcancel);\r\n\r\n    canvas.addEventListener(\"mousedown\", this.on_mousedown);\r\n    canvas.addEventListener(\"mousemove\", this.on_mousemove);\r\n    canvas.addEventListener(\"mouseup\", this.on_mouseup);\r\n    canvas.addEventListener(\"keydown\", this.on_keydown);\r\n\r\n    let bstrip = container.row().strip();\r\n\r\n    let makebutton = (strip, k) => {\r\n      let uiname = k[0] + k.slice(1, k.length).toLowerCase();\r\n      uiname = uiname.replace(/_/g, \" \");\r\n\r\n      let icon = strip.iconbutton(-1, uiname, () => {\r\n        this.loadTemplate(SplineTemplates[k]);\r\n      });\r\n\r\n      icon.iconsheet = 0;\r\n      icon.customIcon = SplineTemplateIcons[k];\r\n    }\r\n\r\n    for (let k in SplineTemplates) {\r\n      makebutton(bstrip, k);\r\n    }\r\n\r\n    let row = container.row();\r\n\r\n    let fullUpdate = () => {\r\n      this.updateKnots();\r\n      this.update();\r\n      this.regen_basis();\r\n      this.recalc = RecalcFlags.ALL;\r\n      this.redraw();\r\n    };\r\n\r\n    let Icons = row.constructor.getIconEnum();\r\n\r\n    let icon = Icons.LARGE_X !== undefined ? Icons.LARGE_X : Icons.TINY_X;\r\n    if (Icons.LARGE_X === undefined) {\r\n      console.log(Icons);\r\n      console.error(\"Curve widget expects Icons.LARGE_X icon for delete button.\");\r\n    }\r\n\r\n    row.iconbutton(icon, \"Delete Point\", () => {\r\n      for (let i = 0; i < this.points.length; i++) {\r\n        let p = this.points[i];\r\n\r\n        if (p.flag & CurveFlags.SELECT) {\r\n          this.points.remove(p);\r\n          i--;\r\n        }\r\n      }\r\n\r\n      fullUpdate();\r\n    });\r\n\r\n    row.button(\"Reset\", () => {\r\n      this.reset();\r\n    });\r\n\r\n    let slider = row.simpleslider(undefined, {\r\n      name      : \"Degree\",\r\n      defaultval: this.deg,\r\n      min       : 1,\r\n      max       : 7,\r\n      isInt     : true,\r\n      callback  : (slider) => {\r\n        this.deg = Math.floor(slider.value);\r\n        fullUpdate();\r\n      }\r\n    });\r\n    /*\r\n    let slider = row.simpleslider(undefined, \"Degree\", this.deg, 1, 6, 1, true, true, (slider) => {\r\n      this.deg = Math.floor(slider.value);\r\n      console.log(slider.value);\r\n\r\n      fullUpdate();\r\n    });*/\r\n\r\n    slider.baseUnit = \"none\";\r\n    slider.displayUnit = \"none\";\r\n\r\n    row = container.row();\r\n    let check = row.check(undefined, \"Interpolating\");\r\n    check.checked = this.interpolating;\r\n\r\n    check.onchange = () => {\r\n      this.interpolating = check.value;\r\n      fullUpdate();\r\n    }\r\n\r\n    container.update.after(() => {\r\n      let key = this.calcHashKey();\r\n      if (key !== this._last_update_key) {\r\n        this._last_update_key = key;\r\n\r\n        slider.setValue(this.deg);\r\n      }\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  killGUI(container, canvas) {\r\n    if (this.uidata !== undefined) {\r\n      let ud = this.uidata;\r\n      this.uidata = undefined;\r\n\r\n      canvas.removeEventListener(\"touchstart\", this.on_touchstart);\r\n      canvas.removeEventListener(\"touchmove\", this.on_touchmove);\r\n      canvas.removeEventListener(\"touchend\", this.on_touchend);\r\n      canvas.removeEventListener(\"touchcancel\", this.on_touchcancel);\r\n\r\n      canvas.removeEventListener(\"mousedown\", this.on_mousedown);\r\n      canvas.removeEventListener(\"mousemove\", this.on_mousemove);\r\n      canvas.removeEventListener(\"mouseup\", this.on_mouseup);\r\n      canvas.removeEventListener(\"keydown\", this.on_keydown);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  start_transform() {\r\n    this.uidata.transpoints = [];\r\n\r\n    for (let p of this.points) {\r\n      if (p.flag & CurveFlags.SELECT) {\r\n        this.uidata.transpoints.push(p);\r\n        p.startco.load(p);\r\n      }\r\n    }\r\n  }\r\n\r\n  on_mousedown(e) {\r\n    this.uidata.start_mpos.load(this.transform_mpos(e.x, e.y));\r\n    this.fastmode = true;\r\n\r\n    let mpos = this.transform_mpos(e.x, e.y);\r\n    let x = mpos[0], y = mpos[1];\r\n    this.do_highlight(x, y);\r\n\r\n    if (this.points.highlight !== undefined) {\r\n      if (!e.shiftKey) {\r\n        for (let i = 0; i < this.points.length; i++) {\r\n          this.points[i].flag &= ~CurveFlags.SELECT;\r\n        }\r\n\r\n        this.points.highlight.flag |= CurveFlags.SELECT;\r\n      } else {\r\n        this.points.highlight.flag ^= CurveFlags.SELECT;\r\n      }\r\n\r\n\r\n      this.uidata.transforming = true;\r\n\r\n      this.start_transform();\r\n\r\n      this.updateKnots();\r\n      this.update();\r\n      this.redraw();\r\n      return;\r\n    } else { //if (!e.isTouch) {\r\n      let p = this.add(this.uidata.start_mpos[0], this.uidata.start_mpos[1]);\r\n      this.points.highlight = p;\r\n\r\n      this.updateKnots();\r\n      this.update();\r\n      this.redraw();\r\n\r\n      this.points.highlight.flag |= CurveFlags.SELECT;\r\n\r\n      this.uidata.transforming = true;\r\n      this.uidata.transpoints = [this.points.highlight];\r\n      this.uidata.transpoints[0].startco.load(this.uidata.transpoints[0]);\r\n    }\r\n  }\r\n\r\n  do_highlight(x, y) {\r\n    let trans = this.uidata.draw_trans;\r\n    let mindis = 1e17, minp = undefined;\r\n    let limit = 19/trans[0], limitsqr = limit*limit;\r\n\r\n    for (let i = 0; i < this.points.length; i++) {\r\n      let p = this.points[i];\r\n      let dx = x - p.sco[0], dy = y - p.sco[1], dis = dx*dx + dy*dy;\r\n\r\n      if (dis < mindis && dis < limitsqr) {\r\n        mindis = dis;\r\n        minp = p;\r\n      }\r\n    }\r\n\r\n    if (this.points.highlight !== minp) {\r\n      this.points.highlight = minp;\r\n      this.redraw()\r\n    }\r\n  }\r\n\r\n  do_transform(x, y) {\r\n    let off = new Vector2([x, y]).sub(this.uidata.start_mpos);\r\n\r\n    let xRange = this.parent.xRange;\r\n    let yRange = this.parent.yRange;\r\n\r\n    for (let i = 0; i < this.uidata.transpoints.length; i++) {\r\n      let p = this.uidata.transpoints[i];\r\n      p.load(p.startco).add(off);\r\n\r\n      p[0] = Math.min(Math.max(p[0], xRange[0]), xRange[1]);\r\n      p[1] = Math.min(Math.max(p[1], yRange[0]), yRange[1]);\r\n    }\r\n\r\n    this.updateKnots();\r\n    this.update();\r\n    this.redraw();\r\n  }\r\n\r\n  transform_mpos(x, y) {\r\n    let r = this.uidata.canvas.getClientRects()[0];\r\n    let dpi = devicePixelRatio; //evil module cycle: UIBase.getDPI();\r\n\r\n    x -= parseInt(r.left);\r\n    y -= parseInt(r.top);\r\n\r\n    x *= dpi;\r\n    y *= dpi;\r\n\r\n    let trans = this.uidata.draw_trans;\r\n\r\n    x = x/trans[0] - trans[1][0];\r\n    y = -y/trans[0] - trans[1][1];\r\n\r\n    return [x, y];\r\n  }\r\n\r\n  on_mousemove(e) {\r\n    if (e.isTouch && this.uidata.transforming) {\r\n      e.preventDefault();\r\n    }\r\n\r\n    let mpos = this.transform_mpos(e.x, e.y);\r\n    let x = mpos[0], y = mpos[1];\r\n\r\n    if (this.uidata.transforming) {\r\n      this.do_transform(x, y);\r\n      this.evaluate(0.5);\r\n      //this.update();\r\n      //this.doSave();\r\n    } else {\r\n      this.do_highlight(x, y);\r\n    }\r\n  }\r\n\r\n  end_transform() {\r\n    this.uidata.transforming = false;\r\n    this.fastmode = false;\r\n    this.updateKnots();\r\n    this.update();\r\n\r\n    splineCache.update(this);\r\n  }\r\n\r\n  on_mouseup(e) {\r\n    this.end_transform();\r\n  }\r\n\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case 88: //xkeey\r\n      case 46: //delete\r\n        if (this.points.highlight !== undefined) {\r\n          this.points.remove(this.points.highlight);\r\n          this.recalc = RecalcFlags.ALL;\r\n\r\n          this.points.highlight = undefined;\r\n          this.updateKnots();\r\n          this.update();\r\n\r\n          if (this._save_hook !== undefined) {\r\n            this._save_hook();\r\n          }\r\n        }\r\n        break;\r\n    }\r\n  }\r\n\r\n  draw(canvas, g, draw_trans) {\r\n    g.save();\r\n\r\n    if (this.uidata === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.uidata.canvas = canvas;\r\n    this.uidata.g = g;\r\n    this.uidata.draw_trans = draw_trans;\r\n\r\n    let sz = draw_trans[0], pan = draw_trans[1];\r\n    g.lineWidth *= 1.5;\r\n    let strokeStyle = g.strokeStyle;\r\n\r\n    for (let ssi = 0; ssi < 1; ssi++) {\r\n      break; //uncomment to draw basis functions\r\n\r\n      let steps = 512;\r\n      for (let si = 0; si < this.points.length; si++) {\r\n        g.beginPath();\r\n\r\n        let f = 0;\r\n        let df = 1.0/(steps - 1);\r\n        for (let i = 0; i < steps; i++, f += df) {\r\n          let totbasis = 0;\r\n\r\n          for (let j = 0; j < this.points.length; j++) {\r\n            totbasis += this.basis(f, j);\r\n          }\r\n\r\n          let val = this.basis(f, si);\r\n\r\n          if (ssi)\r\n            val /= (totbasis === 0 ? 1 : totbasis);\r\n\r\n          (i === 0 ? g.moveTo : g.lineTo).call(g, f, ssi ? val : val*0.5);\r\n        }\r\n\r\n        let color, alpha = this.points[si] === this.points.highlight ? 1.0 : 0.7;\r\n\r\n        if (ssi) {\r\n          color = \"rgba(205, 125, 5,\" + alpha + \")\";\r\n        } else {\r\n          color = \"rgba(25, 145, 45,\" + alpha + \")\";\r\n        }\r\n        g.strokeStyle = color;\r\n        g.stroke();\r\n      }\r\n    }\r\n\r\n    g.strokeStyle = strokeStyle;\r\n    g.lineWidth /= 3.0;\r\n\r\n    let w = 0.03;\r\n\r\n    for (let p of this.points) {\r\n      g.beginPath();\r\n\r\n      if (p === this.points.highlight) {\r\n        g.fillStyle = \"green\";\r\n      } else if (p.flag & CurveFlags.SELECT) {\r\n        g.fillStyle = \"red\";\r\n      } else {\r\n        g.fillStyle = \"orange\";\r\n      }\r\n\r\n      g.rect(p.sco[0] - w/2, p.sco[1] - w/2, w, w);\r\n\r\n      g.fill();\r\n    }\r\n\r\n    g.restore();\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n\r\n    this.updateKnots();\r\n    this.recalc = RecalcFlags.ALL;\r\n  }\r\n}\r\n\r\nBSplineCurve.STRUCT = nstructjs.inherit(BSplineCurve, CurveTypeData) + `\r\n  points        : array(Curve1DPoint);\r\n  deg           : int;\r\n  eidgen        : IDGen;\r\n  interpolating : bool;\r\n}\r\n`;\r\nnstructjs.register(BSplineCurve);\r\nCurveTypeData.register(BSplineCurve);\r\n\r\n\r\nfunction makeSplineTemplateIcons(size = 64) {\r\n  let dpi = devicePixelRatio;\r\n  size = ~~(size*dpi);\r\n\r\n  for (let k in SplineTemplates) {\r\n    let curve = new BSplineCurve();\r\n    curve.loadTemplate(SplineTemplates[k])\r\n\r\n    curve.fastmode = true;\r\n\r\n    let canvas = document.createElement(\"canvas\");\r\n    canvas.width = canvas.height = size;\r\n\r\n    let g = canvas.getContext(\"2d\");\r\n    let steps = 64;\r\n\r\n    curve.update();\r\n\r\n    let scale = 0.5;\r\n\r\n    g.translate(-0.5, -0.5);\r\n    g.scale(size*scale, size*scale);\r\n    g.translate(0.5, 0.5);\r\n\r\n    //margin\r\n    let m = 0.0;\r\n\r\n    let tent = f => 1.0 - Math.abs(Math.fract(f) - 0.5)*2.0;\r\n\r\n    for (let i = 0; i < steps; i++) {\r\n      let s = i/(steps - 1);\r\n      let f = 1.0 - curve.evaluate(tent(s));\r\n\r\n      s = s*(1.0 - m*2.0) + m;\r\n      f = f*(1.0 - m*2.0) + m;\r\n\r\n      //s += 0.5;\r\n      //f += 0.5;\r\n\r\n      if (i === 0) {\r\n        g.moveTo(s, f);\r\n      } else {\r\n        g.lineTo(s, f);\r\n      }\r\n    }\r\n\r\n    const ls = 7.0;\r\n\r\n    g.lineCap = \"round\";\r\n    g.strokeStyle = \"black\";\r\n    g.lineWidth = ls*3*dpi/(size*scale);\r\n    g.stroke();\r\n\r\n    g.strokeStyle = \"white\";\r\n    g.lineWidth = ls*dpi/(size*scale);\r\n    g.stroke();\r\n\r\n    let url = canvas.toDataURL();\r\n    let img = document.createElement(\"img\");\r\n    img.src = url;\r\n\r\n    SplineTemplateIcons[k] = img;\r\n    SplineTemplateIcons[SplineTemplates[k]] = img;\r\n  }\r\n}\r\n\r\nlet splineTemplatesLoaded = false;\r\n\r\nexport function initSplineTemplates() {\r\n  if (splineTemplatesLoaded) {\r\n    return;\r\n  }\r\n\r\n  splineTemplatesLoaded = true;\r\n\r\n  for (let k in SplineTemplates) {\r\n    let curve = new BSplineCurve();\r\n    curve.loadTemplate(SplineTemplates[k]);\r\n    splineCache.get(curve);\r\n  }\r\n\r\n  makeSplineTemplateIcons();\r\n  window._SplineTemplateIcons = SplineTemplateIcons;\r\n}\r\n\r\n//delay to ensure config is fully loaded\r\nwindow.setTimeout(() => {\r\n  if (config.autoLoadSplineTemplates) {\r\n    initSplineTemplates();\r\n  }\r\n}, 0);\r\n\r\n","import nstructjs from \"../util/struct.js\";\r\nimport {CurveFlags, TangentModes, CurveTypeData} from './curve1d_base.js';\r\nimport {Vector2, Vector3, Vector4, Quat, Matrix4} from '../util/vectormath.js';\r\nimport * as util from '../util/util.js';\r\n\r\nlet _udigest = new util.HashDigest();\r\n\r\nfunction feq(a, b) {\r\n  return Math.abs(a - b) < 0.00001;\r\n}\r\n\r\nclass EquationCurve extends CurveTypeData {\r\n  constructor(type) {\r\n    super();\r\n\r\n    this.equation = \"x\";\r\n    this._last_equation = \"\";\r\n    this._last_xrange = new Vector2();\r\n    this._func = undefined;\r\n  }\r\n\r\n  get hasGUI() {\r\n    return this.uidata !== undefined;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      uiname  : \"Equation\",\r\n      name    : \"equation\",\r\n      typeName: \"EquationCurve\"\r\n    }\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    let d = digest;\r\n\r\n    super.calcHashKey(d);\r\n\r\n    d.add(this.equation);\r\n    d.add(this.parent.xRange[0]);\r\n    d.add(this.parent.xRange[1]);\r\n\r\n    return d.get();\r\n  }\r\n\r\n  equals(b) {\r\n    return super.equals(b) && this.equation === b.equation;\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = super.toJSON();\r\n\r\n    return Object.assign(ret, {\r\n      equation: this.equation\r\n    });\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    if (obj.equation !== undefined) {\r\n      this.equation = obj.equation;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  makeGUI(container, canvas, drawTransform) {\r\n    this.uidata = {\r\n      canvas    : canvas,\r\n      g         : canvas.g,\r\n      draw_trans: drawTransform,\r\n    };\r\n\r\n    let row = container.row();\r\n\r\n    let text = this.uidata.textbox = row.textbox(undefined, \"\" + this.equation);\r\n    text.onchange = (val) => {\r\n      console.log(val);\r\n      this.equation = val;\r\n      this.update();\r\n      this.redraw();\r\n    }\r\n\r\n    container.label(\"Equation\");\r\n\r\n  }\r\n\r\n  killGUI(dom, gui, canvas, g, draw_transform) {\r\n    if (this.uidata !== undefined) {\r\n      this.uidata.textbox.remove();\r\n    }\r\n\r\n    this.uidata = undefined;\r\n  }\r\n\r\n  updateTextBox() {\r\n    if (this.uidata && this.uidata.textbox) {\r\n      this.uidata.textbox.text = this.equation;\r\n    }\r\n  }\r\n\r\n  evaluate(s) {\r\n    let update = this.hermite || this._last_equation !== this.equation;\r\n    update = update || this._last_xrange.vectorDistance(this.parent.xRange) > 0.0;\r\n    update = update || !this._func;\r\n\r\n    if (update) {\r\n      this._last_xrange.load(this.parent.xRange);\r\n      this._last_equation = this.equation;\r\n\r\n      this.updateTextBox();\r\n      this.#makeFunc();\r\n\r\n      this._evaluate(0.0);\r\n\r\n      if (this._haserror) {\r\n        console.warn(\"ERROR!\");\r\n        return 0.0;\r\n      }\r\n    }\r\n\r\n    return this._func(s);\r\n  }\r\n\r\n  #makeFunc() {\r\n    this._func = undefined;\r\n\r\n    var sin = Math.sin, cos = Math.cos, pi = Math.PI, PI = Math.PI,\r\n        e                                                = Math.E, E                                    = Math.E, tan                      = Math.tan, abs = Math.abs,\r\n        floor                                            = Math.floor, ceil = Math.ceil, acos = Math.acos,\r\n        asin                                             = Math.asin, atan = Math.atan, cosh         = Math.cos,\r\n        sinh                                             = Math.sinh, log                            = Math.log, pow = Math.pow,\r\n        exp                                              = Math.exp, sqrt = Math.sqrt, cbrt           = Math.cbrt,\r\n        min                                              = Math.min, max = Math.max;\r\n\r\n    var func;\r\n    let code = `\r\n    func = function(x) {\r\n      return ${this.equation};\r\n    }\r\n    `;\r\n    try {\r\n      eval(code);\r\n\r\n      this._haserror = false;\r\n    } catch (error) {\r\n      this._haserror = true;\r\n      console.warn(\"Compile error!\", error.message);\r\n    }\r\n\r\n    this._func = func;\r\n  }\r\n\r\n  _evaluate(s) {\r\n    try {\r\n      let f = this._func(s);\r\n      this._haserror = false;\r\n\r\n      if (isNaN(f)) {\r\n        return 0.0;\r\n      }\r\n    } catch (error) {\r\n      this._haserror = true;\r\n      console.warn(\"ERROR!\");\r\n      return 0.0;\r\n    }\r\n  }\r\n\r\n  derivative(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.evaluate(s) - this.evaluate(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.evaluate(s + df) - this.evaluate(s))/df;\r\n    } else {\r\n      return (this.evaluate(s + df) - this.evaluate(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  derivative2(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.derivative(s) - this.derivative(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.derivative(s + df) - this.derivative(s))/df;\r\n    } else {\r\n      return (this.derivative(s + df) - this.derivative(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  inverse(y) {\r\n    let steps = 9;\r\n    let ds = 1.0/steps, s = 0.0;\r\n    let best = undefined;\r\n    let ret = undefined;\r\n\r\n    for (let i = 0; i < steps; i++, s += ds) {\r\n      let s1 = s, s2 = s + ds;\r\n\r\n      let mid;\r\n\r\n      for (let j = 0; j < 11; j++) {\r\n        let y1 = this.evaluate(s1);\r\n        let y2 = this.evaluate(s2);\r\n        mid = (s1 + s2)*0.5;\r\n\r\n        if (Math.abs(y1 - y) < Math.abs(y2 - y)) {\r\n          s2 = mid;\r\n        } else {\r\n          s1 = mid;\r\n        }\r\n      }\r\n\r\n      let ymid = this.evaluate(mid);\r\n\r\n      if (best === undefined || Math.abs(y - ymid) < best) {\r\n        best = Math.abs(y - ymid);\r\n        ret = mid;\r\n      }\r\n    }\r\n\r\n    return ret === undefined ? 0.0 : ret;\r\n  }\r\n\r\n  onActive(parent, draw_transform) {\r\n  }\r\n\r\n  onInactive(parent, draw_transform) {\r\n  }\r\n\r\n  reset() {\r\n    this.equation = \"x\";\r\n  }\r\n\r\n  destroy() {\r\n  }\r\n\r\n  draw(canvas, g, draw_transform) {\r\n    g.save();\r\n    if (this._haserror) {\r\n\r\n      g.fillStyle = g.strokeStyle = \"rgba(255, 50, 0, 0.25)\";\r\n      g.beginPath();\r\n      g.rect(0, 0, 1, 1);\r\n      g.fill();\r\n\r\n      g.beginPath();\r\n      g.moveTo(0, 0);\r\n      g.lineTo(1, 1);\r\n      g.moveTo(0, 1);\r\n      g.lineTo(1, 0);\r\n\r\n      g.lineWidth *= 3;\r\n      g.stroke();\r\n\r\n      g.restore();\r\n      return;\r\n    }\r\n\r\n    g.restore();\r\n  }\r\n}\r\n\r\nEquationCurve.STRUCT = nstructjs.inherit(EquationCurve, CurveTypeData) + `\r\n  equation : string;\r\n}\r\n`;\r\nnstructjs.register(EquationCurve);\r\nCurveTypeData.register(EquationCurve);\r\n\r\n\r\nclass GuassianCurve extends CurveTypeData {\r\n  constructor(type) {\r\n    super();\r\n\r\n    this.height = 1.0;\r\n    this.offset = 1.0;\r\n    this.deviation = 0.3; //standard deviation\r\n  }\r\n\r\n  get hasGUI() {\r\n    return this.uidata !== undefined;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      uiname  : \"Guassian\",\r\n      name    : \"guassian\",\r\n      typeName: \"GuassianCurve\"\r\n    }\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    super.calcHashKey(digest);\r\n\r\n    let d = digest;\r\n\r\n    d.add(this.height);\r\n    d.add(this.offset);\r\n    d.add(this.deviation);\r\n\r\n    return d.get();\r\n  }\r\n\r\n  equals(b) {\r\n    let r = super.equals(b);\r\n\r\n    r = r && feq(this.height, b.height);\r\n    r = r && feq(this.offset, b.offset);\r\n    r = r && feq(this.deviation, b.deviation);\r\n\r\n    return r;\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = super.toJSON();\r\n\r\n    return Object.assign(ret, {\r\n      height   : this.height,\r\n      offset   : this.offset,\r\n      deviation: this.deviation\r\n    });\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    this.height = obj.height !== undefined ? obj.height : 1.0;\r\n    this.offset = obj.offset;\r\n    this.deviation = obj.deviation;\r\n\r\n    return this;\r\n  }\r\n\r\n  makeGUI(container, canvas, drawTransform) {\r\n    this.uidata = {\r\n      canvas    : canvas,\r\n      g         : canvas.g,\r\n      draw_trans: drawTransform,\r\n    };\r\n\r\n    this.uidata.hslider = container.slider(undefined, \"Height\", this.height, -10, 10, 0.0001);\r\n    this.uidata.hslider.onchange = () => {\r\n      this.height = this.uidata.hslider.value;\r\n      this.redraw();\r\n      this.update();\r\n    }\r\n    this.uidata.oslider = container.slider(undefined, \"Offset\", this.offset, -10, 10, 0.0001);\r\n    this.uidata.oslider.onchange = () => {\r\n      this.offset = this.uidata.oslider.value;\r\n      this.redraw();\r\n      this.update();\r\n    }\r\n    this.uidata.dslider = container.slider(undefined, \"STD Deviation\", this.deviation, -10, 10, 0.0001);\r\n    this.uidata.dslider.onchange = () => {\r\n      this.deviation = this.uidata.dslider.value;\r\n      this.redraw();\r\n      this.update();\r\n    }\r\n\r\n    /*\r\n    this.uidata.oslider = gui.slider(undefined, \"Offset\", this.offset,\r\n      -2.5, 2.5, 0.0001, false, false, (val) => {this.offset = val, this.update(), this.redraw();});\r\n    this.uidata.dslider = gui.slider(undefined, \"STD Deviation\", this.deviation,\r\n      0.0001, 1.25, 0.0001, false, false, (val) => {this.deviation = val, this.update(), this.redraw();});\r\n    //*/\r\n  }\r\n\r\n  killGUI(dom, gui, canvas, g, draw_transform) {\r\n    if (this.uidata !== undefined) {\r\n      this.uidata.hslider.remove();\r\n      this.uidata.oslider.remove();\r\n      this.uidata.dslider.remove();\r\n    }\r\n\r\n    this.uidata = undefined;\r\n  }\r\n\r\n  evaluate(s) {\r\n    let r = this.height*Math.exp(-((s - this.offset)*(s - this.offset))/(2*this.deviation*this.deviation));\r\n    return r;\r\n  }\r\n\r\n  derivative(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.evaluate(s) - this.evaluate(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.evaluate(s + df) - this.evaluate(s))/df;\r\n    } else {\r\n      return (this.evaluate(s + df) - this.evaluate(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  derivative2(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.derivative(s) - this.derivative(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.derivative(s + df) - this.derivative(s))/df;\r\n    } else {\r\n      return (this.derivative(s + df) - this.derivative(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  inverse(y) {\r\n    let steps = 9;\r\n    let ds = 1.0/steps, s = 0.0;\r\n    let best = undefined;\r\n    let ret = undefined;\r\n\r\n    for (let i = 0; i < steps; i++, s += ds) {\r\n      let s1 = s, s2 = s + ds;\r\n\r\n      let mid;\r\n\r\n      for (let j = 0; j < 11; j++) {\r\n        let y1 = this.evaluate(s1);\r\n        let y2 = this.evaluate(s2);\r\n        mid = (s1 + s2)*0.5;\r\n\r\n        if (Math.abs(y1 - y) < Math.abs(y2 - y)) {\r\n          s2 = mid;\r\n        } else {\r\n          s1 = mid;\r\n        }\r\n      }\r\n\r\n      let ymid = this.evaluate(mid);\r\n\r\n      if (best === undefined || Math.abs(y - ymid) < best) {\r\n        best = Math.abs(y - ymid);\r\n        ret = mid;\r\n      }\r\n    }\r\n\r\n    return ret === undefined ? 0.0 : ret;\r\n  }\r\n}\r\n\r\nGuassianCurve.STRUCT = nstructjs.inherit(GuassianCurve, CurveTypeData) + `\r\n  height    : float;\r\n  offset    : float;\r\n  deviation : float;\r\n}\r\n`;\r\nnstructjs.register(GuassianCurve);\r\nCurveTypeData.register(GuassianCurve);\r\n","/*\r\n* Ease\r\n* Visit http://createjs.com/ for documentation, updates and examples.\r\n*\r\n* Copyright (c) 2010 gskinner.com, inc.\r\n*\r\n* Permission is hereby granted, free of charge, to any person\r\n* obtaining a copy of this software and associated documentation\r\n* files (the \"Software\"), to deal in the Software without\r\n* restriction, including without limitation the rights to use,\r\n* copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n* copies of the Software, and to permit persons to whom the\r\n* Software is furnished to do so, subject to the following\r\n* conditions:\r\n*\r\n* The above copyright notice and this permission notice shall be\r\n* included in all copies or substantial portions of the Software.\r\n*\r\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\r\n* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\r\n* OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\r\n* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\r\n* HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\r\n* WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\r\n* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\r\n* OTHER DEALINGS IN THE SOFTWARE.\r\n*/\r\n\r\n/**\r\n* @module TweenJS\r\n*/\r\n\r\n\r\n/**\r\n * The Ease class provides a collection of easing functions for use with TweenJS. It does not use the standard 4 param\r\n * easing signature. Instead it uses a single param which indicates the current linear ratio (0 to 1) of the tween.\r\n *\r\n * Most methods on Ease can be passed directly as easing functions:\r\n *\r\n *      createjs.Tween.get(target).to({x:100}, 500, createjs.Ease.linear);\r\n *\r\n * However, methods beginning with \"get\" will return an easing function based on parameter values:\r\n *\r\n *      createjs.Tween.get(target).to({y:200}, 500, createjs.Ease.getPowIn(2.2));\r\n *\r\n * Please see the <a href=\"http://www.createjs.com/Demos/TweenJS/Tween_SparkTable\">spark table demo</a> for an\r\n * overview of the different ease types on <a href=\"http://tweenjs.com\">TweenJS.com</a>.\r\n *\r\n * <em>Equations derived from work by Robert Penner.</em>\r\n * @class Ease\r\n * @static\r\n **/\r\n\r\n\r\nfunction Ease() {\r\n  throw \"Ease cannot be instantiated.\";\r\n}\r\n\r\nexport default Ease;\r\n\r\n// static methods and properties\r\n/**\r\n * @method linear\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.linear = function(t) { return t; };\r\n\r\n/**\r\n * Identical to linear.\r\n * @method none\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.none = Ease.linear;\r\n\r\n/**\r\n * Mimics the simple -100 to 100 easing in Adobe Flash/Animate.\r\n * @method get\r\n * @param {Number} amount A value from -1 (ease in) to 1 (ease out) indicating the strength and direction of the ease.\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.get = function(amount) {\r\n  if (amount < -1) { amount = -1; }\r\n  else if (amount > 1) { amount = 1; }\r\n  return function(t) {\r\n    if (amount==0) { return t; }\r\n    if (amount<0) { return t*(t*-amount+1+amount); }\r\n    return t*((2-t)*amount+(1-amount));\r\n  };\r\n};\r\n\r\n/**\r\n * Configurable exponential ease.\r\n * @method getPowIn\r\n * @param {Number} pow The exponent to use (ex. 3 would return a cubic ease).\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getPowIn = function(pow) {\r\n  return function(t) {\r\n    return Math.pow(t,pow);\r\n  };\r\n};\r\n\r\n/**\r\n * Configurable exponential ease.\r\n * @method getPowOut\r\n * @param {Number} pow The exponent to use (ex. 3 would return a cubic ease).\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getPowOut = function(pow) {\r\n  return function(t) {\r\n    return 1-Math.pow(1-t,pow);\r\n  };\r\n};\r\n\r\n/**\r\n * Configurable exponential ease.\r\n * @method getPowInOut\r\n * @param {Number} pow The exponent to use (ex. 3 would return a cubic ease).\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getPowInOut = function(pow) {\r\n  return function(t) {\r\n    if ((t*=2)<1) return 0.5*Math.pow(t,pow);\r\n    return 1-0.5*Math.abs(Math.pow(2-t,pow));\r\n  };\r\n};\r\n\r\n/**\r\n * @method quadIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quadIn = Ease.getPowIn(2);\r\n/**\r\n * @method quadOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quadOut = Ease.getPowOut(2);\r\n/**\r\n * @method quadInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quadInOut = Ease.getPowInOut(2);\r\n\r\n/**\r\n * @method cubicIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.cubicIn = Ease.getPowIn(3);\r\n/**\r\n * @method cubicOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.cubicOut = Ease.getPowOut(3);\r\n/**\r\n * @method cubicInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.cubicInOut = Ease.getPowInOut(3);\r\n\r\n/**\r\n * @method quartIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quartIn = Ease.getPowIn(4);\r\n/**\r\n * @method quartOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quartOut = Ease.getPowOut(4);\r\n/**\r\n * @method quartInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quartInOut = Ease.getPowInOut(4);\r\n\r\n/**\r\n * @method quintIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quintIn = Ease.getPowIn(5);\r\n/**\r\n * @method quintOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quintOut = Ease.getPowOut(5);\r\n/**\r\n * @method quintInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quintInOut = Ease.getPowInOut(5);\r\n\r\n/**\r\n * @method sineIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.sineIn = function(t) {\r\n  return 1-Math.cos(t*Math.PI/2);\r\n};\r\n\r\n/**\r\n * @method sineOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.sineOut = function(t) {\r\n  return Math.sin(t*Math.PI/2);\r\n};\r\n\r\n/**\r\n * @method sineInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.sineInOut = function(t) {\r\n  return -0.5*(Math.cos(Math.PI*t) - 1);\r\n};\r\n\r\n/**\r\n * Configurable \"back in\" ease.\r\n * @method getBackIn\r\n * @param {Number} amount The strength of the ease.\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getBackIn = function(amount) {\r\n  return function(t) {\r\n    return t*t*((amount+1)*t-amount);\r\n  };\r\n};\r\n/**\r\n * @method backIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.backIn = Ease.getBackIn(1.7);\r\n\r\n/**\r\n * Configurable \"back out\" ease.\r\n * @method getBackOut\r\n * @param {Number} amount The strength of the ease.\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getBackOut = function(amount) {\r\n  return function(t) {\r\n    return (--t*t*((amount+1)*t + amount) + 1);\r\n  };\r\n};\r\n/**\r\n * @method backOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.backOut = Ease.getBackOut(1.7);\r\n\r\n/**\r\n * Configurable \"back in out\" ease.\r\n * @method getBackInOut\r\n * @param {Number} amount The strength of the ease.\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getBackInOut = function(amount) {\r\n  amount*=1.525;\r\n  return function(t) {\r\n    if ((t*=2)<1) return 0.5*(t*t*((amount+1)*t-amount));\r\n    return 0.5*((t-=2)*t*((amount+1)*t+amount)+2);\r\n  };\r\n};\r\n/**\r\n * @method backInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.backInOut = Ease.getBackInOut(1.7);\r\n\r\n/**\r\n * @method circIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.circIn = function(t) {\r\n  return -(Math.sqrt(1-t*t)- 1);\r\n};\r\n\r\n/**\r\n * @method circOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.circOut = function(t) {\r\n  return Math.sqrt(1-(--t)*t);\r\n};\r\n\r\n/**\r\n * @method circInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.circInOut = function(t) {\r\n  if ((t*=2) < 1) return -0.5*(Math.sqrt(1-t*t)-1);\r\n  return 0.5*(Math.sqrt(1-(t-=2)*t)+1);\r\n};\r\n\r\n/**\r\n * @method bounceIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.bounceIn = function(t) {\r\n  return 1-Ease.bounceOut(1-t);\r\n};\r\n\r\n/**\r\n * @method bounceOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.bounceOut = function(t) {\r\n  if (t < 1/2.75) {\r\n    return (7.5625*t*t);\r\n  } else if (t < 2/2.75) {\r\n    return (7.5625*(t-=1.5/2.75)*t+0.75);\r\n  } else if (t < 2.5/2.75) {\r\n    return (7.5625*(t-=2.25/2.75)*t+0.9375);\r\n  } else {\r\n    return (7.5625*(t-=2.625/2.75)*t +0.984375);\r\n  }\r\n};\r\n\r\n/**\r\n * @method bounceInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.bounceInOut = function(t) {\r\n  if (t<0.5) return Ease.bounceIn (t*2) * .5;\r\n  return Ease.bounceOut(t*2-1)*0.5+0.5;\r\n};\r\n\r\n/**\r\n * Configurable elastic ease.\r\n * @method getElasticIn\r\n * @param {Number} amplitude\r\n * @param {Number} period\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getElasticIn = function(amplitude,period) {\r\n  var pi2 = Math.PI*2;\r\n  return function(t) {\r\n    if (t==0 || t==1) return t;\r\n    var s = period/pi2*Math.asin(1/amplitude);\r\n    return -(amplitude*Math.pow(2,10*(t-=1))*Math.sin((t-s)*pi2/period));\r\n  };\r\n};\r\n/**\r\n * @method elasticIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.elasticIn = Ease.getElasticIn(1,0.3);\r\n\r\n/**\r\n * Configurable elastic ease.\r\n * @method getElasticOut\r\n * @param {Number} amplitude\r\n * @param {Number} period\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getElasticOut = function(amplitude,period) {\r\n  var pi2 = Math.PI*2;\r\n  return function(t) {\r\n    if (t==0 || t==1) return t;\r\n    var s = period/pi2 * Math.asin(1/amplitude);\r\n    return (amplitude*Math.pow(2,-10*t)*Math.sin((t-s)*pi2/period )+1);\r\n  };\r\n};\r\n/**\r\n * @method elasticOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.elasticOut = Ease.getElasticOut(1,0.3);\r\n\r\n/**\r\n * Configurable elastic ease.\r\n * @method getElasticInOut\r\n * @param {Number} amplitude\r\n * @param {Number} period\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getElasticInOut = function(amplitude,period) {\r\n  var pi2 = Math.PI*2;\r\n  return function(t) {\r\n    var s = period/pi2 * Math.asin(1/amplitude);\r\n    if ((t*=2)<1) return -0.5*(amplitude*Math.pow(2,10*(t-=1))*Math.sin( (t-s)*pi2/period ));\r\n    return amplitude*Math.pow(2,-10*(t-=1))*Math.sin((t-s)*pi2/period)*0.5+1;\r\n  };\r\n};\r\n/**\r\n * @method elasticInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.elasticInOut = Ease.getElasticInOut(1,0.3*1.5);\r\n","import nstructjs from \"../util/struct.js\";\r\nimport {CurveConstructors, CurveTypeData} from \"./curve1d_base.js\";\r\nimport Ease from './ease.js';\r\nimport * as util from '../util/util.js';\r\n\r\nfunction bez3(a, b, c, t) {\r\n  var r1 = a + (b - a)*t;\r\n  var r2 = b + (c - b)*t;\r\n\r\n  return r1 + (r2 - r1)*t;\r\n}\r\n\r\nfunction bez4(a, b, c, d, t) {\r\n  var r1 = bez3(a, b, c, t);\r\n  var r2 = bez3(b, c, d, t);\r\n\r\n  return r1 + (r2 - r1)*t;\r\n}\r\n\r\nexport class ParamKey {\r\n  constructor(key, val) {\r\n    this.key = key;\r\n    this.val = val;\r\n  }\r\n}\r\n\r\nParamKey.STRUCT = `\r\nParamKey {\r\n  key : string;\r\n  val : float;\r\n}\r\n`\r\nnstructjs.register(ParamKey);\r\nlet BOOL_FLAG = 1e17;\r\n\r\nlet _udigest = new util.HashDigest();\r\n\r\nexport class SimpleCurveBase extends CurveTypeData {\r\n  constructor() {\r\n    super();\r\n\r\n    this.type = this.constructor.name;\r\n\r\n    let def = this.constructor.define();\r\n    let params = def.params;\r\n\r\n    this.params = {};\r\n    for (let k in params) {\r\n      this.params[k] = params[k][1];\r\n    }\r\n  }\r\n\r\n  get hasGUI() {\r\n    return true;\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    let d = digest;\r\n    super.calcHashKey(d);\r\n\r\n    for (let k in this.params) {\r\n      digest.add(k);\r\n      digest.add(this.params[k]);\r\n    }\r\n\r\n    return d.get();\r\n  }\r\n\r\n  equals(b) {\r\n    if (this.type !== b.type) {\r\n      return false;\r\n    }\r\n\r\n    for (let k in this.params) {\r\n      if (Math.abs(this.params[k] - b.params[k]) > 0.000001) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  redraw() {\r\n    if (this.parent)\r\n      this.parent.redraw();\r\n  }\r\n\r\n  makeGUI(container) {\r\n    let def = this.constructor.define();\r\n    let params = def.params;\r\n\r\n    for (let k in params) {\r\n      let p = params[k];\r\n\r\n      if (p[2] === BOOL_FLAG) {\r\n        let check = container.check(undefined, p[0]);\r\n        check.checked = !!this.params[k];\r\n        check.key = k;\r\n\r\n        let this2 = this;\r\n        check.onchange = function () {\r\n          this2.params[this.key] = this.checked ? 1 : 0;\r\n          this2.update();\r\n          this2.redraw();\r\n        }\r\n      } else {\r\n        let slider = container.slider(undefined, {\r\n          name      : p[0],\r\n          defaultval: this.params[k],\r\n          min       : p[2],\r\n          max       : p[3]\r\n        })\r\n        slider.baseUnit = slider.displayUnit = \"none\";\r\n\r\n        slider.key = k;\r\n\r\n        let this2 = this;\r\n        slider.onchange = function () {\r\n          this2.params[this.key] = this.value;\r\n          this2.update();\r\n          this2.redraw();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  killGUI(container) {\r\n    container.clear();\r\n  }\r\n\r\n  evaluate(s) {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  reset() {\r\n\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  draw(canvas, g, draw_transform) {\r\n    let steps = 128;\r\n    let s = 0, ds = 1.0/(steps - 1);\r\n\r\n    g.beginPath();\r\n    for (let i = 0; i < steps; i++, s += ds) {\r\n      let co = this.evaluate(s);\r\n\r\n      if (i) {\r\n        g.lineTo(co[0], co[1]);\r\n      } else {\r\n        g.moveTo(co[0], co[1]);\r\n      }\r\n    }\r\n\r\n    g.stroke();\r\n  }\r\n\r\n  _saveParams() {\r\n    let ret = [];\r\n    for (let k in this.params) {\r\n      ret.push(new ParamKey(k, this.params[k]));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  toJSON() {\r\n    return Object.assign(super.toJSON(), {\r\n      params: this.params\r\n    });\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    for (let k in obj.params) {\r\n      this.params[k] = obj.params[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n\r\n    let ps = this.params;\r\n    this.params = {};\r\n\r\n    let pdef = this.constructor.define().params;\r\n    if (!pdef) {\r\n      console.warn(\"Missing define function for curve\", this.constructor.name)\r\n      return;\r\n    }\r\n\r\n    for (let pair of ps) {\r\n      if (pair.key in pdef) {\r\n        this.params[pair.key] = pair.val;\r\n      }\r\n    }\r\n\r\n    for (let k in pdef) {\r\n      if (!(k in this.params)) {\r\n        this.params[k] = pdef[k][1];\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nSimpleCurveBase.STRUCT = nstructjs.inherit(SimpleCurveBase, CurveTypeData) + `\r\n  params : array(ParamKey) | obj._saveParams();\r\n}\r\n`;\r\nnstructjs.register(SimpleCurveBase);\r\n\r\nexport class BounceCurve extends SimpleCurveBase {\r\n  static define() {\r\n    return {\r\n      params  : {\r\n        decay : [\"Decay\", 1.0, 0.1, 5.0],\r\n        scale : [\"Scale\", 1.0, 0.01, 10.0],\r\n        freq  : [\"Freq\", 1.0, 0.01, 50.0],\r\n        phase : [\"Phase\", 0.0, -Math.PI*2.0, Math.PI*2.0],\r\n        offset: [\"Offset\", 0.0, -2.0, 2.0]\r\n      },\r\n      name    : \"bounce\",\r\n      uiname  : \"Bounce\",\r\n      typeName: \"BounceCurve\"\r\n\r\n    }\r\n  }\r\n\r\n  _evaluate(t) {\r\n    let params = this.params;\r\n    let decay = params.decay + 1.0;\r\n    let scale = params.scale;\r\n    let freq = params.freq;\r\n    let phase = params.phase;\r\n    let offset = params.offset;\r\n\r\n    t *= freq;\r\n    let t2 = Math.abs(Math.cos(phase + t*Math.PI*2.0))*scale;\r\n    ;//+ (1.0-scale);\r\n\r\n    t2 *= Math.exp(decay*t)/Math.exp(decay);\r\n\r\n    return t2;\r\n  }\r\n\r\n  evaluate(t) {\r\n    let s = this._evaluate(0.0);\r\n    let e = this._evaluate(1.0);\r\n\r\n    return (this._evaluate(t) - s)/(e - s) + this.params.offset;\r\n  }\r\n}\r\n\r\nCurveTypeData.register(BounceCurve);\r\nBounceCurve.STRUCT = nstructjs.inherit(BounceCurve, SimpleCurveBase) + `\r\n}`;\r\nnstructjs.register(BounceCurve);\r\n\r\n\r\nexport class ElasticCurve extends SimpleCurveBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._func = undefined;\r\n    this._last_hash = undefined;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      params  : {\r\n        mode     : [\"Out Mode\", false, BOOL_FLAG, BOOL_FLAG],\r\n        amplitude: [\"Amplitude\", 1.0, 0.01, 10.0],\r\n        period   : [\"Period\", 1.0, 0.01, 5.0]\r\n      },\r\n      name    : \"elastic\",\r\n      uiname  : \"Elastic\",\r\n      typeName: \"ElasticCurve\",\r\n    }\r\n  }\r\n\r\n  evaluate(t) {\r\n    let hash = ~~(this.params.mode*127 + this.params.amplitude*256 + this.params.period*512);\r\n\r\n    if (hash !== this._last_hash || !this._func) {\r\n      this._last_hash = hash;\r\n\r\n      if (this.params.mode) {\r\n        this._func = Ease.getElasticOut(this.params.amplitude, this.params.period);\r\n      } else {\r\n        this._func = Ease.getElasticIn(this.params.amplitude, this.params.period);\r\n      }\r\n    }\r\n    return this._func(t);\r\n  }\r\n}\r\n\r\nCurveTypeData.register(ElasticCurve);\r\nElasticCurve.STRUCT = nstructjs.inherit(ElasticCurve, SimpleCurveBase) + `\r\n}`;\r\nnstructjs.register(ElasticCurve);\r\n\r\n\r\nexport class EaseCurve extends SimpleCurveBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      params  : {\r\n        mode_in  : [\"in\", true, BOOL_FLAG, BOOL_FLAG],\r\n        mode_out : [\"out\", true, BOOL_FLAG, BOOL_FLAG],\r\n        amplitude: [\"Amplitude\", 1.0, 0.01, 4.0]\r\n      },\r\n      name    : \"ease\",\r\n      uiname  : \"Ease\",\r\n      typeName: \"EaseCurve\"\r\n    }\r\n  }\r\n\r\n  evaluate(t) {\r\n    let amp = this.params.amplitude;\r\n    let a1 = this.params.mode_in ? 1.0 - amp : 1.0/3.0;\r\n    let a2 = this.params.mode_out ? amp : 2.0/3.0;\r\n\r\n    return bez4(0.0, a1, a2, 1.0, t);\r\n  }\r\n}\r\n\r\nCurveTypeData.register(EaseCurve);\r\nEaseCurve.STRUCT = nstructjs.inherit(EaseCurve, SimpleCurveBase) + `\r\n}`;\r\nnstructjs.register(EaseCurve);\r\n\r\n\r\nexport class RandCurve extends SimpleCurveBase {\r\n  constructor() {\r\n    super();\r\n    this.random = new util.MersenneRandom();\r\n    this.seed = 0;\r\n  }\r\n\r\n  get seed() {\r\n    return this._seed;\r\n  }\r\n\r\n  set seed(v) {\r\n    this.random.seed(v);\r\n    this._seed = v;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      params  : {\r\n        amplitude: [\"Amplitude\", 1.0, 0.01, 4.0],\r\n        decay    : [\"Decay\", 1.0, 0.0, 5.0],\r\n        in_mode  : [\"In\", true, BOOL_FLAG, BOOL_FLAG]\r\n      },\r\n      name    : \"random\",\r\n      uiname  : \"Random\",\r\n      typeName: \"RandCurve\"\r\n    }\r\n  }\r\n\r\n  evaluate(t) {\r\n    let r = this.random.random();\r\n    let decay = this.params.decay + 1.0;\r\n    let amp = this.params.amplitude;\r\n    let in_mode = this.params.in_mode;\r\n\r\n    if (in_mode) {\r\n      t = 1.0 - t;\r\n    }\r\n    //r *= t;\r\n\r\n    let d;\r\n\r\n    //r *= 0.5;\r\n\r\n    if (in_mode) {\r\n      d = Math.exp(t*decay)/Math.exp(decay);\r\n    } else {\r\n      d = Math.exp(t*decay)/Math.exp(decay);\r\n    }\r\n\r\n    t = t + (r - t)*d;\r\n\r\n    if (in_mode) {\r\n      t = 1.0 - t;\r\n    }\r\n\r\n    return t;\r\n  }\r\n}\r\n\r\nCurveTypeData.register(RandCurve);\r\nRandCurve.STRUCT = nstructjs.inherit(RandCurve, SimpleCurveBase) + `\r\n}`;\r\nnstructjs.register(RandCurve);\r\n\r\n\r\n","\"use strict\";\r\n\r\n/*FIXME: not sure this works anymore*/\r\nimport nstructjs from \"../util/struct.js\";\r\n\r\nimport * as util from '../util/util.js';\r\n//import * as ui_base from './ui_base.js';\r\nimport {Vector2, Vector3, Vector4, Matrix4} from '../util/vectormath.js';\r\nimport {EventDispatcher} from \"../util/events.js\";\r\n\r\nexport {getCurve} from './curve1d_base.js';\r\nexport {SplineTemplates, SplineTemplateIcons} from './curve1d_bspline.js';\r\n\r\nimport './curve1d_basic.js';\r\nimport './curve1d_bspline.js';\r\nimport './curve1d_anim.js';\r\n\r\nexport function mySafeJSONStringify(obj) {\r\n  return JSON.stringify(obj.toJSON(), function (key) {\r\n    let v = this[key];\r\n\r\n    if (typeof v === \"number\") {\r\n      if (v !== Math.floor(v)) {\r\n        v = parseFloat(v.toFixed(5));\r\n      } else {\r\n        v = v;\r\n      }\r\n    }\r\n\r\n    return v;\r\n  });\r\n}\r\n\r\nexport function mySafeJSONParse(buf) {\r\n  return JSON.parse(buf, (key, val) => {\r\n\r\n  });\r\n};\r\n\r\nwindow.mySafeJSONStringify = mySafeJSONStringify;\r\n\r\nexport {CurveConstructors, CURVE_VERSION, CurveTypeData} from './curve1d_base.js';\r\nimport {CurveConstructors, CURVE_VERSION, CurveTypeData} from './curve1d_base.js';\r\n\r\nlet _udigest = new util.HashDigest();\r\n\r\nexport class Curve1D extends EventDispatcher {\r\n  constructor() {\r\n    super();\r\n\r\n    this.uiZoom = 1.0;\r\n    this.xRange = new Vector2().loadXY(0.0, 1.0);\r\n    this.yRange = new Vector2().loadXY(0.0, 1.0);\r\n    this.clipToRange = false;\r\n\r\n    this.generators = [];\r\n    this.VERSION = CURVE_VERSION;\r\n\r\n    for (let gen of CurveConstructors) {\r\n      gen = new gen();\r\n\r\n      gen.parent = this;\r\n      this.generators.push(gen);\r\n    }\r\n\r\n    //this.generators.active = this.generators[0];\r\n    this.setGenerator(\"bspline\");\r\n  }\r\n\r\n  get generatorType() {\r\n    return this.generators.active ? this.generators.active.type : undefined;\r\n  }\r\n\r\n  get fastmode() {\r\n    return this._fastmode;\r\n  }\r\n\r\n  set fastmode(val) {\r\n    this._fastmode = val;\r\n\r\n    for (let gen of this.generators) {\r\n      gen.fastmode = val;\r\n    }\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    let d = digest;\r\n\r\n    for (let g of this.generators) {\r\n      g.calcHashKey(d);\r\n    }\r\n\r\n    return d.get();\r\n  }\r\n\r\n  equals(b) {\r\n    let gen1 = this.generators.active;\r\n    let gen2 = b.generators.active;\r\n\r\n    if (!gen1 || !gen2 || gen1.constructor !== gen2.constructor) {\r\n      return false;\r\n    }\r\n\r\n    return gen1.equals(gen2);\r\n  }\r\n\r\n  load(b) {\r\n    if (b === undefined) {\r\n      return;\r\n    }\r\n    /*\r\n    if (b === undefined) {\r\n      return;\r\n    }\r\n\r\n    let buf1 = mySafeJSONStringify(b);\r\n    let buf2 = mySafeJSONStringify(this);\r\n\r\n    if (buf1 === buf2) {\r\n      return;\r\n    }\r\n\r\n    this.loadJSON(JSON.parse(buf1));\r\n    this._on_change();\r\n    this.redraw();\r\n\r\n    return this;*/\r\n\r\n    let json = nstructjs.writeJSON(b, Curve1D);\r\n    let cpy = nstructjs.readJSON(json, Curve1D);\r\n\r\n    this.generators = cpy.generators;\r\n    for (let gen of cpy.generators) {\r\n      gen.parent = this;\r\n    }\r\n\r\n    for (let k in json) {\r\n      if (k.startsWith(\"_\")) {\r\n        continue;\r\n      }\r\n\r\n      let v = cpy[k];\r\n      if (typeof v === \"number\" || typeof v === \"boolean\" || typeof v === \"string\") {\r\n        this[k] = v;\r\n      } else if (v instanceof Vector2 || v instanceof Vector3 || v instanceof Vector4 || v instanceof Matrix4) {\r\n        this[k].load(v);\r\n      }\r\n    }\r\n\r\n    this._on_change();\r\n    this.redraw();\r\n\r\n    return this;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new Curve1D();\r\n    ret.loadJSON(JSON.parse(mySafeJSONStringify(this)));\r\n    return ret;\r\n  }\r\n\r\n  _on_change() {\r\n\r\n  }\r\n\r\n  redraw() {\r\n    this._fireEvent(\"draw\", this);\r\n  }\r\n\r\n  setGenerator(type) {\r\n    for (let gen of this.generators) {\r\n      if (gen.constructor.define().name === type\r\n        || gen.type === type\r\n        || gen.constructor.define().typeName === type\r\n        || gen.constructor === type) {\r\n        if (this.generators.active) {\r\n          this.generators.active.onInactive();\r\n        }\r\n\r\n        this.generators.active = gen;\r\n        gen.onActive();\r\n\r\n        return;\r\n      }\r\n    }\r\n\r\n    throw new Error(\"unknown curve type \" + type);\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = {\r\n      generators      : [],\r\n      uiZoom          : this.uiZoom,\r\n      VERSION         : this.VERSION,\r\n      active_generator: this.generatorType,\r\n      xRange          : this.xRange,\r\n      yRange          : this.yRange,\r\n      clipToRange     : this.clipToRange,\r\n    };\r\n\r\n    for (let gen of this.generators) {\r\n      ret.generators.push(gen.toJSON());\r\n    }\r\n\r\n    ret.generators.sort((a, b) => a.type.localeCompare(b.type));\r\n\r\n    return ret;\r\n  }\r\n\r\n  getGenerator(type, throw_on_error = true) {\r\n    for (let gen of this.generators) {\r\n      if (gen.type === type) {\r\n        return gen;\r\n      }\r\n    }\r\n\r\n    //was a new generator registerd?\r\n    for (let cls of CurveConstructors) {\r\n      if (cls.define().typeName === type) {\r\n        let gen = new cls();\r\n        gen.type = type;\r\n        gen.parent = this;\r\n        this.generators.push(gen);\r\n        return gen;\r\n      }\r\n    }\r\n\r\n    if (throw_on_error) {\r\n      throw new Error(\"Unknown generator \" + type + \".\");\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  switchGenerator(type) {\r\n    let gen = this.getGenerator(type);\r\n\r\n    if (gen !== this.generators.active) {\r\n      let old = this.generators.active;\r\n\r\n      this.generators.active = gen;\r\n\r\n      old.onInactive(this);\r\n      gen.onActive(this);\r\n    }\r\n\r\n    return gen;\r\n  }\r\n\r\n  destroy() {\r\n    return this;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    this.VERSION = obj.VERSION;\r\n\r\n    this.uiZoom = parseFloat(obj.uiZoom) || this.uiZoom;\r\n    if (obj.xRange) {\r\n      this.xRange = new Vector2(obj.xRange);\r\n    }\r\n    if (obj.yRange) {\r\n      this.yRange = new Vector2(obj.yRange);\r\n    }\r\n    this.clipToRange = Boolean(obj.clipToRange);\r\n\r\n    //this.generators = [];\r\n    for (let gen of obj.generators) {\r\n      let gen2 = this.getGenerator(gen.type, false);\r\n\r\n      if (!gen2 || !(gen2 instanceof CurveTypeData)) {\r\n        //old curve class?\r\n        console.warn(\"Bad curve generator class:\", gen2);\r\n        if (gen2) {\r\n          this.generators.remove(gen2);\r\n        }\r\n        continue;\r\n      }\r\n\r\n      gen2.parent = undefined;\r\n      gen2.reset();\r\n      gen2.loadJSON(gen);\r\n      gen2.parent = this;\r\n\r\n      if (gen.type === obj.active_generator) {\r\n        this.generators.active = gen2;\r\n      }\r\n\r\n      //this.generators.push(gen2);\r\n    }\r\n\r\n    if (this.VERSION < 1.1) {\r\n      this.#patchRange();\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  evaluate(s) {\r\n    if (this.clipToRange) {\r\n      s = Math.min(Math.max(s, this.xRange[0]), this.xRange[1]);\r\n    }\r\n\r\n    let f = this.generators.active.evaluate(s);\r\n    if (this.clipToRange) {\r\n      f = Math.min(Math.max(f, this.yRange[0]), this.yRange[1]);\r\n    }\r\n\r\n    return f;\r\n  }\r\n\r\n  integrate(s, quadSteps) {\r\n    return this.generators.active.integrate(s, quadSteps);\r\n  }\r\n\r\n  derivative(s) {\r\n    return this.generators.active.derivative(s);\r\n  }\r\n\r\n  derivative2(s) {\r\n    return this.generators.active.derivative2(s);\r\n  }\r\n\r\n  inverse(s) {\r\n    return this.generators.active.inverse(s);\r\n  }\r\n\r\n  reset() {\r\n    this.generators.active.reset();\r\n  }\r\n\r\n  update() {\r\n    return this.generators.active.update();\r\n  }\r\n\r\n  draw(canvas, g, draw_transform) {\r\n    let w = canvas.width, h = canvas.height;\r\n\r\n    g.save();\r\n\r\n    let sz = draw_transform[0], pan = draw_transform[1];\r\n\r\n    g.beginPath();\r\n    g.moveTo(-1, 0);\r\n    g.lineTo(1, 0);\r\n    g.strokeStyle = \"red\";\r\n    g.stroke();\r\n\r\n    g.beginPath();\r\n    g.moveTo(0, -1);\r\n    g.lineTo(0, 1);\r\n    g.strokeStyle = \"green\";\r\n    g.stroke();\r\n\r\n    //g.rect(0, 0, 1, 1);\r\n    //g.fillStyle = \"rgb(50, 50, 50)\";\r\n    //g.fill();\r\n\r\n    let f = this.xRange[0], steps = 64;\r\n    let df = (this.xRange[1] - this.xRange[0])/(steps - 1);\r\n    w = 6.0/sz;\r\n\r\n    let curve = this.generators.active;\r\n\r\n    g.beginPath();\r\n    for (let i = 0; i < steps; i++, f += df) {\r\n      let val = this.evaluate(f);\r\n\r\n      (i === 0 ? g.moveTo : g.lineTo).call(g, f, val, w, w);\r\n    }\r\n\r\n    g.strokeStyle = \"grey\";\r\n    g.stroke();\r\n\r\n    if (this.overlay_curvefunc !== undefined) {\r\n      g.beginPath();\r\n      f = this.xRange[0];\r\n\r\n      for (let i = 0; i < steps; i++, f += df) {\r\n        let val = this.overlay_curvefunc(f);\r\n\r\n        (i === 0 ? g.moveTo : g.lineTo).call(g, f, val, w, w);\r\n      }\r\n\r\n      g.strokeStyle = \"green\";\r\n      g.stroke();\r\n    }\r\n\r\n    this.generators.active.draw(canvas, g, draw_transform);\r\n\r\n    g.restore();\r\n    return this;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    this.generators = [];\r\n    reader(this);\r\n\r\n    if (this.VERSION <= 0.75) {\r\n      this.generators = [];\r\n\r\n      for (let cls of CurveConstructors) {\r\n        this.generators.push(new cls());\r\n      }\r\n\r\n      this.generators.active = this.getGenerator(\"BSplineCurve\");\r\n    }\r\n\r\n    for (let gen of this.generators.concat([])) {\r\n      if (!(gen instanceof CurveTypeData)) {\r\n        console.warn(\"Bad generator data found:\", gen);\r\n        this.generators.remove(gen);\r\n        continue;\r\n      }\r\n\r\n      if (gen.type === this._active) {\r\n        this.generators.active = gen;\r\n      }\r\n    }\r\n\r\n    for (let gen of this.generators) {\r\n      gen.parent = this;\r\n    }\r\n\r\n    if (this.VERSION < 1.1) {\r\n      this.#patchRange();\r\n    }\r\n\r\n    delete this._active;\r\n    this.VERSION = CURVE_VERSION;\r\n  }\r\n\r\n  #patchRange() {\r\n    let range = this.getGenerator(\"BSplineCurve\").range;\r\n    if (range) {\r\n      this.xRange.load(range[0]);\r\n      this.yRange.load(range[1]);\r\n    }\r\n  }\r\n}\r\n\r\n/* Remember to update toJSON() loadJSON api. */\r\nCurve1D.STRUCT = `\r\nCurve1D {\r\n  generators  : array(abstract(CurveTypeData));\r\n  _active     : string | obj.generators.active.type;\r\n  VERSION     : float;\r\n  uiZoom      : float;\r\n  xRange      : vec2;\r\n  yRange      : vec2;\r\n  clipToRange : bool;\r\n}\r\n`;\r\nnstructjs.register(Curve1D);\r\n\r\n","import * as util from '../util/util.js';\r\nimport {Vector2, Vector3, Vector4, Quat, Matrix4} from '../util/vectormath.js';\r\nimport {ToolPropertyIF, PropTypes, PropFlags} from \"./toolprop_abstract.js\";\r\nimport nstructjs from '../util/struct.js';\r\n\r\nexport {PropTypes, PropFlags} from './toolprop_abstract.js';\r\n\r\nexport const NumberConstraintsBase = new Set([\r\n  'range', 'expRate', 'step', 'uiRange', 'baseUnit', 'displayUnit', 'stepIsRelative',\r\n  'slideSpeed'\r\n]);\r\n\r\nexport const IntegerConstraints = new Set([\r\n  'radix'\r\n].concat(util.list(NumberConstraintsBase)));\r\n\r\nexport const FloatConstrinats = new Set([\r\n  'decimalPlaces'\r\n].concat(util.list(NumberConstraintsBase)));\r\n\r\nexport const NumberConstraints = new Set(util.list(IntegerConstraints).concat(util.list(FloatConstrinats)));\r\n\r\nexport const PropSubTypes = {\r\n  COLOR: 1\r\n};\r\n\r\nlet first = (iter) => {\r\n  if (iter === undefined) {\r\n    return undefined;\r\n  }\r\n\r\n  if (!(Symbol.iterator in iter)) {\r\n    for (let item in iter) {\r\n      return item;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  for (let item of iter) {\r\n    return item;\r\n  }\r\n};\r\n\r\n//set PropTypes to custom type integers\r\nexport function setPropTypes(types) {\r\n  for (let k in types) {\r\n    PropTypes[k] = types[k];\r\n  }\r\n}\r\n\r\nexport let customPropertyTypes = [];\r\nexport let PropClasses = {};\r\n\r\nlet customPropTypeBase = 17;\r\n\r\nlet wordmap = {\r\n  sel  : \"select\",\r\n  unsel: \"deselect\",\r\n  eid  : \"id\",\r\n  props: \"properties\",\r\n  res  : \"resource\",\r\n\r\n};\r\n\r\nexport var defaultRadix = 10;\r\nexport var defaultDecimalPlaces = 4;\r\n\r\nclass OnceTag {\r\n  constructor(cb) {\r\n    this.cb = cb;\r\n  }\r\n}\r\n\r\nexport class ToolProperty extends ToolPropertyIF {\r\n  constructor(type, subtype, apiname, uiname = \"\", description = \"\", flag = 0, icon = -1) {\r\n    super();\r\n\r\n    this.data = undefined;\r\n\r\n    if (type === undefined) {\r\n      type = this.constructor.PROP_TYPE_ID;\r\n    }\r\n\r\n    this.type = type;\r\n    this.subtype = subtype;\r\n\r\n    //is false if this property still has its default value,\r\n    //i.e. it hasn't been set by the user or anyone else\r\n    this.wasSet = false;\r\n\r\n    this.apiname = apiname;\r\n    this.uiname = uiname !== undefined ? uiname : apiname;\r\n    this.description = description;\r\n    this.flag = flag;\r\n    this.icon = icon;\r\n    this.icon2 = icon; //another icon, e.g. unchecked state\r\n\r\n    //remember to update NumberConstraintsBase et al when adding new number\r\n    //constraints\r\n\r\n    this.decimalPlaces = defaultDecimalPlaces;\r\n    this.radix = defaultRadix;\r\n    this.step = 0.05;\r\n\r\n    this.callbacks = {};\r\n  }\r\n\r\n  static internalRegister(cls) {\r\n    PropClasses[new cls().type] = cls;\r\n  }\r\n\r\n  static getClass(type) {\r\n    return PropClasses[type];\r\n  }\r\n\r\n  static setDefaultRadix(n) {\r\n    defaultRadix = n;\r\n  }\r\n\r\n  static setDefaultDecimalPlaces(n) {\r\n    defaultDecimalPlaces = n;\r\n  }\r\n\r\n  static makeUIName(name) {\r\n    let parts = [\"\"];\r\n    let lastc = undefined;\r\n\r\n    let ischar = (c) => {\r\n      c = c.charCodeAt(0);\r\n\r\n      let upper = c >= \"A\".charCodeAt(0);\r\n      upper = upper && c <= \"Z\".charCodeAt(0);\r\n\r\n      let lower = c >= \"a\".charCodeAt(0);\r\n      lower = lower && c <= \"z\".charCodeAt(0);\r\n\r\n      return upper || lower;\r\n    }\r\n\r\n    for (let i = 0; i < name.length; i++) {\r\n      let c = name[i];\r\n\r\n      if (c === '_' || c === '-' || c === '$') {\r\n        lastc = c;\r\n        c = ' ';\r\n        parts.push('');\r\n        continue;\r\n      }\r\n\r\n      if (i > 0 && c === c.toUpperCase() && lastc !== lastc.toUpperCase()) {\r\n        if (ischar(c) && ischar(lastc)) {\r\n          parts.push('');\r\n        }\r\n      }\r\n\r\n      parts[parts.length - 1] += c;\r\n      lastc = c;\r\n    }\r\n\r\n\r\n    let subst = (word) => {\r\n      if (word in wordmap) {\r\n        return wordmap[word];\r\n      } else {\r\n        return word;\r\n      }\r\n    }\r\n\r\n    parts = parts\r\n      .filter(f => f.trim().length > 0)\r\n      .map(f => subst(f))\r\n      .map(f => f[0].toUpperCase() + f.slice(1, f.length).toLowerCase())\r\n      .join(\" \").trim();\r\n    return parts;\r\n  }\r\n\r\n  static register(cls) {\r\n    cls.PROP_TYPE_ID = (1<<customPropTypeBase);\r\n    PropTypes[cls.name] = cls.PROP_TYPE_ID;\r\n\r\n    customPropTypeBase++;\r\n    customPropertyTypes.push(cls);\r\n\r\n    PropClasses[new cls().type] = cls;\r\n\r\n    return cls.PROP_TYPE_ID;\r\n  }\r\n\r\n  static calcRelativeStep(step, value, logBase = 1.5) {\r\n    value = Math.log(Math.abs(value) + 1.0)/Math.log(logBase);\r\n    value = Math.max(value, step);\r\n\r\n    this.report(util.termColor(\"STEP\", \"red\"), value);\r\n    return value;\r\n  }\r\n\r\n  setDescription(s) {\r\n    this.description = s;\r\n    return this;\r\n  }\r\n\r\n  setUIName(s) {\r\n    this.uiname = s;\r\n    return this;\r\n  }\r\n\r\n  calcMemSize() {\r\n    function strlen(s) {\r\n      //length of string plus an assumed member pointer\r\n      return s !== undefined ? s.length + 8 : 8;\r\n    }\r\n\r\n    let tot = 0;\r\n\r\n    tot += strlen(this.apiname) + strlen(this.uiname);\r\n    tot += strlen(this.description);\r\n\r\n    tot += 11*8; //assumed member pointers\r\n    for (let k in this.callbacks) {\r\n      tot += 24;\r\n    }\r\n\r\n    return tot;\r\n  }\r\n\r\n  equals(b) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  private() {\r\n    this.flag |= PropFlags.PRIVATE;\r\n    return this;\r\n  }\r\n\r\n  saveLastValue() {\r\n    this.flag |= PropFlags.SAVE_LAST_VALUE;\r\n    return this;\r\n  }\r\n\r\n  report() {\r\n    console.warn(...arguments);\r\n  }\r\n\r\n  _fire(type, arg1, arg2) {\r\n    if (this.callbacks[type] === undefined) {\r\n      return;\r\n    }\r\n\r\n    let stack = this.callbacks[type];\r\n    stack = stack.concat([]); //copy\r\n\r\n    for (let i = 0; i < stack.length; i++) {\r\n      let cb = stack[i];\r\n\r\n      if (cb instanceof OnceTag) {\r\n        let j = i;\r\n\r\n        //remove callback;\r\n        while (j < stack.length - 1) {\r\n          stack[j] = stack[j + 1];\r\n          j++;\r\n        }\r\n\r\n        stack[j] = undefined;\r\n        stack.length--;\r\n\r\n        i--;\r\n\r\n        cb.cb.call(this, arg1, arg2);\r\n      } else {\r\n        cb.call(this, arg1, arg2);\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  clearEventCallbacks() {\r\n    this.callbacks = {}\r\n    return this;\r\n  }\r\n\r\n  once(type, cb) {\r\n    if (this.callbacks[type] === undefined) {\r\n      this.callbacks[type] = [];\r\n    }\r\n\r\n    //check if cb is already in callback list inside a OnceTag\r\n    for (let cb2 of this.callbacks[type]) {\r\n      if (cb2 instanceof OnceTag && cb2.cb === cb) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    cb = new OnceTag(cb);\r\n\r\n    this.callbacks[type].push(cb);\r\n\r\n    return this;\r\n  }\r\n\r\n  on(type, cb) {\r\n    if (this.callbacks[type] === undefined) {\r\n      this.callbacks[type] = [];\r\n    }\r\n\r\n    this.callbacks[type].push(cb);\r\n    return this;\r\n  }\r\n\r\n  off(type, cb) {\r\n    this.callbacks[type].remove(cb);\r\n    return this;\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      type       : this.type,\r\n      subtype    : this.subtype,\r\n      apiname    : this.apiname,\r\n      uiname     : this.uiname,\r\n      description: this.description,\r\n      flag       : this.flag,\r\n      icon       : this.icon,\r\n      data       : this.data,\r\n      range      : this.range,\r\n      uiRange    : this.uiRange,\r\n      step       : this.step\r\n    };\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    this.type = obj.type;\r\n    this.subtype = obj.subtype;\r\n    this.apiname = obj.apiname;\r\n    this.uiname = obj.uiname;\r\n    this.description = obj.description;\r\n    this.flag = obj.flag;\r\n    this.icon = obj.icon;\r\n    this.data = obj.data;\r\n\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  setValue(val) {\r\n    if (this.constructor === ToolProperty) {\r\n      throw new Error(\"implement me!\");\r\n    }\r\n\r\n    this.wasSet = true;\r\n\r\n    this._fire(\"change\", val);\r\n  }\r\n\r\n  copyTo(b) {\r\n    b.apiname = this.apiname;\r\n\r\n    b.uiname = this.uiname;\r\n    b.description = this.description;\r\n    b.icon = this.icon;\r\n    b.icon2 = this.icon2;\r\n\r\n    b.baseUnit = this.baseUnit;\r\n    b.subtype = this.subtype;\r\n    b.displayUnit = this.displayUnit;\r\n\r\n    b.flag = this.flag;\r\n\r\n    for (let k in this.callbacks) {\r\n      b.callbacks[k] = this.callbacks[k];\r\n    }\r\n  }\r\n\r\n  copy() { //default copy method\r\n    let ret = new this.constructor();\r\n\r\n    this.copyTo(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  setStep(step) {\r\n    this.step = step;\r\n    return this;\r\n  }\r\n\r\n  getStep(value = 1.0) {\r\n    if (this.stepIsRelative) {\r\n      return ToolProperty.calcRelativeStep(this.step, value);\r\n    } else {\r\n      return this.step;\r\n    }\r\n  }\r\n\r\n  setRelativeStep(step) {\r\n    this.step = step;\r\n    this.stepIsRelative = true;\r\n  }\r\n\r\n  setRange(min, max) {\r\n    if (min === undefined || max === undefined) {\r\n      throw new Error(\"min and/or max cannot be undefined\");\r\n    }\r\n\r\n    this.range = [min, max];\r\n    return this;\r\n  }\r\n\r\n  noUnits() {\r\n    this.baseUnit = this.displayUnit = \"none\";\r\n    return this;\r\n  }\r\n\r\n  setBaseUnit(unit) {\r\n    this.baseUnit = unit;\r\n    return this;\r\n  }\r\n\r\n  setDisplayUnit(unit) {\r\n    this.displayUnit = unit;\r\n    return this;\r\n  }\r\n\r\n  setUnit(unit) {\r\n    this.baseUnit = this.displayUnit = unit;\r\n    return this;\r\n  }\r\n\r\n  setFlag(f, combine = false) {\r\n    this.flag = combine ? this.flag | f : f;\r\n    return this;\r\n  }\r\n\r\n  setUIRange(min, max) {\r\n    if (min === undefined || max === undefined) {\r\n      throw new Error(\"min and/or max cannot be undefined\");\r\n    }\r\n\r\n    this.uiRange = [min, max];\r\n    return this;\r\n  }\r\n\r\n  setIcon(icon) {\r\n    this.icon = icon;\r\n\r\n    return this;\r\n  }\r\n\r\n  setIcon2(icon) {\r\n    this.icon2 = icon;\r\n\r\n    return this;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    if (this.uiRange[0] === -1e17 && this.uiRange[1] === 1e17) {\r\n      this.uiRange = undefined;\r\n    }\r\n\r\n    if (this.baseUnit === \"undefined\") {\r\n      this.baseUnit = undefined;\r\n    }\r\n\r\n    if (this.displayUnit === \"undefined\") {\r\n      this.displayUnit = undefined;\r\n    }\r\n  }\r\n}\r\n\r\nToolProperty.STRUCT = `\r\nToolProperty { \r\n  apiname        : string | \"\"+this.apiname;\r\n  type           : int;\r\n  flag           : int;\r\n  subtype        : int;\r\n  icon           : int;\r\n  icon2          : int;\r\n  baseUnit       : string | \"\"+this.baseUnit;\r\n  displayUnit    : string | \"\"+this.displayUnit;\r\n  range          : array(float) | this.range ? this.range : [-1e17, 1e17];\r\n  uiRange        : array(float) | this.uiRange ? this.uiRange : [-1e17, 1e17];\r\n  description    : string;\r\n  stepIsRelative : bool;\r\n  step           : float;\r\n  expRate        : float;\r\n  radix          : float;\r\n  decimalPlaces  : int;\r\n  uiname         : string | this.uiname || this.apiname || \"\";\r\n}\r\n`;\r\nnstructjs.register(ToolProperty);\r\n\r\nwindow.ToolProperty = ToolProperty;\r\n\r\nexport class FloatArrayProperty extends ToolProperty {\r\n  constructor(value, apiname, uiname, description, flag, icon) {\r\n    super(PropTypes.FLOAT_ARRAY, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.value = [];\r\n\r\n    if (value !== undefined) {\r\n      this.setValue(value);\r\n    }\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return this.value[Symbol.iterator]();\r\n  }\r\n\r\n  setValue(value) {\r\n    super.setValue();\r\n\r\n    if (value === undefined) {\r\n      throw new Error(\"value was undefined in FloatArrayProperty's setValue method\");\r\n    }\r\n\r\n    this.value.length = 0;\r\n\r\n    for (let item of value) {\r\n      if (typeof item !== \"number\" && typeof item !== \"boolean\") {\r\n        console.log(value);\r\n        throw new Error(\"bad item for FloatArrayProperty \" + item);\r\n      }\r\n\r\n      this.value.push(item);\r\n    }\r\n  }\r\n\r\n  push(item) {\r\n    if (typeof item !== \"number\" && typeof item !== \"boolean\") {\r\n      console.log(value);\r\n      throw new Error(\"bad item for FloatArrayProperty \" + item);\r\n    }\r\n\r\n    this.value.push(item);\r\n  }\r\n\r\n  getValue() {\r\n    return this.value;\r\n  }\r\n\r\n  clear() {\r\n    this.value.length = 0;\r\n    return this;\r\n  }\r\n}\r\n\r\nFloatArrayProperty.STRUCT = nstructjs.inherit(FloatArrayProperty, ToolProperty) + `\r\n  value : array(float);\r\n}`;\r\nnstructjs.register(FloatArrayProperty);\r\n\r\nexport class StringProperty extends ToolProperty {\r\n  constructor(value, apiname, uiname, description, flag, icon) {\r\n    super(PropTypes.STRING, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.multiLine = false;\r\n\r\n    if (value) {\r\n      this.setValue(value);\r\n    } else {\r\n      this.setValue(\"\");\r\n    }\r\n\r\n    this.wasSet = false;\r\n  }\r\n\r\n  calcMemSize() {\r\n    return super.calcMemSize() + (this.data !== undefined ? this.data.length*4 : 0) + 8;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data === b.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n\r\n    b.data = this.data;\r\n    b.multiLine = this.multiLine;\r\n\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  setValue(val) {\r\n    //fire events\r\n    super.setValue(val);\r\n    this.data = val;\r\n  }\r\n}\r\n\r\nStringProperty.STRUCT = nstructjs.inherit(StringProperty, ToolProperty) + `\r\n  data : string;\r\n}\r\n`;\r\nnstructjs.register(StringProperty);\r\nToolProperty.internalRegister(StringProperty);\r\n\r\n/*\r\nlet num_res = [\r\n  /([0-9]+)/,\r\n  /((0x)?[0-9a-fA-F]+(h?))/,\r\n  /([0-9]+\\.[0-9]*)/,\r\n  /([0-9]*\\.[0-9]+)/,\r\n  /(\\.[0-9]+)/\r\n];\r\n//num_re = /([0-9]+\\.[0-9]*)|([0-9]*\\.[0-9]+)/\r\n*/\r\n\r\nexport {isNumber} from '../../core/units.js';\r\n/*\r\nexport function isNumber(f) {\r\n  if (f === \"NaN\" || (typeof f == \"number\" && isNaN(f))) {\r\n    return false;\r\n  }\r\n\r\n  f = (\"\" + f).trim();\r\n\r\n  let ok = false;\r\n\r\n  for (let re of num_res) {\r\n    let ret = f.match(re)\r\n    if (!ret) {\r\n      ok = false;\r\n      continue;\r\n    }\r\n\r\n    ok = ret[0].length === f.length;\r\n    if (ok) {\r\n      break;\r\n    }\r\n  }\r\n\r\n  return ok;\r\n}*/\r\n\r\n//window.isNumber = isNumber;\r\n\r\nexport class NumProperty extends ToolProperty {\r\n  constructor(type, value, apiname,\r\n              uiname, description, flag, icon) {\r\n    super(type, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.data = 0;\r\n    this.range = [0, 0];\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data == b.data;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n  }\r\n};\r\nNumProperty.STRUCT = nstructjs.inherit(NumProperty, ToolProperty) + `\r\n  range : array(float);\r\n  data  : float;\r\n}\r\n`;\r\n\r\nexport class _NumberPropertyBase extends ToolProperty {\r\n  constructor(type, value, apiname,\r\n              uiname, description, flag, icon) {\r\n    super(type, null, apiname, uiname, description, flag, icon);\r\n\r\n    this.data = 0.0;\r\n\r\n    //remember to update NumberConstraintsBase et al when adding new number\r\n    //constraints\r\n\r\n    /** controls roller slider rate */\r\n    this.slideSpeed = 1.0;\r\n\r\n    /** exponential rate, used by roller sliders */\r\n    this.expRate = 1.33;\r\n    this.step = 0.1;\r\n\r\n    this.stepIsRelative = false;\r\n\r\n    this.range = [-1e17, 1e17];\r\n\r\n    /** if undefined this.range will be used */\r\n    this.uiRange = undefined;\r\n\r\n    if (value !== undefined && value !== null) {\r\n      this.setValue(value);\r\n      this.wasSet = false;\r\n    }\r\n  }\r\n\r\n  get ui_range() {\r\n    this.report(\"NumberProperty.ui_range is deprecated\");\r\n    return this.uiRange;\r\n  }\r\n\r\n  set ui_range(val) {\r\n    this.report(\"NumberProperty.ui_range is deprecated\");\r\n    this.uiRange = val;\r\n  }\r\n\r\n  calcMemSize() {\r\n    return super.calcMemSize() + 8*8;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data === b.data;\r\n  }\r\n\r\n  toJSON() {\r\n    let json = super.toJSON();\r\n\r\n    json.data = this.data;\r\n    json.expRate = this.expRate;\r\n\r\n    return json;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    this.data = obj.data || this.data;\r\n    this.expRate = obj.expRate || this.expRate;\r\n\r\n    return this;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n\r\n    b.displayUnit = this.displayUnit;\r\n    b.baseUnit = this.baseUnit;\r\n    b.expRate = this.expRate;\r\n    b.step = this.step;\r\n    b.range = this.range ? [this.range[0], this.range[1]] : undefined;\r\n    b.uiRange = this.uiRange ? [this.uiRange[0], this.uiRange[1]] : undefined;\r\n    b.slideSpeed = this.slideSpeed;\r\n    \r\n    b.data = this.data;\r\n  }\r\n\r\n\r\n  setSlideSpeed(f) {\r\n    this.slideSpeed = f;\r\n\r\n    return this;\r\n  }\r\n\r\n  /*\r\n  * non-linear exponent for number sliders\r\n  * in roll mode\r\n  * */\r\n  setExpRate(exp) {\r\n    this.expRate = exp;\r\n  }\r\n\r\n  setValue(val) {\r\n    if (val === undefined || val === null) {\r\n      return;\r\n    }\r\n\r\n    if (typeof val !== \"number\") {\r\n      throw new Error(\"Invalid number \" + val);\r\n    }\r\n\r\n    this.data = val;\r\n\r\n    super.setValue(val);\r\n    return this;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    let get = (key) => {\r\n      if (key in obj) {\r\n        this[key] = obj[key];\r\n      }\r\n    };\r\n\r\n    get(\"range\");\r\n    get(\"step\");\r\n    get(\"expRate\");\r\n    get(\"ui_range\");\r\n\r\n    return this;\r\n  }\r\n};\r\n_NumberPropertyBase.STRUCT = nstructjs.inherit(_NumberPropertyBase, ToolProperty) + `\r\n  range      : array(float);\r\n  expRate    : float;\r\n  data       : float;\r\n  step       : float;\r\n  slideSpeed : float;\r\n}\r\n`;\r\nnstructjs.register(_NumberPropertyBase);\r\n\r\nexport class IntProperty extends _NumberPropertyBase {\r\n  constructor(value, apiname,\r\n              uiname, description, flag, icon) {\r\n    super(PropTypes.INT, value, apiname, uiname, description, flag, icon);\r\n\r\n    //remember to update NumberConstraintsBase et al when adding new number\r\n    //constraints\r\n\r\n    this.radix = 10;\r\n  }\r\n\r\n  setValue(val) {\r\n    super.setValue(Math.floor(val));\r\n    return this;\r\n  }\r\n\r\n  setRadix(radix) {\r\n    this.radix = radix;\r\n  }\r\n\r\n  toJSON() {\r\n    let json = super.toJSON();\r\n\r\n    json.data = this.data;\r\n    json.radix = this.radix;\r\n\r\n    return json;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    this.data = obj.data || this.data;\r\n    this.radix = obj.radix || this.radix;\r\n\r\n    return this;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n  }\r\n}\r\n\r\nIntProperty.STRUCT = nstructjs.inherit(IntProperty, _NumberPropertyBase) + `\r\n  data : int;\r\n}`;\r\nnstructjs.register(IntProperty);\r\n\r\nToolProperty.internalRegister(IntProperty);\r\n\r\nexport class ReportProperty extends StringProperty {\r\n  constructor(value, apiname, uiname, description, flag, icon) {\r\n    super(value, apiname, uiname, description, flag, icon);\r\n\r\n    this.type = PropTypes.REPORT;\r\n  }\r\n}\r\n\r\nReportProperty.STRUCT = nstructjs.inherit(ReportProperty, StringProperty) + `\r\n}\r\n`;\r\nnstructjs.register(ReportProperty);\r\nToolProperty.internalRegister(ReportProperty);\r\n\r\nexport class BoolProperty extends ToolProperty {\r\n  constructor(value, apiname,\r\n              uiname, description, flag, icon) {\r\n    super(PropTypes.BOOL, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.data = !!value;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data == b.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n    b.data = this.data;\r\n\r\n    return this;\r\n  }\r\n\r\n  setValue(val) {\r\n    this.data = !!val;\r\n    super.setValue(val);\r\n\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = super.toJSON();\r\n\r\n    return ret;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nToolProperty.internalRegister(BoolProperty);\r\nBoolProperty.STRUCT = nstructjs.inherit(BoolProperty, ToolProperty) + `\r\n  data : bool;\r\n}\r\n`;\r\nnstructjs.register(BoolProperty);\r\n\r\n\r\nexport class FloatProperty extends _NumberPropertyBase {\r\n  constructor(value, apiname,\r\n              uiname, description, flag, icon) {\r\n    super(PropTypes.FLOAT, value, apiname, uiname, description, flag, icon);\r\n\r\n    //remember to update NumberConstraintsBase et al when adding new number\r\n    //constraints\r\n\r\n    this.decimalPlaces = 4;\r\n  }\r\n\r\n  setDecimalPlaces(n) {\r\n    this.decimalPlaces = n;\r\n    return this;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n    b.data = this.data;\r\n    return this;\r\n  }\r\n\r\n  setValue(val) {\r\n    this.data = val;\r\n\r\n    //fire events\r\n    super.setValue(val);\r\n\r\n    return this;\r\n  }\r\n\r\n  toJSON() {\r\n    let json = super.toJSON();\r\n\r\n    json.data = this.data;\r\n    json.decimalPlaces = this.decimalPlaces;\r\n\r\n    return json;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    this.data = obj.data || this.data;\r\n    this.decimalPlaces = obj.decimalPlaces || this.decimalPlaces;\r\n\r\n    return this;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n  }\r\n}\r\n\r\nToolProperty.internalRegister(FloatProperty);\r\nFloatProperty.STRUCT = nstructjs.inherit(FloatProperty, _NumberPropertyBase) + `\r\n  decimalPlaces : int;\r\n  data          : float;\r\n}\r\n`;\r\nnstructjs.register(FloatProperty);\r\n\r\nexport class EnumKeyPair {\r\n  constructor(key, val) {\r\n    this.key = \"\" + key;\r\n    this.val = \"\" + val;\r\n    this.key_is_int = typeof key === \"number\" || typeof key === \"boolean\";\r\n    this.val_is_int = typeof val === \"number\" || typeof val === \"boolean\";\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    if (this.val_is_int) {\r\n      this.val = parseInt(this.val);\r\n    }\r\n\r\n    if (this.key_is_int) {\r\n      this.key = parseInt(this.key);\r\n    }\r\n  }\r\n}\r\n\r\nEnumKeyPair.STRUCT = `\r\nEnumKeyPair {\r\n  key        : string;\r\n  val        : string;\r\n  key_is_int : bool;\r\n  val_is_int : bool; \r\n}\r\n`\r\nnstructjs.register(EnumKeyPair);\r\n\r\nexport class EnumProperty extends ToolProperty {\r\n  constructor(string_or_int, valid_values, apiname,\r\n              uiname, description, flag, icon) {\r\n    super(PropTypes.ENUM, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.values = {};\r\n    this.keys = {};\r\n    this.ui_value_names = {};\r\n    this.descriptions = {};\r\n\r\n    if (valid_values === undefined) return this;\r\n\r\n    if (valid_values instanceof Array || valid_values instanceof String) {\r\n      for (var i = 0; i < valid_values.length; i++) {\r\n        this.values[valid_values[i]] = valid_values[i];\r\n        this.keys[valid_values[i]] = valid_values[i];\r\n      }\r\n    } else {\r\n      for (var k in valid_values) {\r\n        this.values[k] = valid_values[k];\r\n        this.keys[valid_values[k]] = k;\r\n      }\r\n    }\r\n\r\n    if (string_or_int === undefined) {\r\n      this.data = first(valid_values);\r\n    } else {\r\n      this.setValue(string_or_int);\r\n    }\r\n\r\n    for (var k in this.values) {\r\n      let uin = k.replace(/[_-]/g, \" \").trim();\r\n      uin = uin.split(\" \")\r\n\r\n      let uiname = ToolProperty.makeUIName(k);\r\n\r\n      this.ui_value_names[k] = uiname;\r\n      this.descriptions[k] = uiname;\r\n    }\r\n\r\n    this.iconmap = {};\r\n    this.iconmap2 = {};\r\n\r\n    this.wasSet = false;\r\n  }\r\n\r\n  calcHash(digest = new util.HashDigest()) {\r\n    for (let key in this.keys) {\r\n      digest.add(key);\r\n      digest.add(this.keys[key]);\r\n    }\r\n\r\n    return digest.get();\r\n  }\r\n\r\n  updateDefinition(enumdef_or_prop) {\r\n    let descriptions = this.descriptions;\r\n    let ui_value_names = this.ui_value_names;\r\n\r\n    this.values = {};\r\n    this.keys = {};\r\n    this.ui_value_names = {};\r\n    this.descriptions = {};\r\n\r\n    let enumdef;\r\n\r\n    if (enumdef_or_prop instanceof EnumProperty) {\r\n      enumdef = enumdef_or_prop.values;\r\n    } else {\r\n      enumdef = enumdef_or_prop;\r\n    }\r\n\r\n    for (let k in enumdef) {\r\n      let v = enumdef[k];\r\n\r\n      this.values[k] = v;\r\n      this.keys[v] = k;\r\n    }\r\n\r\n    if (enumdef_or_prop instanceof EnumProperty) {\r\n      let prop = enumdef_or_prop;\r\n      this.iconmap = Object.assign({}, prop.iconmap);\r\n      this.iconmap2 = Object.assign({}, prop.iconmap2);\r\n\r\n      this.ui_value_names = Object.assign({}, prop.ui_value_names);\r\n      this.descriptions = Object.assign({}, prop.descriptions);\r\n    } else {\r\n      for (let k in this.values) {\r\n        if (k in ui_value_names) {\r\n          this.ui_value_names[k] = ui_value_names[k];\r\n        } else {\r\n          this.ui_value_names[k] = ToolProperty.makeUIName(k);\r\n        }\r\n\r\n        if (k in descriptions) {\r\n          this.descriptions[k] = descriptions[k];\r\n        } else {\r\n          this.descriptions[k] = ToolProperty.makeUIName(k);\r\n        }\r\n      }\r\n    }\r\n\r\n    this._fire('metaChange', this);\r\n\r\n    return this;\r\n  }\r\n\r\n  calcMemSize() {\r\n    let tot = super.calcMemSize();\r\n\r\n    for (let k in this.values) {\r\n      tot += (k.length*4 + 16)*4;\r\n    }\r\n\r\n    if (this.descriptions) {\r\n      for (let k in this.descriptions) {\r\n        tot += (k.length + this.descriptions[k].length)*4;\r\n      }\r\n    }\r\n\r\n    return tot + 64;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.getValue() === b.getValue();\r\n  }\r\n\r\n  addUINames(map) {\r\n    for (let k in map) {\r\n      this.ui_value_names[k] = map[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addDescriptions(map) {\r\n    for (let k in map) {\r\n      this.descriptions[k] = map[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addIcons2(iconmap2) {\r\n    if (this.iconmap2 === undefined) {\r\n      this.iconmap2 = {};\r\n    }\r\n\r\n    for (let k in iconmap2) {\r\n      this.iconmap2[k] = iconmap2[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addIcons(iconmap) {\r\n    if (this.iconmap === undefined) {\r\n      this.iconmap = {};\r\n    }\r\n    for (let k in iconmap) {\r\n      this.iconmap[k] = iconmap[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  copyTo(p) {\r\n    super.copyTo(p);\r\n\r\n    p.data = this.data;\r\n\r\n    p.keys = Object.assign({}, this.keys);\r\n    p.values = Object.assign({}, this.values);\r\n    p.ui_value_names = this.ui_value_names;\r\n    p.update = this.update;\r\n    p.api_update = this.api_update;\r\n\r\n    p.iconmap = this.iconmap;\r\n    p.iconmap2 = this.iconmap2;\r\n    p.descriptions = this.descriptions;\r\n\r\n    return p;\r\n  }\r\n\r\n  copy() {\r\n    var p = new this.constructor(\"dummy\", {\"dummy\": 0}, this.apiname, this.uiname, this.description, this.flag)\r\n\r\n    this.copyTo(p);\r\n    return p;\r\n  }\r\n\r\n  getValue() {\r\n    if (this.data in this.values)\r\n      return this.values[this.data];\r\n    else\r\n      return this.data;\r\n  }\r\n\r\n  setValue(val) {\r\n    if (!(val in this.values) && (val in this.keys))\r\n      val = this.keys[val];\r\n\r\n    if (!(val in this.values)) {\r\n      this.report(\"Invalid value for enum!\", val, this.values);\r\n      return;\r\n    }\r\n\r\n    this.data = val;\r\n\r\n    //fire events\r\n    super.setValue(val);\r\n    return this;\r\n  }\r\n\r\n  _loadMap(obj) {\r\n    if (!obj) {\r\n      return {};\r\n    }\r\n\r\n    let ret = {};\r\n    for (let k of obj) {\r\n      ret[k.key] = k.val;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  _saveMap(obj) {\r\n    obj = obj === undefined ? {} : obj;\r\n    let ret = [];\r\n\r\n    for (let k in obj) {\r\n      ret.push(new EnumKeyPair(k, obj[k]));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n\r\n    this.keys = this._loadMap(this._keys);\r\n    this.values = this._loadMap(this._values);\r\n    this.ui_value_names = this._loadMap(this._ui_value_names);\r\n    this.iconmap = this._loadMap(this._iconmap);\r\n    this.iconmap2 = this._loadMap(this._iconmap2);\r\n    this.descriptions = this._loadMap(this._descriptions);\r\n\r\n    if (this.data_is_int) {\r\n      this.data = parseInt(this.data);\r\n      delete this.data_is_int;\r\n    } else if (this.data in this.keys) {\r\n      this.data = this.keys[this.data];\r\n    }\r\n  }\r\n\r\n  _is_data_int() {\r\n    return typeof this.data === \"number\";\r\n  }\r\n}\r\n\r\nToolProperty.internalRegister(EnumProperty);\r\nEnumProperty.STRUCT = nstructjs.inherit(EnumProperty, ToolProperty) + `\r\n  data            : string             | \"\"+this.data;\r\n  data_is_int     : bool               | this._is_data_int();\r\n  _keys           : array(EnumKeyPair) | this._saveMap(this.keys) ;\r\n  _values         : array(EnumKeyPair) | this._saveMap(this.values) ;\r\n  _ui_value_names : array(EnumKeyPair) | this._saveMap(this.ui_value_names) ;\r\n  _iconmap        : array(EnumKeyPair) | this._saveMap(this.iconmap) ;\r\n  _iconmap2       : array(EnumKeyPair) | this._saveMap(this.iconmap2) ;\r\n  _descriptions   : array(EnumKeyPair) | this._saveMap(this.descriptions) ;  \r\n}\r\n`;\r\nnstructjs.register(EnumProperty);\r\n\r\nexport class FlagProperty extends EnumProperty {\r\n  constructor(string_or_int, valid_values, apiname,\r\n              uiname, description, flag, icon) {\r\n    super(string_or_int, valid_values, apiname,\r\n      uiname, description, flag, icon);\r\n\r\n    this.type = PropTypes.FLAG;\r\n    this.wasSet = false;\r\n  }\r\n\r\n  setValue(bitmask) {\r\n    this.data = bitmask;\r\n\r\n    //do not trigger EnumProperty's setValue\r\n    ToolProperty.prototype.setValue.call(this, bitmask);\r\n    return this;\r\n  }\r\n}\r\n\r\nToolProperty.internalRegister(FlagProperty);\r\nFlagProperty.STRUCT = nstructjs.inherit(FlagProperty, EnumProperty) + `\r\n}\r\n`;\r\nnstructjs.register(FlagProperty);\r\n\r\n\r\nexport class VecPropertyBase extends FloatProperty {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(undefined, apiname, uiname, description);\r\n\r\n    this.hasUniformSlider = false;\r\n  }\r\n\r\n  calcMemSize() {\r\n    return super.calcMemSize() + this.data.length*8;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data.vectorDistance(b.data) < 0.00001;\r\n  }\r\n\r\n  uniformSlider(state = true) {\r\n    this.hasUniformSlider = state;\r\n    return this;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n    b.hasUniformSlider = this.hasUniformSlider;\r\n  }\r\n}\r\n\r\nVecPropertyBase.STRUCT = nstructjs.inherit(VecPropertyBase, FloatProperty) + `\r\n  hasUniformSlider : bool | this.hasUniformSlider || false;\r\n}\r\n`;\r\n\r\n\r\nexport class Vec2Property extends FloatProperty {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(undefined, apiname, uiname, description);\r\n\r\n    this.type = PropTypes.VEC2;\r\n    this.data = new Vector2(data);\r\n  }\r\n\r\n  setValue(v) {\r\n    this.data.load(v);\r\n\r\n    //do not trigger parent classes's setValue\r\n    ToolProperty.prototype.setValue.call(this, v);\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    let data = b.data;\r\n    super.copyTo(b);\r\n\r\n    b.data = data;\r\n    b.data.load(this.data);\r\n  }\r\n}\r\n\r\nVec2Property.STRUCT = nstructjs.inherit(Vec2Property, VecPropertyBase) + `\r\n  data : vec2;\r\n}\r\n`;\r\nnstructjs.register(Vec2Property);\r\n\r\nToolProperty.internalRegister(Vec2Property);\r\n\r\nexport class Vec3Property extends VecPropertyBase {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(undefined, apiname, uiname, description);\r\n\r\n    this.type = PropTypes.VEC3;\r\n    this.data = new Vector3(data);\r\n  }\r\n\r\n  isColor() {\r\n    this.subtype = PropSubTypes.COLOR;\r\n    return this;\r\n  }\r\n\r\n  setValue(v) {\r\n    this.data.load(v);\r\n\r\n    //do not trigger parent classes's setValue\r\n    ToolProperty.prototype.setValue.call(this, v);\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    let data = b.data;\r\n    super.copyTo(b);\r\n\r\n    b.data = data;\r\n    b.data.load(this.data);\r\n  }\r\n}\r\n\r\nVec3Property.STRUCT = nstructjs.inherit(Vec3Property, VecPropertyBase) + `\r\n  data : vec3;\r\n}\r\n`;\r\nnstructjs.register(Vec3Property);\r\nToolProperty.internalRegister(Vec3Property);\r\n\r\nexport class Vec4Property extends FloatProperty {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(undefined, apiname, uiname, description);\r\n\r\n    this.type = PropTypes.VEC4;\r\n    this.data = new Vector4(data);\r\n  }\r\n\r\n  setValue(v, w = 1.0) {\r\n    this.data.load(v);\r\n\r\n    //do not trigger parent classes's setValue\r\n    ToolProperty.prototype.setValue.call(this, v);\r\n\r\n    if (v.length < 3) {\r\n      this.data[2] = 0.0;\r\n    }\r\n    if (v.length < 4) {\r\n      this.data[3] = w;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  isColor() {\r\n    this.subtype = PropSubTypes.COLOR;\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    let data = b.data;\r\n    super.copyTo(b);\r\n\r\n    b.data = data;\r\n    b.data.load(this.data);\r\n  }\r\n}\r\n\r\nVec4Property.STRUCT = nstructjs.inherit(Vec4Property, VecPropertyBase) + `\r\n  data : vec4;\r\n}\r\n`;\r\nnstructjs.register(Vec4Property);\r\nToolProperty.internalRegister(Vec4Property);\r\n\r\nexport class QuatProperty extends ToolProperty {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(PropTypes.QUAT, undefined, apiname, uiname, description);\r\n    this.data = new Quat(data);\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data.vectorDistance(b.data) < 0.00001;\r\n  }\r\n\r\n  setValue(v) {\r\n    this.data.load(v);\r\n    super.setValue(v);\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    let data = b.data;\r\n    super.copyTo(b);\r\n\r\n    b.data = data;\r\n    b.data.load(this.data);\r\n  }\r\n}\r\n\r\nQuatProperty.STRUCT = nstructjs.inherit(QuatProperty, VecPropertyBase) + `\r\n  data : vec4;\r\n}\r\n`;\r\nnstructjs.register(QuatProperty);\r\n\r\nToolProperty.internalRegister(QuatProperty);\r\n\r\nexport class Mat4Property extends ToolProperty {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(PropTypes.MATRIX4, undefined, apiname, uiname, description);\r\n    this.data = new Matrix4(data);\r\n  }\r\n\r\n  calcMemSize() {\r\n    return super.calcMemSize() + 16*8 + 32;\r\n  }\r\n\r\n  equals(b) {\r\n    let m1 = this.data.$matrix;\r\n    let m2 = b.data.$matrix;\r\n\r\n    for (let i = 1; i <= 4; i++) {\r\n      for (let j = 1; j <= 4; j++) {\r\n        let key = `m${i}${j}`;\r\n\r\n        if (Math.abs(m1[key] - m2[key]) > 0.00001) {\r\n          return false;\r\n        }\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  setValue(v) {\r\n    this.data.load(v);\r\n    super.setValue(v);\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    let data = b.data;\r\n    super.copyTo(b);\r\n    b.data = data;\r\n\r\n    b.data.load(this.data);\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n  }\r\n}\r\n\r\nMat4Property.STRUCT = nstructjs.inherit(Mat4Property, FloatProperty) + `\r\n  data           : mat4;\r\n}\r\n`;\r\nnstructjs.register(Mat4Property);\r\nToolProperty.internalRegister(Mat4Property);\r\n\r\n/**\r\n * List of other tool props (all of one type)\r\n */\r\nexport class ListProperty extends ToolProperty {\r\n  /*\r\n  * Prop must be a ToolProperty subclass instance\r\n  * */\r\n  constructor(prop, list = [], uiname = \"\") {\r\n    super(PropTypes.PROPLIST);\r\n\r\n    this.uiname = uiname;\r\n\r\n    if (typeof prop == \"number\") {\r\n      prop = PropClasses[prop];\r\n\r\n      if (prop !== undefined) {\r\n        prop = new prop();\r\n      }\r\n    } else if (prop !== undefined) {\r\n      if (prop instanceof ToolProperty) {\r\n        prop = prop.copy();\r\n      } else {\r\n        prop = new prop();\r\n      }\r\n    }\r\n\r\n\r\n    this.prop = prop;\r\n    this.value = [];\r\n\r\n    if (list) {\r\n      for (let val of list) {\r\n        this.push(val);\r\n      }\r\n    }\r\n\r\n    this.wasSet = false;\r\n  }\r\n\r\n  get length() {\r\n    return this.value.length;\r\n  }\r\n\r\n  set length(val) {\r\n    this.value.length = val;\r\n  }\r\n\r\n  calcMemSize() {\r\n    let tot = super.calcMemSize();\r\n\r\n    let psize = this.prop ? this.prop.calcMemSize() + 8 : 8;\r\n    if (!this.prop && this.value.length > 0) {\r\n      psize = this.value[0].calcMemSize();\r\n    }\r\n\r\n    tot += psize*this.value.length + 8;\r\n    tot += 16;\r\n\r\n    return tot;\r\n  }\r\n\r\n  equals(b) {\r\n    let l1 = this.value ? this.value.length : 0;\r\n    let l2 = b.value ? b.value.length : 0;\r\n\r\n    if (l1 !== l2) {\r\n      return false;\r\n    }\r\n\r\n    for (let i = 0; i < l1; i++) {\r\n      let prop1 = this.value[i];\r\n      let prop2 = b.value[i];\r\n\r\n      let bad = prop1.constructor !== prop2.constructor;\r\n      bad = bad || !prop1.equals(prop2);\r\n\r\n      if (bad) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n\r\n    b.prop = this.prop.copy();\r\n\r\n    for (let prop of this.value) {\r\n      b.value.push(prop.copy());\r\n    }\r\n\r\n    return b;\r\n  }\r\n\r\n  copy() {\r\n    return this.copyTo(new ListProperty(this.prop.copy()));\r\n  }\r\n\r\n  push(item = undefined) {\r\n    if (item === undefined) {\r\n      item = this.prop.copy();\r\n    }\r\n\r\n    if (!(item instanceof ToolProperty)) {\r\n      let prop = this.prop.copy();\r\n      prop.setValue(item);\r\n      item = prop;\r\n    }\r\n\r\n    this.value.push(item);\r\n    return item;\r\n  }\r\n\r\n  clear() {\r\n    this.value.length = 0;\r\n  }\r\n\r\n  getListItem(i) {\r\n    return this.value[i].getValue();\r\n  }\r\n\r\n  setListItem(i, val) {\r\n    this.value[i].setValue(val);\r\n  }\r\n\r\n  setValue(value) {\r\n    this.clear();\r\n\r\n    for (let item of value) {\r\n      let prop = this.push();\r\n\r\n      if (typeof item !== \"object\") {\r\n        prop.setValue(item);\r\n      } else if (item instanceof prop.constructor) {\r\n        item.copyTo(prop);\r\n      } else {\r\n        this.report(item);\r\n        throw new Error(\"invalid value \" + item);\r\n      }\r\n    }\r\n\r\n    super.setValue(value);\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.value;\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    let list = this.value;\r\n\r\n    return (function* () {\r\n      for (let item of list) {\r\n        yield item.getValue();\r\n      }\r\n    })();\r\n  }\r\n}\r\n\r\nListProperty.STRUCT = nstructjs.inherit(ListProperty, ToolProperty) + `\r\n  prop  : abstract(ToolProperty);\r\n  value : array(abstract(ToolProperty));\r\n}`;\r\nnstructjs.register(ListProperty);\r\n\r\nToolProperty.internalRegister(ListProperty);\r\n\r\n\r\n//like FlagsProperty but uses strings\r\nexport class StringSetProperty extends ToolProperty {\r\n  constructor(value = undefined, definition = []) {\r\n    super(PropTypes.STRSET);\r\n\r\n    let values = [];\r\n\r\n    this.value = new util.set();\r\n\r\n    let def = definition;\r\n    if (Array.isArray(def) || def instanceof util.set || def instanceof Set) {\r\n      for (let item of def) {\r\n        values.push(item);\r\n      }\r\n    } else if (typeof def === \"object\") {\r\n      for (let k in def) {\r\n        values.push(k);\r\n      }\r\n    } else if (typeof def === \"string\") {\r\n      values.push(def);\r\n    }\r\n\r\n    this.values = {};\r\n    this.ui_value_names = {};\r\n    this.descriptions = {};\r\n    this.iconmap = {};\r\n    this.iconmap2 = {};\r\n\r\n    for (let v of values) {\r\n      this.values[v] = v;\r\n\r\n      let uiname = ToolProperty.makeUIName(v);\r\n      this.ui_value_names[v] = uiname;\r\n    }\r\n\r\n    if (value !== undefined) {\r\n      this.setValue(value);\r\n    }\r\n\r\n    this.wasSet = false;\r\n  }\r\n\r\n  calcMemSize() {\r\n    let tot = super.calcMemSize();\r\n\r\n    for (let k in this.values) {\r\n      tot += (k.length + 16)*5;\r\n    }\r\n\r\n    if (this.descriptions) {\r\n      for (let k in this.descriptions) {\r\n        tot += (k.length + this.descriptions[k].length + 8)*4;\r\n      }\r\n    }\r\n\r\n    return tot + 64;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.value.equals(b.value);\r\n  }\r\n\r\n  /*\r\n  * Values can be a string, undefined/null, or a list/set/object-literal of strings.\r\n  * If destructive is true, then existing set will be cleared.\r\n  * */\r\n  setValue(values, destructive = true, soft_fail = true) {\r\n    let bad = typeof values !== \"string\";\r\n    bad = bad && typeof values !== \"object\";\r\n    bad = bad && values !== undefined && values !== null;\r\n\r\n    if (bad) {\r\n      if (soft_fail) {\r\n        this.report(\"Invalid argument to StringSetProperty.prototype.setValue() \" + values);\r\n        return;\r\n      } else {\r\n        throw new Error(\"Invalid argument to StringSetProperty.prototype.setValue() \" + values);\r\n      }\r\n    }\r\n\r\n    //handle undefined/null\r\n    if (!values) {\r\n      this.value.clear();\r\n    } else if (typeof values === \"string\") {\r\n      if (destructive)\r\n        this.value.clear();\r\n\r\n      if (!(values in this.values)) {\r\n        if (soft_fail) {\r\n          this.report(`\"${values}\" is not in this StringSetProperty`);\r\n          return;\r\n        } else {\r\n          throw new Error(`\"${values}\" is not in this StringSetProperty`);\r\n        }\r\n      }\r\n\r\n      this.value.add(values);\r\n    } else {\r\n      let data = [];\r\n\r\n      if (Array.isArray(values) || values instanceof util.set || values instanceof Set) {\r\n        for (let item of values) {\r\n          data.push(item);\r\n        }\r\n      } else { //object literal?\r\n        for (let k in values) {\r\n          data.push(k);\r\n        }\r\n      }\r\n\r\n      for (let item of data) {\r\n        if (!(item in this.values)) {\r\n          if (soft_fail) {\r\n            this.report(`\"${item}\" is not in this StringSetProperty`);\r\n            continue;\r\n          } else {\r\n            throw new Error(`\"${item}\" is not in this StringSetProperty`);\r\n          }\r\n        }\r\n\r\n        this.value.add(item);\r\n      }\r\n    }\r\n\r\n    super.setValue();\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.value;\r\n  }\r\n\r\n  addIcons2(iconmap2) {\r\n    if (iconmap2 === undefined)\r\n      return;\r\n\r\n    for (let k in iconmap2) {\r\n      this.iconmap2[k] = iconmap2[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addIcons(iconmap) {\r\n    if (iconmap === undefined)\r\n      return;\r\n\r\n    for (let k in iconmap) {\r\n      this.iconmap[k] = iconmap[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addUINames(map) {\r\n    for (let k in map) {\r\n      this.ui_value_names[k] = map[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addDescriptions(map) {\r\n    for (let k in map) {\r\n      this.descriptions[k] = map[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n\r\n    for (let val of this.value) {\r\n      b.value.add(val);\r\n    }\r\n\r\n    b.values = {};\r\n    for (let k in this.values) {\r\n      b.values[k] = this.values[k];\r\n    }\r\n\r\n    b.ui_value_names = {};\r\n    for (let k in this.ui_value_names) {\r\n      b.ui_value_names[k] = this.ui_value_names[k];\r\n    }\r\n\r\n    b.iconmap = {};\r\n    b.iconmap2 = {};\r\n\r\n    for (let k in this.iconmap) {\r\n      b.iconmap[k] = this.iconmap[k];\r\n    }\r\n\r\n    for (let k in this.iconmap2) {\r\n      b.iconmap2[k] = this.iconmap2[k];\r\n    }\r\n\r\n    b.descriptions = {};\r\n    for (let k in this.descriptions) {\r\n      b.descriptions[k] = this.descriptions[k];\r\n    }\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    let values = this.values;\r\n    this.values = {};\r\n\r\n    for (let s of values) {\r\n      this.values[s] = s;\r\n    }\r\n\r\n    this.value = new util.set(this.value);\r\n  }\r\n}\r\n\r\nStringSetProperty.STRUCT = nstructjs.inherit(StringSetProperty, ToolProperty) + `\r\n  value  : iter(string);\r\n  values : iterkeys(string);  \r\n}`;\r\nnstructjs.register(StringSetProperty);\r\n\r\nToolProperty.internalRegister(StringSetProperty);\r\n\r\nimport {Curve1D} from '../curve/curve1d.js';\r\n\r\nexport class Curve1DProperty extends ToolProperty {\r\n  constructor(curve, apiname, uiname, description, flag, icon) {\r\n    super(PropTypes.CURVE, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.data = new Curve1D();\r\n\r\n    if (curve !== undefined) {\r\n      this.setValue(curve);\r\n    }\r\n\r\n    this.wasSet = false;\r\n  }\r\n\r\n  calcMemSize() {\r\n    //bleh, just return a largish block size\r\n    return 1024;\r\n  }\r\n\r\n  equals(b) {\r\n\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  evaluate(t) {\r\n    return this.data.evaluate(t);\r\n  }\r\n\r\n  setValue(curve) {\r\n    if (curve === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.data.load(curve);\r\n    super.setValue(curve);\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n\r\n    b.setValue(this.data);\r\n  }\r\n}\r\n\r\nCurve1DProperty.STRUCT = nstructjs.inherit(Curve1DProperty, ToolProperty) + `\r\n  data : Curve1D;\r\n}\r\n`;\r\n\r\nnstructjs.register(Curve1DProperty);\r\nToolProperty.internalRegister(Curve1DProperty);\r\n\r\n","export const ClassIdSymbol = Symbol(\"pathux-class-id\");\r\n","//import * as nstructjs from './struct.js';\r\nimport {haveModal, _setModalAreaClass} from '../path-controller/util/simple_events.js';\r\nimport * as util from '../path-controller/util/util.js';\r\n\r\nimport '../path-controller/util/struct.js';\r\n\r\nlet ScreenClass = undefined;\r\n\r\nimport {ClassIdSymbol} from '../core/ui_consts.js';\r\n\r\n\r\nexport function setScreenClass(cls) {\r\n  ScreenClass = cls;\r\n}\r\n\r\nexport function getAreaIntName(name) {\r\n  let hash = 0;\r\n\r\n  for (let i = 0; i < name.length; i++) {\r\n    let c = name.charCodeAt(i);\r\n\r\n    if (i%2 === 0) {\r\n      hash += c<<8;\r\n      hash *= 13;\r\n      hash = hash & ((1<<15) - 1);\r\n    } else {\r\n      hash += c;\r\n    }\r\n  }\r\n\r\n  return hash;\r\n}\r\n\r\n//XXX get rid of me\r\nwindow.getAreaIntName = getAreaIntName;\r\n\r\n//XXX get rid of me\r\nexport var AreaTypes = {\r\n  TEST_CANVAS_EDITOR: 0\r\n};\r\n\r\n  export function setAreaTypes(def) {\r\n  for (let k in AreaTypes) {\r\n    delete AreaTypes[k];\r\n  }\r\n\r\n  for (let k in def) {\r\n    AreaTypes[k] = def[k];\r\n  }\r\n}\r\n\r\nexport let areaclasses = {};\r\n\r\n/*hackish! store ref an active wrangler so simple_event's modal\r\n* system can lock it!*/\r\nlet theWrangler = undefined;\r\n\r\nexport class AreaWrangler {\r\n  constructor() {\r\n    this.stacks = new Map();\r\n    this.lasts = new Map();\r\n    this.lastArea = undefined;\r\n    this.stack = [];\r\n    this.idgen = 0;\r\n    this.locked = 0;\r\n    this._last_screen_id = undefined;\r\n\r\n    theWrangler = this;\r\n  }\r\n\r\n  /*Yeek this is particularly evil, it creates a context\r\n  * that can be used by popups with the original context\r\n  * area stack intact of the elements that spawned them.*/\r\n  makeSafeContext(ctx) {\r\n    let wrangler = this.copy();\r\n    let this2 = this;\r\n\r\n    return new Proxy(ctx, {\r\n      get(target, key, rec) {\r\n        wrangler.copyTo(contextWrangler);\r\n        return target[key];\r\n      }\r\n    });\r\n  }\r\n\r\n  copyTo(ret) {\r\n    for (let [key, stack1] of this.stacks) {\r\n      ret.stack.set(key, util.list(stack1));\r\n    }\r\n\r\n    for (let [key, val] of this.lasts) {\r\n      ret.lasts.set(key, val);\r\n    }\r\n\r\n    ret.stack = util.list(this.stack);\r\n    ret.lastArea = this.lastArea;\r\n  }\r\n\r\n  copy(b) {\r\n    let ret = new AreaWrangler();\r\n    this.copyTo(ret);\r\n    return ret;\r\n  }\r\n\r\n  _checkWrangler(ctx) {\r\n    if (ctx === undefined) {\r\n      return true;\r\n    }\r\n\r\n    if (this._last_screen_id === undefined) {\r\n      this._last_screen_id = ctx.screen._id;\r\n      return true;\r\n    }\r\n\r\n    if (ctx.screen._id !== this._last_screen_id) {\r\n      this.reset();\r\n\r\n      this._last_screen_id = ctx.screen._id;\r\n      console.warn(\"contextWrangler detected a new screen; new file?\");\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  reset() {\r\n    theWrangler = this;\r\n    this.stacks = new Map();\r\n    this.lasts = new Map();\r\n    this.lastArea = undefined;\r\n    this.stack = [];\r\n    this.locked = 0;\r\n    this._last_screen_id = undefined;\r\n\r\n    return this;\r\n  }\r\n\r\n  static findInstance() {\r\n    return theWrangler;\r\n  }\r\n\r\n  static lock() {\r\n    return this.findInstance().lock();\r\n  }\r\n\r\n  static unlock() {\r\n    return this.findInstance().unlock();\r\n  }\r\n\r\n  lock() {\r\n    this.locked++;\r\n    return this;\r\n  }\r\n\r\n  unlock() {\r\n    this.locked = Math.max(this.locked - 1, 0);\r\n    return this;\r\n  }\r\n\r\n  push(type, area, pushLastRef = true) {\r\n    theWrangler = this;\r\n\r\n    if (haveModal() || this.locked) {\r\n      pushLastRef = false;\r\n    }\r\n\r\n    if (pushLastRef || !this.lasts.has(type[ClassIdSymbol])) {\r\n      this.lasts.set(type[ClassIdSymbol], area);\r\n      this.lastArea = area;\r\n    }\r\n\r\n    let stack = this.stacks.get(type[ClassIdSymbol]);\r\n    if (stack === undefined) {\r\n      stack = [];\r\n      this.stacks.set(type[ClassIdSymbol], stack);\r\n    }\r\n\r\n    let last = this.lasts.get(type[ClassIdSymbol]);\r\n\r\n    stack.push(last);\r\n    stack.push(area);\r\n\r\n    this.stack.push(area);\r\n  }\r\n\r\n  updateLastRef(type, area) {\r\n    theWrangler = this;\r\n\r\n    if ((this.locked || haveModal()) && this.lasts.has(type[ClassIdSymbol])) {\r\n      return;\r\n    }\r\n\r\n    this.lasts.set(type[ClassIdSymbol], area);\r\n    this.lastArea = area;\r\n  }\r\n\r\n  pop(type, area) {\r\n    let stack = this.stacks.get(type[ClassIdSymbol]);\r\n\r\n    if (stack === undefined) {\r\n      console.warn(\"pop_ctx_area called in error\");\r\n      //throw new Error(\"pop_ctx_area called in error\");\r\n      return;\r\n    }\r\n\r\n    if (stack.length > 0) {\r\n      stack.pop();\r\n      let last = stack.pop();\r\n\r\n      /* paranoia isConnected check to ensure stale elements don't\r\n       * pollute the lasts stack */\r\n      if (!this.locked && last && last.isConnected) {\r\n        this.lasts.set(type[ClassIdSymbol], last);\r\n      }\r\n    } else {\r\n      console.error(\"pop_ctx_area called in error\");\r\n    }\r\n\r\n    if (this.stack.length > 0) {\r\n      this.stack.pop();\r\n    }\r\n  }\r\n\r\n  getLastArea(type) {\r\n    //if (Math.random() > 0.9995) {\r\n      //console.warn(\"getLastArea!\", type, this.lasts.get(type[ClassIdSymbol]));\r\n    //}\r\n\r\n    if (type === undefined) {\r\n      if (this.stack.length > 0) {\r\n        return this.stack[this.stack.length - 1];\r\n      } else {\r\n        return this.lastArea;\r\n      }\r\n    } else {\r\n      if (this.stacks.has(type[ClassIdSymbol])) {\r\n        let stack = this.stacks.get(type[ClassIdSymbol]);\r\n\r\n        if (stack.length > 0) {\r\n          return stack[stack.length-1];\r\n        }\r\n      }\r\n\r\n      return this.lasts.get(type[ClassIdSymbol]);\r\n    }\r\n  }\r\n}\r\n_setModalAreaClass(AreaWrangler);\r\n\r\nexport let contextWrangler = new AreaWrangler();\r\n","\"use strict\";\r\n\r\n/**\r\n * Assorted geometry utility functions.\r\n *\r\n * This file was originally written in a modified form of ES6 way back in ~2010.\r\n * It was then transpiled to ES5 before being ported later to ES6.\r\n *\r\n * TODO: cleanup this file.\r\n */\r\n\r\nimport * as util from './util.js';\r\nimport * as vectormath from './vectormath.js';\r\n\r\nimport {Vector2, Vector3, Vector4, Matrix4, Quat} from './vectormath.js';\r\n\r\nlet dtvtmps = util.cachering.fromConstructor(Vector3, 32);\r\n\r\n\r\nlet quad_co_rets2 = util.cachering.fromConstructor(Vector2, 512);\r\n\r\nexport function quad_bilinear(v1, v2, v3, v4, u, v) {\r\n  return -((v1 - v2)*u - v1 - (u*v1 - u*v2 + u*v3 - u*v4 - v1 + v4)*v);\r\n}\r\n\r\n/*\r\n\r\n on factor;\r\n off period;\r\n\r\n a1 := v1 + (v2 - v1) * u;\r\n a2 := v4 + (v3 - v4) * u;\r\n bilin := a1 + (a2 - a1) * v;\r\n\r\n v1x := 0;\r\n v1y := 0;\r\n\r\n bx := sub(v1=v1x, v2=v2x, v3=v3x, v4=v4x, bilin);\r\n by := sub(v1=v1y, v2=v2y, v3=v3y, v4=v4y, bilin);\r\n\r\n f1 := bx - x;\r\n f2 := by - y;\r\n\r\n ff := solve({f1, f2}, {u, v});\r\n\r\n */\r\nfunction quad_uv_2d(p, v1, v2, v3, v4) {\r\n  let u, v;\r\n\r\n  let v2x = v2[0] - v1[0];\r\n  let v2y = v2[1] - v1[1];\r\n  let v3x = v3[0] - v1[0];\r\n  let v3y = v3[1] - v1[1];\r\n  let v4x = v4[0] - v1[0];\r\n  let v4y = v4[1] - v1[1];\r\n\r\n  let x = p[0] - v1[0];\r\n  let y = p[1] - v1[1];\r\n  let sqrt = Math.sqrt;\r\n\r\n  let A = 2*(((v4y + y)*x - 2*v4x*y)*\r\n      v3y + (v4x*y - v4y*x)*(v4y + y) - ((v4x - x)*v2y - v3x*y)*(v4y - y))*v2x - 2*(\r\n      (v4x*y - v4y*x)*(v4x + x) - (v4x - x)*v3y*x + ((2*v4y - y)*x - v4x*y)*v3x)*\r\n    v2y + (v4x*y - v4y*x + v3y*x - v3x*y)**2 + (v4x - x)**2*v2y**2 + (v4y - y)**2*\r\n    v2x**2;\r\n\r\n  let B = v4x*y - v4y*x + v3y*x - v3x*y;\r\n\r\n  let C1 = (2*(v3x - v4x)*v2y - 2*(v3y - v4y)*v2x);\r\n  let C2 = (2*(v3x*v4y - v3y*v4x + v2y*v4x) - 2*v2x*v4y);\r\n\r\n  let u1, u2;\r\n\r\n  if (A < 0.0) {\r\n    console.log(\"A was < 0\", A);\r\n    A = -A;\r\n    C1 = C2 = 0.0;\r\n  }\r\n\r\n  if (Math.abs(C1) < 0.00001) { //perfectly 90 degrees?\r\n    let dx = v2x;\r\n    let dy = v2y;\r\n\r\n    console.log(\"C1 bad\");\r\n\r\n    let l = Math.sqrt(dx*dx + dy*dy);\r\n    if (l > 0.000001) {\r\n      dx /= l*l;\r\n      dy /= l*l;\r\n    }\r\n\r\n    u1 = u2 = dx*x + dy*y;\r\n  } else {\r\n    u1 = (-(B + sqrt(A) - (v4y - y)*v2x) - (v4x - x)*v2y)/C1;\r\n    u2 = (-(B - sqrt(A) - (v4y - y)*v2x) - (v4x - x)*v2y)/C1;\r\n  }\r\n\r\n  if (Math.abs(C2) < 0.00001) { //perfectly 90 degrees?\r\n    let dx, dy;\r\n\r\n    dx = v3x - v2x;\r\n    dy = v3y - v2y;\r\n\r\n    console.log(\"C2 bad\");\r\n\r\n    let l = Math.sqrt(dx**2 + dy**2);\r\n    if (l > 0.00001) {\r\n      dx /= l*l;\r\n      dy /= l*l;\r\n    }\r\n\r\n    v1 = v2 = x*dx + y*dy;\r\n  } else {\r\n    v1 = (-(B - sqrt(A) + (v4y + y)*v2x) + (v4x + x)*v2y)/C2;\r\n    v2 = (-(B + sqrt(A) + (v4y + y)*v2x) + (v4x + x)*v2y)/C2;\r\n  }\r\n\r\n  let ret = quad_co_rets2.next();\r\n\r\n  let d1 = (u1 - 0.5)**2 + (v1 - 0.5)**2;\r\n  let d2 = (u2 - 0.5)**2 + (v2 - 0.5)**2;\r\n\r\n  if (d1 < d2) {\r\n    ret[0] = u1;\r\n    ret[1] = v1;\r\n  } else {\r\n    ret[0] = u2;\r\n    ret[1] = v2;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n\r\nexport const ClosestModes = {\r\n  CLOSEST  : 0,\r\n  START    : 1,\r\n  END      : 2,\r\n  ENDPOINTS: 3,\r\n  ALL      : 4\r\n};\r\n\r\nlet advs = util.cachering.fromConstructor(Vector4, 128);\r\n\r\nexport class AbstractCurve {\r\n  evaluate(t) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  derivative(t) {\r\n  }\r\n\r\n  curvature(t) {\r\n\r\n  }\r\n\r\n  normal(t) {\r\n\r\n  }\r\n\r\n  width(t) {\r\n\r\n  }\r\n}\r\n\r\nexport class ClosestCurveRets {\r\n  constructor() {\r\n    this.p = new Vector3();\r\n    this.t = 0;\r\n  }\r\n}\r\n\r\nlet cvrets = util.cachering.fromConstructor(ClosestCurveRets, 2048);\r\nlet cvarrays = new util.ArrayPool();\r\nlet cvtmp = new Array(1024);\r\n\r\nexport function closestPoint(p, curve, mode) {\r\n  let steps = 5;\r\n  let s = 0, ds = 1.0/steps;\r\n\r\n  let ri = 0;\r\n\r\n  for (let i = 0; i < steps; i++, s += ds) {\r\n    let c1 = curve.evaluate(s);\r\n    let c2 = curve.evaluate(s + ds);\r\n\r\n\r\n  }\r\n}\r\n\r\nlet poly_normal_tmps = util.cachering.fromConstructor(Vector3, 64);\r\nlet pncent = new Vector3();\r\n\r\nexport function normal_poly(vs) {\r\n  if (vs.length === 3) {\r\n    return poly_normal_tmps.next().load(normal_tri(vs[0], vs[1], vs[2]));\r\n  } else if (vs.length === 4) {\r\n    return poly_normal_tmps.next().load(normal_quad(vs[0], vs[1], vs[2], vs[3]));\r\n  }\r\n\r\n  if (vs.length === 0) {\r\n    return poly_normal_tmps.next().zero();\r\n  }\r\n\r\n  let cent = pncent.zero();\r\n  let tot = 0;\r\n\r\n  for (let v of vs) {\r\n    cent.add(v);\r\n    tot++;\r\n  }\r\n\r\n  cent.mulScalar(1.0/tot);\r\n  let n = poly_normal_tmps.next().zero();\r\n\r\n  for (let i = 0; i < vs.length; i++) {\r\n    let a = vs[i];\r\n    let b = vs[(i + 1)%vs.length];\r\n    let c = cent;\r\n\r\n    let n2 = normal_tri(a, b, c);\r\n    n.add(n2);\r\n  }\r\n\r\n  n.normalize();\r\n  return n;\r\n}\r\n\r\n/*\r\non factor;\r\noff period;\r\n\r\nf1 := u*v1x + v*v2x + (1.0-u-v)*v3x - px;\r\nf2 := u*v1y + v*v2y + (1.0-u-v)*v3y - py;\r\n\r\nff := solve({f1, f2}, {u, v});\r\n\r\non fort;\r\npart(ff, 1, 1);\r\npart(ff, 1, 2);\r\noff fort;\r\n\r\n*/\r\n\r\nlet barycentric_v2_rets = util.cachering.fromConstructor(Vector2, 2048);\r\nlet calc_proj_refs = new util.cachering(() => [0, 0], 64);\r\n\r\n/*\r\n  a b c d\r\n     b\r\n\r\n  a------c\r\n\r\n     d\r\n\r\n  on factor;\r\n  load_package avector;\r\n\r\n  ax := 0;\r\n  ay := 0;\r\n  az := 0;\r\n\r\n  a := avec(ax, ay, az);\r\n  b := avec(bx, by, bz);\r\n  c := avec(cx, cy, cz);\r\n  d := avec(dx, dy, dz);\r\n\r\n  n1 := d cross c;\r\n  n2 := c cross b;\r\n\r\n  n1 := n1 / (VMOD n1);\r\n  n2 := n2 / (VMOD n2);\r\n\r\n  d := n1 dot n2;\r\n  on fort;\r\n\r\n  d*d;\r\n\r\n  off fort;\r\n\r\n\r\n  */\r\n\r\n/**\r\n\r\n v2\r\n\r\n v1------v3\r\n\r\n v4\r\n\r\n */\r\nexport function dihedral_v3_sqr(v1, v2, v3, v4) {\r\n  let bx = v2[0] - v1[0];\r\n  let by = v2[1] - v1[1];\r\n  let bz = v2[2] - v1[2];\r\n\r\n  let cx = v3[0] - v1[0];\r\n  let cy = v3[1] - v1[1];\r\n  let cz = v3[2] - v1[2];\r\n\r\n  let dx = v4[0] - v1[0];\r\n  let dy = v4[1] - v1[1];\r\n  let dz = v4[2] - v1[2];\r\n\r\n\r\n  return ((bx*cz - bz*cx)*(cx*dz - cz*dx) + (by*cz - bz*cy)*(cy*dz - cz*dy) + (bx*cy - by*cx)*\r\n    (cx*dy - cy*dx))**2/(((bx*cz - bz*cx)**2 + (by*cz - bz*cy)**2\r\n    + (bx*cy - by*cx)**2)*((cx*dz - cz*dx)**2 + (cy*dz - cz*dy)**2 + (cx*dy - cy*dx)**2));\r\n}\r\n\r\nlet tet_area_tmps = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport function tet_volume(a, b, c, d) {\r\n  a = tet_area_tmps.next().load(a);\r\n  b = tet_area_tmps.next().load(b);\r\n  c = tet_area_tmps.next().load(c);\r\n  d = tet_area_tmps.next().load(d);\r\n\r\n  a.sub(d);\r\n  b.sub(d);\r\n  c.sub(d);\r\n\r\n  b.cross(c);\r\n  return a.dot(b)/6.0;\r\n}\r\n\r\nexport function calc_projection_axes(no) {\r\n  let ax = Math.abs(no[0]), ay = Math.abs(no[1]), az = Math.abs(no[2]);\r\n\r\n  let ret = calc_proj_refs.next();\r\n\r\n  if (ax > ay && ax > az) {\r\n    ret[0] = 1;\r\n    ret[1] = 2;\r\n  } else if (ay > az && ay > ax) {\r\n    ret[0] = 0;\r\n    ret[1] = 2;\r\n  } else {\r\n    ret[0] = 0;\r\n    ret[1] = 1;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nlet _avtmps = util.cachering.fromConstructor(Vector3, 128);\r\n\r\nfunction inrect_3d(p, min, max) {\r\n  let ok = p[0] >= min[0] && p[0] <= max[0];\r\n  ok = ok && p[1] >= min[1] && p[1] <= max[1];\r\n  ok = ok && p[2] >= min[2] && p[2] <= max[2];\r\n\r\n  return ok;\r\n}\r\n\r\nexport function aabb_isect_line_3d(v1, v2, min, max) {\r\n  let inside = inrect_3d(v1, min, max);\r\n  inside = inside || inrect_3d(v2, min, max);\r\n\r\n  if (inside) {\r\n    return true;\r\n  }\r\n\r\n  let cent = _avtmps.next().load(min).interp(max, 0.5);\r\n\r\n  let p = closest_point_on_line(cent, v1, v2, true);\r\n  if (!p) {\r\n    return false;\r\n  }\r\n\r\n  p = p[0];\r\n\r\n  return inrect_3d(p, min, max);\r\n}\r\n\r\nexport function aabb_isect_cylinder_3d(v1, v2, radius, min, max) {\r\n  let inside = inrect_3d(v1, min, max);\r\n  inside = inside || inrect_3d(v2, min, max);\r\n\r\n  if (inside) {\r\n    return true;\r\n  }\r\n\r\n  let cent = _avtmps.next().load(min).interp(max, 0.5);\r\n\r\n  let p = closest_point_on_line(cent, v1, v2, true);\r\n  if (!p) {\r\n    return false;\r\n  }\r\n\r\n  p = p[0];\r\n\r\n  let size = _avtmps.next().load(max).sub(min);\r\n\r\n  size.mulScalar(0.5);\r\n  size.addScalar(radius); //*(3**0.5));\r\n\r\n  p.sub(cent).abs();\r\n\r\n  return p[0] <= size[0] && p[1] <= size[1] && p[2] <= size[2];\r\n}\r\n\r\nexport function barycentric_v2(p, v1, v2, v3, axis1 = 0, axis2 = 1, out = undefined) {\r\n  let div = (v2[axis1]*v3[axis2] - v2[axis2]*v3[axis1] + (v2[axis2] - v3[axis2])*v1[axis1] - (v2[axis1] - v3[axis1])*v1[axis2]);\r\n\r\n  if (Math.abs(div) < 0.000001) {\r\n    div = 0.00001;\r\n  }\r\n\r\n  let u = (v2[axis1]*v3[axis2] - v2[axis2]*v3[axis1] + (v2[axis2] - v3[axis2])*p[axis1] - (v2[axis1] - v3[axis1])*p[axis2])/div;\r\n  let v = (-(v1[axis1]*v3[axis2] - v1[axis2]*v3[axis1] + (v1[axis2] - v3[axis2])*p[axis1]) + (v1[axis1] - v3[axis1])*p[axis2])/div;\r\n\r\n  if (!out) {\r\n    out = barycentric_v2_rets.next();\r\n  }\r\n\r\n  out[0] = u;\r\n  out[1] = v;\r\n\r\n  return out;\r\n}\r\n\r\n/*\r\n\r\non factor;\r\n\r\nload_package \"avector\";\r\n\r\npx := 0;\r\npy := 0;\r\npz := 0;\r\n\r\nv1 := avec(v1x, v1y, v1z);\r\nv2 := avec(v2x, v2y, v2z);\r\np := avec(px, py, pz);\r\n\r\nt1 := p - v1;\r\nt2 := v2 - v1;\r\n\r\nl1 := t2 / VMOD t2;\r\n\r\nt := dot(t1, t2);\r\n\r\np2 := v1 + t2*t;\r\n\r\non fort;\r\ndot(p2, p2);\r\noff fort;\r\n\r\n**/\r\n\r\nfunction _linedis2(co, v1, v2) {\r\n  let v1x = v1[0] - co[0];\r\n  let v1y = v1[1] - co[1];\r\n  let v1z = v1[2] - co[2];\r\n\r\n  let v2x = v2[0] - co[0];\r\n  let v2y = v2[1] - co[1];\r\n  let v2z = v2[2] - co[2];\r\n\r\n  let dis = (((v1y - v2y)*v1y + (v1z - v2z)*v1z + (v1x - v2x)*v1x)*(v1y - v2y) - v1y)**2 +\r\n    (((v1y - v2y)*v1y + (v1z - v2z)*v1z + (v1x - v2x)*v1x)*(v1z - v2z) - v1z)**2 +\r\n    (((v1y - v2y)*v1y + (v1z - v2z)*v1z + (v1x - v2x)*v1x)*(v1x - v2x) - v1x)**2;\r\n\r\n  return dis;\r\n}\r\n\r\nlet closest_p_tri_rets = new util.cachering(() => {\r\n  return {\r\n    co  : new Vector3(),\r\n    uv  : new Vector2(),\r\n    dist: 0\r\n  }\r\n}, 512);\r\n\r\nlet cpt_v1 = new Vector3();\r\nlet cpt_v2 = new Vector3();\r\nlet cpt_v3 = new Vector3();\r\nlet cpt_v4 = new Vector3();\r\nlet cpt_v5 = new Vector3();\r\nlet cpt_v6 = new Vector3();\r\nlet cpt_p = new Vector3();\r\nlet cpt_n = new Vector3();\r\nlet cpt_mat = new Matrix4();\r\nlet cpt_mat2 = new Matrix4();\r\nlet cpt_b = new Vector3();\r\n\r\nexport function closest_point_on_quad(p, v1, v2, v3, v4, n, uvw) {\r\n  let a = closest_point_on_tri(p, v1, v2, v3, n, uvw);\r\n  let b = closest_point_on_tri(p, v1, v3, v4, n, uvw);\r\n\r\n  return a.dist <= b.dist ? a : b;\r\n}\r\n\r\nexport function closest_point_on_tri(p, v1, v2, v3, n, uvw) {\r\n  let op = p;\r\n\r\n  if (uvw) {\r\n    uvw[0] = uvw[1] = 0.0;\r\n    if (uvw.length > 2) {\r\n      uvw[2] = 0.0;\r\n    }\r\n  }\r\n\r\n  v1 = cpt_v1.load(v1);\r\n  v2 = cpt_v2.load(v2);\r\n  v3 = cpt_v3.load(v3);\r\n  p = cpt_p.load(p);\r\n\r\n  if (n === undefined) {\r\n    n = cpt_n.load(normal_tri(v1, v2, v3));\r\n  }\r\n\r\n  v1.sub(p);\r\n  v2.sub(p);\r\n  v3.sub(p);\r\n  p.zero();\r\n\r\n\r\n  /*use least squares to solve for barycentric coordinates\r\n    then clip to triangle\r\n\r\n    we do this in 2d, as all solutions are coplanar anyway and that way we\r\n    can have one of the equations be \"u+v+w = 1\".\r\n    should investigate if this is really necassary.\r\n   */\r\n\r\n  let ax1, ax2;\r\n  let ax = Math.abs(n[0]), ay = Math.abs(n[1]), az = Math.abs(n[2]);\r\n  if (ax === 0.0 && ay === 0.0 && az === 0.0) {\r\n    console.log(\"eek1\", n, v1, v2, v3);\r\n    let ret = closest_p_tri_rets.next();\r\n\r\n    ret.dist = 1e17;\r\n    ret.co.zero();\r\n    ret.uv.zero();\r\n\r\n    return ret;\r\n  }\r\n\r\n  let ax3;\r\n  if (ax >= ay && ax >= az) {\r\n    ax1 = 1;\r\n    ax2 = 2;\r\n    ax3 = 0;\r\n  } else if (ay >= ax && ay >= az) {\r\n    ax1 = 0;\r\n    ax2 = 2;\r\n    ax3 = 1;\r\n  } else {\r\n    ax1 = 0;\r\n    ax2 = 1;\r\n    ax3 = 2;\r\n  }\r\n\r\n  let mat = cpt_mat;\r\n  let mat2 = cpt_mat2;\r\n  mat.makeIdentity();\r\n\r\n  let m = mat.$matrix;\r\n\r\n  m.m11 = v1[ax1];\r\n  m.m12 = v2[ax1];\r\n  m.m13 = v3[ax1];\r\n  m.m14 = 0.0;\r\n\r\n  m.m21 = v1[ax2];\r\n  m.m22 = v2[ax2];\r\n  m.m23 = v3[ax2];\r\n  m.m24 = 0.0;\r\n\r\n  /*\r\n  m.m31 = v1[ax3];\r\n  m.m32 = v2[ax3];\r\n  m.m33 = v3[ax3];\r\n  m.m34 = 0.0;\r\n  */\r\n\r\n  m.m31 = 1;\r\n  m.m32 = 1;\r\n  m.m33 = 1;\r\n  m.m34 = 0.0;\r\n\r\n  mat.transpose();\r\n\r\n  let b = cpt_b.zero();\r\n\r\n  b[0] = p[ax1];\r\n  b[1] = p[ax2];\r\n  //b[2] = p[ax3];\r\n  b[2] = 1.0;\r\n  b[3] = 0.0;\r\n\r\n  mat2.load(mat).transpose();\r\n\r\n  mat.preMultiply(mat2);\r\n\r\n  if (mat.invert() === null) {\r\n    console.log(\"eek2\", mat.determinant(), ax1, ax2, n);\r\n    let ret = closest_p_tri_rets.next();\r\n\r\n    ret.dist = 1e17;\r\n    ret.co.zero();\r\n    ret.uv.zero();\r\n\r\n    return ret;\r\n  }\r\n\r\n  mat.multiply(mat2);\r\n\r\n\r\n  b.multVecMatrix(mat);\r\n\r\n  let u = b[0];\r\n  let v = b[1];\r\n  let w = b[2];\r\n\r\n  for (let i = 0; i < 1; i++) {\r\n    u = Math.min(Math.max(u, 0.0), 1.0);\r\n    v = Math.min(Math.max(v, 0.0), 1.0);\r\n    w = Math.min(Math.max(w, 0.0), 1.0);\r\n\r\n    let tot = u + v + w;\r\n\r\n    if (tot !== 0.0) {\r\n      tot = 1.0/tot;\r\n      u *= tot;\r\n      v *= tot;\r\n      w *= tot;\r\n    }\r\n  }\r\n\r\n  if (uvw) {\r\n    uvw[0] = u;\r\n    uvw[1] = v;\r\n    if (uvw.length > 2) {\r\n      uvw[2] = w;\r\n    }\r\n  }\r\n\r\n  let x = v1[0]*u + v2[0]*v + v3[0]*w;\r\n  let y = v1[1]*u + v2[1]*v + v3[1]*w;\r\n  let z = v1[2]*u + v2[2]*v + v3[2]*w;\r\n\r\n  let ret = closest_p_tri_rets.next();\r\n\r\n  ret.co.loadXYZ(x, y, z);\r\n  ret.uv[0] = u;\r\n  ret.uv[1] = v;\r\n\r\n  ret.dist = ret.co.vectorLength();\r\n  ret.co.add(op);\r\n\r\n  return ret;\r\n}\r\n\r\nexport function dist_to_tri_v3_old(co, v1, v2, v3, no = undefined) {\r\n  if (!no) {\r\n    no = dtvtmps.next().load(normal_tri(v1, v2, v3));\r\n  }\r\n\r\n  let p = dtvtmps.next().load(co);\r\n  p.sub(v1);\r\n\r\n  let planedis = -p.dot(no);\r\n\r\n  let [axis, axis2] = calc_projection_axes(no);\r\n\r\n  let p1 = dtvtmps.next();\r\n  let p2 = dtvtmps.next();\r\n  let p3 = dtvtmps.next();\r\n\r\n  p1[0] = v1[axis];\r\n  p1[1] = v1[axis2];\r\n  p1[2] = 0.0;\r\n\r\n  p2[0] = v2[axis];\r\n  p2[1] = v2[axis2];\r\n  p2[2] = 0.0;\r\n\r\n  p3[0] = v3[axis];\r\n  p3[1] = v3[axis2];\r\n  p3[2] = 0.0;\r\n\r\n  let pp = dtvtmps.next();\r\n  pp[0] = co[axis];\r\n  pp[1] = co[axis2];\r\n  pp[2] = 0.0;\r\n\r\n  let dis = 1e17;\r\n\r\n  function linedis2d(a, b, c) {\r\n    let dx1 = a[0] - b[0];\r\n    let dy1 = a[1] - b[1];\r\n    let dx2 = c[0] - b[0];\r\n    let dy2 = c[1] - b[1];\r\n\r\n    let len = dx2*dx2 + dy2*dy2;\r\n    len = len > 0.000001 ? 1.0/len : 0.0;\r\n\r\n    dx2 *= len;\r\n    dy2 *= len;\r\n\r\n    return Math.abs(dx1*dy2 - dx2*dy1);\r\n  }\r\n\r\n  let tmp = dtvtmps.next();\r\n  let tmp2 = dtvtmps.next();\r\n\r\n  function linedis3d(a, b, c) {\r\n    tmp.load(a).sub(b);\r\n    tmp2.load(c).sub(b).normalize();\r\n\r\n    let t = tmp.dot(tmp2);\r\n    t = Math.min(Math.max(t, 0.0), b.vectorDistance(c));\r\n\r\n    tmp2.mulScalar(t).add(b);\r\n\r\n    return tmp2.vectorDistance(a);\r\n  }\r\n\r\n\r\n  /* are we above the triangle? if so use plane distance */\r\n  if (point_in_tri(pp, p1, p2, p3)) {\r\n    return Math.abs(planedis);\r\n  }\r\n\r\n  /* get distance to the closest edge */\r\n  dis = Math.min(dis, linedis3d(co, v1, v2));\r\n  dis = Math.min(dis, linedis3d(co, v2, v3));\r\n  dis = Math.min(dis, linedis3d(co, v3, v1));\r\n\r\n  if (0) {\r\n    let uv = barycentric_v2(pp, p1, p2, p3);\r\n\r\n    let w = 1.0 - uv[0] - uv[1];\r\n    uv[0] = Math.min(Math.max(uv[0], 0.0), 1.0);\r\n    uv[1] = Math.min(Math.max(uv[1], 0.0), 1.0);\r\n    w = Math.min(Math.max(w, 0.0), 1.0);\r\n\r\n    let sum = (uv[0] + uv[1] + w);\r\n    sum = sum !== 0.0 ? 1.0/sum : 0.0;\r\n\r\n    w *= sum;\r\n    uv[0] *= sum;\r\n    uv[1] *= sum;\r\n\r\n    pp.zero();\r\n\r\n    pp.addFac(v1, uv[0]);\r\n    pp.addFac(v2, uv[1]);\r\n    pp.addFac(v3, 1.0 - uv[0] - uv[1]);\r\n\r\n    dis = Math.min(dis, pp.vectorDistance(co));\r\n  }\r\n\r\n  return dis;\r\n}\r\n\r\n\r\nexport function dist_to_tri_v3(p, v1, v2, v3, n) {\r\n  return dist_to_tri_v3_old(p, v1, v2, v3, n);\r\n  //return Math.sqrt(Math.abs(dist_to_tri_v3_sqr(p, v1, v2, v3, n)));\r\n}\r\n\r\n\r\n/* reduce script\r\n\r\non factor;\r\n\r\nax := 0;\r\nay := 0;\r\n\r\ne1x := bx - ax;\r\ne1y := by - ay;\r\ne2x := cx - bx;\r\ne2y := cy - by;\r\ne3x := ax - cx;\r\ne3y := ay - cy;\r\n\r\nl1 := (e1x**2 + e1y**2)**0.5;\r\nl2 := (e2x**2 + e2y**2)**0.5;\r\nl3 := (e3x**2 + e3y**2)**0.5;\r\n\r\nload_package \"avector\";\r\n\r\ne1 := avec(e1x / l1, e1y / l1, 0.0);\r\ne2 := avec(e2x / l2, e2y / l2, 0.0);\r\ne3 := avec(e3x / l3, e3y / l3, 0.0);\r\n\r\nd1 := x1*e1[1] - y1*e1[0];\r\nd2 := x1*e2[1] - y1*e2[0];\r\nd3 := x1*e3[1] - y1*e3[0];\r\n\r\nd1 := d1**2;\r\nd2 := d2**2;\r\nd3 := d3**2;\r\n\r\non fort;\r\nd1;\r\nd2;\r\nd3;\r\noff fort;\r\n\r\n*/\r\n\r\nlet _dt3s_n = new Vector3();\r\n\r\nexport function dist_to_tri_v3_sqr(p, v1, v2, v3, n) {\r\n  if (n === undefined) {\r\n    n = _dt3s_n;\r\n    n.load(normal_tri(v1, v2, v3));\r\n  }\r\n\r\n  // find projection axis;\r\n  let axis1, axis2, axis3;\r\n  let nx = n[0] < 0.0 ? -n[0] : n[0];\r\n  let ny = n[1] < 0.0 ? -n[1] : n[1];\r\n  let nz = n[2] < 0.0 ? -n[2] : n[2];\r\n\r\n  const feps = 0.0000001;\r\n\r\n  if (nx > ny && nx > nz) {\r\n    axis1 = 1;\r\n    axis2 = 2;\r\n    axis3 = 0;\r\n  } else if (ny > nx && ny > nz) {\r\n    axis1 = 0;\r\n    axis2 = 2;\r\n    axis3 = 1;\r\n  } else {\r\n    axis1 = 0;\r\n    axis2 = 1;\r\n    axis3 = 2;\r\n  }\r\n\r\n  //n.load(normal_tri(v1, v2, v3));\r\n\r\n  let planedis = (p[0] - v1[0])*n[0] + (p[1] - v1[1])*n[1] + (p[2] - v1[2])*n[2];\r\n  planedis = planedis < 0.0 ? -planedis : planedis;\r\n\r\n  let ax = v1[axis1], ay = v1[axis2], az = v1[axis3];\r\n\r\n  let bx = v2[axis1] - ax, by = v2[axis2] - ay, bz = v2[axis3] - az;\r\n  let cx = v3[axis1] - ax, cy = v3[axis2] - ay, cz = v3[axis3] - az;\r\n\r\n  let bx2 = bx*bx, by2 = by*by, bz2 = bz*bz, cx2 = cx*cx, cy2 = cy*cy, cz2 = cz*cz;\r\n\r\n  let x1 = p[axis1] - ax;\r\n  let y1 = p[axis2] - ay;\r\n  let z1 = p[axis3] - az;\r\n\r\n  const testf = 0.0;\r\n\r\n  let l1 = Math.sqrt(bx**2 + by**2);\r\n  let l2 = Math.sqrt((cx - bx)**2 + (cy - by)**2);\r\n  let l3 = Math.sqrt(cx**2 + cy**2);\r\n\r\n  let s1 = x1*by - y1*bx < testf;\r\n  let s2 = (x1 - bx)*(cy - by) - (y1 - by)*(cx - bx) < testf;\r\n  let s3 = (x1* -cy + y1*cx) < testf;\r\n\r\n  /*\r\n    (x1-cx)*-cy - (y1-cy)*-cx\r\n   reduces to:\r\n     x1*-cy + y1*cx;\r\n   */\r\n\r\n  //console.log(axis1, axis2, axis3, n);\r\n  //console.log(s1, s2, s3);\r\n  //console.log(bx, by, cx, cy);\r\n\r\n  if (1 && n[axis3] < 0.0) {\r\n    s1 = !s1;\r\n    s2 = !s2;\r\n    s3 = !s3;\r\n    /*\r\n        bx = v3[axis1];\r\n        by = v3[axis2];\r\n        bz = v3[axis3];\r\n\r\n        cx = v2[axis1];\r\n        cy = v2[axis2];\r\n        cz = v2[axis3];\r\n\r\n        bx2 = bx*bx;\r\n        by2 = by*by;\r\n        bz2 = bz*bz;\r\n\r\n        cx2 = cx*cx;\r\n        cy2 = cy*cy;\r\n        cz2 = cz*cz;*/\r\n  }\r\n\r\n  let mask = (s1 & 1) | (s2<<1) | (s3<<2);\r\n  if (mask === 0 || mask === 7) {\r\n    return planedis*planedis;\r\n  }\r\n\r\n  let d1, d2, d3, div;\r\n\r\n\r\n  /*\r\n//\\  3|\r\n//  \\ |\r\n//    b\r\n//    | \\\r\n//  1 |   \\  2\r\n//    |  0  \\\r\n// ___a_______c___\r\n//  5 |   4      \\ 6\r\n*/\r\n\r\n  let dis = 0.0;\r\n  let lx, ly, lz;\r\n\r\n  lx = bx;\r\n  ly = by;\r\n  lz = bz;\r\n\r\n  nx = n[axis1];\r\n  ny = n[axis2];\r\n  nz = n[axis3];\r\n\r\n  switch (mask) {\r\n    case 1:\r\n      div = (bx2 + by2);\r\n\r\n      if (div > feps) {\r\n        d1 = (bx*y1 - by*x1);\r\n        d1 = (d1*d1)/div;\r\n\r\n        lx = -by;\r\n        ly = bx;\r\n        lz = bz;\r\n      } else {\r\n        d1 = x1*x1 + y1*y1;\r\n\r\n        lx = x1;\r\n        ly = y1;\r\n        lz = z1;\r\n      }\r\n\r\n      dis = d1;\r\n      break;\r\n    case 3:\r\n      lx = x1 - bx;\r\n      ly = y1 - by;\r\n      lz = z1 - bz;\r\n\r\n      dis = lx*lx + ly*ly;\r\n      return lx*lx + ly*ly + lz*lz;\r\n    case 2:\r\n      div = (bx - cx)**2 + (by - cy)**2;\r\n\r\n      if (div > feps) {\r\n        d2 = ((bx - cx)*y1 - (by - cy)*x1);\r\n        d2 = d2/div;\r\n\r\n        lx = (by - cy);\r\n        ly = (cx - bx);\r\n        lz = cz - bz;\r\n      } else {\r\n        d2 = (x1 - bx)*(x1 - bx) + (y1 - by)*(y1 - by);\r\n\r\n        lx = x1 - bx;\r\n        ly = y1 - by;\r\n        lz = z1 - bz;\r\n      }\r\n\r\n      dis = d2;\r\n      break;\r\n    case 6:\r\n      lx = x1 - cx;\r\n      ly = y1 - cy;\r\n      lz = z1 - cz;\r\n\r\n      return lx*lx + ly*ly + lz*lz;\r\n    case 4:\r\n      div = (cx2 + cy2);\r\n\r\n      if (div > feps) {\r\n        d3 = (cx*y1 - cy*x1);\r\n        d3 = (d3*d3)/div;\r\n\r\n        lx = cy;\r\n        ly = -cx;\r\n        lz = cz;\r\n      } else {\r\n        d3 = (x1 - cx)*(x1 - cx) + (y1 - cy)*(y1 - cy);\r\n\r\n        lx = x1 - cx;\r\n        ly = y1 - cy;\r\n        lz = z1 - cz;\r\n      }\r\n\r\n      dis = d3;\r\n      break;\r\n    case 5:\r\n      lx = x1;\r\n      ly = y1;\r\n      lz = z1;\r\n\r\n      return lx*lx + ly*ly + lz*lz;\r\n  }\r\n\r\n  //lx = p[axis1] - v1[axis1];\r\n  //ly = p[axis2] - v1[axis2];\r\n  {\r\n    let d = lx*nx + ly*ny + lz*nz;\r\n\r\n    d = -d;\r\n\r\n    lx += nx*d;\r\n    ly += ny*d;\r\n    lz += nz*d;\r\n\r\n    //dis = lx*lx + ly*ly;\r\n\r\n    if (0 && Math.random() > 0.999) {\r\n      console.log(\"d\", d.toFixed(6));\r\n      console.log(lx*nx + ly*ny + lz*nz);\r\n    }\r\n  }\r\n\r\n  let mul = ((lx**2 + ly**2)*nz**2 + (lx*nx + ly*ny)**2)/((lx**2 + ly**2)*nz**2);\r\n  //let mul = ((lx**2+ly**2)*nz**2+(lx*nx+ly*ny)**2)/((ly**2+lz**2+lx**2)*nz**2);\r\n\r\n  //mul = 1.0 / nz;\r\n  //mul *= mul;\r\n\r\n  if (Math.random() > 0.999) {\r\n    console.log(mul.toFixed(4));\r\n  }\r\n\r\n  //mul = 1.0;\r\n\r\n  if (0) {\r\n    let odis = dis;\r\n\r\n    dis = x1**2 + y1**2 + z1**2;\r\n\r\n    if (Math.random() > 0.999) {\r\n      console.log((dis/odis).toFixed(4), mul.toFixed(4));\r\n    }\r\n    mul = 1.0;\r\n  }\r\n\r\n  /*\r\n  on factor;\r\n\r\n  dx := sqrt(dis)*(lx / sqrt(lx**2 + ly**2));\r\n  dy := sqrt(dis)*(ly / sqrt(lx**2 + ly**2));\r\n  f2 := dx*nx + dy*ny + dz*nz;\r\n\r\n  fz := solve(f2, dz);\r\n  fz := part(fz, 1, 2);\r\n\r\n  dis2 := dx*dx + dy*dy + fz*fz;\r\n  fmul := dis2/dis;\r\n\r\n  on fort;\r\n  fmul;\r\n  off fort;\r\n\r\n\r\n  */\r\n\r\n  return dis*mul + planedis*planedis;\r\n}\r\n\r\nlet tri_area_temps = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport function tri_area(v1, v2, v3) {\r\n  let l1 = v1.vectorDistance(v2);\r\n  let l2 = v2.vectorDistance(v3);\r\n  let l3 = v3.vectorDistance(v1);\r\n\r\n  let s = (l1 + l2 + l3)/2.0;\r\n  s = s*(s - l1)*(s - l2)*(s - l3);\r\n  s = Math.max(s, 0); /* Numerical error can dip into negative numbers. */\r\n  return Math.sqrt(s);\r\n}\r\n\r\nexport function aabb_overlap_area(pos1, size1, pos2, size2) {\r\n  let r1 = 0.0, r2 = 0.0;\r\n\r\n  for (let i = 0; i < 2; i++) {\r\n    let a1 = pos1[i], a2 = pos2[i];\r\n    let b1 = pos1[i] + size1[i];\r\n    let b2 = pos2[i] + size2[i];\r\n\r\n    if (b1 >= a2 && b2 >= a1) {\r\n      let r = Math.abs(a2 - b1);\r\n      r = Math.min(r, Math.abs(a1 - b2));\r\n\r\n      if (i) {\r\n        r2 = r;\r\n      } else {\r\n        r1 = r;\r\n      }\r\n    }\r\n  }\r\n\r\n  return r1*r2;\r\n}\r\n\r\n/**\r\n * Returns true if two aabbs intersect\r\n * @param {*} pos1\r\n * @param {*} size1\r\n * @param {*} pos2\r\n * @param {*} size2\r\n */\r\n\r\nexport function aabb_isect_2d(pos1, size1, pos2, size2) {\r\n  let ret = 0;\r\n  for (let i = 0; i < 2; i++) {\r\n    let a = pos1[i];\r\n    let b = pos1[i] + size1[i];\r\n    let c = pos2[i];\r\n    let d = pos2[i] + size2[i];\r\n    if (b >= c && a <= d)\r\n      ret += 1;\r\n  }\r\n  return ret === 2;\r\n};\r\n\r\n\r\nexport function aabb_isect_3d(pos1, size1, pos2, size2) {\r\n  let ret = 0;\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    let a = pos1[i];\r\n    let b = pos1[i] + size1[i];\r\n\r\n    let c = pos2[i];\r\n    let d = pos2[i] + size2[i];\r\n\r\n    if (b >= c && a <= d)\r\n      ret += 1;\r\n  }\r\n  return ret === 3;\r\n}\r\n\r\n\r\nlet aabb_intersect_vs = util.cachering.fromConstructor(Vector2, 32);\r\nlet aabb_intersect_rets = new util.cachering(() => {\r\n  return {\r\n    pos : new Vector2(),\r\n    size: new Vector2()\r\n  }\r\n}, 512);\r\n\r\n/**\r\n * Returns aabb that's the intersection of two aabbs\r\n * @param {*} pos1\r\n * @param {*} size1\r\n * @param {*} pos2\r\n * @param {*} size2\r\n */\r\nexport function aabb_intersect_2d(pos1, size1, pos2, size2) {\r\n  let v1 = aabb_intersect_vs.next().load(pos1);\r\n  let v2 = aabb_intersect_vs.next().load(pos1).add(size1);\r\n  let v3 = aabb_intersect_vs.next().load(pos2);\r\n  let v4 = aabb_intersect_vs.next().load(pos2).add(size2);\r\n\r\n  let min = aabb_intersect_vs.next().zero();\r\n  let max = aabb_intersect_vs.next().zero();\r\n\r\n  let tot = 0;\r\n\r\n  for (let i = 0; i < 2; i++) {\r\n    if (v2[i] >= v3[i] && v1[i] <= v4[i]) {\r\n      tot++;\r\n\r\n      min[i] = Math.max(v3[i], v1[i]);\r\n      max[i] = Math.min(v2[i], v4[i]);\r\n    }\r\n  }\r\n\r\n  if (tot !== 2) {\r\n    return undefined;\r\n  }\r\n\r\n  let ret = aabb_intersect_rets.next();\r\n  ret.pos.load(min);\r\n  ret.size.load(max).sub(min);\r\n\r\n  return ret;\r\n}\r\n\r\nwindow.test_aabb_intersect_2d = function () {\r\n  let canvas = document.getElementById(\"test_canvas\");\r\n\r\n  if (!canvas) {\r\n    canvas = document.createElement(\"canvas\");\r\n    canvas.setAttribute(\"id\", \"test_canvas\");\r\n    canvas.g = canvas.getContext(\"2d\");\r\n\r\n    document.body.appendChild(canvas);\r\n  }\r\n\r\n  canvas.width = ~~(window.innerWidth*devicePixelRatio);\r\n  canvas.height = ~~(window.innerHeight*devicePixelRatio);\r\n  canvas.style.width = (canvas.width/devicePixelRatio) + \"px\";\r\n  canvas.style.height = (canvas.height/devicePixelRatio) + \"px\";\r\n  canvas.style.position = \"absolute\";\r\n  canvas.style[\"z-index\"] = \"1000\";\r\n\r\n  let g = canvas.g;\r\n  g.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n  let sz = 800;\r\n  let a1 = new Vector2([Math.random()*sz, Math.random()*sz]).floor();\r\n  let a2 = new Vector2([Math.random()*sz, Math.random()*sz]).floor();\r\n  let b1 = new Vector2([Math.random()*sz, Math.random()*sz]).floor();\r\n  let b2 = new Vector2([Math.random()*sz, Math.random()*sz]).floor();\r\n\r\n  let p1 = new Vector2();\r\n  let s1 = new Vector2();\r\n  let p2 = new Vector2();\r\n  let s2 = new Vector2();\r\n\r\n  p1.load(a1).min(a2);\r\n  s1.load(a1).max(a2);\r\n  p2.load(b1).min(b2);\r\n  s2.load(b1).max(b2);\r\n\r\n  s1.sub(p1);\r\n  s2.sub(p1);\r\n\r\n  console.log(p1, s1);\r\n  console.log(p2, s2);\r\n\r\n  g.beginPath();\r\n  g.rect(0, 0, canvas.width, canvas.height);\r\n  g.fillStyle = \"white\";\r\n  g.fill();\r\n\r\n  g.beginPath();\r\n  g.rect(p1[0], p1[1], s1[0], s1[1]);\r\n  g.fillStyle = \"rgba(255, 100, 75, 1.0)\";\r\n  g.fill();\r\n\r\n  g.beginPath();\r\n  g.rect(p2[0], p2[1], s2[0], s2[1]);\r\n  g.fillStyle = \"rgba(75, 100, 255, 1.0)\";\r\n  g.fill();\r\n\r\n  let ret = aabb_intersect_2d(p1, s1, p2, s2);\r\n\r\n  if (ret) {\r\n\r\n    g.beginPath();\r\n    g.rect(ret.pos[0], ret.pos[1], ret.size[0], ret.size[1]);\r\n    g.fillStyle = \"rgba(0, 0, 0, 1.0)\";\r\n    g.fill();\r\n  }\r\n\r\n  /*\r\n  window.setTimeout(() => {\r\n    canvas.remove();\r\n  }, 2000);\r\n  //*/\r\n\r\n  return {\r\n    end  : test_aabb_intersect_2d.end,\r\n    timer: test_aabb_intersect_2d.timer\r\n  };\r\n}\r\n\r\ntest_aabb_intersect_2d.stop = function stop() {\r\n  if (test_aabb_intersect_2d._timer) {\r\n    console.log(\"stopping timer\");\r\n\r\n    window.clearInterval(test_aabb_intersect_2d._timer);\r\n    test_aabb_intersect_2d._timer = undefined;\r\n  }\r\n}\r\n\r\ntest_aabb_intersect_2d.end = function end() {\r\n  test_aabb_intersect_2d.stop();\r\n\r\n  let canvas = document.getElementById(\"test_canvas\");\r\n  if (canvas) {\r\n    canvas.remove();\r\n  }\r\n}\r\ntest_aabb_intersect_2d.timer = function timer(rate = 500) {\r\n  if (test_aabb_intersect_2d._timer) {\r\n    window.clearInterval(test_aabb_intersect_2d._timer);\r\n    test_aabb_intersect_2d._timer = undefined;\r\n    console.log(\"stopping timer\");\r\n    return;\r\n  }\r\n\r\n  console.log(\"starting timer\");\r\n\r\n  test_aabb_intersect_2d._timer = window.setInterval(() => {\r\n    test_aabb_intersect_2d();\r\n  }, rate);\r\n};\r\n\r\nlet aabb_intersect_vs3 = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport function aabb_intersect_3d(min1, max1, min2, max2) {\r\n  let tot = 0;\r\n\r\n  for (let i = 0; i < 2; i++) {\r\n    if (max1[i] >= min2[i] && min1[i] <= max2[i]) {\r\n      tot++;\r\n    }\r\n  }\r\n\r\n  if (tot !== 3) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n/**\r\n * AABB union of a and b.\r\n * Result is in a.\r\n *\r\n * @param a List of two vectors\r\n * @param b List of two vectors\r\n * @returns a\r\n */\r\nexport function aabb_union(a, b) {\r\n  for (let i = 0; i < 2; i++) {\r\n    for (let j = 0; j < a[i].length; j++) {\r\n      a[i][j] = i ? Math.max(a[i][j], b[i][j]) : Math.min(a[i][j], b[i][j]);\r\n    }\r\n  }\r\n\r\n  return a;\r\n}\r\n\r\nexport function aabb_union_2d(pos1, size1, pos2, size2) {\r\n  let v1 = aabb_intersect_vs.next();\r\n  let v2 = aabb_intersect_vs.next();\r\n  let min = aabb_intersect_vs.next();\r\n  let max = aabb_intersect_vs.next();\r\n  v1.load(pos1).add(size1);\r\n  v2.load(pos2).add(size2);\r\n\r\n  min.load(v1).min(v2);\r\n  max.load(v1).max(v2);\r\n\r\n  max.sub(min);\r\n  let ret = aabb_intersect_rets.next();\r\n\r\n  ret.pos.load(min);\r\n  ret.pos.load(max);\r\n\r\n  return ret;\r\n}\r\n\r\n//XXX refactor to use es6 classes,\r\n//    or at last the class system in typesystem.js\r\nfunction init_prototype(cls, proto) {\r\n  for (let k in proto) {\r\n    cls.prototype[k] = proto[k];\r\n  }\r\n\r\n  return cls.prototype;\r\n}\r\n\r\nfunction inherit(cls, parent, proto) {\r\n  cls.prototype = Object.create(parent.prototype);\r\n\r\n  for (let k in proto) {\r\n    cls.prototype[k] = proto[k];\r\n  }\r\n\r\n  return cls.prototype;\r\n}\r\n\r\nlet set = util.set;\r\n\r\n//everything below here was compiled from es6 code  \r\n//variables starting with $ are function static local vars,\r\n//like in C.  don't use them outside their owning functions.\r\n//\r\n//except for $_mh and $_swapt.  they were used with a C macro\r\n//preprocessor.\r\nlet $_mh, $_swapt;\r\n\r\n//XXX destroy me\r\nexport const feps = 2.22e-16;\r\n\r\nexport const COLINEAR = 1;\r\nexport const LINECROSS = 2;\r\nexport const COLINEAR_ISECT = 3;\r\n\r\nlet _cross_vec1 = new Vector3();\r\nlet _cross_vec2 = new Vector3();\r\n\r\nexport const SQRT2 = Math.sqrt(2.0);\r\nexport const FEPS_DATA = {\r\n  F16: 1.11e-16,\r\n  F32: 5.96e-08,\r\n  F64: 4.88e-04\r\n};\r\n\r\n/*use 32 bit epsilon by default, since we're often working from\r\n  32-bit float data.  note that javascript uses 64-bit doubles \r\n  internally.*/\r\nexport const FEPS = FEPS_DATA.F32;\r\nexport const FLOAT_MIN = -1e+21;\r\nexport const FLOAT_MAX = 1e+22;\r\nexport const Matrix4UI = Matrix4;\r\n\r\n/*\r\nThis must be truly ancient code, possibly from\r\nallshape days.\r\n\r\nif (FLOAT_MIN != FLOAT_MIN || FLOAT_MAX != FLOAT_MAX) {\r\n  FLOAT_MIN = 1e-05;\r\n  FLOAT_MAX = 1000000.0;\r\n  console.log(\"Floating-point 16-bit system detected!\");\r\n}\r\n*/\r\n\r\nlet _static_grp_points4 = new Array(4);\r\nlet _static_grp_points8 = new Array(8);\r\n\r\nexport function get_rect_points(p, size) {\r\n  let cs;\r\n  if (p.length === 2) {\r\n    cs = _static_grp_points4;\r\n    cs[0] = p;\r\n    cs[1] = [p[0] + size[0], p[1]];\r\n    cs[2] = [p[0] + size[0], p[1] + size[1]];\r\n    cs[3] = [p[0], p[1] + size[1]];\r\n  } else if (p.length === 3) {\r\n    cs = _static_grp_points8;\r\n    cs[0] = p;\r\n    cs[1] = [p[0] + size[0], p[1], p[2]];\r\n    cs[2] = [p[0] + size[0], p[1] + size[1], p[2]];\r\n    cs[3] = [p[0], p[1] + size[0], p[2]];\r\n    cs[4] = [p[0], p[1], p[2] + size[2]];\r\n    cs[5] = [p[0] + size[0], p[1], p[2] + size[2]];\r\n    cs[6] = [p[0] + size[0], p[1] + size[1], p[2] + size[2]];\r\n    cs[7] = [p[0], p[1] + size[0], p[2] + size[2]];\r\n  } else {\r\n    throw \"get_rect_points has no implementation for \" + p.length + \"-dimensional data\";\r\n  }\r\n  return cs;\r\n};\r\n\r\nexport function get_rect_lines(p, size) {\r\n  let ps = get_rect_points(p, size);\r\n  if (p.length === 2) {\r\n    return [[ps[0], ps[1]], [ps[1], ps[2]], [ps[2], ps[3]], [ps[3], ps[0]]];\r\n  } else if (p.length === 3) {\r\n    let l1 = [[ps[0], ps[1]], [ps[1], ps[2]], [ps[2], ps[3]], [ps[3], ps[0]]];\r\n    let l2 = [[ps[4], ps[5]], [ps[5], ps[6]], [ps[6], ps[7]], [ps[7], ps[4]]];\r\n    l1.concat(l2);\r\n    l1.push([ps[0], ps[4]]);\r\n    l1.push([ps[1], ps[5]]);\r\n    l1.push([ps[2], ps[6]]);\r\n    l1.push([ps[3], ps[7]]);\r\n    return l1;\r\n  } else {\r\n    throw \"get_rect_points has no implementation for \" + p.length + \"-dimensional data\";\r\n  }\r\n};\r\n\r\nlet $vs_simple_tri_aabb_isect = [0, 0, 0];\r\n\r\nexport function simple_tri_aabb_isect(v1, v2, v3, min, max) {\r\n  $vs_simple_tri_aabb_isect[0] = v1;\r\n  $vs_simple_tri_aabb_isect[1] = v2;\r\n  $vs_simple_tri_aabb_isect[2] = v3;\r\n  for (let i = 0; i < 3; i++) {\r\n    let isect = true;\r\n    for (let j = 0; j < 3; j++) {\r\n      if ($vs_simple_tri_aabb_isect[j][i] < min[i] || $vs_simple_tri_aabb_isect[j][i] >= max[i])\r\n        isect = false;\r\n    }\r\n    if (isect)\r\n      return true;\r\n  }\r\n  return false;\r\n};\r\n\r\nexport class MinMax {\r\n  constructor(totaxis) {\r\n    if (totaxis === undefined) {\r\n      totaxis = 1;\r\n    }\r\n    this.totaxis = totaxis;\r\n    if (totaxis !== 1) {\r\n      let cls;\r\n\r\n      switch (totaxis) {\r\n        case 2:\r\n          cls = Vector2;\r\n          break;\r\n        case 3:\r\n          cls = Vector3;\r\n          break;\r\n        case 4:\r\n          cls = Vector4;\r\n          break;\r\n        default:\r\n          cls = Array;\r\n          break;\r\n      }\r\n\r\n      this._min = new cls(totaxis);\r\n      this._max = new cls(totaxis);\r\n      this.min = new cls(totaxis);\r\n      this.max = new cls(totaxis);\r\n    } else {\r\n      this.min = this.max = 0;\r\n      this._min = FLOAT_MAX;\r\n      this._max = FLOAT_MIN;\r\n    }\r\n    this.reset();\r\n    this._static_mr_co = new Array(this.totaxis);\r\n    this._static_mr_cs = new Array(this.totaxis*this.totaxis);\r\n  }\r\n\r\n  static fromSTRUCT(reader) {\r\n    let ret = new MinMax();\r\n    reader(ret);\r\n    return ret;\r\n  }\r\n\r\n  load(mm) {\r\n    if (this.totaxis === 1) {\r\n      this.min = mm.min;\r\n      this.max = mm.max;\r\n      this._min = mm.min;\r\n      this._max = mm.max;\r\n    } else {\r\n      this.min = new Vector3(mm.min);\r\n      this.max = new Vector3(mm.max);\r\n      this._min = new Vector3(mm._min);\r\n      this._max = new Vector3(mm._max);\r\n    }\r\n  }\r\n\r\n  reset() {\r\n    let totaxis = this.totaxis;\r\n    if (totaxis === 1) {\r\n      this.min = this.max = 0;\r\n      this._min = FLOAT_MAX;\r\n      this._max = FLOAT_MIN;\r\n    } else {\r\n      for (let i = 0; i < totaxis; i++) {\r\n        this._min[i] = FLOAT_MAX;\r\n        this._max[i] = FLOAT_MIN;\r\n        this.min[i] = 0;\r\n        this.max[i] = 0;\r\n      }\r\n    }\r\n  }\r\n\r\n  minmax_rect(p, size) {\r\n    let totaxis = this.totaxis;\r\n    let cs = this._static_mr_cs;\r\n    if (totaxis === 2) {\r\n      cs[0] = p;\r\n      cs[1] = [p[0] + size[0], p[1]];\r\n      cs[2] = [p[0] + size[0], p[1] + size[1]];\r\n      cs[3] = [p[0], p[1] + size[1]];\r\n    } else if (totaxis = 3) {\r\n      cs[0] = p;\r\n      cs[1] = [p[0] + size[0], p[1], p[2]];\r\n      cs[2] = [p[0] + size[0], p[1] + size[1], p[2]];\r\n      cs[3] = [p[0], p[1] + size[0], p[2]];\r\n      cs[4] = [p[0], p[1], p[2] + size[2]];\r\n      cs[5] = [p[0] + size[0], p[1], p[2] + size[2]];\r\n      cs[6] = [p[0] + size[0], p[1] + size[1], p[2] + size[2]];\r\n      cs[7] = [p[0], p[1] + size[0], p[2] + size[2]];\r\n    } else {\r\n      throw \"Minmax.minmax_rect has no implementation for \" + totaxis + \"-dimensional data\";\r\n    }\r\n    for (let i = 0; i < cs.length; i++) {\r\n      this.minmax(cs[i]);\r\n    }\r\n  }\r\n\r\n  minmax(p) {\r\n    let totaxis = this.totaxis;\r\n\r\n    if (totaxis === 1) {\r\n      this._min = this.min = Math.min(this._min, p);\r\n      this._max = this.max = Math.max(this._max, p);\r\n    } else if (totaxis === 2) {\r\n      this._min[0] = this.min[0] = Math.min(this._min[0], p[0]);\r\n      this._min[1] = this.min[1] = Math.min(this._min[1], p[1]);\r\n      this._max[0] = this.max[0] = Math.max(this._max[0], p[0]);\r\n      this._max[1] = this.max[1] = Math.max(this._max[1], p[1]);\r\n    } else if (totaxis === 3) {\r\n      this._min[0] = this.min[0] = Math.min(this._min[0], p[0]);\r\n      this._min[1] = this.min[1] = Math.min(this._min[1], p[1]);\r\n      this._min[2] = this.min[2] = Math.min(this._min[2], p[2]);\r\n      this._max[0] = this.max[0] = Math.max(this._max[0], p[0]);\r\n      this._max[1] = this.max[1] = Math.max(this._max[1], p[1]);\r\n      this._max[2] = this.max[2] = Math.max(this._max[2], p[2]);\r\n    } else {\r\n      for (let i = 0; i < totaxis; i++) {\r\n        this._min[i] = this.min[i] = Math.min(this._min[i], p[i]);\r\n        this._max[i] = this.max[i] = Math.max(this._max[i], p[i]);\r\n      }\r\n    }\r\n  }\r\n};\r\nMinMax.STRUCT = \"\\n  math.MinMax {\\n    min     : vec3;\\n    max     : vec3;\\n    _min    : vec3;\\n    _max    : vec3;\\n    totaxis : int;\\n  }\\n\";\r\n\r\nexport function winding_axis(a, b, c, up_axis) {\r\n  let xaxis = (up_axis + 1)%3;\r\n  let yaxis = (up_axis + 2)%3;\r\n\r\n  let x1 = a[xaxis], y1 = a[yaxis];\r\n  let x2 = b[xaxis], y2 = b[yaxis];\r\n  let x3 = c[xaxis], y3 = c[yaxis];\r\n\r\n  let dx1 = x1 - x2, dy1 = y1 - y2;\r\n  let dx2 = x3 - x2, dy2 = y3 - y2;\r\n\r\n  let f = dx1*dy2 - dy1*dx2;\r\n  return f >= 0.0;\r\n}\r\n\r\nexport function winding(a, b, c, zero_z = false, tol = 0.0) {\r\n  let t1 = _cross_vec1;\r\n  let t2 = _cross_vec2;\r\n\r\n  for (let i = 0; i < a.length; i++) {\r\n    t1[i] = b[i] - a[i];\r\n    t2[i] = c[i] - a[i];\r\n  }\r\n\r\n  return t1[0]*t2[1] - t1[1]*t2[0] > tol;\r\n  /*\r\n  t1.load(a).sub(b);\r\n  t2.load(c).sub(b);\r\n  return t[0]*\r\n  \r\n  for (let i=0; i<a.length; i++) {\r\n      _cross_vec1[i] = b[i]-a[i];\r\n      _cross_vec2[i] = c[i]-a[i];\r\n  }\r\n  if (a.length==2 || zero_z) {\r\n      _cross_vec1[2] = 0.0;\r\n      _cross_vec2[2] = 0.0;\r\n  }\r\n  _cross_vec1.cross(_cross_vec2);\r\n  return _cross_vec1[2]>tol;\r\n*/\r\n}\r\n\r\nexport function inrect_2d(p, pos, size) {\r\n  if (p === undefined || pos === undefined || size === undefined) {\r\n    console.trace();\r\n    console.log(\"Bad paramters to inrect_2d()\");\r\n    console.log(\"p: \", p, \", pos: \", pos, \", size: \", size);\r\n    return false;\r\n  }\r\n  return p[0] >= pos[0] && p[0] <= pos[0] + size[0] && p[1] >= pos[1] && p[1] <= pos[1] + size[1];\r\n};\r\nlet $smin_aabb_isect_line_2d = new Vector2();\r\nlet $ssize_aabb_isect_line_2d = new Vector2();\r\nlet $sv1_aabb_isect_line_2d = new Vector2();\r\nlet $ps_aabb_isect_line_2d = [new Vector2(), new Vector2(), new Vector2()];\r\nlet $l1_aabb_isect_line_2d = [0, 0];\r\nlet $smax_aabb_isect_line_2d = new Vector2();\r\nlet $sv2_aabb_isect_line_2d = new Vector2();\r\nlet $l2_aabb_isect_line_2d = [0, 0];\r\n\r\nexport function aabb_isect_line_2d(v1, v2, min, max) {\r\n  for (let i = 0; i < 2; i++) {\r\n    $smin_aabb_isect_line_2d[i] = Math.min(min[i], v1[i]);\r\n    $smax_aabb_isect_line_2d[i] = Math.max(max[i], v2[i]);\r\n  }\r\n  $smax_aabb_isect_line_2d.sub($smin_aabb_isect_line_2d);\r\n  $ssize_aabb_isect_line_2d.load(max).sub(min);\r\n  if (!aabb_isect_2d($smin_aabb_isect_line_2d, $smax_aabb_isect_line_2d, min, $ssize_aabb_isect_line_2d))\r\n    return false;\r\n  for (let i = 0; i < 4; i++) {\r\n    if (inrect_2d(v1, min, $ssize_aabb_isect_line_2d))\r\n      return true;\r\n    if (inrect_2d(v2, min, $ssize_aabb_isect_line_2d))\r\n      return true;\r\n  }\r\n  $ps_aabb_isect_line_2d[0] = min;\r\n  $ps_aabb_isect_line_2d[1][0] = min[0];\r\n  $ps_aabb_isect_line_2d[1][1] = max[1];\r\n  $ps_aabb_isect_line_2d[2] = max;\r\n  $ps_aabb_isect_line_2d[3][0] = max[0];\r\n  $ps_aabb_isect_line_2d[3][1] = min[1];\r\n  $l1_aabb_isect_line_2d[0] = v1;\r\n  $l1_aabb_isect_line_2d[1] = v2;\r\n  for (let i = 0; i < 4; i++) {\r\n    let a = $ps_aabb_isect_line_2d[i], b = $ps_aabb_isect_line_2d[(i + 1)%4];\r\n    $l2_aabb_isect_line_2d[0] = a;\r\n    $l2_aabb_isect_line_2d[1] = b;\r\n    if (line_line_cross($l1_aabb_isect_line_2d, $l2_aabb_isect_line_2d))\r\n      return true;\r\n  }\r\n  return false;\r\n};\r\n\r\n\r\nexport function expand_rect2d(pos, size, margin) {\r\n  pos[0] -= Math.floor(margin[0]);\r\n  pos[1] -= Math.floor(margin[1]);\r\n  size[0] += Math.floor(margin[0]*2.0);\r\n  size[1] += Math.floor(margin[1]*2.0);\r\n};\r\n\r\nexport function expand_line(l, margin) {\r\n  let c = new Vector3();\r\n  c.add(l[0]);\r\n  c.add(l[1]);\r\n  c.mulScalar(0.5);\r\n  l[0].sub(c);\r\n  l[1].sub(c);\r\n  let l1 = l[0].vectorLength();\r\n  let l2 = l[1].vectorLength();\r\n  l[0].normalize();\r\n  l[1].normalize();\r\n  l[0].mulScalar(margin + l1);\r\n  l[1].mulScalar(margin + l2);\r\n  l[0].add(c);\r\n  l[1].add(c);\r\n  return l;\r\n};\r\n\r\n//stupidly ancient function, todo: rewrite\r\nexport function colinear(a, b, c, limit = 2.2e-16) {\r\n  for (let i = 0; i < 3; i++) {\r\n    _cross_vec1[i] = b[i] - a[i];\r\n    _cross_vec2[i] = c[i] - a[i];\r\n  }\r\n\r\n  if (a.vectorDistance(b) < feps*100 && a.vectorDistance(c) < feps*100) {\r\n    return true;\r\n  }\r\n  if (_cross_vec1.dot(_cross_vec1) < limit || _cross_vec2.dot(_cross_vec2) < limit)\r\n    return true;\r\n  _cross_vec1.cross(_cross_vec2);\r\n  return _cross_vec1.dot(_cross_vec1) < limit;\r\n};\r\n\r\nlet _llc_l1 = [new Vector3(), new Vector3()];\r\nlet _llc_l2 = [new Vector3(), new Vector3()];\r\nlet _llc_l3 = [new Vector3(), new Vector3()];\r\nlet _llc_l4 = [new Vector3(), new Vector3()];\r\n\r\nlet lli_v1 = new Vector3(), lli_v2 = new Vector3(), lli_v3 = new Vector3(), lli_v4 = new Vector3();\r\n\r\nlet _zero_cn = new Vector3();\r\nlet _tmps_cn = util.cachering.fromConstructor(Vector3, 64);\r\nlet _rets_cn = util.cachering.fromConstructor(Vector3, 64);\r\n\r\n//vec1, vec2 should both be normalized\r\nexport function corner_normal(vec1, vec2, width) {\r\n  let ret = _rets_cn.next().zero();\r\n\r\n  let vec = _tmps_cn.next().zero();\r\n  vec.load(vec1).add(vec2).normalize();\r\n\r\n  /*\r\n  ret.load(vec).mulScalar(width);\r\n  return ret;\r\n  */\r\n\r\n  //handle colinear case\r\n  if (Math.abs(vec1.normalizedDot(vec2)) > 0.9999) {\r\n    if (vec1.dot(vec2) > 0.0001) {\r\n      ret.load(vec1).add(vec2).normalize();\r\n    } else {\r\n      ret.load(vec1).normalize();\r\n    }\r\n\r\n    ret.mulScalar(width);\r\n\r\n    return ret;\r\n  } else { //XXX\r\n    //ret.load(vec).mulScalar(width);\r\n    //return ret;\r\n  }\r\n\r\n  vec1 = _tmps_cn.next().load(vec1).mulScalar(width);\r\n  vec2 = _tmps_cn.next().load(vec2).mulScalar(width);\r\n\r\n  let p1 = _tmps_cn.next().load(vec1);\r\n  let p2 = _tmps_cn.next().load(vec2);\r\n\r\n  vec1.addFac(vec1, 0.01);\r\n  vec2.addFac(vec2, 0.01);\r\n\r\n  let sc = 1.0;\r\n\r\n  p1[0] += vec1[1]*sc;\r\n  p1[1] += -vec1[0]*sc;\r\n\r\n  p2[0] += -vec2[1]*sc;\r\n  p2[1] += vec2[0]*sc;\r\n\r\n  let p = line_line_isect(vec1, p1, vec2, p2, false);\r\n\r\n  if (p === undefined || p === COLINEAR_ISECT || p.dot(p) < 0.000001) {\r\n    ret.load(vec1).add(vec2).normalize().mulScalar(width);\r\n  } else {\r\n    ret.load(p);\r\n\r\n    if (vec.dot(vec) > 0 && vec.dot(ret) < 0) {\r\n      ret.load(vec).mulScalar(width);\r\n    }\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n//test_segment is optional, true\r\nexport function line_line_isect(v1, v2, v3, v4, test_segment = true) {\r\n  if (test_segment && !line_line_cross(v1, v2, v3, v4)) {\r\n    return undefined;\r\n  }\r\n\r\n  /*\r\n  on factor;\r\n  off period;\r\n  \r\n  xa := xa1 + (xa2 - xa1)*t1;\r\n  xb := xb1 + (xb2 - xb1)*t2;\r\n  ya := ya1 + (ya2 - ya1)*t1;\r\n  yb := yb1 + (yb2 - yb1)*t2;\r\n  \r\n  f1 := xa - xb;\r\n  f2 := ya - yb;\r\n  \r\n  f := solve({f1, f2}, {t1, t2});\r\n  ft1 := part(f, 1, 1, 2);\r\n  ft2 := part(f, 1, 2, 2);\r\n  \r\n  */\r\n\r\n  let xa1 = v1[0], xa2 = v2[0], ya1 = v1[1], ya2 = v2[1];\r\n  let xb1 = v3[0], xb2 = v4[0], yb1 = v3[1], yb2 = v4[1];\r\n\r\n  let div = ((xa1 - xa2)*(yb1 - yb2) - (xb1 - xb2)*(ya1 - ya2));\r\n  if (div < 0.00000001) { //parallel but intersecting lines.\r\n    return COLINEAR_ISECT;\r\n  } else { //intersection exists\r\n    let t1 = (-((ya1 - yb2)*xb1 - (yb1 - yb2)*xa1 - (ya1 - yb1)*xb2))/div;\r\n\r\n    return lli_v1.load(v1).interp(v2, t1);\r\n  }\r\n}\r\n\r\nexport function line_line_cross(a, b, c, d) {\r\n  /*\r\n  let limit=feps*1000;\r\n  if (Math.abs(l1[0].vectorDistance(l2[0])+l1[1].vectorDistance(l2[0])-l1[0].vectorDistance(l1[1]))<limit) {\r\n      return true;\r\n  }\r\n  if (Math.abs(l1[0].vectorDistance(l2[1])+l1[1].vectorDistance(l2[1])-l1[0].vectorDistance(l1[1]))<limit) {\r\n      return true;\r\n  }\r\n  if (Math.abs(l2[0].vectorDistance(l1[0])+l2[1].vectorDistance(l1[0])-l2[0].vectorDistance(l2[1]))<limit) {\r\n      return true;\r\n  }\r\n  if (Math.abs(l2[0].vectorDistance(l1[1])+l2[1].vectorDistance(l1[1])-l2[0].vectorDistance(l2[1]))<limit) {\r\n      return true;\r\n  }\r\n  //*/\r\n\r\n  let w1 = winding(a, b, c);\r\n  let w2 = winding(c, a, d);\r\n  let w3 = winding(a, b, d);\r\n  let w4 = winding(c, b, d);\r\n  return (w1 === w2) && (w3 === w4) && (w1 !== w3);\r\n};\r\n\r\nlet _asi_v1 = new Vector3();\r\nlet _asi_v2 = new Vector3();\r\nlet _asi_v3 = new Vector3();\r\nlet _asi_v4 = new Vector3();\r\nlet _asi_v5 = new Vector3();\r\nlet _asi_v6 = new Vector3();\r\n\r\nexport function point_in_aabb_2d(p, min, max) {\r\n  return p[0] >= min[0] && p[0] <= max[0] && p[1] >= min[1] && p[1] <= max[1];\r\n}\r\n\r\nlet _asi2d_v1 = new Vector2();\r\nlet _asi2d_v2 = new Vector2();\r\nlet _asi2d_v3 = new Vector2();\r\nlet _asi2d_v4 = new Vector2();\r\nlet _asi2d_v5 = new Vector2();\r\nlet _asi2d_v6 = new Vector2();\r\n\r\nexport function aabb_sphere_isect_2d(p, r, min, max) {\r\n  let v1 = _asi2d_v1, v2 = _asi2d_v2, v3 = _asi2d_v3, mvec = _asi2d_v4;\r\n  let v4 = _asi2d_v5;\r\n\r\n  p = _asi2d_v6.load(p);\r\n  v1.load(p);\r\n  v2.load(p);\r\n\r\n  min = _asi_v5.load(min);\r\n  max = _asi_v6.load(max);\r\n\r\n  mvec.load(max).sub(min).normalize().mulScalar(r + 0.0001);\r\n\r\n  v1.sub(mvec);\r\n  v2.add(mvec);\r\n  v3.load(p);\r\n\r\n  let ret = point_in_aabb_2d(v1, min, max) || point_in_aabb_2d(v2, min, max)\r\n    || point_in_aabb_2d(v3, min, max);\r\n\r\n  if (ret)\r\n    return ret;\r\n\r\n  /*\r\n  v1.load(min).add(max).mulScalar(0.5);\r\n  ret = ret || v1.vectorDistance(p) < r;\r\n  \r\n  v1.load(min);\r\n  ret = ret || v1.vectorDistance(p) < r;\r\n  \r\n  v1.load(max);\r\n  ret = ret || v1.vectorDistance(p) < r;\r\n  \r\n  v1[0] = min[0], v1[1] = max[1];\r\n  ret = ret || v1.vectorDistance(p) < r;\r\n  \r\n  v1[0] = max[0], v1[1] = min[1];\r\n  ret = ret || v1.vectorDistance(p) < r;\r\n  */\r\n  //*\r\n  v1.load(min);\r\n  v2[0] = min[0];\r\n  v2[1] = max[1];\r\n  ret = ret || dist_to_line_2d(p, v1, v2) < r;\r\n\r\n  v1.load(max);\r\n  v2[0] = max[0];\r\n  v2[1] = max[1];\r\n  ret = ret || dist_to_line_2d(p, v1, v2) < r;\r\n\r\n  v1.load(max);\r\n  v2[0] = max[0];\r\n  v2[1] = min[1];\r\n  ret = ret || dist_to_line_2d(p, v1, v2) < r;\r\n\r\n  v1.load(max);\r\n  v2[0] = min[0];\r\n  v2[1] = min[1];\r\n  ret = ret || dist_to_line_2d(p, v1, v2) < r;\r\n  //*/\r\n  return ret;\r\n};\r\n\r\nexport function point_in_aabb(p, min, max) {\r\n  return p[0] >= min[0] && p[0] <= max[0] && p[1] >= min[1] && p[1] <= max[1]\r\n    && p[2] >= min[2] && p[2] <= max[2];\r\n}\r\n\r\nlet asi_rect = new Array(8);\r\nfor (let i = 0; i < 8; i++) {\r\n  asi_rect[i] = new Vector3();\r\n}\r\n\r\nlet aabb_sphere_isect_vs = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport function aabb_sphere_isect(p, r, min, max) {\r\n  {\r\n    let p1 = aabb_sphere_isect_vs.next().load(p);\r\n    let min1 = aabb_sphere_isect_vs.next().load(min);\r\n    let max1 = aabb_sphere_isect_vs.next().load(max);\r\n    if (p.length === 2) {\r\n      p1[2] = 0.0;\r\n    }\r\n    if (min1.length === 2) {\r\n      min1[2] = 0.0;\r\n    }\r\n    if (max.length === 2) {\r\n      max1[2] = 0.0;\r\n    }\r\n\r\n    p = p1;\r\n    min = min1;\r\n    max = max1;\r\n  }\r\n\r\n  let cent = aabb_sphere_isect_vs.next().load(min).interp(max, 0.5);\r\n  p.sub(cent);\r\n  min.sub(cent);\r\n  max.sub(cent);\r\n\r\n  r *= r;\r\n\r\n  let isect = point_in_aabb(p, min, max);\r\n\r\n  if (isect) {\r\n    return true;\r\n  }\r\n\r\n  let rect = asi_rect;\r\n\r\n  rect[0].loadXYZ(min[0], min[1], min[2]);\r\n  rect[1].loadXYZ(min[0], max[1], min[2]);\r\n  rect[2].loadXYZ(max[0], max[1], min[2]);\r\n  rect[3].loadXYZ(max[0], min[1], min[2]);\r\n\r\n  rect[4].loadXYZ(min[0], min[1], max[2]);\r\n  rect[5].loadXYZ(min[0], max[1], max[2]);\r\n  rect[6].loadXYZ(max[0], max[1], max[2]);\r\n  rect[7].loadXYZ(max[0], min[1], max[2]);\r\n\r\n  for (let i = 0; i < 8; i++) {\r\n    if (p.vectorDistanceSqr(rect[i]) < r) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  let p2 = aabb_sphere_isect_vs.next().load(p);\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    p2.load(p);\r\n\r\n    let i2 = (i + 1)%3;\r\n    let i3 = (i + 2)%3;\r\n\r\n    p2[i] = p2[i] < 0.0 ? min[i] : max[i];\r\n\r\n    p2[i2] = Math.min(Math.max(p2[i2], min[i2]), max[i2]);\r\n    p2[i3] = Math.min(Math.max(p2[i3], min[i3]), max[i3]);\r\n\r\n    let isect = p2.vectorDistanceSqr(p) <= r;\r\n\r\n    if (isect) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n};\r\n\r\nexport function aabb_sphere_dist(p, min, max) {\r\n  {\r\n    let p1 = aabb_sphere_isect_vs.next().load(p);\r\n    let min1 = aabb_sphere_isect_vs.next().load(min);\r\n    let max1 = aabb_sphere_isect_vs.next().load(max);\r\n    if (p.length === 2) {\r\n      p1[2] = 0.0;\r\n    }\r\n    if (min1.length === 2) {\r\n      min1[2] = 0.0;\r\n    }\r\n    if (max.length === 2) {\r\n      max1[2] = 0.0;\r\n    }\r\n\r\n    p = p1;\r\n    min = min1;\r\n    max = max1;\r\n  }\r\n\r\n  let cent = aabb_sphere_isect_vs.next().load(min).interp(max, 0.5);\r\n  p.sub(cent);\r\n  min.sub(cent);\r\n  max.sub(cent);\r\n\r\n  let isect = point_in_aabb(p, min, max);\r\n\r\n  if (isect) {\r\n    return 0.0;\r\n  }\r\n\r\n  let rect = asi_rect;\r\n\r\n  rect[0].loadXYZ(min[0], min[1], min[2]);\r\n  rect[1].loadXYZ(min[0], max[1], min[2]);\r\n  rect[2].loadXYZ(max[0], max[1], min[2]);\r\n  rect[3].loadXYZ(max[0], min[1], min[2]);\r\n\r\n  rect[4].loadXYZ(min[0], min[1], max[2]);\r\n  rect[5].loadXYZ(min[0], max[1], max[2]);\r\n  rect[6].loadXYZ(max[0], max[1], max[2]);\r\n  rect[7].loadXYZ(max[0], min[1], max[2]);\r\n\r\n  let mindis;\r\n\r\n  for (let i = 0; i < 8; i++) {\r\n    let dis = p.vectorDistanceSqr(rect[i]);\r\n\r\n    if (mindis === undefined || dis < mindis) {\r\n      mindis = dis;\r\n    }\r\n  }\r\n\r\n  let p2 = aabb_sphere_isect_vs.next().load(p);\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    p2.load(p);\r\n\r\n    let i2 = (i + 1)%3;\r\n    let i3 = (i + 2)%3;\r\n\r\n    p2[i] = p2[i] < 0.0 ? min[i] : max[i];\r\n\r\n    p2[i2] = Math.min(Math.max(p2[i2], min[i2]), max[i2]);\r\n    p2[i3] = Math.min(Math.max(p2[i3], min[i3]), max[i3]);\r\n\r\n    let dis = p2.vectorDistanceSqr(p);\r\n    if (mindis === undefined || dis < mindis) {\r\n      mindis = dis;\r\n    }\r\n  }\r\n\r\n  return mindis === undefined ? 1e17 : mindis;\r\n};\r\n\r\nexport function point_in_tri(p, v1, v2, v3) {\r\n  let w1 = winding(p, v1, v2);\r\n  let w2 = winding(p, v2, v3);\r\n  let w3 = winding(p, v3, v1);\r\n  return w1 === w2 && w2 === w3;\r\n};\r\n\r\nexport function convex_quad(v1, v2, v3, v4) {\r\n  return line_line_cross([v1, v3], [v2, v4]);\r\n};\r\n\r\nlet $e1_normal_tri = new Vector3();\r\nlet $e3_normal_tri = new Vector3();\r\nlet $e2_normal_tri = new Vector3();\r\n\r\nexport function isNum(f) {\r\n  let ok = typeof f === \"number\";\r\n\r\n  ok = ok && !isNaN(f) && isFinite(f);\r\n\r\n  return ok;\r\n}\r\n\r\nconst _normal_tri_rets = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport function normal_tri(v1, v2, v3) {\r\n  let x1 = v2[0] - v1[0];\r\n  let y1 = v2[1] - v1[1];\r\n  let z1 = v2[2] - v1[2];\r\n  let x2 = v3[0] - v1[0];\r\n  let y2 = v3[1] - v1[1];\r\n  let z2 = v3[2] - v1[2];\r\n\r\n  if (!isNum(x1 + y1 + z1 + z2 + y2 + z2)) {\r\n    throw new Error(\"NaN in normal_tri\");\r\n  }\r\n\r\n  let x3, y3, z3;\r\n\r\n  x1 = v2[0] - v1[0];\r\n  y1 = v2[1] - v1[1];\r\n  z1 = v2[2] - v1[2];\r\n  x2 = v3[0] - v1[0];\r\n  y2 = v3[1] - v1[1];\r\n  z2 = v3[2] - v1[2];\r\n  x3 = y1*z2 - z1*y2;\r\n  y3 = z1*x2 - x1*z2;\r\n  z3 = x1*y2 - y1*x2;\r\n\r\n  let len = Math.sqrt((x3*x3 + y3*y3 + z3*z3));\r\n\r\n  if (len > 1e-05)\r\n    len = 1.0/len;\r\n\r\n  x3 *= len;\r\n  y3 *= len;\r\n  z3 *= len;\r\n\r\n  let n = _normal_tri_rets.next();\r\n\r\n  if (!isNum(x3 + y3 + z3)) {\r\n    throw new Error(\"NaN!\");\r\n  }\r\n\r\n  n[0] = x3;\r\n  n[1] = y3;\r\n  n[2] = z3;\r\n\r\n  return n;\r\n};\r\n\r\nlet $n2_normal_quad = new Vector3();\r\n\r\nlet _q1 = new Vector3(), _q2 = new Vector3(), _q3 = new Vector3();\r\n\r\nexport function normal_quad(v1, v2, v3, v4) {\r\n  _q1.load(normal_tri(v1, v2, v3));\r\n  _q2.load(normal_tri(v2, v3, v4));\r\n\r\n  _q1.add(_q2).normalize();\r\n  return _q1;\r\n}\r\n\r\nexport function normal_quad_old(v1, v2, v3, v4) {\r\n  let n = normal_tri(v1, v2, v3);\r\n  $n2_normal_quad[0] = n[0];\r\n  $n2_normal_quad[1] = n[1];\r\n  $n2_normal_quad[2] = n[2];\r\n  n = normal_tri(v1, v3, v4);\r\n  $n2_normal_quad[0] = $n2_normal_quad[0] + n[0];\r\n  $n2_normal_quad[1] = $n2_normal_quad[1] + n[1];\r\n  $n2_normal_quad[2] = $n2_normal_quad[2] + n[2];\r\n  let _len = Math.sqrt(($n2_normal_quad[0]*$n2_normal_quad[0] + $n2_normal_quad[1]*$n2_normal_quad[1] + $n2_normal_quad[2]*$n2_normal_quad[2]));\r\n  if (_len > 1e-05)\r\n    _len = 1.0/_len;\r\n  $n2_normal_quad[0] *= _len;\r\n  $n2_normal_quad[1] *= _len;\r\n  $n2_normal_quad[2] *= _len;\r\n  return $n2_normal_quad;\r\n};\r\n\r\nlet _li_vi = new Vector3();\r\n\r\n//calc_t is optional, false\r\nexport function line_isect(v1, v2, v3, v4, calc_t) {\r\n  if (calc_t === undefined) {\r\n    calc_t = false;\r\n  }\r\n  let div = (v2[0] - v1[0])*(v4[1] - v3[1]) - (v2[1] - v1[1])*(v4[0] - v3[0]);\r\n  if (div === 0.0)\r\n    return [new Vector3(), COLINEAR, 0.0];\r\n  let vi = _li_vi;\r\n  vi[0] = 0;\r\n  vi[1] = 0;\r\n  vi[2] = 0;\r\n  vi[0] = ((v3[0] - v4[0])*(v1[0]*v2[1] - v1[1]*v2[0]) - (v1[0] - v2[0])*(v3[0]*v4[1] - v3[1]*v4[0]))/div;\r\n  vi[1] = ((v3[1] - v4[1])*(v1[0]*v2[1] - v1[1]*v2[0]) - (v1[1] - v2[1])*(v3[0]*v4[1] - v3[1]*v4[0]))/div;\r\n  if (calc_t || v1.length === 3) {\r\n    let n1 = new Vector2(v2).sub(v1);\r\n    let n2 = new Vector2(vi).sub(v1);\r\n    let t = n2.vectorLength()/n1.vectorLength();\r\n    n1.normalize();\r\n    n2.normalize();\r\n    if (n1.dot(n2) < 0.0) {\r\n      t = -t;\r\n    }\r\n    if (v1.length === 3) {\r\n      vi[2] = v1[2] + (v2[2] - v1[2])*t;\r\n    }\r\n    return [vi, LINECROSS, t];\r\n  }\r\n  return [vi, LINECROSS];\r\n};\r\n\r\nlet dt2l_v1 = new Vector2();\r\nlet dt2l_v2 = new Vector2();\r\nlet dt2l_v3 = new Vector2();\r\nlet dt2l_v4 = new Vector2();\r\nlet dt2l_v5 = new Vector2();\r\n\r\nexport function dist_to_line_2d(p, v1, v2, clip, closest_co_out = undefined, t_out = undefined) {\r\n  if (clip === undefined) {\r\n    clip = true;\r\n  }\r\n\r\n  v1 = dt2l_v4.load(v1);\r\n  v2 = dt2l_v5.load(v2);\r\n\r\n  let n = dt2l_v1;\r\n  let vec = dt2l_v3;\r\n\r\n  n.load(v2).sub(v1).normalize();\r\n  vec.load(p).sub(v1);\r\n\r\n  let t = vec.dot(n);\r\n  if (clip) {\r\n    t = Math.min(Math.max(t, 0.0), v1.vectorDistance(v2));\r\n  }\r\n\r\n  n.mulScalar(t).add(v1);\r\n\r\n  if (closest_co_out) {\r\n    closest_co_out[0] = n[0];\r\n    closest_co_out[1] = n[1];\r\n  }\r\n\r\n  if (t_out !== undefined) {\r\n    t_out = t;\r\n  }\r\n\r\n  return n.vectorDistance(p);\r\n}\r\n\r\nlet dt3l_v1 = new Vector3();\r\nlet dt3l_v2 = new Vector3();\r\nlet dt3l_v3 = new Vector3();\r\nlet dt3l_v4 = new Vector3();\r\nlet dt3l_v5 = new Vector3();\r\n\r\nexport function dist_to_line_sqr(p, v1, v2, clip = true) {\r\n  let px = p[0] - v1[0];\r\n  let py = p[1] - v1[1];\r\n  let pz = p.length < 3 ? 0.0 : p[2] - v1[2];\r\n\r\n  pz = pz === undefined ? 0.0 : pz;\r\n\r\n  let v2x = v2[0] - v1[0];\r\n  let v2y = v2[1] - v1[1];\r\n  let v2z = v2.length < 3 ? 0.0 : v2[2] - v1[2];\r\n\r\n  let len = v2x*v2x + v2y*v2y + v2z*v2z;\r\n\r\n  if (len === 0.0) {\r\n    return Math.sqrt(px*px + py*py + pz*pz);\r\n  }\r\n\r\n  let len2 = 1.0/len;\r\n  v2x *= len2;\r\n  v2y *= len2;\r\n  v2z *= len2;\r\n\r\n  let t = px*v2x + py*v2y + pz*v2z;\r\n  if (clip) {\r\n    t = Math.min(Math.max(t, 0.0), len);\r\n  }\r\n\r\n  v2x *= t;\r\n  v2y *= t;\r\n  v2z *= t;\r\n\r\n  return (v2x - px)*(v2x - px) + (v2y - py)*(v2y - py) + (v2z - pz)*(v2z - pz);\r\n}\r\n\r\nexport function dist_to_line(p, v1, v2, clip = true) {\r\n  return Math.sqrt(dist_to_line_sqr(p, v1, v2, clip));\r\n}\r\n\r\n//p cam be 2d, 3d, or 4d point, v1/v2 however must be full homogenous coordinates\r\nlet _cplw_vs4 = util.cachering.fromConstructor(Vector4, 64);\r\nlet _cplw_vs3 = util.cachering.fromConstructor(Vector3, 64);\r\nlet _cplw_vs2 = util.cachering.fromConstructor(Vector2, 64);\r\n\r\nfunction wclip(x1, x2, w1, w2, near) {\r\n  let r1 = near*w1 - x1;\r\n  let r2 = (w1 - w2)*near - (x1 - x2);\r\n\r\n  if (r2 === 0.0) return 0.0;\r\n\r\n  return r1/r2;\r\n}\r\n\r\nfunction clip(a, b, znear) {\r\n  if (a - b === 0.0) return 0.0;\r\n\r\n  return (a - znear)/(a - b);\r\n}\r\n\r\n/*clips v1 and v2 to lie within homogenous projection range\r\n  v1 and v2 are assumed to be projected, pre-division Vector4's\r\n  returns a positive number (how much the line was scaled) if either _v1 or _v2 are\r\n  in front of the near clipping plane otherwise, returns 0\r\n */\r\nexport function clip_line_w(_v1, _v2, znear, zfar) {\r\n  let v1 = _cplw_vs4.next().load(_v1);\r\n  let v2 = _cplw_vs4.next().load(_v2);\r\n\r\n  //are we fully behind the view plane?\r\n  if ((v1[2] < 1.0 && v2[2] < 1.0))\r\n    return false;\r\n\r\n  function doclip1(v1, v2, axis) {\r\n    if (v1[axis]/v1[3] < -1) {\r\n      let t = wclip(v1[axis], v2[axis], v1[3], v2[3], -1);\r\n      v1.interp(v2, t);\r\n    } else if (v1[axis]/v1[3] > 1) {\r\n      let t = wclip(v1[axis], v2[axis], v1[3], v2[3], 1);\r\n      v1.interp(v2, t);\r\n    }\r\n  }\r\n\r\n  function doclip(v1, v2, axis) {\r\n    doclip1(v1, v2, axis);\r\n    doclip1(v2, v1, axis);\r\n  }\r\n\r\n  function dozclip(v1, v2) {\r\n    if (v1[2] < 1) {\r\n      let t = clip(v1[2], v2[2], 1);\r\n      v1.interp(v2, t);\r\n    } else if (v2[2] < 1) {\r\n      let t = clip(v2[2], v1[2], 1);\r\n      v2.interp(v1, t);\r\n    }\r\n  }\r\n\r\n  dozclip(v1, v2, 1);\r\n  doclip(v1, v2, 0);\r\n  doclip(v1, v2, 1);\r\n\r\n  for (let i = 0; i < 4; i++) {\r\n    _v1[i] = v1[i];\r\n    _v2[i] = v2[i];\r\n  }\r\n\r\n  return !(v1[0]/v1[3] === v2[0]/v2[3] || v1[1]/v2[3] === v2[1]/v2[3]);\r\n};\r\n\r\n//clip is optional, true.  clip point to lie within line segment v1->v2\r\nlet _closest_point_on_line_cache = util.cachering.fromConstructor(Vector3, 64);\r\nlet _closest_point_rets = new util.cachering(function () {\r\n  return [0, 0];\r\n}, 64);\r\n\r\nlet _closest_tmps = [new Vector3(), new Vector3(), new Vector3()];\r\n\r\nexport function closest_point_on_line(p, v1, v2, clip = true) {\r\n  let l1 = _closest_tmps[0], l2 = _closest_tmps[1];\r\n  let len;\r\n\r\n\r\n  l1.load(v2).sub(v1);\r\n\r\n  if (clip) {\r\n    len = l1.vectorLength();\r\n  }\r\n\r\n  l1.normalize();\r\n  l2.load(p).sub(v1);\r\n\r\n  let t = l2.dot(l1);\r\n  if (clip) {\r\n    //t = t*(t<0.0) + t*(t>1.0) + (t>1.0);\r\n    t = t < 0.0 ? 0.0 : t;\r\n    t = t > len ? len : t;\r\n  }\r\n\r\n  let co = _closest_point_on_line_cache.next();\r\n  co.load(l1).mulScalar(t).add(v1);\r\n  let ret = _closest_point_rets.next();\r\n\r\n  ret[0] = co;\r\n  ret[1] = t;\r\n\r\n  return ret;\r\n}\r\n\r\n/*given input line (a,d) and tangent t,\r\n  returns a circle that goes through both\r\n  a and d, whose normalized tangent at a is the same\r\n  as normalized t.\r\n  \r\n  note that t need not be normalized, this function\r\n  does that itself*/\r\nlet _circ_from_line_tan_vs = util.cachering.fromConstructor(Vector3, 32);\r\nlet _circ_from_line_tan_ret = new util.cachering(function () {\r\n  return [new Vector3(), 0];\r\n}, 64);\r\n\r\nexport function circ_from_line_tan(a, b, t) {\r\n  let p1 = _circ_from_line_tan_vs.next();\r\n  let t2 = _circ_from_line_tan_vs.next();\r\n  let n1 = _circ_from_line_tan_vs.next();\r\n\r\n  p1.load(a).sub(b);\r\n  t2.load(t).normalize();\r\n  n1.load(p1).normalize().cross(t2).cross(t2).normalize();\r\n\r\n  let ax = p1[0], ay = p1[1], az = p1[2], nx = n1[0], ny = n1[1], nz = n1[2];\r\n  let r = -(ax*ax + ay*ay + az*az);\r\n  let div = (2*(ax*nx + ay*ny + az*nz));\r\n\r\n  if (Math.abs(div) > 0.000001) {\r\n    r /= div;\r\n  } else {\r\n    r = 1000000.0;\r\n  }\r\n\r\n  let ret = _circ_from_line_tan_ret.next();\r\n  ret[0].load(n1).mulScalar(r).add(a)\r\n  ret[1] = r;\r\n\r\n  return ret;\r\n}\r\n\r\n/*given input line (a,d) and tangent t,\r\n  returns a circle that goes through both\r\n  a and d, whose normalized tangent at a is the same\r\n  as normalized t.\r\n\r\n  note that t need not be normalized, this function\r\n  does that itself*/\r\nlet _circ_from_line_tan2d_vs = util.cachering.fromConstructor(Vector3, 32);\r\nlet _circ_from_line_tan2d_ret = new util.cachering(function () {\r\n  return [new Vector2(), 0];\r\n}, 64);\r\n\r\nexport function circ_from_line_tan_2d(a, b, t) {\r\n  a = _circ_from_line_tan2d_vs.next().load(a);\r\n  b = _circ_from_line_tan2d_vs.next().load(b);\r\n  t = _circ_from_line_tan2d_vs.next().load(t);\r\n\r\n  a[2] = b[2] = t[2] = 0.0;\r\n\r\n  let p1 = _circ_from_line_tan2d_vs.next();\r\n  let t2 = _circ_from_line_tan2d_vs.next();\r\n  let n1 = _circ_from_line_tan2d_vs.next();\r\n\r\n  p1.load(a).sub(b);\r\n  t2.load(t).normalize();\r\n  n1.load(p1).normalize().cross(t2).cross(t2).normalize();\r\n\r\n  if (1) {\r\n    let cx, cy, r;\r\n    let x1 = a[0], y1 = a[1];\r\n    let x2 = b[0], y2 = b[1];\r\n    let tanx1 = t[0], tany1 = t[1];\r\n\r\n    let div = (4.0*((x1 - x2)*tany1 - (y1 - y2)*tanx1)**2);\r\n    let div2 = (2.0*(x1 - x2)*tany1 - 2.0*(y1 - y2)*tanx1);\r\n\r\n    if (Math.abs(div) < 0.0001 || Math.abs(div2) < 0.0001) {\r\n      let ret = _circ_from_line_tan2d_ret.next();\r\n\r\n      ret[0].load(a).interp(b, 0.5);\r\n      let dx = a[1] - b[1];\r\n      let dy = b[0] - a[0];\r\n\r\n      r = 1000000.0;\r\n\r\n      ret[0][0] += dx*r;\r\n      ret[0][1] += dy*r;\r\n      ret[1] = r;\r\n\r\n      return ret;\r\n    }\r\n    cx = (((x1 + x2)*(x1 - x2) - (y1 - y2)**2)*tany1 - 2.0*(y1 - y2)*tanx1*x1\r\n    )/div2;\r\n\r\n    cy = (-((y1 + y2)*(y1 - y2) - x2**2 - (x1 - 2.0*x2)*x1)*tanx1 + 2.0*(x1 -\r\n      x2)*tany1*y1)/div2;\r\n\r\n    r = (((y1 - y2)**2 + x2**2 + (x1 - 2.0*x2)*x1)**2*(tanx1**2 + tany1**2)\r\n    )/div;\r\n\r\n    let midx = a[0]*0.5 + b[0]*0.5;\r\n    let midy = a[1]*0.5 + b[1]*0.5;\r\n\r\n    //mirror\r\n    cx = 2.0*midx - cx;\r\n    cy = 2.0*midy - cy;\r\n\r\n    let ret = _circ_from_line_tan2d_ret.next();\r\n    ret[0].loadXY(cx, cy);\r\n    ret[1] = Math.sqrt(r);\r\n\r\n    return ret;\r\n  } else {\r\n    let ax = p1[0], ay = p1[1], az = p1[2], nx = n1[0], ny = n1[1], nz = n1[2];\r\n    let r = -(ax*ax + ay*ay + az*az);\r\n    let div = (2*(ax*nx + ay*ny + az*nz));\r\n\r\n    if (Math.abs(div) > 0.000001) {\r\n      r /= div;\r\n    } else {\r\n      r = 1000000.0;\r\n    }\r\n\r\n    let ret = _circ_from_line_tan2d_ret.next();\r\n    ret[0].load(n1).mulScalar(r).add(a)\r\n    ret[1] = r;\r\n\r\n    return ret;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nlet _gtc_e1 = new Vector3();\r\nlet _gtc_e2 = new Vector3();\r\nlet _gtc_e3 = new Vector3();\r\nlet _gtc_p1 = new Vector3();\r\nlet _gtc_p2 = new Vector3();\r\nlet _gtc_v1 = new Vector3();\r\nlet _gtc_v2 = new Vector3();\r\nlet _gtc_p12 = new Vector3();\r\nlet _gtc_p22 = new Vector3();\r\nlet _get_tri_circ_ret = new util.cachering(function () {\r\n  return [0, 0]\r\n});\r\n\r\nexport function get_tri_circ(a, b, c) {\r\n  let v1 = _gtc_v1;\r\n  let v2 = _gtc_v2;\r\n  let e1 = _gtc_e1;\r\n  let e2 = _gtc_e2;\r\n  let e3 = _gtc_e3;\r\n  let p1 = _gtc_p1;\r\n  let p2 = _gtc_p2;\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    e1[i] = b[i] - a[i];\r\n    e2[i] = c[i] - b[i];\r\n    e3[i] = a[i] - c[i];\r\n  }\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    p1[i] = (a[i] + b[i])*0.5;\r\n    p2[i] = (c[i] + b[i])*0.5;\r\n  }\r\n\r\n  e1.normalize();\r\n\r\n  v1[0] = -e1[1];\r\n  v1[1] = e1[0];\r\n  v1[2] = e1[2];\r\n\r\n  v2[0] = -e2[1];\r\n  v2[1] = e2[0];\r\n  v2[2] = e2[2];\r\n\r\n  v1.normalize();\r\n  v2.normalize();\r\n\r\n  let cent;\r\n  let type;\r\n  for (let i = 0; i < 3; i++) {\r\n    _gtc_p12[i] = p1[i] + v1[i];\r\n    _gtc_p22[i] = p2[i] + v2[i];\r\n  }\r\n\r\n  let isect = line_isect(p1, _gtc_p12, p2, _gtc_p22);\r\n  cent = isect[0];\r\n  type = isect[1];\r\n\r\n  e1.load(a);\r\n  e2.load(b);\r\n  e3.load(c);\r\n\r\n  let r = e1.sub(cent).vectorLength();\r\n  if (r < feps)\r\n    r = e2.sub(cent).vectorLength();\r\n  if (r < feps)\r\n    r = e3.sub(cent).vectorLength();\r\n\r\n  let ret = _get_tri_circ_ret.next();\r\n  ret[0] = cent;\r\n  ret[1] = r;\r\n\r\n  return ret;\r\n};\r\n\r\nexport function gen_circle(m, origin, r, stfeps) {\r\n  let pi = Math.PI;\r\n  let f = -pi/2;\r\n  let df = (pi*2)/stfeps;\r\n  let verts = new Array();\r\n  for (let i = 0; i < stfeps; i++) {\r\n    let x = origin[0] + r*Math.sin(f);\r\n    let y = origin[1] + r*Math.cos(f);\r\n    let v = m.make_vert(new Vector3([x, y, origin[2]]));\r\n    verts.push(v);\r\n    f += df;\r\n  }\r\n  for (let i = 0; i < verts.length; i++) {\r\n    let v1 = verts[i];\r\n    let v2 = verts[(i + 1)%verts.length];\r\n    m.make_edge(v1, v2);\r\n  }\r\n  return verts;\r\n};\r\n\r\nlet cos = Math.cos;\r\nlet sin = Math.sin;\r\n\r\n//axis is optional, 0\r\nexport function rot2d(v1, A, axis) {\r\n  let x = v1[0];\r\n  let y = v1[1];\r\n\r\n  if (axis === 1) {\r\n    v1[0] = x*cos(A) + y*sin(A);\r\n    v1[2] = y*cos(A) - x*sin(A);\r\n  } else {\r\n    v1[0] = x*cos(A) - y*sin(A);\r\n    v1[1] = y*cos(A) + x*sin(A);\r\n  }\r\n}\r\n\r\nexport function makeCircleMesh(gl, radius, stfeps) {\r\n  let mesh = new Mesh();\r\n  let verts1 = gen_circle(mesh, new Vector3(), radius, stfeps);\r\n  let verts2 = gen_circle(mesh, new Vector3(), radius/1.75, stfeps);\r\n  mesh.make_face_complex([verts1, verts2]);\r\n  return mesh;\r\n};\r\n\r\nexport function minmax_verts(verts) {\r\n  let min = new Vector3([1000000000000.0, 1000000000000.0, 1000000000000.0]);\r\n  let max = new Vector3([-1000000000000.0, -1000000000000.0, -1000000000000.0]);\r\n  let __iter_v = __get_iter(verts);\r\n  let v;\r\n  while (1) {\r\n    let __ival_v = __iter_v.next();\r\n    if (__ival_v.done) {\r\n      break;\r\n    }\r\n    v = __ival_v.value;\r\n    for (let i = 0; i < 3; i++) {\r\n      min[i] = Math.min(min[i], v.co[i]);\r\n      max[i] = Math.max(max[i], v.co[i]);\r\n    }\r\n  }\r\n  return [min, max];\r\n};\r\n\r\nexport function unproject(vec, ipers, iview) {\r\n  let newvec = new Vector3(vec);\r\n  newvec.multVecMatrix(ipers);\r\n  newvec.multVecMatrix(iview);\r\n  return newvec;\r\n};\r\n\r\nexport function project(vec, pers, view) {\r\n  let newvec = new Vector3(vec);\r\n  newvec.multVecMatrix(pers);\r\n  newvec.multVecMatrix(view);\r\n  return newvec;\r\n};\r\n\r\nlet _sh_minv = new Vector3();\r\nlet _sh_maxv = new Vector3();\r\nlet _sh_start = [];\r\nlet _sh_end = [];\r\n\r\nlet static_cent_gbw = new Vector3();\r\n\r\nexport function get_boundary_winding(points) {\r\n  let cent = static_cent_gbw.zero();\r\n  if (points.length === 0)\r\n    return false;\r\n  for (let i = 0; i < points.length; i++) {\r\n    cent.add(points[i]);\r\n  }\r\n  cent.divideScalar(points.length);\r\n  let w = 0, totw = 0;\r\n  for (let i = 0; i < points.length; i++) {\r\n    let v1 = points[i];\r\n    let v2 = points[(i + 1)%points.length];\r\n    if (!colinear(v1, v2, cent)) {\r\n      w += winding(v1, v2, cent);\r\n      totw += 1;\r\n    }\r\n  }\r\n  if (totw > 0)\r\n    w /= totw;\r\n  return Math.round(w) === 1;\r\n};\r\n\r\nexport class PlaneOps {\r\n  constructor(normal) {\r\n    let no = normal;\r\n    this.axis = [0, 0, 0];\r\n    this.reset_axis(normal);\r\n  }\r\n\r\n  reset_axis(no) {\r\n    let ax, ay, az;\r\n    let nx = Math.abs(no[0]), ny = Math.abs(no[1]), nz = Math.abs(no[2]);\r\n    if (nz > nx && nz > ny) {\r\n      ax = 0;\r\n      ay = 1;\r\n      az = 2;\r\n    } else if (nx > ny && nx > nz) {\r\n      ax = 2;\r\n      ay = 1;\r\n      az = 0;\r\n    } else {\r\n      ax = 0;\r\n      ay = 2;\r\n      az = 1;\r\n    }\r\n    this.axis = [ax, ay, az];\r\n  }\r\n\r\n  convex_quad(v1, v2, v3, v4) {\r\n    let ax = this.axis;\r\n    v1 = new Vector3([v1[ax[0]], v1[ax[1]], v1[ax[2]]]);\r\n    v2 = new Vector3([v2[ax[0]], v2[ax[1]], v2[ax[2]]]);\r\n    v3 = new Vector3([v3[ax[0]], v3[ax[1]], v3[ax[2]]]);\r\n    v4 = new Vector3([v4[ax[0]], v4[ax[1]], v4[ax[2]]]);\r\n    return convex_quad(v1, v2, v3, v4);\r\n  }\r\n\r\n  line_isect(v1, v2, v3, v4) {\r\n    let ax = this.axis;\r\n    let orig1 = v1, orig2 = v2;\r\n    v1 = new Vector3([v1[ax[0]], v1[ax[1]], v1[ax[2]]]);\r\n    v2 = new Vector3([v2[ax[0]], v2[ax[1]], v2[ax[2]]]);\r\n    v3 = new Vector3([v3[ax[0]], v3[ax[1]], v3[ax[2]]]);\r\n    v4 = new Vector3([v4[ax[0]], v4[ax[1]], v4[ax[2]]]);\r\n    let ret = line_isect(v1, v2, v3, v4, true);\r\n    let vi = ret[0];\r\n    if (ret[1] === LINECROSS) {\r\n      ret[0].load(orig2).sub(orig1).mulScalar(ret[2]).add(orig1);\r\n    }\r\n    return ret;\r\n  }\r\n\r\n  line_line_cross(l1, l2) {\r\n    let ax = this.axis;\r\n    let v1 = l1[0], v2 = l1[1], v3 = l2[0], v4 = l2[1];\r\n    v1 = new Vector3([v1[ax[0]], v1[ax[1]], 0.0]);\r\n    v2 = new Vector3([v2[ax[0]], v2[ax[1]], 0.0]);\r\n    v3 = new Vector3([v3[ax[0]], v3[ax[1]], 0.0]);\r\n    v4 = new Vector3([v4[ax[0]], v4[ax[1]], 0.0]);\r\n    return line_line_cross([v1, v2], [v3, v4]);\r\n  }\r\n\r\n  winding(v1, v2, v3) {\r\n    let ax = this.axis;\r\n    if (v1 === undefined)\r\n      console.trace();\r\n    v1 = new Vector3([v1[ax[0]], v1[ax[1]], 0.0]);\r\n    v2 = new Vector3([v2[ax[0]], v2[ax[1]], 0.0]);\r\n    v3 = new Vector3([v3[ax[0]], v3[ax[1]], 0.0]);\r\n    return winding(v1, v2, v3);\r\n  }\r\n\r\n  colinear(v1, v2, v3) {\r\n    let ax = this.axis;\r\n    v1 = new Vector3([v1[ax[0]], v1[ax[1]], 0.0]);\r\n    v2 = new Vector3([v2[ax[0]], v2[ax[1]], 0.0]);\r\n    v3 = new Vector3([v3[ax[0]], v3[ax[1]], 0.0]);\r\n    return colinear(v1, v2, v3);\r\n  }\r\n\r\n  get_boundary_winding(points) {\r\n    let ax = this.axis;\r\n    let cent = new Vector3();\r\n    if (points.length === 0)\r\n      return false;\r\n    for (let i = 0; i < points.length; i++) {\r\n      cent.add(points[i]);\r\n    }\r\n    cent.divideScalar(points.length);\r\n    let w = 0, totw = 0;\r\n    for (let i = 0; i < points.length; i++) {\r\n      let v1 = points[i];\r\n      let v2 = points[(i + 1)%points.length];\r\n      if (!this.colinear(v1, v2, cent)) {\r\n        w += this.winding(v1, v2, cent);\r\n        totw += 1;\r\n      }\r\n    }\r\n    if (totw > 0)\r\n      w /= totw;\r\n    return Math.round(w) === 1;\r\n  }\r\n}\r\n\r\n/*\r\non factor;\r\n\r\npx := rox + rnx*t;\r\npy := roy + rny*t;\r\npz := roz + rnz*t;\r\n\r\nf1 := (px-pox)*pnx + (py-poy)*pny + (pz-poz)*pnz;\r\nff := solve(f1, t);\r\non fort;\r\npart(ff, 1, 2);\r\noff fort;\r\n\r\n* */\r\nlet _isrp_ret = new Vector3();\r\nlet isect_ray_plane_rets = util.cachering.fromConstructor(Vector3, 256);\r\n\r\nexport function isect_ray_plane(planeorigin, planenormal, rayorigin, raynormal) {\r\n  let po = planeorigin, pn = planenormal, ro = rayorigin, rn = raynormal;\r\n\r\n  let div = (pn[1]*rn[1] + pn[2]*rn[2] + pn[0]*rn[0]);\r\n\r\n  if (Math.abs(div) < 0.000001) {\r\n    return undefined;\r\n  }\r\n\r\n  let t = ((po[1] - ro[1])*pn[1] + (po[2] - ro[2])*pn[2] + (po[0] - ro[0])*pn[0])/div;\r\n  _isrp_ret.load(ro).addFac(rn, t);\r\n\r\n  return isect_ray_plane_rets.next().load(_isrp_ret);\r\n}\r\n\r\nexport function _old_isect_ray_plane(planeorigin, planenormal, rayorigin, raynormal) {\r\n  let p = planeorigin, n = planenormal;\r\n  let r = rayorigin, v = raynormal;\r\n\r\n  let d = p.vectorLength();\r\n  let t = -(r.dot(n) - p.dot(n))/v.dot(n);\r\n  _isrp_ret.load(v);\r\n  _isrp_ret.mulScalar(t);\r\n  _isrp_ret.add(r);\r\n  return _isrp_ret;\r\n};\r\n\r\nexport class Mat4Stack {\r\n  constructor() {\r\n    this.stack = [];\r\n    this.matrix = new Matrix4();\r\n    this.matrix.makeIdentity();\r\n    this.update_func = undefined;\r\n  }\r\n\r\n  set_internal_matrix(mat, update_func) {\r\n    this.update_func = update_func;\r\n    this.matrix = mat;\r\n  }\r\n\r\n  reset(mat) {\r\n    this.matrix.load(mat);\r\n    this.stack = [];\r\n    if (this.update_func !== undefined)\r\n      this.update_func();\r\n  }\r\n\r\n  load(mat) {\r\n    this.matrix.load(mat);\r\n    if (this.update_func !== undefined)\r\n      this.update_func();\r\n  }\r\n\r\n  multiply(mat) {\r\n    this.matrix.multiply(mat);\r\n    if (this.update_func !== undefined)\r\n      this.update_func();\r\n  }\r\n\r\n  identity() {\r\n    this.matrix.loadIdentity();\r\n    if (this.update_func !== undefined)\r\n      this.update_func();\r\n  }\r\n\r\n  push(mat2) {\r\n    this.stack.push(new Matrix4(this.matrix));\r\n    if (mat2 !== undefined) {\r\n      this.matrix.load(mat2);\r\n      if (this.update_func !== undefined)\r\n        this.update_func();\r\n    }\r\n  }\r\n\r\n  pop() {\r\n    let mat = this.stack.pop(this.stack.length - 1);\r\n    this.matrix.load(mat);\r\n    if (this.update_func !== undefined)\r\n      this.update_func();\r\n    return mat;\r\n  }\r\n}\r\n\r\n\r\n/*\r\n\r\non factor;\r\noff period;\r\n\r\nload_package \"avector\";\r\n\r\n\r\na1 := avec(a1x, a1y, a1z);\r\nb1 := avec(b1x, b1y, b1z);\r\nc1 := avec(c1x, c1y, c1z);\r\nd1 := avec(d1x, d1y, d1z);\r\n\r\na1x := 0;\r\na1y := 0;\r\na1z := 0;\r\n\r\na2 := avec(a2x, a2y, a2z);\r\nb2 := avec(b2x, b2y, b2z);\r\nc2 := avec(c2x, c2y, c2z);\r\nd2 := avec(d2x, d2y, d2z);\r\n\r\np1 := a1 + (b1 - a1) * v;\r\np2 := d1 + (c1 - d1) * v;\r\np3 := p1 + (p2 - p1) * u;\r\n\r\np4 := a2 + (b2 - a2) * v;\r\np5 := d2 + (c2 - d2) * v;\r\np6 := p4 + (p5 - p4) * u;\r\n\r\np7 := p3 + (p6 - p3) * w;\r\n\r\nf1 := p7[0] - goalx;\r\nf2 := p7[1] - goaly;\r\nf3 := p7[2] - goalz;\r\n\r\ncomment: solve({f1, f2, f3}, {u, v, w});\r\n\r\non fort;\r\np7;\r\noff fort;\r\n\r\nsub(u=0, v=1, w=0, p7[0]);\r\n\r\n*/\r\n\r\nconst tril_rets = util.cachering.fromConstructor(Vector3, 128);\r\n\r\nfunction lreport() {\r\n  //console.log(...arguments);\r\n}\r\n\r\nexport function trilinear_v3(uvw, boxverts) {\r\n  let [u, v, w] = uvw;\r\n\r\n  const a1x = boxverts[0][0], a1y = boxverts[0][1], a1z = boxverts[0][2];\r\n\r\n  const b1x = boxverts[1][0] - a1x, b1y = boxverts[1][1] - a1y, b1z = boxverts[1][2] - a1z;\r\n  const c1x = boxverts[2][0] - a1x, c1y = boxverts[2][1] - a1y, c1z = boxverts[2][2] - a1z;\r\n  const d1x = boxverts[3][0] - a1x, d1y = boxverts[3][1] - a1y, d1z = boxverts[3][2] - a1z;\r\n\r\n  const a2x = boxverts[4][0] - a1x, a2y = boxverts[4][1] - a1y, a2z = boxverts[4][2] - a1z;\r\n  const b2x = boxverts[5][0] - a1x, b2y = boxverts[5][1] - a1y, b2z = boxverts[5][2] - a1z;\r\n  const c2x = boxverts[6][0] - a1x, c2y = boxverts[6][1] - a1y, c2z = boxverts[6][2] - a1z;\r\n  const d2x = boxverts[7][0] - a1x, d2y = boxverts[7][1] - a1y, d2z = boxverts[7][2] - a1z;\r\n\r\n  const x = (((a2x - b2x)*v - a2x + (c2x - d2x)*v + d2x)*u - ((a2x - b2x)*v - a2x) - (\r\n      ((c1x - d1x)*v + d1x - b1x*v)*u + b1x*v))*w + ((c1x - d1x)*v + d1x - b1x*v)*u +\r\n    b1x*v;\r\n  const y = (((a2y - b2y)*v - a2y + (c2y - d2y)*v + d2y)*u - ((a2y - b2y)*v - a2y) - (\r\n      ((c1y - d1y)*v + d1y - b1y*v)*u + b1y*v))*w + ((c1y - d1y)*v + d1y - b1y*v)*u +\r\n    b1y*v;\r\n  const z = (((a2z - b2z)*v - a2z + (c2z - d2z)*v + d2z)*u - ((a2z - b2z)*v - a2z) - (\r\n      ((c1z - d1z)*v + d1z - b1z*v)*u + b1z*v))*w + ((c1z - d1z)*v + d1z - b1z*v)*u +\r\n    b1z*v;\r\n\r\n  let p = tril_rets.next();\r\n\r\n  p[0] = x + a1x;\r\n  p[1] = y + a1y;\r\n  p[2] = z + a1z;\r\n\r\n  return p;\r\n}\r\n\r\nlet tril_co_rets = util.cachering.fromConstructor(Vector3, 128);\r\nlet tril_co_tmps = util.cachering.fromConstructor(Vector3, 16);\r\nlet tril_mat_1 = new Matrix4();\r\nlet tril_mat_2 = new Matrix4();\r\n\r\nlet wtable = [\r\n  [\r\n    [0.5, 0.5, 0], //u triplet\r\n    [0.5, 0.5, 0], //v triplet\r\n    [0.5, 0.5, 0]  //w triplet\r\n  ],\r\n  [\r\n    [0.5, 0.5, 0],\r\n    [0.0, 0.5, 0.5],\r\n    [0.5, 0.5, 0]\r\n  ],\r\n  [\r\n    [0.0, 0.5, 0.5],\r\n    [0.0, 0.5, 0.5],\r\n    [0.5, 0.5, 0]\r\n  ],\r\n  [\r\n    [0.0, 0.5, 0.5],\r\n    [0.5, 0.5, 0],\r\n    [0.5, 0.5, 0]\r\n  ],\r\n];\r\n\r\nfor (let i = 0; i < 4; i++) {\r\n  let w = wtable[i];\r\n  w = [w[0], w[1], [0.0, 0.5, 0.5]];\r\n  wtable.push(w);\r\n}\r\n\r\nconst pih_tmps = util.cachering.fromConstructor(Vector3, 16);\r\nconst boxfaces_table = [\r\n  [0, 1, 2, 3],\r\n  [7, 6, 5, 4],\r\n  [0, 4, 5, 1],\r\n  [1, 5, 6, 2],\r\n  [2, 6, 7, 3],\r\n  [3, 7, 4, 0]\r\n];\r\n\r\nlet boxfaces_tmp = new Array(6);\r\nfor (let i = 0; i < 6; i++) {\r\n  boxfaces_tmp[i] = new Vector3();\r\n}\r\n\r\nlet boxfacenormals_tmp = new Array(6);\r\nfor (let i = 0; i < 6; i++) {\r\n  boxfacenormals_tmp[i] = new Vector3();\r\n}\r\n\r\nexport function point_in_hex(p, boxverts, boxfacecents = undefined, boxfacenormals = undefined) {\r\n  if (!boxfacecents) {\r\n    boxfacecents = boxfaces_tmp;\r\n\r\n    for (let i = 0; i < 6; i++) {\r\n      let [v1, v2, v3, v4] = boxfaces_table[i];\r\n      v1 = boxverts[v1];\r\n      v2 = boxverts[v2];\r\n      v3 = boxverts[v3];\r\n      v4 = boxverts[v4];\r\n\r\n      boxfacecents[i].load(v1).add(v2).add(v3).add(v4).mulScalar(0.25);\r\n    }\r\n  }\r\n\r\n  if (!boxfacenormals) {\r\n    boxfacenormals = boxfacenormals_tmp;\r\n    for (let i = 0; i < 6; i++) {\r\n      let [v1, v2, v3, v4] = boxfaces_table[i];\r\n      v1 = boxverts[v1];\r\n      v2 = boxverts[v2];\r\n      v3 = boxverts[v3];\r\n      v4 = boxverts[v4];\r\n\r\n      let n = normal_quad(v1, v2, v3, v4);\r\n      boxfacenormals[i].load(n).negate();\r\n    }\r\n  }\r\n\r\n  let t1 = pih_tmps.next();\r\n  let t2 = pih_tmps.next();\r\n\r\n  let cent = pih_tmps.next().zero();\r\n  for (let i = 0; i < 6; i++) {\r\n    cent.add(boxfacecents[i]);\r\n  }\r\n  cent.mulScalar(1.0/6.0);\r\n\r\n  let ret = true;\r\n\r\n  for (let i = 0; i < 6; i++) {\r\n    t1.load(p).sub(boxfacecents[i]);\r\n    t2.load(cent).sub(boxfacecents[i]);\r\n    let n = boxfacenormals[i];\r\n\r\n    if (1) {\r\n      t1.normalize();\r\n      t2.normalize();\r\n\r\n      //console.log(i, \"DOT\", n.dot(t1).toFixed(5), n, t1);\r\n    }\r\n\r\n    if (t1.dot(t2) < 0) {\r\n      //console.log(\"\\n\");\r\n      ret = false;\r\n      return false;\r\n    }\r\n  }\r\n\r\n  //console.log(\"\\n\");\r\n  return ret;\r\n  //return true;\r\n}\r\n\r\nconst boxverts_tmp = new Array(8);\r\nfor (let i = 0; i < 8; i++) {\r\n  boxverts_tmp[i] = new Vector3();\r\n}\r\n\r\nexport function trilinear_co(p, boxverts) {\r\n  let uvw = tril_co_rets.next();\r\n\r\n  uvw.zero();\r\n\r\n  let u = tril_co_tmps.next();\r\n  let v = tril_co_tmps.next();\r\n  let w = tril_co_tmps.next();\r\n\r\n  u.loadXYZ(0.0, 0.5, 1.0);\r\n  v.loadXYZ(0.0, 0.5, 1.0);\r\n  w.loadXYZ(0.0, 0.5, 1.0);\r\n\r\n  let uvw2 = tril_co_tmps.next();\r\n\r\n  for (let step = 0; step < 4; step++) {\r\n    uvw.loadXYZ(u[1], v[1], w[1]);\r\n\r\n    let mini = undefined;\r\n    let mindis = trilinear_v3(uvw, boxverts).vectorDistanceSqr(p);\r\n\r\n    for (let i = 0; i < 8; i++) {\r\n      let [t1, t2, t3] = wtable[i];\r\n\r\n      let u2 = t1[0]*u[0] + t1[1]*u[1] + t1[2]*u[2];\r\n      let v2 = t2[0]*v[0] + t2[1]*v[1] + t2[2]*v[2];\r\n      let w2 = t3[0]*w[0] + t3[1]*w[1] + t3[2]*w[2];\r\n\r\n      let du = Math.abs(u2 - u[1]);\r\n      let dv = Math.abs(v2 - v[1]);\r\n      let dw = Math.abs(w2 - w[1]);\r\n\r\n      uvw.loadXYZ(u2, v2, w2);\r\n      let dis = trilinear_v3(uvw, boxverts).vectorDistanceSqr(p);\r\n\r\n      if (mindis === undefined || dis < mindis) {\r\n        //mindis = dis;\r\n        //mini = i;\r\n      }\r\n\r\n      if (1) {\r\n        let bv = boxverts_tmp;\r\n\r\n        /*\r\n        let dd = 1.0 - 0.001;\r\n\r\n        du *= dd;\r\n        dv *= dd;\r\n        dw *= dd;\r\n        //*/\r\n\r\n        bv[0].loadXYZ(u2 - du, v2 - dv, w2 - dw);\r\n        bv[1].loadXYZ(u2 - du, v2 + dv, w2 - dw);\r\n        bv[2].loadXYZ(u2 + du, v2 + dv, w2 - dw);\r\n        bv[3].loadXYZ(u2 + du, v2 - dv, w2 - dw);\r\n\r\n        bv[4].loadXYZ(u2 - du, v2 - dv, w2 + dw);\r\n        bv[5].loadXYZ(u2 - du, v2 + dv, w2 + dw);\r\n        bv[6].loadXYZ(u2 + du, v2 + dv, w2 + dw);\r\n        bv[7].loadXYZ(u2 + du, v2 - dv, w2 + dw);\r\n\r\n        for (let j = 0; j < 8; j++) {\r\n          bv[j].load(trilinear_v3(bv[j], boxverts));\r\n        }\r\n\r\n        if (point_in_hex(p, bv)) {\r\n          mini = i;\r\n          mindis = dis;\r\n          //console.log(\"DIS\", (dis**0.5).toFixed(3));\r\n          break;\r\n        }\r\n\r\n        //console.log(\"\\n\");\r\n      }\r\n    }\r\n\r\n    if (mini === undefined) {\r\n      lreport(\"mindis:\", (mindis**0.5).toFixed(3));\r\n      break;\r\n    }\r\n\r\n    let [t1, t2, t3] = wtable[mini];\r\n\r\n    let u2 = t1[0]*u[0] + t1[1]*u[1] + t1[2]*u[2];\r\n    let v2 = t2[0]*v[0] + t2[1]*v[1] + t2[2]*v[2];\r\n    let w2 = t3[0]*w[0] + t3[1]*w[1] + t3[2]*w[2];\r\n\r\n    let du = Math.abs(u2 - u[1]);\r\n    let dv = Math.abs(v2 - v[1]);\r\n    let dw = Math.abs(w2 - w[1]);\r\n\r\n    u[0] = u2 - du;\r\n    v[0] = v2 - dv;\r\n    w[0] = w2 - dw;\r\n\r\n    u[1] = u2;\r\n    v[1] = v2;\r\n    w[1] = w2;\r\n\r\n    u[2] = u2 + du;\r\n    v[2] = v2 + dv;\r\n    w[2] = w2 + dw;\r\n\r\n    lreport(\"mindis:\", (mindis**0.5).toFixed(3), u2, v2, w2);\r\n  }\r\n\r\n  uvw.loadXYZ(u[1], v[1], w[1]);\r\n\r\n  //console.log(\"uvw\", uvw);\r\n\r\n  //return uvw;\r\n\r\n  return trilinear_co2(p, boxverts, uvw);\r\n}\r\n\r\n//newton-raphson\r\nexport function trilinear_co2(p, boxverts, uvw) {\r\n  //let uvw = tril_co_rets.next();\r\n  let grad = tril_co_tmps.next();\r\n\r\n  //uvw[0] = uvw[1] = uvw[2] = 0.5;\r\n\r\n  let df = 0.00001;\r\n\r\n  let mat = tril_mat_1;\r\n  let m = mat.$matrix;\r\n  let mat2 = tril_mat_2;\r\n\r\n  let r1 = tril_co_tmps.next();\r\n\r\n  for (let step = 0; step < 55; step++) {\r\n    //let r1 = trilinear_v3(uvw, boxverts).vectorDistance(p);\r\n    let totg = 0;\r\n\r\n    for (let i = 0; i < 3; i++) {\r\n      let axis_error = 0.0;\r\n\r\n      if (uvw[i] < 0) {\r\n        axis_error = -uvw[i];\r\n      } else if (uvw[i] > 1.0) {\r\n        axis_error = uvw[i] - 1.0;\r\n      }\r\n      //r1[i] = trilinear_v3(uvw, boxverts)[i] - p[i];\r\n      r1[i] = trilinear_v3(uvw, boxverts).vectorDistance(p) + 10.0*axis_error;\r\n\r\n      let orig = uvw[i];\r\n\r\n      uvw[i] += df;\r\n      //let r2 = trilinear_v3(uvw, boxverts)[i] - p[i];\r\n\r\n      if (uvw[i] < 0) {\r\n        axis_error = -uvw[i];\r\n      } else if (uvw[i] > 1.0) {\r\n        axis_error = uvw[i] - 1.0;\r\n      } else {\r\n        axis_error = 0.0;\r\n      }\r\n      let r2 = trilinear_v3(uvw, boxverts).vectorDistance(p) + 10.0*axis_error;\r\n      uvw[i] = orig;\r\n\r\n      grad[i] = (r2 - r1[i])/df;\r\n      totg += grad[i]**2;\r\n    }\r\n\r\n    if (totg === 0.0) {\r\n      break;\r\n    }\r\n\r\n    let err = trilinear_v3(uvw, boxverts).vectorDistance(p);\r\n\r\n    if (1) {\r\n      //grad.normalize();\r\n      uvw.addFac(grad, -err/totg*0.85);\r\n    } else {\r\n      mat.makeIdentity();\r\n      m.m11 = grad[0];\r\n      m.m12 = grad[1];\r\n      m.m13 = grad[2];\r\n      m.m22 = m.m33 = m.m44 = 0.0;\r\n\r\n      mat.transpose();\r\n      mat2.load(mat).transpose();\r\n\r\n      //right-indepdenent pseudo inverse\r\n      //mat.multiply(mat2).invert();\r\n      //mat.preMultiply(mat2);\r\n\r\n      //left-independent\r\n      mat.preMultiply(mat2).invert();\r\n      mat.multiply(mat2);\r\n\r\n      grad.load(r1);\r\n      grad.multVecMatrix(mat);\r\n      uvw.addFac(grad, -1.0);\r\n    }\r\n\r\n    lreport(\"error:\", err.toFixed(3), uvw);\r\n\r\n    if (r1.dot(r1)**0.5 < 0.0001) {\r\n      break;\r\n    }\r\n  }\r\n\r\n  lreport(\"\\n\");\r\n\r\n  return uvw;\r\n}\r\n\r\nlet angle_tri_v3_rets = util.cachering.fromConstructor(Vector3, 32);\r\nlet angle_tri_v3_vs = util.cachering.fromConstructor(Vector3, 32);\r\n\r\nexport function tri_angles(v1, v2, v3) {\r\n  let t1 = angle_tri_v3_vs.next().load(v1).sub(v2);\r\n  let t2 = angle_tri_v3_vs.next().load(v3).sub(v2);\r\n  let t3 = angle_tri_v3_vs.next().load(v2).sub(v3);\r\n\r\n  t1.normalize();\r\n  t2.normalize();\r\n  t3.normalize();\r\n\r\n  let th1 = Math.acos(t1.dot(t2)*0.99999);\r\n  t2.negate();\r\n\r\n  let th2 = Math.acos(t2.dot(t3)*0.99999);\r\n  let th3 = Math.PI - (th1 + th2);\r\n\r\n  let ret = angle_tri_v3_rets.next();\r\n\r\n  ret[0] = th1;\r\n  ret[1] = th2;\r\n  ret[2] = th3;\r\n\r\n  return ret;\r\n}\r\n\r\n\r\n","let _clipdata = {\r\n  name: \"nothing\",\r\n  mime: \"nothing\",\r\n  data: undefined\r\n};\r\n\r\nlet _clipboards = {};\r\n\r\nimport * as ctrlconfig from '../path-controller/config/config.js';\r\n\r\nwindow.setInterval(() => {\r\n  let cb = navigator.clipboard;\r\n\r\n  if (!cb || !cb.read) {\r\n    return;\r\n  }\r\n\r\n  cb.read().then((data) => {\r\n    for (let item of data) {\r\n      for (let i = 0; i < item.types.length; i++) {\r\n        let type = item.types[i];\r\n\r\n        if (!(type in _clipboards)) {\r\n          _clipboards[type] = {\r\n            name: type,\r\n            mime: type,\r\n            data: undefined\r\n          };\r\n        }\r\n        ;\r\n\r\n        item.getType(type).then((blob) => new Response(blob).text()).then((text) => {\r\n          _clipboards[type].data = text;\r\n        });\r\n      }\r\n\r\n      //item.getType(\"text/css\").then((blob) => blob.text()).then((text) => {\r\n      //  console.log(\"text\", text);\r\n      //});\r\n    }\r\n    //_clipdata.mime =\r\n  }).catch(function () {\r\n  });\r\n}, 200);\r\n\r\nlet exports = {\r\n  /*client code can override this using .loadConstants, here is a simple implementation\r\n    that just handles color data\r\n\r\n    desiredMimes is either a string, or an array of strings\r\n   */\r\n  getClipboardData(desiredMimes = \"text/plain\") {\r\n    if (typeof desiredMimes === \"string\") {\r\n      desiredMimes = [desiredMimes];\r\n    }\r\n\r\n    for (let m of desiredMimes) {\r\n      let cb = _clipboards[m];\r\n\r\n      if (cb && cb.data) {\r\n        return cb;\r\n      }\r\n    }\r\n  },\r\n  /*client code can override this, here is a simple implementation\r\n    that just handles color data\r\n   */\r\n  setClipboardData(name, mime, data) {\r\n    _clipboards[mime] = {\r\n      name: name,\r\n      mime: mime,\r\n      data: data\r\n    };\r\n\r\n    let clipboard = navigator.clipboard;\r\n    if (!clipboard) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      clipboard.write([new ClipboardItem({\r\n        [mime]: new Blob([data], {type: mime})\r\n      })]).catch((error) => {\r\n        //try pushing through text/plain\r\n        if (mime.startsWith(\"text\") && mime !== \"text/plain\") {\r\n          this.setClipboardData(name, \"text/plain\", data);\r\n        } else {\r\n          console.error(error);\r\n        }\r\n      });\r\n    } catch (error) {\r\n      console.log(error.stack);\r\n      console.log(\"failed to write to system clipboard\");\r\n    }\r\n  },\r\n  colorSchemeType: \"light\",\r\n  docManualPath  : \"../simple_docsys/doc_build/\",\r\n  docEditorPath  : \"../simple_docsys.js\",\r\n\r\n  //add textboxes to rollar sliders,\r\n  //note that  users can also double click them to\r\n  //enter text as well\r\n  useNumSliderTextboxes: true,\r\n\r\n  numSliderArrowLimit: 15, //threshold to check if numslider arrow was clicked\r\n  simpleNumSliders   : false,\r\n\r\n  menusCanPopupAbove: false,\r\n  menu_close_time   : 500,\r\n  doubleClickTime   : 500,\r\n\r\n  //timeout for press-and-hold (touch) version of double clicking\r\n  doubleClickHoldTime: 750,\r\n  DEBUG              : {\r\n    paranoidEvents      : false,\r\n    screenborders       : false,\r\n    areaContextPushes   : false,\r\n    allBordersMovable   : false,\r\n    doOnce              : false,\r\n    modalEvents         : false,\r\n    areaConstraintSolver: false,\r\n    datapaths           : false,\r\n\r\n    domEvents        : false,\r\n    domEventAddRemove: false,\r\n\r\n    debugUIUpdatePerf: false, //turns async FrameManager.update_intern loop into sync\r\n\r\n    screenAreaPosSizeAccesses: false,\r\n    buttonEvents             : false,\r\n\r\n    /*\r\n    customWindowSize: {\r\n      width: 2048, height: 2048\r\n    },\r\n    //*/\r\n  },\r\n\r\n  //auto load 1d bspline templates, can hurt startup time\r\n  autoLoadSplineTemplates: true,\r\n\r\n  addHelpPickers: true,\r\n\r\n  useAreaTabSwitcher : false,\r\n  autoSizeUpdate     : true,\r\n  showPathsInToolTips: true,\r\n\r\n  enableThemeAutoUpdate: true,\r\n  useNativeToolTips    : true,\r\n  noElectronMenus      : false,\r\n\r\n  loadConstants: function (args) {\r\n    for (let k in args) {\r\n      if (k === \"loadConstants\")\r\n        continue;\r\n\r\n      this[k] = args[k];\r\n    }\r\n\r\n    console.error(\"CC\", ctrlconfig);\r\n    ctrlconfig.setConfig(this);\r\n  }\r\n};\r\n\r\nexport default exports;\r\nwindow.DEBUG = exports.DEBUG;\r\n\r\nlet cfg = document.getElementById(\"pathux-config\");\r\nif (cfg) {\r\n  console.error(\"CONFIG CONFIG\", cfg.innerText);\r\n  exports.loadConstants(JSON.parse(cfg.innerText));\r\n}\r\n","/*\r\nTHEME REFACTOR:\r\n\r\n* Use CSS as much as possible\r\n* Create a compatibility layer\r\n\r\n*/\r\nimport * as util from \"../path-controller/util/util.js\";\r\nimport {Vector3, Vector4} from '../path-controller/util/vectormath.js';\r\nimport nstructjs from \"../path-controller/util/struct.js\";\r\nimport cconst from '../config/const.js';\r\n\r\nexport let compatMap = {\r\n  BoxMargin : \"padding\",\r\n  BoxBG : \"background\",\r\n  BoxRadius : \"border-radius\",\r\n  background : \"background-color\",\r\n  defaultWidth : \"width\",\r\n  defaultHeight : \"height\",\r\n  DefaultWidth : \"width\",\r\n  DefaultHeight : \"height\",\r\n  BoxBorder : \"border-color\",\r\n  BoxLineWidth : \"border-width\",\r\n  BoxSubBG : \"background-color\",\r\n  BoxSub2BG : \"background-color\",\r\n  DefaultPanelBG : \"background-color\",\r\n  InnerPanelBG : \"background-color\",\r\n  Background : \"background-color\",\r\n  numslider_width : \"width\",\r\n  numslider_height : \"height\",\r\n};\r\n\r\nexport let ColorSchemeTypes = {\r\n  LIGHT : \"light\",\r\n  DARK  : \"dark\"\r\n};\r\n\r\nexport function parsepx(css) {\r\n  return parseFloat(css.trim().replace(\"px\", \"\"))\r\n}\r\n\r\nexport function color2css(c, alpha_override) {\r\n  let r = ~~(c[0]*255);\r\n  let g = ~~(c[1]*255);\r\n  let b = ~~(c[2]*255);\r\n  let a = c.length < 4 ? 1.0 : c[3];\r\n\r\n  a = alpha_override !== undefined ? alpha_override : a;\r\n\r\n  if (c.length === 3 && alpha_override === undefined) {\r\n    return `rgb(${r},${g},${b})`;\r\n  } else {\r\n    return `rgba(${r},${g},${b}, ${a})`;\r\n  }\r\n}\r\nwindow.color2css = color2css;\r\n\r\nlet css2color_rets = util.cachering.fromConstructor(Vector4, 64);\r\nlet basic_colors = {\r\n  'white' : [1,1,1],\r\n  'grey' : [0.5, 0.5, 0.5],\r\n  'gray' : [0.5, 0.5, 0.5],\r\n  'black' : [0, 0, 0],\r\n  'red' : [1, 0, 0],\r\n  'yellow' : [1, 1, 0],\r\n  'green' : [0, 1, 0],\r\n  'teal' : [0, 1, 1],\r\n  'cyan' : [0, 1, 1],\r\n  'blue' : [0, 0, 1],\r\n  'orange' : [1, 0.5, 0.25],\r\n  'brown' : [0.5, 0.4, 0.3],\r\n  'purple' : [1, 0, 1],\r\n  'pink' : [1, 0.5, 0.5]\r\n};\r\n\r\nexport function color2web(color) {\r\n  function tostr(n) {\r\n    n = ~~(n*255);\r\n    let s = n.toString(16);\r\n\r\n    if (s.length > 2) {\r\n      s = s.slice(0, 2);\r\n    }\r\n\r\n    while (s.length < 2) {\r\n      s = \"0\" + s;\r\n    }\r\n\r\n    return s;\r\n  }\r\n\r\n  if (color.length === 3 || color[3] === 1.0) {\r\n    let r = tostr(color[0]);\r\n    let g = tostr(color[1]);\r\n    let b = tostr(color[2]);\r\n\r\n    return \"#\" + r + g + b;\r\n  } else {\r\n    let r = tostr(color[0]);\r\n    let g = tostr(color[1]);\r\n    let b = tostr(color[2]);\r\n    let a = tostr(color[3]);\r\n\r\n    return \"#\" + r + g + b + a;\r\n  }\r\n}\r\n\r\nwindow.color2web = color2web;\r\n\r\nexport function css2color(color) {\r\n  if (!color) {\r\n    return new Vector4([0,0,0,1]);\r\n  }\r\n\r\n  color = (\"\"+color).trim();\r\n\r\n  let ret = css2color_rets.next();\r\n\r\n  if (color[0] === \"#\") {\r\n    color = color.slice(1, color.length);\r\n    let parts = [];\r\n\r\n    for (let i=0; i<color.length>>1; i++) {\r\n      let part = \"0x\" + color.slice(i*2, i*2+2);\r\n      parts.push(parseInt(part));\r\n    }\r\n\r\n    ret.zero();\r\n    let i;\r\n    for (i=0; i<Math.min(parts.length, ret.length); i++) {\r\n      ret[i] = parts[i] / 255.0;\r\n    }\r\n\r\n    if (i < 4) {\r\n      ret[3] = 1.0;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  if (color in basic_colors) {\r\n    ret.load(basic_colors[color]);\r\n    ret[3] = 1.0;\r\n    return ret;\r\n  }\r\n\r\n  const hasAlpha = color.startsWith(\"rgba(\");\r\n  color = color.replace(\"rgba\", \"\").replace(\"rgb\", \"\").replace(/[\\(\\)]/g, \"\").trim().split(\",\")\r\n\r\n  for (let i=0; i<color.length; i++) {\r\n    ret[i] = parseFloat(color[i]);\r\n    if (i < 3) {\r\n      ret[i] /= 255;\r\n    }\r\n  }\r\n\r\n  if (ret.length === 3) {\r\n    ret.push(1.0);\r\n  }\r\n\r\n  if (!hasAlpha) {\r\n    ret[3] = 1.0;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nwindow.css2color = css2color\r\n\r\nexport function web2color(str) {\r\n  if (typeof str === \"string\" && str.trim()[0] !== \"#\") {\r\n    str = \"#\" + str.trim();\r\n  }\r\n\r\n  return css2color(str);\r\n}\r\nwindow.web2color = web2color;\r\n\r\nlet validate_pat = /\\#?[0-9a-fA-F]{6}([0-9a-fA-F]{2})?$/;\r\n\r\nexport function validateWebColor(str) {\r\n  if (typeof str !== \"string\" && !(str instanceof String))\r\n    return false;\r\n\r\n  return str.trim().search(validate_pat) === 0;\r\n}\r\n\r\nlet num = \"(([0-9]+\\.[0-9]+)|[0-9a-f]+)\";\r\n\r\nlet validate_rgba = new RegExp(`rgba\\\\(${num},${num},${num},${num}\\\\)$`);\r\nlet validate_rgb = new RegExp(`rgb\\\\(${num},${num},${num}\\\\)$`);\r\n\r\nexport function validateCSSColor(color) {\r\n  if (color.toLowerCase() in basic_colors) {\r\n    return true;\r\n  }\r\n\r\n  let rgba = color.toLowerCase().replace(/[ \\t]/g, \"\");\r\n  rgba = rgba.trim();\r\n\r\n  if (validate_rgba.test(rgba) || validate_rgb.exec(rgba)) {\r\n    return true;\r\n  }\r\n\r\n  return validateWebColor(color);\r\n}\r\n\r\nwindow.validateCSSColor = validateCSSColor;\r\n\r\nexport let theme = {};\r\n\r\nexport function invertTheme() {\r\n  cconst.colorSchemeType = cconst.colorSchemeType === ColorSchemeTypes.LIGHT ? ColorSchemeTypes.DARK : ColorSchemeTypes.LIGHT;\r\n\r\n  function inverted(color) {\r\n    if (Array.isArray(color)) {\r\n      for (let i = 0; i < 3; i++) {\r\n        color[i] = 1.0 - color[i];\r\n      }\r\n\r\n      return color;\r\n    }\r\n\r\n    color = css2color(color);\r\n    return color2css(inverted(color));\r\n  }\r\n\r\n  let bg = document.body.style[\"background-color\"];\r\n  //if (!bg) {\r\n  bg = cconst.colorSchemeType === ColorSchemeTypes.LIGHT ? \"rgb(200,200,200)\" : \"rgb(55, 55, 55)\";\r\n  //} else {\r\n  //  bg = inverted(bg);\r\n  //}\r\n\r\n  document.body.style[\"background-color\"] = bg;\r\n\r\n  for (let style in theme) {\r\n    style = theme[style];\r\n\r\n    for (let k in style) {\r\n      let v = style[k];\r\n\r\n      if (v instanceof CSSFont) {\r\n        v.color = inverted(v.color);\r\n      } else if (typeof v === \"string\") {\r\n        v = v.trim().toLowerCase();\r\n\r\n        let iscolor = v.search(\"rgb\") >= 0;\r\n        iscolor = iscolor || v in basic_colors;\r\n        iscolor = iscolor || validateWebColor(v);\r\n\r\n        if (iscolor) {\r\n          style[k] = inverted(v);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nwindow.invertTheme = invertTheme;\r\n\r\nexport function setColorSchemeType(mode) {\r\n  if (!!mode !== cconst.colorSchemeType) {\r\n    invertTheme();\r\n    cconst.colorSchemeType = mode;\r\n  }\r\n\r\n}\r\nwindow.validateWebColor = validateWebColor;\r\n\r\nlet _digest = new util.HashDigest();\r\n\r\nexport class CSSFont {\r\n  constructor(args={}) {\r\n    this._size = args.size ? args.size : 12;\r\n    this.font = args.font;\r\n    this.style = args.style !== undefined ? args.style : \"normal\";\r\n    this.weight = args.weight !== undefined ? args.weight : \"normal\";\r\n    this.variant = args.variant !== undefined ? args.variant : \"normal\";\r\n    this.color = args.color;\r\n  }\r\n\r\n  calcHashUpdate(digest=_digest.reset()) {\r\n    digest.add(this._size || 0);\r\n    digest.add(this.font);\r\n    digest.add(this.style);\r\n    digest.add(this.weight);\r\n    digest.add(this.variant);\r\n    digest.add(this.color);\r\n\r\n    return digest.get();\r\n  }\r\n\r\n  set size(val) {\r\n    this._size = val;\r\n  }\r\n\r\n  get size() {\r\n    if (util.isMobile()) {\r\n      let mul = theme.base.mobileTextSizeMultiplier / visualViewport.scale;\r\n      if (mul) {\r\n        return this._size * mul;;\r\n      }\r\n    }\r\n\r\n    return this._size;\r\n  }\r\n\r\n  copyTo(b) {\r\n    b._size = this._size;\r\n    b.font = this.font;\r\n    b.style = this.style;\r\n    b.color = this.color;\r\n    b.variant = this.variant;\r\n    b.weight = this.weight;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new CSSFont();\r\n    this.copyTo(ret);\r\n    return ret;\r\n  }\r\n\r\n  genCSS(size=this.size) {\r\n    return `${this.style} ${this.variant} ${this.weight} ${size}px ${this.font}`;\r\n  }\r\n\r\n  //deprecated, use genKey()\r\n  hash() {\r\n    return this.genKey();\r\n  }\r\n\r\n  genKey() {\r\n    let color = this.color;\r\n\r\n    if (typeof this.color === \"object\" || typeof this.color === \"function\") {\r\n      color = JSON.stringify(color);\r\n    }\r\n\r\n    return this.genCSS() + \":\" + this.size + \":\" + color;\r\n  }\r\n}\r\nCSSFont.STRUCT = `\r\nCSSFont {\r\n  size     : float | obj._size;\r\n  font     : string | obj.font || \"\";\r\n  style    : string | obj.font || \"\";\r\n  color    : string | \"\"+obj.color;\r\n  variant  : string | obj.variant || \"\";\r\n  weight   : string | \"\"+obj.weight;\r\n}\r\n`;\r\nnstructjs.register(CSSFont);\r\n\r\nexport function exportTheme(theme1=theme, addVarDecl=true) {\r\n  let sortkeys = (obj) => {\r\n    let keys = [];\r\n    for (let k in obj) {\r\n      keys.push(k);\r\n    }\r\n    keys.sort();\r\n\r\n    return keys;\r\n  }\r\n\r\n  let s = addVarDecl ? \"var theme = {\\n\" : \"{\\n\";\r\n\r\n  function writekey(v, indent=\"\") {\r\n    if (typeof v === \"string\") {\r\n      if (v.search(\"\\n\") >= 0) {\r\n        v = \"`\" + v + \"`\";\r\n      } else {\r\n        v = \"'\" + v + \"'\";\r\n      }\r\n\r\n      return v;\r\n    } else if (typeof v === \"object\") {\r\n      if (v instanceof CSSFont) {\r\n        return `new CSSFont({\r\n${indent}  font    : ${writekey(v.font)},\r\n${indent}  weight  : ${writekey(v.weight)},\r\n${indent}  variant : ${writekey(v.variant)},\r\n${indent}  style   : ${writekey(v.style)},\r\n${indent}  size    : ${writekey(v._size)},\r\n${indent}  color   : ${writekey(v.color)}\r\n${indent}})`;\r\n      } else {\r\n        let s = \"{\\n\";\r\n\r\n        for (let k of sortkeys(v)) {\r\n          let v2 = v[k];\r\n\r\n          if (k.search(\" \") >= 0 || k.search(\"-\") >= 0) {\r\n            k = \"'\" + k + \"'\";\r\n          }\r\n\r\n          s += indent + \"  \" + k + \" : \" + writekey(v2, indent + \"  \") + \",\\n\";\r\n        }\r\n\r\n        s += indent + \"}\";\r\n        return s;\r\n      }\r\n    } else {\r\n      return \"\"+v;\r\n    }\r\n\r\n    return \"error\";\r\n  }\r\n\r\n  for (let k of sortkeys(theme1)) {\r\n    let k2 = k;\r\n\r\n    if (k.search(/[- \\t.]/) >= 0) {\r\n      k2 = \"'\" + k + \"'\";\r\n    }\r\n    s += \"  \" + k2 + \": \";\r\n\r\n    let v = theme1[k];\r\n    if (typeof v !== \"object\" || v instanceof CSSFont) {\r\n      s += writekey(v, \"  \") + \",\\n\";\r\n    } else {\r\n      s += \" {\\n\"\r\n      let s2 = \"\";\r\n\r\n      let maxwid = 0;\r\n\r\n      for (let k2 of sortkeys(v)) {\r\n        if (k2.search(\"-\") >= 0 || k2.search(\" \") >= 0) {\r\n          k2 = \"'\" + k2 + \"'\";\r\n        }\r\n\r\n        maxwid = Math.max(maxwid, k2.length);\r\n      }\r\n\r\n      for (let k2 of sortkeys(v)) {\r\n        let v2 = v[k2];\r\n\r\n        if (k2.search(\"-\") >= 0 || k2.search(\" \") >= 0) {\r\n          k2 = \"'\" + k2 + \"'\";\r\n        }\r\n\r\n        let pad = \"\";\r\n\r\n        for (let i=0; i<maxwid-k2.length; i++) {\r\n          pad += \" \";\r\n        }\r\n\r\n        s2 += \"    \" + k2 + pad + \": \" + writekey(v2, \"    \") + \",\\n\";\r\n      }\r\n\r\n      s += s2;\r\n      s += \"  },\\n\\n\"\r\n    }\r\n  }\r\n  s += \"};\\n\";\r\n\r\n  return s;\r\n}\r\nwindow._exportTheme = exportTheme;\r\n\r\n","import {Vector2, Matrix4, Quat, Vector3, Vector4} from '../path-controller/util/vectormath.js';\r\nimport * as math from '../path-controller/util/math.js'\r\nimport {color2css, css2color, parsepx} from './ui_theme.js';\r\nimport {Curve1D, getCurve} from \"../path-controller/curve/curve1d.js\";\r\nimport * as util from '../path-controller/util/util.js';\r\n\r\nclass Task {\r\n  constructor(taskcb) {\r\n    this.task = taskcb;\r\n    this.start = util.time_ms();\r\n    this.done = false;\r\n  }\r\n}\r\n\r\nexport class AnimManager {\r\n  constructor() {\r\n    this.tasks = [];\r\n    this.timer = undefined;\r\n\r\n    //all animation tasks that last longer then 10 seconds are terminated\r\n    this.timeOut = 10*1000.0;\r\n  }\r\n\r\n  stop() {\r\n    if (this.timer !== undefined) {\r\n      window.clearInterval(this.timer);\r\n      this.timer = undefined;\r\n    }\r\n  }\r\n\r\n  add(task) {\r\n    this.tasks.push(new Task(task));\r\n  }\r\n\r\n  remove(task) {\r\n    for (let t of this.tasks) {\r\n      if (t.task === task) {\r\n        t.dead = true;\r\n        this.tasks.remove(t);\r\n        return;\r\n      }\r\n    }\r\n  }\r\n\r\n  start() {\r\n    this.timer = window.setInterval(() => {\r\n      for (let t of this.tasks) {\r\n        try {\r\n          t.task();\r\n        } catch (error) {\r\n          t.done = true;\r\n          util.print_stack(error);\r\n        }\r\n\r\n        if (util.time_ms() - t.start > this.timeOut) {\r\n          t.dead = true;\r\n        }\r\n      }\r\n\r\n      for (let i=0; i<this.tasks.length; i++) {\r\n        if (this.tasks[i].done) {\r\n          let t = this.tasks[i];\r\n          this.tasks.remove(t);\r\n          i--;\r\n\r\n          try {\r\n            if (t.task.onend) {\r\n              t.task.onend();\r\n            }\r\n          } catch (error) {\r\n            util.print_stack(error);\r\n          }\r\n        }\r\n      }\r\n    }, 1000/40.0);\r\n  }\r\n}\r\n\r\n\r\nexport const manager = new AnimManager();\r\nmanager.start();\r\n\r\nexport class AbstractCommand {\r\n  constructor() {\r\n    this.cbs = [];\r\n    this.end_cbs = [];\r\n  }\r\n\r\n  start(animator, done) {\r\n\r\n  }\r\n\r\n  exec(animator, done) {\r\n\r\n  }\r\n}\r\n\r\nexport class WaitCommand extends AbstractCommand {\r\n  constructor(ms) {\r\n    super();\r\n    this.ms = ms;\r\n  }\r\n\r\n  start(animator, done) {\r\n    this.time = animator.time;\r\n  }\r\n\r\n  exec(animator, done) {\r\n    if (animator.time - this.time > this.ms) {\r\n      done();\r\n    }\r\n  }\r\n}\r\n\r\nexport class GoToCommand extends AbstractCommand {\r\n  constructor(obj, key, value, time, curve=\"ease\") {\r\n    super();\r\n\r\n    this.object = obj;\r\n    this.key = key;\r\n    this.value = value;\r\n    this.ms = time;\r\n\r\n    if (typeof curve === \"string\") {\r\n      this.curve = new (getCurve(curve))();\r\n    } else {\r\n      this.curve = curve;\r\n    }\r\n  }\r\n\r\n  start(animator, done) {\r\n    this.time = animator.time;\r\n\r\n    let value = this.object[this.key];\r\n\r\n    if (Array.isArray(value)) {\r\n      this.startValue = util.list(value);\r\n    } else {\r\n      this.startValue = value;\r\n    }\r\n  }\r\n\r\n  exec(animator, done) {\r\n    let t = animator.time - this.time;\r\n    let ms = this.ms;\r\n\r\n    if (t > ms) {\r\n      done();\r\n      t = ms;\r\n    }\r\n\r\n    t /= ms;\r\n\r\n    t = this.curve.evaluate(t);\r\n\r\n    if (Array.isArray(this.startValue)) {\r\n      let value = this.object[this.key];\r\n\r\n      for (let i=0; i<this.startValue.length; i++) {\r\n        if (value[i] === undefined || this.value[i] === undefined) {\r\n          continue;\r\n        }\r\n\r\n        value[i] = this.startValue[i] + (this.value[i] - this.startValue[i]) * t;\r\n      }\r\n    } else {\r\n      this.object[this.key] = this.startValue + (this.value - this.startValue) * t;\r\n\r\n    }\r\n  }\r\n}\r\n\r\nexport class SetCommand extends AbstractCommand {\r\n  constructor(obj, key, val) {\r\n    super();\r\n\r\n    this.object = obj;\r\n    this.key = key;\r\n    this.value = val;\r\n  }\r\n\r\n  start(animator, done) {\r\n    this.object[key] = val;\r\n    done();\r\n  }\r\n}\r\n\r\nexport class Command {\r\n  constructor(type, args) {\r\n    this.args = args;\r\n    this.cbs = [];\r\n  }\r\n}\r\n\r\nexport class Animator {\r\n  constructor(owner, method = \"update\") {\r\n    this.on_tick = this.on_tick.bind(this);\r\n    this.on_tick.onend = () => {\r\n      if (this.onend) {\r\n        this.onend();\r\n      }\r\n    }\r\n\r\n    this.commands = [];\r\n    this.owner = owner;\r\n    this._done = false;\r\n    this.method = method;\r\n    this.onend = null;\r\n    this.first = true;\r\n\r\n    this.time = 0.0;\r\n    this.last = util.time_ms();\r\n\r\n    this.bind(owner);\r\n  }\r\n\r\n  bind(owner) {\r\n    this._done = false;\r\n    this.owner = owner;\r\n    //this.owner[this.method].after(this.on_tick);\r\n    manager.add(this.on_tick);\r\n  }\r\n\r\n  wait(ms) {\r\n    this.commands.push(new WaitCommand(ms));\r\n    return this;\r\n  }\r\n\r\n  goto(key, val, timeMs, curve = \"ease\") {\r\n    let cmd = new GoToCommand(this.owner, key, val, timeMs, curve);\r\n    this.commands.push(cmd);\r\n    return this;\r\n  }\r\n\r\n  set(key, val, time) {\r\n    let cmd = new SetCommand(this.owner, key, val);\r\n    this.commands.push(cmd);\r\n    return this;\r\n  }\r\n\r\n  while(cb) {\r\n    this.commands[this.commands.length - 1].cbs.push(cb);\r\n    return this;\r\n  }\r\n\r\n  then(cb) {\r\n    this.commands[this.commands.length-1].end_cbs.push(cb);\r\n    return this;\r\n  }\r\n\r\n  end() {\r\n    if (this._done) {\r\n      return;\r\n    }\r\n\r\n    this._done = true;\r\n    manager.remove(this.on_tick);\r\n    //this.owner.update.remove(this.on_tick);\r\n\r\n    if (this.onend) {\r\n      this.onend();\r\n    }\r\n  }\r\n\r\n  on_tick() {\r\n    if (this._done) {\r\n      throw new Error(\"animation wasn't properly cleaned up\");\r\n    }\r\n\r\n    let dt = util.time_ms() - this.last;\r\n    this.time += dt;\r\n    this.last = util.time_ms();\r\n\r\n    if (this.commands.length === 0) {\r\n      this.end();\r\n      return\r\n    }\r\n\r\n    let cmd = this.commands[0];\r\n    let done = false;\r\n\r\n    function donecb() {\r\n      done = true;\r\n    }\r\n\r\n    if (this.first) {\r\n      this.first = false;\r\n      //console.log(cmd, cmd.start)\r\n      cmd.start(this, donecb);\r\n    }\r\n\r\n    try {\r\n      cmd.exec(this, donecb);\r\n    } catch (error) {\r\n      done = true;\r\n      util.print_stack(error);\r\n    }\r\n\r\n    for (let cb of this.commands[0].cbs) {\r\n      try {\r\n        cb();\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n      }\r\n    }\r\n\r\n    if (done) {\r\n      for (let cb of this.commands[0].end_cbs) {\r\n        try {\r\n          cb();\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n        }\r\n      }\r\n      while (this.commands.length > 0) {\r\n        this.commands.shift();\r\n\r\n        done = false;\r\n\r\n        if (this.commands.length > 0) {\r\n          this.commands[0].start(this, donecb);\r\n        }\r\n\r\n        if (!done) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","export class token {\r\n  constructor(type, val, lexpos, lexlen, lineno, lexer, parser) {\r\n    this.type = type;\r\n    this.value = val;\r\n    this.lexpos = lexpos;\r\n    this.lexlen = lexlen;\r\n    this.lineno = lineno;\r\n    this.lexer = lexer;\r\n    this.parser = parser;\r\n  }\r\n\r\n  setValue(val) {\r\n    this.value = val;\r\n    return this;\r\n  }\r\n\r\n  toString() {\r\n    if (this.value !== undefined)\r\n      return \"token(type=\" + this.type + \", value='\" + this.value + \"')\"\r\n    else\r\n      return \"token(type=\" + this.type + \")\"\r\n  }\r\n}\r\n\r\n//func is optional. it takes a function\r\n//with one parameter, token, and either\r\n//a) returns the token, or b) returns\r\n//undefined, in which case the token\r\n//should be ignored by the lexer\r\nexport class tokdef {\r\n  constructor(name, regexpr, func) {\r\n    this.name = name;\r\n    this.re = regexpr\r\n    this.func = func\r\n  }\r\n}\r\n\r\nexport class PUTLParseError extends Error {\r\n}\r\n\r\n//errfunc is optional.  it requires\r\n//a function that takes one param, lexer,\r\n//and returns true if the lexer\r\n//should propegate an error when an error\r\n//has happened\r\nexport class lexer {\r\n  constructor(tokdef, errfunc) {\r\n    this.tokdef = tokdef;\r\n    this.tokens = new Array();\r\n    this.lexpos = 0;\r\n    this.lexdata = \"\";\r\n    this.lineno = 0;\r\n    this.errfunc = errfunc;\r\n    this.tokints = {}\r\n    this.print_tokens = false;\r\n    this.print_debug = false;\r\n\r\n    for (let i = 0; i < tokdef.length; i++) {\r\n      this.tokints[tokdef[i].name] = i;\r\n    }\r\n\r\n    this.statestack = [[\"__main__\", 0]];\r\n    this.states = {\"__main__\": [tokdef, errfunc]};\r\n    this.statedata = 0; //public variable\r\n  }\r\n\r\n  copy() {\r\n    let ret = new lexer(this.tokdef, this.errfunc);\r\n\r\n    for (let k in this.states) {\r\n      let state = this.states[k];\r\n\r\n      state = [state[0], state[1]];\r\n      ret.states[k] = state;\r\n    }\r\n\r\n    ret.statedata = this.statedata;\r\n\r\n    return ret;\r\n  }\r\n\r\n//errfunc is optional, defines state-specific error function\r\n  add_state(name, tokdef, errfunc) {\r\n    if (errfunc === undefined) {\r\n      errfunc = function (lexer) {\r\n        return true;\r\n      };\r\n    }\r\n\r\n    this.states[name] = [tokdef, errfunc];\r\n  }\r\n\r\n  tok_int(name) {\r\n\r\n  }\r\n\r\n  //statedata is optional.\r\n  //it stores state-specific data in lexer.statedata.\r\n  push_state(state, statedata) {\r\n    this.statestack.push([state, statedata])\r\n\r\n    state = this.states[state];\r\n    this.statedata = statedata;\r\n\r\n    this.tokdef = state[0];\r\n    this.errfunc = state[1];\r\n  }\r\n\r\n  pop_state() {\r\n    let item = this.statestack[this.statestack.length - 1];\r\n    let state = this.states[item[0]];\r\n\r\n    this.tokdef = state[0];\r\n    this.errfunc = state[1];\r\n    this.statedata = item[1];\r\n  }\r\n\r\n  input(str) {\r\n    //go back to main state\r\n    while (this.statestack.length > 1) {\r\n      this.pop_state();\r\n    }\r\n\r\n    this.lexdata = str;\r\n    this.lexpos = 0;\r\n    this.lineno = 0;\r\n    this.tokens = new Array();\r\n\r\n    this.peeked_tokens = [];\r\n  }\r\n\r\n  error() {\r\n    if (this.errfunc !== undefined && !this.errfunc(this))\r\n      return;\r\n\r\n    console.log(\"Syntax error near line \" + this.lineno);\r\n    let next = Math.min(this.lexpos + 8, this.lexdata.length);\r\n    console.log(\"  \" + this.lexdata.slice(this.lexpos, next));\r\n\r\n    throw new PUTLParseError(\"Parse error\");\r\n  }\r\n\r\n  peek() {\r\n    let tok = this.next(true);\r\n\r\n    if (tok === undefined)\r\n      return undefined;\r\n\r\n    this.peeked_tokens.push(tok);\r\n    return tok;\r\n  }\r\n\r\n\r\n  peek_i(i) {\r\n    while (this.peeked_tokens.length <= i) {\r\n      let t = this.peek();\r\n      if (t === undefined)\r\n        return undefined;\r\n    }\r\n\r\n    return this.peeked_tokens[i];\r\n  }\r\n\r\n  at_end() {\r\n    return this.lexpos >= this.lexdata.length && this.peeked_tokens.length === 0;\r\n  }\r\n\r\n  next(ignore_peek) {\r\n    if (ignore_peek !== true && this.peeked_tokens.length > 0) {\r\n      let tok = this.peeked_tokens[0];\r\n\r\n      if (this.print_debug) {\r\n        console.log(\"PEEK_SHIFTING\", \"\" + tok);\r\n      }\r\n\r\n      this.peeked_tokens.shift();\r\n\r\n      if (this.print_tokens) {\r\n        console.log(tok.toString());\r\n      }\r\n\r\n      return tok;\r\n    }\r\n\r\n    if (this.lexpos >= this.lexdata.length)\r\n      return undefined;\r\n\r\n    let ts = this.tokdef;\r\n    let tlen = ts.length;\r\n\r\n    let lexdata = this.lexdata.slice(this.lexpos, this.lexdata.length);\r\n\r\n    let results = []\r\n\r\n    for (let i = 0; i < tlen; i++) {\r\n      let t = ts[i];\r\n\r\n      if (t.re === undefined)\r\n        continue;\r\n\r\n      let res = t.re.exec(lexdata);\r\n\r\n      if (res !== null && res !== undefined && res.index === 0) {\r\n        results.push([t, res]);\r\n      }\r\n    }\r\n\r\n    let max_res = 0;\r\n    let theres = undefined;\r\n    for (let i = 0; i < results.length; i++) {\r\n      let res = results[i];\r\n\r\n      if (res[1][0].length > max_res) {\r\n        theres = res;\r\n        max_res = res[1][0].length;\r\n      }\r\n    }\r\n\r\n    if (theres === undefined) {\r\n      this.error();\r\n      return;\r\n    }\r\n\r\n    let def = theres[0];\r\n\r\n    let lexlen = max_res;\r\n    let tok = new token(def.name, theres[1][0], this.lexpos, lexlen, this.lineno, this, undefined);\r\n    this.lexpos += max_res;\r\n\r\n    if (def.func) {\r\n      tok = def.func(tok)\r\n\r\n      if (tok === undefined) {\r\n        return this.next(ignore_peek);\r\n      }\r\n    }\r\n\r\n    if (this.print_tokens) {\r\n      console.log(tok.toString());\r\n    }\r\n\r\n    if (!ignore_peek && this.print_debug) {\r\n      console.log(\"CONSUME\", tok.toString(), \"\\n\" + getTraceBack());\r\n    }\r\n\r\n    return tok;\r\n  }\r\n}\r\n\r\nexport function getTraceBack(limit, start) {\r\n  try {\r\n    throw new Error();\r\n  } catch (error) {\r\n    let stack = error.stack.split(\"\\n\");\r\n    stack = stack.slice(1, stack.length);\r\n\r\n    if (start === undefined) {\r\n      start = 0;\r\n    }\r\n\r\n    for (let i = 0; i < stack.length; i++) {\r\n      let l = stack[i];\r\n\r\n      let j = l.length - 1;\r\n      while (j > 0 && l[j] !== \"/\") {\r\n        j--;\r\n      }\r\n\r\n      let k = j;\r\n      while (k >= 0 && l[k] !== \"(\") {\r\n        k--;\r\n      }\r\n\r\n      let func = l.slice(0, k).trim();\r\n      let file = l.slice(j + 1, l.length - 1);\r\n\r\n      l = `  ${func} (${file})`;\r\n\r\n      if (l.search(/parseutil\\.js/) >= 0) {\r\n        start = Math.max(start, i);\r\n      }\r\n      stack[i] = l;\r\n    }\r\n\r\n    if (limit !== undefined) {\r\n      stack.length = Math.min(stack.length, limit);\r\n    }\r\n\r\n    if (start !== undefined) {\r\n      stack = stack.slice(start, stack.length);\r\n    }\r\n\r\n    stack = stack.join(\"\\n\");\r\n    return stack;\r\n  }\r\n}\r\n\r\nexport class parser {\r\n  constructor(lexer, errfunc) {\r\n    this.lexer = lexer;\r\n    this.errfunc = errfunc;\r\n    this.start = undefined;\r\n    this.userdata = undefined;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new parser(this.lexer.copy(), this.errfunc);\r\n    ret.start = this.start;\r\n\r\n    return ret;\r\n  }\r\n\r\n\r\n  parse(data, err_on_unconsumed) {\r\n    if (err_on_unconsumed === undefined)\r\n      err_on_unconsumed = true;\r\n\r\n    if (data !== undefined)\r\n      this.lexer.input(data);\r\n\r\n    let ret = this.start(this);\r\n\r\n    if (err_on_unconsumed && !this.lexer.at_end() && this.lexer.next() !== undefined) {\r\n      //console.log(this.lexer.lexdata.slice(this.lexer.lexpos-1, this.lexer.lexdata.length));\r\n      this.error(undefined, \"parser did not consume entire input\");\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  input(data) {\r\n    this.lexer.input(data);\r\n  }\r\n\r\n  error(tok, msg) {\r\n    if (msg === undefined)\r\n      msg = \"\"\r\n\r\n    let estr;\r\n\r\n    if (tok === undefined)\r\n      estr = \"Parse error at end of input: \" + msg\r\n    else\r\n      estr = \"Parse error at line \" + (tok.lineno + 1) + \": \" + msg;\r\n\r\n    let buf = \"1| \"\r\n    let ld = this.lexer.lexdata;\r\n    let l = 1;\r\n    for (let i = 0; i < ld.length; i++) {\r\n      let c = ld[i];\r\n      if (c === '\\n') {\r\n        l++;\r\n        buf += \"\\n\" + l + \"| \"\r\n      } else {\r\n        buf += c;\r\n      }\r\n    }\r\n\r\n    console.log(\"------------------\")\r\n    console.log(buf);\r\n    console.log(\"==================\")\r\n    console.log(estr);\r\n\r\n    if (this.errfunc && !this.errfunc(tok)) {\r\n      return;\r\n    }\r\n\r\n    throw new PUTLParseError(estr);\r\n  }\r\n\r\n  peek() {\r\n    let tok = this.lexer.peek();\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n\r\n    return tok;\r\n  }\r\n\r\n  peek_i(i) {\r\n    let tok = this.lexer.peek_i(i);\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n\r\n    return tok;\r\n  }\r\n\r\n  peeknext() {\r\n    return this.peek_i(0);\r\n  }\r\n\r\n  next() {\r\n    let tok = this.lexer.next();\r\n\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n\r\n    return tok;\r\n  }\r\n\r\n  optional(type) {\r\n    let tok = this.peek_i(0);\r\n\r\n    if (tok && tok.type === type) {\r\n      this.next();\r\n\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  at_end() {\r\n    return this.lexer.at_end();\r\n  }\r\n\r\n  expect(type, msg) {\r\n    let tok = this.next();\r\n\r\n    if (msg === undefined)\r\n      msg = type\r\n\r\n    if (tok === undefined || tok.type != type) {\r\n      this.error(tok, \"Expected \" + msg + \", not \" + tok.type);\r\n    }\r\n\r\n    return tok.value;\r\n  }\r\n}\r\n\r\nfunction test_parser() {\r\n  let basic_types = new set([\r\n    \"int\",\r\n    \"float\",\r\n    \"double\",\r\n    \"vec2\",\r\n    \"vec3\",\r\n    \"vec4\",\r\n    \"mat4\",\r\n    \"string\"]);\r\n\r\n  let reserved_tokens = new set([\r\n    \"int\",\r\n    \"float\",\r\n    \"double\",\r\n    \"vec2\",\r\n    \"vec3\",\r\n    \"vec4\",\r\n    \"mat4\",\r\n    \"string\",\r\n    \"static_string\",\r\n    \"array\"]);\r\n\r\n  function tk(name, re, func) {\r\n    return new tokdef(name, re, func);\r\n  }\r\n\r\n  let tokens = [\r\n    tk(\"ID\", /[a-zA-Z]+[a-zA-Z0-9_]*/, function (t) {\r\n      if (reserved_tokens.has(t.value)) {\r\n        t.type = t.value.toUpperCase();\r\n      }\r\n\r\n      return t;\r\n    }),\r\n    tk(\"OPEN\", /\\{/),\r\n    tk(\"CLOSE\", /}/),\r\n    tk(\"COLON\", /:/),\r\n    tk(\"JSCRIPT\", /\\|/, function (t) {\r\n      let js = \"\"\r\n      let lexer = t.lexer;\r\n      while (lexer.lexpos < lexer.lexdata.length) {\r\n        let c = lexer.lexdata[lexer.lexpos];\r\n        if (c === \"\\n\")\r\n          break;\r\n\r\n        js += c;\r\n        lexer.lexpos++;\r\n      }\r\n\r\n      if (js.endsWith(\";\")) {\r\n        js = js.slice(0, js.length - 1);\r\n        lexer.lexpos--;\r\n      }\r\n\r\n      t.value = js;\r\n      return t;\r\n    }),\r\n\r\n    tk(\"LPARAM\", /\\(/),\r\n    tk(\"RPARAM\", /\\)/),\r\n    tk(\"COMMA\", /,/),\r\n    tk(\"NUM\", /[0-9]/),\r\n    tk(\"SEMI\", /;/),\r\n    tk(\"NEWLINE\", /\\n/, function (t) {\r\n      t.lexer.lineno += 1;\r\n    }),\r\n    tk(\"SPACE\", / |\\t/, function (t) {\r\n      //throw out non-newline whitespace tokens\r\n    })\r\n  ];\r\n\r\n  for (let rt in reserved_tokens) {\r\n    tokens.push(tk(rt.toUpperCase()));\r\n  }\r\n\r\n  /*let a =\r\n  Loop {\r\n    eid : int;\r\n    flag : int;\r\n    index : int;\r\n    type : int;\r\n\r\n    co : vec3;\r\n    no : vec3;\r\n    loop : int | eid(loop);\r\n    edges : array(e, int) | e.eid;\r\n\r\n    loops : array(Loop);\r\n  }\r\n  `;\r\n  */\r\n\r\n  function errfunc(lexer) {\r\n    return true; //throw error\r\n  }\r\n\r\n  let lex = new lexer(tokens, errfunc)\r\n  console.log(\"Testing lexical scanner...\")\r\n\r\n  lex.input(a);\r\n\r\n  let tok;\r\n  while (tok = lex.next()) {\r\n    console.log(tok.toString())\r\n  }\r\n\r\n  let parser = new parser(lex);\r\n  parser.input(a);\r\n\r\n  function p_Array(p) {\r\n    p.expect(\"ARRAY\");\r\n    p.expect(\"LPARAM\");\r\n\r\n    let arraytype = p_Type(p);\r\n    let itername = \"\";\r\n\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = arraytype;\r\n      arraytype = p_Type(p);\r\n    }\r\n\r\n\r\n    p.expect(\"RPARAM\");\r\n\r\n    return {type: \"array\", data: {type: arraytype, iname: itername}};\r\n  }\r\n\r\n  function p_Type(p) {\r\n    let tok = p.peek()\r\n\r\n    if (tok.type === \"ID\") {\r\n      p.next();\r\n      return {type: \"struct\", data: \"\\\"\" + tok.value + \"\\\"\"};\r\n    } else if (basic_types.has(tok.type.toLowerCase())) {\r\n      p.next();\r\n      return {type: tok.type.toLowerCase()};\r\n    } else if (tok.type === \"ARRAY\") {\r\n      return p_Array(p);\r\n    } else {\r\n      p.error(tok, \"invalid type \" + tok.type); //(tok.value === \"\" ? tok.type : tok.value));\r\n    }\r\n  }\r\n\r\n  function p_Field(p) {\r\n    let field = {}\r\n\r\n    console.log(\"-----\", p.peek().type);\r\n\r\n    field.name = p.expect(\"ID\", \"struct field name\");\r\n    p.expect(\"COLON\");\r\n\r\n    field.type = p_Type(p);\r\n    field.set = undefined;\r\n    field.get = undefined;\r\n\r\n    let tok = p.peek();\r\n    if (tok.type === \"JSCRIPT\") {\r\n      field.get = tok.value;\r\n      p.next()\r\n    }\r\n\r\n    tok = p.peek();\r\n    if (tok.type === \"JSCRIPT\") {\r\n      field.set = tok.value;\r\n      p.next();\r\n    }\r\n\r\n    p.expect(\"SEMI\");\r\n\r\n    return field;\r\n  }\r\n\r\n  function p_Struct(p) {\r\n    let st = {}\r\n    st.name = p.expect(\"ID\", \"struct name\")\r\n    st.fields = [];\r\n\r\n    p.expect(\"OPEN\");\r\n\r\n    while (1) {\r\n      if (p.at_end()) {\r\n        p.error(undefined);\r\n      } else if (p.optional(\"CLOSE\")) {\r\n        break;\r\n      } else {\r\n        st.fields.push(p_Field(p));\r\n      }\r\n    }\r\n\r\n    return st;\r\n  }\r\n\r\n  let ret = p_Struct(parser);\r\n\r\n  console.log(JSON.stringify(ret));\r\n}\r\n","import {PropFlags, PropTypes} from '../toolsys/toolprop_abstract.js';\r\nimport {Quat, Vector2, Vector3, Vector4} from '../util/vectormath.js';\r\nimport * as toolprop_abstract from '../toolsys/toolprop_abstract.js';\r\nimport * as toolprop from '../toolsys/toolprop.js';\r\nimport {print_stack, cachering} from '../util/util.js';\r\n\r\nexport const DataFlags = {\r\n  READ_ONLY             : 1,\r\n  USE_CUSTOM_GETSET     : 2,\r\n  USE_FULL_UNDO         : 4, //DataPathSetOp in controller_ops.js saves/loads entire file for undo/redo\r\n  USE_CUSTOM_PROP_GETTER: 8,\r\n};\r\n\r\n\r\nexport const DataTypes = {\r\n  STRUCT        : 0,\r\n  DYNAMIC_STRUCT: 1,\r\n  PROP          : 2,\r\n  ARRAY         : 3\r\n};\r\n\r\nlet propCacheRings = {};\r\n\r\nexport function getTempProp(type) {\r\n  if (!(type in propCacheRings)) {\r\n    propCacheRings[type] = cachering.fromConstructor(ToolProperty.getClass(type), 32);\r\n  }\r\n\r\n  return propCacheRings[type].next();\r\n}\r\n\r\nexport class DataPathError extends Error {\r\n};\r\n\r\n\r\nexport function getVecClass(proptype) {\r\n  switch (proptype) {\r\n    case PropTypes.VEC2:\r\n      return Vector2;\r\n    case PropTypes.VEC3:\r\n      return Vector3;\r\n    case PropTypes.VEC4:\r\n      return Vector4;\r\n    case PropTypes.QUAT:\r\n      return Quat;\r\n    default:\r\n      throw new Error(\"bad prop type \" + proptype);\r\n  }\r\n}\r\n\r\nexport function isVecProperty(prop) {\r\n  if (!prop || typeof prop !== \"object\" || prop === null)\r\n    return false;\r\n\r\n  let ok = false;\r\n\r\n  ok = ok || prop instanceof toolprop_abstract.Vec2PropertyIF;\r\n  ok = ok || prop instanceof toolprop_abstract.Vec3PropertyIF;\r\n  ok = ok || prop instanceof toolprop_abstract.Vec4PropertyIF;\r\n  ok = ok || prop instanceof toolprop.Vec2Property;\r\n  ok = ok || prop instanceof toolprop.Vec3Property;\r\n  ok = ok || prop instanceof toolprop.Vec4Property;\r\n\r\n  ok = ok || prop.type === PropTypes.VEC2;\r\n  ok = ok || prop.type === PropTypes.VEC3;\r\n  ok = ok || prop.type === PropTypes.VEC4;\r\n  ok = ok || prop.type === PropTypes.QUAT;\r\n\r\n  return ok;\r\n}\r\n\r\nexport class DataPath {\r\n  constructor(path, apiname, prop, type = DataTypes.PROP) {\r\n    this.type = type;\r\n    this.data = prop;\r\n    this.apiname = apiname;\r\n    this.path = path;\r\n    this.flag = 0;\r\n    this.struct = undefined;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new DataPath();\r\n\r\n    ret.flag = this.flag;\r\n    ret.type = this.type;\r\n    ret.data = this.data;\r\n    ret.apiname = this.apiname;\r\n    ret.path = this.path;\r\n    ret.struct = this.struct;\r\n\r\n    return ret;\r\n  }\r\n\r\n  /** this property should not be treated as something\r\n   *  that should be kept track off in the undo stack*/\r\n  noUndo() {\r\n    this.data.flag |= PropFlags.NO_UNDO;\r\n    return this;\r\n  }\r\n\r\n  setProp(prop) {\r\n    this.data = prop;\r\n  }\r\n\r\n  readOnly() {\r\n    this.flag |= DataFlags.READ_ONLY;\r\n\r\n    if (this.type === DataTypes.PROP) {\r\n      this.data.flag |= PropFlags.READ_ONLY;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  read_only() {\r\n    console.warn(\"DataPath.read_only is deprecated; use readOnly\");\r\n    return this.readOnly();\r\n  }\r\n\r\n  /** used to override tool property settings,\r\n   *  e.g. ranges, units, etc; returns a\r\n   *  base class instance of ToolProperty.\r\n   *\r\n   *  The this context points to the original ToolProperty and contains\r\n   *  a few useful references:\r\n   *\r\n   *  this.dataref - an object instance of this struct type\r\n   *  this.ctx - a context\r\n   *\r\n   *  callback takes one argument, a new (freshly copied of original)\r\n   *  tool property to modify\r\n   *\r\n   * */\r\n  customPropCallback(callback) {\r\n    this.flag |= DataFlags.USE_CUSTOM_PROP_GETTER;\r\n    this.data.flag |= PropFlags.USE_CUSTOM_PROP_GETTER;\r\n    this.propGetter = callback;\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * For the callbacks 'this' points to an internal ToolProperty;\r\n   * Referencing object lives in 'this.dataref'; calling context in 'this.ctx';\r\n   * and the datapath is 'this.datapath'\r\n   **/\r\n  customGetSet(get, set) {\r\n    this.flag |= DataFlags.USE_CUSTOM_GETSET;\r\n\r\n    if (this.type !== DataTypes.DYNAMIC_STRUCT && this.type !== DataTypes.STRUCT) {\r\n      this.data.flag |= PropFlags.USE_CUSTOM_GETSET;\r\n      this.data._getValue = this.data.getValue;\r\n      this.data._setValue = this.data.setValue;\r\n\r\n      if (get)\r\n        this.data.getValue = get;\r\n\r\n      if (set)\r\n        this.data.setValue = set;\r\n    } else {\r\n      this.getSet = {\r\n        get, set\r\n      };\r\n\r\n      this.getSet.dataref = undefined;\r\n      this.getSet.datapath = undefined;\r\n      this.getSet.ctx = undefined;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  customSet(set) {\r\n    this.customGetSet(undefined, set);\r\n    return this;\r\n  }\r\n\r\n  customGet(get) {\r\n    this.customGetSet(get, undefined);\r\n    return this;\r\n  }\r\n\r\n  /**db will be executed with underlying data object\r\n   that contains this path in 'this.dataref'\r\n\r\n   main event is 'change'\r\n   */\r\n  on(type, cb) {\r\n    if (this.type == DataTypes.PROP) {\r\n      this.data.on(type, cb);\r\n    } else {\r\n      throw new Error(\"invalid call to DataPath.on\");\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  off(type, cb) {\r\n    if (this.type === DataTypes.PROP) {\r\n      this.data.off(type, cb);\r\n    }\r\n  }\r\n\r\n  simpleSlider() {\r\n    this.data.flag |= PropFlags.SIMPLE_SLIDER;\r\n    this.data.flag &= ~PropFlags.FORCE_ROLLER_SLIDER;\r\n    return this;\r\n  }\r\n\r\n  rollerSlider() {\r\n    this.data.flag &= ~PropFlags.SIMPLE_SLIDER;\r\n    this.data.flag |= PropFlags.FORCE_ROLLER_SLIDER;\r\n\r\n    return this;\r\n  }\r\n\r\n  checkStrip(state = true) {\r\n    if (state) {\r\n      this.data.flag |= PropFlags.FORCE_ENUM_CHECKBOXES;\r\n    } else {\r\n      this.data.flag &= ~PropFlags.FORCE_ENUM_CHECKBOXES;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  noUnits() {\r\n    this.baseUnit(\"none\");\r\n    this.displayUnit(\"none\");\r\n    return this;\r\n  }\r\n\r\n  baseUnit(unit) {\r\n    this.data.setBaseUnit(unit);\r\n    return this;\r\n  }\r\n\r\n  displayUnit(unit) {\r\n    this.data.setDisplayUnit(unit);\r\n    return this;\r\n  }\r\n\r\n  unit(unit) {\r\n    return this.baseUnit(unit).displayUnit(unit);\r\n  }\r\n\r\n  editAsBaseUnit() {\r\n    this.data.flag |= PropFlags.EDIT_AS_BASE_UNIT;\r\n    return this;\r\n  }\r\n\r\n  range(min, max) {\r\n    this.data.setRange(min, max);\r\n    return this;\r\n  }\r\n\r\n  uiRange(min, max) {\r\n    this.data.setUIRange(min, max);\r\n    return this;\r\n  }\r\n\r\n  decimalPlaces(n) {\r\n    this.data.setDecimalPlaces(n);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * like other callbacks (until I refactor it),\r\n   * func will be called with a mysterious object that stores\r\n   * the following properties:\r\n   *\r\n   * this.dataref  : owning object reference\r\n   * this.datactx  : ctx\r\n   * this.datapath : datapath\r\n   * */\r\n  uiNameGetter(func) {\r\n    this.ui_name_get = func;\r\n    return this;\r\n  }\r\n\r\n  expRate(exp) {\r\n    this.data.setExpRate(exp);\r\n    return this;\r\n  }\r\n\r\n  slideSpeed(speed) {\r\n    this.data.setSlideSpeed(speed);\r\n    return this;\r\n  }\r\n\r\n  /**adds a slider for moving vector component sliders simultaneously*/\r\n  uniformSlider(state = true) {\r\n    this.data.uniformSlider(state);\r\n\r\n    return this;\r\n  }\r\n\r\n  radix(r) {\r\n    this.data.setRadix(r);\r\n    return this;\r\n  }\r\n\r\n  relativeStep(s) {\r\n    this.data.setRelativeStep(s);\r\n    return this;\r\n  }\r\n\r\n  step(s) {\r\n    this.data.setStep(s);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Tell DataPathSetOp to save/load entire app state for undo/redo\r\n   *\r\n   * */\r\n  fullSaveUndo() {\r\n    this.flag |= DataFlags.USE_FULL_UNDO;\r\n    this.data.flag |= PropFlags.USE_BASE_UNDO;\r\n\r\n    return this;\r\n  }\r\n\r\n  icon(i) {\r\n    this.data.setIcon(i);\r\n    return this;\r\n  }\r\n\r\n  icon2(i) {\r\n    this.data.setIcon2(i);\r\n    return this;\r\n  }\r\n\r\n  icons(icons) { //for enum/flag properties\r\n    this.data.addIcons(icons);\r\n    return this;\r\n  }\r\n\r\n  /** secondary icons (e.g. disabled states) */\r\n  icons2(icons) {\r\n    this.data.addIcons2(icons);\r\n    return this;\r\n  }\r\n\r\n  descriptions(description_map) { //for enum/flag properties\r\n    this.data.addDescriptions(description_map);\r\n    return this;\r\n  }\r\n\r\n  uiNames(uinames) {\r\n    this.data.addUINames(uinames);\r\n    return this;\r\n  }\r\n\r\n  description(d) {\r\n    this.data.description = d;\r\n    return this;\r\n  }\r\n}\r\n\r\nexport const StructFlags = {\r\n  NO_UNDO: 1 //struct and its child structs can't participate in undo\r\n             //via the DataPathToolOp\r\n};\r\n\r\nexport class ListIface {\r\n  getStruct(api, list, key) {\r\n\r\n  }\r\n\r\n  get(api, list, key) {\r\n\r\n  }\r\n\r\n  getKey(api, list, obj) {\r\n\r\n  }\r\n\r\n  getActive(api, list) {\r\n\r\n  }\r\n\r\n  setActive(api, list, val) {\r\n\r\n  }\r\n\r\n  set(api, list, key, val) {\r\n    list[key] = val;\r\n  }\r\n\r\n  getIter() {\r\n\r\n  }\r\n\r\n  filter(api, list, filter) {\r\n\r\n  }\r\n}\r\n\r\nexport class ToolOpIface {\r\n  constructor() {\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"!untitled tool\",\r\n      icon       : -1,\r\n      toolpath   : \"logical_module.tool\", //logical_module need not match up to real module name\r\n      description: undefined,\r\n      is_modal   : false,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n};\r\n\r\n\r\nlet DataAPIClass = undefined;\r\n\r\nexport function setImplementationClass(cls) {\r\n  DataAPIClass = cls;\r\n}\r\n\r\nexport function registerTool(cls) {\r\n  if (DataAPIClass === undefined) {\r\n    throw new Error(\"data api not initialized properly; call setImplementationClass\");\r\n  }\r\n\r\n  return DataAPIClass.registerTool(cls);\r\n}\r\n","\"use strict\";\r\nimport nstructjs from '../util/struct.js';\r\n\r\n/**\r\n\r\n ToolOps are base operators for modifying application state.\r\n They operate on Contexts and can use the datapath API.\r\n They make up the undo stack.\r\n\r\n ToolOp subclasses handle undo with their undoPre (run before tool execution)\r\n and undo methods.  You can set default handlers (most commonly this is just\r\n saving/reloading the app state) with setDefaultUndoHandlers.\r\n\r\n ToolOps have inputs and outputs (which are ToolProperties) and can also\r\n be modal.\r\n\r\n ## Rules\r\n\r\n Tools are never, EVER allowed to store direct pointers to the application state,\r\n with one exception: tools in modal mode may store such pointers, but they must\r\n delete them when existing modal mode by overriding modalEnd.\r\n\r\n This is to prevent very evil and difficult to debug bugs in the undo stack\r\n and nasty memory leaks.\r\n\r\n ## Example\r\n\r\n <pre>\r\n\r\n const ExampleEnum = {\r\n  ITEM1 : 0,\r\n  ITEM2 : 1\r\n}\r\n\r\n class MyTool extends ToolOp {\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Tool Name\",\r\n      toolpath   : \"my.tool\",\r\n      inputs     : {\r\n          input1 : new IntProperty(),\r\n          input2 : new EnumProperty(0, ExampleEnum)\r\n      },\r\n      outputs    : {\r\n          someoutput : new IntProperty\r\n      }\r\n    }\r\n  }\r\n\r\n  undoPre(ctx) {\r\n    //run before tool starts\r\n  }\r\n\r\n  undo(ctx) {\r\n    //undo handler\r\n  }\r\n\r\n  execPre(ctx) {\r\n    //run right before exec\r\n  }\r\n  exec(ctx) {\r\n    //main execution method\r\n  }\r\n  execPost(ctx) {\r\n    //run right after exec\r\n  }\r\n}\r\n ToolOp.register(MyTool);\r\n\r\n </pre>\r\n */\r\n\r\nimport * as events from '../util/events.js';\r\nimport {keymap} from '../util/simple_events.js';\r\nimport {PropFlags, PropTypes} from './toolprop.js';\r\nimport {DataPath} from '../controller/controller_base.js';\r\nimport * as util from '../util/util.js';\r\n\r\nexport let ToolClasses = [];\r\nwindow._ToolClasses = ToolClasses;\r\n\r\nexport function setContextClass(cls) {\r\n  console.warn(\"setContextClass is deprecated\");\r\n}\r\n\r\nexport const ToolFlags = {\r\n  PRIVATE: 1\r\n\r\n};\r\n\r\n\r\nexport const UndoFlags = {\r\n  NO_UNDO      : 2,\r\n  IS_UNDO_ROOT : 4,\r\n  UNDO_BARRIER : 8,\r\n  HAS_UNDO_DATA: 16\r\n};\r\n\r\nclass InheritFlag {\r\n  constructor(slots = {}) {\r\n    this.slots = slots;\r\n  }\r\n}\r\n\r\nlet modalstack = [];\r\n\r\nlet defaultUndoHandlers = {\r\n  undoPre(ctx) {\r\n    throw new Error(\"implement me\");\r\n  },\r\n  undo(ctx) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n}\r\n\r\nexport function setDefaultUndoHandlers(undoPre, undo) {\r\n  if (!undoPre || !undo) {\r\n    throw new Error(\"invalid parameters to setDefaultUndoHandlers\");\r\n  }\r\n\r\n  defaultUndoHandlers.undoPre = undoPre;\r\n  defaultUndoHandlers.undo = undo;\r\n}\r\n\r\nexport class ToolPropertyCache {\r\n  constructor() {\r\n    this.map = new Map();\r\n    this.pathmap = new Map();\r\n    this.accessors = {};\r\n\r\n    this.userSetMap = new Set();\r\n\r\n    this.api = undefined;\r\n    this.dstruct = undefined;\r\n  }\r\n\r\n  static getPropKey(cls, key, prop) {\r\n    return prop.apiname && prop.apiname.length > 0 ? prop.apiname : key;\r\n  }\r\n\r\n  _buildAccessors(cls, key, prop, dstruct, api) {\r\n    let tdef = cls._getFinalToolDef();\r\n\r\n    this.api = api;\r\n    this.dstruct = dstruct;\r\n\r\n    if (!tdef.toolpath) {\r\n      console.warn(\"Bad tool property\", cls, \"it's tooldef was missing a toolpath field\");\r\n      return;\r\n    }\r\n\r\n    let path = tdef.toolpath.trim().split(\".\").filter(f => f.trim().length > 0);\r\n    let obj = this.accessors;\r\n\r\n    let st = dstruct;\r\n    let partial = \"\";\r\n\r\n    for (let i = 0; i < path.length; i++) {\r\n      let k = path[i];\r\n      let pathk = k;\r\n\r\n      if (i === 0) {\r\n        pathk = \"accessors.\" + k;\r\n      }\r\n\r\n      if (i > 0) {\r\n        partial += \".\";\r\n      }\r\n      partial += k;\r\n\r\n      if (!(k in obj)) {\r\n        obj[k] = {};\r\n      }\r\n\r\n      let st2 = api.mapStruct(obj[k], true, k);\r\n      if (!(k in st.pathmap)) {\r\n        st.struct(pathk, k, k, st2);\r\n      }\r\n      st = st2;\r\n\r\n      this.pathmap.set(partial, obj[k]);\r\n\r\n      obj = obj[k];\r\n    }\r\n\r\n    let name = prop.apiname !== undefined && prop.apiname.length > 0 ? prop.apiname : key;\r\n    let prop2 = prop.copy()\r\n\r\n    let dpath = new DataPath(name, name, prop2);\r\n    let uiname = prop.uiname;\r\n\r\n    if (!uiname || uiname.trim().length === 0) {\r\n      uiname = prop.apiname;\r\n    }\r\n    if (!uiname || uiname.trim().length === 0) {\r\n      uiname = key;\r\n    }\r\n\r\n    uiname = ToolProperty.makeUIName(uiname);\r\n\r\n    prop2.uiname = uiname;\r\n    prop2.description = prop2.description || prop2.uiname;\r\n\r\n    st.add(dpath);\r\n\r\n    obj[name] = prop2.getValue();\r\n  }\r\n\r\n  _getAccessor(cls) {\r\n    let toolpath = cls.tooldef().toolpath.trim();\r\n    return this.pathmap.get(toolpath);\r\n  }\r\n\r\n  useDefault(cls, key, prop) {\r\n    key = this.userSetMap.has(cls.tooldef().trim() + \".\" + this.constructor.getPropKey(key));\r\n    key = key.trim();\r\n\r\n    return key;\r\n  }\r\n\r\n  has(cls, key, prop) {\r\n    if (prop.flag & PropFlags.NO_DEFAULT) {\r\n      return false;\r\n    }\r\n\r\n    let obj = this._getAccessor(cls);\r\n\r\n    key = this.constructor.getPropKey(cls, key, prop);\r\n    return obj && key in obj;\r\n  }\r\n\r\n  get(cls, key, prop) {\r\n    if (cls === ToolMacro) {\r\n      return;\r\n    }\r\n\r\n    let obj = this._getAccessor(cls);\r\n    key = this.constructor.getPropKey(cls, key, prop);\r\n\r\n    if (obj) {\r\n      return obj[key];\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  set(cls, key, prop) {\r\n    if (cls === ToolMacro) {\r\n      return;\r\n    }\r\n\r\n    let toolpath = cls.tooldef().toolpath.trim();\r\n    let obj = this._getAccessor(cls);\r\n\r\n    if (!obj) {\r\n      console.warn(\"Warning, toolop \" + cls.name + \" was not in the default map; unregistered?\");\r\n      this._buildAccessors(cls, key, prop, this.dstruct, this.api);\r\n\r\n      obj = this.pathmap.get(toolpath);\r\n    }\r\n\r\n    if (!obj) {\r\n      console.error(\"Malformed toolpath in toolop definition: \" + toolpath);\r\n      return;\r\n    }\r\n\r\n    key = this.constructor.getPropKey(cls, key, prop);\r\n\r\n    //copy prop first in case we're a non-primitive-value type, e.g. vector properties\r\n    obj[key] = prop.copy().getValue();\r\n\r\n    let path = toolpath + \".\" + key;\r\n    this.userSetMap.add(path);\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nexport const SavedToolDefaults = new ToolPropertyCache();\r\n\r\nexport class ToolOp extends events.EventHandler {\r\n  /**\r\n   Main ToolOp constructor.  It reads the inputs/outputs properteis from\r\n   this.constructor.tooldef() and copies them to build this.inputs and this.outputs.\r\n   If inputs or outputs are wrapped in ToolOp.inherit(), it will walk up the class\r\n   chain to fetch parent class properties.\r\n\r\n\r\n   Default input values are loaded from SavedToolDefaults.  If initialized (buildToolSysAPI\r\n   has been called) SavedToolDefaults will have a copy of all the default\r\n   property values of all registered ToolOps.\r\n   **/\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this._pointerId = undefined;\r\n    this._overdraw = undefined;\r\n    this.__memsize = undefined;\r\n\r\n    var def = this.constructor.tooldef();\r\n\r\n    if (def.undoflag !== undefined) {\r\n      this.undoflag = def.undoflag;\r\n    }\r\n\r\n    if (def.flag !== undefined) {\r\n      this.flag = def.flag;\r\n    }\r\n\r\n    this._accept = this._reject = undefined;\r\n    this._promise = undefined;\r\n\r\n    for (var k in def) {\r\n      this[k] = def[k];\r\n    }\r\n\r\n    let getSlots = (slots, key) => {\r\n      if (slots === undefined)\r\n        return {};\r\n\r\n      if (!(slots instanceof InheritFlag)) {\r\n        return slots;\r\n      }\r\n\r\n      slots = {};\r\n      let p = this.constructor;\r\n      let lastp = undefined;\r\n\r\n      while (p !== undefined && p !== Object && p !== ToolOp && p !== lastp) {\r\n        if (p.tooldef) {\r\n          let def = p.tooldef();\r\n\r\n          if (def[key] !== undefined) {\r\n            let slots2 = def[key];\r\n            let stop = !(slots2 instanceof InheritFlag);\r\n\r\n            if (slots2 instanceof InheritFlag) {\r\n              slots2 = slots2.slots;\r\n            }\r\n\r\n            for (let k in slots2) {\r\n              if (!(k in slots)) {\r\n                slots[k] = slots2[k];\r\n              }\r\n            }\r\n\r\n            if (stop) {\r\n              break;\r\n            }\r\n          }\r\n        }\r\n\r\n        lastp = p;\r\n        p = p.prototype.__proto__.constructor;\r\n      }\r\n\r\n      return slots;\r\n    };\r\n\r\n    let dinputs = getSlots(def.inputs, \"inputs\");\r\n    let doutputs = getSlots(def.outputs, \"outputs\");\r\n\r\n    this.inputs = {};\r\n    this.outputs = {};\r\n\r\n    if (dinputs) {\r\n      for (let k in dinputs) {\r\n        let prop = dinputs[k].copy();\r\n        prop.apiname = prop.apiname && prop.apiname.length > 0 ? prop.apiname : k;\r\n\r\n        if (!this.hasDefault(prop, k)) {\r\n          this.inputs[k] = prop;\r\n          continue;\r\n        }\r\n\r\n        try {\r\n          prop.setValue(this.getDefault(prop, k));\r\n        } catch (error) {\r\n          console.log(error.stack);\r\n          console.log(error.message);\r\n        }\r\n\r\n        prop.wasSet = false;\r\n        this.inputs[k] = prop;\r\n      }\r\n    }\r\n\r\n    if (doutputs) {\r\n      for (let k in doutputs) {\r\n        let prop = doutputs[k].copy();\r\n        prop.apiname = prop.apiname && prop.apiname.length > 0 ? prop.apiname : k;\r\n\r\n        this.outputs[k] = prop;\r\n      }\r\n    }\r\n\r\n    this.drawlines = [];\r\n  }\r\n\r\n  /**\r\n   ToolOp definition.\r\n\r\n   An example:\r\n   <pre>\r\n   static tooldef() {\r\n    return {\r\n      uiname   : \"Tool Name\",\r\n      toolpath : \"logical_module.tool\", //logical_module need not match up to a real module\r\n      icon     : -1, //tool's icon, or -1 if there is none\r\n      description : \"tooltip\",\r\n      is_modal : false, //tool is interactive and takes control of events\r\n      hotkey   : undefined,\r\n      undoflag : 0, //see UndoFlags\r\n      flag     : 0,\r\n      inputs   : ToolOp.inherit({\r\n        f32val : new Float32Property(1.0),\r\n        path   : new StringProperty(\"./path\");\r\n      }),\r\n      outputs  : {}\r\n      }\r\n    }\r\n   </pre>\r\n   */\r\n  static tooldef() {\r\n    if (this === ToolOp) {\r\n      throw new Error(\"Tools must implemented static tooldef() methods!\");\r\n    }\r\n\r\n    return {};\r\n  }\r\n\r\n  /** Returns a map of input property values,\r\n   *  e.g. `let {prop1, prop2} = this.getValues()` */\r\n  getInputs() {\r\n    let ret = {};\r\n\r\n    for (let k in this.inputs) {\r\n      ret[k] = this.inputs[k].getValue();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  static Equals(a, b) {\r\n    if (!a || !b) return false;\r\n    if (a.constructor !== b.constructor) return false;\r\n\r\n    let bad = false;\r\n\r\n    for (let k in a.inputs) {\r\n      bad = bad || !(k in b.inputs);\r\n      bad = bad || a.inputs[k].constructor !== b.inputs[k];\r\n      bad = bad || !a.inputs[k].equals(b.inputs[k]);\r\n\r\n      if (bad) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return !bad;\r\n  }\r\n\r\n  static inherit(slots = {}) {\r\n    return new InheritFlag(slots);\r\n  }\r\n\r\n  /**\r\n\r\n   Creates a new instance of this toolop from args and a context.\r\n   This is often use to fill properties with default arguments\r\n   stored somewhere in the context.\r\n\r\n   */\r\n  static invoke(ctx, args) {\r\n    let tool = new this();\r\n\r\n    for (let k in args) {\r\n      if (!(k in tool.inputs)) {\r\n        console.warn(\"Unknown tool argument \" + k);\r\n        continue;\r\n      }\r\n\r\n      let prop = tool.inputs[k];\r\n      let val = args[k];\r\n\r\n      if ((typeof val === \"string\") && prop.type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n        if (val in prop.values) {\r\n          val = prop.values[val];\r\n        } else {\r\n          console.warn(\"Possible invalid enum/flag:\", val);\r\n          continue;\r\n        }\r\n      }\r\n\r\n      tool.inputs[k].setValue(val);\r\n    }\r\n\r\n    return tool;\r\n  }\r\n\r\n  static register(cls) {\r\n    if (ToolClasses.indexOf(cls) >= 0) {\r\n      console.warn(\"Tried to register same ToolOp class twice:\", cls.name, cls);\r\n      return;\r\n    }\r\n\r\n    ToolClasses.push(cls);\r\n  }\r\n\r\n  static _regWithNstructjs(cls, structName = cls.name) {\r\n    if (nstructjs.isRegistered(cls)) {\r\n      return;\r\n    }\r\n\r\n    let parent = cls.prototype.__proto__.constructor;\r\n\r\n    if (!cls.hasOwnProperty(\"STRUCT\")) {\r\n      if (parent !== ToolOp && parent !== ToolMacro && parent !== Object) {\r\n        this._regWithNstructjs(parent);\r\n      }\r\n\r\n      cls.STRUCT = nstructjs.inherit(cls, parent) + '}\\n';\r\n    }\r\n\r\n    nstructjs.register(cls);\r\n  }\r\n\r\n  static isRegistered(cls) {\r\n    return ToolClasses.indexOf(cls) >= 0;\r\n  }\r\n\r\n  static unregister(cls) {\r\n    if (ToolClasses.indexOf(cls) >= 0) {\r\n      ToolClasses.remove(cls);\r\n    }\r\n  }\r\n\r\n  static _getFinalToolDef() {\r\n    let def = this.tooldef();\r\n\r\n    let getSlots = (slots, key) => {\r\n      if (slots === undefined)\r\n        return {};\r\n\r\n      if (!(slots instanceof InheritFlag)) {\r\n        return slots;\r\n      }\r\n\r\n      slots = {};\r\n      let p = this\r\n\r\n      while (p !== undefined && p !== Object && p !== ToolOp) {\r\n        if (p.tooldef) {\r\n          let def = p.tooldef();\r\n\r\n          if (def[key] !== undefined) {\r\n            let slots2 = def[key];\r\n            let stop = !(slots2 instanceof InheritFlag);\r\n\r\n            if (slots2 instanceof InheritFlag) {\r\n              slots2 = slots2.slots;\r\n            }\r\n\r\n            for (let k in slots2) {\r\n              if (!(k in slots)) {\r\n                slots[k] = slots2[k];\r\n              }\r\n            }\r\n\r\n            if (stop) {\r\n              break;\r\n            }\r\n          }\r\n\r\n        }\r\n        p = p.prototype.__proto__.constructor;\r\n      }\r\n\r\n      return slots;\r\n    };\r\n\r\n    let dinputs = getSlots(def.inputs, \"inputs\");\r\n    let doutputs = getSlots(def.outputs, \"outputs\");\r\n\r\n    def.inputs = dinputs;\r\n    def.outputs = doutputs;\r\n\r\n    return def;\r\n  }\r\n\r\n  static onTick() {\r\n    for (let toolop of modalstack) {\r\n      toolop.on_tick();\r\n    }\r\n  }\r\n\r\n  static searchBoxOk(ctx) {\r\n    let flag = this.tooldef().flag;\r\n    let ret = !(flag && (flag & ToolFlags.PRIVATE));\r\n    ret = ret && this.canRun(ctx);\r\n\r\n    return ret;\r\n  }\r\n\r\n  //toolop is an optional instance of this class, may be undefined\r\n  static canRun(ctx, toolop = undefined) {\r\n    return true;\r\n  }\r\n\r\n  /** Called when the undo system needs to destroy\r\n   *  this toolop to save memory*/\r\n  onUndoDestroy() {\r\n\r\n  }\r\n\r\n  /** Used by undo system to limit memory */\r\n  calcMemSize(ctx) {\r\n    if (this.__memsize !== undefined) {\r\n      return this.__memsize;\r\n    }\r\n\r\n    let tot = 0;\r\n\r\n    for (let step = 0; step < 2; step++) {\r\n      let props = step ? this.outputs : this.inputs;\r\n\r\n      for (let k in props) {\r\n        let prop = props[k];\r\n\r\n        let size = prop.calcMemSize();\r\n\r\n        if (isNaN(size) || !isFinite(size)) {\r\n          console.warn(\"Got NaN when calculating mem size for property\", prop);\r\n          continue;\r\n        }\r\n\r\n        tot += size;\r\n      }\r\n    }\r\n\r\n    let size = this.calcUndoMem(ctx);\r\n\r\n    if (isNaN(size) || !isFinite(size)) {\r\n      console.warn(\"Got NaN in calcMemSize\", this);\r\n    } else {\r\n      tot += size;\r\n    }\r\n\r\n    this.__memsize = tot;\r\n\r\n    return tot;\r\n  }\r\n\r\n  loadDefaults(force = true) {\r\n    for (let k in this.inputs) {\r\n      let prop = this.inputs[k];\r\n\r\n      if (!force && prop.wasSet) {\r\n        continue;\r\n      }\r\n\r\n      if (this.hasDefault(prop, k)) {\r\n        prop.setValue(this.getDefault(prop, k));\r\n        prop.wasSet = false;\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  hasDefault(toolprop, key = toolprop.apiname) {\r\n    return SavedToolDefaults.has(this.constructor, key, toolprop);\r\n  }\r\n\r\n  getDefault(toolprop, key = toolprop.apiname) {\r\n    let cls = this.constructor;\r\n\r\n    if (SavedToolDefaults.has(cls, key, toolprop)) {\r\n      return SavedToolDefaults.get(cls, key, toolprop);\r\n    } else {\r\n      return toolprop.getValue();\r\n    }\r\n  }\r\n\r\n  saveDefaultInputs() {\r\n    for (let k in this.inputs) {\r\n      let prop = this.inputs[k];\r\n\r\n      if (prop.flag & PropFlags.SAVE_LAST_VALUE) {\r\n        SavedToolDefaults.set(this.constructor, k, prop);\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  genToolString() {\r\n    let def = this.constructor.tooldef();\r\n    let path = def.toolpath + \"(\";\r\n\r\n    for (let k in this.inputs) {\r\n      let prop = this.inputs[k];\r\n\r\n      path += k + \"=\";\r\n      if (prop.type === PropTypes.STRING)\r\n        path += \"'\";\r\n\r\n      if (prop.type === PropTypes.FLOAT) {\r\n        path += prop.getValue().toFixed(3);\r\n      } else {\r\n        path += prop.getValue();\r\n      }\r\n\r\n      if (prop.type === PropTypes.STRING)\r\n        path += \"'\";\r\n      path += \" \";\r\n    }\r\n    path += \")\";\r\n    return path;\r\n  }\r\n\r\n  on_tick() {\r\n\r\n  }\r\n\r\n  /**default on_keydown implementation for modal tools,\r\n   no need to call super() to execute this if you don't want to*/\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case keymap[\"Enter\"]:\r\n      case keymap[\"Space\"]:\r\n        this.modalEnd(false);\r\n        break;\r\n      case keymap[\"Escape\"]:\r\n        this.modalEnd(true);\r\n        break;\r\n    }\r\n  }\r\n\r\n  //called after undoPre\r\n  calcUndoMem(ctx) {\r\n    console.warn(\"ToolOp.prototype.calcUndoMem: implement me!\");\r\n    return 0;\r\n  }\r\n\r\n  undoPre(ctx) {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  undo(ctx) {\r\n    throw new Error(\"implement me!\");\r\n    //_appstate.loadUndoFile(this._undo);\r\n  }\r\n\r\n  redo(ctx) {\r\n    this._was_redo = true; //also set by toolstack.redo\r\n\r\n    this.undoPre(ctx);\r\n    this.execPre(ctx);\r\n    this.exec(ctx);\r\n    this.execPost(ctx);\r\n  }\r\n\r\n  //for compatibility with fairmotion\r\n  exec_pre(ctx) {\r\n    this.execPre(ctx);\r\n  }\r\n\r\n  execPre(ctx) {\r\n  }\r\n\r\n  exec(ctx) {\r\n  }\r\n\r\n  execPost(ctx) {\r\n\r\n  }\r\n\r\n  /**for use in modal mode only*/\r\n  resetTempGeom() {\r\n    var ctx = this.modal_ctx;\r\n\r\n    for (var dl of this.drawlines) {\r\n      dl.remove();\r\n    }\r\n\r\n    this.drawlines.length = 0;\r\n  }\r\n\r\n  error(msg) {\r\n    console.warn(msg);\r\n  }\r\n\r\n  getOverdraw() {\r\n    if (this._overdraw === undefined) {\r\n      this._overdraw = document.createElement(\"overdraw-x\");\r\n      this._overdraw.start(this.modal_ctx.screen);\r\n    }\r\n\r\n    return this._overdraw;\r\n  }\r\n\r\n  /**for use in modal mode only*/\r\n  makeTempLine(v1, v2, style) {\r\n    let line = this.getOverdraw().line(v1, v2, style);\r\n    this.drawlines.push(line);\r\n    return line;\r\n  }\r\n\r\n  pushModal(node) {\r\n    throw new Error(\"cannot call this; use modalStart\")\r\n  }\r\n\r\n  popModal() {\r\n    throw new Error(\"cannot call this; use modalEnd\");\r\n  }\r\n\r\n  /**returns promise to be executed on modalEnd*/\r\n  modalStart(ctx) {\r\n    if (this.modalRunning) {\r\n      console.warn(\"Warning, tool is already in modal mode consuming events\");\r\n      return this._promise;\r\n    }\r\n\r\n    this.modal_ctx = ctx;\r\n    this.modalRunning = true\r\n\r\n    this._promise = new Promise((accept, reject) => {\r\n      this._accept = accept;\r\n      this._reject = reject;\r\n\r\n      modalstack.push(this);\r\n\r\n      if (this._pointerId !== undefined) {\r\n        super.pushPointerModal(ctx.screen, this._pointerId);\r\n      } else {\r\n        super.pushModal(ctx.screen);\r\n      }\r\n    });\r\n\r\n    return this._promise;\r\n  }\r\n\r\n  /*eek, I've not been using this.\r\n    guess it's a non-enforced contract, I've been naming\r\n    cancel methods 'cancel' all this time.\r\n\r\n    XXX fix\r\n  */\r\n  toolCancel() {\r\n  }\r\n\r\n  modalEnd(was_cancelled) {\r\n    if (this._modalstate) {\r\n      modalstack.pop();\r\n    }\r\n\r\n    if (this._overdraw !== undefined) {\r\n      this._overdraw.end();\r\n      this._overdraw = undefined;\r\n    }\r\n\r\n    if (was_cancelled && this._on_cancel !== undefined) {\r\n      if (this._accept) {\r\n        this._accept(this.modal_ctx, true);\r\n      }\r\n\r\n      this._on_cancel(this);\r\n      this._on_cancel = undefined;\r\n    }\r\n\r\n    this.resetTempGeom();\r\n\r\n    var ctx = this.modal_ctx;\r\n\r\n    this.modal_ctx = undefined;\r\n    this.modalRunning = false;\r\n    this.is_modal = false;\r\n\r\n    super.popModal();\r\n\r\n    this._promise = undefined;\r\n\r\n    if (this._accept) {\r\n      this._accept(ctx, false);//Context, was_cancelled\r\n      this._accept = this._reject = undefined;\r\n    }\r\n\r\n    this.saveDefaultInputs();\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    let outs = this.outputs;\r\n    let ins = this.inputs;\r\n\r\n    this.inputs = {};\r\n    this.outputs = {};\r\n\r\n    for (let pair of ins) {\r\n      this.inputs[pair.key] = pair.val;\r\n    }\r\n\r\n    for (let pair of outs) {\r\n      this.outputs[pair.key] = pair.val;\r\n    }\r\n  }\r\n\r\n  _save_inputs() {\r\n    let ret = [];\r\n    for (let k in this.inputs) {\r\n      ret.push(new PropKey(k, this.inputs[k]));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  _save_outputs() {\r\n    let ret = [];\r\n    for (let k in this.outputs) {\r\n      ret.push(new PropKey(k, this.outputs[k]));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nToolOp.STRUCT = `\r\ntoolsys.ToolOp {\r\n  inputs  : array(toolsys.PropKey) | this._save_inputs();\r\n  outputs : array(toolsys.PropKey) | this._save_outputs();\r\n}\r\n`;\r\nnstructjs.register(ToolOp);\r\n\r\nclass PropKey {\r\n  constructor(key, val) {\r\n    this.key = key;\r\n    this.val = val;\r\n  }\r\n}\r\n\r\nPropKey.STRUCT = `\r\ntoolsys.PropKey {\r\n  key : string;\r\n  val : abstract(ToolProperty);\r\n}\r\n`;\r\nnstructjs.register(PropKey);\r\n\r\nexport class MacroLink {\r\n  constructor(sourcetool_idx, srckey, srcprops = \"outputs\", desttool_idx, dstkey, dstprops = \"inputs\") {\r\n    this.source = sourcetool_idx;\r\n    this.dest = desttool_idx;\r\n\r\n    this.sourceProps = srcprops;\r\n    this.destProps = dstprops;\r\n\r\n    this.sourcePropKey = srckey;\r\n    this.destPropKey = dstkey;\r\n  }\r\n}\r\n\r\nMacroLink.STRUCT = `\r\ntoolsys.MacroLink {\r\n  source         : int;\r\n  dest           : int;\r\n  sourcePropKey  : string;\r\n  destPropKey    : string;\r\n  sourceProps    : string;\r\n  destProps      : string; \r\n}\r\n`;\r\nnstructjs.register(MacroLink);\r\n\r\nexport const MacroClasses = {};\r\nwindow._MacroClasses = MacroClasses;\r\n\r\nlet macroidgen = 0;\r\n\r\n\r\nexport class ToolMacro extends ToolOp {\r\n  constructor() {\r\n    super();\r\n\r\n    this.tools = [];\r\n    this.curtool = 0;\r\n    this.has_modal = false;\r\n    this.connects = [];\r\n    this.connectLinks = [];\r\n\r\n    this._macro_class = undefined;\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname: \"Tool Macro\"\r\n    }\r\n  }\r\n\r\n  //toolop is an optional instance of this class, may be undefined\r\n  static canRun(ctx, toolop = undefined) {\r\n    return true;\r\n  }\r\n\r\n  _getTypeClass() {\r\n    if (this._macro_class && this._macro_class.ready) {\r\n      return this._macro_class;\r\n    }\r\n\r\n    if (!this._macro_class) {\r\n      this._macro_class = class MacroTypeClass extends ToolOp {\r\n        static tooldef() {\r\n          return this.__tooldef;\r\n        }\r\n      }\r\n\r\n      this._macro_class.__tooldef = {\r\n        toolpath: this.constructor.tooldef().toolpath || ''\r\n      };\r\n      this._macro_class.ready = false;\r\n    }\r\n\r\n    if (!this.tools || this.tools.length === 0) {\r\n      /* We've been invoked by ToolOp constructor,\r\n      *  for now just return an empty class  */\r\n      return this._macro_class;\r\n    }\r\n\r\n    let key = \"\";\r\n    for (let tool of this.tools) {\r\n      key = tool.constructor.name + \":\";\r\n    }\r\n\r\n    /* Handle child classes of ToolMacro */\r\n    if (this.constructor !== ToolMacro) {\r\n      key += \":\" + this.constructor.tooldef().toolpath;\r\n    }\r\n\r\n    for (let k in this.inputs) {\r\n      key += k + \":\";\r\n    }\r\n\r\n    if (key in MacroClasses) {\r\n      this._macro_class = MacroClasses[key];\r\n      return this._macro_class;\r\n    }\r\n\r\n    let name = \"Macro(\"\r\n    let i = 0;\r\n    let is_modal;\r\n\r\n    for (let tool of this.tools) {\r\n      let def = tool.constructor.tooldef();\r\n\r\n      if (i > 0) {\r\n        name += \", \";\r\n      } else {\r\n        is_modal = def.is_modal;\r\n      }\r\n\r\n      if (def.uiname) {\r\n        name += def.uiname;\r\n      } else if (def.toolpath) {\r\n        name += def.toolpath;\r\n      } else {\r\n        name += tool.constructor.name;\r\n      }\r\n\r\n      i++;\r\n    }\r\n\r\n    let inputs = {};\r\n\r\n    for (let k in this.inputs) {\r\n      inputs[k] = this.inputs[k].copy().clearEventCallbacks();\r\n      inputs[k].wasSet = false;\r\n    }\r\n\r\n    let tdef = {\r\n      uiname  : name,\r\n      toolpath: key,\r\n      inputs,\r\n      outputs : {},\r\n      is_modal\r\n    };\r\n\r\n    let cls = this._macro_class;\r\n    cls.__tooldef = tdef;\r\n    cls._macroTypeId = macroidgen++;\r\n    cls.ready = true;\r\n\r\n    /*\r\n    let cls = {\r\n      name : key,\r\n      tooldef() {\r\n        return tdef\r\n      },\r\n      _getFinalToolDef() {\r\n        return this.tooldef();\r\n      }\r\n    };//*/\r\n\r\n    MacroClasses[key] = cls;\r\n\r\n    return cls;\r\n  }\r\n\r\n  saveDefaultInputs() {\r\n    for (let k in this.inputs) {\r\n      let prop = this.inputs[k];\r\n\r\n      if (prop.flag & PropFlags.SAVE_LAST_VALUE) {\r\n        SavedToolDefaults.set(this._getTypeClass(), k, prop);\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  hasDefault(toolprop, key = toolprop.apiname) {\r\n    return SavedToolDefaults.has(this._getTypeClass(), key, toolprop);\r\n  }\r\n\r\n  getDefault(toolprop, key = toolprop.apiname) {\r\n    let cls = this._getTypeClass();\r\n\r\n    if (SavedToolDefaults.has(cls, key, toolprop)) {\r\n      return SavedToolDefaults.get(cls, key, toolprop);\r\n    } else {\r\n      return toolprop.getValue();\r\n    }\r\n  }\r\n\r\n  connect(srctool, srcoutput, dsttool, dstinput, srcprops = \"outputs\", dstprops = \"inputs\") {\r\n    if (typeof dsttool === \"function\") {\r\n      return this.connectCB(...arguments);\r\n    }\r\n\r\n    let i1 = this.tools.indexOf(srctool);\r\n    let i2 = this.tools.indexOf(dsttool);\r\n\r\n    if (i1 < 0 || i2 < 0) {\r\n      throw new Error(\"tool not in macro\");\r\n    }\r\n\r\n    //remove linked properties from this.inputs\r\n    if (srcprops === \"inputs\") {\r\n      let tool = this.tools[i1];\r\n\r\n      let prop = tool.inputs[srcoutput];\r\n      if (prop === this.inputs[srcoutput]) {\r\n        delete this.inputs[srcoutput];\r\n      }\r\n    }\r\n\r\n    if (dstprops === \"inputs\") {\r\n      let tool = this.tools[i2];\r\n      let prop = tool.inputs[dstinput];\r\n\r\n      if (this.inputs[dstinput] === prop) {\r\n        delete this.inputs[dstinput];\r\n      }\r\n    }\r\n\r\n    this.connectLinks.push(new MacroLink(i1, srcoutput, srcprops, i2, dstinput, dstprops));\r\n    return this;\r\n  }\r\n\r\n  connectCB(srctool, dsttool, callback, thisvar) {\r\n    this.connects.push({\r\n      srctool : srctool,\r\n      dsttool : dsttool,\r\n      callback: callback,\r\n      thisvar : thisvar\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  add(tool) {\r\n    if (tool.is_modal) {\r\n      this.is_modal = true;\r\n    }\r\n\r\n    for (let k in tool.inputs) {\r\n      let prop = tool.inputs[k];\r\n\r\n      if (!(prop.flag & PropFlags.PRIVATE)) {\r\n        this.inputs[k] = prop;\r\n      }\r\n    }\r\n\r\n    this.tools.push(tool);\r\n\r\n    return this;\r\n  }\r\n\r\n  _do_connections(tool) {\r\n    let i = this.tools.indexOf(tool);\r\n\r\n    for (let c of this.connectLinks) {\r\n      if (c.source === i) {\r\n        let tool2 = this.tools[c.dest];\r\n\r\n        tool2[c.destProps][c.destPropKey].setValue(tool[c.sourceProps][c.sourcePropKey].getValue());\r\n      }\r\n    }\r\n\r\n    for (var c of this.connects) {\r\n      if (c.srctool === tool) {\r\n        c.callback.call(c.thisvar, c.srctool, c.dsttool);\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n  canRun(ctx) {\r\n    if (this.tools.length == 0)\r\n      return false;\r\n\r\n    //poll first tool only in list\r\n    return this.tools[0].constructor.canRun(ctx);\r\n  }//*/\r\n\r\n  modalStart(ctx) {\r\n    //macros obviously can't call loadDefaults in the constructor\r\n    //like normal tool ops can.\r\n    this.loadDefaults(false);\r\n\r\n    this._promise = new Promise((function (accept, reject) {\r\n      this._accept = accept;\r\n      this._reject = reject;\r\n    }).bind(this));\r\n\r\n    this.curtool = 0;\r\n\r\n    let i;\r\n\r\n    for (i = 0; i < this.tools.length; i++) {\r\n      if (this.tools[i].is_modal)\r\n        break;\r\n\r\n      this.tools[i].undoPre(ctx);\r\n      this.tools[i].execPre(ctx);\r\n      this.tools[i].exec(ctx);\r\n      this.tools[i].execPost(ctx);\r\n      this._do_connections(this.tools[i]);\r\n    }\r\n\r\n    var on_modal_end = (function on_modal_end() {\r\n      this._do_connections(this.tools[this.curtool]);\r\n      this.curtool++;\r\n\r\n      while (this.curtool < this.tools.length &&\r\n      !this.tools[this.curtool].is_modal) {\r\n        this.tools[this.curtool].undoPre(ctx);\r\n        this.tools[this.curtool].execPre(ctx);\r\n        this.tools[this.curtool].exec(ctx);\r\n        this.tools[this.curtool].execPost(ctx);\r\n        this._do_connections(this.tools[this.curtool]);\r\n\r\n        this.curtool++;\r\n      }\r\n\r\n      if (this.curtool < this.tools.length) {\r\n        this.tools[this.curtool].undoPre(ctx);\r\n        this.tools[this.curtool].modalStart(ctx).then(on_modal_end);\r\n      } else {\r\n        this._accept(this, false);\r\n      }\r\n    }).bind(this);\r\n\r\n    if (i < this.tools.length) {\r\n      this.curtool = i;\r\n      this.tools[this.curtool].undoPre(ctx);\r\n      this.tools[this.curtool].modalStart(ctx).then(on_modal_end);\r\n    }\r\n\r\n    return this._promise;\r\n  }\r\n\r\n  loadDefaults(force = true) {\r\n    return super.loadDefaults(force);\r\n  }\r\n\r\n  exec(ctx) {\r\n    //macros obviously can't call loadDefaults in the constructor\r\n    //like normal tool ops can.\r\n    //note that this will detect if the user changes property values\r\n\r\n    this.loadDefaults(false);\r\n\r\n    for (var i = 0; i < this.tools.length; i++) {\r\n      this.tools[i].undoPre(ctx);\r\n      this.tools[i].execPre(ctx);\r\n      this.tools[i].exec(ctx);\r\n      this.tools[i].execPost(ctx);\r\n      this._do_connections(this.tools[i]);\r\n    }\r\n  }\r\n\r\n  calcUndoMem(ctx) {\r\n    let tot = 0;\r\n\r\n    for (let tool of this.tools) {\r\n      tot += tool.calcUndoMem(ctx);\r\n    }\r\n\r\n    return tot;\r\n  }\r\n\r\n  calcMemSize(ctx) {\r\n    let tot = 0;\r\n\r\n    for (let tool of this.tools) {\r\n      tot += tool.calcMemSize(ctx);\r\n    }\r\n\r\n    return tot;\r\n  }\r\n\r\n  undoPre() {\r\n    return; //undoPre is handled in exec() or modalStart()\r\n  }\r\n\r\n  undo(ctx) {\r\n    for (var i = this.tools.length - 1; i >= 0; i--) {\r\n      this.tools[i].undo(ctx);\r\n    }\r\n  }\r\n}\r\n\r\nToolMacro.STRUCT = nstructjs.inherit(ToolMacro, ToolOp, \"toolsys.ToolMacro\") + `\r\n  tools        : array(abstract(toolsys.ToolOp));\r\n  connectLinks : array(toolsys.MacroLink);\r\n}\r\n`;\r\nnstructjs.register(ToolMacro);\r\n\r\nexport class ToolStack extends Array {\r\n  constructor(ctx) {\r\n    super();\r\n\r\n    this.memLimit = 512*1024*1024;\r\n    this.enforceMemLimit = false;\r\n\r\n    this.cur = -1;\r\n    this.ctx = ctx;\r\n\r\n    this.modalRunning = 0;\r\n\r\n    this._undo_branch = undefined; //used to save undo branch in case of tool cancel\r\n  }\r\n\r\n  get head() {\r\n    return this[this.cur];\r\n  }\r\n\r\n  limitMemory(maxmem = this.memLimit, ctx = this.ctx) {\r\n    if (maxmem === undefined) {\r\n      throw new Error(\"maxmem cannot be undefined\");\r\n    }\r\n\r\n    let size = this.calcMemSize();\r\n\r\n    let start = 0;\r\n\r\n    while (start < this.cur - 2 && size > maxmem) {\r\n      size -= this[start].calcMemSize(ctx);\r\n      start++;\r\n    }\r\n\r\n    if (start === 0) {\r\n      return size;\r\n    }\r\n\r\n    for (let i = 0; i < start; i++) {\r\n      this[i].onUndoDestroy();\r\n    }\r\n\r\n    this.cur -= start;\r\n\r\n    for (let i = 0; i < this.length - start; i++) {\r\n      this[i] = this[i + start];\r\n    }\r\n    this.length -= start;\r\n\r\n    return this.calcMemSize(ctx);\r\n  }\r\n\r\n  calcMemSize(ctx = this.ctx) {\r\n    let tot = 0;\r\n\r\n    for (let tool of this) {\r\n      try {\r\n        tot += tool.calcMemSize();\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        console.error(\"Failed to execute a calcMemSize method\");\r\n      }\r\n    }\r\n\r\n    return tot;\r\n  }\r\n\r\n  setRestrictedToolContext(ctx) {\r\n    this.toolctx = ctx;\r\n  }\r\n\r\n  reset(ctx) {\r\n    if (ctx !== undefined) {\r\n      this.ctx = ctx;\r\n    }\r\n\r\n    this.modalRunning = 0;\r\n    this.cur = -1;\r\n    this.length = 0;\r\n  }\r\n\r\n  /**\r\n   * runs .undo,.redo if toolstack head is same as tool\r\n   *\r\n   * otherwise, .execTool(ctx, tool) is called.\r\n   *\r\n   * @param compareInputs : check if toolstack head has identical input values, defaults to false\r\n   * */\r\n  execOrRedo(ctx, tool, compareInputs = false) {\r\n    let head = this.head;\r\n\r\n    let ok = compareInputs ? ToolOp.Equals(head, tool) : head && head.constructor === tool.constructor;\r\n\r\n    tool.__memsize = undefined; //reset cache memsize\r\n\r\n    if (ok) {\r\n      //console.warn(\"Same tool detected\");\r\n\r\n      this.undo();\r\n\r\n      //can inputs differ? in that case, execute new tool\r\n      if (!compareInputs) {\r\n        this.execTool(ctx, tool);\r\n      } else {\r\n        this.rerun();\r\n      }\r\n\r\n      return false;\r\n    } else {\r\n      this.execTool(ctx, tool);\r\n      return true;\r\n    }\r\n  }\r\n\r\n  execTool(ctx, toolop) {\r\n    if (this.enforceMemLimit) {\r\n      this.limitMemory(this.memLimit, ctx);\r\n    }\r\n\r\n    if (!toolop.constructor.canRun(ctx, toolop)) {\r\n      console.log(\"toolop.constructor.canRun returned false\");\r\n      return;\r\n    }\r\n\r\n    let tctx = ctx.toLocked();\r\n\r\n    let undoflag = toolop.constructor.tooldef().undoflag;\r\n    if (toolop.undoflag !== undefined) {\r\n      undoflag = toolop.undoflag;\r\n    }\r\n    undoflag = undoflag === undefined ? 0 : undoflag;\r\n\r\n    //if (!(undoflag & UndoFlags.IS_UNDO_ROOT) && !(undoflag & UndoFlags.NO_UNDO)) {\r\n    //tctx = new SavedContext(ctx, ctx.datalib);\r\n    //}\r\n\r\n    toolop.execCtx = tctx;\r\n\r\n    if (!(undoflag & UndoFlags.NO_UNDO)) {\r\n      this.cur++;\r\n\r\n      //save branch for if tool cancel\r\n      this._undo_branch = this.slice(this.cur + 1, this.length);\r\n\r\n      //truncate\r\n      this.length = this.cur + 1;\r\n\r\n      this[this.cur] = toolop;\r\n      toolop.undoPre(tctx);\r\n    }\r\n\r\n    if (toolop.is_modal) {\r\n      ctx = toolop.modal_ctx = ctx;\r\n\r\n      this.modal_running = true;\r\n\r\n      toolop._on_cancel = (function (toolop) {\r\n        if (!(toolop.undoflag & UndoFlags.NO_UNDO)) {\r\n          this[this.cur].undo(ctx);\r\n          this.pop_i(this.cur);\r\n          this.cur--;\r\n        }\r\n      }).bind(this);\r\n\r\n      //will handle calling .exec itself\r\n      toolop.modalStart(ctx);\r\n    } else {\r\n      toolop.execPre(tctx);\r\n      toolop.exec(tctx);\r\n      toolop.execPost(tctx);\r\n      toolop.saveDefaultInputs();\r\n    }\r\n  }\r\n\r\n  toolCancel(ctx, tool) {\r\n    if (tool._was_redo) { //also set by toolstack.redo\r\n      //ignore tool cancel requests on redo\r\n      return;\r\n    }\r\n\r\n    if (tool !== this[this.cur]) {\r\n      console.warn(\"toolCancel called in error\", this, tool);\r\n      return;\r\n    }\r\n\r\n    this.undo();\r\n    this.length = this.cur + 1;\r\n\r\n    if (this._undo_branch !== undefined) {\r\n      for (let item of this._undo_branch) {\r\n        this.push(item);\r\n      }\r\n    }\r\n  }\r\n\r\n  undo() {\r\n    if (this.enforceMemLimit) {\r\n      this.limitMemory(this.memLimit);\r\n    }\r\n\r\n    if (this.cur >= 0 && !(this[this.cur].undoflag & UndoFlags.IS_UNDO_ROOT)) {\r\n      let tool = this[this.cur];\r\n\r\n      tool.undo(tool.execCtx);\r\n\r\n      this.cur--;\r\n    }\r\n  }\r\n\r\n  //reruns a tool if it's at the head of the stack\r\n  rerun(tool) {\r\n    if (this.enforceMemLimit) {\r\n      this.limitMemory(this.memLimit);\r\n    }\r\n\r\n    if (tool === this[this.cur]) {\r\n      tool._was_redo = false;\r\n\r\n      if (!tool.execCtx) {\r\n        tool.execCtx = this.ctx;\r\n      }\r\n\r\n      tool.undo(tool.execCtx);\r\n\r\n      tool._was_redo = true; //also set by toolstack.redo\r\n\r\n      tool.undoPre(tool.execCtx);\r\n      tool.execPre(tool.execCtx);\r\n      tool.exec(tool.execCtx);\r\n      tool.execPost(tool.execCtx);\r\n    } else {\r\n      console.warn(\"Tool wasn't at head of stack\", tool);\r\n    }\r\n  }\r\n\r\n  redo() {\r\n    if (this.enforceMemLimit) {\r\n      this.limitMemory(this.memLimit);\r\n    }\r\n\r\n    if (this.cur >= -1 && this.cur + 1 < this.length) {\r\n      //console.log(\"redo!\", this.cur, this.length);\r\n\r\n      this.cur++;\r\n      let tool = this[this.cur];\r\n\r\n\r\n      if (!tool.execCtx) {\r\n        tool.execCtx = this.ctx;\r\n      }\r\n\r\n      tool._was_redo = true;\r\n      tool.redo(tool.execCtx);\r\n\r\n      tool.saveDefaultInputs();\r\n    }\r\n  }\r\n\r\n  save() {\r\n    let data = [];\r\n    nstructjs.writeObject(data, this);\r\n    return data;\r\n  }\r\n\r\n  rewind() {\r\n    while (this.cur >= 0) {\r\n      let last = this.cur;\r\n      this.undo();\r\n\r\n      //prevent infinite loops\r\n      if (last === this.cur) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**cb is a function(ctx), if it returns the value false then playback stops\r\n   promise will still be fulfilled.\r\n\r\n   onstep is a callback, if it returns a promise that promise will be\r\n   waited on, otherwise execution is queue with window.setTimeout().\r\n   */\r\n  replay(cb, onStep) {\r\n    let cur = this.cur;\r\n\r\n    this.rewind();\r\n\r\n    let last = this.cur;\r\n\r\n    let start = util.time_ms();\r\n\r\n    return new Promise((accept, reject) => {\r\n      let next = () => {\r\n        last = this.cur;\r\n\r\n        if (cb && cb(ctx) === false) {\r\n          accept();\r\n          return;\r\n        }\r\n\r\n        if (this.cur < this.length) {\r\n          this.cur++;\r\n          this.rerun();\r\n        }\r\n\r\n        if (last === this.cur) {\r\n          console.warn(\"time:\", (util.time_ms() - start)/1000.0);\r\n          accept(this);\r\n        } else {\r\n          if (onStep) {\r\n            let ret = onStep();\r\n\r\n            if (ret && ret instanceof Promise) {\r\n              ret.then(() => {\r\n                next();\r\n              });\r\n            } else {\r\n              window.setTimeout(() => {\r\n                next();\r\n              })\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      next();\r\n    });\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    for (let item of this._stack) {\r\n      this.push(item);\r\n    }\r\n\r\n    delete this._stack;\r\n  }\r\n\r\n  //note that this makes sure tool classes are registered with nstructjs\r\n  //during save\r\n  _save() {\r\n    for (let tool of this) {\r\n      let cls = tool.constructor;\r\n\r\n      if (!nstructjs.isRegistered(cls)) {\r\n        cls._regWithNstructjs(cls);\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nToolStack.STRUCT = `\r\ntoolsys.ToolStack {\r\n  cur    : int;\r\n  _stack : array(abstract(toolsys.ToolOp)) | this._save();\r\n}\r\n`;\r\nnstructjs.register(ToolStack);\r\n\r\nwindow._testToolStackIO = function () {\r\n  let data = [];\r\n  let cls = _appstate.toolstack.constructor;\r\n\r\n  nstructjs.writeObject(data, _appstate.toolstack);\r\n  data = new DataView(new Uint8Array(data).buffer);\r\n\r\n  let toolstack = nstructjs.readObject(data, cls);\r\n\r\n  _appstate.toolstack.rewind();\r\n\r\n  toolstack.cur = -1;\r\n  toolstack.ctx = _appstate.toolstack.ctx;\r\n  _appstate.toolstack = toolstack;\r\n\r\n  return toolstack;\r\n}\r\n\r\nexport function buildToolSysAPI(api, registerWithNStructjs = true, rootCtxStruct = undefined) {\r\n  let datastruct = api.mapStruct(ToolPropertyCache, true);\r\n\r\n  for (let cls of ToolClasses) {\r\n    let def = cls._getFinalToolDef();\r\n\r\n    for (let k in def.inputs) {\r\n      let prop = def.inputs[k];\r\n\r\n      if (!(prop.flag & (PropFlags.PRIVATE | PropFlags.READ_ONLY))) {\r\n        SavedToolDefaults._buildAccessors(cls, k, prop, datastruct, api);\r\n      }\r\n    }\r\n  }\r\n\r\n  if (rootCtxStruct) {\r\n    rootCtxStruct.struct(\"toolDefaults\", \"toolDefaults\", \"Tool Defaults\", api.mapStruct(ToolPropertyCache));\r\n  }\r\n\r\n  if (!registerWithNStructjs) {\r\n    return;\r\n  }\r\n\r\n  //register tools with nstructjs\r\n  for (let cls of ToolClasses) {\r\n    try {\r\n      if (!nstructjs.isRegistered(cls)) {\r\n        ToolOp._regWithNstructjs(cls);\r\n      }\r\n    } catch (error) {\r\n      console.log(error.stack);\r\n      console.error(\"Failed to register a tool with nstructjs\");\r\n    }\r\n  }\r\n}\r\n","import {ToolClasses, ToolOp, ToolFlags, UndoFlags, ToolMacro} from './toolsys.js';\r\nimport {tokdef, lexer, parser, PUTLParseError} from '../util/parseutil.js';\r\nimport {DataPathError} from '../controller/controller_base.js';\r\nimport {cachering} from '../util/util.js';\r\n\r\nexport let ToolPaths = {};\r\n\r\nvar initToolPaths_run = false;\r\n\r\nexport function buildParser() {\r\n  let t = (name, re, func) => new tokdef(name, re, func);\r\n\r\n  let tokens = [\r\n    t('ID', /[a-zA-Z_$]+[a-zA-Z0-9_$]*/, (t) => {\r\n      if (t.value == \"true\" || t.value == \"false\") {\r\n        t.type = \"BOOL\";\r\n        t.value = t.value == \"true\";\r\n      }\r\n\r\n      return t;\r\n    }),\r\n    t('LPAREN', /\\(/),\r\n    t('RPAREN', /\\)/),\r\n    t('LSBRACKET', /\\[/),\r\n    t('RSBRACKET', /\\]/),\r\n    t('DOT', /\\./),\r\n    t('COMMA', /\\,/),\r\n    t('EQUALS', /\\=/),\r\n    t('STRLIT', /\"[^\"]*\"/, (t) => {\r\n      t.value = t.value.slice(1, t.value.length-1);\r\n      return t;\r\n    }),\r\n    t('STRLIT', /'[^']*'/, (t) => {\r\n      t.value = t.value.slice(1, t.value.length-1);\r\n      return t;\r\n    }),\r\n    t('NUMBER', /-?[0-9]+/, (t) => {\r\n      t.value = parseInt(t.value);\r\n      return t;\r\n    }),\r\n    t('NUMBER', /-?[0-9]+\\.[0-9]*/, (t) => {\r\n      t.value = parseFloat(t.value);\r\n      return t;\r\n    }),\r\n    t('WS', /[ \\n\\r\\t]/, (t) => undefined) //ignore whitespace\r\n  ];\r\n\r\n  let lexerror = (t) => {\r\n    console.warn(\"Parse error\");\r\n    return true;\r\n  };\r\n\r\n  let valid_datatypes = {\r\n    \"STRLIT\" : 1, \"NUMBER\" : 1, \"BOOL\" : 1\r\n  };\r\n\r\n  function p_Start(p) {\r\n    let args = {};\r\n\r\n    while (!p.at_end()) {\r\n      let keyword = p.expect(\"ID\");\r\n\r\n      p.expect(\"EQUALS\");\r\n\r\n      let t = p.next();\r\n      if (!(t.type in valid_datatypes)) {\r\n        throw new PUTLParseError(\"parse error: unexpected \" + t.type);\r\n      }\r\n\r\n      args[keyword] = t.value;\r\n    }\r\n\r\n    return args;\r\n  }\r\n\r\n  let lex = new lexer(tokens, lexerror)\r\n  let p = new parser(lex);\r\n  p.start = p_Start;\r\n\r\n  return p;\r\n}\r\n\r\nexport let Parser = buildParser();\r\n/*\r\nlet parse_rets = new cachering(() => return {\r\n  toolclass : undefined,\r\n  args : {}\r\n}, 64);\r\n//*/\r\n\r\nexport function parseToolPath(str, check_tool_exists=true) {\r\n  if (!initToolPaths_run) {\r\n    initToolPaths_run = true;\r\n    initToolPaths();\r\n  }\r\n\r\n  let startstr = str;\r\n\r\n  let i1 = str.search(/\\(/);\r\n  let i2 = str.search(/\\)/);\r\n  let args = \"\";\r\n\r\n  if (i1 >= 0 && i2 >= 0) {\r\n    args = str.slice(i1+1, i2).trim();\r\n    str = str.slice(0, i1).trim();\r\n  }\r\n\r\n  if (!(str in ToolPaths) && check_tool_exists) {\r\n    throw new DataPathError(\"unknown tool \" + str);\r\n  }\r\n\r\n  let ret;\r\n\r\n  try {\r\n    ret = Parser.parse(args);\r\n  } catch (error) {\r\n    console.log(error);\r\n    throw new DataPathError(`\"${startstr}\"\\n  ${error.message}`);\r\n  }\r\n\r\n  return {\r\n    toolclass : ToolPaths[str],\r\n    args      : ret\r\n  };\r\n}\r\n\r\nexport function testToolParser() {\r\n  let ret = parseToolPath(\"view3d.sometool(selectmode=1 str='str' bool=true)\", false);\r\n\r\n  return ret;\r\n}\r\n\r\nwindow.parseToolPath = parseToolPath;\r\n//window._ToolPaths = ToolPaths;\r\n\r\n//tool path parser for simple_toolsys.js\r\nexport function initToolPaths() {\r\n  for (let cls of ToolClasses) {\r\n    if (!cls.hasOwnProperty(\"tooldef\")) { //ignore abstract classes\r\n      continue;\r\n    }\r\n\r\n    let def = cls.tooldef();\r\n    let path = def.toolpath;\r\n\r\n    ToolPaths[path] = cls;\r\n  }\r\n}","import {ToolOp} from '../toolsys/toolsys.js';\r\nimport {print_stack} from '../util/util.js';\r\nimport {PropFlags, PropTypes} from '../toolsys/toolprop_abstract.js';\r\nimport {ToolProperty} from '../toolsys/toolprop.js';\r\nimport {DataPathError, isVecProperty, ListIface} from './controller_base.js';\r\n\r\nexport class ModelInterface {\r\n  constructor() {\r\n    this.prefix = \"\";\r\n  }\r\n\r\n  getToolDef(path) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  getToolPathHotkey(ctx, path) {\r\n    return undefined;\r\n  }\r\n\r\n  get list() {\r\n    throw new Error(\"implement me\");\r\n    return ListIface;\r\n  }\r\n\r\n  createTool(path, inputs = {}, constructor_argument = undefined) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  //returns tool class, or undefined if one cannot be found for path\r\n  parseToolPath(path) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  /**\r\n   * runs .undo,.redo if toolstack head is same as tool\r\n   *\r\n   * otherwise, .execTool(ctx, tool) is called.\r\n   *\r\n   * @param compareInputs : check if toolstack head has identical input values, defaults to false\r\n   * */\r\n  execOrRedo(ctx, toolop, compareInputs = false) {\r\n    return ctx.toolstack.execOrRedo(ctx, toolop, compareInputs);\r\n  }\r\n\r\n  execTool(ctx, path, inputs = {}, constructor_argument = undefined, event = undefined) {\r\n    return new Promise((accept, reject) => {\r\n      let tool = path;\r\n\r\n      try {\r\n        if (typeof tool == \"string\" || !(tool instanceof ToolOp)) {\r\n          tool = this.createTool(ctx, path, inputs, constructor_argument);\r\n        }\r\n      } catch (error) {\r\n        print_stack(error);\r\n        reject(error);\r\n        return;\r\n      }\r\n\r\n      //give client a chance to change tool instance directly\r\n      accept(tool);\r\n\r\n      //execute\r\n      try {\r\n        ctx.toolstack.execTool(ctx, tool, event);\r\n      } catch (error) { //for some reason chrome is suppressing errors\r\n        print_stack(error);\r\n        throw error;\r\n      }\r\n    });\r\n  }\r\n\r\n  //used by simple_controller.js for tagging error messages\r\n  pushReportContext(name) {\r\n\r\n  }\r\n\r\n  //used by simple_controller.js for tagging error messages\r\n  popReportContext() {\r\n\r\n  }\r\n\r\n  static toolRegistered(tool) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  static registerTool(tool) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  //not yet supported by path.ux's controller implementation\r\n  massSetProp(ctx, mass_set_path, value) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  /** takes a mass_set_path and returns an array of individual paths */\r\n  resolveMassSetPaths(ctx, mass_set_path) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  /**\r\n   * @example\r\n   *\r\n   * return {\r\n   *   obj      : [object owning property key]\r\n   *   parent   : [parent of obj]\r\n   *   key      : [property key]\r\n   *   subkey   : used by flag properties, represents a key within the property\r\n   *   value    : [value of property]\r\n   *   prop     : [optional toolprop.ToolProperty representing the property definition]\r\n   *   struct   : [optional datastruct representing the type, if value is an object]\r\n   *   mass_set : mass setter string, if controller implementation supports it\r\n   * }\r\n   */\r\n  resolvePath(ctx, path, ignoreExistence, rootStruct) {\r\n  }\r\n\r\n  setValue(ctx, path, val, rootStruct) {\r\n    let res = this.resolvePath(ctx, path, undefined, rootStruct);\r\n    let prop = res.prop;\r\n\r\n    if (prop !== undefined && (prop.flag & PropFlags.READ_ONLY)) {\r\n      throw new DataPathError(\"Tried to set read only property\");\r\n    }\r\n\r\n    if (prop !== undefined && (prop.flag & PropFlags.USE_CUSTOM_GETSET)) {\r\n      prop.dataref = res.obj;\r\n      prop.ctx = ctx;\r\n      prop.datapath = path;\r\n\r\n      if (res.subkey !== undefined) {\r\n        let val2 = prop.getValue();\r\n        if (typeof val2 === \"object\") {\r\n          val2 = val2.copy();\r\n        }\r\n\r\n        if (prop.type === PropTypes.FLAG) {\r\n          if (val) {\r\n            val2 |= prop.values[res.subkey];\r\n          } else {\r\n            val2 &= ~prop.values[res.subkey];\r\n          }\r\n\r\n          val = val2;\r\n        } else if (prop.type === PropTypes.ENUM) {\r\n          val = prop.values[res.subkey];\r\n        } else {\r\n          val2[res.subkey] = val;\r\n          val = val2;\r\n        }\r\n      }\r\n\r\n      prop.setValue(val);\r\n      return;\r\n    }\r\n\r\n    if (prop !== undefined) {\r\n      if (prop.type === PropTypes.CURVE && !val) {\r\n        throw new DataPathError(\"can't set curve data to nothing\");\r\n      }\r\n\r\n      let use_range = (prop.type & (PropTypes.INT | PropTypes.FLOAT));\r\n\r\n      use_range = use_range || (res.subkey && (prop.type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4)));\r\n      use_range = use_range && prop.range;\r\n      use_range = use_range && !(prop.range[0] === 0.0 && prop.range[1] === 0.0);\r\n      use_range = use_range && typeof val === \"number\";\r\n\r\n      if (use_range) {\r\n        val = Math.min(Math.max(val, prop.range[0]), prop.range[1]);\r\n      }\r\n    }\r\n\r\n    let old = res.obj[res.key];\r\n\r\n    if (res.subkey !== undefined && res.prop !== undefined && res.prop.type === PropTypes.ENUM) {\r\n      let ival = res.prop.values[res.subkey];\r\n\r\n      if (val) {\r\n        res.obj[res.key] = ival;\r\n      }\r\n    } else if (res.prop !== undefined && res.prop.type === PropTypes.FLAG) {\r\n      if (res.subkey !== undefined) {\r\n        let ival = res.prop.values[res.subkey];\r\n\r\n        if (val) {\r\n          res.obj[res.key] |= ival;\r\n        } else {\r\n          res.obj[res.key] &= ~ival;\r\n        }\r\n      } else if (typeof val === \"number\" || typeof val === \"boolean\") {\r\n        val = typeof val === \"boolean\" ? (val & 1) : val;\r\n\r\n        res.obj[res.key] = val;\r\n      } else {\r\n        throw new DataPathError(\"Expected a number for a bitmask property\");\r\n      }\r\n    } else if (res.subkey !== undefined && isVecProperty(res.prop)) {\r\n      if (res.key !== \"\") {\r\n        res.obj[res.key][res.subkey] = val;\r\n      } else {\r\n        res.obj[res.subkey] = val;\r\n      }\r\n    } else if (res.key === \"\" && isVecProperty(res.prop)) {\r\n      for (let i = 0; i < res.obj.length; i++) {\r\n        res.obj[i] = val[i];\r\n      }\r\n    } else if (!(prop !== undefined && prop instanceof ListIface)) {\r\n      res.obj[res.key] = val;\r\n    }\r\n\r\n    if (prop !== undefined && prop instanceof ListIface) {\r\n      prop.set(this, res.obj, res.key, val);\r\n    } else if (prop !== undefined) {\r\n      prop.dataref = res.obj;\r\n      prop.datapath = path;\r\n      prop.ctx = ctx;\r\n\r\n      prop._fire(\"change\", res.obj[res.key], old);\r\n    }\r\n  }\r\n\r\n  getDescription(ctx, path) {\r\n    let rdef = this.resolvePath(ctx, path);\r\n    if (rdef === undefined) {\r\n      throw new DataPathError(\"invalid path \" + path);\r\n    }\r\n\r\n    if (!rdef.prop || !(rdef.prop instanceof ToolProperty)) {\r\n      return \"\";\r\n    }\r\n\r\n    let type = rdef.prop.type;\r\n    let prop = rdef.prop;\r\n\r\n    if (rdef.subkey !== undefined) {\r\n      let subkey = rdef.subkey;\r\n\r\n      if (type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4)) {\r\n        if (prop.descriptions && subkey in prop.descriptions) {\r\n          return prop.descriptions[subkey];\r\n        }\r\n      } else if (type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n        if (!(subkey in prop.values) && subkey in prop.keys) {\r\n          subkey = prop.keys[subkey]\r\n        }\r\n        ;\r\n\r\n        if (prop.descriptions && subkey in prop.descriptions) {\r\n          return prop.descriptions[subkey];\r\n        }\r\n      } else if (type === PropTypes.PROPLIST) {\r\n        let val = tdef.value;\r\n        if (typeof val === \"object\" && val instanceof ToolProperty) {\r\n          return val.description;\r\n        }\r\n      }\r\n    }\r\n\r\n    return rdef.prop.description ? rdef.prop.description : rdef.prop.uiname;\r\n  }\r\n\r\n  validPath(ctx, path, rootStruct) {\r\n    try {\r\n      this.getValue(ctx, path, rootStruct);\r\n      return true;\r\n    } catch (error) {\r\n      if (!(error instanceof DataPathError)) {\r\n        throw error;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  getPropName(ctx, path) {\r\n    let i = path.length - 1;\r\n    while (i >= 0 && path[i] !== \".\") {\r\n      i--;\r\n    }\r\n\r\n    path = path.slice(i + 1, path.length).trim();\r\n\r\n    if (path.endsWith(\"]\")) {\r\n      i = path.length - 1;\r\n      while (i >= 0 && path[i] !== \"[\") {\r\n        i--;\r\n      }\r\n\r\n      path = path.slice(0, i).trim();\r\n\r\n      return this.getPropName(ctx, path);\r\n    }\r\n\r\n    return path;\r\n  }\r\n\r\n  getValue(ctx, path, rootStruct = undefined) {\r\n    if (typeof ctx == \"string\") {\r\n      throw new Error(\"You forgot to pass context to getValue\");\r\n    }\r\n\r\n    let ret = this.resolvePath(ctx, path, undefined, rootStruct);\r\n\r\n    if (ret === undefined) {\r\n      throw new DataPathError(\"invalid path \" + path);\r\n    }\r\n\r\n    let exec = ret.prop !== undefined && (ret.prop.flag & PropFlags.USE_CUSTOM_GETSET);\r\n\r\n    //resolvePath handles the case of vector properties with custom callbacks for us\r\n    //(and possibly all the other cases too, need to check)\r\n    exec = exec && !(ret.prop !== undefined && (ret.prop.type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4 | PropTypes.QUAT)));\r\n\r\n    if (exec) {\r\n      ret.prop.dataref = ret.obj;\r\n      ret.prop.datapath = path;\r\n      ret.prop.ctx = ctx;\r\n\r\n      let val = ret.prop.getValue();\r\n\r\n      if (typeof val === \"string\" && (ret.prop.type & (PropTypes.FLAG | PropTypes.ENUM))) {\r\n        val = ret.prop.values[val];\r\n      }\r\n\r\n      if (ret.subkey && ret.prop.type === PropTypes.ENUM) {\r\n        val = val === ret.prop.values[ret.subkey];\r\n      } else if (ret.subkey && ret.prop.type === PropTypes.FLAG) {\r\n        val = val & ret.prop.values[ret.subkey];\r\n      }\r\n\r\n      return val;\r\n\r\n    }\r\n\r\n    return ret.value;\r\n  }\r\n}\r\n","import {ToolOp, ToolFlags} from \"../toolsys/toolsys.js\";\r\nimport {\r\n  PropTypes, PropFlags, BoolProperty, IntProperty, FloatProperty, FlagProperty,\r\n  EnumProperty, StringProperty, Vec3Property, Vec2Property, Vec4Property,\r\n  QuatProperty, Mat4Property\r\n} from \"../toolsys/toolprop.js\";\r\n\r\nimport * as util from '../util/util.js';\r\nimport {isVecProperty, getVecClass} from \"./controller_base.js\";\r\n\r\nexport class DataPathSetOp extends ToolOp {\r\n  constructor() {\r\n    super();\r\n\r\n    this.propType = -1;\r\n    this._undo = undefined;\r\n  }\r\n\r\n  setValue(ctx, val, object) {\r\n    let prop = this.inputs.prop;\r\n    let path = this.inputs.dataPath.getValue();\r\n\r\n    if (prop.type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n      let rdef = ctx.api.resolvePath(ctx, path);\r\n      if (rdef.subkey !== undefined) {\r\n        let subkey = rdef.subkey;\r\n        if (typeof subkey === \"string\") {\r\n          subkey = rdef.prop.values[subkey];\r\n        }\r\n\r\n        this.inputs.flagBit.setValue(subkey);\r\n        this.inputs.useFlagBit.setValue(true);\r\n      }\r\n\r\n      //if (rdef.subkey !== undefined) {\r\n      //  val = rdef.value;\r\n      //val = !!val;\r\n      //}\r\n    }\r\n\r\n    prop.dataref = object;\r\n    prop.ctx = ctx;\r\n    prop.datapath = path;\r\n\r\n    try {\r\n      prop.setValue(val);\r\n      this.hadError = false;\r\n    } catch (error) {\r\n      console.error(\"Error setting datapath\", path);\r\n      this.hadError = true;\r\n    }\r\n  }\r\n\r\n  static create(ctx, datapath, value, id, massSetPath) {\r\n    let rdef = ctx.api.resolvePath(ctx, datapath);\r\n\r\n    if (rdef === undefined || rdef.prop === undefined) {\r\n      console.warn(\"DataPathSetOp failed\", rdef, rdef.prop);\r\n      return;\r\n    }\r\n\r\n    let prop = rdef.prop;\r\n    let tool = new DataPathSetOp();\r\n\r\n    tool.propType = prop.type;\r\n    tool.inputs.destType.setValue(prop.type);\r\n\r\n    if (prop && (prop.flag & PropFlags.USE_BASE_UNDO)) {\r\n      tool.inputs.fullSaveUndo.setValue(true);\r\n    }\r\n\r\n    let mask = PropTypes.FLAG | PropTypes.ENUM;\r\n    mask |= PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4 | PropTypes.QUAT;\r\n\r\n    if (rdef.subkey !== undefined && (prop.type & mask)) {\r\n      if (prop.type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n        let i = datapath.length - 1;\r\n\r\n        //chope off enum selector\r\n        while (i >= 0 && datapath[i] !== '[' && datapath[i] !== '=') {\r\n          i--;\r\n        }\r\n\r\n        if (i >= 0) {\r\n          if (!value && prop.type === PropTypes.ENUM) {\r\n            /* This is a no-op. */\r\n            return undefined;\r\n          }\r\n\r\n          datapath = datapath.slice(0, i).trim();\r\n        }\r\n\r\n        tool.inputs.prop = new IntProperty();\r\n      } else {\r\n        tool.inputs.prop = new FloatProperty();\r\n      }\r\n\r\n      let subkey = rdef.subkey;\r\n      if (typeof subkey !== \"number\") {\r\n        subkey = rdef.prop.values[subkey];\r\n      }\r\n\r\n      if (prop.type === PropTypes.FLAG) {\r\n        tool.inputs.flagBit.setValue(subkey);\r\n        tool.inputs.useFlagBit.setValue(true);\r\n      }\r\n\r\n      if (prop.type === PropTypes.ENUM) {\r\n        value = subkey;\r\n      } else if (prop.type === PropTypes.FLAG) {\r\n        let value2 = ctx.api.getValue(ctx, datapath);\r\n\r\n        if (typeof value2 !== \"number\") {\r\n          value2 = typeof value2 === \"boolean\" ? (value & 1) : 0;\r\n        }\r\n\r\n        if (value) {\r\n          value2 |= subkey;\r\n        } else {\r\n          value2 &= ~subkey;\r\n        }\r\n\r\n        value = value2;\r\n      }\r\n      //value = rdef.obj[rdef.key];\r\n      //console.log(\"rdef.value\", value);\r\n    } else {\r\n      tool.inputs.prop = prop.copy();\r\n    }\r\n\r\n    tool.inputs.dataPath.setValue(datapath);\r\n\r\n    if (massSetPath) {\r\n      tool.inputs.massSetPath.setValue(massSetPath);\r\n    } else {\r\n      tool.inputs.massSetPath.setValue(\"\");\r\n    }\r\n\r\n    tool.id = id;\r\n\r\n    tool.setValue(ctx, value, rdef.obj);\r\n\r\n    return tool;\r\n  }\r\n\r\n  hash(massSetPath, dataPath, prop, id) {\r\n    massSetPath = massSetPath === undefined ? \"\" : massSetPath;\r\n    massSetPath = massSetPath === null ? \"\" : massSetPath;\r\n\r\n    let ret = \"\" + massSetPath + \":\" + dataPath + \":\" + prop + \":\" + id;\r\n\r\n    return ret;\r\n  }\r\n\r\n  hashThis() {\r\n    return this.hash(this.inputs.massSetPath.getValue(),\r\n      this.inputs.dataPath.getValue(),\r\n      this.propType,\r\n      this.id);\r\n  }\r\n\r\n  undoPre(ctx) {\r\n    if (this.inputs.fullSaveUndo.getValue()) {\r\n      return super.undoPre(ctx);\r\n    }\r\n\r\n    if (this.__ctx)\r\n      ctx = this.__ctx;\r\n\r\n    this._undo = {};\r\n\r\n    let paths = new Set();\r\n\r\n    if (this.inputs.massSetPath.getValue().trim()) {\r\n      let massSetPath = this.inputs.massSetPath.getValue().trim();\r\n\r\n      paths = new Set(ctx.api.resolveMassSetPaths(ctx, massSetPath));\r\n\r\n    }\r\n\r\n    paths.add(this.inputs.dataPath.getValue());\r\n\r\n    for (let path of paths) {\r\n      let val = ctx.api.getValue(ctx, path);\r\n\r\n      if (typeof val === \"object\") {\r\n        val = val.copy();\r\n      }\r\n\r\n      this._undo[path] = val;\r\n    }\r\n\r\n    /*\r\n    for (let path of paths) {\r\n      let rdef = ctx.api.resolvePath(ctx, path);\r\n\r\n      if (rdef === undefined) {\r\n        console.warn(\"Failed to lookup path in DataPathSetOp.undoPre\", path);\r\n        continue;\r\n      }\r\n\r\n      let prop = rdef.prop;\r\n      let value = rdef.value;\r\n\r\n      if (prop.type & (PropTypes.ENUM|PropTypes.FLAG)) {\r\n        this._undo[path] = rdef.obj[rdef.key];\r\n      } else if (isVecProperty(prop)) {\r\n        if (rdef.subkey) {\r\n          this._undo[path] = rdef.value;\r\n        } else {\r\n          let cls = getVecClass(prop.type);\r\n          this._undo[path] = new cls(rdef.value);\r\n        }\r\n      } else {\r\n        let prop2 = prop.copy();\r\n\r\n        prop2.dataref = rdef.obj;\r\n        prop2.datapath = path;\r\n        prop2.ctx = ctx;\r\n\r\n        prop2.setValue(value);\r\n\r\n        this._undo[path] = prop2.getValue();\r\n      }\r\n    }*/\r\n  }\r\n\r\n  undo(ctx) {\r\n    if (this.__ctx)\r\n      ctx = this.__ctx;\r\n\r\n    if (this.inputs.fullSaveUndo.getValue()) {\r\n      return super.undo(ctx);\r\n    }\r\n\r\n    for (let path in this._undo) {\r\n      let rdef = ctx.api.resolvePath(ctx, path);\r\n\r\n      if (rdef.prop !== undefined && (rdef.prop.type & (PropTypes.ENUM | PropTypes.FLAG))) {\r\n        let old = rdef.obj[rdef.key];\r\n\r\n        if (rdef.subkey) {\r\n          let key = rdef.subkey;\r\n\r\n          if (typeof key !== \"number\") {\r\n            key = rdef.prop.values[key];\r\n          }\r\n\r\n          if (rdef.prop.type === PropTypes.FLAG) {\r\n            if (this._undo[path]) {\r\n              rdef.obj[rdef.key] |= key;\r\n            } else {\r\n              rdef.obj[rdef.key] &= ~key;\r\n            }\r\n          } else {\r\n            rdef.obj[rdef.key] = key;\r\n          }\r\n        } else {\r\n          rdef.obj[rdef.key] = this._undo[path];\r\n        }\r\n\r\n        rdef.prop.dataref = rdef.obj;\r\n        rdef.prop.datapath = path;\r\n        rdef.prop.ctx = ctx;\r\n\r\n        rdef.prop._fire(\"change\", rdef.obj[rdef.key], old);\r\n      } else {\r\n        try {\r\n          ctx.api.setValue(ctx, path, this._undo[path]);\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n          console.warn(\"Failed to set property in undo for DataPathSetOp\");\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  exec(ctx) {\r\n    //use saved ctx we got from modal start\r\n    if (this.__ctx) {\r\n      ctx = this.__ctx;\r\n    }\r\n\r\n    let path = this.inputs.dataPath.getValue();\r\n    let massSetPath = this.inputs.massSetPath.getValue().trim();\r\n\r\n    try {\r\n      ctx.api.setValue(ctx, path, this.inputs.prop.getValue());\r\n      this.hadError = false;\r\n    } catch (error) {\r\n      console.log(error.stack);\r\n      console.log(error.message);\r\n      console.log(\"error setting \" + path);\r\n\r\n      this.hadError = true;\r\n    }\r\n\r\n    if (massSetPath) {\r\n      let value = this.inputs.prop.getValue();\r\n      let useFlagBit = this.inputs.useFlagBit.getValue();\r\n\r\n      if (useFlagBit && this.inputs.destType.getValue() === PropTypes.FLAG) {\r\n        let bit = this.inputs.flagBit.getValue();\r\n\r\n        value = !!(value & bit);\r\n      }\r\n      try {\r\n        ctx.api.massSetProp(ctx, massSetPath, value);\r\n      } catch (error) {\r\n        console.log(error.stack);\r\n        console.log(error.message);\r\n        console.log(\"error setting \" + path);\r\n\r\n        this.hadError = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  modalStart(ctx) {\r\n    this.__ctx = ctx.toLocked();\r\n\r\n    //save full, modal ctx\r\n    super.modalStart(this.__ctx);\r\n\r\n    this.exec(this.__ctx);\r\n    this.modalEnd(false);\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname  : \"Property Set\",\r\n      toolpath: \"app.prop_set\",\r\n      icon    : -1,\r\n      flag    : ToolFlags.PRIVATE,\r\n      is_modal: true,\r\n      inputs  : {\r\n        dataPath    : new StringProperty(),\r\n        massSetPath : new StringProperty(),\r\n        fullSaveUndo: new BoolProperty(false),\r\n        flagBit     : new IntProperty(),\r\n        useFlagBit  : new BoolProperty(),\r\n        destType    : new EnumProperty(PropTypes.INT, PropTypes),\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nToolOp.register(DataPathSetOp);\r\n","/**\r\n\r\n This is the main datapath controller module, inspired by Blender's RNA system.\r\n\r\n Datapaths are special bindings for objects; they store types (e.g. float, int, enumeration, string),\r\n as well as lots of UI-specific metadata (like human-readable names, tooltips, icons, numeric ranges, etc).\r\n\r\n Controller bindings are intended to present a more unified and coherent model of the\r\n application model than may actually exists.  This is inspired by Blender's RNA system, which\r\n hides almost all of Blender's core data structure complexity (Blender is written in C) from\r\n users who e.g. write python scripts, extend the UI, use advanced animation features, or anything else\r\n that uses RNA paths.\r\n\r\n ## Contexts\r\n\r\n The datapath system works in tandem with the context module.  Contexts are client-provided classes\r\n that the datapath API and ToolOps use to communicate with the application state.\r\n\r\n ## Example\r\n\r\n <pre>\r\n\r\n function initMyDataAPI() {\r\n  let api = new DataAPI();\r\n\r\n  //map MyContextClass to a struct, true tells mapStruct to auto-create\r\n  //the struct if it doesn't already exist\r\n  let st = api.mapStruct(MyContextClass, true);\r\n\r\n  //set fields of struct, e.g. st.int, st.float, st.enum, st.struct, etc\r\n\r\n  //build toolsys api\r\n  buildToolSysAPI(api);\r\n\r\n  //create bindings for default tool operator settings\r\n  cstruct.struct(\"propCache\", \"toolDefaults\", \"Tool Defaults\", api.mapStruct(ToolPropertyCache));\r\n\r\n  return api;\r\n}\r\n </pre>\r\n */\r\nimport * as toolprop from '../toolsys/toolprop.js';\r\nimport * as parseutil from '../util/parseutil.js';\r\nimport {print_stack} from '../util/util.js';\r\nimport {ToolOp, UndoFlags, ToolFlags} from \"../toolsys/toolsys.js\";\r\nimport {Vec2Property, Vec3Property, Vec4Property, PropTypes, PropFlags} from '../toolsys/toolprop.js';\r\nimport * as toolprop_abstract from '../toolsys/toolprop_abstract.js';\r\nimport * as util from '../util/util.js';\r\n\r\nimport {DataPath, DataFlags, DataTypes, DataPathError, StructFlags, getTempProp} from './controller_base.js';\r\n\r\nexport * from './controller_base.js';\r\n\r\nlet PUTLParseError = parseutil.PUTLParseError;\r\n\r\nlet tk = (name, re, func) => new parseutil.tokdef(name, re, func);\r\nlet tokens = [\r\n  tk(\"ID\", /[a-zA-Z_$]+[a-zA-Z_$0-9]*/),\r\n  tk(\"NUM\", /-?[0-9]+/, (t) => {\r\n    t.value = parseInt(t.value);\r\n    return t;\r\n  }),\r\n  tk('NUMBER', /-?[0-9]+\\.[0-9]*/, (t) => {\r\n    t.value = parseFloat(t.value);\r\n    return t;\r\n  }),\r\n  tk(\"STRLIT\", /'.*?'/, (t) => {\r\n    t.value = t.value.slice(1, t.value.length - 1);\r\n    return t;\r\n  }),\r\n  tk(\"STRLIT\", /\".*?\"/, (t) => {\r\n    t.value = t.value.slice(1, t.value.length - 1);\r\n    return t;\r\n  }),\r\n  tk(\"DOT\", /\\./),\r\n  tk(\"EQUALS\", /(\\=)|(\\=\\=)/),\r\n  tk(\"LSBRACKET\", /\\[/),\r\n  tk(\"RSBRACKET\", /\\]/),\r\n  tk(\"AND\", /\\&/),\r\n  tk(\"WS\", /[ \\t\\n\\r]+/, (t) => undefined) //drok token\r\n];\r\n\r\nlet lexer = new parseutil.lexer(tokens, (t) => {\r\n  console.warn(\"Parse error\", t);\r\n  throw new DataPathError();\r\n});\r\n\r\nexport let pathParser = new parseutil.parser(lexer);\r\n\r\nlet parserStack = new Array(32);\r\nfor (let i = 0; i < parserStack.length; i++) {\r\n  parserStack[i] = pathParser.copy();\r\n}\r\nparserStack.cur = 0;\r\n\r\nimport {\r\n  setImplementationClass, isVecProperty, ListIface\r\n} from './controller_base.js';\r\nimport {initToolPaths, parseToolPath} from '../toolsys/toolpath.js';\r\nimport {ModelInterface} from './controller_abstract.js';\r\n\r\nexport {DataPathError, DataFlags} from './controller_base.js';\r\n\r\nimport {ToolClasses} from '../toolsys/toolsys.js';\r\nimport {ToolProperty, IntProperty} from \"../toolsys/toolprop.js\";\r\n\r\nlet tool_classes = ToolClasses;\r\n\r\nlet tool_idgen = 1;\r\nSymbol.ToolID = Symbol(\"toolid\");\r\n\r\nfunction toolkey(cls) {\r\n  if (!(Symbol.ToolID in cls)) {\r\n    cls[Symbol.ToolID] = tool_idgen++;\r\n  }\r\n\r\n  return cls[Symbol.ToolID];\r\n}\r\n\r\nlet lt = util.time_ms();\r\nlet lastmsg = undefined;\r\nlet lcount = 0;\r\n\r\nlet reportstack = [\"api\"];\r\n\r\nexport function pushReportName(name) {\r\n  if (reportstack.length > 1024) {\r\n    console.trace(\"eerk, reportstack overflowed\");\r\n    reportstack.length = 0;\r\n    reportstack.push(\"api\");\r\n  }\r\n\r\n  reportstack.push(name);\r\n}\r\n\r\nfunction report(msg) {\r\n  let name = reportstack.length === 0 ? \"api\" : reportstack[reportstack.length - 1];\r\n\r\n  util.console.context(name).warn(msg);\r\n}\r\n\r\nexport function popReportName() {\r\n  reportstack.pop();\r\n}\r\n\r\n\r\nexport class DataList extends ListIface {\r\n  constructor(callbacks) {\r\n    super();\r\n\r\n    if (callbacks === undefined) {\r\n      throw new DataPathError(\"missing callbacks argument to DataList\");\r\n    }\r\n\r\n    this.cb = {};\r\n\r\n    if (typeof callbacks === \"object\" && !Array.isArray(callbacks)) {\r\n      for (let k in callbacks) {\r\n        this.cb[k] = callbacks[k];\r\n      }\r\n    } else {\r\n      for (let cb of callbacks) {\r\n        this.cb[cb.name] = cb;\r\n      }\r\n    }\r\n\r\n    let check = (key) => {\r\n      if (!(key in this.cbs)) {\r\n        throw new DataPathError(`Missing ${key} callback in DataList`);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   Generic list API.\r\n\r\n   * Callbacks is an array of name functions, like so:\r\n   - function getStruct(api, list, key) //return DataStruct type of object in key, key is optional if omitted return base type of all objects?\r\n   - function get(api, list, key)\r\n   - function set(api, list, key, val) //this one has default behavior: list[key] = val\r\n   - function getLength(api, list)\r\n   - function getActive(api, list)\r\n   - function setActive(api, list, key)\r\n   - function getIter(api, list)\r\n   - function getKey(api, list, object) returns object's key in this list, either a string or a number\r\n   * */\r\n\r\n  copy() {\r\n    let ret = new DataList([this.cb.get]);\r\n\r\n    for (let k in this.cb) {\r\n      ret.cb[k] = this.cb[k];\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  get(api, list, key) {\r\n    return this.cb.get(api, list, key);\r\n  }\r\n\r\n  getLength(api, list) {\r\n    this._check(\"getLength\");\r\n    return this.cb.getLength(api, list);\r\n  }\r\n\r\n  _check(cb) {\r\n    if (!(cb in this.cb)) {\r\n      throw new DataPathError(cb + \" not supported by this list\");\r\n    }\r\n  }\r\n\r\n  set(api, list, key, val) {\r\n    if (this.cb.set === undefined) {\r\n      list[key] = val;\r\n    } else {\r\n      this.cb.set(api, list, key, val);\r\n    }\r\n  }\r\n\r\n  getIter(api, list) {\r\n    this._check(\"getIter\");\r\n    return this.cb.getIter(api, list);\r\n  }\r\n\r\n  filter(api, list, bitmask) {\r\n    this._check(\"filter\");\r\n    return this.cb.filter(api, list, bitmask);\r\n  }\r\n\r\n  getActive(api, list) {\r\n    this._check(\"getActive\");\r\n    return this.cb.getActive(api, list);\r\n  }\r\n\r\n  setActive(api, list, key) {\r\n    this._check(\"setActive\");\r\n    this.cb.setActive(api, list, key);\r\n  }\r\n\r\n  getKey(api, list, obj) {\r\n    this._check(\"getKey\");\r\n    return this.cb.getKey(api, list, obj);\r\n  }\r\n\r\n  getStruct(api, list, key) {\r\n    if (this.cb.getStruct !== undefined) {\r\n      return this.cb.getStruct(api, list, key);\r\n    }\r\n\r\n    let obj = this.get(api, list, key);\r\n\r\n    if (obj === undefined)\r\n      return undefined;\r\n\r\n    return api.getStruct(obj.constructor);\r\n  }\r\n}\r\n\r\nexport class DataStruct {\r\n  constructor(members = [], name = \"unnamed\") {\r\n    this.members = [];\r\n    this.name = name;\r\n    this.pathmap = {};\r\n    this.flag = 0;\r\n    this.dpath = undefined; //owning DataPath\r\n\r\n    this.inheritFlag = 0;\r\n\r\n    for (let m of members) {\r\n      this.add(m);\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this.pathmap = {};\r\n    this.members = [];\r\n\r\n    return this;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new DataStruct();\r\n\r\n    ret.name = this.name;\r\n    ret.flag = this.flag;\r\n    ret.inheritFlag = this.inheritFlag;\r\n\r\n    for (let m of this.members) {\r\n      let m2 = m.copy();\r\n\r\n      //don't copy struct or list references, just\r\n      //direct properties\r\n\r\n      if (m2.type === DataTypes.PROP) {\r\n        m2.data = m2.data.copy();\r\n      }\r\n\r\n      ret.add(m2);\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   * Like .struct, but the type of struct is looked up\r\n   * for objects at runtime.  Note that to work correctly each object\r\n   * must create its own struct definition via api.mapStruct\r\n   *\r\n   * @param path\r\n   * @param apiname\r\n   * @param uiname\r\n   * @param default_struct : default struct if one can't be looked up\r\n   * @returns {*}\r\n   */\r\n  dynamicStruct(path, apiname, uiname, default_struct = undefined) {\r\n    let ret = default_struct ? default_struct : new DataStruct();\r\n\r\n    let dpath = new DataPath(path, apiname, ret, DataTypes.DYNAMIC_STRUCT);\r\n    ret.inheritFlag |= this.inheritFlag;\r\n\r\n    ret.dpath = dpath;\r\n\r\n    this.add(dpath);\r\n    return ret;\r\n  }\r\n\r\n  struct(path, apiname, uiname, existing_struct = undefined) {\r\n    let ret = existing_struct ? existing_struct : new DataStruct();\r\n\r\n    let dpath = new DataPath(path, apiname, ret, DataTypes.STRUCT);\r\n    ret.inheritFlag |= this.inheritFlag;\r\n\r\n    ret.dpath = dpath;\r\n\r\n    this.add(dpath);\r\n    return ret;\r\n  }\r\n\r\n  customGet(getter) {\r\n    this.dpath.customGet(getter);\r\n\r\n    return this;\r\n  }\r\n\r\n  customGetSet(getter, setter) {\r\n    this.dpath.customGetSet(getter, setter);\r\n\r\n    return this;\r\n  }\r\n\r\n  color3(path, apiname, uiname, description) {\r\n    let ret = this.vec3(path, apiname, uiname, description);\r\n\r\n    ret.data.subtype = toolprop.PropSubTypes.COLOR;\r\n    ret.range(0, 1);\r\n    ret.simpleSlider();\r\n\r\n    ret.noUnits();\r\n\r\n    return ret;\r\n  }\r\n\r\n  color4(path, apiname, uiname, description = uiname) {\r\n    let ret = this.vec4(path, apiname, uiname, description);\r\n\r\n    ret.data.subtype = toolprop.PropSubTypes.COLOR;\r\n    ret.range(0, 1);\r\n    ret.simpleSlider();\r\n\r\n    ret.noUnits();\r\n\r\n    return ret;\r\n  }\r\n\r\n  arrayList(path, apiname, structdef, uiname, description) {\r\n    let ret = this.list(path, apiname, [\r\n      function getIter(api, list) {\r\n        return list[Symbol.iterator]();\r\n      },\r\n      function getLength(api, list) {\r\n        return list.length;\r\n      },\r\n      function get(api, list, key) {\r\n        return list[key];\r\n      },\r\n      function set(api, list, key, val) {\r\n        if (typeof key === \"string\") {\r\n          key = parseInt(key);\r\n        }\r\n\r\n        if (key < 0 || key >= list.length) {\r\n          throw new DataPathError(\"Invalid index \" + key);\r\n        }\r\n\r\n        list[key] = val;\r\n      },\r\n      function getKey(api, list, obj) {\r\n        return list.indexOf(obj);\r\n      },\r\n      function getStruct(api, list, key) {\r\n        return structdef;\r\n      }]);\r\n\r\n    return ret;\r\n  }\r\n\r\n  color3List(path, apiname, uiname, description) {\r\n    return this.vectorList(3, path, apiname, uiname, description, toolprop.PropSubTypes.COLOR);\r\n  }\r\n\r\n  color4List(path, apiname, uiname, description) {\r\n    return this.vectorList(4, path, apiname, uiname, description, toolprop.PropSubTypes.COLOR);\r\n  }\r\n\r\n  vectorList(size, path, apiname, uiname, description, subtype) {\r\n    let type;\r\n\r\n    switch (size) {\r\n      case 2:\r\n        type = toolprop.Vec2Property;\r\n        break;\r\n      case 3:\r\n        type = toolprop.Vec3Property;\r\n      case 4:\r\n        type = toolprop.Vec4Property;\r\n    }\r\n\r\n    if (type === undefined) {\r\n      throw new DataPathError(\"Invalid size for vectorList; expected 2 3 or 4\");\r\n    }\r\n\r\n    let prop = new type(undefined, apiname, uiname, description);\r\n\r\n    let pstruct = new DataStruct(undefined, \"Vector\");\r\n    pstruct.vec3(\"\", \"co\", \"Coords\", \"Coordinates\");\r\n\r\n    let ret = this.list(path, apiname, [\r\n      function getIter(api, list) {\r\n        return list[Symbol.iterator]();\r\n      },\r\n      function getLength(api, list) {\r\n        return list.length;\r\n      },\r\n      function get(api, list, key) {\r\n        return list[key];\r\n      },\r\n      function set(api, list, key, val) {\r\n        if (typeof key == \"string\") {\r\n          key = parseInt(key);\r\n        }\r\n\r\n        if (key < 0 || key >= list.length) {\r\n          throw new DataPathError(\"Invalid index \" + key);\r\n        }\r\n\r\n        list[key] = val;\r\n      },\r\n      function getKey(api, list, obj) {\r\n        return list.indexOf(obj);\r\n      },\r\n      function getStruct(api, list, key) {\r\n        return pstruct;\r\n      }]);\r\n\r\n    return ret;\r\n  }\r\n\r\n  bool(path, apiname, uiname, description) {\r\n    let prop = new toolprop.BoolProperty(undefined, apiname, uiname, description);\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  vec2(path, apiname, uiname, description) {\r\n    let prop = new toolprop.Vec2Property(undefined, apiname, uiname, description);\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  vec3(path, apiname, uiname, description) {\r\n    let prop = new toolprop.Vec3Property(undefined, apiname, uiname, description);\r\n    //prop.uiname = uiname;\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  vec4(path, apiname, uiname, description) {\r\n    let prop = new toolprop.Vec4Property(undefined, apiname, uiname, description);\r\n    //prop.uiname = uiname;\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  float(path, apiname, uiname, description) {\r\n    let prop = new toolprop.FloatProperty(0, apiname, uiname, description);\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  textblock(path, apiname, uiname, description) {\r\n    let prop = new toolprop.StringProperty(undefined, apiname, uiname, description);\r\n    prop.multiLine = true;\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  report(path, apiname, uiname, description) {\r\n    let prop = new toolprop.ReportProperty(undefined, apiname, uiname, description);\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  string(path, apiname, uiname, description) {\r\n    let prop = new toolprop.StringProperty(undefined, apiname, uiname, description);\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  int(path, apiname, uiname, description, prop = undefined) {\r\n    if (!prop) {\r\n      prop = new toolprop.IntProperty(0, apiname, uiname, description);\r\n    }\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  curve1d(path, apiname, uiname, description) {\r\n    let prop = new toolprop.Curve1DProperty(undefined);\r\n\r\n    prop.apiname = apiname;\r\n    prop.uiname = uiname;\r\n    prop.description = description;\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  enum(path, apiname, enumdef, uiname, description) {\r\n    let prop;\r\n\r\n    if (enumdef instanceof toolprop.EnumProperty) {\r\n      prop = enumdef;\r\n    } else {\r\n      prop = new toolprop.EnumProperty(undefined, enumdef, apiname, uiname, description);\r\n    }\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  list(path, apiname, funcs) {\r\n    let array = new DataList(funcs);\r\n\r\n    let dpath = new DataPath(path, apiname, array);\r\n    dpath.type = DataTypes.ARRAY;\r\n\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  flags(path, apiname, enumdef, uiname, description) {\r\n    let prop;\r\n\r\n    if (enumdef === undefined || !(enumdef instanceof toolprop.ToolProperty)) {\r\n      prop = new toolprop.FlagProperty(undefined, enumdef, apiname, uiname, description);\r\n    } else {\r\n      prop = enumdef;\r\n    }\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  remove(m) {\r\n    if (typeof m === \"string\") {\r\n      m = this.pathmap[m];\r\n    }\r\n\r\n    if (!(m.apiname in this.pathmap)) {\r\n      throw new Error(\"Member not in struct \" + m.apiname);\r\n    }\r\n\r\n    delete this.pathmap[m.apiname];\r\n    this.members.remove(m);\r\n  }\r\n\r\n  fromToolProp(path, prop, apiname) {\r\n    if (apiname === undefined) {\r\n      apiname = prop.apiname !== undefined && prop.apiname.length > 0 ? prop.apiname : k;\r\n    }\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n\r\n    this.add(dpath);\r\n\r\n    return dpath;\r\n  }\r\n\r\n  add(m) {\r\n    if (m.apiname in this.pathmap) {\r\n      if (window.DEBUG.datapaths) {\r\n        console.warn(\"Overriding existing member '\" + m.apiname + \"' in datapath struct\", this.name);\r\n      }\r\n\r\n      this.remove(this.pathmap[m.apiname]);\r\n    }\r\n\r\n    m.flag |= this.inheritFlag;\r\n\r\n    this.members.push(m);\r\n    m.parent = this;\r\n\r\n    this.pathmap[m.apiname] = m;\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nlet _map_struct_idgen = 1;\r\nlet _map_structs = {};\r\n\r\nwindow._debug__map_structs = _map_structs; //global for debugging purposes only\r\n\r\nlet _dummypath = new DataPath();\r\n\r\nlet DummyIntProperty = new IntProperty();\r\nconst CLS_API_KEY = Symbol(\"dp_map_id\");\r\nconst CLS_API_KEY_CUSTOM = Symbol(\"dp_map_custom\");\r\n\r\nexport class DataAPI extends ModelInterface {\r\n  constructor() {\r\n    super();\r\n\r\n    this.rootContextStruct = undefined;\r\n    this.structs = [];\r\n  }\r\n\r\n  get list() {\r\n    return undefined;\r\n  }\r\n\r\n  static toolRegistered(cls) {\r\n    return ToolOp.isRegistered(cls);\r\n    //let key = toolkey(cls);\r\n    //return key in tool_classes;\r\n  }\r\n\r\n  static registerTool(cls) {\r\n    console.warn(\"Outdated function simple_controller.DataAPI.registerTool called\");\r\n\r\n    return ToolOp.register(cls);\r\n\r\n    //let key = toolkey(cls);\r\n    //\r\n    //if (!(key in tool_classes)) {\r\n    //  tool_classes[key] = cls;\r\n    //}\r\n  }\r\n\r\n  getStructs() {\r\n    return this.structs;\r\n  }\r\n\r\n  setRoot(sdef) {\r\n    this.rootContextStruct = sdef;\r\n  }\r\n\r\n  hasStruct(cls) {\r\n    return cls.hasOwnProperty(CLS_API_KEY);\r\n  }\r\n\r\n  getStruct(cls) {\r\n    return this.mapStruct(cls, false);\r\n  }\r\n\r\n  mergeStructs(dest, src) {\r\n    for (let m of src.members) {\r\n      dest.add(m.copy());\r\n    }\r\n  }\r\n\r\n  inheritStruct(cls, parent, auto_create_parent = false) {\r\n    let st = this.mapStruct(parent, auto_create_parent);\r\n\r\n    if (st === undefined) {\r\n      throw new Error(\"parent has no struct definition\");\r\n    }\r\n\r\n    st = st.copy();\r\n    st.name = cls.name;\r\n\r\n    this._addClass(cls, st);\r\n    return st;\r\n  }\r\n\r\n  /**\r\n   * Look up struct definition for a class.\r\n   *\r\n   * @param cls: the class\r\n   * @param auto_create: If true, automatically create definition if not already existing.\r\n   * @returns {IterableIterator<*>}\r\n   */\r\n\r\n  _addClass(cls, dstruct) {\r\n    let key = _map_struct_idgen++;\r\n    cls[CLS_API_KEY] = key;\r\n\r\n    this.structs.push(dstruct);\r\n\r\n    _map_structs[key] = dstruct;\r\n  }\r\n\r\n  /* Associate cls with a DataStruct\r\n   * via callback, which will be called\r\n   * with an instance of cls as its argument*/\r\n  mapStructCustom(cls, callback) {\r\n    this.mapStruct(cls, true);\r\n    cls[CLS_API_KEY_CUSTOM] = callback;\r\n  }\r\n\r\n  mapStruct(cls, auto_create = true, name = cls.name) {\r\n    let key;\r\n\r\n    if (!cls.hasOwnProperty(CLS_API_KEY)) {\r\n      key = undefined;\r\n    } else {\r\n      key = cls[CLS_API_KEY];\r\n    }\r\n\r\n    if (key === undefined && auto_create) {\r\n      let dstruct = new DataStruct(undefined, name);\r\n      this._addClass(cls, dstruct);\r\n      return dstruct;\r\n    } else if (key === undefined) {\r\n      throw new Error(\"class does not have a struct definition: \" + name);\r\n    }\r\n\r\n    return _map_structs[key];\r\n  }\r\n\r\n  //used for tagging error messages\r\n  pushReportContext(name) {\r\n    pushReportName(name);\r\n  }\r\n\r\n  //used for tagging error messages\r\n  popReportContext() {\r\n    popReportName();\r\n  }\r\n\r\n  /*\r\n  massSetProp operate on lists.  The idea is to\r\n  write a filter str inside a data path, e.g.\r\n\r\n  ctx.api.massSetProp(ctx, \"obj.list[{$.select}].value\", 1);\r\n\r\n\r\n  * */\r\n  massSetProp(ctx, massSetPath, value) {\r\n    for (let path of this.resolveMassSetPaths(ctx, massSetPath)) {\r\n      this.setValue(ctx, path, value);\r\n    }\r\n  }\r\n\r\n  resolveMassSetPaths(ctx, massSetPath) {\r\n    if (massSetPath.startsWith(\"/\")) {\r\n      massSetPath = massSetPath.slice(1, massSetPath.length);\r\n    }\r\n\r\n    let start = massSetPath.search(\"{\");\r\n    let end = massSetPath.search(\"}\");\r\n\r\n    if (start < 0 || end < 0) {\r\n      throw new DataPathError(\"Invalid mass set datapath: \" + massSetPath);\r\n      return;\r\n    }\r\n\r\n    let prefix = massSetPath.slice(0, start - 1);\r\n    let filter = massSetPath.slice(start + 1, end);\r\n    let suffix = massSetPath.slice(end + 2, massSetPath.length);\r\n\r\n    let rdef = this.resolvePath(ctx, prefix);\r\n\r\n    if (!(rdef.prop instanceof DataList)) {\r\n      throw new DataPathError(\"massSetPath expected a path resolving to a DataList: \" + massSetPath);\r\n    }\r\n\r\n    let paths = [];\r\n\r\n    let list = rdef.prop;\r\n    let api = ctx.api;\r\n\r\n    function applyFilter(obj) {\r\n      //console.log(filter, obj, obj.constructor.name);\r\n\r\n      if (obj === undefined) {\r\n        return undefined;\r\n      } else if (typeof obj === \"object\" || typeof obj === \"function\") {\r\n        let st = api.mapStruct(obj.constructor, false);\r\n\r\n        let path = filter;\r\n        if (path.startsWith(\"$\")) {\r\n          path = path.slice(1, filter.length).trim();\r\n        }\r\n        if (path.startsWith(\".\")) {\r\n          path = path.slice(1, filter.length).trim();\r\n        }\r\n\r\n        try {\r\n          return api.getValue(obj, path, st);\r\n        } catch (error) {\r\n          if (!(error instanceof DataPathError)) {\r\n            util.print_stack(error);\r\n            console.error(\"Error in datapath callback\");\r\n          }\r\n\r\n          return false;\r\n        }\r\n      } else {\r\n        let $ = obj;\r\n        return eval(filter);\r\n      }\r\n    }\r\n\r\n    for (let obj of list.getIter(this, rdef.value)) {\r\n      if (!applyFilter(obj)) {\r\n        continue;\r\n      }\r\n\r\n      let key = \"\" + list.getKey(this, rdef.value, obj);\r\n      let path = `${prefix}[${key}]${suffix}`;\r\n\r\n      /* validate the final path */\r\n      try {\r\n        this.getValue(ctx, path);\r\n      } catch (error) {\r\n        if (!(error instanceof DataPathError)) {\r\n          util.print_stack(error);\r\n          console.error(path + \": Error in datapath API\");\r\n        }\r\n\r\n        continue;\r\n      }\r\n\r\n      paths.push(path);\r\n    }\r\n\r\n    return paths;\r\n  }\r\n\r\n  resolvePath(ctx, inpath, ignoreExistence = false, dstruct = undefined) {\r\n    let parser = parserStack[parserStack.cur++];\r\n    let ret = undefined;\r\n\r\n    if (inpath[0] === \"/\") {\r\n      inpath = inpath.slice(1, inpath.length).trim();\r\n    }\r\n\r\n    try {\r\n      ret = this.resolvePath_intern(ctx, inpath, ignoreExistence, parser, dstruct)\r\n    } catch (error) {\r\n      //throw new DataPathError(\"bad path \" + path);\r\n      if (!(error instanceof DataPathError)) {\r\n        util.print_stack(error);\r\n        report(\"error while evaluating path \" + inpath);\r\n      }\r\n\r\n      if (window.DEBUG && window.DEBUG.datapaths) {\r\n        util.print_stack(error);\r\n      }\r\n\r\n      ret = undefined;\r\n    }\r\n\r\n    parserStack.cur--;\r\n\r\n    if (ret !== undefined && ret.prop && ret.dpath && (ret.dpath.flag & DataFlags.USE_CUSTOM_PROP_GETTER)) {\r\n      ret.prop = this.getPropOverride(ctx, inpath, ret.dpath, ret.obj);\r\n    }\r\n\r\n    if (ret !== undefined && ret.prop && ret.dpath && ret.dpath.ui_name_get) {\r\n      let dummy = {\r\n        datactx : ctx,\r\n        datapath: inpath,\r\n        dataref : ret.obj\r\n      };\r\n\r\n      let name = ret.dpath.ui_name_get.call(dummy);\r\n\r\n      ret.prop.uiname = \"\" + name;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  getPropOverride(ctx, path, dpath, obj, prop = dpath.data) {\r\n    prop.ctx = ctx;\r\n    prop.datapath = path;\r\n    prop.dataref = obj;\r\n\r\n    let newprop = getTempProp(prop.type);\r\n    prop.copyTo(newprop);\r\n\r\n    dpath.propGetter.call(prop, newprop);\r\n    prop.ctx = prop.datapath = prop.dataref = undefined;\r\n\r\n    return newprop;\r\n  }\r\n\r\n  /**\r\n   get meta information for a datapath.\r\n\r\n   @param ignoreExistence: don't try to get actual data associated with path,\r\n   just want meta information\r\n   */\r\n  resolvePath_intern(ctx, inpath, ignoreExistence = false, p = pathParser, dstruct = undefined) {\r\n    inpath = inpath.replace(\"==\", \"=\");\r\n\r\n    p.input(inpath);\r\n\r\n    dstruct = dstruct || this.rootContextStruct;\r\n\r\n    let obj = ctx;\r\n    let lastobj = ctx;\r\n    let subkey;\r\n    let lastobj2 = undefined;\r\n    let lastkey = undefined;\r\n    let prop = undefined;\r\n    let lastdpath = undefined;\r\n\r\n    function p_key() {\r\n      let t = p.peeknext();\r\n      if (t.type === \"NUM\" || t.type === \"STRLIT\") {\r\n        p.next();\r\n        return t.value;\r\n      } else {\r\n        throw new PUTLParseError(\"Expected list key\");\r\n      }\r\n    }\r\n\r\n    let _i = 0;\r\n    while (!p.at_end()) {\r\n      let key = p.expect(\"ID\");\r\n      let dpath = dstruct.pathmap[key];\r\n\r\n      lastdpath = dpath;\r\n\r\n      if (dpath === undefined) {\r\n        if (key === \"length\" && prop !== undefined && prop instanceof DataList) {\r\n          prop.getLength(this, obj);\r\n          key = \"length\";\r\n\r\n          prop = DummyIntProperty;\r\n\r\n          prop.name = \"length\";\r\n          prop.flag = PropFlags.READ_ONLY;\r\n\r\n          dpath = _dummypath;\r\n          dpath.type = DataTypes.PROP;\r\n          dpath.data = prop;\r\n          dpath.struct = dpath.parent = dstruct;\r\n          dpath.flag = DataFlags.READ_ONLY;\r\n          dpath.path = \"length\";\r\n\r\n          /*\r\n          parent: lastobj2,\r\n            obj: lastobj,\r\n            value: obj,\r\n            key: lastkey,\r\n            //*/\r\n        } else if (key === \"active\" && prop !== undefined && prop instanceof DataList) {\r\n          let act = prop.getActive(this, obj);\r\n\r\n          if (act === undefined && !ignoreExistence) {\r\n            throw new DataPathError(\"no active elem ent for list\");\r\n          }\r\n\r\n          let actkey = obj !== undefined && act !== undefined ? prop.getKey(this, obj, act) : undefined;\r\n\r\n          dstruct = prop.getStruct(this, obj, actkey);\r\n          if (dstruct === undefined) {\r\n            throw new DataPathError(\"couldn't get data type for \" + inpath + \"'s element '\" + key + \"'\");\r\n          }\r\n\r\n          _dummypath.parent = dpath;\r\n          dpath = _dummypath;\r\n\r\n          lastobj = obj;\r\n          obj = act;\r\n\r\n          dpath.type = DataTypes.STRUCT;\r\n          dpath.data = dstruct;\r\n          dpath.path = key;\r\n\r\n          p.optional(\"DOT\");\r\n\r\n          continue;\r\n        } else {\r\n          throw new DataPathError(inpath + \": unknown property \" + key);\r\n        }\r\n      }\r\n\r\n      let dynstructobj = undefined;\r\n\r\n      if (dpath.type === DataTypes.STRUCT) {\r\n        dstruct = dpath.data;\r\n      } else if (dpath.type === DataTypes.DYNAMIC_STRUCT) {\r\n        let ok = false;\r\n\r\n        if (obj !== undefined) {\r\n          let obj2;\r\n\r\n          if (dpath.flag & DataFlags.USE_CUSTOM_GETSET) {\r\n            let fakeprop = dpath.getSet;\r\n            fakeprop.ctx = ctx;\r\n            fakeprop.dataref = obj;\r\n            fakeprop.datapath = inpath;\r\n\r\n            obj2 = fakeprop.get();\r\n\r\n            fakeprop.ctx = fakeprop.datapath = fakeprop.dataref = undefined;\r\n          } else {\r\n            obj2 = obj[dpath.path];\r\n          }\r\n\r\n          dynstructobj = obj2;\r\n\r\n          if (obj2 !== undefined) {\r\n            if (CLS_API_KEY_CUSTOM in obj2.constructor) {\r\n              dstruct = obj2.constructor[CLS_API_KEY_CUSTOM](obj2);\r\n            } else {\r\n              dstruct = this.mapStruct(obj2.constructor, false);\r\n            }\r\n          } else {\r\n            dstruct = dpath.data;\r\n          }\r\n\r\n          if (dstruct === undefined) {\r\n            dstruct = dpath.data;\r\n          }\r\n\r\n          ok = dstruct !== undefined;\r\n        }\r\n\r\n        if (!ok) {\r\n          throw new DataPathError(\"dynamic struct error for path: \" + inpath);\r\n        }\r\n      } else {\r\n        prop = dpath.data;\r\n      }\r\n\r\n      if (prop && (dpath.flag & DataFlags.USE_CUSTOM_PROP_GETTER)) {\r\n        prop = this.getPropOverride(ctx, inpath, dpath, obj);\r\n      }\r\n\r\n      if (dpath.path.search(/\\./) >= 0) {\r\n        let keys = dpath.path.split(/\\./);\r\n\r\n        for (let key of keys) {\r\n          lastobj2 = lastobj;\r\n          lastobj = obj;\r\n          lastkey = key;\r\n\r\n          if (obj === undefined && !ignoreExistence) {\r\n            throw new DataPathError(\"no data for \" + inpath);\r\n          } else if (obj !== undefined) {\r\n            obj = obj[key.trim()];\r\n          }\r\n        }\r\n      } else {\r\n        lastobj2 = lastobj;\r\n        lastobj = obj;\r\n\r\n        lastkey = dpath.path;\r\n\r\n        if (dpath.flag & DataFlags.USE_CUSTOM_GETSET) {\r\n          let fakeprop = dpath.getSet;\r\n\r\n          if (!fakeprop && dpath.type === DataTypes.PROP) {\r\n            let prop = dpath.data;\r\n\r\n            prop.ctx = ctx;\r\n            prop.dataref = obj;\r\n            prop.datapath = inpath;\r\n\r\n            try {\r\n              obj = prop.getValue();\r\n            } catch (error) {\r\n              util.print_stack(error);\r\n              obj = undefined;\r\n            }\r\n\r\n            if (typeof obj === \"string\" && (prop.type & (PropTypes.ENUM | PropTypes.FLAG))) {\r\n              obj = prop.values[obj];\r\n            }\r\n\r\n            prop.ctx = prop.dataref = prop.datapath = undefined;\r\n          } else {\r\n            fakeprop.ctx = ctx;\r\n            fakeprop.dataref = obj;\r\n            fakeprop.datapath = inpath;\r\n\r\n            obj = fakeprop.get();\r\n            fakeprop.ctx = fakeprop.datapath = fakeprop.dataref = undefined;\r\n          }\r\n        } else if (obj === undefined && !ignoreExistence) {\r\n          throw new DataPathError(\"no data for \" + inpath);\r\n        } else if (dpath.type === DataTypes.DYNAMIC_STRUCT) {\r\n          obj = dynstructobj;\r\n        } else if (obj !== undefined && dpath.path !== \"\") {\r\n          obj = obj[dpath.path];\r\n        }\r\n      }\r\n\r\n      let t = p.peeknext();\r\n      if (t === undefined) {\r\n        break;\r\n      }\r\n\r\n      if (t.type === \"DOT\") {\r\n        p.next();\r\n      } else if (t.type === \"EQUALS\" && prop !== undefined && (prop.type & (PropTypes.ENUM | PropTypes.FLAG))) {\r\n        p.expect(\"EQUALS\");\r\n\r\n        let t2 = p.peeknext();\r\n        let type = t2 && t2.type === \"ID\" ? \"ID\" : \"NUM\";\r\n\r\n        let val = p.expect(type);\r\n\r\n        let val1 = val;\r\n\r\n        if (typeof val == \"string\") {\r\n          val = prop.values[val];\r\n        }\r\n\r\n        if (val === undefined) {\r\n          throw new DataPathError(\"unknown value \" + val1);\r\n        }\r\n\r\n        if (val in prop.keys) {\r\n          subkey = prop.keys[val];\r\n        }\r\n\r\n        key = dpath.path;\r\n        obj = !!(lastobj[key] == val);\r\n      } else if (t.type === \"AND\" && prop !== undefined && (prop.type & (PropTypes.ENUM | PropTypes.FLAG))) {\r\n        p.expect(\"AND\");\r\n\r\n        let t2 = p.peeknext();\r\n        let type = t2 && t2.type === \"ID\" ? \"ID\" : \"NUM\";\r\n\r\n        let val = p.expect(type);\r\n\r\n        let val1 = val;\r\n\r\n        if (typeof val == \"string\") {\r\n          val = prop.values[val];\r\n        }\r\n\r\n        if (val === undefined) {\r\n          throw new DataPathError(\"unknown value \" + val1);\r\n        }\r\n\r\n        if (val in prop.keys) {\r\n          subkey = prop.keys[val];\r\n        }\r\n\r\n        key = dpath.path;\r\n        obj = !!(lastobj[key] & val);\r\n      } else if (t.type === \"LSBRACKET\" && prop !== undefined && (prop.type & (PropTypes.ENUM | PropTypes.FLAG))) {\r\n        p.expect(\"LSBRACKET\");\r\n\r\n        let t2 = p.peeknext();\r\n        let type = t2 && t2.type === \"ID\" ? \"ID\" : \"NUM\";\r\n\r\n        let val = p.expect(type);\r\n\r\n        let val1 = val;\r\n\r\n        if (typeof val == \"string\") {\r\n          val = prop.values[val];\r\n        }\r\n\r\n        if (val === undefined) {\r\n          console.warn(inpath, prop.values, val1, prop);\r\n          throw new DataPathError(\"unknown value \" + val1);\r\n        }\r\n\r\n        if (val in prop.keys) {\r\n          subkey = prop.keys[val];\r\n        }\r\n\r\n        let bitfield;\r\n        key = dpath.path;\r\n\r\n        if (!(prop.flag & PropFlags.USE_CUSTOM_GETSET)) {\r\n          bitfield = lastobj ? lastobj[key] : 0;\r\n        } else {\r\n          prop.dataref = lastobj;\r\n          prop.datapath = inpath;\r\n          prop.ctx = ctx;\r\n\r\n          try {\r\n            bitfield = prop.getValue();\r\n          } catch (error) {\r\n            util.print_stack(error);\r\n\r\n            bitfield = NaN;\r\n          }\r\n        }\r\n\r\n        if (lastobj === undefined && !ignoreExistence) {\r\n          throw new DataPathError(\"no data for path \" + inpath);\r\n        } else if (lastobj !== undefined) {\r\n          if (prop.type === PropTypes.ENUM) {\r\n            obj = !!(bitfield === val);\r\n          } else {\r\n            obj = !!(bitfield & val);\r\n          }\r\n        }\r\n\r\n        p.expect(\"RSBRACKET\");\r\n      } else if (t.type === \"LSBRACKET\" && prop !== undefined && isVecProperty(prop)) {\r\n        p.expect(\"LSBRACKET\");\r\n        let num = p.expect(\"NUM\");\r\n        p.expect(\"RSBRACKET\");\r\n\r\n        subkey = num;\r\n\r\n        if (prop !== undefined && !(prop.type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4 | PropTypes.QUAT))) {\r\n          lastobj = obj;\r\n        }\r\n\r\n        obj = obj[num];\r\n      } else if (t.type === \"LSBRACKET\") {\r\n        p.expect(\"LSBRACKET\")\r\n\r\n        if (lastobj && lastkey && typeof lastkey === \"string\" && lastkey.length > 0) {\r\n          lastobj = lastobj[lastkey];\r\n        }\r\n\r\n        lastkey = p_key();\r\n        p.expect(\"RSBRACKET\");\r\n\r\n        if (!(prop instanceof DataList)) {\r\n          throw new DataPathError(\"bad property, not a list\");\r\n        }\r\n\r\n        obj = prop.get(this, lastobj, lastkey);\r\n        dstruct = prop.getStruct(this, lastobj, lastkey);\r\n\r\n        if (!dstruct) {\r\n          throw new DataPathError(inpath + \": list has no entry \" + lastkey);\r\n        }\r\n\r\n        if (p.peeknext() !== undefined && p.peeknext().type === \"DOT\") {\r\n          p.next();\r\n        }\r\n      }\r\n\r\n      if (_i++ > 1000) {\r\n        console.warn(\"infinite loop in resolvePath parser\");\r\n        break;\r\n      }\r\n    }\r\n\r\n    return {\r\n      dpath  : lastdpath,\r\n      parent : lastobj2,\r\n      obj    : lastobj,\r\n      value  : obj,\r\n      key    : lastkey,\r\n      dstruct: dstruct,\r\n      prop   : prop,\r\n      subkey : subkey\r\n    };\r\n  }\r\n\r\n  resolvePathOld2(ctx, path) {\r\n    let splitchars = new Set([\".\", \"[\", \"]\", \"=\", \"&\"]);\r\n    let subkey = undefined;\r\n\r\n    path = path.replace(/\\=\\=/g, \"=\");\r\n\r\n    path = \".\" + this.prefix + path;\r\n\r\n    let p = [\"\"];\r\n    for (let i = 0; i < path.length; i++) {\r\n      let s = path[i];\r\n\r\n      if (splitchars.has(s)) {\r\n        if (s !== \"]\") {\r\n          p.push(s);\r\n        }\r\n\r\n        p.push(\"\");\r\n        continue;\r\n      }\r\n\r\n      p[p.length - 1] += s;\r\n    }\r\n\r\n    for (let i = 0; i < p.length; i++) {\r\n      p[i] = p[i].trim();\r\n\r\n      if (p[i].length === 0) {\r\n        p.remove(p[i]);\r\n        i--;\r\n      }\r\n\r\n      let c = parseInt(p[i]);\r\n      if (!isNaN(c)) {\r\n        p[i] = c;\r\n      }\r\n    }\r\n\r\n    let i = 0;\r\n\r\n    let parent1, obj = ctx, parent2;\r\n    let key = undefined;\r\n    let dstruct = undefined;\r\n    let arg = undefined;\r\n    let type = \"normal\";\r\n    let retpath = p;\r\n    let prop;\r\n    let lastkey = key, a;\r\n    let apiname = key;\r\n\r\n    while (i < p.length - 1) {\r\n      lastkey = key;\r\n      apiname = key;\r\n\r\n      if (dstruct !== undefined && dstruct.pathmap[lastkey]) {\r\n        let dpath = dstruct.pathmap[lastkey];\r\n\r\n        apiname = dpath.apiname;\r\n      }\r\n\r\n      let a = p[i];\r\n      let b = p[i + 1];\r\n\r\n      //check for enum/flag propertys with [] form\r\n      if (a === \"[\") {\r\n        let ok = false;\r\n\r\n        key = b;\r\n        prop = undefined;\r\n\r\n        if (dstruct !== undefined && dstruct.pathmap[lastkey]) {\r\n          let dpath = dstruct.pathmap[lastkey];\r\n\r\n          if (dpath.type === DataTypes.PROP) {\r\n            prop = dpath.data;\r\n          }\r\n        }\r\n\r\n        if (prop !== undefined && (prop.type === PropTypes.ENUM || prop.type === PropTypes.FLAG)) {\r\n          util.console.context(\"api\").log(\"found flag/enum property\");\r\n          ok = true;\r\n        }\r\n\r\n        if (ok) {\r\n          if (isNaN(parseInt(key))) {\r\n            key = prop.values[key];\r\n          } else if (typeof key == \"int\") {\r\n            key = parseInt(key);\r\n          }\r\n\r\n          let value = obj;\r\n          if (typeof value == \"string\") {\r\n            value = prop.values[key];\r\n          }\r\n\r\n          if (prop.type === PropTypes.ENUM) {\r\n            value = !!(value == key);\r\n          } else { //flag\r\n            value = !!(value & key);\r\n          }\r\n\r\n          if (key in prop.keys) {\r\n            subkey = prop.keys[key];\r\n          }\r\n\r\n          obj = value;\r\n          i++;\r\n          continue;\r\n        }\r\n      }\r\n\r\n      if (dstruct !== undefined && dstruct.pathmap[lastkey]) {\r\n        let dpath = dstruct.pathmap[lastkey];\r\n\r\n        if (dpath.type == DataTypes.PROP) {\r\n          prop = dpath.data;\r\n        }\r\n      }\r\n\r\n      if (a === \".\" || a === \"[\") {\r\n        key = b;\r\n\r\n        parent2 = parent1;\r\n        parent1 = obj;\r\n        obj = obj[b];\r\n\r\n        if (obj === undefined || obj === null) {\r\n          break;\r\n        }\r\n\r\n        if (typeof obj == \"object\") {\r\n          dstruct = this.mapStruct(obj.constructor, false);\r\n        }\r\n\r\n        i += 2;\r\n        continue;\r\n      } else if (a === \"&\") {\r\n        obj &= b;\r\n        arg = b;\r\n\r\n        if (b in prop.keys) {\r\n          subkey = prop.keys[b];\r\n        }\r\n\r\n        i += 2;\r\n        type = \"flag\";\r\n        continue;\r\n      } else if (a === \"=\") {\r\n        obj = obj == b;\r\n        arg = b;\r\n\r\n        if (b in prop.keys) {\r\n          subkey = prop.keys[b];\r\n        }\r\n\r\n        i += 2;\r\n        type = \"enum\";\r\n        continue;\r\n      } else {\r\n        throw new DataPathError(\"bad path \" + path);\r\n      }\r\n\r\n      i++;\r\n    }\r\n\r\n    if (lastkey !== undefined && dstruct !== undefined && dstruct.pathmap[lastkey]) {\r\n      let dpath = dstruct.pathmap[key];\r\n\r\n      apiname = dpath.apiname;\r\n    }\r\n\r\n\r\n    if (dstruct !== undefined && dstruct.pathmap[key]) {\r\n      let dpath = dstruct.pathmap[key];\r\n\r\n      if (dpath.type == DataTypes.PROP) {\r\n        prop = dpath.data;\r\n      }\r\n    }\r\n\r\n    return {\r\n      parent : parent2,\r\n      obj    : parent1,\r\n      value  : obj,\r\n      key    : key,\r\n      dstruct: dstruct,\r\n      subkey : subkey,\r\n      prop   : prop,\r\n      arg    : arg,\r\n      type   : type,\r\n      _path  : retpath\r\n    };\r\n  }\r\n\r\n  /*returns {\r\n    obj : [object owning property key]\r\n    parent : [parent of obj]\r\n    key : [property key]\r\n    value : [value of property]\r\n    prop : [optional toolprop.ToolProperty representing the property definition]\r\n    struct : [optional datastruct representing the type, if value is an object]\r\n  }\r\n  */\r\n  resolvePathold(ctx, path) {\r\n    path = this.prefix + path;\r\n    path = path.replace(/\\[/g, \".\").replace(/\\]/g, \"\").trim().split(\".\");\r\n\r\n    let parent1, obj = ctx, parent2;\r\n    let key = undefined;\r\n    let dstruct = undefined;\r\n\r\n    for (let c of path) {\r\n      let c2 = parseInt(c);\r\n      if (!isNaN(c2)) {\r\n        c = c2;\r\n      }\r\n\r\n      parent2 = parent1;\r\n      parent1 = obj;\r\n      key = c;\r\n\r\n      if (typeof obj == \"number\") {\r\n        //bitmask test\r\n        obj = obj & c;\r\n        break;\r\n      }\r\n\r\n      obj = obj[c];\r\n\r\n      if (typeof obj == \"object\") {\r\n        dstruct = this.mapStruct(obj.constructor, false);\r\n      }\r\n    }\r\n\r\n    let prop;\r\n\r\n    if (dstruct !== undefined && dstruct.pathmap[key]) {\r\n      let dpath = dstruct.pathmap[key];\r\n\r\n      if (dpath.type == DataTypes.PROP) {\r\n        prop = dpath.data;\r\n      }\r\n    }\r\n\r\n    return {\r\n      parent : parent2,\r\n      obj    : parent1,\r\n      value  : obj,\r\n      key    : key,\r\n      dstruct: dstruct,\r\n      prop   : prop\r\n    };\r\n  }\r\n\r\n  _parsePathOverrides(path) {\r\n    let parts = ['', undefined, undefined];\r\n\r\n    const TOOLPATH = 0, NAME = 1, HOTKEY = 2;\r\n    let part = TOOLPATH;\r\n\r\n    for (let i = 0; i < path.length; i++) {\r\n      let c = path[i];\r\n      let n = i < path.length - 1 ? path[i + 1] : \"\";\r\n\r\n      if (c === \"|\") {\r\n        part = NAME;\r\n        parts[NAME] = \"\";\r\n        continue;\r\n      } else if (c === \":\" && n === \":\") {\r\n        part = HOTKEY;\r\n        parts[HOTKEY] = \"\";\r\n        i++;\r\n        continue;\r\n      }\r\n\r\n      parts[part] += c;\r\n    }\r\n\r\n    return {\r\n      path  : parts[TOOLPATH].trim(),\r\n      uiname: parts[NAME] ? parts[NAME].trim() : undefined,\r\n      hotkey: parts[HOTKEY] ? parts[HOTKEY].trim() : undefined,\r\n    };\r\n  }\r\n\r\n  /** Get tooldef for path, applying any modifications, e.g.:\r\n   *  \"app.some_tool()|Label::CustomHotkeyString\"\r\n   * */\r\n  getToolDef(toolpath) {\r\n    let {path, uiname, hotkey} = this._parsePathOverrides(toolpath);\r\n\r\n    let cls = this.parseToolPath(path);\r\n    if (cls === undefined) {\r\n      throw new DataPathError(\"unknown path \\\"\" + path + \"\\\"\");\r\n    }\r\n\r\n    let def = cls.tooldef();\r\n    if (uiname) {\r\n      def.uiname = uiname;\r\n    }\r\n    if (hotkey) {\r\n      def.hotkey = hotkey;\r\n    }\r\n\r\n    return def;\r\n  }\r\n\r\n  getToolPathHotkey(ctx, toolpath) {\r\n    let {path, uiname, hotkey} = this._parsePathOverrides(toolpath);\r\n\r\n    if (hotkey) {\r\n      return hotkey;\r\n    }\r\n\r\n    try {\r\n      return this.#getToolPathHotkey_intern(ctx, path);\r\n    } catch (error) {\r\n      print_stack(error);\r\n      util.console.context(\"api\").log(\"failed to fetch tool path: \" + path);\r\n\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  #getToolPathHotkey_intern(ctx, path) {\r\n    let screen = ctx.screen;\r\n    let this2 = this;\r\n\r\n    function searchKeymap(keymap) {\r\n      if (keymap === undefined) {\r\n        return undefined;\r\n      }\r\n\r\n      let ret;\r\n\r\n      function search(cb) {\r\n        if (ret) {\r\n          return;\r\n        }\r\n\r\n        for (let hk of keymap) {\r\n          if (typeof hk.action === \"string\" && cb(hk.action)) {\r\n            ret = hk.buildString();\r\n          }\r\n        }\r\n      }\r\n\r\n      search((tool) => tool.trim() === path.trim());\r\n      search((tool) => this2._parsePathOverrides(tool).path === path.trim());\r\n\r\n      return ret;\r\n    }\r\n\r\n    if (screen.sareas.length === 0) {\r\n      return searchKeymap(screen.keymap);\r\n    }\r\n\r\n    //client might have its own area subclass with\r\n    //getActiveArea defined (that's encouraged),\r\n    //which is why we don't just call Area.getActiveArea\r\n    let areacls = screen.sareas[0].area.constructor;\r\n    let area = areacls.getActiveArea();\r\n\r\n    if (area) {\r\n      for (let keymap of area.getKeyMaps()) {\r\n        let ret = searchKeymap(keymap);\r\n\r\n        if (ret !== undefined) {\r\n          return ret;\r\n        }\r\n      }\r\n    }\r\n\r\n    //search all other areas\r\n    for (let sarea of screen.sareas) {\r\n      if (!sarea.area) continue;\r\n\r\n      for (let keymap of sarea.area.getKeyMaps()) {\r\n        let ret = searchKeymap(keymap);\r\n\r\n        if (ret) {\r\n          return ret;\r\n        }\r\n      }\r\n    }\r\n\r\n    return this.keymap ? searchKeymap(this.keymap) : false;\r\n  }\r\n\r\n  parseToolPath(path) {\r\n    try {\r\n      return parseToolPath(path).toolclass;\r\n    } catch (error) {\r\n      if (error instanceof DataPathError) {\r\n        console.warn(\"warning, bad tool path \" + path);\r\n        return undefined;\r\n      } else {\r\n        throw error;\r\n      }\r\n    }\r\n  }\r\n\r\n  parseToolArgs(path) {\r\n    return parseToolPath(path).args;\r\n  }\r\n\r\n  createTool(ctx, path, inputs = {}) {\r\n    let cls;\r\n    let args;\r\n\r\n    if (typeof path == \"string\" || path instanceof String) {\r\n      //parseToolPath will raise DataPathError if path is malformed\r\n      let tpath = parseToolPath(path);\r\n\r\n      cls = tpath.toolclass;\r\n      args = tpath.args;\r\n    } else {\r\n      cls = path;\r\n      args = {};\r\n    }\r\n\r\n    if (!cls) {\r\n      debugger;\r\n      console.error(\"Unknown tool \" + path);\r\n    }\r\n\r\n    let tool = cls.invoke(ctx, args);\r\n\r\n    if (inputs !== undefined) {\r\n      for (let k in inputs) {\r\n        if (!(k in tool.inputs)) {\r\n          console.warn(cls.tooldef().uiname + \": Unknown tool property \\\"\" + k + \"\\\"\");\r\n          continue;\r\n        }\r\n\r\n        tool.inputs[k].setValue(inputs[k]);\r\n      }\r\n    }\r\n\r\n    return tool;\r\n  }\r\n}\r\n\r\nexport function initSimpleController() {\r\n  initToolPaths();\r\n}\r\n\r\nimport {DataPathSetOp} from \"./controller_ops.js\";\r\n\r\nlet dpt = DataPathSetOp;\r\n\r\nexport function getDataPathToolOp() {\r\n  return dpt;\r\n}\r\n\r\nexport function setDataPathToolOp(cls) {\r\n  ToolOp.unregister(DataPathSetOp);\r\n\r\n  if (!ToolOp.isRegistered(cls)) {\r\n    ToolOp.register(cls);\r\n  }\r\n\r\n  dpt = cls;\r\n}\r\n\r\nsetImplementationClass(DataAPI);\r\n","import * as util from '../util/util.js';\r\nimport * as vectormath from '../util/vectormath.js';\r\nimport {Vector3, Vector4} from '../util/vectormath.js';\r\n\r\nlet rgb_to_hsv_rets = new util.cachering(() => [0, 0, 0], 64);\r\n\r\nexport function rgb_to_hsv(r, g, b) {\r\n  let computedH = 0;\r\n  let computedS = 0;\r\n  let computedV = 0;\r\n\r\n  if (r == null || g == null || b == null ||\r\n    isNaN(r) || isNaN(g) || isNaN(b)) {\r\n    throw new Error(`Please enter numeric RGB values! r: ${r} g: ${g} b: ${b}`);\r\n  }\r\n  /*\r\n  if (r<0 || g<0 || b<0 || r>1.0 || g>1.0 || b>1.0) {\r\n   throw new Error('RGB values must be in the range 0 to 1.0');\r\n   return;\r\n  }//*/\r\n\r\n  let minRGB = Math.min(r, Math.min(g, b));\r\n  let maxRGB = Math.max(r, Math.max(g, b));\r\n\r\n  // Black-gray-white\r\n  if (minRGB === maxRGB) {\r\n    computedV = minRGB;\r\n\r\n    let ret = rgb_to_hsv_rets.next();\r\n    ret[0] = 0, ret[1] = 0, ret[2] = computedV;\r\n    return ret;\r\n  }\r\n\r\n  // Colors other than black-gray-white:\r\n  let d = (r === minRGB) ? g - b : ((b === minRGB) ? r - g : b - r);\r\n  let h = (r === minRGB) ? 3 : ((b === minRGB) ? 1 : 5);\r\n\r\n  computedH = (60*(h - d/(maxRGB - minRGB)))/360.0;\r\n  computedS = (maxRGB - minRGB)/maxRGB;\r\n  computedV = maxRGB;\r\n\r\n  let ret = rgb_to_hsv_rets.next();\r\n  ret[0] = computedH, ret[1] = computedS, ret[2] = computedV;\r\n  return ret;\r\n}\r\n\r\nlet hsv_to_rgb_rets = new util.cachering(() => [0, 0, 0], 64);\r\n\r\nexport function hsv_to_rgb(h, s, v) {\r\n  let c = 0, m = 0, x = 0;\r\n  let ret = hsv_to_rgb_rets.next();\r\n\r\n  ret[0] = ret[1] = ret[2] = 0.0;\r\n  h *= 360.0;\r\n\r\n  c = v*s;\r\n  x = c*(1.0 - Math.abs(((h/60.0)%2) - 1.0));\r\n  m = v - c;\r\n  let color;\r\n\r\n  function RgbF_Create(r, g, b) {\r\n    ret[0] = r;\r\n    ret[1] = g;\r\n    ret[2] = b;\r\n\r\n    return ret;\r\n  }\r\n\r\n  if (h >= 0.0 && h < 60.0) {\r\n    color = RgbF_Create(c + m, x + m, m);\r\n  } else if (h >= 60.0 && h < 120.0) {\r\n    color = RgbF_Create(x + m, c + m, m);\r\n  } else if (h >= 120.0 && h < 180.0) {\r\n    color = RgbF_Create(m, c + m, x + m);\r\n  } else if (h >= 180.0 && h < 240.0) {\r\n    color = RgbF_Create(m, x + m, c + m);\r\n  } else if (h >= 240.0 && h < 300.0) {\r\n    color = RgbF_Create(x + m, m, c + m);\r\n  } else if (h >= 300.0) {\r\n    color = RgbF_Create(c + m, m, x + m);\r\n  } else {\r\n    color = RgbF_Create(m, m, m);\r\n  }\r\n\r\n  return color;\r\n}\r\n\r\nlet rgb_to_cmyk_rets = util.cachering.fromConstructor(Vector4, 512);\r\nlet cmyk_to_rgb_rets = util.cachering.fromConstructor(Vector3, 512);\r\n\r\nexport function cmyk_to_rgb(c, m, y, k) {\r\n  let ret = cmyk_to_rgb_rets.next();\r\n\r\n  if (k === 1.0) {\r\n    ret.zero();\r\n    return ret;\r\n  }\r\n\r\n  c = c - c*k + k;\r\n  m = m - m*k + k;\r\n  y = y - y*k + k;\r\n\r\n  ret[0] = 1.0 - c;\r\n  ret[1] = 1.0 - m;\r\n  ret[2] = 1.0 - y;\r\n\r\n  return ret;\r\n}\r\n\r\nexport function rgb_to_cmyk(r, g, b) {\r\n  //CMYK and CMY values from 0 to 1\r\n  let ret = rgb_to_cmyk_rets.next();\r\n\r\n  let C = 1.0 - r;\r\n  let M = 1.0 - g;\r\n  let Y = 1.0 - b;\r\n\r\n  let var_K = 1\r\n\r\n  if (C < var_K) var_K = C\r\n  if (M < var_K) var_K = M\r\n  if (Y < var_K) var_K = Y\r\n  if (var_K === 1) { //Black\r\n    C = 0\r\n    M = 0\r\n    Y = 0\r\n  } else {\r\n    C = (C - var_K)/(1 - var_K)\r\n    M = (M - var_K)/(1 - var_K)\r\n    Y = (Y - var_K)/(1 - var_K)\r\n  }\r\n\r\n  let K = var_K\r\n\r\n  ret[0] = C;\r\n  ret[1] = M;\r\n  ret[2] = Y;\r\n  ret[3] = K;\r\n\r\n  return ret;\r\n}\r\n\r\n","import {CSSFont} from './ui_theme.js';\r\n\r\nexport const DefaultTheme = {\r\n  base: {\r\n    AreaHeaderBG        : 'rgba(200, 200, 200, 0.95)',\r\n    BasePackFlag        : 0,\r\n    BoxDepressed        : 'rgba(130,130,130, 1)',\r\n    BoxHighlight        : 'rgba(151,208,239, 1)',\r\n    \"flex-grow\"         : \"unset\",\r\n    mobileSizeMultiplier: 1.0,\r\n    DefaultText         : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 14,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n    LabelText           : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 14,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n    TitleText           : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 12,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n    'background-color'  : 'rgba(207,207,207, 0.5)',\r\n    'border-color'      : 'rgba(34,34,34, 1)',\r\n    'border-radius'     : 12.010619764585666,\r\n    'focus-border-width': 2,\r\n    oneAxisPadding      : 2,\r\n    padding             : 1,\r\n  },\r\n\r\n  button: {\r\n    DefaultText        : new CSSFont({\r\n      font   : 'poppins',\r\n      weight : 'bold',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 12,\r\n      color  : 'rgba(35,35,35, 1)'\r\n    }),\r\n    'background-color' : 'rgba(238,238,238, 0.8672412740773168)',\r\n    'border-color'     : 'rgba(255,255,255, 1)',\r\n    'border-radius'    : 4,\r\n    'border-style'     : 'solid',\r\n    'border-width'     : 2,\r\n    disabled           : {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgb(109,109,109)'\r\n      }),\r\n      'background-color': 'rgb(19,19,19)',\r\n      'border-color'    : '#f58f8f',\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 1,\r\n    },\r\n    height             : 25,\r\n    highlight          : {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgba(255,255,255, 1)'\r\n      }),\r\n      'background-color': 'rgba(138,222,255, 1)',\r\n      'border-color'    : 'rgba(255,255,255, 1)',\r\n      'border-radius'   : 4,\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 2,\r\n    },\r\n    'highlight-pressed': {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgba(35,35,35, 1)'\r\n      }),\r\n      'background-color': 'rgba(113,113,113, 1)',\r\n      'border-color'    : '#DADCE0',\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 1,\r\n    },\r\n    margin             : 4,\r\n    'margin-left'      : 4,\r\n    'margin-right'     : 4,\r\n    padding            : 1,\r\n    pressed            : {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgba(35,35,35, 1)'\r\n      }),\r\n      'background-color': 'rgba(113,113,113, 1)',\r\n      'border-color'    : '#DADCE0',\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 1,\r\n    },\r\n    width              : 25,\r\n  },\r\n\r\n  checkbox: {\r\n    CheckSide         : 'left',\r\n    height            : 32,\r\n    width             : 32,\r\n    \"background-color\": \"rgb(168,168,168)\",\r\n  },\r\n\r\n  colorfield: {\r\n    circleSize    : 11,\r\n    colorBoxHeight: 24,\r\n    fieldSize     : 400,\r\n    height        : 256,\r\n    hueHeight     : 32,\r\n    width         : 256,\r\n  },\r\n\r\n  colorpickerbutton: {\r\n    height: 32,\r\n    width : 95,\r\n  },\r\n\r\n  curvewidget: {\r\n    CanvasBG    : 'rgb(44,44,44)',\r\n    CanvasHeight: 256,\r\n    CanvasWidth : 256,\r\n  },\r\n\r\n  dropbox: {\r\n    dropTextBG: 'rgba(233,233,233, 1)',\r\n    height    : 25,\r\n    width     : 32,\r\n  },\r\n\r\n  iconbutton: {\r\n    highlight: {\r\n      'background-color': 'rgba(133,182,255,0.8)',\r\n      'border-color'    : 'black',\r\n      'border-radius'   : 5,\r\n      'border-width'    : 1,\r\n      height            : 32,\r\n      'margin-bottom'   : 1,\r\n      'margin-left'     : 2,\r\n      'margin-right'    : 2,\r\n      'margin-top'      : 1,\r\n      padding           : 2,\r\n      width             : 32,\r\n    },\r\n    depressed: {\r\n      'background-color': 'rgba(42,61,77,0.8)',\r\n      'border-color'    : 'black',\r\n      'border-radius'   : 5,\r\n      'border-width'    : 1,\r\n      height            : 32,\r\n      'margin-bottom'   : 1,\r\n      'margin-left'     : 2,\r\n      'margin-right'    : 2,\r\n      'margin-top'      : 1,\r\n      padding           : 2,\r\n      width             : 32,\r\n    },\r\n\r\n    'background-color': 'rgba(15,15,15, 0)',\r\n    'border-color'    : 'black',\r\n    'border-radius'   : 5,\r\n    'border-width'    : 1,\r\n    height            : 32,\r\n    'margin-bottom'   : 1,\r\n    'margin-left'     : 2,\r\n    'margin-right'    : 2,\r\n    'margin-top'      : 1,\r\n    padding           : 2,\r\n    width             : 32,\r\n  },\r\n\r\n  iconcheck: {\r\n    highlight         : {\r\n      'background-color': 'rgba(133,182,255,0.8)',\r\n      'border-color'    : 'black',\r\n      'border-radius'   : 5,\r\n      'border-width'    : 1,\r\n      height            : 32,\r\n      'margin-bottom'   : 1,\r\n      'margin-left'     : 2,\r\n      'margin-right'    : 2,\r\n      'margin-top'      : 1,\r\n      padding           : 2,\r\n      width             : 32,\r\n    },\r\n    depressed         : {\r\n      'background-color': 'rgba(42,61,77,0.8)',\r\n      'border-color'    : 'black',\r\n      'border-radius'   : 5,\r\n      'border-width'    : 1,\r\n      height            : 32,\r\n      'margin-bottom'   : 1,\r\n      'margin-left'     : 2,\r\n      'margin-right'    : 2,\r\n      'margin-top'      : 1,\r\n      padding           : 2,\r\n      width             : 32,\r\n    },\r\n    'background-color': 'rgba(15,15,15, 0)',\r\n    'border-color'    : 'rgba(237,209,209, 1)',\r\n    'border-radius'   : 5,\r\n    'border-width'    : 0,\r\n    drawCheck         : true,\r\n    height            : 32,\r\n    'margin-bottom'   : 1,\r\n    'margin-left'     : 2,\r\n    'margin-right'    : 2,\r\n    'margin-top'      : 1,\r\n    padding           : 2,\r\n    width             : 32,\r\n  },\r\n\r\n  label: {\r\n    LabelText: new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 14,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n  },\r\n\r\n  listbox: {\r\n    ListActive   : 'rgba(200, 205, 215, 1.0)',\r\n    ListHighlight: 'rgba(155, 220, 255, 0.5)',\r\n    height       : 200,\r\n    width        : 110,\r\n  },\r\n\r\n  menu: {\r\n    MenuBG          : 'rgba(250, 250, 250, 1.0)',\r\n    \"item-radius\"   : 0,\r\n    MenuBorder      : '1px solid grey',\r\n    MenuHighlight   : 'rgba(155, 220, 255, 1.0)',\r\n    MenuSeparator   : {\r\n      width             : \"100%\",\r\n      height            : 2,\r\n      padding           : 0,\r\n      margin            : 0,\r\n      border            : \"none\",\r\n      \"background-color\": \"grey\"\r\n    },\r\n    'box-shadow'    : '5px 5px 25px rgba(0,0,0,0.75)',\r\n    MenuSpacing     : 5,\r\n    MenuText        : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 12,\r\n      color  : 'rgba(25, 25, 25, 1.0)'\r\n    }),\r\n    \"padding-top\"   : 0,\r\n    \"padding-left\"  : 0,\r\n    \"padding-right\" : 0,\r\n    \"padding-bottom\": 0,\r\n    'border-color'  : 'grey',\r\n    'border-radius' : 5,\r\n    'border-style'  : 'solid',\r\n    'border-width'  : 1,\r\n  },\r\n\r\n  notification: {\r\n    DefaultText       : new CSSFont({\r\n      font   : 'poppins',\r\n      weight : 'bold',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 12,\r\n      color  : 'rgb(55,55,55)'\r\n    }),\r\n    \"background-color\": \"rgba(72,72,72,0)\",\r\n    \"border-radius\"   : 5,\r\n    \"border-color\"    : \"grey\",\r\n    \"border-width\"    : 1,\r\n    \"border-style\"    : \"solid\",\r\n    ProgressBarBG     : \"rgb(74,148,183)\",\r\n    ProgressBar       : \"rgb(250,132,58)\",\r\n  },\r\n\r\n  numslider: {\r\n    'arrow-color'     : '50%',\r\n    'background-color': 'rgba(219,219,219, 1)',\r\n    'border-color'    : 'rgba(255,255,255, 1)',\r\n    'border-radius'   : 1,\r\n    height            : 22,\r\n    highlight         : {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgb(0,0,0)'\r\n      }),\r\n      'background-color': 'rgba(151,208,239, 1)',\r\n      'border-color'    : 'rgba(255,255,255, 1)',\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 1,\r\n    },\r\n    pressed           : {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgba(0,0,0, 1)'\r\n      }),\r\n      'arrow-color'     : 'rgb(28,28,28)',\r\n      'background-color': 'rgba(178,178,178, 1)',\r\n      'border-color'    : 'rgba(255,255,255, 1)',\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 1,\r\n    },\r\n    width             : 115,\r\n    /*\r\n    'highlight-pressed'            : {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgb(245,245,245)'\r\n      }),\r\n      'background-color': 'rgb(126,126,126)',\r\n      'border-color'    : '#DADCE0',\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 1,\r\n    },*/\r\n  },\r\n\r\n  numslider_simple: {\r\n    SlideHeight       : 10,\r\n    TextBoxWidth      : 45,\r\n    'background-color': 'rgba(219,219,219, 1)',\r\n    height            : 18,\r\n    labelOnTop        : true,\r\n    addLabel          : true,\r\n    width             : 135,\r\n  },\r\n\r\n  numslider_textbox: {\r\n    TextBoxHeight     : 25,\r\n    TextBoxWidth      : 50,\r\n    'background-color': 'rgba(219,219,219, 1)',\r\n    height            : 25,\r\n    labelOnTop        : true,\r\n    addLabel          : false,\r\n    width             : 120,\r\n  },\r\n\r\n  panel: {\r\n    HeaderBorderRadius    : 5.329650280441558,\r\n    HeaderRadius          : 4,\r\n    TitleBackground       : 'rgba(177,219,255, 1)',\r\n    TitleBorder           : 'rgba(104,104,104, 1)',\r\n    TitleText             : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 14,\r\n      color  : 'rgba(0,0,0, 1)'\r\n    }),\r\n    'background-color'    : 'rgba(184,184,184, 0.7594818376068376)',\r\n    'border-color'        : 'rgba(0,0,0, 0.5598061397157866)',\r\n    'border-radius'       : 4,\r\n    'border-style'        : 'groove',\r\n    'border-width'        : 1.141,\r\n    'margin-bottom'       : 0,\r\n    'margin-bottom-closed': 0,\r\n    'margin-left'         : 5.6584810220495445,\r\n    'margin-right'        : 0,\r\n    'margin-top'          : 0,\r\n    'margin-top-closed'   : 0,\r\n    'padding-bottom'      : 0,\r\n    'padding-left'        : 0,\r\n    'padding-right'       : 0,\r\n    'padding-top'         : 0,\r\n  },\r\n\r\n  richtext: {\r\n    DefaultText       : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 16,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n    'background-color': 'rgb(245, 245, 245)',\r\n  },\r\n\r\n  screenborder: {\r\n    'border-inner'   : 'grey',\r\n    'border-outer'   : 'rgba(228,228,228, 1)',\r\n    'border-width'   : 2,\r\n    'mouse-threshold': 8,\r\n  },\r\n\r\n  scrollbars: {\r\n    border  : undefined,\r\n    color   : undefined,\r\n    color2  : undefined,\r\n    contrast: undefined,\r\n    width   : undefined,\r\n  },\r\n\r\n  sidebar: {\r\n    'background-color': 'rgba(55, 55, 55, 0.5)',\r\n  },\r\n\r\n  strip: {\r\n    'background-color': 'rgba(75,75,75, 0.33213141025641024)',\r\n    'border-color'    : 'rgba(0,0,0, 0.31325409987877156)',\r\n    'border-radius'   : 8.76503417507447,\r\n    'border-style'    : 'solid',\r\n    'border-width'    : 1,\r\n    margin            : 2,\r\n    oneAxisPadding    : 2,\r\n    padding           : 1,\r\n    \"flex-grow\"       : \"unset\",\r\n  },\r\n\r\n  tabs: {\r\n    \"focus-on-tab-click\": \"false\",\r\n    \"movable-tabs\"      : \"true\",\r\n    TabPadding_mobile   : 20, //padding perpindicular to the label text\r\n    TabPadding          : 0,\r\n    TabActive           : 'rgba(212,212,212, 1)',\r\n    TabBarRadius        : 6,\r\n    TabHighlight        : 'rgba(50, 50, 50, 0.2)',\r\n    TabInactive         : 'rgba(183,183,183, 1)',\r\n    TabStrokeStyle1     : 'rgba(0,0,0, 1)',\r\n    TabStrokeStyle2     : 'rgba(0,0,0, 1)',\r\n    TabText             : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'bold',\r\n      style  : 'normal',\r\n      size   : 15,\r\n      color  : 'rgba(0,0,0, 1)'\r\n    }),\r\n    'background-color'  : 'rgba(222,222,222, 1)',\r\n  },\r\n\r\n  textbox: {\r\n    DefaultText       : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 14,\r\n      color  : 'rgba(3,3,3, 1)'\r\n    }),\r\n    'border-color'    : \"rgba(0,0,0,0)\",\r\n    'border-width'    : 1,\r\n    \"border-radius\"   : 4,\r\n    \"border-style\"    : \"solid\",\r\n    'background-color': 'rgba(245,245,245, 1)',\r\n  },\r\n\r\n  tooltip: {\r\n    ToolTipText       : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'bold',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 12,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n    'background-color': 'rgba(255,255,255, 1)',\r\n    'border-color'    : 'rgba(139,139,139, 1)',\r\n    'border-radius'   : 3,\r\n    'border-style'    : 'solid',\r\n    'border-width'    : 1,\r\n    padding           : 5,\r\n  },\r\n\r\n  treeview: {\r\n    itemIndent: 10,\r\n    rowHeight : 18,\r\n  },\r\n\r\n  vecPopupButton: {\r\n    height : 18,\r\n    padding: 3,\r\n    width  : 100,\r\n  },\r\n\r\n};\r\n","\"use strict\";\r\n\r\n/*\r\nIcons are defined in spritesheets that live in\r\nthe iconsheet16/32 dom nodes.  Icons are numbered start from\r\nthe upper left sprite tile.\r\n\r\nThis function sets the mapping between icon numbers and names.\r\n\r\nThe following icons should be in the icon sheet and in this map:\r\n\r\nRESIZE      :\r\nSMALL_PLUS  :\r\nTRANSLATE   : for moving things\r\nUI_EXPAND   : panel open icon\r\nUI_COLLAPSE : panel close icon\r\nNOTE_EXCL   : exclamation mark for notifications\r\nHELP        : help symbol\r\n*/\r\nexport function setIconMap(icons) {\r\n  for (let k in icons) {\r\n    Icons[k] = icons[k];\r\n  }\r\n}\r\n\r\nlet a = 0;\r\nexport let Icons = {\r\n  FOLDER: a++,\r\n  FILE  : a++,\r\n  TINY_X: a++,\r\n\r\n  SMALL_PLUS : a++,\r\n  SMALL_MINUS: a++,\r\n  UNDO       : a++,\r\n\r\n  REDO: a++,\r\n  HELP: a++,\r\n\r\n  UNCHECKED   : a++,\r\n  CHECKED     : a++,\r\n  LARGE_CHECK : a++,\r\n  CURSOR_ARROW: a++,\r\n  NOTE_EXCL   : a++,\r\n  SCROLL_DOWN : a++,\r\n  SCROLL_UP   : a++,\r\n  BACKSPACE   : a++,\r\n  LEFT_ARROW  : a++,\r\n  RIGHT_ARROW : a++,\r\n  UI_EXPAND   : a++, //triangle\r\n  UI_COLLAPSE : a++, //triangle\r\n\r\n\r\n  BOLD         : a++,\r\n  ITALIC       : a++,\r\n  UNDERLINE    : a++,\r\n  STRIKETHRU   : a++,\r\n  TREE_EXPAND  : a++,\r\n  TREE_COLLAPSE: a++,\r\n  ZOOM_OUT     : a++,\r\n  ZOOM_IN      : a++,\r\n  LARGE_X      : a++, /* Used for curve widget delete button. */\r\n};\r\n/* used for icon checkboxes with overlayed check marks */\r\nIcons.ENUM_CHECKED = Icons.CHECKED;\r\nIcons.ENUM_UNCHECKED = Icons.UNCHECKED;\r\n\r\n\r\n","let exclude = new Set([\r\n  \"toString\", \"constructor\", \"prototype\", \"__proto__\", \"toLocaleString\",\r\n  \"hasOwnProperty\", \"shadow\"\r\n]);\r\n\r\nlet UIBase = undefined;\r\n\r\n//deal with circular module refrence\r\nexport function _setUIBase(uibase) {\r\n  UIBase = uibase;\r\n}\r\n\r\nlet AspectKeys = Symbol(\"aspect-keys\");\r\n\r\nexport function initAspectClass(object, blacklist = new Set()) {\r\n  let cls = object.constructor;\r\n\r\n  if (!cls[AspectKeys]) {\r\n    cls[AspectKeys] = [];\r\n    let keys = [];\r\n\r\n    let p = object.__proto__;\r\n    while (p) {\r\n      keys = keys.concat(Reflect.ownKeys(p));\r\n      p = p.__proto__;\r\n    }\r\n    keys = new Set(keys);\r\n\r\n    function validProperty(obj, key) {\r\n      let descr = Object.getOwnPropertyDescriptor(obj, key);\r\n\r\n      if (descr && (descr.get || descr.set)) {\r\n        return false;\r\n      }\r\n\r\n      let p = obj.constructor;\r\n      do {\r\n        if (p.prototype) {\r\n          let descr = Object.getOwnPropertyDescriptor(p.prototype, key);\r\n\r\n          if (descr && (descr.set || descr.get)) {\r\n            return false;\r\n          }\r\n        }\r\n\r\n        p = p.__proto__;\r\n      } while (p && p !== p.__proto__);\r\n\r\n      return true;\r\n    }\r\n\r\n    for (let k of keys) {\r\n      let v;\r\n\r\n      if (typeof k === \"string\" && k.startsWith(\"_\")) {\r\n        continue;\r\n      }\r\n\r\n      if (k === \"constructor\") {\r\n        continue;\r\n      }\r\n\r\n      if (blacklist.has(k) || exclude.has(k)) {\r\n        continue;\r\n      }\r\n\r\n      if (!validProperty(object, k)) {\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        v = object[k];\r\n      } catch (error) {\r\n        continue;\r\n      }\r\n\r\n      if (typeof v !== \"function\") {\r\n        continue;\r\n      }\r\n\r\n      cls[AspectKeys].push(k);\r\n    }\r\n  }\r\n\r\n  object.__aspect_methods = new Set();\r\n\r\n  for (let k of cls[AspectKeys]) {\r\n    AfterAspect.bind(object, k);\r\n  }\r\n}\r\n\r\nexport function clearAspectCallbacks(obj) {\r\n  for (let key of obj.__aspect_methods) {\r\n    obj[key].clear();\r\n  }\r\n}\r\n\r\n/**\r\n *\r\n * example:\r\n *\r\n * someobject.update.after(() => {\r\n *   do_something();\r\n *   return someobject.update.value;\r\n * }\r\n *\r\n * */\r\nexport class AfterAspect {\r\n  constructor(owner, key) {\r\n    this.owner = owner;\r\n    this.key = key;\r\n\r\n    this.chain = [[owner[key], false]];\r\n    this.chain2 = [[owner[key], false]];\r\n\r\n    this.root = [[owner[key], false]];\r\n\r\n    let this2 = this;\r\n\r\n    let method = this._method = function () {\r\n      let chain = this2.chain;\r\n      let chain2 = this2.chain2;\r\n\r\n      chain2.length = chain.length;\r\n\r\n      for (let i = 0; i < chain.length; i++) {\r\n        chain2[i] = chain[i];\r\n      }\r\n\r\n      for (let i = 0; i < chain2.length; i++) {\r\n        let [cb, node, once] = chain2[i];\r\n\r\n        if (node) {\r\n          let isDead = !node.isConnected;\r\n\r\n          if (node instanceof UIBase) {\r\n            isDead = isDead || node.isDead();\r\n          }\r\n\r\n          if (isDead) {\r\n            console.warn(\"pruning dead AfterAspect callback\", node);\r\n            chain.remove(chain2[i]);\r\n            continue;\r\n          }\r\n        }\r\n\r\n\r\n        if (once && chain.indexOf(chain2[i]) >= 0) {\r\n          chain.remove(chain2[i]);\r\n        }\r\n\r\n        if (cb && cb.apply) {\r\n          method.value = cb.apply(this, arguments);\r\n          //method.value = Reflect.apply(cb, this, arguments);\r\n          //cb.apply(this, args);\r\n        }\r\n      }\r\n\r\n      let ret = method.value;\r\n      method.value = undefined;\r\n\r\n      return ret;\r\n    };\r\n\r\n    this._method_bound = false;\r\n\r\n    method.after = this.after.bind(this);\r\n    method.once = this.once.bind(this);\r\n    method.remove = this.remove.bind(this);\r\n\r\n    owner[key].after = this.after.bind(this);\r\n    owner[key].once = this.once.bind(this);\r\n    owner[key].remove = this.remove.bind(this);\r\n  }\r\n\r\n  static bind(owner, key) {\r\n    owner.__aspect_methods.add(key);\r\n\r\n    return new AfterAspect(owner, key);\r\n  }\r\n\r\n  remove(cb) {\r\n    for (let item of this.chain) {\r\n      if (item[0] === cb) {\r\n        this.chain.remove(item);\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  once(cb, node) {\r\n    return this.after(cb, node, true);\r\n  }\r\n\r\n  _checkbind() {\r\n    if (!this._method_bound) {\r\n      this.owner[this.key] = this._method;\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this._checkbind();\r\n    this.chain = [[this.root[0][0], this.root[0][1]]];\r\n    this.chain2 = [[this.root[0][0], this.root[0][1]]];\r\n\r\n    return this;\r\n  }\r\n\r\n  before(cb, node, once) {\r\n    this._checkbind();\r\n\r\n    if (cb === undefined) {\r\n      console.warn(\"invalid call to .after(); cb was undefined\");\r\n      return this.owner;\r\n    }\r\n    this.chain = [[cb, node, once]].concat(this.chain);\r\n    return this.owner;\r\n  }\r\n\r\n  after(cb, node, once) {\r\n    this._checkbind();\r\n\r\n    if (cb === undefined) {\r\n      console.warn(\"invalid call to .after(); cb was undefined\");\r\n      return this.owner;\r\n    }\r\n    this.chain.push([cb, node, once]);\r\n    return this.owner;\r\n  }\r\n}\r\n","import {contextWrangler} from '../screen/area_wrangler.js';\r\n\r\nlet _ui_base = undefined;\r\n\r\n//avoid circular module references\r\nlet TextBox = undefined;\r\n\r\nexport function _setTextboxClass(cls) {\r\n  TextBox = cls;\r\n}\r\n\r\n//import * as ui_save from './ui_save.js';\r\n\r\n/*\r\nif (window.document && document.body) {\r\n  console.log(\"ensuring body.style.margin/padding are zero\");\r\n  document.body.style[\"margin\"] = \"0px\";\r\n  document.body.style[\"padding\"] = \"0px\";\r\n}\r\n */\r\n\r\nimport {Animator} from \"./anim.js\";\r\nimport './units.js';\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as math from '../path-controller/util/math.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport {\r\n  pushModalLight, popModalLight, copyEvent, pathDebugEvent,\r\n  haveModal, keymap, reverse_keymap, pushPointerModal\r\n} from '../path-controller/util/simple_events.js';\r\nimport {getDataPathToolOp} from '../path-controller/controller/controller.js';\r\nimport * as units from './units.js';\r\nimport {rgb_to_hsv, hsv_to_rgb} from \"../util/colorutils.js\";\r\n\r\nexport * from './ui_theme.js';\r\n\r\nimport {CSSFont, theme, parsepx, compatMap} from \"./ui_theme.js\";\r\n\r\nimport {DefaultTheme} from './theme.js';\r\n\r\n//global list of elements to, hopefully, prevent minification tree shaking\r\n//of live elements\r\nexport let ElementClasses = [];\r\n\r\nexport {theme} from \"./ui_theme.js\";\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nwindow.__cconst = cconst;\r\n\r\nlet Vector4 = vectormath.Vector4;\r\n\r\nexport {Icons} from '../icon_enum.js';\r\nimport {Icons} from '../icon_enum.js';\r\n\r\nexport {setIconMap} from '../icon_enum.js';\r\nimport {setIconMap} from '../icon_enum.js';\r\n\r\nimport {AfterAspect, initAspectClass} from \"./aspect.js\";\r\nimport * as aspect from './aspect.js';\r\n\r\nconst EnumProperty = toolprop.EnumProperty;\r\n\r\nlet Area;\r\nexport let _setAreaClass = (cls) => {\r\n  Area = cls;\r\n}\r\n\r\nexport const ErrorColors = {\r\n  WARNING: \"yellow\",\r\n  ERROR  : \"red\",\r\n  OK     : \"green\"\r\n};\r\n\r\nwindow.__theme = theme;\r\n\r\nlet registered_has_happened = false;\r\nlet tagPrefix = \"\";\r\nconst EventCBSymbol = Symbol(\"wrapped event callback\");\r\n\r\nfunction calcElemCBKey(elem, type, options) {\r\n  return elem._id + \":\" + type + \":\" + JSON.stringify(options || {});\r\n}\r\n\r\n/**\r\n * Sets tag prefix for pathux html elements.\r\n * Must be called prior to loading other modules.\r\n * Since this is tricky, you can alternatively\r\n * add a script tag with the prefix with the id \"pathux-tag-prefix\",\r\n * e.g.<pre> <script type=\"text/plain\" id=\"pathux-tag-prefix\">prefix</script> </pre>\r\n * */\r\nexport function setTagPrefix(prefix) {\r\n  if (registered_has_happened) {\r\n    throw new Error(\"have to call ui_base.setTagPrefix before loading any other path.ux modules\");\r\n  }\r\n\r\n  tagPrefix = \"\" + prefix;\r\n}\r\n\r\nexport function getTagPrefix(prefix) {\r\n  return tagPrefix;\r\n}\r\n\r\nlet prefix = document.getElementById(\"pathux-tag-prefix\");\r\nif (prefix) {\r\n  console.log(\"Found pathux-tag-prefix element\");\r\n  prefix = prefix.innerText.trim();\r\n  setTagPrefix(prefix);\r\n}\r\n\r\nimport {ClassIdSymbol} from './ui_consts.js';\r\n\r\nexport {ClassIdSymbol};\r\n\r\nlet class_idgen = 1;\r\n\r\nexport function setTheme(theme2) {\r\n  //merge theme\r\n  for (let k in theme2) {\r\n    let v = theme2[k];\r\n\r\n    if (typeof v !== \"object\") {\r\n      theme[k] = v;\r\n      continue;\r\n    }\r\n\r\n    let v0 = theme[k];\r\n\r\n    if (!(k in theme)) {\r\n      theme[k] = {};\r\n    }\r\n\r\n    for (let k2 in v) {\r\n      //if (v0 && !(k2 in v0)) {\r\n      //  continue;\r\n      //}\r\n\r\n      if (k2 in compatMap) {\r\n        let k3 = compatMap[k2];\r\n\r\n        if (v[k3] === undefined) {\r\n          v[k3] = v[k2];\r\n        }\r\n\r\n        delete v[k2];\r\n        k2 = k3;\r\n      }\r\n\r\n      theme[k][k2] = v[k2];\r\n    }\r\n  }\r\n}\r\n\r\nsetTheme(DefaultTheme);\r\n\r\nlet _last_report = util.time_ms();\r\n\r\nexport function report() {\r\n  if (util.time_ms() - _last_report > 350) {\r\n    console.warn(...arguments);\r\n    _last_report = util.time_ms();\r\n  }\r\n}\r\n\r\n//this function is deprecated\r\nexport function getDefault(key, elem) {\r\n  console.warn(\"Deprecated call to ui_base.js:getDefault\");\r\n\r\n  if (key in theme.base) {\r\n    return theme.base[key];\r\n  } else {\r\n    throw new Error(\"Unknown default \" + key);\r\n  }\r\n}\r\n\r\n//XXX implement me!\r\nexport function IsMobile() {\r\n  console.warn(\"ui_base.IsMobile is deprecated; use util.isMobile instead\")\r\n  return util.isMobile();\r\n};\r\n\r\nlet keys = [\"margin\", \"padding\", \"margin-block-start\", \"margin-block-end\"];\r\nkeys = keys.concat([\"padding-block-start\", \"padding-block-end\"]);\r\n\r\nkeys = keys.concat([\"margin-left\", \"margin-top\", \"margin-bottom\", \"margin-right\"]);\r\nkeys = keys.concat([\"padding-left\", \"padding-top\", \"padding-bottom\", \"padding-right\"]);\r\nexport const marginPaddingCSSKeys = keys;\r\n\r\n\r\nclass _IconManager {\r\n  constructor(image, tilesize, number_of_horizontal_tiles, drawsize) {\r\n    this.tilex = number_of_horizontal_tiles;\r\n    this.tilesize = tilesize;\r\n    this.drawsize = drawsize;\r\n\r\n    this.customIcons = new Map();\r\n\r\n    this.image = image;\r\n    this.promise = undefined;\r\n    this._accept = undefined;\r\n    this._reject = undefined;\r\n  }\r\n\r\n  get ready() {\r\n    return this.image && this.image.width;\r\n  }\r\n\r\n  onReady() {\r\n    if (this.ready) {\r\n      return new Promise((accept, reject) => {\r\n        accept(this);\r\n      });\r\n    }\r\n\r\n    if (this.promise) {\r\n      return this.promise;\r\n    }\r\n\r\n    let onload = this.image.onload;\r\n    this.image.onload = (e) => {\r\n      if (onload) {\r\n        onload.call(this.image, e);\r\n      }\r\n\r\n      if (!this._accept) {\r\n        return;\r\n      }\r\n\r\n      let accept = this._accept;\r\n      this._accept = this._reject = this.promise = undefined;\r\n\r\n      if (this.image.width) {\r\n        accept(this);\r\n      }\r\n    }\r\n\r\n    this.promise = new util.TimeoutPromise((accept, reject) => {\r\n      this._accept = accept;\r\n      this._reject = reject;\r\n    }, 15000, true); /* silently rejects on timeout */\r\n\r\n    this.promise.catch(error => {\r\n      util.print_stack(error);\r\n      this.promise = this._accept = this._reject = undefined;\r\n    });\r\n\r\n    return this.promise;\r\n  }\r\n\r\n  canvasDraw(elem, canvas, g, icon, x = 0, y = 0) {\r\n    let customIcon = this.customIcons.get(icon);\r\n\r\n    if (customIcon) {\r\n      g.drawImage(customIcon.canvas, x, y);\r\n      return;\r\n    }\r\n\r\n    let tx = icon%this.tilex;\r\n    let ty = ~~(icon/this.tilex);\r\n\r\n    let dpi = elem.getDPI();\r\n    let ts = this.tilesize;\r\n    let ds = this.drawsize;\r\n\r\n    if (!this.image) {\r\n      //console.warn(\"Failed to render an iconsheet\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      g.drawImage(this.image, tx*ts, ty*ts, ts, ts, x, y, ds*dpi, ds*dpi);\r\n    } catch (error) {\r\n      console.log(this.image);\r\n      console.error(error.stack);\r\n      console.error(error.message);\r\n      console.error(\"failed to draw an icon\");\r\n    }\r\n  }\r\n\r\n  setCSS(icon, dom, fitsize = undefined) {\r\n    if (!fitsize) {\r\n      fitsize = this.drawsize;\r\n    }\r\n\r\n    if (typeof fitsize === \"object\") {\r\n      fitsize = Math.max(fitsize[0], fitsize[1]);\r\n    }\r\n\r\n    dom.style[\"background\"] = this.getCSS(icon, fitsize);\r\n    if (this.customIcons.has(icon)) {\r\n      dom.style[\"background-size\"] = (fitsize) + \"px\";\r\n    } else {\r\n      dom.style[\"background-size\"] = (fitsize*this.tilex) + \"px\";\r\n    }\r\n\r\n    dom.style[\"background-clip\"] = \"content-box\";\r\n\r\n    if (!dom.style[\"width\"]) {\r\n      dom.style[\"width\"] = this.drawsize + \"px\";\r\n    }\r\n    if (!dom.style[\"height\"]) {\r\n      dom.style[\"height\"] = this.drawsize + \"px\";\r\n    }\r\n  }\r\n\r\n  //icon is an integer\r\n  getCSS(icon, fitsize = this.drawsize) {\r\n    if (icon === -1) { //-1 means no icon\r\n      return '';\r\n    }\r\n\r\n    if (typeof fitsize === \"object\") {\r\n      fitsize = Math.max(fitsize[0], fitsize[1]);\r\n    }\r\n\r\n    let ratio = fitsize/this.tilesize;\r\n\r\n    let customIcon = this.customIcons.get(icon);\r\n    if (customIcon !== undefined) {\r\n      //ratio = fitsize / this.drawsize;\r\n      //let d = this.drawsize*0.25;\r\n      let d = 0.0;\r\n\r\n      let css = `url(\"${customIcon.blobUrl}\")`;\r\n\r\n      return css;\r\n    }\r\n\r\n    let x = (-(icon%this.tilex)*this.tilesize)*ratio;\r\n    let y = (-(~~(icon/this.tilex))*this.tilesize)*ratio;\r\n\r\n    //x = ~~x;\r\n    //y = ~~y;\r\n\r\n    //console.log(this.tilesize, this.drawsize, x, y);\r\n    //let ts = this.tilesize;\r\n    //return `image('${this.image.src}#xywh=${x},${y},${ts},${ts}')`;\r\n    return `url(\"${this.image.src}\") ${x}px ${y}px`;\r\n  }\r\n}\r\n\r\nexport class CustomIcon {\r\n  constructor(manager, key, id, baseImage) {\r\n    this.key = key;\r\n    this.baseImage = baseImage;\r\n    this.images = []\r\n    this.id = id;\r\n    this.manager = manager;\r\n  }\r\n\r\n  regenIcons() {\r\n    let manager = this.manager;\r\n\r\n    let doSheet = (sheet) => {\r\n      let size = sheet.drawsize;\r\n      let canvas = document.createElement(\"canvas\");\r\n      let g = canvas.getContext(\"2d\");\r\n\r\n      canvas.width = canvas.height = size;\r\n      g.drawImage(this.baseImage, 0, 0, size, size);\r\n\r\n      canvas.toBlob((blob) => {\r\n        let blobUrl = URL.createObjectURL(blob);\r\n\r\n        sheet.customIcons.set(this.id, {\r\n          blobUrl,\r\n          canvas\r\n        });\r\n      })\r\n    }\r\n\r\n    for (let sheet of manager.iconsheets) {\r\n      doSheet(sheet);\r\n    }\r\n  }\r\n}\r\n\r\nexport class IconManager {\r\n  /**\r\n   images is a list of dom ids of img tags\r\n\r\n   sizes is a list of tile sizes, one per image.\r\n   you can control the final *draw* size by passing an array\r\n   of [tilesize, drawsize] instead of just a number.\r\n   */\r\n  constructor(images, sizes, horizontal_tile_count) {\r\n    this.iconsheets = [];\r\n    this.tilex = horizontal_tile_count;\r\n\r\n    this.customIcons = new Map();\r\n    this.customIconIDMap = new Map();\r\n\r\n    for (let i = 0; i < images.length; i++) {\r\n      let size, drawsize;\r\n\r\n      if (typeof sizes[i] == \"object\") {\r\n        size = sizes[i][0], drawsize = sizes[i][1];\r\n      } else {\r\n        size = drawsize = sizes[i];\r\n      }\r\n\r\n      if (util.isMobile()) {\r\n        drawsize = ~~(drawsize*theme.base.mobileSizeMultiplier);\r\n      }\r\n\r\n      this.iconsheets.push(new _IconManager(images[i], size, horizontal_tile_count, drawsize));\r\n    }\r\n  }\r\n\r\n  isReady(sheet = 0) {\r\n    return this.iconsheets[sheet].ready;\r\n  }\r\n\r\n  addCustomIcon(key, image) {\r\n    let icon = this.customIcons.get(key);\r\n\r\n    if (!icon) {\r\n      let maxid = 0;\r\n\r\n      for (let k in Icons) {\r\n        maxid = Math.max(maxid, Icons[k] + 1);\r\n      }\r\n      for (let icon of this.customIcons.values()) {\r\n        maxid = Math.max(maxid, icon.id + 1);\r\n      }\r\n\r\n      maxid = Math.max(maxid, 1000); //just to be on the safe side\r\n\r\n      let id = maxid;\r\n      icon = new CustomIcon(this, key, id, image);\r\n\r\n      this.customIcons.set(key, icon);\r\n      this.customIconIDMap.set(id, icon);\r\n    }\r\n\r\n    icon.baseImage = image;\r\n    icon.regenIcons();\r\n\r\n    return icon.id;\r\n  }\r\n\r\n  load(manager2) {\r\n    this.iconsheets = manager2.iconsheets;\r\n    this.tilex = manager2.tilex;\r\n\r\n    return this;\r\n  }\r\n\r\n  reset(horizontal_tile_count) {\r\n    this.iconsheets.length = 0;\r\n    this.tilex = horizontal_tile_count;\r\n  }\r\n\r\n  add(image, size, drawsize = size) {\r\n    this.iconsheets.push(new _IconManager(image, size, this.tilex, drawsize));\r\n    return this;\r\n  }\r\n\r\n  canvasDraw(elem, canvas, g, icon, x = 0, y = 0, sheet = 0) {\r\n    let base = this.iconsheets[sheet];\r\n\r\n    sheet = this.findSheet(sheet);\r\n    let ds = sheet.drawsize;\r\n\r\n    sheet.drawsize = base.drawsize;\r\n    sheet.canvasDraw(elem, canvas, g, icon, x, y);\r\n    sheet.drawsize = ds;\r\n  }\r\n\r\n  findClosestSheet(size) {\r\n    let sheets = this.iconsheets.concat([]);\r\n\r\n    sheets.sort((a, b) => a.drawsize - b.drawsize);\r\n    let sheet;\r\n\r\n    for (let i = 0; i < sheets.length; i++) {\r\n      if (sheets[i].drawsize <= size) {\r\n        sheet = sheets[i];\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (!sheet)\r\n      sheet = sheets[sheets.length - 1];\r\n\r\n    return this.iconsheets.indexOf(sheet);\r\n  }\r\n\r\n  findSheet(sheet) {\r\n    if (sheet === undefined) {\r\n      console.warn(\"sheet was undefined\");\r\n      sheet = 0;\r\n    }\r\n\r\n    let base = this.iconsheets[sheet];\r\n\r\n    /**sigh**/\r\n    let dpi = UIBase.getDPI();\r\n    let minsheet = undefined;\r\n    let goal = dpi*base.drawsize;\r\n\r\n    for (let sheet of this.iconsheets) {\r\n      minsheet = sheet;\r\n\r\n      if (sheet.drawsize >= goal) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return minsheet === undefined ? base : minsheet;\r\n  }\r\n\r\n  getTileSize(sheet = 0) {\r\n    return this.iconsheets[sheet].drawsize;\r\n    return this.findSheet(sheet).drawsize;\r\n  }\r\n\r\n  getRealSize(sheet = 0) {\r\n    return this.iconsheets[sheet].tilesize;\r\n    return this.findSheet(sheet).tilesize;\r\n    //return this.iconsheets[sheet].tilesize;\r\n  }\r\n\r\n  //icon is an integer\r\n  getCSS(icon, sheet = 0) {\r\n    //return this.iconsheets[sheet].getCSS(icon);\r\n    //return this.findSheet(sheet).getCSS(icon);\r\n\r\n    let base = this.iconsheets[sheet];\r\n    sheet = this.findSheet(sheet);\r\n    let ds = sheet.drawsize;\r\n\r\n    sheet.drawsize = base.drawsize;\r\n    let ret = sheet.getCSS(icon);\r\n    sheet.drawsize = ds;\r\n\r\n    return ret;\r\n  }\r\n\r\n  setCSS(icon, dom, sheet = 0, fitsize = undefined) {\r\n    //return this.iconsheets[sheet].setCSS(icon, dom);\r\n\r\n    let base = this.iconsheets[sheet];\r\n    sheet = this.findSheet(sheet);\r\n    let ds = sheet.drawsize;\r\n\r\n    sheet.drawsize = base.drawsize;\r\n    let ret = sheet.setCSS(icon, dom, fitsize);\r\n    sheet.drawsize = ds;\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nexport let iconmanager = new IconManager([\r\n  document.getElementById(\"iconsheet16\"),\r\n  document.getElementById(\"iconsheet32\"),\r\n  document.getElementById(\"iconsheet48\")\r\n], [16, 32, 64], 16);\r\n\r\nwindow._iconmanager = iconmanager; //debug global\r\n\r\n//if client code overrides iconsheets, they must follow logical convention\r\n//that the first one is \"small\" and the second is \"large\"\r\nexport let IconSheets = {\r\n  SMALL : 0,\r\n  LARGE : 1,\r\n  XLARGE: 2\r\n};\r\n\r\nexport function iconSheetFromPackFlag(flag) {\r\n  if (flag & PackFlags.CUSTOM_ICON_SHEET) {\r\n    //console.log(\"Custom Icon Sheet:\", flag>>PackFlags.CUSTOM_ICON_SHEET_START);\r\n    return flag>>PackFlags.CUSTOM_ICON_SHEET_START;\r\n  }\r\n\r\n  if ((flag & PackFlags.SMALL_ICON) && !(PackFlags.LARGE_ICON)) {\r\n    return 0//IconSheets.SMALL; //0\r\n  } else {\r\n    return 1//IconSheets.LARGE; //1\r\n  }\r\n}\r\n\r\nexport function getIconManager() {\r\n  return iconmanager;\r\n}\r\n\r\nexport function setIconManager(manager, IconSheetsOverride) {\r\n  iconmanager.load(manager);\r\n\r\n  if (IconSheetsOverride !== undefined) {\r\n    for (let k in IconSheetsOverride) {\r\n      IconSheets[k] = IconSheetsOverride[k];\r\n    }\r\n  }\r\n}\r\n\r\nexport function makeIconDiv(icon, sheet = 0) {\r\n  let size = iconmanager.getRealSize(sheet);\r\n\r\n  let drawsize = iconmanager.getTileSize(sheet);\r\n\r\n  let icontest = document.createElement(\"div\");\r\n\r\n  icontest.style[\"width\"] = icontest.style[\"min-width\"] = drawsize + \"px\";\r\n  icontest.style[\"height\"] = icontest.style[\"min-height\"] = drawsize + \"px\";\r\n\r\n  //icontest.style[\"background-color\"] = \"orange\";\r\n\r\n  icontest.style[\"margin\"] = \"0px\";\r\n  icontest.style[\"padding\"] = \"0px\";\r\n\r\n  iconmanager.setCSS(icon, icontest, sheet);\r\n\r\n  return icontest;\r\n}\r\n\r\nlet Vector2 = vectormath.Vector2;\r\nlet Matrix4 = vectormath.Matrix4;\r\n\r\nexport let dpistack = [];\r\n\r\nexport const UIFlags = {};\r\n\r\nconst internalElementNames = {};\r\nconst externalElementNames = {};\r\n\r\nexport const PackFlags = {\r\n  INHERIT_WIDTH : 1,\r\n  INHERIT_HEIGHT: 2,\r\n  VERTICAL      : 4,\r\n  USE_ICONS     : 8,\r\n  SMALL_ICON    : 16,\r\n  LARGE_ICON    : 32,\r\n\r\n  FORCE_PROP_LABELS         : 64, //force propeties (Container.prototype.prop()) to always have labels\r\n  PUT_FLAG_CHECKS_IN_COLUMNS: 128, //group flag property checkmarks in columns (doesn't apply to icons)\r\n\r\n  WRAP_CHECKBOXES: 256,\r\n\r\n  //internal flags\r\n  STRIP_HORIZ            : 512,\r\n  STRIP_VERT             : 1024,\r\n  STRIP                  : 512 | 1024,\r\n  SIMPLE_NUMSLIDERS      : 2048,\r\n  FORCE_ROLLER_SLIDER    : 4096,\r\n  HIDE_CHECK_MARKS       : (1<<13),\r\n  NO_NUMSLIDER_TEXTBOX   : (1<<14),\r\n  CUSTOM_ICON_SHEET      : 1<<15,\r\n  CUSTOM_ICON_SHEET_START: 20, //custom icon sheet bits are shifted to here\r\n  NO_UPDATE              : 1<<16\r\n};\r\n\r\nlet first = (iter) => {\r\n  if (iter === undefined) {\r\n    return undefined;\r\n  }\r\n\r\n  if (!(Symbol.iterator in iter)) {\r\n    for (let item in iter) {\r\n      return item;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  for (let item of iter) {\r\n    return item;\r\n  }\r\n}\r\n\r\nimport {DataPathError} from '../path-controller/controller/controller.js';\r\nimport {TimeoutPromise} from '../path-controller/util/util.js';\r\nimport {IntProperty, NumberConstraints, PropFlags} from '../path-controller/toolsys/toolprop.js';\r\n\r\nlet _mobile_theme_patterns = [\r\n  /.*width.*/,\r\n  /.*height.*/,\r\n  /.*size.*/,\r\n  /.*margin.*/,\r\n  /.*pad/,\r\n  /.*radius.*/\r\n];\r\n\r\n\r\nlet _idgen = 0;\r\n\r\nwindow._testSetScrollbars = function (color = \"grey\", contrast = 0.5, width = 15, border = \"solid\") {\r\n  let buf = styleScrollBars(color, undefined, contrast, width, border, \"*\");\r\n  CTX.screen.mergeGlobalCSS(buf);\r\n\r\n  //document.body.style[\"overflow\"] = \"scroll\";\r\n\r\n  /*\r\n  if (!window._tsttag) {\r\n    window._tsttag = document.createElement(\"style\");\r\n    document.body.prepend(_tsttag);\r\n  }\r\n\r\n  _tsttag.textContent = buf;\r\n  //*/\r\n\r\n  return buf;\r\n};\r\n\r\nexport function styleScrollBars(color = \"grey\", color2 = undefined, contrast = 0.5, width = 15,\r\n                                border                                                    = \"1px groove black\", selector                     = \"*\") {\r\n\r\n  if (!color2) {\r\n    let c = css2color(color);\r\n    let a = c.length > 3 ? c[3] : 1.0;\r\n\r\n    c = rgb_to_hsv(c[0], c[1], c[2]);\r\n    let inv = c.slice(0, c.length);\r\n\r\n    inv[2] = 1.0 - inv[2];\r\n    inv[2] += (c[2] - inv[2])*(1.0 - contrast);\r\n\r\n    inv = hsv_to_rgb(inv[0], inv[1], inv[2]);\r\n\r\n    inv.length = 4;\r\n    inv[3] = a;\r\n\r\n    inv = color2css(inv);\r\n    color2 = inv;\r\n  }\r\n\r\n  let buf = `\r\n\r\n${selector} {\r\n  scrollbar-width : ${width <= 16 ? 'thin' : 'auto'};\r\n  scrollbar-color : ${color2} ${color};\r\n}\r\n\r\n${selector}::-webkit-scrollbar {\r\n  width : ${width}px;\r\n  background-color : ${color};\r\n}\r\n\r\n${selector}::-webkit-scrollbar-track {\r\n  background-color : ${color};\r\n  border : ${border};\r\n}\r\n\r\n${selector}::-webkit-scrollbar-thumb {\r\n  background-color : ${color2};\r\n  border : ${border};\r\n}\r\n    `;\r\n\r\n  //console.log(buf);\r\n  return buf;\r\n}\r\n\r\nwindow.styleScrollBars = styleScrollBars;\r\n\r\nlet _digest = new util.HashDigest();\r\n\r\nexport function calcThemeKey(digest = _digest.reset()) {\r\n  for (let k in theme) {\r\n    let obj = theme[k];\r\n\r\n    if (typeof obj !== \"object\") {\r\n      continue;\r\n    }\r\n\r\n    for (let k2 in obj) {\r\n      let v2 = obj[k2];\r\n\r\n      if (typeof v2 === \"number\" || typeof v2 === \"boolean\" || typeof v2 === \"string\") {\r\n        digest.add(v2);\r\n      } else if (typeof v2 === \"object\" && v2 instanceof CSSFont) {\r\n        v2.calcHashUpdate(digest);\r\n      }\r\n    }\r\n  }\r\n\r\n  return digest.get();\r\n}\r\n\r\nexport var _themeUpdateKey = calcThemeKey();\r\n\r\nexport function flagThemeUpdate() {\r\n  _themeUpdateKey = calcThemeKey();\r\n}\r\n\r\nwindow._flagThemeUpdate = flagThemeUpdate;\r\n\r\nlet setTimeoutQueue = new Set();\r\nlet haveTimeout = false;\r\n\r\nfunction timeout_cb() {\r\n  if (setTimeoutQueue.size === 0) {\r\n    haveTimeout = false;\r\n    return;\r\n  }\r\n\r\n  for (let item of new Set(setTimeoutQueue)) {\r\n    let {cb, timeout, time} = item;\r\n    if (util.time_ms() - time < timeout) {\r\n      continue;\r\n    }\r\n\r\n    setTimeoutQueue.delete(item);\r\n\r\n    try {\r\n      cb();\r\n    } catch (error) {\r\n      console.error(error.stack);\r\n    }\r\n  }\r\n\r\n  window.setTimeout(timeout_cb, 0);\r\n}\r\n\r\nexport function internalSetTimeout(cb, timeout) {\r\n  if (timeout > 100) { //call directly\r\n    window.setTimeout(cb, timeout);\r\n    return;\r\n  }\r\n\r\n  setTimeoutQueue.add({\r\n    cb, timeout, time: util.time_ms()\r\n  });\r\n\r\n  if (!haveTimeout) {\r\n    haveTimeout = true;\r\n    window.setTimeout(timeout_cb, 0);\r\n  }\r\n}\r\n\r\nwindow.setTimeoutQueue = setTimeoutQueue;\r\n\r\nexport class UIBase extends HTMLElement {\r\n  constructor() {\r\n    super();\r\n\r\n    this._modalstack = [];\r\n\r\n    this._tool_tip_abort_delay = undefined;\r\n    this._tooltip_ref = undefined;\r\n\r\n    this._textBoxEvents = false;\r\n\r\n    this._themeOverride = undefined;\r\n\r\n    this._checkTheme = true;\r\n    this._last_theme_update_key = _themeUpdateKey;\r\n\r\n    this._client_disabled_set = undefined;\r\n    //this._parent_disabled_set = 0;\r\n\r\n    this._useNativeToolTips = cconst.useNativeToolTips;\r\n    this._useNativeToolTips_set = false;\r\n    this._has_own_tooltips = undefined;\r\n    this._tooltip_timer = util.time_ms();\r\n\r\n    this.pathUndoGen = 0;\r\n    this._lastPathUndoGen = 0;\r\n    this._useDataPathUndo = undefined;\r\n\r\n    this._active_animations = [];\r\n\r\n    //ref to Link element referencing Screen style node\r\n    //Screen.update_intern sets the contents of this\r\n    this._screenStyleTag = document.createElement(\"style\");\r\n    this._screenStyleUpdateHash = 0;\r\n\r\n    initAspectClass(this, new Set([\"appendChild\", \"animate\", \"shadow\", \"removeNode\", \"prepend\", \"add\", \"init\"]));\r\n\r\n    this.shadow = this.attachShadow({mode: 'open'});\r\n\r\n    if (cconst.DEBUG.paranoidEvents) {\r\n      this.__cbs = [];\r\n    }\r\n\r\n    this.shadow.appendChild(this._screenStyleTag);\r\n    this.shadow._appendChild = this.shadow.appendChild;\r\n\r\n    ///*\r\n    let appendChild = this.shadow.appendChild;\r\n    this.shadow.appendChild = (child) => {\r\n      if (child && typeof child === \"object\" && child instanceof UIBase) {\r\n        child.parentWidget = this;\r\n      }\r\n\r\n      return this.shadow._appendChild(child, ...arguments);\r\n    };\r\n    //*/\r\n\r\n    this._wasAddedToNodeAtSomeTime = false;\r\n\r\n    this.visibleToPick = true;\r\n\r\n    this._override_class = undefined;\r\n    this.parentWidget = undefined;\r\n\r\n    /*\r\n    this.shadow._appendChild = this.shadow.appendChild;\r\n    this.shadow.appendChild = (child) => {\r\n      if (child instanceof UIBase) {\r\n        child.ctx = this.ctx;\r\n        child.parentWidget = this;\r\n\r\n        if (child._useDataPathUndo === undefined) {\r\n          child.useDataPathUndo = this.useDataPathUndo;\r\n        }\r\n      }\r\n\r\n      return this.shadow._appendChild(child);\r\n    };\r\n    //*/\r\n\r\n    let tagname = this.constructor.define().tagname;\r\n    this._id = tagname.replace(/\\-/g, \"_\") + (_idgen++);\r\n\r\n    this.default_overrides = {}; //inherited by child widgets\r\n    this.my_default_overrides = {}; //not inherited to child widgets\r\n    this.class_default_overrides = {};\r\n\r\n    this._last_description = undefined;\r\n    this._description_final = undefined;\r\n\r\n    //getting css to flow down properly can be a pain, so\r\n    //some packing settings are set as bitflags here,\r\n    //see PackFlags\r\n\r\n    /*\r\n    setInterval(() => {\r\n      this.update();\r\n    }, 200);\r\n    //*/\r\n\r\n    this._modaldata = undefined;\r\n    this.packflag = this.getDefault(\"BasePackFlag\");\r\n    this._internalDisabled = false;\r\n    this.__disabledState = false;\r\n    this._disdata = undefined;\r\n    this._ctx = undefined;\r\n\r\n    this._description = undefined;\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n    .DefaultText {\r\n      font: ` + _getFont(this) + `;\r\n    }\r\n    `;\r\n    this.shadow.appendChild(style);\r\n    this._init_done = false;\r\n\r\n    /* Deprecated touch -> mouse event conversion,\r\n       use pointer events instead. */\r\n    let do_touch = (e, type, button) => {\r\n      if (haveModal()) {\r\n        return;\r\n      }\r\n\r\n      button = button === undefined ? 0 : button;\r\n      let e2 = copyEvent(e);\r\n\r\n      if (e.touches.length === 0) {\r\n        //hrm, what to do, what to do. . .\r\n      } else {\r\n        let t = e.touches[0];\r\n\r\n        e2.pageX = t.pageX;\r\n        e2.pageY = t.pageY;\r\n        e2.screenX = t.screenX;\r\n        e2.screenY = t.screenY;\r\n        e2.clientX = t.clientX;\r\n        e2.clientY = t.clientY;\r\n        e2.x = t.x;\r\n        e2.y = t.y;\r\n      }\r\n\r\n      e2.button = button;\r\n\r\n      e2 = new MouseEvent(type, e2);\r\n\r\n      e2.was_touch = true;\r\n      e2.stopPropagation = e.stopPropagation.bind(e);\r\n      e2.preventDefault = e.preventDefault.bind(e);\r\n      e2.touches = e.touches;\r\n\r\n      this.dispatchEvent(e2);\r\n    };\r\n\r\n    this.addEventListener(\"touchstart\", (e) => {\r\n      do_touch(e, \"mousedown\", 0);\r\n    }, {passive: false});\r\n    this.addEventListener(\"touchmove\", (e) => {\r\n      do_touch(e, \"mousemove\");\r\n    }, {passive: false});\r\n    this.addEventListener(\"touchcancel\", (e) => {\r\n      do_touch(e, \"mouseup\", 2);\r\n    }, {passive: false});\r\n    this.addEventListener(\"touchend\", (e) => {\r\n      do_touch(e, \"mouseup\", 0);\r\n    }, {passive: false});\r\n\r\n    if (this.constructor.define().havePickClipboard) {\r\n      this._clipboardHotkeyInit();\r\n    }\r\n  }\r\n\r\n  /*\r\n  set default_overrides(v) {\r\n    console.error(\"default_overrides was set\", v);\r\n    this._default_overrides = v;\r\n  }\r\n\r\n  get default_overrides() {\r\n    return this._default_overrides;\r\n  }//*/\r\n\r\n  get useNativeToolTips() {\r\n    return this._useNativeToolTips;\r\n  }\r\n\r\n  set useNativeToolTips(val) {\r\n    this._useNativeToolTips = val;\r\n    this._useNativeToolTips_set = true;\r\n  }\r\n\r\n  get parentWidget() {\r\n    return this._parentWidget;\r\n  }\r\n\r\n  set parentWidget(val) {\r\n    if (val) {\r\n      this._wasAddedToNodeAtSomeTime = true;\r\n    }\r\n\r\n    this._parentWidget = val;\r\n  }\r\n\r\n  get useDataPathUndo() {\r\n    let p = this;\r\n\r\n    while (p) {\r\n      if (p._useDataPathUndo !== undefined) {\r\n        return p._useDataPathUndo;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   causes calls to setPathValue to go through\r\n   toolpath app.datapath_set(path=\"\" newValueJSON=\"\")\r\n\r\n   every child will inherit\r\n   */\r\n  set useDataPathUndo(val) {\r\n    this._useDataPathUndo = val;\r\n  }\r\n\r\n  get description() {\r\n\r\n    return this._description;\r\n  }\r\n\r\n  set description(val) {\r\n    if (val === null) {\r\n      this._description = undefined;\r\n      return;\r\n    }\r\n\r\n    this._description = val;\r\n\r\n    if (val === undefined || val === null) {\r\n      return;\r\n    }\r\n\r\n    if (cconst.showPathsInToolTips && this.hasAttribute(\"datapath\")) {\r\n      let s = \"\" + this._description;\r\n\r\n      let path = this.getAttribute(\"datapath\");\r\n      s += \"\\n    path: \" + path;\r\n\r\n      if (this.hasAttribute(\"mass_set_path\")) {\r\n        let m = this.getAttribute(\"mass_set_path\");\r\n        s += \"\\n    massSetPath: \" + m;\r\n      }\r\n\r\n      this._description_final = s;\r\n    } else {\r\n      this._description_final = this._description;\r\n    }\r\n\r\n    if (cconst.useNativeToolTips) {\r\n      this.title = \"\" + this._description_final;\r\n    }\r\n  }\r\n\r\n  get background() {\r\n    return this.__background;\r\n  }\r\n\r\n  set background(bg) {\r\n    this.__background = bg;\r\n\r\n    this.overrideDefault(\"background-color\", bg, true);\r\n    this.style[\"background-color\"] = bg;\r\n  }\r\n\r\n  get disabled() {\r\n    //hrm, I could just propegate checks upward. . .\r\n\r\n    if (this.parentWidget && this.parentWidget.disabled) {\r\n      return true;\r\n    }\r\n\r\n    return !!this._client_disabled_set || !!this._internalDisabled;// || !!this._parent_disabled_set;\r\n  }\r\n\r\n  set disabled(v) {\r\n    this._client_disabled_set = v;\r\n    this.__updateDisable(this.disabled);\r\n  }\r\n\r\n  get internalDisabled() {\r\n    return this._internalDisabled;\r\n  }\r\n\r\n  set internalDisabled(val) {\r\n    this._internalDisabled = !!val;\r\n\r\n    this.__updateDisable(this.disabled);\r\n  }\r\n\r\n  get ctx() {\r\n    return this._ctx;\r\n  }\r\n\r\n  set ctx(c) {\r\n    this._ctx = c;\r\n\r\n    this._forEachChildWidget((n) => {\r\n      n.ctx = c;\r\n    });\r\n  }\r\n\r\n  get _reportCtxName() {\r\n    return \"\" + this._id;\r\n  }\r\n\r\n  get modalRunning() {\r\n    return this._modaldata !== undefined;\r\n  }\r\n\r\n  static getIconEnum() {\r\n    return Icons;\r\n  }\r\n\r\n  static setDefault(element) {\r\n    return element;\r\n  }\r\n\r\n  /**DEPRECATED\r\n\r\n   scaling ratio (e.g. for high-resolution displays)\r\n   */\r\n  static getDPI() {\r\n    //if (dpistack.length > 0) {\r\n    //  return dpistack[this.dpistack.length-1];\r\n    //} else {\r\n    //if (util.isMobile()) {\r\n    return window.devicePixelRatio; // * visualViewport.scale;\r\n    //}\r\n\r\n    return window.devicePixelRatio;\r\n    //}\r\n  }\r\n\r\n  static prefix(name) {\r\n    return tagPrefix + name;\r\n  }\r\n\r\n  static internalRegister(cls) {\r\n    cls[ClassIdSymbol] = class_idgen++;\r\n\r\n    registered_has_happened = true;\r\n\r\n    internalElementNames[cls.define().tagname] = this.prefix(cls.define().tagname);\r\n    customElements.define(this.prefix(cls.define().tagname), cls);\r\n  }\r\n\r\n  static getInternalName(name) {\r\n    return internalElementNames[name];\r\n  }\r\n\r\n  static createElement(name, internal = false) {\r\n    if (!internal && name in externalElementNames) {\r\n      return document.createElement(name);\r\n    } else if (name in internalElementNames) {\r\n      return document.createElement(internalElementNames[name]);\r\n    } else {\r\n      return document.createElement(name)\r\n    }\r\n  }\r\n\r\n  static register(cls) {\r\n    registered_has_happened = true;\r\n\r\n    cls[ClassIdSymbol] = class_idgen++;\r\n\r\n    ElementClasses.push(cls);\r\n\r\n    externalElementNames[cls.define().tagname] = cls.define().tagname;\r\n    customElements.define(cls.define().tagname, cls);\r\n  }\r\n\r\n  /**\r\n   * Defines core attributes of the class\r\n   *\r\n   * @example\r\n   *\r\n   * static define() {return {\r\n   *   tagname             : \"custom-element-x\",\r\n   *   style               : \"[style class in theme]\"\r\n   *   subclassChecksTheme : boolean //set to true to disable base class invokation of checkTheme()\r\n   *   havePickClipboard   : boolean //whether element supports mouse hover copy/paste\r\n   *   pasteForAllChildren : boolean //mouse hover paste happens even over child widgets\r\n   *   copyForAllChildren  : boolean //mouse hover copy happens even over child widgets\r\n   * }}\r\n   */\r\n  static define() {\r\n    throw new Error(\"Missing define() for ux element\");\r\n  }\r\n\r\n  setUndo(val) {\r\n    this.useDataPathUndo = val;\r\n    return this;\r\n  }\r\n\r\n  hide(sethide = true) {\r\n    this.hidden = sethide;\r\n\r\n    for (let n of this.shadow.childNodes) {\r\n      n.hidden = sethide;\r\n    }\r\n\r\n    this._forEachChildWidget((n) => {\r\n      n.hide(sethide);\r\n    })\r\n  }\r\n\r\n  getElementById(id) {\r\n    let ret;\r\n\r\n    let rec = (n) => {\r\n      if (ret) {\r\n        return;\r\n      }\r\n\r\n      if (n.getAttribute(\"id\") === id || n.id === id) {\r\n        ret = n;\r\n      }\r\n\r\n      if (n instanceof UIBase && n.constructor.define().tagname === \"panelframe-x\") {\r\n        rec(n.contents);\r\n      } else if (n instanceof UIBase && n.constructor.define().tagname === \"tabcontainer-x\") {\r\n        for (let k in n.tabs) {\r\n          let tab = n.tabs[k];\r\n\r\n          if (tab) {\r\n            rec(tab);\r\n          }\r\n        }\r\n      }\r\n\r\n      for (let n2 of n.childNodes) {\r\n        if (n2 instanceof HTMLElement) {\r\n          rec(n2);\r\n\r\n          if (ret) {\r\n            break;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (n.shadow) {\r\n        for (let n2 of n.shadow.childNodes) {\r\n          if (n2 instanceof HTMLElement) {\r\n            rec(n2);\r\n\r\n            if (ret) {\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    rec(this);\r\n\r\n    return ret;\r\n  }\r\n\r\n  unhide() {\r\n    this.hide(false);\r\n  }\r\n\r\n  findArea() {\r\n    let p = this;\r\n\r\n    while (p) {\r\n      if (p instanceof Area) {\r\n        return p;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    return p;\r\n  }\r\n\r\n  addEventListener(type, cb, options) {\r\n    if (cconst.DEBUG.domEventAddRemove) {\r\n      console.log(\"addEventListener\", type, this._id, options);\r\n    }\r\n\r\n    let cb2 = (e) => {\r\n      if (cconst.DEBUG.paranoidEvents) {\r\n        if (this.isDead()) {\r\n          this.removeEventListener(type, cb, options);\r\n          return;\r\n        }\r\n      }\r\n\r\n      if (cconst.DEBUG.domEvents) {\r\n        pathDebugEvent(e);\r\n      }\r\n\r\n      let area = this.findArea();\r\n\r\n      if (area) {\r\n        area.push_ctx_active();\r\n        try {\r\n          let ret = cb(e);\r\n          area.pop_ctx_active();\r\n          return ret;\r\n        } catch (error) {\r\n          area.pop_ctx_active();\r\n          throw error;\r\n        }\r\n      } else {\r\n        if (cconst.DEBUG.areaContextPushes) {\r\n          console.warn(\"Element is not part of an area?\", element);\r\n        }\r\n\r\n        return cb(e);\r\n      }\r\n    };\r\n\r\n    if (!cb[EventCBSymbol]) {\r\n      cb[EventCBSymbol] = new Map();\r\n    }\r\n\r\n    let key = calcElemCBKey(this, type, options);\r\n    cb[EventCBSymbol].set(key, cb2);\r\n\r\n    if (cconst.DEBUG.paranoidEvents) {\r\n      this.__cbs.push([type, cb2, options]);\r\n    }\r\n\r\n    return super.addEventListener(type, cb2, options);\r\n  }\r\n\r\n  removeEventListener(type, cb, options) {\r\n    if (cconst.DEBUG.paranoidEvents) {\r\n      for (let item of this.__cbs) {\r\n        if (item[0] == type && item[1] === cb._cb2 && (\"\" + item[2]) === (\"\" + options)) {\r\n          this.__cbs.remove(item);\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (cconst.DEBUG.domEventAddRemove) {\r\n      console.log(\"removeEventListener\", type, this._id, options);\r\n    }\r\n\r\n    let key = calcElemCBKey(this, type, options);\r\n\r\n    if (!cb[EventCBSymbol] || !cb[EventCBSymbol].has(key)) {\r\n      return super.removeEventListener(type, cb, options);\r\n    } else {\r\n      let cb2 = cb[EventCBSymbol].get(key);\r\n\r\n      let ret = super.removeEventListener(type, cb2, options);\r\n\r\n      cb[EventCBSymbol].delete(key);\r\n      return ret;\r\n    }\r\n  }\r\n\r\n  connectedCallback() {\r\n\r\n  }\r\n\r\n  noMarginsOrPadding() {\r\n    return;\r\n    let keys = [\"margin\", \"padding\", \"margin-block-start\", \"margin-block-end\"];\r\n    keys = keys.concat([\"padding-block-start\", \"padding-block-end\"]);\r\n\r\n    keys = keys.concat([\"margin-left\", \"margin-top\", \"margin-bottom\", \"margin-right\"]);\r\n    keys = keys.concat([\"padding-left\", \"padding-top\", \"padding-bottom\", \"padding-right\"]);\r\n\r\n    for (let k of keys) {\r\n      this.style[k] = \"0px\";\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * find owning screen and tell it to update\r\n   * the global tab order\r\n   * */\r\n  regenTabOrder() {\r\n    let screen = this.getScreen();\r\n    if (screen !== undefined) {\r\n      screen.needsTabRecalc = true;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  noMargins() {\r\n    this.style[\"margin\"] = this.style[\"margin-left\"] = this.style[\"margin-right\"] = \"0px\";\r\n    this.style[\"margin-top\"] = this.style[\"margin-bottom\"] = \"0px\";\r\n    return this;\r\n  }\r\n\r\n  noPadding() {\r\n    this.style[\"padding\"] = this.style[\"padding-left\"] = this.style[\"padding-right\"] = \"0px\";\r\n    this.style[\"padding-top\"] = this.style[\"padding-bottom\"] = \"0px\";\r\n    return this;\r\n  }\r\n\r\n  getTotalRect() {\r\n    let found = false;\r\n\r\n    let min = new Vector2([1e17, 1e17]);\r\n    let max = new Vector2([-1e17, -1e17]);\r\n\r\n    let doaabb = (n) => {\r\n      let rs = n.getClientRects();\r\n\r\n      for (let r of rs) {\r\n        min[0] = Math.min(min[0], r.x);\r\n        min[1] = Math.min(min[1], r.y);\r\n        max[0] = Math.max(max[0], r.x + r.width);\r\n        max[1] = Math.max(max[1], r.y + r.height);\r\n\r\n        found = true;\r\n      }\r\n    };\r\n\r\n    doaabb(this);\r\n\r\n    this._forEachChildWidget((n) => {\r\n      doaabb(n);\r\n    });\r\n\r\n    if (found) {\r\n      return {\r\n        width : max[0] - min[0],\r\n        height: max[1] - min[1],\r\n        x     : min[0],\r\n        y     : min[1],\r\n        left  : min[0],\r\n        top   : min[1],\r\n        right : max[0],\r\n        bottom: max[1]\r\n      };\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  parseNumber(value, args = {}) {\r\n    value = (\"\" + value).trim().toLowerCase();\r\n\r\n    let baseUnit = args.baseUnit || this.baseUnit;\r\n    let isInt = args.isInt || this.isInt;\r\n\r\n    let sign = 1.0;\r\n\r\n    if (value.startsWith(\"-\")) {\r\n      value = value.slice(1, value.length).trim();\r\n      sign = -1;\r\n    }\r\n\r\n    let hexre = /-?[0-9a-f]+h$/;\r\n\r\n    if (value.startsWith(\"0b\")) {\r\n      value = value.slice(2, value.length).trim();\r\n      value = parseInt(value, 2);\r\n    } else if (value.startsWith(\"0x\")) {\r\n      value = value.slice(2, value.length).trim();\r\n      value = parseInt(value, 16);\r\n    } else if (value.search(hexre) === 0) {\r\n      value = value.slice(0, value.length - 1).trim();\r\n      value = parseInt(value, 16);\r\n    } else {\r\n      value = units.parseValue(value, baseUnit);\r\n    }\r\n\r\n    if (isInt) {\r\n      value = ~~value;\r\n    }\r\n\r\n    return value*sign;\r\n  }\r\n\r\n  formatNumber(value, args = {}) {\r\n    let baseUnit = args.baseUnit || this.baseUnit;\r\n    let displayUnit = args.displayUnit || this.displayUnit;\r\n    let isInt = args.isInt || this.isInt;\r\n    let radix = args.radix || this.radix || 10;\r\n    let decimalPlaces = args.decimalPlaces || this.decimalPlaces;\r\n\r\n    //console.log(this.baseUnit, this.displayUnit);\r\n\r\n    if (isInt && radix !== 10) {\r\n      let ret = Math.floor(value).toString(radix);\r\n\r\n      if (radix === 2)\r\n        return \"0b\" + ret;\r\n      else if (radix === 16)\r\n        return ret + \"h\";\r\n    }\r\n\r\n    return units.buildString(value, baseUnit, decimalPlaces, displayUnit);\r\n  }\r\n\r\n  setBoxCSS(subkey) {\r\n    let boxcode = '';\r\n\r\n    //debugger;\r\n\r\n    let keys = [\"left\", \"right\", \"top\", \"bottom\"];\r\n\r\n    let sub;\r\n    if (subkey) {\r\n      sub = this.getAttribute(subkey) || {};\r\n    }\r\n\r\n    let def = (key) => {\r\n      if (sub) {\r\n        return this.getSubDefault(subkey, key);\r\n      }\r\n\r\n      return this.getDefault(key);\r\n    }\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let key = i ? \"padding\" : \"margin\";\r\n\r\n      this.style[key] = \"unset\";\r\n\r\n      let val = def(key);\r\n      if (val !== undefined) { //handle default first\r\n        for (let j = 0; j < 4; j++) {\r\n          this.style[key + \"-\" + keys[j]] = val + \"px\";\r\n        }\r\n      }\r\n\r\n      for (let j = 0; j < 4; j++) { //now do box sides\r\n        let key2 = `${key}-${keys[j]}`;\r\n        let val2 = def(key2);\r\n\r\n        if (val2 !== undefined) {\r\n          this.style[key2] = val2 + \"px\";\r\n        }\r\n      }\r\n\r\n    }\r\n\r\n    this.style[\"border-radius\"] = def(\"border-radius\") + \"px\";\r\n    this.style[\"border\"] = `${def(\"border-width\")}px ${def(\"border-style\")} ${def(\"border-color\")}`;\r\n  }\r\n\r\n  genBoxCSS(subkey) {\r\n    let boxcode = '';\r\n\r\n    let keys = [\"left\", \"right\", \"top\", \"bottom\"];\r\n\r\n    let sub;\r\n    if (subkey) {\r\n      sub = this.getAttribute(subkey) || {};\r\n    }\r\n\r\n    let def = (key) => {\r\n      if (sub) {\r\n        return this.getSubDefault(subkey, key);\r\n      }\r\n\r\n      return this.getDefault(key);\r\n    }\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let key = i ? \"padding\" : \"margin\";\r\n\r\n      let val = def(key);\r\n      if (val !== undefined) {\r\n        boxcode += `${key}: ${val} px;\\n`;\r\n      }\r\n\r\n      for (let j = 0; j < 4; j++) {\r\n        let key2 = `${key}-${keys[j]}`;\r\n        let val2 = def(key2);\r\n\r\n        if (val2 !== undefined) {\r\n          boxcode += `${key2}: ${val}px;\\n`;\r\n        }\r\n      }\r\n    }\r\n\r\n    boxcode += `border-radius: ${def(\"border-radius\")}px;\\n`;\r\n    boxcode += `border: ${def(\"border-width\")}px ${def(\"border-style\")} ${def(\"border-color\")};\\n`;\r\n\r\n    return boxcode;\r\n  }\r\n\r\n  setCSS(setBG = true) {\r\n    if (setBG) {\r\n      let bg = this.getDefault(\"background-color\");\r\n      if (bg) {\r\n        this.style[\"background-color\"] = bg;\r\n      }\r\n    }\r\n\r\n    let zoom = this.getZoom();\r\n    if (zoom === 1.0) {\r\n      return;\r\n    }\r\n\r\n    let transform = \"\" + this.style[\"transform\"];\r\n\r\n    //try to preserve user set transform by selectively deleting scale\r\n    //kind of hackish. . .\r\n\r\n    //normalize whitespace\r\n    transform = transform.replace(/[ \\t\\n\\r]+/g, ' ');\r\n    transform = transform.replace(/, /g, ',');\r\n\r\n    //cut out scale\r\n    let transform2 = transform.replace(/scale\\([^)]+\\)/, '').trim();\r\n    this.style[\"transform\"] = transform2 + ` scale(${zoom},${zoom})`;\r\n  }\r\n\r\n  flushSetCSS() {\r\n    //check init\r\n    this._init();\r\n\r\n    this.setCSS();\r\n\r\n    this._forEachChildWidget((c) => {\r\n      if (!(c.packflag & PackFlags.NO_UPDATE)) {\r\n        c.flushSetCSS();\r\n      }\r\n    });\r\n  }\r\n\r\n  /* Why is the DOM API argument order swapped here?*/\r\n  replaceChild(newnode, node) {\r\n    for (let i = 0; i < this.childNodes.length; i++) {\r\n      if (this.childNodes[i] === node) {\r\n        super.replaceChild(newnode, node);\r\n        return true;\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < this.shadow.childNodes.length; i++) {\r\n      if (this.shadow.childNodes[i] === node) {\r\n        this.shadow.replaceChild(newnode, node);\r\n        return true;\r\n      }\r\n    }\r\n\r\n    console.error(\"Unknown child node\", node);\r\n    return false;\r\n  }\r\n\r\n  swapWith(b) {\r\n    let p1 = this.parentNode;\r\n    let p2 = b.parentNode;\r\n\r\n    if (this.parentWidget && (p1 === this.parentWidget.shadow) || p1 === null) {\r\n      p1 = this.parentWidget;\r\n    }\r\n\r\n    if (b.parentWidget && (p2 === b.parentWidget.shadow) || p2 === null) {\r\n      p2 = b.parentWidget;\r\n    }\r\n\r\n    if (!p1 || !p2) {\r\n      console.error(\"Invalid call to UIBase.prototype.swapWith\", this, b, p1, p2);\r\n      return false;\r\n    }\r\n\r\n    let getPos = (n, p) => {\r\n      let i = Array.prototype.indexOf.call(p.childNodes, n);\r\n\r\n      if (i < 0 && p.shadow) {\r\n        p = p.shadow;\r\n        i = Array.prototype.indexOf.call(p.childNodes, n);\r\n      }\r\n\r\n      return [i, p];\r\n    }\r\n\r\n    let [i1, n1] = getPos(this, p1);\r\n    let [i2, n2] = getPos(b, p2);\r\n\r\n    console.log(\"i1, i2, n1, n2\", i1, i2, n1, n2);\r\n\r\n    let tmp1 = document.createElement(\"div\");\r\n    let tmp2 = document.createElement(\"div\");\r\n\r\n    n1.insertBefore(tmp1, this);\r\n    n2.insertBefore(tmp2, b);\r\n\r\n    //HTMLElement.prototype.remove.call(this);\r\n    //HTMLElement.prototype.remove.call(b);\r\n\r\n    n1.replaceChild(b, tmp1);\r\n    n2.replaceChild(this, tmp2);\r\n\r\n    let ptmp = this.parentWidget;\r\n    this.parentWidget = b.parentWidget;\r\n    b.parentWidget = ptmp;\r\n\r\n    tmp1.remove();\r\n    tmp2.remove();\r\n\r\n    return true;\r\n  }\r\n\r\n  traverse(type_or_set) {\r\n    let this2 = this;\r\n\r\n    let classes = type_or_set;\r\n\r\n    let is_set = type_or_set instanceof Set;\r\n    is_set = is_set || type_or_set instanceof util.set;\r\n    is_set = is_set || Array.isArray(type_or_set);\r\n\r\n    if (!is_set) {\r\n      classes = [type_or_set];\r\n    }\r\n\r\n    let visit = new Set();\r\n\r\n    return (function* () {\r\n      let stack = [this2];\r\n\r\n      while (stack.length > 0) {\r\n        let n = stack.pop();\r\n\r\n        visit.add(n);\r\n\r\n        if (!n || !n.childNodes) {\r\n          continue;\r\n        }\r\n\r\n        for (let cls of classes) {\r\n          if (n instanceof cls) {\r\n            yield n;\r\n          }\r\n        }\r\n\r\n        for (let c of n.childNodes) {\r\n          if (!visit.has(c)) {\r\n            stack.push(c);\r\n          }\r\n        }\r\n\r\n        if (n.shadow) {\r\n          for (let c of n.shadow.childNodes) {\r\n            if (!visit.has(c)) {\r\n              stack.push(c);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    })();\r\n  }\r\n\r\n  appendChild(child) {\r\n    if (child instanceof UIBase) {\r\n      child.ctx = this.ctx;\r\n      child.parentWidget = this;\r\n\r\n      child.useDataPathUndo = this.useDataPathUndo;\r\n    }\r\n\r\n    return super.appendChild(child);\r\n  }\r\n\r\n  _clipboardHotkeyInit() {\r\n    this._clipboard_over = false;\r\n    this._last_clipboard_keyevt = undefined;\r\n\r\n    this._clipboard_keystart = () => {\r\n      if (this._clipboard_events) {\r\n        return;\r\n      }\r\n\r\n      this._clipboard_events = true;\r\n      window.addEventListener(\"keydown\", this._clipboard_keydown, {capture: true, passive: false});\r\n    }\r\n\r\n    this._clipboard_keyend = () => {\r\n      if (!this._clipboard_events) {\r\n        return;\r\n      }\r\n\r\n      this._clipboard_events = false;\r\n      window.removeEventListener(\"keydown\", this._clipboard_keydown, {capture: true, passive: false});\r\n    }\r\n\r\n    this._clipboard_keydown = (e, internal_mode) => {\r\n      if (!this.isConnected || !cconst.getClipboardData) {\r\n        this._clipboard_keyend();\r\n        return;\r\n      }\r\n\r\n      if (e === this._last_clipboard_keyevt || !this._clipboard_over) {\r\n        return;\r\n      }\r\n\r\n      /* the user's mouse cursor might not be over the element\r\n      *  if they've tabbed to it */\r\n\r\n      let is_copy = e.keyCode === keymap[\"C\"] && (e.ctrlKey || e.commandKey) && !e.shiftKey && !e.altKey;\r\n      let is_paste = e.keyCode === keymap[\"V\"] && (e.ctrlKey || e.commandKey) && !e.shiftKey && !e.altKey;\r\n\r\n      if (!is_copy && !is_paste) {\r\n        //early out, remember that pickElement is highly expensive to run\r\n        return;\r\n      }\r\n\r\n      //pasteForAllChildren\r\n      if (!internal_mode) {\r\n        let screen = this.ctx.screen;\r\n        let elem = screen.pickElement(screen.mpos[0], screen.mpos[1]);\r\n\r\n        let checkTree = is_paste && this.constructor.define().pasteForAllChildren;\r\n        checkTree = checkTree || (is_copy && this.constructor.define().copyForAllChildren);\r\n\r\n        while (checkTree && !(elem instanceof TextBox) && elem !== this && elem.parentWidget) {\r\n          console.log(\"  \" + elem._id);\r\n\r\n          elem = elem.parentWidget;\r\n        }\r\n\r\n        console.warn(\"COLOR\", this._id, elem._id);\r\n\r\n        if (elem !== this) {\r\n          //remove global keyhandler\r\n          this._clipboard_keyend();\r\n          return;\r\n        }\r\n      } else {\r\n        console.warn(\"COLOR\", this._id);\r\n      }\r\n\r\n      this._last_clipboard_keyevt = e;\r\n\r\n      if (is_copy) {\r\n        this.clipboardCopy();\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n\r\n      if (is_paste) {\r\n        this.clipboardPaste();\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n    }\r\n\r\n    let start = (e) => {\r\n      this._clipboard_over = true;\r\n      this._clipboard_keystart();\r\n    }\r\n\r\n    let stop = (e) => {\r\n      this._clipboard_over = false;\r\n      this._clipboard_keyend();\r\n    }\r\n\r\n    this.doOnce(() => {\r\n      this.tabIndex = 0; //enable self key events when element has focus\r\n    });\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      return this._clipboard_keydown(e, true);\r\n    });\r\n\r\n    this.addEventListener(\"pointerover\", start, {capture: true, passive: true});\r\n    this.addEventListener(\"pointerout\", stop, {capture: true, passive: true});\r\n    this.addEventListener(\"focus\", stop, {capture: true, passive: true});\r\n  }\r\n\r\n  /** set havePickClipboard to true in define() to\r\n   *  enable mouseover pick clipboarding */\r\n  clipboardCopy() {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  clipboardPaste() {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  //delayed init\r\n  init() {\r\n    this._init_done = true;\r\n\r\n    if (!this.hasAttribute(\"id\") && this._id) {\r\n      this.setAttribute(\"id\", this._id);\r\n    }\r\n  }\r\n\r\n  _ondestroy() {\r\n    if (this.tabIndex >= 0) {\r\n      this.regenTabOrder();\r\n    }\r\n\r\n    if (cconst.DEBUG.paranoidEvents) {\r\n      for (let item of this.__cbs) {\r\n        this.removeEventListener(item[0], item[1], item[2]);\r\n      }\r\n\r\n      this.__cbs = [];\r\n    }\r\n\r\n\r\n    if (this.ondestroy !== undefined) {\r\n      this.ondestroy();\r\n    }\r\n  }\r\n\r\n  remove(trigger_on_destroy = true) {\r\n    if (this.tabIndex >= 0) {\r\n      this.regenTabOrder();\r\n    }\r\n\r\n    super.remove();\r\n\r\n    if (trigger_on_destroy) {\r\n      this._ondestroy();\r\n    }\r\n\r\n    if (this.on_remove) {\r\n      this.on_remove();\r\n    }\r\n\r\n    this.parentWidget = undefined;\r\n  }\r\n\r\n  /*\r\n  *\r\n  * called when elements are removed.\r\n  * you should assume the element will be reused later;\r\n  * on_destroy is the callback for when elements are permanently destroyed\r\n  * */\r\n  on_remove() {\r\n\r\n  }\r\n\r\n  removeChild(child, trigger_on_destroy = true) {\r\n    super.removeChild(child);\r\n\r\n    if (trigger_on_destroy) {\r\n      child._ondestroy();\r\n    }\r\n  }\r\n\r\n  flushUpdate(force = false) {\r\n    //check init\r\n    this._init();\r\n\r\n    this.update();\r\n\r\n    this._forEachChildWidget((c) => {\r\n      if (force || !(c.packflag & PackFlags.NO_UPDATE)) {\r\n        if (!c.ctx) {\r\n          c.ctx = this.ctx;\r\n        }\r\n\r\n        c.flushUpdate(force);\r\n      }\r\n    });\r\n  }\r\n\r\n  //used by container nodes\r\n  /**\r\n   * Iterates over all child widgets,\r\n   * including ones that might be inside\r\n   * of normal DOM nodes.\r\n   *\r\n   * This is done by recursing into the dom\r\n   * tree and stopping at any node that's\r\n   * descended from ui_base.UIBase\r\n   **/\r\n  _forEachChildWidget(cb, thisvar) {\r\n    let rec = (n) => {\r\n      if (n instanceof UIBase) {\r\n        if (thisvar !== undefined) {\r\n          cb.call(thisvar, n);\r\n        } else {\r\n          cb(n);\r\n        }\r\n      } else {\r\n        for (let n2 of n.childNodes) {\r\n          rec(n2);\r\n        }\r\n\r\n        if (n.shadow !== undefined) {\r\n          for (let n2 of n.shadow.childNodes) {\r\n            rec(n2);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    for (let n of this.childNodes) {\r\n      rec(n);\r\n    }\r\n\r\n    if (this.shadow) {\r\n      for (let n of this.shadow.childNodes) {\r\n        rec(n);\r\n      }\r\n    }\r\n  }\r\n\r\n  checkInit() {\r\n    return this._init();\r\n  }\r\n\r\n  _init() {\r\n    if (this._init_done) {\r\n      return false;\r\n    }\r\n\r\n    this._init_done = true;\r\n    this.init();\r\n\r\n    return true;\r\n  }\r\n\r\n  getWinWidth() {\r\n    return window.innerWidth;\r\n  }\r\n\r\n  getWinHeight() {\r\n    return window.innerHeight;\r\n  }\r\n\r\n  calcZ() {\r\n    let p = this;\r\n    let n = this;\r\n\r\n    while (n) {\r\n      if (n.style && n.style[\"z-index\"]) {\r\n        let z = parseFloat(n.style[\"z-index\"]);\r\n        return z;\r\n      }\r\n\r\n      n = n.parentNode;\r\n\r\n      if (!n) {\r\n        n = p = p.parentWidget;\r\n      }\r\n    }\r\n\r\n    return 0;\r\n  }\r\n\r\n  pickElement(x, y, args = {}, marginy = 0, nodeclass = UIBase, excluded_classes = undefined) {\r\n    let marginx;\r\n    let clip;\r\n    let mouseEvent;\r\n    let isMouseMove, isMouseDown;\r\n\r\n    if (typeof args === \"object\") {\r\n      marginx = args.sx || 0;\r\n      marginy = args.sy || 0;\r\n      nodeclass = args.nodeclass || UIBase;\r\n      excluded_classes = args.excluded_classes;\r\n      clip = args.clip;\r\n      mouseEvent = args.mouseEvent;\r\n    } else {\r\n      marginx = args;\r\n\r\n      args = {\r\n        marginx         : marginx || 0,\r\n        marginy         : marginy || 0,\r\n        nodeclass       : nodeclass || UIBase,\r\n        excluded_classes: excluded_classes,\r\n        clip            : clip\r\n      }\r\n    }\r\n\r\n    if (mouseEvent) {\r\n      isMouseMove = mouseEvent.type === \"mousemove\" || mouseEvent.type === \"touchmove\" || mouseEvent.type === \"pointermove\";\r\n      isMouseDown = mouseEvent.buttons || (mouseEvent.touches && mouseEvent.touches.length > 0);\r\n    }\r\n\r\n    x -= window.scrollX;\r\n    y -= window.scrollY;\r\n\r\n    let elem = document.elementFromPoint(x, y);\r\n\r\n    if (!elem) {\r\n      return;\r\n    }\r\n\r\n    let path = [elem];\r\n    let lastelem = elem;\r\n    let i = 0;\r\n\r\n    while (elem && elem.shadow) {\r\n      if (i++ > 1000) {\r\n        console.error(\"Infinite loop error\");\r\n        break;\r\n      }\r\n\r\n      elem = elem.shadow.elementFromPoint(x, y);\r\n\r\n      if (elem === lastelem) {\r\n        break;\r\n      }\r\n\r\n      if (elem) {\r\n        path.push(elem);\r\n      }\r\n\r\n      lastelem = elem;\r\n    }\r\n\r\n    path.reverse();\r\n\r\n    //console.warn(path);\r\n\r\n    for (let i = 0; i < path.length; i++) {\r\n      let node = path[i];\r\n      let ok = node instanceof nodeclass;\r\n\r\n      if (excluded_classes) {\r\n        for (let cls of excluded_classes) {\r\n          ok = ok && !(node instanceof cls);\r\n        }\r\n      }\r\n\r\n      if (clip) {\r\n        let rect = node.getBoundingClientRect();\r\n        let clip2 = math.aabb_intersect_2d(clip.pos, clip.size, [rect.x, rect.y], [rect.width, rect.height]);\r\n\r\n        ok = ok && clip2;\r\n      }\r\n\r\n      if (ok) {\r\n        window.elem = node;\r\n        //console.log(node._id);\r\n        return node;\r\n      }\r\n    }\r\n  }\r\n\r\n  __updateDisable(val) {\r\n    if (!!val === !!this.__disabledState) {\r\n      return;\r\n    }\r\n\r\n    this.__disabledState = !!val;\r\n\r\n    if (val && !this._disdata) {\r\n      let style = this.getDefault(\"disabled\") || this.getDefault(\"internalDisabled\") || {\r\n        \"background-color\": this.getDefault(\"DisabledBG\")\r\n      };\r\n\r\n      this._disdata = {\r\n        style   : {},\r\n        defaults: {}\r\n      };\r\n\r\n      for (let k in style) {\r\n        //save old style information\r\n        this._disdata.style[k] = this.style[k];\r\n        this._disdata.defaults[k] = this.default_overrides[k];\r\n\r\n        let v = style[k];\r\n\r\n        if (typeof v === \"object\" && v instanceof CSSFont) {\r\n          this.style[k] = style[k].genCSS();\r\n        } else if (typeof v === \"object\") {\r\n          continue;\r\n        } else {\r\n          this.style[k] = style[k];\r\n        }\r\n        this.default_overrides[k] = style[k];\r\n      }\r\n\r\n      this.__disabledState = !!val;\r\n      this.on_disabled();\r\n    } else if (!val && this._disdata) {\r\n\r\n      //load old style information\r\n      for (let k in this._disdata.style) {\r\n        this.style[k] = this._disdata.style[k];\r\n      }\r\n\r\n      for (let k in this._disdata.defaults) {\r\n        let v = this._disdata.defaults[k];\r\n\r\n        if (v === undefined) {\r\n          delete this.default_overrides[k];\r\n        } else {\r\n          this.default_overrides[k] = v;\r\n        }\r\n      }\r\n\r\n      //this.background = this.style[\"background-color\"];\r\n      this._disdata = undefined;\r\n\r\n      this.__disabledState = !!val;\r\n      this.on_enabled();\r\n    }\r\n\r\n    this.__disabledState = !!val;\r\n\r\n    let visit = (n) => {\r\n      if (n instanceof UIBase) {\r\n        let changed = !!n.__disabledState;\r\n\r\n        /*\r\n        if (val) {\r\n          n._parent_disabled_set = Math.max(n._parent_disabled_set + 1, 0);\r\n        } else {\r\n          n._parent_disabled_set = Math.max(n._parent_disabled_set - 1, 0);\r\n        }//*/\r\n\r\n        n.__updateDisable(n.disabled);\r\n\r\n        changed = changed !== !!n.__disabledState;\r\n        if (changed) {\r\n          n.update();\r\n          n.setCSS();\r\n        }\r\n      }\r\n    };\r\n\r\n    this._forEachChildWidget(visit);\r\n  }\r\n\r\n  on_disabled() {\r\n\r\n  }\r\n\r\n  on_enabled() {\r\n\r\n  }\r\n\r\n  pushModal(handlers = this, autoStopPropagation = true, pointerId = undefined, pointerElem = this) {\r\n    if (this._modaldata !== undefined) {\r\n      console.warn(\"UIBase.prototype.pushModal called when already in modal mode\");\r\n      this.popModal();\r\n    }\r\n\r\n    let _areaWrangler = contextWrangler.copy();\r\n\r\n    contextWrangler.copy(this.ctx);\r\n\r\n    function bindFunc(func) {\r\n      return function () {\r\n        _areaWrangler.copyTo(contextWrangler);\r\n\r\n        return func.apply(handlers, arguments);\r\n      }\r\n    }\r\n\r\n    let handlers2 = {};\r\n    for (let k in handlers) {\r\n      let func = handlers[k];\r\n\r\n      if (typeof func !== \"function\") {\r\n        continue;\r\n      }\r\n\r\n      handlers2[k] = bindFunc(func);\r\n    }\r\n    //this._modalstack.push(this.ctx);\r\n    //this.ctx = this.ctx.toLocked();\r\n\r\n    if (pointerId !== undefined && pointerElem) {\r\n      this._modaldata = pushPointerModal(handlers2, autoStopPropagation);\r\n    } else {\r\n      this._modaldata = pushModalLight(handlers2, autoStopPropagation);\r\n    }\r\n\r\n    return this._modaldata;\r\n  }\r\n\r\n  popModal() {\r\n    if (this._modaldata === undefined) {\r\n      console.warn(\"Invalid call to UIBase.prototype.popModal\");\r\n      return;\r\n    }\r\n\r\n    //this.ctx = this._modalstack.pop();\r\n    popModalLight(this._modaldata);\r\n    this._modaldata = undefined;\r\n  }\r\n\r\n  /** child classes can override this to prevent focus on flash*/\r\n  _flash_focus() {\r\n    this.focus();\r\n  }\r\n\r\n  flash(color, rect_element = this, timems = 355, autoFocus = true) {\r\n    if (typeof color != \"object\") {\r\n      color = css2color(color);\r\n    }\r\n    color = new Vector4(color);\r\n    let csscolor = color2css(color);\r\n\r\n    if (this._flashtimer !== undefined && this._flashcolor !== csscolor) {\r\n      window.setTimeout(() => {\r\n        this.flash(color, rect_element, timems, autoFocus);\r\n      }, 100);\r\n\r\n      return;\r\n    } else if (this._flashtimer !== undefined) {\r\n      return;\r\n    }\r\n\r\n    //let rect = rect_element.getClientRects()[0];\r\n    let rect = rect_element.getBoundingClientRect();\r\n\r\n    if (rect === undefined) {\r\n      return;\r\n    }\r\n\r\n    //okay, dom apparently calls onchange() on .remove, so we have\r\n    //to put the timer code first to avoid loops\r\n    let timer;\r\n    let tick = 0;\r\n    let max = ~~(timems/20);\r\n\r\n    let x = rect.x, y = rect.y;\r\n\r\n    let cb = (e) => {\r\n      if (timer === undefined) {\r\n        return\r\n      }\r\n\r\n      let a = 1.0 - tick/max;\r\n      div.style[\"background-color\"] = color2css(color, a*a*0.5);\r\n\r\n      if (tick > max) {\r\n        window.clearInterval(timer);\r\n\r\n        this._flashtimer = undefined;\r\n        this._flashcolor = undefined;\r\n        timer = undefined;\r\n\r\n        div.remove();\r\n\r\n        if (autoFocus) {\r\n          this._flash_focus();\r\n        }\r\n      }\r\n\r\n      tick++;\r\n    };\r\n\r\n    window.setTimeout(cb, 5);\r\n    this._flashtimer = timer = window.setInterval(cb, 20);\r\n\r\n    let div = document.createElement(\"div\");\r\n\r\n    div.style[\"pointer-events\"] = \"none\";\r\n    div.tabIndex = undefined;\r\n    div.style[\"z-index\"] = \"900\";\r\n    div.style[\"display\"] = \"float\";\r\n    div.style[\"position\"] = UIBase.PositionKey;\r\n    div.style[\"margin\"] = \"0px\";\r\n    div.style[\"left\"] = x + \"px\";\r\n    div.style[\"top\"] = y + \"px\";\r\n\r\n    div.style[\"background-color\"] = color2css(color, 0.5);\r\n    div.style[\"width\"] = rect.width + \"px\";\r\n    div.style[\"height\"] = rect.height + \"px\";\r\n    div.setAttribute(\"class\", \"UIBaseFlash\");\r\n\r\n    let screen = this.getScreen();\r\n    if (screen !== undefined) {\r\n      screen._enterPopupSafe();\r\n    }\r\n\r\n    document.body.appendChild(div);\r\n    if (autoFocus) {\r\n      this._flash_focus();\r\n    }\r\n\r\n    this._flashcolor = csscolor;\r\n\r\n    if (screen !== undefined) {\r\n      screen._exitPopupSafe();\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n  }\r\n\r\n  on_resize(newsize) {\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = {};\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      ret.datapath = this.getAttribute(\"datapath\");\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    if (!this._init_done) {\r\n      this._init();\r\n    }\r\n  }\r\n\r\n  getPathValue(ctx, path) {\r\n    try {\r\n      return ctx.api.getValue(ctx, path);\r\n    } catch (error) {\r\n      //report(\"data path error in ui for\" + path);\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  undoBreakPoint() {\r\n    this.pathUndoGen++;\r\n  }\r\n\r\n  setPathValueUndo(ctx, path, val) {\r\n    let mass_set_path = this.getAttribute(\"mass_set_path\");\r\n    let rdef = ctx.api.resolvePath(ctx, path);\r\n    let prop = rdef.prop;\r\n\r\n    if (ctx.api.getValue(ctx, path) === val) {\r\n      return;\r\n    }\r\n\r\n    let toolstack = this.ctx.toolstack;\r\n    let head = toolstack.head;\r\n\r\n    let bad = head === undefined || !(head instanceof getDataPathToolOp());\r\n    bad = bad || head.hashThis() !== head.hash(mass_set_path, path, prop.type, this._id);\r\n    bad = bad || this.pathUndoGen !== this._lastPathUndoGen;\r\n\r\n    //if (head !== undefined && head instanceof getDataPathToolOp()) {\r\n    //console.log(\"===>\", bad, head.hashThis());\r\n    //console.log(\"    ->\", head.hash(mass_set_path, path, prop.type, this._id));\r\n    //}\r\n\r\n    if (!bad) {\r\n      toolstack.undo();\r\n      head.setValue(ctx, val, rdef.obj);\r\n      toolstack.redo();\r\n    } else {\r\n      this._lastPathUndoGen = this.pathUndoGen;\r\n\r\n      let toolop = getDataPathToolOp().create(ctx, path, val, this._id, mass_set_path);\r\n\r\n      /* getDataPathToolOp.create can return false in case of no-op paths. */\r\n      if (!toolop) {\r\n        return;\r\n      }\r\n\r\n      ctx.toolstack.execTool(this.ctx, toolop);\r\n      head = toolstack.head;\r\n    }\r\n\r\n    if (!head || head.hadError === true) {\r\n      throw new Error(\"toolpath error\");\r\n    }\r\n  }\r\n\r\n  loadNumConstraints(prop = undefined, dom = this, onModifiedCallback = undefined) {\r\n    let modified = false;\r\n\r\n    if (!prop) {\r\n      let path;\r\n\r\n      if (dom.hasAttribute(\"datapath\")) {\r\n        path = dom.getAttribute(\"datapath\");\r\n      }\r\n\r\n      if (path === undefined && this.hasAttribute(\"datapath\")) {\r\n        path = this.getAttribute(\"datapath\");\r\n      }\r\n\r\n      if (typeof path === \"string\") {\r\n        prop = this.getPathMeta(this.ctx, path);\r\n      }\r\n    }\r\n\r\n    let loadAttr = (propkey, domkey = key, thiskey = key) => {\r\n      let old = this[thiskey];\r\n\r\n      if (dom.hasAttribute(domkey)) {\r\n        this[thiskey] = parseFloat(dom.getAttribute(domkey));\r\n      } else if (prop) {\r\n        this[thiskey] = prop[propkey];\r\n      }\r\n\r\n      if (this[thiskey] !== old) {\r\n        modified = true;\r\n      }\r\n    }\r\n\r\n    for (let key of NumberConstraints) {\r\n      let thiskey = key, domkey = key;\r\n\r\n      if (key === \"range\") { //handled later\r\n        continue;\r\n      }\r\n\r\n      loadAttr(key, domkey, thiskey);\r\n    }\r\n\r\n    let oldmin = this.range[0];\r\n    let oldmax = this.range[1];\r\n\r\n    let range = prop ? prop.range : undefined;\r\n    if (range && !dom.hasAttribute(\"min\")) {\r\n      this.range[0] = range[0];\r\n    } else if (dom.hasAttribute(\"min\")) {\r\n      this.range[0] = parseFloat(dom.getAttribute(\"min\"));\r\n    }\r\n\r\n    if (range && !dom.hasAttribute(\"max\")) {\r\n      this.range[1] = range[1];\r\n    } else if (dom.hasAttribute(\"max\")) {\r\n      this.range[1] = parseFloat(dom.getAttribute(\"max\"));\r\n    }\r\n\r\n    if (this.range[0] !== oldmin || this.range[1] !== oldmax) {\r\n      modified = true;\r\n    }\r\n\r\n    let oldint = this.isInt;\r\n\r\n    if (dom.getAttribute(\"integer\")) {\r\n      let val = dom.getAttribute(\"integer\");\r\n      val = (\"\" + val).toLowerCase();\r\n\r\n      //handles anonymouse <numslider-x integer> case\r\n      this.isInt = val === \"null\" || val === \"true\" || val === \"yes\" || val === \"1\";\r\n    } else if (prop && prop instanceof IntProperty) {\r\n      this.isInt = true;\r\n    }\r\n\r\n    if (!this.isInt !== !oldint) {\r\n      modified = true;\r\n    }\r\n\r\n    let oldedit = this.editAsBaseUnit;\r\n\r\n    if (this.editAsBaseUnit === undefined) {\r\n      if (prop && (prop.flag & PropFlags.EDIT_AS_BASE_UNIT)) {\r\n        this.editAsBaseUnit = true;\r\n      } else {\r\n        this.editAsBaseUnit = false;\r\n      }\r\n    }\r\n\r\n    if (!this.editAsBaseUnit !== !oldedit) {\r\n      modified = true;\r\n    }\r\n\r\n    if (modified) {\r\n      this.setCSS();\r\n\r\n      if (onModifiedCallback) {\r\n        onModifiedCallback.call(this);\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n    adds a method call to the event queue,\r\n    but only if that method (for this instance, as differentiated\r\n    by ._id) isn't there already.\r\n\r\n    also, method won't be ran until this.ctx exists\r\n  */\r\n\r\n  pushReportContext(key) {\r\n    if (this.ctx.api.pushReportContext) {\r\n      this.ctx.api.pushReportContext(key);\r\n    }\r\n  }\r\n\r\n  popReportContext() {\r\n    if (this.ctx.api.popReportContext)\r\n      this.ctx.api.popReportContext();\r\n  }\r\n\r\n  setPathValue(ctx, path, val) {\r\n    if (this.useDataPathUndo) {\r\n      this.pushReportContext(this._reportCtxName);\r\n\r\n      try {\r\n        this.setPathValueUndo(ctx, path, val);\r\n      } catch (error) {\r\n        this.popReportContext();\r\n\r\n        if (!(error instanceof DataPathError)) {\r\n          throw error;\r\n        } else {\r\n          return;\r\n        }\r\n      }\r\n\r\n      this.popReportContext();\r\n      return;\r\n    }\r\n\r\n    this.pushReportContext(this._reportCtxName);\r\n\r\n    try {\r\n      if (this.hasAttribute(\"mass_set_path\")) {\r\n        ctx.api.massSetProp(ctx, this.getAttribute(\"mass_set_path\"), val);\r\n        ctx.api.setValue(ctx, path, val);\r\n      } else {\r\n        ctx.api.setValue(ctx, path, val);\r\n      }\r\n    } catch (error) {\r\n      this.popReportContext();\r\n\r\n      if (!(error instanceof DataPathError)) {\r\n        throw error;\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    this.popReportContext();\r\n  }\r\n\r\n  getPathMeta(ctx, path) {\r\n    this.pushReportContext(this._reportCtxName);\r\n    let ret = ctx.api.resolvePath(ctx, path);\r\n    this.popReportContext();\r\n\r\n    return ret !== undefined ? ret.prop : undefined;\r\n  }\r\n\r\n  getPathDescription(ctx, path) {\r\n    let ret;\r\n    this.pushReportContext(this._reportCtxName);\r\n\r\n    try {\r\n      ret = ctx.api.getDescription(ctx, path);\r\n    } catch (error) {\r\n      this.popReportContext();\r\n\r\n      if (error instanceof DataPathError) {\r\n        //console.warn(\"Invalid data path '\" + path + \"'\");\r\n        return undefined;\r\n      } else {\r\n        throw error;\r\n      }\r\n    }\r\n\r\n    this.popReportContext();\r\n    return ret;\r\n  }\r\n\r\n  getScreen() {\r\n    if (this.ctx !== undefined)\r\n      return this.ctx.screen;\r\n  }\r\n\r\n  isDead() {\r\n    return !this.isConnected;\r\n    let p = this, lastp = this;\r\n\r\n    function find(c, n) {\r\n      for (let n2 of c) {\r\n        if (n2 === n) {\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n\r\n    while (p) {\r\n      lastp = p;\r\n\r\n      let parent = p.parentWidget;\r\n      if (!parent) {\r\n        parent = p.parentElement ? p.parentElement : p.parentNode;\r\n      }\r\n\r\n      if (parent && p && !find(parent.childNodes, p)) {\r\n        if (parent.shadow !== undefined && !find(parent.shadow.childNodes)) {\r\n          return true;\r\n        }\r\n      }\r\n      p = parent;\r\n\r\n      if (p === document.body) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  doOnce(func, timeout = undefined) {\r\n    if (func._doOnce === undefined) {\r\n      func._doOnce_reqs = new Set();\r\n\r\n      func._doOnce = function (thisvar, trace) {\r\n        if (func._doOnce_reqs.has(thisvar._id)) {\r\n          return;\r\n        }\r\n\r\n        func._doOnce_reqs.add(thisvar._id);\r\n\r\n        function f() {\r\n          if (thisvar.isDead()) {\r\n            func._doOnce_reqs.delete(thisvar._id);\r\n\r\n            if (func === thisvar._init || !cconst.DEBUG.doOnce) {\r\n              return;\r\n            }\r\n\r\n            console.warn(\"Ignoring doOnce call for dead element\", thisvar._id, func, trace);\r\n            return;\r\n          }\r\n\r\n          if (!thisvar.ctx) {\r\n            if (cconst.DEBUG.doOnce) {\r\n              console.warn(\"doOnce call is waiting for context...\", thisvar._id, func);\r\n            }\r\n\r\n            internalSetTimeout(f, 0);\r\n            return;\r\n          }\r\n\r\n          func._doOnce_reqs.delete(thisvar._id);\r\n          func.call(thisvar);\r\n        };\r\n\r\n        internalSetTimeout(f, timeout);\r\n      }\r\n    }\r\n\r\n    let trace = new Error().stack;\r\n    func._doOnce(this, trace);\r\n  }\r\n\r\n  float(x = 0, y = 0, zindex = undefined, positionKey = UIBase.PositionKey) {\r\n    this.style.position = positionKey;\r\n\r\n    this.style.left = x + \"px\";\r\n    this.style.top = y + \"px\";\r\n\r\n    if (zindex !== undefined) {\r\n      this.style[\"z-index\"] = zindex\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  _ensureChildrenCtx() {\r\n    let ctx = this.ctx;\r\n    if (ctx === undefined) {\r\n      return;\r\n    }\r\n\r\n    this._forEachChildWidget((n) => {\r\n      n.parentWidget = this;\r\n\r\n      if (n.ctx === undefined) {\r\n        n.ctx = ctx;\r\n      }\r\n\r\n      n._ensureChildrenCtx(ctx);\r\n    });\r\n  }\r\n\r\n  checkThemeUpdate() {\r\n    if (!cconst.enableThemeAutoUpdate) {\r\n      return false;\r\n    }\r\n\r\n    if (_themeUpdateKey !== this._last_theme_update_key) {\r\n      this._last_theme_update_key = _themeUpdateKey;\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  abortToolTips(delayMs = 500) {\r\n    if (this._has_own_tooltips) {\r\n      this._has_own_tooltips.stop_timer();\r\n    }\r\n\r\n    if (this._tooltip_ref) {\r\n      this._tooltip_ref.remove();\r\n      this._tooltip_ref = undefined;\r\n    }\r\n\r\n    this._tool_tip_abort_delay = util.time_ms() + delayMs;\r\n\r\n    return this;\r\n  }\r\n\r\n  updateToolTipHandlers() {\r\n    if (!this._useNativeToolTips_set && !cconst.useNativeToolTips !== !this._useNativeToolTips) {\r\n      this._useNativeToolTips = cconst.useNativeToolTips;\r\n    }\r\n\r\n    if (!!this.useNativeToolTips === !this._has_own_tooltips) {\r\n      return;\r\n    }\r\n\r\n    if (!this.useNativeToolTips) {\r\n      let state = this._has_own_tooltips = {\r\n        start_timer : (e) => {\r\n          this._tooltip_timer = util.time_ms();\r\n          //console.warn(this._id, \"tooltip timer start\", e.type);\r\n        },\r\n        stop_timer  : (e) => {\r\n          //console.warn(this._id, \"tooltip timer end\", util.time_ms()-this._tooltip_timer, e.type);\r\n          this._tooltip_timer = undefined;\r\n        },\r\n        reset_timer : (e) => {\r\n          //console.warn(this._id, \"tooltip timer reset\", util.time_ms()-this._tooltip_timer, e.type);\r\n          if (this._tooltip_timer !== undefined) {\r\n            this._tooltip_timer = util.time_ms();\r\n          }\r\n        },\r\n        start_events: [\r\n          \"mouseover\"\r\n        ],\r\n        reset_events: [\r\n          \"mousemove\", \"mousedown\", \"mouseup\",\r\n          \"touchstart\", \"touchend\", \"keydown\", \"focus\"\r\n        ],\r\n        stop_events : [\r\n          \"mouseleave\", \"blur\", \"mouseout\"\r\n        ],\r\n        handlers    : {}\r\n      }\r\n\r\n      let bind_handler = (type, etype) => {\r\n        let handler = (e) => {\r\n          if (this._tool_tip_abort_delay !== undefined && util.time_ms() < this._tool_tip_abort_delay) {\r\n            this._tooltip_timer = undefined;\r\n            return;\r\n          }\r\n\r\n          state[type](e);\r\n        };\r\n\r\n        if (etype in state.handlers) {\r\n          console.error(type, \"is in handlers already\");\r\n          return;\r\n        }\r\n\r\n        state.handlers[etype] = handler;\r\n        return handler;\r\n      }\r\n\r\n      let i = 0;\r\n      let lists = [state.start_events, state.stop_events, state.reset_events];\r\n\r\n      for (let type of [\"start_timer\", \"stop_timer\", \"reset_timer\"]) {\r\n        for (let etype of lists[i]) {\r\n          this.addEventListener(etype, bind_handler(type, etype), {passive: true});\r\n        }\r\n\r\n        i++;\r\n      }\r\n    } else {\r\n      console.warn(this.id, \"removing tooltip handlers\");\r\n      let state = this._has_own_tooltips;\r\n\r\n      for (let k in this.state.handlers) {\r\n        let handler = this.state.handlers[k];\r\n        this.removeEventListener(k, handler);\r\n      }\r\n\r\n      this._has_own_tooltips = undefined;\r\n      this._tooltip_timer = undefined;\r\n    }\r\n  }\r\n\r\n  updateToolTips() {\r\n    if (this._description_final === undefined || this._description_final === null ||\r\n      this._description_final.trim().length === 0) {\r\n      return;\r\n    }\r\n\r\n    if (!this.ctx || !this.ctx.screen) {\r\n      return;\r\n    }\r\n\r\n    this.updateToolTipHandlers();\r\n\r\n    if (this.useNativeToolTips || this._tooltip_timer === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this._tool_tip_abort_delay !== undefined && util.time_ms() < this._tool_tip_abort_delay) {\r\n      return;\r\n    }\r\n\r\n    this._tool_tip_abort_delay = undefined;\r\n\r\n    let screen = this.ctx.screen;\r\n\r\n    const timelimit = 500;\r\n    let ok = util.time_ms() - this._tooltip_timer > timelimit;\r\n\r\n    let x = screen.mpos[0], y = screen.mpos[1];\r\n\r\n    let r = this.getClientRects();\r\n    r = r ? r[0] : r;\r\n\r\n    if (!r) {\r\n      ok = false;\r\n    } else {\r\n      ok = ok && x >= r.x && x < r.x + r.width;\r\n      ok = ok && y >= r.y && y < r.y + r.height;\r\n    }\r\n\r\n\r\n    //console.log(r);\r\n    if (r) {\r\n      //console.warn(this._id, \"possible tooltip\", x, y, r.x-3, r.y-3, r.width, r.height);\r\n    }\r\n\r\n    ok = ok && !haveModal();\r\n    ok = ok && screen.pickElement(x, y) === this;\r\n    ok = ok && this._description_final;\r\n\r\n    if (ok) {\r\n      //console.warn(\"Showing tooltop\", this.id);\r\n      this._tooltip_ref = _ToolTip.show(this._description_final, this.ctx.screen, x, y);\r\n    } else {\r\n      if (this._tooltip_ref) {\r\n        this._tooltip_ref.remove();\r\n      }\r\n\r\n      this._tooltip_ref = undefined;\r\n    }\r\n\r\n    //console.warn(this._id, \"tooltip timer end\");\r\n    if (util.time_ms() - this._tooltip_timer > timelimit) {\r\n      this._tooltip_timer = undefined;\r\n    }\r\n  }\r\n\r\n  //called regularly\r\n  update() {\r\n    this.updateToolTips();\r\n\r\n    if (this.ctx && this._description === undefined && this.getAttribute(\"datapath\")) {\r\n      let d = this.getPathDescription(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n      this.description = d;\r\n    }\r\n\r\n    if (!this._init_done) {\r\n      this._init();\r\n    }\r\n\r\n    if (this._init_done && !this.constructor.define().subclassChecksTheme) {\r\n      if (this.checkThemeUpdate()) {\r\n        console.log(\"theme update!\");\r\n\r\n        this.setCSS();\r\n      }\r\n    }\r\n  }\r\n\r\n  onadd() {\r\n    //if (this.parentWidget !== undefined) {\r\n    //  this._useDataPathUndo = this.parentWidget._useDataPathUndo;\r\n    //}\r\n\r\n    if (!this._init_done) {\r\n      this.doOnce(this._init);\r\n    }\r\n\r\n    if (this.tabIndex >= 0) {\r\n      this.regenTabOrder();\r\n    }\r\n  }\r\n\r\n  getZoom() {\r\n    if (this.parentWidget !== undefined) {\r\n      return this.parentWidget.getZoom();\r\n    }\r\n\r\n    return 1.0;\r\n  }\r\n\r\n  /**try to use this method\r\n\r\n   scaling ratio (e.g. for high-resolution displays)\r\n   for zoom ratio use getZoom()\r\n   */\r\n  getDPI() {\r\n    if (this.parentWidget !== undefined) {\r\n      return this.parentWidget.getDPI();\r\n    }\r\n\r\n    return UIBase.getDPI();\r\n  }\r\n\r\n  /**\r\n   * for saving ui state.\r\n   * see saveUIData() export\r\n   *\r\n   * should fail gracefully.\r\n   */\r\n  saveData() {\r\n    return {};\r\n  }\r\n\r\n  /**\r\n   * for saving ui state.\r\n   * see saveUIData() export\r\n   *\r\n   * should fail gracefully.\r\n   *\r\n   * also, it doesn't rebuild the object graph,\r\n   * it patches it; for true serialization use\r\n   * the toJSON/loadJSON or STRUCT interfaces.\r\n   */\r\n  loadData(obj) {\r\n    return this;\r\n  }\r\n\r\n  overrideDefault(key, val, localOnly = false) {\r\n    this.my_default_overrides[key] = val;\r\n\r\n    if (!localOnly) {\r\n      this.default_overrides[key] = val;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  overrideClass(style) {\r\n    this._override_class = style;\r\n  }\r\n\r\n  overrideClassDefault(style, key, val) {\r\n    if (!(style in this.class_default_overrides)) {\r\n      this.class_default_overrides[style] = {};\r\n    }\r\n\r\n    this.class_default_overrides[style][key] = val;\r\n  }\r\n\r\n  _doMobileDefault(key, val, obj) {\r\n    if (!util.isMobile())\r\n      return val;\r\n\r\n    const mobilekey = key + \"_mobile\";\r\n    if (obj && mobilekey in obj) {\r\n      return obj[mobilekey];\r\n    }\r\n\r\n    key = key.toLowerCase();\r\n    let ok = false;\r\n\r\n    for (let re of _mobile_theme_patterns) {\r\n      if (key.search(re) >= 0) {\r\n        ok = true;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (ok && theme.base.mobileSizeMultiplier) {\r\n      val *= theme.base.mobileSizeMultiplier;\r\n    }\r\n\r\n    return val;\r\n  }\r\n\r\n  hasDefault(key) {\r\n    let p = this;\r\n\r\n    while (p) {\r\n      if (key in p.default_overrides) {\r\n        return true;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    return this.hasClassDefault(key);\r\n  }\r\n\r\n  hasSubDefault(key, subkey) {\r\n    return this._hasSubDefault(...arguments, theme)\r\n      || this._themeOverride && this._hasSubDefault(...arguments, this._themeOverride);\r\n  }\r\n\r\n  _hasSubDefault(key, subkey) {\r\n    let style = this.getStyleClass();\r\n\r\n    let obj = this.getDefault(key);\r\n\r\n    if (!obj || typeof obj !== \"object\") {\r\n      return false;\r\n    }\r\n\r\n    return subkey in obj;\r\n  }\r\n\r\n  hasClassSubDefault(key, subkey, inherit = true) {\r\n    return this._hasClassSubDefault(key, subkey, inherit, undefined, theme) ||\r\n      this._themeOverride && this._hasClassSubDefault(key, subkey, inherit, undefined, this._themeOverride);\r\n  }\r\n\r\n  _hasClassSubDefault(key, subkey, inherit = true, style = this.getStyleClass(), themeDef) {\r\n    let th = themeDef;\r\n    th = th[style];\r\n\r\n    if (inherit) {\r\n      if (this._hasClassSubDefault(key, subkey, false, themeDef)) {\r\n        return true;\r\n      }\r\n\r\n      let ret = false;\r\n      let def = this.constructor.define();\r\n\r\n      if (def.parentStyle) {\r\n        ret |= this._hasClassSubDefault(key, subkey, false, def.parentStyle, themeDef);\r\n      }\r\n      ret |= this._hasClassSubDefault(key, subkey, false, \"base\", themeDef);\r\n      return ret;\r\n    }\r\n\r\n    if (!th) {\r\n      return false;\r\n    }\r\n\r\n    let obj = th[key];\r\n    if (!obj || typeof obj !== \"object\") {\r\n      return false;\r\n    }\r\n\r\n    return subkey in obj;\r\n  }\r\n\r\n  /** get a sub style from a theme style class.\r\n   *  note that if key is falsy then it just forwards to this.getDefault directly*/\r\n  getSubDefault(key, subkey, backupkey = subkey, defaultval = undefined, inherit = true) {\r\n    /* Check if client code manually overrode a theme key for this instance. */\r\n    if (subkey && subkey in this.my_default_overrides) {\r\n      //return this.getDefault(subkey, undefined, defaultval);\r\n    }\r\n\r\n    if (!key) {\r\n      return this.getDefault(subkey, undefined, defaultval, inherit);\r\n    }\r\n\r\n    let style = this.getDefault(key, undefined, undefined, inherit);\r\n\r\n    if (!style || typeof style !== \"object\" || !(subkey in style)) {\r\n      if (defaultval !== undefined) {\r\n        return defaultval;\r\n      } else if (backupkey) {\r\n        return this.getDefault(backupkey, undefined, undefined, inherit);\r\n      }\r\n    } else {\r\n      return style[subkey];\r\n    }\r\n  }\r\n\r\n  getDefault(key, checkForMobile = true, defaultval = undefined, inherit = true) {\r\n    let ret = this.getDefault_intern(key, checkForMobile, defaultval, inherit);\r\n\r\n    //convert pixel units straight to numbers\r\n    if (typeof ret === \"string\" && ret.trim().toLowerCase().endsWith(\"px\")) {\r\n      let s = ret.trim().toLowerCase();\r\n      s = s.slice(0, s.length - 2).trim();\r\n\r\n      let f = parseFloat(s);\r\n      if (!isNaN(f) && isFinite(f)) {\r\n        return f;\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  getDefault_intern(key, checkForMobile = true, defaultval = undefined, inherit = true) {\r\n    if (this.my_default_overrides[key] !== undefined) {\r\n      let v = this.my_default_overrides[key];\r\n      return checkForMobile ? this._doMobileDefault(key, v, this.my_default_overrides) : v;\r\n    }\r\n\r\n    let p = this;\r\n    while (p) {\r\n      if (p.default_overrides[key] !== undefined) {\r\n        let v = p.default_overrides[key];\r\n        checkForMobile ? this._doMobileDefault(key, v, p.default_overrides) : v;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    return this.getClassDefault(key, checkForMobile, defaultval, inherit);\r\n  }\r\n\r\n  getStyleClass() {\r\n    if (this._override_class !== undefined) {\r\n      return this._override_class;\r\n    }\r\n\r\n    let p = this.constructor, lastp = undefined;\r\n\r\n    while (p && p !== lastp && p !== UIBase && p !== Object) {\r\n      let def = p.define();\r\n\r\n      if (def.style) {\r\n        return def.style;\r\n      }\r\n\r\n      if (!p.prototype || !p.prototype.__proto__)\r\n        break;\r\n\r\n      p = p.prototype.__proto__.constructor;\r\n    }\r\n\r\n    return \"base\";\r\n  }\r\n\r\n  hasClassDefault(key) {\r\n    let style = this.getStyleClass();\r\n\r\n    let p = this;\r\n    while (p) {\r\n      let def = p.class_default_overrides[style];\r\n\r\n      if (def && (key in def)) {\r\n        return true;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    let th = this._themeOverride;\r\n\r\n    if (th && style in th && key in th[style]) {\r\n      return true;\r\n    }\r\n\r\n    if (style in theme && key in theme[style]) {\r\n      return true;\r\n    }\r\n\r\n    return key in theme.base;\r\n  }\r\n\r\n  getClassDefault(key, checkForMobile = true, defaultval = undefined, inherit = true) {\r\n    let style = this.getStyleClass();\r\n\r\n    if (style === \"none\") {\r\n      return undefined;\r\n    }\r\n\r\n    let themeobj;\r\n    let val;\r\n    let p = this;\r\n\r\n    while (p) {\r\n      let def = p.class_default_overrides[style];\r\n\r\n      if (def && (key in def)) {\r\n        themeobj = def;\r\n        val = def[key];\r\n        break;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    if (val === undefined && style in theme && !(key in theme[style]) && !(key in theme.base)) {\r\n      if (window.DEBUG.theme) {\r\n        report(\"Missing theme key \", key, \"for\", style);\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let th = !i ? this._themeOverride : theme;\r\n\r\n      if (!th) {\r\n        continue;\r\n      }\r\n\r\n      if (val === undefined && style in th && key in th[style]) {\r\n        themeobj = th[style];\r\n        val = th[style][key];\r\n      } else if (defaultval !== undefined) {\r\n        themeobj = undefined;\r\n        val = defaultval;\r\n      } else if (val === undefined && inherit) {\r\n        let def = this.constructor.define();\r\n\r\n        if (def.parentStyle && key in th[def.parentStyle]) {\r\n          val = th[def.parentStyle][key];\r\n          themeobj = th[def.parentStyle];\r\n        } else {\r\n          val = th.base[key];\r\n          themeobj = th.base;\r\n        }\r\n      }\r\n    }\r\n\r\n    return checkForMobile ? this._doMobileDefault(key, val, themeobj) : val;\r\n  }\r\n\r\n  overrideTheme(theme) {\r\n    this._themeOverride = theme;\r\n\r\n    this._forEachChildWidget((child) => {\r\n      child.overrideTheme(theme);\r\n    });\r\n\r\n    if (this.ctx) {\r\n      this.flushSetCSS();\r\n      this.flushUpdate();\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  getStyle() {\r\n    console.warn(\"deprecated call to UIBase.getStyle\");\r\n    return this.getStyleClass();\r\n  }\r\n\r\n  /** returns a new Animator instance\r\n   *\r\n   * example:\r\n   *\r\n   * container.animate().goto(\"style.width\", 500, 100, \"ease\");\r\n   * */\r\n  animate(_extra_handlers = {}) {\r\n    let transform = new DOMMatrix(this.style[\"transform\"]);\r\n\r\n    let update_trans = () => {\r\n      let t = transform;\r\n      let css = \"matrix(\" + t.a + \",\" + t.b + \",\" + t.c + \",\" + t.d + \",\" + t.e + \",\" + t.f + \")\";\r\n      this.style[\"transform\"] = css;\r\n    }\r\n\r\n    let handlers = {\r\n      background_get() {\r\n        return css2color(this.background);\r\n      },\r\n\r\n      background_set(c) {\r\n        if (typeof c !== \"string\") {\r\n          c = color2css(c);\r\n        }\r\n        this.background = c;\r\n      },\r\n\r\n      dx_get() {\r\n        return transform.m41;\r\n      },\r\n      dx_set(x) {\r\n        transform.m41 = x;\r\n        update_trans();\r\n      },\r\n\r\n      dy_get() {\r\n        return transform.m42;\r\n      },\r\n      dy_set(x) {\r\n        transform.m42 = x;\r\n        update_trans();\r\n      }\r\n    }\r\n\r\n    let pixkeys = [\"width\", \"height\", \"left\", \"top\", \"right\", \"bottom\", \"border-radius\",\r\n                   \"border-width\", \"margin\", \"padding\", \"margin-left\", \"margin-right\",\r\n                   \"margin-top\", \"margin-bottom\", \"padding-left\", \"padding-right\", \"padding-bottom\",\r\n                   \"padding-top\"];\r\n    handlers = Object.assign(handlers, _extra_handlers);\r\n\r\n    let makePixHandler = (k, k2) => {\r\n      handlers[k2 + \"_get\"] = () => {\r\n        let s = this.style[k];\r\n\r\n        if (s.endsWith(\"px\")) {\r\n          return parsepx(s);\r\n        } else {\r\n          return 0.0;\r\n        }\r\n      }\r\n\r\n      handlers[k2 + \"_set\"] = (val) => {\r\n        this.style[k] = val + \"px\";\r\n      }\r\n    }\r\n\r\n    for (let k of pixkeys) {\r\n      if (!(k in handlers)) {\r\n        makePixHandler(k, `style.${k}`);\r\n        makePixHandler(k, `style[\"${k}\"]`);\r\n        makePixHandler(k, `style['${k}']`);\r\n      }\r\n    }\r\n\r\n    let handler = {\r\n      get: (target, key, receiver) => {\r\n        console.log(key, handlers[key + \"_get\"], handlers);\r\n\r\n        if ((key + \"_get\") in handlers) {\r\n          return handlers[key + \"_get\"].call(target);\r\n        } else {\r\n          return target[key];\r\n        }\r\n      },\r\n      set: (target, key, val, receiver) => {\r\n        console.log(key);\r\n\r\n        if ((key + \"_set\") in handlers) {\r\n          handlers[key + \"_set\"].call(target, val);\r\n        } else {\r\n          target[key] = val;\r\n        }\r\n\r\n        return true;\r\n      }\r\n    }\r\n\r\n    let proxy = new Proxy(this, handler);\r\n    let anim = new Animator(proxy);\r\n\r\n    anim.onend = () => {\r\n      this._active_animations.remove(anim);\r\n    }\r\n\r\n    this._active_animations.push(anim);\r\n    return anim;\r\n  }\r\n\r\n  abortAnimations() {\r\n    for (let anim of util.list(this._active_animations)) {\r\n      anim.end();\r\n    }\r\n\r\n    this._active_animations = [];\r\n  }\r\n}\r\n\r\nexport function drawRoundBox2(elem, options = {}) {\r\n  drawRoundBox(elem, options.canvas, options.g, options.width, options.height, options.r, options.op, options.color, options.margin, options.no_clear);\r\n}\r\n\r\n/**okay, I need to refactor this function,\r\n it needs to take x, y as well as width, height,\r\n and be usable for more use cases.*/\r\nexport function drawRoundBox(elem, canvas, g, width, height, r      = undefined,\r\n                             op = \"fill\", color = undefined, margin = undefined,\r\n                             no_clear                               = false) {\r\n  width = width === undefined ? canvas.width : width;\r\n  height = height === undefined ? canvas.height : height;\r\n  g.save();\r\n\r\n  let dpi = elem.getDPI();\r\n\r\n  r = r === undefined ? elem.getDefault(\"border-radius\") : r;\r\n\r\n  if (margin === undefined) {\r\n    margin = 1;\r\n  }\r\n\r\n  r *= dpi;\r\n  let r1 = r, r2 = r;\r\n\r\n  if (r > (height - margin*2)*0.5) {\r\n    r1 = (height - margin*2)*0.5;\r\n  }\r\n\r\n  if (r > (width - margin*2)*0.5) {\r\n    r2 = (width - margin*2)*0.5;\r\n  }\r\n\r\n  let bg = color;\r\n\r\n  if (bg === undefined && canvas._background !== undefined) {\r\n    bg = canvas._background;\r\n  } else if (bg === undefined) {\r\n    bg = elem.getDefault(\"background-color\");\r\n  }\r\n\r\n  if (op === \"fill\" && !no_clear) {\r\n    g.clearRect(0, 0, width, height);\r\n  }\r\n\r\n  g.fillStyle = bg;\r\n  //hackish!\r\n  g.strokeStyle = color === undefined ? elem.getDefault(\"border-color\") : color;\r\n\r\n  let w = width, h = height;\r\n\r\n  let th = Math.PI/4;\r\n  let th2 = Math.PI*0.75;\r\n\r\n  g.beginPath();\r\n\r\n  g.moveTo(margin, margin + r1);\r\n  g.lineTo(margin, h - r1 - margin);\r\n\r\n  g.quadraticCurveTo(margin, h - margin, margin + r2, h - margin);\r\n  g.lineTo(w - margin - r2, h - margin);\r\n\r\n  g.quadraticCurveTo(w - margin, h - margin, w - margin, h - margin - r1);\r\n  g.lineTo(w - margin, margin + r1);\r\n\r\n  g.quadraticCurveTo(w - margin, margin, w - margin - r2, margin);\r\n  g.lineTo(margin + r2, margin);\r\n\r\n  g.quadraticCurveTo(margin, margin, margin, margin + r1);\r\n  g.closePath();\r\n\r\n  if (op === \"clip\") {\r\n    g.clip();\r\n  } else if (op === \"fill\") {\r\n    g.fill();\r\n  } else {\r\n    g.stroke();\r\n  }\r\n\r\n  g.restore();\r\n};\r\n\r\nexport function _getFont_new(elem, size, font = \"DefaultText\", do_dpi = true) {\r\n\r\n  font = elem.getDefault(font);\r\n\r\n  return font.genCSS(size);\r\n}\r\n\r\nexport function getFont(elem, size, font = \"DefaultText\", do_dpi = true) {\r\n  return _getFont_new(elem, size, font = \"DefaultText\", do_dpi = true);\r\n}\r\n\r\n//size is optional, defaults to font's default size\r\nexport function _getFont(elem, size, font = \"DefaultText\", do_dpi = true) {\r\n  let dpi = elem.getDPI();\r\n\r\n  let font2 = elem.getDefault(font);\r\n  if (font2 !== undefined) {\r\n    //console.warn(\"New style font detected\", font2, font2.genCSS(size));\r\n    return _getFont_new(elem, size, font, do_dpi);\r\n  }\r\n\r\n  throw new Error(\"unknown font \" + font);\r\n}\r\n\r\nexport function _ensureFont(elem, canvas, g, size) {\r\n  if (canvas.font) {\r\n    g.font = canvas.font;\r\n  } else {\r\n    let font = elem.getDefault(\"DefaultText\");\r\n    g.font = font.genCSS(size);\r\n  }\r\n}\r\n\r\nlet _mc;\r\n\r\nfunction get_measure_canvas() {\r\n  if (_mc !== undefined) {\r\n    return _mc;\r\n  }\r\n\r\n  _mc = document.createElement(\"canvas\");\r\n  _mc.width = 256;\r\n  _mc.height = 256;\r\n  _mc.g = _mc.getContext(\"2d\");\r\n\r\n  return _mc;\r\n}\r\n\r\nexport function measureTextBlock(elem, text, canvas                    = undefined,\r\n                                 g = undefined, size = undefined, font = undefined) {\r\n  let lines = text.split(\"\\n\");\r\n\r\n  let ret = {\r\n    width : 0,\r\n    height: 0\r\n  };\r\n\r\n  if (size === undefined) {\r\n    if (font !== undefined && typeof font === \"object\") {\r\n      size = font.size;\r\n    }\r\n\r\n    if (size === undefined) {\r\n      size = elem.getDefault(\"DefaultText\").size;\r\n    }\r\n  }\r\n\r\n  for (let line of lines) {\r\n    let m = measureText(elem, line, canvas, g, size, font);\r\n\r\n    ret.width = Math.max(ret.width, m.width);\r\n    let h = m.height !== undefined ? m.height : size*1.25;\r\n\r\n    ret.height += h;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nexport function measureText(elem, text, canvas                    = undefined,\r\n                            g = undefined, size = undefined, font = undefined) {\r\n  if (typeof canvas === \"object\" && canvas !== null && !(canvas instanceof HTMLCanvasElement) && canvas.tagName !== \"CANVAS\") {\r\n    let args = canvas;\r\n\r\n    canvas = args.canvas;\r\n    g = args.g;\r\n    size = args.size;\r\n    font = args.font;\r\n\r\n  }\r\n\r\n  if (g === undefined) {\r\n    canvas = get_measure_canvas();\r\n    g = canvas.g;\r\n  }\r\n\r\n  if (font !== undefined) {\r\n    if (typeof font === \"object\" && font instanceof CSSFont) {\r\n      font = font.genCSS(size);\r\n    }\r\n\r\n    g.font = font;\r\n  } else {\r\n    _ensureFont(elem, canvas, g, size);\r\n  }\r\n\r\n  let ret = g.measureText(text);\r\n\r\n  if (size !== undefined) {\r\n    //clear custom font for next time\r\n    g.font = undefined;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n//export function drawText(elem, x, y, text, canvas, g, color=undefined, size=undefined, font=undefined) {\r\nexport function drawText(elem, x, y, text, args = {}) {\r\n  let canvas = args.canvas, g = args.g, color = args.color, font = args.font;\r\n  let size = args.size;\r\n\r\n  if (size === undefined) {\r\n    if (font !== undefined && font instanceof CSSFont) {\r\n      size = font.size;\r\n    } else {\r\n      size = elem.getDefault(\"DefaultText\").size;\r\n    }\r\n  }\r\n\r\n  size *= UIBase.getDPI();\r\n\r\n\r\n  if (color === undefined) {\r\n    if (font && font.color) {\r\n      color = font.color;\r\n    } else {\r\n      color = elem.getDefault(\"DefaultText\").color;\r\n    }\r\n  }\r\n\r\n  if (font === undefined) {\r\n    _ensureFont(elem, canvas, g, size);\r\n  } else if (typeof font === \"object\" && font instanceof CSSFont) {\r\n    g.font = font = font.genCSS(size);\r\n  } else if (font) {\r\n    g.font = font;\r\n  }\r\n\r\n  if (typeof color === \"object\") {\r\n    color = color2css(color);\r\n  }\r\n\r\n\r\n  g.fillStyle = color;\r\n  g.fillText(text, x + 0.5, y + 0.5);\r\n\r\n  if (size !== undefined) {\r\n    //clear custom font for next time\r\n    g.font = undefined;\r\n  }\r\n}\r\n\r\nlet PIDX = 0, PSHADOW = 1, PTOT = 2;\r\n\r\n/**\r\n\r\n Saves UI layout data, like panel layouts, active tabs, etc.\r\n Uses the UIBase.prototype.[save/load]Data interface.\r\n\r\n Note that this is error-tolerant.\r\n */\r\nexport function saveUIData(node, key) {\r\n  if (key === undefined) {\r\n    throw new Error(\"ui_base.saveUIData(): key cannot be undefined\");\r\n  }\r\n\r\n  let paths = [];\r\n\r\n  let rec = (n, path, ni, is_shadow) => {\r\n    path = path.slice(0, path.length); //copy path\r\n\r\n    let pi = path.length;\r\n    for (let i = 0; i < PTOT; i++) {\r\n      path.push(undefined);\r\n    }\r\n\r\n    path[pi] = ni;\r\n    path[pi + 1] = is_shadow ? 1 : 0;\r\n\r\n    if (n instanceof UIBase) {\r\n      let path2 = path.slice(0, path.length);\r\n      let data = n.saveData();\r\n\r\n      let bad = !data;\r\n      bad = bad || (typeof data === \"object\" && Object.keys(data).length === 0);\r\n\r\n      if (!bad) {\r\n        path2.push(data);\r\n\r\n        if (path2[pi + 2]) {\r\n          paths.push(path2);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < n.childNodes.length; i++) {\r\n      let n2 = n.childNodes[i];\r\n\r\n      rec(n2, path, i, false);\r\n    }\r\n\r\n    let shadow = n.shadow;\r\n\r\n    if (!shadow)\r\n      return;\r\n\r\n    for (let i = 0; i < shadow.childNodes.length; i++) {\r\n      let n2 = shadow.childNodes[i];\r\n\r\n      rec(n2, path, i, true);\r\n    }\r\n  }\r\n\r\n  rec(node, [], 0, false);\r\n\r\n  return JSON.stringify({\r\n    key        : key,\r\n    paths      : paths,\r\n    _ui_version: 1\r\n  });\r\n}\r\n\r\nwindow._saveUIData = saveUIData;\r\n\r\nexport function loadUIData(node, buf) {\r\n  if (buf === undefined || buf === null) {\r\n    return;\r\n  }\r\n\r\n  let obj = JSON.parse(buf);\r\n  let key = buf.key;\r\n\r\n  for (let path of obj.paths) {\r\n    let n = node;\r\n\r\n    let data = path[path.length - 1];\r\n    path = path.slice(2, path.length - 1); //in case some api doesn't want me calling .pop()\r\n\r\n    for (let pi = 0; pi < path.length; pi += PTOT) {\r\n      let ni = path[pi], shadow = path[pi + 1];\r\n\r\n      let list;\r\n\r\n      if (shadow) {\r\n        list = n.shadow;\r\n\r\n        if (list) {\r\n          list = list.childNodes;\r\n        }\r\n      } else {\r\n        list = n.childNodes;\r\n      }\r\n\r\n      if (list === undefined || list[ni] === undefined) {\r\n        //console.log(\"failed to load a ui data block\", path);\r\n        n = undefined;\r\n        break;\r\n      }\r\n\r\n      n = list[ni];\r\n    }\r\n\r\n    if (n !== undefined && n instanceof UIBase) {\r\n      n._init(); //ensure init's been called, _init will check if it has\r\n      n.loadData(data);\r\n\r\n      //console.log(n, path, data);\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.PositionKey = \"fixed\";\r\n\r\nwindow._loadUIData = loadUIData;\r\n\r\n//avoid explicit circular references\r\naspect._setUIBase(UIBase);\r\n//ui_save.setUIBase(UIBase);\r\n","\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as simple_toolsys from '../path-controller/toolsys/toolsys.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport {DataPathError} from '../path-controller/controller/controller.js';\r\nimport {Vector3, Vector4, Quat, Matrix4} from '../path-controller/util/vectormath.js';\r\nimport cconst from '../config/const.js';\r\nimport {_themeUpdateKey, CSSFont} from \"../core/ui_base.js\";\r\n\r\nlet keymap = events.keymap;\r\n\r\nlet EnumProperty = toolprop.EnumProperty,\r\n    PropTypes    = toolprop.PropTypes;\r\n\r\nlet UIBase     = ui_base.UIBase,\r\n    PackFlags  = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nlet parsepx = ui_base.parsepx;\r\n\r\ncconst.DEBUG.buttonEvents = true;\r\n\r\nexport class ButtonEventBase extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._auto_depress = true;\r\n    this._highlight = false;\r\n    this._pressed = false;\r\n  }\r\n\r\n  bindEvents() {\r\n    let press_gen = 0;\r\n    let depress;\r\n\r\n    let press = (e) => {\r\n      e.stopPropagation();\r\n\r\n      if (!this.modalRunning) {\r\n        let this2 = this;\r\n\r\n        this.pushModal({\r\n          on_pointerdown(e) {\r\n            this.end(e);\r\n          },\r\n\r\n          on_pointerup(e) {\r\n            this.end(e);\r\n          },\r\n\r\n          on_pointercancel(e) {\r\n            console.warn(\"Pointer cancel in button\");\r\n            this2.popModal();\r\n          },\r\n\r\n          on_keydown(e) {\r\n            switch (e.keyCode) {\r\n              case keymap[\"Enter\"]:\r\n              case keymap[\"Escape\"]:\r\n              case keymap[\"Space\"]:\r\n                this.end();\r\n                break;\r\n            }\r\n          },\r\n\r\n          end(e) {\r\n            if (!this2.modalRunning) {\r\n              return;\r\n            }\r\n\r\n            this2.popModal();\r\n            depress(e);\r\n          }\r\n        }, undefined, e.pointerId);\r\n      }\r\n\r\n      if (cconst.DEBUG.buttonEvents) {\r\n        console.log(\"button press\", this._pressed, this.disabled, e.button);\r\n      }\r\n\r\n      if (this.disabled) return;\r\n\r\n      this._pressed = true;\r\n\r\n      if (this._onpress) {\r\n        this._onpress(this);\r\n      }\r\n\r\n      this._redraw();\r\n\r\n      e.preventDefault();\r\n    };\r\n\r\n    depress = (e) => {\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(\"button depress\", e.button, e.was_touch);\r\n\r\n      if (this._auto_depress) {\r\n        this._pressed = false;\r\n\r\n        if (this.disabled) return;\r\n\r\n        this._redraw();\r\n      }\r\n\r\n      if (e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        if (util.isMobile() || e.type === \"pointerup\" && e.button) {\r\n          return;\r\n        }\r\n      }\r\n\r\n      this._redraw();\r\n\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(\"button click callback:\", this.onclick, this._onpress, this.onpress);\r\n\r\n      if (this.onclick && e && e.pointerType !== \"mouse\") {\r\n        this.onclick(this);\r\n      }\r\n\r\n      this.undoBreakPoint();\r\n    }\r\n\r\n    this.addEventListener(\"click\", () => {\r\n      this._pressed = false;\r\n      this._highlight = false;\r\n      this._redraw();\r\n    });\r\n\r\n    this.addEventListener(\"pointerdown\", press, {captured: true, passive: false});\r\n    this.addEventListener(\"pointerup\", depress, {captured: true, passive: false});\r\n    this.addEventListener(\"pointerover\", (e) => {\r\n      if (this.disabled)\r\n        return;\r\n\r\n      this._highlight = true;\r\n      this._redraw();\r\n    })\r\n\r\n    this.addEventListener(\"pointerout\", (e) => {\r\n      if (this.disabled)\r\n        return;\r\n\r\n      this._highlight = false;\r\n      this._redraw();\r\n    })\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      if (this.disabled) return;\r\n\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(e.keyCode);\r\n\r\n      switch (e.keyCode) {\r\n        case 27: //escape\r\n          this.blur();\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          break;\r\n        case 32: //spacebar\r\n        case 13: //enter\r\n          this.click();\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          break;\r\n      }\r\n    });\r\n\r\n    this.addEventListener(\"focusin\", () => {\r\n      if (this.disabled) return;\r\n\r\n      this._focus = 1;\r\n      this._redraw();\r\n      this.focus();\r\n    });\r\n\r\n    this.addEventListener(\"blur\", () => {\r\n      if (this.disabled) return;\r\n\r\n      this._focus = 0;\r\n      this._redraw();\r\n    });\r\n  }\r\n\r\n  _redraw() {\r\n\r\n  }\r\n}\r\n\r\nexport class Button extends ButtonEventBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.label = document.createElement(\"span\");\r\n    this.label.innerText = \"button\";\r\n    this.shadow.appendChild(this.label);\r\n\r\n    this.label.style[\"pointer-events\"] = \"none\";\r\n\r\n    this._pressed = false;\r\n    this._highlight = false;\r\n    this._pressedTime = 0;\r\n    this._pressedTimeout = 100;\r\n\r\n    this._auto_depress = true;\r\n\r\n    this._last_name = undefined;\r\n    this._last_disabled = undefined;\r\n  }\r\n\r\n  get name() {\r\n    return \"\" + this.getAttribute(\"name\");\r\n  }\r\n\r\n  set name(val) {\r\n    this.setAttribute(\"name\", val);\r\n  }\r\n\r\n  get _pressed() {\r\n    return this.__pressed;\r\n  }\r\n\r\n  set _pressed(v) {\r\n    let changed = !v !== !this._pressed;\r\n\r\n    if (v) {\r\n      this._pressedTime = util.time_ms();\r\n    } else if (changed && util.time_ms() - this._pressedTime < this._pressedTimeout) {\r\n      window.setTimeout(() => {\r\n        this.setCSS();\r\n      }, this._pressedTimeout - (util.time_ms() - this._pressedTime) + 1);\r\n    }\r\n\r\n    this.__pressed = v;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"button-x\",\r\n      style  : \"button\"\r\n    };\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this.tabIndex = 0;\r\n\r\n    this.bindEvents();\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  on_enabled() {\r\n    this.setCSS();\r\n  }\r\n\r\n  on_disabled() {\r\n    this.setCSS();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    if (this.hasDefault(\"pressedTimeout\")) {\r\n      this._pressedTimeout = this.getDefault(\"pressedTimeout\");\r\n    }\r\n\r\n    let subkey = undefined;\r\n\r\n    let pressed = this._pressed;\r\n    if (!pressed && util.time_ms() - this._pressedTime < this._pressedTimeout) {\r\n      pressed = true;\r\n    }\r\n\r\n    if (this.disabled) {\r\n      subkey = \"disabled\";\r\n    } else if (pressed && this._highlight) {\r\n      subkey = \"highlight-pressed\";\r\n    } else if (pressed) {\r\n      subkey = \"pressed\";\r\n    } else if (this._highlight) {\r\n      subkey = \"highlight\";\r\n    }\r\n\r\n    let h = this.getDefault(\"height\");\r\n\r\n    this.setBoxCSS(subkey);\r\n\r\n    this.label.style[\"padding\"] = this.label.style[\"margin\"] = \"0px\";\r\n    this.style[\"background-color\"] = this.getSubDefault(subkey, \"background-color\");\r\n\r\n    let font = this.getSubDefault(subkey, \"DefaultText\");\r\n    this.label.style[\"font\"] = font.genCSS();\r\n    this.label.style[\"color\"] = font.color;\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"align-items\"] = \"center\";\r\n    this.style[\"width\"] = \"max-content\";\r\n    this.style[\"height\"] = h + \"px\";\r\n\r\n    this.style[\"user-select\"] = \"none\";\r\n    this.label.style[\"user-select\"] = \"none\";\r\n  }\r\n\r\n  click() {\r\n    if (this._onpress) {\r\n      let rect = this.getClientRects();\r\n      let x = rect.x + rect.width*0.5;\r\n      let y = rect.y + rect.height*0.5;\r\n\r\n      let e = {\r\n        x                : x, y: y, stopPropagation: () => {\r\n        }, preventDefault: () => {\r\n        }\r\n      };\r\n\r\n      this._onpress(e);\r\n    }\r\n\r\n    super.click();\r\n  }\r\n\r\n  _redraw() {\r\n    this.setCSS();\r\n  }\r\n\r\n  updateDisabled() {\r\n    if (this._last_disabled !== this.disabled) {\r\n      this._last_disabled = this.disabled;\r\n\r\n      //setTimeout(() => {\r\n\r\n      this._redraw();\r\n\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(\"disabled update!\", this.disabled, this.style[\"background-color\"]);\r\n      //}, 100);\r\n    }\r\n  }\r\n\r\n  update() {\r\n    if (this._last_name !== this.name) {\r\n      this.label.innerHTML = this.name;\r\n      this._last_name = this.name;\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.register(Button);\r\n\r\n//use .setAttribute(\"linear\") to disable nonlinear sliding\r\nexport class OldButton extends ButtonEventBase {\r\n  constructor() {\r\n    super();\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    this._last_but_update_key = \"\";\r\n\r\n    this._name = \"\";\r\n    this._namePad = undefined;\r\n    this._leftPad = 5; //extra pad before text\r\n    this._rightPad = 5; //extra pad after text\r\n\r\n    this._last_w = 0;\r\n    this._last_h = 0;\r\n\r\n    this._last_dpi = dpi;\r\n\r\n    this._lastw = undefined;\r\n    this._lasth = undefined;\r\n\r\n    this.dom = document.createElement(\"canvas\");\r\n    this.g = this.dom.getContext(\"2d\");\r\n\r\n    this.dom.setAttribute(\"class\", \"canvas1\");\r\n    this.dom.tabIndex = 0;\r\n\r\n    this._last_bg = undefined;\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      if (this.disabled) return;\r\n\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(e.keyCode);\r\n\r\n      switch (e.keyCode) {\r\n        case 27: //escape\r\n          this.blur();\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          break;\r\n        case 32: //spacebar\r\n        case 13: //enter\r\n          this.click();\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          break;\r\n      }\r\n    });\r\n\r\n    this.addEventListener(\"focusin\", () => {\r\n      if (this.disabled) return;\r\n\r\n      this._focus = 1;\r\n      this._redraw();\r\n      this.focus();\r\n    });\r\n\r\n    this.addEventListener(\"blur\", () => {\r\n      if (this.disabled) return;\r\n\r\n      this._focus = 0;\r\n      this._redraw();\r\n    });\r\n\r\n    this._last_disabled = false;\r\n    this._auto_depress = true;\r\n\r\n    this.shadow.appendChild(this.dom);\r\n  }\r\n\r\n  get r() {\r\n    return this.getDefault(\"border-radius\");\r\n  }\r\n\r\n  set r(val) {\r\n    this.overrideDefault(\"border-radius\", val);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"old-button-x\",\r\n      style  : \"button\"\r\n    };\r\n  }\r\n\r\n  click() {\r\n    if (this._onpress) {\r\n      let rect = this.getClientRects();\r\n      let x = rect.x + rect.width*0.5;\r\n      let y = rect.y + rect.height*0.5;\r\n\r\n      let e = {\r\n        x                : x, y: y, stopPropagation: () => {\r\n        }, preventDefault: () => {\r\n        }\r\n      };\r\n\r\n      this._onpress(e);\r\n    }\r\n\r\n    super.click();\r\n  }\r\n\r\n  init() {\r\n    let dpi = this.getDPI();\r\n\r\n    //set default dimensions\r\n    let width = ~~(this.getDefault(\"width\")*dpi);\r\n    let height = ~~(this.getDefault(\"height\")*dpi);\r\n\r\n    this.dom.width = width;\r\n    this.dom.height = height;\r\n\r\n    this.dom.style[\"width\"] = (width/dpi) + \"px\";\r\n    this.dom.style[\"height\"] = (height/dpi) + \"px\";\r\n    this.dom.style[\"padding\"] = this.dom.style[\"margin\"] = \"0px\";\r\n\r\n    this._name = undefined;\r\n    this.updateName();\r\n\r\n    this.bindEvents();\r\n    this._redraw();\r\n  }\r\n\r\n  setAttribute(key, val) {\r\n    super.setAttribute(key, val);\r\n\r\n    if (key === \"name\") {\r\n      this.updateName();\r\n      this.updateWidth();\r\n    }\r\n  }\r\n\r\n  old_bindEvents() {\r\n    let press_gen = 0;\r\n\r\n    let press = (e) => {\r\n      e.stopPropagation();\r\n\r\n      if (cconst.DEBUG.buttonEvents) {\r\n        console.log(\"button press\", this._pressed, this.disabled, e.button);\r\n      }\r\n\r\n      if (this.disabled) return;\r\n\r\n      this._pressed = true;\r\n\r\n      if (util.isMobile() && this.onclick && e.button === 0) {\r\n        this.onclick();\r\n      }\r\n\r\n      if (this._onpress) {\r\n        this._onpress(this);\r\n      }\r\n\r\n      this._redraw();\r\n\r\n      e.preventDefault();\r\n    };\r\n\r\n    let depress = (e) => {\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(\"button depress\", e.button, e.was_touch);\r\n\r\n      if (this._auto_depress) {\r\n        this._pressed = false;\r\n\r\n        if (this.disabled) return;\r\n\r\n        this._redraw();\r\n      }\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n\r\n      if (util.isMobile() || e.type === \"pointerup\" && e.button) {\r\n        return;\r\n      }\r\n\r\n      this._redraw();\r\n\r\n      if (cconst.DEBUG.buttonEvents) {\r\n        console.log(\"button click callback:\", this.onclick, this._onpress, this.onpress);\r\n      }\r\n\r\n      if (this.onclick && e.pointerType !== \"mouse\") {\r\n        this.onclick(this);\r\n      }\r\n\r\n      this.undoBreakPoint();\r\n    }\r\n\r\n    this.addEventListener(\"mousedown\", press, {captured: true, passive: false});\r\n    this.addEventListener(\"mouseup\", depress, {captured: true, passive: false});\r\n    this.addEventListener(\"mouseover\", (e) => {\r\n      if (this.disabled)\r\n        return;\r\n\r\n      this._highlight = true;\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    })\r\n\r\n    this.addEventListener(\"mouseout\", (e) => {\r\n      if (this.disabled)\r\n        return;\r\n\r\n      this._highlight = false;\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    })\r\n  }\r\n\r\n  updateDisabled() {\r\n    if (this._last_disabled !== this.disabled) {\r\n      this._last_disabled = this.disabled;\r\n\r\n      //setTimeout(() => {\r\n      this.dom._background = this.getDefault(\"background-color\");\r\n\r\n      this._repos_canvas();\r\n      this._redraw();\r\n\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(\"disabled update!\", this.disabled, this.style[\"background-color\"]);\r\n      //}, 100);\r\n    }\r\n  }\r\n\r\n  updateDefaultSize() {\r\n    const dpi = UIBase.getDPI();\r\n    let height = ~~(this.getDefault(\"height\")) + this.getDefault(\"padding\");\r\n    let size = this.getDefault(\"DefaultText\").size*1.33;\r\n\r\n    if (height === undefined || size === undefined || isNaN(height) || isNaN(size)) {\r\n      return;\r\n    }\r\n\r\n    height = ~~(Math.max(height, size)*dpi);\r\n    let cssHeight = (height/dpi) + \"px\";\r\n\r\n    if (cssHeight !== this.style[\"height\"]) {\r\n      this.style[\"height\"] = cssHeight;\r\n      this.dom.style[\"height\"] = cssHeight;\r\n      this.dom.height = height;\r\n\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _calcUpdateKey() {\r\n    return _themeUpdateKey;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.style[\"user-select\"] = \"none\";\r\n    this.dom.style[\"user-select\"] = \"none\";\r\n\r\n    this.updateDefaultSize();\r\n    this.updateWidth();\r\n    this.updateDPI();\r\n    this.updateName();\r\n    this.updateDisabled();\r\n\r\n    if (this.background !== this._last_bg) {\r\n      this._last_bg = this.background;\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n\r\n    let key = this._calcUpdateKey();\r\n    if (key !== this._last_but_update_key) {\r\n      this._last_but_update_key = key;\r\n\r\n      this.setCSS();\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.dom.style[\"margin\"] = this.getDefault(\"margin\", undefined, 0) + \"px\";\r\n    this.dom.style[\"margin-left\"] = this.getDefault(\"margin-left\", undefined, 0) + \"px\";\r\n    this.dom.style[\"margin-right\"] = this.getDefault(\"margin-right\", undefined, 0) + \"px\";\r\n    this.dom.style[\"margin-top\"] = this.getDefault(\"margin-top\", undefined, 0) + \"px\";\r\n    this.dom.style[\"margin-bottom\"] = this.getDefault(\"margin-bottom\", undefined, 0) + \"px\";\r\n\r\n    let name = this._name;\r\n    if (name === undefined) {\r\n      return;\r\n    }\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let pad = this.getDefault(\"padding\");\r\n    let ts = this.getDefault(\"DefaultText\").size;\r\n\r\n    let tw = ui_base.measureText(this, this._genLabel(), {\r\n      size: ts,\r\n      font: this.getDefault(\"DefaultText\")\r\n    }).width + 2.0*pad + this._leftPad + this._rightPad;\r\n\r\n    if (this._namePad !== undefined) {\r\n      tw += this._namePad;\r\n    }\r\n\r\n    let w = this.getDefault(\"width\");\r\n\r\n    w = Math.max(w, tw);\r\n    w = ~~w;\r\n    this.dom.style[\"width\"] = w + \"px\";\r\n    this.updateBorders();\r\n  }\r\n\r\n  updateBorders() {\r\n    let lwid = this.getDefault(\"border-width\");\r\n\r\n    if (lwid) {\r\n      this.dom.style[\"border-color\"] = this.getDefault(\"border-color\");\r\n      this.dom.style[\"border-width\"] = lwid + \"px\";\r\n      this.dom.style[\"border-style\"] = \"solid\";\r\n      this.dom.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n    } else {\r\n      this.dom.style[\"border-color\"] = \"none\";\r\n      this.dom.style[\"border-width\"] = \"0px\";\r\n      this.dom.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n    }\r\n\r\n  }\r\n\r\n  updateName() {\r\n    if (!this.hasAttribute(\"name\")) {\r\n      return;\r\n    }\r\n\r\n    let name = this.getAttribute(\"name\");\r\n\r\n    if (name !== this._name) {\r\n      this._name = name;\r\n\r\n      this.setCSS();\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  updateWidth(w_add = 0) {\r\n  }\r\n\r\n  _repos_canvas() {\r\n    let dpi = this.getDPI();\r\n\r\n    let w = parsepx(this.dom.style[\"width\"]);\r\n    let h = parsepx(this.dom.style[\"height\"]);\r\n\r\n    let w2 = ~~(w*dpi);\r\n    let h2 = ~~(h*dpi);\r\n\r\n    w = w2/dpi;\r\n    h = h2/dpi;\r\n\r\n    this.dom.width = w2;\r\n    this.dom.style[\"width\"] = w + \"px\";\r\n\r\n    this.dom.height = h2;\r\n    this.dom.style[\"height\"] = h + \"px\";\r\n  }\r\n\r\n  updateDPI() {\r\n    let dpi = this.getDPI();\r\n\r\n    if (this._last_dpi !== dpi) {\r\n      //console.log(\"update dpi\", dpi);\r\n\r\n      this._last_dpi = dpi;\r\n\r\n      this.g.font = undefined; //reset font\r\n\r\n      this.setCSS();\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n\r\n    if (this.style[\"background-color\"]) {\r\n      this.dom._background = this.style[\"background-color\"];\r\n      this.style[\"background-color\"] = \"\";\r\n    }\r\n\r\n    //console.log(\">\", this.dom.style[\"background-color\"], \"-----\");\r\n    //console.log(\"width:\", this.clientWidth)\r\n  }\r\n\r\n  _genLabel() {\r\n    return \"\" + this._name;\r\n  }\r\n\r\n  _getSubKey() {\r\n    if (this._pressed) {\r\n      return 'depressed';\r\n    } else if (this._highlight) {\r\n      return 'highlight';\r\n    } else {\r\n      return undefined; //make getSubDefault forward to getDefault\r\n    }\r\n  }\r\n\r\n  _redraw(draw_text = true) {\r\n    //console.log(\"button draw\");\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let subkey = this._getSubKey();\r\n\r\n    if (this._pressed && this._highlight) {\r\n      this.dom._background = this.getSubDefault(subkey, \"highlight-pressed\", \"BoxHighlight\");\r\n    } else if (this._pressed) {\r\n      this.dom._background = this.getSubDefault(subkey, \"pressed\", \"BoxDepressed\");\r\n    } else if (this._highlight) {\r\n      this.dom._background = this.getSubDefault(subkey, \"highlight\", \"BoxHighlight\");\r\n    } else {\r\n      this.dom._background = this.getSubDefault(subkey, \"background-color\", \"background-color\");\r\n    }\r\n\r\n    ui_base.drawRoundBox(this, this.dom, this.g);\r\n\r\n    //drawn with CSS now\r\n    /*\r\n    let lwid = this.getDefault(\"border-width\");\r\n    if (lwid) {\r\n      this.g.lineWidth = lwid*dpi;\r\n      ui_base.drawRoundBox(this, this.dom, this.g, undefined, undefined, undefined, \"stroke\");\r\n    }\r\n     */\r\n\r\n    this.updateBorders();\r\n\r\n    if (this._focus) {\r\n      let w = this.dom.width, h = this.dom.height;\r\n      let p = 1/dpi;\r\n\r\n      //XXX remove this.g.translate lines after refactoring drawRoundBox, see comment in ui_base.js\r\n      this.g.translate(p, p);\r\n      let lw = this.g.lineWidth;\r\n\r\n\r\n      this.g.lineWidth = this.getDefault(\"focus-border-width\", undefined, 1.0)*dpi;\r\n\r\n      ui_base.drawRoundBox(this, this.dom, this.g, w - p*2, h - p*2, this.r, \"stroke\", this.getDefault(\"BoxHighlight\"));\r\n\r\n      this.g.lineWidth = lw;\r\n      this.g.translate(-p, -p);\r\n    }\r\n\r\n    if (draw_text) {\r\n      this._draw_text();\r\n    }\r\n  }\r\n\r\n  _draw_text() {\r\n    let dpi = this.getDPI();\r\n\r\n    let subkey = this._getSubKey();\r\n\r\n    //if (util.isMobile()) {\r\n    //dpi = dpi; //visualViewport.scale;\r\n    //}\r\n\r\n    let font = this.getSubDefault(subkey, \"DefaultText\");\r\n\r\n    let pad = this.getDefault(\"padding\")*dpi;\r\n    let ts = font.size*dpi;\r\n\r\n    let text = this._genLabel();\r\n\r\n    //console.log(text, \"text\", this._name);\r\n\r\n    let w = this.dom.width, h = this.dom.height;\r\n\r\n    let tw = ui_base.measureText(this, text, undefined, undefined, ts, font).width;\r\n\r\n    let cx = pad*0.5 + this._leftPad*dpi;\r\n    let cy = ts + (h - ts)/3.0;\r\n\r\n    let g = this.g;\r\n\r\n    ui_base.drawText(this, ~~cx, ~~cy, text, {\r\n      canvas: this.dom,\r\n      g     : this.g,\r\n      size  : ts/dpi,\r\n      font  : font\r\n    });\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(OldButton);\r\n","\"use strict\";\r\n\r\nimport * as units from '../core/units.js';\r\nimport * as util from '../path-controller/util/util.js';\r\nimport {Vector2, Vector3, Vector4, Matrix4, Quat} from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nfunction myToFixed(s, n) {\r\n  s = s.toFixed(n);\r\n\r\n  while (s.endsWith('0')) {\r\n    s = s.slice(0, s.length - 1);\r\n  }\r\n  if (s.endsWith(\"\\.\")) {\r\n    s = s.slice(0, s.length - 1);\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nlet keymap = events.keymap;\r\n\r\nlet EnumProperty = toolprop.EnumProperty,\r\n    PropTypes    = toolprop.PropTypes;\r\n\r\nlet UIBase     = ui_base.UIBase,\r\n    PackFlags  = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nlet parsepx = ui_base.parsepx;\r\n\r\nimport {Button} from './ui_button.js';\r\nimport {_setTextboxClass} from '../core/ui_base.js';\r\n\r\nexport class TextBoxBase extends UIBase {\r\n  static define() {\r\n    return {\r\n      modalKeyEvents: true\r\n    }\r\n  }\r\n}\r\n\r\nexport class TextBox extends TextBoxBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._editing = false;\r\n\r\n    this._width = this.getDefault(\"width\") + \"px\";\r\n    this._textBoxEvents = true;\r\n\r\n    let margin = Math.ceil(3*this.getDPI());\r\n\r\n    this._had_error = false;\r\n\r\n    this.decimalPlaces = undefined; //will inherit from property defaults\r\n\r\n    this.baseUnit = undefined; //will automatically use defaults\r\n    this.displayUnit = undefined; //will automatically use defaults\r\n\r\n    this.dom = document.createElement(\"input\");\r\n\r\n    this.dom.tabIndex = 0;\r\n    this.dom.setAttribute(\"tabindex\", 0);\r\n    this.dom.setAttribute(\"tab-index\", 0);\r\n    this.dom.style[\"margin\"] = margin + \"px\";\r\n\r\n    this.dom.setAttribute(\"type\", \"textbox\");\r\n    this.dom.onchange = (e) => {\r\n      this._change(this.dom.value);\r\n    }\r\n\r\n    this.radix = 16;\r\n\r\n    this.dom.oninput = (e) => {\r\n      this._change(this.dom.value);\r\n    }\r\n\r\n    this.shadow.appendChild(this.dom);\r\n\r\n    this.dom.addEventListener(\"focus\", (e) => {\r\n      console.log(\"Textbox focus\", this.isModal);\r\n\r\n      this._focus = 1;\r\n\r\n      if (this.isModal) {\r\n        this._startModal();\r\n        this.setCSS();\r\n      }\r\n    });\r\n\r\n    this.dom.addEventListener(\"blur\", (e) => {\r\n      console.log(\"Textbox blur\");\r\n\r\n      this._focus = 0;\r\n\r\n      if (this._modal) {\r\n        this._endModal(true);\r\n        this.setCSS();\r\n      }\r\n    });\r\n\r\n  }\r\n\r\n  get startSelected() {\r\n    let b = (\"\" + this.getAttribute(\"start-selected\")).toLowerCase();\r\n\r\n    return b === \"yes\" || b === \"true\" || b === \"on\" || b === \"1\";\r\n  }\r\n\r\n  set startSelected(v) {\r\n    this.setAttribute(\"start-selected\", v ? \"true\" : \"false\");\r\n  }\r\n\r\n  /** realtime dom attribute getter, defaults to true in absence of attribute*/\r\n  get realtime() {\r\n    let ret = this.getAttribute(\"realtime\");\r\n\r\n    if (!ret) {\r\n      return true;\r\n    }\r\n\r\n    ret = ret.toLowerCase().trim();\r\n\r\n    return ret === 'yes' || ret === 'true' || ret === 'on';\r\n  }\r\n\r\n  set realtime(val) {\r\n    this.setAttribute('realtime', val ? 'true' : 'false');\r\n  }\r\n\r\n  get isModal() {\r\n    let ret = this.getAttribute(\"modal\");\r\n\r\n    if (!ret) {\r\n      return false;\r\n    }\r\n\r\n    ret = ret.toLowerCase().trim();\r\n\r\n    return ret === 'yes' || ret === 'true' || ret === 'on';\r\n  }\r\n\r\n  set isModal(val) {\r\n    this.setAttribute('modal', val ? 'true' : 'false');\r\n  }\r\n\r\n  _startModal() {\r\n    if (this.startSelected) {\r\n      this.select();\r\n    }\r\n\r\n    console.warn(\"textbox modal\");\r\n\r\n    if (this._modal) {\r\n      this._endModal(true);\r\n    }\r\n\r\n    this._editing = true;\r\n\r\n    let ignore = 0;\r\n\r\n    let finish = (ok) => {\r\n      this._endModal(ok);\r\n    }\r\n\r\n    let keydown = (e) => {\r\n      e.stopPropagation();\r\n\r\n      switch (e.keyCode) {\r\n        case keymap.Enter:\r\n          finish(true);\r\n          break;\r\n        case keymap.Escape:\r\n          finish(false);\r\n          break;\r\n      }\r\n\r\n      return;\r\n      if (ignore) return;\r\n\r\n      let e2 = new KeyboardEvent(e.type, e);\r\n\r\n      ignore = 1;\r\n      this.dom.dispatchEvent(e2);\r\n      ignore = 0;\r\n    };\r\n\r\n    this._modal = true;\r\n    this.pushModal({\r\n      on_mousemove: (e) => {\r\n        e.stopPropagation();\r\n      },\r\n\r\n      on_keydown : keydown,\r\n      on_keypress: keydown,\r\n      on_keyup   : keydown,\r\n\r\n      on_mousedown: (e) => {\r\n        e.stopPropagation();\r\n        console.log(\"mouse down\", e, e.x, e.y);\r\n      }\r\n    }, false)\r\n  }\r\n\r\n  _flash_focus() {\r\n    //don't focus on flash\r\n  }\r\n\r\n  get editing() {\r\n    return this._editing;\r\n  }\r\n\r\n  _endModal(ok) {\r\n    console.log(\"textbox end modal\");\r\n\r\n    this._editing = false;\r\n\r\n    this._modal = false;\r\n    this.popModal();\r\n\r\n    this.blur();\r\n\r\n    if (this.onend) {\r\n      this.onend(ok);\r\n    } else {\r\n      this._updatePathVal(this.dom.value);\r\n    }\r\n\r\n    this.blur();\r\n  }\r\n\r\n  get tabIndex() {\r\n    return this.dom.tabIndex;\r\n  }\r\n\r\n  set tabIndex(val) {\r\n    this.dom.tabIndex = val;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    //set isModal default\r\n    if (!this.hasAttribute('modal')) {\r\n      this.isModal = true;\r\n    }\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"width\"] = this._width;\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  set width(val) {\r\n    if (typeof val === \"number\") {\r\n      val += \"px\";\r\n    }\r\n\r\n    this._width = val;\r\n    this.style[\"width\"] = val;\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.overrideDefault(\"background-color\", this.getDefault(\"background-color\"));\r\n\r\n    this.background = this.getDefault(\"background-color\");\r\n    this.dom.style[\"margin\"] = this.dom.style[\"padding\"] = \"0px\";\r\n\r\n    if (this.getDefault(\"background-color\")) {\r\n      this.dom.style[\"background-color\"] = this.getDefault(\"background-color\");\r\n    }\r\n\r\n    this.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n    this.dom.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n\r\n    let bwid = this.getDefault(\"border-width\");\r\n    let bcolor = this.getDefault(\"border-color\");\r\n    let bstyle = this.getDefault(\"border-style\");\r\n    let border = `${bwid}px ${bstyle} ${bcolor}`\r\n\r\n    this.style[\"border\"] = border;\r\n    this.style[\"border-color\"] = bcolor;\r\n\r\n    if (this._focus) {\r\n      this.dom.style[\"border\"] = `2px dashed ${this.getDefault('focus-border-color')}`;\r\n    } else {\r\n      this.dom.style[\"border\"] = border;\r\n      this.dom.style[\"border-color\"] = bcolor;\r\n    }\r\n\r\n    if (this.style[\"font\"]) {\r\n      this.dom.style[\"font\"] = this.style[\"font\"];\r\n    } else {\r\n      this.dom.style[\"font\"] = this.getDefault(\"DefaultText\").genCSS();\r\n      this.dom.style[\"color\"] = this.getDefault(\"DefaultText\").color;\r\n    }\r\n\r\n    this.dom.style[\"width\"] = \"100%\";\r\n    this.dom.style[\"height\"] = \"100%\";\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.ctx || !this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n    if (this._focus || this._flashtimer !== undefined || (this._had_error && this._focus)) {\r\n      return;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n    if (val === undefined || val === null) {\r\n      this.internalDisabled = true;\r\n      return;\r\n    } else {\r\n      this.internalDisabled = false;\r\n    }\r\n\r\n\r\n    let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    let text = this.text;\r\n\r\n    if (!prop) {\r\n      console.error(\"datapath error \" + this.getAttribute(\"datapath\"), val);\r\n      return;\r\n    }\r\n\r\n    let is_num = prop.type & (PropTypes.FLOAT | PropTypes.INT);\r\n    if (typeof val === \"number\" && (prop.type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4 | PropTypes.QUAT))) {\r\n      is_num = true;\r\n    }\r\n\r\n    if (is_num) {\r\n      let is_int = prop.type === PropTypes.INT;\r\n\r\n      this.radix = prop.radix;\r\n\r\n      let decimalPlaces = this.decimalPlaces !== undefined ? this.decimalPlaces : prop.decimalPlaces;\r\n      if (this.hasAttribute(\"decimalPlaces\")) {\r\n        decimalPlaces = parseInt(this.getAttribute(\"decimalPlaces\"));\r\n      }\r\n\r\n      let baseUnit = this.baseUnit ?? prop.baseUnit;\r\n      if (this.hasAttribute(\"baseUnit\")) {\r\n        baseUnit = this.getAttribute(\"baseUnit\");\r\n      }\r\n\r\n      let displayUnit = this.displayUnit ?? prop.displayUnit;\r\n      if (this.hasAttribute(\"displayUnit\")) {\r\n        displayUnit = this.getAttribute(\"displayUnit\");\r\n      }\r\n\r\n      if (is_int && this.radix === 2) {\r\n        text = val.toString(this.radix);\r\n        text = \"0b\" + text;\r\n      } else if (is_int && this.radix === 16) {\r\n        text += \"h\";\r\n      } else {\r\n        text = units.buildString(val, baseUnit, decimalPlaces, displayUnit);\r\n      }\r\n    } else if (prop !== undefined && prop.type === PropTypes.STRING) {\r\n      text = val;\r\n    }\r\n\r\n    if (this.text !== text) {\r\n      this.text = text;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    if (this.dom.style[\"width\"] !== this.style[\"width\"]) {\r\n      this.dom.style[\"width\"] = this.style[\"width\"];\r\n    }\r\n    if (this.dom.style[\"height\"] !== this.style[\"height\"]) {\r\n      this.dom.style[\"height\"] = this.style[\"height\"];\r\n    }\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  select() {\r\n    this.dom.select();\r\n    //return this.dom.select.apply(this, arguments);\r\n  }\r\n\r\n  focus() {\r\n    return this.dom.focus();\r\n  }\r\n\r\n  blur() {\r\n    return this.dom.blur();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname       : \"textbox-x\",\r\n      style         : \"textbox\",\r\n      modalKeyEvents: true\r\n    };\r\n  }\r\n\r\n  get text() {\r\n    return this.dom.value;\r\n  }\r\n\r\n  set text(value) {\r\n    this.dom.value = value;\r\n  }\r\n\r\n  _prop_update(prop, text) {\r\n    let is_num = prop.type & (PropTypes.FLOAT | PropTypes.INT);\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (typeof val === \"number\" && (prop.type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4 | PropTypes.QUAT))) {\r\n      is_num = true;\r\n    }\r\n\r\n    if (is_num) {\r\n      let is_int = prop.type === PropTypes.INT;\r\n\r\n      this.radix = prop.radix;\r\n\r\n      let decimalPlaces = this.decimalPlaces !== undefined ? this.decimalPlaces : prop.decimalPlaces;\r\n      if (this.hasAttribute(\"decimalPlaces\")) {\r\n        decimalPlaces = parseInt(this.getAttribute(\"decimalPlaces\"));\r\n      }\r\n\r\n      let baseUnit = this.baseUnit ?? prop.baseUnit;\r\n      if (this.hasAttribute(\"baseUnit\")) {\r\n        baseUnit = this.getAttribute(\"baseUnit\");\r\n      }\r\n\r\n      let displayUnit = this.displayUnit ?? prop.displayUnit;\r\n      if (this.hasAttribute(\"displayUnit\")) {\r\n        displayUnit = this.getAttribute(\"displayUnit\");\r\n      }\r\n\r\n      if (!units.isNumber(text.trim())) {\r\n        this.flash(ui_base.ErrorColors.ERROR, this.dom, undefined, false);\r\n        this.focus();\r\n        this.dom.focus();\r\n        this._had_error = true;\r\n      } else {\r\n        let val = units.parseValue(text, baseUnit, displayUnit);\r\n\r\n        if (this._had_error) {\r\n          this.flash(ui_base.ErrorColors.OK, this.dom, undefined, false);\r\n        }\r\n\r\n        this._had_error = false;\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), val);\r\n      }\r\n    } else if (prop.type === PropTypes.STRING) {\r\n      try {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this.text);\r\n\r\n        if (this._had_error) {\r\n          this.flash(ui_base.ErrorColors.OK, this.dom, undefined, false);\r\n          this.dom.focus();\r\n        }\r\n\r\n        this._had_error = false;\r\n      } catch (error) {\r\n        console.log(error.stack);\r\n        console.log(error.message);\r\n        console.warn(\"textbox error!\");\r\n        //this._had_error = true;\r\n\r\n        this.flash(ui_base.ErrorColors.ERROR, this.dom, undefined, false);\r\n        this.dom.focus();\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  _updatePathVal(text) {\r\n    if (this.hasAttribute(\"datapath\") && this.ctx !== undefined) {\r\n      let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n      console.log(prop);\r\n\r\n      if (prop) {\r\n        this._prop_update(prop, text);\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  _change(text) {\r\n    if (this.realtime) {\r\n      this._updatePathVal(text);\r\n    }\r\n\r\n    if (this.onchange) {\r\n      this.onchange(text);\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(TextBox);\r\n\r\n/**\r\n\r\n Returns false if it's safe to call preventDefault.\r\n\r\n Returns true if the element at position x,y is\r\n either a textbox or is draggable.\r\n */\r\nexport function checkForTextBox(screen, x, y) {\r\n  let p = screen.pickElement(x, y);\r\n  //console.log(p, x, y);\r\n\r\n  while (p) {\r\n    //don't prevent draggable elements from dragging\r\n    if (p.draggable) {\r\n      return true;\r\n    }\r\n\r\n    if (p instanceof UIBase) {\r\n      //check immediate children of p\r\n      for (let i = 0; i < 2; i++) {\r\n        let nodes = i ? p.childNodes : p.shadow.childNodes;\r\n\r\n        for (let child of nodes) {\r\n          if (child.draggable) {\r\n            return true;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    let ok = p instanceof TextBoxBase;\r\n    ok = ok || p.constructor.define && p.constructor.define().modalKeyEvents;\r\n\r\n    if (ok) {\r\n      return true;\r\n    }\r\n\r\n    p = p.parentWidget ? p.parentWidget : p.parentNode;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nui_base._setTextboxClass(TextBox);\r\n","\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as toolsys from '../path-controller/toolsys/toolsys.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport {DataPathError} from '../path-controller/controller/controller.js';\r\nimport {Vector3, Vector4, Quat, Matrix4} from '../path-controller/util/vectormath.js';\r\nimport {isNumber, PropFlags} from \"../path-controller/toolsys/toolprop.js\";\r\nimport * as units from '../core/units.js';\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nfunction myToFixed(s, n) {\r\n  s = s.toFixed(n);\r\n\r\n  while (s.endsWith('0')) {\r\n    s = s.slice(0, s.length - 1);\r\n  }\r\n  if (s.endsWith(\"\\.\")) {\r\n    s = s.slice(0, s.length - 1);\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nlet keymap = events.keymap;\r\n\r\nlet EnumProperty = toolprop.EnumProperty,\r\n    PropTypes    = toolprop.PropTypes;\r\n\r\nlet UIBase     = ui_base.UIBase,\r\n    PackFlags  = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nlet parsepx = ui_base.parsepx;\r\n\r\nimport {Button, OldButton} from './ui_button.js';\r\nimport {eventWasTouch, popModalLight, pushModalLight} from '../path-controller/util/simple_events.js';\r\n\r\nexport {Button} from './ui_button.js';\r\n\r\nexport class IconLabel extends UIBase {\r\n  constructor() {\r\n    super();\r\n    this._icon = -1;\r\n    this.iconsheet = 1;\r\n  }\r\n\r\n  get icon() {\r\n    return this._icon;\r\n  }\r\n\r\n  set icon(id) {\r\n    this._icon = id;\r\n    this.setCSS();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"icon-label-x\"\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"margin\"] = this.style[\"padding\"] = \"0px\";\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  setCSS() {\r\n    let size = ui_base.iconmanager.getTileSize(this.iconsheet);\r\n\r\n\r\n    ui_base.iconmanager.setCSS(this.icon, this);\r\n\r\n    this.style[\"width\"] = size + \"px\";\r\n    this.style[\"height\"] = size + \"px\";\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(IconLabel);\r\n\r\nexport class ValueButtonBase extends OldButton {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(val) {\r\n    this._value = val;\r\n\r\n    if (this.ctx && this.hasAttribute(\"datapath\")) {\r\n      this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this._value);\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) return;\r\n    if (this.ctx === undefined) return;\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (val === undefined) {\r\n      let redraw = !this.disabled;\r\n\r\n      this.internalDisabled = true;\r\n\r\n      if (redraw) this._redraw();\r\n\r\n      return;\r\n    } else {\r\n      let redraw = this.disabled;\r\n\r\n      this.internalDisabled = false;\r\n      if (redraw) this._redraw();\r\n    }\r\n\r\n    if (val !== this._value) {\r\n      this._value = val;\r\n      this.updateWidth();\r\n      this._repos_canvas();\r\n      this._redraw();\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    this.updateDataPath();\r\n\r\n    super.update();\r\n  }\r\n}\r\n\r\nexport class Check extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._checked = false;\r\n    this._highlight = false;\r\n    this._focus = false;\r\n\r\n    let shadow = this.shadow;\r\n\r\n    //let form = document.createElement(\"form\");\r\n\r\n    let span = document.createElement(\"span\");\r\n    span.setAttribute(\"class\", \"checkx\");\r\n\r\n    span.style[\"display\"] = \"flex\";\r\n    span.style[\"flex-direction\"] = \"row\";\r\n    span.style[\"margin\"] = span.style[\"padding\"] = \"0px\";\r\n    //span.style[\"background\"] = ui_base.iconmanager.getCSS(1);\r\n\r\n    let sheet = 0;\r\n    let size = ui_base.iconmanager.getTileSize(0);\r\n\r\n    let check = this.canvas = document.createElement(\"canvas\");\r\n    this.g = check.getContext(\"2d\");\r\n\r\n    check.setAttribute(\"id\", check._id);\r\n    check.setAttribute(\"name\", check._id);\r\n\r\n    let mdown = (e) => {\r\n      this._highlight = false;\r\n      this.checked = !this.checked;\r\n    };\r\n\r\n    let mup = (e) => {\r\n      this._highlight = false;\r\n      this.blur();\r\n      this._redraw();\r\n    };\r\n\r\n    let mover = (e) => {\r\n      this._highlight = true;\r\n      this._redraw();\r\n    };\r\n\r\n    let mleave = (e) => {\r\n      this._highlight = false;\r\n      this._redraw();\r\n    };\r\n\r\n    span.addEventListener(\"pointerover\", mover, {passive: true});\r\n    span.addEventListener(\"mousein\", mover, {passive: true});\r\n    span.addEventListener(\"mouseleave\", mleave, {passive: true});\r\n    span.addEventListener(\"pointerout\", mleave, {passive: true});\r\n\r\n    this.addEventListener(\"blur\", (e) => {\r\n      this._highlight = this._focus = false;\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"focusin\", (e) => {\r\n      this._focus = true;\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"focus\", (e) => {\r\n      this._focus = true;\r\n      this._redraw();\r\n    });\r\n\r\n\r\n    span.addEventListener(\"pointerdown\", mdown, {passive: true});\r\n    span.addEventListener(\"pointerup\", mup, {passive: true});\r\n    span.addEventListener(\"pointercancel\", mup, {passive: true});\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Escape\"]:\r\n          this._highlight = undefined;\r\n          this._redraw();\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n\r\n          this.blur();\r\n          break;\r\n        case keymap[\"Enter\"]:\r\n        case keymap[\"Space\"]:\r\n          this.checked = !this.checked;\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          break;\r\n      }\r\n    });\r\n    this.checkbox = check;\r\n\r\n    span.appendChild(check);\r\n\r\n    let label = this._label = document.createElement(\"label\");\r\n    label.setAttribute(\"class\", \"checkx\");\r\n    span.setAttribute(\"class\", \"checkx\");\r\n    label.style[\"align-self\"] = \"center\";\r\n\r\n    let side = this.getDefault(\"CheckSide\");\r\n    if (side === \"right\") {\r\n      span.prepend(label);\r\n    } else {\r\n      span.appendChild(label);\r\n    }\r\n\r\n    shadow.appendChild(span);\r\n  }\r\n\r\n  get internalDisabled() {\r\n    return super.internalDisabled;\r\n  }\r\n\r\n  set internalDisabled(val) {\r\n    if (!!this.internalDisabled === !!val) {\r\n      return;\r\n    }\r\n\r\n    super.internalDisabled = val;\r\n    this._redraw();\r\n  }\r\n\r\n  get value() {\r\n    return this.checked;\r\n  }\r\n\r\n  set value(v) {\r\n    this.checked = v;\r\n  }\r\n\r\n  get checked() {\r\n    return this._checked;\r\n  }\r\n\r\n  set checked(v) {\r\n    v = !!v;\r\n\r\n    if (this._checked !== v) {\r\n      this._checked = v;\r\n\r\n      this.setCSS();\r\n\r\n      //this.dom.checked = v;\r\n      this._redraw();\r\n\r\n      if (this.onclick) {\r\n        this.onclick(v);\r\n      }\r\n      if (this.onchange) {\r\n        this.onchange(v);\r\n      }\r\n\r\n      if (this.hasAttribute(\"datapath\")) {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this._checked);\r\n      }\r\n    }\r\n  }\r\n\r\n  get label() {\r\n    return this._label.textContent;\r\n  }\r\n\r\n  set label(l) {\r\n    this._label.textContent = l;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname    : \"check-x\",\r\n      style      : \"checkbox\",\r\n      parentStyle: \"button\"\r\n    };\r\n  }\r\n\r\n  init() {\r\n    this.tabIndex = 1;\r\n    this.setAttribute(\"class\", \"checkx\");\r\n\r\n\r\n    let style = document.createElement(\"style\");\r\n    //let style = this.cssStyleTag();\r\n\r\n    let color = this.getDefault(\"focus-border-color\");\r\n\r\n    style.textContent = `\r\n      .checkx:focus {\r\n        outline : none;\r\n      }\r\n    `;\r\n\r\n    //document.body.prepend(style);\r\n    this.prepend(style);\r\n  }\r\n\r\n  setCSS() {\r\n    this._label.style[\"font\"] = this.getDefault(\"DefaultText\").genCSS();\r\n    this._label.style[\"color\"] = this.getDefault(\"DefaultText\").color;\r\n\r\n    this._label.style['font'] = 'normal 14px poppins'; // TODO - Jordan - add to settings\r\n\r\n    super.setCSS();\r\n\r\n    //force clear background\r\n    this.style[\"background-color\"] = \"rgba(0,0,0,0)\";\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.getAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    let redraw = false;\r\n\r\n    if (val === undefined) {\r\n      this.internalDisabled = true;\r\n      return;\r\n    } else {\r\n      redraw = this.internalDisabled;\r\n\r\n      this.internalDisabled = false;\r\n    }\r\n\r\n    val = !!val;\r\n\r\n    redraw = redraw || !!this._checked !== !!val;\r\n\r\n    if (redraw) {\r\n      this._checked = val;\r\n      this._repos_canvas();\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _repos_canvas() {\r\n  }\r\n\r\n  _redraw() {\r\n    if (this.canvas === undefined) {\r\n      //flag update\r\n      this._updatekey = \"\";\r\n      return;\r\n    }\r\n\r\n    let canvas = this.canvas, g = this.g;\r\n    let dpi = UIBase.getDPI();\r\n    let tilesize = ui_base.iconmanager.getTileSize(0);\r\n    let pad = this.getDefault(\"padding\");\r\n\r\n    let csize = tilesize + pad*2;\r\n\r\n    canvas.style[\"margin\"] = \"2px\";\r\n    canvas.style[\"width\"] = csize + \"px\";\r\n    canvas.style[\"height\"] = csize + \"px\";\r\n\r\n    csize = ~~(csize*dpi + 0.5);\r\n    tilesize = ~~(tilesize*dpi + 0.5);\r\n\r\n    canvas.width = csize;\r\n    canvas.height = csize;\r\n\r\n    g.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    g.beginPath();\r\n    g.rect(0, 0, canvas.width, canvas.height);\r\n    g.fill();\r\n\r\n    let color;\r\n\r\n    if (!this._checked && this._highlight) {\r\n      color = this.getDefault(\"BoxHighlight\");\r\n    }\r\n\r\n    ui_base.drawRoundBox(this, canvas, g, undefined, undefined, undefined, undefined, color);\r\n    if (this._checked) {\r\n      //canvasDraw(elem, canvas, g, icon, x=0, y=0, sheet=0) {\r\n      let x = (csize - tilesize)*0.5, y = (csize - tilesize)*0.5;\r\n      ui_base.iconmanager.canvasDraw(this, canvas, g, ui_base.Icons.LARGE_CHECK, x, y);\r\n    }\r\n\r\n    if (this._focus) {\r\n      color = this.getDefault(\"focus-border-color\");\r\n      g.lineWidth *= dpi;\r\n      ui_base.drawRoundBox(this, canvas, g, undefined, undefined, undefined, \"stroke\", color);\r\n    }\r\n  }\r\n\r\n  updateDPI() {\r\n    let dpi = UIBase.getDPI();\r\n\r\n    if (dpi !== this._last_dpi) {\r\n      this._last_dpi = dpi;\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateDPI();\r\n\r\n    let ready = ui_base.getIconManager().isReady(0);\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n\r\n    let updatekey = this.getDefault(\"DefaultText\").hash();\r\n    updatekey += this._checked + \":\" + this._label.textContent;\r\n    updatekey += \":\" + ready;\r\n\r\n    if (updatekey !== this._updatekey) {\r\n      this._repos_canvas();\r\n      this.setCSS();\r\n\r\n      this._updatekey = updatekey;\r\n      this._redraw();\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(Check);\r\n\r\nexport class IconButton extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._customIcon = undefined;\r\n\r\n    this._pressed = false;\r\n    this._highlight = false;\r\n    this._draw_pressed = true;\r\n\r\n    this._icon = -1;\r\n    this._icon_pressed = undefined;\r\n    this.iconsheet = 0;\r\n    this.drawButtonBG = true;\r\n\r\n    this._extraIcon = undefined; //draw another icon on top\r\n\r\n    this.extraDom = undefined;\r\n\r\n    //have to put icon in subdiv\r\n    this.dom = document.createElement(\"div\");\r\n    this.shadow.appendChild(this.dom);\r\n\r\n    this._last_iconsheet = undefined;\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Enter\"]:\r\n        case keymap[\"Space\"]:\r\n          this.click();\r\n          break;\r\n      }\r\n    });\r\n  }\r\n\r\n  click() {\r\n    if (this._onpress) {\r\n      let rect = this.getClientRects();\r\n      let x = rect.x + rect.width*0.5;\r\n      let y = rect.y + rect.height*0.5;\r\n\r\n      let e = {x : x, y : y, stopPropagation : () => {}, preventDefault : () => {}};\r\n\r\n      this._onpress(e);\r\n    }\r\n\r\n    super.click();\r\n  }\r\n\r\n  get customIcon() {\r\n    return this._customIcon;\r\n  }\r\n\r\n  set customIcon(domImage) {\r\n    this._customIcon = domImage;\r\n    this.setCSS();\r\n  }\r\n\r\n  get icon() {\r\n    return this._icon;\r\n  }\r\n\r\n  set icon(val) {\r\n    this._icon = val;\r\n    this.setCSS();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"iconbutton-x\",\r\n      style  : \"iconbutton\"\r\n    };\r\n  }\r\n\r\n  _on_press() {\r\n    this._pressed = true;\r\n    this.setCSS();\r\n  }\r\n\r\n  _on_depress() {\r\n    this._pressed = false;\r\n    this.setCSS();\r\n  }\r\n\r\n  updateDefaultSize() {\r\n\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    let def;\r\n    let pstyle = this.getDefault(\"depressed\");\r\n    let hstyle = this.getDefault(\"highlight\");\r\n\r\n    this.noMarginsOrPadding();\r\n\r\n    if (this._pressed && this._draw_pressed) {\r\n      def = k => this.getSubDefault(\"depressed\", k);\r\n    } else if (this._highlight) {\r\n      def = k => this.getSubDefault(\"highlight\", k);\r\n    } else {\r\n      def = k => this.getDefault(k);\r\n    }\r\n\r\n    let loadstyle = (key, addpx) => {\r\n      let val = def(key);\r\n      if (addpx) {\r\n        val = (\"\" + val).trim();\r\n\r\n        if (!val.toLowerCase().endsWith(\"px\")) {\r\n          val += \"px\";\r\n        }\r\n      }\r\n\r\n      this.style[key] = val;\r\n    }\r\n\r\n    let keys = [\"margin\", \"padding\", \"margin-left\", \"margin-right\", \"margin-top\", \"margin-botton\",\r\n                \"padding-left\", \"padding-bottom\", \"padding-top\", \"padding-right\",\r\n                \"border-radius\"]\r\n\r\n    for (let k of keys) {\r\n      loadstyle(k, true);\r\n    }\r\n    loadstyle(\"background-color\", false);\r\n    loadstyle(\"color\", false);\r\n\r\n    let border = `${def(\"border-width\", true)} ${def(\"border-style\", false)} ${def(\"border-color\", false)}`\r\n    this.style[\"border\"] = border;\r\n\r\n    let w = this.getDefault(\"width\");\r\n\r\n    let size = ui_base.iconmanager.getTileSize(this.iconsheet);\r\n    w = size;\r\n\r\n    this.style[\"width\"] = w + \"px\";\r\n    this.style[\"height\"] = w + \"px\";\r\n\r\n    this.dom.style[\"width\"] = w + \"px\";\r\n    this.dom.style[\"height\"] = w + \"px\";\r\n    this.dom.style[\"margin\"] = this.dom.style[\"padding\"] = \"0px\";\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"align-items\"] = \"center\";\r\n\r\n    if (this._customIcon) {\r\n      this.dom.style[\"background-image\"] = `url(\"${this._customIcon.src}\")`\r\n      this.dom.style[\"background-size\"] = \"contain\";\r\n      this.dom.style[\"background-repeat\"] = \"no-repeat\";\r\n    } else {\r\n      let icon = this.icon;\r\n\r\n      if (this._pressed && this._icon_pressed !== undefined) {\r\n        icon = this._icon_pressed;\r\n      }\r\n\r\n      ui_base.iconmanager.setCSS(icon, this.dom, this.iconsheet);\r\n    }\r\n\r\n    if (this._extraIcon !== undefined) {\r\n      let dom;\r\n\r\n      if (!this.extraDom) {\r\n        this.extraDom = dom = document.createElement(\"div\");\r\n\r\n        this.shadow.appendChild(dom);\r\n      } else {\r\n        dom = this.extraDom;\r\n      }\r\n\r\n      dom.style[\"position\"] = \"absolute\";\r\n      dom.style[\"margin\"] = dom.style[\"padding\"] = \"0px\";\r\n      dom.style[\"pointer-events\"] = \"none\";\r\n      dom.style[\"width\"] = size + \"px\";\r\n      dom.style[\"height\"] = size + \"px\";\r\n\r\n      ui_base.iconmanager.setCSS(this._extraIcon, dom, this.iconsheet);\r\n    } else if (this.extraDom) {\r\n      this.extraDom.remove();\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    let press = (e) => {\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n\r\n      if (this.modalRunning) {\r\n        this.popModal();\r\n      }\r\n\r\n      if (!eventWasTouch(e) && e.button !== 0) {\r\n        return;\r\n      }\r\n\r\n      if (1) { //!eventWasTouch(e)) {\r\n        let this2 = this;\r\n\r\n        this.pushModal({\r\n          on_mouseup(e) {\r\n            //touch events aren't fireing onclick automatically the way mouse ones are\r\n\r\n            if (this2.onclick && eventWasTouch(e)) {\r\n              this2.onclick();\r\n            }\r\n            this.end();\r\n          },\r\n          on_touchcancel(e) {\r\n            this.on_mouseup(e);\r\n            this.end();\r\n          },\r\n          on_touchend(e) {\r\n            this.on_mouseup(e);\r\n            this.end();\r\n          },\r\n          on_keydown(e) {\r\n            this.end();\r\n          },\r\n          end() {\r\n            if (this2.modalRunning) {\r\n              this2.popModal();\r\n              this2._on_depress(e)\r\n              this2.setCSS();\r\n            }\r\n          }\r\n        });\r\n      }\r\n\r\n      this._on_press(e);\r\n    }\r\n\r\n    let depress = (e) => {\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n\r\n      this._on_depress();\r\n      this.setCSS();\r\n    }\r\n\r\n    let high = (e) => {\r\n      this._highlight = true;\r\n      this.setCSS();\r\n    }\r\n\r\n    let unhigh = (e) => {\r\n      this._highlight = false;\r\n      this.setCSS();\r\n    }\r\n\r\n    this.tabIndex = 0;\r\n\r\n    this.addEventListener(\"mouseover\", high);\r\n    this.addEventListener(\"mouseexit\", unhigh);\r\n    this.addEventListener(\"mouseleave\", unhigh);\r\n    this.addEventListener(\"focus\", high);\r\n    this.addEventListener(\"blur\", unhigh);\r\n\r\n    this.addEventListener(\"mousedown\", press, {capture: true});\r\n    this.addEventListener(\"mouseup\", depress, {capture: true});\r\n    //this.addEventListener(\"touchstart\", press, {capture: true});\r\n    //this.addEventListener(\"touchcancel\", depress, {capture: true});\r\n    //this.addEventListener(\"touchend\", depress, {capture: true});\r\n    this.setCSS();\r\n\r\n    this.dom.style[\"pointer-events\"] = \"none\";\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    if (this.iconsheet !== this._last_iconsheet) {\r\n      this.setCSS();\r\n      this._last_iconsheet = this.iconsheet;\r\n    }\r\n  }\r\n\r\n  _getsize() {\r\n    let margin = this.getDefault(\"padding\");\r\n\r\n    return ui_base.iconmanager.getTileSize(this.iconsheet) + margin*2;\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(IconButton);\r\n\r\n\r\nexport class IconCheck extends IconButton {\r\n  constructor() {\r\n    super();\r\n\r\n    this._checked = undefined;\r\n    this._drawCheck = undefined;\r\n  }\r\n\r\n  get drawCheck() {\r\n    let ret = this._drawCheck;\r\n\r\n    ret = ret === undefined ? this.getDefault(\"drawCheck\") : ret;\r\n    ret = ret === undefined ? true : ret;\r\n\r\n    return ret;\r\n  }\r\n\r\n  set drawCheck(val) {\r\n    val = !!val;\r\n\r\n    if (val && (this.packflag & PackFlags.HIDE_CHECK_MARKS)) {\r\n      this.packflag &= ~PackFlags.HIDE_CHECK_MARKS;\r\n    }\r\n\r\n    let old = !!this.drawCheck;\r\n    this._drawCheck = val;\r\n\r\n    if (val !== old) {\r\n      this.updateDrawCheck();\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  click() {\r\n    super.click();\r\n    this.checked ^= true;\r\n  }\r\n\r\n  get icon() {\r\n    return this._icon;\r\n  }\r\n\r\n  set icon(val) {\r\n    this._icon = val;\r\n    this.setCSS();\r\n  }\r\n\r\n  get checked() {\r\n    return this._checked;\r\n  }\r\n\r\n  set checked(val) {\r\n    if (!!val !== !!this._checked) {\r\n      this._checked = val\r\n      this._updatePressed(!!val);\r\n      this.setCSS();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(val);\r\n      }\r\n    }\r\n  }\r\n\r\n  get noEmboss() {\r\n    let ret = this.getAttribute(\"no-emboss\");\r\n\r\n    if (!ret) {\r\n      return false;\r\n    }\r\n\r\n    ret = ret.toLowerCase().trim();\r\n\r\n    return ret === 'true' || ret === 'yes' || ret === 'on';\r\n  }\r\n\r\n  set noEmboss(val) {\r\n    this.setAttribute('no-emboss', val ? 'true' : 'false');\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname    : \"iconcheck-x\",\r\n      style      : \"iconcheck\",\r\n      parentStyle: \"iconbutton\"\r\n    };\r\n  }\r\n\r\n  _updatePressed(val) {\r\n    //don't set _pressed if we have a custom icon for press state\r\n    if (this._icon_pressed) {\r\n      this._draw_pressed = false;\r\n    }\r\n\r\n    this._pressed = val;\r\n    this.setCSS();\r\n  }\r\n\r\n  _on_depress() {\r\n    return;\r\n  }\r\n\r\n  _on_press() {\r\n    this.checked ^= true;\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), !!this.checked);\r\n    }\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  updateDefaultSize() {\r\n\r\n  }\r\n\r\n  _calcUpdateKey() {\r\n    return super._calcUpdateKey() + \":\" + this._icon;\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\") || !this.ctx) {\r\n      return;\r\n    }\r\n\r\n    if (this._icon < 0) {\r\n      let rdef;\r\n      try {\r\n        rdef = this.ctx.api.resolvePath(this.ctx, this.getAttribute(\"datapath\"));\r\n      } catch (error) {\r\n        if (error instanceof DataPathError) {\r\n          return;\r\n        } else {\r\n          throw error;\r\n        }\r\n      }\r\n\r\n      if (rdef !== undefined && rdef.prop) {\r\n        let icon, icon2, title;\r\n\r\n        if (rdef.prop.flag & PropFlags.NO_UNDO) {\r\n          this.setUndo(false);\r\n        } else {\r\n          this.setUndo(true);\r\n        }\r\n\r\n        //console.log(\"SUBKEY\", rdef.subkey, rdef.prop.iconmap);\r\n\r\n        if (rdef.subkey && (rdef.prop.type === PropTypes.FLAG || rdef.prop.type === PropTypes.ENUM)) {\r\n          icon = rdef.prop.iconmap[rdef.subkey];\r\n          icon2 = rdef.prop.iconmap2[rdef.subkey];\r\n          title = rdef.prop.descriptions[rdef.subkey];\r\n\r\n          if (!title && rdef.subkey.length > 0) {\r\n            title = rdef.subkey;\r\n            title = title[0].toUpperCase() + title.slice(1, title.length).toLowerCase();\r\n          }\r\n        } else {\r\n          icon2 = rdef.prop.icon2;\r\n          icon = rdef.prop.icon;\r\n          title = rdef.prop.description;\r\n        }\r\n\r\n        if (icon2 !== undefined && icon2 !== -1) {\r\n          this._icon_pressed = icon;\r\n          icon = icon2;\r\n        }\r\n\r\n        if (icon !== undefined && icon !== this.icon)\r\n          this.icon = icon;\r\n        if (title)\r\n          this.description = title;\r\n      }\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (val === undefined) {\r\n      this.internalDisabled = true;\r\n      return;\r\n    } else {\r\n      this.internalDisabled = false;\r\n    }\r\n\r\n    val = !!val;\r\n\r\n    if (val !== !!this._checked) {\r\n      this._checked = val;\r\n      this._updatePressed(!!val);\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  updateDrawCheck() {\r\n    if (this.drawCheck) {\r\n      this._extraIcon = this._checked ? ui_base.Icons.ENUM_CHECKED : ui_base.Icons.ENUM_UNCHECKED;\r\n    } else {\r\n      this._extraIcon = undefined;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    if (this.packflag & PackFlags.HIDE_CHECK_MARKS) {\r\n      this.drawCheck = false;\r\n    }\r\n\r\n    this.updateDrawCheck();\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n\r\n    super.update();\r\n  }\r\n\r\n  _getsize() {\r\n    let margin = this.getDefault(\"padding\");\r\n    return ui_base.iconmanager.getTileSize(this.iconsheet) + margin*2;\r\n  }\r\n\r\n  setCSS() {\r\n    this.updateDrawCheck();\r\n    super.setCSS();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(IconCheck);\r\n\r\nexport class Check1 extends Button {\r\n  constructor() {\r\n    super();\r\n\r\n    this._namePad = 40;\r\n    this._value = undefined;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname    : \"check1-x\",\r\n      parentStyle: \"button\"\r\n    };\r\n  }\r\n\r\n  _redraw() {\r\n    //console.log(\"button draw\");\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let box = 40;\r\n    ui_base.drawRoundBox(this, this.dom, this.g, box);\r\n\r\n    let ts = this.getDefault(\"DefaultText\").size;\r\n\r\n    let text = this._genLabel();\r\n\r\n    //console.log(text, \"text\", this._name);\r\n\r\n    let tw = ui_base.measureText(this, text, this.dom, this.g).width;\r\n    let cx = this.dom.width/2 - tw/2;\r\n    let cy = this.dom.height/2;\r\n\r\n    ui_base.drawText(this, box, cy + ts/2, text, {\r\n      canvas: this.dom, g: this.g\r\n    });\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(Check1);\r\n\r\nexport {checkForTextBox} from './ui_textbox.js';\r\n","export function saveFile(data, filename=\"unnamed\", exts=[], mime=\"application/x-octet-stream\") {\r\n  let blob = new Blob([data], {type : mime});\r\n  let url = URL.createObjectURL(blob);\r\n\r\n  let a = document.createElement(\"a\");\r\n  a.setAttribute(\"href\", url);\r\n  a.setAttribute(\"download\", filename);\r\n\r\n  a.click();\r\n}\r\n\r\n//returns a promise\r\nexport function loadFile(filename=\"unnamed\", exts=[]) {\r\n  let input = document.createElement(\"input\");\r\n  input.type = \"file\";\r\n\r\n  exts = exts.join(\",\");\r\n\r\n  input.setAttribute(\"accept\", exts)\r\n  return new Promise((accept, reject) => {\r\n    input.onchange = function(e) {\r\n      if (this.files === undefined || this.files.length !== 1) {\r\n        reject(\"file load error\");\r\n        return;\r\n      }\r\n\r\n      let file = this.files[0];\r\n      let reader = new FileReader();\r\n\r\n      reader.onload = function(e2) {\r\n        accept(e2.target.result);\r\n      };\r\n\r\n      reader.readAsArrayBuffer(file);\r\n    }\r\n    input.click();\r\n  });\r\n}\r\n\r\nwindow._testLoadFile = function(exts=[\"*.*\"]) {\r\n  loadFile(undefined, exts).then((data) => {\r\n    console.log(\"got file data:\", data);\r\n  });\r\n};\r\n\r\nwindow._testSaveFile = function() {\r\n  let buf = _appstate.createFile();\r\n  //console.log(buf);\r\n  saveFile(buf, \"unnamed.w3d\", [\".w3d\"]);\r\n}","/**\r\n see doc_src/context.md\r\n */\r\n\r\nimport * as util from '../util/util.js';\r\n\r\nimport cconst from '../config/config.js';\r\n\r\nlet notifier = undefined;\r\n\r\nexport function setNotifier(cls) {\r\n  notifier = cls;\r\n}\r\n\r\nexport const ContextFlags = {\r\n  IS_VIEW : 1\r\n};\r\n\r\nclass InheritFlag {\r\n  constructor(data) {\r\n    this.data = data;\r\n  }\r\n}\r\n\r\nlet __idgen = 1;\r\n\r\nif (Symbol.ContextID === undefined) {\r\n  Symbol.ContextID = Symbol(\"ContextID\");\r\n}\r\n\r\nif (Symbol.CachedDef === undefined) {\r\n  Symbol.CachedDef = Symbol(\"CachedDef\");\r\n}\r\n\r\nconst _ret_tmp = [undefined];\r\n\r\nexport const OverlayClasses = [];\r\n\r\nexport function makeDerivedOverlay(parent) {\r\n  return class ContextOverlay extends parent {\r\n    constructor(appstate) {\r\n      super(appstate);\r\n\r\n      this.ctx = undefined; //owning context\r\n      this._state = appstate;\r\n    }\r\n\r\n    get state() {\r\n      return this._state;\r\n    }\r\n\r\n    set state(state) {\r\n      this._state = state;\r\n    }\r\n\r\n    /*\r\n    Ugly hack, ui_lasttool.js saves\r\n    a DataStruct wrapping the most recently executed ToolOp\r\n    in this.state._last_tool.\r\n    */\r\n    get last_tool() {\r\n      return this.state._last_tool;\r\n    }\r\n\r\n\r\n    onRemove(have_new_file = false) {\r\n    }\r\n\r\n    copy() {\r\n      return new this.constructor(this._state);\r\n    }\r\n\r\n    validate() {\r\n      throw new Error(\"Implement me!\");\r\n    }\r\n\r\n\r\n    //base classes override this\r\n    static contextDefine() {\r\n      throw new Error(\"implement me!\");\r\n      return {\r\n        name: \"\",\r\n        flag: 0\r\n      }\r\n    }\r\n\r\n    //don't override this\r\n    static resolveDef() {\r\n      if (this.hasOwnProperty(Symbol.CachedDef)) {\r\n        return this[Symbol.CachedDef];\r\n      }\r\n\r\n      let def2 = Symbol.CachedDef = {};\r\n\r\n      let def = this.contextDefine();\r\n\r\n      if (def === undefined) {\r\n        def = {};\r\n      }\r\n\r\n      for (let k in def) {\r\n        def2[k] = def[k];\r\n      }\r\n\r\n      if (!(\"flag\") in def) {\r\n        def2.flag = Context.inherit(0);\r\n      }\r\n\r\n      let parents = [];\r\n      let p = util.getClassParent(this);\r\n\r\n      while (p && p !== ContextOverlay) {\r\n        parents.push(p);\r\n        p = util.getClassParent(p);\r\n      }\r\n\r\n      if (def2.flag instanceof InheritFlag) {\r\n        let flag = def2.flag.data;\r\n        for (let p of parents) {\r\n          let def = p.contextDefine();\r\n\r\n          if (!def.flag) {\r\n            continue;\r\n          } else if (def.flag instanceof InheritFlag) {\r\n            flag |= def.flag.data;\r\n          } else {\r\n            flag |= def.flag;\r\n            //don't go past non-inheritable parents\r\n            break;\r\n          }\r\n        }\r\n\r\n        def2.flag = flag;\r\n      }\r\n\r\n      return def2;\r\n    }\r\n  };\r\n}\r\n\r\nexport const ContextOverlay = makeDerivedOverlay(Object);\r\n\r\nexport const excludedKeys = new Set([\"onRemove\", \"reset\", \"toString\", \"_fix\",\r\n                                     \"valueOf\", \"copy\", \"next\", \"save\", \"load\", \"clear\", \"hasOwnProperty\",\r\n                                     \"toLocaleString\", \"constructor\", \"propertyIsEnumerable\", \"isPrototypeOf\",\r\n                                     \"state\", \"saveProperty\", \"loadProperty\", \"getOwningOverlay\", \"_props\"]);\r\n\r\nexport class LockedContext {\r\n  constructor(ctx, noWarnings) {\r\n    this.props = {};\r\n\r\n    this.state = ctx.state;\r\n    this.api = ctx.api;\r\n    this.toolstack = ctx.toolstack;\r\n\r\n    this.noWarnings = noWarnings;\r\n\r\n    this.load(ctx);\r\n  }\r\n\r\n  toLocked() {\r\n    //just return itself\r\n    return this;\r\n  }\r\n\r\n  error() {\r\n    return this.ctx.error(...arguments);\r\n  }\r\n  warning() {\r\n    return this.ctx.warning(...arguments);\r\n  }\r\n  message() {\r\n    return this.ctx.message(...arguments);\r\n  }\r\n  progbar() {\r\n    return this.ctx.progbar(...arguments);\r\n  }\r\n\r\n  load(ctx) {\r\n    //let keys = util.getAllKeys(ctx);\r\n    let keys = ctx._props;\r\n\r\n    function wrapget(name) {\r\n      return function(ctx2, data) {\r\n        return ctx.loadProperty(ctx2, name, data);\r\n      }\r\n    }\r\n\r\n    for (let k of keys) {\r\n      let v;\r\n      if (k === \"state\" || k === \"toolstack\" || k === \"api\") {\r\n        continue;\r\n      }\r\n\r\n      if (typeof k === \"string\" && (k.endsWith(\"_save\") || k.endsWith(\"_load\"))) {\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        v = ctx[k];\r\n      } catch (error) {\r\n        if (cconst.DEBUG.contextSystem) {\r\n          console.warn(\"failed to look up property in context: \", k);\r\n        }\r\n        continue;\r\n      }\r\n\r\n      let data, getter;\r\n      let overlay = ctx.getOwningOverlay(k);\r\n\r\n      if (overlay === undefined) {\r\n        //property must no longer be used?\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        if (typeof k === \"string\" && (overlay[k + \"_save\"] && overlay[k + \"_load\"])) {\r\n          data = overlay[k + \"_save\"]();\r\n          getter = overlay[k + \"_load\"];\r\n        } else {\r\n          data = ctx.saveProperty(k);\r\n          getter = wrapget(k);\r\n        }\r\n      } catch (error) {\r\n        //util.print_stack(error);\r\n        console.warn(\"Failed to save context property\", k);\r\n        continue;\r\n      }\r\n\r\n      this.props[k] = {\r\n        data : data,\r\n        get  : getter\r\n      };\r\n    }\r\n\r\n    let defineProp = (name) => {\r\n      Object.defineProperty(this, name, {\r\n        get : function() {\r\n          let def = this.props[name];\r\n          return def.get(this.ctx, def.data)\r\n        }\r\n      })\r\n    };\r\n\r\n    for (let k in this.props) {\r\n      defineProp(k);\r\n    }\r\n\r\n    this.ctx = ctx;\r\n  }\r\n\r\n  setContext(ctx) {\r\n    this.ctx = ctx;\r\n\r\n    this.state = ctx.state;\r\n    this.api = ctx.api;\r\n    this.toolstack = ctx.toolstack;\r\n  }\r\n}\r\n\r\nlet next_key = {};\r\nlet idgen = 1;\r\n\r\nexport class Context {\r\n  constructor(appstate) {\r\n    this.state = appstate;\r\n\r\n    this._props = new Set();\r\n    this._stack = [];\r\n    this._inside_map = {};\r\n  }\r\n\r\n  /** chrome's debug console corrupts this._inside_map,\r\n   this method fixes it*/\r\n  _fix() {\r\n    this._inside_map = {};\r\n  }\r\n\r\n  fix() {\r\n    this._fix();\r\n  }\r\n\r\n  error(message, timeout=1500) {\r\n    let state = this.state;\r\n\r\n    console.warn(message);\r\n\r\n    if (state && state.screen) {\r\n      return notifier.error(state.screen, message, timeout);\r\n    }\r\n  }\r\n\r\n  warning(message, timeout=1500) {\r\n    let state = this.state;\r\n\r\n    console.warn(message);\r\n\r\n    if (state && state.screen) {\r\n      return notifier.warning(state.screen, message, timeout);\r\n    }\r\n  }\r\n\r\n  message(msg, timeout=1500) {\r\n    let state = this.state;\r\n\r\n    console.warn(msg);\r\n\r\n    if (state && state.screen) {\r\n      return notifier.message(state.screen, msg, timeout);\r\n    }\r\n  }\r\n\r\n  progbar(msg, perc=0.0, timeout=1500, id=msg) {\r\n    let state = this.state;\r\n\r\n    if (state && state.screen) {\r\n      //progbarNote(screen, msg, percent, color, timeout) {\r\n      return notifier.progbarNote(state.screen, msg, perc, \"green\", timeout, id);\r\n    }\r\n  }\r\n\r\n  validateOverlays() {\r\n    let stack = this._stack;\r\n    let stack2 = [];\r\n\r\n    for (let i=0; i<stack.length; i++) {\r\n      if (stack[i].validate()) {\r\n        stack2.push(stack[i]);\r\n      }\r\n    }\r\n\r\n    this._stack = stack2;\r\n  }\r\n\r\n  hasOverlay(cls) {\r\n    return this.getOverlay(cls) !== undefined;\r\n  }\r\n\r\n  getOverlay(cls) {\r\n    for (let overlay of this._stack) {\r\n      if (overlay.constructor === cls) {\r\n        return overlay;\r\n      }\r\n    }\r\n  }\r\n\r\n  clear(have_new_file=false) {\r\n    for (let overlay of this._stack) {\r\n      overlay.onRemove(have_new_file);\r\n    }\r\n\r\n    this._stack = [];\r\n  }\r\n\r\n  //this is implemented by child classes\r\n  //it should load the same default overlays as in constructor\r\n  reset(have_new_file=false) {\r\n    this.clear(have_new_file);\r\n  }\r\n\r\n  //returns a new context with overriden properties\r\n  //unlike pushOverlay, overrides can be a simple object\r\n  override(overrides) {\r\n    if (overrides.copy === undefined) {\r\n      overrides.copy = function() {\r\n        return Object.assign({}, this);\r\n      }\r\n    }\r\n\r\n    let ctx = this.copy();\r\n    ctx.pushOverlay(overrides);\r\n    return ctx;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new this.constructor(this.state);\r\n\r\n    for (let item of this._stack) {\r\n      ret.pushOverlay(item.copy());\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   Used by overlay property getters.  If returned,\r\n   the next overlay in the struct will have its getter used.\r\n\r\n   Example:\r\n\r\n   class overlay {\r\n      get scene() {\r\n        if (some_reason) {\r\n          return Context.super();\r\n        }\r\n\r\n        return something_else;\r\n      }\r\n    }\r\n   */\r\n  static super() {\r\n    return next_key;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * saves a property into some kind of non-object-reference form\r\n   *\r\n   * */\r\n  saveProperty(key) {\r\n    //console.warn(\"Missing saveProperty implementation in Context; passing through values...\", key)\r\n    return this[key];\r\n  }\r\n\r\n  /**\r\n   *\r\n   * lookup property based on saved data\r\n   *\r\n   * */\r\n  loadProperty(ctx, key, data) {\r\n    //console.warn(\"Missing loadProperty implementation in Context; passing through values...\", key)\r\n    return data;\r\n  }\r\n\r\n  getOwningOverlay(name, _val_out) {\r\n    let inside_map = this._inside_map;\r\n    let stack = this._stack;\r\n\r\n    if (cconst.DEBUG.contextSystem) {\r\n      console.log(name, inside_map);\r\n    }\r\n\r\n    for (let i=stack.length-1; i >= 0; i--) {\r\n      let overlay = stack[i];\r\n      let ret = next_key;\r\n\r\n      if (overlay[Symbol.ContextID] === undefined) {\r\n        throw new Error(\"context corruption\");\r\n      }\r\n\r\n      let ikey = overlay[Symbol.ContextID];\r\n\r\n      if (cconst.DEBUG.contextSystem) {\r\n        console.log(ikey, overlay);\r\n      }\r\n\r\n      //prevent infinite recursion\r\n      if (inside_map[ikey]) {\r\n        continue;\r\n      }\r\n\r\n      if (overlay.__allKeys.has(name)) {\r\n        if (cconst.DEBUG.contextSystem) {\r\n          console.log(\"getting value\");\r\n        }\r\n\r\n        //Chrome's console messes this up\r\n\r\n        inside_map[ikey] = 1;\r\n\r\n        try {\r\n          ret = overlay[name];\r\n        } catch (error) {\r\n\r\n          inside_map[ikey] = 0;\r\n          throw error;\r\n        }\r\n\r\n        inside_map[ikey] = 0;\r\n      }\r\n\r\n      if (ret !== next_key) {\r\n        if (_val_out !== undefined) {\r\n          _val_out[0] = ret;\r\n        }\r\n        return overlay;\r\n      }\r\n    }\r\n\r\n    if (_val_out !== undefined) {\r\n      _val_out[0] = undefined;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  ensureProperty(name) {\r\n    if (this.hasOwnProperty(name)) {\r\n      return;\r\n    }\r\n\r\n    this._props.add(name);\r\n\r\n    Object.defineProperty(this, name, {\r\n      get : function() {\r\n        let ret = _ret_tmp;\r\n        _ret_tmp[0] = undefined;\r\n\r\n        this.getOwningOverlay(name, ret);\r\n        return ret[0];\r\n      }, set : function() {\r\n        throw new Error(\"Cannot set ctx properties\")\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Returns a new context that doesn't\r\n   * contain any direct object references\r\n   * except for .state .datalib and .api, but\r\n   * instead uses those three to look up references\r\n   * on property access.\r\n   * */\r\n  toLocked() {\r\n    return new LockedContext(this);\r\n  }\r\n\r\n  pushOverlay(overlay) {\r\n    if (!overlay.hasOwnProperty(Symbol.ContextID)) {\r\n      overlay[Symbol.ContextID] = idgen++;\r\n    }\r\n\r\n    let keys = new Set();\r\n    for (let key of util.getAllKeys(overlay)) {\r\n      if (!excludedKeys.has(key) && !(typeof key === \"string\" && key[0] === \"_\")) {\r\n        keys.add(key);\r\n      }\r\n    }\r\n\r\n    overlay.ctx = this;\r\n\r\n    if (overlay.__allKeys === undefined) {\r\n      overlay.__allKeys = keys;\r\n    }\r\n\r\n    for (let k of keys) {\r\n      let bad = typeof k === \"symbol\" || excludedKeys.has(k);\r\n      bad = bad || (typeof k === \"string\" && k[0] === \"_\");\r\n      bad = bad || (typeof k === \"string\" && k.endsWith(\"_save\"));\r\n      bad = bad || (typeof k === \"string\" && k.endsWith(\"_load\"));\r\n\r\n      if (bad) {\r\n        continue;\r\n      }\r\n\r\n      this.ensureProperty(k);\r\n    }\r\n\r\n    if (this._stack.indexOf(overlay) >= 0) {\r\n      console.warn(\"Overlay already added once\");\r\n      if (this._stack[this._stack.length-1] === overlay) {\r\n        console.warn(\"  Definitely an error, overlay is already at top of stack\");\r\n        return;\r\n      }\r\n    }\r\n\r\n    this._stack.push(overlay);\r\n  }\r\n\r\n  popOverlay(overlay) {\r\n    if (overlay !== this._stack[this._stack.length-1]) {\r\n      console.warn(\"Context.popOverlay called in error\", overlay);\r\n      return;\r\n    }\r\n\r\n    overlay.onRemove();\r\n    this._stack.pop();\r\n  }\r\n\r\n  removeOverlay(overlay) {\r\n    if (this._stack.indexOf(overlay) < 0) {\r\n      console.warn(\"Context.removeOverlay called in error\", overlay);\r\n      return;\r\n    }\r\n\r\n    overlay.onRemove();\r\n    this._stack.remove(overlay);\r\n  }\r\n\r\n  static inherit(data) {\r\n    return new InheritFlag(data);\r\n  }\r\n\r\n  static register(cls) {\r\n    if (cls[Symbol.ContextID]) {\r\n      console.warn(\"Tried to register same class twice:\", cls);\r\n      return;\r\n    }\r\n\r\n    cls[Symbol.ContextID] = __idgen++;\r\n    OverlayClasses.push(cls);\r\n  }\r\n}\r\n\r\nexport function test() {\r\n  function testInheritance() {\r\n    class Test0 extends ContextOverlay {\r\n      static contextDefine() {\r\n        return {\r\n          flag: 1\r\n        }\r\n      }\r\n    }\r\n\r\n    class Test1 extends Test0 {\r\n      static contextDefine() {\r\n        return {\r\n          flag: 2\r\n        }\r\n      }\r\n    }\r\n\r\n    class Test2 extends Test1 {\r\n      static contextDefine() {\r\n        return {\r\n          flag: Context.inherit(4)\r\n        }\r\n      }\r\n    }\r\n\r\n    class Test3 extends Test2 {\r\n      static contextDefine() {\r\n        return {\r\n          flag: Context.inherit(8)\r\n        }\r\n      }\r\n    }\r\n\r\n    class Test4 extends Test3 {\r\n      static contextDefine() {\r\n        return {\r\n          flag: Context.inherit(16)\r\n        }\r\n      }\r\n    }\r\n\r\n    return Test4.resolveDef().flag === 30;\r\n  }\r\n\r\n  return testInheritance();\r\n}\r\n\r\nif (!test()) {\r\n  throw new Error(\"Context test failed\");\r\n}\r\n","import {Vector2} from \"./vectormath.js\";\r\nimport * as math from './math.js';\r\nimport * as util from './util.js';\r\n\r\nexport class Constraint {\r\n  constructor(name, func, klst, params, k=1.0) {\r\n    this.glst = [];\r\n    this.klst = klst;\r\n    this.k = k;\r\n    this.params = params;\r\n    this.name = name;\r\n\r\n    for (let ks of klst) {\r\n      this.glst.push(new Float64Array(ks.length));\r\n    }\r\n\r\n    this.df = 0.0005;\r\n    this.threshold = 0.0001;\r\n    this.func = func;\r\n\r\n    this.funcDv = null;\r\n  }\r\n\r\n  evaluate(no_dvs=false) {\r\n    let r1 = this.func(this.params);\r\n\r\n    if (this.funcDv) {\r\n      this.funcDv(this.params, this.glst);\r\n      return r1;\r\n    }\r\n\r\n    if (Math.abs(r1) < this.threshold)\r\n      return 0.0;\r\n\r\n    let df = this.df;\r\n\r\n    if (no_dvs)\r\n      return r1;\r\n\r\n    for (let i=0; i<this.klst.length; i++) {\r\n      let gs = this.glst[i];\r\n      let ks = this.klst[i];\r\n\r\n      for (let j=0; j<ks.length; j++) {\r\n        let orig = ks[j];\r\n        ks[j] += df;\r\n        let r2 = this.func(this.params);\r\n        ks[j] = orig;\r\n\r\n        gs[j] = (r2 - r1) / df;\r\n      }\r\n    }\r\n\r\n    return r1;\r\n  }\r\n}\r\n\r\nexport class Solver {\r\n  constructor() {\r\n    this.constraints = [];\r\n    this.gk = 0.99;\r\n    this.simple = false;\r\n    this.randCons = false;\r\n\r\n    /** stop when average constraint error falls below this */\r\n    this.threshold = 0.01;\r\n  }\r\n\r\n  add(con) {\r\n    this.constraints.push(con);\r\n  }\r\n\r\n  solveStep(gk=this.gk) {\r\n    let err = 0.0;\r\n\r\n    let cons = this.constraints;\r\n    for (let ci=0; ci<cons.length; ci++ ){\r\n      let ri = ci;\r\n      if (this.randCons) {\r\n        ri = ~~(Math.random()*this.constraints.length*0.99999);\r\n      }\r\n\r\n      let con = cons[ri];\r\n\r\n      let r1 = con.evaluate();\r\n\r\n      if (r1 === 0.0)\r\n        continue;\r\n\r\n      err += Math.abs(r1);\r\n      let totgs = 0.0;\r\n\r\n      for (let i=0; i<con.klst.length; i++) {\r\n        let ks = con.klst[i], gs = con.glst[i];\r\n        for (let j=0; j<ks.length; j++) {\r\n          totgs += gs[j]*gs[j];\r\n        }\r\n      }\r\n\r\n      if (totgs === 0.0)  {\r\n        continue;\r\n      }\r\n\r\n      r1 /= totgs;\r\n\r\n      for (let i=0; i<con.klst.length; i++) {\r\n        let ks = con.klst[i], gs = con.glst[i];\r\n        for (let j=0; j<ks.length; j++) {\r\n          ks[j] += -r1*gs[j]*con.k*gk;\r\n        }\r\n      }\r\n    }\r\n\r\n    return err;\r\n  }\r\n\r\n  solveStepSimple(gk=this.gk) {\r\n    let err = 0.0;\r\n\r\n    let cons = this.constraints;\r\n    for (let ci=0; ci<cons.length; ci++ ){\r\n      let ri = ci;\r\n      if (this.randCons) {\r\n        ri = ~~(Math.random()*this.constraints.length*0.99999);\r\n      }\r\n\r\n      let con = cons[ri];\r\n\r\n      let r1 = con.evaluate();\r\n\r\n      if (r1 === 0.0)\r\n        continue;\r\n\r\n      err += Math.abs(r1);\r\n      let totgs = 0.0;\r\n\r\n      for (let i=0; i<con.klst.length; i++) {\r\n        let ks = con.klst[i], gs = con.glst[i];\r\n        for (let j=0; j<ks.length; j++) {\r\n          totgs += gs[j]*gs[j];\r\n        }\r\n      }\r\n\r\n      if (totgs === 0.0)  {\r\n        continue;\r\n      }\r\n\r\n      totgs = 0.0001 / Math.sqrt(totgs);\r\n\r\n      for (let i=0; i<con.klst.length; i++) {\r\n        let ks = con.klst[i], gs = con.glst[i];\r\n        for (let j=0; j<ks.length; j++) {\r\n          ks[j] += -totgs*gs[j]*con.k*gk;\r\n        }\r\n      }\r\n    }\r\n\r\n    return err;\r\n  }\r\n\r\n  solve(steps, gk=this.gk, printError=false) {\r\n    let err = 0.0;\r\n\r\n    for (let i=0; i<steps; i++) {\r\n      if (this.simple) {\r\n        err = this.solveStepSimple(gk);\r\n      } else {\r\n        err = this.solveStep(gk);\r\n      }\r\n\r\n\r\n      if (printError) {\r\n        console.warn(\"average error:\", (err/this.constraints.length).toFixed(4));\r\n      }\r\n      if (err < this.threshold / this.constraints.length) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return err;\r\n  }\r\n}\r\n","\"use strict\";\r\n\r\nimport {Vector2} from \"./vectormath.js\";\r\nimport * as math from './math.js';\r\nimport * as util from './util.js';\r\n\r\nimport {Constraint, Solver} from './solver.js';\r\n\r\nlet idgen = 0;\r\n\r\nexport class PackNodeVertex extends Vector2 {\r\n  constructor(node, co) {\r\n    super(co);\r\n\r\n    this.node = node;\r\n    this._id = idgen++;\r\n    this.edges = [];\r\n    this._absPos = new Vector2();\r\n  }\r\n\r\n  get absPos() {\r\n    this._absPos.load(this).add(this.node.pos);\r\n    return this._absPos;\r\n  }\r\n\r\n  [Symbol.keystr]() {\r\n    return this._id;\r\n  }\r\n}\r\n\r\nexport class PackNode {\r\n  constructor() {\r\n    this.pos = new Vector2();\r\n    this.vel = new Vector2();\r\n    this.oldpos = new Vector2();\r\n    this._id = idgen++;\r\n    this.size = new Vector2();\r\n    this.verts = [];\r\n  }\r\n\r\n  [Symbol.keystr]() {\r\n    return this._id;\r\n  }\r\n}\r\n\r\nfunction copyGraph(nodes) {\r\n  let ret = [];\r\n  let idmap = {};\r\n\r\n  for (let n of nodes) {\r\n    let n2 = new PackNode();\r\n    n2._id = n._id;\r\n    n2.pos.load(n.pos);\r\n    n2.vel.load(n.vel);\r\n    n2.size.load(n.size);\r\n\r\n    n2.verts = [];\r\n    idmap[n2._id] = n2;\r\n\r\n    for (let v of n.verts) {\r\n      let v2 = new PackNodeVertex(n2, v);\r\n      v2._id = v._id;\r\n      idmap[v2._id] = v2;\r\n\r\n      n2.verts.push(v2);\r\n    }\r\n\r\n    ret.push(n2);\r\n  }\r\n\r\n  for (let n of nodes) {\r\n    for (let v of n.verts) {\r\n      let v2 = idmap[v._id];\r\n\r\n      for (let v3 of v.edges) {\r\n        v2.edges.push(idmap[v3._id]);\r\n      }\r\n    }\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nfunction getCenter(nodes) {\r\n  let cent = new Vector2();\r\n\r\n  for (let n of nodes) {\r\n    cent.add(n.pos);\r\n  }\r\n\r\n  if (nodes.length === 0)\r\n    return cent;\r\n\r\n  cent.mulScalar(1.0 / nodes.length);\r\n\r\n  return cent;\r\n}\r\n\r\nfunction loadGraph(nodes, copy) {\r\n  let idmap = {};\r\n\r\n  for (let i=0; i<nodes.length; i++) {\r\n    nodes[i].pos.load(copy[i].pos);\r\n    nodes[i].oldpos.load(copy[i].oldpos);\r\n    nodes[i].vel.load(copy[i].vel);\r\n  }\r\n}\r\n\r\nexport function graphGetIslands(nodes) {\r\n  let islands = [];\r\n  let visit1 = new util.set();\r\n\r\n  let rec = (n, island) => {\r\n    island.push(n);\r\n    visit1.add(n);\r\n\r\n    for (let v of n.verts) {\r\n      for (let e of v.edges) {\r\n        let n2 = e.node;\r\n        if (n2 !== n && !visit1.has(n2)) {\r\n          rec(n2, island);\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  for (let n of nodes) {\r\n    if (visit1.has(n)) {\r\n      continue;\r\n    }\r\n\r\n    let island = [];\r\n    islands.push(island);\r\n    rec(n, island);\r\n  }\r\n\r\n  return islands;\r\n}\r\n\r\nexport function graphPack(nodes, margin_or_args=15, steps=10, updateCb=undefined) {\r\n  let margin = margin_or_args;\r\n  let speed = 1.0;\r\n\r\n  if (typeof margin === \"object\") {\r\n    let args = margin;\r\n\r\n    margin = args.margin ?? 15;\r\n    steps = args.steps ?? 10;\r\n    updateCb = args.updateCb;\r\n    speed = args.speed ?? 1.0;\r\n  }\r\n\r\n  let orignodes = nodes;\r\n  nodes = copyGraph(nodes);\r\n\r\n  let decay = 1.0;\r\n  let decayi = 0;\r\n\r\n\r\n  let min = new Vector2().addScalar(1e17);\r\n  let max = new Vector2().addScalar(-1e17);\r\n\r\n  let tmp = new Vector2();\r\n  for (let n of nodes) {\r\n    min.min(n.pos);\r\n    tmp.load(n.pos).add(n.size);\r\n    max.max(tmp);\r\n  }\r\n\r\n  let size = new Vector2(max).sub(min);\r\n\r\n  for (let n of nodes) {\r\n    n.pos[0] += (Math.random()-0.5)*5.0/size[0]*speed;\r\n    n.pos[1] += (Math.random()-0.5)*5.0/size[1]*speed;\r\n  }\r\n\r\n  let nodemap = {};\r\n  for (let n of nodes) {\r\n    n.vel.zero();\r\n    nodemap[n._id] = n;\r\n    for (let v of n.verts) {\r\n      nodemap[v._id] = v;\r\n    }\r\n  }\r\n\r\n  let visit = new util.set();\r\n  let verts = new util.set();\r\n  let isect = [];\r\n\r\n  let disableEdges = false;\r\n\r\n  function edge_c(params) {\r\n    let [v1, v2, restlen] = params;\r\n\r\n    if (disableEdges) return 0;\r\n\r\n    return Math.abs(v1.absPos.vectorDistance(v2.absPos) - restlen);\r\n  }\r\n\r\n  let p1 = new Vector2();\r\n  let p2 = new Vector2();\r\n  let s1 = new Vector2();\r\n  let s2 = new Vector2();\r\n\r\n  function loadBoxes(n1, n2, margin1=margin) {\r\n    p1.load(n1.pos);\r\n    p2.load(n2.pos);\r\n    s1.load(n1.size);\r\n    s2.load(n2.size);\r\n\r\n    p1.subScalar(margin1);\r\n    p2.subScalar(margin1);\r\n    s1.addScalar(margin1*2.0);\r\n    s2.addScalar(margin1*2.0);\r\n  }\r\n\r\n  let disableArea = false;\r\n\r\n  function area_c(params) {\r\n    let [n1, n2] = params;\r\n\r\n    if (disableArea)\r\n      return 0.0;\r\n\r\n    loadBoxes(n1, n2);\r\n\r\n    let a1 = n1.size[0]*n1.size[1];\r\n    let a2 = n2.size[0]*n2.size[1];\r\n\r\n    return math.aabb_overlap_area(p1, s1, p2, s2);\r\n    return (math.aabb_overlap_area(p1, s1, p2, s2) / (a1+a2));\r\n  }\r\n\r\n  let lasterr, besterr, best;\r\n  let err;\r\n\r\n  let islands = graphGetIslands(nodes);\r\n  let fakeVerts = [];\r\n  for (let island of islands) {\r\n    let n = island[0];\r\n    let fv = new PackNodeVertex(n);\r\n    fakeVerts.push(fv);\r\n  }\r\n\r\n  let solveStep1 = (gk=1.0) => {\r\n    let solver = new Solver();\r\n\r\n    isect.length = 0;\r\n    visit = new util.set();\r\n\r\n    if (fakeVerts.length > 1) {\r\n      for (let i=1; i<fakeVerts.length; i++) {\r\n        let v1 = fakeVerts[0];\r\n        let v2 = fakeVerts[i];\r\n\r\n        let rlen = 1.0;\r\n\r\n        let con = new Constraint(\"edge_c\", edge_c, [v1.node.pos, v2.node.pos], [v1, v2, rlen]);\r\n        con.k = 0.25;\r\n        solver.add(con);\r\n      }\r\n    }\r\n\r\n    for (let n1 of nodes) {\r\n      for (let v of n1.verts) {\r\n        verts.add(v);\r\n        for (let v2 of v.edges) {\r\n          //hueristic to avoid adding same constraint twice\r\n          if (v2._id < v._id) continue;\r\n\r\n          let rlen = n1.size.vectorLength()*0.0;\r\n\r\n          let con = new Constraint(\"edge_c\", edge_c, [v.node.pos, v2.node.pos], [v, v2, rlen]);\r\n          con.k = 1.0;\r\n          solver.add(con);\r\n        }\r\n      }\r\n\r\n      for (let n2 of nodes) {\r\n        if (n1 === n2) continue;\r\n        let key = Math.min(n1._id, n2._id) + \":\" + Math.max(n1._id, n2._id);\r\n        if (visit.has(key)) continue;\r\n\r\n        loadBoxes(n1, n2);\r\n        let area = math.aabb_overlap_area(p1, s1, p2, s2);\r\n\r\n        if (area > 0.01) {\r\n          let size = decay*(n1.size.vectorLength() + n2.size.vectorLength())*speed;\r\n          //*\r\n          n1.pos[0] += (Math.random() - 0.5)*size;\r\n          n1.pos[1] += (Math.random() - 0.5)*size;\r\n          n2.pos[0] += (Math.random() - 0.5)*size;\r\n          n2.pos[1] += (Math.random() - 0.5)*size;\r\n          //*/\r\n\r\n          isect.push([n1, n2]);\r\n          visit.add(key);\r\n        }\r\n      }\r\n\r\n      for (let [n1, n2] of isect) {\r\n        let con = new Constraint(\"area_c\", area_c, [n1.pos, n2.pos], [n1, n2]);\r\n        solver.add(con);\r\n        con.k = 1.0;\r\n      }\r\n    }\r\n\r\n    return solver;\r\n  };\r\n\r\n  let i = 1;\r\n  let solveStep = (gk=0.5) => {\r\n    let solver = solveStep1();\r\n\r\n    if (i % 40 === 0.0) {\r\n      let c1 = getCenter(nodes);\r\n\r\n      let rfac = 1000.0;\r\n\r\n      if (best) loadGraph(nodes, best);\r\n\r\n      for (let n of nodes) {\r\n        n.pos[0] += (Math.random() - 0.5) * rfac * speed;\r\n        n.pos[1] += (Math.random() - 0.5) * rfac * speed;\r\n        n.vel.zero();\r\n      }\r\n\r\n      let c2 = getCenter(nodes);\r\n      c1.sub(c2);\r\n\r\n      for (let n of nodes) {\r\n        n.pos.add(c1);\r\n      }\r\n    }\r\n\r\n    let err = 1e17;\r\n\r\n    for (let n of nodes) {\r\n      n.oldpos.load(n.pos);\r\n      n.pos.addFac(n.vel, 0.5);\r\n    }\r\n\r\n    disableEdges = false;\r\n    disableArea = true;\r\n    solver.solve(1, gk);\r\n\r\n    //solve so boxes don't overlap\r\n    disableEdges = true;\r\n    disableArea = false;\r\n\r\n    for (let j=0; j<10; j++) {\r\n      solver = solveStep1();\r\n      err = solver.solve(10, gk*speed);\r\n    }\r\n\r\n    for (let n of nodes) {\r\n      n.vel.load(n.pos).sub(n.oldpos);\r\n    }\r\n\r\n    //get error from edge constraints\r\n\r\n    disableEdges = false;\r\n    disableArea = true;\r\n\r\n    err = 0.0;\r\n    for (let con of solver.constraints) {\r\n      err += con.evaluate(true);\r\n    }\r\n\r\n    disableEdges = false;\r\n    disableArea = false;\r\n\r\n    /*\r\n    loadGraph(orignodes, nodes);\r\n    if (updateCb) {\r\n      updateCb();\r\n    }//*/\r\n\r\n    lasterr = err;\r\n\r\n    let add = Math.random()*besterr*Math.exp(-i*0.1);\r\n\r\n    if (besterr === undefined || err < besterr+add) {\r\n      best = copyGraph(nodes);\r\n      besterr = err;\r\n    }\r\n\r\n    i++;\r\n\r\n    return err;\r\n  };\r\n\r\n\r\n  for (let j=0; j<steps; j++) {\r\n    solveStep();\r\n\r\n    decayi++;\r\n    decay = Math.exp(-decayi*0.1);\r\n  }\r\n\r\n  min.zero().addScalar(1e17);\r\n  max.zero().addScalar(-1e17);\r\n\r\n  for (let node of (best ? best : nodes)) {\r\n    min.min(node.pos);\r\n    p2.load(node.pos).add(node.size);\r\n    max.max(p2);\r\n  }\r\n\r\n  for (let node of (best ? best : nodes)) {\r\n    node.pos.sub(min);\r\n  }\r\n\r\n  loadGraph(orignodes, best ? best : nodes);\r\n\r\n  if (updateCb) {\r\n    if (nodes._timer !== undefined) {\r\n      window.clearInterval(nodes._timer);\r\n    }\r\n\r\n    nodes._timer = window.setInterval(() => {\r\n      let time = util.time_ms();\r\n\r\n      while (util.time_ms() - time < 50) {\r\n        let err = solveStep();\r\n      }\r\n\r\n      if (cconst.DEBUG.boxPacker) {\r\n        console.log(\"err\", (besterr / nodes.length).toFixed(2), (lasterr / nodes.length).toFixed(2), \"isects\", isect.length);\r\n      }\r\n\r\n      if (best) loadGraph(orignodes, best);\r\n\r\n      if (updateCb() === false) {\r\n        clearInterval(nodes._timer);\r\n        return;\r\n      }\r\n    }, 100);\r\n\r\n    let timer = nodes._timer;\r\n\r\n    return {\r\n      stop : () => {\r\n        if (best) loadGraph(nodes, best);\r\n\r\n        window.clearInterval(timer);\r\n        nodes._timer = undefined;\r\n      }\r\n    }\r\n  }\r\n}\r\n","\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport cconst from '../config/const.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport {OldButton} from \"./ui_button.js\";\r\nimport {DomEventTypes} from '../path-controller/util/events.js';\r\n\r\nimport {HotKey, keymap} from '../path-controller/util/simple_events.js';\r\nimport { parseToolPath } from '../path-controller/controller.js'\r\n\r\nlet EnumProperty = toolprop.EnumProperty,\r\n    PropTypes    = toolprop.PropTypes;\r\n\r\nlet UIBase     = ui_base.UIBase,\r\n    PackFlags  = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nfunction getpx(css) {\r\n  return parseFloat(css.trim().replace(\"px\", \"\"))\r\n}\r\n\r\nfunction debugmenu() {\r\n  if (window.DEBUG && window.DEBUG.menu) {\r\n    console.warn(\"%cmenu:\", \"color:blue\", ...arguments);\r\n  }\r\n}\r\n\r\n\r\nexport class Menu extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.parentMenu = undefined;\r\n\r\n    this._was_clicked = false;\r\n\r\n    this.items = [];\r\n    this.autoSearchMode = true;\r\n\r\n    this._ignoreFocusEvents = false;\r\n    this.closeOnMouseUp = true;\r\n\r\n    this._submenu = undefined;\r\n\r\n    this.ignoreFirstClick = false;\r\n\r\n    this.itemindex = 0;\r\n    this.closed = false;\r\n    this.started = false;\r\n    this.activeItem = undefined;\r\n\r\n    this.overrideDefault(\"DefaultText\", this.getDefault(\"MenuText\"));\r\n\r\n    //we have to make a container for any submenus to\r\n    this.container = document.createElement(\"span\");\r\n    this.container.style[\"display\"] = \"flex\";\r\n    this.container.style[\"color\"] = this.getDefault(\"MenuText\").color;\r\n\r\n    //this.container.style[\"background-color\"] = \"red\";\r\n    this.container.setAttribute(\"class\", \"menucon\");\r\n\r\n    this.dom = document.createElement(\"ul\");\r\n    this.dom.setAttribute(\"class\", \"menu\");\r\n    /*\r\n              place-items: start start;\r\n              flex-wrap : nowrap;\r\n              align-content : start;\r\n              place-content : start;\r\n              justify-content : start;\r\n\r\n              align-items : start;\r\n              place-items : start;\r\n              justify-items : start;\r\n    */\r\n\r\n    let style = this.menustyle = document.createElement(\"style\");\r\n    this.buildStyle();\r\n\r\n    this.dom.setAttribute(\"tabindex\", -1);\r\n\r\n    //the menu wrangler handles key events\r\n\r\n    this.shadow.appendChild(style);\r\n    this.shadow.appendChild(this.container);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"menu-x\",\r\n      style  : \"menu\"\r\n    };\r\n  }\r\n\r\n  float(x, y, zindex = undefined) {\r\n    let dpi = this.getDPI();\r\n    let rect = this.dom.getClientRects();\r\n    let maxx = this.getWinWidth() - 10;\r\n    let maxy = this.getWinHeight() - 10;\r\n\r\n    if (rect.length > 0) {\r\n      rect = rect[0];\r\n      if (y + rect.height > maxy) {\r\n        y = maxy - rect.height - 1;\r\n      }\r\n\r\n      if (x + rect.width > maxx) {\r\n        x = maxx - rect.width - 1;\r\n      }\r\n    }\r\n\r\n    super.float(x, y, 50);\r\n  }\r\n\r\n  click() {\r\n    if (this._was_clicked) {\r\n      return;\r\n    }\r\n\r\n    if (this.ignoreFirstClick) {\r\n      this.ignoreFirstClick = Math.max(this.ignoreFirstClick - 1, 0);\r\n      return;\r\n    }\r\n\r\n    if (!this.activeItem || this.activeItem._isMenu) {\r\n      return;\r\n    }\r\n\r\n    this._was_clicked = true;\r\n\r\n    if (this.onselect) {\r\n      try {\r\n        this.onselect(this.activeItem._id);\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        console.log(\"Error in menu callback\");\r\n      }\r\n    }\r\n\r\n    this.close();\r\n  }\r\n\r\n  _ondestroy() {\r\n    if (this.started) {\r\n      menuWrangler.popMenu(this);\r\n\r\n      if (this.onclose) {\r\n        this.onclose();\r\n      }\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this.setCSS();\r\n  }\r\n\r\n  close() {\r\n    if (this.closed) {\r\n      return;\r\n    }\r\n\r\n    this.closed = true;\r\n\r\n    if (this.started) {\r\n      menuWrangler.popMenu(this);\r\n    }\r\n\r\n    this.started = false;\r\n\r\n    if (this._popup) {\r\n      this._popup.end();\r\n      this._popup = undefined;\r\n    }\r\n\r\n    this.remove();\r\n    this.dom.remove();\r\n\r\n    if (this.onclose) {\r\n      this.onclose(this);\r\n    }\r\n  }\r\n\r\n  _select(dir, focus = true) {\r\n    if (this.activeItem === undefined) {\r\n      for (let item of this.items) {\r\n        if (!item.hidden) {\r\n          this.setActive(item, focus);\r\n          break;\r\n        }\r\n      }\r\n    } else {\r\n      let i = this.items.indexOf(this.activeItem);\r\n      let item = this.activeItem;\r\n\r\n      do {\r\n        i = (i + dir + this.items.length)%this.items.length;\r\n        item = this.items[i];\r\n\r\n        if (!item.hidden) {\r\n          break;\r\n        }\r\n      } while (item !== this.activeItem);\r\n\r\n      this.setActive(item, focus);\r\n    }\r\n\r\n    if (this.hasSearchBox) {\r\n      this.activeItem.scrollIntoView();\r\n    }\r\n  }\r\n\r\n  selectPrev(focus = true) {\r\n    return this._select(-1, focus);\r\n  }\r\n\r\n  selectNext(focus = true) {\r\n    return this._select(1, focus);\r\n  }\r\n\r\n  start_fancy(prepend, setActive = true) {\r\n    return this.startFancy(prepend, setActive);\r\n  }\r\n\r\n  setActive(item, focus = true) {\r\n    if (this.activeItem === item) {\r\n      return;\r\n    }\r\n\r\n    if (this.activeItem) {\r\n      this.activeItem.style[\"background-color\"] = this.getDefault(\"MenuBG\");\r\n\r\n      if (focus) {\r\n        this.activeItem.blur();\r\n      }\r\n    }\r\n\r\n    if (item) {\r\n      item.style[\"background-color\"] = this.getDefault(\"MenuHighlight\");\r\n\r\n      if (focus) {\r\n        item.focus();\r\n      }\r\n    }\r\n\r\n    this.activeItem = item;\r\n  }\r\n\r\n  startFancy(prepend, setActive = true) {\r\n    this.hasSearchBox = true;\r\n    this.started = true;\r\n    menuWrangler.pushMenu(this);\r\n\r\n    let dom2 = document.createElement(\"div\");\r\n    //let dom2 = document.createElement(\"div\");\r\n\r\n    this.dom.setAttribute(\"class\", \"menu\");\r\n    dom2.setAttribute(\"class\", \"menu\");\r\n\r\n    let sbox = this.textbox = UIBase.createElement(\"textbox-x\");\r\n    this.textbox.parentWidget = this;\r\n\r\n    dom2.appendChild(sbox);\r\n    dom2.appendChild(this.dom);\r\n\r\n    dom2.style[\"height\"] = \"300px\";\r\n    this.dom.style[\"height\"] = \"300px\";\r\n    this.dom.style[\"overflow\"] = \"scroll\";\r\n\r\n    if (prepend) {\r\n      this.container.prepend(dom2);\r\n    } else {\r\n      this.container.appendChild(dom2);\r\n    }\r\n\r\n    dom2.parentWidget = this.container;\r\n\r\n    sbox.focus();\r\n    sbox.onchange = () => {\r\n      let t = sbox.text.trim().toLowerCase();\r\n\r\n      for (let item of this.items) {\r\n        item.hidden = true;\r\n        item.remove();\r\n      }\r\n\r\n      for (let item of this.items) {\r\n        let ok = t == \"\";\r\n        ok = ok || item.innerHTML.toLowerCase().search(t) >= 0;\r\n\r\n        if (ok) {\r\n          item.hidden = false;\r\n          this.dom.appendChild(item);\r\n        } else if (item === this.activeItem) {\r\n          this.selectNext(false);\r\n        }\r\n        //item.hidden = !ok;\r\n      }\r\n    }\r\n\r\n    sbox.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case 27: //escape key\r\n          this.close();\r\n          break;\r\n        case 13: //enter key\r\n          this.click(this.activeItem);\r\n          this.close();\r\n          break;\r\n      }\r\n    });\r\n  }\r\n\r\n  start(prepend = false, setActive = true) {\r\n    this.closed = false;\r\n\r\n    this.started = true;\r\n    this.focus();\r\n\r\n    menuWrangler.pushMenu(this);\r\n\r\n    let dokey = (key) => {\r\n      let val = this.getDefault(key);\r\n      if (typeof val === \"number\") {\r\n        val = \"\" + val + \"px\";\r\n      }\r\n\r\n      if (val !== undefined) {\r\n        this.dom.style[key] = val;\r\n      }\r\n    }\r\n\r\n    dokey(\"padding\");\r\n    dokey(\"padding-top\");\r\n    dokey(\"padding-left\");\r\n    dokey(\"padding-right\");\r\n    dokey(\"padding-bottom\");\r\n\r\n    if (this.items.length > 15 && this.autoSearchMode) {\r\n      return this.start_fancy(prepend, setActive);\r\n    }\r\n\r\n    if (prepend) {\r\n      this.container.prepend(this.dom);\r\n    } else {\r\n      this.container.appendChild(this.dom);\r\n    }\r\n\r\n    if (!setActive)\r\n      return;\r\n\r\n    this.setCSS();\r\n    this.flushUpdate();\r\n\r\n    window.setTimeout(() => {\r\n      this.flushUpdate();\r\n\r\n      //select first child\r\n      //TODO: cache last child entry\r\n\r\n      if (this.activeItem === undefined) {\r\n        this.activeItem = this.dom.childNodes[0];\r\n      }\r\n\r\n      if (this.activeItem === undefined) {\r\n        return;\r\n      }\r\n\r\n      this.activeItem.focus();\r\n    }, 0);\r\n  }\r\n\r\n  addItemExtra(text, id = undefined, hotkey, icon = -1, add = true, tooltip = undefined) {\r\n    let dom = document.createElement(\"span\");\r\n\r\n    dom.style[\"display\"] = \"inline-flex\";\r\n\r\n    dom.hotkey = hotkey;\r\n    dom.icon = icon;\r\n\r\n    let icon_div;\r\n\r\n    if (1) { //icon >= 0) {\r\n      icon_div = ui_base.makeIconDiv(icon, IconSheets.SMALL);\r\n    } else {\r\n      let tilesize = ui_base.iconmanager.getTileSize(IconSheets.SMALL);\r\n\r\n      //tilesize *= window.devicePixelRatio;\r\n\r\n      icon_div = document.createElement(\"span\");\r\n      icon_div.style[\"padding\"] = icon_div.style[\"margin\"] = \"0px\";\r\n      icon_div.style[\"width\"] = tilesize + \"px\";\r\n      icon_div.style[\"height\"] = tilesize + \"px\";\r\n    }\r\n\r\n    icon_div.style[\"display\"] = \"inline-flex\";\r\n    icon_div.style[\"margin-right\"] = \"1px\";\r\n    icon_div.style[\"align\"] = \"left\";\r\n\r\n    let span = document.createElement(\"span\");\r\n\r\n    //stupid css doesn't get width right. . .\r\n    span.style[\"font\"] = ui_base.getFont(this, undefined, \"MenuText\");\r\n\r\n    let dpi = this.getDPI();\r\n    let tsize = this.getDefault(\"MenuText\").size;\r\n    //XXX proportional font fail\r\n\r\n    //XXX stupid!\r\n    let canvas = document.createElement(\"canvas\");\r\n    let g = canvas.getContext(\"2d\");\r\n\r\n    g.font = span.style[\"font\"];\r\n\r\n    let rect = span.getClientRects();\r\n\r\n    let twid = Math.ceil(g.measureText(text).width);\r\n    let hwid;\r\n    if (hotkey) {\r\n      dom.hotkey = hotkey;\r\n      g.font = ui_base.getFont(this, undefined, \"HotkeyText\");\r\n      hwid = Math.ceil(g.measureText(hotkey).width/UIBase.getDPI());\r\n      twid += hwid + 8;\r\n    }\r\n\r\n    //let twid = Math.ceil(text.trim().length * tsize / dpi);\r\n\r\n    span.innerText = text;\r\n\r\n    span.style[\"word-wrap\"] = \"none\";\r\n    span.style[\"white-space\"] = \"pre\";\r\n    span.style[\"overflow\"] = \"hidden\";\r\n    span.style[\"text-overflow\"] = \"clip\";\r\n\r\n    span.style[\"width\"] = ~~(twid) + \"px\";\r\n    span.style[\"padding\"] = \"0px\";\r\n    span.style[\"margin\"] = \"0px\";\r\n\r\n    dom.style[\"width\"] = \"100%\";\r\n\r\n    dom.appendChild(icon_div);\r\n    dom.appendChild(span);\r\n\r\n    if (hotkey) {\r\n      let hotkey_span = document.createElement(\"span\");\r\n      hotkey_span.innerText = hotkey;\r\n      hotkey_span.style[\"display\"] = \"inline-flex\";\r\n\r\n      hotkey_span.style[\"margin\"] = \"0px\";\r\n      hotkey_span.style[\"margin-left\"] = \"auto\";\r\n      hotkey_span.style[\"margin-right\"] = \"0px\";\r\n      hotkey_span.style[\"padding\"] = \"0px\";\r\n\r\n      hotkey_span.style[\"font\"] = ui_base.getFont(this, undefined, \"HotkeyText\");\r\n      hotkey_span.style[\"color\"] = this.getDefault(\"HotkeyTextColor\");\r\n\r\n      //hotkey_span.style[\"width\"] = ~~((hwid + 7)) + \"px\";\r\n      hotkey_span.style[\"width\"] = \"max-content\";\r\n\r\n      //hotkey_span.style[\"background-color\"] = \"rgba(0,0,0,0)\";\r\n\r\n      hotkey_span.style[\"text-align\"] = \"right\";\r\n      hotkey_span.style[\"justify-content\"] = \"right\";\r\n      hotkey_span[\"flex-wrap\"] = \"nowrap\";\r\n      hotkey_span[\"text-wrap\"] = \"nowrap\";\r\n\r\n      //hotkey_span.style[\"border\"] = \"1px solid red\";\r\n\r\n      //hotkey_span.style[\"display\"] = \"inline\";\r\n      //hotkey_span.style[\"float\"] = \"right\";\r\n\r\n      dom.appendChild(hotkey_span);\r\n    }\r\n\r\n    let ret = this.addItem(dom, id, add);\r\n\r\n    ret.hotkey = hotkey;\r\n    ret.icon = icon;\r\n    ret.label = text ? text : ret.innerText;\r\n\r\n    if (tooltip) {\r\n      ret.title = tooltip;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  //item can be menu or text\r\n  addItem(item, id, add = true, tooltip = undefined) {\r\n    id = id === undefined ? item : id;\r\n    let text = item;\r\n\r\n    if (typeof item === \"string\" || item instanceof String) {\r\n      let dom = document.createElement(\"dom\");\r\n      dom.style[\"text-align\"] = \"left\";\r\n\r\n      dom.textContent = item;\r\n      item = dom;\r\n      //return this.addItemExtra(item, id);\r\n    } else {\r\n      text = item.textContent;\r\n    }\r\n\r\n    let li = document.createElement(\"li\");\r\n\r\n    li.setAttribute(\"tabindex\", this.itemindex++);\r\n    li.setAttribute(\"class\", \"menuitem\");\r\n\r\n    if (tooltip !== undefined) {\r\n      li.title = tooltip;\r\n    }\r\n\r\n    if (item instanceof Menu) {\r\n      //let dom = this.addItemExtra(\"\"+item.title, id, \"\", -1, false);\r\n      let dom = document.createElement(\"span\");\r\n      dom.innerHTML = \"\" + item.title;\r\n      dom._id = dom.id = id;\r\n      dom.setAttribute(\"class\", \"menu\")\r\n\r\n      //dom = document.createElement(\"div\");\r\n      //dom.innerText = \"\"+item.title;\r\n\r\n      //dom.style[\"display\"] = \"inline-block\";\r\n      li.style[\"width\"] = \"100%\"\r\n      li.appendChild(dom);\r\n\r\n      li._isMenu = true;\r\n      li._menu = item;\r\n      item.parentMenu = this;\r\n\r\n      item.hidden = false;\r\n      item.container = this.container;\r\n    } else {\r\n      li._isMenu = false;\r\n      li.appendChild(item);\r\n    }\r\n\r\n    li._id = id;\r\n\r\n    this.items.push(li);\r\n\r\n    li.label = text ? text : li.innerText.trim();\r\n\r\n    if (add) {\r\n      li.addEventListener(\"blur\", (e) => {\r\n        if (this._ignoreFocusEvents) {\r\n          return;\r\n        }\r\n\r\n        if (this.activeItem && !this.activeItem._isMenu) {\r\n          this.setActive(undefined, false);\r\n        }\r\n      });\r\n\r\n      let onfocus = (e) => {\r\n        if (this._ignoreFocusEvents) {\r\n          return;\r\n        }\r\n\r\n        let active = this.activeItem;\r\n\r\n        if (this._submenu) {\r\n          this._submenu.close();\r\n          this._submenu = undefined;\r\n        }\r\n\r\n        if (li._isMenu) {\r\n          li._menu.onselect = (item) => {\r\n            this.onselect(item);\r\n            li._menu.close();\r\n            this.close();\r\n          };\r\n\r\n          li._menu.start(false, false);\r\n          this._submenu = li._menu;\r\n        }\r\n\r\n        this.setActive(li, false);\r\n      };\r\n\r\n      let onclick = (e) => {\r\n        onfocus(e);\r\n\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n\r\n        if (this.activeItem !== undefined && this.activeItem._isMenu) {\r\n          //ignore\r\n          return;\r\n        }\r\n\r\n        this.click();\r\n      }\r\n\r\n      li.addEventListener(\"contextmenu\", e => e.preventDefault());\r\n      this.addEventListener(\"contextmenu\", e => e.preventDefault());\r\n\r\n      li.addEventListener(\"pointerup\", onclick, {capture: true});\r\n      li.addEventListener(\"click\", onclick, {capture: true});\r\n      li.addEventListener(\"pointerdown\", onclick, {capture: true});\r\n\r\n      li.addEventListener(\"focus\", (e) => {\r\n        onfocus(e);\r\n        onfocus(e);\r\n      })\r\n\r\n      li.addEventListener(\"pointermove\", (e) => {\r\n        onfocus(e);\r\n        li.focus();\r\n      });\r\n      li.addEventListener(\"mouseover\", (e) => {\r\n        onfocus(e);\r\n        li.focus();\r\n      });\r\n      li.addEventListener(\"mouseenter\", (e) => {\r\n        onfocus(e);\r\n        li.focus();\r\n      });\r\n\r\n      li.addEventListener(\"pointerover\", (e) => {\r\n        onfocus(e);\r\n        li.focus();\r\n      });\r\n\r\n      this.dom.appendChild(li);\r\n    }\r\n\r\n    return li;\r\n  }\r\n\r\n  _getBorderStyle() {\r\n    let r = this.getDefault(\"border-width\");\r\n    let s = this.getDefault(\"border-style\");\r\n    let c = this.getDefault(\"border-color\");\r\n\r\n    return `${r}px ${s} ${c}`;\r\n  }\r\n\r\n  buildStyle() {\r\n    let pad1 = util.isMobile() ? 2 : 0;\r\n    pad1 += this.getDefault(\"MenuSpacing\");\r\n\r\n    let boxShadow = \"\";\r\n    if (this.hasDefault(\"box-shadow\")) {\r\n      boxShadow = \"box-shadow: \" + this.getDefault(\"box-shadow\") + ';';\r\n    }\r\n\r\n    let sepcss = this.getDefault(\"MenuSeparator\");\r\n    if (typeof sepcss === \"object\") {\r\n      let s = '';\r\n\r\n      for (let k in sepcss) {\r\n        let v = sepcss[k];\r\n\r\n        if (typeof v === \"number\") {\r\n          v = v.toFixed(4) + \"px\";\r\n        }\r\n\r\n        s += `    ${k}: ${v};\\n`;\r\n      }\r\n\r\n      sepcss = s;\r\n    }\r\n\r\n    let itemRadius = 0;\r\n\r\n    if (this.hasDefault(\"item-radius\")) {\r\n      itemRadius = this.getDefault(\"item-radius\");\r\n    } else {\r\n      itemRadius = this.getDefault(\"border-radius\");\r\n    }\r\n\r\n    this.menustyle.textContent = `\r\n        .menucon {\r\n          position:fixed;\r\n          float:left;\r\n          \r\n          border-radius : ${this.getDefault(\"border-radius\")}px;\r\n\r\n          display: block;\r\n          -moz-user-focus: normal;\r\n          ${boxShadow}\r\n        }\r\n        \r\n        ul.menu {\r\n          display        : flex;\r\n          flex-direction : column;\r\n          flex-wrap      : nowrap;\r\n          width          : max-content;\r\n          \r\n          margin : 0px;\r\n          padding : 0px;\r\n          border : ${this._getBorderStyle()};\r\n          border-radius : ${this.getDefault(\"border-radius\")}px;\r\n          -moz-user-focus: normal;\r\n          background-color: ${this.getDefault(\"MenuBG\")};\r\n          color : ${this.getDefault(\"MenuText\").color};\r\n        }\r\n        \r\n        .menuitem {\r\n          display : flex;\r\n          flex-wrap : nowrap;\r\n          flex-direction : row;          \r\n          \r\n          list-style-type:none;\r\n          -moz-user-focus: normal;\r\n          \r\n          margin : 0;\r\n          padding : 0px;\r\n          padding-right: 16px;\r\n          padding-left: 16px;\r\n          padding-top : ${pad1}px;\r\n          padding-bottom : ${pad1}px;\r\n          \r\n          border-radius : ${itemRadius}px;\r\n          \r\n          color : ${this.getDefault(\"MenuText\").color};\r\n          font : ${this.getDefault(\"MenuText\").genCSS()};\r\n          background-color: ${this.getDefault(\"MenuBG\")};\r\n        }\r\n        \r\n        .menuseparator {\r\n          ${sepcss}\r\n        }\r\n        \r\n        .menuitem:focus {\r\n          display : flex;\r\n          text-align: left;\r\n          \r\n          border : none;\r\n          outline : none;\r\n          border-radius : ${itemRadius}px;\r\n          \r\n          background-color: ${this.getDefault(\"MenuHighlight\")};\r\n          color : ${this.getDefault(\"MenuText\").color};\r\n          -moz-user-focus: normal;\r\n        }\r\n      `;\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.buildStyle();\r\n\r\n    this.container.style[\"color\"] = this.getDefault(\"MenuText\").color;\r\n    this.style[\"color\"] = this.getDefault(\"MenuText\").color;\r\n  }\r\n\r\n  seperator() {\r\n    let bar = document.createElement(\"div\");\r\n    bar.setAttribute(\"class\", \"menuseparator\");\r\n\r\n    this.dom.appendChild(bar);\r\n\r\n    return this;\r\n  }\r\n\r\n  menu(title) {\r\n    let ret = UIBase.createElement(\"menu-x\");\r\n\r\n    ret.setAttribute(\"name\", title);\r\n    this.addItem(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  calcSize() {\r\n\r\n  }\r\n}\r\n\r\nMenu.SEP = Symbol(\"menu seperator\");\r\nUIBase.internalRegister(Menu);\r\n\r\nexport class DropBox extends OldButton {\r\n  constructor() {\r\n    super();\r\n\r\n    this.lockTimer = 0;\r\n\r\n    this._template = undefined;\r\n\r\n    this._searchMenuMode = false;\r\n    this.altKey = undefined;\r\n\r\n    this._value = 0;\r\n\r\n    this._last_datapath = undefined;\r\n\r\n    this.r = 5;\r\n    this._menu = undefined;\r\n    this._auto_depress = false;\r\n    //this.prop = new ui_base.EnumProperty(undefined, {}, \"\", \"\", 0);\r\n\r\n    this._onpress = this._onpress.bind(this);\r\n  }\r\n\r\n  get searchMenuMode() {\r\n    return this._searchMenuMode;\r\n  }\r\n\r\n  set searchMenuMode(v) {\r\n    this._searchMenuMode = v;\r\n  }\r\n\r\n  get template() {\r\n    return this._template;\r\n  }\r\n\r\n  set template(v) {\r\n    this._template = v;\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(v) {\r\n    this.setValue(v);\r\n  }\r\n\r\n  get menu() {\r\n    return this._menu;\r\n  }\r\n\r\n  set menu(val) {\r\n    this._menu = val;\r\n\r\n    if (val !== undefined) {\r\n      this._name = val.title;\r\n      this.updateName();\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"dropbox-x\",\r\n      style  : \"dropbox\"\r\n    };\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.setAttribute(\"menu-button\", \"true\");\r\n\r\n    this.updateWidth();\r\n  }\r\n\r\n  setCSS() {\r\n    //do not call parent classes's setCSS here\r\n\r\n    this.style[\"user-select\"] = \"none\";\r\n    this.dom.style[\"user-select\"] = \"none\";\r\n\r\n    let keys;\r\n    if (this.getAttribute(\"simple\")) {\r\n      keys = [\"margin-left\", \"margin-right\", \"padding-left\", \"padding-right\"];\r\n    } else {\r\n      keys = [\r\n        \"margin\", \"margin-left\", \"margin-right\",\r\n        \"margin-top\", \"margin-bottom\", \"padding\",\r\n        \"padding-left\", \"padding-right\", \"padding-top\",\r\n        \"padding-bottom\"];\r\n    }\r\n\r\n    let setDefault = (key) => {\r\n      if (this.hasDefault(key)) {\r\n        this.dom.style[key] = this.getDefault(key, undefined, 0) + \"px\";\r\n      }\r\n    }\r\n\r\n    for (let k of keys) {\r\n      setDefault(k);\r\n    }\r\n  }\r\n\r\n  _genLabel() {\r\n    let s = super._genLabel();\r\n    let ret = \"\";\r\n\r\n    if (s.length === 0) {\r\n      s = \"(error)\";\r\n    }\r\n\r\n    this.altKey = s[0].toUpperCase().charCodeAt(0);\r\n\r\n    for (let i = 0; i < s.length; i++) {\r\n      if (s[i] === \"&\" && i < s.length - 1 && s[i + 1] !== \"&\") {\r\n        this.altKey = s[i + 1].toUpperCase().charCodeAt(0);\r\n      } else if (s[i] === \"&\" && i < s.length - 1 && s[i + 1] === \"&\") {\r\n        continue;\r\n      } else {\r\n        ret += s[i];\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  updateWidth() {\r\n    //let ret = super.updateWidth(10);\r\n    let dpi = this.getDPI();\r\n\r\n    let ts = this.getDefault(\"DefaultText\").size;\r\n    let tw = this.g.measureText(this._genLabel()).width/dpi;\r\n    //let tw = ui_base.measureText(this, this._genLabel(), undefined, undefined, ts).width + 8;\r\n    tw = ~~tw;\r\n\r\n    tw += 15;\r\n\r\n    if (!this.getAttribute(\"simple\")) {\r\n      tw += 35;\r\n    }\r\n\r\n    if (tw !== this._last_w) {\r\n      this._last_w = tw;\r\n      this.dom.style[\"width\"] = tw + \"px\";\r\n      this.style[\"width\"] = tw + \"px\";\r\n      this.width = tw;\r\n\r\n      this.overrideDefault(\"width\", tw);\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n\r\n    return 0;\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.ctx || !this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let wasError = false;\r\n    let prop, val;\r\n\r\n    try {\r\n      this.pushReportContext(this._reportCtxName);\r\n      prop = this.ctx.api.resolvePath(this.ctx, this.getAttribute(\"datapath\")).prop;\r\n      val = this.ctx.api.getValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n      prop = prop && prop.prop ? prop.prop : prop;\r\n\r\n      this.popReportContext();\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n      wasError = true;\r\n    }\r\n\r\n    if (wasError) {\r\n      this.disabled = true;\r\n      this.setCSS();\r\n      this._redraw();\r\n\r\n      return;\r\n    } else {\r\n      this.disabled = false;\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n\r\n    if (!prop) {\r\n      return;\r\n    }\r\n\r\n    if (this.prop === undefined) {\r\n      this.prop = prop;\r\n    }\r\n\r\n    prop = this.prop;\r\n\r\n    let name = this.getAttribute(\"name\");\r\n    \r\n    if (prop.type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n      name = prop.ui_value_names[prop.keys[val]];\r\n    } else {\r\n      name = \"\" + val;\r\n    }\r\n\r\n    if (name !== this.getAttribute(\"name\")) {\r\n      this.setAttribute(\"name\", name);\r\n      this.updateName();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    let path = this.getAttribute(\"datapath\");\r\n\r\n    if (path && path !== this._last_datapath) {\r\n      this._last_datapath = path;\r\n      this.prop = undefined;\r\n\r\n      this.updateDataPath();\r\n    }\r\n\r\n    super.update();\r\n\r\n    let key = this.getDefault(\"dropTextBG\");\r\n    if (key !== this._last_dbox_key) {\r\n      this._last_dbox_key = key;\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n  }\r\n\r\n  _build_menu_template() {\r\n    if (this._menu !== undefined && this._menu.parentNode !== undefined) {\r\n      this._menu.remove();\r\n    }\r\n\r\n    //let name = \"\" + this.getAttribute(\"name\");\r\n    let template = this._template;\r\n\r\n    if (typeof template === \"function\") {\r\n      template = template();\r\n    }\r\n\r\n    this._menu = createMenu(this.ctx, \"\", template);\r\n    return this._menu;\r\n  }\r\n\r\n  _build_menu() {\r\n    if (this._template) {\r\n      this._build_menu_template();\r\n      return;\r\n    }\r\n\r\n    let prop = this.prop;\r\n\r\n    if (this.prop === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this._menu !== undefined && this._menu.parentNode !== undefined) {\r\n      this._menu.remove();\r\n    }\r\n\r\n    let menu = this._menu = UIBase.createElement(\"menu-x\");\r\n\r\n    //let name = \"\" + this.getAttribute(\"name\");\r\n    menu.setAttribute(\"name\", \"\");\r\n    menu._dropbox = this;\r\n\r\n    let valmap = {};\r\n    let enummap = prop.values;\r\n    let iconmap = prop.iconmap;\r\n    let uimap = prop.ui_value_names;\r\n    let desr = prop.descriptions || {};\r\n\r\n    for (let k in enummap) {\r\n      let uk = k;\r\n\r\n      valmap[enummap[k]] = k;\r\n\r\n      if (uimap !== undefined && k in uimap) {\r\n        uk = uimap[k];\r\n      }\r\n\r\n      let tooltip = desr[k];\r\n\r\n      //menu.addItem(k, enummap[k], \":\");\r\n      if (iconmap && iconmap[k]) {\r\n        menu.addItemExtra(uk, enummap[k], undefined, iconmap[k], undefined, tooltip);\r\n      } else {\r\n        menu.addItem(uk, enummap[k], undefined, tooltip);\r\n      }\r\n    }\r\n\r\n    menu.onselect = (id) => {\r\n      this._pressed = false;\r\n\r\n      this._pressed = false;\r\n      this._redraw();\r\n\r\n      this._menu = undefined;\r\n\r\n      //check if datapath system will be calling .prop.setValue instead of us\r\n      let callProp = true;\r\n      if (this.hasAttribute(\"datapath\")) {\r\n        let rdef = this.ctx.api.resolvePath(this.ctx, this.getAttribute(\"datapath\"));\r\n        let prop = rdef.dpath.data;\r\n\r\n        callProp = !rdef || !rdef.dpath || !(rdef.dpath.data instanceof ToolProperty);\r\n      }\r\n\r\n      this._value = this._convertVal(id);\r\n\r\n      if (callProp) {\r\n        this.prop.setValue(id);\r\n      }\r\n\r\n      this.setAttribute(\"name\", this.prop.ui_value_names[valmap[id]]);\r\n      if (this.onselect) {\r\n        this.onselect(id);\r\n      }\r\n\r\n      if (this.hasAttribute(\"datapath\") && this.ctx) {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), id);\r\n      }\r\n    };\r\n  }\r\n\r\n  _onpress(e) {\r\n    this.abortToolTips(1000);\r\n\r\n    if (this._menu !== undefined) {\r\n      this.lockTimer = util.time_ms();\r\n\r\n      this._pressed = false;\r\n      this._redraw();\r\n\r\n      let menu = this._menu;\r\n      this._menu = undefined;\r\n      menu.close();\r\n      return;\r\n    }\r\n\r\n    if (util.time_ms() - this.lockTimer < 200) {\r\n      return;\r\n    }\r\n\r\n    this._build_menu();\r\n\r\n    if (this._menu === undefined) {\r\n      return;\r\n    }\r\n\r\n    this._menu.autoSearchMode = false;\r\n\r\n    this._menu._dropbox = this;\r\n    this.dom._background = this.getDefault(\"BoxDepressed\");\r\n    this._background = this.getDefault(\"BoxDepressed\");\r\n    this._redraw();\r\n    this._pressed = true;\r\n    this.setCSS();\r\n\r\n    let onclose = this._menu.onclose;\r\n    this._menu.onclose = () => {\r\n      this.lockTimer = util.time_ms();\r\n\r\n      this._pressed = false;\r\n      this._redraw();\r\n\r\n      let menu = this._menu;\r\n      if (menu) {\r\n        this._menu = undefined;\r\n        menu._dropbox = undefined;\r\n      }\r\n\r\n      if (onclose) {\r\n        onclose.call(menu);\r\n      }\r\n    }\r\n\r\n    let menu = this._menu;\r\n    let screen = this.getScreen();\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let x = e.x, y = e.y;\r\n    let rects = this.dom.getBoundingClientRect(); //getClientRects();\r\n\r\n    let rheight = rects.height;\r\n    x = rects.x - window.scrollX;\r\n    y = rects.y + rheight - window.scrollY; // + rects[0].height; // visualViewport.scale;\r\n\r\n    if (!window.haveElectron) {\r\n      //y -= 8;\r\n    }\r\n\r\n    /* need to figure out a better way to pop up a menu\r\n    *  above a given y position */\r\n    if (cconst.menusCanPopupAbove && y > screen.size[1]*0.5 && !this.searchMenuMode) {\r\n      let con = screen.popup(this, 500, 400, false, 0);\r\n\r\n      con.style[\"z-index\"] = \"-10000\";\r\n      con.style[\"position\"] = UIBase.PositionKey;\r\n      document.body.appendChild(con);\r\n\r\n      con.style[\"visibility\"] = \"hidden\";\r\n\r\n      con.add(menu);\r\n      menu.start();\r\n\r\n      let time = util.time_ms();\r\n\r\n      let timer = window.setInterval(() => {\r\n        if (util.time_ms() - time > 1500) {\r\n          window.clearInterval(timer);\r\n          return;\r\n        }\r\n\r\n        let r = menu.dom.getBoundingClientRect();\r\n\r\n        if (!r || r.height < 55) {\r\n          return;\r\n        }\r\n\r\n        window.clearInterval(timer);\r\n\r\n        y -= r.height + rheight;\r\n\r\n        menu.dom.remove();\r\n        con.remove();\r\n\r\n        let popup = this._popup = menu._popup = screen.popup(this, x, y, false, 0);\r\n        popup.noMarginsOrPadding();\r\n\r\n        //popup.shadow.appendChild(menu.dom);\r\n        popup.add(menu);\r\n        menu.start();\r\n\r\n        popup.style[\"left\"] = x + \"px\";\r\n        popup.style[\"top\"] = y + \"px\";\r\n        //menu.setCSS();\r\n      }, 1);\r\n\r\n      return;\r\n    }\r\n\r\n    /*\r\n    let w = document.createElement(\"div\");\r\n    w.style[\"width\"] = w.style[\"height\"] = \"15px\";\r\n    w.style[\"background-color\"] = \"red\";\r\n    w.style[\"z-index\"] = \"5000\";\r\n    w.style[\"position\"] = UIBase.PositionKey;\r\n    w.style[\"pointer-events\"] = \"none\";\r\n    w.style[\"left\"] = x + \"px\";\r\n    w.style[\"top\"] = y + \"px\";\r\n\r\n    document.body.appendChild(w);\r\n    //*/\r\n\r\n    let con = this._popup = menu._popup = screen.popup(this, x, y, false, 0);\r\n    con.noMarginsOrPadding();\r\n\r\n    con.add(menu);\r\n    if (this.searchMenuMode) {\r\n      menu.startFancy();\r\n    } else {\r\n      menu.start();\r\n    }\r\n  }\r\n\r\n  _redraw() {\r\n    if (this.getAttribute(\"simple\")) {\r\n      let color;\r\n\r\n      this.g.clearRect(0, 0, this.dom.width, this.dom.height);\r\n      \r\n      if (this._highlight) {\r\n        ui_base.drawRoundBox2(this, {canvas: this.dom, g: this.g, color: this.getDefault(\"BoxHighlight\")});\r\n      }\r\n\r\n      if (this._focus) {\r\n        ui_base.drawRoundBox2(this, {\r\n          canvas: this.dom, g: this.g, color: this.getDefault(\"BoxHighlight\"), op: \"stroke\", no_clear: true\r\n        });\r\n        ui_base.drawRoundBox(this, this.dom, this.g, undefined, undefined, 2, \"stroke\");\r\n      }\r\n\r\n      this._draw_text();\r\n      return;\r\n    }\r\n\r\n    super._redraw(false);\r\n\r\n    let g = this.g;\r\n    let w = this.dom.width, h = this.dom.height;\r\n    let dpi = this.getDPI();\r\n\r\n    let p = 10*dpi;\r\n    let p2 = dpi;\r\n\r\n    //*\r\n    let bg = this.getDefault(\"dropTextBG\");\r\n    if (bg !== undefined) {\r\n      g.fillStyle = bg;\r\n\r\n      g.beginPath();\r\n      g.rect(p2, p2, this.dom.width - p2 - h, this.dom.height - p2*2);\r\n      g.fill();\r\n    }\r\n    //*/\r\n\r\n    g.fillStyle = \"rgba(50, 50, 50, 0.2)\";\r\n    g.strokeStyle = \"rgba(50, 50, 50, 0.8)\";\r\n    g.beginPath();\r\n    /*\r\n    g.moveTo(w-p, p);\r\n    g.lineTo(w-(p+h*0.25), h-p);\r\n    g.lineTo(w-(p+h*0.5), p);\r\n    g.closePath();\r\n    //*/\r\n\r\n    let sz = 0.3;\r\n    g.moveTo(w - h*0.5 - p, p);\r\n    g.lineTo(w - p, p);\r\n    g.moveTo(w - h*0.5 - p, p + sz*h/3);\r\n    g.lineTo(w - p, p + sz*h/3);\r\n    g.moveTo(w - h*0.5 - p, p + sz*h*2/3);\r\n    g.lineTo(w - p, p + sz*h*2/3);\r\n\r\n    g.lineWidth = 1;\r\n    g.stroke();\r\n\r\n    this._draw_text();\r\n  }\r\n\r\n  _convertVal(val) {\r\n    if (typeof val === \"string\" && this.prop) {\r\n      if (val in this.prop.values) {\r\n        return this.prop.values[val];\r\n      } else if (val in this.prop.keys) {\r\n        return this.prop.keys[val];\r\n      } else {\r\n        return undefined;\r\n      }\r\n    }\r\n\r\n    return val;\r\n  }\r\n\r\n  setValue(val, setLabelOnly = false) {\r\n    if (val === undefined || val === this._value) {\r\n      return;\r\n    }\r\n\r\n    val = this._convertVal(val);\r\n\r\n    if (val === undefined) {\r\n      console.warn(\"Bad val\", arguments[0]);\r\n      return;\r\n    }\r\n\r\n    this._value = val;\r\n\r\n    if (this.prop !== undefined && !setLabelOnly) {\r\n      this.prop.setValue(val);\r\n      let val2 = val;\r\n\r\n      if (val2 in this.prop.keys)\r\n        val2 = this.prop.keys[val2];\r\n      val2 = this.prop.ui_value_names[val2];\r\n\r\n      this.setAttribute(\"name\", \"\" + val2);\r\n      this._name = \"\" + val2;\r\n    } else {\r\n      this.setAttribute(\"name\", \"\" + val);\r\n      this._name = \"\" + val;\r\n    }\r\n\r\n    if (this.onchange && !setLabelOnly) {\r\n      this.onchange(val);\r\n    }\r\n\r\n    this.setCSS();\r\n    this.updateDataPath();\r\n    this._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(DropBox);\r\n\r\nexport class MenuWrangler {\r\n  constructor() {\r\n    this.screen = undefined;\r\n    this.menustack = [];\r\n\r\n    this.lastPickElemTime = util.time_ms();\r\n\r\n    this._closetimer = 0;\r\n    this.closeOnMouseUp = undefined;\r\n    this.closereq = undefined;\r\n\r\n    this.timer = undefined;\r\n  }\r\n\r\n  get closetimer() {\r\n    return this._closetimer;\r\n  }\r\n\r\n  set closetimer(v) {\r\n    debugmenu(\"set closertime\", v);\r\n    this._closetimer = v;\r\n  }\r\n\r\n  get menu() {\r\n    return this.menustack.length > 0 ? this.menustack[this.menustack.length - 1] : undefined;\r\n  }\r\n\r\n  pushMenu(menu) {\r\n    debugmenu(\"pushMenu\");\r\n\r\n    this.spawnreq = undefined;\r\n\r\n    if (this.menustack.length === 0 && menu.closeOnMouseUp) {\r\n      this.closeOnMouseUp = true;\r\n    }\r\n\r\n    this.menustack.push(menu);\r\n  }\r\n\r\n  popMenu(menu) {\r\n    debugmenu(\"popMenu\");\r\n\r\n    return this.menustack.pop();\r\n  }\r\n\r\n  endMenus() {\r\n    debugmenu(\"endMenus\");\r\n\r\n    for (let menu of this.menustack) {\r\n      menu.close();\r\n    }\r\n\r\n    this.menustack = [];\r\n  }\r\n\r\n  searchKeyDown(e) {\r\n    let menu = this.menu;\r\n\r\n    e.stopPropagation();\r\n    menu._ignoreFocusEvents = true;\r\n    menu.textbox.focus();\r\n    menu._ignoreFocusEvents = false;\r\n\r\n    //if (e.shiftKey || e.altKey || e.ctrlKey || e.commandKey) {\r\n    //  return;\r\n    //}\r\n\r\n    switch (e.keyCode) {\r\n      case keymap[\"Enter\"]: //return key\r\n        menu.click(menu.activeItem);\r\n        break;\r\n      case keymap[\"Escape\"]: //escape key\r\n        menu.close();\r\n        break;\r\n      case keymap[\"Up\"]:\r\n        menu.selectPrev(false);\r\n        break;\r\n      case keymap[\"Down\"]:\r\n        menu.selectNext(false);\r\n        break;\r\n    }\r\n  }\r\n\r\n  on_keydown(e) {\r\n    window.menu = this.menu;\r\n\r\n    if (this.menu === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this.menu.hasSearchBox) {\r\n      return this.searchKeyDown(e);\r\n    }\r\n\r\n    let menu = this.menu;\r\n\r\n    switch (e.keyCode) {\r\n      case keymap[\"Left\"]: //left\r\n      case keymap[\"Right\"]: //right\r\n        if (menu._dropbox) {\r\n          let dropbox = menu._dropbox;\r\n\r\n          if (e.keyCode === keymap[\"Left\"]) {\r\n            dropbox = dropbox.previousElementSibling;\r\n          } else {\r\n            dropbox = dropbox.nextElementSibling;\r\n          }\r\n\r\n          if (dropbox !== undefined && dropbox instanceof DropBox) {\r\n            this.endMenus();\r\n            dropbox._onpress(e);\r\n          }\r\n        }\r\n        break;\r\n      case keymap[\"Up\"]: //up\r\n        menu.selectPrev();\r\n        break;\r\n      case keymap[\"Down\"]: //down\r\n        menu.selectNext();\r\n        break;\r\n      /*\r\n      let item = menu.activeItem;\r\n      if (!item) {\r\n        item = menu.items[0];\r\n      }\r\n\r\n      if (!item) {\r\n        return;\r\n      }\r\n\r\n      let item2;\r\n      let i = menu.items.indexOf(item);\r\n\r\n      if (e.keyCode == 38) {\r\n        i = (i - 1 + menu.items.length) % menu.items.length;\r\n      } else {\r\n        i = (i + 1) % menu.items.length;\r\n      }\r\n\r\n      item2 = menu.items[i];\r\n\r\n      if (item2) {\r\n        menu.setActive(item2);\r\n      }\r\n      break;//*/\r\n      case 13: //return key\r\n      case 32: //space key\r\n        menu.click(menu.activeItem);\r\n        break;\r\n      case 27: //escape key\r\n        menu.close();\r\n        break;\r\n    }\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    if (this.menu === undefined || this.screen === undefined) {\r\n      this.closetimer = util.time_ms();\r\n      return;\r\n    }\r\n\r\n    let screen = this.screen;\r\n    let x = e.pageX, y = e.pageY;\r\n\r\n    let element = screen.pickElement(x, y);\r\n\r\n    if (element !== undefined && (element instanceof DropBox || util.isMobile())) {\r\n      this.endMenus();\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    if (this.menu === undefined || this.screen === undefined) {\r\n      this.closetimer = util.time_ms();\r\n      return;\r\n    }\r\n\r\n    let screen = this.screen;\r\n    let x = e.pageX, y = e.pageY;\r\n\r\n    let element = screen.pickElement(x, y, undefined, undefined, DropBox);\r\n    if (element !== undefined) {\r\n      this.closeOnMouseUp = false;\r\n    } else {\r\n      element = screen.pickElement(x, y, undefined, undefined, Menu);\r\n\r\n      //closeOnMouseUp\r\n      if (element && this.closeOnMouseUp) {\r\n        element.click();\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  findMenu(x, y) {\r\n    let screen = this.screen;\r\n\r\n    let element = screen.pickElement(x, y);\r\n\r\n    if (element === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (element instanceof Menu) {\r\n      return element;\r\n    }\r\n\r\n    let w = element;\r\n\r\n    while (w) {\r\n      if (w instanceof Menu) {//w === this.menu) {\r\n        return w;\r\n        break;\r\n      }\r\n\r\n      w = w.parentWidget;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    if (this.menu && this.menu.hasSearchBox) {\r\n      this.closetimer = util.time_ms();\r\n      this.closereq = undefined;\r\n      return;\r\n    }\r\n\r\n    if (this.menu === undefined || this.screen === undefined) {\r\n      this.closetimer = util.time_ms();\r\n      this.closereq = undefined;\r\n      return;\r\n    }\r\n\r\n    let screen = this.screen;\r\n    let x = e.pageX, y = e.pageY;\r\n\r\n    let element;\r\n    let menu = this.menu;\r\n\r\n    if (menu) {\r\n      let r = menu.getBoundingClientRect();\r\n      let pad = 15;\r\n\r\n      if (r && x >= r.x - pad && y >= r.y - pad && x <= r.x + r.width + pad*2 && y <= r.y + r.height + pad*2) {\r\n        element = menu;\r\n      }\r\n    }\r\n\r\n    if (!element && util.time_ms() - this.lastPickElemTime > 250) {\r\n      element = screen.pickElement(x, y);\r\n      this.lastPickElemTime = util.time_ms();\r\n    }\r\n\r\n    if (element === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (element instanceof Menu) {\r\n      this.closetimer = util.time_ms();\r\n      this.closereq = undefined;\r\n      return;\r\n    }\r\n    \r\n    let destroy = element.hasAttribute(\"menu-button\") && element.hasAttribute(\"simple\");\r\n    destroy = destroy && element.menu !== this.menu;\r\n\r\n    if (destroy) {\r\n      /* check that dropbox doesn't contain our parent menu either */\r\n\r\n      let menu2 = this.menu;\r\n      while (menu2 !== element.menu) {\r\n        menu2 = menu2.parentMenu;\r\n        destroy = destroy && (menu2 === undefined || menu2 !== element.menu);\r\n      }\r\n    }\r\n\r\n    if (destroy) {\r\n      //destroy entire menu stack\r\n      this.endMenus();\r\n\r\n      this.closetimer = util.time_ms();\r\n      this.closereq = undefined;\r\n\r\n      //start new menu\r\n      element._onpress(e);\r\n      return;\r\n    }\r\n\r\n    let ok = false;\r\n\r\n    let w = element;\r\n    while (w) {\r\n      if (w instanceof Menu) {//w === this.menu) {\r\n        ok = true;\r\n        break;\r\n      }\r\n\r\n      if (w.hasAttribute(\"menu-button\") && w.menu === this.menu) {\r\n        ok = true;\r\n        break;\r\n      }\r\n\r\n      w = w.parentWidget;\r\n    }\r\n\r\n    if (!ok) {\r\n      this.closereq = this.menu;\r\n    } else {\r\n      this.closetimer = util.time_ms();\r\n      this.closereq = undefined;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    let closetime = cconst.menu_close_time;\r\n    closetime = closetime === undefined ? 50 : closetime;\r\n\r\n    let close = this.closereq && this.closereq === this.menu;\r\n    close = close && util.time_ms() - this.closetimer > closetime;\r\n\r\n    if (close) {\r\n      this.closereq = undefined;\r\n      this.endMenus();\r\n    }\r\n  }\r\n\r\n  startTimer() {\r\n    if (this.timer) {\r\n      this.stopTimer();\r\n    }\r\n\r\n    this.timer = setInterval(() => {\r\n      debugmenu(\"start menu wrangler interval\");\r\n\r\n      this.update();\r\n    }, 150);\r\n  }\r\n\r\n  stopTimer() {\r\n    if (this.timer) {\r\n      debugmenu(\"stop menu wrangler interval\");\r\n\r\n      clearInterval(this.timer);\r\n      this.timer = undefined;\r\n    }\r\n  }\r\n}\r\n\r\nexport let menuWrangler = window._menuWrangler = new MenuWrangler();\r\nlet wrangerStarted = false;\r\n\r\nexport function startMenuEventWrangling(screen) {\r\n  menuWrangler.screen = screen;\r\n\r\n  if (wrangerStarted) {\r\n    return;\r\n  }\r\n\r\n  wrangerStarted = true;\r\n\r\n  for (let k in DomEventTypes) {\r\n    if (menuWrangler[k] === undefined) {\r\n      continue;\r\n    }\r\n\r\n    let dom = k.search(\"key\") >= 0 ? window : document.body;\r\n    dom = window;\r\n    dom.addEventListener(DomEventTypes[k], menuWrangler[k].bind(menuWrangler), {passive: false, capture: true})\r\n  }\r\n\r\n  menuWrangler.screen = screen;\r\n  menuWrangler.startTimer();\r\n}\r\n\r\nwindow._startMenuEventWrangling = startMenuEventWrangling;\r\n\r\nexport function setWranglerScreen(screen) {\r\n  startMenuEventWrangling(screen);\r\n}\r\n\r\nexport function getWranglerScreen() {\r\n  return menuWrangler.screen;\r\n}\r\n\r\nexport function createMenu(ctx, title, templ) {\r\n  let menu = UIBase.createElement(\"menu-x\");\r\n  menu.ctx = ctx;\r\n  menu.setAttribute(\"name\", title);\r\n\r\n  let SEP = menu.constructor.SEP;\r\n  let id = 0;\r\n  let cbs = {};\r\n\r\n  let doItem = (item) => {\r\n    if (item !== undefined && item instanceof Menu) {\r\n      menu.addItem(item);\r\n    } else if (typeof item == \"string\") {\r\n      let def, hotkey;\r\n\r\n      try {\r\n        def = ctx.api.getToolDef(item);\r\n      } catch (error) {\r\n        menu.addItem(\"(tool path error)\", id++);\r\n        return;\r\n      }\r\n\r\n      //3Extra(text, id=undefined, hotkey, icon=-1, add=true) {\r\n      if (!def.hotkey) {\r\n        try {\r\n          hotkey = ctx.api.getToolPathHotkey(ctx, item);\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n          console.warn(\"error getting hotkey for tool \" + item);\r\n          hotkey = undefined;\r\n        }\r\n      } else {\r\n        hotkey = def.hotkey;\r\n      }\r\n\r\n      menu.addItemExtra(def.uiname, id, hotkey, def.icon);\r\n\r\n      cbs[id] = (function (toolpath) {\r\n        return function () {\r\n          ctx.api.execTool(ctx, toolpath);\r\n        }\r\n      })(item);\r\n\r\n      id++;\r\n    } else if (item === SEP) {\r\n      menu.seperator();\r\n    } else if (typeof item === \"function\" || item instanceof Function) {\r\n      doItem(item());\r\n    } else if (item instanceof Array) { //old array-based api for custom entries\r\n      let hotkey = item.length > 2 ? item[2] : undefined;\r\n      let icon = item.length > 3 ? item[3] : undefined;\r\n      let tooltip = item.length > 4 ? item[4] : undefined;\r\n      let id2 = item.length > 5 ? item[5] : id++;\r\n\r\n      if (hotkey !== undefined && hotkey instanceof HotKey) {\r\n        hotkey = hotkey.buildString();\r\n      }\r\n\r\n      menu.addItemExtra(item[0], id2, hotkey, icon, undefined, tooltip);\r\n\r\n      cbs[id2] = (function (cbfunc, arg) {\r\n        return function () {\r\n          cbfunc(arg);\r\n        }\r\n      })(item[1], id2);\r\n    } else if (typeof item === \"object\") { //new object-based api for custom entries\r\n      let {name, callback, hotkey, icon, tooltip} = item;\r\n\r\n      let id2 = item.id !== undefined ? item.id : id++;\r\n      if (hotkey !== undefined && hotkey instanceof HotKey) {\r\n        hotkey = hotkey.buildString();\r\n      }\r\n\r\n      menu.addItemExtra(name, id2, hotkey, icon, undefined, tooltip);\r\n\r\n      cbs[id2] = (function (cbfunc, arg) {\r\n        return function () {\r\n          cbfunc(arg);\r\n        }\r\n      })(callback, id2);\r\n    }\r\n  }\r\n\r\n  for (let item of templ) {\r\n    doItem(item);\r\n  }\r\n\r\n  menu.onselect = (id) => {\r\n    cbs[id]();\r\n  }\r\n\r\n  return menu;\r\n}\r\n\r\nexport function startMenu(menu, x, y, searchMenuMode = false, safetyDelay = 55) {\r\n  menuWrangler.endMenus();\r\n\r\n  let screen = menu.ctx.screen;\r\n  let con = menu._popup = screen.popup(undefined, x, y, false, safetyDelay);\r\n  con.noMarginsOrPadding();\r\n\r\n  con.add(menu);\r\n  if (searchMenuMode) {\r\n    menu.startFancy();\r\n  } else {\r\n    menu.start();\r\n  }\r\n\r\n  menu.flushUpdate();\r\n  menu.flushSetCSS();\r\n\r\n  menu._popup.flushUpdate();\r\n  menu._popup.flushSetCSS();\r\n}\r\n","//bind module to global var to get at it in console.\r\n//\r\n//note that require has an api for handling circular \r\n//module refs, in such cases do not use these vars.\r\n\r\nvar _ui = undefined;\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as units from '../core/units.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from './ui_base.js';\r\nimport * as ui_widgets from '../widgets/ui_widgets.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport '../path-controller/util/html5_fileapi.js';\r\nimport {HotKey} from '../path-controller/util/simple_events.js';\r\nimport {CSSFont} from './ui_theme.js';\r\nimport {theme, iconSheetFromPackFlag} from './ui_base.js';\r\n\r\nimport {createMenu, startMenu} from \"../widgets/ui_menu.js\";\r\n\r\nlet PropFlags = toolprop.PropFlags;\r\nlet PropSubTypes = toolprop.PropSubTypes;\r\n\r\nlet EnumProperty = toolprop.EnumProperty;\r\n\r\nlet Vector2   = vectormath.Vector2,\r\n    UIBase    = ui_base.UIBase,\r\n    PackFlags = ui_base.PackFlags,\r\n    PropTypes = toolprop.PropTypes;\r\n\r\nimport {DataPathError} from '../path-controller/controller/controller_base.js';\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nexport class Label extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._label = \"\";\r\n\r\n    this._lastText = \"\";\r\n\r\n    this.dom = document.createElement(\"div\");\r\n    this.dom.setAttribute(\"class\", \"_labelx\");\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n      div._labelx::selection {\r\n        color: none;\r\n        background: none;\r\n         -webkit-user-select:none;\r\n         user-select:none;\r\n      }\r\n    `;\r\n\r\n    this.shadow.appendChild(style);\r\n    this.shadow.appendChild(this.dom);\r\n\r\n    this.font = \"LabelText\";\r\n  }\r\n\r\n  get font() {\r\n    return this._font;\r\n  }\r\n\r\n  /**Set a font defined in ui_base.defaults\r\n   e.g. DefaultText*/\r\n  set font(fontDefaultName) {\r\n    if (typeof fontDefaultName === \"string\") {\r\n      this._font = this.getDefault(fontDefaultName);\r\n      if (!this._font) {\r\n        console.warn(\"Invalid font\", fontDefaultName);\r\n      }\r\n    } else if (typeof fontDefaultName === \"object\" && fontDefaultName instanceof CSSFont) {\r\n      this._font = fontDefaultName;\r\n    } else {\r\n      console.warn(\"Invalid font\", fontDefaultName);\r\n    }\r\n\r\n    this._updateFont();\r\n  }\r\n\r\n  get text() {\r\n    return this._label;\r\n    //return this.dom.innerText;\r\n  }\r\n\r\n  set text(text) {\r\n    this._label = text;\r\n\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      this.dom.innerText = text;\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"label-x\",\r\n      style  : \"label\"\r\n    };\r\n  }\r\n\r\n  init() {\r\n    this.dom.style[\"width\"] = \"max-content\";\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS(false);\r\n    this.setBoxCSS();\r\n  }\r\n\r\n  on_disabled() {\r\n    super.on_disabled();\r\n    this._enabled_font = this.font;\r\n    this.font = \"DefaultText\";\r\n    this._updateFont();\r\n  }\r\n\r\n  on_enabled() {\r\n    super.on_enabled();\r\n    this.font = this._enabled_font;\r\n    this._updateFont();\r\n  }\r\n\r\n  _updateFont() {\r\n    let font = this._font;\r\n    if (!font) return;\r\n\r\n    this.dom.style[\"font\"] = font.genCSS();\r\n    this.dom.style[\"color\"] = font.color;\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (this.ctx === undefined) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n    let prop = this.getPathMeta(this.ctx, path);\r\n    let val = this.getPathValue(this.ctx, path);\r\n\r\n    if (val === undefined) {\r\n      return;\r\n    }\r\n\r\n    //console.log(path);\r\n    if (prop.type & (PropTypes.INT | PropTypes.FLOAT)) {\r\n      val = units.buildString(val, prop.baseUnit, prop.decimalPlaces, prop.displayUnit);\r\n    }\r\n\r\n    val = \"\" + this._label + \" \" + val;\r\n\r\n    if (val !== this._lastText) {\r\n      this._lastText = val;\r\n      this.dom.innerText = val;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    let key = \"\";\r\n\r\n    if (this._font !== undefined && this._font instanceof CSSFont) {\r\n      key += this._font.genKey();\r\n    }\r\n\r\n    if (key !== this._last_font) {\r\n      this._last_font = key;\r\n      this._updateFont();\r\n    }\r\n\r\n    this.dom.style[\"pointer-events\"] = this.style[\"pointer-events\"];\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n  }\r\n}\r\n\r\nui_base.UIBase.internalRegister(Label);\r\n\r\nexport class Container extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.dataPrefix = '';\r\n    this.massSetPrefix = '';\r\n\r\n    this.inherit_packflag = 0;\r\n\r\n    let style = this.styletag = document.createElement(\"style\")\r\n    style.textContent = `\r\n    `;\r\n\r\n    this.shadow.appendChild(style);\r\n    this.reversed = false;\r\n\r\n    this._prefixstack = [];\r\n    this._mass_prefixstack = [];\r\n  }\r\n\r\n  set background(bg) {\r\n    this.__background = bg;\r\n\r\n    this.styletag.textContent = `div.containerx {\r\n        background-color : ${bg};\r\n      }\r\n    `;\r\n    this.style[\"background-color\"] = bg;\r\n  }\r\n\r\n  get children() {\r\n    let list = [];\r\n\r\n    this._forEachChildWidget((n) => {\r\n      list.push(n);\r\n    });\r\n\r\n    return list\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"container-x\"\r\n    };\r\n  }\r\n\r\n  /** recursively change path prefix for all children*/\r\n  changePathPrefix(newprefix) {\r\n    let prefix = this.dataPrefix.trim();\r\n    this.dataPrefix = newprefix;\r\n\r\n    if (prefix.length > 0) {\r\n      prefix += \".\";\r\n    }\r\n\r\n    let rec = (n, con) => {\r\n      if (n instanceof Container && n !== this) {\r\n        if (n.dataPrefix.startsWith(prefix)) {\r\n          n.dataPrefix = n.dataPath.slice(prefix.length, n.dataPrefix.length);\r\n          n.dataPrefix = con._joinPrefix(n.dataPrefix);\r\n          con = n;\r\n        }\r\n      }\r\n\r\n      if (n.hasAttribute(\"datapath\")) {\r\n        let path = n.getAttribute(\"datapath\");\r\n\r\n        if (path.startsWith(prefix)) {\r\n          path = path.slice(prefix.length, path.length);\r\n          path = con._joinPrefix(path);\r\n          n.setAttribute(\"datapath\", path);\r\n\r\n          //update helper tooltips\r\n          n.description = n.description;\r\n        }\r\n      }\r\n\r\n      n._forEachChildWidget((n2) => {\r\n        rec(n2, con);\r\n      });\r\n    }\r\n\r\n    rec(this, this);\r\n  }\r\n\r\n  reverse() {\r\n    this.reversed ^= true;\r\n    return this;\r\n  }\r\n\r\n  pushMassSetPrefix(val) {\r\n    this._mass_prefixstack.push(this.massSetPrefix);\r\n    this.massSetPrefix = val;\r\n    return this;\r\n  }\r\n\r\n  pushDataPrefix(val) {\r\n    this._prefixstack.push(this.dataPrefix);\r\n    this.dataPrefix = val;\r\n    return this;\r\n  }\r\n\r\n  popDataPrefix() {\r\n    this.dataPrefix = this._prefixstack.pop();\r\n    return this;\r\n  }\r\n\r\n  popMassSetPrefix() {\r\n    this.massSetPrefix = this._mass_prefixstack.pop();\r\n    return this;\r\n  }\r\n\r\n  saveData() {\r\n    if (this.scrollTop || this.scrollLeft) {\r\n      return {\r\n        scrollTop : this.scrollTop,\r\n        scrollLeft: this.scrollLeft\r\n      }\r\n    } else {\r\n      return {};\r\n    }\r\n  }\r\n\r\n  loadData(obj) {\r\n    if (!obj) return;\r\n\r\n    let x = obj.scrollLeft || 0;\r\n    let y = obj.scrollTop || 0;\r\n\r\n    this.doOnce(() => {\r\n      this.scrollTo(x, y);\r\n    }, 12);\r\n  }\r\n\r\n  init() {\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-direction\"] = this.reversed ? \"column-reverse\" : \"column\";\r\n    this.style[\"flex-wrap\"] = \"nowrap\";\r\n    this.style[\"flex-grow\"] = \"\" + this.getDefault(\"flex-grow\", undefined, \"1\");\r\n\r\n    this.setCSS();\r\n\r\n    super.init();\r\n\r\n    this.setAttribute(\"class\", \"containerx\");\r\n  }\r\n\r\n  /** Returns previous icon flags */\r\n  useIcons(enabled_or_sheet = true) {\r\n    let enabled = !!enabled_or_sheet;\r\n\r\n    let mask = PackFlags.USE_ICONS | PackFlags.SMALL_ICON | PackFlags.LARGE_ICON;\r\n    mask = mask | PackFlags.CUSTOM_ICON_SHEET;\r\n    mask = mask | (255<<PackFlags.CUSTOM_ICON_SHEET_START);\r\n\r\n    let previous = this.packflag & mask;\r\n\r\n    if (!enabled) {\r\n      this.packflag &= ~PackFlags.USE_ICONS;\r\n      this.inherit_packflag &= ~PackFlags.USE_ICONS;\r\n\r\n      return previous;\r\n    }\r\n\r\n    let sheet = enabled_or_sheet;\r\n\r\n    if (sheet === true) {\r\n      sheet = PackFlags.SMALL_ICON;\r\n    } else if (sheet === 1) {\r\n      sheet = PackFlags.LARGE_ICON;\r\n    } else {\r\n      sheet = PackFlags.CUSTOM_ICON_SHEET | (sheet<<(PackFlags.CUSTOM_ICON_SHEET_START));\r\n    }\r\n\r\n    //clear any existing sizing flags\r\n    this.packflag &= ~(PackFlags.SMALL_ICON | PackFlags.LARGE_ICON | PackFlags.CUSTOM_ICON_SHEET);\r\n    this.packflag &= ~(255<<PackFlags.CUSTOM_ICON_SHEET_START);\r\n\r\n    this.packflag |= PackFlags.USE_ICONS | sheet;\r\n    this.inherit_packflag |= PackFlags.USE_ICONS | sheet;\r\n\r\n    return previous;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param mode: flexbox wrap mode, can be wrap, nowrap, or wrap-reverse\r\n   * @returns {Container}\r\n   */\r\n  wrap(mode = \"wrap\") {\r\n    this.style[\"flex-wrap\"] = mode;\r\n    return this;\r\n  }\r\n\r\n  noMarginsOrPadding() {\r\n    super.noMarginsOrPadding();\r\n\r\n    let keys = [\"margin\", \"padding\", \"margin-block-start\", \"margin-block-end\"];\r\n    keys = keys.concat([\"padding-block-start\", \"padding-block-end\"]);\r\n\r\n    for (let k of keys) {\r\n      this.style[k] = \"0px\";\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  setCSS() {\r\n    let rest = '';\r\n\r\n    let add = (style) => {\r\n      if (!this.hasDefault(style)) {\r\n        return;\r\n      }\r\n\r\n      let val = this.getDefault(style);\r\n\r\n      if (val !== undefined) {\r\n        rest += `  ${style} = ${val};\\n`;\r\n        this.style[style] = val;\r\n      }\r\n    }\r\n\r\n    add(\"border-radius\");\r\n    add(\"border-width\");\r\n    add(\"border-top\");\r\n    add(\"border-bottom\");\r\n    add(\"border-left\");\r\n    add(\"border-right\");\r\n\r\n    this.styletag.textContent = `div.containerx {\r\n        background-color : ${this.getDefault(\"background-color\")};\r\n        ${rest}\r\n      }\r\n      `;\r\n  }\r\n\r\n  overrideDefault(key, val) {\r\n    super.overrideDefault(key, val);\r\n    this.setCSS();\r\n\r\n    return this;\r\n  }\r\n\r\n  /*\r\n  * shorthand for:\r\n  *\r\n  * .row().noMarginsOrPadding().oneAxisPadding()\r\n  * */\r\n  strip(themeClass = \"strip\", margin1 = this.getDefault(\"oneAxisPadding\"), margin2 = 1, horiz = undefined) {\r\n    if (horiz === undefined) {\r\n      horiz = this instanceof RowFrame;\r\n      horiz = horiz || this.style[\"flex-direction\"] === \"row\";\r\n    }\r\n\r\n    let flag = horiz ? PackFlags.STRIP_HORIZ : PackFlags.STRIP_VERT;\r\n\r\n    let strip = (horiz ? this.row() : this.col());\r\n\r\n    if (typeof margin1 !== \"number\") {\r\n      throw new Error(\"margin1 was not a number\");\r\n    }\r\n    if (typeof margin2 !== \"number\") {\r\n      throw new Error(\"margin2 was not a number\");\r\n    }\r\n\r\n    strip.packflag |= flag;\r\n    strip.dataPrefix = this.dataPrefix;\r\n    strip.massSetPrefix = this.massSetPrefix;\r\n\r\n    if (themeClass in theme) {\r\n      strip.overrideClass(themeClass);\r\n      strip.background = strip.getDefault(\"background-color\");\r\n      strip.setCSS();\r\n      strip.overrideClass(themeClass);\r\n\r\n      let lastkey;\r\n\r\n      strip.update.after(function () {\r\n        let bradius = strip.getDefault(\"border-radius\");\r\n        let bline = strip.getDefault(\"border-width\");\r\n        let bstyle = strip.getDefault(\"border-style\") || 'solid';\r\n        let padding = strip.getDefault(\"padding\");\r\n        let bcolor = strip.getDefault(\"border-color\") || \"rgba(0,0,0,0)\";\r\n        let margin = strip.getDefault(\"margin\") || 0;\r\n\r\n        bline = bline === undefined ? 0 : bline;\r\n        bradius = bradius === undefined ? 0 : bradius;\r\n        padding = padding === undefined ? 5 : padding;\r\n\r\n        let bg = strip.getDefault(\"background-color\");\r\n\r\n        let key = \"\" + bradius + \":\" + bline + \":\" + bg + \":\" + padding + \":\";\r\n        key += bstyle + \":\" + padding + \":\" + bcolor + \":\" + margin;\r\n\r\n        if (key !== lastkey) {\r\n          lastkey = key;\r\n\r\n          strip.oneAxisPadding(margin1 + padding, margin2 + padding);\r\n          strip.setCSS();\r\n\r\n          strip.background = bg;\r\n\r\n          strip.style[\"margin\"] = \"\" + margin + \"px\";\r\n          strip.style[\"border\"] = `${bline}px ${bstyle} ${bcolor}`;\r\n          strip.style[\"border-radius\"] = \"\" + bradius + \"px\";\r\n        }\r\n      })\r\n    } else {\r\n      console.warn(this.constructor.name + \".strip(): unknown theme class \" + themeClass);\r\n    }\r\n\r\n    /*\r\n    let prev = strip.previousElementSibling;\r\n    if (prev !== undefined && (prev.packflag & flag)) {\r\n      if (horiz) {\r\n        prev.style[\"padding-right\"] = \"0px\";\r\n      } else {\r\n        prev.style[\"padding-top\"] = \"0px\";\r\n      }\r\n    }//*/\r\n\r\n    return strip;\r\n  }\r\n\r\n  /**\r\n   * tries to set margin along one axis only in smart manner\r\n   * */\r\n  oneAxisMargin(m = this.getDefault(\"oneAxisMargin\"), m2 = 0) {\r\n    this.style[\"margin-top\"] = this.style[\"margin-bottom\"] = \"\" + m + \"px\";\r\n    this.style[\"margin-left\"] = this.style[\"margin-right\"] = \"\" + m2 + \"px\";\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * tries to set padding along one axis only in smart manner\r\n   * */\r\n  oneAxisPadding(axisPadding = this.getDefault(\"oneAxisPadding\"), otherPadding = 0) {\r\n    this.style[\"padding-top\"] = this.style[\"padding-bottom\"] = \"\" + axisPadding + \"px\";\r\n    this.style[\"padding-left\"] = this.style[\"padding-right\"] = \"\" + otherPadding + \"px\";\r\n\r\n    return this;\r\n  }\r\n\r\n  setMargin(m) {\r\n    this.style[\"margin\"] = m + \"px\";\r\n\r\n    return this;\r\n  }\r\n\r\n  setPadding(m) {\r\n    this.style[\"padding\"] = m + \"px\";\r\n\r\n    return this;\r\n  }\r\n\r\n  setSize(width, height) {\r\n    if (width !== undefined) {\r\n      if (typeof width == \"number\")\r\n        this.style[\"width\"] = this.div.style[\"width\"] = ~~width + \"px\";\r\n      else\r\n        this.style[\"width\"] = this.div.style[\"width\"] = width;\r\n    }\r\n\r\n    if (height !== undefined) {\r\n      if (typeof height == \"number\")\r\n        this.style[\"height\"] = this.div.style[\"height\"] = ~~height + \"px\";\r\n      else\r\n        this.style[\"height\"] = this.div.style[\"height\"] = height;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  save() {\r\n  }\r\n\r\n  load() {\r\n  }\r\n\r\n  saveVisibility() {\r\n    localStorage[this.storagePrefix + \"_settings\"] = JSON.stringify(this);\r\n    return this;\r\n  }\r\n\r\n  loadVisibility() {\r\n    let key = this.storagePrefix + \"_settings\";\r\n    let ok = true;\r\n\r\n    if (key in localStorage) {\r\n      console.log(\"loading UI visibility state. . .\");\r\n\r\n      try {\r\n        this.loadJSON(JSON.parse(localStorage[key]));\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        ok = false;\r\n      }\r\n    }\r\n\r\n    return ok;\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = {\r\n      opened: !this.closed\r\n    };\r\n\r\n    return Object.assign(super.toJSON(), ret);\r\n  }\r\n\r\n  _ondestroy() {\r\n    this._forEachChildWidget((n) => {\r\n      n._ondestroy();\r\n    });\r\n\r\n    super._ondestroy();\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    //console.error(\"ui.js:Container.loadJSON: implement me!\");\r\n\r\n    return this;\r\n  }\r\n\r\n  redrawCurves() {\r\n    throw new Error(\"Implement me (properly!)\");\r\n\r\n    if (this.closed)\r\n      return;\r\n\r\n    for (let cw of this.curve_widgets) {\r\n      cw.draw();\r\n    }\r\n  }\r\n\r\n  listen() {\r\n    window.setInterval(() => {\r\n      this.update();\r\n    }, 150);\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  appendChild(child) {\r\n    if (child instanceof ui_base.UIBase) {\r\n      child.ctx = this.ctx;\r\n      child.parentWidget = this;\r\n      this.shadow.appendChild(child);\r\n\r\n      if (child.onadd) {\r\n        child.onadd();\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    return super.appendChild(child);\r\n  }\r\n\r\n  clear(trigger_on_destroy = true) {\r\n    for (let child of this.children) {\r\n      if (child instanceof ui_base.UIBase) {\r\n        child.remove(trigger_on_destroy);\r\n      }\r\n    }\r\n  }\r\n\r\n  removeChild(child, trigger_on_destroy = true) {\r\n    let ret = super.removeChild(child);\r\n\r\n    if (child.on_remove) {\r\n      child.on_remove();\r\n    }\r\n\r\n    if (trigger_on_destroy && child.on_destroy) {\r\n      child.on_destroy();\r\n    }\r\n\r\n    child.parentWidget = undefined;\r\n\r\n    return ret;\r\n  }\r\n\r\n  prepend(child) {\r\n    if (child instanceof UIBase) {\r\n      this._prepend(child);\r\n    } else {\r\n      super.prepend(child);\r\n    }\r\n  }\r\n\r\n  //*\r\n  _prepend(child) {\r\n    return this._add(child, true);\r\n  }//*/\r\n\r\n  add(child) {\r\n    return this._add(child);\r\n  }\r\n\r\n  insert(i, ch) {\r\n    ch.parentWidget = this;\r\n    ch.ctx = this;\r\n\r\n    if (i >= this.shadow.childNodes.length) {\r\n      this.add(ch);\r\n    } else {\r\n      this.shadow.insertBefore(ch, util.list(this.children)[i]);\r\n    }\r\n\r\n    if (ch.onadd) {\r\n      ch.onadd();\r\n    }\r\n  }\r\n\r\n  _add(child, prepend = false) {\r\n    //paranoia check for if we accidentally got a DOM NodeList\r\n    if (child instanceof NodeList) {\r\n      throw new Error(\"eek!\");\r\n    }\r\n\r\n    child.ctx = this.ctx;\r\n    child.parentWidget = this;\r\n    child._useDataPathUndo = this._useDataPathUndo;\r\n\r\n    if (!child._themeOverride && this._themeOverride) {\r\n      child.overrideTheme(this._themeOverride);\r\n    }\r\n\r\n    if (prepend) {\r\n      this.shadow.prepend(child);\r\n    } else {\r\n      this.shadow.appendChild(child);\r\n    }\r\n\r\n    /*\r\n    if (child._ctx) {\r\n      child._init();\r\n    }//*/\r\n\r\n    if (child.onadd)\r\n      child.onadd();\r\n\r\n    return child;\r\n  }\r\n\r\n  //TODO: make sure this works on Electron?\r\n  dynamicMenu(title, list, packflag = 0) {\r\n    //actually, .menu works for now\r\n    return this.menu(title, list, packflag);\r\n  }\r\n\r\n  /**example usage:\r\n\r\n   .menu([\r\n   \"some_tool_path.tool()|CustomLabel\",\r\n   ui_widgets.Menu.SEP,\r\n   \"some_tool_path.another_tool()\",\r\n   \"some_tool_path.another_tool()|CustomLabel::Custom Hotkey String\",\r\n   [\"Name\", () => {console.log(\"do something\")}]\r\n   ])\r\n\r\n   **/\r\n  menu(title, list, packflag = 0) {\r\n    let dbox = UIBase.createElement(\"dropbox-x\");\r\n\r\n    dbox._name = title;\r\n    dbox.setAttribute(\"simple\", true);\r\n    dbox.setAttribute(\"name\", title);\r\n\r\n    if (list instanceof HTMLElement && list.constructor.name === \"Menu\") {\r\n      dbox._build_menu = function () {\r\n        if (this._menu !== undefined && this._menu.parentNode !== undefined) {\r\n          this._menu.remove();\r\n        }\r\n\r\n        this._menu = createMenu(this.ctx, title, list);\r\n        return this._menu;\r\n      }\r\n    } else if (list) {\r\n      dbox.template = list;\r\n    }\r\n\r\n    this._container_inherit(dbox, packflag);\r\n\r\n    this._add(dbox);\r\n    return dbox;\r\n  }\r\n\r\n  toolPanel(path_or_cls, args = {}) {\r\n    let tdef;\r\n    let cls;\r\n\r\n    if (typeof path_or_cls === \"string\") {\r\n      cls = this.ctx.api.parseToolPath(path_or_cls);\r\n    } else {\r\n      cls = path_or_cls;\r\n    }\r\n\r\n    tdef = cls._getFinalToolDef();\r\n\r\n    let packflag = args.packflag || 0;\r\n    let label = args.label || tdef.uiname;\r\n    let createCb = args.createCb || args.create_cb;\r\n    let container = args.container || this.panel(label);\r\n    let defaultsPath = args.defaultsPath || \"toolDefaults\";\r\n\r\n    if (defaultsPath.length > 0 && !defaultsPath.endsWith(\".\")) {\r\n      defaultsPath += \".\";\r\n    }\r\n\r\n    let path = defaultsPath + tdef.toolpath;\r\n\r\n    container.useIcons(false);\r\n\r\n    let inputs = tdef.inputs || {};\r\n    for (let k in inputs) {\r\n      let prop = inputs[k];\r\n\r\n      if (prop.flag & PropFlags.PRIVATE) {\r\n        continue;\r\n      }\r\n\r\n      let apiname = prop.apiname || k;\r\n      let path2 = path + \".\" + apiname;\r\n\r\n      container.prop(path2);\r\n    }\r\n\r\n    container.tool(path_or_cls, packflag, createCb, label);\r\n\r\n    return container;\r\n  }\r\n\r\n  tool(path_or_cls, packflag_or_args = {}, createCb = undefined, label = undefined) {\r\n    let cls;\r\n    let packflag;\r\n\r\n    if (typeof packflag_or_args === \"object\") {\r\n      let args = packflag_or_args;\r\n\r\n      packflag = args.packflag;\r\n      createCb = args.createCb;\r\n      label = args.label;\r\n    } else {\r\n      packflag = packflag_or_args || 0;\r\n    }\r\n\r\n    if (typeof path_or_cls == \"string\") {\r\n      if (path_or_cls.search(/\\|/) >= 0) {\r\n        path_or_cls = path_or_cls.split(\"|\");\r\n\r\n        if (label === undefined && path_or_cls.length > 1) {\r\n          label = path_or_cls[1].trim();\r\n        }\r\n\r\n        path_or_cls = path_or_cls[0].trim();\r\n      }\r\n\r\n      if (this.ctx === undefined) {\r\n        console.warn(\"this.ctx was undefined in tool()\");\r\n        return;\r\n      }\r\n\r\n      cls = this.ctx.api.parseToolPath(path_or_cls);\r\n\r\n      if (cls === undefined) {\r\n        console.warn(\"Unknown tool for toolpath \\\"\" + path_or_cls + \"\\\"\");\r\n        return;\r\n      }\r\n    } else {\r\n      cls = path_or_cls;\r\n    }\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n    let hotkey;\r\n\r\n    if (createCb === undefined) {\r\n      createCb = (cls) => {\r\n        return this.ctx.api.createTool(this.ctx, path_or_cls);\r\n      }\r\n    }\r\n\r\n    let cb = () => {\r\n      console.log(\"tool run\");\r\n\r\n      let toolob = createCb(cls);\r\n      this.ctx.api.execTool(this.ctx, toolob);\r\n    }\r\n\r\n    let def = typeof path_or_cls === \"string\" ? this.ctx.api.getToolDef(path_or_cls) : cls.tooldef();\r\n    let tooltip = def.description === undefined ? def.uiname : def.description;\r\n\r\n    //is there a hotkey hardcoded in the class?\r\n    if (def.hotkey !== undefined) {\r\n      tooltip += \"\\n\\t\" + def.hotkey;\r\n      hotkey = def.hotkey;\r\n    } else { //if not, use getToolPathHotkey api\r\n      let path = path_or_cls;\r\n\r\n      if (typeof path != \"string\") {\r\n        path = def.toolpath;\r\n      }\r\n\r\n      let hotkey = this.ctx.api.getToolPathHotkey(this.ctx, path);\r\n      if (hotkey) {\r\n        tooltip += \"\\n\\tHotkey: \" + hotkey;\r\n      }\r\n    }\r\n\r\n    let ret;\r\n\r\n    if (def.icon !== undefined && (packflag & PackFlags.USE_ICONS)) {\r\n      label = label === undefined ? tooltip : label;\r\n\r\n      ret = this.iconbutton(def.icon, label, cb);\r\n\r\n      ret.iconsheet = iconSheetFromPackFlag(packflag);\r\n      ret.packflag |= packflag;\r\n      ret.description = tooltip;\r\n    } else {\r\n      label = label === undefined ? def.uiname : label;\r\n\r\n      ret = this.button(label, cb);\r\n      ret.description = tooltip;\r\n      ret.packflag |= packflag;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  //supports number types\r\n  textbox(inpath, text, cb = undefined, packflag = 0) {\r\n    let path;\r\n\r\n    if (inpath) {\r\n      path = this._joinPrefix(inpath);\r\n    }\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let ret = UIBase.createElement(\"textbox-x\");\r\n\r\n    if (path !== undefined) {\r\n      ret.setAttribute(\"datapath\", path);\r\n    }\r\n\r\n    ret.ctx = this.ctx;\r\n    ret.parentWidget = this;\r\n    ret._init();\r\n    this._add(ret);\r\n\r\n    ret.setCSS();\r\n    ret.update();\r\n\r\n    ret.packflag |= packflag;\r\n    ret.onchange = cb;\r\n    ret.text = text;\r\n\r\n    return ret;\r\n  }\r\n\r\n  pathlabel(inpath, label = \"\", packflag = 0) {\r\n    let path;\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    if (inpath) {\r\n      path = this._joinPrefix(inpath);\r\n    }\r\n\r\n    let ret = UIBase.createElement(\"label-x\");\r\n\r\n    ret.text = label;\r\n    ret.packflag = packflag;\r\n    ret.setAttribute(\"datapath\", path);\r\n\r\n    this._add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  label(text) {\r\n    let ret = UIBase.createElement(\"label-x\");\r\n    ret.text = text;\r\n\r\n    this._add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * makes a button for a help picker tool\r\n   * to view tooltips on mobile devices\r\n   * */\r\n  helppicker() {\r\n    let ret = this.iconbutton(ui_base.Icons.HELP, \"Help Picker\", () => {\r\n      this.getScreen().hintPickerTool();\r\n    })\r\n\r\n    if (util.isMobile()) {\r\n      //ret.iconsheet = 2;\r\n      //XXX look up in mobile theme properly\r\n    }\r\n\r\n    if (ret.ctx) {\r\n      ret._init();\r\n      ret.setCSS();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  iconbutton(icon, description, cb, thisvar, packflag = 0) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let ret = UIBase.createElement(\"iconbutton-x\")\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    ret.setAttribute(\"icon\", icon);\r\n    ret.description = description;\r\n    ret.icon = icon;\r\n\r\n    ret.iconsheet = iconSheetFromPackFlag(packflag);\r\n\r\n    ret.onclick = cb;\r\n\r\n    this._add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  button(label, cb, thisvar, id, packflag = 0) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let ret = UIBase.createElement(\"button-x\")\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    ret.setAttribute(\"name\", label);\r\n    ret.setAttribute(\"buttonid\", id); //XXX no longer used?\r\n    ret.onclick = cb;\r\n\r\n    this._add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  _joinPrefix(path, prefix = this.dataPrefix.trim()) {\r\n    if (path === undefined) {\r\n      return undefined;\r\n    }\r\n\r\n    path = path.trim();\r\n    if (path[0] === \"/\") {\r\n      return path;\r\n    }\r\n\r\n    if (prefix.length > 0 && path.length > 0 && !prefix.endsWith(\".\") && !path.startsWith(\".\")) {\r\n      path = \".\" + path;\r\n    }\r\n\r\n    return prefix + path;\r\n  }\r\n\r\n  colorbutton(inpath, packflag, mass_set_path = undefined) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    let ret = UIBase.createElement(\"color-picker-button-x\");\r\n\r\n    if (inpath !== undefined) {\r\n      inpath = this._joinPrefix(inpath);\r\n      ret.setAttribute(\"datapath\", inpath);\r\n    }\r\n\r\n    if (mass_set_path !== undefined) {\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n    }\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  noteframe(packflag = 0) {\r\n    let ret = UIBase.createElement(\"noteframe-x\");\r\n\r\n    ret.packflag |= (this.inherit_packflag & ~PackFlags.NO_UPDATE) | packflag;\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  curve1d(inpath, packflag = 0, mass_set_path = undefined) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    let ret = UIBase.createElement(\"curve-widget-x\");\r\n\r\n    ret.ctx = this.ctx;\r\n    ret.packflag |= packflag;\r\n\r\n    if (inpath) {\r\n      inpath = this._joinPrefix(inpath);\r\n      ret.setAttribute(\"datapath\", inpath);\r\n    }\r\n\r\n    if (mass_set_path)\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n\r\n    this.add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  vecpopup(inpath, packflag = 0, mass_set_path = undefined) {\r\n    let button = UIBase.createElement(\"vector-popup-button-x\");\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n    let name = \"vector\";\r\n\r\n    if (inpath) {\r\n      inpath = this._joinPrefix(inpath);\r\n\r\n      button.setAttribute(\"datapath\", inpath);\r\n      if (mass_set_path) {\r\n        button.setAttribute(\"mass_set_path\", mass_set_path);\r\n      }\r\n\r\n      let rdef = this.ctx.api.resolvePath(this.ctx, inpath);\r\n      if (rdef && rdef.prop) {\r\n        name = rdef.prop.uiname || rdef.prop.name;\r\n      }\r\n    }\r\n\r\n    button.setAttribute(\"name\", name);\r\n    button.packflag |= packflag;\r\n\r\n    this.add(button);\r\n    return button;\r\n  }\r\n\r\n  _getMassPath(ctx, inpath, mass_set_path) {\r\n    if (mass_set_path === undefined && this.massSetPrefix.length > 0) {\r\n      mass_set_path = ctx.api.getPropName(ctx, inpath);\r\n    }\r\n\r\n    if (mass_set_path === undefined) {\r\n      return undefined;\r\n    }\r\n\r\n    return this._joinPrefix(mass_set_path, this.massSetPrefix);\r\n  }\r\n\r\n  prop(inpath, packflag = 0, mass_set_path = undefined) {\r\n    if (!this.ctx) {\r\n      console.warn(this.id + \".ctx was undefined\");\r\n      let p = this.parentWidget;\r\n\r\n      while (p) {\r\n        if (p.ctx) {\r\n          console.warn(\"Fetched this.ctx from parent\");\r\n          this.ctx = p.ctx;\r\n          break;\r\n        }\r\n\r\n        p = p.parentWidget;\r\n      }\r\n\r\n      if (!this.ctx) {\r\n        throw new Error(\"ui.Container.prototype.prop(): this.ctx was undefined\");\r\n      }\r\n    }\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let rdef = this.ctx.api.resolvePath(this.ctx, this._joinPrefix(inpath), true);\r\n\r\n    if (rdef === undefined || rdef.prop === undefined) {\r\n      console.warn(\"Unknown property at path\", this._joinPrefix(inpath), this.ctx.api.resolvePath(this.ctx, this._joinPrefix(inpath), true));\r\n      return;\r\n    }\r\n    //slider(path, name, defaultval, min, max, step, is_int, do_redraw, callback, packflag=0) {\r\n    let prop = rdef.prop;\r\n\r\n    let useDataPathUndo = !(prop.flag & PropFlags.NO_UNDO);\r\n\r\n    //console.log(prop, PropTypes, PropSubTypes);\r\n\r\n    function makeUIName(name) {\r\n      if (typeof name === \"number\" && isNaN(name)) {\r\n        console.warn(\"Subkey error in data api\", inpath);\r\n        return \"\" + name;\r\n      }\r\n\r\n      name = \"\" + name;\r\n      name = name[0].toUpperCase() + name.slice(1, name.length).toLowerCase();\r\n      name = name.replace(/_/g, \" \");\r\n      return name;\r\n    }\r\n\r\n    if (prop.type === PropTypes.REPORT) {\r\n      return this.pathlabel(inpath, prop.uiname);\r\n    } else if (prop.type === PropTypes.STRING) {\r\n      let ret;\r\n\r\n      if (prop.flag & PropFlags.READ_ONLY) {\r\n        ret = this.pathlabel(inpath, prop.uiname);\r\n      } else if (prop.multiLine) {\r\n        ret = this.textarea(inpath, rdef.value, packflag, mass_set_path);\r\n        ret.useDataPathUndo = useDataPathUndo;\r\n      } else {\r\n        let strip = this.strip();\r\n\r\n        let uiname = prop.uiname !== undefined ? prop.uiname : ToolProperty.makeUIName(prop.apiname);\r\n\r\n        strip.label(prop.uiname);\r\n\r\n        ret = strip.textbox(inpath);\r\n        ret.useDataPathUndo = useDataPathUndo;\r\n\r\n        if (mass_set_path) {\r\n          ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n        }\r\n      }\r\n\r\n      ret.packflag |= packflag;\r\n      return ret;\r\n    } else if (prop.type === PropTypes.CURVE) {\r\n      let ret = this.curve1d(inpath, packflag, mass_set_path);\r\n      ret.useDataPathUndo = useDataPathUndo;\r\n      return ret;\r\n    } else if (prop.type === PropTypes.INT || prop.type === PropTypes.FLOAT) {\r\n      let ret;\r\n      if (packflag & PackFlags.SIMPLE_NUMSLIDERS) {\r\n        ret = this.simpleslider(inpath, {packflag: packflag});\r\n      } else {\r\n        ret = this.slider(inpath, {packflag: packflag});\r\n      }\r\n\r\n      ret.useDataPathUndo = useDataPathUndo;\r\n      ret.packflag |= packflag;\r\n\r\n      if (mass_set_path) {\r\n        ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n      }\r\n\r\n      return ret;\r\n    } else if (prop.type === PropTypes.BOOL) {\r\n      let ret = this.check(inpath, prop.uiname, packflag, mass_set_path);\r\n      ret.useDataPathUndo = useDataPathUndo;\r\n      return ret;\r\n    } else if (prop.type === PropTypes.ENUM) {\r\n      if (rdef.subkey !== undefined) {\r\n        let subkey = rdef.subkey;\r\n        let name = rdef.prop.ui_value_names[rdef.subkey];\r\n\r\n        if (name === undefined) {\r\n          name = makeUIName(rdef.subkey);\r\n        }\r\n\r\n        let check = this.check(inpath, name, packflag, mass_set_path);\r\n        let tooltip = rdef.prop.descriptions[subkey];\r\n\r\n        check.useDataPathUndo = useDataPathUndo;\r\n\r\n        check.description = tooltip === undefined ? rdef.prop.ui_value_names[subkey] : tooltip;\r\n        check.icon = rdef.prop.iconmap[rdef.subkey];\r\n\r\n        return check;\r\n      }\r\n\r\n      if (!(packflag & PackFlags.USE_ICONS) && !(prop.flag & (PropFlags.USE_ICONS | PropFlags.FORCE_ENUM_CHECKBOXES))) {\r\n        if (packflag & PackFlags.FORCE_PROP_LABELS) {\r\n          let strip = this.strip();\r\n          strip.label(prop.uiname);\r\n\r\n          return strip.listenum(inpath, {packflag, mass_set_path}).setUndo(useDataPathUndo);\r\n        } else {\r\n          return this.listenum(inpath, {packflag, mass_set_path}).setUndo(useDataPathUndo);\r\n        }\r\n\r\n      } else {\r\n        if (prop.flag & PropFlags.USE_ICONS) {\r\n          packflag |= PackFlags.USE_ICONS;\r\n        } else if (prop.flag & PropFlags.FORCE_ENUM_CHECKBOXES) {\r\n          packflag &= ~PackFlags.USE_ICONS;\r\n        }\r\n\r\n        if (packflag & PackFlags.FORCE_PROP_LABELS) {\r\n          let strip = this.strip();\r\n          strip.label(prop.uiname);\r\n\r\n          return strip.checkenum(inpath, undefined, packflag).setUndo(useDataPathUndo);\r\n        } else {\r\n          return this.checkenum(inpath, undefined, packflag).setUndo(useDataPathUndo);\r\n        }\r\n      }\r\n    } else if (prop.type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4)) {\r\n      if (rdef.subkey !== undefined) {\r\n        let ret;\r\n\r\n        if (packflag & PackFlags.SIMPLE_NUMSLIDERS)\r\n          ret = this.simpleslider(inpath, {packflag: packflag});\r\n        else\r\n          ret = this.slider(inpath, {packflag: packflag});\r\n\r\n        ret.packflag |= packflag;\r\n        return ret.setUndo(useDataPathUndo);\r\n      } else if (prop.subtype === PropSubTypes.COLOR) {\r\n        return this.colorbutton(inpath, packflag, mass_set_path).setUndo(useDataPathUndo);\r\n        //return this.colorPicker(inpath, packflag, mass_set_path);\r\n      } else {\r\n        let ret = UIBase.createElement(\"vector-panel-x\");\r\n\r\n        mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n        ret.packflag |= packflag | (this.inherit_packflag & ~PackFlags.NO_UPDATE);\r\n        ret.inherit_packflag |= packflag | (this.inherit_packflag & ~PackFlags.NO_UPDATE);\r\n\r\n        if (inpath) {\r\n          ret.setAttribute(\"datapath\", this._joinPrefix(inpath));\r\n        }\r\n\r\n        if (mass_set_path) {\r\n          ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n        }\r\n\r\n        this.add(ret);\r\n\r\n        return ret.setUndo(useDataPathUndo);\r\n      }\r\n    } else if (prop.type === PropTypes.FLAG) {\r\n      if (rdef.subkey !== undefined) {\r\n        let tooltip = rdef.prop.descriptions[rdef.subkey];\r\n        let name = rdef.prop.ui_value_names[rdef.subkey];\r\n\r\n        if (typeof rdef.subkey === \"number\") {\r\n          name = rdef.prop.keys[rdef.subkey];\r\n          if (name && name in rdef.prop.ui_value_names) {\r\n            name = rdef.prop.ui_value_names[name];\r\n          } else {\r\n            name = makeUIName(name ? name : \"(error)\");\r\n          }\r\n        }\r\n\r\n        if (name === undefined) {\r\n          name = \"(error)\";\r\n        }\r\n\r\n        let ret = this.check(inpath, name, packflag, mass_set_path);\r\n\r\n        ret.icon = rdef.prop.iconmap[rdef.subkey];\r\n\r\n        if (tooltip) {\r\n          ret.description = tooltip;\r\n        }\r\n\r\n        return ret.setUndo(useDataPathUndo);\r\n      } else {\r\n        let con = this;\r\n\r\n        if (packflag & PackFlags.FORCE_PROP_LABELS) {\r\n          con = this.strip();\r\n          con.label(prop.uiname);\r\n        }\r\n\r\n        if (packflag & PackFlags.PUT_FLAG_CHECKS_IN_COLUMNS) {\r\n          let i = 0;\r\n          let row = con.row();\r\n          let col1 = row.col();\r\n          let col2 = row.col();\r\n\r\n          for (let k in prop.values) {\r\n            let name = prop.ui_value_names[k];\r\n            let tooltip = prop.descriptions[k];\r\n\r\n            if (name === undefined) {\r\n              name = makeUIName(k);\r\n            }\r\n\r\n            let con2 = i & 1 ? col1 : col2;\r\n            let check = con2.check(`${inpath}[${k}]`, name, packflag, mass_set_path);\r\n\r\n            if (tooltip) {\r\n              check.description = tooltip;\r\n            }\r\n\r\n            check.setUndo(useDataPathUndo);\r\n\r\n            i++;\r\n          }\r\n\r\n          return row;\r\n        }\r\n\r\n        if (packflag & PackFlags.WRAP_CHECKBOXES) {\r\n          let isrow = this.style[\"flex-direction\"] === \"row\";\r\n          isrow = isrow || this.style[\"flex-direction\"] === \"row-reverse\";\r\n\r\n          let wrapChars;\r\n\r\n          let strip, con;\r\n\r\n          if (isrow) {\r\n            wrapChars = this.getDefault(\"checkRowWrapLimit\", undefined, 24);\r\n            strip = this.col().strip();\r\n            strip.packflag |= packflag;\r\n            strip.inherit_packflag |= packflag;\r\n\r\n            con = strip.row();\r\n          } else {\r\n            wrapChars = this.getDefault(\"checkColWrapLimit\", undefined, 5);\r\n            strip = this.row().strip();\r\n            strip.packflag |= packflag;\r\n            strip.inherit_packflag |= packflag;\r\n\r\n            con = strip.col();\r\n          }\r\n\r\n          let x = 0;\r\n          let y = 0;\r\n\r\n          for (let k in prop.values) {\r\n            let name = prop.ui_value_names[k];\r\n            let tooltip = prop.descriptions[k];\r\n\r\n            if (name === undefined) {\r\n              name = makeUIName(k);\r\n            }\r\n\r\n            let check = con.check(`${inpath}[${k}]`, name, packflag, mass_set_path);\r\n\r\n            if (tooltip) {\r\n              check.description = tooltip;\r\n            }\r\n\r\n            x += name.length;\r\n            y += 1;\r\n\r\n            if (isrow && x > wrapChars) {\r\n              x = 0;\r\n              con = strip.row();\r\n            } else if (!isrow && y > wrapChars) {\r\n              y = 0;\r\n              con = strip.col();\r\n            }\r\n          }\r\n\r\n          return strip;\r\n        }\r\n\r\n        if (con === this) {\r\n          con = this.strip();\r\n        }\r\n\r\n        let rebuild = () => {\r\n          con.clear();\r\n\r\n          for (let k in prop.values) {\r\n            let name = prop.ui_value_names[k];\r\n            let tooltip = prop.descriptions[k];\r\n\r\n            if (name === undefined) {\r\n              name = makeUIName(k);\r\n            }\r\n\r\n            let check = con.check(`${inpath}[${k}]`, name, packflag, mass_set_path);\r\n            check.useDataPathUndo = useDataPathUndo;\r\n\r\n            if (tooltip) {\r\n              check.description = tooltip;\r\n            }\r\n\r\n            check.setUndo(useDataPathUndo);\r\n          }\r\n        }\r\n\r\n        rebuild();\r\n        let last_hash = prop.calcHash();\r\n\r\n        con.update.after(() => {\r\n          let hash = prop.calcHash();\r\n\r\n          if (last_hash !== hash) {\r\n            last_hash = hash;\r\n            console.error(\"Property definition update\");\r\n            rebuild();\r\n          }\r\n        });\r\n\r\n        return con;\r\n      }\r\n    }\r\n  }\r\n\r\n  iconcheck(inpath, icon, name, mass_set_path) {\r\n    let ret = UIBase.createElement(\"iconcheck-x\");\r\n    ret.icon = icon;\r\n    ret.description = name;\r\n\r\n    if (inpath) {\r\n      ret.setAttribute(\"datapath\", inpath);\r\n    }\r\n\r\n    if (mass_set_path) {\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n    }\r\n\r\n    this.add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  check(inpath, name, packflag = 0, mass_set_path = undefined) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let path = inpath !== undefined ? this._joinPrefix(inpath) : undefined;\r\n\r\n    //let prop = this.ctx.getProp(path);\r\n    let ret;\r\n    if (packflag & PackFlags.USE_ICONS) {\r\n      ret = UIBase.createElement(\"iconcheck-x\");\r\n\r\n      ret.iconsheet = iconSheetFromPackFlag(packflag);\r\n    } else {\r\n      ret = UIBase.createElement(\"check-x\");\r\n    }\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    ret.packflag |= packflag;\r\n    ret.label = name;\r\n    ret.noMarginsOrPadding();\r\n\r\n    if (inpath) {\r\n      ret.setAttribute(\"datapath\", path);\r\n    }\r\n\r\n    if (mass_set_path) {\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n    }\r\n\r\n    this._add(ret);\r\n\r\n    //ret.update();\r\n\r\n    return ret;\r\n  }\r\n\r\n  /*\r\n  *\r\n  * new (optional) form: checkenum(inpath, args)\r\n  * */\r\n  checkenum(inpath, name, packflag, enummap, defaultval, callback, iconmap, mass_set_path) {\r\n    if (typeof name === \"object\" && name !== null) {\r\n      let args = name;\r\n\r\n      name = args.name;\r\n      packflag = args.packflag;\r\n      enummap = args.enummap;\r\n      defaultval = args.defaultval;\r\n      callback = args.callback;\r\n      iconmap = args.iconmap;\r\n      mass_set_path = args.mass_set_path;\r\n    }\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    packflag = packflag === undefined ? 0 : packflag;\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let path = this._joinPrefix(inpath);\r\n\r\n    let has_path = path !== undefined;\r\n    let prop;\r\n    let frame;\r\n\r\n    if (path !== undefined) {\r\n      prop = this.ctx.api.resolvePath(this.ctx, path, true);\r\n\r\n      if (prop !== undefined)\r\n        prop = prop.prop;\r\n    }\r\n\r\n    if (path !== undefined) {\r\n      if (prop === undefined) {\r\n        console.warn(\"Bad path in checkenum\", path);\r\n        return;\r\n      }\r\n\r\n      frame = this.strip();\r\n      frame.oneAxisPadding();\r\n\r\n      if (packflag & PackFlags.USE_ICONS) {\r\n        for (let key in prop.values) {\r\n          let check = frame.check(inpath + \"[\" + key + \"]\", \"\", packflag);\r\n\r\n          check.packflag |= PackFlags.HIDE_CHECK_MARKS;\r\n\r\n          check.icon = prop.iconmap[key];\r\n          check.drawCheck = false;\r\n\r\n          check.style[\"padding\"] = \"0px\";\r\n          check.style[\"margin\"] = \"0px\";\r\n\r\n          check.dom.style[\"padding\"] = \"0px\";\r\n          check.dom.style[\"margin\"] = \"0px\";\r\n\r\n          check.description = prop.descriptions[key];\r\n          //console.log(check.description, key, prop.keys[key], prop.descriptions, prop.keys);\r\n        }\r\n      } else {\r\n        if (name === undefined) {\r\n          name = prop.uiname;\r\n        }\r\n\r\n        frame.label(name).font = \"TitleText\";\r\n\r\n        let checks = {};\r\n\r\n        let ignorecb = false;\r\n\r\n        function makecb(key) {\r\n          return () => {\r\n            if (ignorecb) return;\r\n\r\n            ignorecb = true;\r\n            for (let k in checks) {\r\n              if (k !== key) {\r\n                checks[k].checked = false;\r\n              }\r\n            }\r\n            ignorecb = false;\r\n\r\n            if (callback) {\r\n              callback(key);\r\n            }\r\n          }\r\n        }\r\n\r\n        for (let key in prop.values) {\r\n          let check = frame.check(`${inpath}[${key}]`, prop.ui_value_names[key]);\r\n          checks[key] = check;\r\n\r\n          if (mass_set_path) {\r\n            check.setAttribute(\"mass_set_path\", mass_set_path);\r\n          }\r\n\r\n\r\n          check.description = prop.descriptions[prop.keys[key]];\r\n          if (!check.description) {\r\n            check.description = \"\" + prop.ui_value_names[key];\r\n          }\r\n          check.onchange = makecb(key);\r\n        }\r\n      }\r\n    }\r\n\r\n    return frame;\r\n  }\r\n\r\n  checkenum_panel(inpath, name, packflag = 0, callback = undefined, mass_set_path = undefined, prop = undefined) {\r\n    packflag = packflag === undefined ? 0 : packflag;\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let path = this._joinPrefix(inpath);\r\n    let frame;\r\n\r\n    let has_path = path !== undefined;\r\n\r\n    if (path !== undefined && prop === undefined) {\r\n      prop = this.ctx.api.resolvePath(this.ctx, path, true);\r\n\r\n      if (prop !== undefined)\r\n        prop = prop.prop;\r\n    }\r\n\r\n    if (!name && prop) {\r\n      name = prop.uiname;\r\n    }\r\n\r\n    if (path !== undefined) {\r\n      if (prop === undefined) {\r\n        console.warn(\"Bad path in checkenum\", path);\r\n        return;\r\n      }\r\n\r\n      frame = this.panel(name, name, packflag);\r\n\r\n      frame.oneAxisPadding();\r\n      frame.setCSS.after(frame.background = this.getDefault(\"BoxSub2BG\"));\r\n\r\n      if (packflag & PackFlags.USE_ICONS) {\r\n        for (let key in prop.values) {\r\n          let check = frame.check(inpath + \" == \" + prop.values[key], \"\", packflag);\r\n\r\n          check.icon = prop.iconmap[key];\r\n          check.drawCheck = false;\r\n\r\n          check.style[\"padding\"] = \"0px\";\r\n          check.style[\"margin\"] = \"0px\";\r\n\r\n          check.dom.style[\"padding\"] = \"0px\";\r\n          check.dom.style[\"margin\"] = \"0px\";\r\n\r\n          check.description = prop.descriptions[key];\r\n          //console.log(check.description, key, prop.keys[key], prop.descriptions, prop.keys);\r\n        }\r\n      } else {\r\n        if (name === undefined) {\r\n          name = prop.uiname;\r\n        }\r\n\r\n        frame.label(name).font = \"TitleText\";\r\n\r\n        let checks = {};\r\n\r\n        let ignorecb = false;\r\n\r\n        function makecb(key) {\r\n          return () => {\r\n            if (ignorecb) return;\r\n\r\n            ignorecb = true;\r\n            for (let k in checks) {\r\n              if (k !== key) {\r\n                checks[k].checked = false;\r\n              }\r\n            }\r\n            ignorecb = false;\r\n\r\n            if (callback) {\r\n              callback(key);\r\n            }\r\n          }\r\n        }\r\n\r\n        for (let key in prop.values) {\r\n          let check = frame.check(inpath + \" = \" + prop.values[key], prop.ui_value_names[key]);\r\n          checks[key] = check;\r\n\r\n          if (mass_set_path) {\r\n            check.setAttribute(\"mass_set_path\", mass_set_path);\r\n          }\r\n\r\n\r\n          check.description = prop.descriptions[prop.keys[key]];\r\n          if (!check.description) {\r\n            check.description = \"\" + prop.ui_value_names[key];\r\n          }\r\n          check.onchange = makecb(key);\r\n          //console.log(\"PATH\", path);\r\n        }\r\n      }\r\n    }\r\n\r\n    return frame;\r\n  }\r\n\r\n  /*\r\n    enummap is an object that maps\r\n    ui names to keys, e.g.:\r\n\r\n    ui.listenum(\"color\", \"Color\", {\r\n      RED   : 0,\r\n      GREEN : 1,\r\n      BLUE  : 2\r\n    });\r\n\r\n    path can be undefined, in which case, use callback,\r\n    which gets the current enum as an argument\r\n\r\n    defaultval cannot be undefined\r\n  */\r\n  listenum(inpath, name, enumDef, defaultval, callback, iconmap, packflag = 0) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n    let mass_set_path;\r\n\r\n    if (name && typeof name === \"object\") {\r\n      let args = name;\r\n\r\n      name = args.name;\r\n      enumDef = args.enumDef;\r\n      defaultval = args.defaultval;\r\n      callback = args.callback;\r\n      iconmap = args.iconmap;\r\n      packflag = args.packflag || 0;\r\n      mass_set_path = args.mass_set_path;\r\n    }\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    let path;\r\n\r\n    if (inpath !== undefined) {\r\n      path = this._joinPrefix(inpath);\r\n    }\r\n\r\n    let ret = UIBase.createElement(\"dropbox-x\")\r\n    if (enumDef !== undefined) {\r\n      if (enumDef instanceof toolprop.EnumProperty) {\r\n        ret.prop = enumDef;\r\n      } else {\r\n        ret.prop = new toolprop.EnumProperty(defaultval, enumDef, path, name);\r\n      }\r\n\r\n      if (iconmap !== undefined) {\r\n        ret.prop.addIcons(iconmap)\r\n      }\r\n    } else {\r\n      let res = this.ctx.api.resolvePath(this.ctx, path, true);\r\n\r\n      if (res !== undefined) {\r\n        ret.prop = res.prop;\r\n\r\n        name = name === undefined ? res.prop.uiname : name;\r\n      }\r\n    }\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    if (path !== undefined) {\r\n      ret.setAttribute(\"datapath\", path);\r\n    }\r\n    if (mass_set_path !== undefined) {\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n    }\r\n\r\n    ret.setAttribute(\"name\", name);\r\n\r\n    if (defaultval) {\r\n      ret.setValue(defaultval);\r\n    }\r\n\r\n    ret.onchange = callback;\r\n    ret.onselect = callback;\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  getroot() {\r\n    let p = this;\r\n\r\n    while (p.parent !== undefined) {\r\n      p = p.parent;\r\n    }\r\n\r\n    return p;\r\n  }\r\n\r\n  simpleslider(inpath, name, defaultval, min, max, step, is_int, do_redraw, callback, packflag = 0) {\r\n    if (arguments.length === 2 || typeof name === \"object\") {\r\n      let args = Object.assign({}, name);\r\n\r\n      args.packflag = (args.packflag || 0) | PackFlags.SIMPLE_NUMSLIDERS;\r\n      return this.slider(inpath, args);\r\n      //new-style api call\r\n    } else {\r\n      return this.slider(inpath, name, defaultval, min, max, step, is_int, do_redraw, callback, packflag | PackFlags.SIMPLE_NUMSLIDERS);\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * usage: .slider(inpath, {\r\n   *  name : bleh,\r\n   *  defaultval : number,\r\n   *  etc...\r\n   * });\r\n   * */\r\n  slider(inpath, name, defaultval, min, max, step, is_int, do_redraw, callback, packflag = 0) {\r\n    if (arguments.length === 2 || typeof name === \"object\") {\r\n      //new-style api call\r\n\r\n      let args = name;\r\n\r\n      name = args.name;\r\n      defaultval = args.defaultval;\r\n      min = args.min;\r\n      max = args.max;\r\n      step = args.step;\r\n      is_int = args.is_int || args.isInt;\r\n      do_redraw = args.do_redraw;\r\n      callback = args.callback;\r\n      packflag = args.packflag || 0;\r\n    }\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n    let ret;\r\n\r\n    if (inpath) {\r\n      inpath = this._joinPrefix(inpath);\r\n\r\n      let rdef = this.ctx.api.resolvePath(this.ctx, inpath, true);\r\n      if (rdef && rdef.prop && (rdef.prop.flag & PropFlags.SIMPLE_SLIDER)) {\r\n        packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n      }\r\n      if (rdef && rdef.prop && (rdef.prop.flag & PropFlags.FORCE_ROLLER_SLIDER)) {\r\n        packflag |= PackFlags.FORCE_ROLLER_SLIDER;\r\n      }\r\n    }\r\n\r\n    let simple = (packflag & PackFlags.SIMPLE_NUMSLIDERS) || cconst.simpleNumSliders;\r\n    simple = simple && !(packflag & PackFlags.FORCE_ROLLER_SLIDER);\r\n\r\n    let extraTextBox = cconst.useNumSliderTextboxes && !(packflag & PackFlags.NO_NUMSLIDER_TEXTBOX);\r\n\r\n    if (extraTextBox) {\r\n      if (simple) {\r\n        ret = UIBase.createElement(\"numslider-simple-x\");\r\n      } else {\r\n        ret = UIBase.createElement(\"numslider-textbox-x\");\r\n      }\r\n    } else {\r\n      if (simple) {\r\n        ret = UIBase.createElement(\"numslider-simple-x\");\r\n      } else {\r\n        ret = UIBase.createElement(\"numslider-x\");\r\n      }\r\n    }\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    let decimals;\r\n\r\n    if (inpath) {\r\n      ret.setAttribute(\"datapath\", inpath);\r\n    }\r\n\r\n    if (name) {\r\n      ret.setAttribute(\"name\", name);\r\n    }\r\n\r\n    if (min !== undefined) {\r\n      ret.setAttribute(\"min\", min);\r\n    }\r\n    if (max !== undefined) {\r\n      ret.setAttribute(\"max\", max);\r\n    }\r\n\r\n    if (defaultval !== undefined) {\r\n      ret.setValue(defaultval);\r\n    }\r\n\r\n    if (is_int) {\r\n      ret.setAttribute(\"integer\", is_int);\r\n    }\r\n\r\n    if (decimals !== undefined) {\r\n      ret.decimalPlaces = decimals;\r\n    }\r\n\r\n    if (callback) {\r\n      ret.onchange = callback;\r\n    }\r\n\r\n    this._add(ret);\r\n\r\n    if (this.ctx) {\r\n      ret.setCSS();\r\n      ret.update();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  _container_inherit(elem, packflag = 0) {\r\n    //don't inherit NO_UPDATE\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    elem.packflag |= packflag;\r\n    elem.inherit_packflag |= packflag;\r\n    elem.dataPrefix = this.dataPrefix;\r\n    elem.massSetPrefix = this.massSetPrefix;\r\n  }\r\n\r\n  treeview() {\r\n    let ret = UIBase.createElement(\"tree-view-x\");\r\n    ret.ctx = this.ctx;\r\n    this.add(ret);\r\n\r\n    this._container_inherit(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  panel(name, id, packflag = 0, tooltip = undefined) {\r\n    id = id === undefined ? name : id;\r\n\r\n    let ret = UIBase.createElement(\"panelframe-x\");\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    if (tooltip) {\r\n      ret.setHeaderToolTip(tooltip);\r\n    }\r\n\r\n    ret.setAttribute(\"label\", name);\r\n    ret.setAttribute(\"id\", id);\r\n\r\n    this._add(ret);\r\n\r\n\r\n    if (this.ctx) {//check init was called\r\n      ret.ctx = this.ctx;\r\n      ret._init();\r\n      //ret.headerLabel = name;\r\n\r\n      ret.contents.ctx = ret.ctx;\r\n    }\r\n\r\n    ret.contents.dataPrefix = this.dataPrefix;\r\n    ret.contents.massSetPrefix = this.massSetPrefix;\r\n\r\n    return ret;\r\n  }\r\n\r\n  row(packflag = 0) {\r\n    let ret = UIBase.createElement(\"rowframe-x\");\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n\r\n    ret.ctx = this.ctx;\r\n\r\n    return ret;\r\n  }\r\n\r\n  listbox(packflag = 0) {\r\n    let ret = UIBase.createElement(\"listbox-x\");\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  table(packflag = 0) {\r\n    let ret = UIBase.createElement(\"tableframe-x\");\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  twocol(parentDepth = 1, packflag = 0) {\r\n    let ret = UIBase.createElement(\"two-column-x\");\r\n\r\n    ret.parentDepth = parentDepth;\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  col(packflag = 0) {\r\n    let ret = UIBase.createElement(\"colframe-x\");\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  colorPicker(inpath, packflag_or_args = 0, mass_set_path = undefined, themeOverride = undefined) {\r\n    let packflag;\r\n\r\n    if (typeof packflag_or_args === \"object\") {\r\n      let args = packflag_or_args;\r\n\r\n      packflag = args.packflag !== undefined ? args.packflag : 0;\r\n      mass_set_path = args.massSetPath;\r\n      themeOverride = args.themeOverride;\r\n    }\r\n\r\n    let path;\r\n\r\n    if (inpath) {\r\n      path = this._joinPrefix(inpath);\r\n    }\r\n\r\n    let ret = UIBase.createElement(\"colorpicker-x\");\r\n\r\n    if (themeOverride) {\r\n      ret.overrideClass(themeOverride);\r\n    }\r\n\r\n    packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    ret.ctx = this.ctx;\r\n    ret.parentWidget = this;\r\n    ret._init();\r\n    ret.packflag |= packflag;\r\n    ret.inherit_packflag |= packflag;\r\n    ret.constructor.setDefault(ret);\r\n\r\n    if (path !== undefined) {\r\n      ret.setAttribute(\"datapath\", path);\r\n    }\r\n\r\n    console.warn(\"mass_set_path\", mass_set_path);\r\n    if (mass_set_path) {\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n    }\r\n\r\n    //XXX\r\n    window.colorpicker = ret;\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  textarea(datapath = undefined, value = \"\", packflag = 0, mass_set_path = undefined) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, datapath, mass_set_path);\r\n\r\n    let ret = UIBase.createElement(\"rich-text-editor-x\");\r\n    ret.ctx = this.ctx;\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    if (value !== undefined) {\r\n      ret.value = value;\r\n    }\r\n\r\n    if (datapath)\r\n      ret.setAttribute(\"datapath\", datapath)\r\n    if (mass_set_path)\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path)\r\n\r\n    this.add(ret);\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   * html5 viewer\r\n   * */\r\n  viewer(datapath = undefined, value = \"\", packflag = 0, mass_set_path = undefined) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, datapath, mass_set_path);\r\n\r\n    let ret = UIBase.createElement(\"html-viewer-x\");\r\n    ret.ctx = this.ctx;\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    if (value !== undefined) {\r\n      ret.value = value;\r\n    }\r\n\r\n    if (datapath)\r\n      ret.setAttribute(\"datapath\", datapath)\r\n    if (mass_set_path)\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path)\r\n\r\n    this.add(ret);\r\n    return ret;\r\n  }\r\n\r\n  //\r\n  tabs(position = \"top\", packflag = 0) {\r\n\r\n    let ret = UIBase.createElement(\"tabcontainer-x\");\r\n\r\n    ret.constructor.setDefault(ret);\r\n    ret.setAttribute(\"bar_pos\", position);\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  asDialogFooter() {\r\n    this.style['margin-top'] = '15px';\r\n    this.style['justify-content'] = 'flex-end';\r\n\r\n    return this;\r\n  }\r\n\r\n};\r\n\r\nui_base.UIBase.internalRegister(Container, \"div\");\r\n\r\n\r\nexport class RowFrame extends Container {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: 'rowframe-x'\r\n    };\r\n  }\r\n\r\n  //try to set styling as early as possible\r\n  connectedCallback() {\r\n    super.connectedCallback();\r\n\r\n    this.style['display'] = 'flex';\r\n    this.style['flex-direction'] = this.reversed ? 'row-reverse' : 'row';\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style['display'] = 'flex';\r\n    this.style['flex-direction'] = this.reversed ? 'row-reverse' : 'row';\r\n\r\n    if (!this.style['align-items'] || this.style['align-items'] == '') {\r\n      this.style['align-items'] = 'center';\r\n    }\r\n\r\n    if (this.getDefault(\"slider-style\") === \"simple\") {\r\n      this.packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n      this.inherit_packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n    }\r\n  }\r\n\r\n  oneAxisMargin(m = this.getDefault('oneAxisMargin'), m2 = 0) {\r\n    this.style['margin-left'] = this.style['margin-right'] = m + 'px';\r\n    this.style['margin-top'] = this.style['margin-bottom'] = '' + m2 + 'px';\r\n\r\n    return this;\r\n  }\r\n\r\n  oneAxisPadding(m = this.getDefault('oneAxisPadding'), m2 = 0) {\r\n    this.style['padding-left'] = this.style['padding-right'] = '' + m + 'px';\r\n    this.style['padding-top'] = this.style['padding-bottom'] = '' + m2 + 'px';\r\n\r\n    return this;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(RowFrame);\r\n\r\nexport class ColumnFrame extends Container {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"colframe-x\"\r\n    };\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-direction\"] = \"column\";\r\n    this.style[\"justify-content\"] = \"right\";\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  oneAxisMargin(m = this.getDefault('oneAxisMargin'), m2 = 0) {\r\n    this.style['margin-top'] = this.style['margin-bottom'] = '' + m + 'px';\r\n    this.style['margin-left'] = this.style['margin-right'] = m2 + 'px';\r\n\r\n    return this;\r\n  }\r\n\r\n  oneAxisPadding(m = this.getDefault('oneAxisPadding'), m2 = 0) {\r\n    this.style['padding-top'] = this.style['padding-bottom'] = '' + m + 'px';\r\n    this.style['padding-left'] = this.style['padding-right'] = '' + m2 + 'px';\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ColumnFrame);\r\n\r\n\r\nexport class TwoColumnFrame extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this._colWidth = 256;\r\n    this.parentDepth = 1;\r\n  }\r\n\r\n  get colWidth() {\r\n    if (this.hasAttribute(\"colWidth\")) {\r\n      return parsepx(this.getAttribute(\"colWidth\"));\r\n    }\r\n\r\n    return this._colWidth;\r\n  }\r\n\r\n  set colWidth(v) {\r\n    if (this.hasAttribute(\"colWidth\")) {\r\n      this.setAttribute(\"colWidth\", \"\" + v);\r\n    } else {\r\n      this._colWidth = v;\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"two-column-x\"\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-direction\"] = \"column\";\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    let p = this;\r\n\r\n    for (let i = 0; i < this.parentDepth; i++) {\r\n      p = p.parentWidget ? p.parentWidget : p;\r\n    }\r\n\r\n    if (!p) {\r\n      return;\r\n    }\r\n\r\n    let r = p.getBoundingClientRect();\r\n\r\n    if (!r) {\r\n      return;\r\n    }\r\n\r\n    let style = r.width > this.colWidth*2.0 ? 'row' : 'column';\r\n\r\n    if (this.style[\"flex-direction\"] !== style) {\r\n      this.style[\"flex-direction\"] = style;\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(TwoColumnFrame);\r\n","import * as util from '../path-controller/util/util.js';\r\nimport * as ui from '../core/ui.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport {Icons, css2color, color2css} from '../core/ui_base.js';\r\n\r\nlet UIBase = ui_base.UIBase;\r\n\r\nexport class Note extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    let style = document.createElement(\"style\");\r\n\r\n    this._noteid = undefined;\r\n    this.height = 20;\r\n\r\n    this.showExclMark = true;\r\n\r\n    style.textContent = `\r\n    .notex {\r\n      display : flex;\r\n      flex-direction : row;\r\n      flex-wrap : nowrap;\r\n      height : {this.height}px;\r\n      padding : 0px;\r\n      margin : 0px;\r\n    }\r\n    `;\r\n\r\n    this.dom = document.createElement(\"div\");\r\n    this.dom.setAttribute(\"class\", \"notex\");\r\n    this.color = \"red\";\r\n\r\n    this.shadow.appendChild(style);\r\n    this.shadow.append(this.dom);\r\n    this.setLabel(\"\");\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"note-x\",\r\n      style  : 'notification',\r\n    }\r\n  }\r\n\r\n  setLabel(s) {\r\n    let color = this.color;\r\n    if (this.showExclMark && this.mark === undefined) {\r\n      this.mark = document.createElement(\"div\");\r\n      this.mark.style[\"display\"] = \"flex\";\r\n      this.mark.style[\"flex-direction\"] = \"row\";\r\n      this.mark.style[\"flex-wrap\"] = \"nowrap\";\r\n\r\n      //this.mark.style[\"width\"]\r\n      let sheet = 0;\r\n\r\n      let size = ui_base.iconmanager.getTileSize(sheet);\r\n\r\n      this.mark.style[\"width\"] = \"\" + size + \"px\";\r\n      this.mark.style[\"height\"] = \"\" + size + \"px\";\r\n\r\n      this.dom.appendChild(this.mark);\r\n\r\n      this.ntext = document.createElement(\"div\");\r\n      this.ntext.style[\"display\"] = \"inline-flex\";\r\n      this.ntext.style[\"flex-wrap\"] = \"nowrap\";\r\n\r\n      this.dom.appendChild(this.ntext);\r\n\r\n      ui_base.iconmanager.setCSS(Icons.NOTE_EXCL, this.mark, sheet);\r\n\r\n      //this.mark.style[\"margin\"] = this.ntext.style[\"margin\"] = \"0px\"\r\n      //this.mark.style[\"padding\"] = this.ntext.style[\"padding\"] = \"0px\"\r\n      //this.mark.style[\"background-color\"] = color;\r\n    } else if (!this.showExclMark && this.mark) {\r\n      this.mark.remove();\r\n      this.mark = undefined;\r\n    }\r\n\r\n    let ntext = this.ntext;\r\n    //mark.innerText = \"!\";\r\n    ntext.innerText = \" \" + s;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.setAttribute(\"class\", \"notex\");\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-wrap\"] = \"nowrap\";\r\n    this.style[\"flex-direction\"] = \"row\";\r\n    this.style[\"border-radius\"] = \"7px\";\r\n    this.style[\"padding\"] = \"2px\";\r\n\r\n    this.style[\"color\"] = this.getDefault(\"DefaultText\").color;\r\n    let clr = css2color(this.color);\r\n    clr = color2css([clr[0], clr[1], clr[2], 0.25]);\r\n\r\n    this.style[\"background-color\"] = clr;\r\n    this.setCSS();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS(false);\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(Note);\r\n\r\nexport class ProgBarNote extends Note {\r\n  constructor() {\r\n    super();\r\n\r\n    this._percent = 0.0;\r\n    this.barWidth = 100;\r\n\r\n    let bar = this.bar = document.createElement(\"div\");\r\n    bar.style[\"display\"] = \"flex\";\r\n    bar.style[\"flex-direction\"] = \"row\";\r\n    bar.style[\"width\"] = this.barWidth + \"px\";\r\n    bar.style[\"height\"] = this.height + \"px\";\r\n    bar.style[\"background-color\"] = this.getDefault(\"ProgressBarBG\");\r\n    bar.style[\"border-radius\"] = \"12px\";\r\n    bar.style[\"align-items\"] = \"center\";\r\n    bar.style[\"padding\"] = bar.style[\"margin\"] = \"0px\";\r\n\r\n    let bar2 = this.bar2 = document.createElement(\"div\");\r\n    let w = 50.0;\r\n\r\n    bar2.style[\"display\"] = \"flex\";\r\n    bar2.style[\"flex-direction\"] = \"row\";\r\n    bar2.style[\"height\"] = this.height + \"px\";\r\n    bar2.style[\"background-color\"] = this.getDefault(\"ProgressBar\");\r\n    bar2.style[\"border-radius\"] = \"12px\";\r\n    bar2.style[\"align-items\"] = \"center\";\r\n    bar2.style[\"padding\"] = bar2.style[\"margin\"] = \"0px\";\r\n\r\n    this.bar.appendChild(bar2);\r\n    this.dom.appendChild(this.bar);\r\n  }\r\n\r\n  get percent() {\r\n    return this._percent;\r\n  }\r\n\r\n  set percent(val) {\r\n    this._percent = val;\r\n    this.setCSS();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"note-progress-x\",\r\n      style  : 'notification',\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    let w = ~~(this.percent*this.barWidth + 0.5);\r\n\r\n    this.bar2.style[\"width\"] = w + \"px\";\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ProgBarNote);\r\n\r\nexport class NoteFrame extends ui.RowFrame {\r\n  constructor() {\r\n    super();\r\n    this._h = 20;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"noteframe-x\",\r\n      style  : 'noteframe',\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.noMarginsOrPadding();\r\n\r\n    noteframes.push(this);\r\n    this.background = this.getDefault(\"background-color\");\r\n    this.style['flex-grow'] = 'unset';\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.style[\"width\"] = \"min-contents\";\r\n    this.style[\"height\"] = this._h + \"px\";\r\n  }\r\n\r\n  _ondestroy() {\r\n    if (noteframes.indexOf(this) >= 0) {\r\n      noteframes.remove(this)\r\n    }\r\n\r\n    super._ondestroy();\r\n  }\r\n\r\n  progbarNote(msg, percent, color = \"rgba(255,0,0,0.2)\", timeout = 700, id = msg) {\r\n    let note;\r\n\r\n    for (let child of this.children) {\r\n      if (child._noteid === id) {\r\n        note = child;\r\n        break;\r\n      }\r\n    }\r\n\r\n    let f = (100.0*Math.min(percent, 1.0)).toFixed(1);\r\n\r\n    if (note === undefined) {\r\n      note = this.addNote(msg, color, -1, \"note-progress-x\");\r\n      note._noteid = id;\r\n    }\r\n\r\n    //note.setLabel(msg + \" \" + f + \"%\");\r\n    note.percent = percent;\r\n\r\n    if (percent >= 1.0) {\r\n      //note.setLabel(msg + \" \" + f + \"%\");\r\n\r\n      window.setTimeout(() => {\r\n        note.remove();\r\n      }, timeout);\r\n    }\r\n\r\n    return note;\r\n  }\r\n\r\n  addNote(msg, color = \"rgba(255,0,0,0.2)\", timeout = 1200, tagname = \"note-x\", showExclMark=true) {\r\n    //let note = UIBase.createElement(\"note-x\");\r\n\r\n    //note.ctx = this.ctx;\r\n    //note.background = \"red\";\r\n    //note.dom.innerText = msg;\r\n\r\n    //this._add(note);\r\n\r\n    let note = UIBase.createElement(tagname);\r\n\r\n    note.color = color;\r\n    note.setLabel(msg);\r\n\r\n    note.style[\"text-align\"] = \"center\";\r\n\r\n    note.style[\"font\"] = ui_base.getFont(note, \"DefaultText\");\r\n    note.style[\"color\"] = this.getDefault(\"DefaultText\").color;\r\n    note.showExclMark = showExclMark;\r\n\r\n    this.add(note);\r\n\r\n    this.noMarginsOrPadding();\r\n    note.noMarginsOrPadding();\r\n\r\n    //this.dom.style[\"position\"] = UIBase.PositionKey;\r\n    //this.style[\"position\"] = UIBase.PositionKey;\r\n    //note.style[\"position\"] = UIBase.PositionKey;\r\n\r\n    note.style[\"height\"] = this._h + \"px\";\r\n    note.height = this._h;\r\n\r\n    if (timeout !== -1) {\r\n      window.setTimeout(() => {\r\n        //console.log(\"remove!\");\r\n        note.remove();\r\n      }, timeout);\r\n    }\r\n\r\n    //this.appendChild(note);\r\n    return note;\r\n\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(NoteFrame);\r\n\r\nexport function getNoteFrames(screen) {\r\n  let ret = [];\r\n\r\n  let rec = (n) => {\r\n\r\n    if (n instanceof NoteFrame) {\r\n      ret.push(n);\r\n    }\r\n\r\n    if (n.childNodes !== undefined) {\r\n      for (let node of n.childNodes) {\r\n        rec(node);\r\n      }\r\n    }\r\n\r\n    if (n instanceof ui_base.UIBase && n.shadow !== undefined && n.shadow.childNodes) {\r\n      for (let node of n.shadow.childNodes) {\r\n        rec(node);\r\n      }\r\n    }\r\n  }\r\n\r\n  rec(screen);\r\n  return ret;\r\n}\r\n\r\nexport let noteframes = [];\r\n\r\nexport function sendNote(screen, msg, color, timeout = 3000, showExclMark=true) {\r\n  noteframes = getNoteFrames(screen);\r\n\r\n  for (let frame of noteframes) {\r\n    try {\r\n      frame.addNote(msg, color, timeout, undefined, showExclMark);\r\n    } catch (error) {\r\n      print_stack(error);\r\n      console.log(error.stack, error.message);\r\n      console.log(\"bad notification frame\");\r\n    }\r\n  }\r\n}\r\n\r\nwindow._sendNote = sendNote;\r\n\r\nexport function error(screen, msg, timeout) {\r\n  return sendNote(screen, msg, ui_base.color2css([1.0, 0.0, 0.0, 1.0]), timeout);\r\n}\r\n\r\nexport function warning(screen, msg, timeout) {\r\n  return sendNote(screen, msg, ui_base.color2css([0.78, 0.78, 0.2, 1.0]), timeout);\r\n}\r\n\r\nexport function message(screen, msg, timeout) {\r\n  return sendNote(screen, msg, ui_base.color2css([0.2, 0.9, 0.1, 1.0]), timeout, false);\r\n}\r\n\r\n\r\nexport function progbarNote(screen, msg, percent, color, timeout) {\r\n  noteframes = getNoteFrames(screen);\r\n\r\n  for (let frame of noteframes) {\r\n    try {\r\n      frame.progbarNote(msg, percent, color, timeout);\r\n    } catch (error) {\r\n      print_stack(error);\r\n      console.log(error.stack, error.message);\r\n      console.log(\"bad notification frame\");\r\n    }\r\n  }\r\n}\r\n","import * as ui_base from '../core/ui_base.js'\r\nimport * as util from '../path-controller/util/util.js';\r\nimport {ColumnFrame, RowFrame, Container} from \"../core/ui.js\";\r\nlet UIBase = ui_base.UIBase, Icons = ui_base.Icons;\r\nimport {TextBoxBase} from './ui_textbox.js';\r\nimport {keymap} from \"../path-controller/util/simple_events.js\";\r\n\r\nexport class RichEditor extends TextBoxBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._internalDisabled = false;\r\n    this._value = \"\";\r\n\r\n    this.textOnlyMode = false;\r\n\r\n    this.styletag = document.createElement(\"style\");\r\n    this.styletag.textContent = `\r\n      div.rich-text-editor-x {\r\n        width        :   100%;\r\n        height       :   100%;\r\n        min-height   :   150px;\r\n        overflow     :   scroll;\r\n        padding      :   5px;\r\n        white-space  :   pre-wrap;\r\n      }\r\n      \r\n      rich-text-editor-x {\r\n        display        : flex;\r\n        flex-direction : column;\r\n      }\r\n    `;\r\n\r\n    this.shadow.appendChild(this.styletag);\r\n\r\n    let controls = this.controls = UIBase.createElement(\"rowframe-x\");\r\n\r\n\r\n    let makeicon = (icon, description, cb) => {\r\n      icon = controls.iconbutton(icon, description, cb);\r\n      icon.iconsheet = 1; //use second smallest icon size\r\n      icon.overrideDefault(\"padding\", 3);\r\n\r\n      return icon;\r\n    };\r\n\r\n    makeicon(Icons.BOLD, \"Bold\", () => {\r\n      document.execCommand(\"bold\");\r\n    });\r\n    makeicon(Icons.ITALIC, \"Italic\", () => {\r\n      document.execCommand(\"italic\");\r\n    });\r\n    makeicon(Icons.UNDERLINE, \"Underline\", () => {\r\n      document.execCommand(\"underline\");\r\n    });\r\n    makeicon(Icons.STRIKETHRU, \"Strikethrough\", () => {\r\n      document.execCommand(\"strikeThrough\");\r\n    });\r\n\r\n    controls.background = this.getDefault(\"background-color\");\r\n\r\n    this.shadow.appendChild(controls);\r\n\r\n    this.textarea = document.createElement(\"div\");\r\n    this.textarea.contentEditable = true;\r\n    this.textarea.setAttribute(\"class\", \"rich-text-editor-x\");\r\n\r\n    this.textarea.style[\"font\"] = this.getDefault(\"DefaultText\").genCSS();\r\n    this.textarea.style[\"background-color\"] = this.getDefault(\"background-color\");\r\n    this.textarea.setAttribute(\"white-space\", \"pre-wrap\");\r\n\r\n    this.textarea.addEventListener(\"keydown\", (e) => {\r\n      if (e.keyCode === keymap[\"S\"] && e.shiftKey && (e.ctrlKey || e.commandKey)) {\r\n        this.toggleStrikeThru();\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n    });\r\n\r\n    this.textarea.addEventListener(\"focus\", (e) => {\r\n      this._focus = 1;\r\n      this.setCSS();\r\n    });\r\n    this.textarea.addEventListener(\"blur\", (e) => {\r\n      this._focus = 0;\r\n      this.setCSS();\r\n    });\r\n\r\n    document.execCommand(\"styleWithCSS\", true);\r\n\r\n    window.ta = this;\r\n\r\n    this.textarea.addEventListener(\"selectionchange\", (e) => {\r\n      console.log(\"sel1\");\r\n    });\r\n\r\n    document.addEventListener(\"selectionchange\", (e, b) => {\r\n      console.log(\"sel2\", document.getSelection().startNode, b);\r\n    });\r\n\r\n    this.textarea.addEventListener(\"input\", (e) => {\r\n      if (this.internalDisabled) {\r\n        return;\r\n      }\r\n\r\n      console.log(\"text input\", e);\r\n\r\n      let text;\r\n\r\n      if (this.textOnlyMode) {\r\n        text = this.textarea.innerText;\r\n      } else {\r\n        text = this.textarea.innerHTML;\r\n      }\r\n\r\n      if (this.textOnlyMode && text === this._value) {\r\n        //formatting changed?\r\n        console.log(\"detected formatting change\");\r\n        return;\r\n      }\r\n\r\n      //console.log(\"text changed\", ...arguments);\r\n      let sel = document.getSelection();\r\n      let range = sel.getRangeAt(0);\r\n      //console.log(range.startOffset, range.endOffset, range.startContainer);\r\n\r\n      let node = sel.anchorNode;\r\n      let off = sel.anchorOffset;\r\n\r\n      this._value = text;\r\n\r\n      //sel.collapse(node, off);\r\n\r\n      if (this.hasAttribute(\"datapath\")) {\r\n        let path = this.getAttribute(\"datapath\");\r\n        this.setPathValue(this.ctx, path, this.value);\r\n      }\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this._value);\r\n      }\r\n      if (this.oninput) {\r\n        this.oninput(this._value);\r\n      }\r\n\r\n      this.dispatchEvent(new InputEvent(this));\r\n      this.dispatchEvent(new CustomEvent('change'));\r\n    });\r\n\r\n    this.shadow.appendChild(this.textarea);\r\n  }\r\n\r\n  /**\r\n   * Only available in textOnlyMode.  Called when starting text formatting\r\n  */\r\n  formatStart() {\r\n  }\r\n\r\n  /**\r\n  * Only available in textOnlyMode.  Formats html-formated line.\r\n   *\r\n   * @param line : line to format\r\n   * @parem text : whole text\r\n  * */\r\n  formatLine(line, text) {\r\n    return line;\r\n  }\r\n\r\n  toggleStrikeThru() {\r\n    console.log(\"strike thru!\");\r\n    document.execCommand(\"strikeThrough\");\r\n  }\r\n  /**\r\n   * Only available in textOnlyMode.  Called when starting text formatting\r\n   */\r\n  formatEnd() {\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    window.rc = this;\r\n\r\n    document.execCommand(\"defaultParagraphSeparator\", false, \"div\");\r\n\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  get internalDisabled() {\r\n    return this._internalDisabled;\r\n  }\r\n\r\n  set internalDisabled(val) {\r\n    let changed = !!this._internalDisabled !== !!val;\r\n\r\n    if (changed || 1) {\r\n      this._internalDisabled = !!val;\r\n      super.internalDisabled = val;\r\n\r\n      this.textarea.internalDisabled = val;\r\n      this.textarea.contentEditable = !val;\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  set value(val) {\r\n    this._value = val;\r\n\r\n    if (this.textOnlyMode) {\r\n      let val2 = \"\";\r\n      for (let l of val.split(\"\\n\")) {\r\n        val2 += l + \"<br>\";\r\n      }\r\n      val = val2;\r\n    }\r\n\r\n    this.textarea.innerHTML = val;\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.controls.background = this.getDefault(\"background-color\");\r\n\r\n    if (this._focus) {\r\n      this.textarea.style[\"border\"] = `2px dashed ${this.getDefault('focus-border-color')}`;\r\n    } else {\r\n      this.textarea.style[\"border\"] = \"none\";\r\n    }\r\n\r\n    if (this.style[\"font\"]) {\r\n      this.textarea.style[\"font\"] = this.style[\"font\"];\r\n    } else {\r\n      this.textarea.style[\"font\"] = this.getDefault(\"DefaultText\").genCSS();\r\n    }\r\n\r\n    if (this.style[\"color\"]) {\r\n      this.textarea.style[\"color\"] = this.style[\"color\"];\r\n    }  else {\r\n      this.textarea.style[\"color\"] = this.getDefault(\"DefaultText\").color;\r\n    }\r\n\r\n\r\n    if (this.disabled) {\r\n      this.textarea.style[\"background-color\"] = this.getDefault(\"DisabledBG\");\r\n    } else {\r\n      this.textarea.style[\"background-color\"] = this.getDefault(\"background-color\");\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n    let prop = this.getPathMeta(this.ctx, path);\r\n\r\n    if (prop === undefined) {\r\n      console.warn(\"invalid datapath \" + path);\r\n\r\n      this.internalDisabled = true;\r\n      return;\r\n    }\r\n\r\n    this.internalDisabled = false;\r\n    let value = this.getPathValue(this.ctx, path);\r\n\r\n    if (value !== this._value) {\r\n      console.log(\"text change\");\r\n      this.value = value;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateDataPath();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"rich-text-editor-x\",\r\n    style   : \"richtext\",\r\n    modalKeyEvents : true\r\n  }}\r\n}\r\nUIBase.internalRegister(RichEditor);\r\n\r\nexport class RichViewer extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.contents = document.createElement(\"div\");\r\n    this.contents.style[\"padding\"] = \"10px\";\r\n    this.contents.style[\"margin\"] = \"10px\";\r\n    this.contents.style[\"overflow\"] = \"scroll\";\r\n\r\n    this.shadow.appendChild(this.contents);\r\n    this._value = \"\";\r\n  }\r\n\r\n  hideScrollBars() {\r\n    this.contents.style[\"overflow\"] = \"hidden\"\r\n  }\r\n\r\n  showScrollBars() {\r\n    this.contents.style[\"overflow\"] = \"scroll\"\r\n  }\r\n\r\n  //transforms text into final html form\r\n  //note that client code is allowed to override this directly\r\n  textTransform(text) {\r\n    return text;\r\n  }\r\n  set value(val) {\r\n    this._value = val;\r\n\r\n    this.contents.innerHTML = this.textTransform(val);\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n    let prop = this.getPathMeta(this.ctx, path);\r\n\r\n    if (prop === undefined) {\r\n      console.warn(\"invalid datapath \" + path);\r\n\r\n      this.internalDisabled = true;\r\n      return;\r\n    }\r\n\r\n    this.internalDisabled = false;\r\n    let value = this.getPathValue(this.ctx, path);\r\n\r\n    if (value !== this.value) {\r\n      this.value = value;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateDataPath();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"html-viewer-x\",\r\n    style   : \"html_viewer\"\r\n  }}\r\n}\r\nUIBase.internalRegister(RichViewer);\r\n","\"use strict\";\r\nimport './ui_richedit.js';\r\n\r\nimport * as util from '../util/util.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport {Vector2, Vector3, Vector4, Quat, Matrix4} from '../path-controller/util/vectormath.js';\r\nimport {RowFrame, ColumnFrame} from \"../core/ui.js\";\r\nimport {isNumber, PropFlags} from \"../path-controller/toolsys/toolprop.js\";\r\n\r\nimport './ui_widgets.js';\r\n\r\nlet keymap = events.keymap;\r\n\r\nimport {EnumProperty, PropTypes} from '../path-controller/toolsys/toolprop.js';\r\nimport {UIBase, PackFlags, IconSheets, parsepx} from '../core/ui_base.js';\r\n\r\nimport * as units from '../core/units.js';\r\nimport {ToolProperty} from '../path-controller/toolsys/toolprop.js';\r\nimport {Button} from \"./ui_button.js\";\r\n\r\nexport class VectorPopupButton extends Button {\r\n  constructor() {\r\n    super();\r\n\r\n    this.value = new Vector4();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"vector-popup-button-x\",\r\n    style : \"vecPopupButton\"\r\n  }}\r\n\r\n  _onpress(e) {\r\n    if (e.button && e.button !== 0) {\r\n      return;\r\n    }\r\n\r\n    let panel = UIBase.createElement(\"vector-panel-x\");\r\n    let screen = this.ctx.screen;\r\n\r\n    let popup = screen.popup(this, this);\r\n\r\n    popup.add(panel);\r\n    popup.button(\"ok\", () => {\r\n      popup.end();\r\n    })\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      panel.setAttribute(\"datapath\", this.getAttribute(\"datapath\"));\r\n    }\r\n    if (this.hasAttribute(\"mass_set_path\")) {\r\n      panel.setAttribute(\"mass_set_path\", this.getAttribute(\"mass_set_path\"));\r\n    }\r\n\r\n    popup.flushUpdate();\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let value = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (!value) {\r\n      this.internalDisabled = true;\r\n      return;\r\n    }\r\n\r\n    if (this.internalDisabled) {\r\n      this.internalDisabled = false;\r\n    }\r\n\r\n    if (this.value.length !== value.length) {\r\n      switch (value.length) {\r\n        case 2:\r\n          this.value = new Vector2();\r\n          break;\r\n        case 3:\r\n          this.value = new Vector3();\r\n          break;\r\n        case 4:\r\n          this.value = new Vector4();\r\n          break;\r\n      }\r\n    }\r\n\r\n    if (this.value.vectorDistance(value) > 0.0001) {\r\n      this.value.load(value);\r\n      console.log(\"updated vector popup button value\");\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n    this.updateDataPath();\r\n  }\r\n\r\n}\r\nUIBase.internalRegister(VectorPopupButton);\r\n\r\nexport class VectorPanel extends ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this.range = [-1e17, 1e17];\r\n\r\n    this.name = \"\";\r\n\r\n    this.axes = \"XYZW\";\r\n    this.value = new Vector3();\r\n    this.sliders = [];\r\n    this.hasUniformSlider = false;\r\n\r\n    this.packflag |= PackFlags.FORCE_ROLLER_SLIDER;\r\n\r\n    let makeParam = (key) => {\r\n      Object.defineProperty(this, key, {\r\n        get : function() {\r\n          return this._getNumParam(key);\r\n        },\r\n\r\n        set : function(val) {\r\n          this._setNumParam(key, val);\r\n        }\r\n      });\r\n    };\r\n\r\n    this.__range = [-1e17, 1e17];\r\n    this._range = new Array(2);\r\n\r\n    Object.defineProperty(this._range, 0, {\r\n      get : () => this.__range[0],\r\n      set : (val) => this.__range[0] = val\r\n    });\r\n    Object.defineProperty(this._range, 1, {\r\n      get : () => this.__range[1],\r\n      set : (val) => this.__range[1] = val\r\n    });\r\n\r\n    makeParam(\"isInt\");\r\n    makeParam(\"radix\");\r\n    makeParam(\"decimalPlaces\");\r\n    makeParam(\"baseUnit\");\r\n    makeParam(\"displayUnit\");\r\n    makeParam(\"step\");\r\n    makeParam(\"slideSpeed\");\r\n    makeParam(\"expRate\");\r\n    makeParam(\"stepIsRelative\");\r\n\r\n    window.vp = this;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this.rebuild();\r\n    this.setCSS();\r\n\r\n    this.background = this.getDefault(\"InnerPanelBG\");\r\n  }\r\n\r\n  _getNumParam(key) {\r\n    return this[\"_\"+key];\r\n  }\r\n\r\n  _setNumParam(key, val) {\r\n    if (key === \"range\") {\r\n      this.__range[0] = val[0];\r\n      this.__range[1] = val[1];\r\n\r\n      return;\r\n    }\r\n\r\n    this[\"_\"+key] = val;\r\n\r\n    for (let slider of this.sliders) {\r\n      slider[key] = val;\r\n    }\r\n  }\r\n\r\n  rebuild() {\r\n    this.clear();\r\n\r\n    if (this.name) {\r\n      this.label(this.name);\r\n    }\r\n\r\n    let frame, row;\r\n\r\n    if (this.hasUniformSlider) {\r\n      row = this.row();\r\n      frame = row.col();\r\n    } else {\r\n      frame = this;\r\n    }\r\n\r\n    this.sliders = [];\r\n\r\n    for (let i=0; i<this.value.length; i++) {\r\n      let slider = frame.slider(undefined, {\r\n        name       : this.axes[i],\r\n        defaultval : this.value[i],\r\n        min        : this.range[0],\r\n        max        : this.range[1],\r\n        step       : this.step || 0.001,\r\n        is_int     : this.isInt,\r\n        packflag   : this.packflag\r\n      });\r\n\r\n      slider.addLabel = false;\r\n      slider.labelOnTop = false;\r\n\r\n      //let slider = frame.slider(undefined, this.axes[i], this.value[i], this.range[0], this.range[1], 0.001, this.isInt);\r\n      slider.axis = i;\r\n      let this2 = this;\r\n\r\n      slider.baseUnit = this.baseUnit;\r\n      slider.slideSpeed = this.slideSpeed;\r\n      slider.decimalPlaces = this.decimalPlaces;\r\n      slider.displayUnit = this.displayUnit;\r\n      slider.isInt = this.isInt;\r\n      slider.range = this.__range;\r\n      slider.radix = this.radix;\r\n      slider.step = this.step;\r\n      slider.expRate = this.expRate;\r\n      slider.stepIsRelative= this.stepIsRelative;\r\n\r\n      if (this.stepIsRelative) {\r\n        slider.step = ToolProperty.calcRelativeStep(this.step, this.value[i]);\r\n      }\r\n\r\n      slider.onchange = function(e) {\r\n        this2.value[this.axis] = this.value;\r\n\r\n        if (this2.hasAttribute(\"datapath\")) {\r\n          this2.setPathValue(this2.ctx, this2.getAttribute(\"datapath\"), this2.value);\r\n        }\r\n\r\n        if (this2.uslider) {\r\n          this2.uslider.setValue(this2.uniformValue, false);\r\n        }\r\n\r\n        if (this2.onchange) {\r\n          this2.onchange(this2.value);\r\n        }\r\n      }\r\n\r\n      this.sliders.push(slider);\r\n    }\r\n\r\n    if (this.hasUniformSlider) {\r\n      let uslider = this.uslider = UIBase.createElement(\"numslider-x\");\r\n      row._prepend(uslider);\r\n\r\n      uslider.range = this.range;\r\n      uslider.baseUnit = this.baseUnit;\r\n      uslider.slideSpeed = this.slideSpeed;\r\n      uslider.decimalPlaces = this.decimalPlaces;\r\n      uslider.displayUnit = this.displayUnit;\r\n      uslider.expRate = this.expRate;\r\n      uslider.step = this.step;\r\n      uslider.expRate = this.expRate;\r\n      uslider.isInt = this.isInt;\r\n      uslider.radix = this.radix;\r\n      uslider.decimalPlaces = this.decimalPlaces;\r\n      uslider.stepIsRelative= this.stepIsRelative;\r\n\r\n      uslider.vertical = true;\r\n      uslider.setValue(this.uniformValue, false);\r\n\r\n      this.sliders.push(uslider);\r\n\r\n      uslider.onchange = () => {\r\n        this.uniformValue = uslider.value;\r\n      }\r\n    } else {\r\n      this.uslider = undefined;\r\n    }\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  get uniformValue() {\r\n    let sum = 0.0;\r\n\r\n    for (let i=0; i<this.value.length; i++) {\r\n      sum += isNaN(this.value[i]) ? 0.0 : this.value[i];\r\n    }\r\n\r\n    return sum / this.value.length;\r\n  }\r\n\r\n  set uniformValue(val) {\r\n    let old = this.uniformValue;\r\n    let doupdate = false;\r\n\r\n    if (old === 0.0 || val === 0.0) {\r\n      doupdate = this.value.dot(this.value) !== 0.0\r\n\r\n      this.value.zero();\r\n    } else {\r\n      let ratio = val / old;\r\n      for (let i = 0; i < this.value.length; i++) {\r\n        this.value[i] *= ratio;\r\n      }\r\n\r\n      doupdate = true;\r\n    }\r\n\r\n    if (doupdate) {\r\n      if (this.hasAttribute(\"datapath\")) {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this.value);\r\n      }\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.value);\r\n      }\r\n\r\n      for (let i=0; i<this.value.length; i++) {\r\n        this.sliders[i].setValue(this.value[i], false);\r\n        this.sliders[i]._redraw();\r\n      }\r\n\r\n      if (this.uslider) {\r\n        this.uslider.setValue(val, false);\r\n        this.uslider._redraw();\r\n      }\r\n    }\r\n  }\r\n\r\n  setValue(value) {\r\n    if (!value) {\r\n      return;\r\n    }\r\n\r\n    if (value.length !== this.value.length) {\r\n      switch (value.length) {\r\n        case 2:\r\n          this.value = new Vector2(value);\r\n          break;\r\n        case 3:\r\n          this.value = new Vector3(value);\r\n          break;\r\n        case 4:\r\n          this.value = new Vector4(value);\r\n          break;\r\n        default:\r\n          throw new Error(\"invalid vector size \" + value.length);\r\n      }\r\n\r\n      this.rebuild();\r\n    } else {\r\n      this.value.load(value);\r\n    }\r\n\r\n    if (this.onchange) {\r\n      this.onchange(this.value);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n\r\n    let val = this.getPathValue(this.ctx, path);\r\n    if (val === undefined) {\r\n      this.internalDisabled = true;\r\n      return;\r\n    }\r\n\r\n\r\n    let meta = this.getPathMeta(this.ctx, path);\r\n    let name = meta.uiname !== undefined ? meta.uiname : meta.name;\r\n    if (this.hasAttribute(\"name\")) {\r\n      name = this.getAttribute(\"name\");\r\n    }\r\n\r\n    if (name && name !== this.name) {\r\n      this.name = name;\r\n      this.rebuild();\r\n      return;\r\n    }\r\n\r\n    let loadNumParam = (k, do_rebuild=false) => {\r\n      if (meta && meta[k] !== undefined && this[k] === undefined) {\r\n        this[k] = meta[k];\r\n\r\n        if (this[k] !== meta[k] && do_rebuild) {\r\n          this.doOnce(this.rebuild);\r\n        }\r\n      }\r\n    }\r\n\r\n\r\n    loadNumParam(\"decimalPlaces\");\r\n    loadNumParam(\"baseUnit\");\r\n    loadNumParam(\"slideSpeed\");\r\n    loadNumParam(\"displayUnit\");\r\n    loadNumParam(\"decimalPlaces\");\r\n    loadNumParam(\"isInt\");\r\n    loadNumParam(\"radix\");\r\n    loadNumParam(\"step\");\r\n    loadNumParam(\"expRate\");\r\n    loadNumParam(\"stepIsRelative\");\r\n\r\n    if (meta && meta.hasUniformSlider !== undefined && meta.hasUniformSlider !== this.hasUniformSlider) {\r\n      this.hasUniformSlider = meta.hasUniformSlider;\r\n      this.doOnce(this.rebuild);\r\n    }\r\n\r\n    if (meta && meta.range) {\r\n      let update = this.range[0] !== meta.range[0];\r\n      update= update || this.range[1] !== meta.range[1];\r\n\r\n      this.range[0] = meta.range[0];\r\n      this.range[1] = meta.range[1];\r\n\r\n      if (update) {\r\n        this.doOnce(this.rebuild);\r\n      }\r\n    }\r\n\r\n    this.internalDisabled = false;\r\n\r\n    let length = val.length;\r\n\r\n    if (meta && (meta.flag & PropFlags.USE_CUSTOM_GETSET)) {\r\n      let rdef = this.ctx.api.resolvePath(this.ctx, path);\r\n\r\n      meta.ctx = this.ctx;\r\n      meta.dataref = rdef.obj;\r\n      meta.datapath = path;\r\n\r\n      length = meta.getValue().length;\r\n\r\n      meta.dataref = undefined;\r\n    }\r\n\r\n    if (this.value.length !== length) {\r\n      switch (length) {\r\n        case 2:\r\n          val = new Vector2(val);\r\n          break;\r\n        case 3:\r\n          val = new Vector3(val);\r\n          break;\r\n        case 4:\r\n          val = new Vector4(val);\r\n          break;\r\n        default:\r\n          val = meta.getValue().copy().load(val);\r\n          break;\r\n      }\r\n\r\n      this.value = val;\r\n      this.rebuild();\r\n\r\n      for (let i=0; i<this.value.length; i++) {\r\n        this.sliders[i].setValue(val[i], false);\r\n        this.sliders[i]._redraw();\r\n      }\r\n    } else {\r\n      if (this.value.vectorDistance(val) > 0) {\r\n        this.value.load(val);\r\n\r\n        if (this.uslider) {\r\n          this.uslider.setValue(this.uniformValue, false);\r\n        }\r\n\r\n        for (let i=0; i<this.value.length; i++) {\r\n          this.sliders[i].setValue(val[i], false);\r\n          this.sliders[i]._redraw();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateDataPath();\r\n\r\n    if (this.stepIsRelative) {\r\n      for (let slider of this.sliders) {\r\n        slider.step = ToolProperty.calcRelativeStep(this.step, slider.value);\r\n      }\r\n    }\r\n\r\n    if (this.uslider) {\r\n      this.uslider.step = this.step;\r\n      if (this.stepIsRelative) {\r\n        this.uslider.step = ToolProperty.calcRelativeStep(this.step, this.uniformValue);\r\n      }\r\n\r\n    }\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"vector-panel-x\"\r\n  }}\r\n}\r\nUIBase.internalRegister(VectorPanel);\r\n\r\n\r\nexport class ToolTip extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.visibleToPick = false;\r\n    this.div = document.createElement(\"div\");\r\n\r\n    this.shadow.appendChild(this.div);\r\n    this._start_time = undefined;\r\n    this.timeout = undefined;\r\n  }\r\n\r\n  static show(message, screen, x, y) {\r\n    let ret = UIBase.createElement(this.define().tagname);\r\n\r\n    ret._start_time = util.time_ms();\r\n    ret.timeout = ret.getDefault(\"timeout\");\r\n\r\n    ret.text = message;\r\n    let size = ret._estimateSize();\r\n\r\n    let pad = 5;\r\n    size = [size[0] + pad, size[1] + pad];\r\n\r\n    console.log(size);\r\n    x = Math.min(Math.max(x, 0), screen.size[0] - size[0]);\r\n    y = Math.min(Math.max(y, 0), screen.size[1] - size[1]);\r\n\r\n    let dpi = UIBase.getDPI();\r\n\r\n    x += 10/dpi;\r\n    y += 15/dpi;\r\n\r\n    ret._popup = screen.popup(ret, x, y);\r\n    ret._popup.background = \"rgba(0,0,0,0)\";\r\n    ret._popup.style[\"border\"] = \"none\";\r\n    ret.div.style[\"padding\"] = \"15px\";\r\n\r\n    ret._popup.add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  end() {\r\n    this._popup.end();\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this.setCSS();\r\n  }\r\n\r\n  set text(val) {\r\n    this.div.innerHTML = val.replace(/[\\n]/g, \"<br>\\n\");\r\n  }\r\n\r\n  get text() {\r\n    return this.div.innerHTML;\r\n  }\r\n\r\n  _estimateSize() {\r\n    let text = this.div.textContent;\r\n    let block = ui_base.measureTextBlock(this, text, undefined, undefined, undefined, this.getDefault(\"ToolTipText\"));\r\n\r\n    return [block.width+50, block.height+30];\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    if (util.time_ms() - this._start_time > this.timeout) {\r\n      this.end();\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    let color = this.getDefault(\"background-color\");\r\n    let bcolor = this.getDefault(\"border-color\");\r\n\r\n    this.background = color;\r\n\r\n    let radius = this.getDefault(\"border-radius\", undefined, 5);\r\n    let bstyle = this.getDefault(\"border-style\", undefined, \"solid\");\r\n    let bwidth = this.getDefault(\"border-width\", undefined, 1);\r\n    let padding = this.getDefault(\"padding\", undefined, 15);\r\n\r\n    this.noMarginsOrPadding();\r\n\r\n    this.div.style[\"padding\"] = padding + \"px\";\r\n\r\n    this.div.style[\"background-color\"] = \"rgba(0,0,0,0)\";\r\n    this.div.style[\"border\"] = `${bwidth}px ${bstyle} ${bcolor}`;\r\n    this.div.style[\"border-radius\"] = radius + \"px\";\r\n    this.style[\"border-radius\"] = radius + \"px\";\r\n\r\n    let font = this.getDefault(\"ToolTipText\");\r\n    this.div.style[\"color\"] = font.color;\r\n    this.div.style[\"font\"] = font.genCSS();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"tool-tip-x\",\r\n    style   : \"tooltip\"\r\n  }}\r\n};\r\nUIBase.internalRegister(ToolTip);\r\n\r\nwindow._ToolTip = ToolTip;\r\n","\"use strict\";\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as simple_toolsys from '../path-controller/toolsys/toolsys.js';\r\nimport {ToolTip} from \"../widgets/ui_widgets2.js\";\r\n\r\n/*\r\nwhy am I using a toolstack here at all?  time to remove!\r\n*/\r\n\r\nlet toolstack_getter = function () {\r\n  throw new Error(\"must pass a toolstack getter to registerToolStackGetter\")\r\n}\r\n\r\nexport function registerToolStackGetter(func) {\r\n  toolstack_getter = func;\r\n}\r\n\r\nlet Vector2   = vectormath.Vector2,\r\n    Vector3   = vectormath.Vector3,\r\n    UndoFlags = simple_toolsys.UndoFlags,\r\n    ToolFlags = simple_toolsys.ToolFlags;\r\n\r\nimport {pushModalLight, popModalLight, keymap, pushPointerModal} from \"../util/simple_events.js\";\r\n\r\n//import {keymap} from './events';\r\n\r\nexport class ToolBase extends simple_toolsys.ToolOp {\r\n  constructor(screen) {\r\n    super();\r\n    this.screen = screen;\r\n    //super();\r\n\r\n    this._finished = false;\r\n  }\r\n\r\n  start(elem, pointerId) {\r\n    //toolstack_getter().execTool(this);\r\n    this.modalStart(undefined, elem, pointerId);\r\n  }\r\n\r\n  cancel() {\r\n    this.finish();\r\n  }\r\n\r\n  finish() {\r\n    this._finished = true;\r\n    this.popModal(this.screen);\r\n  }\r\n\r\n  popModal() {\r\n    this.overdraw.end();\r\n    popModalLight(this.modaldata);\r\n    this.modaldata = undefined;\r\n  }\r\n\r\n  modalStart(ctx, elem, pointerId) {\r\n    this.ctx = ctx;\r\n\r\n    if (this.modaldata !== undefined) {\r\n      console.log(\"Error, modaldata was not undefined\");\r\n      popModalLight(this.modaldata);\r\n    }\r\n\r\n    this.overdraw = ui_base.UIBase.createElement(\"overdraw-x\");\r\n    this.overdraw.start(this.screen);\r\n\r\n    let handlers = {};\r\n    let keys = Object.getOwnPropertyNames(this);\r\n    for (let k in this.__proto__) {\r\n      keys.push(k);\r\n    }\r\n    for (let k of Object.getOwnPropertyNames(this.__proto__)) {\r\n      keys.push(k);\r\n    }\r\n\r\n    for (let k in this) {\r\n      keys.push(k);\r\n    }\r\n\r\n    for (let k of keys) {\r\n      if (k.startsWith(\"on\")) {\r\n        handlers[k] = this[k].bind(this);\r\n      }\r\n    }\r\n\r\n    //window.setTimeout(() => {\r\n    if (pointerId !== undefined) {\r\n      handlers.on_pointerdown = handlers.on_pointerdown ?? handlers.on_mousedown;\r\n      handlers.on_pointermove = handlers.on_pointermove ?? handlers.on_mousemove;\r\n      handlers.on_pointerup = handlers.on_pointerup ?? handlers.on_mouseup;\r\n      handlers.on_pointercancel = handlers.on_pointercancel ?? handlers.on_pointerup ?? handlers.on_mouseup;\r\n\r\n      this.modaldata = pushPointerModal(handlers, elem, pointerId);\r\n    } else {\r\n      this.modaldata = pushModalLight(handlers);\r\n    }\r\n    //console.log(\"HANDLERS\", this.modaldata.handlers);\r\n\r\n    //}, 100);\r\n\r\n    //window.addEventListener(\"touchmove\", (e) => {\r\n    //  console.log(\"touchmove\");\r\n    //}, {passive : false});\r\n  }\r\n\r\n  on_pointermove(e) {\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    this.finish();\r\n  }\r\n\r\n  on_keydown(e) {\r\n    console.log(\"s\", e.keyCode);\r\n\r\n    switch (e.keyCode) {\r\n      case keymap.Escape: //esc\r\n        this.cancel();\r\n        break;\r\n      case keymap.Space: //space\r\n      case keymap.Enter: //return\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\nexport class AreaResizeTool extends ToolBase {\r\n  constructor(screen, border, mpos) {\r\n    if (screen === undefined) screen = _appstate.screen; //XXX hackish!\r\n\r\n    super(screen);\r\n\r\n    this.start_mpos = new Vector2(mpos);\r\n\r\n    this.sarea = border.sareas[0];\r\n    if (!this.sarea || border.dead) {\r\n      console.log(border.dead, border);\r\n      throw new Error(\"border corruption\");\r\n    }\r\n\r\n    this.screen = screen;\r\n\r\n    this.side = this.sarea._side(border);\r\n  }\r\n\r\n  get border() {\r\n    return this.sarea._borders[this.side];\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Resize Area\",\r\n      toolpath   : \"screen.area.resize\",\r\n      icon       : ui_base.Icons.RESIZE,\r\n      description: \"change size of area\",\r\n      is_modal   : true,\r\n      undoflag   : UndoFlags.NO_UNDO,\r\n      flag       : 0,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n\r\n  getBorders() {\r\n    let horiz = this.border.horiz;\r\n\r\n    let ret = [];\r\n    let visit = new Set();\r\n\r\n    let rec = (v) => {\r\n      if (visit.has(v._id)) {\r\n        return;\r\n      }\r\n\r\n      visit.add(v._id);\r\n\r\n      for (let border of v.borders) {\r\n        if (border.horiz == horiz && !visit.has(border._id)) {\r\n          visit.add(border._id);\r\n          ret.push(border);\r\n\r\n          rec(border.otherVertex(v));\r\n        }\r\n      }\r\n    }\r\n\r\n    rec(this.border.v1);\r\n    rec(this.border.v2);\r\n\r\n    return ret;\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    this.finish();\r\n  }\r\n\r\n  finish() {\r\n    super.finish();\r\n\r\n    this.screen.snapScreenVerts();\r\n    this.screen.regenBorders();\r\n    this.screen.snapScreenVerts();\r\n    this.screen.loadFromVerts();\r\n  }\r\n\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case keymap[\"Escape\"]:\r\n      case keymap[\"Enter\"]:\r\n      case keymap[\"Space\"]:\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let mpos = new Vector2([e.x, e.y]);\r\n\r\n    mpos.sub(this.start_mpos);\r\n\r\n    let axis = this.border.horiz ? 1 : 0;\r\n\r\n    //console.log(this.border.horiz);\r\n\r\n    this.overdraw.clear();\r\n\r\n    let visit = new Set();\r\n    let borders = this.getBorders();\r\n\r\n    let color = cconst.DEBUG.screenborders ? \"rgba(1.0, 0.5, 0.0, 0.1)\" : \"rgba(1.0, 0.5, 0.0, 1.0)\";\r\n\r\n    let bad = false;\r\n\r\n    for (let border of borders) {\r\n      bad = bad || !this.screen.isBorderMovable(border);\r\n\r\n      border.oldv1 = new Vector2(border.v1);\r\n      border.oldv2 = new Vector2(border.v2);\r\n    }\r\n\r\n    if (bad) {\r\n      console.log(\"border is not movable\");\r\n      return;\r\n    }\r\n\r\n    let check = () => {\r\n      let count = 0;\r\n\r\n      for (let sarea of this.screen.sareas) {\r\n        if (sarea.size[0] < 15 || sarea.size[1] < 15) {\r\n          count++;\r\n        }\r\n      }\r\n\r\n      return count;\r\n    };\r\n\r\n    let badcount = check();\r\n\r\n\r\n    let snapMode = true;\r\n\r\n    let df = mpos[axis];\r\n    let border = this.border;\r\n\r\n    this.screen.moveBorder(border, df, false);\r\n\r\n    for (let border of borders) {\r\n      //if false, stead of forcing areas to fit within screen bounds\r\n      //in snapScreenVerts the screen bounds will be modified instead.\r\n\r\n      if (border.outer) {\r\n        snapMode = false;\r\n      }\r\n\r\n      this.overdraw.line(border.v1, border.v2, color);\r\n    }\r\n\r\n    this.start_mpos[0] = e.x;\r\n    this.start_mpos[1] = e.y;\r\n    this.screen.loadFromVerts();\r\n    this.screen.setCSS();\r\n\r\n    if (check() != badcount) {\r\n      console.log(\"bad\");\r\n\r\n      for (let border of borders) {\r\n        border.v1.load(border.oldv1);\r\n        border.v2.load(border.oldv2);\r\n      }\r\n    }\r\n\r\n\r\n    this.screen.snapScreenVerts(snapMode);\r\n    this.screen.loadFromVerts();\r\n    this.screen.solveAreaConstraints(snapMode);\r\n    this.screen.setCSS();\r\n    this.screen.updateDebugBoxes();\r\n    this.screen._fireResizeCB();\r\n  }\r\n}\r\n\r\n//controller.registerTool(AreaResizeTool);\r\n\r\nexport class SplitTool extends ToolBase {\r\n  constructor(screen) {\r\n    if (screen === undefined) screen = _appstate.screen; //XXX hackish!\r\n\r\n    super(screen);\r\n\r\n    this.done = false;\r\n    this.screen = screen;\r\n    this.ctx = screen.ctx;\r\n    this.sarea = undefined;\r\n    this.t = undefined;\r\n\r\n    this.started = false;\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Split Area\",\r\n      toolpath   : \"screen.area.split\",\r\n      icon       : ui_base.Icons.SMALL_PLUS,\r\n      description: \"split an area in two\",\r\n      is_modal   : true,\r\n      undoflag   : UndoFlags.NO_UNDO,\r\n      flag       : 0,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n\r\n  modalStart(ctx) {\r\n    if (this.started) {\r\n      console.trace(\"double call to modalStart()\");\r\n      return;\r\n    }\r\n\r\n    this.overdraw = ui_base.UIBase.createElement(\"overdraw-x\");\r\n    this.overdraw.start(this.screen);\r\n\r\n    super.modalStart(ctx);\r\n  }\r\n\r\n  cancel() {\r\n    return this.finish(true);\r\n  }\r\n\r\n  finish(canceled = false) {\r\n    if (this.done) {\r\n      return;\r\n    }\r\n\r\n    this.done = true;\r\n    this.overdraw.end();\r\n\r\n    this.popModal(this.screen);\r\n\r\n    if (canceled || !this.sarea) {\r\n      return;\r\n    }\r\n\r\n    let sarea = this.sarea, screen = this.screen;\r\n    let t = this.t;\r\n\r\n    screen.splitArea(sarea, t, this.horiz);\r\n    screen._internalRegenAll();\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let x = e.x, y = e.y;\r\n\r\n    let screen = this.screen;\r\n\r\n    let sarea = screen.findScreenArea(x, y);\r\n\r\n    this.overdraw.clear();\r\n\r\n    if (sarea !== undefined) {\r\n      //x -= sarea.pos[0];\r\n      //y -= sarea.pos[1];\r\n      x = (x - sarea.pos[0])/(sarea.size[0]);\r\n      y = (y - sarea.pos[1])/(sarea.size[1]);\r\n\r\n      let dx = 1.0 - Math.abs(x - 0.5);\r\n      let dy = 1.0 - Math.abs(y - 0.5);\r\n\r\n      this.sarea = sarea;\r\n      let horiz = this.horiz = dx < dy;\r\n\r\n      if (horiz) {\r\n        this.t = y;\r\n        this.overdraw.line([sarea.pos[0], e.y], [sarea.pos[0] + sarea.size[0], e.y]);\r\n      } else {\r\n        this.t = x;\r\n        this.overdraw.line([e.x, sarea.pos[1]], [e.x, sarea.pos[1] + sarea.size[1]]);\r\n      }\r\n    }\r\n    //console.warn(\"sarea:\", sarea);\r\n\r\n    //let sarea = this.\r\n    //console.log(e.x, e.y);\r\n    //this.overdraw.clear();\r\n    //this.overdraw.line([e.x, e.y-200], [e.x, e.y+200], \"grey\");\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    this.finish();\r\n\r\n    if (e.button) {\r\n      this.stopPropagation();\r\n      this.preventDefault();\r\n    }\r\n  }\r\n\r\n  on_keydown(e) {\r\n    console.log(\"s\", e.keyCode);\r\n\r\n    switch (e.keyCode) {\r\n      case keymap.Escape: //esc\r\n        this.cancel();\r\n        break;\r\n      case keymap.Space: //space\r\n      case keymap.Enter: //return\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\n\r\nexport class RemoveAreaTool extends ToolBase {\r\n  constructor(screen, border) {\r\n    if (screen === undefined) screen = _appstate.screen; //XXX hackish!\r\n\r\n    super(screen);\r\n\r\n    this.border = border;\r\n\r\n    this.done = false;\r\n    this.screen = screen;\r\n    this.ctx = screen.ctx;\r\n    this.sarea = undefined;\r\n    this.t = undefined;\r\n\r\n    this.started = false;\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Remove Area\",\r\n      toolpath   : \"screen.area.pick_remove\",\r\n      icon       : ui_base.Icons.SMALL_PLUS,\r\n      description: \"Collapse a window\",\r\n      is_modal   : true,\r\n      undoflag   : UndoFlags.NO_UNDO,\r\n      flag       : 0,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n\r\n  modalStart(ctx) {\r\n    if (this.started) {\r\n      console.trace(\"double call to modalStart()\");\r\n      return;\r\n    }\r\n\r\n    this.overdraw = ui_base.UIBase.createElement(\"overdraw-x\");\r\n    this.overdraw.start(this.screen);\r\n\r\n    super.modalStart(ctx);\r\n  }\r\n\r\n  cancel() {\r\n    return this.finish(true);\r\n  }\r\n\r\n  finish(canceled = false) {\r\n    if (this.done) {\r\n      return;\r\n    }\r\n\r\n    this.done = true;\r\n    this.overdraw.end();\r\n\r\n    this.popModal(this.screen);\r\n\r\n    if (canceled || !this.sarea) {\r\n      return;\r\n    }\r\n\r\n    let sarea = this.sarea, screen = this.screen;\r\n    let t = this.t;\r\n\r\n    if (sarea) {\r\n      screen.collapseArea(sarea, this.border);\r\n      screen._internalRegenAll();\r\n    }\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let x = e.x, y = e.y;\r\n\r\n    let screen = this.screen;\r\n\r\n    let sarea = screen.findScreenArea(x, y);\r\n\r\n    this.overdraw.clear();\r\n\r\n    if (sarea !== undefined) {\r\n      this.sarea = sarea;\r\n      this.overdraw.rect(sarea.pos, sarea.size, \"rgba(0,0,0,0.1)\");\r\n    }\r\n    //console.warn(\"sarea:\", sarea);\r\n\r\n    //let sarea = this.\r\n    //console.log(e.x, e.y);\r\n    //this.overdraw.clear();\r\n    //this.overdraw.line([e.x, e.y-200], [e.x, e.y+200], \"grey\");\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    this.finish();\r\n\r\n    if (e.button) {\r\n      this.stopPropagation();\r\n      this.preventDefault();\r\n    }\r\n  }\r\n\r\n  on_keydown(e) {\r\n    console.log(\"s\", e.keyCode);\r\n\r\n    switch (e.keyCode) {\r\n      case keymap.Escape: //esc\r\n        this.cancel();\r\n        break;\r\n      case keymap.Space: //space\r\n      case keymap.Enter: //return\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\n//controller.registerTool(SplitTool);\r\n\r\n\r\nexport class AreaDragTool extends ToolBase {\r\n  constructor(screen, sarea, mpos) {\r\n    if (screen === undefined) screen = _appstate.screen; //XXX hackish!\r\n\r\n    super(screen);\r\n\r\n    this.dropArea = false;\r\n    this.excludeAreas = new Set();\r\n    this.cursorbox = undefined;\r\n    this.boxes = [];\r\n    this.boxes.active = undefined;\r\n\r\n    this.sarea = sarea;\r\n    this.start_mpos = new Vector2(mpos);\r\n    this.screen = screen;\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Drag Area\",\r\n      toolpath   : \"screen.area.drag\",\r\n      icon       : ui_base.Icons.TRANSLATE,\r\n      description: \"move or duplicate area\",\r\n      is_modal   : true,\r\n      undoflag   : UndoFlags.NO_UNDO,\r\n      flag       : 0,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n\r\n  finish() {\r\n    super.finish();\r\n\r\n    this.screen.regenBorders();\r\n    this.screen.solveAreaConstraints();\r\n    this.screen.snapScreenVerts();\r\n    this.screen._recalcAABB();\r\n  }\r\n\r\n  getBoxRect(b) {\r\n    let sa = b.sarea;\r\n    let pos, size;\r\n\r\n    if (b.horiz == -1) {\r\n      //replacement mode\r\n      pos = sa.pos;\r\n      size = sa.size;\r\n    } else if (b.horiz) {\r\n      if (b.side == 'b') {\r\n        pos = [sa.pos[0], sa.pos[1] + sa.size[1]*b.t]\r\n        size = [sa.size[0], sa.size[1]*(1.0 - b.t)]\r\n      } else {\r\n        pos = [sa.pos[0], sa.pos[1]];\r\n        size = [sa.size[0], sa.size[1]*b.t]\r\n      }\r\n    } else {\r\n      if (b.side == 'r') {\r\n        pos = [sa.pos[0] + sa.size[0]*b.t, sa.pos[1]]\r\n        size = [sa.size[0]*(1.0 - b.t), sa.size[1]]\r\n      } else {\r\n        pos = [sa.pos[0], sa.pos[1]];\r\n        size = [sa.size[0]*b.t, sa.size[1]]\r\n      }\r\n    }\r\n\r\n    let color = \"rgba(100, 100, 100, 0.2)\";\r\n\r\n    let ret = this.overdraw.rect(pos, size, color);\r\n    ret.style[\"pointer-events\"] = \"none\";\r\n\r\n    return ret;\r\n  }\r\n\r\n  doSplit(b) {\r\n    if (this.sarea) {\r\n      return this.doSplitDrop(b);\r\n    }\r\n\r\n    let src = this.sarea, dst = b.sarea;\r\n    let screen = this.screen;\r\n\r\n    let t = b.t;\r\n\r\n    screen.splitArea(dst, t, b.horiz);\r\n\r\n    screen._internalRegenAll();\r\n  }\r\n\r\n  doSplitDrop(b) {\r\n    //first check if there was no change\r\n    if (b.horiz === -1 && b.sarea === this.sarea) {\r\n      return;\r\n    }\r\n\r\n    let can_rip = false;\r\n    let sa = this.sarea;\r\n    let screen = this.screen;\r\n\r\n    //rip conditions\r\n    can_rip = sa.size[0] === screen.size[0] || sa.size[1] === screen.size[1];\r\n    can_rip = can_rip || this.sarea.floating;\r\n    can_rip = can_rip && b.sarea !== sa;\r\n    can_rip = can_rip && (b.horiz === -1 || !screen.areasBorder(sa, b.sarea));\r\n\r\n    let expand = b.horiz === -1 && b.sarea !== sa && screen.areasBorder(b.sarea, sa);\r\n\r\n    can_rip = can_rip || expand;\r\n\r\n    console.log(\"can_rip:\", can_rip, expand);\r\n\r\n    if (can_rip) {\r\n      screen.removeArea(sa);\r\n      screen.snapScreenVerts();\r\n    }\r\n\r\n    if (b.horiz === -1) {\r\n      //replacement\r\n      let src = this.sarea, dst = b.sarea;\r\n\r\n      if (can_rip && src !== dst) {\r\n        let mm;\r\n\r\n        //handle case of one area \"consuming\" another\r\n        if (expand) {\r\n          mm = screen.minmaxArea(src);\r\n          screen.minmaxArea(dst, mm);\r\n        }\r\n\r\n        console.log(\"replacing. . .\", expand);\r\n\r\n        if (src.floating) {\r\n          let old = dst.editors;\r\n\r\n          dst.editors = [];\r\n          dst.editormap = {};\r\n\r\n          if (dst.area && !(dst.area.constructor.define().areaname in src.editormap)) {\r\n            dst.area.push_ctx_active();\r\n            dst.area.on_area_inactive();\r\n            dst.area.remove();\r\n            dst.area.pop_ctx_active();\r\n          }\r\n\r\n          for (let editor of old) {\r\n            let def = editor.constructor.define();\r\n\r\n            let bad = false;\r\n            //bad = !(def.areaname in src.editormap);\r\n\r\n            for (let editor2 of src.editors) {\r\n              if (editor.constructor === editor2.constructor) {\r\n                bad = true;\r\n                break;\r\n              }\r\n            }\r\n\r\n            if (!bad) {\r\n              dst.editors.push(editor);\r\n              dst.editormap[def.areaname] = editor;\r\n            }\r\n          }\r\n\r\n          for (let editor of src.editors) {\r\n            let def = editor.constructor.define();\r\n\r\n            dst.editormap[def.areaname] = editor;\r\n            dst.editors.push(editor);\r\n\r\n            if (editor.owning_sarea) {\r\n              editor.owning_sarea = dst;\r\n            }\r\n\r\n            if (editor.parentWidget) {\r\n              editor.parentWidget = dst;\r\n            }\r\n          }\r\n\r\n          if (cconst.useAreaTabSwitcher) {\r\n            for (let editor of dst.editors) {\r\n              if (editor.switcher) {\r\n                editor.switcher.flagUpdate();\r\n              }\r\n            }\r\n          }\r\n\r\n          dst.area = src.area;\r\n          dst.shadow.appendChild(src.area);\r\n\r\n          src.area = undefined;\r\n          src.editors = [];\r\n          src.editormap = {};\r\n\r\n          dst.on_resize(dst.size, dst.size);\r\n\r\n          dst.flushSetCSS();\r\n          dst.flushUpdate();\r\n\r\n          screen.removeArea(src);\r\n          screen.snapScreenVerts();\r\n\r\n          return;\r\n        } else {\r\n          screen.replaceArea(dst, src);\r\n        }\r\n\r\n        if (expand) {\r\n          console.log(\"\\nEXPANDING:\", src.size[0], src.size[1]);\r\n\r\n          src.pos[0] = mm.min[0];\r\n          src.pos[1] = mm.min[1];\r\n\r\n          src.size[0] = mm.max[0] - mm.min[0];\r\n          src.size[1] = mm.max[1] - mm.min[1];\r\n\r\n          src.loadFromPosSize();\r\n\r\n          screen._internalRegenAll();\r\n        }\r\n      } else {\r\n        //console.log(\"copying. . .\");\r\n        screen.replaceArea(dst, src.copy());\r\n        screen._internalRegenAll();\r\n      }\r\n    } else {\r\n      let src = this.sarea, dst = b.sarea;\r\n\r\n      let t = b.t;\r\n\r\n      let nsa = screen.splitArea(dst, t, b.horiz);\r\n\r\n      if (b.side === 'l' || b.side === 't') {\r\n        nsa = dst;\r\n      }\r\n\r\n      if (can_rip) {\r\n        //console.log(\"replacing\");\r\n        screen.replaceArea(nsa, src);\r\n      } else {\r\n        //console.log(\"copying\");\r\n        screen.replaceArea(nsa, src.copy());\r\n      }\r\n\r\n      screen._internalRegenAll();\r\n    }\r\n  }\r\n\r\n  makeBoxes(sa) {\r\n    let sz = util.isMobile() ? 100 : 40;\r\n    let cx = sa.pos[0] + sa.size[0]*0.5;\r\n    let cy = sa.pos[1] + sa.size[1]*0.5;\r\n\r\n    let color = this.color = \"rgba(200, 200, 200, 0.55)\";\r\n    let hcolor = this.hcolor = \"rgba(230, 230, 230, 0.75)\";\r\n    let idgen = 0;\r\n    let boxes = this.boxes;\r\n\r\n    let box = (x, y, sz, horiz, t, side) => {\r\n      //console.log(x, y, sz);\r\n\r\n      let b = this.overdraw.rect([x - sz[0]*0.5, y - sz[1]*0.5], sz, color);\r\n      b.style[\"border-radius\"] = \"14px\";\r\n\r\n      boxes.push(b);\r\n\r\n      b.sarea = sa;\r\n\r\n      let style = document.createElement(\"style\")\r\n      let cls = `mybox_${idgen++}`;\r\n\r\n      b.horiz = horiz;\r\n      b.t = t;\r\n      b.side = side;\r\n      b.setAttribute(\"class\", cls);\r\n      b.setAttribute(\"is_box\", true);\r\n\r\n      b.addEventListener(\"pointermove\", this.on_pointermove.bind(this));\r\n\r\n      let onclick = b.onclick = (e) => {\r\n        let type = e.type.toLowerCase();\r\n\r\n        if ((e.type === \"pointerdown\" || e.type === \"pointerup\") && e.button !== 0) {\r\n          return; //another handler will cancel\r\n        }\r\n\r\n        console.log(\"split click\");\r\n\r\n        if (!this._finished) {\r\n          this.finish();\r\n          this.doSplit(b);\r\n\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n        }\r\n      }\r\n\r\n      b.addEventListener(\"click\", onclick);\r\n      b.addEventListener(\"pointerdown\", onclick);\r\n      b.addEventListener(\"pointerup\", onclick);\r\n\r\n      b.addEventListener(\"pointerenter\", (e) => {\r\n        if (this.curbox !== undefined) {\r\n          if (this.curbox.rect) {\r\n            this.curbox.rect.remove()\r\n            this.curbox.rect = undefined;\r\n          }\r\n        }\r\n\r\n        if (b.rect !== undefined) {\r\n          b.rect.remove();\r\n          b.rect = undefined;\r\n        }\r\n\r\n        b.rect = this.getBoxRect(b);\r\n        this.curbox = b;\r\n\r\n        b.setColor(hcolor);\r\n        //b.style[\"background-color\"] = hcolor;\r\n      })\r\n\r\n      b.addEventListener(\"pointerleave\", (e) => {\r\n        if (b.rect) {\r\n          b.rect.remove();\r\n          b.rect = undefined;\r\n        }\r\n\r\n        if (this.curbox === b) {\r\n          this.curbox = undefined;\r\n        }\r\n\r\n        b.setColor(color);\r\n        //b.style[\"background-color\"] = color;\r\n      })\r\n\r\n      style.textContent = `\r\n        .${cls}:hover {\r\n          background-color : orange;\r\n          fill:orange;stroke-width:2\r\n        }\r\n      `\r\n      //console.log(style.textContent);\r\n      b.appendChild(style);\r\n      b.setAttribute(\"class\", cls);\r\n\r\n      return b;\r\n    }\r\n\r\n    let pad = 5;\r\n\r\n    if (this.sarea) {\r\n      box(cx, cy, [sz, sz], -1, -1, -1);\r\n    }\r\n\r\n    box(cx - sz*0.75 - pad, cy, [sz*0.5, sz], false, 0.5, 'l');\r\n    box(cx - sz*1.2 - pad, cy, [sz*0.25, sz], false, 0.3, 'l');\r\n\r\n    box(cx + sz*0.75 + pad, cy, [sz*0.5, sz], false, 0.5, 'r');\r\n    box(cx + sz*1.2 + pad, cy, [sz*0.25, sz], false, 0.7, 'r');\r\n\r\n    box(cx, cy - sz*0.75 - pad, [sz, sz*0.5], true, 0.5, 't');\r\n    box(cx, cy - sz*1.2 - pad, [sz, sz*0.25], true, 0.3, 't');\r\n\r\n    box(cx, cy + sz*0.75 + pad, [sz, sz*0.5], true, 0.5, 'b');\r\n    box(cx, cy + sz*1.2 + pad, [sz, sz*0.25], true, 0.7, 'b');\r\n  }\r\n\r\n  getActiveBox(x, y) {\r\n    for (let n of this.boxes) {\r\n      if (n.hasAttribute && n.hasAttribute(\"is_box\")) {\r\n        let rect = n.getClientRects()[0];\r\n\r\n        //console.log(rect.x, rect.y);\r\n        if (x >= rect.x && y >= rect.y && x < rect.x + rect.width && y < rect.y + rect.height) {\r\n          //console.log(\"found rect\");\r\n          return n;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  on_drag(e) {\r\n    this.on_pointermove(e);\r\n  }\r\n\r\n  on_dragend(e) {\r\n    this.on_pointerup(e);\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let wid = 55;\r\n    let color = \"rgb(200, 200, 200, 0.7)\";\r\n\r\n    //console.trace(\"pointer move!\", e.x, e.y, this.sarea);\r\n\r\n    /*\r\n     manually feed events to boxes so as to work right\r\n     with touch events; note that pushModalLight routes\r\n     touch to pointer events (if no touch handlers are present).\r\n     */\r\n    let n = this.getActiveBox(e.x, e.y);\r\n\r\n    if (n !== undefined) {\r\n      n.setColor(this.hcolor); //\"rgba(250, 250, 250, 0.75)\");\r\n    }\r\n    //console.log(\"pointer move\", n);\r\n\r\n    if (this.boxes.active !== undefined && this.boxes.active !== n) {\r\n      this.boxes.active.setColor(this.color);\r\n      this.boxes.active.dispatchEvent(new PointerEvent(\"pointerleave\", e));\r\n    }\r\n\r\n    if (n !== undefined) {\r\n      n.dispatchEvent(new PointerEvent(\"pointerenter\", e));\r\n    }\r\n\r\n    this.boxes.active = n;\r\n    /*\r\n    let rec = (n) => {\r\n      if (n.hasAttribute && n.hasAttribute(\"is_box\")) {\r\n        let rect = n.getClientRects()[0];\r\n\r\n        console.log(rect.x, rect.y);\r\n        if (x >= rect.x && x >= rect.y && x < rect.x+rect.width && y < rect.y+rect.height) {\r\n          console.log(\"found rect\");\r\n          n.dispatchEvent(\"pointerenter\", new PointerEvent(\"pointerenter\", e));\r\n        }\r\n      }\r\n      if (n === undefined || n.childNodes === undefined) {\r\n        return;\r\n      }\r\n\r\n      for (let n2 of n.childNodes) {\r\n        rec(n2);\r\n      }\r\n      if (n.shadow) {\r\n        for (let n2 of n.shadow.childNodes) {\r\n          rec(n2);\r\n        }\r\n      }\r\n    };\r\n\r\n    rec(this.overdraw);\r\n    //*/\r\n    if (this.sarea === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this.cursorbox === undefined) {\r\n      wid = 25;\r\n      this.cursorbox = this.overdraw.rect([e.x - wid*0.5, e.y - wid*0.5], [wid, wid], color);\r\n      this.cursorbox.style[\"pointer-events\"] = \"none\";\r\n    } else {\r\n      this.cursorbox.style[\"x\"] = (e.x - wid*0.5) + \"px\";\r\n      this.cursorbox.style[\"y\"] = (e.y - wid*0.5) + \"px\";\r\n    }\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    console.log(\"e.button\", e.button, e, e.x, e.y, this.getActiveBox(e.x, e.y));\r\n\r\n    if (e.button) {\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n    } else {\r\n      let box = this.getActiveBox(e.x, e.y);\r\n\r\n      if (box !== undefined) {\r\n        box.onclick(e);\r\n      }\r\n    }\r\n\r\n    this.finish();\r\n  }\r\n\r\n  modalStart(ctx) {\r\n    super.modalStart(...arguments);\r\n\r\n    let screen = this.screen;\r\n\r\n    this.overdraw.clear();\r\n\r\n    if (this.sarea && !this.excludeAreas.has(this.sarea)) {\r\n      let sa = this.sarea;\r\n      let box = this.overdraw.rect(sa.pos, sa.size, \"rgba(100, 100, 100, 0.5)\");\r\n\r\n      box.style[\"pointer-events\"] = \"none\";\r\n    }\r\n\r\n    for (let sa of screen.sareas) {\r\n      if (this.excludeAreas.has(sa)) {\r\n        continue;\r\n      }\r\n\r\n      this.makeBoxes(sa);\r\n    }\r\n  }\r\n\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case keymap[\"Escape\"]:\r\n      case keymap[\"Enter\"]:\r\n      case keymap[\"Space\"]:\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\n\r\nexport class AreaMoveAttachTool extends AreaDragTool {\r\n  constructor(screen, sarea, mpos) {\r\n    super(screen, sarea, mpos);\r\n\r\n    this.excludeAreas = new Set([sarea]);\r\n\r\n    this.dropArea = true;\r\n    this.first = true;\r\n    this.sarea = sarea;\r\n    this.mpos = new Vector2(mpos);\r\n    this.start_mpos2 = new Vector2(mpos);\r\n    this.start_pos = new Vector2(sarea.pos);\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let dx = e.x - this.start_mpos2[0];\r\n    let dy = e.y - this.start_mpos2[1];\r\n\r\n    let sarea = this.sarea;\r\n\r\n    if (this.first) {\r\n      this.start_mpos2 = new Vector2([e.x, e.y]);\r\n      this.first = false;\r\n      return;\r\n    }\r\n\r\n\r\n    sarea.pos[0] = this.start_pos[0] + dx;\r\n    sarea.pos[1] = this.start_pos[1] + dy;\r\n\r\n    sarea.loadFromPosSize();\r\n\r\n    this.mpos.loadXY(e.x, e.y);\r\n    super.on_pointermove(e);\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    super.on_pointerup(e);\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    super.on_pointerdown(e);\r\n  }\r\n\r\n  on_keydown(e) {\r\n    super.on_keydown(e);\r\n  }\r\n}\r\n\r\n//controller.registerTool(AreaDragTool);\r\n\r\nexport class ToolTipViewer extends ToolBase {\r\n  constructor(screen) {\r\n    super(screen);\r\n\r\n    this.tooltip = undefined;\r\n    this.element = undefined;\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Help Tool\",\r\n      toolpath   : \"screen.help_picker\",\r\n      icon       : ui_base.Icons.HELP,\r\n      description: \"view tooltips\",\r\n      is_modal   : true,\r\n      undoflag   : UndoFlags.NO_UNDO,\r\n      flag       : 0,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    this.pick(e);\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    this.pick(e);\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    this.finish();\r\n  }\r\n\r\n  finish() {\r\n    super.finish();\r\n  }\r\n\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case keymap.Escape:\r\n      case keymap.Enter:\r\n      case Keymap.Space:\r\n        if (this.tooltip) {\r\n          this.tooltip.end();\r\n        }\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n\r\n  pick(e) {\r\n    let x = e.x, y = e.y;\r\n\r\n    let ele = this.screen.pickElement(x, y);\r\n    console.log(ele ? ele.tagName : ele);\r\n\r\n    if (ele !== undefined && ele !== this.element && ele.title) {\r\n      if (this.tooltip) {\r\n        this.tooltip.end();\r\n      }\r\n\r\n      this.element = ele;\r\n      let tip = ele.title;\r\n\r\n      this.tooltip = ToolTip.show(tip, this.screen, x, y);\r\n    }\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n  }\r\n}\r\n\r\n","import nstructjs from '../path-controller/util/struct.js';\r\nimport * as ui_base from \"../core/ui_base.js\";\r\nimport * as FrameManager_ops from \"./FrameManager_ops.js\";\r\nimport cconst from \"../config/const.js\";\r\nimport {UIBase} from '../core/ui_base.js';\r\n\r\nimport {Vector2} from '../path-controller/util/vectormath.js';\r\nimport {createMenu, Menu} from '../widgets/ui_menu.js';\r\nimport {popModalLight, pushModalLight} from '../path-controller/util/simple_events.js';\r\n\r\nexport const AreaFlags = {\r\n  HIDDEN                : 1,\r\n  FLOATING              : 2,\r\n  INDEPENDENT           : 4, //area is indpendent of the screen mesh\r\n  NO_SWITCHER           : 8,\r\n  NO_HEADER_CONTEXT_MENU: 16,\r\n  NO_COLLAPSE           : 32,\r\n};\r\n\r\nexport let SnapLimit = 1;\r\n\r\nexport const BORDER_ZINDEX_BASE = 25\r\n\r\nexport function snap(c, snap_limit = SnapLimit) {\r\n  if (Array.isArray(c)) {\r\n    for (let i = 0; i < c.length; i++) {\r\n      c[i] = Math.floor(c[i]/snap_limit)*snap_limit;\r\n    }\r\n  } else {\r\n    c = Math.floor(c/snap_limit)*snap_limit;\r\n  }\r\n\r\n  return c;\r\n}\r\n\r\nexport function snapi(c, snap_limit = SnapLimit) {\r\n  //return snap(c, snap_limit);\r\n\r\n  if (Array.isArray(c)) {\r\n    for (let i = 0; i < c.length; i++) {\r\n      c[i] = Math.ceil(c[i]/snap_limit)*snap_limit;\r\n    }\r\n  } else {\r\n    c = Math.ceil(c/snap_limit)*snap_limit;\r\n  }\r\n\r\n  return c;\r\n}\r\n\r\nexport class ScreenVert extends Vector2 {\r\n  constructor(pos, id, added_id) {\r\n    super(pos);\r\n\r\n    this.added_id = added_id;\r\n    this.sareas = [];\r\n    this.borders = [];\r\n\r\n    this._id = id;\r\n  }\r\n\r\n  static hash(pos, added_id, limit) {\r\n    let x = snap(pos[0], limit);\r\n    let y = snap(pos[1], limit);\r\n\r\n    return \"\" + x + \":\" + y + \": + added_id\";\r\n  }\r\n\r\n  valueOf() {\r\n    return ScreenVert.hash(this, this.added_id);\r\n  }\r\n\r\n  [Symbol.keystr]() {\r\n    return ScreenVert.hash(this, this.added_id);\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n  }\r\n}\r\n\r\nScreenVert.STRUCT = `\r\npathux.ScreenVert {\r\n  0 : float;\r\n  1 : float;\r\n}\r\n`;\r\nnstructjs.register(ScreenVert);\r\n\r\nexport class ScreenHalfEdge {\r\n  constructor(border, sarea) {\r\n    this.sarea = sarea;\r\n    this.border = border;\r\n    this.side = sarea._side(border);\r\n  }\r\n\r\n  get v1() {\r\n    return this.border.v1;\r\n  }\r\n\r\n  get v2() {\r\n    return this.border.v2;\r\n  }\r\n\r\n  [Symbol.keystr]() {\r\n    return this.sarea._id + \":\" + this.border._id;\r\n  }\r\n\r\n}\r\n\r\nexport class ScreenBorder extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.visibleToPick = false;\r\n\r\n    this.screen = undefined;\r\n    this.v1 = undefined;\r\n    this.v2 = undefined;\r\n    this._id = undefined;\r\n\r\n    this._hash = undefined;\r\n\r\n    this.outer = undefined;\r\n\r\n    this.halfedges = []; //all bordering borders, including ones with nonshared verts\r\n    this.sareas = [];\r\n\r\n    this._innerstyle = document.createElement(\"style\");\r\n    this._style = undefined;\r\n\r\n    this.shadow.appendChild(this._innerstyle);\r\n\r\n    this.inner = document.createElement(\"div\");\r\n    //this.inner.innerText = \"sdfsdfsdf\";\r\n    this.shadow.appendChild(this.inner);\r\n\r\n    let call_menu = ScreenBorder.bindBorderMenu(this);\r\n\r\n    this.addEventListener(\"pointerdown\", (e) => {\r\n      let ok = this.movable;\r\n\r\n      if (e.button === 2) {\r\n        call_menu(e);\r\n        return;\r\n      }\r\n\r\n      if (!ok) {\r\n        console.log(\"border is not movable\");\r\n        return;\r\n      }\r\n\r\n      let tool = new FrameManager_ops.AreaResizeTool(this.screen, this, [e.x, e.y]);\r\n\r\n      tool.start();\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }, {capture: true});\r\n  }\r\n\r\n  static bindBorderMenu(elem, usePickElement = false) {\r\n    let on_dblclick = (e) => {\r\n      if (usePickElement && elem.pickElement(e.x, e.y) !== elem) {\r\n        return;\r\n      }\r\n\r\n      let menu = [\r\n        [\"Split Area\", () => {\r\n          elem.ctx.screen.splitTool();\r\n        }],\r\n        Menu.SEP,\r\n        [\"Collapse Area\", () => {\r\n          elem.ctx.screen.removeAreaTool(elem instanceof ScreenBorder ? elem : undefined);\r\n        }],\r\n      ];\r\n\r\n      menu = createMenu(elem.ctx, \"\", menu);\r\n      //if (e.button === 2) {\r\n      menu.ignoreFirstClick = 2;\r\n      //}\r\n\r\n      elem.ctx.screen.popupMenu(menu, e.x - 15, e.y - 15);\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n\r\n    elem.addEventListener(\"contextmenu\", (e) => e.preventDefault());\r\n    elem.addEventListener(\"dblclick\", on_dblclick, {capture: true});\r\n\r\n    return on_dblclick;\r\n  }\r\n\r\n  getOtherSarea(sarea) {\r\n    console.log(this.halfedges, this.halfedges.length);\r\n\r\n    for (let he of this.halfedges) {\r\n      console.log(he);\r\n\r\n      let ok = he.sarea !== sarea;\r\n      ok = ok && he.sarea._verts.indexOf(this.v1) >= 0;\r\n      ok = ok && he.sarea._verts.indexOf(this.v2) >= 0;\r\n\r\n      if (ok) {\r\n        return he.sarea;\r\n      }\r\n    }\r\n  }\r\n\r\n  get locked() {\r\n    for (let sarea of this.sareas) {\r\n      let mask = 1<<sarea._borders.indexOf(this);\r\n      let lock = sarea.borderLock & mask;\r\n\r\n      if (lock || (sarea.flag & AreaFlags.NO_COLLAPSE)) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  get dead() {\r\n    return !this.parentNode;\r\n  }\r\n\r\n  get side() {\r\n    throw new Error(\"side accedd\");\r\n  }\r\n\r\n  set side(val) {\r\n    throw new Error(\"side accedd\");\r\n  }\r\n\r\n  get valence() {\r\n    let ret = 0; //this.sareas.length;\r\n    let horiz = this.horiz;\r\n\r\n    let visit = {};\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let sv = i ? this.v2 : this.v1;\r\n      //console.log(sv);\r\n\r\n      for (let sa of sv.borders) {\r\n        if (sa.horiz != this.horiz)\r\n          continue;\r\n        if (sa._id in visit)\r\n          continue;\r\n\r\n        visit[sa._id] = 1;\r\n\r\n        let a0x = Math.min(this.v1[0], this.v2[0]);\r\n        let a0y = Math.min(this.v1[1], this.v2[1]);\r\n        let a1x = Math.max(this.v1[0], this.v2[0]);\r\n        let a1y = Math.max(this.v1[1], this.v2[1]);\r\n\r\n        let b0x = Math.min(sa.v1[0], sa.v2[0]);\r\n        let b0y = Math.min(sa.v1[1], sa.v2[1]);\r\n        let b1x = Math.min(sa.v1[0], sa.v2[0]);\r\n        let b1y = Math.min(sa.v1[1], sa.v2[1]);\r\n\r\n        let ok;\r\n\r\n        let eps = 0.001;\r\n        if (horiz) {\r\n          ok = (a0y <= b1y + eps && a1y >= a0y - eps);\r\n        } else {\r\n          ok = (a0x <= b1x + eps && a1x >= a0x - eps);\r\n        }\r\n\r\n        if (ok) {\r\n          //console.log(\"found\");\r\n          ret += sa.sareas.length;\r\n        }\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  get horiz() {\r\n    let dx = this.v2[0] - this.v1[0];\r\n    let dy = this.v2[1] - this.v1[1];\r\n\r\n    return Math.abs(dx) > Math.abs(dy);\r\n  }\r\n\r\n  static hash(v1, v2) {\r\n    return Math.min(v1._id, v2._id) + \":\" + Math.max(v1._id, v2._id);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"screenborder-x\",\r\n      style  : \"screenborder\"\r\n    };\r\n  }\r\n\r\n  otherVertex(v) {\r\n    if (v === this.v1)\r\n      return this.v2;\r\n    else\r\n      return this.v1;\r\n  }\r\n\r\n  setCSS() {\r\n    this.style[\"pointer-events\"] = this.movable ? \"auto\" : \"none\";\r\n\r\n    if (this._style === undefined) {\r\n      this._style = document.createElement(\"style\");\r\n      this.appendChild(this._style);\r\n    }\r\n\r\n    let dpi = UIBase.getDPI();\r\n\r\n    let pad = this.getDefault(\"mouse-threshold\")/dpi;\r\n    let wid = this.getDefault(\"border-width\");\r\n\r\n    let v1 = this.v1, v2 = this.v2;\r\n    let vec = new Vector2(v2).sub(v1);\r\n\r\n    let x = Math.min(v1[0], v2[0]), y = Math.min(v1[1], v2[1]);\r\n    let w, h;\r\n    let cursor, bstyle;\r\n\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"display\"] = this.horiz ? \"row\" : \"column\";\r\n    this.style[\"justify-content\"] = \"center\";\r\n    this.style[\"align-items\"] = \"center\";\r\n\r\n    if (!this.horiz) {\r\n      this.style[\"padding-left\"] = this.style[\"padding-right\"] = pad + \"px\";\r\n      x -= wid*0.5 + pad;\r\n\r\n      w = wid*2;\r\n      h = Math.abs(vec[1]);\r\n\r\n      cursor = 'e-resize';\r\n      bstyle = \"border-left-style : solid;\\n    border-right-style : solid;\\n\";\r\n      bstyle = \"border-top-style : none;\\n    border-bottom-style : none;\\n\";\r\n    } else {\r\n      this.style[\"padding-top\"] = this.style[\"padding-bottom\"] = pad + \"px\";\r\n      y -= wid*0.5 + pad;\r\n\r\n      w = Math.abs(vec[0]);\r\n      h = wid;\r\n\r\n      cursor = 'n-resize';\r\n      bstyle = \"border-top-style : solid;\\n    border-bottom-style : solid;\\n\";\r\n    }\r\n\r\n\r\n    let color = this.getDefault(\"border-outer\");\r\n    let debug = cconst.DEBUG.screenborders;\r\n\r\n    if (debug) {\r\n      wid = 4;\r\n      let alpha = 1.0;\r\n      let c = this.sareas.length*75;\r\n\r\n      let r = 0, g = 0, b = 0;\r\n\r\n      if (this.movable) {\r\n        b = 255;\r\n      }\r\n      if (this.halfedges.length > 1) {\r\n        g = 255;\r\n      }\r\n      if (this.outer) {\r\n        r = 255;\r\n      }\r\n      color = `rgba(${r}, ${g}, ${b}, ${alpha})`;\r\n    }\r\n\r\n\r\n    let innerbuf = `\r\n        .screenborder_inner_${this._id} {\r\n          ${bstyle}\r\n          ${this.horiz ? 'height' : 'width'} : ${wid}px;\r\n          ${!this.horiz ? 'height' : 'width'} : 100%;\r\n          margin : 0px;\r\n          padding : 0px;\r\n          \r\n          background-color : ${this.getDefault(\"border-inner\")};\r\n          border-color : ${color};\r\n          border-width : ${wid*0.5}px;\r\n          border-style : ${debug && this.outer ? \"dashed\" : \"solid\"};\r\n          pointer-events : none;\r\n        }`;\r\n\r\n    let sbuf = `\r\n        .screenborder_${this._id} {\r\n        }\r\n    `;\r\n\r\n    let ok = this.movable;\r\n    if (!this.outer) {\r\n      for (let sarea of this.sareas) {\r\n        ok = ok || sarea.floating;\r\n      }\r\n    }\r\n\r\n    if (ok) {\r\n      sbuf += `\r\n        .screenborder_${this._id}:hover {\r\n          cursor : ${cursor};\r\n        }\r\n      `;\r\n    }\r\n\r\n    this._style.textContent = sbuf;\r\n    this._innerstyle.textContent = innerbuf;\r\n\r\n    this.setAttribute(\"class\", \"screenborder_\" + this._id);\r\n    this.inner.setAttribute(\"class\", \"screenborder_inner_\" + this._id);\r\n\r\n    this.style[\"position\"] = UIBase.PositionKey;\r\n    this.style[\"left\"] = x + \"px\";\r\n    this.style[\"top\"] = y + \"px\";\r\n    this.style[\"width\"] = w + \"px\";\r\n    this.style[\"height\"] = h + \"px\";\r\n    this.style[\"z-index\"] = \"\" + BORDER_ZINDEX_BASE;\r\n  }\r\n\r\n  valueOf() {\r\n    return ScreenBorder.hash(this.v1, this.v2);\r\n  }\r\n\r\n  [Symbol.keystr]() {\r\n    return ScreenBorder.hash(this.v1, this.v2);\r\n  }\r\n}\r\n\r\nui_base.UIBase.internalRegister(ScreenBorder);\r\n","let _ScreenArea = undefined;\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as ui from '../core/ui.js';\r\nimport * as ui_noteframe from '../widgets/ui_noteframe.js';\r\nimport {haveModal} from '../path-controller/util/simple_events.js';\r\nimport cconst from '../config/const.js';\r\n\r\nimport nstructjs from '../path-controller/util/struct.js';\r\n\r\nlet UIBase = ui_base.UIBase;\r\n\r\nimport {EnumProperty} from \"../path-controller/toolsys/toolprop.js\";\r\n\r\nlet Vector2 = vectormath.Vector2;\r\nlet Screen = undefined;\r\n\r\nimport {AreaFlags, BORDER_ZINDEX_BASE, ScreenBorder, snap, snapi} from './FrameManager_mesh.js';\r\n\r\nexport {AreaFlags};\r\n\r\nexport * from './area_wrangler.js';\r\nimport {getAreaIntName, setAreaTypes, contextWrangler, AreaWrangler, areaclasses} from './area_wrangler.js';\r\n\r\nexport {contextWrangler};\r\n\r\nwindow._contextWrangler = contextWrangler;\r\n\r\nexport const BorderMask = {\r\n  LEFT  : 1,\r\n  BOTTOM: 2,\r\n  RIGHT : 4,\r\n  TOP   : 8,\r\n  ALL   : 1 | 2 | 4 | 8\r\n};\r\n\r\nexport const BorderSides = {\r\n  LEFT  : 0,\r\n  BOTTOM: 1,\r\n  RIGHT : 2,\r\n  TOP   : 3\r\n};\r\n\r\n/**\r\n * Base class for all editors\r\n **/\r\nexport class Area extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    /**\r\n     * -----b4----\r\n     *\r\n     * b1       b3\r\n     *\r\n     * -----b2----\r\n     *\r\n     * */\r\n\r\n    let def = this.constructor.define();\r\n\r\n    //set bits in mask to keep\r\n    //borders from moving\r\n    this.borderLock = def.borderLock || 0;\r\n    this.flag = def.flag || 0;\r\n\r\n    this.inactive = true;\r\n    this.areaDragToolEnabled = true;\r\n\r\n    this.owning_sarea = undefined;\r\n    this._area_id = contextWrangler.idgen++;\r\n\r\n    this.pos = undefined; //set by screenarea parent\r\n    this.size = undefined; //set by screenarea parent\r\n    this.minSize = [5, 5];\r\n    this.maxSize = [undefined, undefined];\r\n\r\n    let appendChild = this.shadow.appendChild;\r\n    this.shadow.appendChild = (child) => {\r\n      appendChild.call(this.shadow, child);\r\n      if (child instanceof UIBase) {\r\n        child.parentWidget = this;\r\n      }\r\n    }\r\n\r\n    let prepend = this.shadow.prepend;\r\n    this.shadow.prepend = (child) => {\r\n      prepend.call(this.shadow, child);\r\n\r\n      if (child instanceof UIBase) {\r\n        child.parentWidget = this;\r\n      }\r\n    };\r\n  }\r\n\r\n  get floating() {\r\n    return ~~(this.flag & AreaFlags.FLOATING);\r\n  }\r\n\r\n  set floating(val) {\r\n    if (val) {\r\n      this.flag |= AreaFlags.FLOATING;\r\n    } else {\r\n      this.flag &= ~AreaFlags.FLOATING;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get active area as defined by push_ctx_active and pop_ctx_active.\r\n   *\r\n   * Type should be an Area subclass, if undefined the last accessed area\r\n   * will be returned.\r\n   * */\r\n  static getActiveArea(type) {\r\n    return contextWrangler.getLastArea(type);\r\n  }\r\n\r\n  static unregister(cls) {\r\n    let def = cls.define();\r\n\r\n    if (!def.areaname) {\r\n      throw new Error(\"Missing areaname key in define()\");\r\n    }\r\n\r\n    if (def.areaname in areaclasses) {\r\n      delete areaclasses[def.areaname];\r\n    }\r\n  }\r\n\r\n  /*\r\n  addEventListener(type, cb, options) {\r\n    let cb2 = (e) => {\r\n      let x, y;\r\n      let screen = this.getScreen();\r\n\r\n      if (!screen) {\r\n        console.warn(\"no screen!\");\r\n        return cb(elem);\r\n      }\r\n\r\n      if (type.startsWith(\"mouse\")) {\r\n        x = e.x; y = e.y;\r\n      } else if (type.startsWith(\"touch\") && e.touches && e.touches.length > 0) {\r\n        x = e.touches[0].pageX; y = e.touches[0].pageY;\r\n      } else if (type.startsWith(\"pointer\")) {\r\n        x = e.x; y = e.y;\r\n      } else {\r\n        if (screen) {\r\n          x = screen.mpos[0];\r\n          y = screen.mpos[1];\r\n        } else {\r\n          x = y = -100;\r\n        }\r\n      }\r\n\r\n      let elem = screen.pickElement(x, y);\r\n      console.log(elem ? elem.tagName : undefined);\r\n\r\n      if (elem === this || elem === this.owning_sarea) {\r\n        return cb(elem);\r\n      }\r\n    };\r\n\r\n    cb.__cb2 = cb2;\r\n    return super.addEventListener(type, cb2, options);\r\n  }\r\n\r\n  removeEventListener(type, cb, options) {\r\n    super.removeEventListener(type, cb.__cb2, options);\r\n  }\r\n  //*/\r\n\r\n  static register(cls) {\r\n    let def = cls.define();\r\n\r\n    if (!def.areaname) {\r\n      throw new Error(\"Missing areaname key in define()\");\r\n    }\r\n\r\n    areaclasses[def.areaname] = cls;\r\n\r\n    ui_base.UIBase.internalRegister(cls);\r\n  }\r\n\r\n  static makeAreasEnum() {\r\n    let areas = {};\r\n    let icons = {};\r\n    let i = 0;\r\n\r\n    for (let k in areaclasses) {\r\n      let cls = areaclasses[k];\r\n      let def = cls.define();\r\n\r\n      if (def.flag & AreaFlags.HIDDEN)\r\n        continue;\r\n\r\n      let uiname = def.uiname;\r\n\r\n      if (uiname === undefined) {\r\n        uiname = k.replace(\"_\", \" \").toLowerCase();\r\n        uiname = uiname[0].toUpperCase() + uiname.slice(1, uiname.length);\r\n      }\r\n\r\n      areas[uiname] = k;\r\n      icons[uiname] = def.icon !== undefined ? def.icon : -1;\r\n    }\r\n\r\n    let prop = new EnumProperty(undefined, areas);\r\n    prop.addIcons(icons);\r\n\r\n    return prop;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname : \"pathux-editor-x\", // tag name, e.g. editor-x\r\n      areaname: undefined, //api name for area type\r\n      flag    : 0, //see AreaFlags\r\n      uiname  : undefined,\r\n      icon    : undefined //icon representing area in MakeHeader's area switching menu. Integer.\r\n    };\r\n  }\r\n\r\n  static newSTRUCT() {\r\n    return UIBase.createElement(this.define().tagname);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"overflow\"] = \"hidden\";\r\n    this.noMarginsOrPadding();\r\n\r\n    let onover = (e) => {\r\n      //console.log(this._area_id, this.ctx.workspace._area_id);\r\n\r\n      //try to trigger correct entry in context area stacks\r\n      this.push_ctx_active();\r\n      this.pop_ctx_active();\r\n    };\r\n\r\n    //*\r\n    super.addEventListener(\"mouseover\", onover, {passive: true});\r\n    super.addEventListener(\"mousemove\", onover, {passive: true});\r\n    super.addEventListener(\"mousein\", onover, {passive: true});\r\n    super.addEventListener(\"mouseenter\", onover, {passive: true});\r\n    super.addEventListener(\"touchstart\", onover, {passive: true});\r\n    super.addEventListener(\"focusin\", onover, {passive: true});\r\n    super.addEventListener(\"focus\", onover, {passive: true});\r\n    //*/\r\n  }\r\n\r\n  _get_v_suffix() {\r\n    if (this.flag & AreaFlags.INDEPENDENT) {\r\n      return this._id;\r\n    } else {\r\n      return \"\";\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Return a list of keymaps used by this editor\r\n   * @returns {Array<KeyMap>}\r\n   */\r\n  getKeyMaps() {\r\n    return this.keymap !== undefined ? [this.keymap] : [];\r\n  }\r\n\r\n  on_fileload(isActiveEditor) {\r\n    contextWrangler.reset();\r\n  }\r\n\r\n  buildDataPath() {\r\n    let p = this;\r\n\r\n    let sarea = this.owning_sarea;\r\n\r\n    if (sarea === undefined || sarea.screen === undefined) {\r\n      console.warn(\"Area.buildDataPath(): Failed to build data path\");\r\n      return \"\";\r\n    }\r\n\r\n    let screen = sarea.screen;\r\n\r\n    let idx1 = screen.sareas.indexOf(sarea);\r\n    let idx2 = sarea.editors.indexOf(this);\r\n\r\n    if (idx1 < 0 || idx2 < 0) {\r\n      throw new Error(\"malformed area data\");\r\n    }\r\n\r\n    let ret = `screen.sareas[${idx1}].editors[${idx2}]`;\r\n    return ret;\r\n  }\r\n\r\n  saveData() {\r\n    return {\r\n      _area_id: this._area_id,\r\n      areaName: this.areaName\r\n    };\r\n  }\r\n\r\n  loadData(obj) {\r\n    let id = obj._area_id;\r\n\r\n    if (id !== undefined && id !== null) {\r\n      this._area_id = id;\r\n    }\r\n  }\r\n\r\n  draw() {\r\n  }\r\n\r\n  copy() {\r\n    console.warn(\"You might want to implement this, Area.prototype.copy based method called\");\r\n    let ret = UIBase.createElement(this.constructor.define().tagname);\r\n    return ret;\r\n  }\r\n\r\n  on_resize(size, oldsize) {\r\n    super.on_resize(size, oldsize);\r\n  }\r\n\r\n  on_area_focus() {\r\n\r\n  }\r\n\r\n  on_area_blur() {\r\n\r\n  }\r\n\r\n  /** called when editors are swapped with another editor type*/\r\n  on_area_active() {\r\n  }\r\n\r\n  /** called when editors are swapped with another editor type*/\r\n  on_area_inactive() {\r\n  }\r\n\r\n  /*\r\n  * This is needed so UI controls can know what their parent area is.\r\n  * For example, a slider with data path \"view2d.zoomfac\" needs to know where\r\n  * to find view2d.\r\n  *\r\n  * Typically this works by adding a field to a ContextOverlay:\r\n  *\r\n  * class ContextOverlay {\r\n  *   get view3d() {\r\n  *     return Area.getActiveArea(View3D);\r\n  *   }\r\n  * }\r\n  *\r\n  * Make sure to wrap event callbacks in push_ctx_active and pop_ctx_active.\r\n  * */\r\n  push_ctx_active(dontSetLastRef = false) {\r\n    contextWrangler.updateLastRef(this.constructor, this);\r\n    contextWrangler.push(this.constructor, this, !dontSetLastRef);\r\n  }\r\n\r\n  /**\r\n   * see push_ctx_active\r\n   * */\r\n  pop_ctx_active(dontSetLastRef = false) {\r\n    contextWrangler.pop(this.constructor, this, !dontSetLastRef);\r\n  }\r\n\r\n  getScreen() {\r\n    //XXX\r\n    //return _appstate.screen;\r\n    throw new Error(\"replace me in Area.prototype\");\r\n  }\r\n\r\n  toJSON() {\r\n    return Object.assign(super.toJSON(), {\r\n      areaname: this.constructor.define().areaname,\r\n      _area_id: this._area_id\r\n    });\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n    this._area_id = obj._area_id;\r\n\r\n    return this;\r\n  }\r\n\r\n  getBarHeight() {\r\n    return this.header.getClientRects()[0].height;\r\n  }\r\n\r\n  makeAreaSwitcher(container) {\r\n    if (cconst.useAreaTabSwitcher) {\r\n      let ret = UIBase.createElement(\"area-docker-x\");\r\n      container.add(ret);\r\n      return ret;\r\n    }\r\n\r\n    let prop = Area.makeAreasEnum();\r\n\r\n    let dropbox = container.listenum(undefined, {\r\n      name    : this.constructor.define().uiname,\r\n      enumDef : prop,\r\n      callback: (id) => {\r\n        let cls = areaclasses[id];\r\n        this.owning_sarea.switch_editor(cls);\r\n      }\r\n    });\r\n\r\n    dropbox.update.after(() => {\r\n      let name = this.constructor.define().uiname;\r\n      let val = prop.values[name];\r\n\r\n      if (dropbox.value !== val && val in prop.keys) {\r\n        val = prop.keys[val];\r\n      }\r\n\r\n      if (dropbox.value !== val) {\r\n        dropbox.setValue(prop.values[name], true);\r\n      }\r\n    });\r\n\r\n    return dropbox;\r\n  }\r\n\r\n  makeHeader(container, add_note_area = true, make_draggable = true) {\r\n    let switcherRow;\r\n    let row;\r\n    let helpRow;\r\n\r\n    if (!(this.flag & AreaFlags.NO_SWITCHER) && cconst.useAreaTabSwitcher) {\r\n      let col = this.header = container.col();\r\n\r\n      switcherRow = helpRow = col.row();\r\n      row = col.row();\r\n    } else {\r\n      row = helpRow = this.header = container.row();\r\n    }\r\n\r\n    if (!(this.flag & AreaFlags.NO_HEADER_CONTEXT_MENU)) {\r\n      let callmenu = ScreenBorder.bindBorderMenu(this.header, true);\r\n\r\n      this.addEventListener(\"mousedown\", e => {\r\n        if (e.button !== 2 || this.header.pickElement(e.x, e.y) !== this.header) {\r\n          return;\r\n        }\r\n\r\n        callmenu(e);\r\n      });\r\n    }\r\n\r\n    this.header.remove();\r\n    container._prepend(this.header);\r\n\r\n    row.setCSS.after(() => row.background = this.getDefault(\"AreaHeaderBG\"));\r\n\r\n    let rh = ~~(16*this.getDPI());\r\n\r\n    //container.setSize(undefined, rh);\r\n    //row.setSize(undefined, rh);\r\n    //row.setSize(undefined, rh);\r\n\r\n    container.noMarginsOrPadding();\r\n    row.noMarginsOrPadding();\r\n\r\n    row.style[\"width\"] = \"100%\";\r\n    row.style[\"margin\"] = \"0px\";\r\n    row.style[\"padding\"] = \"0px\";\r\n\r\n    if (!(this.flag & AreaFlags.NO_SWITCHER)) {\r\n      if (this.switcher) {\r\n        //add back same switcher\r\n        switcherRow.add(this.switcher);\r\n      } else {\r\n        this.switcher = this.makeAreaSwitcher(cconst.useAreaTabSwitcher ? switcherRow : row);\r\n      }\r\n    }\r\n\r\n    if (util.isMobile() || cconst.addHelpPickers) {\r\n      if (this.helppicker) {\r\n        this.helppicker.remove();\r\n      }\r\n\r\n      this.helppicker = helpRow.helppicker();\r\n      this.helppicker.iconsheet = 0;\r\n    }\r\n\r\n    if (add_note_area) {\r\n      let notef = UIBase.createElement(\"noteframe-x\");\r\n      notef.ctx = this.ctx;\r\n      row._add(notef);\r\n    }\r\n\r\n    /* don't do normal dragging for tab switchers */\r\n    if (cconst.useAreaTabSwitcher) {\r\n      return row;\r\n    }\r\n\r\n    let eventdom = this.header;\r\n\r\n    let mdown = false;\r\n    let mpos = new Vector2();\r\n\r\n    let mpre = (e, pageX, pageY) => {\r\n      if (haveModal()) {\r\n        return;\r\n      }\r\n\r\n      pageX = pageX === undefined ? e.x : pageX;\r\n      pageY = pageY === undefined ? e.y : pageY;\r\n\r\n      let node = this.getScreen().pickElement(pageX, pageY);\r\n\r\n      /*\r\n      while (node) {\r\n        if (node === row) {\r\n          break;\r\n        }\r\n        node = node.parentWidget;\r\n      }//*/\r\n\r\n      //console.log(node === row, node ? node._id : undefined, row._id)\r\n\r\n      if (node !== row) {\r\n        return false;\r\n      }\r\n\r\n      return true;\r\n    }\r\n\r\n    eventdom.addEventListener(\"pointerout\", (e) => {\r\n      //console.log(\"pointerout\", e);\r\n      mdown = false;\r\n    });\r\n    eventdom.addEventListener(\"pointerleave\", (e) => {\r\n      mdown = false;\r\n      //console.log(\"pointerleave\", e);\r\n    });\r\n\r\n    eventdom.addEventListener(\"pointerdown\", (e) => {\r\n      //console.log(\"pointerdown\", e, mpre(e));\r\n\r\n      if (!mpre(e)) return;\r\n\r\n      mpos[0] = e.pageX;\r\n      mpos[1] = e.pageY;\r\n      mdown = true;\r\n    });\r\n\r\n    let last_time = util.time_ms();\r\n\r\n    let do_mousemove = (e, pageX, pageY) => {\r\n      if (haveModal() || !make_draggable) {\r\n        return;\r\n      }\r\n\r\n      let mdown2 = e.buttons !== 0 || (e.touches && e.touches.length > 0);\r\n      mdown2 = mdown2 && mdown;\r\n\r\n      //console.log(\"area drag?\", e, mdown2, e.pageX, e.pageY, mpre(e, pageX, pageY), e.was_touch);\r\n\r\n      //calls to pickElement in mpre are expensive\r\n      if (util.time_ms() - last_time < 250) {\r\n        return;\r\n      }\r\n\r\n      last_time = util.time_ms;\r\n\r\n      if (!mdown2 || !mpre(e, pageX, pageY)) return;\r\n\r\n\r\n      if (e.type === \"mousemove\" && e.was_touch) {\r\n        //okay how are patched events getting here?\r\n        //avoid double call. . .\r\n        return;\r\n      }\r\n\r\n      //console.log(mdown);\r\n      let dx = pageX - mpos[0];\r\n      let dy = pageY - mpos[1];\r\n\r\n      let dis = dx*dx + dy*dy;\r\n      let limit = 7;\r\n\r\n      if (dis > limit*limit) {\r\n        let sarea = this.owning_sarea;\r\n        if (sarea === undefined) {\r\n          console.warn(\"Error: missing sarea ref\");\r\n          return;\r\n        }\r\n\r\n        let screen = sarea.screen;\r\n        if (screen === undefined) {\r\n          console.log(\"Error: missing screen ref\");\r\n          return;\r\n        }\r\n\r\n        if (!this.areaDragToolEnabled) {\r\n          return;\r\n        }\r\n        mdown = false;\r\n        console.log(\"area drag tool!\", e.type, e);\r\n        screen.areaDragTool(this.owning_sarea);\r\n      }\r\n    };\r\n\r\n    //not working on mobile\r\n    //row.setAttribute(\"draggable\", true);\r\n    //row.draggable = true;\r\n    /*\r\n    eventdom.addEventListener(\"dragstart\", (e) => {\r\n      return;\r\n      console.log(\"drag start!\", e);\r\n      e.dataTransfer.setData(\"text/json\", \"SplitAreaDrag\");\r\n\r\n      let canvas = document.createElement(\"canvas\");\r\n      let g = canvas.g;\r\n\r\n      canvas.width = 32;\r\n      canvas.height = 32;\r\n\r\n      e.dataTransfer.setDragImage(canvas, 0, 0);\r\n\r\n      mdown = false;\r\n      console.log(\"area drag tool!\");\r\n      this.getScreen().areaDragTool(this.owning_sarea);\r\n    });\r\n\r\n    eventdom.addEventListener(\"drag\", (e) => {\r\n      console.log(\"drag!\", e);\r\n    });*/\r\n\r\n    eventdom.addEventListener(\"pointermove\", (e) => {\r\n      return do_mousemove(e, e.pageX, e.pageY);\r\n    }, false);\r\n    eventdom.addEventListener(\"pointerup\", (e) => {\r\n      console.log(\"pointerup\", e);\r\n      mdown = false;\r\n    }, false);\r\n    eventdom.addEventListener(\"pointercancel\", (e) => {\r\n      console.log(\"pointercancel\", e);\r\n      mdown = false;\r\n    }, false);\r\n\r\n    return row;\r\n  }\r\n\r\n  setCSS() {\r\n    if (this.size !== undefined) {\r\n      this.style[\"position\"] = UIBase.PositionKey;\r\n      //this.style[\"left\"] = this.pos[0] + \"px\";\r\n      //this.style[\"top\"] = this.pos[1] + \"px\";\r\n      this.style[\"width\"] = this.size[0] + \"px\";\r\n      this.style[\"height\"] = this.size[1] + \"px\";\r\n    }\r\n  }\r\n\r\n  update() {\r\n    //don't update non-active editors\r\n    if (this.owning_sarea === undefined || this !== this.owning_sarea.area) {\r\n      return;\r\n    }\r\n\r\n    super.update();\r\n\r\n    //see FrameManager.js, we use a single update\r\n    //function for everything now\r\n    //this._forEachChildWidget((n) => {\r\n    //  n.update();\r\n    //});\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n  }\r\n\r\n  _isDead() {\r\n    if (this.dead) {\r\n      return true;\r\n    }\r\n\r\n    let screen = this.getScreen();\r\n\r\n    if (screen === undefined)\r\n      return true;\r\n\r\n    if (screen.parentNode === undefined)\r\n      return true;\r\n  }\r\n\r\n  //called by owning ScreenArea on file load\r\n  afterSTRUCT() {\r\n    let f = () => {\r\n      if (this._isDead()) {\r\n        return;\r\n      }\r\n      if (!this.ctx) {\r\n        this.doOnce(f);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        ui_base.loadUIData(this, this.saved_uidata);\r\n        this.saved_uidata = undefined;\r\n      } catch (error) {\r\n        console.log(\"failed to load ui data\");\r\n        util.print_stack(error);\r\n      }\r\n    };\r\n\r\n    this.doOnce(f);\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n  }\r\n\r\n  _getSavedUIData() {\r\n    return ui_base.saveUIData(this, \"area\");\r\n  }\r\n}\r\n\r\nArea.STRUCT = `\r\npathux.Area { \r\n  flag : int;\r\n  saved_uidata : string | obj._getSavedUIData();\r\n}\r\n`\r\n\r\nnstructjs.register(Area, \"pathux.Area\");\r\nui_base.UIBase.internalRegister(Area);\r\n\r\nexport class ScreenArea extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._flag = undefined;\r\n\r\n    this.flag = 0; /** holds AreaFlags.FLOATING and AreaFlags.INDEPENDENT */\r\n\r\n    this._borders = [];\r\n    this._verts = [];\r\n    this.dead = false;\r\n\r\n    this._sarea_id = contextWrangler.idgen++;\r\n\r\n    this._pos = new Vector2();\r\n    this._size = new Vector2([512, 512]);\r\n\r\n    if (cconst.DEBUG.screenAreaPosSizeAccesses) {\r\n      let wrapVector = (name, axis) => {\r\n        Object.defineProperty(this[name], axis, {\r\n          get: function () {\r\n            return this[\"_\" + axis];\r\n          },\r\n\r\n          set: function (val) {\r\n            console.warn(`ScreenArea.${name}[${axis}] set:`, val);\r\n            this[\"_\" + axis] = val;\r\n          }\r\n        });\r\n      };\r\n\r\n      wrapVector(\"size\", 0);\r\n      wrapVector(\"size\", 1);\r\n      wrapVector(\"pos\", 0);\r\n      wrapVector(\"pos\", 1);\r\n    }\r\n\r\n    this.area = undefined;\r\n    this.editors = [];\r\n    this.editormap = {};\r\n\r\n    this.addEventListener(\"mouseover\", (e) => {\r\n      if (haveModal()) {\r\n        return;\r\n      }\r\n\r\n      //console.log(\"screen area mouseover\");\r\n      let screen = this.getScreen();\r\n      if (screen.sareas.active !== this && screen.sareas.active && screen.sareas.active.area) {\r\n        screen.sareas.active.area.on_area_blur();\r\n      }\r\n\r\n      if (this.area && screen.sareas.active !== this) {\r\n        this.area.on_area_focus();\r\n      }\r\n\r\n      screen.sareas.active = this;\r\n    });\r\n\r\n    //this.addEventListener(\"mouseleave\", (e) => {\r\n    //console.log(\"screen area mouseleave\");\r\n    //});\r\n  }\r\n\r\n  /*\r\n  saveData() {\r\n    return {\r\n      _sarea_id : this._sarea_id,\r\n      pos       : this.pos,\r\n      size      : this.size,\r\n    };\r\n  }\r\n  loadData(obj) {\r\n    super.loadData(obj);\r\n\r\n    let id = obj._sarea_id;\r\n    \r\n    let type = obj.areatype;\r\n    \r\n    if (id !== undefined && id !== null) {\r\n      this._sarea_id = id;\r\n    }\r\n    \r\n    for (let area of this.editors) {\r\n      if (area.areaType == type) {\r\n        console.log(\"             found saved area type\");\r\n        \r\n        this.switch_editor(area.constructor);\r\n      }\r\n    }\r\n    \r\n    this.pos.load(obj.pos);\r\n    this.size.load(obj.size);\r\n  }//*/\r\n\r\n  get floating() {\r\n    return this.flag & AreaFlags.FLOATING;\r\n  }\r\n\r\n  set floating(val) {\r\n    if (val) {\r\n      this.flag |= AreaFlags.FLOATING;\r\n    } else {\r\n      this.flag &= ~AreaFlags.FLOATING;\r\n    }\r\n  }\r\n\r\n  get flag() {\r\n    let flag = this._flag & (AreaFlags.FLOATING | AreaFlags.INDEPENDENT);\r\n\r\n    if (this.area) {\r\n      flag |= this.area.flag;\r\n    }\r\n\r\n    return flag;\r\n  }\r\n\r\n  set flag(v) {\r\n    this._flag &= ~(AreaFlags.FLOATING | AreaFlags.INDEPENDENT);\r\n    this._flag |= v & (AreaFlags.FLOATING | AreaFlags.INDEPENDENT);\r\n\r\n    if (this.area) {\r\n      this.area.flag |= v & ~(AreaFlags.FLOATING | AreaFlags.INDEPENDENT);\r\n    }\r\n  }\r\n\r\n  get borderLock() {\r\n    return this.area !== undefined ? this.area.borderLock : 0;\r\n  }\r\n\r\n  get minSize() {\r\n    return this.area !== undefined ? this.area.minSize : this.size;\r\n  }\r\n\r\n  get maxSize() {\r\n    return this.area !== undefined ? this.area.maxSize : this.size;\r\n  }\r\n\r\n  get pos() {\r\n    return this._pos;\r\n  }\r\n\r\n  set pos(val) {\r\n    if (cconst.DEBUG.screenAreaPosSizeAccesses) {\r\n      console.log(\"ScreenArea set pos\", val);\r\n    }\r\n    this._pos.load(val);\r\n  }\r\n\r\n  get size() {\r\n    return this._size;\r\n  }\r\n\r\n  set size(val) {\r\n    if (cconst.DEBUG.screenAreaPosSizeAccesses) {\r\n      console.log(\"ScreenArea set size\", val);\r\n    }\r\n    this._size.load(val);\r\n  }\r\n\r\n  static newSTRUCT() {\r\n    return UIBase.createElement(\"screenarea-x\");\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"screenarea-x\"\r\n    };\r\n  }\r\n\r\n  _get_v_suffix() {\r\n    return this.area ? this.area._get_v_suffix() : \"\";\r\n  }\r\n\r\n  bringToFront() {\r\n    let screen = this.getScreen();\r\n\r\n    HTMLElement.prototype.remove.call(this);\r\n    screen.sareas.remove(this);\r\n\r\n    screen.appendChild(this);\r\n\r\n    let zindex = BORDER_ZINDEX_BASE + 1;\r\n\r\n    if (screen.style[\"z-index\"]) {\r\n      zindex = parseInt(screen.style[\"z-index\"]) + 1;\r\n    }\r\n\r\n    for (let sarea of screen.sareas) {\r\n      let zindex = sarea.style[\"z-index\"];\r\n      if (sarea.style[\"z-index\"]) {\r\n        zindex = Math.max(zindex, parseInt(sarea.style[\"z-index\"]) + 1);\r\n      }\r\n    }\r\n\r\n    this.style[\"z-index\"] = zindex;\r\n  }\r\n\r\n  _side(border) {\r\n    let ret = this._borders.indexOf(border);\r\n    if (ret < 0) {\r\n      throw new Error(\"border not in screen area\");\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.noMarginsOrPadding();\r\n  }\r\n\r\n  draw() {\r\n    if (this.area && this.area.draw) {\r\n      this.area.push_ctx_active();\r\n      this.area.draw();\r\n      this.area.pop_ctx_active();\r\n    }\r\n  }\r\n\r\n  _isDead() {\r\n    if (this.dead) {\r\n      return true;\r\n    }\r\n\r\n    let screen = this.getScreen();\r\n\r\n    if (screen === undefined)\r\n      return true;\r\n\r\n    if (screen.parentNode === undefined)\r\n      return true;\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = {\r\n      editors  : this.editors,\r\n      _sarea_id: this._sarea_id,\r\n      area     : this.area.constructor.define().areaname,\r\n      pos      : this.pos,\r\n      size     : this.size\r\n    };\r\n\r\n    return Object.assign(super.toJSON(), ret);\r\n  }\r\n\r\n  on_keydown(e) {\r\n    if (this.area.on_keydown) {\r\n      this.area.push_ctx_active();\r\n      this.area.on_keydown(e);\r\n      this.area.pop_ctx_active();\r\n    }\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    if (obj === undefined) {\r\n      console.warn(\"undefined in loadJSON\");\r\n      return;\r\n    }\r\n\r\n    super.loadJSON(obj);\r\n\r\n    this.pos.load(obj.pos);\r\n    this.size.load(obj.size);\r\n\r\n    for (let editor of obj.editors) {\r\n      let areaname = editor.areaname;\r\n\r\n      //console.log(editor);\r\n\r\n      let tagname = areaclasses[areaname].define().tagname;\r\n      let area = UIBase.createElement(tagname);\r\n\r\n      area.owning_sarea = this;\r\n      this.editormap[areaname] = area;\r\n      this.editors.push(this.editormap[areaname]);\r\n\r\n      area.pos = new Vector2(obj.pos);\r\n      area.size = new Vector2(obj.size);\r\n      area.ctx = this.ctx;\r\n\r\n      area.inactive = true;\r\n      area.loadJSON(editor);\r\n      area.owning_sarea = undefined;\r\n\r\n      if (areaname === obj.area) {\r\n        this.area = area;\r\n      }\r\n    }\r\n\r\n    if (this.area !== undefined) {\r\n      this.area.ctx = this.ctx;\r\n      this.area.style[\"width\"] = \"100%\";\r\n      this.area.style[\"height\"] = \"100%\";\r\n      this.area.owning_sarea = this;\r\n      this.area.parentWidget = this;\r\n\r\n      this.area.pos = this.pos;\r\n      this.area.size = this.size;\r\n\r\n      this.area.inactive = false;\r\n      this.shadow.appendChild(this.area);\r\n      this.area.on_area_active();\r\n      this.area.onadd();\r\n    }\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  _ondestroy() {\r\n    super._ondestroy();\r\n\r\n    this.dead = true;\r\n\r\n    for (let editor of this.editors) {\r\n      if (editor === this.area) continue;\r\n\r\n      editor._ondestroy();\r\n    }\r\n  }\r\n\r\n  getScreen() {\r\n    if (this.screen !== undefined) {\r\n      return this.screen;\r\n    }\r\n\r\n    //try to walk up graph, if possible\r\n    let p = this.parentNode;\r\n    let _i = 0;\r\n\r\n    while (p && !(p instanceof Screen) && p !== p.parentNode) {\r\n      p = this.parentNode;\r\n\r\n      if (_i++ > 1000) {\r\n        console.warn(\"infinite loop detected in ScreenArea.prototype.getScreen()\");\r\n        return undefined;\r\n      }\r\n    }\r\n\r\n    return p && p instanceof Screen ? p : undefined;\r\n  }\r\n\r\n  copy(screen) {\r\n    let ret = UIBase.createElement(\"screenarea-x\");\r\n\r\n    ret.screen = screen;\r\n    ret.ctx = this.ctx;\r\n\r\n    ret.pos[0] = this.pos[0];\r\n    ret.pos[1] = this.pos[1];\r\n\r\n    ret.size[0] = this.size[0];\r\n    ret.size[1] = this.size[1];\r\n\r\n    for (let area of this.editors) {\r\n      let cpy = area.copy();\r\n\r\n      cpy.ctx = this.ctx;\r\n\r\n      cpy.parentWidget = ret;\r\n      ret.editors.push(cpy);\r\n      ret.editormap[cpy.constructor.define().areaname] = cpy;\r\n\r\n      if (area === this.area) {\r\n        ret.area = cpy;\r\n      }\r\n    }\r\n\r\n    //console.trace(\"RET.AREA\", this.area, ret.area);\r\n\r\n    ret.ctx = this.ctx;\r\n\r\n    if (ret.area !== undefined) {\r\n      ret.area.ctx = this.ctx;\r\n\r\n      ret.area.pos = ret.pos;\r\n      ret.area.size = ret.size;\r\n      ret.area.owning_sarea = ret;\r\n      ret.area.parentWidget = ret;\r\n\r\n      ret.shadow.appendChild(ret.area);\r\n      //ret.area.onadd();\r\n\r\n      if (ret.area._init_done) {\r\n        ret.area.push_ctx_active();\r\n        ret.area.on_area_active();\r\n        ret.area.pop_ctx_active();\r\n      } else {\r\n        ret.doOnce(() => {\r\n          if (this.dead) {\r\n            return;\r\n          }\r\n          ret._init();\r\n          ret.area._init();\r\n          ret.area.push_ctx_active();\r\n          ret.area.on_area_active();\r\n          ret.area.pop_ctx_active();\r\n        });\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  snapToScreenSize() {\r\n    let screen = this.getScreen();\r\n    let co = new Vector2();\r\n    let changed = 0;\r\n\r\n    for (let v of this._verts) {\r\n      co.load(v);\r\n\r\n      v[0] = Math.min(Math.max(v[0], 0), screen.size[0]);\r\n      v[1] = Math.min(Math.max(v[1], 0), screen.size[1]);\r\n\r\n      if (co.vectorDistance(v) > 0.1) {\r\n        changed = 1;\r\n      }\r\n    }\r\n\r\n    if (changed) {\r\n      this.loadFromVerts();\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Sets screen verts from pos/size\r\n   * */\r\n  loadFromPosSize() {\r\n    if (this.floating && this._verts.length > 0) {\r\n      let p = this.pos, s = this.size;\r\n\r\n      this._verts[0].loadXY(p[0], p[1]);\r\n      this._verts[1].loadXY(p[0], p[1] + s[1]);\r\n      this._verts[2].loadXY(p[0] + s[0], p[1] + s[1]);\r\n      this._verts[3].loadXY(p[0] + s[0], p[1]);\r\n\r\n      for (let border of this._borders) {\r\n        border.setCSS();\r\n      }\r\n\r\n      this.setCSS();\r\n      return;\r\n    }\r\n\r\n    let screen = this.getScreen();\r\n    if (!screen) return;\r\n\r\n    for (let b of this._borders) {\r\n      screen.freeBorder(b);\r\n    }\r\n\r\n    this.makeBorders(screen);\r\n    this.setCSS();\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Sets pos/size from screen verts\r\n   * */\r\n  loadFromVerts() {\r\n    if (this._verts.length == 0) {\r\n      return;\r\n    }\r\n\r\n    let min = new Vector2([1e17, 1e17]);\r\n    let max = new Vector2([-1e17, -1e17]);\r\n\r\n    for (let v of this._verts) {\r\n      min.min(v);\r\n      max.max(v);\r\n    }\r\n\r\n    this.pos[0] = min[0];\r\n    this.pos[1] = min[1];\r\n\r\n    this.size[0] = max[0] - min[0];\r\n    this.size[1] = max[1] - min[1];\r\n\r\n    this.setCSS();\r\n    return this;\r\n  }\r\n\r\n  on_resize(size, oldsize) {\r\n    super.on_resize(size, oldsize);\r\n\r\n    if (this.area !== undefined) {\r\n      this.area.on_resize(size, oldsize);\r\n    }\r\n  }\r\n\r\n  makeBorders(screen) {\r\n    this._borders.length = 0;\r\n    this._verts.length = 0;\r\n\r\n    let p = this.pos, s = this.size;\r\n\r\n    //s = snapi(new Vector2(s));\r\n\r\n    let vs = [\r\n      new Vector2([p[0], p[1]]),\r\n      new Vector2([p[0], p[1] + s[1]]),\r\n      new Vector2([p[0] + s[0], p[1] + s[1]]),\r\n      new Vector2([p[0] + s[0], p[1]])\r\n    ];\r\n\r\n    let floating = this.floating;\r\n\r\n    for (let i = 0; i < vs.length; i++) {\r\n      vs[i] = snap(vs[i]);\r\n      vs[i] = screen.getScreenVert(vs[i], i, floating);\r\n      this._verts.push(vs[i]);\r\n    }\r\n\r\n    for (let i = 0; i < vs.length; i++) {\r\n      let v1 = vs[i], v2 = vs[(i + 1)%vs.length];\r\n\r\n      let b = screen.getScreenBorder(this, v1, v2, i);\r\n\r\n\r\n      for (let j = 0; j < 2; j++) {\r\n        let v = j ? b.v2 : b.v1;\r\n\r\n        if (v.sareas.indexOf(this) < 0) {\r\n          v.sareas.push(this);\r\n        }\r\n      }\r\n\r\n      if (b.sareas.indexOf(this) < 0) {\r\n        b.sareas.push(this);\r\n      }\r\n\r\n      this._borders.push(b);\r\n\r\n      b.movable = screen.isBorderMovable(b);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  setCSS() {\r\n    this.style[\"position\"] = UIBase.PositionKey;\r\n\r\n    this.style[\"left\"] = this.pos[0] + \"px\";\r\n    this.style[\"top\"] = this.pos[1] + \"px\";\r\n\r\n    this.style[\"width\"] = this.size[0] + \"px\";\r\n    this.style[\"height\"] = this.size[1] + \"px\";\r\n\r\n    this.style[\"overflow\"] = \"hidden\";\r\n    this.style[\"contain\"] = \"layout\"; //ensure we have a new positioning stack\r\n\r\n    if (this.area !== undefined) {\r\n      this.area.setCSS();\r\n    }\r\n  }\r\n\r\n  appendChild(child) {\r\n    if (child instanceof Area) {\r\n      let def = child.constructor.define();\r\n      let existing = this.editormap[def.areaname];\r\n\r\n      if (existing && existing !== child) {\r\n        console.warn(\"Warning, replacing an exising editor instance\", child, existing);\r\n\r\n        if (this.area === existing) {\r\n          this.area = child;\r\n        }\r\n\r\n        existing.remove();\r\n        this.editormap[def.areaname] = child;\r\n      }\r\n\r\n      child.ctx = this.ctx;\r\n      child.pos = this.pos;\r\n      child.size = this.size;\r\n\r\n      if (this.editors.indexOf(child) < 0) {\r\n        this.editors.push(child);\r\n      }\r\n\r\n      child.owning_sarea = undefined;\r\n      if (this.area === undefined) {\r\n        this.area = child;\r\n      }\r\n    }\r\n\r\n    super.appendChild(child);\r\n\r\n    if (child instanceof ui_base.UIBase) {\r\n      child.parentWidget = this;\r\n      child.onadd();\r\n    }\r\n  }\r\n\r\n  switch_editor(cls) {\r\n    return this.switchEditor(cls);\r\n  }\r\n\r\n  switchEditor(cls) {\r\n    let def = cls.define();\r\n    let name = def.areaname;\r\n\r\n    //areaclasses[name]\r\n    if (!(name in this.editormap)) {\r\n      this.editormap[name] = UIBase.createElement(def.tagname);\r\n      this.editormap[name].ctx = this.ctx;\r\n      this.editormap[name].parentWidget = this;\r\n      this.editormap[name].owning_sarea = this;\r\n      this.editormap[name].inactive = false;\r\n\r\n      this.editors.push(this.editormap[name]);\r\n    }\r\n\r\n    //var finish = () => {\r\n    if (this.area) {\r\n      //break direct pos/size references for old active area\r\n      this.area.pos = new Vector2(this.area.pos);\r\n      this.area.size = new Vector2(this.area.size);\r\n\r\n      this.area.owning_sarea = undefined;\r\n      this.area.inactive = true;\r\n      this.area.push_ctx_active();\r\n      this.area._init(); //check that init was called\r\n      this.area.on_area_inactive();\r\n      this.area.pop_ctx_active();\r\n\r\n      this.area.remove();\r\n    } else {\r\n      this.area = undefined;\r\n    }\r\n\r\n    this.area = this.editormap[name];\r\n\r\n    this.area.inactive = false;\r\n    this.area.parentWidget = this;\r\n\r\n    //. . .and set references to pos/size\r\n    this.area.pos = this.pos;\r\n    this.area.size = this.size;\r\n    this.area.owning_sarea = this;\r\n    this.area.ctx = this.ctx;\r\n\r\n    this.area.packflag |= this.packflag;\r\n\r\n    this.shadow.appendChild(this.area);\r\n\r\n    this.area.style[\"width\"] = \"100%\";\r\n    this.area.style[\"height\"] = \"100%\";\r\n\r\n    //propegate new size\r\n    this.area.push_ctx_active();\r\n    this.area._init(); //check that init was called\r\n    this.area.on_resize(this.size, this.size);\r\n    this.area.pop_ctx_active();\r\n\r\n    this.area.push_ctx_active();\r\n    this.area.on_area_active();\r\n    this.area.pop_ctx_active();\r\n\r\n    this.regenTabOrder();\r\n    //}\r\n  }\r\n\r\n  _checkWrangler() {\r\n    if (this.ctx)\r\n      contextWrangler._checkWrangler(this.ctx);\r\n  }\r\n\r\n  update() {\r\n    this._checkWrangler();\r\n\r\n    super.update();\r\n\r\n    //flag client controller implementation that\r\n    //this area is active for its type\r\n    if (this.area !== undefined) {\r\n      this.area.owning_sarea = this;\r\n      this.area.parentWidget = this;\r\n      this.area.size = this.size;\r\n      this.area.pos = this.pos;\r\n\r\n      let screen = this.getScreen();\r\n      let oldsize = [this.size[0], this.size[1]];\r\n\r\n      let moved = screen ? screen.checkAreaConstraint(this, true) : 0;\r\n      //*\r\n      if (moved) {\r\n        if (cconst.DEBUG.areaConstraintSolver) {\r\n          console.log(\"screen constraint solve\", moved, this.area.minSize, this.area.maxSize, this.area.tagName, this.size);\r\n        }\r\n\r\n        screen.solveAreaConstraints();\r\n        screen.regenBorders();\r\n        this.on_resize(oldsize);\r\n      }//*/\r\n\r\n      this.area.push_ctx_active(true);\r\n    }\r\n\r\n    this._forEachChildWidget((n) => {\r\n      n.update();\r\n    });\r\n\r\n    if (this.area !== undefined) {\r\n      this.area.pop_ctx_active(true);\r\n    }\r\n  }\r\n\r\n  appendChild(ch) {\r\n    if (ch instanceof Area) {\r\n      this.editors.push(ch);\r\n      this.editormap[ch.constructor.define().areaname] = ch;\r\n    } else {\r\n      super.appendChild(ch);\r\n    }\r\n  }\r\n\r\n  removeChild(ch) {\r\n    if (ch instanceof Area) {\r\n      ch.owining_sarea = undefined;\r\n      ch.pos = undefined;\r\n      ch.size = undefined;\r\n\r\n      if (this.area === ch && this.editors.length > 1) {\r\n        let i = (this.editors.indexOf(ch) + 1)%this.editors.length;\r\n        this.switchEditor(this.editors[i].constructor);\r\n      } else if (this.area === ch) {\r\n        this.editors = [];\r\n        this.editormap = {};\r\n        this.area = undefined;\r\n\r\n        ch.remove();\r\n        return;\r\n      }\r\n\r\n      let areaname = ch.constructor.define().areaname;\r\n\r\n      this.editors.remove(ch);\r\n      delete this.editormap[areaname];\r\n\r\n      ch.parentWidget = undefined;\r\n    } else {\r\n      return super.removeChild(ch);\r\n    }\r\n  }\r\n\r\n  afterSTRUCT() {\r\n    for (let area of this.editors) {\r\n      area.pos = this.pos;\r\n      area.size = this.size;\r\n      area.owning_sarea = this;\r\n\r\n      area.push_ctx_active();\r\n      area._ctx = this.ctx;\r\n      area.afterSTRUCT();\r\n      area.pop_ctx_active();\r\n    }\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    this.pos = new Vector2(this.pos);\r\n    this.size = new Vector2(this.size);\r\n\r\n    //find active editor\r\n\r\n    let editors = [];\r\n\r\n    for (let area of this.editors) {\r\n      if (!area.constructor || !area.constructor.define || area.constructor === Area) {\r\n        //failed to load this area\r\n        continue;\r\n      }\r\n\r\n      /*\r\n      if (area.constructor === undefined || area.constructor.define === undefined) {\r\n        console.warn(\"Missing class for area\", area, \"maybe buggy loadSTRUCT()?\");\r\n        continue;\r\n      }\r\n      //*/\r\n\r\n      let areaname = area.constructor.define().areaname;\r\n\r\n      area.inactive = true;\r\n      area.owning_sarea = undefined;\r\n      this.editormap[areaname] = area;\r\n\r\n      if (areaname === this.area) {\r\n        this.area = area;\r\n      }\r\n\r\n      /*\r\n      * originally inactive areas weren't supposed to have\r\n      * a reference to their owning ScreenAreas.\r\n      *\r\n      * Unfortunately this will cause isDead() to return true,\r\n      * which might lead to nasty problems.\r\n      * */\r\n      area.parentWidget = this;\r\n\r\n      editors.push(area);\r\n    }\r\n    this.editors = editors;\r\n\r\n    if (typeof this.area !== \"object\") {\r\n      let area = this.editors[0];\r\n\r\n      console.warn(\"Failed to find active area!\", this.area);\r\n\r\n      if (typeof area !== \"object\") {\r\n        for (let k in areaclasses) {\r\n          area = areaclasses[k].define().tagname;\r\n          area = UIBase.createElement(area);\r\n          let areaname = area.constructor.define().areaname;\r\n\r\n          this.editors.push(area);\r\n          this.editormap[areaname] = area;\r\n\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (area) {\r\n        this.area = area;\r\n      }\r\n    }\r\n\r\n    if (this.area !== undefined) {\r\n      this.area.style[\"width\"] = \"100%\";\r\n      this.area.style[\"height\"] = \"100%\";\r\n      this.area.owning_sarea = this;\r\n      this.area.parentWidget = this;\r\n\r\n      this.area.pos = this.pos;\r\n      this.area.size = this.size;\r\n\r\n      this.area.inactive = false;\r\n      this.shadow.appendChild(this.area);\r\n\r\n      let f = () => {\r\n        if (this._isDead()) {\r\n          return;\r\n        }\r\n\r\n        if (!this.ctx && this.parentNode) {\r\n          console.log(\"waiting to start. . .\");\r\n          this.doOnce(f);\r\n          return;\r\n        }\r\n\r\n        this.area.ctx = this.ctx;\r\n        this.area._init(); //ensure init has been called already\r\n        this.area.on_area_active();\r\n        this.area.onadd();\r\n      };\r\n\r\n      this.doOnce(f);\r\n    }\r\n\r\n  }\r\n}\r\n\r\nScreenArea.STRUCT = `\r\npathux.ScreenArea { \r\n  pos      : vec2;\r\n  size     : vec2;\r\n  type     : string;\r\n  hidden   : bool;\r\n  editors  : array(abstract(pathux.Area));\r\n  area     : string | this.area ? this.area.constructor.define().areaname : \"\";\r\n}\r\n`;\r\n\r\nnstructjs.register(ScreenArea, \"pathux.ScreenArea\");\r\nui_base.UIBase.internalRegister(ScreenArea);\r\n\r\nui_base._setAreaClass(Area);\r\n\r\nexport function setScreenClass(cls) {\r\n  Screen = cls;\r\n}\r\n","import {Area} from '../screen/ScreenArea.js';\r\nimport * as nstructjs from '../path-controller/util/struct.js';\r\nimport {UIBase, theme, flagThemeUpdate, saveUIData, loadUIData} from '../core/ui_base.js';\r\nimport {Container} from '../core/ui.js';\r\nimport {validateCSSColor, color2css, css2color, CSSFont} from '../core/ui_theme.js';\r\n\r\nexport class ThemeEditor extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.categoryMap = {};\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"theme-editor-x\",\r\n      style  : \"theme-editor\"\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.build();\r\n  }\r\n\r\n  doFolder(catkey, obj, container = this, panel = undefined, path=undefined) {\r\n    let key = catkey.key;\r\n\r\n    if (!path) {\r\n      path = [key];\r\n    }\r\n\r\n    if (!panel) {\r\n      panel = container.panel(key, undefined, undefined, catkey.help);\r\n      panel.style[\"margin-left\"] = \"15px\";\r\n    }\r\n\r\n    let row2 = panel.row();\r\n    let textbox = row2.textbox(undefined, \"\");\r\n\r\n    let callback = (id) => {\r\n      console.log(\"ID\", id, obj, catkey);\r\n      console.log(textbox, textbox.text, textbox.value);\r\n\r\n      let propkey = (textbox.text || \"\").trim();\r\n\r\n      if (!propkey) {\r\n        console.error(\"Cannot have empty theme property name\");\r\n        return;\r\n      }\r\n\r\n      if (id === \"FLOAT\") {\r\n        obj[propkey] = 0.0;\r\n      } else if (id === \"SUBFOLDER\") {\r\n        obj[propkey] = {test : 0};\r\n      } else if (id === \"COLOR\") {\r\n        obj[propkey] = \"grey\";\r\n      } else if (id === \"FONT\") {\r\n        obj[propkey] = new CSSFont();\r\n      } else if (id === \"STRING\") {\r\n        obj[propkey] = \"\";\r\n      }\r\n\r\n      let uidata = saveUIData(panel, \"theme-panel\");\r\n\r\n      panel.clear();\r\n      this.doFolder(catkey, obj, container, panel, path);\r\n\r\n      loadUIData(panel, uidata);\r\n      panel.flushUpdate();\r\n      panel.flushSetCSS();\r\n\r\n      //doFolder(catkey, obj, container = this, panel=undefined) {\r\n      //this.build();\r\n      if (this.onchange) {\r\n        this.onchange(key, propkey, obj);\r\n      }\r\n    }\r\n\r\n    let menu = row2.menu(\"+\", [\r\n      {name: \"Float\", callback: () => callback(\"FLOAT\")},\r\n      {name: \"Color\", callback: () => callback(\"COLOR\")},\r\n      {name: \"Subfolder\", callback: () => callback(\"SUBFOLDER\")},\r\n      {name: \"Font\", callback: () => callback(\"FONT\")},\r\n      {name: \"String\", callback: () => callback(\"STRING\")},\r\n    ]);\r\n\r\n    let row = panel.row();\r\n    let col1 = row.col();\r\n    let col2 = row.col();\r\n\r\n    let do_onchange = (key, k, obj) => {\r\n      flagThemeUpdate();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(key, k, obj);\r\n      }\r\n\r\n      this.ctx.screen.completeSetCSS();\r\n      this.ctx.screen.completeUpdate();\r\n    };\r\n\r\n    let getpath = (path) => {\r\n      let obj = theme;\r\n\r\n      for (let i = 0; i < path.length; i++) {\r\n        obj = obj[path[i]];\r\n      }\r\n\r\n      return obj;\r\n    }\r\n\r\n    let ok = false;\r\n    let _i = 0;\r\n\r\n    let dokey = (k, v, path) => {\r\n      let col = _i%2 === 0 ? col1 : col2;\r\n\r\n      if (k.toLowerCase().search(\"flag\") >= 0) {\r\n        return; //don't do flags\r\n      }\r\n\r\n      if (typeof v === \"string\") {\r\n        let v2 = v.toLowerCase().trim();\r\n\r\n        let iscolor = validateCSSColor(v2);\r\n\r\n        if (iscolor) {\r\n          let cw = col.colorbutton();\r\n          ok = true;\r\n          _i++;\r\n\r\n          let color = css2color(v2);\r\n          if (color.length < 3) {\r\n            color = [color[0], color[1], color[2], 1.0];\r\n          }\r\n\r\n          try {\r\n            cw.setRGBA(color);\r\n          } catch (error) {\r\n            console.warn(\"Failed to set color \" + k, v2);\r\n          }\r\n\r\n          cw.onchange = () => {\r\n            console.log(\"setting '\" + k + \"' to \" + color2css(cw.rgba), key);\r\n            getpath(path)[k] = color2css(cw.rgba);\r\n\r\n            do_onchange(key, k);\r\n          }\r\n          cw.label = k;\r\n        } else {\r\n          col.label(k);\r\n\r\n          let box = col.textbox();\r\n          box.onchange = () => {\r\n            getpath(path)[k] = box.text;\r\n            do_onchange(key, k);\r\n          }\r\n          box.text = v;\r\n        }\r\n      } else if (typeof v === \"number\") {\r\n        let slider = col.slider(undefined, k, v, 0, 256, 0.01, false);\r\n\r\n        slider.baseUnit = slider.displayUnit = \"none\";\r\n\r\n        ok = true;\r\n        _i++;\r\n\r\n        slider.onchange = () => {\r\n          getpath(path)[k] = slider.value;\r\n\r\n          do_onchange(key, k);\r\n        }\r\n      } else if (typeof v === \"boolean\") {\r\n        let check = col.check(undefined, k);\r\n\r\n        check.value = getpath(path)[k];\r\n\r\n        check.onchange = () => {\r\n          getpath(path)[k] = !!check.value;\r\n          do_onchange(key, k);\r\n        }\r\n      } else if (typeof v === \"object\" && v instanceof CSSFont) {\r\n        let panel2 = col.panel(k);\r\n        ok = true;\r\n        _i++;\r\n\r\n        let textbox = (key) => {\r\n          panel2.label(key);\r\n          let tbox = panel2.textbox(undefined, v[key]);\r\n\r\n          tbox.width = tbox.getDefault(\"width\");\r\n\r\n          tbox.onchange = function () {\r\n            v[key] = this.text;\r\n            do_onchange(key, k);\r\n          }\r\n        }\r\n\r\n        textbox(\"font\");\r\n        textbox(\"variant\");\r\n        textbox(\"weight\");\r\n        textbox(\"style\");\r\n\r\n        let cw = panel2.colorbutton();\r\n        cw.label = \"color\";\r\n        cw.setRGBA(css2color(v.color));\r\n        cw.onchange = () => {\r\n          v.color = color2css(cw.rgba);\r\n          do_onchange(key, k);\r\n        }\r\n\r\n        let slider = panel2.slider(undefined, \"size\", v.size);\r\n        slider.onchange = () => {\r\n          v.size = slider.value;\r\n          do_onchange(key, k);\r\n        }\r\n        slider.setAttribute(\"min\", 1);\r\n        slider.setAttribute(\"max\", 100);\r\n\r\n        slider.baseUnit = slider.displayUnit = \"none\";\r\n\r\n        panel2.closed = true;\r\n      } else if (typeof v === \"object\") {\r\n        /*\r\n          let old = {\r\n            panel, row, col1, col2\r\n          };\r\n\r\n          let path2 = path.slice(0, path.length);\r\n          path2.push(k);\r\n\r\n          panel = panel.panel(k);\r\n          row = panel.row();\r\n          col1 = row.col();\r\n          col2 = row.col();\r\n          for (let k2 in v) {\r\n            let v2 = v[k2];\r\n\r\n            dokey(k2, v2, path2);\r\n          }\r\n\r\n          panel = old.panel;\r\n          row = old.row;\r\n          col1 = old.col1;\r\n          col2 = old.col2;\r\n        */\r\n\r\n        let catkey2 = Object.assign({}, catkey);\r\n        catkey2.key = k;\r\n\r\n        let path2 = path.concat(k);\r\n\r\n        this.doFolder(catkey2, v, panel, undefined, path2);\r\n      }\r\n    };\r\n\r\n    for (let k in obj) {\r\n      let v = obj[k];\r\n\r\n      dokey(k, v, path);\r\n    }\r\n\r\n    if (!ok) {\r\n      panel.remove();\r\n    } else {\r\n      panel.closed = true;\r\n    }\r\n\r\n  }\r\n\r\n  build() {\r\n    let uidata = saveUIData(this, \"theme\");\r\n\r\n    this.clear();\r\n\r\n    let categories = {};\r\n\r\n    for (let k of Object.keys(theme)) {\r\n      let catkey;\r\n\r\n      if (k in this.categoryMap) {\r\n        let cat = this.categoryMap[k];\r\n\r\n        if (typeof cat === \"string\") {\r\n          cat = {\r\n            category: cat,\r\n            help    : \"\",\r\n            key     : k\r\n          }\r\n        }\r\n\r\n        catkey = cat;\r\n      } else {\r\n        catkey = {category: k, help: '', key: k};\r\n      }\r\n\r\n      if (!catkey.key) {\r\n        catkey.key = k;\r\n      }\r\n\r\n      if (!(catkey.category in categories)) {\r\n        categories[catkey.category] = [];\r\n      }\r\n\r\n      categories[catkey.category].push(catkey);\r\n    }\r\n\r\n    function strcmp(a, b) {\r\n      a = a.trim().toLowerCase();\r\n      b = b.trim().toLowerCase();\r\n      return a < b ? -1 : (a === b ? 0 : 1);\r\n    }\r\n\r\n    let keys = Object.keys(categories);\r\n    keys.sort(strcmp);\r\n\r\n    for (let k of keys) {\r\n      let list = categories[k];\r\n      list.sort((a, b) => strcmp(a.key, b.key));\r\n\r\n      let panel = this;\r\n\r\n      if (list.length > 1) {\r\n        panel = this.panel(k);\r\n      }\r\n\r\n      for (let cat of list) {\r\n        let k2 = cat.key;\r\n        let v = theme[k2];\r\n\r\n        if (typeof v === \"object\") {\r\n          this.doFolder(cat, v, panel);\r\n        }\r\n      }\r\n\r\n      if (list.length > 1) {\r\n        panel.closed = true;\r\n      }\r\n    }\r\n\r\n    loadUIData(this, uidata);\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      this.flushSetCSS();\r\n      this.flushUpdate();\r\n    }\r\n\r\n    if (this.ctx && this.ctx.screen) {\r\n      /* Fix panel spacing bug. */\r\n      window.setTimeout(() => {\r\n        this.ctx.screen.completeSetCSS();\r\n      }, 100);\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ThemeEditor);\r\n","import {UIBase, drawText} from \"../core/ui_base.js\";\r\nimport {ValueButtonBase} from \"./ui_widgets.js\";\r\nimport cconst from '../config/const.js';\r\nimport * as ui_base from \"../core/ui_base.js\";\r\nimport * as units from \"../core/units.js\";\r\nimport {Vector2} from \"../path-controller/util/vectormath.js\";\r\nimport {ColumnFrame} from \"../core/ui.js\";\r\nimport * as util from \"../path-controller/util/util.js\";\r\nimport {\r\n  PropTypes, isNumber, PropSubTypes, PropFlags, NumberConstraints, IntProperty\r\n} from \"../path-controller/toolsys/toolprop.js\";\r\nimport {eventWasTouch} from \"../path-controller/util/simple_events.js\";\r\nimport {KeyMap, keymap} from \"../path-controller/util/simple_events.js\";\r\nimport {color2css, css2color} from \"../core/ui_theme.js\";\r\nimport {ThemeEditor} from \"./theme_editor.js\";\r\nimport {Unit} from '../core/units.js';\r\n\r\nexport const sliderDomAttributes = new Set([\r\n  \"min\", \"max\", \"integer\", \"displayUnit\", \"baseUnit\", \"labelOnTop\",\r\n  \"radix\", \"step\", \"expRate\", \"stepIsRelative\", \"decimalPlaces\",\r\n  \"slideSpeed\"\r\n]);\r\n\r\nfunction updateSliderFromDom(dom, slider = dom) {\r\n  slider.loadNumConstraints(undefined, dom);\r\n}\r\n\r\nexport const SliderDefaults = {\r\n  stepIsRelative: false,\r\n  expRate       : 1.0 + 1.0/3.0,\r\n  radix         : 10,\r\n  decimalPlaces : 4,\r\n  baseUnit      : \"none\",\r\n  displayUnit   : \"none\",\r\n  slideSpeed    : 1.0,\r\n  step          : 0.1,\r\n}\r\n\r\nexport function NumberSliderBase(cls = UIBase, skip = new Set(), defaults = SliderDefaults) {\r\n  skip = new Set(skip);\r\n\r\n  return class NumberSliderBase extends cls {\r\n    constructor() {\r\n      super();\r\n\r\n      for (let key of NumberConstraints) {\r\n        if (skip.has(key)) {\r\n          continue;\r\n        }\r\n\r\n        if (key in defaults) {\r\n          this[key] = defaults[key];\r\n        } else {\r\n          this[key] = undefined;\r\n        }\r\n      }\r\n    }\r\n\r\n    loadNumConstraints(prop, dom) {\r\n      return super.loadNumConstraints(prop, dom, this._redraw);\r\n    }\r\n  }\r\n}\r\n\r\n//use .setAttribute(\"linear\") to disable nonlinear sliding\r\nexport class NumSlider extends NumberSliderBase(ValueButtonBase) {\r\n  constructor() {\r\n    super();\r\n\r\n    this._highlight = undefined;\r\n    this._last_label = undefined;\r\n\r\n    this.mdown = false;\r\n    this.ma = undefined;\r\n\r\n    this.mpos = new Vector2();\r\n    this.start_mpos = new Vector2();\r\n\r\n    this._last_overarrow = false;\r\n\r\n    this._name = \"\";\r\n    this._value = 0.0;\r\n    this.expRate = SliderDefaults.expRate;\r\n\r\n    this.vertical = false;\r\n    this._last_disabled = false;\r\n\r\n    this.range = [-1e17, 1e17];\r\n    this.isInt = false;\r\n    this.editAsBaseUnit = undefined;\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(val) {\r\n    this.setValue(val);\r\n  }\r\n\r\n  /** Current name label.  If set to null label will\r\n   * be pulled from the datapath api.*/\r\n  get name() {\r\n    return this.getAttribute(\"name\") || this._name;\r\n  }\r\n\r\n  /** Current name label.  If set to null label will\r\n   * be pulled from the datapath api.*/\r\n  set name(name) {\r\n    if (name === undefined || name === null) {\r\n      this.removeAttribute(\"name\");\r\n    } else {\r\n      this.setAttribute(\"name\", name);\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname          : \"numslider-x\",\r\n      style            : \"numslider\",\r\n      parentStyle      : \"button\",\r\n      havePickClipboard: true,\r\n    };\r\n  }\r\n\r\n\r\n  updateWidth(force = false) {\r\n    let dpi = UIBase.getDPI();\r\n    let wid = ~~(this.getDefault(\"width\")*dpi);\r\n\r\n    if (force || wid !== this._last_width) {\r\n      this._last_width = wid;\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (!prop) {\r\n      return;\r\n    }\r\n\r\n    let name;\r\n\r\n    if (this.hasAttribute(\"name\")) {\r\n      name = this.getAttribute(\"name\");\r\n    } else {\r\n      name = \"\" + prop.uiname;\r\n    }\r\n\r\n    //lazily load constraints, since there's so much\r\n    //accessing of DOM attributes\r\n    let updateConstraints = false;\r\n\r\n    if (name !== this._name) {\r\n      this._name = name;\r\n      this.setCSS();\r\n      updateConstraints = true;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (val !== this._value) {\r\n      updateConstraints = true;\r\n      /* Note that super.updateDataPath will update .value for us*/\r\n    }\r\n\r\n    if (updateConstraints) {\r\n      this.loadNumConstraints(prop);\r\n    }\r\n\r\n    super.updateDataPath();\r\n  }\r\n\r\n  update() {\r\n    if (!!this._last_disabled !== !!this.disabled) {\r\n      this._last_disabled = !!this.disabled;\r\n      this._redraw();\r\n      this.setCSS();\r\n    }\r\n\r\n    this.updateWidth();\r\n    super.update(); //calls this.updateDataPath\r\n\r\n    updateSliderFromDom(this);\r\n  }\r\n\r\n  clipboardCopy() {\r\n    console.log(\"Copy\", \"\" + this.value);\r\n    cconst.setClipboardData(\"value\", \"text/plain\", \"\" + this.value);\r\n  }\r\n\r\n  clipboardPaste() {\r\n    let data = cconst.getClipboardData(\"text/plain\");\r\n    console.log(\"Paste\", data);\r\n\r\n    if (typeof data == \"object\") {\r\n      data = data.data;\r\n    }\r\n\r\n    let displayUnit = this.editAsBaseUnit ? undefined : this.displayUnit;\r\n    let val = units.parseValue(data, this.baseUnit, displayUnit);\r\n\r\n    if (typeof val === \"number\" && !isNaN(val)) {\r\n      this.setValue(val);\r\n    }\r\n  }\r\n\r\n  swapWithTextbox() {\r\n    let tbox = UIBase.createElement(\"textbox-x\");\r\n\r\n    if (this.modalRunning) {\r\n      this.popModal();\r\n    }\r\n\r\n    this.mdown = false;\r\n    this._pressed = false;\r\n\r\n    tbox.ctx = this.ctx;\r\n    tbox._init();\r\n\r\n    tbox.decimalPlaces = this.decimalPlaces;\r\n    tbox.isInt = this.isInt;\r\n    tbox.editAsBaseUnit = this.editAsBaseUnit;\r\n\r\n    if (this.isInt && this.radix != 10) {\r\n      let text = this.value.toString(this.radix);\r\n      if (this.radix === 2)\r\n        text = \"0b\" + text;\r\n      else if (this.radix === 16)\r\n        text += \"h\";\r\n\r\n      tbox.text = text;\r\n    } else {\r\n      tbox.text = units.buildString(this.value, this.baseUnit, this.decimalPlaces, this.displayUnit);\r\n    }\r\n\r\n    this.parentNode.insertBefore(tbox, this);\r\n    //this.remove();\r\n    this.hidden = true;\r\n    //this.dom.hidden = true;\r\n\r\n    let finish = (ok) => {\r\n      tbox.remove();\r\n      this.hidden = false;\r\n\r\n      if (ok) {\r\n        let val = tbox.text.trim();\r\n\r\n        if (this.isInt && this.radix !== 10) {\r\n          val = parseInt(val);\r\n        } else {\r\n          let displayUnit = this.editAsBaseUnit ? undefined : this.displayUnit;\r\n\r\n          val = units.parseValue(val, this.baseUnit, displayUnit);\r\n        }\r\n\r\n        if (isNaN(val)) {\r\n          console.log(\"Text input error\", val, tbox.text.trim(), this.isInt);\r\n          this.flash(ui_base.ErrorColors.ERROR);\r\n        } else {\r\n          this.setValue(val);\r\n\r\n          if (this.onchange) {\r\n            this.onchange(this);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    tbox.onend = finish;\r\n    tbox.focus();\r\n    tbox.select();\r\n\r\n    //this.shadow.appendChild(tbox);\r\n    return;\r\n  }\r\n\r\n  bindEvents() {\r\n    let dir = this.range && this.range[0] > this.range[1] ? -1 : 1;\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Left\"]:\r\n        case keymap[\"Down\"]:\r\n          this.setValue(this.value - dir*5*this.step);\r\n          break;\r\n        case keymap[\"Up\"]:\r\n        case keymap[\"Right\"]:\r\n          this.setValue(this.value + dir*5*this.step);\r\n          break;\r\n      }\r\n    });\r\n\r\n    let onmousedown = (e) => {\r\n      e.preventDefault();\r\n\r\n      if (this.disabled) {\r\n        this.mdown = false;\r\n        this._pressed = false;\r\n        e.stopPropagation();\r\n\r\n        return;\r\n      }\r\n\r\n      if (e.button) {\r\n        return;\r\n      }\r\n\r\n      this.mdown = true;\r\n      this._pressed = true;\r\n      this._redraw();\r\n\r\n      if (e.shiftKey) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        this.swapWithTextbox();\r\n      } else if (this.overArrow(e.x, e.y)) {\r\n        this._on_click(e);\r\n      } else {\r\n        this.dragStart(e);\r\n        e.stopPropagation();\r\n      }\r\n    }\r\n\r\n    this._on_click = (e) => {\r\n      this.setMpos(e);\r\n\r\n      if (this.disabled) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        return;\r\n      }\r\n\r\n      let step;\r\n\r\n      if (step = this.overArrow(e.x, e.y)) {\r\n        if (e.shiftKey) {\r\n          step *= 0.1;\r\n        }\r\n\r\n        this.setValue(this.value + step);\r\n      }\r\n    }\r\n\r\n    this.addEventListener(\"pointermove\", (e) => {\r\n      this.setMpos(e);\r\n\r\n      if (this.mdown && !this._modaldata && this.mpos.vectorDistance(this.start_mpos) > 13) {\r\n        this.dragStart(e);\r\n      }\r\n    });\r\n\r\n    this.addEventListener(\"dblclick\", (e) => {\r\n      this.setMpos(e);\r\n\r\n      this.mdown = false;\r\n      this._pressed = false;\r\n\r\n      if (this.disabled || this.overArrow(e.x, e.y)) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        return;\r\n      }\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n\r\n      this.swapWithTextbox();\r\n    });\r\n\r\n    this.addEventListener(\"pointerdown\", (e) => {\r\n      this.setMpos(e);\r\n\r\n      if (this.disabled) return;\r\n      onmousedown(e);\r\n    }, {capture: true});\r\n\r\n    this.addEventListener(\"pointerup\", (e) => {\r\n      this.mdown = false;\r\n      this._pressed = false;\r\n      this._redraw();\r\n    })\r\n    /*\r\n    this.addEventListener(\"touchstart\", (e) => {\r\n      if (this.disabled) return;\r\n\r\n      e.x = e.touches[0].screenX;\r\n      e.y = e.touches[0].screenY;\r\n\r\n      this.dragStart(e);\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }, {passive : false});\r\n    //*/\r\n\r\n    //this.addEventListener(\"pointerup\", (e) => {\r\n    //  return onmouseup(e);\r\n    //});\r\n\r\n    this.addEventListener(\"pointerover\", (e) => {\r\n      this.setMpos(e);\r\n      if (this.disabled) return;\r\n\r\n      if (!this._highlight) {\r\n        this._highlight = true;\r\n        this._repos_canvas();\r\n        this._redraw();\r\n      }\r\n    })\r\n\r\n    this.addEventListener(\"blur\", (e) => {\r\n      this._highlight = false;\r\n      this.mdown = false;\r\n    });\r\n\r\n    this.addEventListener(\"pointerout\", (e) => {\r\n      this.setMpos(e);\r\n      if (this.disabled) return;\r\n\r\n      this._highlight = false;\r\n\r\n      this.dom._background = this.getDefault(\"background-color\");\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    })\r\n  }\r\n\r\n  overArrow(x, y) {\r\n    let r = this.getBoundingClientRect();\r\n    let rwidth, rx;\r\n\r\n    if (this.vertical) {\r\n      rwidth = r.height;\r\n      rx = r.y;\r\n      x = y;\r\n    } else {\r\n      rwidth = r.width;\r\n      rx = r.x;\r\n    }\r\n\r\n    x -= rx;\r\n    let sz = this._getArrowSize();\r\n\r\n    let szmargin = sz + cconst.numSliderArrowLimit;\r\n\r\n    let step = this.step || 0.01;\r\n\r\n    if (this.isInt) {\r\n      step = Math.max(step, 1);\r\n    }\r\n\r\n    if (isNaN(step)) {\r\n      console.error(\"NaN step size\", \"step:\", this.step, \"numslider:\", this._id);\r\n      this.flash(\"red\");\r\n      step = this.isInt ? 1 : 0.1;\r\n    }\r\n\r\n    if (x < szmargin) {\r\n      return -step;\r\n    } else if (x > rwidth - szmargin) {\r\n      return step;\r\n    }\r\n\r\n    return 0;\r\n  }\r\n\r\n  doRange() {\r\n    console.warn(\"Deprecated: NumSlider.prototype.doRange, use loadNumConstraints instead!\");\r\n    this.loadNumConstraints();\r\n  }\r\n\r\n  setValue(value, fire_onchange = true, setDataPath = true, checkConstraints = true) {\r\n    value = Math.min(Math.max(value, this.range[0]), this.range[1]);\r\n\r\n    this._value = value;\r\n\r\n    if (this.hasAttribute(\"integer\")) {\r\n      this.isInt = true;\r\n    }\r\n\r\n    if (this.isInt) {\r\n      this._value = Math.floor(this._value);\r\n    }\r\n\r\n    if (checkConstraints) {\r\n      this.loadNumConstraints();\r\n    }\r\n\r\n    if (setDataPath && this.ctx && this.hasAttribute(\"datapath\")) {\r\n      this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this._value);\r\n    }\r\n\r\n    if (fire_onchange && this.onchange) {\r\n      this.onchange(this.value);\r\n    }\r\n\r\n    this._redraw();\r\n  }\r\n\r\n  setMpos(e) {\r\n    this.mpos[0] = e.x;\r\n    this.mpos[1] = e.y;\r\n\r\n    if (!this.mdown) {\r\n      this.start_mpos[0] = e.x;\r\n      this.start_mpos[1] = e.y;\r\n    }\r\n\r\n    let over = this.overArrow(e.x, e.y);\r\n\r\n    if (over !== this._last_overarrow) {\r\n      this._last_overarrow = over;\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  dragStart(e) {\r\n    this.mdown = false;\r\n    this._pressed = true;\r\n\r\n    if (this.disabled) return;\r\n\r\n    if (this.modalRunning) {\r\n      console.log(\"modal already running for numslider\", this);\r\n      return;\r\n    }\r\n\r\n    this.last_time = util.time_ms();\r\n\r\n    let last_background = this.dom._background;\r\n    let cancel;\r\n\r\n    this.ma = new util.MovingAvg(eventWasTouch(e) ? 8 : 2);\r\n\r\n    let startvalue = this.value;\r\n    let value = startvalue;\r\n\r\n    let startx = this.vertical ? e.y : e.x, starty = this.vertical ? e.x : e.y;\r\n    let sumdelta = 0;\r\n\r\n    this.dom._background = this.getDefault(\"BoxDepressed\");\r\n    let fire = () => {\r\n      if (this.onchange) {\r\n        this.onchange(this);\r\n      }\r\n    }\r\n\r\n    let handlers = {\r\n      on_keydown: (e) => {\r\n        switch (e.keyCode) {\r\n          case 27: //escape key\r\n            cancel(true);\r\n          case 13: //enter key\r\n            cancel(false);\r\n            break;\r\n        }\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      },\r\n\r\n      on_pointermove: (e) => {\r\n        if (this.disabled) return;\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        let x = this.ma.add(this.vertical ? e.y : e.x);\r\n        let dx = x - startx;\r\n        startx = x;\r\n\r\n        if (util.time_ms() - this.last_time < 35) {\r\n          return;\r\n        }\r\n        this.last_time = util.time_ms();\r\n\r\n        if (e.shiftKey) {\r\n          dx *= 0.1;\r\n        }\r\n\r\n        dx *= this.vertical ? -1 : 1;\r\n\r\n        sumdelta += Math.abs(dx);\r\n\r\n        value += dx*this.step*0.1*this.slideSpeed;\r\n\r\n        let dvalue = value - startvalue;\r\n        let dsign = Math.sign(dvalue);\r\n\r\n        let expRate = this.expRate;\r\n\r\n        //if (eventWasTouch(e)) {\r\n        //  expRate = (1 + expRate)*0.5;\r\n        //}\r\n\r\n        if (!this.hasAttribute(\"linear\")) {\r\n          dvalue = Math.pow(Math.abs(dvalue), expRate)*dsign;\r\n        }\r\n\r\n        this.value = startvalue + dvalue;\r\n\r\n        /*\r\n        if (e.shiftKey) {\r\n          dx *= 0.1;\r\n          this.value = startvalue2 + dx*0.1*this.step*this.slideSpeed;\r\n          startvalue3 = this.value;\r\n        } else {\r\n          startvalue2 = this.value;\r\n          this.value = startvalue3 + dx*0.1*this.step*this.slideSpeed;\r\n        }*/\r\n\r\n        this.updateWidth();\r\n        this._redraw();\r\n        fire();\r\n      },\r\n\r\n      on_pointerup: (e) => {\r\n        this.setMpos(e);\r\n\r\n        this.undoBreakPoint();\r\n        cancel(false);\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      },\r\n\r\n      on_pointerout: (e) => {\r\n        last_background = this.getDefault(\"background-color\");\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      },\r\n\r\n      on_pointerover: (e) => {\r\n        last_background = this.getDefault(\"BoxHighlight\");\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      },\r\n\r\n      on_pointerdown: (e) => {\r\n        this.popModal();\r\n      },\r\n    };\r\n\r\n    //events.pushModal(this.getScreen(), handlers);\r\n    this.pushModal(handlers);\r\n\r\n    cancel = (restore_value) => {\r\n      this._pressed = false;\r\n\r\n      if (restore_value) {\r\n        this.value = startvalue;\r\n        this.updateWidth();\r\n        fire();\r\n      }\r\n\r\n      this.dom._background = last_background; //ui_base.getDefault(\"background-color\");\r\n      this._redraw();\r\n\r\n      this.popModal();\r\n    }\r\n  }\r\n\r\n  get _pressed() {\r\n    return this.__pressed;\r\n  }\r\n\r\n  set _pressed(v) {\r\n    /* Try to improve usability on pen/touch displays\r\n     * by forcing pressed state to last at least 100ms.\r\n     */\r\n    if (!v) {\r\n      window.setTimeout(() => {\r\n        let redraw = this.__pressed;\r\n\r\n        this.__pressed = false;\r\n        if (redraw) {\r\n          this._redraw();\r\n        }\r\n      }, 100);\r\n    } else {\r\n      this.__pressed = v;\r\n    }\r\n  }\r\n\r\n  setCSS(unused_setBG, fromRedraw) {\r\n    /* Do not call parent class implementation. */\r\n\r\n    let dpi = this.getDPI();\r\n    let ts = this.getDefault(\"DefaultText\").size*UIBase.getDPI();\r\n    let label = this._genLabel();\r\n\r\n    let tw = ui_base.measureText(this, label, {\r\n      size: ts,\r\n      font: this.getDefault(\"DefaultText\")\r\n    }).width/dpi;\r\n\r\n    /* Enforce a minimum size based on final text. */\r\n    tw = Math.max(tw + this._getArrowSize()*1, this.getDefault(\"width\"));\r\n\r\n    tw += ts;\r\n    tw = ~~tw;\r\n\r\n    let w, h;\r\n\r\n    if (this.vertical) {\r\n      w = this.getDefault(\"height\");\r\n      h = tw;\r\n    } else {\r\n      h = this.getDefault(\"height\");\r\n      w = tw;\r\n    }\r\n\r\n    w = ~~(w*dpi);\r\n    h = ~~(h*dpi);\r\n\r\n    this.style[\"width\"] = this.dom.style[\"width\"] = (w/dpi) + \"px\";\r\n    this.style[\"height\"] = this.dom.style[\"height\"] = (h/dpi) + \"px\";\r\n    this.dom.width = w;\r\n    this.dom.height = h;\r\n\r\n    if (!fromRedraw) {\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _repos_canvas() {\r\n    //super._repos_canvas();\r\n  }\r\n\r\n  updateDefaultSize() {\r\n    /* Do nothing, don't invoke parent class method. */\r\n  }\r\n\r\n  updateName(force) {\r\n    if (!this.hasAttribute(\"name\")) {\r\n      return;\r\n    }\r\n\r\n    let name = this.getAttribute(\"name\");\r\n\r\n    if (force || name !== this._name) {\r\n      this._name = name;\r\n      this.setCSS();\r\n    }\r\n\r\n    let label = this._genLabel();\r\n    if (label !== this._last_label) {\r\n      this._last_label = label;\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  _genLabel() {\r\n    let val = this.value;\r\n    let text;\r\n\r\n    if (val === undefined) {\r\n      text = \"error\";\r\n    } else {\r\n      val = val === undefined ? 0.0 : val;\r\n\r\n      if (this.isInt) {\r\n        val = Math.floor(val);\r\n      }\r\n\r\n      val = units.buildString(val, this.baseUnit, this.decimalPlaces, this.displayUnit);\r\n\r\n      text = val;\r\n      if (this._name) {\r\n        text = this._name + \": \" + text;\r\n      } else if (this.hasAttribute(\"name\")) {\r\n        text = \"\" + this.getAttribute(\"name\") + \": \" + text;\r\n      }\r\n    }\r\n\r\n    return text;\r\n  }\r\n\r\n  _redraw(fromCSS) {\r\n    if (!fromCSS) {\r\n      this.setCSS(undefined, true);\r\n    }\r\n\r\n    let g = this.g;\r\n    let canvas = this.dom;\r\n\r\n    let dpi = this.getDPI();\r\n    let disabled = this.disabled;\r\n\r\n    /* Fallback on BoxHighlight for backwards compatibility with\r\n     * old themes. */\r\n\r\n    let over = !this._modaldata && this.overArrow(this.mpos[0], this.mpos[1]);\r\n\r\n    let subkey = undefined;\r\n    let pressed = this._pressed && !over;\r\n\r\n    if (this._highlight && pressed) {\r\n      subkey = \"highlight-pressed\";\r\n    } else if (this._highlight) {\r\n      subkey = \"highlight\";\r\n    } else if (pressed) {\r\n      subkey = \"pressed\";\r\n    }\r\n\r\n    let getDefault = (key, backupval = undefined, subkey2 = subkey) => {\r\n      /* Have highlight-pressed fall back to pressed. */\r\n      if (subkey2 === \"highlight-pressed\" && !this.hasClassSubDefault(subkey2, key, false)) {\r\n        return this.getSubDefault(\"pressed\", key, undefined, backupval);\r\n      }\r\n\r\n      if (!subkey2) {\r\n        return this.getDefault(key, undefined, backupval);\r\n      } else {\r\n        return this.getSubDefault(subkey2, key, undefined, backupval);\r\n      }\r\n    }\r\n\r\n    let r = getDefault(\"border-radius\");\r\n    if (this.isInt) {\r\n      r *= 0.25;\r\n    }\r\n\r\n    let boxbg = getDefault(\"background-color\");\r\n\r\n    ui_base.drawRoundBox(this, this.dom, this.g, undefined, undefined,\r\n      r, \"fill\", disabled ? getDefault(\"DisabledBG\") : boxbg);\r\n    ui_base.drawRoundBox(this, this.dom, this.g, undefined, undefined,\r\n      r, \"stroke\", disabled ? getDefault(\"DisabledBG\") : getDefault(\"border-color\"));\r\n\r\n    let ts = getDefault(\"DefaultText\").size;\r\n    let text = this._genLabel();\r\n\r\n    let cx = ts + this._getArrowSize();\r\n    let cy = this.dom.height/2;\r\n\r\n    this.dom.font = undefined;\r\n\r\n    g.save();\r\n\r\n    let th = Math.PI*0.5;\r\n\r\n    if (this.vertical) {\r\n      g.rotate(th);\r\n\r\n      ui_base.drawText(this, cx, -ts*0.5, text, {\r\n        canvas: this.dom,\r\n        g     : this.g,\r\n        size  : ts,\r\n        font  : getDefault(\"DefaultText\"),\r\n      });\r\n      g.restore();\r\n    } else {\r\n      ui_base.drawText(this, cx, cy + ts/2, text, {\r\n        canvas: this.dom,\r\n        g     : this.g,\r\n        size  : ts,\r\n        font  : getDefault(\"DefaultText\"),\r\n      });\r\n    }\r\n\r\n    let parseArrowColor = (arrowcolor) => {\r\n      arrowcolor = arrowcolor.trim();\r\n      if (arrowcolor.endsWith(\"%\")) {\r\n        arrowcolor = arrowcolor.slice(0, arrowcolor.length - 1).trim();\r\n\r\n        let perc = parseFloat(arrowcolor)/100.0;\r\n        let c = css2color(this.getDefault(\"background-color\"));\r\n\r\n        let f = (c[0] + c[1] + c[2])*perc;\r\n\r\n        f = ~~(f*255);\r\n        arrowcolor = `rgba(${f},${f},${f},0.95)`;\r\n\r\n      }\r\n      return arrowcolor;\r\n    }\r\n\r\n    let arrowcolor_base;\r\n    let arrowcolor;\r\n\r\n    arrowcolor_base = this.getDefault(\"arrow-color\");\r\n    arrowcolor_base = parseArrowColor(arrowcolor_base);\r\n\r\n    if (this._pressed && this._highlight) {\r\n      arrowcolor = this.getSubDefault(\"highlight-pressed\", \"arrow-color\", null, undefined, false);\r\n\r\n      if (!arrowcolor) {\r\n        arrowcolor = this.getSubDefault(\"pressed\", \"arrow-color\");\r\n      }\r\n\r\n      if (!arrowcolor) {\r\n        arrowcolor = \"33%\";\r\n      }\r\n    } else if (this._pressed) {\r\n      arrowcolor = this.getSubDefault(\"pressed\", \"arrow-color\", \"arrow-color\", \"33%\");\r\n    } else if (this._highlight) {\r\n      if (!this.hasClassSubDefault(\"highlight\", \"arrow-color\", false)) {\r\n        if (this.hasClassSubDefault(\"highlight\", \"background-color\", false)) {\r\n          arrowcolor = this.getSubDefault(\"highlight\", \"background-color\");\r\n        } else {\r\n          arrowcolor = this.getDefault(\"BoxHighlight\");\r\n        }\r\n\r\n        arrowcolor = css2color(arrowcolor);\r\n        let base = this.getSubDefault(\"pressed\", \"arrow-color\", undefined, \"33%\");\r\n        base = css2color(base);\r\n\r\n        arrowcolor.interp(base, 0.25);\r\n        arrowcolor = color2css(arrowcolor);\r\n      } else {\r\n        arrowcolor = this.getSubDefault(\"highlight\", \"arrow-color\");\r\n      }\r\n    } else {\r\n      arrowcolor = getDefault(\"arrow-color\", \"33%\");\r\n    }\r\n\r\n    if (this._pressed) {\r\n//      arrowcolor = this.getSubDefault(\"pressed\", \"arrow-color\");\r\n    }\r\n\r\n    arrowcolor = parseArrowColor(arrowcolor);\r\n\r\n\r\n    let d = 7, w = canvas.width, h = canvas.height;\r\n    let sz = this._getArrowSize();\r\n\r\n    if (this.vertical) {\r\n      g.beginPath();\r\n      g.moveTo(w*0.5, d);\r\n      g.lineTo(w*0.5 + sz*0.5, d + sz);\r\n      g.lineTo(w*0.5 - sz*0.5, d + sz);\r\n\r\n      g.fillStyle = over < 0 ? arrowcolor : arrowcolor_base;\r\n      g.fill();\r\n\r\n      g.beginPath();\r\n      g.moveTo(w*0.5, h - d);\r\n      g.lineTo(w*0.5 + sz*0.5, h - sz - d);\r\n      g.lineTo(w*0.5 - sz*0.5, h - sz - d);\r\n\r\n      g.fillStyle = over > 0 ? arrowcolor : arrowcolor_base;\r\n      g.fill();\r\n    } else {\r\n      g.beginPath();\r\n      g.moveTo(d, h*0.5);\r\n      g.lineTo(d + sz, h*0.5 + sz*0.5);\r\n      g.lineTo(d + sz, h*0.5 - sz*0.5);\r\n\r\n      g.fillStyle = over < 0 ? arrowcolor : arrowcolor_base;\r\n      g.fill();\r\n\r\n      g.beginPath();\r\n      g.moveTo(w - d, h*0.5);\r\n      g.lineTo(w - sz - d, h*0.5 + sz*0.5);\r\n      g.lineTo(w - sz - d, h*0.5 - sz*0.5);\r\n\r\n      g.fillStyle = over > 0 ? arrowcolor : arrowcolor_base;\r\n      g.fill();\r\n    }\r\n\r\n    g.fill();\r\n  }\r\n\r\n  _getArrowSize() {\r\n    return UIBase.getDPI()*10;\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(NumSlider);\r\n\r\n\r\nexport class NumSliderSimpleBase extends NumberSliderBase(UIBase) {\r\n  constructor() {\r\n    super();\r\n\r\n    this.baseUnit = undefined;\r\n    this.displayUnit = undefined;\r\n    this.editAsBaseUnit = undefined;\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.g = this.canvas.getContext(\"2d\");\r\n\r\n    this.canvas.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.highlight = false;\r\n    this.isInt = false;\r\n\r\n    this.shadow.appendChild(this.canvas);\r\n    this.range = [0, 1];\r\n\r\n    /** if not undefined defines subrange of visible slider */\r\n    this.uiRange = undefined;\r\n\r\n    this.step = 0.1;\r\n    this._value = 0.5;\r\n    this.ma = undefined;\r\n    this._focus = false;\r\n\r\n    this.modal = undefined;\r\n\r\n    this._last_slider_key = '';\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(val) {\r\n    this.setValue(val);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname    : \"numslider-simple-base-x\",\r\n      style      : \"numslider_simple\",\r\n      parentStyle: \"button\"\r\n    }\r\n  }\r\n\r\n  setValue(val, fire_onchange = true, setDataPath = true) {\r\n    val = Math.min(Math.max(val, this.range[0]), this.range[1]);\r\n\r\n    if (this.isInt) {\r\n      val = Math.floor(val);\r\n    }\r\n\r\n    if (this._value !== val) {\r\n      this._value = val;\r\n      this._redraw();\r\n\r\n      if (this.onchange && fire_onchange) {\r\n        this.onchange(val);\r\n      }\r\n\r\n      if (setDataPath && this.getAttribute(\"datapath\")) {\r\n        let path = this.getAttribute(\"datapath\");\r\n        this.setPathValue(this.ctx, path, this._value);\r\n      }\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n\r\n    if (!path || path === \"null\" || path === \"undefined\") {\r\n      return;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, path);\r\n\r\n    if (this.isInt) {\r\n      val = Math.floor(val);\r\n    }\r\n\r\n    if (val !== this._value) {\r\n      let prop = this.getPathMeta(this.ctx, path);\r\n      if (!prop) {\r\n        return;\r\n      }\r\n\r\n      this.loadNumConstraints(prop);\r\n      this.setValue(val, true, false);\r\n    }\r\n  }\r\n\r\n  _setFromMouse(e) {\r\n    let rect = this.getClientRects()[0];\r\n    if (rect === undefined) {\r\n      return;\r\n    }\r\n\r\n    let x = e.x - rect.left;\r\n    let dpi = UIBase.getDPI();\r\n    let co = this._getButtonPos();\r\n\r\n    let val = this._invertButtonX(x*dpi);\r\n    this.value = val;\r\n  }\r\n\r\n  _startModal(e) {\r\n    if (this.disabled) {\r\n      return;\r\n    }\r\n\r\n    if (e !== undefined) {\r\n      this._setFromMouse(e);\r\n    }\r\n    let dom = window;\r\n    let evtargs = {capture: false};\r\n\r\n    if (this.modal) {\r\n      console.warn(\"Double call to _startModal!\");\r\n      return;\r\n    }\r\n\r\n    this.ma = new util.MovingAvg(eventWasTouch(e) ? 4 : 2);\r\n    let handlers;\r\n\r\n    let end = () => {\r\n      if (handlers === undefined) {\r\n        return;\r\n      }\r\n\r\n      this.popModal();\r\n      handlers = undefined;\r\n    };\r\n\r\n    handlers = {\r\n      pointermove: (e) => {\r\n        let x = e.x, y = e.y;\r\n\r\n        x = this.ma.add(x);\r\n\r\n        let e2 = new MouseEvent(e, {\r\n          x, y\r\n        });\r\n        this._setFromMouse(e);\r\n      },\r\n\r\n      pointerover : (e) => {\r\n      },\r\n      pointerout  : (e) => {\r\n      },\r\n      pointerleave: (e) => {\r\n      },\r\n      pointerenter: (e) => {\r\n      },\r\n      blur        : (e) => {\r\n      },\r\n      focus       : (e) => {\r\n      },\r\n\r\n      pointerup: (e) => {\r\n        this.undoBreakPoint();\r\n        end();\r\n      },\r\n\r\n      keydown: (e) => {\r\n        switch (e.keyCode) {\r\n          case keymap[\"Enter\"]:\r\n          case keymap[\"Space\"]:\r\n          case keymap[\"Escape\"]:\r\n            end();\r\n        }\r\n      }\r\n    };\r\n\r\n    function makefunc(f) {\r\n      return (e) => {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n\r\n        return f(e);\r\n      }\r\n    }\r\n\r\n    for (let k in handlers) {\r\n      handlers[k] = makefunc(handlers[k]);\r\n    }\r\n\r\n    this.pushModal(handlers);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    if (!this.hasAttribute(\"tab-index\")) {\r\n      this.setAttribute(\"tab-index\", 0);\r\n    }\r\n\r\n    this.updateSize();\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      let dt = this.range[1] > this.range[0] ? 1 : -1;\r\n\r\n      switch (e.keyCode) {\r\n        case keymap[\"Left\"]:\r\n        case keymap[\"Right\"]:\r\n          let fac = this.step;\r\n\r\n          if (e.shiftKey) {\r\n            fac *= 0.1;\r\n          }\r\n\r\n          if (this.isInt) {\r\n            fac = Math.max(fac, 1);\r\n          }\r\n\r\n          this.value += e.keyCode === keymap[\"Left\"] ? -dt*fac : dt*fac;\r\n\r\n          break;\r\n      }\r\n    });\r\n\r\n    this.addEventListener(\"focusin\", () => {\r\n      if (this.disabled) return;\r\n\r\n      this._focus = 1;\r\n      this._redraw();\r\n      this.focus();\r\n    });\r\n\r\n    this.addEventListener(\"pointerdown\", (e) => {\r\n      if (this.disabled) {\r\n        return;\r\n      }\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n      this._startModal(e);\r\n    });\r\n\r\n    this.addEventListener(\"pointerin\", (e) => {\r\n      this.setHighlight(e);\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"pointerout\", (e) => {\r\n      this.highlight = false;\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"pointerover\", (e) => {\r\n      this.setHighlight(e);\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"pointermove\", (e) => {\r\n      this.setHighlight(e);\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"pointerleave\", (e) => {\r\n      this.highlight = false;\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"blur\", (e) => {\r\n      this._focus = 0;\r\n      this.highlight = false;\r\n      this._redraw();\r\n    });\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  setHighlight(e) {\r\n    this.highlight = this.isOverButton(e) ? 2 : 1;\r\n  }\r\n\r\n  _redraw() {\r\n    let g = this.g, canvas = this.canvas;\r\n    let w = canvas.width, h = canvas.height;\r\n    let dpi = UIBase.getDPI();\r\n\r\n    let color = this.getDefault(\"background-color\");\r\n    let sh = ~~(this.getDefault(\"SlideHeight\")*dpi + 0.5);\r\n\r\n    g.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    g.fillStyle = color;\r\n\r\n    let y = (h - sh)*0.5;\r\n\r\n    let r = this.getDefault(\"border-radius\");\r\n\r\n    g.translate(0, y);\r\n    ui_base.drawRoundBox(this, this.canvas, g, w, sh, r, \"fill\", color, undefined, true);\r\n\r\n    let bcolor = this.getDefault('border-color');\r\n    ui_base.drawRoundBox(this, this.canvas, g, w, sh, r, \"stroke\", bcolor, undefined, true);\r\n    g.translate(0, -y);\r\n\r\n    if (this.highlight === 1) {\r\n      color = this.getDefault(\"BoxHighlight\");\r\n    } else {\r\n      color = this.getDefault(\"border-color\");\r\n    }\r\n\r\n    g.strokeStyle = color;\r\n    g.stroke();\r\n\r\n    let co = this._getButtonPos();\r\n\r\n    g.beginPath();\r\n\r\n    if (this.highlight === 2) {\r\n      color = this.getDefault(\"BoxHighlight\");\r\n    } else {\r\n      color = this.getDefault(\"border-color\");\r\n    }\r\n\r\n    g.arc(co[0], co[1], Math.abs(co[2]), -Math.PI, Math.PI);\r\n    g.fill();\r\n\r\n    g.strokeStyle = color;\r\n    g.stroke();\r\n\r\n    g.beginPath();\r\n    g.setLineDash([4, 4]);\r\n\r\n    if (this._focus) {\r\n      g.strokeStyle = this.getDefault(\"BoxHighlight\");\r\n      g.arc(co[0], co[1], co[2] - 4, -Math.PI, Math.PI);\r\n      g.stroke();\r\n    }\r\n\r\n    g.setLineDash([]);\r\n  }\r\n\r\n  isOverButton(e) {\r\n    let x = e.x, y = e.y;\r\n    let rect = this.getClientRects()[0];\r\n\r\n    if (!rect) {\r\n      return false;\r\n    }\r\n\r\n    x -= rect.left;\r\n    y -= rect.top;\r\n\r\n    let co = this._getButtonPos();\r\n\r\n    let dpi = UIBase.getDPI();\r\n    let dv = new Vector2([co[0]/dpi - x, co[1]/dpi - y]);\r\n    let dis = dv.vectorLength();\r\n\r\n    return dis < co[2]/dpi;\r\n  }\r\n\r\n  _invertButtonX(x) {\r\n    let w = this.canvas.width;\r\n    let dpi = UIBase.getDPI();\r\n    let sh = ~~(this.getDefault(\"SlideHeight\")*dpi + 0.5);\r\n    let boxw = this.canvas.height - 4;\r\n    let w2 = w - boxw;\r\n\r\n    let range = this.uiRange || this.range;\r\n\r\n    x = (x - boxw*0.5)/w2;\r\n    x = x*(range[1] - range[0]) + range[0];\r\n\r\n    return x;\r\n  }\r\n\r\n  _getButtonPos() {\r\n    let w = this.canvas.width;\r\n    let dpi = UIBase.getDPI();\r\n    let sh = ~~(this.getDefault(\"SlideHeight\")*dpi + 0.5);\r\n    let x = this._value;\r\n\r\n    let range = this.uiRange || this.range;\r\n\r\n    x = (x - range[0])/(range[1] - range[0]);\r\n\r\n    let boxw = this.canvas.height - 4;\r\n    let w2 = w - boxw;\r\n\r\n    x = x*w2 + boxw*0.5;\r\n\r\n    return [x, boxw*0.5, boxw*0.5];\r\n  }\r\n\r\n  setCSS() {\r\n    //UIBase.setCSS does annoying things with background-color\r\n    //super.setCSS();\r\n\r\n    const dpi = UIBase.getDPI();\r\n    this.style[\"min-width\"] = this.getDefault(\"width\") + \"px\";\r\n    this.style[\"width\"] = this.getDefault(\"width\") + \"px\";\r\n\r\n    this.canvas.style[\"width\"] = \"\" + (this.canvas.width/dpi) + \"px\";\r\n    this.canvas.style[\"height\"] = \"\" + (this.canvas.height/dpi) + \"px`\";\r\n\r\n    this.canvas.height = this.getDefault(\"height\")*UIBase.getDPI();\r\n\r\n    this._redraw();\r\n  }\r\n\r\n  updateSize() {\r\n    if (this.canvas === undefined) {\r\n      return;\r\n    }\r\n\r\n    let rect = this.getClientRects()[0];\r\n\r\n    if (rect === undefined) {\r\n      return;\r\n    }\r\n\r\n    let dpi = UIBase.getDPI();\r\n    let canvas = this.canvas;\r\n    let w = ~~(rect.width*dpi), h = ~~(rect.height*dpi);\r\n\r\n    if (w !== canvas.width || h !== canvas.height) {\r\n      this.canvas.width = w;\r\n      this.canvas.height = h;\r\n\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _ondestroy() {\r\n    if (this.modalRunning) {\r\n      this.popModal();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    /*\r\n    if (this.checkThemeUpdate()) {\r\n      this._redraw();\r\n    }\r\n    */\r\n\r\n    let key = \"\" + this.getDefault(\"width\") + \":\" + this.getDefault(\"height\") + \":\" + this.getDefault(\"SlideHeight\");\r\n\r\n    if (key !== this._last_slider_key) {\r\n      this._last_slider_key = key;\r\n\r\n      this.flushUpdate();\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n\r\n    if (this.getAttribute(\"tab-index\") !== this.tabIndex) {\r\n      this.tabIndex = this.getAttribute(\"tab-index\");\r\n    }\r\n\r\n    this.updateSize();\r\n    this.updateDataPath();\r\n    updateSliderFromDom(this);\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(NumSliderSimpleBase);\r\n\r\nexport class SliderWithTextbox extends ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this._value = 0;\r\n    this._name = undefined;\r\n    this._lock_textbox = false;\r\n    this._labelOnTop = undefined;\r\n\r\n    this._last_label_on_top = undefined;\r\n\r\n    this.container = this;\r\n\r\n    this.textbox = UIBase.createElement(\"textbox-x\");\r\n    this.textbox.width = 55;\r\n    this._numslider = undefined;\r\n\r\n    this.textbox.overrideDefault(\"width\", this.getDefault(\"TextBoxWidth\"));\r\n    this.textbox.setAttribute(\"class\", \"numslider_simple_textbox\");\r\n    this.textbox.startSelected = true;\r\n\r\n    this._last_value = undefined;\r\n  }\r\n\r\n  get addLabel() {\r\n    if (this.hasAttribute(\"add-label\")) {\r\n      let val = (\"\" + this.getAttribute(\"add-label\")).toLowerCase();\r\n      return val === \"true\" || val === \"yes\";\r\n    }\r\n\r\n    return this.getDefault(\"addLabel\");\r\n  }\r\n\r\n  set addLabel(v) {\r\n    this.setAttribute(\"add-label\", v ? \"true\" : \"false\");\r\n\r\n    if (this.addLabel && !this.l) {\r\n      this.doOnce(this.rebuild);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * whether to put label on top or to the left of sliders\r\n   *\r\n   * If undefined value will be either this.getAtttribute(\"labelOnTop\"),\r\n   * if \"labelOnTop\" attribute exists, or it will be this.getDefault(\"labelOnTop\")\r\n   * (theme default)\r\n   **/\r\n  get labelOnTop() {\r\n    let ret = this._labelOnTop;\r\n\r\n    if (ret === undefined && this.hasAttribute(\"labelOnTop\")) {\r\n      let val = this.getAttribute(\"labelOnTop\");\r\n      if (typeof val === \"string\") {\r\n        val = val.toLowerCase();\r\n        ret = val === \"true\" || val === \"yes\";\r\n      } else {\r\n        ret = !!val;\r\n      }\r\n    }\r\n\r\n    if (ret === undefined) {\r\n      ret = this.getDefault(\"labelOnTop\");\r\n    }\r\n\r\n    return !!ret;\r\n  }\r\n\r\n  set labelOnTop(v) {\r\n    this._labelOnTop = v;\r\n  }\r\n\r\n  get numslider() {\r\n    return this._numslider;\r\n  }\r\n\r\n  //child classes set this in their constructors\r\n  set numslider(v) {\r\n    this._numslider = v;\r\n    this.textbox.range = this._numslider.range;\r\n  }\r\n\r\n  get editAsBaseUnit() {\r\n    return this.numslider.editAsBaseUnit;\r\n  }\r\n\r\n  set editAsBaseUnit(v) {\r\n    this.numslider.editAsBaseUnit = v;\r\n  }\r\n\r\n  get range() {\r\n    return this.numslider.range;\r\n  }\r\n\r\n  set range(v) {\r\n    this.numslider.range = v;\r\n  }\r\n\r\n  get step() {\r\n    return this.numslider.step;\r\n  }\r\n\r\n  set step(v) {\r\n    this.numslider.step = v;\r\n  }\r\n\r\n  get expRate() {\r\n    return this.numslider.expRate;\r\n  }\r\n\r\n  set expRate(v) {\r\n    this.numslider.expRate = v;\r\n  }\r\n\r\n  get decimalPlaces() {\r\n    return this.numslider.decimalPlaces;\r\n  }\r\n\r\n  set decimalPlaces(v) {\r\n    this.numslider.decimalPlaces = v;\r\n  }\r\n\r\n  get isInt() {\r\n    return this.numslider.isInt;\r\n  }\r\n\r\n  set isInt(v) {\r\n    this.numslider.isInt = v;\r\n  }\r\n\r\n  get slideSpeed() {\r\n    return this.numslider.slideSpeed;\r\n  }\r\n\r\n  set slideSpeed(v) {\r\n    this.numslider.slideSpeed = v;\r\n  }\r\n\r\n  get radix() {\r\n    return this.numslider.radix;\r\n  }\r\n\r\n  set radix(v) {\r\n    this.numslider.radix = v;\r\n  }\r\n\r\n  get stepIsRelative() {\r\n    return this.numslider.stepIsRelative;\r\n  }\r\n\r\n  set stepIsRelative(v) {\r\n    this.numslider.stepIsRelative = v;\r\n  }\r\n\r\n  get displayUnit() {\r\n    return this.numslider.displayUnit;\r\n  }\r\n\r\n  set displayUnit(val) {\r\n    let update = val !== this.displayUnit;\r\n\r\n    this.numslider.displayUnit = this.textbox.displayUnit = val;\r\n\r\n    if (update) {\r\n      //this.numslider._redraw();\r\n      this.updateTextBox();\r\n    }\r\n  }\r\n\r\n  get baseUnit() {\r\n    return this.textbox.baseUnit;\r\n  }\r\n\r\n  set baseUnit(val) {\r\n    let update = val !== this.baseUnit;\r\n\r\n    this.numslider.baseUnit = this.textbox.baseUnit = val;\r\n\r\n    if (update) {\r\n      //this.slider._redraw();\r\n      this.updateTextBox();\r\n    }\r\n  }\r\n\r\n  get realTimeTextBox() {\r\n    let ret = this.getAttribute(\"realtime\");\r\n\r\n    if (!ret) {\r\n      return false;\r\n    }\r\n\r\n    ret = ret.toLowerCase().trim();\r\n\r\n    return ret === 'true' || ret === 'on' || ret === 'yes';\r\n  }\r\n\r\n  set realTimeTextBox(val) {\r\n    this.setAttribute(\"realtime\", val ? \"true\" : \"false\");\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(val) {\r\n    this.setValue(val);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.rebuild();\r\n    window.setTimeout(() => this.updateTextBox(), 500);\r\n  }\r\n\r\n  rebuild() {\r\n    this._last_label_on_top = this.labelOnTop;\r\n\r\n    this.container.clear();\r\n\r\n    if (!this.labelOnTop) {\r\n      this.container = this.row();\r\n    } else {\r\n      this.container = this;\r\n    }\r\n\r\n    if (this.hasAttribute(\"name\")) {\r\n      this._name = this.getAttribute(\"name\");\r\n    } else {\r\n      this._name = \"slider\";\r\n    }\r\n\r\n\r\n    if (this.addLabel) {\r\n      this.l = this.container.label(this._name);\r\n      this.l.overrideClass(\"numslider_textbox\");\r\n      this.l.font = \"TitleText\";\r\n      this.l.style[\"display\"] = \"float\";\r\n      this.l.style[\"position\"] = \"relative\";\r\n    }\r\n\r\n    let strip = this.container.row();\r\n    //strip.style['justify-content'] = 'space-between';\r\n    strip.add(this.numslider);\r\n\r\n    let path = this.hasAttribute(\"datapath\") ? this.getAttribute(\"datapath\") : undefined;\r\n\r\n    let textbox = this.textbox;\r\n    this.textbox.overrideDefault(\"width\", this.getDefault(\"TextBoxWidth\"));\r\n\r\n    let apply_textbox = () => {\r\n      let text = textbox.text;\r\n\r\n      if (!units.isNumber(text)) {\r\n        textbox.flash(\"red\");\r\n        return;\r\n      } else {\r\n        textbox.flash(\"green\");\r\n\r\n        let displayUnit = this.editAsBaseUnit ? undefined : this.displayUnit;\r\n\r\n        let f = units.parseValue(text, this.baseUnit, displayUnit);\r\n\r\n        if (isNaN(f)) {\r\n          this.flash(\"red\");\r\n          return;\r\n        }\r\n\r\n        if (this.isInt) {\r\n          f = Math.floor(f);\r\n        }\r\n\r\n        this._lock_textbox = 1;\r\n        this.setValue(f);\r\n        this._lock_textbox = 0;\r\n\r\n      }\r\n    };\r\n\r\n    if (this.realTimeTextBox) {\r\n      textbox.onchange = apply_textbox;\r\n    }\r\n\r\n    textbox.onend = apply_textbox;\r\n\r\n    textbox.ctx = this.ctx;\r\n    textbox.packflag |= this.inherit_packflag;\r\n    textbox.overrideDefault(\"width\", this.getDefault(\"TextBoxWidth\"));\r\n\r\n    textbox.style[\"height\"] = (this.getDefault(\"height\") - 2) + \"px\";\r\n    textbox._init();\r\n\r\n    strip.add(textbox);\r\n\r\n    textbox.setCSS();\r\n    this.linkTextBox();\r\n\r\n    let in_onchange = 0;\r\n\r\n    this.numslider.onchange = (val) => {\r\n      this._value = this.numslider.value;\r\n      this.updateTextBox();\r\n\r\n      if (in_onchange) {\r\n        return;\r\n      }\r\n\r\n      if (this.onchange !== undefined) {\r\n        in_onchange++;\r\n        try {\r\n          if (this.onchange) {\r\n            this.onchange(this);\r\n          }\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n        }\r\n      }\r\n\r\n      in_onchange--;\r\n    }\r\n  }\r\n\r\n  updateTextBox() {\r\n    if (!this._init_done) {\r\n      return;\r\n    }\r\n\r\n    if (this._lock_textbox > 0 || this.textbox.editing)\r\n      return;\r\n\r\n    this.textbox.text = this.formatNumber(this._value);\r\n    this.textbox.update();\r\n\r\n    updateSliderFromDom(this, this.numslider);\r\n  }\r\n\r\n  linkTextBox() {\r\n    this.updateTextBox();\r\n\r\n    let onchange = this.numslider.onchange;\r\n    this.numslider.onchange = (e) => {\r\n      this._value = e.value;\r\n      this.updateTextBox();\r\n\r\n      onchange(e);\r\n    }\r\n  }\r\n\r\n  setValue(val, fire_onchange = true) {\r\n    this._value = val;\r\n    this.numslider.setValue(val, fire_onchange);\r\n    this.updateTextBox();\r\n  }\r\n\r\n  updateName() {\r\n    let name = this.getAttribute(\"name\");\r\n\r\n    if (!name && this.hasAttribute(\"datapath\")) {\r\n      let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n      if (prop) {\r\n        name = prop.uiname;\r\n      }\r\n    }\r\n\r\n    if (!name) {\r\n      name = \"[error]\";\r\n    }\r\n\r\n    if (name !== this._name) {\r\n      this._name = name;\r\n      if (this.l) {\r\n        this.l.text = name;\r\n      }\r\n    }\r\n  }\r\n\r\n  updateLabelOnTop() {\r\n    if (this.labelOnTop !== this._last_label_on_top) {\r\n      this._last_label_on_top = this.labelOnTop;\r\n      this.rebuild();\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.ctx || !this.getAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"))\r\n\r\n    if (!prop) {\r\n      return;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n    if (val !== this._last_value) {\r\n      this._last_value = this._value = val;\r\n      this.updateTextBox();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    this.updateLabelOnTop();\r\n    super.update();\r\n\r\n    this.updateDataPath();\r\n    let redraw = false;\r\n\r\n    updateSliderFromDom(this, this.numslider);\r\n    updateSliderFromDom(this, this.textbox);\r\n\r\n    if (redraw) {\r\n      this.setCSS();\r\n      this.numslider.setCSS();\r\n      this.numslider._redraw();\r\n    }\r\n\r\n    this.updateName();\r\n\r\n    this.numslider.description = this.description;\r\n    this.textbox.description = this.title; //get full, transformed toolip\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.numslider.setAttribute(\"datapath\", this.getAttribute(\"datapath\"));\r\n      this.textbox.setAttribute(\"datapath\", this.getAttribute(\"datapath\"));\r\n    }\r\n\r\n    if (this.hasAttribute(\"mass_set_path\")) {\r\n      this.numslider.setAttribute(\"mass_set_path\", this.getAttribute(\"mass_set_path\"))\r\n      this.textbox.setAttribute(\"mass_set_path\", this.getAttribute(\"mass_set_path\"));\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n    this.textbox.setCSS();\r\n    //textbox.style[\"margin\"] = \"5px\";\r\n\r\n  }\r\n}\r\n\r\nexport class NumSliderSimple extends SliderWithTextbox {\r\n  constructor() {\r\n    super();\r\n\r\n    this.numslider = UIBase.createElement(\"numslider-simple-base-x\");\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"numslider-simple-x\",\r\n      style  : \"numslider_simple\"\r\n    }\r\n  }\r\n\r\n  _redraw() {\r\n    this.numslider._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(NumSliderSimple);\r\n\r\nexport class NumSliderWithTextBox extends SliderWithTextbox {\r\n  constructor() {\r\n    super();\r\n\r\n    this.numslider = UIBase.createElement(\"numslider-x\");\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"numslider-textbox-x\",\r\n      style  : \"numslider_textbox\"\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    if (this.hasAttribute(\"name\")) {\r\n      let name = this.getAttribute(\"name\");\r\n\r\n      if (name !== this.numslider.name) {\r\n        this.numslider.setAttribute(\"name\", name);\r\n        this.numslider._redraw();\r\n      }\r\n    }\r\n  }\r\n\r\n  _redraw() {\r\n    this.numslider._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(NumSliderWithTextBox);\r\n\r\n","//stores xml sources\r\nimport {isNumber} from '../path-controller/toolsys/toolprop.js';\r\n\r\nlet pagecache = new Map()\r\nimport {PackFlags, UIBase} from '../core/ui_base.js';\r\nimport {sliderDomAttributes} from '../widgets/ui_numsliders.js';\r\nimport * as util from '../util/util.js';\r\nimport {Menu} from '../widgets/ui_menu.js';\r\nimport {Icons} from '../core/ui_base.js';\r\nimport {Container} from '../core/ui.js';\r\n\r\nexport var domTransferAttrs = new Set([\"id\", \"title\", \"tab-index\"]);\r\nexport var domEventAttrs = new Set([\"click\", \"mousedown\", \"mouseup\", \"mousemove\", \"keydown\", \"keypress\"]);\r\n\r\nexport function parseXML(xml) {\r\n  let parser = new DOMParser()\r\n  xml = `<root>${xml}</root>`;\r\n  return parser.parseFromString(xml.trim(), \"application/xml\");\r\n}\r\n\r\nlet num_re = /[0-9]+$/;\r\n\r\nfunction getIconFlag(elem) {\r\n  if (!elem.hasAttribute(\"useIcons\")) {\r\n    return 0;\r\n  }\r\n\r\n  let attr = elem.getAttribute(\"useIcons\");\r\n\r\n  if (typeof attr === \"string\") {\r\n    attr = attr.toLowerCase().trim();\r\n  }\r\n\r\n  if (attr === \"false\" || attr === \"no\") {\r\n    return 0;\r\n  }\r\n\r\n  if (attr === \"true\" || attr === \"yes\") {\r\n    return PackFlags.USE_ICONS;\r\n  } else if (attr === \"small\") {\r\n    return PackFlags.SMALL_ICON | PackFlags.USE_ICONS;\r\n  } else if (attr === \"large\") {\r\n    return PackFlags.LARGE_ICON | PackFlags.USE_ICONS;\r\n  } else {\r\n    let isnum = typeof attr === \"number\";\r\n    let sheet = attr;\r\n\r\n    if (typeof sheet === \"string\" && sheet.search(num_re) === 0) {\r\n      sheet = parseInt(sheet);\r\n      isnum = true;\r\n    }\r\n\r\n    if (!isnum) {\r\n      return PackFlags.USE_ICONS;\r\n    }\r\n\r\n    let flag = PackFlags.USE_ICONS | PackFlags.CUSTOM_ICON_SHEET;\r\n    flag |= ((sheet - 1)<<PackFlags.CUSTOM_ICON_SHEET_START);\r\n\r\n    return flag;\r\n  }\r\n\r\n  return 0;\r\n}\r\n\r\nfunction getPackFlag(elem) {\r\n  let packflag = getIconFlag(elem);\r\n\r\n  if (elem.hasAttribute(\"drawChecks\")) {\r\n    if (!getbool(elem, \"drawChecks\")) {\r\n      packflag |= PackFlags.HIDE_CHECK_MARKS;\r\n    } else {\r\n      packflag &= ~PackFlags.HIDE_CHECK_MARKS;\r\n    }\r\n  }\r\n\r\n  if (getbool(elem, \"simpleSlider\")) {\r\n    packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n  }\r\n  if (getbool(elem, \"rollarSlider\")) {\r\n    packflag |= PackFlags.FORCE_ROLLER_SLIDER;\r\n  }\r\n\r\n  return packflag;\r\n}\r\n\r\nfunction myParseFloat(s) {\r\n  s = '' + s;\r\n  s = s.trim().toLowerCase();\r\n\r\n  if (s.endsWith(\"px\")) {\r\n    s = s.slice(0, s.length - 2);\r\n  }\r\n\r\n  return parseFloat(s);\r\n}\r\n\r\nfunction getbool(elem, attr) {\r\n  let ret = elem.getAttribute(attr);\r\n  if (!ret) {\r\n    return false;\r\n  }\r\n\r\n  ret = ret.toLowerCase();\r\n  return ret === \"1\" || ret === \"true\" || ret === \"yes\";\r\n}\r\n\r\nfunction getfloat(elem, attr, defaultval) {\r\n  if (!elem.hasAttribute(attr)) {\r\n    return defaultval;\r\n  }\r\n\r\n  return myParseFloat(elem.getAttribute(attr));\r\n}\r\n\r\n/*\r\n**\r\n*\r\n* a customHandler can be a callback, or the string \"default\", e.g.\r\n*\r\n* xmlpage.customHandlers[\"homegig-element-x\"] = \"default\".\r\n*\r\n* The default case simply suppresses the warning that would otherwise\r\n* be printed to the console.\r\n* */\r\nexport const customHandlers = {};\r\n\r\nclass Handler {\r\n  constructor(ctx, container) {\r\n    this.container = container;\r\n    this.stack = [];\r\n    this.ctx = ctx;\r\n    this.codefuncs = {};\r\n\r\n    this.templateVars = {};\r\n\r\n    let attrs = util.list(sliderDomAttributes);\r\n\r\n    //note that useIcons, showLabel and sliderMode are PackFlag bits and are inherited through that system\r\n\r\n    this.inheritDomAttrs = {};\r\n    this.inheritDomAttrKeys = new Set(attrs);\r\n  }\r\n\r\n  push() {\r\n    this.stack.push(this.container);\r\n    this.stack.push(new Set(this.inheritDomAttrKeys));\r\n    this.stack.push(Object.assign({}, this.inheritDomAttrs));\r\n  }\r\n\r\n  pop() {\r\n    this.inheritDomAttrs = this.stack.pop();\r\n    this.inheritDomAttrKeys = this.stack.pop();\r\n    this.container = this.stack.pop();\r\n  }\r\n\r\n  handle(elem) {\r\n    if (elem.constructor === XMLDocument || elem.nodeName === 'root') {\r\n      for (let child of elem.childNodes) {\r\n        this.handle(child);\r\n      }\r\n\r\n      window.tree = elem\r\n      return;\r\n    } else if (elem.constructor === Text || elem.constructor === Comment) {\r\n      return;\r\n    }\r\n\r\n    let tagname = \"\" + elem.tagName;\r\n\r\n    if (tagname in customHandlers) {\r\n      customHandlers[tagname](this, elem);\r\n    } else if (this[tagname]) {\r\n      this[tagname](elem);\r\n    } else {\r\n      let elem2 = UIBase.createElement(tagname.toLowerCase());\r\n\r\n      window.__elem = elem;\r\n      //transfer DOM attributes\r\n      for (let k of elem.getAttributeNames()) {\r\n        elem2.setAttribute(k, elem.getAttribute(k));\r\n      }\r\n\r\n      if (elem2 instanceof UIBase) {\r\n        if (!elem2.hasAttribute(\"datapath\") && elem2.hasAttribute(\"path\")) {\r\n          elem2.setAttribute(\"datapath\", elem2.getAttribute(\"path\"));\r\n        }\r\n\r\n        if (elem2.hasAttribute(\"datapath\")) {\r\n          let path = elem2.getAttribute(\"datapath\");\r\n          path = this.container._joinPrefix(path);\r\n          elem2.setAttribute(\"datapath\", path);\r\n        }\r\n\r\n        if (elem2.hasAttribute(\"massSetPath\") || this.container.massSetPrefix) {\r\n          let massSetPath = \"\";\r\n\r\n          if (elem2.hasAttribute(\"massSetPath\")) {\r\n            massSetPath = elem2.getAttribute(\"massSetPath\");\r\n          }\r\n\r\n          let path = elem2.getAttribute(\"datapath\");\r\n\r\n          path = this.container._getMassPath(this.container.ctx, path, massSetPath);\r\n          elem2.setAttribute(\"massSetPath\", path);\r\n          elem2.setAttribute(\"mass_set_path\", path);\r\n        }\r\n\r\n        this.container.add(elem2);\r\n        this._style(elem, elem2);\r\n\r\n        if (elem2 instanceof Container) {\r\n          this.push();\r\n\r\n          this.container = elem2;\r\n          this._container(elem, elem2, true);\r\n          this.visit(elem);\r\n\r\n          this.pop();\r\n\r\n          return;\r\n        }\r\n      } else {\r\n        console.warn(\"Unknown element \" + elem.tagName + \" (\" + elem.constructor.name + \")\");\r\n        let elem2 = document.createElement(elem.tagName.toLowerCase());\r\n\r\n        for (let attr of elem.getAttributeNames()) {\r\n          elem2.setAttribute(attr, elem.getAttribute(attr));\r\n        }\r\n\r\n        this._basic(elem, elem2);\r\n\r\n        this.container.shadow.appendChild(elem2);\r\n\r\n        if (!(elem2 instanceof UIBase)) {\r\n          elem2.pathux_ctx = this.container.ctx;\r\n        } else {\r\n          elem2.ctx = this.container.ctx;\r\n        }\r\n      }\r\n\r\n      this.visit(elem);\r\n    }\r\n  }\r\n\r\n  _style(elem, elem2) {\r\n    let style = {};\r\n\r\n    //try to handle class attribute, at least somewhat\r\n\r\n    if (elem.hasAttribute(\"class\")) {\r\n      elem2.setAttribute(\"class\", elem.getAttribute(\"class\"));\r\n\r\n      let cls = elem2.getAttribute(\"class\").trim();\r\n      let keys = [\r\n        cls,\r\n        (elem2.tagName.toLowerCase() + \".\" + cls).trim(),\r\n        \"#\" + elem.getAttribute(\"id\").trim()\r\n      ];\r\n\r\n      for (let sheet of document.styleSheets) {\r\n        for (let rule of sheet.rules) {\r\n          for (let k of keys) {\r\n            if (rule.selectorText.trim() === k) {\r\n              for (let k2 of rule.styleMap.keys()) {\r\n                let val = rule.style[k2]\r\n\r\n                style[k2] = val;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (elem.hasAttribute(\"style\")) {\r\n      let stylecode = elem.getAttribute(\"style\");\r\n\r\n      stylecode = stylecode.split(\";\");\r\n\r\n      for (let row of stylecode) {\r\n        row = row.trim();\r\n\r\n        let i = row.search(/\\:/);\r\n        if (i >= 0) {\r\n          let key = row.slice(0, i).trim();\r\n          let val = row.slice(i + 1, row.length).trim();\r\n\r\n          style[key] = val;\r\n        }\r\n      }\r\n    }\r\n\r\n    let keys = Object.keys(style);\r\n    if (keys.length === 0) {\r\n      return;\r\n    }\r\n\r\n    function setStyle() {\r\n      for (let k of keys) {\r\n        elem2.style[k] = style[k];\r\n      }\r\n    }\r\n\r\n    if (elem2 instanceof UIBase) {\r\n      elem2.setCSS.after(() => {\r\n        setStyle();\r\n      });\r\n    }\r\n\r\n    setStyle();\r\n  }\r\n\r\n  visit(node) {\r\n    for (let child of node.childNodes) {\r\n      this.handle(child)\r\n    }\r\n  }\r\n\r\n  _getattr(elem, k) {\r\n    let val = elem.getAttribute(k);\r\n\r\n    if (!val) {\r\n      return val;\r\n    }\r\n\r\n    if (val.startsWith(\"##\")) {\r\n      val = val.slice(2, val.length).trim();\r\n\r\n      if (!(val in this.templateVars)) {\r\n        console.error(`unknown template variable '${val}'`);\r\n        val = '';\r\n      } else {\r\n        val = this.templateVars[val];\r\n      }\r\n    }\r\n\r\n    return val;\r\n  }\r\n\r\n  _basic(elem, elem2) {\r\n    this._style(elem, elem2);\r\n\r\n    for (let k of elem.getAttributeNames()) {\r\n      if (k.startsWith(\"custom\")) {\r\n        elem2.setAttribute(k, this._getattr(elem, k));\r\n      }\r\n    }\r\n\r\n    let codeattrs = [];\r\n\r\n    for (let k of elem.getAttributeNames()) {\r\n      let val = \"\"+elem.getAttribute(k);\r\n\r\n      if (val.startsWith('ng[')) {\r\n        val = val.slice(3, val.endsWith(\"]\") ? val.length-1 : val.length);\r\n\r\n        codeattrs.push([k, \"ng\", val]);\r\n      }\r\n    }\r\n\r\n    for (let k of domEventAttrs) {\r\n      let k2 = 'on' + k;\r\n\r\n      if (elem.hasAttribute(k2)) {\r\n        codeattrs.push([k, \"dom\", elem.getAttribute(k2)]);\r\n      }\r\n    }\r\n\r\n    for (let [k, eventType, id] of codeattrs) {\r\n      if (!(id in this.codefuncs)) {\r\n        console.error(\"Unknown code fragment \" + id);\r\n        continue;\r\n      }\r\n\r\n      if (eventType === \"dom\") {\r\n        //click events usually don't go through normal\r\n        //dom event system\r\n        if (k === 'click') {\r\n          let onclick = elem2.onclick;\r\n          let func = this.codefuncs[id];\r\n\r\n          elem2.onclick = function () {\r\n            if (onclick) {\r\n              onclick.apply(this, arguments);\r\n            }\r\n\r\n            return func.apply(this, arguments);\r\n          }\r\n        } else {\r\n          elem2.addEventListener(k, this.codefuncs[id]);\r\n        }\r\n      } else if (eventType === \"ng\") {\r\n        elem2.addEventListener(k, this.codefuncs[id]);\r\n      }\r\n    }\r\n\r\n\r\n    for (let k of domTransferAttrs) {\r\n      if (elem.hasAttribute(k)) {\r\n        elem2.setAttribute(k, elem.getAttribute(k));\r\n      }\r\n    }\r\n\r\n    for (let k in this.inheritDomAttrs) {\r\n      if (!elem.hasAttribute(k)) {\r\n        elem.setAttribute(k, this.inheritDomAttrs[k]);\r\n      }\r\n    }\r\n\r\n    for (let k of sliderDomAttributes) {\r\n      if (elem.hasAttribute(k)) {\r\n        elem2.setAttribute(k, elem.getAttribute(k));\r\n      }\r\n    }\r\n\r\n    if (!(elem2 instanceof UIBase)) {\r\n      return;\r\n    }\r\n\r\n    if (elem.hasAttribute(\"theme-class\")) {\r\n      elem2.overrideClass(elem.getAttribute(\"theme-class\"));\r\n\r\n      if (elem2._init_done) {\r\n        elem2.setCSS();\r\n        elem2.flushUpdate();\r\n      }\r\n    }\r\n\r\n    if (elem.hasAttribute(\"useIcons\") && typeof elem2.useIcons === \"function\") {\r\n      let val = elem.getAttribute(\"useIcons\").trim().toLowerCase();\r\n\r\n      if (val === \"small\" || val === \"true\" || val === \"yes\") {\r\n        val = true;\r\n      } else if (val === \"large\") {\r\n        val = 1;\r\n      } else if (val === \"false\" || val === \"no\") {\r\n        val = false;\r\n      } else {\r\n        val = parseInt(val) - 1;\r\n      }\r\n\r\n      elem2.useIcons(val);\r\n    }\r\n\r\n    if (elem.hasAttribute(\"sliderTextBox\")) {\r\n      let textbox = getbool(elem, \"sliderTextBox\");\r\n\r\n      if (textbox) {\r\n        elem2.packflag &= ~PackFlags.NO_NUMSLIDER_TEXTBOX;\r\n        elem2.inherit_packflag &= ~PackFlags.NO_NUMSLIDER_TEXTBOX;\r\n      } else {\r\n        elem2.packflag |= PackFlags.NO_NUMSLIDER_TEXTBOX;\r\n        elem2.inherit_packflag |= PackFlags.NO_NUMSLIDER_TEXTBOX;\r\n      }\r\n\r\n      //console.error(\"textBox\", textbox, elem2, elem.getAttribute(\"sliderTextBox\"), elem2.packflag);\r\n    }\r\n\r\n    if (elem.hasAttribute(\"sliderMode\")) {\r\n      let sliderMode = elem.getAttribute(\"sliderMode\");\r\n\r\n      if (sliderMode === \"slider\") {\r\n        elem2.packflag &= ~PackFlags.FORCE_ROLLER_SLIDER;\r\n        elem2.inherit_packflag &= ~PackFlags.FORCE_ROLLER_SLIDER;\r\n\r\n        elem2.packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n        elem2.inherit_packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n      } else if (sliderMode === \"roller\") {\r\n        elem2.packflag &= ~PackFlags.SIMPLE_NUMSLIDERS;\r\n        elem2.packflag |= PackFlags.FORCE_ROLLER_SLIDER;\r\n\r\n        elem2.inherit_packflag &= ~PackFlags.SIMPLE_NUMSLIDERS;\r\n        elem2.inherit_packflag |= PackFlags.FORCE_ROLLER_SLIDER;\r\n      }\r\n\r\n      //console.error(\"sliderMode\", sliderMode, elem2, elem2.packflag & (PackFlags.SIMPLE_NUMSLIDERS | PackFlags.FORCE_ROLLER_SLIDER));\r\n    }\r\n\r\n    if (elem.hasAttribute(\"showLabel\")) {\r\n      let state = getbool(elem, \"showLabel\");\r\n\r\n      if (state) {\r\n        elem2.packflag |= PackFlags.FORCE_PROP_LABELS;\r\n        elem2.inherit_packflag |= PackFlags.FORCE_PROP_LABELS;\r\n      } else {\r\n        elem2.packflag &= ~PackFlags.FORCE_PROP_LABELS;\r\n        elem2.inherit_packflag &= ~PackFlags.FORCE_PROP_LABELS;\r\n      }\r\n    }\r\n\r\n    function doBox(key) {\r\n      if (elem.hasAttribute(key)) {\r\n        let val = elem.getAttribute(key).toLowerCase().trim();\r\n\r\n        if (val.endsWith(\"px\")) {\r\n          val = val.slice(0, val.length - 2).trim();\r\n        }\r\n\r\n        if (val.endsWith(\"%\")) {\r\n          //eek! don't support at all?\r\n          //or use aspect overlay?\r\n\r\n          console.warn(`Relative styling of '${key}' may be unstable for this element`, elem);\r\n\r\n          elem.setCSS.after(function () {\r\n            this.style[key] = val;\r\n          });\r\n        } else {\r\n          val = parseFloat(val);\r\n\r\n          if (isNaN(val) || typeof val !== \"number\") {\r\n            console.error(`Invalid style ${key}:${elem.getAttribute(key)}`);\r\n            return;\r\n          }\r\n\r\n          elem2.overrideDefault(key, val);\r\n          elem2.setCSS();\r\n          elem2.style[key] = \"\" + val + \"px\";\r\n        }\r\n      }\r\n    }\r\n\r\n    doBox(\"width\");\r\n    doBox(\"height\");\r\n    doBox(\"margin\");\r\n    doBox(\"padding\");\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let key = i ? \"margin\" : \"padding\";\r\n\r\n      doBox(key + \"-bottom\");\r\n      doBox(key + \"-top\");\r\n      doBox(key + \"-left\");\r\n      doBox(key + \"-right\");\r\n    }\r\n  }\r\n\r\n  _handlePathPrefix(elem, con) {\r\n    if (elem.hasAttribute(\"path\")) {\r\n      let prefix = con.dataPrefix;\r\n      let path = elem.getAttribute(\"path\").trim();\r\n\r\n      if (prefix.length > 0) {\r\n        prefix += \".\";\r\n      }\r\n\r\n      prefix += path;\r\n      con.dataPrefix = prefix;\r\n    }\r\n\r\n    if (elem.hasAttribute(\"massSetPath\")) {\r\n      let prefix = con.massSetPrefix;\r\n      let path = elem.getAttribute(\"massSetPath\").trim();\r\n\r\n      if (prefix.length > 0) {\r\n        prefix += \".\";\r\n      }\r\n\r\n      prefix += path;\r\n      con.massSetPrefix = prefix;\r\n    }\r\n  }\r\n\r\n  _container(elem, con, ignorePathPrefix=false) {\r\n    for (let k of this.inheritDomAttrKeys) {\r\n      if (elem.hasAttribute(k)) {\r\n        this.inheritDomAttrs[k] = elem.getAttribute(k);\r\n      }\r\n    }\r\n\r\n    let packflag = getPackFlag(elem);\r\n\r\n    con.packflag |= packflag;\r\n    con.inherit_packflag |= packflag;\r\n\r\n    this._basic(elem, con);\r\n\r\n    if (!ignorePathPrefix) {\r\n      this._handlePathPrefix(elem, con);\r\n    }\r\n  }\r\n  noteframe(elem) {\r\n    let ret = this.container.noteframe();\r\n\r\n    if (ret) {\r\n      this._basic(elem, ret);\r\n    }\r\n  }\r\n\r\n  cell(elem) {\r\n    this.push();\r\n    this.container = this.container.cell();\r\n    this._container(elem, this.container);\r\n    this.visit(elem);\r\n    this.pop();\r\n  }\r\n\r\n  table(elem) {\r\n    this.push();\r\n    this.container = this.container.table();\r\n    this._container(elem, this.container);\r\n    this.visit(elem);\r\n    this.pop();\r\n  }\r\n\r\n  panel(elem) {\r\n    let title = \"\" + elem.getAttribute(\"label\")\r\n    let closed = getbool(elem, \"closed\")\r\n\r\n    this.push()\r\n    this.container = this.container.panel(title);\r\n    this.container.closed = closed;\r\n\r\n    this._container(elem, this.container);\r\n\r\n    this.visit(elem)\r\n\r\n    this.pop();\r\n  }\r\n\r\n  pathlabel(elem) {\r\n    this._prop(elem, \"pathlabel\")\r\n  }\r\n\r\n  /**\r\n   handle a code element, which are wrapped in functions\r\n   */\r\n  code(elem) {\r\n    window._codelem = elem;\r\n\r\n    let buf = '';\r\n\r\n    for (let elem2 of elem.childNodes) {\r\n      if (elem2.nodeName === \"#text\") {\r\n        buf += elem2.textContent + '\\n';\r\n      }\r\n    }\r\n\r\n    var func, $scope = this.templateScope;\r\n\r\n    buf = `\r\nfunc = function() {\r\n  ${buf};\r\n}\r\n    `;\r\n\r\n    eval(buf);\r\n\r\n    let id = \"\" + elem.getAttribute(\"id\");\r\n\r\n    this.codefuncs[id] = func;\r\n  }\r\n\r\n  textbox(elem) {\r\n    if (elem.hasAttribute(\"path\")) {\r\n      this._prop(elem, 'textbox');\r\n    } else {\r\n      //let elem2 = this.container.textbox();\r\n      //this._basic(elem, elem2);\r\n    }\r\n  }\r\n\r\n  label(elem) {\r\n    let elem2 = this.container.label(elem.innerHTML);\r\n    this._basic(elem, elem2);\r\n  }\r\n\r\n  colorfield(elem) {\r\n    this._prop(elem, \"colorfield\");\r\n  }\r\n\r\n  /** simpleSliders=true enables simple sliders */\r\n  prop(elem) {\r\n    this._prop(elem, \"prop\")\r\n  }\r\n\r\n  _prop(elem, key) {\r\n    let packflag = getPackFlag(elem);\r\n    let path = elem.getAttribute(\"path\");\r\n\r\n    let elem2;\r\n    if (key === 'pathlabel') {\r\n      elem2 = this.container.pathlabel(path, elem.innerHTML, packflag);\r\n    } else if (key === 'textbox') {\r\n      elem2 = this.container.textbox(path, undefined, undefined, packflag);\r\n\r\n      elem2.update();\r\n\r\n      //make textboxes non-modal by default\r\n      if (elem.hasAttribute(\"modal\")) {\r\n        elem2.setAttribute(\"modal\", elem.getAttribute(\"modal\"));\r\n      }\r\n\r\n      if (elem.hasAttribute(\"realtime\")) {\r\n        elem2.setAttribute(\"realtime\", elem.getAttribute(\"realtime\"));\r\n      }\r\n    } else if (key === \"colorfield\") {\r\n      elem2 = this.container.colorPicker(path, {\r\n        packflag,\r\n        themeOverride: elem.hasAttribute(\"theme-class\") ? elem.getAttribute(\"theme-class\") : undefined\r\n      });\r\n    } else {\r\n      elem2 = this.container[key](path, packflag);\r\n    }\r\n\r\n    if (!elem2) {\r\n      elem2 = document.createElement(\"span\");\r\n      elem2.innerHTML = \"error\";\r\n      this.container.shadow.appendChild(elem2);\r\n    } else {\r\n      this._basic(elem, elem2);\r\n\r\n      if (elem.hasAttribute(\"massSetPath\") || this.container.massSetPrefix) {\r\n        let mpath = elem.getAttribute(\"massSetPath\");\r\n        if (!mpath) {\r\n          mpath = elem.getAttribute(\"path\");\r\n        }\r\n\r\n        mpath = this.container._getMassPath(this.container.ctx, path, mpath);\r\n\r\n        elem2.setAttribute(\"mass_set_path\", mpath);\r\n      }\r\n    }\r\n  }\r\n\r\n  strip(elem) {\r\n    this.push();\r\n\r\n    let dir;\r\n    if (elem.hasAttribute(\"mode\")) {\r\n      dir = elem.getAttribute(\"mode\").toLowerCase().trim();\r\n      dir = dir === \"horizontal\";\r\n    }\r\n\r\n    let margin1 = getfloat(elem, \"margin1\", undefined);\r\n    let margin2 = getfloat(elem, \"margin2\", undefined);\r\n\r\n    this.container = this.container.strip(undefined, margin1, margin2, dir);\r\n    this._container(elem, this.container);\r\n    this.visit(elem);\r\n\r\n    this.pop();\r\n  }\r\n\r\n  column(elem) {\r\n    this.push();\r\n    this.container = this.container.col();\r\n    this._container(elem, this.container);\r\n    this.visit(elem);\r\n    this.pop();\r\n  }\r\n\r\n  row(elem) {\r\n    this.push();\r\n    this.container = this.container.row();\r\n    this._container(elem, this.container);\r\n    this.visit(elem);\r\n    this.pop();\r\n  }\r\n\r\n  toolPanel(elem) {\r\n    this.tool(elem, \"toolPanel\");\r\n  }\r\n\r\n  tool(elem, key = \"tool\") {\r\n    let path = elem.getAttribute(\"path\");\r\n    let packflag = getPackFlag(elem);\r\n\r\n    let noIcons = false, iconflags;\r\n\r\n    if (getbool(elem, \"useIcons\")) {\r\n      packflag |= PackFlags.USE_ICONS;\r\n    } else if (elem.hasAttribute(\"useIcons\")) {\r\n      packflag &= ~PackFlags.USE_ICONS;\r\n      noIcons = true;\r\n    }\r\n\r\n    let label = (\"\" + elem.textContent).trim()\r\n    if (label.length > 0) {\r\n      path += \"|\" + label;\r\n    }\r\n\r\n    if (noIcons) {\r\n      iconflags = this.container.useIcons(false);\r\n    }\r\n\r\n    let elem2 = this.container[key](path, packflag);\r\n\r\n    if (elem2) {\r\n      this._basic(elem, elem2);\r\n    } else {\r\n      elem2 = document.createElement(\"strip\")\r\n      elem2.innerHTML = \"error\"\r\n      this.container.shadow.appendChild(elem2);\r\n      this._basic(elem, elem2);\r\n    }\r\n\r\n    if (noIcons) {\r\n      this.container.inherit_packflag |= iconflags;\r\n      this.container.packflag |= iconflags;\r\n    }\r\n  }\r\n\r\n  dropbox(elem) {\r\n    return this.menu(elem, true);\r\n  }\r\n\r\n  menu(elem, isDropBox = false) {\r\n    let packflag = getPackFlag(elem);\r\n    let title = elem.getAttribute(\"name\")\r\n\r\n    let list = [];\r\n\r\n    for (let child of elem.childNodes) {\r\n      if (child.tagName === \"tool\") {\r\n        let path = child.getAttribute(\"path\");\r\n        let label = child.innerHTML.trim();\r\n\r\n        if (label.length > 0) {\r\n          path += \"|\" + label;\r\n        }\r\n\r\n        list.push(path);\r\n      } else if (child.tagName === \"sep\") {\r\n        list.push(Menu.SEP);\r\n      } else if (child.tagName === \"item\") {\r\n        let id, icon, hotkey, description;\r\n\r\n        if (child.hasAttribute(\"id\")) {\r\n          id = child.getAttribute(\"id\");\r\n        }\r\n\r\n        if (child.hasAttribute(\"icon\")) {\r\n          icon = child.getAttribute(\"icon\").toUpperCase().trim();\r\n          icon = Icons[icon];\r\n        }\r\n\r\n        if (child.hasAttribute(\"hotkey\")) {\r\n          hotkey = child.getAttribute(\"hotkey\");\r\n        }\r\n\r\n        if (child.hasAttribute(\"description\")) {\r\n          description = child.getAttribute(\"description\");\r\n        }\r\n\r\n        list.push({\r\n          name: child.innerHTML.trim(),\r\n          id, icon, hotkey, description\r\n        });\r\n      }\r\n    }\r\n\r\n    let ret = this.container.menu(title, list, packflag);\r\n    if (isDropBox) {\r\n      ret.removeAttribute(\"simple\");\r\n    }\r\n\r\n    if (elem.hasAttribute(\"id\")) {\r\n      ret.setAttribute(\"id\", elem.getAttribute(\"id\"));\r\n    }\r\n\r\n    this._basic(elem, ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  button(elem) {\r\n    let title = elem.innerHTML.trim();\r\n\r\n    let ret = this.container.button(title);\r\n\r\n    if (elem.hasAttribute(\"id\")) {\r\n      ret.setAttribute(\"id\", elem.getAttribute(\"id\"));\r\n    }\r\n\r\n    this._basic(elem, ret);\r\n  }\r\n\r\n  iconbutton(elem) {\r\n    let title = elem.innerHTML.trim();\r\n\r\n    let icon = elem.getAttribute(\"icon\");\r\n    if (icon) {\r\n      icon = UIBase.getIconEnum()[icon];\r\n    }\r\n    let ret = this.container.iconbutton(icon, title);\r\n\r\n    if (elem.hasAttribute(\"id\")) {\r\n      ret.setAttribute(\"id\", elem.getAttribute(\"id\"));\r\n    }\r\n\r\n    this._basic(elem, ret);\r\n  }\r\n\r\n  tab(elem) {\r\n    this.push();\r\n\r\n    let title = \"\" + elem.getAttribute(\"label\");\r\n\r\n    let tabs = this.container;\r\n\r\n    this.container = this.container.tab(title);\r\n\r\n    if (elem.hasAttribute(\"overflow\")) {\r\n      this.container.setAttribute(\"overflow\", elem.getAttribute(\"overflow\"));\r\n    }\r\n\r\n    if (elem.hasAttribute(\"overflow-y\")) {\r\n      this.container.setAttribute(\"overflow-y\", elem.getAttribute(\"overflow-y\"));\r\n    }\r\n\r\n    this._container(elem, this.container)\r\n    this.visit(elem);\r\n\r\n    this.pop();\r\n  }\r\n\r\n  tabs(elem) {\r\n    let pos = elem.getAttribute(\"pos\") || \"left\"\r\n\r\n    this.push();\r\n\r\n    let tabs = this.container.tabs(pos)\r\n    this.container = tabs;\r\n\r\n    if (elem.hasAttribute(\"movable-tabs\")) {\r\n      tabs.setAttribute(\"movable-tabs\", elem.getAttribute(\"movable-tabs\"));\r\n    }\r\n\r\n    this._container(elem, tabs);\r\n    this.visit(elem);\r\n\r\n    this.pop();\r\n  }\r\n}\r\n\r\nexport function initPage(ctx, xml, parentContainer = undefined, templateVars = {}, templateScope = {}) {\r\n  let tree = parseXML(xml);\r\n  let container = UIBase.createElement(\"container-x\");\r\n\r\n  container.ctx = ctx;\r\n  if (ctx) {\r\n    container._init();\r\n  }\r\n\r\n  if (parentContainer) {\r\n    parentContainer.add(container);\r\n  }\r\n\r\n  let handler = new Handler(ctx, container);\r\n\r\n  handler.templateVars = Object.assign({}, templateVars);\r\n  handler.templateScope = templateScope;\r\n\r\n  handler.handle(tree);\r\n\r\n  return container;\r\n\r\n}\r\n\r\nexport function loadPage(ctx, url, parentContainer_or_args = undefined, loadSourceOnly = false,\r\n                         modifySourceCB, templateVars, templateScope) {\r\n  let source;\r\n  let parentContainer;\r\n\r\n  if (parentContainer_or_args !== undefined && !(parentContainer_or_args instanceof HTMLElement)) {\r\n    let args = parentContainer_or_args;\r\n\r\n    parentContainer = args.parentContainer;\r\n    loadSourceOnly = args.loadSourceOnly;\r\n    modifySourceCB = args.modifySourceCB;\r\n    templateVars = args.templateVars;\r\n    templateScope = args.templateScope;\r\n  } else {\r\n    parentContainer = parentContainer_or_args;\r\n  }\r\n\r\n  if (pagecache.has(url)) {\r\n    source = pagecache.get(url);\r\n\r\n    if (modifySourceCB) {\r\n      source = modifySourceCB(source);\r\n    }\r\n\r\n    return new Promise((accept, reject) => {\r\n      if (loadSourceOnly) {\r\n        accept(source);\r\n      } else {\r\n        accept(initPage(ctx, source, parentContainer, templateVars, templateScope));\r\n      }\r\n    });\r\n  } else {\r\n    return new Promise((accept, reject) => {\r\n      fetch(url).then(res => res.text()).then(data => {\r\n        pagecache.set(url, data);\r\n\r\n        if (modifySourceCB) {\r\n          data = modifySourceCB(data);\r\n        }\r\n\r\n        if (loadSourceOnly) {\r\n          accept(data);\r\n        } else {\r\n          accept(initPage(ctx, data, parentContainer, templateVars, templateScope));\r\n        }\r\n      });\r\n    });\r\n  }\r\n}\r\n","import {CurveConstructors} from \"./curve1d_base.js\";\r\nimport {EnumProperty} from \"../toolsys/toolprop.js\";\r\n\r\nexport function makeGenEnum() {\r\n  let enumdef = {};\r\n  let uinames = {};\r\n  let icons = {};\r\n\r\n  for (let cls of CurveConstructors) {\r\n    let def = cls.define();\r\n\r\n    let uiname = def.uiname;\r\n    uiname = uiname === undefined ? def.name : uiname;\r\n\r\n    enumdef[def.name] = cls.name;\r\n    uinames[def.name] = uiname;\r\n    icons[def.name] = def.icon !== undefined ? def.icon : -1;\r\n  }\r\n\r\n  //return enumdef;\r\n  return new EnumProperty(undefined, enumdef).addUINames(uinames).addIcons(icons);\r\n}\r\n","import {Curve1DProperty} from \"../path-controller/toolsys/toolprop.js\";\r\nimport {UIBase, Icons} from '../core/ui_base.js';\r\nimport {ColumnFrame, RowFrame} from \"../core/ui.js\";\r\nimport * as util from '../path-controller/util/util.js';\r\nimport {Vector2, Vector3} from \"../path-controller/util/vectormath.js\";\r\nimport {Curve1D, mySafeJSONStringify} from \"../path-controller/curve/curve1d.js\";\r\nimport {makeGenEnum} from '../path-controller/curve/curve1d_utils.js';\r\n\r\nexport class Curve1DWidget extends ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this.useDataPathUndo = false;\r\n\r\n    this._on_draw = this._on_draw.bind(this);\r\n    this.drawTransform = [1.0, [0, 0]];\r\n\r\n    this._value = new Curve1D();\r\n    this._value.on(\"draw\", this._on_draw);\r\n\r\n    let in_onchange = false;\r\n\r\n    this._value._on_change = (msg) => {\r\n      if (in_onchange) {\r\n        return;\r\n      }\r\n\r\n      /* Prevent infinite recursion. */\r\n      in_onchange = true;\r\n\r\n      try {\r\n        if (this.onchange) {\r\n          this.onchange(this._value);\r\n        }\r\n\r\n        if (this.hasAttribute(\"datapath\")) {\r\n          let path = this.getAttribute(\"datapath\");\r\n          if (this._value !== undefined) {\r\n            let val = this.getPathValue(this.ctx, path);\r\n\r\n            if (val) {\r\n              val.load(this._value);\r\n              this.setPathValue(this.ctx, path, val);\r\n            } else {\r\n              val = this._value.copy();\r\n              this.setPathValue(this.ctx, path, val);\r\n            }\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error(error.stack);\r\n        console.error(error.message);\r\n      }\r\n\r\n      in_onchange = false;\r\n    };\r\n\r\n    this._gen_type = undefined;\r\n    this._lastGen = undefined;\r\n\r\n    this._last_dpi = undefined;\r\n    this.canvas = document.createElement(\"canvas\");\r\n\r\n    this.g = this.canvas.getContext(\"2d\");\r\n    this.canvas.g = this.g;\r\n\r\n    window.cw = this;\r\n    this.shadow.appendChild(this.canvas);\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  _on_draw(e) {\r\n    let curve = e.data;\r\n\r\n    //console.log(\"draw\");\r\n    this._redraw();\r\n  }\r\n\r\n  set value(val) {\r\n    this._value.load(val);\r\n    this.update();\r\n    this._redraw();\r\n  }\r\n\r\n  _on_change() {\r\n    if (this.onchange) {\r\n      this.onchange(this);\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.useDataPathUndo = false;\r\n    let row = this.row();\r\n\r\n    let prop = makeGenEnum();\r\n\r\n    prop.setValue(this.value.generatorType);\r\n\r\n    this.dropbox = row.listenum(undefined, \"Type\", prop, this.value.generatorType, (id) => {\r\n      console.warn(\"SELECT\", id, prop.keys[id]);\r\n\r\n      this.value.setGenerator(id);\r\n      this.value._on_change(\"curve type change\");\r\n    });\r\n    this.dropbox._init();\r\n\r\n    row.iconbutton(Icons.ZOOM_OUT, \"Zoom Out\", () => {\r\n      let curve = this._value;\r\n      if (!curve) return;\r\n      //if (isNaN(curve.uiZoom))\r\n      //  curve.uiZoom = 1.0;\r\n\r\n      curve.uiZoom *= 0.9;\r\n      if (this.getAttribute(\"datapath\")) {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), curve);\r\n      }\r\n\r\n      this._redraw();\r\n    }).iconsheet = 0;\r\n    row.iconbutton(Icons.ZOOM_IN, \"Zoom In\", () => {\r\n      let curve = this._value;\r\n      if (!curve) return;\r\n      //if (isNaN(curve.uiZoom))\r\n      //  curve.uiZoom = 1.0;\r\n\r\n      curve.uiZoom *= 1.1;\r\n      if (this.getAttribute(\"datapath\")) {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), curve);\r\n      }\r\n\r\n      this._redraw();\r\n\r\n    }).iconsheet = 0;\r\n\r\n    this.container = this.col();\r\n\r\n    let panel = this.panel(\"Range\");\r\n\r\n    let clipCheck = panel.check(undefined, \"Clip To Range\");\r\n    clipCheck.onchange = (val) => {\r\n      this._value.clipToRange = val;\r\n      this._on_change();\r\n      this._redraw();\r\n    }\r\n    clipCheck.checked = this._value.clipToRange;\r\n\r\n    let xmin = panel.slider(undefined, \"X Min\", this._value.xRange[0], -10, 10, 0.1, false, undefined, (val) => {\r\n      this._value.xRange[0] = val.value;\r\n      this._on_change();\r\n      this._redraw();\r\n    });\r\n\r\n    let xmax = panel.slider(undefined, \"X Max\", this._value.xRange[1], -10, 10, 0.1, false, undefined, (val) => {\r\n      this._value.xRange[1] = val.value;\r\n      this._on_change();\r\n      this._redraw();\r\n    });\r\n\r\n    let ymin = panel.slider(undefined, \"Y Min\", this._value.yRange[0], -10, 10, 0.1, false, undefined, (val) => {\r\n      this._value.yRange[0] = val.value;\r\n      this._on_change();\r\n      this._redraw();\r\n    });\r\n\r\n    let ymax = panel.slider(undefined, \"Y Max\", this._value.yRange[1], -10, 10, 0.1, false, undefined, (val) => {\r\n      this._value.yRange[1] = val.value;\r\n      this._on_change();\r\n      this._redraw();\r\n    });\r\n\r\n    let last_update_key = \"\";\r\n    this.container.update.after(() => {\r\n      const xRange = this._value.xRange;\r\n      const yRange = this._value.yRange;\r\n      let key = \"\" + xRange[0] + \":\" + xRange[1]\r\n        + \":\" + yRange[0] + \":\" + yRange[1] + \":\" + this._value.clipToRange;\r\n\r\n      clipCheck.checked = this._value.clipToRange;\r\n\r\n      if (key !== last_update_key) {\r\n        last_update_key = key;\r\n\r\n        xmin.setValue(xRange[0]);\r\n        xmax.setValue(xRange[1]);\r\n\r\n        ymin.setValue(yRange[0]);\r\n        ymax.setValue(yRange[1]);\r\n      }\r\n    });\r\n\r\n    xmin.displayUnit = xmin.baseUnit = \"none\";\r\n    ymin.displayUnit = ymin.baseUnit = \"none\";\r\n    xmax.displayUnit = xmax.baseUnit = \"none\";\r\n    ymax.displayUnit = ymax.baseUnit = \"none\";\r\n\r\n    panel.closed = false;\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.style[\"width\"] = \"min-contents\";\r\n    this.style[\"height\"] = \"min-contents\";\r\n    this.updateSize();\r\n  }\r\n\r\n  updateSize() {\r\n    let dpi = UIBase.getDPI();\r\n    let w = ~~(this.getDefault(\"CanvasWidth\")*dpi);\r\n    let h = ~~(this.getDefault(\"CanvasHeight\")*dpi);\r\n\r\n    let bad = w !== this.canvas.width || h !== this.canvas.height;\r\n    bad = bad || dpi !== this._last_dpi;\r\n\r\n    if (!bad) {\r\n      return;\r\n    }\r\n\r\n    this._last_dpi = dpi;\r\n    this.canvas.width = w;\r\n    this.canvas.height = h;\r\n\r\n    this.canvas.style[\"width\"] = (w/dpi) + \"px\";\r\n    this.canvas.style[\"height\"] = (h/dpi) + \"px\";\r\n\r\n    this._redraw();\r\n  }\r\n\r\n  _redraw() {\r\n    //forcibly clear canvas, works better then clearRect\r\n    this.canvas.width = this.canvas.width;\r\n    this.canvas.height = this.canvas.height;\r\n\r\n    let canvas = this.canvas, g = this.g;\r\n\r\n    //g.clearRect(0, 0, canvas.width, canvas.height);\r\n    g.beginPath();\r\n    g.rect(0, 0, canvas.width, canvas.height);\r\n    g.fillStyle = this.getDefault(\"CanvasBG\");\r\n    g.fill();\r\n\r\n    g.save();\r\n\r\n    let zoom = this._value.uiZoom;\r\n    let scale = Math.max(canvas.width, canvas.height);\r\n\r\n    g.lineWidth /= scale;\r\n\r\n    this.drawTransform[0] = scale*zoom;\r\n    this.drawTransform[1][0] = 0.0;\r\n    this.drawTransform[1][1] = -1.0;\r\n\r\n    this.drawTransform[1][0] -= 0.5 - 0.5/zoom;\r\n    this.drawTransform[1][1] += 0.5 - 0.5/zoom;\r\n\r\n    //g.scale(scale, scale);\r\n\r\n    g.scale(this.drawTransform[0], -this.drawTransform[0]);\r\n    g.translate(this.drawTransform[1][0], this.drawTransform[1][1]);\r\n\r\n    g.lineWidth /= zoom;\r\n\r\n    this._value.draw(this.canvas, this.g, this.drawTransform);\r\n    g.restore();\r\n  }\r\n\r\n  rebuild() {\r\n    let ctx = this.ctx;\r\n    if (ctx === undefined || this.container === undefined) {\r\n      return;\r\n    }\r\n\r\n    this._gen_type = this.value.generatorType;\r\n    let col = this.container;\r\n\r\n    if (this._lastGen !== undefined) {\r\n      this._lastGen.killGUI(col, this.canvas);\r\n    }\r\n\r\n    let onchange = this.dropbox.onchange;\r\n    this.dropbox.onchange = undefined\r\n    this.dropbox.setValue(this.value.generatorType);\r\n    this.dropbox.onchange = onchange;\r\n\r\n    col.clear();\r\n\r\n    let gen = this.value.generators.active;\r\n    gen.makeGUI(col, this.canvas);\r\n\r\n    this._lastGen = gen;\r\n\r\n    this._redraw();\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n    let val = this.getPathValue(this.ctx, path);\r\n\r\n    if (this._lastu === undefined) {\r\n      this._lastu = 0;\r\n    }\r\n\r\n    if (val && !val.equals(this._value) && util.time_ms() - this._lastu > 200) {\r\n      this._lastu = util.time_ms();\r\n\r\n      this._value.load(val);\r\n      this.update();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  updateGenUI() {\r\n    let bad = this._lastGen !== this.value.generators.active;\r\n\r\n    if (bad) {\r\n      this.rebuild();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateDataPath();\r\n    this.updateSize();\r\n    this.updateGenUI();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"curve-widget-x\",\r\n      style  : \"curvewidget\"\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(Curve1DWidget);\r\n","//bind module to global var to get at it in console.\r\n//\r\n//note that require has an api for handling circular\r\n//module refs, in such cases do not use these vars.\r\n\r\nimport {CSSFont} from \"../core/ui_base.js\";\r\n\r\nvar _ui = undefined;\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as ui_widgets from './ui_widgets.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport '../path-controller/util/html5_fileapi.js';\r\nimport {ColumnFrame, RowFrame, Container} from \"../core/ui.js\";\r\n\r\nlet PropFlags = toolprop.PropFlags;\r\nlet PropSubTypes = toolprop.PropSubTypes;\r\n\r\nlet EnumProperty = toolprop.EnumProperty;\r\n\r\nlet Vector2   = vectormath.Vector2,\r\n    UIBase    = ui_base.UIBase,\r\n    PackFlags = ui_base.PackFlags,\r\n    PropTypes = toolprop.PropTypes;\r\n\r\n\r\n//methods to forward to this.contents\r\nlet forward_keys = new Set([\r\n  \"row\", \"col\", \"strip\", \"noteframe\", \"helppicker\", \"vecpopup\",\r\n  \"tabs\", \"table\", \"menu\", \"listbox\", \"panel\",\r\n  \"pathlabel\", \"label\", \"listenum\", \"check\", \"iconcheck\",\r\n  \"button\", \"iconbutton\", \"colorPicker\", \"twocol\",\r\n  \"treeview\", \"slider\", \"simpleslider\", \"curve1d\",\r\n  \"noteframe\", \"vecpopup\",\r\n  \"prop\", \"tool\", \"toolPanel\", \"textbox\", \"dynamicMenu\",\r\n  \"add\", \"prepend\", \"useIcons\", \"noMarginsOrPadding\", \"wrap\"\r\n]);\r\n\r\nexport class PanelFrame extends ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this.titleframe = super.row();\r\n\r\n    this.contents = super.col();\r\n    this.contents._remove = this.contents.remove;\r\n    this.contents.remove = () => {\r\n      this.remove();\r\n    };\r\n\r\n    this._panel = this; //compatibility alias\r\n\r\n    this.contents._panel = this;\r\n    this.iconcheck = UIBase.createElement(\"iconcheck-x\");\r\n    this.iconcheck.noEmboss = true;\r\n\r\n    Object.defineProperty(this.contents, \"closed\", {\r\n      get: () => {\r\n        return this.closed;\r\n      },\r\n\r\n      set: (v) => {\r\n        this.closed = v;\r\n      }\r\n    })\r\n\r\n    Object.defineProperty(this.contents, \"title\", {\r\n      get: () => this.titleframe.getAttribute(\"title\"),\r\n      set: (v) => this.setHeaderToolTip(v)\r\n    });\r\n\r\n    this.packflag = this.inherit_packflag = 0;\r\n\r\n    this._closed = false;\r\n\r\n    this.makeHeader();\r\n  }\r\n\r\n  get inherit_packflag() {\r\n    if (!this.contents) return;\r\n    return this.contents.inherit_packflag;\r\n  }\r\n\r\n  set inherit_packflag(val) {\r\n    if (!this.contents) return;\r\n    this.contents.inherit_packflag = val;\r\n  }\r\n\r\n  get packflag() {\r\n    if (!this.contents) return;\r\n    return this.contents.packflag;\r\n  }\r\n\r\n  set packflag(val) {\r\n    if (!this.contents) return;\r\n    this.contents.packflag = val;\r\n  }\r\n\r\n  appendChild(child) {\r\n    return this.contents.shadow.appendChild(child);\r\n  }\r\n\r\n  get headerLabel() {\r\n    return this.__label.text;\r\n  }\r\n\r\n  set headerLabel(v) {\r\n    this.__label.text = v;\r\n    this.__label._updateFont();\r\n\r\n    if (this.hasAttribute(\"label\")) {\r\n      this.setAttribute(\"label\", v);\r\n    }\r\n\r\n    if (this.ctx) {\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  get dataPrefix() {\r\n    return this.contents ? this.contents.dataPrefix : \"\";\r\n  }\r\n\r\n  set dataPrefix(v) {\r\n    if (this.contents) {\r\n      this.contents.dataPrefix = v;\r\n    }\r\n  }\r\n\r\n  get closed() {\r\n    return this._closed;\r\n  }\r\n\r\n  set closed(val) {\r\n    let update = !!val !== !!this.closed;\r\n    this._closed = val;\r\n\r\n    //console.log(\"closed set\", update);\r\n    if (update) {\r\n      this._updateClosed(true);\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname            : \"panelframe-x\",\r\n      style              : \"panel\",\r\n      subclassChecksTheme: true\r\n    };\r\n  }\r\n\r\n  setHeaderToolTip(tooltip) {\r\n    this.titleframe.setAttribute(\"title\", tooltip);\r\n\r\n    this.titleframe._forEachChildWidget((child) => {\r\n      child.setAttribute(\"title\", tooltip);\r\n    });\r\n  }\r\n\r\n  saveData() {\r\n    let ret = {\r\n      closed: this._closed\r\n    };\r\n\r\n    return Object.assign(super.saveData(), ret);\r\n  }\r\n\r\n  loadData(obj) {\r\n    if (!(\"closed\" in obj)) {\r\n      this.closed = obj._closed;\r\n    } else {\r\n      this.closed = obj.closed;\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this.contents.clear();\r\n    return this;\r\n  }\r\n\r\n  makeHeader() {\r\n    let row = this.titleframe;\r\n\r\n    let iconcheck = this.iconcheck;\r\n\r\n    if (!iconcheck) {\r\n      return;\r\n    }\r\n\r\n    iconcheck.overrideDefault(\"padding\", 0);\r\n\r\n    iconcheck.noMarginsOrPadding();\r\n\r\n    iconcheck.overrideDefault(\"highlight\", {\r\n      \"background-color\" : iconcheck.getSubDefault(\"highlight\", \"background-color\")\r\n    });\r\n\r\n    iconcheck.overrideDefault(\"background-color\", \"rgba(0,0,0,0)\");\r\n    iconcheck.overrideDefault(\"BoxDepressed\", \"rgba(0,0,0,0)\");\r\n    iconcheck.overrideDefault(\"border-color\", \"rgba(0,0,0,0)\");\r\n\r\n    iconcheck.ctx = this.ctx;\r\n    iconcheck._icon_pressed = ui_base.Icons.UI_EXPAND;\r\n    iconcheck._icon = ui_base.Icons.UI_COLLAPSE;\r\n    iconcheck.drawCheck = false;\r\n    iconcheck.iconsheet = ui_base.IconSheets.SMALL;\r\n    iconcheck.checked = this._closed;\r\n\r\n    this.iconcheck.onchange = (e) => {\r\n      this.closed = this.iconcheck.checked;\r\n    };\r\n\r\n    row._add(iconcheck);\r\n\r\n    //stupid css, let's just hackishly put \" \" to create spacing2\r\n\r\n    let onclick = (e) => {\r\n      iconcheck.checked = !iconcheck.checked;\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n    };\r\n\r\n    let label = this.__label = row.label(this.getAttribute(\"label\"));\r\n\r\n    this.__label.font = \"TitleText\";\r\n\r\n    label._updateFont();\r\n\r\n    label.noMarginsOrPadding();\r\n    label.addEventListener(\"mousedown\", onclick);\r\n    label.addEventListener(\"touchdown\", onclick);\r\n\r\n    let bs = this.getDefault(\"border-style\");\r\n\r\n    row.background = this.getDefault(\"TitleBackground\");\r\n    row.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n    row.style[\"border\"] = `${this.getDefault(\"border-width\")}px ${bs} ${this.getDefault(\"border-color\")}`;\r\n\r\n    row.style[\"padding-right\"] = \"20px\";\r\n    row.style[\"padding-left\"] = \"5px\";\r\n    row.style[\"padding-top\"] = this.getDefault(\"padding-top\") + \"px\";\r\n    row.style[\"padding-bottom\"] = this.getDefault(\"padding-bottom\") + \"px\";\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.background = this.getDefault(\"background-color\");\r\n    this.style[\"width\"] = \"100%\";\r\n\r\n    this.contents.ctx = this.ctx;\r\n    if (!this._closed) {\r\n      super.add(this.contents);\r\n      this.contents.flushUpdate();\r\n    }\r\n\r\n    this.contents.dataPrefix = this.dataPrefix;\r\n\r\n    //con.style[\"margin-left\"] = \"5px\";\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    if (!this.titleframe || !this.__label) {\r\n      return;\r\n    }\r\n\r\n    let getDefault = (key, defval) => {\r\n      let val = this.getDefault(key);\r\n      return val !== undefined ? val : defval;\r\n    };\r\n\r\n    let bs = this.getDefault(\"border-style\");\r\n\r\n    let header_radius = this.getDefault(\"HeaderRadius\");\r\n    if (header_radius === undefined) {\r\n      header_radius = this.getDefault(\"border-radius\");\r\n    }\r\n\r\n    let boxmargin = getDefault(\"padding\", 0);\r\n\r\n    let paddingleft = getDefault(\"padding-left\", 0);\r\n    let paddingright = getDefault(\"padding-right\", 0);\r\n\r\n    paddingleft += boxmargin;\r\n    paddingright += boxmargin;\r\n\r\n    this.titleframe.background = this.getDefault(\"TitleBackground\");\r\n    this.titleframe.style[\"border-radius\"] = header_radius + \"px\";\r\n    this.titleframe.style[\"border\"] = `${this.getDefault(\"border-width\")}px ${bs} ${this.getDefault(\"TitleBorder\")}`;\r\n    this.style[\"border\"] = `${this.getDefault(\"border-width\")}px ${bs} ${this.getDefault(\"border-color\")}`;\r\n    this.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n\r\n    this.titleframe.style[\"padding-top\"] = this.getDefault(\"padding-top\") + \"px\";\r\n    this.titleframe.style[\"padding-bottom\"] = this.getDefault(\"padding-bottom\") + \"px\";\r\n    this.titleframe.style[\"padding-left\"] = paddingleft + \"px\";\r\n    this.titleframe.style[\"padding-right\"] = paddingright + \"px\";\r\n    this.titleframe.style[\"margin-bottom\"] = \"0px\";\r\n    this.titleframe.style[\"margin-top\"] = \"0px\";\r\n\r\n    this.__label.style[\"border\"] = \"unset\";\r\n    this.__label.style[\"border-radius\"] = \"unset\";\r\n\r\n    let bg = this.getDefault(\"background-color\");\r\n\r\n    this.background = bg;\r\n    this.contents.background = bg;\r\n    this.contents.parentWidget = this;\r\n    this.contents.style[\"background-color\"] = bg;\r\n    this.style[\"background-color\"] = bg;\r\n\r\n    let margintop, marginbottom;\r\n\r\n    if (this._closed) {\r\n      margintop = getDefault('margin-top-closed', 0);\r\n      marginbottom = getDefault('margin-bottom-closed', 5);\r\n    } else {\r\n      margintop = getDefault('margin-top', 0);\r\n      marginbottom = getDefault('margin-bottom', 0);\r\n    }\r\n\r\n    let marginleft = getDefault('margin-left', 0);\r\n    let marginright = getDefault('margin-right', 0);\r\n\r\n    this.style['margin-left'] = marginleft + \"px\";\r\n    this.style['margin-right'] = marginright + \"px\";\r\n\r\n    this.style['margin-top'] = margintop + \"px\";\r\n    this.style['margin-bottom'] = marginbottom + \"px\";\r\n\r\n    //this.style[\"padding-left\"] = paddingleft + \"px\";\r\n    //this.style[\"padding-right\"] = paddingright + \"px\";\r\n\r\n    this.__label._updateFont();\r\n  }\r\n\r\n  on_disabled() {\r\n    super.on_disabled();\r\n\r\n    this.__label._updateFont();\r\n    this.setCSS();\r\n  }\r\n\r\n  on_enabled() {\r\n    super.on_enabled();\r\n\r\n    this.__label.setCSS();\r\n    this.__label.style[\"color\"] = this.style[\"color\"];\r\n    this.setCSS();\r\n  }\r\n\r\n  update() {\r\n    let text = this.getAttribute(\"label\");\r\n\r\n    let update = text !== this.__label.text;\r\n\r\n    if (this.checkThemeUpdate()) {\r\n      update = true;\r\n      this._setVisible(this.closed, true);\r\n      this.setCSS();\r\n      this.flushSetCSS();\r\n    }\r\n\r\n    if (update) {\r\n      this.headerLabel = this.getAttribute(\"label\")\r\n\r\n      this.__label._updateFont();\r\n      this.setCSS();\r\n    }\r\n\r\n    super.update();\r\n  }\r\n\r\n  _onchange(isClosed) {\r\n    if (this.onchange) {\r\n      this.onchange(isClosed);\r\n    }\r\n\r\n    if (this.contents.onchange) {\r\n      this.contents.onchange(isClosed);\r\n    }\r\n  }\r\n\r\n  //catch setAttribute so we can detect label update\r\n  //even if close and updates disabled\r\n  setAttribute(key, value) {\r\n    let ret = super.setAttribute(key, value);\r\n\r\n    if (this.ctx) {\r\n      this.update();\r\n      this.flushUpdate();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  get noUpdateClosedContents() {\r\n    if (!this.hasAttribute(\"update-closed-contents\")) {\r\n      return false;\r\n    }\r\n\r\n    let ret = this.getAttribute(\"update-closed-contents\");\r\n    return ret === \"true\" || ret === \"on\";\r\n  }\r\n\r\n  set noUpdateClosedContents(v) {\r\n    this.setAttribute(\"update-closed-contents\", v ? \"true\" : \"false\");\r\n  }\r\n\r\n  _setVisible(isClosed, changed) {\r\n    changed = changed || !!isClosed !== !!this._closed;\r\n\r\n    this._state = isClosed;\r\n\r\n    if (isClosed) {\r\n      this.contents.style.display = \"none\";\r\n\r\n      //this.contents._remove();\r\n      //this.contents.hide(true);\r\n      if (!this.noUpdateClosedContents) {\r\n        this.contents.packflag |= PackFlags.NO_UPDATE;\r\n      }\r\n    } else {\r\n      //this.contents.hide(false);\r\n      this.contents.style.display = \"flex\";\r\n      this.contents.packflag &= ~PackFlags.NO_UPDATE;\r\n      this.contents.flushUpdate();\r\n    }\r\n\r\n    this.contents.hidden = isClosed;\r\n\r\n    if (this.parentWidget) {\r\n      this.parentWidget.flushUpdate();\r\n    } else {\r\n      this.flushUpdate();\r\n    }\r\n\r\n    if (changed) {\r\n      this._onchange(isClosed);\r\n    }\r\n\r\n    /*\r\n    for (let c of this.shadow.childNodes) {\r\n      if (c !== this.titleframe) {\r\n        c.hidden = state;\r\n      }\r\n    }*/\r\n  }\r\n\r\n  _updateClosed(changed) {\r\n    this._setVisible(this._closed, changed);\r\n\r\n    if (this.iconcheck) {\r\n      this.iconcheck.checked = this._closed;\r\n    }\r\n  }\r\n}\r\n\r\n\r\nlet makeForward = (k) => {\r\n  return function() {\r\n    return this.contents[k](...arguments);\r\n  }\r\n};\r\n\r\nfor (let k of forward_keys) {\r\n  PanelFrame.prototype[k] = makeForward(k);\r\n}\r\n\r\nUIBase.internalRegister(PanelFrame);\r\n","\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as ui from '../core/ui.js';\r\nimport {PropTypes} from '../path-controller/toolsys/toolprop.js';\r\nimport {keymap} from '../path-controller/util/simple_events.js';\r\nimport cconst from '../config/const.js';\r\nimport {color2web, web2color, validateWebColor} from \"../core/ui_base.js\";\r\n\r\nlet Vector2 = vectormath.Vector2,\r\n    Vector3 = vectormath.Vector3,\r\n    Vector4 = vectormath.Vector4,\r\n    Matrix4 = vectormath.Matrix4;\r\n\r\nexport {rgb_to_hsv, hsv_to_rgb} from \"../path-controller/util/colorutils.js\";\r\nimport {rgb_to_hsv, hsv_to_rgb, cmyk_to_rgb, rgb_to_cmyk} from \"../path-controller/util/colorutils.js\";\r\nimport {contextWrangler} from '../screen/area_wrangler.js';\r\n\r\nlet UIBase     = ui_base.UIBase,\r\n    PackFlags  = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nlet UPW = 1.25, VPW = 0.75;\r\n\r\n//*\r\nlet sample_rets = new util.cachering(() => [0, 0], 64);\r\n\r\nexport function inv_sample(u, v) {\r\n  let ret = sample_rets.next();\r\n\r\n  ret[0] = Math.pow(u, UPW);\r\n  ret[1] = Math.pow(v, VPW);\r\n\r\n  return ret;\r\n}\r\n\r\nexport function sample(u, v) {\r\n  let ret = sample_rets.next();\r\n\r\n  ret[0] = Math.pow(u, 1.0/UPW);\r\n  ret[1] = Math.pow(v, 1.0/VPW);\r\n\r\n  return ret;\r\n}\r\n\r\n//*/\r\n\r\n/* shared methods for clipboard handling */\r\nfunction colorClipboardCopy() {\r\n  let rgba = this.getRGBA();\r\n\r\n  let r = rgba[0]*255;\r\n  let g = rgba[1]*255;\r\n  let b = rgba[2]*255;\r\n  let a = rgba[3];\r\n\r\n  let data = `rgba(${r.toFixed(4)}, ${g.toFixed(4)}, ${b.toFixed(4)}, ${a.toFixed(4)})`;\r\n  //cconst.setClipboardData(\"color\", \"text/css\", data);\r\n\r\n  cconst.setClipboardData(\"color\", \"text/plain\", data);\r\n}\r\n\r\nfunction colorClipboardPaste() {\r\n  let data = cconst.getClipboardData(\"text/plain\");\r\n\r\n  if (!data || !validateCSSColor(\"\" + data.data)) {// || data.mime !== \"text/css\") {\r\n    return;\r\n  }\r\n\r\n  let color;\r\n\r\n  try {\r\n    color = css2color(data.data);\r\n  } catch (error) {\r\n    //not a color\r\n    console.log(error.stack);\r\n    console.log(error.message);\r\n  }\r\n\r\n  if (color) {\r\n    if (color.length < 4) {\r\n      color.push(1.0);\r\n    }\r\n\r\n    this.setRGBA(color);\r\n  }\r\n}\r\n\r\nlet fieldrand = new util.MersenneRandom(0);\r\n\r\nlet huefields = {};\r\n\r\nexport function getHueField(width, height, dpi) {\r\n  let key = width + \":\" + height + \":\" + dpi.toFixed(4);\r\n\r\n  if (key in huefields) {\r\n    return huefields[key];\r\n  }\r\n\r\n  let field = new ImageData(width, height);\r\n  let idata = field.data;\r\n\r\n  for (let i = 0; i < width*height; i++) {\r\n    let ix = i%width, iy = ~~(i/width);\r\n    let idx = i*4;\r\n\r\n    let rgb = hsv_to_rgb(ix/width, 1, 1);\r\n\r\n    idata[idx] = rgb[0]*255;\r\n    idata[idx + 1] = rgb[1]*255;\r\n    idata[idx + 2] = rgb[2]*255;\r\n    idata[idx + 3] = 255;\r\n  }\r\n\r\n  //*\r\n  let canvas = document.createElement(\"canvas\");\r\n  canvas.width = field.width;\r\n  canvas.height = field.height;\r\n  let g = canvas.getContext(\"2d\");\r\n  g.putImageData(field, 0, 0);\r\n  field = canvas;\r\n  //*/\r\n\r\n  huefields[key] = field;\r\n  return field;\r\n}\r\n\r\nlet fields = {};\r\n\r\nexport function getFieldImage(fieldsize, width, height, hsva) {\r\n  fieldrand.seed(0);\r\n\r\n  /* render field at half res and upscale via canvas2d */\r\n  let width2 = width>>1;\r\n  let height2 = height>>1;\r\n  let fieldsize2 = fieldsize>>1;\r\n\r\n  let hue = hsva[0];\r\n  let hue_rgb = hsv_to_rgb(hue, 1.0, 1.0);\r\n  let key = fieldsize + \":\" + width2 + \":\" + height2 + \":\" + hue.toFixed(5);\r\n\r\n  if (key in fields)\r\n    return fields[key];\r\n\r\n  let size2 = fieldsize2;\r\n  let valpow = 0.75;\r\n\r\n  let image = {\r\n    width : width,\r\n    height: height,\r\n    image : new ImageData(fieldsize2, fieldsize2),\r\n\r\n    x2sat: (x) => {\r\n      return Math.min(Math.max(x/width, 0), 1);\r\n    },\r\n    y2val: (y) => {\r\n      y = 1.0 - Math.min(Math.max(y/height, 0), 1);\r\n\r\n      return y === 0.0 ? 0.0 : y**valpow;\r\n    },\r\n    sat2x: (s) => {\r\n      return s*width;\r\n    },\r\n    val2y: (v) => {\r\n      if (v === 0)\r\n        return height;\r\n\r\n      v = v**(1.0/valpow);\r\n      return (1.0 - v)*height;\r\n    }\r\n  };\r\n\r\n  image.params = {\r\n    box: {\r\n      x     : 0,\r\n      y     : 0,\r\n      width : width,\r\n      height: height\r\n    }\r\n  };\r\n\r\n  let idata = image.image.data;\r\n  for (let i = 0; i < idata.length; i += 4) {\r\n    let i2 = i/4;\r\n    let x = i2%size2, y = ~~(i2/size2);\r\n\r\n    let v = 1.0 - (y/size2);\r\n    let s = (x/size2);\r\n\r\n    let rgb = hsv_to_rgb(hsva[0], s, v**valpow);\r\n\r\n    idata[i] = rgb[0]*255;\r\n    idata[i + 1] = rgb[1]*255;\r\n    idata[i + 2] = rgb[2]*255;\r\n    idata[i + 3] = 255;\r\n  }\r\n\r\n  //*\r\n  let image2 = document.createElement(\"canvas\");\r\n  image2.width = size2;\r\n  image2.height = size2;\r\n  let g = image2.getContext(\"2d\");\r\n  g.putImageData(image.image, 0, 0);\r\n  //*/\r\n  image.canvas = image2;\r\n  image.scale = width/size2;\r\n\r\n  fields[key] = image;\r\n  return image;\r\n}\r\n\r\n\r\nlet _update_temp = new Vector4();\r\n\r\nexport class SimpleBox {\r\n  constructor(pos = [0, 0], size = [1, 1]) {\r\n    this.pos = new Vector2(pos);\r\n    this.size = new Vector2(size);\r\n    this.r = 0;\r\n  }\r\n}\r\n\r\nexport class HueField extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.g = this.canvas.getContext(\"2d\");\r\n    this.shadow.appendChild(this.canvas);\r\n\r\n    let setFromXY = (x, y) => {\r\n      let dpi = this.getDPI();\r\n      let pad = this._getPad();\r\n\r\n      let w = this.canvas.width/dpi - pad*2.0;\r\n      x -= pad;\r\n\r\n      let h = x/w;\r\n      h = Math.min(Math.max(h, 0.0), 1.0);\r\n\r\n      this.hsva[0] = h;\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.hsva);\r\n      }\r\n\r\n      this._redraw();\r\n    };\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Left\"]:\r\n        case keymap[\"Right\"]:\r\n          let sign = e.keyCode === keymap[\"Left\"] ? -1 : 1;\r\n\r\n          this.hsva[0] = Math.min(Math.max(this.hsva[0] + 0.05*sign, 0.0), 1.0);\r\n          this._redraw();\r\n\r\n          if (this.onchange) {\r\n            this.onchange();\r\n          }\r\n          break;\r\n      }\r\n    });\r\n\r\n    this.addEventListener(\"mousedown\", (e) => {\r\n      if (this.modalRunning) {\r\n        return;\r\n      }\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n\r\n      let rect = this.canvas.getClientRects()[0];\r\n      let x = e.clientX - rect.x, y = e.clientY - rect.y;\r\n\r\n      setFromXY(x, y);\r\n\r\n      this.pushModal({\r\n        on_mousemove: (e) => {\r\n          let rect = this.canvas.getClientRects()[0];\r\n          let x = e.clientX - rect.x, y = e.clientY - rect.y;\r\n\r\n          setFromXY(x, y);\r\n        },\r\n        on_mousedown: (e) => {\r\n          this.popModal();\r\n        },\r\n        on_mouseup  : (e) => {\r\n          this.popModal();\r\n        },\r\n        on_keydown  : (e) => {\r\n          if (e.keyCode === keymap[\"Enter\"] || e.keyCode === keymap[\"Escape\"] || e.keyCode === keymap[\"Space\"]) {\r\n            this.popModal();\r\n          }\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n\r\n  static define() {\r\n    return {\r\n      tagname          : \"huefield-x\",\r\n      style            : \"colorfield\",\r\n      havePickClipboard: true\r\n    };\r\n  }\r\n\r\n  getRGBA() {\r\n    let rgb = hsv_to_rgb(this.hsva[0], this.hsva[1], this.hsva[2]);\r\n    return new Vector4().loadXYZW(rgb[0], rgb[1], rgb[2], this.hsva[3]);\r\n  }\r\n\r\n  setRGBA(rgba) {\r\n    let hsv = rgb_to_hsv(rgba[0], rgba[1], rgba[2]);\r\n    this.hsva.loadXYZW(hsv[0], hsv[1], hsv[2], rgba[3]);\r\n\r\n    this._redraw();\r\n\r\n    if (this.onchange) {\r\n      this.onchange(this.hsva);\r\n    }\r\n  }\r\n\r\n  clipboardCopy() {\r\n    colorClipboardCopy.apply(this, arguments);\r\n  }\r\n\r\n  clipboardPaste() {\r\n    colorClipboardPaste.apply(this, arguments);\r\n  }\r\n\r\n  _getPad() {\r\n    return Math.max(this.getDefault(\"circleSize\"), 15);\r\n  }\r\n\r\n  _redraw() {\r\n    let g = this.g, canvas = this.canvas;\r\n    let dpi = this.getDPI();\r\n\r\n    let w = this.getDefault(\"width\");\r\n    let h = this.getDefault(\"hueHeight\");\r\n\r\n    canvas.width = ~~(w*dpi);\r\n    canvas.height = ~~(h*dpi);\r\n\r\n    canvas.style[\"width\"] = w + \"px\";\r\n    canvas.style[\"height\"] = h + \"px\";\r\n\r\n    /* create horizontal padding to make selection of\r\n     *  endpoint hue easier */\r\n\r\n    let rselector = ~~(this._getPad()*dpi); //~~(this.getDefault(\"circleSize\")*dpi);\r\n    let r_circle = this.getDefault(\"circleSize\")*dpi;\r\n\r\n    let w2 = canvas.width, h2 = canvas.height;\r\n\r\n    w2 -= rselector*2.0;\r\n\r\n    //g.drawImage(getHueField(w2, h2, dpi), 0, 0, w2, h2, rselector*2, 0, w2, h2);\r\n    g.drawImage(getHueField(w2, h2, dpi), 0, 0, w2, h2, rselector, 0, w2, h2);\r\n\r\n    let x = this.hsva[0]*w2 + rselector;\r\n    let y = canvas.height*0.5;\r\n\r\n    g.beginPath();\r\n    g.arc(x, y, r_circle, -Math.PI, Math.PI);\r\n    g.closePath();\r\n\r\n    g.strokeStyle = \"white\";\r\n    g.lineWidth = 3*dpi;\r\n    g.stroke();\r\n\r\n    g.strokeStyle = \"grey\";\r\n    g.lineWidth = 1*dpi;\r\n    g.stroke();\r\n\r\n    if (this.disabled) {\r\n      g.beginPath();\r\n      g.fillStyle = \"rgba(25,25,25,0.75)\"\r\n      g.rect(0, 0, this.canvas.width, this.canvas.height);\r\n      g.fill();\r\n    }\r\n  }\r\n\r\n  on_disabled() {\r\n    this._redraw();\r\n  }\r\n\r\n  on_enabled() {\r\n    this._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(HueField);\r\n\r\nexport class SatValField extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.hsva = [0, 0, 0, 1];\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.g = this.canvas.getContext(\"2d\");\r\n    this.shadow.appendChild(this.canvas);\r\n\r\n    this.onchange = undefined;\r\n\r\n    let setFromXY = (x, y) => {\r\n      let field = this._getField();\r\n      let r = ~~(this.getDefault(\"circleSize\")*this.getDPI());\r\n\r\n      let sat = field.x2sat(x - r);\r\n      let val = field.y2val(y - r);\r\n\r\n      this.hsva[1] = sat;\r\n      this.hsva[2] = val;\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.hsva);\r\n      }\r\n\r\n      this._redraw();\r\n    };\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Left\"]:\r\n        case keymap[\"Right\"]: {\r\n          let sign = e.keyCode === keymap[\"Left\"] ? -1 : 1;\r\n\r\n          this.hsva[1] = Math.min(Math.max(this.hsva[1] + 0.05*sign, 0.0), 1.0);\r\n          this._redraw();\r\n\r\n          if (this.onchange) {\r\n            this.onchange(this.hsva);\r\n          }\r\n\r\n          break;\r\n        }\r\n\r\n        case keymap[\"Up\"]:\r\n        case keymap[\"Down\"]: {\r\n          let sign = e.keyCode === keymap[\"Down\"] ? -1 : 1;\r\n\r\n          this.hsva[2] = Math.min(Math.max(this.hsva[2] + 0.05*sign, 0.0), 1.0);\r\n          this._redraw();\r\n\r\n          if (this.onchange) {\r\n            this.onchange(this.hsva);\r\n          }\r\n          break;\r\n        }\r\n      }\r\n    });\r\n\r\n    this.canvas.addEventListener(\"mousedown\", (e) => {\r\n      if (this.modalRunning) {\r\n        return;\r\n      }\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n\r\n      let rect = this.canvas.getClientRects()[0];\r\n      let x = e.clientX - rect.x, y = e.clientY - rect.y;\r\n\r\n      setFromXY(x, y);\r\n\r\n      this.pushModal({\r\n        on_pointermove(e) {\r\n          this.on_mousemove(e);\r\n        },\r\n        on_mousemove: (e) => {\r\n          let rect = this.canvas.getClientRects()[0];\r\n          if (rect === undefined) {\r\n            return;\r\n          }\r\n\r\n          let x = e.clientX - rect.x, y = e.clientY - rect.y;\r\n\r\n          setFromXY(x, y);\r\n        },\r\n        on_mousedown: (e) => {\r\n          this.popModal();\r\n        },\r\n        on_mouseup  : (e) => {\r\n          this.popModal();\r\n        },\r\n        on_keydown  : (e) => {\r\n          if (e.keyCode === keymap[\"Enter\"] || e.keyCode === keymap[\"Escape\"] || e.keyCode === keymap[\"Space\"]) {\r\n            this.popModal();\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    this.canvas.addEventListener(\"touchstart\", (e) => {\r\n      if (this.modalRunning) {\r\n        return;\r\n      }\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n\r\n      let rect = this.canvas.getClientRects()[0];\r\n      let x = e.touches[0].clientX - rect.x, y = e.touches[0].clientY - rect.y;\r\n\r\n      setFromXY(x, y);\r\n\r\n      this.pushModal({\r\n        on_mousemove  : (e) => {\r\n          let rect = this.canvas.getClientRects()[0];\r\n          let x, y;\r\n\r\n          if (e.touches && e.touches.length) {\r\n            x = e.touches[0].clientX - rect.x;\r\n            y = e.touches[0].clientY - rect.y;\r\n          } else {\r\n            x = e.x;\r\n            y = e.y;\r\n          }\r\n\r\n          setFromXY(x, y);\r\n        },\r\n        on_touchmove  : (e) => {\r\n          let rect = this.canvas.getClientRects()[0];\r\n          let x = e.touches[0].clientX - rect.x, y = e.touches[0].clientY - rect.y;\r\n\r\n          setFromXY(x, y);\r\n        },\r\n        on_mousedown  : (e) => {\r\n          this.popModal();\r\n        },\r\n        on_touchcancel: (e) => {\r\n          this.popModal();\r\n        },\r\n        on_touchend   : (e) => {\r\n          this.popModal();\r\n        },\r\n        on_mouseup    : (e) => {\r\n          this.popModal();\r\n        },\r\n        on_keydown    : (e) => {\r\n          if (e.keyCode === keymap[\"Enter\"] || e.keyCode === keymap[\"Escape\"] || e.keyCode === keymap[\"Space\"]) {\r\n            this.popModal();\r\n          }\r\n        }\r\n      });\r\n    })\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname          : \"satvalfield-x\",\r\n      style            : \"colorfield\",\r\n      havePickClipboard: true\r\n    };\r\n  }\r\n\r\n  getRGBA() {\r\n    let rgb = hsv_to_rgb(this.hsva[0], this.hsva[1], this.hsva[2]);\r\n    return new Vector4().loadXYZW(rgb[0], rgb[1], rgb[2], this.hsva[3]);\r\n  }\r\n\r\n  setRGBA(rgba) {\r\n    let hsv = rgb_to_hsv(rgba[0], rgba[1], rgba[2]);\r\n    this.hsva.loadXYZW(hsv[0], hsv[1], hsv[2], rgba[3]);\r\n\r\n    this.update(true);\r\n    this._redraw();\r\n\r\n    if (this.onchange) {\r\n      this.onchange(this.hsva);\r\n    }\r\n  }\r\n\r\n  clipboardCopy() {\r\n    colorClipboardCopy.apply(this, arguments);\r\n  }\r\n\r\n  clipboardPaste() {\r\n    colorClipboardPaste.apply(this, arguments);\r\n  }\r\n\r\n  _getField() {\r\n    let dpi = this.getDPI();\r\n    let canvas = this.canvas;\r\n    let r = this.getDefault(\"circleSize\");\r\n    let w = this.getDefault(\"width\");\r\n    let h = this.getDefault(\"height\");\r\n\r\n    //r = ~~(r*dpi);\r\n\r\n    return getFieldImage(this.getDefault(\"fieldSize\"), w - r*2, h - r*2, this.hsva);\r\n  }\r\n\r\n  update(force_update = false) {\r\n    super.update();\r\n\r\n    if (force_update) {\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _redraw() {\r\n    let g = this.g, canvas = this.canvas;\r\n    let dpi = this.getDPI();\r\n\r\n    let w = this.getDefault(\"width\");\r\n    let h = this.getDefault(\"height\");\r\n\r\n    canvas.width = ~~(w*dpi);\r\n    canvas.height = ~~(h*dpi);\r\n\r\n    canvas.style[\"width\"] = w + \"px\";\r\n    canvas.style[\"height\"] = h + \"px\";\r\n    //SatValField\r\n\r\n    let rselector = ~~(this.getDefault(\"circleSize\")*dpi);\r\n\r\n    let field = this._getField()\r\n    let image = field.canvas;\r\n\r\n    g.globalAlpha = 1.0;\r\n    g.beginPath();\r\n    g.rect(0, 0, canvas.width, canvas.height);\r\n    g.fillStyle = \"rgb(200, 200, 200)\";\r\n    g.fill();\r\n\r\n    g.beginPath();\r\n\r\n    let steps = 17;\r\n    let dx = canvas.width/steps;\r\n    let dy = canvas.height/steps;\r\n\r\n    for (let i = 0; i < steps*steps; i++) {\r\n      let x = (i%steps)*dx, y = (~~(i/steps))*dy;\r\n\r\n      if (i%2 === 0) {\r\n        continue;\r\n      }\r\n      g.rect(x, y, dx, dy);\r\n    }\r\n\r\n    g.fillStyle = \"rgb(110, 110, 110)\";\r\n    g.fill();\r\n\r\n    g.globalAlpha = this.hsva[3];\r\n    g.drawImage(image, 0, 0, image.width, image.height, rselector, rselector, canvas.width - rselector*2, canvas.height - rselector*2);\r\n\r\n    let hsva = this.hsva;\r\n\r\n    let x = field.sat2x(hsva[1])*dpi + rselector;\r\n    let y = field.val2y(hsva[2])*dpi + rselector;\r\n    let r = rselector;\r\n\r\n    g.beginPath();\r\n    g.arc(x, y, r, -Math.PI, Math.PI);\r\n    g.closePath();\r\n\r\n    g.strokeStyle = \"white\";\r\n    g.lineWidth = 3*dpi;\r\n    g.stroke();\r\n\r\n    g.strokeStyle = \"grey\";\r\n    g.lineWidth = 1*dpi;\r\n    g.stroke();\r\n\r\n    if (this.disabled) {\r\n      g.beginPath();\r\n      g.fillStyle = \"rgba(25,25,25,0.75)\";\r\n      g.rect(0, 0, this.canvas.width, this.canvas.height);\r\n      g.fill();\r\n    }\r\n  }\r\n\r\n  on_disabled() {\r\n    this._redraw();\r\n  }\r\n\r\n  on_enabled() {\r\n    this._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(SatValField);\r\n\r\nexport class ColorField extends ui.ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this.hsva = new Vector4([0.05, 0.6, 0.15, 1.0]);\r\n    this.rgba = new Vector4([0, 0, 0, 0]);\r\n\r\n    this._recalcRGBA();\r\n\r\n    this._lastThemeStyle = this.constructor.define().style;\r\n\r\n    /*\r\n    this.hbox = new SimpleBox();\r\n    this.svbox = new SimpleBox();\r\n    //*/\r\n\r\n    this._last_dpi = undefined;\r\n\r\n    let satvalfield = this.satvalfield = UIBase.createElement(\"satvalfield-x\");\r\n    satvalfield.hsva = this.hsva;\r\n\r\n    let huefield = this.huefield = UIBase.createElement(\"huefield-x\");\r\n    huefield.hsva = this.hsva;\r\n\r\n    huefield.onchange = (e) => {\r\n      this.satvalfield._redraw();\r\n      this._recalcRGBA();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.rgba);\r\n      }\r\n    };\r\n\r\n    satvalfield.onchange = (e) => {\r\n      this._recalcRGBA();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.rgba);\r\n      }\r\n    };\r\n\r\n    this._add(satvalfield);\r\n    this._add(huefield);\r\n    //this.shadow.appendChild(canvas);\r\n    //this.shadow.appendChild(huecanvas);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"colorfield-x\",\r\n      style  : \"colorfield\"\r\n    };\r\n  }\r\n\r\n  setCMYK(c, m, y, k) {\r\n    let rgb = cmyk_to_rgb(c, m, y, k);\r\n    let hsv = rgb_to_hsv(rgb[0], rgb[1], rgb[2]);\r\n\r\n    this.setHSVA(hsv[0], hsv[1], hsv[2], this.hsva[3]);\r\n  }\r\n\r\n  getCMYK() {\r\n    let rgb = hsv_to_rgb(this.hsva[0], this.hsva[1], this.hsva[2]);\r\n    return rgb_to_cmyk(rgb[0], rgb[1], rgb[2]);\r\n  }\r\n\r\n  setHSVA(h, s, v, a = 1.0, fire_onchange = true) {\r\n    this.hsva[0] = h;\r\n    this.hsva[1] = s;\r\n    this.hsva[2] = v;\r\n    this.hsva[3] = a;\r\n\r\n    this._recalcRGBA();\r\n    this.update(true);\r\n\r\n    if (this.onchange && fire_onchange) {\r\n      this.onchange(this.hsva, this.rgba);\r\n    }\r\n  }\r\n\r\n  _recalcRGBA() {\r\n    let ret = hsv_to_rgb(this.hsva[0], this.hsva[1], this.hsva[2]);\r\n\r\n    this.rgba[0] = ret[0];\r\n    this.rgba[1] = ret[1];\r\n    this.rgba[2] = ret[2];\r\n    this.rgba[3] = this.hsva[3];\r\n\r\n    return this;\r\n  }\r\n\r\n  updateDPI(force_update = false, _in_update = false) {\r\n    let dpi = this.getDPI();\r\n\r\n    let update = force_update;\r\n    update = update || dpi != this._last_dpi;\r\n\r\n    if (update) {\r\n      this._last_dpi = dpi;\r\n\r\n      if (!_in_update)\r\n        this._redraw();\r\n\r\n      return true;\r\n    }\r\n  }\r\n\r\n  getRGBA() {\r\n    let rgb = hsv_to_rgb(this.hsva[0], this.hsva[1], this.hsva[2]);\r\n    return new Vector4().loadXYZW(rgb[0], rgb[1], rgb[2], this.hsva[3]);\r\n  }\r\n\r\n  setRGBA(r, g, b, a = 1.0, fire_onchange = true) {\r\n    if (typeof r === \"object\") {\r\n      g = r[1];\r\n      b = r[2];\r\n      a = r[3];\r\n      r = r[0];\r\n    }\r\n\r\n    let hsv = rgb_to_hsv(r, g, b);\r\n\r\n    this.hsva[0] = hsv[0];\r\n    this.hsva[1] = hsv[1];\r\n    this.hsva[2] = hsv[2];\r\n    this.hsva[3] = a;\r\n\r\n    this._recalcRGBA();\r\n    this.update(true);\r\n\r\n    if (this.onchange && fire_onchange) {\r\n      this.onchange(this.hsva, this.rgba);\r\n    }\r\n  }\r\n\r\n  updateThemeOverride() {\r\n    let theme = this.getStyleClass();\r\n    if (theme === this._lastThemeStyle) {\r\n      return false;\r\n    }\r\n\r\n    this._lastThemeStyle = theme;\r\n    this.huefield.overrideClass(theme);\r\n    this.satvalfield.overrideClass(theme);\r\n\r\n    for (let i=0; i<3; i++) {\r\n      this.flushSetCSS();\r\n      this.flushUpdate();\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  update(force_update = false) {\r\n    super.update();\r\n\r\n    this.updateThemeOverride();\r\n\r\n    let redraw = this.updateDPI(force_update, true);\r\n    redraw = redraw || force_update;\r\n\r\n    if (redraw) {\r\n      this.satvalfield.update(true);\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.style[\"flex-grow\"] = this.getDefault(\"flex-grow\");\r\n  }\r\n\r\n  _redraw() {\r\n    this.satvalfield._redraw();\r\n    this.huefield._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ColorField);\r\n\r\nexport class ColorPicker extends ui.ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this._lastThemeStyle = this.constructor.define().style;\r\n  }\r\n\r\n  //*\r\n  get hsva() {\r\n    return this.field.hsva;\r\n  }\r\n\r\n  get rgba() {\r\n    return this.field.rgba;\r\n  }//*/\r\n\r\n  set description(val) {\r\n    //do not allow setting description of the colorpicker container\r\n  }\r\n\r\n  static setDefault(node) {\r\n    let tabs, colorsPanel = node;\r\n\r\n    if (node.getClassDefault(\"usePanels\")) {\r\n      let panel = colorsPanel = node.panel(\"Color\");\r\n      tabs = panel.tabs();\r\n      panel.closed = true;\r\n\r\n      panel.style[\"flex-grow\"] = \"unset\";\r\n\r\n      /* force compactness */\r\n      panel.titleframe.style[\"flex-grow\"] = \"unset\";\r\n      //panel.titleframe.style[\"align-items\"] = \"unset\";\r\n    } else {\r\n      tabs = node.tabs();\r\n    }\r\n\r\n    node.cssText = node.textbox();\r\n    node.cssText.onchange = (val) => {\r\n      let ok = validateWebColor(val);\r\n      if (!ok) {\r\n        node.cssText.flash(\"red\");\r\n        return;\r\n      } else {\r\n        node.cssText.flash(\"green\");\r\n      }\r\n\r\n      val = val.trim();\r\n\r\n      let color = web2color(val);\r\n\r\n      node._no_update_textbox = true;\r\n      node.field.setRGBA(color[0], color[1], color[2], color[3]);\r\n      node._setSliders();\r\n\r\n      node._no_update_textbox = false;\r\n    };\r\n\r\n    //tabs.overrideDefault(\"background-color\", node.getDefault(\"background-color\"));\r\n\r\n    let tab = tabs.tab(\"HSV\");\r\n\r\n    node.h = tab.slider(undefined, \"Hue\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let hsva = node.hsva;\r\n      node.setHSVA(e.value, hsva[1], hsva[2], hsva[3]);\r\n    });\r\n\r\n    node.s = tab.slider(undefined, \"Saturation\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let hsva = node.hsva;\r\n      node.setHSVA(hsva[0], e.value, hsva[2], hsva[3]);\r\n    });\r\n    node.v = tab.slider(undefined, \"Value\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let hsva = node.hsva;\r\n      node.setHSVA(hsva[0], hsva[1], e.value, hsva[3]);\r\n    });\r\n    node.a = tab.slider(undefined, \"Alpha\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let hsva = node.hsva;\r\n      node.setHSVA(hsva[0], hsva[1], hsva[2], e.value);\r\n    });\r\n\r\n    node.h.baseUnit = node.h.displayUnit = \"none\";\r\n    node.s.baseUnit = node.s.displayUnit = \"none\";\r\n    node.v.baseUnit = node.v.displayUnit = \"none\";\r\n    node.a.baseUnit = node.a.displayUnit = \"none\";\r\n\r\n    tab = tabs.tab(\"RGB\");\r\n\r\n    node.r = tab.slider(undefined, \"R\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let rgba = node.rgba;\r\n      node.setRGBA(e.value, rgba[1], rgba[2], rgba[3]);\r\n    });\r\n    node.g = tab.slider(undefined, \"G\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let rgba = node.rgba;\r\n      node.setRGBA(rgba[0], e.value, rgba[2], rgba[3]);\r\n    });\r\n    node.b = tab.slider(undefined, \"B\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let rgba = node.rgba;\r\n      node.setRGBA(rgba[0], rgba[1], e.value, rgba[3]);\r\n    });\r\n    node.a2 = tab.slider(undefined, \"Alpha\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let rgba = node.rgba;\r\n      node.setRGBA(rgba[0], rgba[1], rgba[2], e.value);\r\n    });\r\n\r\n    node.r.baseUnit = node.r.displayUnit = \"none\";\r\n    node.g.baseUnit = node.g.displayUnit = \"none\";\r\n    node.b.baseUnit = node.b.displayUnit = \"none\";\r\n    node.a2.baseUnit = node.a2.displayUnit = \"none\";\r\n\r\n    if (!node.getDefault(\"noCMYK\")) {\r\n      tab = tabs.tab(\"CMYK\")\r\n      let cmyk = node.getCMYK();\r\n\r\n      let makeCMYKSlider = (label, idx) => {\r\n        let slider = tab.slider(undefined, {\r\n          name      : label,\r\n          min       : 0.0,\r\n          max       : 1.0,\r\n          is_int    : false,\r\n          defaultval: cmyk[idx],\r\n          callback  : (e) => {\r\n            let cmyk = node.getCMYK();\r\n            cmyk[idx] = e.value;\r\n            node.setCMYK(cmyk[0], cmyk[1], cmyk[2], cmyk[3]);\r\n          },\r\n          step      : 0.001\r\n        });\r\n\r\n        slider.baseUnit = slider.displayUnit = \"none\";\r\n\r\n        return slider;\r\n      }\r\n\r\n      node.cmyk = [\r\n        makeCMYKSlider(\"C\", 0),\r\n        makeCMYKSlider(\"M\", 1),\r\n        makeCMYKSlider(\"Y\", 2),\r\n        makeCMYKSlider(\"K\", 3),\r\n      ];\r\n    }\r\n\r\n    node._setSliders();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname            : \"colorpicker-x\",\r\n      style              : \"colorfield\",\r\n      havePickClipboard  : true,\r\n      copyForAllChildren : true,\r\n      pasteForAllChildren: true,\r\n    };\r\n  }\r\n\r\n  clipboardCopy() {\r\n    colorClipboardCopy.apply(this, arguments);\r\n  }\r\n\r\n  clipboardPaste() {\r\n    colorClipboardPaste.apply(this, arguments);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.field = UIBase.createElement(\"colorfield-x\");\r\n    this.field.setAttribute(\"class\", \"colorpicker\");\r\n\r\n    this.field.packflag |= this.inherit_packflag;\r\n    this.field.packflag |= this.packflag;\r\n\r\n    this.field.onchange = () => {\r\n      this._setDataPath();\r\n      this._setSliders();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.field.rgba);\r\n      }\r\n    };\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n      .colorpicker {\r\n        background-color : ${this.getDefault(\"background-color\")};\r\n      }\r\n    `;\r\n\r\n    this._style = style;\r\n\r\n    let cb = this.colorbox = document.createElement(\"div\");\r\n    cb.style[\"width\"] = \"100%\";\r\n    cb.style[\"height\"] = this.getDefault(\"colorBoxHeight\") + \"px\";\r\n    cb.style[\"background-color\"] = \"black\";\r\n\r\n    this.shadow.appendChild(style);\r\n    this.field.ctx = this.ctx;\r\n\r\n    this.add(this.colorbox);\r\n    this.add(this.field);\r\n\r\n    this.style[\"width\"] = this.getDefault(\"width\") + \"px\";\r\n  }\r\n\r\n  updateColorBox() {\r\n    let r = this.field.rgba[0], g = this.field.rgba[1], b = this.field.rgba[2];\r\n    //let a = this.field.rgba[3];\r\n\r\n    r = ~~(r*255);\r\n    g = ~~(g*255);\r\n    b = ~~(b*255);\r\n\r\n    let css = `rgb(${r},${g},${b})`;\r\n    this.colorbox.style[\"background-color\"] = css;\r\n  }\r\n\r\n  _setSliders() {\r\n    if (this.h === undefined) {\r\n      //setDefault() wasn't called\r\n      console.warn(\"colorpicker ERROR\");\r\n      return;\r\n    }\r\n\r\n    let hsva = this.field.hsva;\r\n    this.h.setValue(hsva[0], false);\r\n    this.s.setValue(hsva[1], false);\r\n    this.v.setValue(hsva[2], false);\r\n    this.a.setValue(hsva[3], false);\r\n\r\n    let rgba = this.field.rgba;\r\n\r\n    this.r.setValue(rgba[0], false);\r\n    this.g.setValue(rgba[1], false);\r\n    this.b.setValue(rgba[2], false);\r\n    this.a2.setValue(rgba[3], false);\r\n\r\n    if (this.cmyk) {\r\n      let cmyk = this.field.getCMYK();\r\n\r\n      for (let i = 0; i < 4; i++) {\r\n        this.cmyk[i].setValue(cmyk[i], false);\r\n      }\r\n    }\r\n\r\n    this.updateColorBox();\r\n\r\n    if (!this._no_update_textbox) {\r\n      this.cssText.text = color2web(this.field.rgba);\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (val === undefined) {\r\n      //console.warn(\"Bad datapath\", this.getAttribute(\"datapath\"));\r\n      this.internalDisabled = true;\r\n      return;\r\n    }\r\n\r\n    this.internalDisabled = false;\r\n\r\n    _update_temp.load(val);\r\n\r\n    if (prop.type === PropTypes.VEC3) {\r\n      _update_temp[3] = 1.0;\r\n    }\r\n\r\n    if (_update_temp.vectorDistance(this.field.rgba) > 0.01) {\r\n      this.field.setRGBA(_update_temp[0], _update_temp[1], _update_temp[2], _update_temp[3], false);\r\n      this._setSliders();\r\n      this.field.update(true);\r\n    }\r\n  }\r\n\r\n  updateThemeOverride() {\r\n    let theme = this.getStyleClass();\r\n    if (theme === this._lastThemeStyle) {\r\n      return false;\r\n    }\r\n\r\n    this._lastThemeStyle = theme;\r\n    this.field.overrideClass(theme);\r\n\r\n    this.flushSetCSS();\r\n    this.flushUpdate();\r\n\r\n    return true;\r\n  }\r\n\r\n  update() {\r\n    this.updateThemeOverride();\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n\r\n    super.update();\r\n  }\r\n\r\n  _setDataPath() {\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n      if (prop === undefined) {\r\n        console.warn(\"Bad data path for color field:\", this.getAttribute(\"datapath\"));\r\n      }\r\n\r\n      let val = this.field.rgba;\r\n      if (prop !== undefined && prop.type === PropTypes.VEC3) {\r\n        val = new Vector3();\r\n        val.load(this.field.rgba);\r\n      }\r\n\r\n      this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), val);\r\n    }\r\n  }\r\n\r\n  getCMYK() {\r\n    return this.field.getCMYK();\r\n  }\r\n\r\n  setCMYK(c, m, y, k) {\r\n    this.field.setCMYK(c, m, y, k);\r\n    this._setSliders();\r\n    this._setDataPath();\r\n  }\r\n\r\n  setHSVA(h, s, v, a) {\r\n    this.field.setHSVA(h, s, v, a);\r\n    this._setSliders();\r\n    this._setDataPath();\r\n  }\r\n\r\n  getRGBA() {\r\n    return this.field.getRGBA();\r\n  }\r\n\r\n  setRGBA(r, g, b, a) {\r\n    this.field.setRGBA(r, g, b, a)\r\n    this._setSliders();\r\n    this._setDataPath();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ColorPicker);\r\n\r\n\r\nexport class ColorPickerButton extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._highlight = false;\r\n    this._depress = false;\r\n    this._label = \"error\";\r\n\r\n    this.customLabel = undefined;\r\n\r\n    this.rgba = new Vector4([1, 1, 1, 1]);\r\n\r\n    this.labelDom = document.createElement(\"span\");\r\n    this.labelDom.textContent = this._label;\r\n    this.dom = document.createElement(\"canvas\");\r\n    this.g = this.dom.getContext(\"2d\");\r\n\r\n    this.shadow.appendChild(this.labelDom);\r\n    this.shadow.appendChild(this.dom);\r\n  }\r\n\r\n  get label() {\r\n    return this._label;\r\n  }\r\n\r\n  set label(val) {\r\n    this._label = val;\r\n    this.labelDom.textContent = val;\r\n  }\r\n\r\n  get font() {\r\n    return this._font;\r\n  }\r\n\r\n  set font(val) {\r\n    this._font = val;\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  get noLabel() {\r\n    let ret = \"\" + this.getAttribute(\"no-label\");\r\n    ret = ret.toLowerCase();\r\n\r\n    return ret === \"true\" || ret === \"yes\" || ret === \"on\";\r\n  }\r\n\r\n  set noLabel(v) {\r\n    if (this.labelDom) {\r\n      this.labelDom.hidden = true; //will be deleted later\r\n    }\r\n\r\n    this.setAttribute(\"no-label\", v ? \"true\" : \"false\");\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname          : \"color-picker-button-x\",\r\n      style            : \"colorpickerbutton\",\r\n      havePickClipboard: true\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this._font = \"DefaultText\"; //this.getDefault(\"defaultFont\");\r\n\r\n    let enter = (e) => {\r\n      this._highlight = true;\r\n      this._redraw();\r\n    }\r\n\r\n    let leave = (e) => {\r\n      this._highlight = false;\r\n      this._redraw();\r\n    }\r\n\r\n    this.addEventListener(\"pointerover\", enter, {capture: true, passive: true});\r\n    this.addEventListener(\"pointerout\", leave, {capture: true, passive: true});\r\n    this.addEventListener(\"focus\", leave, {capture: true, passive: true});\r\n\r\n\r\n    this.addEventListener(\"mousedown\", (e) => {\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n\r\n      this.click(e);\r\n    });\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  clipboardCopy() {\r\n    colorClipboardCopy.apply(this, arguments);\r\n  }\r\n\r\n  clipboardPaste() {\r\n    colorClipboardPaste.apply(this, arguments);\r\n  }\r\n\r\n  getRGBA() {\r\n    return this.rgba;\r\n  }\r\n\r\n  click(e) {\r\n    this.abortToolTips(4000);\r\n    console.warn(\"CLICK COLORPICKER\");\r\n    this.blur();\r\n\r\n    if (this.onclick) {\r\n      this.onclick(e);\r\n    }\r\n\r\n    let colorpicker = this.ctx.screen.popup(this, this);\r\n    let ctx = contextWrangler.makeSafeContext(this.ctx);\r\n\r\n    colorpicker.ctx = ctx;\r\n    colorpicker.useDataPathUndo = this.useDataPathUndo;\r\n\r\n    let path = this.hasAttribute(\"datapath\") ? this.getAttribute(\"datapath\") : undefined;\r\n\r\n    let widget = colorpicker.colorPicker(path, undefined, this.getAttribute(\"mass_set_path\"));\r\n\r\n    widget.ctx = ctx;\r\n    widget._init();\r\n    widget.setRGBA(this.rgba[0], this.rgba[1], this.rgba[2], this.rgba[3]);\r\n\r\n    widget.style[\"padding\"] = \"20px\";\r\n\r\n    let onchange = () => {\r\n      this.rgba.load(widget.rgba);\r\n      this.redraw();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this);\r\n      }\r\n    }\r\n\r\n    widget.onchange = onchange;\r\n\r\n    colorpicker.style[\"background-color\"] = widget.getDefault(\"background-color\");\r\n    //colorpicker.style[\"border-radius\"] = \"25px\";\r\n    colorpicker.style[\"border-width\"] = widget.getDefault(\"border-width\");\r\n  }\r\n\r\n  setRGBA(val) {\r\n    let a = this.rgba[3];\r\n\r\n    let old = new Vector4(this.rgba);\r\n\r\n    this.rgba.load(val);\r\n\r\n    if (val.length < 4) {\r\n      this.rgba[3] = a;\r\n    }\r\n\r\n    if (this.rgba.vectorDistance(old) < 0.001) {\r\n      return;\r\n    }\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this.rgba);\r\n    }\r\n\r\n    if (this.onchange) {\r\n      this.onchange();\r\n    }\r\n\r\n    this._redraw();\r\n    return this;\r\n  }\r\n\r\n  on_disabled() {\r\n    this.setCSS();\r\n    this._redraw();\r\n  }\r\n\r\n  _redraw() {\r\n    let canvas = this.dom, g = this.g;\r\n\r\n    g.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    if (this.disabled) {\r\n      let color = \"rgb(55, 55, 55)\";\r\n\r\n      g.save();\r\n\r\n      ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"fill\", color);\r\n      ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"clip\");\r\n      let steps = 5;\r\n      let dt = canvas.width/steps, t = 0;\r\n\r\n      g.beginPath();\r\n      g.lineWidth = 2;\r\n      g.strokeStyle = \"black\";\r\n\r\n      for (let i = 0; i < steps; i++, t += dt) {\r\n        g.moveTo(t, 0);\r\n        g.lineTo(t + dt, canvas.height);\r\n        g.moveTo(t + dt, 0);\r\n        g.lineTo(t, canvas.height);\r\n      }\r\n\r\n      g.stroke();\r\n      g.restore();\r\n      return;\r\n    }\r\n\r\n    //do checker pattern for alpha\r\n    g.save();\r\n\r\n    let grid1 = \"rgb(100, 100, 100)\";\r\n    let grid2 = \"rgb(175, 175, 175)\";\r\n\r\n    ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"clip\");\r\n    ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"fill\", grid1);\r\n\r\n    let cellsize = 10;\r\n    let totx = Math.ceil(canvas.width/cellsize), toty = Math.ceil(canvas.height/cellsize);\r\n\r\n    ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"clip\", undefined, undefined, true);\r\n    g.clip();\r\n\r\n    g.beginPath();\r\n    for (let x = 0; x < totx; x++) {\r\n      for (let y = 0; y < toty; y++) {\r\n        if ((x + y) & 1) {\r\n          continue;\r\n        }\r\n\r\n        g.rect(x*cellsize, y*cellsize, cellsize, cellsize);\r\n      }\r\n    }\r\n\r\n    g.fillStyle = grid2;\r\n    g.fill();\r\n\r\n    //g.fillStyle = \"orange\";\r\n    //g.beginPath();\r\n    //g.rect(0, 0, canvas.width, canvas.height);\r\n    //g.fill();\r\n\r\n    let color = color2css(this.rgba);\r\n    ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"fill\", color, undefined, true);\r\n    //drawRoundBox(elem, canvas, g, width, height, r=undefined, op=\"fill\", color=undefined, pad=undefined) {\r\n\r\n    if (this._highlight) {\r\n      //let color = \"rgba(200, 200, 255, 0.5)\";\r\n      let color = this.getDefault(\"BoxHighlight\");\r\n      ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"fill\", color);\r\n    }\r\n\r\n    g.restore();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    let w = this.getDefault(\"width\");\r\n    let h = this.getDefault(\"height\");\r\n    let dpi = this.getDPI();\r\n\r\n    this.style[\"width\"] = \"min-contents\" + \"px\";\r\n    this.style[\"height\"] = h + \"px\";\r\n\r\n    this.style[\"flex-direction\"] = \"row\";\r\n    this.style[\"display\"] = \"flex\";\r\n\r\n    this.labelDom.style[\"color\"] = this.getDefault(this._font).color;\r\n    this.labelDom.style[\"font\"] = ui_base.getFont(this, undefined, this._font, false);\r\n\r\n    let canvas = this.dom;\r\n\r\n    canvas.style[\"width\"] = w + \"px\";\r\n    canvas.style[\"height\"] = h + \"px\";\r\n    canvas.width = ~~(w*dpi);\r\n    canvas.height = ~~(h*dpi);\r\n\r\n    this.style[\"background-color\"] = \"rgba(0,0,0,0)\";\r\n    this._redraw();\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!(this.hasAttribute(\"datapath\"))) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n    let prop = this.getPathMeta(this.ctx, path);\r\n\r\n    if ((prop === undefined || prop.data === undefined) && cconst.DEBUG.verboseDataPath) {\r\n      console.log(\"bad path\", path);\r\n      return;\r\n    } else if (prop === undefined) {\r\n      let redraw = !this.disabled;\r\n\r\n      this.internalDisabled = true;\r\n\r\n      if (redraw) {\r\n        this._redraw();\r\n      }\r\n      return;\r\n    }\r\n\r\n    let redraw = this.disabled;\r\n\r\n    this.internalDisabled = false;\r\n\r\n    if (this.customLabel === undefined && prop.uiname !== this._label) {\r\n      this.label = prop.uiname;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, path);\r\n\r\n    if (val === undefined) {\r\n      redraw = redraw || this.disabled !== true;\r\n\r\n      this.internalDisabled = true;\r\n\r\n      if (redraw) {\r\n        this._redraw();\r\n      }\r\n\r\n    } else {\r\n      this.internalDisabled = false;\r\n\r\n      let dis;\r\n\r\n      if (val.length === 3) {\r\n        dis = Vector3.prototype.vectorDistance.call(val, this.rgba);\r\n      } else {\r\n        dis = this.rgba.vectorDistance(val);\r\n      }\r\n\r\n      if (dis > 0.0001) {\r\n        if (prop.type === PropTypes.VEC3) {\r\n          this.rgba.load(val);\r\n          this.rgba[3] = 1.0;\r\n        } else {\r\n          this.rgba.load(val);\r\n        }\r\n\r\n        redraw = true;\r\n      }\r\n\r\n      if (redraw) {\r\n        this._redraw();\r\n      }\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    if (this.noLabel && this.labelDom.isConnected) {\r\n      this.labelDom.remove();\r\n    }\r\n\r\n    if (this.customLabel !== undefined && this.customLabel !== this._label) {\r\n      this.label = this.customLabel;\r\n    }\r\n\r\n    for (let i = 0; i < this.rgba.length; i++) {\r\n      if (this.rgba[i] === undefined) {\r\n        console.warn(\"corrupted color or alpha detected\", this.rgba);\r\n        this.rgba[i] = 1.0;\r\n      }\r\n    }\r\n\r\n    let key = \"\" + this.rgba[0].toFixed(4) + \" \" + this.rgba[1].toFixed(4) + \" \" + this.rgba[2].toFixed(4) + \" \" + this.rgba[3].toFixed(4);\r\n    key += this.disabled;\r\n\r\n    if (key !== this._last_key) {\r\n      this._last_key = key;\r\n      this.redraw();\r\n    }\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n  }\r\n\r\n  redraw() {\r\n    this._redraw();\r\n  }\r\n};\r\nUIBase.internalRegister(ColorPickerButton);\r\n","\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as ui from '../core/ui.js';\r\nimport {loadUIData, saveUIData} from '../core/ui_base.js';\r\nimport {keymap} from '../path-controller/util/events.js';\r\n\r\nlet UIBase      = ui_base.UIBase,\r\n    PackFlags   = ui_base.PackFlags,\r\n    IconSheets  = ui_base.IconSheets,\r\n    iconmanager = ui_base.iconmanager;\r\n\r\nexport let tab_idgen = 1;\r\nlet debug = false;\r\nlet Vector2 = vectormath.Vector2;\r\n\r\nfunction getpx(css) {\r\n  return parseFloat(css.trim().replace(\"px\", \"\"))\r\n}\r\n\r\nlet FAKE_TAB_ID = Symbol(\"fake_tab_id\");\r\n\r\n\r\nclass TabDragEvent extends PointerEvent {\r\n}\r\n\r\n\r\n/* subclass HTMLElement so tabs can be used as the .target\r\n*  member of events*/\r\nexport class TabItem extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.name = name;\r\n    this.icon = undefined;\r\n    this.tooltip = \"\";\r\n    this.movable = true;\r\n    this.tbar = undefined;\r\n\r\n    this.ontabclick = null;\r\n    this.ontabdragstart = null;\r\n    this.ontabdragmove = null;\r\n    this.ontabdragend = null;\r\n\r\n    let helper = (key) => {\r\n      let key2 = \"on\" + key;\r\n\r\n      this.addEventListener(key, (e) => {\r\n        if (this[key2]) {\r\n          return this[key2](e);\r\n        }\r\n      });\r\n    }\r\n\r\n    helper(\"tabclick\");\r\n    helper(\"tabdragstart\");\r\n    helper(\"tabdragmove\");\r\n    helper(\"tabdragend\");\r\n\r\n    this.dom = undefined;\r\n    this.extra = undefined;\r\n    this.extraSize = undefined;\r\n\r\n    this.size = new Vector2();\r\n    this.pos = new Vector2();\r\n\r\n    this.abssize = new Vector2();\r\n    this.abspos = new Vector2();\r\n\r\n\r\n    this.addEventListener(\"pointerdown\", (e) => {\r\n      this.parentWidget.on_pointerdown(e);\r\n    });\r\n\r\n    this.addEventListener(\"pointermove\", (e) => {\r\n      this.parentWidget.on_pointermove(e);\r\n    });\r\n\r\n    this.addEventListener(\"pointerup\", (e) => {\r\n      this.parentWidget.on_pointerup(e);\r\n    });\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap.Enter:\r\n        case keymap.Space:\r\n          this.parentWidget.setActive(this, e);\r\n          break;\r\n      }\r\n    });\r\n  }\r\n\r\n  init() {\r\n    this.tabIndex = 1;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"tab-item-x\"\r\n    }\r\n  }\r\n\r\n  sendEvent(type, forwardEvent) {\r\n    let cls;\r\n\r\n    if (type === \"tabdragstart\" || type === \"tabdragend\") {\r\n      cls = TabDragEvent;\r\n    } else if (forwardEvent && forwardEvent instanceof Event) {\r\n      cls = forwardEvent.constructor;\r\n    } else {\r\n      cls = PointerEvent;\r\n    }\r\n\r\n    let e2 = {};\r\n\r\n    if (forwardEvent) {\r\n      for (let k in forwardEvent) {\r\n        if (k === \"defaultPrevented\" || k === \"cancelBubble\") {\r\n          continue;\r\n        }\r\n\r\n        e2[k] = forwardEvent[k];\r\n      }\r\n    }\r\n\r\n    e2.target = this;\r\n\r\n    e2 = new cls(type, e2);\r\n\r\n    this.dispatchEvent(e2);\r\n    return e2;\r\n  }\r\n\r\n  getClientRects() {\r\n    let r = this.tbar.getClientRects()[0];\r\n\r\n    let s = this.abssize, p = this.abspos;\r\n\r\n    s.load(this.size);\r\n    p.load(this.pos);\r\n\r\n    if (r) {\r\n      p[0] += r.x;\r\n      p[1] += r.y;\r\n    }\r\n\r\n    return [{\r\n      x  : p[0], y: p[1], width: s[0], height: s[1], left: p[0],\r\n      top: p[1], right: p[0] + s[0], bottom: p[1] + s[1]\r\n    }];\r\n  }\r\n\r\n  setCSS() {\r\n    let dpi = UIBase.getDPI();\r\n    let x = this.pos[0]/dpi;\r\n    let y = this.pos[1]/dpi;\r\n    let w = this.size[0]/dpi;\r\n    let h = this.size[1]/dpi;\r\n\r\n    if (this == this.parentWidget.tabs.active) {\r\n      this.style[\"focus-border-width\"] = \"0px\";\r\n    } else {\r\n      this.style[\"focus-border-width\"] = \"2px\";\r\n    }\r\n\r\n    this.style[\"background-color\"] = \"transparent\";\r\n\r\n    this.style[\"margin\"] = this.style[\"padding\"] = \"0px\";\r\n    this.style[\"position\"] = \"absolute\";\r\n    this.style[\"pointer-events\"] = \"auto\";\r\n\r\n    this.style[\"left\"] = x + \"px\";\r\n    this.style[\"top\"] = y + \"px\";\r\n    this.style[\"width\"] = w + \"px\";\r\n    this.style[\"height\"] = h + \"px\";\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(TabItem);\r\n\r\nexport class ModalTabMove extends events.EventHandler {\r\n  constructor(tab, tbar, dom) {\r\n    super();\r\n\r\n    this.dom = dom;\r\n    this.tab = tab;\r\n    this.tbar = tbar;\r\n    this.first = true;\r\n\r\n    this.droptarget = undefined;\r\n    this.start_mpos = new Vector2();\r\n    this.mpos = undefined;\r\n\r\n    this.dragtab = undefined;\r\n    this.dragstate = false;\r\n    this.finished = false;\r\n  }\r\n\r\n  finish() {\r\n    if (debug) if (debug) console.log(\"finish\");\r\n\r\n    if (this.finished) {\r\n      return;\r\n    }\r\n\r\n    this.finished = true;\r\n\r\n    if (this.tbar.tool === this) {\r\n      this.tbar.tool = undefined;\r\n    }\r\n\r\n    this.popModal(this.dom);\r\n    this.tbar.update(true);\r\n  }\r\n\r\n  popModal() {\r\n    if (this.dragcanvas !== undefined) {\r\n      this.dragcanvas.remove();\r\n    }\r\n    let ret = super.popModal(...arguments);\r\n\r\n    this.tab.sendEvent(\"tabdragend\");\r\n\r\n    return ret;\r\n  }\r\n\r\n  on_pointerleave(e) {\r\n  }\r\n\r\n  on_pointerenter(e) {\r\n  }\r\n\r\n  on_pointerenter(e) {\r\n  }\r\n\r\n  on_pointerstart(e) {\r\n  }\r\n\r\n  on_pointerend(e) {\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    this.finish();\r\n  }\r\n\r\n  on_pointercancel(e) {\r\n    this.finish();\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    this.finish();\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    return this._on_move(e, e.x, e.y);\r\n  }\r\n\r\n  _dragstate(e, x, y) {\r\n    this.dragcanvas.style[\"left\"] = x + \"px\";\r\n    this.dragcanvas.style[\"top\"] = y + \"px\";\r\n\r\n    let ctx = this.tbar.ctx;\r\n    let screen = ctx.screen;\r\n    let elem = screen.pickElement(x, y);\r\n\r\n    let e2 = new DragEvent(\"dragenter\", this.dragevent);\r\n    if (elem !== this.droptarget) {\r\n      let e2 = new DragEvent(\"dragexit\", this.dragevent);\r\n      if (this.droptarget) {\r\n        this.droptarget.dispatchEvent(e2);\r\n      }\r\n\r\n      e2 = new DragEvent(\"dragover\", this.dragevent);\r\n      this.droptarget = elem;\r\n      if (elem) {\r\n        elem.dispatchEvent(e2);\r\n      }\r\n    }\r\n    //console.log(elem);\r\n  }\r\n\r\n  _on_move(e, x, y) {\r\n    let r = this.tbar.getClientRects()[0];\r\n    let dpi = UIBase.getDPI();\r\n\r\n    if (r === undefined) {\r\n      //element was removed during/before move\r\n      this.finish();\r\n      return;\r\n    }\r\n\r\n    if (this.dragstate) {\r\n      this._dragstate(e, x, y);\r\n      return;\r\n    }\r\n\r\n    x -= r.x;\r\n    y -= r.y;\r\n\r\n    let dx, dy;\r\n\r\n    x *= dpi;\r\n    y *= dpi;\r\n\r\n    if (this.first) {\r\n      this.first = false;\r\n      this.start_mpos[0] = x;\r\n      this.start_mpos[1] = y;\r\n    }\r\n    if (this.mpos === undefined) {\r\n      this.mpos = [0, 0];\r\n      dx = dy = 0;\r\n    } else {\r\n      dx = x - this.mpos[0];\r\n      dy = y - this.mpos[1];\r\n    }\r\n\r\n    if (debug) console.log(x, y, dx, dy);\r\n\r\n    let tab = this.tab, tbar = this.tbar;\r\n    let axis = tbar.horiz ? 0 : 1;\r\n    let distx, disty;\r\n\r\n    if (tbar.horiz) {\r\n      tab.pos[0] += dx;\r\n      disty = Math.abs(y - this.start_mpos[1]);\r\n    } else {\r\n      tab.pos[1] += dy;\r\n      disty = Math.abs(x - this.start_mpos[0]);\r\n    }\r\n\r\n    let limit = 50;\r\n    let csize = tbar.horiz ? this.tbar.canvas.width : this.tbar.canvas.height;\r\n\r\n    let dragok = tab.pos[axis] + tab.size[axis] < -limit || tab.pos[axis] >= csize + limit;\r\n    dragok = dragok || disty > limit*1.5;\r\n    dragok = dragok && (this.tbar.draggable || this.tbar.getAttribute(\"draggable\"));\r\n\r\n    //console.log(dragok, disty, this.tbar.draggable);\r\n\r\n    if (dragok) {\r\n      this.dragstate = true;\r\n      this.dragevent = new DragEvent(\"dragstart\", {\r\n        dataTransfer: new DataTransfer()\r\n      });\r\n\r\n      this.dragtab = tab;\r\n      let g = this.tbar.g;\r\n      this.dragimg = g.getImageData(~~tab.pos[0], ~~tab.pos[1], ~~tab.size[0], ~~tab.size[1]);\r\n      this.dragcanvas = document.createElement(\"canvas\");\r\n      let g2 = this.drag_g = this.dragcanvas.getContext(\"2d\");\r\n\r\n      this.dragcanvas.visibleToPick = false;\r\n      this.dragcanvas.width = ~~tab.size[0];\r\n      this.dragcanvas.height = ~~tab.size[1];\r\n      this.dragcanvas.style[\"width\"] = (tab.size[0]/dpi) + \"px\";\r\n      this.dragcanvas.style[\"height\"] = (tab.size[1]/dpi) + \"px\";\r\n      this.dragcanvas.style[\"position\"] = UIBase.PositionKey;\r\n      this.dragcanvas.style[\"left\"] = e.x + \"px\";\r\n      this.dragcanvas.style[\"top\"] = e.y + \"px\";\r\n      this.dragcanvas.style[\"z-index\"] = \"500\";\r\n      document.body.appendChild(this.dragcanvas);\r\n      g2.putImageData(this.dragimg, 0, 0);\r\n\r\n\r\n      this.tbar.dispatchEvent(this.dragevent);\r\n\r\n      return;\r\n    }\r\n\r\n    let ti = tbar.tabs.indexOf(tab);\r\n    let next = ti < tbar.tabs.length - 1 ? tbar.tabs[ti + 1] : undefined;\r\n    let prev = ti > 0 ? tbar.tabs[ti - 1] : undefined;\r\n\r\n    if (next !== undefined && next.movable && tab.pos[axis] > next.pos[axis]) {\r\n      tbar.swapTabs(tab, next);\r\n    } else if (prev !== undefined && prev.movable && tab.pos[axis] < prev.pos[axis] + prev.size[axis]*0.5) {\r\n      tbar.swapTabs(tab, prev);\r\n    }\r\n\r\n    tbar.update(true);\r\n\r\n    this.mpos[0] = x;\r\n    this.mpos[1] = y;\r\n\r\n    let e2 = tab.sendEvent(\"tabdragmove\", e);\r\n\r\n    if (e2.defaultPrevented) {\r\n      this.finish();\r\n    }\r\n  }\r\n\r\n  on_keydown(e) {\r\n    if (debug) console.log(e.keyCode);\r\n\r\n    switch (e.keyCode) {\r\n      case keymap.Escape: //escape\r\n      case keymap.Space: //space\r\n      case keymap.Enter: //enter\r\n      case keymap.Tab: //tab\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\nexport class TabBar extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    let style = document.createElement(\"style\");\r\n    let canvas = document.createElement(\"canvas\");\r\n\r\n    this.iconsheet = 0;\r\n    this.movableTabs = true;\r\n\r\n    this.tabFontScale = 1.0;\r\n\r\n    this.tabs = [];\r\n    this.tabs.active = undefined;\r\n    this.tabs.highlight = undefined;\r\n\r\n    this._last_style_key = undefined;\r\n\r\n    canvas.style[\"width\"] = \"145px\";\r\n    canvas.style[\"height\"] = \"45px\";\r\n\r\n    this.r = this.getDefault(\"TabBarRadius\", undefined, 8);\r\n\r\n    this.canvas = canvas;\r\n    this.g = canvas.getContext(\"2d\");\r\n\r\n    this.canvas.style[\"touch-action\"] = \"none\";\r\n\r\n    style.textContent = `\r\n    `;\r\n\r\n    this.shadow.appendChild(style);\r\n    this.shadow.appendChild(canvas);\r\n\r\n    this._last_dpi = undefined;\r\n    this._last_pos = undefined;\r\n\r\n    this.horiz = true;\r\n    this.onchange = null;\r\n    this.onselect = null; //onselect is like onchange, but fires even if tab hasn't changed\r\n\r\n    let mx, my;\r\n\r\n    this.canvas.addEventListener(\"pointermove\", (e) => {\r\n      this.on_pointermove(e);\r\n    }, false);\r\n\r\n\r\n    this.canvas.addEventListener(\"pointerdown\", (e) => {\r\n      this.on_pointerdown(e);\r\n    });\r\n  }\r\n\r\n  _doelement(e, mx, my) {\r\n    for (let tab of this.tabs) {\r\n      let ok;\r\n\r\n      if (this.horiz) {\r\n        ok = mx >= tab.pos[0] && mx <= tab.pos[0] + tab.size[0];\r\n      } else {\r\n        ok = my >= tab.pos[1] && my <= tab.pos[1] + tab.size[1];\r\n      }\r\n\r\n      if (ok && this.tabs.highlight !== tab) {\r\n        this.tabs.highlight = tab;\r\n        this.update(true);\r\n      }\r\n    }\r\n  }\r\n\r\n  _domouse(e) {\r\n    let r = this.canvas.getClientRects()[0];\r\n\r\n    let mx = e.x - r.x;\r\n    let my = e.y - r.y;\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    mx *= dpi;\r\n    my *= dpi;\r\n\r\n    this._doelement(e, mx, my);\r\n\r\n    const is_mdown = e.type === \"mousedown\" || e.type == \"pointerdown\";\r\n    if (is_mdown && this.onselect && this._fireOnSelect().defaultPrevented) {\r\n      e.preventDefault();\r\n    }\r\n  }\r\n\r\n  _doclick(e) {\r\n    this._domouse(e);\r\n\r\n    if (e.defaultPrevented) {\r\n      return;\r\n    }\r\n\r\n    if (debug) console.log(\"mdown\");\r\n\r\n    if (e.button !== 0) {\r\n      return;\r\n    }\r\n\r\n    let ht = this.tabs.highlight;\r\n\r\n    let acte = {};\r\n    for (let k in e) {\r\n      if (k === \"defaultPrevented\" || k === \"cancelBubble\") {\r\n        continue;\r\n      }\r\n\r\n      acte[k] = e[k];\r\n    }\r\n\r\n    acte.target = ht;\r\n    acte.pointerId = e.pointerId;\r\n\r\n    acte = new PointerEvent(\"tabactive\", acte);\r\n\r\n    let e2 = ht.sendEvent(\"tabclick\", e);\r\n\r\n    if (e2.defaultPrevented) {\r\n      acte.preventDefault();\r\n    }\r\n\r\n    if (ht !== undefined && this.tool === undefined) {\r\n      this.setActive(ht, acte);\r\n\r\n      if (this.movableTabs && !acte.defaultPrevented) {\r\n        this._startMove(ht, e);\r\n      }\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    this._doclick(e);\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let r = this.canvas.getClientRects()[0];\r\n    this._domouse(e);\r\n\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n  }\r\n\r\n  on_pointerup(e) {\r\n\r\n  }\r\n\r\n\r\n  static setDefault(e) {\r\n    e.setAttribute(\"bar_pos\", \"top\");\r\n    e.updatePos(true);\r\n\r\n    return e;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"tabbar-x\",\r\n      style  : \"tabs\"\r\n    };\r\n  }\r\n\r\n  _ensureNoModal() {\r\n    if (this.tool) {\r\n      this.tool.finish();\r\n      this.tool = undefined;\r\n    }\r\n  }\r\n\r\n  get tool() {\r\n    return this._tool;\r\n  }\r\n\r\n  set tool(v) {\r\n    //console.warn(\"SET TOOL\", v, this._id);\r\n    this._tool = v;\r\n  }\r\n\r\n  _startMove(tab = this.tabs.active, event, pointerId = event ? event.pointerId : undefined, pointerElem = tab) {\r\n    if (this.movableTabs) {\r\n      let e2 = tab.sendEvent(\"tabdragstart\", event);\r\n\r\n      if (e2.defaultPrevented) {\r\n        return;\r\n      }\r\n\r\n      if (this.tool) {\r\n        this.tool.finish();\r\n      }\r\n\r\n      let edom = this.getScreen();\r\n      let tool = this.tool = new ModalTabMove(tab, this, edom);\r\n\r\n      if (event && pointerElem && pointerId !== undefined) {\r\n        tool.pushPointerModal(pointerElem, pointerId);\r\n      } else {\r\n        tool.pushModal(edom, false);\r\n      }\r\n    }\r\n  }\r\n\r\n  _fireOnSelect() {\r\n    let e = this._makeOnSelectEvt();\r\n\r\n    if (this.onselect) {\r\n      this.onselect(e);\r\n    }\r\n\r\n    return e;\r\n  }\r\n\r\n  _makeOnSelectEvt() {\r\n    return {\r\n      tab             : this.tabs.highlight,\r\n      defaultPrevented: false,\r\n      preventDefault() {\r\n        this.defaultPrevented = true;\r\n      }\r\n    }\r\n    /*\r\n      return new MouseEvent(\"mousedown\", {\r\n        target : [this.tabs.highlight],\r\n        tab : \"sdfdsf\"\r\n      });\r\n\r\n   */\r\n  }\r\n\r\n  getTab(name_or_id) {\r\n    for (let tab of this.tabs) {\r\n      if (tab.id === name_or_id || tab.name === name_or_id)\r\n        return tab;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  clear() {\r\n    for (let t of this.tabs) {\r\n      if (t.dom) {\r\n        t.dom.remove();\r\n      }\r\n\r\n      t.remove();\r\n    }\r\n\r\n    this.tabs = [];\r\n    this.setCSS();\r\n    this._redraw();\r\n  }\r\n\r\n  saveData() {\r\n    let taborder = [];\r\n\r\n    for (let tab of this.tabs) {\r\n      taborder.push(tab.name);\r\n    }\r\n\r\n    let act = this.tabs.active !== undefined ? this.tabs.active.name : \"null\";\r\n\r\n    return {\r\n      taborder: taborder,\r\n      active  : act\r\n    };\r\n  }\r\n\r\n  loadData(obj) {\r\n    if (!obj.taborder) {\r\n      return;\r\n    }\r\n\r\n    let tabs = this.tabs;\r\n    let active = undefined;\r\n    let ntabs = [];\r\n\r\n    ntabs.active = undefined;\r\n    ntabs.highlight = undefined;\r\n\r\n    for (let tname of obj.taborder) {\r\n      let tab = this.getTab(tname);\r\n\r\n      if (tab === undefined) {\r\n        continue;\r\n      }\r\n\r\n      if (tab.name === obj.active) {\r\n        active = tab;\r\n      }\r\n\r\n      ntabs.push(tab);\r\n    }\r\n\r\n    for (let tab of tabs) {\r\n      if (ntabs.indexOf(tab) < 0) {\r\n        ntabs.push(tab);\r\n      }\r\n    }\r\n\r\n    this.tabs = ntabs;\r\n\r\n    try {\r\n      if (active !== undefined) {\r\n        this.setActive(active);\r\n      } else if (this.tabs.length > 0) {\r\n        this.setActive(this.tabs[0]);\r\n      }\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n    }\r\n\r\n    this.update(true);\r\n\r\n    return this;\r\n  }\r\n\r\n  swapTabs(a, b) {\r\n    let tabs = this.tabs;\r\n\r\n    let ai = tabs.indexOf(a);\r\n    let bi = tabs.indexOf(b);\r\n\r\n    tabs[ai] = b;\r\n    tabs[bi] = a;\r\n\r\n    this.update(true);\r\n  }\r\n\r\n  addIconTab(icon, id, tooltip, movable = true) {\r\n    let tab = this.addTab(\"\", id, tooltip, movable);\r\n    tab.icon = icon;\r\n\r\n    return tab;\r\n  }\r\n\r\n  addTab(name, id, tooltip = \"\", movable) {\r\n    let tab = UIBase.createElement(\"tab-item-x\", true);\r\n\r\n    this.shadow.appendChild(tab);\r\n    tab.parentWidget = this;\r\n\r\n\r\n    tab.name = name;\r\n    tab.id = id;\r\n    tab.tooltip = tooltip;\r\n    tab.movable = movable;\r\n    tab.tbar = this;\r\n\r\n    this.tabs.push(tab);\r\n    this.update(true);\r\n\r\n    if (this.tabs.length === 1) {\r\n      this.setActive(this.tabs[0]);\r\n    }\r\n\r\n    return tab;\r\n  }\r\n\r\n  updatePos(force_update = false) {\r\n    let pos = this.getAttribute(\"bar_pos\");\r\n\r\n    if (pos !== this._last_pos || force_update) {\r\n      this._last_pos = pos;\r\n\r\n      this.horiz = pos === \"top\" || pos === \"bottom\";\r\n      if (debug) console.log(\"tab bar position update\", this.horiz);\r\n\r\n      if (this.horiz) {\r\n        this.style[\"width\"] = \"100%\";\r\n        delete this.style[\"height\"];\r\n      } else {\r\n        this.style[\"height\"] = \"100%\";\r\n        delete this.style[\"width\"];\r\n      }\r\n\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  updateDPI(force_update = false) {\r\n    let dpi = this.getDPI();\r\n\r\n    if (dpi !== this._last_dpi) {\r\n      if (debug) console.log(\"DPI update!\");\r\n      this._last_dpi = dpi;\r\n\r\n      this.updateCanvas(true);\r\n    }\r\n  }\r\n\r\n  updateCanvas(force_update = false) {\r\n    let canvas = this.canvas;\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let rwidth = getpx(this.canvas.style[\"width\"]);\r\n    let rheight = getpx(this.canvas.style[\"height\"]);\r\n\r\n    let width = ~~(rwidth*dpi);\r\n    let height = ~~(rheight*dpi);\r\n\r\n    let update = force_update;\r\n    update = update || canvas.width !== width || canvas.height !== height;\r\n\r\n    if (update) {\r\n      canvas.width = width;\r\n      canvas.height = height;\r\n\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _getFont(tsize) {\r\n    let font = this.getDefault(\"TabText\");\r\n\r\n    if (this.tabFontScale !== 1.0) {\r\n      font = font.copy();\r\n      font.size *= this.tabFontScale;\r\n    }\r\n\r\n    return font;\r\n  }\r\n\r\n  _layout() {\r\n    if ((!this.ctx || !this.ctx.screen) && !this.isDead()) {\r\n      this.doOnce(this._layout);\r\n    }\r\n\r\n    let g = this.g;\r\n\r\n    if (debug) console.log(\"tab layout\");\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let font = this._getFont();\r\n    let tsize = (font.size*dpi);\r\n\r\n    g.font = font.genCSS(tsize);\r\n\r\n    let axis = this.horiz ? 0 : 1;\r\n\r\n    let pad = 4*dpi + Math.ceil(tsize*0.25);\r\n    let hpad = this.getDefault(\"TabPadding\", undefined, 0.0);\r\n\r\n    let x = pad;\r\n    let y = 0.0;\r\n\r\n    let h = tsize + Math.ceil(tsize*0.5) + hpad;\r\n    let iconsize = iconmanager.getTileSize(this.iconsheet);\r\n    let have_icons = false;\r\n\r\n    for (let tab of this.tabs) {\r\n      if (tab.icon !== undefined) {\r\n        have_icons = true;\r\n        h = Math.max(h, iconsize + 4);\r\n        break;\r\n      }\r\n    }\r\n\r\n    let r1 = this.parentWidget ? this.parentWidget.getClientRects()[0] : undefined;\r\n    let r2 = this.canvas.getClientRects()[0];\r\n\r\n    let rx = 0, ry = 0;\r\n    if (r2) {\r\n      rx = r2.x;//r2.x - r1.x;\r\n      ry = r2.y; //r2.y - r1.y;\r\n    }\r\n\r\n    let ti = -1;\r\n\r\n    let makeTabWatcher = (tab) => {\r\n      if (tab.watcher) {\r\n        clearInterval(tab.watcher.timer);\r\n      }\r\n\r\n      let watcher = () => {\r\n        let dead = this.tabs.indexOf(tab) < 0;\r\n        dead = dead || this.isDead();\r\n\r\n        if (dead) {\r\n          if (tab.dom)\r\n            tab.dom.remove();\r\n          tab.dom = undefined;\r\n\r\n          if (tab.watcher.timer)\r\n            clearInterval(tab.watcher.timer);\r\n        }\r\n      };\r\n\r\n      tab.watcher = watcher;\r\n      tab.watcher.timer = window.setInterval(watcher, 750);\r\n\r\n      return tab.watcher.timer;\r\n    };\r\n\r\n    let haveTabDom = false;\r\n    for (let tab of this.tabs) {\r\n      if (tab.extra) {\r\n        haveTabDom = true;\r\n      }\r\n    }\r\n\r\n    if (haveTabDom && this.ctx && this.ctx.screen && !this._size_cb) {\r\n      this._size_cb = () => {\r\n        if (this.isDead()) {\r\n          this.ctx.screen.removeEventListener(\"resize\", this._size_cb);\r\n          this._size_cb = undefined;\r\n          return;\r\n        }\r\n        if (!this.ctx) return;\r\n\r\n        this._layout();\r\n        this._redraw();\r\n      };\r\n\r\n      this.ctx.screen.addEventListener(\"resize\", this._size_cb);\r\n    }\r\n\r\n    for (let tab of this.tabs) {\r\n      ti++;\r\n\r\n      if (tab.extra && !tab.dom) {\r\n\r\n        tab.dom = document.createElement(\"div\");\r\n        tab.dom.style[\"margin\"] = tab.dom.style[\"padding\"] = \"0px\";\r\n\r\n        //XXX breaks mobile\r\n        //let z = this.calcZ();\r\n        //tab.dom.style[\"z-index\"] = z - 1 - ti;\r\n\r\n        document.body.appendChild(tab.dom);\r\n        tab.dom.style[\"position\"] = UIBase.PositionKey;\r\n        tab.dom.style[\"display\"] = \"flex\";\r\n        tab.dom.style[\"flex-direction\"] = this.horiz ? \"row\" : \"column\";\r\n\r\n        tab.dom.style[\"pointer-events\"] = \"none\";\r\n\r\n        if (!this.horiz) {\r\n          tab.dom.style[\"width\"] = (tab.size[0]/dpi) + \"px\";\r\n          tab.dom.style[\"height\"] = (tab.size[1]/dpi) + \"px\";\r\n          tab.dom.style[\"left\"] = (rx + tab.pos[0]/dpi) + \"px\";\r\n          tab.dom.style[\"top\"] = (ry + tab.pos[1]/dpi) + \"px\";\r\n        } else {\r\n          tab.dom.style[\"width\"] = (tab.size[0]/dpi) + \"px\";\r\n          tab.dom.style[\"height\"] = (tab.size[1]/dpi) + \"px\";\r\n          tab.dom.style[\"left\"] = (rx + tab.pos[0]/dpi) + \"px\";\r\n          tab.dom.style[\"top\"] = (ry + tab.pos[1]/dpi) + \"px\";\r\n        }\r\n\r\n        let font = this._getFont();\r\n        tab.dom.style[\"font\"] = font.genCSS();\r\n        tab.dom.style[\"color\"] = font.color;\r\n\r\n        tab.dom.appendChild(tab.extra);\r\n\r\n        //tab.dom.style[\"background-color\"] = \"red\";\r\n\r\n        makeTabWatcher(tab);\r\n      }\r\n\r\n      let w = g.measureText(tab.name).width;\r\n\r\n      if (tab.extra) {\r\n        w += tab.extraSize || tab.extra.getClientRects()[0].width;\r\n\r\n      }\r\n\r\n      if (tab.icon !== undefined) {\r\n        w += iconsize;\r\n      }\r\n\r\n      //don't interfere with tab dragging\r\n      let bad = this.tool !== undefined && tab === this.tabs.active;\r\n\r\n      if (!bad) {\r\n        tab.pos[axis] = x;\r\n        tab.pos[axis ^ 1] = y;\r\n      }\r\n\r\n      //tab.size = [0, 0];\r\n      tab.size[axis] = w + pad*2;\r\n      tab.size[axis ^ 1] = h;\r\n\r\n      x += w + pad*2;\r\n    }\r\n\r\n    x = (~~(x + pad))/dpi;\r\n    h = (~~h)/dpi;\r\n\r\n\r\n    if (this.horiz) {\r\n      this.canvas.style[\"width\"] = x + \"px\";\r\n      this.canvas.style[\"height\"] = h + \"px\";\r\n    } else {\r\n      this.canvas.style[\"height\"] = x + \"px\";\r\n      this.canvas.style[\"width\"] = h + \"px\";\r\n    }\r\n\r\n    for (let tab of this.tabs) {\r\n      tab.setCSS();\r\n    }\r\n\r\n    //this.canvas.width = x;\r\n  }\r\n\r\n  /** tab is a TabItem instance */\r\n  setActive(tab, event) {\r\n    if (tab.noSwitch) {\r\n      return;\r\n    }\r\n\r\n    let update = tab !== this.tabs.active;\r\n    this.tabs.active = tab;\r\n\r\n    if (update) {\r\n      if (!util.isMobile() && this.getDefault(\"focus-on-tab-click\")) {\r\n        tab.focus({preventScroll: true, focusVisible: false});\r\n      }\r\n\r\n      if (this.onchange)\r\n        this.onchange(tab, event);\r\n\r\n      this.update(true);\r\n    }\r\n  }\r\n\r\n  _redraw() {\r\n    let g = this.g;\r\n\r\n    let activecolor = this.getDefault(\"TabActive\") || \"rgba(0,0,0,0)\";\r\n\r\n    if (debug) console.log(\"tab draw\");\r\n\r\n    g.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n\r\n    let dpi = this.getDPI();\r\n    let font = this._getFont();\r\n\r\n    let tsize = font.size;\r\n    let iconsize = iconmanager.getTileSize(this.iconsheet);\r\n\r\n    tsize = (tsize*dpi);\r\n    g.font = font.genCSS(tsize);\r\n\r\n    g.lineWidth = 2;\r\n    g.strokeStyle = this.getDefault(\"TabStrokeStyle1\");\r\n\r\n    let r = this.r*dpi;\r\n    this._layout();\r\n    let tab;\r\n\r\n    const draw_text = (name, x2, y2) => {\r\n      let hpad = this.getDefault(\"TabPadding\", undefined, 0.0);\r\n      if (this.horiz) {\r\n        y2 += hpad*0.5;\r\n      } else {\r\n        y2 -= hpad*0.5;\r\n      }\r\n\r\n      g.fillText(tab.name, x2, y2);\r\n    };\r\n\r\n    let ti = -1;\r\n    for (tab of this.tabs) {\r\n      ti++;\r\n\r\n      if (tab === this.tabs.active)\r\n        continue;\r\n\r\n      let x = tab.pos[0], y = tab.pos[1];\r\n      let w = tab.size[0], h = tab.size[1];\r\n      //let tw = g.measureText(tab.name).width;\r\n      let tw = ui_base.measureText(this, tab.name, this.canvas, g, tsize, font).width;\r\n\r\n      let x2 = x + (tab.size[this.horiz ^ 1] - tw)*0.5;\r\n      let y2 = y + tsize;\r\n\r\n      if (tab === this.tabs.highlight) {\r\n        let p = 2;\r\n\r\n        g.beginPath();\r\n        g.rect(x + p, y + p, w - p*2, h - p*2);\r\n        g.fillStyle = this.getDefault(\"TabHighlight\");\r\n        g.fill();\r\n      }\r\n\r\n      g.fillStyle = this.getDefault(\"TabText\").color;\r\n\r\n      if (!this.horiz) {\r\n        let x3 = 0, y3 = y2;\r\n\r\n        g.save();\r\n        g.translate(x3, y3);\r\n        g.rotate(Math.PI/2);\r\n        g.translate(x3 - tsize, -y3 - tsize*0.5);\r\n      }\r\n\r\n      if (tab.icon !== undefined) {\r\n        iconmanager.canvasDraw(this, this.canvas, g, tab.icon, x, y, this.iconsheet);\r\n        x2 += iconsize + 4;\r\n      }\r\n\r\n      draw_text(tab.name, x2, y2);\r\n\r\n      if (!this.horiz) {\r\n        g.restore();\r\n      }\r\n\r\n      let prev = this.tabs[Math.max(ti - 1 + this.tabs.length, 0)];\r\n      let next = this.tabs[Math.min(ti + 1, this.tabs.length - 1)];\r\n\r\n      if (tab !== this.tabs[this.tabs.length - 1] && prev !== this.tabs.active && next !== this.tabs.active) {\r\n        g.beginPath();\r\n        if (this.horiz) {\r\n          g.moveTo(x + w, h - 5);\r\n          g.lineTo(x + w, 5);\r\n        } else {\r\n          g.moveTo(w - 5, y + h);\r\n          g.lineTo(5, y + h);\r\n        }\r\n        g.strokeStyle = this.getDefault(\"TabStrokeStyle1\");\r\n        g.stroke();\r\n      }\r\n    }\r\n\r\n    let th = tsize;\r\n\r\n    //draw active tab\r\n    tab = this.tabs.active;\r\n    if (tab) {\r\n      let x = tab.pos[0], y = tab.pos[1];\r\n      let w = tab.size[0], h = tab.size[1];\r\n      //let tw = g.measureText(tab.name).width;\r\n      let tw = ui_base.measureText(this, tab.name, this.canvas, g, tsize, font).width;\r\n\r\n      if (this.horiz) {\r\n        h += 2;\r\n      } else {\r\n        w += 2;\r\n      }\r\n\r\n      let x2 = x + (tab.size[this.horiz ^ 1] - tw)*0.5;\r\n      let y2 = y + tsize;\r\n\r\n      if (tab === this.tabs.active) {\r\n        /*\r\n        let x = !this.horiz ? tab.y : tab.x;\r\n        let y = !this.horiz ? tab.x : tab.y;\r\n        let w = !this.horiz ? tab.size[1] : tab.size[0];\r\n        let h = !this.horiz ? tab.size[0] : tab.size[1];\r\n\r\n        if (!this.horiz) {\r\n          //g.save();\r\n          //g.translate(0, y);\r\n          //g.rotate(Math.PI/16);\r\n          //g.translate(0, -y);\r\n        }//*/\r\n\r\n        g.beginPath();\r\n        //g.lineWidth *= 5;\r\n        let ypad = 2;\r\n\r\n        g.strokeStyle = this.getDefault(\"TabStrokeStyle2\");\r\n        g.fillStyle = activecolor;\r\n        let r2 = r*1.5;\r\n\r\n        if (this.horiz) {\r\n          g.moveTo(x - r, h);\r\n          g.quadraticCurveTo(x, h, x, h - r);\r\n          g.lineTo(x, r2);\r\n          g.quadraticCurveTo(x, ypad, x + r2, ypad)\r\n          g.lineTo(x + w - r2, ypad);\r\n          g.quadraticCurveTo(x + w, 0, x + w, r2);\r\n          g.lineTo(x + w, h - r2);\r\n          g.quadraticCurveTo(x + w, h, x + w + r, h);\r\n\r\n          g.stroke()\r\n          //\r\n          g.closePath()\r\n        } else {\r\n          g.moveTo(w, y - r);\r\n          g.quadraticCurveTo(w, y, w - r, y);\r\n          ///*\r\n          g.lineTo(r2, y);\r\n          g.quadraticCurveTo(ypad, y, ypad, y + r2);\r\n          g.lineTo(ypad, y + h - r2);\r\n          g.quadraticCurveTo(0, y + h, r2, y + h);\r\n          g.lineTo(w - r2, y + h);\r\n          g.quadraticCurveTo(w, y + h, w, y + h + r);\r\n          //*/\r\n          g.stroke()\r\n          //\r\n          g.closePath()\r\n        }\r\n\r\n        let cw = this.horiz ? this.canvas.width : this.canvas.height;\r\n\r\n        let worig = g.lineWidth;\r\n\r\n        g.lineWidth *= 0.5;\r\n\r\n        g.fill();\r\n        //g.stroke();\r\n\r\n        g.lineWidth = worig;\r\n\r\n        if (!this.horiz) {\r\n          let x3 = 0, y3 = y2;\r\n\r\n          g.save();\r\n          g.translate(x3, y3);\r\n          g.rotate(Math.PI/2);\r\n          g.translate(-x3 - tsize, -y3 - tsize*0.5);\r\n        }\r\n\r\n        g.fillStyle = this.getDefault(\"TabText\").color;\r\n\r\n        draw_text(tab.name, x2, y2);\r\n\r\n        if (!this.horiz) {\r\n          g.restore();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  removeTab(tab) {\r\n    this.tabs.remove(tab);\r\n    if (tab === this.tabs.active) {\r\n      this.tabs.active = this.tabs[0];\r\n    }\r\n\r\n    this._layout();\r\n    this._redraw();\r\n    this.setCSS();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS(false);\r\n\r\n    /* create a no stacking context */\r\n    this.style[\"contain\"] = \"layout\";\r\n\r\n    this.r = this.getDefault(\"TabBarRadius\", undefined, 8);\r\n\r\n    let r = this.r !== undefined ? this.r : 3;\r\n\r\n    this.style[\"touch-action\"] = \"none\";\r\n\r\n    this.canvas.style[\"background-color\"] = this.getDefault(\"TabInactive\");\r\n    this.canvas.style[\"border-radius\"] = r + \"px\";\r\n    //this.style[\"background-color\"] = this.getDefault(\"TabInactive\");\r\n  }\r\n\r\n  updateStyle() {\r\n    let key = \"\" + this.getDefault(\"background-color\");\r\n    key += this.getDefault(\"TabActive\");\r\n    key += this.getDefault(\"TabInactive\");\r\n    key += this.getDefault(\"TabBarRadius\");\r\n    key += this.getDefault(\"TabStrokeStyle1\");\r\n    key += this.getDefault(\"TabStrokeStyle2\");\r\n    key += this.getDefault(\"TabHighlight\");\r\n    key += JSON.stringify(this.getDefault(\"TabText\"));\r\n    key += this.tabFontScale;\r\n\r\n    if (key !== this._last_style_key) {\r\n      this._last_style_key = key;\r\n\r\n      this._layout();\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  update(force_update = false) {\r\n    let rect = this.getClientRects()[0];\r\n    if (rect) {\r\n      let key = Math.floor(rect.x*4.0) + \":\" + Math.floor(rect.y*4.0);\r\n      if (key !== this._last_p_key) {\r\n        this._last_p_key = key;\r\n\r\n        //console.log(\"tab bar autobuild\");\r\n        this._layout();\r\n      }\r\n    }\r\n    super.update();\r\n\r\n    this.updateStyle();\r\n    this.updatePos(force_update);\r\n    this.updateDPI(force_update);\r\n    this.updateCanvas(force_update);\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(TabBar);\r\n\r\nexport class TabContainer extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._last_style_key = \"\";\r\n\r\n    this.dataPrefix = \"\";\r\n\r\n    this.inherit_packflag = 0;\r\n    this.packflag = 0;\r\n\r\n    this.tabFontScale = 1.0;\r\n\r\n    this.tbar = UIBase.createElement(\"tabbar-x\");\r\n    this.tbar.parentWidget = this;\r\n    this.tbar.setAttribute(\"class\", \"_tbar_\" + this._id);\r\n    this.tbar.constructor.setDefault(this.tbar);\r\n    this.tbar.tabFontScale = this.tabFontScale;\r\n\r\n    this._remakeStyle();\r\n\r\n    this.tabs = {};\r\n\r\n    this._last_horiz = undefined;\r\n    this._last_bar_pos = undefined;\r\n    this._tab = undefined;\r\n\r\n    let div = document.createElement(\"div\");\r\n    div.setAttribute(\"class\", `_tab_${this._id}`);\r\n    div.appendChild(this.tbar);\r\n    this.shadow.appendChild(div);\r\n\r\n    this.tbar.parentWidget = this;\r\n\r\n    this.tbar.onselect = (e) => {\r\n      if (this.onselect) {\r\n        this.onselect(e);\r\n      }\r\n    };\r\n\r\n    this.tbar.onchange = (tab, event) => {\r\n      if (this._tab) {\r\n        HTMLElement.prototype.remove.call(this._tab);\r\n      }\r\n\r\n      this._tab = this.tabs[tab.id];\r\n      //this._tab = document.createElement(\"div\");\r\n      //this._tab.innerText = \"SDfdsfsdyay\";\r\n\r\n      this._tab.parentWidget = this;\r\n\r\n      //ensure we get full update convergence when switching\r\n      //tabs\r\n      for (let i = 0; i < 2; i++) {\r\n        this._tab.flushUpdate();\r\n      }\r\n\r\n      let div = document.createElement(\"div\");\r\n\r\n      this.tbar.setCSS.once(() => div.style[\"background-color\"] = this.getDefault(\"background-color\"), div);\r\n\r\n      div.setAttribute(\"class\", `_tab_${this._id}`);\r\n      div.appendChild(this._tab);\r\n\r\n      this.shadow.appendChild(div);\r\n\r\n      if (this.onchange) {\r\n        this.onchange(tab, event);\r\n      }\r\n    }\r\n  }\r\n\r\n  get movableTabs() {\r\n    let attr;\r\n\r\n    if (!this.hasAttribute(\"movable-tabs\")) {\r\n      attr = this.getDefault(\"movable-tabs\");\r\n\r\n      if (attr === undefined || attr === null) {\r\n        attr = \"true\";\r\n      }\r\n\r\n      if (typeof attr === \"boolean\" || typeof attr === \"number\") {\r\n        attr = attr ? \"true\" : \"false\";\r\n      }\r\n    } else {\r\n      attr = \"\" + this.getAttribute(\"movable-tabs\");\r\n    }\r\n\r\n    attr = attr.toLowerCase();\r\n\r\n    return attr === \"true\";\r\n  }\r\n\r\n  set movableTabs(val) {\r\n    val = !!val;\r\n\r\n    this.setAttribute(\"movable-tabs\", val ? \"true\" : \"false\");\r\n    this.tbar.movableTabs = this.movableTabs;\r\n  }\r\n\r\n  get hideScrollBars() {\r\n    let attr = (\"\" + this.getAttribute(\"hide-scrollbars\")).toLowerCase();\r\n    return attr === \"true\" || attr === \"yes\";\r\n  }\r\n\r\n  set hideScrollBars(val) {\r\n    val = !!val;\r\n\r\n    this.setAttribute(\"hide-scrollbars\", \"\" + val);\r\n  }\r\n\r\n  static setDefault(e) {\r\n    e.setAttribute(\"bar_pos\", \"top\");\r\n\r\n    return e;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"tabcontainer-x\",\r\n      style  : \"tabs\"\r\n    };\r\n  }\r\n\r\n  _startMove(tab = this.tbar.tabs.active, event) {\r\n    return this.tbar._startMove(tab, event);\r\n  }\r\n\r\n  _ensureNoModal() {\r\n    return this.tbar._ensureNoModal();\r\n  }\r\n\r\n  saveData() {\r\n    let json = super.saveData() || {};\r\n    json.tabs = {};\r\n\r\n    for (let k in this.tabs) {\r\n      let tab = this.tabs[k];\r\n\r\n      if (k === this.tbar.tabs.active.id) {\r\n        //no need to save active tab here\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        json.tabs[tab.id] = JSON.parse(saveUIData(tab, \"tab\"));\r\n      } catch (error) {\r\n        console.error(\"Failed to save tab UI layout\", tab.id);\r\n      }\r\n    }\r\n\r\n    return json;\r\n  }\r\n\r\n  loadData(json) {\r\n    if (!json.tabs) {\r\n      return;\r\n    }\r\n\r\n    for (let k in json.tabs) {\r\n      if (!(k in this.tabs)) {\r\n        continue;\r\n      }\r\n\r\n      let uidata = JSON.stringify(json.tabs[k]);\r\n      loadUIData(this.tabs[k], uidata);\r\n    }\r\n  }\r\n\r\n  enableDrag() {\r\n    this.tbar.draggable = this.draggable = true;\r\n    this.tbar.addEventListener(\"dragstart\", (e) => {\r\n      this.dispatchEvent(new DragEvent(\"dragstart\", e));\r\n    });\r\n    this.tbar.addEventListener(\"dragover\", (e) => {\r\n      this.dispatchEvent(new DragEvent(\"dragover\", e));\r\n    });\r\n    this.tbar.addEventListener(\"dragexit\", (e) => {\r\n      this.dispatchEvent(new DragEvent(\"dragexit\", e));\r\n    });\r\n    /*\r\n    let doms = [this, this.tbar, this.tbar.canvas];\r\n    for (let dom of doms) {\r\n      dom.setAttribute(\"draggable\", \"true\");\r\n      dom.draggable = true;\r\n\r\n      dom.addEventListener(\"dragstart\", (e) => {\r\n        console.log(\"drag start\", e);\r\n      });\r\n\r\n      dom.addEventListener(\"drag\", (e) => {\r\n        console.log(\"drag\", e);\r\n      });\r\n    }*/\r\n  }\r\n\r\n  clear() {\r\n    this.tbar.clear();\r\n    if (this._tab !== undefined) {\r\n      HTMLElement.prototype.remove.call(this._tab);\r\n      this._tab = undefined;\r\n    }\r\n\r\n    this.tabs = {};\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.background = this.getDefault(\"background-color\");\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.background = this.getDefault(\"background-color\");\r\n    this._remakeStyle();\r\n  }\r\n\r\n  _remakeStyle() {\r\n    let horiz = this.tbar.horiz;\r\n    let display = \"flex\";\r\n    let flexDir = !horiz ? \"row\" : \"column\";\r\n    let bgcolor = this.__background; //this.getDefault(\"background-color\");\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n      ._tab_${this._id} {\r\n        display : ${display};\r\n        flex-direction : ${flexDir};\r\n        margin : 0px;\r\n        padding : 0px;\r\n        align-self : flex-start;\r\n        ${!horiz ? \"vertical-align : top;\" : \"\"}\r\n      }\r\n      \r\n      ._tbar_${this._id} {\r\n        list-style-type : none;\r\n        align-self : flex-start;\r\n        background-color : ${bgcolor};\r\n        flex-direction : ${flexDir};\r\n        ${!horiz ? \"vertical-align : top;\" : \"\"}\r\n      }\r\n    `;\r\n\r\n    if (this._style)\r\n      this._style.remove();\r\n    this._style = style;\r\n\r\n    this.shadow.prepend(style);\r\n  }\r\n\r\n  icontab(icon, id, tooltip) {\r\n    let t = this.tab(\"\", id, tooltip);\r\n    t._tab.icon = icon;\r\n\r\n    return t;\r\n  }\r\n\r\n  removeTab(tab) {\r\n    let tab2 = tab._tab;\r\n    this.tbar.removeTab(tab2);\r\n    tab.remove();\r\n  }\r\n\r\n  tab(name, id = undefined, tooltip = undefined, movable = true) {\r\n    if (id === undefined) {\r\n      id = tab_idgen++;\r\n    }\r\n\r\n    let col = UIBase.createElement(\"colframe-x\");\r\n\r\n    this.tabs[id] = col;\r\n\r\n    col.dataPrefix = this.dataPrefix;\r\n\r\n    col.ctx = this.ctx;\r\n    col._tab = this.tbar.addTab(name, id, tooltip, movable);\r\n\r\n    col.inherit_packflag |= this.inherit_packflag;\r\n    col.packflag |= this.packflag;\r\n\r\n    //let cls = this.tbar.horiz ? ui.ColumnFrame : ui.RowFrame;\r\n\r\n    col.parentWidget = this;\r\n\r\n    if (col.ctx) {\r\n      col._init();\r\n    }\r\n\r\n    col.setCSS();\r\n\r\n    if (this._tab === undefined) {\r\n      this.setActive(col);\r\n    }\r\n\r\n    col.noSwitch = function () {\r\n      this._tab.noSwitch = true;\r\n      return this;\r\n    }\r\n\r\n    function defineTabEvent(key) {\r\n      key = \"on\" + key;\r\n\r\n      Object.defineProperty(col, key, {\r\n        get() {\r\n          return this._tab[key];\r\n        },\r\n        set(v) {\r\n          this._tab[key] = v;\r\n        }\r\n      });\r\n    }\r\n\r\n    defineTabEvent(\"tabclick\");\r\n    defineTabEvent(\"tabdragmove\");\r\n    defineTabEvent(\"tabdragstart\");\r\n    defineTabEvent(\"tabdragend\");\r\n\r\n    return col;\r\n  }\r\n\r\n  setActive(tab) {\r\n    if (typeof tab === \"string\") {\r\n      tab = this.getTab(tab);\r\n    }\r\n\r\n    if (!tab) {\r\n      return;\r\n    }\r\n\r\n    if (tab._tab !== this.tbar.tabs.active) {\r\n      this.tbar.setActive(tab._tab);\r\n    }\r\n  }\r\n\r\n  getTabCount() {\r\n    return this.tbar.tabs.length;\r\n  }\r\n\r\n  moveTab(tab, i) {\r\n    tab = tab._tab;\r\n\r\n    let tab2 = this.tbar.tabs[i];\r\n\r\n    if (tab !== tab2) {\r\n      this.tbar.swapTabs(tab, tab2);\r\n    }\r\n\r\n    this.tbar.setCSS();\r\n    this.tbar._layout();\r\n    this.tbar._redraw();\r\n  }\r\n\r\n  getTab(name_or_id) {\r\n    if (name_or_id in this.tabs) {\r\n      return this.tabs[name_or_id];\r\n    }\r\n\r\n    for (let k in this.tabs) {\r\n      let t = this.tabs[k];\r\n\r\n      if (t.name === name_or_id) {\r\n        return t;\r\n      }\r\n    }\r\n\r\n    throw new Error(\"Unknown tab \" + name_or_id);\r\n  }\r\n\r\n  updateBarPos() {\r\n    let barpos = this.getAttribute(\"bar_pos\");\r\n\r\n    if (barpos !== this._last_bar_pos) {\r\n      this.horiz = barpos === \"top\" || barpos === \"bottom\";\r\n      this._last_bar_pos = barpos;\r\n\r\n      this.tbar.setAttribute(\"bar_pos\", barpos);\r\n      this.tbar.update(true);\r\n      this.update();\r\n    }\r\n  }\r\n\r\n  updateHoriz() {\r\n    let horiz = this.tbar.horiz;\r\n\r\n    if (this._last_horiz !== horiz) {\r\n      this._last_horiz = horiz;\r\n      this._remakeStyle();\r\n    }\r\n  }\r\n\r\n  updateStyle() {\r\n    let key = \"\" + this.getDefault(\"background-color\");\r\n\r\n    if (key !== this._last_style_key) {\r\n      this._last_style_key = key;\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  getActive() {\r\n    return this.tbar.tabs.active;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.tbar.movableTabs = this.movableTabs;\r\n\r\n    if (this._tab !== undefined) {\r\n      this._tab.update();\r\n    }\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-direction\"] = !this.horiz ? \"row\" : \"column\";\r\n\r\n    this.tbar.tabFontScale = this.tabFontScale;\r\n\r\n    this.updateStyle();\r\n    this.updateHoriz();\r\n    this.updateBarPos();\r\n    this.tbar.update();\r\n\r\n    let act = this.tbar.tabs.active;\r\n\r\n    if (act && !this.hideScrollBars) {\r\n      let container = this.tabs[act.id];\r\n\r\n      //propegate overflow-y to tab container as a whole\r\n\r\n      if (container.hasAttribute(\"overflow-y\") && this.style[\"overflow-y\"] !== container.getAttribute(\"overflow-y\")) {\r\n        this.style[\"overflow-y\"] = container.getAttribute(\"overflow-y\");\r\n        //container.style[\"overflow-y\"] = \"unset\";\r\n      } else if (!container.hasAttribute(\"overflow-y\")) {\r\n        this.style[\"overflow-y\"] = this.getDefault(\"overflow-y\") || \"unset\";\r\n      }\r\n\r\n      if (container.hasAttribute(\"overflow\") && this.style[\"overflow\"] !== container.getAttribute(\"overflow\")) {\r\n        this.style[\"overflow\"] = container.getAttribute(\"overflow\");\r\n        //container.style[\"overflow-y\"] = \"unset\";\r\n      } else if (!container.hasAttribute(\"overflow\")) {\r\n        this.style[\"overflow\"] = this.getDefault(\"overflow\") || \"unset\";\r\n      }\r\n    } else if (this.hideScrollBars) {\r\n      this.style[\"overflow\"] = this.style[\"overflow-y\"] = \"unset\";\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(TabContainer);\r\n","//bind module to global var to get at it in console.\r\n//\r\n//note that require has an api for handling circular\r\n//module refs, in such cases do not use these vars.\r\n\r\nimport {Container} from \"../core/ui.js\";\r\n\r\nvar _ui = undefined;\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_curvewidget from './ui_curvewidget.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as ui_widgets from './ui_widgets.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\n\r\nlet PropFlags = toolprop.PropFlags;\r\nlet PropSubTypes = toolprop.PropSubTypes;\r\n\r\nlet EnumProperty = toolprop.EnumProperty;\r\n\r\nlet Vector2 = vectormath.Vector2,\r\n  UIBase = ui_base.UIBase,\r\n  PackFlags = ui_base.PackFlags,\r\n  PropTypes = toolprop.PropTypes;\r\n\r\n\r\nconst list = util.list;\r\n\r\nexport class TableRow extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.dom.remove();\r\n    this.dom = document.createElement(\"tr\");\r\n\r\n    //kind of dumb, but this.dom doesn't live within this element itself, bleh\r\n    //this.shadow.appendChild(this.dom);\r\n    this.dom.setAttribute(\"class\", \"containerx\");\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"tablerow-x\"\r\n  };}\r\n\r\n  _add(child) {\r\n    child.ctx = this.ctx;\r\n    child.parentWidget = this;\r\n\r\n    let td = document.createElement(\"td\");\r\n    td.appendChild(child);\r\n\r\n    this.dom.appendChild(td);\r\n    child.onadd();\r\n  }\r\n};\r\nUIBase.internalRegister(TableRow);\r\n\r\nexport class TableFrame extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.dom = document.createElement(\"table\");\r\n    this.shadow.appendChild(this.dom);\r\n    this.dom.setAttribute(\"class\", \"containerx\");\r\n\r\n    //this.dom.style[\"display\"] = \"block\";\r\n  }\r\n\r\n  update() {\r\n    this.style[\"display\"] = \"inline-block\";\r\n    super.update();\r\n  }\r\n\r\n  _add(child) {\r\n    child.ctx = this.ctx;\r\n    child.parentWidget = this;\r\n    this.dom.appendChild(child);\r\n    child.onadd();\r\n  }\r\n\r\n  add(child) {\r\n    this._add(child);\r\n  }\r\n\r\n  row() {\r\n    let tr = document.createElement(\"tr\");\r\n    let cls = \"table-tr\";\r\n\r\n    tr.setAttribute(\"class\", cls);\r\n    this.dom.appendChild(tr);\r\n    let this2 = this;\r\n\r\n    function maketd() {\r\n      let td = document.createElement(\"td\");\r\n      tr.appendChild(td);\r\n\r\n      td.style[\"margin\"] = tr.style[\"margin\"];\r\n      td.style[\"padding\"] = tr.style[\"padding\"];\r\n\r\n      let container = UIBase.createElement(\"rowframe-x\");\r\n\r\n      container.ctx = this2.ctx;\r\n      container.parentWidget = this2;\r\n      container.setAttribute(\"class\", cls);\r\n\r\n      td.setAttribute(\"class\", cls);\r\n      td.appendChild(container);\r\n\r\n      return container;\r\n    }\r\n\r\n    //hrm wish I could subclass html elements easier\r\n    let ret = {\r\n      _tr : tr,\r\n\r\n      style : tr.style,\r\n\r\n      focus : function(args) {\r\n        tr.focus(args);\r\n      },\r\n\r\n      blur : function(args) {\r\n        tr.blur(args);\r\n      },\r\n\r\n      remove : () => {\r\n        tr.remove();\r\n      },\r\n\r\n      addEventListener : function(type, cb, arg) {\r\n        tr.addEventListener(type, cb, arg);\r\n      },\r\n\r\n      removeEventListener : function(type, cb, arg) {\r\n        tr.removeEventListener(type, cb, arg);\r\n      },\r\n\r\n      setAttribute : function(attr, val) {\r\n        if (attr == \"class\") {\r\n          cls = val;\r\n        }\r\n\r\n        tr.setAttribute(attr, val);\r\n      },\r\n\r\n      scrollTo : function() {\r\n        return this._tr.scrollTo(...arguments);\r\n      },\r\n\r\n      scrollIntoView : function() {\r\n        return this._tr.scrollIntoView(...arguments);\r\n      },\r\n\r\n      clear : function() {\r\n        for (let node of list(tr.childNodes)) {\r\n          tr.removeChild(node);\r\n        }\r\n      }\r\n    };\r\n\r\n    function makefunc(f) {\r\n      ret[f] = function() {\r\n        let container = maketd();\r\n\r\n        container.background = tr.style[\"background-color\"]; //\"rgba(0,0,0,0)\";\r\n        return container[f].apply(container, arguments);\r\n      }\r\n    }\r\n\r\n    let _bg = \"\";\r\n\r\n    //need to implement proper proxy here!\r\n    Object.defineProperty(ret, \"tabIndex\", {\r\n      set : function(f) {\r\n        tr.tabIndex = f;\r\n      },\r\n\r\n      get : function(f) {\r\n        return tr.tabIndex;\r\n      }\r\n    });\r\n\r\n    Object.defineProperty(ret, \"background\", {\r\n      set : function(bg) {\r\n        _bg = bg;\r\n        tr.style[\"background-color\"] = bg;\r\n\r\n        for (let node of tr.childNodes) {\r\n          if (node.childNodes.length > 0) {\r\n            node.childNodes[0].background = bg;\r\n            node.style[\"background-color\"] = bg;\r\n          }\r\n        }\r\n      }, get : function() {\r\n        return _bg;\r\n      }\r\n    });\r\n\r\n    /*\r\n    Object.defineProperty(ret, \"class\", {\r\n      set(bg) {\r\n        tr.class = bg;\r\n      }\r\n    });//*/\r\n\r\n    ret.cell = () => {\r\n      let container = maketd();\r\n      container.background = tr.style[\"background-color\"];\r\n      return container;\r\n    };\r\n    \r\n    //makefunc(\"cell\");\r\n    makefunc(\"label\");\r\n    makefunc(\"tool\");\r\n    makefunc(\"prop\");\r\n    makefunc(\"pathlabel\");\r\n    makefunc(\"button\");\r\n    makefunc(\"iconbutton\");\r\n    makefunc(\"textbox\");\r\n    makefunc(\"col\");\r\n    makefunc(\"row\");\r\n    makefunc(\"table\");\r\n    makefunc(\"listenum\");\r\n    makefunc(\"check\");\r\n\r\n    return ret;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  clear() {\r\n    super.clear();\r\n    for (let child of list(this.dom.childNodes)) {\r\n      child.remove();\r\n    }\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"tableframe-x\"\r\n  };}\r\n}\r\nUIBase.internalRegister(TableFrame);\r\n\r\n","\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as simple_toolsys from '../path-controller/toolsys/toolsys.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\n\r\nimport {TableFrame} from './ui_table.js';\r\nimport {Container, ColumnFrame, RowFrame} from '../core/ui.js';\r\nimport {keymap} from '../path-controller/util/events.js';\r\n\r\nlet EnumProperty = toolprop.EnumProperty,\r\n    PropTypes    = toolprop.PropTypes;\r\n\r\nlet UIBase     = ui_base.UIBase,\r\n    PackFlags  = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nfunction getpx(css) {\r\n  return parseFloat(css.trim().replace(\"px\", \"\"))\r\n}\r\n\r\nclass ListItem extends RowFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    let highlight = () => {\r\n      //console.log(\"listitem mouseover\");\r\n      this.highlight = true;\r\n      this.setBackground();\r\n    };\r\n\r\n    let unhighlight = () => {\r\n      //console.log(\"listitem mouseleave\");\r\n      this.highlight = false;\r\n      this.setBackground();\r\n    };\r\n\r\n    this.addEventListener(\"mouseover\", highlight);\r\n    this.addEventListener(\"mousein\", highlight);\r\n\r\n    this.addEventListener(\"mouseleave\", unhighlight);\r\n    this.addEventListener(\"mouseout\", unhighlight);\r\n    this.addEventListener(\"blur\", unhighlight);\r\n\r\n    this.addEventListener(\"click\", (e) => {\r\n      //console.log(\"click!\");\r\n      if (this.onclick) {\r\n        this.onclick();\r\n      }\r\n    });\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n      .listitem {\r\n        -moz-user-focus: normal;\r\n        moz-user-focus: normal;\r\n        user-focus: normal;\r\n      }\r\n    `;\r\n\r\n    this.shadowRoot.prepend(style);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"listitem-x\",\r\n      style  : \"listbox\"\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.setAttribute(\"class\", \"listitem\");\r\n\r\n    this.style[\"width\"] = \"100%\";\r\n    this.style[\"height\"] = this.getDefault(\"ItemHeight\") + \"px\";\r\n    this.style[\"flex-grow\"] = \"unset\";\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  setBackground() {\r\n    if (this.highlight && this.is_active) {\r\n      this.background = this.getDefault(\"ListActiveHighlight\");\r\n    } else if (this.highlight) {\r\n      this.background = this.getDefault(\"ListHighlight\");\r\n    } else if (this.is_active) {\r\n      this.background = this.getDefault(\"ListActive\");\r\n    } else {\r\n      this.background = this.getDefault(\"background-color\");\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.setBackground();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ListItem);\r\n\r\nclass ListBox extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.items = [];\r\n    this.idmap = {};\r\n    this.items.active = undefined;\r\n    this.highlight = false;\r\n    this.is_active = false;\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n      .listbox {\r\n        -moz-user-focus: normal;\r\n        moz-user-focus: normal;\r\n        user-focus: normal;\r\n      }\r\n    `;\r\n    this.shadow.prepend(style);\r\n\r\n    this.onkeydown = (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Up\"]:\r\n        case keymap[\"Down\"]:\r\n          if (this.items.length == 0)\r\n            return;\r\n\r\n          if (this.items.active === undefined) {\r\n            this.setActive(this.items[0]);\r\n            return;\r\n          }\r\n\r\n          let i = this.items.indexOf(this.items.active);\r\n          let dir = e.keyCode == keymap[\"Up\"] ? -1 : 1;\r\n\r\n          i = Math.max(Math.min(i + dir, this.items.length - 1), 0);\r\n          this.setActive(this.items[i]);\r\n\r\n          break;\r\n      }\r\n    };\r\n\r\n    //this.addEventListener(\"keydown\", on_keydown);\r\n\r\n    //this._table =  this.table();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"listbox-x\",\r\n      style  : \"listbox\"\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.setCSS();\r\n\r\n    this.style[\"width\"] = this.getDefault(\"width\") + \"px\";\r\n    this.style[\"height\"] = this.getDefault(\"height\") + \"px\";\r\n    this.style[\"overflow\"] = \"scroll\";\r\n\r\n    //this.setAttribute(\"class\", \"listbox\");\r\n    //this.setAttribute(\"tabindex\", 0);\r\n    //this.tabIndex = 0;\r\n  }\r\n\r\n  addItem(name, id) {\r\n    let item = UIBase.createElement(\"listitem-x\");\r\n\r\n    item._id = id === undefined ? this.items.length : id;\r\n    this.idmap[item._id] = item;\r\n\r\n    //item.addEventListener(\"keydown\", this.onkeydown);\r\n    this.tabIndex = 1;\r\n    this.setAttribute(\"tabindex\", 1);\r\n\r\n    this.add(item);\r\n    this.items.push(item);\r\n\r\n    item.label(name);\r\n    let this2 = this;\r\n\r\n    item.onclick = function () {\r\n      this2.setActive(this);\r\n      this.setBackground();\r\n    };\r\n\r\n    return item;\r\n  }\r\n\r\n  removeItem(item) {\r\n    if (typeof item == \"number\") {\r\n      item = this.idmap[item];\r\n    }\r\n\r\n    item.remove();\r\n    delete this.idmap[item._id];\r\n    this.items.remove(item);\r\n  }\r\n\r\n  setActive(item) {\r\n    if (typeof item == \"number\") {\r\n      item = this.idmap[item];\r\n    }\r\n\r\n    //console.log(\"set active!\");\r\n\r\n    if (item === this.items.active) {\r\n      return;\r\n    }\r\n\r\n    if (this.items.active !== undefined) {\r\n      this.items.active.highlight = false;\r\n      this.items.active.is_active = false;\r\n      this.items.active.setBackground();\r\n    }\r\n\r\n    this.items.active = item;\r\n\r\n    if (item) {\r\n      item.is_active = true;\r\n\r\n      item.setBackground();\r\n      item.scrollIntoViewIfNeeded();\r\n    }\r\n\r\n    if (this.onchange) {\r\n      this.onchange(item ? item._id : undefined, item);\r\n    }\r\n  }\r\n\r\n  clear() {\r\n\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ListBox);\r\n","import {UIBase} from '../core/ui_base.js';\r\nimport * as util from '../path-controller/util/util.js';\r\nimport {keymap} from '../path-controller/util/simple_events.js';\r\n\r\nexport class ProgressCircle extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.g = this.canvas.getContext(\"2d\");\r\n\r\n    this.shadow.appendChild(this.canvas);\r\n    this.size = 150;\r\n    this.animreq = undefined;\r\n    this._value = 0.0;\r\n    this.startTime = util.time_ms();\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this.flagRedraw();\r\n    this.update();\r\n\r\n    //enable keyboard focus\r\n    this.tabIndex = 0;\r\n    this.setAttribute(\"tab-index\", 0);\r\n    this.setAttribute(\"tabindex\", 0);\r\n\r\n    let onkey = (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Escape\"]:\r\n          if (this.oncancel) {\r\n            this.oncancel(this);\r\n          }\r\n          break;\r\n      }\r\n    }\r\n\r\n    this.addEventListener(\"keydown\", onkey);\r\n    this.canvas.addEventListener(\"keydown\", onkey);\r\n  }\r\n\r\n  flagRedraw() {\r\n    if (this.animreq !== undefined) {\r\n      return;\r\n    }\r\n\r\n    this.animreq = requestAnimationFrame(() => {\r\n      this.animreq = undefined;\r\n      this.draw();\r\n    })\r\n  }\r\n\r\n  draw() {\r\n    let c = this.canvas, g = this.g;\r\n\r\n    let clr1 = \"rgb(68,69,83)\";\r\n    let clr2 = \"rgb(141,154,196)\";\r\n    let clr3 = \"rgb(214,110,54)\";\r\n\r\n    let t = (util.time_ms() - this.startTime) / 1000.0;\r\n\r\n    g.save();\r\n    g.clearRect(0, 0, c.width, c.height);\r\n\r\n    g.lineWidth /= c.width*0.5;\r\n    g.scale(c.width, c.height);\r\n    g.translate(0.5, 0.5);\r\n\r\n    g.fillStyle = clr2;\r\n    g.strokeStyle = clr1;\r\n\r\n    g.beginPath();\r\n    g.moveTo(0, 0);\r\n    g.arc(0, 0, 0.45, Math.PI, -Math.PI);\r\n    //g.closePath()\r\n\r\n    g.moveTo(0, 0);\r\n    g.arc(0, 0, 0.2, Math.PI, -Math.PI);\r\n    //g.closePath()\r\n\r\n    g.clip(\"evenodd\");\r\n\r\n    g.beginPath();\r\n    g.arc(0, 0, 0.45, -Math.PI, Math.PI);\r\n    g.fill();\r\n    g.stroke();\r\n\r\n    g.beginPath();\r\n    g.arc(0, 0, 0.2, Math.PI, -Math.PI);\r\n    g.stroke();\r\n\r\n    g.beginPath();\r\n\r\n    let th = this._value*Math.PI*2.0;\r\n\r\n    let steps = 12;\r\n    let dth = (Math.PI*2.0) / steps;\r\n    let lwid = g.lineWidth;\r\n    g.lineWidth *= 3;\r\n\r\n    for (let i=0; i<steps; i++) {\r\n      let th1 = i * dth;\r\n      th1 += t;\r\n\r\n      let r1 = 0.2;\r\n      let r2 = 0.45;\r\n      let th2 = th1 + dth*0.5;\r\n\r\n      g.beginPath();\r\n      g.moveTo(Math.cos(th1)*r1, Math.sin(th1)*r1);\r\n      g.lineTo(Math.cos(th2)*r2, Math.sin(th2)*r2);\r\n      g.strokeStyle = \"rgba(255,255,255,0.5)\";\r\n      g.stroke();\r\n    }\r\n\r\n    g.lineWidth = lwid;\r\n\r\n    g.beginPath();\r\n    g.moveTo(0, 0);\r\n    g.arc(0, 0, 0.4, Math.PI, -Math.PI);\r\n    //g.closePath()\r\n\r\n    g.clip(\"evenodd\");\r\n\r\n    g.beginPath();\r\n    g.fillStyle = clr3;\r\n    g.moveTo(0, 0);\r\n    g.arc(0, 0, 0.45, 0, th);\r\n    g.lineTo(0, 0);\r\n    g.fill();\r\n\r\n    g.strokeStyle = \"rgb(141,154,196)\";\r\n    g.stroke();\r\n\r\n    g.restore();\r\n  }\r\n\r\n  set value(percent) {\r\n    this._value = percent;\r\n    this.flagRedraw();\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  startTimer() {\r\n    if (this.timer !== undefined) {\r\n      return;\r\n    }\r\n\r\n    this.focus();\r\n\r\n    window.setInterval(() => {\r\n      if (!this.isConnected) {\r\n        this.endTimer();\r\n        return;\r\n      }\r\n\r\n      this.flagRedraw();\r\n    }, 50);\r\n  }\r\n\r\n  endTimer() {\r\n    if (this.timer !== undefined) {\r\n      window.clearInterval(this.timer);\r\n    }\r\n    this.timer = undefined;\r\n  }\r\n\r\n  update() {\r\n    if (!this.isConnected && this.timer) {\r\n      this.endTimer();\r\n    }\r\n\r\n    let size = ~~(this.size*UIBase.getDPI());\r\n\r\n    if (size !== this.canvas.width) {\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    let c = this.canvas;\r\n\r\n    let size = ~~(this.size*UIBase.getDPI());\r\n\r\n    if (c.width !== size) {\r\n      c.width = c.height = size;\r\n\r\n      size /= UIBase.getDPI();\r\n      c.style[\"width\"] = size + \"px\";\r\n      c.style[\"height\"] = size + \"px\";\r\n\r\n      c.style[\"display\"] = \"flex\";\r\n\r\n      this.style[\"width\"] = size + \"px\";\r\n      this.style[\"height\"] = size + \"px\";\r\n\r\n      //forcibly redraw in this case, do not queue with flagRedraw\r\n      this.draw();\r\n    }\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"align-items\"] = \"center\";\r\n    this.style[\"justify-content\"] = \"center\";\r\n    this.style[\"width\"] = \"100%\";\r\n    this.style[\"height\"] = \"100%\";\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname : \"progress-circle-x\"\r\n    }\r\n  }\r\n}\r\nUIBase.register(ProgressCircle);\r\n","import {PackFlags, UIBase} from \"../core/ui_base.js\";\r\nimport {ColumnFrame} from \"../core/ui.js\";\r\nimport {PropTypes, PropFlags} from \"../path-controller/toolsys/toolprop.js\";\r\n\r\nimport {UndoFlags, ToolFlags} from \"../path-controller/toolsys/toolsys.js\";\r\nimport {DataPath, DataTypes} from \"../path-controller/controller/controller.js\";\r\n\r\nimport {ToolProperty} from '../path-controller/toolsys/toolprop.js';\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport cconst from '../config/const.js';\r\n\r\nconst LastKey = Symbol(\"LastToolPanelId\");\r\nlet tool_idgen = 0;\r\n\r\nexport function getLastToolStruct(ctx) {\r\n  let ret = ctx.state._last_tool;\r\n\r\n  if (!ret) {\r\n    ret = ctx.toolstack.head;\r\n  } else {\r\n    let msg = \"Passing the last tool to last-tool-panel via appstate._last_tool is deprecated;\";\r\n    msg += \"\\nctx.toolstack.head is now used instead.\";\r\n\r\n    console.warn(msg);\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n/*\r\n*\r\n* This panel shows the most recently executed ToolOp's\r\n* settings.  It assumes that recent toolops are accessible\r\n* in ctx.last_tool.\r\n* */\r\nexport class LastToolPanel extends ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this._tool_id = undefined;\r\n    this.useDataPathUndo = false;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.useDataPathUndo = false;\r\n    this.rebuild();\r\n  }\r\n\r\n  /** client code can subclass and override this method */\r\n  getToolStackHead(ctx) {\r\n    //don't process the root toolop\r\n    let bad = ctx.toolstack.length === 0 || ctx.toolstack.cur >= ctx.toolstack.length;\r\n    bad = bad || ctx.toolstack.cur < 0;\r\n    bad = bad || ctx.toolstack[ctx.toolstack.cur].undoflag & UndoFlags.IS_UNDO_ROOT;\r\n\r\n    if (bad) {\r\n      return undefined;\r\n    }\r\n\r\n    return ctx.toolstack[ctx.toolstack.cur];\r\n  }\r\n\r\n  rebuild() {\r\n    let ctx = this.ctx;\r\n    if (ctx === undefined) {\r\n      this._tool_id = -1; //wait for .ctx\r\n      return;\r\n    }\r\n\r\n    this.clear();\r\n\r\n    this.label(\"Recent Command Settings\");\r\n\r\n    let tool = this.getToolStackHead(ctx);\r\n\r\n    if (!tool) {\r\n      this.setCSS();\r\n      return;\r\n    }\r\n\r\n    let def = tool.constructor.tooldef();\r\n    let name = def.uiname !== undefined ? def.uiname : def.name;\r\n\r\n    let panel = this.panel(def.uiname);\r\n\r\n    this.buildTool(ctx, tool, panel);\r\n    this.flushUpdate();\r\n  }\r\n\r\n  /** client code can subclass and override this method */\r\n  buildTool(ctx, tool, panel) {\r\n    let fakecls = {};\r\n    fakecls.constructor = fakecls;\r\n\r\n    //in theory it shouldn't matter if multiple last tool panels\r\n    //override _last_tool, since they all access the same data\r\n    this.ctx.state._last_tool = fakecls;\r\n    let lastkey = tool[LastKey];\r\n\r\n    let getTool = () => {\r\n      let tool = this.ctx.toolstack[this.ctx.toolstack.cur];\r\n      if (!tool || tool[LastKey] !== lastkey) {\r\n        return undefined;\r\n      }\r\n\r\n      return tool;\r\n    };\r\n\r\n    if (tool.flag & ToolFlags.PRIVATE) {\r\n      return;\r\n    }\r\n\r\n    let st = this.ctx.api.mapStruct(fakecls, true);\r\n    let paths = [];\r\n\r\n    function defineProp(k, key) {\r\n      Object.defineProperty(fakecls, key, {\r\n        get : function() {\r\n          let tool = getTool();\r\n          if (tool) {\r\n            if (!tool.inputs[k]) {\r\n              console.error(\"Missing property \" + k, tool);\r\n            }\r\n            return tool.inputs[k].getValue();\r\n          }\r\n        },\r\n\r\n        set : function(val) {\r\n          let tool = getTool();\r\n          if (tool) {\r\n            tool.inputs[k].setValue(val);\r\n            tool.saveDefaultInputs();\r\n\r\n            ctx.toolstack.rerun(tool);\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    for (let k in tool.inputs) {\r\n      let prop = tool.inputs[k];\r\n\r\n      if (prop.flag & (PropFlags.PRIVATE|PropFlags.READ_ONLY)) {\r\n        continue;\r\n      }\r\n\r\n      let uiname = prop.uiname;\r\n      if (!uiname) {\r\n        uiname = ToolProperty.makeUIName(k);\r\n      }\r\n\r\n      prop.uiname = uiname;\r\n      let apikey = k.replace(/[\\t ]/g, \"_\");\r\n\r\n      let dpath = new DataPath(apikey, apikey, prop, DataTypes.PROP);\r\n      st.add(dpath);\r\n\r\n      paths.push(dpath);\r\n\r\n      defineProp(k, apikey);\r\n    }\r\n\r\n    panel.useDataPathUndo = false;\r\n\r\n    for (let dpath of paths) {\r\n      let path = \"last_tool.\" + dpath.path;\r\n\r\n      panel.label(dpath.data.uiname);\r\n      let ret = panel.prop(path, PackFlags.FORCE_ROLLER_SLIDER);\r\n\r\n      if (ret) {\r\n        ret.useDataPathUndo = false;\r\n      }\r\n    }\r\n    this.setCSS();\r\n\r\n    //console.log(\"Building last tool settings\");\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n    let ctx = this.ctx;\r\n\r\n    if (!ctx) {\r\n      return;\r\n    }\r\n\r\n    let tool = this.getToolStackHead(ctx);\r\n\r\n    if (tool && (!(LastKey in tool) || tool[LastKey] !== this._tool_id)) {\r\n      tool[LastKey] = tool_idgen++;\r\n      this._tool_id = tool[LastKey];\r\n\r\n      this.rebuild();\r\n    }\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"last-tool-panel-x\"\r\n  }}\r\n}\r\nUIBase.internalRegister(LastToolPanel);\r\n","export const mimeMap = {\r\n  \".js\"  : \"application/javascript\",\r\n  \".json\": \"text/json\",\r\n  \".html\": \"text/html\",\r\n  \".txt\" : \"text/plain\",\r\n  \".jpg\" : \"image/jpeg\",\r\n  \".png\" : \"image/png\",\r\n  \".tiff\": \"image/tiff\",\r\n  \".gif\" : \"image/gif\",\r\n  \".bmp\" : \"image/bitmap\",\r\n  \".tga\" : \"image/targa\",\r\n  \".svg\" : \"image/svg+xml\",\r\n  \".xml\" : \"text/xml\",\r\n  \".webp\": \"image/webp\",\r\n  \"svg\"  : \"image/svg+xml\",\r\n  \"txt\"  : \"text/plain\",\r\n  \"html\" : \"text/html\",\r\n  \"css\"  : \"text/css\",\r\n  \"ts\"   : \"application/typescript\",\r\n  \"py\"   : \"application/python\",\r\n  \"c\"    : \"application/c\",\r\n  \"cpp\"  : \"application/cpp\",\r\n  \"cc\"   : \"application/cpp\",\r\n  \"h\"    : \"application/c\",\r\n  \"hh\"   : \"application/cpp\",\r\n  \"hpp\"  : \"application/cpp\",\r\n  \"sh\"   : \"application/bash\",\r\n  \"mjs\"  : \"application/javascript\",\r\n  \"cjs\"  : \"application/javascript\",\r\n  \"gif\"  : \"image/gif\"\r\n};\r\n\r\nexport var textMimes = new Set([\r\n  \"application/javascript\", \"application/x-javscript\",\r\n  \"image/svg+xml\", \"application/xml\"\r\n]);\r\n\r\nexport function isMimeText(mime) {\r\n  if (!mime) {\r\n    return false;\r\n  }\r\n\r\n  if (mime.startsWith(\"text\")) {\r\n    return true;\r\n  }\r\n\r\n  return textMimes.has(mime);\r\n}\r\n\r\nexport function getExtension(path) {\r\n  if (!path) {\r\n    return \"\";\r\n  }\r\n\r\n  let i = path.length;\r\n  while (i > 0 && path[i] !== \".\") {\r\n    i--;\r\n  }\r\n\r\n  return path.slice(i, path.length).trim().toLowerCase();\r\n}\r\n\r\nexport function getMime(path) {\r\n  let ext = getExtension(path);\r\n  if (ext in mimeMap) {\r\n    return mimeMap[ext];\r\n  }\r\n\r\n  return \"application/x-octet-stream\";\r\n}\r\n\r\nexport class PlatformAPI {\r\n  static writeFile(data, handle, mime) {\r\n    throw new Error(\"implement me\");\r\n    //returns a promise\r\n  }\r\n\r\n  static resolveURL(path, base = location.href) {\r\n    base = base.trim();\r\n\r\n    if (path.startsWith(\"./\")) {\r\n      path = path.slice(2, path.length).trim();\r\n    }\r\n\r\n    while (path.startsWith(\"/\")) {\r\n      path = path.slice(1, path.length).trim();\r\n    }\r\n\r\n    while (base.endsWith(\"/\")) {\r\n      base = base.slice(0, base.length - 1).trim();\r\n    }\r\n\r\n    let exts = [\"html\", \"txt\", \"js\", \"php\", \"cgi\"]\r\n    for (let ext of exts) {\r\n      ext = \".\" + ext;\r\n      if (base.endsWith(ext)) {\r\n        let i = base.length - 1;\r\n        while (i > 0 && base[i] !== \"/\") {\r\n          i--;\r\n        }\r\n\r\n        base = base.slice(0, i).trim();\r\n      }\r\n    }\r\n\r\n    while (base.endsWith(\"/\")) {\r\n      base = base.slice(0, base.length - 1).trim();\r\n    }\r\n\r\n    path = (base + \"/\" + path).split(\"/\")\r\n    let path2 = [];\r\n\r\n    for (let i = 0; i < path.length; i++) {\r\n      if (path[i] === \"..\") {\r\n        path2.pop();\r\n      } else {\r\n        path2.push(path[i]);\r\n      }\r\n    }\r\n\r\n    return path2.join(\"/\");\r\n  }\r\n\r\n  //returns a promise that resolves to a FilePath that can be used for re-saving.\r\n  static showOpenDialog(title, args = new FileDialogArgs()) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  //returns a promise\r\n  static showSaveDialog(title, savedata_cb, args = new FileDialogArgs()) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  //returns a promise.  if mime is a text type, a string will be fed to the promise,\r\n  //otherwise it will be an ArrayBuffer\r\n  static readFile(path, mime) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n}\r\n\r\nexport class FileDialogArgs {\r\n  constructor() {\r\n    this.multi = false; //allow selecting multiple files\r\n    this.addToRecentList = false; //update recent file list\r\n\r\n    /* example for filters:\r\n    [{\r\n      name : \"Images\",\r\n      mime : \"image/png\"\r\n      extensions : \"[\"png\", \"jpg\"]\r\n    }]\r\n    * */\r\n    this.filters = []\r\n  }\r\n}\r\n\r\n/*a file path, some platforms may not return real payhs*/\r\nexport class FilePath {\r\n  constructor(data, filename = \"unnamed\") {\r\n    this.data = data;\r\n    this.filename = filename;\r\n  }\r\n}\r\n","let promise;\r\n\r\nif (window.haveElectron) {\r\n  promise = import('./electron/electron_api.js');\r\n} else {\r\n  promise = import('./web/web_api.js');\r\n}\r\n\r\nexport var platform;\r\n\r\npromise.then((module) => {\r\n  platform = module.platform;\r\n  promise = undefined;\r\n});\r\n\r\nexport function getPlatformAsync() {\r\n  if (promise) {\r\n    return new Promise((accept, reject) => {\r\n      promise.then(mod => {\r\n        accept(mod.platform);\r\n      });\r\n    });\r\n  }\r\n\r\n  return new Promise((accept, reject) => {\r\n    accept(platform);\r\n  })\r\n}\r\n","\"use strict\";\r\n\r\nlet _nativeTheme;\r\n\r\nfunction getNativeTheme() {\r\n  if (_nativeTheme) {\r\n    return _nativeTheme;\r\n  }\r\n\r\n  let remote = getElectron().remote;\r\n  if (!remote) { /* Newer electron version with no remote, client must provide it */\r\n    ipcRenderer.invoke(\"nativeTheme\");\r\n  } else {\r\n    _nativeTheme = remote.nativeTheme;\r\n  }\r\n\r\n  return _nativeTheme;\r\n}\r\n\r\nfunction getElectronVersion() {\r\n  let key = navigator.userAgent;\r\n  let i = key.search(\"Electron\");\r\n  key = key.slice(i + 9, key.length);\r\n\r\n  i = key.search(/[ \\t]/);\r\n  if (i >= 0) {\r\n    key = key.slice(0, i);\r\n  }\r\n\r\n  key = key.trim();\r\n  key = key.split(\".\").map(f => parseInt(f));\r\n\r\n  return key;\r\n}\r\n\r\n/*\r\n* wrap require to keep angular from auto-importing\r\n* this api in browsers\r\n* */\r\nfunction getElectron() {\r\n  return require('electron');\r\n}\r\n\r\nfunction myRequire(mod) {\r\n  return globalThis.require(mod);\r\n}\r\n\r\nimport {Menu, DropBox} from '../../widgets/ui_menu.js';\r\nimport {getIconManager} from \"../../core/ui_base.js\";\r\nimport cconst from \"../../config/const.js\";\r\nimport * as util from '../../util/util.js';\r\n\r\nimport {FileDialogArgs, FilePath} from '../platform_base.js';\r\n\r\nfunction getFilename(path) {\r\n  let filename = path.replace(/\\\\/g, \"/\");\r\n  let i = filename.length - 1;\r\n  while (i >= 0 && filename[i] !== \"/\") {\r\n    i--;\r\n  }\r\n\r\n  if (filename[i] === \"/\") {\r\n    i++;\r\n  }\r\n\r\n  if (i > 0) {\r\n    filename = filename.slice(i, filename.length).trim();\r\n  }\r\n\r\n  return filename;\r\n}\r\n\r\nlet _menu_init = false;\r\nlet _init = false;\r\n\r\nimport {mimeMap} from '../platform_base.js';\r\n\r\nlet electron_menu_idgen = 1;\r\nlet ipcRenderer;\r\n\r\nexport class ElectronMenu extends Array {\r\n  constructor(args = {}) {\r\n    super();\r\n\r\n    this._ipcId = electron_menu_idgen++;\r\n\r\n    for (let k in args) {\r\n      this[k] = args[k];\r\n    }\r\n  }\r\n\r\n  insert(i, item) {\r\n    this.length++;\r\n\r\n    let j = this.length - 1;\r\n    while (j > i) {\r\n      this[j] = this[j - 1];\r\n      j--;\r\n    }\r\n    this[i] = item;\r\n\r\n    return this;\r\n  }\r\n\r\n  static setApplicationMenu(menu) {\r\n    initElectronIpc();\r\n\r\n    ipcRenderer.invoke(\"set-menu-bar\", menu);\r\n  }\r\n\r\n  closePopup() {\r\n    ipcRenderer.invoke(\"close-menu\", this._ipcId);\r\n  }\r\n\r\n  append(item) {\r\n    this.push(item);\r\n  }\r\n\r\n  popup(args) {\r\n    let {x, y, callback} = args;\r\n\r\n    callback = wrapRemoteCallback(\"popup_menu_click\", callback);\r\n\r\n    const {ipcRenderer} = require('electron')\r\n    ipcRenderer.invoke(\"popup-menu\", this, x, y, callback);\r\n  }\r\n}\r\n\r\nlet callbacks = {};\r\nlet keybase = 1;\r\n\r\nexport function wrapRemoteCallback(key, callback) {\r\n  key = \"remote_\" + key + (keybase++);\r\n  callbacks[key] = callback;\r\n\r\n  return key;\r\n}\r\n\r\nlet ipcInit = false;\r\n\r\nfunction initElectronIpc() {\r\n  if (ipcInit) {\r\n    return;\r\n  }\r\n\r\n  ipcInit = true;\r\n  ipcRenderer = require('electron').ipcRenderer;\r\n\r\n  ipcRenderer.on('invoke-menu-callback', (event, key, args) => {\r\n    //console.error(\"Electron menu callback\", key, args);\r\n    callbacks[key].apply(undefined, args);\r\n  });\r\n\r\n  ipcRenderer.on(\"nativeTheme\", (event, module) => {\r\n    _nativeTheme = Object.assign({}, module);\r\n    _nativeTheme._themeSource = _nativeTheme.themeSource;\r\n\r\n    Object.defineProperty(_nativeTheme, \"themeSource\", {\r\n      get() {\r\n        return this._themeSource;\r\n      },\r\n      set(v) {\r\n        ipcRenderer.invoke(\"nativeTheme.setThemeSource\", v);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n\r\nexport class ElectronMenuItem {\r\n  constructor(args) {\r\n    for (let k in args) {\r\n      this[k] = args[k];\r\n    }\r\n\r\n    if (this.click) {\r\n      this.click = wrapRemoteCallback(\"menu_click\", this.click);\r\n    }\r\n  }\r\n}\r\n\r\nfunction patchDropBox() {\r\n  initElectronIpc();\r\n\r\n  if (cconst.noElectronMenus) {\r\n    return;\r\n  }\r\n\r\n  //haveElectron = false;\r\n  //return;\r\n  DropBox.prototype._onpress = function _onpress(e) {\r\n    if (this._menu !== undefined) {\r\n      this._menu.close();\r\n      this._menu = undefined;\r\n      this._pressed = false;\r\n      this._redraw();\r\n      return;\r\n    }\r\n\r\n    this._build_menu();\r\n\r\n    let emenu = buildElectronMenu(this._menu);\r\n\r\n    this._menu.close = () => {\r\n      emenu.closePopup(); //getCurrentWindow);\r\n    };\r\n\r\n    //console.log(\"menu dropbox click\", this._menu);\r\n\r\n    if (this._menu === undefined) {\r\n      return;\r\n    }\r\n\r\n    this._menu._dropbox = this;\r\n    this.dom._background = this.getDefault(\"BoxDepressed\");\r\n    this._background = this.getDefault(\"BoxDepressed\");\r\n    this._redraw();\r\n    this._pressed = true;\r\n    this.setCSS();\r\n\r\n    let onclose = this._menu.onclose;\r\n    this._menu.onclose = () => {\r\n      this._pressed = false;\r\n      this._redraw();\r\n\r\n      let menu = this._menu;\r\n      if (menu) {\r\n        this._menu = undefined;\r\n        menu._dropbox = undefined;\r\n      }\r\n\r\n      if (onclose) {\r\n        onclose.call(menu);\r\n      }\r\n    }\r\n\r\n    let menu = this._menu;\r\n    let screen = this.getScreen();\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let x = e.x, y = e.y;\r\n    let rects = this.dom.getClientRects();\r\n\r\n    x = rects[0].x;\r\n    y = rects[0].y + Math.ceil(rects[0].height);\r\n\r\n    x = ~~x;\r\n    y = ~~y;\r\n\r\n    emenu.popup({\r\n      x       : x,\r\n      y       : y,\r\n      callback: () => {\r\n\r\n        if (this._menu) {\r\n          this._menu.onclose();\r\n        }\r\n      }\r\n    })\r\n  };\r\n}\r\n\r\nlet on_tick = () => {\r\n  let nativeTheme = getNativeTheme();\r\n\r\n  if (nativeTheme) {\r\n    let mode = nativeTheme.shouldUseDarkColors ? \"dark\" : \"light\";\r\n\r\n    if (mode !== cconst.colorSchemeType) {\r\n      nativeTheme.themeSource = cconst.colorSchemeType;\r\n    }\r\n  }\r\n}\r\n\r\nexport function checkInit() {\r\n  if (window.haveElectron && !_init) {\r\n    _init = true;\r\n\r\n\r\n    patchDropBox();\r\n    setInterval(on_tick, 350);\r\n  }\r\n}\r\n\r\nexport let iconcache = {};\r\n\r\nfunction makeIconKey(icon, iconsheet, invertColors) {\r\n  return \"\" + icon + \":\" + iconsheet + \":\" + invertColors;\r\n}\r\n\r\nexport function getNativeIcon(icon, iconsheet = 0, invertColors = false, size = 16) {\r\n  //let key = makeIconKey(icon, iconsheet, invertColors);\r\n  //if (key in iconcache) {\r\n  //  return iconcache[key];\r\n  //}\r\n\r\n  let icongen;\r\n\r\n  try {\r\n    icongen = myRequire(\"./icogen.js\");\r\n  } catch (error) {\r\n    icongen = myRequire(\"./icogen.cjs\");\r\n  }\r\n\r\n\r\n  window.icongen = icongen;\r\n  let nativeImage = getElectron().nativeImage;\r\n\r\n  let manager = getIconManager();\r\n  let sheet = manager.findSheet(iconsheet);\r\n  let images = [];\r\n\r\n  let sizes = icongen.GetRequiredICOImageSizes();\r\n\r\n  //for (let size of sizes) {\r\n  if (1) {\r\n    let iconsheet = manager.findClosestSheet(size);\r\n    let tilesize = manager.getTileSize(iconsheet);\r\n\r\n    let canvas = document.createElement(\"canvas\");\r\n    let g = canvas.getContext(\"2d\");\r\n\r\n    canvas.width = canvas.height = size;\r\n\r\n    if (invertColors) {\r\n      g.filter = \"invert(100%)\";\r\n    }\r\n\r\n    let scale = size/tilesize;\r\n    g.scale(scale, scale);\r\n\r\n    manager.canvasDraw({getDPI: () => 1.0}, canvas, g, icon, 0, 0, iconsheet);\r\n\r\n    let header = \"data:image/png;base64,\";\r\n    let data = canvas.toDataURL();\r\n\r\n    data = data.slice(header.length, data.length);\r\n    data = Buffer.from(data, \"base64\");\r\n\r\n    myRequire(\"fs\").writeFileSync(\"./myicon2.png\", data);\r\n\r\n    images.push(data);\r\n  }\r\n  //}\r\n\r\n  //let ico = icongen.GenerateICO(images);\r\n  //icon = nativeImage.createFromBuffer(ico);\r\n  //icon = nativeImage.createFromBitmap(ico);\r\n  //myRequire(\"fs\").writeFileSync(\"myicon2.ico\", ico);\r\n  return \"myicon2.png\"\r\n  return icon;\r\n  return undefined\r\n\r\n  window._icon = icon;\r\n  return icon;\r\n}\r\n\r\nlet map = {\r\n  CTRL   : \"Control\",\r\n  ALT    : \"Alt\",\r\n  SHIFT  : \"Shift\",\r\n  COMMAND: \"Command\"\r\n};\r\n\r\nexport function buildElectronHotkey(hk) {\r\n  hk = hk.trim().replace(/[ \\t-]+/g, \"+\");\r\n  for (let k in map) {\r\n    hk = hk.replace(k, map[k]);\r\n  }\r\n\r\n  return hk;\r\n}\r\n\r\nexport function buildElectronMenu(menu) {\r\n  let electron = getElectron().remote;\r\n\r\n  initElectronIpc();\r\n\r\n  //let ElectronMenu = electron.Menu;\r\n  //let ElectronMenuItem = electron.MenuItem;\r\n\r\n  let emenu = new ElectronMenu();\r\n\r\n  let buildItem = (item) => {\r\n    if (item._isMenu) {\r\n      let menu2 = item._menu;\r\n\r\n      return new ElectronMenuItem({\r\n        submenu: buildElectronMenu(item._menu),\r\n        label  : menu2.getAttribute(\"title\")\r\n      });\r\n    }\r\n\r\n\r\n    let hotkey = item.hotkey;\r\n    let icon = item.icon;\r\n    let label = \"\" + item.label;\r\n\r\n    if (hotkey && typeof hotkey !== \"string\") {\r\n      hotkey = buildElectronHotkey(hotkey);\r\n    } else {\r\n      hotkey = \"\" + hotkey;\r\n    }\r\n\r\n    if (icon < 0) {\r\n      icon = undefined;\r\n    }\r\n\r\n    let args = {\r\n      id                 : \"\" + item._id,\r\n      label              : label,\r\n      accelerator        : hotkey,\r\n      icon               : icon ? getNativeIcon(icon) : undefined,\r\n      click              : function () {\r\n        menu.onselect(item._id);\r\n      },\r\n      registerAccelerator: false\r\n    };\r\n\r\n    return new ElectronMenuItem(args);\r\n  }\r\n\r\n  for (let item of menu.items) {\r\n    //buildItem(item);\r\n    emenu.append(buildItem(item));\r\n\r\n  }\r\n\r\n  return emenu;\r\n}\r\n\r\nexport function initMenuBar(menuEditor, override = false) {\r\n  checkInit();\r\n\r\n  if (!window.haveElectron) {\r\n    return;\r\n  }\r\n\r\n  if (_menu_init && !override) {\r\n    return;\r\n  }\r\n\r\n  _menu_init = true;\r\n\r\n  //let win = electron.getCurrentWindow();\r\n\r\n  let menu = new ElectronMenu();\r\n\r\n  let _roles = new Set([\"undo\", \"redo\", \"cut\", \"copy\", \"paste\", \"delete\", \"about\",\r\n                        \"quit\", \"open\", \"save\", \"load\", \"paste\", \"cut\", \"zoom\"]);\r\n  let roles = {};\r\n  for (let k of _roles) {\r\n    roles[k] = k;\r\n  }\r\n\r\n  roles = Object.assign(roles, {\r\n    \"select all\": \"selectAll\",\r\n    \"file\"      : \"fileMenu\",\r\n    \"edit\"      : \"editMenu\",\r\n    \"view\"      : \"viewMenu\",\r\n    \"app\"       : \"appMenu\",\r\n    \"help\"      : \"help\",\r\n    \"zoom in\"   : \"zoomIn\",\r\n    \"zoom out\"  : \"zoomOut\"\r\n  });\r\n\r\n  /*\r\n  let item = new MenuItem({\r\n    label : \"Label\",\r\n    tooltip : \"Tooltip\",\r\n    icon : getNativeIcon(0),\r\n    accelerator : \"Control+Z\",\r\n    checked : true,\r\n    id : 0,\r\n    role : undefined,\r\n    click : (arg) => {\r\n      console.log(\"menu click!\", arg)\r\n    },\r\n    submenu : undefined,\r\n    role :  undo, redo, cut, copy, paste, pasteAndMatchStyle, delete, selectAll, reload,\r\n            forceReload, toggleDevTools, resetZoom, zoomIn, zoomOut, togglefullscreen, window,\r\n             minimize, close, help, about, services, hide, hideOthers, unhide, quit, startSpeaking,\r\n             stopSpeaking, close, minimize, zoom, front, appMenu, fileMenu, editMenu, viewMenu, recentDocuments,\r\n              toggleTabBar, selectNextTab, selectPreviousTab, mergeAllWindows, clearRecentDocuments, moveTabToNewWindow\r\n               or windowMenu - Define the action of the menu item, when specified the click property will be ignored.\r\n                See roles.\r\n\r\n  });//*/\r\n\r\n\r\n  let header = menuEditor.header;\r\n  for (let dbox of header.traverse(DropBox)) {\r\n    dbox._build_menu();\r\n    dbox.update();\r\n\r\n    dbox._build_menu();\r\n    let menu2 = dbox._menu;\r\n    menu2.ctx = dbox.ctx;\r\n    menu2._init();\r\n    menu2.update();\r\n\r\n    let title = dbox._genLabel();\r\n    let args = {\r\n      label  : title,\r\n      tooltip: dbox.description,\r\n      submenu: buildElectronMenu(menu2)\r\n    };\r\n\r\n    menu.insert(0, new ElectronMenuItem(args));\r\n  }\r\n\r\n\r\n  ElectronMenu.setApplicationMenu(menu);\r\n  //win.setMenu(menu);\r\n}\r\n\r\nimport {PlatformAPI, isMimeText} from '../platform_base.js';\r\n\r\nexport class platform extends PlatformAPI {\r\n  static showOpenDialog(title, args = new FileDialogArgs()) {\r\n    console.log(args.filters);\r\n\r\n    let eargs = {\r\n      defaultPath: args.defaultPath,\r\n      filters    : this._sanitizeFilters(args.filters ?? []),\r\n      properties : [\r\n        \"openFile\", \"showHiddenFiles\", \"createDirectory\"\r\n      ]\r\n    }\r\n\r\n    if (args.multi) {\r\n      eargs.properties.push(\"multiSelections\");\r\n    }\r\n\r\n    if (!args.addToRecentList) {\r\n      eargs.properties.push(\"dontAddToRecent\");\r\n    }\r\n\r\n    initElectronIpc();\r\n\r\n    return new Promise((accept, reject) => {\r\n      ipcRenderer.invoke('show-open-dialog', eargs, wrapRemoteCallback(\"open-dialog\", (ret) => {\r\n        if (ret.canceled || ret.cancelled) {\r\n          reject(\"cancel\");\r\n        } else {\r\n          accept(ret.filePaths.map(f => new FilePath(f, getFilename(f))));\r\n        }\r\n      }), wrapRemoteCallback(\"show-open-dialog\", (error) => {\r\n        reject(error);\r\n      }));\r\n    });\r\n  }\r\n\r\n  static _sanitizeFilters(filters) {\r\n    let filters2 = [];\r\n\r\n    for (let filter of filters) {\r\n      if (Array.isArray(filter)) {\r\n        let ext = filter[0];\r\n\r\n        filter = {extensions: filter};\r\n\r\n        ext = ext.replace(/\\./g, \"\").trim().toLowerCase();\r\n        if (ext in mimeMap) {\r\n          filter.mime = mimeMap[ext];\r\n        }\r\n\r\n        filter.name = ext;\r\n      }\r\n\r\n      console.log(filter.extensions);\r\n      filter.extensions = filter.extensions.map(f => f.startsWith(\".\") ? f.slice(1, f.length) : f);\r\n\r\n      filters2.push(filter);\r\n    }\r\n\r\n    return filters2;\r\n  }\r\n\r\n  static showSaveDialog(title, filedata_cb, args = new FileDialogArgs()) {\r\n    console.log(args.filters);\r\n\r\n    let eargs = {\r\n      defaultPath: args.defaultPath,\r\n      filters    : this._sanitizeFilters(args.filters ?? []),\r\n      properties : [\r\n        \"openFile\", \"showHiddenFiles\", \"createDirectory\"\r\n      ]\r\n    }\r\n\r\n    if (args.multi) {\r\n      eargs.properties.push(\"multiSelections\");\r\n    }\r\n\r\n    if (!args.addToRecentList) {\r\n      eargs.properties.push(\"dontAddToRecent\");\r\n    }\r\n\r\n    return new Promise((accept, reject) => {\r\n      initElectronIpc();\r\n\r\n      let onthen = (ret) => {\r\n        if (ret.canceled) {\r\n          reject(\"cancel\");\r\n        } else {\r\n          let path = ret.filePath;\r\n          let filedata = filedata_cb();\r\n\r\n          if (filedata instanceof ArrayBuffer) {\r\n            filedata = new Uint8Array(filedata);\r\n          }\r\n\r\n          require('fs').writeFileSync(path, filedata);\r\n          console.log(\"saved file\", filedata);\r\n\r\n          accept(new FilePath(path, getFilename(path)));\r\n        }\r\n      }\r\n\r\n      let oncatch = (error) => {\r\n        reject(error);\r\n      }\r\n\r\n      ipcRenderer.invoke('show-save-dialog', eargs, wrapRemoteCallback('dialog', onthen), wrapRemoteCallback('dialog', oncatch));\r\n\r\n    });\r\n  }\r\n\r\n  static readFile(path, mime) {\r\n    return new Promise((accept, reject) => {\r\n      let fs = require('fs');\r\n\r\n      if (isMimeText(mime)) {\r\n        accept(fs.readFileSync(path.data, \"utf8\"));\r\n      } else {\r\n        accept(fs.readFileSync(path.data).buffer);\r\n      }\r\n    });\r\n  }\r\n\r\n  static writeFile(data, handle, mime) {\r\n    return new Promise((accept, reject) => {\r\n      let fs = require('fs');\r\n\r\n      fs.writeFileSync(handle.data, data);\r\n      accept(handle);\r\n    });\r\n  }\r\n}\r\n","\"use strict\";\r\nexport const SVG_URL = 'http://www.w3.org/2000/svg';\r\n\r\nimport * as util from './util.js';\r\nimport * as vectormath from './vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as ui from '../core/ui.js';\r\nimport * as math from './math.js';\r\n\r\nconst Vector2 = vectormath.Vector2;\r\n\r\nexport class CanvasOverdraw extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.shadow.appendChild(this.canvas);\r\n    this.g = this.canvas.getContext(\"2d\");\r\n\r\n    this.screen = undefined;\r\n    this.shapes = [];\r\n    this.otherChildren = []; //non-svg elements\r\n    this.font = undefined;\r\n\r\n    let style = document.createElement(\"style\")\r\n    style.textContent = `\r\n      .overdrawx {\r\n        pointer-events : none;\r\n      }\r\n    `;\r\n\r\n    this.shadow.appendChild(style);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname : 'screen-overdraw-canvas-x'\r\n    }\r\n  }\r\n\r\n  startNode(node, screen) {\r\n    if (screen) {\r\n      this.screen = screen;\r\n      this.ctx = screen.ctx;\r\n    }\r\n\r\n    if (!this.parentNode) {\r\n      node.appendChild(this);\r\n    }\r\n\r\n    this.style[\"display\"] = \"float\";\r\n    this.style[\"z-index\"] = this.zindex_base;\r\n\r\n    this.style[\"position\"] = \"absolute\";\r\n    this.style[\"left\"] = \"0px\";\r\n    this.style[\"top\"] = \"0px\";\r\n\r\n    this.style[\"width\"] = \"100%\" //screen.size[0] + \"px\";\r\n    this.style[\"height\"] = \"100%\" //screen.size[1] + \"px\";\r\n\r\n    this.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.svg = document.createElementNS(SVG_URL, \"svg\");\r\n    this.svg.style[\"width\"] = \"100%\";\r\n    this.svg.style[\"height\"] = \"100%\";\r\n\r\n    this.svg.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.shadow.appendChild(this.svg);\r\n    //this.style[\"background-color\"] = \"green\";\r\n  }\r\n\r\n  start(screen) {\r\n    this.screen = screen;\r\n    this.ctx = screen.ctx;\r\n\r\n    screen.parentNode.appendChild(this);\r\n\r\n    this.style[\"display\"] = \"float\";\r\n    this.style[\"z-index\"] = this.zindex_base;\r\n\r\n    this.style[\"position\"] = \"absolute\";\r\n    this.style[\"left\"] = \"0px\";\r\n    this.style[\"top\"] = \"0px\";\r\n\r\n    this.style[\"width\"] = screen.size[0] + \"px\";\r\n    this.style[\"height\"] = screen.size[1] + \"px\";\r\n\r\n    this.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.svg = document.createElementNS(SVG_URL, \"svg\");\r\n    this.svg.style[\"width\"] = \"100%\";\r\n    this.svg.style[\"height\"] = \"100%\";\r\n\r\n    this.shadow.appendChild(this.svg);\r\n\r\n    //this.style[\"background-color\"] = \"green\";\r\n  }\r\n}\r\n\r\nexport class Overdraw extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.visibleToPick = false;\r\n\r\n    this.screen = undefined;\r\n    this.shapes = [];\r\n    this.otherChildren = []; //non-svg elements\r\n    this.font = undefined;\r\n\r\n    let style = document.createElement(\"style\")\r\n    style.textContent = `\r\n      .overdrawx {\r\n        pointer-events : none;\r\n      }\r\n    `;\r\n\r\n    this.shadow.appendChild(style);\r\n\r\n    this.zindex_base = 1000;\r\n  }\r\n\r\n  startNode(node, screen, cssPosition=\"relative\") {\r\n    if (screen) {\r\n      this.screen = screen;\r\n      this.ctx = screen.ctx;\r\n    }\r\n\r\n    if (!this.parentNode) {\r\n      node.appendChild(this);\r\n    }\r\n\r\n    this.style[\"z-index\"] = this.zindex_base;\r\n\r\n    this.style[\"position\"] = cssPosition;\r\n\r\n    //this.style[\"left\"] = \"0px\";\r\n    //this.style[\"top\"] = \"0px\";\r\n    this.style[\"margin\"] = this.style[\"padding\"] = \"0px\";\r\n\r\n    this.style[\"width\"] = \"100%\" //screen.size[0] + \"px\";\r\n    this.style[\"height\"] = \"100%\" //screen.size[1] + \"px\";\r\n\r\n    this.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.svg = document.createElementNS(SVG_URL, \"svg\");\r\n    this.svg.style[\"width\"] = \"100%\";\r\n    this.svg.style[\"height\"] = \"100%\";\r\n\r\n    this.svg.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.shadow.appendChild(this.svg);\r\n    //this.style[\"background-color\"] = \"green\";\r\n  }\r\n\r\n  start(screen) {\r\n    this.screen = screen;\r\n    this.ctx = screen.ctx;\r\n\r\n    screen.parentNode.appendChild(this);\r\n\r\n    this.style[\"display\"] = \"float\";\r\n    this.style[\"z-index\"] = this.zindex_base;\r\n\r\n    this.style[\"position\"] = \"absolute\";\r\n    this.style[\"left\"] = \"0px\";\r\n    this.style[\"top\"] = \"0px\";\r\n\r\n    this.style[\"width\"] = screen.size[0] + \"px\";\r\n    this.style[\"height\"] = screen.size[1] + \"px\";\r\n\r\n    this.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.svg = document.createElementNS(SVG_URL, \"svg\");\r\n    this.svg.style[\"width\"] = \"100%\";\r\n    this.svg.style[\"height\"] = \"100%\";\r\n\r\n    this.shadow.appendChild(this.svg);\r\n\r\n    //this.style[\"background-color\"] = \"green\";\r\n  }\r\n\r\n  clear() {\r\n    for (let child of util.list(this.svg.childNodes)) {\r\n      child.remove();\r\n    }\r\n\r\n    for (let child of this.otherChildren) {\r\n      child.remove();\r\n    }\r\n\r\n    this.otherChildren.length = 0;\r\n  }\r\n\r\n  drawTextBubbles(texts, cos, colors) {\r\n    let boxes = [];\r\n    let elems = [];\r\n\r\n    let cent = new Vector2();\r\n\r\n    for (let i=0; i<texts.length; i++) {\r\n      let co = cos[i];\r\n      let text = texts[i];\r\n      let color;\r\n\r\n      if (colors !== undefined) {\r\n        color = colors[i];\r\n      }\r\n\r\n      cent.add(co);\r\n      let box = this.text(texts[i], co[0], co[1], {color : color});\r\n\r\n      boxes.push(box);\r\n      let font = box.style[\"font\"];\r\n      let pat = /[0-9]+px/;\r\n      let size = font.match(pat)[0];\r\n\r\n      //console.log(\"size\", size);\r\n\r\n      if (size === undefined) {\r\n        size = this.getDefault(\"DefaultText\").size;\r\n      } else {\r\n        size = ui_base.parsepx(size);\r\n      }\r\n\r\n      //console.log(size);\r\n      let tsize = ui_base.measureTextBlock(this, text, undefined, undefined, size, font);\r\n\r\n      box.minsize = [\r\n        ~~tsize.width,\r\n        ~~tsize.height\r\n      ];\r\n\r\n      let pad = ui_base.parsepx(box.style[\"padding\"]);\r\n\r\n      box.minsize[0] += pad*2;\r\n      box.minsize[1] += pad*2;\r\n\r\n      let x = ui_base.parsepx(box.style[\"left\"]);\r\n      let y = ui_base.parsepx(box.style[\"top\"]);\r\n\r\n      box.grads = new Array(4);\r\n      box.params = [x, y, box.minsize[0], box.minsize[1]];\r\n      box.startpos = new Vector2([x, y]);\r\n\r\n      box.setCSS = function() {\r\n        this.style[\"padding\"] = \"0px\";\r\n        this.style[\"margin\"] = \"0px\";\r\n        this.style[\"left\"] = ~~this.params[0] + \"px\";\r\n        this.style[\"top\"] = ~~this.params[1] + \"px\";\r\n        this.style[\"width\"] = ~~this.params[2] + \"px\";\r\n        this.style[\"height\"] = ~~this.params[3] + \"px\";\r\n      };\r\n\r\n      box.setCSS();\r\n      //console.log(box.params);\r\n      elems.push(box);\r\n    }\r\n\r\n    if (boxes.length === 0) {\r\n      return;\r\n    }\r\n\r\n    cent.mulScalar(1.0 / boxes.length);\r\n\r\n    function error() {\r\n      let p1 = [0, 0], p2 = [0, 0];\r\n      let s1 = [0, 0], s2 = [0, 0];\r\n\r\n      let ret = 0.0;\r\n\r\n      for (let box1 of boxes) {\r\n        for (let box2 of boxes) {\r\n          if (box2 === box1) {\r\n            continue;\r\n          }\r\n\r\n          s1[0] = box1.params[2];\r\n          s1[1] = box1.params[3];\r\n          s2[0] = box2.params[2];\r\n          s2[1] = box2.params[3];\r\n\r\n          let overlap = math.aabb_overlap_area(box1.params, s1, box2.params, s2);\r\n          ret += overlap;\r\n        }\r\n\r\n        ret += box1.startpos.vectorDistance(box1.params)*0.25;\r\n      }\r\n\r\n      return ret;\r\n    }\r\n\r\n    function solve() {\r\n      //console.log(\"ERROR\", error());\r\n      let r1 = error();\r\n      if (r1 === 0.0) {\r\n        return;\r\n      }\r\n\r\n      let df = 0.0001;\r\n      let totgs = 0.0;\r\n\r\n      for (let box of boxes) {\r\n        for (let i=0; i<box.params.length; i++) {\r\n          let orig = box.params[i];\r\n          box.params[i] += df;\r\n          let r2 = error();\r\n          box.params[i] = orig;\r\n\r\n          box.grads[i] = (r2 - r1) / df;\r\n          totgs += box.grads[i]**2;\r\n        }\r\n      }\r\n\r\n      if (totgs === 0.0) {\r\n        return;\r\n      }\r\n\r\n      r1 /= totgs;\r\n      let k = 0.4;\r\n\r\n      for (let box of boxes) {\r\n        for (let i = 0; i < box.params.length; i++) {\r\n          box.params[i] += -r1*box.grads[i]*k;\r\n        }\r\n\r\n        box.params[2] = Math.max(box.params[2], box.minsize[0]);\r\n        box.params[3] = Math.max(box.params[3], box.minsize[1]);\r\n\r\n        box.setCSS();\r\n      }\r\n    }\r\n\r\n    for (let i=0; i<15; i++) {\r\n      solve();\r\n    }\r\n\r\n    for (let box of boxes) {\r\n      elems.push(this.line(box.startpos, box.params));\r\n    }\r\n\r\n    return elems;\r\n  }\r\n\r\n  text(text, x, y, args={}) {\r\n    args = Object.assign({}, args);\r\n\r\n    if (args.font === undefined) {\r\n      if (this.font !== undefined)\r\n        args.font = this.font;\r\n      else\r\n        args.font = this.getDefault(\"DefaultText\").genCSS();\r\n    }\r\n\r\n    if (!args[\"background-color\"]) {\r\n      args[\"background-color\"] = \"rgba(75, 75, 75, 0.75)\";\r\n    }\r\n\r\n    args.color = args.color ? args.color : \"white\";\r\n    if (typeof args.color === \"object\") {\r\n      args.color = ui_base.color2css(args.color);\r\n    }\r\n\r\n    args[\"padding\"] = args[\"padding\"] === undefined ? \"5px\" : args[\"padding\"];\r\n    args[\"border-color\"] = args[\"border-color\"] ? args[\"border-color\"] : \"grey\";\r\n    args[\"border-radius\"] = args[\"border-radius\"] ? args[\"border-radius\"] : \"25px\";\r\n    args[\"border-width\"] = args[\"border-width\"] !== undefined ? args[\"border-width\"] : \"2px\";\r\n\r\n    if (typeof args[\"border-width\"] === \"number\") {\r\n      args[\"border-width\"] = \"\" + args[\"border-width\"] + \"px\";\r\n    }\r\n    if (typeof args[\"border-radius\"] === \"number\") {\r\n      args[\"border-radius\"] = \"\" + args[\"border-radius\"] + \"px\";\r\n    }\r\n\r\n    //not sure I need SVG for this. . .\r\n    let box = document.createElement(\"div\")\r\n\r\n    box.setAttribute(\"class\", \"overdrawx\");\r\n\r\n    box.style[\"position\"] = \"fixed\";\r\n    box.style[\"width\"] = \"min-contents\";\r\n    box.style[\"height\"] = \"min-contents\";\r\n    box.style[\"border-width\"] = args[\"border-width\"]\r\n    box.style[\"border-radius\"] = \"25px\";\r\n    box.style[\"pointer-events\"] = \"none\";\r\n    box.style[\"z-index\"] = this.zindex_base + 1;\r\n    box.style[\"background-color\"] = args[\"background-color\"];\r\n    box.style[\"padding\"] = args[\"padding\"];\r\n\r\n    box.style[\"left\"] = x + \"px\";\r\n    box.style[\"top\"] = y + \"px\";\r\n\r\n    box.style[\"display\"] = \"flex\";\r\n    box.style[\"justify-content\"] = \"center\";\r\n    box.style[\"align-items\"] = \"center\";\r\n\r\n    box.innerText = text;\r\n    box.style[\"font\"] = args.font;\r\n    box.style[\"color\"] = args.color;\r\n\r\n    this.otherChildren.push(box);\r\n    this.shadow.appendChild(box);\r\n\r\n    return box;\r\n  }\r\n\r\n  circle(p, r, stroke=\"black\", fill=\"none\") {\r\n    let circle = document.createElementNS(SVG_URL, \"circle\");\r\n    circle.setAttribute(\"cx\", p[0]);\r\n    circle.setAttribute(\"cy\", p[1]);\r\n    circle.setAttribute(\"r\", r);\r\n\r\n    if (fill) {\r\n      circle.setAttribute(\"style\", `stroke:${stroke};stroke-width:2;fill:${fill}`);\r\n    } else {\r\n      circle.setAttribute(\"style\", `stroke:${stroke};stroke-width:2`);\r\n    }\r\n\r\n    this.svg.appendChild(circle);\r\n\r\n    return circle;\r\n  }\r\n\r\n  line(v1, v2, color=\"black\") {\r\n    let line = document.createElementNS(SVG_URL, \"line\");\r\n    line.setAttribute(\"x1\", v1[0]);\r\n    line.setAttribute(\"y1\", v1[1]);\r\n    line.setAttribute(\"x2\", v2[0]);\r\n    line.setAttribute(\"y2\", v2[1]);\r\n    line.setAttribute(\"style\", `stroke:${color};stroke-width:2`);\r\n\r\n    this.svg.appendChild(line);\r\n    return line;\r\n  }\r\n\r\n  rect(p, size, color=\"black\") {\r\n    let line = document.createElementNS(SVG_URL, \"rect\");\r\n    line.setAttribute(\"x\", p[0]);\r\n    line.setAttribute(\"y\", p[1]);\r\n    line.setAttribute(\"width\", size[0]);\r\n    line.setAttribute(\"height\", size[1]);\r\n    line.setAttribute(\"style\", `fill:${color};stroke-width:2`);\r\n\r\n    line.setColor = (color) => {\r\n      line.setAttribute(\"style\", `fill:${color};stroke-width:2`);\r\n    };\r\n\r\n    this.svg.appendChild(line);\r\n    return line;\r\n  }\r\n\r\n  end() {\r\n    this.clear();\r\n    this.remove();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"overdraw-x\",\r\n    style   : \"overdraw\"\r\n  };}\r\n}\r\n\r\nui_base.UIBase.internalRegister(Overdraw);\r\n","import '../util/ScreenOverdraw.js';\r\nimport {UIBase, Icons} from '../core/ui_base.js';\r\nimport {Container} from '../core/ui.js';\r\nimport {pushModalLight, popModalLight, keymap} from '../path-controller/util/simple_events.js';\r\nimport {parsepx} from '../core/ui_theme.js';\r\nimport {Vector2} from '../path-controller/util/vectormath.js';\r\nimport * as math from '../path-controller/util/math.js';\r\n\r\nexport class TreeItem extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.treeParent = undefined;\r\n    this.treeChildren = [];\r\n    this.treeView = undefined;\r\n    this.treeDepth = 0;\r\n\r\n    this.header = this.row();\r\n\r\n    this._icon1 = this.header.iconbutton(Icons.TREE_COLLAPSE);\r\n    this._icon1.iconsheet = 0;\r\n    this._icon1.drawButtonBG = false;\r\n\r\n    this._icon2 = undefined;\r\n\r\n    this._icon1.onclick = () => {\r\n      if (this.opened) {\r\n        this.close();\r\n      }  else {\r\n        this.open();\r\n      }\r\n    }\r\n\r\n    this.opened = true;\r\n\r\n    this._label = this.header.label(\"unlabeled\");\r\n    this._labelText = \"unlabeled\";\r\n  }\r\n\r\n  set icon(id) {\r\n    if (this._icon2) {\r\n      this._icon2 = id;\r\n    } else {\r\n      this._icon2 = UIBase.createElement(\"icon-label-x\");\r\n      this._icon2.icon = id;\r\n      this._icon2.iconsheet = 0;\r\n\r\n\r\n      this.header.insert(1, this._icon2);\r\n    }\r\n  }\r\n\r\n  get icon() {\r\n    if (this._icon2)\r\n      return this._icon2.icon;\r\n    else\r\n      return -1;\r\n  }\r\n\r\n  open() {\r\n    this._icon1.icon = Icons.TREE_COLLAPSE;\r\n    this.opened = true;\r\n    this.treeView._open(this);\r\n  }\r\n\r\n  close() {\r\n    this._icon1.icon = Icons.TREE_EXPAND;\r\n    this.opened = false;\r\n    this.treeView._close(this);\r\n  }\r\n\r\n  set text(b) {\r\n    if (typeof b === \"string\") {\r\n      this._label.text = b;\r\n      this._labelText = b;\r\n    } else if (b instanceof HTMLElement) {\r\n      this._label.remove();\r\n      this.header.add(b);\r\n\r\n      this._label = b;\r\n      this._labelText = b;\r\n    }\r\n  }\r\n\r\n  get text() {\r\n    return this._labelText;\r\n  }\r\n\r\n\r\n  item(name, args={}) {\r\n    args.treeParent = this;\r\n    return this.parentWidget.item(name, args);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"tree-item-x\",\r\n    style   : \"treeview\"\r\n  }}\r\n}\r\nUIBase.internalRegister(TreeItem);\r\n\r\nexport class TreeView extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.items = [];\r\n    this.strokes = [];\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-direction\"] = \"column\";\r\n\r\n    //this.shadow.appendChild(this.overdraw);\r\n\r\n    this.overdraw = UIBase.createElement(\"overdraw-x\");\r\n    console.log(this.overdraw.startNode);\r\n    this.overdraw.startNode(this);\r\n\r\n    this.style[\"margin\"] = this.style[\"padding\"] = \"0px\";\r\n\r\n    this.updateOverdraw();\r\n  }\r\n\r\n  _forAllChildren(item, cb) {\r\n    let visit = (n) => {\r\n      cb(n);\r\n\r\n      for (let c of n.treeChildren) {\r\n        visit(c);\r\n      }\r\n    }\r\n\r\n    for (let c of item.treeChildren) {\r\n      visit(c);\r\n    }\r\n  }\r\n\r\n  _open(item) {\r\n    this._forAllChildren(item, (c) => {\r\n      if (c.opened) {\r\n        c.unhide();\r\n      }\r\n    })\r\n\r\n    this._makeStrokes();\r\n  }\r\n\r\n  _close(item) {\r\n    this._forAllChildren(item, (c) => {\r\n      c.hide();\r\n    })\r\n\r\n    this._makeStrokes();\r\n  }\r\n\r\n  _makeStrokes() {\r\n    if (!this.overdraw) {\r\n      //this.doOnce(this._makeStrokes);\r\n      return;\r\n    }\r\n\r\n    for (let elem of this.strokes) {\r\n      elem.remove();\r\n    }\r\n    this.strokes.length = 0;\r\n\r\n    let hidden = (item) => {\r\n      return item.hidden;\r\n      let p = item;\r\n\r\n      while (p) {\r\n        if (!p.opened)\r\n          return true;\r\n        p = p.treeParent;\r\n      }\r\n\r\n      return false;\r\n    }\r\n\r\n    let items = this.items;\r\n    if (items.length == 0) {\r\n      return;\r\n    }\r\n\r\n    this.overdraw.clear();\r\n\r\n    let next = (i) => {\r\n      i++;\r\n\r\n      while (i < items.length && hidden(items[i])) {\r\n        i++;\r\n        continue;\r\n      }\r\n\r\n      return i;\r\n    }\r\n\r\n    let i = 0;\r\n    if (hidden(items[i]))\r\n      i = next(i);\r\n\r\n    let origin = this.overdraw.getBoundingClientRect();\r\n    let overdraw = this.overdraw;\r\n\r\n    let line = function(x1, y1, x2, y2) {\r\n      let ox = origin.x, oy = origin.y;\r\n\r\n      x1 -= ox; y1 -= oy;\r\n      x2 -= ox; y2 -= oy;\r\n\r\n      overdraw.line([x1, y1], [x2, y2]);\r\n    }\r\n\r\n    console.log(\"making lines\", i);\r\n\r\n    let indent = this.getDefault(\"itemIndent\");\r\n    let rowh = this.getDefault(\"rowHeight\");\r\n\r\n    let getx = (depth) => {\r\n      return (depth+2.2)*indent + origin.x;\r\n    }\r\n\r\n    this.overdraw.style[\"z-index\"] = \"0\";\r\n\r\n    let prev = undefined;\r\n\r\n    for (; i<items.length; i = next(i)) {\r\n      let item = this.items[i];\r\n      let item2 = next(i);\r\n      item2 = item2 < items.length ? items[item2] : undefined;\r\n\r\n      let r = item._icon1.getBoundingClientRect();\r\n\r\n      if (!r) continue;\r\n\r\n      let x1 = getx(item.treeDepth);\r\n      let y1 = origin.y + (i+1)*rowh - rowh*0.25;\r\n\r\n\r\n      if (item2 && item2.treeDepth > item.treeDepth) {//} && (!prev || prev.treeDepth !== item.treeDepth)) {\r\n        let y2 = y1 + rowh*0.75;\r\n\r\n        line(x1, y1, x1, y2)\r\n        line(x1, y2, getx(item2.treeDepth)-3, y2);\r\n\r\n      } else if (item2 && item2.treeDepth === item.treeDepth) {\r\n        line(x1, y1, x1, y1+rowh*0.5)\r\n      }\r\n\r\n      prev = item;\r\n    }\r\n  }\r\n\r\n  updateOverdraw() {\r\n    let mm = new math.MinMax(2);\r\n    let ok = false;\r\n\r\n    for (let item of this.items) {\r\n      if (item.hidden) {\r\n        //continue;\r\n      }\r\n\r\n      for (let r of item.getClientRects()) {\r\n        //console.log(r.y);\r\n        mm.minmax([r.x, r.y]);\r\n        mm.minmax([r.x+r.width, r.y+r.height]);\r\n        ok = true;\r\n      }\r\n    }\r\n\r\n    if (!ok) {\r\n      return;\r\n    }\r\n\r\n    let r = this.getClientRects()[0];\r\n    if (!r) return;\r\n\r\n    let x = r.left;\r\n    let y = r.top;// - r.y;\r\n\r\n    let od = this.overdraw;\r\n    let w = mm.max[0] - mm.min[0];\r\n    let h = mm.max[1] - mm.min[1];\r\n\r\n    od.style[\"margin\"] = \"0px\";\r\n    od.style[\"padding\"] = \"0px\";\r\n    od.svg.style[\"margin\"] = \"0px\";\r\n\r\n    od.style[\"position\"] = UIBase.PositionKey;\r\n\r\n    od.style[\"width\"] = (r.width-1) + \"px\";\r\n    od.style[\"height\"] = (r.height-1) + \"px\";\r\n\r\n    od.style[\"left\"] = x + \"px\";\r\n    od.style[\"top\"] =  y + \"px\";\r\n\r\n    //od.style[\"background-color\"] = \"rgba(50, 50, 50, 0.25)\";\r\n    //od.svg.style[\"background-color\"] = \"rgba(50, 50, 50, 0.25)\";\r\n\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateOverdraw();\r\n  }\r\n\r\n  item(name, args={icon : undefined}) {\r\n    let ret = UIBase.createElement(\"tree-item-x\");\r\n    this.add(ret);\r\n    ret._init();\r\n\r\n    ret.text = name;\r\n\r\n    if (args.icon) {\r\n      ret.icon = args.icon;\r\n    }\r\n\r\n    ret.treeParent = args.treeParent;\r\n    ret.treeView = this;\r\n\r\n    //ret.style[\"margin-bottom\"] = ret.style[\"margin-top\"] = \"0px\";\r\n    //ret.style[\"padding-bottom\"] = ret.style[\"padding-top\"] = \"0px\";\r\n    ret.style[\"max-height\"] = this.getDefault(\"rowHeight\") + \"px\";\r\n\r\n    if (ret.treeParent) {\r\n      ret.treeParent.treeChildren.push(ret);\r\n      ret.treeDepth = ret.treeParent.treeDepth + 1;\r\n    }\r\n\r\n    let p = ret.treeParent;\r\n    let i = 1;\r\n    while (p) {\r\n      p = p.treeParent;\r\n      i++;\r\n    }\r\n\r\n    ret.style[\"margin-left\"] = (i*this.getDefault(\"itemIndent\")) + \"px\";\r\n    this.items.push(ret);\r\n\r\n    this.doOnce(() => {\r\n      this._makeStrokes();\r\n    });\r\n\r\n    return ret;\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"tree-view-x\",\r\n    style   : \"treeview\"\r\n  }}\r\n}\r\nUIBase.internalRegister(TreeView);\r\n\r\n","import {UIBase, Icons} from '../core/ui_base.js';\r\nimport {Container} from '../core/ui.js';\r\nimport {pushModalLight, popModalLight, keymap} from '../path-controller/util/simple_events.js';\r\nimport {parsepx} from '../core/ui_theme.js';\r\n\r\nfunction startDrag(box) {\r\n  if (box._modal) {\r\n    popModalLight(box._modal);\r\n    box._modal = undefined;\r\n    return;\r\n  }\r\n\r\n  let first = true;\r\n  let lastx = 0;\r\n  let lasty = 0;\r\n\r\n  let handlers = {\r\n    on_mousemove(e) {\r\n      let x = e.x, y = e.y;\r\n\r\n      if (first) {\r\n        lastx = x;\r\n        lasty = y;\r\n        first = false;\r\n\r\n        return;\r\n      }\r\n\r\n      let dx = x - lastx;\r\n      let dy = y - lasty;\r\n\r\n      let hx = parsepx(box.style[\"left\"]);\r\n      let hy = parsepx(box.style[\"top\"]);\r\n\r\n      hx += dx;\r\n      hy += dy;\r\n\r\n      console.log(hx, hy);\r\n\r\n      box.style[\"left\"] = hx + \"px\";\r\n      box.style[\"top\"] = hy + \"px\";\r\n\r\n      lastx = x;\r\n      lasty = y;\r\n    },\r\n\r\n    end() {\r\n      if (box._modal) {\r\n        popModalLight(box._modal);\r\n        box._modal = undefined;\r\n      }\r\n    },\r\n\r\n    on_mouseup(e) {\r\n      this.end();\r\n    },\r\n\r\n    on_keydown(e) {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Escape\"]:\r\n        case keymap[\"Return\"]:\r\n          this.end();\r\n          break;\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  box._modal = pushModalLight(handlers);\r\n}\r\n\r\nexport class DragBox extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this._done = false;\r\n    this.header = UIBase.createElement(\"rowframe-x\");\r\n    this.contents = UIBase.createElement(\"container-x\");\r\n\r\n    this.header.style[\"border-radius\"] = \"20px\";\r\n\r\n    this.header.parentWidget = this;\r\n    this.contents.parentWidget = this;\r\n\r\n    this.shadow.appendChild(this.header);\r\n    this.shadow.appendChild(this.contents);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    let header = this.header;\r\n\r\n    header.ctx = this.ctx;\r\n    this.contents.ctx = this.ctx;\r\n    header._init();\r\n    this.contents._init();\r\n\r\n    this.style[\"min-width\"] = \"350px\";\r\n    header.style[\"height\"] = \"35px\";\r\n\r\n    let icon = header.iconbutton(Icons.DELETE, \"Hide\", () => {\r\n      this.end();\r\n    });\r\n    icon.iconsheet = 0; //use small icons\r\n\r\n    this.addEventListener(\"mousedown\", (e) => {\r\n      console.log(\"start drag\");\r\n      startDrag(this);\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n\r\n    }, {capture : false})\r\n\r\n    header.background = this.getDefault(\"background-color\");\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  add() {\r\n    return this.contents.add(...arguments);\r\n  }\r\n\r\n  prepend(n) {\r\n    return this.contents.prepend(n);\r\n  }\r\n\r\n  appendChild(n) {\r\n    return this.contents.appendChild(n);\r\n  }\r\n  col() {\r\n    return this.contents.col(...arguments);\r\n  }\r\n\r\n  row() {\r\n    return this.contents.row(...arguments);\r\n  }\r\n\r\n  strip() {\r\n    return this.contents.strip(...arguments);\r\n  }\r\n  button() {\r\n    return this.contents.button(...arguments);\r\n  }\r\n  iconbutton() {\r\n    return this.contents.iconbutton(...arguments);\r\n  }\r\n  iconcheck() {\r\n    return this.contents.iconcheck(...arguments);\r\n  }\r\n  tool() {\r\n    return this.contents.tool(...arguments);\r\n  }\r\n  menu() {\r\n    return this.contents.menu(...arguments);\r\n  }\r\n  prop() {\r\n    return this.contents.prop(...arguments);\r\n  }\r\n  listenum() {\r\n    return this.contents.listenum(...arguments);\r\n  }\r\n  check() {\r\n    return this.contents.check(...arguments);\r\n  }\r\n  iconenum() {\r\n    return this.contents.iconenum(...arguments);\r\n  }\r\n  slider() {\r\n    return this.contents.slider(...arguments);\r\n  }\r\n  simpleslider() {\r\n    return this.contents.simpleslider(...arguments);\r\n  }\r\n  curve() {\r\n    return this.contents.curve(...arguments);\r\n  }\r\n  textbox() {\r\n    return this.contents.textbox(...arguments);\r\n  }\r\n  textarea() {\r\n    return this.contents.textarea(...arguments);\r\n  }\r\n  viewer() {\r\n    return this.contents.viewer(...arguments);\r\n  }\r\n  panel() {\r\n    return this.contents.panel(...arguments);\r\n  }\r\n  tabs() {\r\n    return this.contents.tabs(...arguments);\r\n  }\r\n  table() {\r\n    return this.contents.table(...arguments);\r\n  }\r\n\r\n\r\n  end() {\r\n    if (this._done) {\r\n      return;\r\n    }\r\n    this.remove();\r\n\r\n    if (this._onend) {\r\n      this._onend();\r\n    }\r\n\r\n    if (this.onend) {\r\n      this.onend();\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.background = this.getDefault(\"background-color\");\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"drag-box-x\",\r\n    style   : \"panel\"\r\n  }}\r\n}\r\nUIBase.internalRegister(DragBox);\r\n","import {UIBase, saveUIData, loadUIData} from '../core/ui_base.js';\r\n\r\nimport * as util from \"../path-controller/util/util.js\"\r\nimport cconst from \"../config/const.js\";\r\nimport * as nstructjs from \"../path-controller/util/struct.js\";\r\n\r\nimport {Vector2} from '../path-controller/util/vectormath.js';\r\nimport {Container} from \"../core/ui.js\";\r\nimport {Area} from \"./ScreenArea.js\";\r\nimport {Icons} from \"../core/ui_base.js\";\r\n\r\nimport {startMenu} from \"../widgets/ui_menu.js\";\r\nimport {getAreaIntName, setAreaTypes, AreaWrangler, areaclasses} from './area_wrangler.js';\r\n\r\nlet ignore = 0;\r\n\r\nfunction dockerdebug() {\r\n  if (cconst.DEBUG.areadocker) {\r\n    console.warn(...arguments);\r\n  }\r\n}\r\n\r\nwindow.testSnapScreenVerts = function (arg) {\r\n  let screen = CTX.screen;\r\n\r\n  screen.unlisten();\r\n  screen.on_resize([screen.size[0] - 75, screen.size[1]], screen.size);\r\n  screen.on_resize = screen.updateSize = () => {\r\n  };\r\n\r\n  let p = CTX.propsbar;\r\n  p.pos[0] += 50;\r\n  p.owning_sarea.loadFromPosSize();\r\n  screen.regenBorders();\r\n\r\n  screen.size[0] = window.innerWidth - 5;\r\n\r\n  screen.snapScreenVerts(arg);\r\n}\r\n\r\nexport class AreaDocker extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this._last_update_key = undefined;\r\n    this.mpos = new Vector2();\r\n    this.needsRebuild = true;\r\n    this.ignoreChange = 0;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"area-docker-x\",\r\n      style  : \"areadocker\"\r\n    }\r\n  }\r\n\r\n  rebuild() {\r\n    if (!this.parentWidget) {\r\n      return;\r\n    }\r\n\r\n    let sarea = this.getArea().parentWidget;\r\n    if (!sarea) {\r\n      this.needsRebuild = true;\r\n      return;\r\n    }\r\n\r\n    this.needsRebuild = false;\r\n    this.ignoreChange++;\r\n\r\n    dockerdebug(\"Rebuild\", this.getArea());\r\n\r\n    let uidata = sarea.switcherData = saveUIData(this, \"switcherTabs\");\r\n\r\n    this.clear();\r\n\r\n    let tabs = this.tbar = this.tabs()\r\n    tabs.onchange = this.tab_onchange.bind(this);\r\n\r\n    let tab;\r\n\r\n    dockerdebug(sarea._id, sarea.area ? sarea.area._id : \"(no active area)\", sarea.editors)\r\n\r\n    sarea.switcherData = uidata;\r\n\r\n    for (let editor of sarea.editors) {\r\n      let def = editor.constructor.define();\r\n      let name = def.uiname;\r\n\r\n      if (!name) {\r\n        name = def.areaname || def.tagname.replace(/-x/, '');\r\n        name = ToolProperty.makeUIName(name);\r\n      }\r\n\r\n      let tab = tabs.tab(name, editor._id);\r\n\r\n      let start_mpos = new Vector2();\r\n      let mpos = new Vector2();\r\n\r\n      tab._tab.addEventListener(\"tabdragstart\", (e) => {\r\n        if (e.x !== 0 && e.y !== 0) {\r\n          start_mpos.loadXY(e.x, e.y);\r\n          this.mpos.loadXY(e.x, e.y);\r\n        } else {\r\n          start_mpos.load(this.mpos);\r\n        }\r\n\r\n        dockerdebug(\"tab drag start!\", start_mpos, e);\r\n      });\r\n      tab._tab.addEventListener(\"tabdragmove\", (e) => {\r\n        this.mpos.loadXY(e.x, e.y);\r\n\r\n        let rect = this.tbar.tbar.canvas.getBoundingClientRect();\r\n\r\n        let x = e.x, y = e.y;\r\n\r\n        let m = 8;\r\n        if (x < rect.x - m || x > rect.x + rect.width + m || y < rect.y - m || y >= rect.y + rect.height + m) {\r\n          dockerdebug(\"tab detach!\");\r\n          e.preventDefault(); //end dragging\r\n          this.detach(e);\r\n        }\r\n      });\r\n      tab._tab.addEventListener(\"tabdragend\", (e) => {\r\n\r\n        this.mpos.loadXY(e.x, e.y);\r\n        dockerdebug(\"tab drag end!\", e);\r\n      });\r\n    }\r\n\r\n    tab = this.tbar.icontab(Icons.SMALL_PLUS, \"add\", \"Add Editor\", false).noSwitch();\r\n    dockerdebug(\"Add Menu Tab\", tab);\r\n\r\n    let icon = this.addicon = tab._tab;\r\n\r\n    icon.ontabclick = e => this.on_addclick(e);\r\n    icon.setAttribute(\"menu-button\", \"true\");\r\n    icon.setAttribute(\"simple\", \"true\");\r\n\r\n    this.loadTabData(uidata);\r\n\r\n    this.ignoreChange--;\r\n  }\r\n\r\n  detach(event) {\r\n    this.tbar._ensureNoModal();\r\n\r\n    let area = this.getArea();\r\n    let sarea = this.ctx.screen.floatArea(area);\r\n\r\n    sarea.size.min([300, 300]);\r\n    sarea.loadFromPosSize();\r\n\r\n    let mpos = event ? new Vector2([event.x, event.y]) : this.mpos;\r\n\r\n    dockerdebug(\"EVENT\", event);\r\n\r\n    if (event && event instanceof PointerEvent) {\r\n      this.ctx.screen.moveAttachTool(sarea, mpos, document.body, event.pointerId);\r\n    } else {\r\n      this.ctx.screen.moveAttachTool(sarea, mpos);\r\n    }\r\n  }\r\n\r\n  loadTabData(uidata) {\r\n    this.ignoreChange++;\r\n    loadUIData(this, uidata);\r\n    this.ignoreChange--;\r\n  }\r\n\r\n  on_addclick(e) {\r\n    let mpos = new Vector2([e.x, e.y]);\r\n\r\n    if (this.addicon.menu && !this.addicon.menu.closed) {\r\n      this.addicon.menu.close();\r\n    } else {\r\n      this.addTabMenu(e.target, mpos);\r\n    }\r\n  }\r\n\r\n  tab_onchange(tab, event) {\r\n    if (this.ignoreChange) {\r\n      return;\r\n    }\r\n\r\n    dockerdebug(\"EVENT\", event);\r\n\r\n    if (event && (!(event instanceof PointerEvent) || event.pointerType === \"mouse\")) {\r\n      //event.preventDefault(); //prevent tab dragging\r\n    }\r\n\r\n    this.select(tab.id, event);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"touch-action\"] = \"none\";\r\n\r\n    this.addEventListener(\"pointermove\", (e) => {\r\n      this.mpos.loadXY(e.x, e.y);\r\n    });\r\n\r\n    this.rebuild();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n  }\r\n\r\n  getArea() {\r\n    let p = this.parentWidget;\r\n    let lastp = p;\r\n\r\n    let name = UIBase.getInternalName(\"screenarea-x\");\r\n    while (p && p.tagName.toLowerCase() !== name) {\r\n      lastp = p;\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    return lastp\r\n  }\r\n\r\n  flagUpdate() {\r\n    this.needsRebuild = true;\r\n    return this;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    let active = this.tbar.getActive();\r\n    let area = this.getArea();\r\n\r\n    let key = this.parentWidget._id;\r\n    for (let area2 of area.parentWidget.editors) {\r\n      key += area2._id + \":\";\r\n    }\r\n\r\n    if (key !== this._last_update_key) {\r\n      this._last_update_key = key;\r\n      this.needsRebuild = true;\r\n    }\r\n\r\n    if (this.needsRebuild) {\r\n      this.rebuild();\r\n      return;\r\n    }\r\n\r\n    if (this.addicon) {\r\n      let tabs = this.tbar.tbar.tabs;\r\n      let idx = tabs.indexOf(this.addicon);\r\n      if (idx !== tabs.length - 1) {\r\n        this.tbar.tbar.swapTabs(this.addicon, tabs[tabs.length - 1]);\r\n\r\n      }\r\n    }\r\n\r\n    if (!active || active._id !== area._id) {\r\n      this.ignoreChange++;\r\n\r\n      try {\r\n        this.tbar.setActive(area._id);\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        this.needsRebuild = true;\r\n      }\r\n\r\n      this.ignoreChange--;\r\n    }\r\n\r\n    window.tabs = this.tbar;\r\n\r\n    this.ignoreChange = 0;\r\n  }\r\n\r\n  select(areaId, event) {\r\n    dockerdebug(\"Tab Select!\", areaId);\r\n\r\n    this.ignoreChange++;\r\n\r\n    let area = this.getArea();\r\n    let sarea = area.parentWidget;\r\n\r\n    let uidata = saveUIData(this.tbar, \"switcherTabs\");\r\n    let newarea;\r\n\r\n    for (let area2 of sarea.editors) {\r\n      if (area2._id === areaId) {\r\n        newarea = area2;\r\n        sarea.switchEditor(area2.constructor);\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (newarea === area || !newarea.switcher) {\r\n      return;\r\n    }\r\n\r\n    //this.ctx.screen.completeSetCSS();\r\n    //this.ctx.screen.completeUpdate();\r\n    sarea.flushSetCSS();\r\n    sarea.flushUpdate();\r\n\r\n    newarea = sarea.area;\r\n\r\n    /* unswap switchers to avoid a bug in Chrome where\r\n    *  touch-action appears to not be respected due to our\r\n    *  swapping elements */\r\n\r\n    let parentw = area.switcher.parentWidget;\r\n    let newparentw = newarea.switcher.parentWidget;\r\n\r\n    let parent = area.switcher.parentNode;\r\n    let newparent = newarea.switcher.parentNode;\r\n\r\n    area.switcher = newarea.switcher;\r\n    newarea.switcher = this;\r\n\r\n    HTMLElement.prototype.remove.call(area.switcher);\r\n    HTMLElement.prototype.remove.call(newarea.switcher);\r\n\r\n    if (parent instanceof UIBase) {\r\n      parent.shadow.appendChild(area.switcher);\r\n    } else {\r\n      parent.appendChild(area.switcher);\r\n    }\r\n\r\n    if (newparent instanceof UIBase) {\r\n      newparent.shadow.prepend(newarea.switcher);\r\n    } else {\r\n      newparent.prepend(newarea.switcher);\r\n    }\r\n\r\n    area.switcher.parentWidget = parentw;\r\n    newarea.switcher.parentWidget = newparentw;\r\n\r\n    area.switcher.tbar._ensureNoModal();\r\n    newarea.switcher.tbar._ensureNoModal();\r\n\r\n    newarea.switcher.loadTabData(uidata);\r\n    area.switcher.loadTabData(uidata);\r\n\r\n    newarea.switcher.setCSS();\r\n    newarea.switcher.update();\r\n\r\n    if (event && (event instanceof PointerEvent || event instanceof MouseEvent || event instanceof TouchEvent)) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n      newarea.switcher.tbar._startMove(undefined, event);\r\n    }\r\n\r\n    //console.log(this._id);\r\n\r\n    sarea.switcherData = uidata;\r\n    this.ignoreChange--;\r\n  }\r\n\r\n  addTabMenu(tab, mpos) {\r\n    let rect = tab.getClientRects()[0];\r\n\r\n    dockerdebug(tab, tab.getClientRects());\r\n\r\n    if (!mpos) {\r\n      mpos = this.ctx.screen.mpos;\r\n    }\r\n\r\n    let menu = UIBase.createElement(\"menu-x\");\r\n\r\n    menu.closeOnMouseUp = false;\r\n    menu.ctx = this.ctx;\r\n    menu._init();\r\n\r\n    let prop = Area.makeAreasEnum();\r\n    let sarea = this.getArea().parentWidget;\r\n\r\n    if (!sarea) {\r\n      return;\r\n    }\r\n\r\n    for (let k in Object.assign({}, prop.values)) {\r\n      let ok = true;\r\n      for (let area of sarea.editors) {\r\n        if (area.constructor.define().uiname === k) {\r\n          ok = false;\r\n        }\r\n      }\r\n\r\n      if (!ok) {\r\n        continue;\r\n      }\r\n\r\n      let icon = prop.iconmap[k];\r\n      menu.addItemExtra(k, prop.values[k], undefined, icon);\r\n    }\r\n\r\n    if (!rect) {\r\n      console.warn(\"no rect!\");\r\n      return;\r\n    }\r\n\r\n    dockerdebug(mpos[0], mpos[1], rect.x, rect.y);\r\n\r\n    menu.onselect = (val) => {\r\n      dockerdebug(\"menu select\", val, this.getArea().parentWidget);\r\n\r\n      this.addicon.menu = undefined;\r\n\r\n      let sarea = this.getArea().parentWidget;\r\n      if (sarea) {\r\n        let cls = areaclasses[val];\r\n\r\n        this.ignoreChange++;\r\n        let area, ud;\r\n\r\n        try {\r\n          let uidata = saveUIData(this.tbar, \"switcherTabs\");\r\n          sarea.switchEditor(cls);\r\n\r\n          dockerdebug(\"switching\", cls);\r\n          area = sarea.area;\r\n          area._init();\r\n\r\n          if (area.switcher) {\r\n            area.switcher.rebuild();\r\n            area.switcher.loadTabData(uidata);\r\n            sarea.switcherData = uidata;\r\n          }\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n          throw error;\r\n        } finally {\r\n          this.ignoreChange = Math.max(this.ignoreChange - 1, 0);\r\n        }\r\n\r\n        dockerdebug(\"AREA\", area.switcher, area);\r\n\r\n        if (area.switcher) {\r\n          this.ignoreChange++;\r\n\r\n          try {\r\n            area.parentWidget = sarea;\r\n            area.owning_sarea = sarea;\r\n            area.switcher.parentWidget = area;\r\n            area.switcher.ctx = area.ctx;\r\n            area.switcher._init();\r\n            area.switcher.update();\r\n\r\n            dockerdebug(\"loading data\", ud);\r\n            area.switcher.loadTabData(ud);\r\n\r\n            area.switcher.rebuild(); //make sure plus tab is at end\r\n            area.flushUpdate();\r\n          } catch (error) {\r\n            throw error;\r\n          } finally {\r\n            this.ignoreChange = Math.max(this.ignoreChange - 1, 0);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    this.addicon.menu = menu;\r\n\r\n    startMenu(menu, mpos[0] - 35, rect.y + rect.height, false, 0);\r\n    return menu;\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(AreaDocker);\r\n","import {ToolTipViewer} from \"./FrameManager_ops.js\";\r\n\r\nlet _FrameManager = undefined;\r\nimport '../widgets/dragbox.js';\r\nimport '../widgets/ui_widgets2.js';\r\nimport '../widgets/ui_panel.js';\r\nimport '../widgets/ui_treeview.js';\r\n\r\nimport {DataPathError, nstructjs} from '../path-controller/controller.js';\r\n\r\nimport '../util/ScreenOverdraw.js';\r\nimport cconst from '../config/const.js';\r\nimport {haveModal, pushModalLight, popModalLight, _setScreenClass} from '../path-controller/util/simple_events.js';\r\nimport * as util from '../path-controller/util/util.js';\r\nimport '../widgets/ui_curvewidget.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as ScreenArea from './ScreenArea.js';\r\nimport * as FrameManager_ops from './FrameManager_ops.js';\r\nimport * as math from '../path-controller/util/math.js';\r\nimport * as ui_menu from '../widgets/ui_menu.js';\r\nimport '../path-controller/util/struct.js';\r\nimport {KeyMap, HotKey} from '../path-controller/util/simple_events.js';\r\nimport {keymap} from \"../path-controller/util/simple_events.js\";\r\n\r\nimport {AreaDocker} from './AreaDocker.js';\r\n\r\nimport {snap, snapi, ScreenBorder, ScreenVert, ScreenHalfEdge, SnapLimit} from \"./FrameManager_mesh.js\";\r\n\r\nexport {ScreenBorder, ScreenVert, ScreenHalfEdge} from \"./FrameManager_mesh.js\";\r\nimport {theme, PackFlags} from '../core/ui_base.js';\r\nimport * as FrameManager_mesh from './FrameManager_mesh.js';\r\nimport {makePopupArea} from \"../widgets/ui_dialog.js\";\r\n\r\nlet Area = ScreenArea.Area;\r\n\r\nimport '../widgets/ui_widgets.js';\r\nimport '../widgets/ui_tabs.js';\r\nimport '../widgets/ui_colorpicker2.js';\r\nimport '../widgets/ui_noteframe.js';\r\nimport '../widgets/ui_listbox.js';\r\nimport '../widgets/ui_table.js';\r\nimport {AreaFlags, setScreenClass} from \"./ScreenArea.js\";\r\nimport {checkForTextBox} from '../widgets/ui_textbox.js';\r\nimport {startMenu} from '../widgets/ui_menu.js';\r\n\r\nfunction list(iter) {\r\n  let ret = [];\r\n\r\n  for (let item of iter) {\r\n    ret.push(item);\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nui_menu.startMenuEventWrangling();\r\n\r\nlet _events_started = false;\r\n\r\nexport function registerToolStackGetter(func) {\r\n  FrameManager_ops.registerToolStackGetter(func);\r\n}\r\n\r\nlet Vector2         = vectormath.Vector2,\r\n    UIBase          = ui_base.UIBase,\r\n    styleScrollBars = ui_base.styleScrollBars;\r\n\r\nlet update_stack = new Array(8192);\r\nupdate_stack.cur = 0;\r\n\r\nlet screen_idgen = 0;\r\n\r\nexport function purgeUpdateStack() {\r\n  for (let i = 0; i < update_stack.length; i++) {\r\n    update_stack[i] = undefined;\r\n  }\r\n}\r\n\r\n/**\r\n * Base class for app workspaces\r\n *\r\n attributes:\r\n\r\n inherit-scale : don't resize to fit whole screen, use cssbox scaling\r\n\r\n */\r\nexport class Screen extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.snapLimit = 1;\r\n    this.fullScreen = true;\r\n\r\n    //all widget shadow DOMs reference this style tag,\r\n    //or rather they copy it\r\n    this.globalCSS = document.createElement(\"style\");\r\n    this.shadow.prepend(this.globalCSS);\r\n\r\n    this._do_updateSize = true;\r\n    this._resize_callbacks = [];\r\n\r\n    this.allBordersMovable = cconst.DEBUG.allBordersMovable;\r\n    this.needsBorderRegen = true;\r\n\r\n    this._popup_safe = 0;\r\n\r\n    //if true, will test all areas for keymaps on keypress,\r\n    //not just the active one\r\n    this.testAllKeyMaps = false;\r\n\r\n    this.needsTabRecalc = true;\r\n    this._screen_id = screen_idgen++;\r\n\r\n    this._popups = [];\r\n\r\n    this._ctx = undefined;\r\n\r\n    this.keymap = new KeyMap();\r\n\r\n    this.size = new Vector2([window.innerWidth, window.innerHeight]);\r\n    this.pos = new Vector2();\r\n    this.oldpos = new Vector2();\r\n\r\n    this.idgen = 0;\r\n    this.sareas = [];\r\n    this.sareas.active = undefined;\r\n    this.mpos = [0, 0];\r\n\r\n    this.screenborders = [];\r\n    this.screenverts = [];\r\n    this._vertmap = {};\r\n    this._edgemap = {};\r\n    this._idmap = {};\r\n\r\n    //effective bounds of screen\r\n    this._aabb = [new Vector2(), new Vector2()];\r\n\r\n    let on_mousemove = (e, x, y) => {\r\n      //let elem = this.pickElement(x, y, 1, 1, ScreenArea.ScreenArea);\r\n      let dragging = e.type === \"mousemove\" || e.type === \"touchmove\" || e.type === \"pointermove\";\r\n      dragging = dragging && (e.buttons || (e.touches && e.touches.length > 0));\r\n\r\n      /*\r\n      make sure active area is up to date.\r\n      but don't call pickElement too often as it's slow\r\n      */\r\n      if (!dragging && Math.random() > 0.9) {\r\n        let elem = this.pickElement(x, y, {\r\n          sx        : 1,\r\n          sy        : 1,\r\n          nodeclass : ScreenArea.ScreenArea,\r\n          mouseEvent: e\r\n        });\r\n\r\n        if (0) {\r\n          let elem2 = this.pickElement(x, y, 1, 1);\r\n          console.log(\"\" + this.sareas.active, elem2 ? elem2.tagName : undefined, elem !== undefined);\r\n        }\r\n\r\n        if (elem !== undefined) {\r\n          if (elem.area) {\r\n            //make sure context area stacks are up to date\r\n            elem.area.push_ctx_active();\r\n            elem.area.pop_ctx_active();\r\n          }\r\n\r\n          this.sareas.active = elem;\r\n        }\r\n      }\r\n\r\n      this.mpos[0] = x;\r\n      this.mpos[1] = y;\r\n    }\r\n    this.shadow.addEventListener(\"mousemove\", (e) => {\r\n      return on_mousemove(e, e.x, e.y);\r\n    }, {passive: true});\r\n\r\n    /*UIBase forwards touch events already\r\n    this.shadow.addEventListener(\"touchmove\", (e) => {\r\n      if (e.touches.length === 0) {\r\n        return;\r\n      }\r\n\r\n      return on_mousemove(e, e.touches[0].pageX, e.touches[0].pagesY);\r\n    }, {passive : true});\r\n    */\r\n  }\r\n\r\n  get borders() {\r\n    let this2 = this;\r\n\r\n    return (function* () {\r\n      for (let k in this2._edgemap) {\r\n        yield this2._edgemap[k];\r\n      }\r\n    })();\r\n  }\r\n\r\n  get listening() {\r\n    return this.listen_timer !== undefined;\r\n  }\r\n\r\n  get ctx() {\r\n    return this._ctx;\r\n  }\r\n\r\n  set ctx(val) {\r\n    this._ctx = val;\r\n\r\n    //fully recurse tree\r\n    let rec = (n) => {\r\n      if (n instanceof UIBase) {\r\n        n.ctx = val;\r\n      }\r\n\r\n      for (let n2 of n.childNodes) {\r\n        rec(n2);\r\n      }\r\n\r\n      if (n.shadow) {\r\n        for (let n2 of n.shadow.childNodes) {\r\n          rec(n2);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let n of this.childNodes) {\r\n      rec(n);\r\n    }\r\n\r\n    for (let n of this.shadow.childNodes) {\r\n      rec(n);\r\n    }\r\n  }\r\n\r\n  static fromJSON(obj, schedule_resize = false) {\r\n    let ret = UIBase.createElement(this.define().tagname);\r\n    return ret.loadJSON(obj, schedule_resize);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"pathux-screen-x\"\r\n    };\r\n  }\r\n\r\n  static newSTRUCT() {\r\n    return UIBase.createElement(this.define().tagname);\r\n  }\r\n\r\n  setPosSize(x, y, w, h) {\r\n    this.pos[0] = x;\r\n    this.pos[1] = y;\r\n    this.size[0] = w;\r\n    this.size[1] = h;\r\n\r\n    this.setCSS();\r\n    this._internalRegenAll();\r\n  }\r\n\r\n  setSize(w, h) {\r\n    this.size[0] = w;\r\n    this.size[1] = h;\r\n\r\n    this.setCSS();\r\n    this._internalRegenAll();\r\n  }\r\n\r\n  setPos(x, y) {\r\n    this.pos[0] = x;\r\n    this.pos[1] = y;\r\n\r\n    this.setCSS();\r\n    this._internalRegenAll();\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    if (this.hasAttribute(\"listen\")) {\r\n      this.listen();\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {*} style May be a string, a CSSStyleSheet instance, or a style tag\r\n   * @returns Promise fulfilled when style has been merged\r\n   */\r\n  mergeGlobalCSS(style) {\r\n    return new Promise((accept, reject) => {\r\n      let sheet;\r\n\r\n      let finish = () => {\r\n        let sheet2 = this.globalCSS.sheet;\r\n        if (!sheet2) {\r\n          this.doOnce(finish);\r\n          return;\r\n        }\r\n\r\n        let map = {};\r\n        for (let rule of sheet2.rules) {\r\n          map[rule.selectorText] = rule;\r\n        }\r\n\r\n        for (let rule of sheet.rules) {\r\n          let k = rule.selectorText;\r\n          if (k in map) {\r\n            let rule2 = map[k];\r\n\r\n            if (!rule.styleMap) { //handle firefox\r\n              for (let k in rule.style) {\r\n                let desc = Object.getOwnPropertyDescriptor(rule.style, k);\r\n\r\n                if (!desc || !desc.writable) {\r\n                  continue;\r\n                }\r\n                let v = rule.style[k];\r\n\r\n                if (v) {\r\n                  rule2.style[k] = rule.style[k];\r\n                }\r\n              }\r\n              continue;\r\n            }\r\n            for (let [key, val] of list(rule.styleMap.entries())) {\r\n              if (1 || rule2.styleMap.has(key)) {\r\n                //rule2.styleMap.delete(key);\r\n                let sval = \"\";\r\n\r\n                if (Array.isArray(val)) {\r\n                  for (let item of val) {\r\n                    sval += \" \" + val;\r\n                  }\r\n                  sval = sval.trim();\r\n                } else {\r\n                  sval = (\"\" + val).trim();\r\n                }\r\n\r\n                rule2.style[key] = sval;\r\n                rule2.styleMap.set(key, val);\r\n              } else {\r\n                rule2.styleMap.append(key, val);\r\n              }\r\n            }\r\n          } else {\r\n            sheet2.insertRule(rule.cssText);\r\n          }\r\n        }\r\n      }\r\n\r\n      if (typeof style === \"string\") {\r\n        try { //stupid firefox\r\n          sheet = new CSSStyleSheet();\r\n        } catch (error) {\r\n          sheet = undefined;\r\n        }\r\n\r\n        if (sheet && sheet.replaceSync) {\r\n          sheet.replaceSync(style);\r\n          finish();\r\n        } else {\r\n          let tag = document.createElement(\"style\");\r\n          tag.textContent = style;\r\n          document.body.appendChild(tag);\r\n\r\n          let cb = () => {\r\n            if (!tag.sheet) {\r\n              this.doOnce(cb);\r\n              return;\r\n            }\r\n\r\n            sheet = tag.sheet;\r\n            finish();\r\n            tag.remove();\r\n          };\r\n\r\n          this.doOnce(cb)\r\n        }\r\n      } else if (!(style instanceof CSSStyleSheet)) {\r\n        sheet = style.sheet;\r\n        finish();\r\n      } else {\r\n        sheet = style;\r\n        finish();\r\n      }\r\n    });\r\n  }\r\n\r\n  newScreenArea() {\r\n    let ret = UIBase.createElement(\"screenarea-x\");\r\n    ret.ctx = this.ctx;\r\n\r\n    if (ret.ctx) {\r\n      ret.init();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  copy() {\r\n    let ret = UIBase.createElement(this.constructor.define().tagname);\r\n    ret.ctx = this.ctx;\r\n    ret._init();\r\n\r\n    for (let sarea of this.sareas) {\r\n      let sarea2 = sarea.copy(ret);\r\n\r\n      sarea2._ctx = this.ctx;\r\n      sarea2.screen = ret;\r\n      sarea2.parentWidget = ret;\r\n\r\n      ret.appendChild(sarea2);\r\n    }\r\n\r\n    for (let sarea of ret.sareas) {\r\n      sarea.ctx = this.ctx;\r\n      sarea.area.ctx = this.ctx;\r\n\r\n      sarea.area.push_ctx_active();\r\n      sarea._init();\r\n      sarea.area._init();\r\n      sarea.area.pop_ctx_active();\r\n\r\n      for (let area of sarea.editors) {\r\n        area.ctx = this.ctx;\r\n\r\n        area.push_ctx_active();\r\n        area._init();\r\n        area.pop_ctx_active();\r\n      }\r\n    }\r\n\r\n    ret.update();\r\n    ret.regenBorders();\r\n    ret.setCSS();\r\n\r\n    return ret;\r\n  }\r\n\r\n  findScreenArea(x, y) {\r\n    for (let i = this.sareas.length - 1; i >= 0; i--) {\r\n      let sarea = this.sareas[i];\r\n\r\n      let ok = x >= sarea.pos[0] && x <= sarea.pos[0] + sarea.size[0];\r\n      ok = ok && (y >= sarea.pos[1] && y <= sarea.pos[1] + sarea.size[1]);\r\n\r\n      if (ok) {\r\n        return sarea;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param x\r\n   * @param y\r\n   * @param args arguments : {sx, sy, nodeclass, excluded_classes}\r\n   */\r\n  pickElement(x, y, args, sy, nodeclass, excluded_classes) {\r\n    let sx;\r\n    let clip;\r\n\r\n    if (typeof args === \"object\") {\r\n      sx = args.sx;\r\n      sy = args.sy;\r\n      nodeclass = args.nodeclass;\r\n      excluded_classes = args.excluded_classes;\r\n      clip = args.clip;\r\n    } else {\r\n      sx = args;\r\n\r\n      args = {\r\n        sx              : sx,\r\n        sy              : sy,\r\n        nodeclass       : nodeclass,\r\n        excluded_classes: excluded_classes\r\n      };\r\n    }\r\n\r\n    if (!this.ctx) {\r\n      console.warn(\"no ctx in screen\");\r\n      return;\r\n    }\r\n\r\n    let ret;\r\n\r\n    for (let i = this._popups.length - 1; i >= 0; i--) {\r\n      let popup = this._popups[i];\r\n\r\n      ret = ret || popup.pickElement(x, y, args);\r\n    }\r\n\r\n    ret = ret || super.pickElement(x, y, args);\r\n\r\n    return ret;\r\n  }\r\n\r\n  _enterPopupSafe() {\r\n    if (this._popup_safe === undefined) {\r\n      this._popup_safe = 0;\r\n    }\r\n\r\n    this._popup_safe++;\r\n  }\r\n\r\n  * _allAreas() {\r\n    for (let sarea of this.sareas) {\r\n      for (let area of sarea.editors) {\r\n        yield [area, area._area_id, sarea];\r\n      }\r\n    }\r\n  }\r\n\r\n  _exitPopupSafe() {\r\n    this._popup_safe = Math.max(this._popup_safe - 1, 0);\r\n  }\r\n\r\n  popupMenu(menu, x, y) {\r\n    startMenu(menu, x, y);\r\n\r\n    for (let i = 0; i < 3; i++) {\r\n      menu.flushSetCSS();\r\n      menu.flushUpdate();\r\n    }\r\n\r\n    return menu;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param popupDelay : if non-zero, wait for popup to layout for popupDelay miliseconds,\r\n   *                     then move the popup so it's fully inside the window (if it's outsize).\r\n   *\r\n   * */\r\n  popup(owning_node, elem_or_x, y, closeOnMouseOut = true, popupDelay = 5) {\r\n    let ret = this._popup(...arguments);\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      ret.flushUpdate();\r\n      ret.flushSetCSS();\r\n    }\r\n\r\n    if (popupDelay === 0) {\r\n      return ret;\r\n    }\r\n\r\n    let z = ret.style[\"z-index\"];\r\n\r\n    ret.style[\"z-index\"] = \"-10\";\r\n\r\n    let cb = () => {\r\n      let rect = ret.getClientRects()[0];\r\n      let size = this.size;\r\n\r\n      if (!rect) {\r\n        this.doOnce(cb);\r\n        return;\r\n      }\r\n\r\n      //console.log(\"rect\", rect);\r\n\r\n      if (rect.bottom > size[1]) {\r\n        ret.style[\"top\"] = (size[1] - rect.height - 10) + \"px\";\r\n      } else if (rect.top < 0) {\r\n        ret.style[\"top\"] = \"10px\";\r\n      }\r\n      if (rect.right > size[0]) {\r\n        ret.style[\"left\"] = (size[0] - rect.width - 10) + \"px\";\r\n      } else if (rect.left < 0) {\r\n        ret.style[\"left\"] = \"10px\";\r\n      }\r\n\r\n\r\n      ret.style[\"z-index\"] = z;\r\n\r\n      ret.flushUpdate();\r\n      ret.flushSetCSS();\r\n    }\r\n\r\n    setTimeout(cb, popupDelay);\r\n    //this.doOnce(cb);\r\n\r\n    return ret;\r\n  }\r\n\r\n  draggablePopup(x, y) {\r\n    let ret = UIBase.createElement(\"drag-box-x\");\r\n    ret.ctx = this.ctx;\r\n    ret.parentWidget = this;\r\n    ret._init();\r\n\r\n    this._popups.push(ret);\r\n\r\n    ret._onend = () => {\r\n      if (this._popups.indexOf(ret) >= 0) {\r\n        this._popups.remove(ret);\r\n      }\r\n    }\r\n\r\n    ret.style[\"z-index\"] = 205;\r\n    ret.style[\"position\"] = UIBase.PositionKey;\r\n    ret.style[\"left\"] = x + \"px\";\r\n    ret.style[\"top\"] = y + \"px\";\r\n\r\n    document.body.appendChild(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  /** makes a popup at x,y and returns a new container-x for it */\r\n  _popup(owning_node, elem_or_x, y, closeOnMouseOut = true) {\r\n    let x;\r\n\r\n    let sarea = this.sareas.active;\r\n\r\n    let w = owning_node;\r\n    while (w) {\r\n      if (w instanceof ScreenArea.ScreenArea) {\r\n        sarea = w;\r\n        break;\r\n      }\r\n      w = w.parentWidget;\r\n    }\r\n\r\n    if (typeof elem_or_x === \"object\") {\r\n      let r = elem_or_x.getClientRects()[0];\r\n\r\n      x = r.x;\r\n      y = r.y;\r\n    } else {\r\n      x = elem_or_x;\r\n    }\r\n\r\n    x += window.scrollX;\r\n    y += window.scrollY;\r\n\r\n    let container = UIBase.createElement(\"container-x\");\r\n\r\n    container.ctx = this.ctx;\r\n    container._init();\r\n\r\n    let remove = container.remove;\r\n    container.remove = () => {\r\n      if (this._popups.indexOf(container) >= 0) {\r\n        this._popups.remove(container);\r\n      }\r\n\r\n      return remove.apply(container, arguments);\r\n    };\r\n\r\n    container.overrideClass(\"popup\");\r\n\r\n    container.background = container.getDefault(\"background-color\");\r\n    container.style[\"border-radius\"] = container.getDefault(\"border-radius\") + \"px\";\r\n    container.style[\"border-color\"] = container.getDefault(\"border-color\");\r\n    container.style[\"border-style\"] = container.getDefault(\"border-style\");\r\n    container.style[\"border-width\"] = container.getDefault(\"border-width\") + \"px\";\r\n    container.style[\"box-shadow\"] = container.getDefault(\"box-shadow\");\r\n\r\n    container.style[\"position\"] = UIBase.PositionKey;\r\n    container.style[\"z-index\"] = \"2205\";\r\n    container.style[\"left\"] = x + \"px\";\r\n    container.style[\"top\"] = y + \"px\";\r\n    container.style[\"margin\"] = \"0px\";\r\n\r\n    container.parentWidget = this;\r\n\r\n    let mm = new math.MinMax(2);\r\n    let p = new Vector2();\r\n\r\n    let _update = container.update;\r\n    container.update.after(() => {\r\n      container.style[\"z-index\"] = \"2205\";\r\n    });\r\n\r\n    /*causes weird bugs\r\n    container.update = () => {\r\n      _update.call(container);\r\n\r\n      let rects = container.getClientRects();\r\n      mm.reset();\r\n\r\n      for (let r of rects) {\r\n        p[0] = r.x;\r\n        p[1] = r.y;\r\n        mm.minmax(p);\r\n\r\n        p[0] += r.width;\r\n        p[1] += r.height;\r\n        mm.minmax(p);\r\n      }\r\n\r\n      let x = mm.min[0], y = mm.min[1];\r\n\r\n      x = Math.min(x, this.size[0]-(mm.max[0]-mm.min[0]));\r\n      y = Math.min(y, this.size[1]-(mm.max[1]-mm.min[1]));\r\n\r\n      container.style[\"left\"] = x + \"px\";\r\n      container.style[\"top\"] = y + \"px\";\r\n    }//*/\r\n\r\n    document.body.appendChild(container);\r\n    //this.shadow.appendChild(container);\r\n    this.setCSS();\r\n\r\n    this._popups.push(container);\r\n\r\n    let touchpick, mousepick, keydown;\r\n\r\n    let done = false;\r\n    let end = () => {\r\n      if (this._popup_safe) {\r\n        return;\r\n      }\r\n\r\n      if (done) return;\r\n\r\n      //this.ctx.screen.removeEventListener(\"touchstart\", touchpick, true);\r\n      //this.ctx.screen.removeEventListener(\"touchmove\", touchpick, true);\r\n      this.ctx.screen.removeEventListener(\"mousedown\", mousepick, true);\r\n      this.ctx.screen.removeEventListener(\"mousemove\", mousepick, {passive: true});\r\n      this.ctx.screen.removeEventListener(\"mouseup\", mousepick, true);\r\n      window.removeEventListener(\"keydown\", keydown);\r\n\r\n      done = true;\r\n      container.remove();\r\n    };\r\n\r\n    container.end = end;\r\n\r\n    let _remove = container.remove;\r\n    container.remove = function () {\r\n      if (arguments.length == 0) {\r\n        end();\r\n      }\r\n      _remove.apply(this, arguments);\r\n    };\r\n\r\n    container._ondestroy = () => {\r\n      end();\r\n    };\r\n\r\n    let bad_time = util.time_ms();\r\n    let last_pick_time = util.time_ms();\r\n\r\n    mousepick = (e, x, y, do_timeout = true) => {\r\n      if (!container.isConnected) {\r\n        end();\r\n        return;\r\n      }\r\n\r\n      if (sarea && sarea.area) {\r\n        sarea.area.push_ctx_active();\r\n        sarea.area.pop_ctx_active();\r\n      }\r\n      //console.log(\"=======================================================popup touch start\");\r\n      //console.log(e);\r\n\r\n      if (util.time_ms() - last_pick_time < 350) {\r\n        return;\r\n      }\r\n      last_pick_time = util.time_ms();\r\n\r\n      x = x === undefined ? e.x : x;\r\n      y = y === undefined ? e.y : y;\r\n\r\n      //let elem = this.pickElement(x, y, 2, 2, undefined, [ScreenBorder]);\r\n      let elem = this.pickElement(x, y, {\r\n        sx              : 2,\r\n        sy              : 2,\r\n        excluded_classes: [ScreenBorder],\r\n        mouseEvent      : e\r\n      });\r\n\r\n      let startelem = elem;\r\n\r\n      if (elem === undefined) {\r\n        if (closeOnMouseOut) {\r\n          end();\r\n        }\r\n        return;\r\n      }\r\n\r\n      let ok = false;\r\n      let elem2 = elem;\r\n\r\n      while (elem) {\r\n        if (elem === container) {\r\n          ok = true;\r\n          break;\r\n        }\r\n        elem = elem.parentWidget;\r\n      }\r\n\r\n      if (!ok) {\r\n        do_timeout = !do_timeout || (util.time_ms() - bad_time > 100);\r\n\r\n        if (closeOnMouseOut && do_timeout) {\r\n          end();\r\n        }\r\n      } else {\r\n        bad_time = util.time_ms();\r\n      }\r\n    };\r\n\r\n    touchpick = (e) => {\r\n      let x = e.touches[0].pageX, y = e.touches[0].pageY;\r\n\r\n      return mousepick(e, x, y, false);\r\n    };\r\n\r\n    keydown = (e) => {\r\n      if (!container.isConnected) {\r\n        window.removeEventListener(\"keydown\", keydown);\r\n        return;\r\n      }\r\n\r\n      switch (e.keyCode) {\r\n        case keymap[\"Escape\"]:\r\n          end();\r\n          break;\r\n      }\r\n    };\r\n\r\n    //this.ctx.screen.addEventListener(\"touchstart\", touchpick, true);\r\n    //this.ctx.screen.addEventListener(\"touchmove\", touchpick, true);\r\n    this.ctx.screen.addEventListener(\"mousedown\", mousepick, true);\r\n    this.ctx.screen.addEventListener(\"mousemove\", mousepick, {passive: true});\r\n    this.ctx.screen.addEventListener(\"mouseup\", mousepick, true);\r\n    window.addEventListener(\"keydown\", keydown);\r\n\r\n    /*\r\n    container.addEventListener(\"mouseleave\", (e) => {\r\n      console.log(\"popup mouse leave\");\r\n      if (closeOnMouseOut)\r\n        end();\r\n    });\r\n    container.addEventListener(\"mouseout\", (e) => {\r\n      console.log(\"popup mouse out\");\r\n      if (closeOnMouseOut)\r\n        end();\r\n    });\r\n    //*/\r\n\r\n    this.calcTabOrder();\r\n\r\n    return container;\r\n  }\r\n\r\n  _recalcAABB(save = true) {\r\n    let mm = new math.MinMax(2);\r\n\r\n    for (let v of this.screenverts) {\r\n      mm.minmax(v);\r\n    }\r\n\r\n    if (save) {\r\n      this._aabb[0].load(mm.min);\r\n      this._aabb[1].load(mm.max);\r\n    }\r\n\r\n    return [new Vector2(mm.min), new Vector2(mm.max)];\r\n  }\r\n\r\n  //XXX look at if this is referenced anywhere\r\n  load() {\r\n  }\r\n\r\n  //XXX look at if this is referenced anywhere\r\n  save() {\r\n  }\r\n\r\n  popupArea(area_class) {\r\n    return makePopupArea(area_class, this);\r\n  }\r\n\r\n  remove(trigger_destroy = true) {\r\n    this.unlisten();\r\n\r\n    if (trigger_destroy) {\r\n      return super.remove();\r\n    } else {\r\n      HTMLElement.prototype.remove.call(this);\r\n    }\r\n  }\r\n\r\n  unlisten() {\r\n    if (this.listen_timer !== undefined) {\r\n      window.clearInterval(this.listen_timer);\r\n      this.listen_timer = undefined;\r\n    }\r\n  }\r\n\r\n  checkCSSSize() {\r\n    let w = this.style.width.toLowerCase().trim();\r\n    let h = this.style.height.toLowerCase().trim();\r\n\r\n    if (w.endsWith(\"px\") && h.endsWith(\"px\")) {\r\n      w = parseFloat(w.slice(0, w.length - 2).trim());\r\n      h = parseFloat(h.slice(0, h.length - 2).trim());\r\n\r\n      if (w !== this.size[0] || h !== this.size[1]) {\r\n        this.on_resize([this.size[0], this.size[1]], [w, h]);\r\n        this.size[0] = w;\r\n        this.size[1] = h;\r\n      }\r\n    }\r\n  }\r\n\r\n  getBoolAttribute(attr, defaultval = false) {\r\n    if (!this.hasAttribute(attr)) {\r\n      return defaultval;\r\n    }\r\n\r\n    let ret = this.getAttribute(attr);\r\n\r\n    if (typeof ret === \"number\") {\r\n      return !!ret;\r\n    } else if (typeof ret === \"string\") {\r\n      ret = ret.toLowerCase().trim();\r\n      ret = ret === \"true\" || ret === \"1\" || ret === \"yes\";\r\n    }\r\n\r\n    return !!ret;\r\n  }\r\n\r\n  updateSize() {\r\n    if (this.getBoolAttribute(\"inherit-scale\") || !this.fullScreen || !cconst.autoSizeUpdate) {\r\n      this.checkCSSSize();\r\n      return;\r\n    }\r\n\r\n    let width = window.innerWidth;\r\n    let height = window.innerHeight;\r\n\r\n    let ratio = window.outerHeight/window.innerHeight;\r\n    let scale = visualViewport.scale;\r\n\r\n    let pad = 4;\r\n    width = visualViewport.width*scale - pad;\r\n    height = visualViewport.height*scale - pad;\r\n\r\n    let ox = visualViewport.offsetLeft;\r\n    let oy = visualViewport.offsetTop;\r\n\r\n    if (cconst.DEBUG.customWindowSize) {\r\n      let s = cconst.DEBUG.customWindowSize;\r\n      width = s.width;\r\n      height = s.height;\r\n      ox = 0;\r\n      oy = 0;\r\n      window._DEBUG = cconst.DEBUG;\r\n    }\r\n\r\n    let key = this._calcSizeKey(width, height, ox, oy, devicePixelRatio, scale);\r\n\r\n    /* CSS IS EVIL! WHY DOES BODY HAVE A MARGIN? */\r\n    document.body.style.margin = document.body.style.padding = \"0px\";\r\n    document.body.style[\"transform-origin\"] = \"top left\";\r\n    document.body.style[\"transform\"] = `translate(${ox}px,${oy}px) scale(${1.0/scale})`;\r\n\r\n    //document.body.style[\"transform\"] = `scale(${1.0 / scale}, ${1.0 / scale})`; // translate(${ox*scale2}px, ${oy*scale2}px)`;\r\n\r\n    if (key !== this._last_ckey1) {\r\n      //console.log(\"resizing\", key, this._last_ckey1);\r\n      this._last_ckey1 = key;\r\n\r\n      this.on_resize(this.size, [width, height], false);\r\n      this.on_resize(this.size, this.size, false);\r\n\r\n      let scale = visualViewport.scale;\r\n\r\n\r\n      this.regenBorders();\r\n\r\n      this.setCSS();\r\n      this.completeUpdate();\r\n    }\r\n  }\r\n\r\n  listen(args = {updateSize: true}) {\r\n    ui_menu.setWranglerScreen(this);\r\n\r\n    let ctx = this.ctx;\r\n    startEvents(() => ctx.screen);\r\n\r\n    if (this.listen_timer !== undefined) {\r\n      return; //already listening\r\n    }\r\n\r\n    this._do_updateSize = args.updateSize !== undefined ? args.updateSize : true;\r\n\r\n    this.listen_timer = window.setInterval(() => {\r\n      if (this.isDead()) {\r\n        console.log(\"dead screen\");\r\n        this.unlisten();\r\n        return;\r\n      }\r\n\r\n      this.update();\r\n    }, 150);\r\n  }\r\n\r\n  _calcSizeKey(w, h, x, y, dpi, scale) {\r\n    if (arguments.length !== 6) {\r\n      throw new Error(\"eek\");\r\n    }\r\n\r\n    let s = \"\";\r\n    for (let i = 0; i < arguments.length; i++) {\r\n      s += arguments[i].toFixed(0) + \":\";\r\n    }\r\n\r\n    return s;\r\n  }\r\n\r\n  _ondestroy() {\r\n    if (ui_menu.getWranglerScreen() === this) {\r\n      //ui_menu.setWranglerScreen(undefined);\r\n    }\r\n\r\n    this.unlisten();\r\n\r\n    //unlike other ondestroy functions, this one physically dismantles the DOM tree\r\n    let recurse = (n, second_pass, parent) => {\r\n      if (n.__pass === second_pass) {\r\n        console.warn(\"CYCLE IN DOM TREE!\", n, parent);\r\n        return;\r\n      }\r\n\r\n      n.__pass = second_pass;\r\n\r\n      n._forEachChildWidget(n2 => {\r\n        if (n === n2)\r\n          return;\r\n        recurse(n2, second_pass, n);\r\n\r\n        try {\r\n          if (!second_pass && !n2.__destroyed) {\r\n            n2.__destroyed = true;\r\n            n2._ondestroy();\r\n          }\r\n        } catch (error) {\r\n          print_stack(error);\r\n          console.log(\"failed to exectue an ondestroy callback\");\r\n        }\r\n\r\n        n2.__destroyed = true;\r\n\r\n        try {\r\n          if (second_pass) {\r\n            n2.remove();\r\n          }\r\n        } catch (error) {\r\n          print_stack(error);\r\n          console.log(\"failed to remove element after ondestroy callback\");\r\n        }\r\n      });\r\n    };\r\n\r\n    let id = ~~(Math.random()*1024*1024);\r\n\r\n    recurse(this, id);\r\n    recurse(this, id + 1);\r\n  }\r\n\r\n  destroy() {\r\n    this._ondestroy();\r\n  }\r\n\r\n  clear() {\r\n    this._ondestroy();\r\n\r\n    this.sareas = [];\r\n    this.sareas.active = undefined;\r\n\r\n    for (let child of list(this.childNodes)) {\r\n      child.remove();\r\n    }\r\n    for (let child of list(this.shadow.childNodes)) {\r\n      child.remove();\r\n    }\r\n  }\r\n\r\n  _test_save() {\r\n    let obj = JSON.parse(JSON.stringify(this));\r\n    console.log(JSON.stringify(this));\r\n\r\n    this.loadJSON(obj);\r\n  }\r\n\r\n  loadJSON(obj, schedule_resize = false) {\r\n    this.clear();\r\n    super.loadJSON();\r\n\r\n    for (let sarea of obj.sareas) {\r\n      let sarea2 = UIBase.createElement(\"screenarea-x\");\r\n\r\n      sarea2.ctx = this.ctx;\r\n      sarea2.screen = this;\r\n\r\n      this.appendChild(sarea2);\r\n\r\n      sarea2.loadJSON(sarea);\r\n    }\r\n\r\n    this.regenBorders();\r\n    this.setCSS();\r\n\r\n    if (schedule_resize) {\r\n      window.setTimeout(() => {\r\n        this.on_resize(this.size, [window.innerWidth, window.innerHeight]);\r\n      }, 50);\r\n    }\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = {\r\n      sareas: this.sareas\r\n    };\r\n\r\n    ret.size = this.size;\r\n    ret.idgen = this.idgen;\r\n\r\n    return Object.assign(super.toJSON(), ret);\r\n  }\r\n\r\n  getHotKey(toolpath) {\r\n    let test = (keymap) => {\r\n      for (let hk of keymap) {\r\n        if (typeof hk.action != \"string\")\r\n          continue;\r\n\r\n        if (hk.action.trim().startsWith(toolpath.trim())) {\r\n          return hk;\r\n        }\r\n      }\r\n    };\r\n\r\n    let ret = test(this.keymap);\r\n    if (ret)\r\n      return ret;\r\n\r\n    if (this.sareas.active && this.sareas.active.keymap) {\r\n      let area = this.sareas.active.area;\r\n\r\n      for (let keymap of area.getKeyMaps()) {\r\n        ret = test(keymap);\r\n\r\n        if (ret)\r\n          return ret;\r\n      }\r\n    }\r\n\r\n    if (ret === undefined) {\r\n      //just to be safe, check all areas in case the\r\n      //context is confused as to which area is currently \"active\"\r\n\r\n      for (let sarea of this.sareas) {\r\n        let area = sarea.area;\r\n\r\n        for (let keymap of area.getKeyMaps()) {\r\n          ret = test(keymap);\r\n\r\n          if (ret) {\r\n            return ret;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  addEventListener(type, cb, options) {\r\n    if (type === \"resize\") {\r\n      this._resize_callbacks.push(cb);\r\n    } else {\r\n      return super.addEventListener(type, cb, options);\r\n    }\r\n  }\r\n\r\n  removeEventListener(type, cb, options) {\r\n    if (type === \"resize\") {\r\n      if (this._resize_callbacks.indexOf(cb) >= 0)\r\n        this._resize_callbacks.remove(cb);\r\n    } else {\r\n      return super.removeEventListener(type, cb, options);\r\n    }\r\n  }\r\n\r\n  execKeyMap(e) {\r\n    let handled = false;\r\n\r\n    if (window.DEBUG && window.DEBUG.keymap) {\r\n      console.warn(\"execKeyMap called\", e.keyCode, document.activeElement.tagName);\r\n    }\r\n\r\n    if (this.sareas.active) {\r\n      let area = this.sareas.active.area;\r\n\r\n      if (!area) {\r\n        return;\r\n      }\r\n\r\n      area.push_ctx_active();\r\n\r\n      for (let keymap of area.getKeyMaps()) {\r\n        if (keymap === undefined) {\r\n          continue;\r\n        }\r\n\r\n        if (keymap.handle(area.ctx, e)) {\r\n          handled = true;\r\n          break;\r\n        }\r\n      }\r\n\r\n      area.pop_ctx_active();\r\n    }\r\n\r\n    handled = handled || this.keymap.handle(this.ctx, e);\r\n\r\n    if (!handled && this.testAllKeyMaps) {\r\n      for (let sarea of this.sareas) {\r\n        if (handled) {\r\n          break;\r\n        }\r\n\r\n        sarea.area.push_ctx_active();\r\n\r\n        for (let keymap of sarea.area.getKeyMaps()) {\r\n          if (keymap.handle(sarea.area.ctx, e)) {\r\n            handled = true;\r\n            break;\r\n          }\r\n        }\r\n\r\n        sarea.area.pop_ctx_active();\r\n      }\r\n    }\r\n\r\n    return handled;\r\n  }\r\n\r\n  calcTabOrder() {\r\n    let nodes = [];\r\n    let visit = {};\r\n\r\n    let rec = (n) => {\r\n      let bad = n.tabIndex < 0 || n.tabIndex === undefined || n.tabIndex === null;\r\n      bad = bad || !(n instanceof UIBase);\r\n\r\n      if (n._id in visit || n.hidden) {\r\n        return;\r\n      }\r\n\r\n      visit[n._id] = 1;\r\n\r\n      if (!bad) {\r\n        n.__pos = n.getClientRects()[0];\r\n        if (n.__pos) {\r\n          nodes.push(n);\r\n        }\r\n      }\r\n\r\n      n._forEachChildWidget((n2) => {\r\n        rec(n2);\r\n      });\r\n    };\r\n\r\n    for (let sarea of this.sareas) {\r\n      rec(sarea);\r\n    }\r\n\r\n    for (let popup of this._popups) {\r\n      rec(popup);\r\n    }\r\n\r\n    //console.log(\"nodes2\", nodes2);\r\n    for (let i = 0; i < nodes.length; i++) {\r\n      let n = nodes[i];\r\n\r\n      n.tabIndex = i + 1;\r\n      //console.log(n.tabIndex);\r\n    }\r\n  }\r\n\r\n  drawUpdate() {\r\n    if (window.redraw_all !== undefined) {\r\n      window.redraw_all();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    let move = [];\r\n    for (let child of this.childNodes) {\r\n      if (child instanceof ScreenArea) {\r\n        move.push(child);\r\n      }\r\n    }\r\n\r\n    for (let child of move) {\r\n      console.warn(\"moved screen area to shadow\");\r\n\r\n      HTMLElement.prototype.remove.call(child);\r\n      this.shadow.appendChild(child);\r\n    }\r\n\r\n    if (this._do_updateSize) {\r\n      this.updateSize();\r\n    }\r\n\r\n    if (this.needsTabRecalc) {\r\n      this.needsTabRecalc = false;\r\n      this.calcTabOrder();\r\n    }\r\n\r\n    outer: for (let sarea of this.sareas) {\r\n      for (let b of sarea._borders) {\r\n        let movable = this.isBorderMovable(b);\r\n\r\n        if (movable !== b.movable) {\r\n          console.log(\"detected change in movable borders\");\r\n          this.regenBorders();\r\n          break outer;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (this._update_gen) {\r\n      let ret;\r\n\r\n      /*\r\n      if (cconst.DEBUG.debugUIUpdatePerf) {\r\n          for (ret = this._update_gen.next(); !ret.done; ret = this._update_gen.next()) {}\r\n\r\n        this._update_gen = this.update_intern();\r\n        return;\r\n      }\r\n      //*/\r\n\r\n      try {\r\n        ret = this._update_gen.next();\r\n      } catch (error) {\r\n        if (!(error instanceof DataPathError)) {\r\n          util.print_stack(error);\r\n          console.log(\"error in update_intern tasklet\");\r\n        }\r\n        return;\r\n      }\r\n\r\n      if (ret !== undefined && ret.done) {\r\n        this._update_gen = undefined;\r\n      }\r\n    } else {\r\n      this._update_gen = this.update_intern();\r\n    }\r\n  }\r\n\r\n  purgeUpdateStack() {\r\n    this._update_gen = undefined;\r\n    purgeUpdateStack();\r\n  }\r\n\r\n  completeSetCSS() {\r\n    let rec = (n) => {\r\n      n.setCSS();\r\n\r\n      if (n.packflag & PackFlags.NO_UPDATE) {\r\n        return;\r\n      }\r\n\r\n      n._forEachChildWidget((c) => {\r\n        rec(c);\r\n      })\r\n    }\r\n\r\n    rec(this);\r\n  }\r\n\r\n  completeUpdate() {\r\n    for (let step of this.update_intern()) {\r\n    }\r\n  }\r\n\r\n  updateScrollStyling() {\r\n    let s = theme.scrollbars;\r\n\r\n    if (!s || !s.color) return;\r\n\r\n    let key = \"\" + s.color + \":\" + s.color2 + \":\" + s.border + \":\" + s.contrast + \":\" + s.width;\r\n\r\n    if (key !== this._last_scrollstyle_key) {\r\n      this._last_scrollstyle_key = key;\r\n\r\n      //console.log(\"updating scrollbar styling\");\r\n\r\n      this.mergeGlobalCSS(styleScrollBars(s.color, s.color2, s.contrast, s.width, s.border, \"*\"));\r\n    }\r\n  }\r\n\r\n  //XXX race condition warning\r\n  update_intern() {\r\n    this.updateScrollStyling();\r\n\r\n    let popups = this._popups;\r\n\r\n    let cssText = \"\";\r\n    let sheet = this.globalCSS.sheet;\r\n    if (sheet) {\r\n      for (let rule of sheet.rules) {\r\n        cssText += rule.cssText + \"\\n\";\r\n      }\r\n\r\n      window.cssText = cssText\r\n    }\r\n    let cssTextHash = util.strhash(cssText);\r\n\r\n    if (this.needsBorderRegen) {\r\n      this.needsBorderRegen = false;\r\n      this.regenBorders();\r\n    }\r\n\r\n    super.update();\r\n    let this2 = this;\r\n\r\n    //ensure each area has proper ctx set\r\n    for (let sarea of this.sareas) {\r\n      if (!sarea.ctx) {\r\n        sarea.ctx = this.ctx;\r\n      }\r\n    }\r\n\r\n    return (function* () {\r\n      let stack = update_stack;\r\n      stack.cur = 0;\r\n\r\n      let lastn = this2;\r\n\r\n      function push(n) {\r\n        stack[stack.cur++] = n;\r\n      }\r\n\r\n      function pop(n) {\r\n        if (stack.cur < 0) {\r\n          throw new Error(\"Screen.update(): stack overflow!\");\r\n        }\r\n\r\n        return stack[--stack.cur];\r\n      }\r\n\r\n      let ctx = this2.ctx;\r\n\r\n      let SCOPE_POP = Symbol(\"pop\");\r\n      let AREA_CTX_POP = Symbol(\"pop2\");\r\n\r\n      let scopestack = [];\r\n      let areastack = [];\r\n\r\n      let t = util.time_ms();\r\n      push(this2);\r\n\r\n      for (let p of popups) {\r\n        push(p);\r\n      }\r\n\r\n      while (stack.cur > 0) {\r\n        let n = pop();\r\n\r\n        if (n === undefined) {\r\n          //console.log(\"eek!\", stack.length);\r\n          continue;\r\n        } else if (n === SCOPE_POP) {\r\n          scopestack.pop();\r\n          continue;\r\n        } else if (n === AREA_CTX_POP) {\r\n          //console.log(\"POP\", areastack[areastack.length-1].constructor.name);\r\n          areastack.pop().pop_ctx_active(ctx, true);\r\n          continue;\r\n        }\r\n\r\n        if (n instanceof Area) {\r\n          //console.log(\"PUSH\", n.constructor.name);\r\n          areastack.push(n);\r\n          n.push_ctx_active(ctx, true);\r\n          push(AREA_CTX_POP);\r\n        }\r\n\r\n        if (!n.hidden && n !== this2 && n instanceof UIBase) {\r\n          if (!n._ctx) {\r\n            n._ctx = ctx;\r\n          }\r\n\r\n          if (n._screenStyleUpdateHash !== cssTextHash) {\r\n            n._screenStyleTag.textContent = cssText;\r\n            n._screenStyleUpdateHash = cssTextHash;\r\n          }\r\n\r\n          if (scopestack.length > 0 && scopestack[scopestack.length - 1]) {\r\n            n.parentWidget = scopestack[scopestack.length - 1];\r\n\r\n            //if (n.parentWidget && n._useDataPathUndo === undefined && n.parentWidget._useDataPathUndo !== undefined) {\r\n            //  n._useDataPathUndo = n.parentWidget._useDataPathUndo;\r\n            //}\r\n          }\r\n\r\n          n.update();\r\n        }\r\n\r\n        if (util.time_ms() - t > 20) {\r\n          yield;\r\n          t = util.time_ms();\r\n        }\r\n\r\n        for (let n2 of n.childNodes) {\r\n          if (!(n2 instanceof UIBase) || !(n2.packflag & PackFlags.NO_UPDATE)) {\r\n            push(n2);\r\n          }\r\n        }\r\n\r\n        if (n.shadow === undefined) {\r\n          continue;\r\n        }\r\n\r\n        for (let n2 of n.shadow.childNodes) {\r\n          if (!(n2 instanceof UIBase) || !(n2.packflag & PackFlags.NO_UPDATE)) {\r\n            push(n2);\r\n          }\r\n        }\r\n\r\n        if (n instanceof UIBase) {\r\n          if (!(n.packflag & PackFlags.NO_UPDATE)) {\r\n            scopestack.push(n);\r\n            push(SCOPE_POP);\r\n          }\r\n        }\r\n      }\r\n    })();\r\n  }\r\n\r\n  //load pos/size from screenverts\r\n  loadFromVerts() {\r\n    let old = [0, 0];\r\n    for (let sarea of this.sareas) {\r\n      old[0] = sarea.size[0];\r\n      old[1] = sarea.size[1];\r\n\r\n      sarea.loadFromVerts();\r\n      sarea.on_resize(old);\r\n      sarea.setCSS();\r\n    }\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  /** merges sarea into the screen area opposite to sarea*/\r\n  collapseArea(sarea, border) {\r\n    let sarea2;\r\n\r\n    if (!border) {\r\n      for (let b of sarea._borders) {\r\n        let sarea2 = b.getOtherSarea(sarea);\r\n\r\n        if (sarea2 && !b.locked) {\r\n          border = b;\r\n          break;\r\n        }\r\n      }\r\n    } else if (border.locked) {\r\n      console.warn(\"Cannot remove screen border\");\r\n    }\r\n\r\n    console.warn(\"SAREA2\", border, sarea2, sarea2 !== sarea);\r\n\r\n    if (border) {\r\n      sarea2 = border.getOtherSarea(sarea);\r\n\r\n      if (!sarea2) {\r\n        console.error(\"Error merging sarea\");\r\n        return;\r\n      }\r\n\r\n      let size1 = new Vector2(sarea.pos).add(sarea.size);\r\n      let size2 = new Vector2(sarea2.pos).add(sarea2.size);\r\n\r\n      sarea2.pos.min(sarea.pos);\r\n      sarea2.size.load(size1).max(size2).sub(sarea2.pos);\r\n\r\n      sarea2.loadFromPosSize();\r\n    }\r\n\r\n    this.sareas.remove(sarea);\r\n    sarea.remove();\r\n\r\n    this.regenScreenMesh();\r\n    this._internalRegenAll();\r\n\r\n    return this;\r\n  }\r\n\r\n  splitArea(sarea, t = 0.5, horiz = true) {\r\n    let w = sarea.size[0], h = sarea.size[1];\r\n    let x = sarea.pos[0], y = sarea.size[1];\r\n    let s1, s2;\r\n\r\n    if (!horiz) {\r\n      s1 = sarea;\r\n      if (s1.ctx === undefined) {\r\n        s1.ctx = this.ctx;\r\n      }\r\n      s2 = s1.copy(this);\r\n\r\n      s1.size[0] *= t;\r\n      s2.size[0] *= (1.0 - t);\r\n\r\n      s2.pos[0] += w*t;\r\n    } else {\r\n      s1 = sarea;\r\n      if (s1.ctx === undefined) {\r\n        s1.ctx = this.ctx;\r\n      }\r\n      s2 = s1.copy(this);\r\n\r\n      s1.size[1] *= t;\r\n      s2.size[1] *= (1.0 - t);\r\n\r\n      s2.pos[1] += h*t;\r\n    }\r\n\r\n    s2.ctx = this.ctx;\r\n    this.appendChild(s2);\r\n\r\n    s1.on_resize(s1.size);\r\n    s2.on_resize(s2.size);\r\n\r\n    this.regenBorders();\r\n    this.solveAreaConstraints();\r\n\r\n    s1.setCSS();\r\n    s2.setCSS();\r\n\r\n    this.setCSS();\r\n\r\n    //XXX not sure if this is right place to do this or really necassary\r\n    if (s2.area !== undefined)\r\n      s2.area.onadd();\r\n\r\n    return s2;\r\n  }\r\n\r\n  setCSS() {\r\n    if (!this.getBoolAttribute(\"inherit-scale\")) {\r\n      this.style[\"width\"] = this.size[0] + \"px\";\r\n      this.style[\"height\"] = this.size[1] + \"px\";\r\n    }\r\n\r\n    this.style[\"overflow\"] = \"hidden\";\r\n\r\n    //call setCSS on borders\r\n    for (let key in this._edgemap) {\r\n      let b = this._edgemap[key];\r\n\r\n      b.setCSS();\r\n    }\r\n  }\r\n\r\n  regenScreenMesh(snapLimit = SnapLimit) {\r\n    this.snapLimit = snapLimit;\r\n\r\n    this.regenBorders();\r\n  }\r\n\r\n  regenBorders_stage2() {\r\n    for (let b of this.screenborders) {\r\n      b.halfedges = []\r\n    }\r\n\r\n    function hashHalfEdge(border, sarea) {\r\n      return border._id + \":\" + sarea._id;\r\n    }\r\n\r\n    function has_he(border, border2, sarea) {\r\n      for (let he of border.halfedges) {\r\n        if (border2 === he.border && sarea === he.sarea) {\r\n          return true;\r\n        }\r\n      }\r\n\r\n      return false;\r\n    }\r\n\r\n    for (let b1 of this.screenborders) {\r\n      for (let sarea of b1.sareas) {\r\n        let he = new ScreenHalfEdge(b1, sarea);\r\n        b1.halfedges.push(he);\r\n      }\r\n\r\n      let axis = b1.horiz ? 1 : 0;\r\n\r\n      let min = Math.min(b1.v1[axis], b1.v2[axis]);\r\n      let max = Math.max(b1.v1[axis], b1.v2[axis]);\r\n\r\n      for (let b2 of this.walkBorderLine(b1)) {\r\n        if (b1 === b2) {\r\n          continue;\r\n        }\r\n\r\n        let ok = b2.v1[axis] >= min && b2.v1[axis] <= max;\r\n        ok = ok || (b2.v2[axis] >= min && b2.v2[axis] <= max);\r\n\r\n        for (let sarea of b2.sareas) {\r\n          let ok2 = ok && !has_he(b2, b1, sarea);\r\n          if (ok2) {\r\n            let he2 = new ScreenHalfEdge(b2, sarea);\r\n            b1.halfedges.push(he2);\r\n          }\r\n        }\r\n\r\n      }\r\n    }\r\n\r\n\r\n    for (let b of this.screenborders) {\r\n      let movable = true;\r\n\r\n      for (let sarea of b.sareas) {\r\n        movable = movable && this.isBorderMovable(b);\r\n      }\r\n\r\n      b.movable = movable;\r\n    }\r\n  }\r\n\r\n  hasBorder(b) {\r\n    return b._id in this._idmap;\r\n  }\r\n\r\n  killScreenVertex(v) {\r\n    this.screenverts.remove(v);\r\n\r\n    delete this._edgemap[ScreenVert.hash(v, undefined, this.snapLimit)];\r\n    delete this._idmap[v._id];\r\n\r\n    return this;\r\n  }\r\n\r\n  freeBorder(b, sarea) {\r\n    if (b.sareas.indexOf(sarea) >= 0) {\r\n      b.sareas.remove(sarea);\r\n    }\r\n\r\n    let dels = [];\r\n\r\n    for (let he of b.halfedges) {\r\n      if (he.sarea === sarea) {\r\n        dels.push([b, he]);\r\n      }\r\n\r\n      for (let he2 of he.border.halfedges) {\r\n        if (he2 === he)\r\n          continue;\r\n\r\n        if (he2.sarea === sarea) {\r\n          dels.push([he.border, he2]);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let d of dels) {\r\n      if (d[0].halfedges.indexOf(d[1]) < 0) {\r\n        console.warn(\"Double remove detected; use util.set?\");\r\n        continue;\r\n      }\r\n\r\n      d[0].halfedges.remove(d[1]);\r\n    }\r\n\r\n    if (b.sareas.length === 0) {\r\n      this.killBorder(b);\r\n    }\r\n  }\r\n\r\n  killBorder(b) {\r\n    console.log(\"killing border\", b._id, b);\r\n\r\n    if (this.screenborders.indexOf(b) < 0) {\r\n      console.log(\"unknown border\", b);\r\n      b.remove();\r\n      return;\r\n    }\r\n\r\n    this.screenborders.remove(b);\r\n\r\n    let del = [];\r\n\r\n    for (let he of b.halfedges) {\r\n      if (he === he2)\r\n        continue;\r\n\r\n      for (let he2 of he.border.halfedges) {\r\n        if (he2.border === b) {\r\n          del.push([he.border, he2]);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let d of del) {\r\n      d[0].halfedges.remove(d[1]);\r\n    }\r\n\r\n    delete this._edgemap[ScreenBorder.hash(b.v1, b.v2)];\r\n    delete this._idmap[b._id];\r\n\r\n    b.v1.borders.remove(b);\r\n    b.v2.borders.remove(b);\r\n\r\n    if (b.v1.borders.length === 0) {\r\n      this.killScreenVertex(b.v1);\r\n    }\r\n    if (b.v2.borders.length === 0) {\r\n      this.killScreenVertex(b.v2);\r\n    }\r\n\r\n    b.remove();\r\n\r\n    return this;\r\n  }\r\n\r\n  //XXX rename to regenScreenMesh\r\n  regenBorders() {\r\n    for (let b of this.screenborders) {\r\n      b.remove();\r\n    }\r\n\r\n    this._idmap = {};\r\n    this.screenborders = [];\r\n    this._edgemap = {};\r\n    this._vertmap = {};\r\n    this.screenverts = []\r\n\r\n    for (let sarea of this.sareas) {\r\n      if (sarea.hidden) continue;\r\n\r\n      sarea.makeBorders(this);\r\n    }\r\n\r\n    for (let key in this._edgemap) {\r\n      let b = this._edgemap[key];\r\n\r\n      b.setCSS();\r\n    }\r\n\r\n    this.regenBorders_stage2();\r\n    this._recalcAABB();\r\n\r\n    for (let b of this.screenborders) {\r\n      b.outer = this.isBorderOuter(b);\r\n      b.movable = this.isBorderMovable(b);\r\n      b.setCSS();\r\n    }\r\n\r\n    this.updateDebugBoxes();\r\n  }\r\n\r\n  _get_debug_overlay() {\r\n    if (!this._debug_overlay) {\r\n      this._debug_overlay = UIBase.createElement(\"overdraw-x\");\r\n      let s = this._debug_overlay;\r\n\r\n      s.startNode(this, this);\r\n    }\r\n\r\n    return this._debug_overlay;\r\n  }\r\n\r\n  updateDebugBoxes() {\r\n    if (cconst.DEBUG.screenborders) {\r\n      let overlay = this._get_debug_overlay();\r\n      overlay.clear();\r\n\r\n      for (let b of this.screenborders) {\r\n        overlay.line(b.v1, b.v2, \"red\");\r\n      }\r\n      let del = [];\r\n      for (let child of document.body.childNodes) {\r\n        if (child.getAttribute && child.getAttribute(\"class\") === \"__debug\") {\r\n          del.push(child);\r\n        }\r\n      }\r\n      for (let n of del) {\r\n        n.remove();\r\n      }\r\n\r\n      let box = (x, y, s, text, color = \"red\") => {\r\n        x -= s*0.5;\r\n        y -= s*0.5;\r\n\r\n        x = Math.min(Math.max(x, 0.0), this.size[0] - s);\r\n        y = Math.min(Math.max(y, 0.0), this.size[1] - s);\r\n\r\n        let ret = UIBase.createElement(\"div\");\r\n        ret.setAttribute(\"class\", \"__debug\");\r\n\r\n\r\n        ret.style[\"position\"] = UIBase.PositionKey;\r\n        ret.style[\"left\"] = x + \"px\";\r\n        ret.style[\"top\"] = y + \"px\";\r\n        ret.style[\"height\"] = s + \"px\";\r\n        ret.style[\"width\"] = s + \"px\";//\"200px\";\r\n        ret.style[\"z-index\"] = \"1000\";\r\n        ret.style[\"pointer-events\"] = \"none\";\r\n        ret.style[\"padding\"] = ret.style[\"margin\"] = \"0px\";\r\n        ret.style['display'] = \"float\";\r\n        ret.style[\"background-color\"] = color;\r\n        document.body.appendChild(ret);\r\n\r\n        let colors = [\r\n          \"orange\",\r\n          \"black\",\r\n          \"white\",\r\n        ];\r\n\r\n        for (let i = 2; i >= 0; i--) {\r\n          ret = UIBase.createElement(\"div\");\r\n\r\n          ret.setAttribute(\"class\", \"__debug\");\r\n\r\n          ret.style[\"position\"] = UIBase.PositionKey;\r\n          ret.style[\"left\"] = x + \"px\";\r\n          ret.style[\"top\"] = y + \"px\";\r\n          ret.style[\"height\"] = s + \"px\";\r\n          ret.style[\"width\"] = \"250px\";//\"200px\";\r\n          ret.style[\"z-index\"] = \"\" + (1005 - i - 1);\r\n          ret.style[\"pointer-events\"] = \"none\";\r\n          ret.style[\"color\"] = colors[i];\r\n\r\n          let w = (i)*2;\r\n          ret.style[\"-webkit-text-stroke-width\"] = w + \"px\";\r\n          ret.style[\"-webkit-text-stroke-color\"] = colors[i];\r\n          ret.style[\"text-stroke-width\"] = w + \"px\";\r\n          ret.style[\"text-stroke-color\"] = colors[i];\r\n\r\n          ret.style[\"padding\"] = ret.style[\"margin\"] = \"0px\";\r\n          ret.style['display'] = \"float\";\r\n          ret.style[\"background-color\"] = \"rgba(0,0,0,0)\";\r\n          ret.innerText = \"\" + text;\r\n          document.body.appendChild(ret);\r\n        }\r\n\r\n      };\r\n\r\n      for (let v of this.screenverts) {\r\n        box(v[0], v[1], 10*v.borders.length, \"\" + v.borders.length, \"rgba(255,0,0,0.5)\");\r\n      }\r\n\r\n      for (let b of this.screenborders) {\r\n        for (let he of b.halfedges) {\r\n          let txt = `${he.side}, ${b.sareas.length}, ${b.halfedges.length}`;\r\n          let p = new Vector2(b.v1).add(b.v2).mulScalar(0.5);\r\n          let size = 10*b.halfedges.length;\r\n\r\n          let wadd = 25 + size*0.5;\r\n          let axis = b.horiz & 1;\r\n\r\n          if (p[axis] > he.sarea.pos[axis]) {\r\n            p[axis] -= wadd;\r\n          } else {\r\n            p[axis] += wadd;\r\n          }\r\n          box(p[0], p[1], size, txt, \"rgba(155,255,75,0.5)\")\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  checkAreaConstraint(sarea, checkOnly = false) {\r\n    let min = sarea.minSize, max = sarea.maxSize;\r\n    let vs = sarea._verts;\r\n    let chg = 0.0;\r\n    let mask = 0;\r\n\r\n    let moveBorder = (sidea, sideb, dh) => {\r\n      let b1 = sarea._borders[sidea];\r\n      let b2 = sarea._borders[sideb];\r\n      let bad = 0;\r\n\r\n      for (let i = 0; i < 2; i++) {\r\n        let b = i ? b2 : b1;\r\n        let bad2 = sarea.borderLock & (1<<sidea);\r\n\r\n        bad2 = bad2 || !b.movable;\r\n        bad2 = bad2 || this.isBorderOuter(b);\r\n\r\n        if (bad2)\r\n          bad |= 1<<i;\r\n      }\r\n\r\n      if (bad === 0) {\r\n        this.moveBorder(b1, dh*0.5);\r\n        this.moveBorder(b2, -dh*0.5);\r\n      } else if (bad === 1) {\r\n        this.moveBorder(b2, -dh);\r\n      } else if (bad === 2) {\r\n        this.moveBorder(b1, dh);\r\n      } else if (bad === 3) {\r\n        //both borders are bad, yet we need to move anyway. . .\r\n        //console.warn(\"got case of two borders being bad\");\r\n\r\n        if (!this.isBorderOuter(b1)) {\r\n          this.moveBorder(b1, dh);\r\n        } else if (!this.isBorderOuter(b2)) {\r\n          this.moveBorder(b2, -dh);\r\n        } else {\r\n          this.moveBorder(b1, dh*0.5);\r\n          this.moveBorder(b2, -dh*0.5);\r\n        }\r\n      }\r\n    };\r\n\r\n    if (max[0] !== undefined && sarea.size[0] > max[0]) {\r\n      let dh = (sarea.size[0] - max[0]);\r\n      chg += Math.abs(dh);\r\n      mask |= 1;\r\n\r\n      moveBorder(0, 2, dh);\r\n    }\r\n\r\n    if (min[0] !== undefined && sarea.size[0] < min[0]) {\r\n      let dh = (min[0] - sarea.size[0]);\r\n      chg += Math.abs(dh);\r\n      mask |= 2;\r\n\r\n      moveBorder(2, 0, dh);\r\n    }\r\n\r\n\r\n    if (max[1] !== undefined && sarea.size[1] > max[1]) {\r\n      let dh = (sarea.size[1] - max[1]);\r\n      chg += Math.abs(dh);\r\n      mask |= 4;\r\n\r\n      moveBorder(3, 1, dh);\r\n    }\r\n\r\n    if (min[1] !== undefined && sarea.size[1] < min[1]) {\r\n      let dh = (min[1] - sarea.size[1]);\r\n      chg += Math.abs(dh);\r\n      mask |= 8;\r\n\r\n      moveBorder(1, 3, dh);\r\n    }\r\n\r\n    if (sarea.pos[0] + sarea.size[0] > this.size[0]) {\r\n      mask |= 16;\r\n      let dh = ((this.size[0] - sarea.size[0]) - sarea.pos[0]);\r\n\r\n      chg += Math.abs(dh);\r\n\r\n      if (sarea.floating) {\r\n        sarea.pos[0] = this.size[0] - sarea.size[0];\r\n        sarea.loadFromPosSize();\r\n      } else {\r\n        this.moveBorder(sarea._borders[0], dh);\r\n        this.moveBorder(sarea._borders[2], dh);\r\n      }\r\n    }\r\n\r\n    if (chg === 0.0) {\r\n      return false;\r\n    }\r\n\r\n    return mask;\r\n  }\r\n\r\n  walkBorderLine(b) {\r\n    let visit = new util.set();\r\n    let ret = [b];\r\n    visit.add(b);\r\n\r\n    let rec = (b, v) => {\r\n      for (let b2 of v.borders) {\r\n        if (b2 === b) {\r\n          continue;\r\n        }\r\n\r\n        if (b2.horiz === b.horiz && !visit.has(b2)) {\r\n          visit.add(b2);\r\n          ret.push(b2);\r\n          rec(b2, b2.otherVertex(v));\r\n        }\r\n      }\r\n    }\r\n\r\n    rec(b, b.v1);\r\n    let ret2 = ret;\r\n    ret = [];\r\n\r\n    rec(b, b.v2);\r\n    ret2.reverse();\r\n\r\n    return ret2.concat(ret);\r\n  }\r\n\r\n  moveBorderWithoutVerts(halfedge, df) {\r\n    let side = halfedge.side;\r\n    let sarea = halfedge.sarea;\r\n\r\n    switch (side) {\r\n      case 0:\r\n        sarea.pos[0] += df;\r\n        sarea.size[0] -= df;\r\n        break;\r\n      case 1:\r\n        sarea.size[1] += df;\r\n        break;\r\n      case 2:\r\n        sarea.size[0] += df;\r\n        break;\r\n      case 3:\r\n        sarea.pos[1] += df;\r\n        sarea.size[1] -= df;\r\n        break;\r\n    }\r\n  }\r\n\r\n  moveBorder(b, df, strict = true) {\r\n    return this.moveBorderSimple(b, df, strict);\r\n  }\r\n\r\n  moveBorderSimple(b, df, strict = true) {\r\n    let axis = b.horiz & 1;\r\n    let axis2 = axis ^ 1;\r\n\r\n    let min = Math.min(b.v1[axis2], b.v2[axis2]);\r\n    let max = Math.max(b.v1[axis2], b.v2[axis2]);\r\n\r\n    let test = (v) => {\r\n      return v[axis2] >= min && v[axis2] <= max;\r\n    };\r\n\r\n    let vs = new util.set();\r\n\r\n    for (let b2 of this.walkBorderLine(b)) {\r\n      if (strict && !test(b2.v1) && !test(b2.v2)) {\r\n        return false;\r\n      }\r\n\r\n      vs.add(b2.v1);\r\n      vs.add(b2.v2);\r\n    }\r\n\r\n    for (let v of vs) {\r\n      v[axis] += df;\r\n    }\r\n\r\n    for (let v of vs) {\r\n      for (let b of v.borders) {\r\n        for (let sarea of b.sareas) {\r\n          sarea.loadFromVerts();\r\n        }\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  moveBorderUnused(b, df, strict = true) {\r\n    if (!b) {\r\n      console.warn(\"missing border\");\r\n      return false;\r\n    }\r\n\r\n    let axis = b.horiz & 1;\r\n\r\n    let vs = new util.set();\r\n\r\n    let visit = new util.set();\r\n\r\n    let axis2 = axis ^ 1;\r\n\r\n    let min = Math.min(b.v1[axis2], b.v2[axis2]);\r\n    let max = Math.max(b.v1[axis2], b.v2[axis2]);\r\n\r\n    let test = (v) => {\r\n      return v[axis2] >= min && v[axis2] <= max;\r\n    };\r\n\r\n    let first = true;\r\n    let found = false;\r\n    let halfedges = new util.set();\r\n    let borders = new util.set();\r\n\r\n    for (let b2 of this.walkBorderLine(b)) {\r\n      /*\r\n      if (first) {\r\n        first = false;\r\n        df = Math.max(Math.abs(df), FrameManager_mesh.SnapLimit) * Math.sign(df);\r\n      }\r\n      found = true;\r\n      for (let sarea of b2.sareas) {\r\n        halfedges.add(new ScreenHalfEdge(b2, sarea))\r\n      }\r\n      vs.add(b2.v1);\r\n      vs.add(b2.v2);\r\n      continue;\r\n      //*/\r\n\r\n      if (!strict) {\r\n        vs.add(b2.v1);\r\n        vs.add(b2.v2);\r\n        continue;\r\n      }\r\n\r\n\r\n      let t1 = test(b2.v1), t2 = test(b2.v2);\r\n\r\n      if (!t1 || !t2) {\r\n        found = true;\r\n\r\n        if (first) {\r\n          first = false;\r\n          df = Math.max(Math.abs(df), FrameManager_mesh.SnapLimit)*Math.sign(df);\r\n        }\r\n      }\r\n      if (!t1 && !t2) {\r\n        continue;\r\n      }\r\n\r\n      borders.add(b2);\r\n\r\n      //make dummy half edges to keep track of border/sarea pairs\r\n      //and especailly what the border side is\r\n      for (let sarea of b2.sareas) {\r\n        halfedges.add(new ScreenHalfEdge(b2, sarea))\r\n      }\r\n\r\n      vs.add(b2.v1);\r\n      vs.add(b2.v2);\r\n    }\r\n\r\n    for (let b2 of this.walkBorderLine(b)) {\r\n      if (borders.has(b2)) {\r\n        continue;\r\n      }\r\n\r\n      for (let he of b2.halfedges) {\r\n        borders.remove(he.border);\r\n        if (halfedges.has(he)) {\r\n          halfedges.remove(he);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let v of vs) {\r\n      let ok = v[axis2] >= min && v[axis2] <= max;\r\n\r\n      if (!ok && strict) {\r\n        //   return false;\r\n      }\r\n    }\r\n\r\n    if (!found || !strict) {\r\n      for (let v of vs) {\r\n        v[axis] += df;\r\n      }\r\n    } else {\r\n      let borders = new util.set();\r\n\r\n      for (let he of halfedges) {\r\n        borders.add(he.border);\r\n        this.moveBorderWithoutVerts(he, df);\r\n      }\r\n\r\n      for (let he of halfedges) {\r\n        he.sarea.loadFromPosSize();\r\n      }\r\n\r\n      for (let b of borders) {\r\n        let sareas = b.sareas.slice(0, b.sareas.length);\r\n\r\n        this.killBorder(b);\r\n        for (let sarea of sareas) {\r\n          sarea.loadFromPosSize();\r\n        }\r\n      }\r\n\r\n      return halfedges.length > 0;\r\n    }\r\n\r\n\r\n    for (let sarea of b.sareas) {\r\n      sarea.loadFromVerts();\r\n    }\r\n\r\n    for (let he of b.halfedges) {\r\n      he.sarea.loadFromVerts();\r\n\r\n      for (let sarea of he.border.sareas) {\r\n        sarea.loadFromVerts();\r\n        for (let b2 of sarea._borders) {\r\n          b2.setCSS();\r\n        }\r\n      }\r\n    }\r\n\r\n    b.setCSS();\r\n\r\n    return true;\r\n  }\r\n\r\n  solveAreaConstraints(snapArgument = true) {\r\n    let repeat = false;\r\n    let found = false;\r\n\r\n    let time = util.time_ms();\r\n\r\n    for (let i = 0; i < 10; i++) {\r\n      repeat = false;\r\n\r\n      for (let sarea of this.sareas) {\r\n        if (sarea.hidden) continue;\r\n\r\n        repeat = repeat || this.checkAreaConstraint(sarea);\r\n      }\r\n\r\n      found = found || repeat;\r\n\r\n      if (repeat) {\r\n        for (let sarea of this.sareas) {\r\n          sarea.loadFromVerts();\r\n        }\r\n\r\n        this.snapScreenVerts(snapArgument);\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (found) {\r\n      this.snapScreenVerts(snapArgument);\r\n      if (cconst.DEBUG.areaConstraintSolver) {\r\n        time = util.time_ms() - time;\r\n\r\n        console.log(`enforced area constraint ${time.toFixed(2)}ms`);\r\n      }\r\n      this._recalcAABB();\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  snapScreenVerts(fitToSize = true) {\r\n    let this2 = this;\r\n\r\n    function* screenverts() {\r\n      for (let v of this2.screenverts) {\r\n        let ok = 0;\r\n\r\n        for (let sarea of v.sareas) {\r\n          if (!(sarea.flag & AreaFlags.INDEPENDENT)) {\r\n            ok = 1;\r\n          }\r\n        }\r\n\r\n        if (ok) {\r\n          yield v;\r\n        }\r\n      }\r\n    }\r\n\r\n    let mm = new math.MinMax(2);\r\n    for (let v of screenverts()) {\r\n      mm.minmax(v);\r\n    }\r\n\r\n    let min = mm.min, max = mm.max;\r\n\r\n    //snap(min);\r\n    //snapi(max);\r\n\r\n    if (fitToSize) {\r\n      //fit entire screen to, well, the entire screen (size)\r\n      let vec = new Vector2(max).sub(min);\r\n      let sz = new Vector2(this.size);\r\n\r\n      sz.div(vec);\r\n\r\n      for (let v of screenverts()) {\r\n        v.sub(min).mul(sz);\r\n        //snap(v.sub(min).mul(sz));//.add(this.pos);\r\n      }\r\n\r\n      for (let v of screenverts()) {\r\n        v[0] += this.pos[0];\r\n        v[1] += this.pos[1];\r\n      }\r\n\r\n      //this.pos.zero();\r\n    } else {\r\n      for (let v of screenverts()) {\r\n        //snap(v);\r\n      }\r\n\r\n      [min, max] = this._recalcAABB();\r\n\r\n      //snap(min);\r\n      //snapi(max);\r\n\r\n      this.size.load(max).sub(min);\r\n      //this.pos.zero();\r\n      //this.pos.load(min);\r\n    }\r\n\r\n    let found = 1;\r\n\r\n    for (let sarea of this.sareas) {\r\n      if (sarea.hidden) continue;\r\n\r\n      let old = new Vector2(sarea.size);\r\n      let oldpos = new Vector2(sarea.pos);\r\n\r\n      sarea.loadFromVerts();\r\n\r\n      found = found || old.vectorDistance(sarea.size) > 1;\r\n      found = found || oldpos.vectorDistance(sarea.pos) > 1;\r\n\r\n      sarea.on_resize(old);\r\n    }\r\n\r\n    if (found) {\r\n      //this.regenBorders();\r\n      this._recalcAABB();\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  on_resize(oldsize, newsize = this.size, _set_key = true) {\r\n    //console.warn(\"resizing\");\r\n\r\n    if (_set_key) {\r\n      this._last_ckey1 = this._calcSizeKey(newsize[0], newsize[1], this.pos[0], this.pos[1], devicePixelRatio, visualViewport.scale);\r\n    }\r\n\r\n    let ratio = [newsize[0]/oldsize[0], newsize[1]/oldsize[1]];\r\n\r\n    let offx = this.pos[0] - this.oldpos[0];\r\n    let offy = this.pos[1] - this.oldpos[1];\r\n\r\n    this.oldpos.load(this.pos);\r\n\r\n    //console.log(\"resize!\", ratio);\r\n\r\n    for (let v of this.screenverts) {\r\n      v[0] *= ratio[0];\r\n      v[1] *= ratio[1];\r\n      v[0] += offx;\r\n      v[1] += offy;\r\n    }\r\n\r\n    let min = [1e17, 1e17], max = [-1e17, -1e17];\r\n    let olds = [];\r\n\r\n    for (let sarea of this.sareas) {\r\n      olds.push([sarea.size[0], sarea.size[1]]);\r\n\r\n      sarea.loadFromVerts();\r\n    }\r\n\r\n    this.size[0] = newsize[0];\r\n    this.size[1] = newsize[1];\r\n\r\n    this.snapScreenVerts();\r\n    this.solveAreaConstraints();\r\n    this._recalcAABB();\r\n\r\n\r\n    let i = 0;\r\n    for (let sarea of this.sareas) {\r\n      sarea.on_resize(sarea.size, olds[i]);\r\n      sarea.setCSS();\r\n      i++;\r\n    }\r\n\r\n    this.regenBorders();\r\n    this.setCSS();\r\n    this.calcTabOrder();\r\n\r\n    this._fireResizeCB(oldsize);\r\n  }\r\n\r\n  _fireResizeCB(oldsize = this.size) {\r\n    for (let cb of this._resize_callbacks) {\r\n      cb(oldsize);\r\n    }\r\n  }\r\n\r\n  getScreenVert(pos, added_id = \"\", floating = false) {\r\n    let key = ScreenVert.hash(pos, added_id, this.snapLimit);\r\n\r\n    if (floating || !(key in this._vertmap)) {\r\n      let v = new ScreenVert(pos, this.idgen++, added_id);\r\n\r\n      this._vertmap[key] = v;\r\n      this._idmap[v._id] = v;\r\n\r\n      this.screenverts.push(v);\r\n    }\r\n\r\n    return this._vertmap[key];\r\n  }\r\n\r\n  isBorderOuter(border) {\r\n    let sides = 0;\r\n\r\n    for (let he of border.halfedges) {\r\n      sides |= 1<<he.side;\r\n    }\r\n\r\n    let bits = 0;\r\n    for (let i = 0; i < 4; i++) {\r\n      bits += (sides & (1<<i)) ? 1 : 0;\r\n    }\r\n\r\n    let ret = bits < 2;\r\n    let floating = false;\r\n\r\n    for (let sarea of border.sareas) {\r\n      floating = floating || sarea.floating;\r\n    }\r\n\r\n    if (floating) {\r\n      //check if border is on screen limits\r\n      let axis = border.horiz ? 1 : 0;\r\n\r\n      ret = Math.abs(border.v1[axis] - this.pos[axis]) < 4;\r\n      ret = ret || Math.abs(border.v1[axis] - this.pos[axis] - this.size[axis]) < 4;\r\n    }\r\n\r\n    border.outer = ret;\r\n    return ret;\r\n  }\r\n\r\n  isBorderMovable(b, limit = 5) {\r\n    if (this.allBordersMovable)\r\n      return true;\r\n\r\n    for (let he of b.halfedges) {\r\n      if (he.sarea.borderLock & (1<<he.side)) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    let ok = !this.isBorderOuter(b);\r\n\r\n    for (let sarea of b.sareas) {\r\n      if (sarea.floating) {\r\n        ok = true;\r\n        break;\r\n      }\r\n    }\r\n\r\n    return ok;\r\n  }\r\n\r\n  getScreenBorder(sarea, v1, v2, side) {\r\n    let suffix = sarea._get_v_suffix();\r\n\r\n    if (!(v1 instanceof ScreenVert)) {\r\n      v1 = this.getScreenVert(v1, suffix);\r\n    }\r\n\r\n    if (!(v2 instanceof ScreenVert)) {\r\n      v2 = this.getScreenVert(v2, suffix);\r\n    }\r\n\r\n    let hash = ScreenBorder.hash(v1, v2);\r\n\r\n    if (!(hash in this._edgemap)) {\r\n      let sb = this._edgemap[hash] = UIBase.createElement(\"screenborder-x\");\r\n\r\n      sb._hash = hash;\r\n      sb.screen = this;\r\n      sb.v1 = v1;\r\n      sb.v2 = v2;\r\n      sb._id = this.idgen++;\r\n\r\n      v1.borders.push(sb);\r\n      v2.borders.push(sb);\r\n\r\n      sb.ctx = this.ctx;\r\n\r\n      this.screenborders.push(sb);\r\n      this.appendChild(sb);\r\n\r\n      sb.setCSS();\r\n\r\n      this._edgemap[hash] = sb;\r\n      this._idmap[sb._id] = sb;\r\n    }\r\n\r\n    return this._edgemap[hash];\r\n  }\r\n\r\n  minmaxArea(sarea, mm = undefined) {\r\n    if (mm === undefined) {\r\n      mm = new math.MinMax(2);\r\n    }\r\n\r\n    for (let b of sarea._borders) {\r\n      mm.minmax(b.v1);\r\n      mm.minmax(b.v2);\r\n    }\r\n\r\n    return mm;\r\n  }\r\n\r\n  //does sarea1 border sarea2?\r\n  areasBorder(sarea1, sarea2) {\r\n    for (let b of sarea1._borders) {\r\n      for (let sa of b.sareas) {\r\n        if (sa === sarea2)\r\n          return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  //regenerates borders, sets css and calls this.update\r\n\r\n  replaceArea(dst, src) {\r\n    if (dst === src)\r\n      return;\r\n\r\n    src.pos[0] = dst.pos[0];\r\n    src.pos[1] = dst.pos[1];\r\n    src.size[0] = dst.size[0];\r\n    src.size[1] = dst.size[1];\r\n\r\n    src.floating = dst.floating;\r\n    src._borders = dst._borders;\r\n    src._verts = dst._verts;\r\n\r\n    if (this.sareas.indexOf(src) < 0) {\r\n      this.sareas.push(src);\r\n      this.shadow.appendChild(src);\r\n    }\r\n\r\n    if (this.sareas.active === dst) {\r\n      this.sareas.active = src;\r\n    }\r\n\r\n    //this.sareas.remove(dst);\r\n    //dst.remove();\r\n\r\n    this.sareas.remove(dst);\r\n    dst.remove();\r\n\r\n    this.regenScreenMesh();\r\n    this.snapScreenVerts();\r\n    this._updateAll();\r\n  }\r\n\r\n  _internalRegenAll() {\r\n    this.snapScreenVerts();\r\n    this._recalcAABB();\r\n    this.calcTabOrder();\r\n    this.setCSS();\r\n\r\n    this.completeUpdate();\r\n    this.completeSetCSS();\r\n    this.completeUpdate();\r\n  }\r\n\r\n  _updateAll() {\r\n    for (let sarea of this.sareas) {\r\n      sarea.setCSS();\r\n    }\r\n    this.setCSS();\r\n    this.update();\r\n  }\r\n\r\n  removeArea(sarea) {\r\n    if (this.sareas.indexOf(sarea) < 0) {\r\n      console.warn(sarea, \"<- Warning: tried to remove unknown area\");\r\n      return;\r\n    }\r\n\r\n    this.sareas.remove(sarea);\r\n    sarea.remove();\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      this.snapScreenVerts();\r\n      this.regenScreenMesh();\r\n    }\r\n\r\n    this._updateAll();\r\n    this.drawUpdate();\r\n  }\r\n\r\n  appendChild(child) {\r\n    /*\r\n    if (child instanceof UIBase) {\r\n      if (child._useDataPathUndo === undefined) {\r\n        child.useDataPathUndo = this.useDataPathUndo;\r\n      }\r\n    }*/\r\n\r\n    if (child instanceof ScreenArea.ScreenArea) {\r\n      child.screen = this;\r\n      child.ctx = this.ctx;\r\n      child.parentWidget = this;\r\n\r\n      this.sareas.push(child);\r\n\r\n      if (child.size.dot(child.size) === 0) {\r\n        child.size[0] = this.size[0];\r\n        child.size[1] = this.size[1];\r\n      }\r\n\r\n      if (!child._has_evts) {\r\n        child._has_evts = true;\r\n\r\n        let onfocus = (e) => {\r\n          this.sareas.active = child;\r\n        }\r\n\r\n        let onblur = (e) => {\r\n          //XXX this is causing bugs\r\n\r\n          //if (this.sareas.active === child) {\r\n          //  this.sareas.active = undefined;\r\n          //}\r\n        }\r\n\r\n        child.addEventListener(\"focus\", onfocus);\r\n        child.addEventListener(\"mouseenter\", onfocus);\r\n        child.addEventListener(\"blur\", onblur);\r\n        child.addEventListener(\"mouseleave\", onblur);\r\n      }\r\n\r\n      this.regenBorders();\r\n      child.setCSS();\r\n      this.drawUpdate();\r\n      child._init();\r\n    }\r\n\r\n    return this.shadow.appendChild(child);\r\n    //return super.appendChild(child);\r\n  }\r\n\r\n  add(child) {\r\n    return this.appendChild(child);\r\n  }\r\n\r\n  hintPickerTool() {\r\n    (new FrameManager_ops.ToolTipViewer(this)).start();\r\n  }\r\n\r\n  removeAreaTool(border) {\r\n    let tool = new FrameManager_ops.RemoveAreaTool(this, border);\r\n    //let tool = new FrameManager_ops.AreaDragTool(this, undefined, this.mpos);\r\n    tool.start();\r\n  }\r\n\r\n  moveAttachTool(sarea, mpos = this.mpos, elem, pointerId) {\r\n    let tool = new FrameManager_ops.AreaMoveAttachTool(this, sarea, mpos);\r\n    tool.start(elem, pointerId);\r\n  }\r\n\r\n  splitTool() {\r\n    let tool = new FrameManager_ops.SplitTool(this);\r\n    //let tool = new FrameManager_ops.AreaDragTool(this, undefined, this.mpos);\r\n    tool.start();\r\n  }\r\n\r\n  areaDragTool(sarea = this.sareas.active) {\r\n    if (sarea === undefined) {\r\n      console.warn(\"no active screen area\");\r\n      return;\r\n    }\r\n\r\n    let mpos = this.mpos;\r\n    let tool = new FrameManager_ops.AreaDragTool(this, this.sareas.active, mpos);\r\n\r\n    tool.start();\r\n  }\r\n\r\n  makeBorders() {\r\n    for (let sarea of this.sareas) {\r\n      sarea.makeBorders(this);\r\n    }\r\n  }\r\n\r\n  cleanupBorders() {\r\n    let del = new Set();\r\n\r\n    for (let b of this.screenborders) {\r\n      if (b.halfedges.length === 0) {\r\n        del.add(b);\r\n      }\r\n    }\r\n\r\n    for (let b of del) {\r\n      delete this._edgemap[b._hash];\r\n      HTMLElement.prototype.remove.call(b);\r\n    }\r\n  }\r\n\r\n  mergeBlankAreas() {\r\n    for (let b of this.screenborders) {\r\n      if (b.locked) {\r\n        continue;\r\n      }\r\n\r\n      let blank, sarea;\r\n\r\n      for (let he of b.halfedges) {\r\n        if (!he.sarea.area) {\r\n          blank = he.sarea;\r\n          sarea = b.getOtherSarea(blank);\r\n\r\n          let axis = b.horiz ^ 1;\r\n\r\n          if (blank && sarea && blank.size[axis] !== sarea.size[axis]) {\r\n            blank = sarea = undefined;\r\n          }\r\n\r\n          if (blank && sarea) {\r\n            break;\r\n          } else {\r\n            blank = undefined;\r\n            sarea = undefined;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (blank && sarea && blank !== sarea) {\r\n        this.collapseArea(blank, b);\r\n      }\r\n    }\r\n\r\n    this.cleanupBorders();\r\n  }\r\n\r\n  floatArea(area) {\r\n    let sarea = area.parentWidget;\r\n\r\n    /* already floating? */\r\n    if (sarea.floating) {\r\n      return sarea;\r\n    }\r\n\r\n    sarea.editors.remove(area);\r\n    delete sarea.editormap[area.constructor.define().areaname];\r\n    sarea.area = undefined;\r\n\r\n    HTMLElement.prototype.remove.call(area);\r\n\r\n    let sarea2 = UIBase.createElement(\"screenarea-x\", true);\r\n    sarea2.floating = true;\r\n\r\n    sarea2.pos = new Vector2(sarea.pos);\r\n    sarea2.pos.addScalar(5);\r\n\r\n    sarea2.size = new Vector2(sarea.size);\r\n\r\n    sarea2.editors.push(area);\r\n    sarea2.editormap[area.constructor.define().areaname] = area;\r\n\r\n    sarea2.shadow.appendChild(area);\r\n    sarea2.area = area;\r\n\r\n    area.push_ctx_active();\r\n    area.pop_ctx_active();\r\n\r\n    area.pos = sarea2.pos;\r\n    area.size = sarea2.size;\r\n    area.parentWidget = sarea2;\r\n    area.owning_sarea = sarea2;\r\n\r\n    sarea.flushSetCSS();\r\n    sarea.flushUpdate();\r\n\r\n    sarea2.flushSetCSS();\r\n    sarea2.flushUpdate();\r\n\r\n    this.appendChild(sarea2);\r\n\r\n    if (sarea.editors.length > 0) {\r\n      let area2 = sarea.editors[0];\r\n      sarea.switch_editor(area2.constructor);\r\n\r\n      sarea.flushSetCSS();\r\n      sarea.flushUpdate();\r\n    }\r\n\r\n    sarea2.loadFromPosSize();\r\n    sarea2.bringToFront();\r\n\r\n    this.mergeBlankAreas();\r\n    this.cleanupBorders();\r\n\r\n    return sarea2;\r\n  }\r\n\r\n  on_keydown(e) {\r\n    if (checkForTextBox(this, this.mpos[0], this.mpos[1])) {\r\n      console.log(\"textbox detected\");\r\n      return;\r\n    }\r\n\r\n    if (!haveModal() && this.execKeyMap(e)) {\r\n      e.preventDefault();\r\n      return;\r\n    }\r\n\r\n    if (!haveModal() && this.sareas.active !== undefined && this.sareas.active.on_keydown) {\r\n      let area = this.sareas.active;\r\n      return this.sareas.active.on_keydown(e);\r\n    }\r\n  }\r\n\r\n  on_keyup(e) {\r\n    if (!haveModal() && this.sareas.active !== undefined && this.sareas.active.on_keyup) {\r\n      return this.sareas.active.on_keyup(e);\r\n    }\r\n  }\r\n\r\n  on_keypress(e) {\r\n    if (!haveModal() && this.sareas.active !== undefined && this.sareas.active.on_keypress) {\r\n      return this.sareas.active.on_keypress(e);\r\n    }\r\n  }\r\n\r\n  draw() {\r\n    for (let sarea of this.sareas) {\r\n      sarea.draw();\r\n    }\r\n  }\r\n\r\n  afterSTRUCT() {\r\n    for (let sarea of this.sareas) {\r\n      sarea._ctx = this.ctx;\r\n      sarea.afterSTRUCT();\r\n    }\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    this.clear();\r\n\r\n    reader(this);\r\n\r\n    //handle old files that might have saved as simple arrays\r\n    this.size = new Vector2(this.size);\r\n\r\n    let sareas = this.sareas;\r\n    this.sareas = [];\r\n\r\n    /*\r\n    let push = this.sareas.push;\r\n\r\n    this.sareas.push = function(item) {\r\n      console.error(\"this.sareas.push\", item);\r\n      push.call(this, item);\r\n    }\r\n    */\r\n\r\n    for (let sarea of sareas) {\r\n      sarea.screen = this;\r\n      sarea.parentWidget = this;\r\n\r\n      this.appendChild(sarea);\r\n    }\r\n\r\n    this.regenBorders();\r\n    this.setCSS();\r\n\r\n    this.doOnce(() => {\r\n      this.loadUIData(this.uidata);\r\n      this.uidata = undefined;\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  test_struct(appstate = _appstate) {\r\n    let data = [];\r\n    //let scripts = nstructjs.write_scripts();\r\n    nstructjs.manager.write_object(data, this);\r\n    data = new DataView(new Uint8Array(data).buffer);\r\n\r\n    let screen2 = nstructjs.manager.read_object(data, this.constructor);\r\n    screen2.ctx = this.ctx;\r\n\r\n    for (let sarea of screen2.sareas) {\r\n      sarea.screen = screen2;\r\n      sarea.ctx = this.ctx;\r\n      sarea.area.ctx = this.ctx;\r\n    }\r\n\r\n    let parent = this.parentElement;\r\n    this.remove();\r\n\r\n    appstate.screen = screen2;\r\n\r\n    parent.appendChild(screen2);\r\n\r\n    //for (let \r\n    screen2.regenBorders();\r\n    screen2.update();\r\n    screen2.listen();\r\n\r\n    screen2.doOnce(() => {\r\n      screen2.on_resize(screen2.size, [window.innerWidth, window.innerHeight]);\r\n    });\r\n\r\n    console.log(data)\r\n    return screen2;\r\n  }\r\n\r\n  saveUIData() {\r\n    try {\r\n      return ui_base.saveUIData(this, \"screen\");\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n      console.log(\"Failed to save UI state data\");\r\n    }\r\n  }\r\n\r\n  loadUIData(str) {\r\n    try {\r\n      ui_base.loadUIData(this, str);\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n      console.log(\"Failed to load UI state data\");\r\n    }\r\n  }\r\n}\r\n\r\nScreen.STRUCT = `\r\npathux.Screen { \r\n  size  : vec2;\r\n  pos   : vec2;\r\n  sareas : array(pathux.ScreenArea);\r\n  idgen : int;\r\n  uidata : string | obj.saveUIData();\r\n}\r\n`;\r\n\r\nnstructjs.register(Screen);\r\nui_base.UIBase.internalRegister(Screen);\r\n\r\nScreenArea.setScreenClass(Screen);\r\n_setScreenClass(Screen);\r\n\r\nlet get_screen_cb;\r\nlet _on_keydown;\r\n\r\nlet start_cbs = [];\r\nlet stop_cbs = [];\r\nlet keyboardDom = window;\r\n\r\nlet key_event_opts;\r\n\r\nexport function startEvents(getScreenFunc) {\r\n  get_screen_cb = getScreenFunc;\r\n\r\n  if (_events_started) {\r\n    return;\r\n  }\r\n\r\n  _events_started = true;\r\n\r\n  _on_keydown = (e) => {\r\n    /* Prevent browser from unfocuing the page with the alt key.\r\n     * Happens during touch/pen event handing in Chrome (Oct2023).\r\n     */\r\n    if (e.keyCode === keymap[\"Alt\"]) {\r\n      e.preventDefault();\r\n    }\r\n\r\n    let screen = get_screen_cb();\r\n\r\n    return screen.on_keydown(e);\r\n  };\r\n\r\n  window.addEventListener(\"keydown\", _on_keydown, key_event_opts);\r\n\r\n  for (let cb of start_cbs) {\r\n    cb();\r\n  }\r\n}\r\n\r\nexport function stopEvents() {\r\n  window.removeEventListener(\"keydown\", _on_keydown, key_event_opts);\r\n  _on_keydown = undefined;\r\n  _events_started = false;\r\n\r\n  for (let cb of stop_cbs) {\r\n    try {\r\n      cb();\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n    }\r\n  }\r\n\r\n  return get_screen_cb;\r\n}\r\n\r\nexport function setKeyboardDom(dom) {\r\n  let started = _events_started;\r\n  if (started) {\r\n    stopEvents();\r\n  }\r\n\r\n  keyboardDom = dom;\r\n\r\n  if (started) {\r\n    startEvents(get_screen_cb);\r\n  }\r\n}\r\n\r\n/** Sets options passed to addEventListener() for on_keydown hotkey handler */\r\nexport function setKeyboardOpts(opts) {\r\n  key_event_opts = opts;\r\n}\r\n\r\nexport function _onEventsStart(cb) {\r\n  start_cbs.push(cb);\r\n}\r\n\r\nexport function _onEventsStop(cb) {\r\n  stop_cbs.push(cb);\r\n}\r\n\r\n/*\r\ndocument.addEventListener(\"touchstart\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"touchmove\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"scroll\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"resize\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"pointerdown\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"pointerstart\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"pointermove\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\n*/\r\n","import {AreaFlags} from \"../screen/ScreenArea.js\";\r\nimport {keymap} from \"../path-controller/util/simple_events.js\";\r\n\r\nexport function makePopupArea(area_class, screen, args={}) {\r\n  let sarea = UIBase.createElement(\"screenarea-x\");\r\n\r\n  let width = args.width || (screen.size[0]*0.7);\r\n  let height = args.height || (screen.size[1]*0.7);\r\n  let addEscapeKeyHandler = args.addEscapeKeyHandler !== undefined ? args.addEscapeKeyHandler : true;\r\n\r\n  sarea.ctx = screen.ctx;\r\n  sarea.size[0] = width;\r\n  sarea.size[1] = height;\r\n  sarea.pos[0] = 100;\r\n  sarea.pos[1] = 100;\r\n\r\n  sarea.pos[0] = Math.min(sarea.pos[0], screen.size[0] - sarea.size[0] - 2);\r\n  sarea.pos[1] = Math.min(sarea.pos[1], screen.size[1] - sarea.size[1] - 2);\r\n\r\n  sarea.switch_editor(area_class);\r\n\r\n  sarea.overrideClass(\"popup\");\r\n  sarea.style[\"background-color\"] = sarea.getDefault(\"background-color\");\r\n  sarea.style[\"border-radius\"] = sarea.getDefault(\"border-radius\") + \"px\";\r\n  sarea.style[\"border-color\"] = sarea.getDefault(\"border-color\");\r\n  sarea.style[\"border-style\"] = sarea.getDefault(\"border-style\");\r\n  sarea.style[\"border-width\"] = sarea.getDefault(\"border-width\") + \"px\";\r\n\r\n  sarea.flag |= AreaFlags.FLOATING | AreaFlags.INDEPENDENT;\r\n\r\n  screen.appendChild(sarea);\r\n  sarea.setCSS();\r\n\r\n  if (addEscapeKeyHandler) {\r\n    sarea.on_keydown = (e) => {\r\n      if (e.keyCode === keymap.Escape) {\r\n        screen.removeArea(sarea);\r\n      }\r\n    }\r\n  }\r\n\r\n  sarea.bringToFront();\r\n\r\n  return sarea;\r\n}","import {Area, contextWrangler} from '../screen/ScreenArea.js';\r\nimport {nstructjs} from '../path-controller/controller.js';\r\nimport {UIBase} from '../core/ui_base.js';\r\nimport {Container} from '../core/ui.js';\r\nimport {parsepx} from '../core/ui_base.js';\r\nimport {Icons} from '../core/ui_base.js';\r\nimport * as util from '../util/util.js';\r\n\r\nlet sidebar_hash = new util.HashDigest();\r\n\r\nexport class SideBar extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.header = this.row();\r\n    this.header.style[\"height\"] = \"45px\";\r\n\r\n    this._last_resize_key = undefined;\r\n\r\n    this._closed = false;\r\n\r\n    this.closeIcon = this.header.iconbutton(Icons.RIGHT_ARROW, \"Close/Open sidebar\", () => {\r\n      console.log(\"click!\");\r\n      this.closed = !this._closed;\r\n    });\r\n\r\n    this._openWidth = undefined;\r\n    this.needsSetCSS = true;\r\n    this.tabbar = this.tabs(\"left\");\r\n    //this.tabbar.style[\"flex-grow\"] = \"8\";\r\n  }\r\n\r\n  saveData() {\r\n    return {\r\n      closed : this.closed\r\n    }\r\n  }\r\n\r\n  loadData(obj) {\r\n    this.closed = obj.closed;\r\n  }\r\n\r\n  set closed(val) {\r\n    if (!!this._closed === !!val) {\r\n      return;\r\n    }\r\n\r\n    if (this._openWidth === undefined && !this._closed && val) {\r\n      this._openWidth = this.width;\r\n    }\r\n\r\n    console.log(\"animate!\");\r\n    let w = val ? 50 : this._openWidth;\r\n    this.animate().goto(\"width\", w, 500);\r\n\r\n\r\n    if (val) {\r\n      this.closeIcon.icon = Icons.LEFT_ARROW;\r\n    } else {\r\n      this.closeIcon.icon = Icons.RIGHT_ARROW;\r\n    }\r\n\r\n    this._closed = val;\r\n  }\r\n\r\n  get closed() {\r\n    return this._closed;\r\n  }\r\n\r\n  get width() {\r\n    return parsepx(\"\" + this.getAttribute(\"width\"));\r\n  }\r\n\r\n  set width(val) {\r\n    this.setAttribute(\"width\", \"\" + val + \"px\");\r\n    this.update();\r\n  }\r\n\r\n  get height() {\r\n    return parsepx(\"\" + this.getAttribute(\"height\"));\r\n  }\r\n\r\n  set height(val) {\r\n    this.setAttribute(\"height\", \"\" + val + \"px\");\r\n    this.update();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"sidebar-base-x\",\r\n      style  : \"sidebar\"\r\n    }\r\n  }\r\n\r\n  tab(name) {\r\n    return this.tabbar.tab(name);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    let closed = this._closed;\r\n    this._closed = false;\r\n\r\n    if (!this.getAttribute(\"width\")) {\r\n      this.width = 300;\r\n    }\r\n    if (!this.getAttribute(\"height\")) {\r\n      this.height = 700;\r\n    }\r\n\r\n    this.setCSS();\r\n\r\n    if (closed) {\r\n      this.closed = true;\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    if (!this.parentWidget) {\r\n      return;\r\n    }\r\n\r\n    let editor = this.parentWidget;\r\n\r\n    //happens when editors are inactive\r\n    if (!editor.pos || !editor.size) {\r\n      return;\r\n    }\r\n\r\n    this.needsSetCSS = false;\r\n\r\n    let w = this.width, h = this.height;\r\n\r\n    w = isNaN(w) ? 500 : w;\r\n    h = isNaN(h) ? 500 : h;\r\n\r\n    h = Math.min(h, editor.size[1]-25);\r\n\r\n    this.style[\"position\"] = \"absolute\";\r\n    this.style[\"width\"] = w + \"px\";\r\n    this.style[\"height\"] = h + \"px\";\r\n    this.style[\"z-index\"] = \"100\";\r\n    this.style[\"overflow\"] = \"scroll\";\r\n\r\n    this.style[\"background-color\"] = this.getDefault(\"AreaHeaderBG\");\r\n\r\n    this.tabbar.style[\"height\"] = (h - 45) + \"px\";\r\n    this.style[\"left\"] = (editor.size[0] - w) + \"px\";\r\n  }\r\n\r\n  update() {\r\n    sidebar_hash.reset();\r\n    sidebar_hash.add(this.width);\r\n    sidebar_hash.add(this.height);\r\n\r\n    let key = sidebar_hash.get();\r\n    if (key !== this._last_resize_key) {\r\n      this._last_resize_key = key;\r\n      this.needsSetCSS = true;\r\n    }\r\n\r\n    if (this.needsSetCSS) {\r\n      this.setCSS();\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.register(SideBar);\r\n\r\nexport class Editor extends Area {\r\n  constructor() {\r\n    super();\r\n\r\n    this.container = UIBase.createElement(\"container-x\");\r\n    this.container.parentWidget = this;\r\n    this.shadow.appendChild(this.container);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      areaname: \"areaname\",\r\n      tagname : \"tagname-x\"\r\n    }\r\n  }\r\n\r\n  static defineAPI(api, strct) {\r\n    return strct;\r\n  }\r\n\r\n  /** \\param makeMenuBar function(ctx, container, menuBarEditor)\r\n   *\r\n   * example:\r\n   *\r\n   * function makeMenuBar(ctx, container, menuBarEditor) {\r\n   *\r\n   *  container.menu(\"File\", [\r\n   *    \"app.new()\",\r\n   *    simple.Menu.SEP,\r\n   *    \"app.save()\",\r\n   *    \"app.save(forceDialog=true)|Save As\",\r\n   *    \"app.open\"\r\n   *  ]);\r\n   * }\r\n   * */\r\n  static registerAppMenu(makeMenuBar) {\r\n    if (this !== Editor) {\r\n      throw new Error(\"must call registerAppMenu from simple.Editor base class\");\r\n    }\r\n\r\n    this.makeMenuBar = makeMenuBar;\r\n  }\r\n\r\n  static register(cls) {\r\n    if (!cls.hasOwnProperty(\"define\")) {\r\n      throw new Error(\"missing define() method\");\r\n    }\r\n\r\n    if (!cls.hasOwnProperty(\"STRUCT\")) {\r\n      cls.STRUCT = nstructjs.inherit(cls, this) + `\\n}`;\r\n    }\r\n\r\n    super.register(cls);\r\n    nstructjs.register(cls);\r\n  }\r\n\r\n  makeSideBar() {\r\n    if (this.sidebar) {\r\n      this.sidebar.remove();\r\n    }\r\n\r\n    let sidebar = this.sidebar = UIBase.createElement(\"sidebar-base-x\");\r\n    sidebar.parentWidget = this;\r\n    sidebar.ctx = this.ctx;\r\n    this.shadow.appendChild(sidebar);\r\n\r\n    if (this.ctx) {\r\n      sidebar._init();\r\n\r\n      this.sidebar.flushSetCSS();\r\n      this.sidebar.flushUpdate();\r\n    }\r\n\r\n\r\n    return this.sidebar;\r\n  }\r\n\r\n  on_resize(size, oldsize) {\r\n    super.on_resize(size, oldsize);\r\n\r\n    if (this.sidebar) {\r\n      if (this.ctx && this.pos) {\r\n        this.sidebar.setCSS();\r\n      } else {\r\n        this.sidebar.needsSetCSS = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  static findEditor(cls) {\r\n    return contextWrangler.getLastArea(cls);\r\n  }\r\n  \r\n  getScreen() {\r\n    return this.ctx.screen;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.makeHeader(this.container);\r\n  }\r\n\r\n  /** creates default header and puts it in this.header */\r\n  makeHeader(container, add_note_area = true, make_draggable = true) {\r\n    return super.makeHeader(container, add_note_area, make_draggable);\r\n  }\r\n\r\n  /** called regularly */\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  /** */\r\n  setCSS() {\r\n    super.setCSS();\r\n  }\r\n}\r\n\r\n","let text = `\r\n<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\r\n<svg\r\n   xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\r\n   xmlns:cc=\"http://creativecommons.org/ns#\"\r\n   xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"\r\n   xmlns:svg=\"http://www.w3.org/2000/svg\"\r\n   xmlns=\"http://www.w3.org/2000/svg\"\r\n   xmlns:xlink=\"http://www.w3.org/1999/xlink\"\r\n   xmlns:sodipodi=\"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\"\r\n   xmlns:inkscape=\"http://www.inkscape.org/namespaces/inkscape\"\r\n   width=\"512\"\r\n   height=\"512\"\r\n   id=\"svg16099\"\r\n   version=\"1.1\"\r\n   inkscape:version=\"1.0 (4035a4fb49, 2020-05-01)\"\r\n   sodipodi:docname=\"iconsheet.svg\"\r\n   inkscape:export-filename=\"C:\\dev\\allshape\\src\\datafiles\\iconsheet16.png\"\r\n   inkscape:export-xdpi=\"45\"\r\n   inkscape:export-ydpi=\"45\">\r\n  <defs\r\n     id=\"defs16101\">\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1587\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1307\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1303\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1299\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1295\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1291\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1231\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1186\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1182\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4974\"\r\n       is_visible=\"true\" />\r\n    <linearGradient\r\n       id=\"linearGradient5481\">\r\n      <stop\r\n         id=\"stop4865\"\r\n         offset=\"0\"\r\n         style=\"stop-color:#e66700;stop-opacity:1;\" />\r\n      <stop\r\n         style=\"stop-color:#f47712;stop-opacity:1;\"\r\n         offset=\"0.52777779\"\r\n         id=\"stop4867\" />\r\n      <stop\r\n         id=\"stop4869\"\r\n         offset=\"1\"\r\n         style=\"stop-color:#f8bb8a;stop-opacity:1;\" />\r\n    </linearGradient>\r\n    <linearGradient\r\n       id=\"linearGradient17116-6\">\r\n      <stop\r\n         id=\"stop4860\"\r\n         offset=\"0\"\r\n         style=\"stop-color:#b3a500;stop-opacity:1;\" />\r\n      <stop\r\n         id=\"stop4862\"\r\n         offset=\"1\"\r\n         style=\"stop-color:#eaa500;stop-opacity:1;\" />\r\n    </linearGradient>\r\n    <linearGradient\r\n       id=\"linearGradient17116\">\r\n      <stop\r\n         id=\"stop4853\"\r\n         offset=\"0\"\r\n         style=\"stop-color:#b3a500;stop-opacity:1;\" />\r\n      <stop\r\n         id=\"stop4855\"\r\n         offset=\"1\"\r\n         style=\"stop-color:#eaa500;stop-opacity:1;\" />\r\n    </linearGradient>\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4290\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4286\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4122\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4118\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4194\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect3225\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect5012\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect5008\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4108\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect3264\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect5465\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4613\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4609\"\r\n       is_visible=\"true\" />\r\n    <linearGradient\r\n       id=\"linearGradient5609\">\r\n      <stop\r\n         id=\"stop5611\"\r\n         offset=\"0\"\r\n         style=\"stop-color:#0089e6;stop-opacity:1;\" />\r\n      <stop\r\n         style=\"stop-color:#1280f4;stop-opacity:1;\"\r\n         offset=\"0.52777779\"\r\n         id=\"stop5613\" />\r\n      <stop\r\n         id=\"stop5615\"\r\n         offset=\"1\"\r\n         style=\"stop-color:#d4eefc;stop-opacity:1;\" />\r\n    </linearGradient>\r\n    <linearGradient\r\n       id=\"linearGradient5481-8\">\r\n      <stop\r\n         style=\"stop-color:#ffc700;stop-opacity:1\"\r\n         offset=\"0\"\r\n         id=\"stop5483\" />\r\n      <stop\r\n         id=\"stop5491\"\r\n         offset=\"0.52777779\"\r\n         style=\"stop-color:#ffc700;stop-opacity:1\" />\r\n      <stop\r\n         style=\"stop-color:#ffa41c;stop-opacity:1\"\r\n         offset=\"1\"\r\n         id=\"stop5485\" />\r\n    </linearGradient>\r\n    <inkscape:perspective\r\n       sodipodi:type=\"inkscape:persp3d\"\r\n       inkscape:vp_x=\"-108.10967 : 516.24314 : 1\"\r\n       inkscape:vp_y=\"0 : 323.31882 : 0\"\r\n       inkscape:vp_z=\"57.429562 : 516.24314 : 1\"\r\n       inkscape:persp3d-origin=\"-25.340056 : 488.65327 : 1\"\r\n       id=\"perspective18342\" />\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0.0\"\r\n       refX=\"0.0\"\r\n       id=\"Arrow2Send\"\r\n       style=\"overflow:visible;\">\r\n      <path\r\n         id=\"path17173\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.62500000;stroke-linejoin:round;\"\r\n         d=\"M 8.7185878,4.0337352 L -2.2072895,0.016013256 L 8.7185884,-4.0017078 C 6.9730900,-1.6296469 6.9831476,1.6157441 8.7185878,4.0337352 z \"\r\n         transform=\"scale(0.3) rotate(180) translate(-2.3,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Mend\"\r\n       orient=\"auto\"\r\n       refY=\"0.0\"\r\n       refX=\"0.0\"\r\n       id=\"Arrow2Mend\"\r\n       style=\"overflow:visible;\">\r\n      <path\r\n         id=\"path17167\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.62500000;stroke-linejoin:round;\"\r\n         d=\"M 8.7185878,4.0337352 L -2.2072895,0.016013256 L 8.7185884,-4.0017078 C 6.9730900,-1.6296469 6.9831476,1.6157441 8.7185878,4.0337352 z \"\r\n         transform=\"scale(0.6) rotate(180) translate(0,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow1Send\"\r\n       orient=\"auto\"\r\n       refY=\"0.0\"\r\n       refX=\"0.0\"\r\n       id=\"Arrow1Send\"\r\n       style=\"overflow:visible;\">\r\n      <path\r\n         id=\"path17155\"\r\n         d=\"M 0.0,0.0 L 5.0,-5.0 L -12.5,0.0 L 5.0,5.0 L 0.0,0.0 z \"\r\n         style=\"fill-rule:evenodd;stroke:#000000;stroke-width:1.0pt;\"\r\n         transform=\"scale(0.2) rotate(180) translate(6,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Lend\"\r\n       orient=\"auto\"\r\n       refY=\"0.0\"\r\n       refX=\"0.0\"\r\n       id=\"Arrow2Lend\"\r\n       style=\"overflow:visible;\">\r\n      <path\r\n         id=\"path17161\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.62500000;stroke-linejoin:round;\"\r\n         d=\"M 8.7185878,4.0337352 L -2.2072895,0.016013256 L 8.7185884,-4.0017078 C 6.9730900,-1.6296469 6.9831476,1.6157441 8.7185878,4.0337352 z \"\r\n         transform=\"scale(1.1) rotate(180) translate(1,0)\" />\r\n    </marker>\r\n    <linearGradient\r\n       id=\"linearGradient17126\">\r\n      <stop\r\n         style=\"stop-color:#008080;stop-opacity:1;\"\r\n         offset=\"0\"\r\n         id=\"stop17128\" />\r\n      <stop\r\n         style=\"stop-color:#00b3b3;stop-opacity:1;\"\r\n         offset=\"1\"\r\n         id=\"stop17130\" />\r\n    </linearGradient>\r\n    <linearGradient\r\n       id=\"linearGradient17116-6-9\">\r\n      <stop\r\n         style=\"stop-color:#b3a500;stop-opacity:1;\"\r\n         offset=\"0\"\r\n         id=\"stop17118\" />\r\n      <stop\r\n         style=\"stop-color:#eaa500;stop-opacity:1;\"\r\n         offset=\"1\"\r\n         id=\"stop17120\" />\r\n    </linearGradient>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-2\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-2\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-6\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-8\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-7\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-6\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-8\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-9\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-79\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-5\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-3\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-1\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-33\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-4\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-1\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-3\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <linearGradient\r\n       inkscape:collect=\"always\"\r\n       xlink:href=\"#linearGradient5481-5\"\r\n       id=\"linearGradient5489-4\"\r\n       x1=\"355.89935\"\r\n       y1=\"17.125025\"\r\n       x2=\"380.47559\"\r\n       y2=\"17.125025\"\r\n       gradientUnits=\"userSpaceOnUse\" />\r\n    <linearGradient\r\n       id=\"linearGradient5481-5\">\r\n      <stop\r\n         style=\"stop-color:#e66700;stop-opacity:1;\"\r\n         offset=\"0\"\r\n         id=\"stop5483-2\" />\r\n      <stop\r\n         id=\"stop5491-9\"\r\n         offset=\"0.52777779\"\r\n         style=\"stop-color:#f47712;stop-opacity:1;\" />\r\n      <stop\r\n         style=\"stop-color:#f8bb8a;stop-opacity:1;\"\r\n         offset=\"1\"\r\n         id=\"stop5485-9\" />\r\n    </linearGradient>\r\n    <linearGradient\r\n       y2=\"17.125025\"\r\n       x2=\"380.47559\"\r\n       y1=\"17.125025\"\r\n       x1=\"355.89935\"\r\n       gradientUnits=\"userSpaceOnUse\"\r\n       id=\"linearGradient5588\"\r\n       xlink:href=\"#linearGradient5609\"\r\n       inkscape:collect=\"always\"\r\n       gradientTransform=\"matrix(1.2151103,0,0,1.1804992,-207.06775,536.98221)\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4108-1\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4108-4\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4108-9\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect3225-1\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect3225-4\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4122-2\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4122-7\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1587-6\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4194-5\"\r\n       is_visible=\"true\" />\r\n  </defs>\r\n  <sodipodi:namedview\r\n     id=\"base\"\r\n     pagecolor=\"#9c9c9c\"\r\n     bordercolor=\"#666666\"\r\n     borderopacity=\"1.0\"\r\n     inkscape:pageopacity=\"0\"\r\n     inkscape:pageshadow=\"2\"\r\n     inkscape:zoom=\"3.8325453\"\r\n     inkscape:cx=\"144.17961\"\r\n     inkscape:cy=\"49.96269\"\r\n     inkscape:document-units=\"px\"\r\n     inkscape:current-layer=\"layer1\"\r\n     showgrid=\"true\"\r\n     inkscape:window-width=\"1606\"\r\n     inkscape:window-height=\"962\"\r\n     inkscape:window-x=\"177\"\r\n     inkscape:window-y=\"71\"\r\n     inkscape:window-maximized=\"0\"\r\n     inkscape:snap-global=\"false\"\r\n     inkscape:pagecheckerboard=\"true\"\r\n     inkscape:document-rotation=\"0\">\r\n    <inkscape:grid\r\n       type=\"xygrid\"\r\n       id=\"grid16107\"\r\n       empspacing=\"1\"\r\n       visible=\"true\"\r\n       enabled=\"true\"\r\n       snapvisiblegridlinesonly=\"false\"\r\n       spacingx=\"32\"\r\n       spacingy=\"32\"\r\n       dotted=\"false\"\r\n       originx=\"0\"\r\n       originy=\"0\" />\r\n  </sodipodi:namedview>\r\n  <metadata\r\n     id=\"metadata16104\">\r\n    <rdf:RDF>\r\n      <cc:Work\r\n         rdf:about=\"\">\r\n        <dc:format>image/svg+xml</dc:format>\r\n        <dc:type\r\n           rdf:resource=\"http://purl.org/dc/dcmitype/StillImage\" />\r\n        <dc:title />\r\n      </cc:Work>\r\n    </rdf:RDF>\r\n  </metadata>\r\n  <g\r\n     inkscape:label=\"Layer 1\"\r\n     inkscape:groupmode=\"layer\"\r\n     id=\"layer1\"\r\n     transform=\"translate(0,-540.36218)\">\r\n    <ellipse\r\n       style=\"opacity:0.79203539;fill:url(#linearGradient5588);fill-opacity:1;stroke:#3c3c3c;stroke-width:1.1393038;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1\"\r\n       id=\"path3171-8\"\r\n       cx=\"240.32063\"\r\n       cy=\"557.19836\"\r\n       rx=\"14.353489\"\r\n       ry=\"14.165989\" />\r\n    <flowRoot\r\n       xml:space=\"preserve\"\r\n       id=\"flowRoot5564\"\r\n       style=\"font-style:normal;font-weight:normal;line-height:0.01%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none\"\r\n       transform=\"matrix(0.64571833,0,0,0.61432912,8.6966653,558.72048)\"><flowRegion\r\n         id=\"flowRegion5566\"\r\n         style=\"font-family:sans-serif\"><rect\r\n           id=\"rect5568\"\r\n           width=\"78.749992\"\r\n           height=\"72.5\"\r\n           x=\"346.24997\"\r\n           y=\"-21.999973\"\r\n           style=\"font-family:sans-serif\" /></flowRegion><flowPara\r\n         id=\"flowPara5570\"\r\n         style=\"font-weight:bold;font-size:40px;line-height:1.25;font-family:sans-serif;-inkscape-font-specification:'Sans Bold'\">?</flowPara></flowRoot>\r\n    <path\r\n       style=\"fill:none;stroke:#ec6900;stroke-width:4.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;marker-mid:none;marker-end:none\"\r\n       d=\"m 187.1235,559.26606 c -3.71166,-5.87882 -12.04056,-10.0009 -18.86169,0.34701\"\r\n       id=\"path4144-1\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\" />\r\n    <path\r\n       style=\"fill:#ec6900;fill-opacity:1;stroke:none;stroke-width:0.001;stroke-miterlimit:4;stroke-dasharray:none\"\r\n       d=\"m 170.01417,560.40163 2.05175,2.63036 -9.89352,4.33226 2.83717,-13.08504 z\"\r\n       id=\"path5370-7\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <path\r\n       style=\"fill:none;stroke:#1f9000;stroke-width:4.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;marker-mid:none;marker-end:none\"\r\n       d=\"m 197.1805,559.70121 c 3.69186,-5.88365 11.97631,-10.00911 18.76103,0.3473\"\r\n       id=\"path4144-1-9\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\" />\r\n    <path\r\n       style=\"fill:#1f9000;fill-opacity:1;stroke:none\"\r\n       d=\"m 213.95021,560.59037 -2.0408,2.63252 9.84072,4.33582 -2.82203,-13.09579 z\"\r\n       id=\"path5370-7-4\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <rect\r\n       style=\"fill:#000000;fill-opacity:1;stroke:none\"\r\n       id=\"rect3224\"\r\n       width=\"23.641272\"\r\n       height=\"8.4057856\"\r\n       x=\"487.73776\"\r\n       y=\"552.41565\" />\r\n    <path\r\n       style=\"fill:none;stroke:#000000;stroke-width:5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"M 498.18023,567.81152 484.7754,556.20378 498.93081,545.77569\"\r\n       id=\"path4074\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccc\" />\r\n    <path\r\n       style=\"fill:#000000;fill-opacity:1;stroke:none\"\r\n       d=\"m 17.866009,585.82436 -0.09,-4.53232 -14.5167501,7.49748 14.5683701,7.84238 z\"\r\n       id=\"path5370-5-0-6-5\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <path\r\n       style=\"fill:#000000;fill-opacity:1;stroke:none\"\r\n       d=\"m 46.366429,592.31275 0.0109,4.6129 14.90287,-7.37024 -14.68289,-8.23782 z\"\r\n       id=\"path5370-5-1-2\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <rect\r\n       style=\"opacity:0.94690265;fill:#000000;fill-opacity:1;stroke:none\"\r\n       id=\"rect5558-3-3\"\r\n       width=\"10.726034\"\r\n       height=\"5.6689787\"\r\n       x=\"-3.0812507\"\r\n       y=\"587.85645\"\r\n       transform=\"matrix(1,0,0.06880209,0.99763033,0,0)\" />\r\n    <rect\r\n       style=\"opacity:0.94690265;fill:#000000;fill-opacity:1;stroke:none\"\r\n       id=\"rect5558-1\"\r\n       width=\"10.540748\"\r\n       height=\"5.5710502\"\r\n       x=\"-22.93788\"\r\n       y=\"587.9295\"\r\n       transform=\"matrix(1,0,0.06880209,0.99763033,0,0)\" />\r\n    <path\r\n       style=\"fill:#2e2e2e;fill-opacity:1;stroke:none;stroke-width:0.685581\"\r\n       d=\"m 71.46269,592.27473 0.01481,6.27371 20.268436,-10.02379 -19.969263,-11.20374 z\"\r\n       id=\"path5370-5-1-2-1\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <path\r\n       style=\"fill:#2e2e2e;fill-opacity:1;stroke:none;stroke-width:0.685581\"\r\n       d=\"m 108.87703,578.56977 -6.27262,0.11779 10.35514,20.10117 10.87444,-20.15049 z\"\r\n       id=\"path5370-5-1-2-1-7\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <path\r\n       style=\"fill:#000000;fill-opacity:1;stroke:#363636;stroke-width:2.23946524;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 69.769603,567.95981 5.60449,-5.39601\"\r\n       id=\"path5452-5-5-1-7\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\"\r\n       inkscape:transform-center-x=\"3.061478\"\r\n       inkscape:transform-center-y=\"-0.63275351\" />\r\n    <path\r\n       style=\"fill:#000000;fill-opacity:1;stroke:#363636;stroke-width:2.23946524;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 75.172083,567.8747 -5.47097,-5.53134\"\r\n       id=\"path5452-5-5-1-7-4\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\"\r\n       inkscape:transform-center-x=\"3.196728\"\r\n       inkscape:transform-center-y=\"-0.78552851\" />\r\n    <path\r\n       style=\"fill:#ffe87e;fill-opacity:1;stroke:#a58000;stroke-width:1.02573335px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 36.512525,599.08328 -0.0847,-15.30469 14.76623,-0.079 1.13455,-5.3121 h 6.7663 l 0.52197,5.56549 h 2.38874 l -0.0349,15.41642 z\"\r\n       id=\"path4607\"\r\n       inkscape:path-effect=\"#path-effect4609\"\r\n       inkscape:original-d=\"m 36.512525,599.08328 -0.0847,-15.30469 14.76623,-0.079 1.13455,-5.3121 h 6.7663 l 0.52197,5.56549 h 2.38874 l -0.0349,15.41642 z\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccccccccc\"\r\n       transform=\"translate(-33.065965,-31.819347)\" />\r\n    <path\r\n       style=\"fill:#dfc449;fill-opacity:1;stroke:#a58000;stroke-width:1.04236829px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 38.651325,583.64804 2.27904,-5.34039 8.11475,0.19058 1.53729,4.93611 z\"\r\n       id=\"path5463\"\r\n       inkscape:path-effect=\"#path-effect5465\"\r\n       inkscape:original-d=\"m 38.651325,583.64804 2.27904,-5.34039 8.11475,0.19058 1.53729,4.93611 z\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccccc\"\r\n       transform=\"translate(-33.065965,-31.819347)\" />\r\n    <path\r\n       style=\"fill:#d7f0fb;fill-opacity:1;stroke:#4f4f4f;stroke-width:1.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;stroke-miterlimit:4;stroke-dasharray:none\"\r\n       d=\"m 71.789265,599.90744 0.17512,-24.69199 h 15.41061 l 4.378,4.90337 0.17513,19.96374 z\"\r\n       id=\"path3262\"\r\n       inkscape:path-effect=\"#path-effect3264\"\r\n       inkscape:original-d=\"m 71.789265,599.90744 0.17512,-24.69199 h 15.41061 l 4.378,4.90337 0.17513,19.96374 z\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cccccc\"\r\n       transform=\"translate(-33.561281,-31.819347)\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 73.190225,596.58015 16.81157,-0.35024\"\r\n       id=\"path4106\"\r\n       inkscape:path-effect=\"#path-effect4108\"\r\n       inkscape:original-d=\"m 73.190225,596.58015 16.81157,-0.35024\"\r\n       inkscape:connector-curvature=\"0\"\r\n       transform=\"translate(-33.561281,-31.819347)\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 73.540465,591.50166 16.81157,-0.35024\"\r\n       id=\"path4106-7\"\r\n       inkscape:path-effect=\"#path-effect4108-1\"\r\n       inkscape:original-d=\"m 73.540465,591.50166 16.81157,-0.35024\"\r\n       inkscape:connector-curvature=\"0\"\r\n       transform=\"translate(-33.561281,-31.819347)\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 73.365345,586.59829 16.81157,-0.35024\"\r\n       id=\"path4106-0\"\r\n       inkscape:path-effect=\"#path-effect4108-4\"\r\n       inkscape:original-d=\"m 73.365345,586.59829 16.81157,-0.35024\"\r\n       inkscape:connector-curvature=\"0\"\r\n       transform=\"translate(-33.561281,-31.819347)\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 73.365345,582.22027 16.81157,-0.35024\"\r\n       id=\"path4106-4\"\r\n       inkscape:path-effect=\"#path-effect4108-9\"\r\n       inkscape:original-d=\"m 73.365345,582.22027 16.81157,-0.35024\"\r\n       inkscape:connector-curvature=\"0\"\r\n       transform=\"translate(-33.561281,-31.819347)\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#f1f1f1;stroke-width:4.65793133;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 103.19489,558.19446 16.18158,0.0627\"\r\n       id=\"path5452-5-5-1-7-7\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\"\r\n       inkscape:transform-center-x=\"3.6534509\"\r\n       inkscape:transform-center-y=\"-5.3788766\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#f4f4f4;stroke-width:4.65793133;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 111.38254,565.89244 -0.15492,-16.18101\"\r\n       id=\"path5452-5-5-1-7-4-4\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\"\r\n       inkscape:transform-center-x=\"3.6340509\"\r\n       inkscape:transform-center-y=\"-5.8027516\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#f1f1f1;stroke-width:4.54087734;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 135.53124,558.66024 15.77493,0.0612\"\r\n       id=\"path5452-5-5-1-7-7-1\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\"\r\n       inkscape:transform-center-x=\"3.561639\"\r\n       inkscape:transform-center-y=\"-5.2436726\" />\r\n    <path\r\n       style=\"fill:#bfbfbf;fill-opacity:1;stroke:#ffffff;stroke-width:1.39999998;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 273.79736,565.92624 4.84986,4.15066 7.44379,-12.0346 -3.26109,-1.20718 -4.82074,8.91974 -2.46038,-2.39761 z\"\r\n       id=\"path1157\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccccccc\" />\r\n    <path\r\n       style=\"fill:#ff9d00;fill-opacity:1;stroke:#808080;stroke-width:0.78749156px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 306.19903,566.65065 4.84985,4.15066 7.4438,-12.0346 -3.26109,-1.20718 -4.82075,8.91974 -2.46037,-2.39761 z\"\r\n       id=\"path1157-6\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccccccc\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:4.85740042;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 419.41366,537.85807 12.87326,7.64338 12.79438,-7.33068\"\r\n       id=\"path1585\"\r\n       inkscape:connector-curvature=\"0\"\r\n       inkscape:path-effect=\"#path-effect1587\"\r\n       inkscape:original-d=\"m 419.41366,537.85807 12.87326,7.64338 c 4.40656,-2.37267 3.01422,-8.5404 12.79438,-7.33068\"\r\n       sodipodi:nodetypes=\"ccc\"\r\n       transform=\"matrix(0.82348572,0,0,0.82348572,75.604975,111.95505)\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:4.85740042;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 419.41366,537.85807 12.87326,7.64338 12.79438,-7.33068\"\r\n       id=\"path1585-6\"\r\n       inkscape:connector-curvature=\"0\"\r\n       inkscape:path-effect=\"#path-effect1587-6\"\r\n       inkscape:original-d=\"m 419.41366,537.85807 12.87326,7.64338 c 4.40656,-2.37267 3.01422,-8.5404 12.79438,-7.33068\"\r\n       sodipodi:nodetypes=\"ccc\"\r\n       transform=\"matrix(-0.82326686,0.01898429,-0.01898429,-0.82326686,829.82733,995.45395)\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#ffffff;stroke-width:1.4972775px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 325.7796,560.88703 9.22114,7.89176 14.15308,-22.88169 -6.20039,-2.29524 -9.16581,16.95932 -4.67796,-4.55863 z\"\r\n       id=\"path1157-6-7\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccccccc\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:none\"\r\n       d=\"m 338.27455,603.35315 -4.55847,-12.13972 -4.42325,4.14941 0.29119,-21.42993 14.0532,13.84869 -5.29334,1.40046 4.98485,11.66133 z\"\r\n       id=\"path4192-0\"\r\n       inkscape:path-effect=\"#path-effect4194-5\"\r\n       inkscape:original-d=\"m 338.27455,603.35315 -4.55847,-12.13972 -4.42325,4.14941 0.29119,-21.42993 14.0532,13.84869 -5.29334,1.40046 c 11.73953,18.68506 2.52594,6.89719 4.98485,11.66133 z\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cccccccc\"\r\n       transform=\"rotate(-9.319008,159.52768,371.93318)\" />\r\n    <text\r\n       xml:space=\"preserve\"\r\n       style=\"font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:17.712px;line-height:0%;font-family:'MV Boli';-inkscape-font-specification:'MV Boli';letter-spacing:0px;word-spacing:0px;fill:#ffdc00;fill-opacity:1;stroke:none;stroke-width:1.476\"\r\n       x=\"179.14906\"\r\n       y=\"751.84772\"\r\n       id=\"text3255-0\"\r\n       transform=\"matrix(1.2141217,-0.1513943,0.23126622,0.79480305,0,0)\"><tspan\r\n         sodipodi:role=\"line\"\r\n         id=\"tspan3257-0\"\r\n         x=\"179.14906\"\r\n         y=\"751.84772\"\r\n         style=\"font-size:44.4154px;line-height:1.25;stroke-width:1.476\">!</tspan></text>\r\n    <text\r\n       xml:space=\"preserve\"\r\n       style=\"font-style:normal;font-weight:normal;font-size:32.4516px;line-height:1.25;font-family:sans-serif;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.81129\"\r\n       x=\"131.62856\"\r\n       y=\"599.63672\"\r\n       id=\"text1309\"><tspan\r\n         sodipodi:role=\"line\"\r\n         id=\"tspan1307\"\r\n         x=\"131.62856\"\r\n         y=\"599.63672\"\r\n         style=\"font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:sans-serif;-inkscape-font-specification:'sans-serif Bold';stroke-width:0.81129\">B</tspan></text>\r\n    <text\r\n       id=\"text1309-2\"\r\n       y=\"658.43152\"\r\n       x=\"153.61592\"\r\n       style=\"font-style:normal;font-weight:normal;font-size:41.6588px;line-height:1.25;font-family:sans-serif;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.04147\"\r\n       xml:space=\"preserve\"\r\n       transform=\"scale(1.0962314,0.91221617)\"><tspan\r\n         style=\"font-style:italic;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:serif;-inkscape-font-specification:'serif Bold Italic';stroke-width:1.04147\"\r\n         y=\"658.43152\"\r\n         x=\"153.61592\"\r\n         id=\"tspan1307-4\"\r\n         sodipodi:role=\"line\">i</tspan></text>\r\n    <text\r\n       xml:space=\"preserve\"\r\n       style=\"font-style:normal;font-weight:normal;font-size:38.431px;line-height:1.25;font-family:sans-serif;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.960773\"\r\n       x=\"264.23669\"\r\n       y=\"522.23657\"\r\n       id=\"text1309-0-9\"\r\n       transform=\"scale(0.87011438,1.1492742)\"><tspan\r\n         sodipodi:role=\"line\"\r\n         id=\"tspan1307-3-4\"\r\n         x=\"264.23669\"\r\n         y=\"522.23657\"\r\n         style=\"font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:sans-serif;-inkscape-font-specification:'sans-serif Bold';stroke-width:0.960773\"><tspan\r\n           style=\"font-weight:normal;stroke-width:0.960773\"\r\n           id=\"tspan1365\">s</tspan></tspan></text>\r\n    <text\r\n       xml:space=\"preserve\"\r\n       style=\"font-style:normal;font-weight:normal;font-size:31.7797px;line-height:1.25;font-family:sans-serif;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.794494\"\r\n       x=\"195.07664\"\r\n       y=\"596.5979\"\r\n       id=\"text1309-0-2\"\r\n       transform=\"scale(0.99519471,1.0048285)\"><tspan\r\n         sodipodi:role=\"line\"\r\n         id=\"tspan1307-3-1\"\r\n         x=\"195.07664\"\r\n         y=\"596.5979\"\r\n         style=\"font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:sans-serif;-inkscape-font-specification:'sans-serif Bold';stroke-width:0.794494\">U</tspan></text>\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:3.47724;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 194.05959,600.03363 25.702,0.14808\"\r\n       id=\"path1375\" />\r\n    <path\r\n       id=\"path1375-2\"\r\n       d=\"m 227.04774,587.38832 25.63991,0.14772\"\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:3.46884;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       inkscape:transform-center-x=\"1.1856386\"\r\n       inkscape:transform-center-y=\"-0.33875464\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#484848;stroke-width:1.623;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 262.93706,592.38036 0.0134,5.70131 18.41916,-9.10923 -18.14729,-10.18151 z\"\r\n       id=\"path5370-5-1-2-1-4\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <path\r\n       inkscape:connector-curvature=\"0\"\r\n       id=\"path5370-5-1-2-1-4-0\"\r\n       d=\"m 301.44451,581.20782 -5.70129,0.0197 9.12976,18.40899 10.16128,-18.15862 z\"\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#484848;stroke-width:1.623;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\" />\r\n    <ellipse\r\n       style=\"fill:none;stroke:#242424;stroke-width:2.80047;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:20;stroke-opacity:1\"\r\n       id=\"path1040\"\r\n       ry=\"8.7032747\"\r\n       rx=\"8.4312963\"\r\n       cy=\"583.49023\"\r\n       cx=\"331.71524\" />\r\n    <path\r\n       style=\"fill:none;stroke:#242424;stroke-width:6;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 336.4644,589.47097 10.10632,10.66173\"\r\n       id=\"path1042\"\r\n       sodipodi:nodetypes=\"cc\" />\r\n    <path\r\n       style=\"fill:none;stroke:#242424;stroke-width:2.17621;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 325.36075,583.26941 12.63506,0.34484\"\r\n       id=\"path1044\" />\r\n    <ellipse\r\n       cx=\"364.00839\"\r\n       cy=\"584.36328\"\r\n       rx=\"9.6165609\"\r\n       ry=\"9.9267731\"\r\n       id=\"path1040-0\"\r\n       style=\"fill:none;stroke:#242424;stroke-width:3.19416;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:20;stroke-opacity:1\" />\r\n    <path\r\n       sodipodi:nodetypes=\"cc\"\r\n       id=\"path1042-6\"\r\n       d=\"m 369.73697,590.7899 10.89694,10.89694\"\r\n       style=\"fill:none;stroke:#242424;stroke-width:6;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\" />\r\n    <path\r\n       id=\"path1044-4\"\r\n       d=\"m 357.64269,584.09303 12.63506,0.34484\"\r\n       style=\"fill:none;stroke:#242424;stroke-width:2.17621;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\" />\r\n    <path\r\n       style=\"fill:none;stroke:#242424;stroke-width:2.17621;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 363.94156,590.78154 0.20796,-12.63806\"\r\n       id=\"path1044-4-9\" />\r\n  </g>\r\n</svg>\r\n`.trim();\r\n\r\ntext = btoa(text);\r\nexport let iconSvg = `data:image/svg+xml;base64,` + text;","\"use strict\";\r\n\r\nimport {iconSvg} from './iconsheet.js';\r\n\r\nexport const Icons = {\r\n  FOLDER        : 0, //file folder\r\n  FILE          : 1,\r\n  TINY_X        : 2, //'x' in bottom left corner\r\n  SMALL_PLUS    : 3,\r\n  SMALL_MINUS   : 4,\r\n  UNDO          : 5,\r\n  REDO          : 6,\r\n  HELP          : 7,\r\n  ENUM_UNCHECKED: 8, //overlaid on icon checkboxes when unchecked\r\n  ENUM_CHECKED  : 9, //overlaid on icon checkboxes when checked\r\n  LARGE_CHECK   : 10, //default check mark for non-icon checkboxes\r\n  CURSOR_ARROW  : 11,\r\n  NOTE_EXCL     : 12, //notification exclamation mark\r\n  SCROLL_DOWN   : 13,\r\n  SCROLL_UP     : 14,\r\n  BACKSPACE     : 15,\r\n  LEFT_ARROW    : 16,\r\n  RIGHT_ARROW   : 17,\r\n  UI_EXPAND     : 18, //triangle\r\n  UI_COLLAPSE   : 19, //triangle\r\n  BOLD          : 20,\r\n  ITALIC        : 21,\r\n  UNDERLINE     : 22,\r\n  STRIKETHRU    : 23,\r\n  TREE_EXPAND   : 24,\r\n  TREE_COLLAPSE : 25,\r\n  ZOOM_OUT      : 26,\r\n  ZOOM_IN       : 27\r\n};\r\n\r\nexport function loadDefaultIconSheet() {\r\n  let iconSheet = document.createElement(\"img\");\r\n  iconSheet.src = iconSvg;\r\n\r\n  return iconSheet;\r\n}\r\n\r\n\r\n","import nstructjs from '../path-controller/util/struct.js';\r\n\r\nimport {UIBase} from '../core/ui_base.js';\r\n\r\nexport class FileHeader {\r\n  constructor(version, magic, flags) {\r\n    this.magic = magic;\r\n    this.flags = flags;\r\n    this.version_major = version ? version[0] : 0;\r\n    this.version_minor = version ? version[1] : 0;\r\n    this.version_micro = version ? version[2] : 0;\r\n    this.schema = nstructjs.write_scripts();\r\n  }\r\n}\r\n\r\nFileHeader.STRUCT = `\r\nsimple.FileHeader {\r\n  magic         : static_string[4];\r\n  version_major : short;\r\n  version_minor : short;\r\n  version_micro : short;\r\n  flags         : short;\r\n  schema        : string; \r\n}\r\n`;\r\nnstructjs.register(FileHeader);\r\n\r\nexport class FileFull extends FileHeader {\r\n  constructor(version, magic, flags) {\r\n    super(version, magic, flags);\r\n    this.objects = [];\r\n  }\r\n}\r\n\r\nFileFull.STRUCT = nstructjs.inherit(FileFull, FileHeader) + `\r\n  objects : array(abstract(Object));\r\n  screen  : abstract(Object);\r\n}\r\n`;\r\nnstructjs.register(FileFull);\r\n\r\n\r\nexport class FileArgs {\r\n  constructor(args = {}) {\r\n    this.ext = args.ext || \".data\";\r\n    this.magic = args.magic || \"STRT\";\r\n    this.doScreen = args.doScreen !== undefined ? args.doScreen : true;\r\n    this.resetOnLoad = args.resetOnLoad !== undefined ? args.resetOnLoad : true;\r\n    this.useJSON = args.useJSON !== undefined ? args.useJSON : false;\r\n    this.version = args.version !== undefined ? args.version : 0;\r\n    this.fileFlags = args.fileFlags !== undefined ? args.fileFlags : 0;\r\n    this.fromFileOp = false; /* SimpleSaveOp and SimpleOpenOp set this to true */\r\n  }\r\n}\r\n\r\nexport class EmptyStruct {\r\n\r\n}\r\nEmptyStruct.STRUCT = `\r\nEmptyStruct {\r\n}\r\n`;\r\nnstructjs.register(EmptyStruct);\r\n\r\nexport function saveFile(appstate, args, objects) {\r\n  if (args.useJSON === undefined) {\r\n    args.useJSON = appstate.saveFilesInJSON;\r\n  }\r\n\r\n  args = new FileArgs(args);\r\n\r\n  let version = args.version;\r\n  if (typeof version === \"number\") {\r\n    if (version === Math.floor(version)) {\r\n      version = [version, 0, 0];\r\n    } else {\r\n      let major = ~~version;\r\n      let minor = ~~(Math.fract(version)*10.0);\r\n      let micro = (Math.fract(version) - minor) * 100.0;\r\n\r\n      version = [major, minor, micro];\r\n    }\r\n  }\r\n\r\n  let file = new FileFull(version, args.magic, args.fileFlags);\r\n\r\n  if (args.doScreen) {\r\n    file.screen = appstate.screen;\r\n  } else {\r\n    file.screen = new EmptyStruct();\r\n  }\r\n\r\n  for (let ob of objects) {\r\n    file.objects.push(ob);\r\n  }\r\n\r\n  if (args.useJSON) {\r\n    return nstructjs.writeJSON(file);\r\n  } else {\r\n    let data = [];\r\n    nstructjs.writeObject(data, file);\r\n    return (new Uint8Array(data)).buffer;\r\n  }\r\n}\r\n\r\nexport function loadFile(appstate, args, data) {\r\n  let header;\r\n\r\n  if (args.useJSON === undefined) {\r\n    args.useJSON = appstate.saveFilesInJSON;\r\n  }\r\n\r\n  args = new FileArgs(args);\r\n\r\n  if (!args.useJSON) {\r\n    if (data instanceof Array) {\r\n      data = (new Uint8Array(data)).buffer;\r\n    }\r\n\r\n    if (data instanceof Uint8Array) {\r\n      data = data.buffer;\r\n    }\r\n\r\n    if (data instanceof ArrayBuffer) {\r\n      data = new DataView(data);\r\n    }\r\n\r\n    header = nstructjs.readObject(data, FileHeader);\r\n  } else {\r\n    if (typeof data === \"string\") {\r\n      data = JSON.parse(data);\r\n    }\r\n\r\n    header = nstructjs.readJSON(data, FileHeader);\r\n  }\r\n\r\n  if (header.magic !== args.magic) {\r\n    throw new Error(\"invalid file\");\r\n  }\r\n\r\n  let istruct = new nstructjs.STRUCT();\r\n  istruct.parse_structs(header.schema);\r\n\r\n  let ret;\r\n\r\n  if (!args.useJSON) {\r\n    ret = istruct.readObject(data, FileFull);\r\n  } else {\r\n    ret = istruct.readJSON(data, FileFull);\r\n  }\r\n\r\n  if (args.resetOnLoad) {\r\n    appstate.reset();\r\n  }\r\n\r\n  if (args.doScreen) {\r\n    if (appstate.screen) {\r\n      appstate.screen.unlisten();\r\n      appstate.screen.remove();\r\n    }\r\n\r\n    ret.screen.ctx = appstate.ctx;\r\n\r\n    if (!(ret.screen instanceof appstate.screenClass)) {\r\n      let screen = UIBase.createElement(appstate.screenClass.define().tagname);\r\n      screen.ctx = appstate.ctx;\r\n\r\n      for (let sarea of ret.screen.sareas) {\r\n        screen.appendChild(sarea);\r\n\r\n        sarea.area.afterSTRUCT();\r\n        sarea.area.on_fileload();\r\n      }\r\n\r\n      ret.screen = screen;\r\n    }\r\n\r\n    appstate.screen = ret.screen;\r\n\r\n    document.body.appendChild(appstate.screen);\r\n    appstate.screen.listen();\r\n  }\r\n\r\n  return ret;\r\n}","import {Editor} from './editor.js';\r\nimport {UIBase} from '../core/ui_base.js';\r\nimport {nstructjs} from '../path-controller/controller.js';\r\nimport {AreaFlags} from '../screen/ScreenArea.js';\r\n\r\n/** see ./editor.js:Editor.registerAppMenu */\r\n\r\nexport class MenuBarEditor extends Editor {\r\n  constructor() {\r\n    super();\r\n\r\n    this.updateHeight();\r\n    this.borderLock = 1 | 2 | 4 | 8;\r\n    this.areaDragToolEnabled = false;\r\n\r\n    this._height = 25;\r\n\r\n    this.needsRebuild = false;\r\n  }\r\n\r\n  get height() {\r\n    return this._height;\r\n  }\r\n\r\n  set height(v) {\r\n    this._height = v;\r\n    this.updateHeight();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname : \"simple-menu-editor-x\",\r\n      areaname: \"menu\",\r\n      uiname  : \"Menu Bar\",\r\n      icon    : -1,\r\n      //hide in editor list\r\n      flag    : AreaFlags.HIDDEN | AreaFlags.NO_HEADER_CONTEXT_MENU | AreaFlags.NO_COLLAPSE | AreaFlags.NO_SWITCHER\r\n    }\r\n  }\r\n\r\n  updateHeight(force = false) {\r\n    if (!this.header)\r\n      return;\r\n\r\n    if (window.haveElectron) {\r\n      this.maxSize[1] = this.minSize[1] = 1;\r\n      electron_api.initMenuBar(this);\r\n      return;\r\n    }\r\n\r\n    if (this._height === undefined) {\r\n      let rect = this.header.getClientRects()[0];\r\n\r\n      if (rect) {\r\n        this._height = rect.height;\r\n      }\r\n    }\r\n\r\n    let update = force || this._height !== this.minSize[1];\r\n    this.minSize[1] = this.maxSize[1] = this._height;\r\n\r\n    if (update && this.ctx && this.getScreen()) {\r\n      this.getScreen().solveAreaConstraints();\r\n    }\r\n  }\r\n\r\n  makeMenuBar(container) {\r\n    if (Editor.makeMenuBar) {\r\n      Editor.makeMenuBar(this.ctx, container, this);\r\n    }\r\n  }\r\n\r\n  flagRebuild() {\r\n    this.needsRebuild = true;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.background = this.getDefault(\"AreaHeaderBG\");\r\n\r\n    this.menuRow = this.header.row();\r\n    this.makeMenuBar(this.menuRow);\r\n\r\n    this.doOnce(() => {\r\n      if (window.haveElectron) {\r\n        this.height = 1;\r\n        electron_api.initMenuBar(this);\r\n      }\r\n    });\r\n\r\n    this.updateHeight(true);\r\n    this.flushUpdate();\r\n  }\r\n\r\n  rebuild() {\r\n    this.needsRebuild = false;\r\n\r\n    this.menuRow.clear();\r\n    this.makeMenuBar(this.menuRow);\r\n    this.flushUpdate();\r\n  }\r\n\r\n  update() {\r\n    if (this.needsRebuild) {\r\n      this.rebuild();\r\n    }\r\n  }\r\n}\r\n\r\nMenuBarEditor.STRUCT = nstructjs.inherit(MenuBarEditor, Editor, \"MenuBarEditor\") + `\r\n}\r\n`;\r\n\r\nexport function registerMenuBarEditor() {\r\n  Editor.register(MenuBarEditor);\r\n}\r\n","import * as platform from '../platforms/platform.js';\r\n\r\nimport {ToolOp, UndoFlags} from '../path-controller/toolsys/toolsys.js';\r\nimport {ToolProperty, BoolProperty, StringProperty} from '../path-controller/toolsys/toolprop.js';\r\n\r\nimport {sendNote, error, warning, message} from '../widgets/ui_noteframe.js';\r\n\r\nexport class SimpleAppNewOp extends ToolOp {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : \"New\",\r\n      toolpath: \"app.new\",\r\n      inputs  : {},\r\n      undoflag: UndoFlags.NO_UNDO\r\n    }\r\n  }\r\n\r\n  exec(ctx) {\r\n    _appstate.createNewFile();\r\n  }\r\n}\r\n\r\nexport class SimpleAppSaveOp extends ToolOp {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : \"Save\",\r\n      toolpath: \"app.save\",\r\n      inputs  : {\r\n        forceDialog: new BoolProperty()\r\n      },\r\n      undoflag: UndoFlags.NO_UNDO\r\n    }\r\n  }\r\n\r\n  exec(ctx) {\r\n    let ext = _appstate.fileExt;\r\n    let useJSON = _appstate.startArgs.saveFilesInJSON;\r\n\r\n    _appstate.saveFile({\r\n      doScreen  : true,\r\n      useJSON,\r\n      fromFileOp: true\r\n    }).then(data => {\r\n\r\n      function save() {\r\n        return data;\r\n      }\r\n\r\n      platform.platform.showSaveDialog(\"Save As\", save, {\r\n        multi          : false,\r\n        addToRecentList: true,\r\n        filters        : [{\r\n          name      : \"File\",\r\n          mime      : useJSON ? \"text/json\" : \"application/x-octet-stream\",\r\n          extensions: [\".\" + ext.toLowerCase()]\r\n        }]\r\n      }).then(path => {\r\n        _appstate.currentFileRef = path;\r\n        message(\"File saved\");\r\n      }).catch(err => {\r\n        if (typeof err === \"object\" && err.message) {\r\n          err = err.message;\r\n        }\r\n\r\n        error(\"Failed to save file \" + err);\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\nexport class SimpleAppOpenOp extends ToolOp {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : \"Open\",\r\n      toolpath: \"app.open\",\r\n      inputs  : {\r\n        forceDialog: new BoolProperty()\r\n      },\r\n      undoflag: UndoFlags.NO_UNDO\r\n    }\r\n  }\r\n\r\n  exec(ctx) {\r\n    let ext = _appstate.fileExt;\r\n    let useJSON = _appstate.startArgs.saveFilesInJSON;\r\n    let mime = useJSON ? \"text/json\" : \"application/x-octet-stream\";\r\n\r\n    platform.platform.showOpenDialog(\"Open File\", {\r\n      multi          : false,\r\n      addToRecentList: true,\r\n      filters        : [{\r\n        name      : \"File\",\r\n        mime,\r\n        extensions: [\".\" + ext.toLowerCase()]\r\n      }]\r\n    }).then(paths => {\r\n      for (let path of paths) {\r\n        platform.platform.readFile(path, mime).then(data => {\r\n          console.log(\"got data!\", data);\r\n\r\n          _appstate.loadFile(data, {useJSON, doScreen: true, fromFileOp: true})\r\n            .catch(err => {\r\n              error(\"File error: \" + err.message);\r\n            });\r\n        });\r\n      }\r\n    }).catch(error => {\r\n      ctx.error(error.message);\r\n    })\r\n  }\r\n}\r\n\r\nexport function register() {\r\n  ToolOp.register(SimpleAppSaveOp);\r\n  ToolOp.register(SimpleAppOpenOp);\r\n  ToolOp.register(SimpleAppNewOp);\r\n}\r\n","import nstructjs from '../path-controller/util/struct.js';\r\nimport {Context, ContextOverlay, makeDerivedOverlay} from '../path-controller/controller/context.js';\r\n\r\nexport const DataModelClasses = [];\r\nimport {ToolStack} from '../path-controller/toolsys/toolsys.js';\r\nimport {DataAPI} from '../path-controller/controller/controller.js';\r\nimport {Screen} from '../screen/FrameManager.js';\r\nimport {areaclasses} from '../screen/area_wrangler.js';\r\nimport * as util from '../util/util.js';\r\nimport {Editor} from './editor.js';\r\n\r\nimport {Vector2} from '../path-controller/util/vectormath.js';\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nexport class DataModel {\r\n  static defineAPI(api, strct) {\r\n    return strct;\r\n  }\r\n\r\n  static register(cls) {\r\n    if (!cls.hasOwnProperty(\"defineAPI\")) {\r\n      //  throw new Error(cls.name + \"is missing a defineAPI method\");\r\n    }\r\n\r\n    DataModelClasses.push(cls);\r\n\r\n    if (cls.hasOwnProperty(\"STRUCT\")) {\r\n      nstructjs.register(cls);\r\n    }\r\n  }\r\n}\r\n\r\nclass EmptyContextClass extends Context {\r\n  static defineAPI(api, strct) {\r\n  }\r\n}\r\n\r\nimport * as ui_noteframe from '../widgets/ui_noteframe.js';\r\n\r\n/**\r\n * Extend the client-provided context class\r\n * with a few standard methods and properties\r\n *\r\n * */\r\nfunction GetContextClass(ctxClass) {\r\n  let ok = 0;\r\n  let cls = ctxClass;\r\n  while (cls) {\r\n    if (cls === Context) {\r\n      ok = 1;\r\n    } else if (cls === ContextOverlay) {\r\n      ok = 2;\r\n    }\r\n\r\n    cls = cls.__proto__;\r\n  }\r\n\r\n  if (ok === 1) {\r\n    return ctxClass;\r\n  }\r\n\r\n  let OverlayDerived;\r\n\r\n  if (ok === 2) {\r\n    OverlayDerived = ctxClass;\r\n  } else {\r\n    OverlayDerived = makeDerivedOverlay(ctxClass);\r\n  }\r\n\r\n  class Overlay extends OverlayDerived {\r\n    constructor(state) {\r\n      super(state);\r\n    }\r\n\r\n    get screen() {\r\n      return this.state.screen;\r\n    }\r\n\r\n    get api() {\r\n      return this.state.api;\r\n    }\r\n\r\n    get toolstack() {\r\n      return this.state.toolstack;\r\n    }\r\n\r\n    message(msg, timeout = 2500) {\r\n      return ui_noteframe.message(this.screen, msg, timeout);\r\n    }\r\n\r\n    error(msg, timeout = 2500) {\r\n      return ui_noteframe.error(this.screen, msg, timeout);\r\n    }\r\n\r\n    warning(msg, timeout = 2500) {\r\n      return ui_noteframe.warning(this.screen, msg, timeout);\r\n    }\r\n\r\n    progressBar(msg, percent, color, timeout = 1000) {\r\n      return ui_noteframe.progbarNote(this.screen, msg, percent, color, timeout);\r\n    }\r\n  }\r\n\r\n  Context.register(Overlay);\r\n\r\n  return class ContextDerived extends Context {\r\n    constructor(state) {\r\n      super(state);\r\n\r\n      this.pushOverlay(new Overlay(state))\r\n    }\r\n\r\n    static defineAPI(api, st) {\r\n      return Overlay.defineAPI(api, st);\r\n    }\r\n  }\r\n}\r\n\r\nexport function makeAPI(ctxClass) {\r\n  let api = new DataAPI();\r\n\r\n  for (let cls of DataModelClasses) {\r\n    if (cls.defineAPI) {\r\n      cls.defineAPI(api, api.mapStruct(cls, true));\r\n    }\r\n  }\r\n\r\n  for (let k in areaclasses) {\r\n    areaclasses[k].defineAPI(api, api.mapStruct(areaclasses[k], true));\r\n  }\r\n\r\n  if (ctxClass.defineAPI) {\r\n    ctxClass.defineAPI(api, api.mapStruct(ctxClass, true));\r\n  } else {\r\n    throw new Error(\"Context class should have a defineAPI static method\");\r\n  }\r\n\r\n  api.rootContextStruct = api.mapStruct(ctxClass, api.mapStruct(ctxClass, true));\r\n\r\n  return api;\r\n}\r\n\r\nimport {Icons, loadDefaultIconSheet} from './icons.js';\r\nimport {IconManager, setIconManager, setIconMap, setTheme, UIBase} from '../core/ui_base.js';\r\nimport {FileArgs, loadFile, saveFile} from './file.js';\r\nimport {HotKey, KeyMap} from '../path-controller/util/simple_events.js';\r\nimport {initSplineTemplates} from '../path-controller/curve/curve1d_bspline.js';\r\nimport {MenuBarEditor, registerMenuBarEditor} from './menubar.js';\r\nimport {register} from './app_ops.js';\r\n\r\nexport class StartArgs {\r\n  constructor() {\r\n    this.singlePage = true;\r\n\r\n    this.icons = Icons;\r\n    this.iconsheet = undefined; //will default to loadDefaultIconSheet();\r\n    this.iconSizes = [16, 24, 32, 48];\r\n    this.iconTileSize = 32;\r\n    this.iconsPerRow = 16;\r\n    this.theme = undefined; //see scripts/core/theme.js\r\n\r\n    this.registerSaveOpenOps = true;\r\n\r\n    this.autoLoadSplineTemplates = true;\r\n    this.showPathsInToolTips = true;\r\n    this.enableThemeAutoUpdate = false;\r\n    this.addHelpPickers = false;\r\n    this.useNumSliderTextboxes = true;\r\n    this.numSliderArrowLimit = cconst.numSliderArrowLimit;\r\n    this.simpleNumSliders = cconst.simpleNumSliders;\r\n  }\r\n}\r\n\r\nexport class SimpleScreen extends Screen {\r\n  constructor() {\r\n    super();\r\n\r\n    this.keymap = new KeyMap([\r\n      new HotKey(\"Z\", [\"CTRL\"], () => {\r\n        this.ctx.toolstack.undo(this.ctx);\r\n      }),\r\n      new HotKey(\"Z\", [\"CTRL\", \"SHIFT\"], () => {\r\n        this.ctx.toolstack.redo(this.ctx);\r\n      }),\r\n    ])\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"simple-screen-x\"\r\n    }\r\n  }\r\n\r\n  init() {\r\n    if (this.ctx.state.startArgs.registerSaveOpenOps) {\r\n      this.keymap.add(new HotKey(\"S\", [\"CTRL\"], \"app.save()\"));\r\n      this.keymap.add(new HotKey(\"O\", [\"CTRL\"], \"app.open()\"));\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.style[\"position\"] = UIBase.PositionKey;\r\n    this.style[\"left\"] = this.pos[0] + \"px\";\r\n    this.style[\"top\"] = this.pos[1] + \"px\";\r\n  }\r\n}\r\n\r\nUIBase.register(SimpleScreen);\r\n\r\nexport class AppState {\r\n  /** ctxClass is the context class.  It can be either a simple class\r\n   *  or a subclass of the more complex path.ux Context class.  Note that\r\n   *  using Context will avoid subtle undo stack errors caused by the context\r\n   *  changing after a tool is run (this is why Context has a serialization\r\n   *  mechanism).\r\n   *\r\n   *  Path.ux will actually subclass ctxClass and add a few standard methods\r\n   *  and properties, see GetContextClass.*/\r\n  constructor(ctxClass, screenClass = SimpleScreen) {\r\n    this._ctxClass = ctxClass;\r\n\r\n    ctxClass = GetContextClass(ctxClass);\r\n\r\n    this.startArgs = undefined;\r\n    this.currentFileRef = undefined; //current file path/ref\r\n\r\n    this.ctx = new ctxClass(this);\r\n    this.ctx._state = this;\r\n    this.toolstack = new ToolStack();\r\n    this.api = makeAPI(ctxClass);\r\n    this.screenClass = screenClass;\r\n    this.screen = undefined;\r\n\r\n    this.fileMagic = \"STRT\";\r\n    this.fileVersion = [0, 0, 1];\r\n    this._fileExt = \"data\";\r\n    this._fileExtSet = false;\r\n    this.saveFilesInJSON = false; /* save files in nstructjs-json */\r\n\r\n    this.defaultEditorClass = undefined; //if undefined, the first non-menubar editor will be used\r\n  }\r\n\r\n\r\n  get fileExt() {\r\n    return this._fileExt;\r\n  }\r\n\r\n  set fileExt(ext) {\r\n    this._fileExt = ext;\r\n    this._fileExtSet = true;\r\n  }\r\n\r\n  /** resets the undo stack */\r\n  reset() {\r\n    this.toolstack.reset();\r\n  }\r\n\r\n  /** Create a new file. See this.makeScreen() if you wish\r\n   *  to create a new screen at this time, and this.reset()\r\n   *  if you wish to reset the undo stack*/\r\n  createNewFile() {\r\n    console.warn(\"appstate.createNewFile: implement me, using default hack\");\r\n    let state = new this.constructor(this.ctx._ctxClass);\r\n\r\n    state.api = this.api;\r\n    state.ctx = this.ctx;\r\n    state.startArgs = this.startArgs;\r\n    state.saveFilesInJSON = this.saveFilesInJSON;\r\n\r\n    state.toolstack = this.toolstack;\r\n    state.toolstack.reset();\r\n\r\n    this.screen.unlisten();\r\n    this.screen.remove();\r\n\r\n    for (let k in state) {\r\n      this[k] = state[k];\r\n    }\r\n\r\n    this.makeScreen();\r\n  }\r\n\r\n  saveFileSync(objects, args = {}) {\r\n    args = new FileArgs(Object.assign({\r\n      magic  : this.fileMagic,\r\n      version: this.fileVersion,\r\n      ext    : this.fileExt\r\n    }, args));\r\n\r\n    return saveFile(this, args, objects);\r\n  }\r\n\r\n  /** Serialize the application state. Takes\r\n   *  a list of objects to save (with nstructjs);\r\n   *  Subclasses should override this, like so:\r\n   *\r\n   *  saveFile(args={}) {\r\n   *    let objects = app state;\r\n   *    return super.saveFile(objects, args);\r\n   *  }\r\n   **/\r\n  saveFile(objects, args = {}) {\r\n    args = new FileArgs(Object.assign({\r\n      magic  : this.fileMagic,\r\n      version: this.fileVersion,\r\n      ext    : this.fileExt\r\n    }, args));\r\n\r\n    return new Promise((accept, reject) => {\r\n      accept(this.saveFileSync(objects, args));\r\n    });\r\n  }\r\n\r\n  loadFileSync(data, args = {}) {\r\n    args = new FileArgs(Object.assign({\r\n      magic  : this.fileMagic,\r\n      version: this.fileVersion,\r\n      ext    : this.fileExt\r\n    }, args));\r\n\r\n    let ret = loadFile(this, args, data);\r\n\r\n    if (args.doScreen) {\r\n      try {\r\n        this.ensureMenuBar();\r\n      } catch (error) {\r\n        console.error(error.stack);\r\n        console.error(error.message);\r\n        console.error(\"Failed to add menu bar\");\r\n      }\r\n\r\n      this.screen.completeSetCSS();\r\n      this.screen.completeUpdate();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   *  Loads a new file. The default behavior is a\r\n   *  complete state reset (you can control this\r\n   *  with args.reset_toolstack, args.reset_context\r\n   *  and args.doScreen).\r\n   *\r\n   *  As the base class cannot know just what to do\r\n   *  with the loaded data (the objects parameter\r\n   *  passed to saveFile) it is recommended you\r\n   *  override this function like so:\r\n   *\r\n   *  loadFile(data, args) {\r\n   *    return super.loadFile(data, args).then(fileData) => {\r\n   *      // load fileData.objects into appropriate properties\r\n   *      // this is the same objects array originally passed\r\n   *      // to this.saveFile\r\n   *      this.data = fileData.objects;\r\n   *    });\r\n   *  }\r\n   *\r\n   *  @param {ArrayBuffer|JSON|DataView} data\r\n   *  @param {FileArgs} args\r\n   *  */\r\n  loadFile(data, args = {}) {\r\n    return new Promise((accept, reject) => {\r\n      accept(this.loadFileSync(data, args));\r\n    });\r\n  }\r\n\r\n  ensureMenuBar() {\r\n    let screen = this.screen;\r\n    let ok = false;\r\n\r\n    for (let sarea of screen.sareas) {\r\n      if (sarea.area instanceof MenuBarEditor) {\r\n        ok = true;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (ok) {\r\n      return;\r\n    }\r\n\r\n    if (!Editor.makeMenuBar) {\r\n      /* don't make menu bar if Editor.registerAppMenu hasn't been called */\r\n      return;\r\n    }\r\n\r\n    /* ensure screen size is up to date */\r\n    screen.update();\r\n\r\n    let sarea = UIBase.createElement(\"screenarea-x\");\r\n\r\n    screen.appendChild(sarea);\r\n\r\n    let h = 55;\r\n    let min = new Vector2().addScalar(1e17);\r\n    let max = new Vector2().addScalar(-1e17);\r\n    let tmp = new Vector2();\r\n\r\n    for (let sarea2 of screen.sareas) {\r\n      if (sarea2 === sarea) {\r\n        continue;\r\n      }\r\n\r\n      min.min(sarea2.pos);\r\n      tmp.load(sarea2.pos).add(sarea2.size);\r\n      max.max(tmp);\r\n    }\r\n\r\n    let scale = (max[1] - min[1] - h)/(max[1] - min[1]);\r\n\r\n    for (let sarea2 of screen.sareas) {\r\n      if (sarea2 === sarea) {\r\n        continue;\r\n      }\r\n\r\n      sarea2.pos[1] *= scale;\r\n      sarea2.size[1] *= scale;\r\n      sarea2.pos[1] += h;\r\n    }\r\n\r\n    sarea.pos.zero();\r\n    sarea.size[0] = screen.size[0];\r\n    sarea.size[1] = h;\r\n\r\n    screen.regenScreenMesh();\r\n    screen.snapScreenVerts();\r\n\r\n    sarea.switch_editor(MenuBarEditor);\r\n\r\n    screen.solveAreaConstraints();\r\n\r\n    screen.completeSetCSS();\r\n    screen.completeUpdate();\r\n  }\r\n\r\n  makeScreen() {\r\n    if (this.screen) {\r\n      this.screen.unlisten();\r\n      this.screen.remove();\r\n    }\r\n\r\n    let screen = this.screen = UIBase.createElement(this.screenClass.define().tagname);\r\n    let sarea = UIBase.createElement(\"screenarea-x\");\r\n\r\n    screen.ctx = this.ctx;\r\n    sarea.ctx = this.ctx;\r\n\r\n    document.body.appendChild(screen);\r\n\r\n    let cls = this.defaultEditorClass;\r\n\r\n    if (!cls) {\r\n      for (let k in areaclasses) {\r\n        cls = areaclasses[k];\r\n\r\n        if (cls !== MenuBarEditor) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    sarea.switch_editor(cls);\r\n    screen.appendChild(sarea);\r\n\r\n    screen._init();\r\n    screen.listen();\r\n    screen.update();\r\n    screen.completeSetCSS();\r\n    screen.completeUpdate();\r\n\r\n    if (Editor.makeMenuBar) {\r\n      this.ensureMenuBar();\r\n    }\r\n  }\r\n\r\n  start(args = new StartArgs()) {\r\n    let args2 = new StartArgs();\r\n\r\n    let methodsCheck = [\r\n      \"saveFile\", \"createNewFile\", \"loadFile\"\r\n    ];\r\n\r\n    for (let method of methodsCheck) {\r\n      let m1 = AppState.prototype[method];\r\n      let m2 = this[method];\r\n\r\n      if (m1 === m2) {\r\n        console.warn(`Warning: it is recommended to override .${method} when subclassing simple.AppState`);\r\n      }\r\n    }\r\n\r\n    document.body.style[\"touch-action\"] = \"none\";\r\n\r\n    registerMenuBarEditor();\r\n\r\n    for (let k in args2) {\r\n      if (args[k] === undefined) {\r\n        args[k] = args2[k];\r\n      }\r\n    }\r\n\r\n    if (args.registerSaveOpenOps) {\r\n      register();\r\n    }\r\n\r\n    if (!args.iconsheet) {\r\n      args.iconsheet = loadDefaultIconSheet();\r\n    }\r\n\r\n    this.startArgs = args;\r\n\r\n    cconst.loadConstants(args);\r\n\r\n    if (args.autoLoadSplineTemplates) {\r\n      initSplineTemplates();\r\n    }\r\n\r\n    let sizes = [];\r\n    let images = [];\r\n\r\n    for (let size of args.iconSizes) {\r\n      sizes.push([args.iconTileSize, size]);\r\n      images.push(args.iconsheet);\r\n    }\r\n\r\n    window.iconsheet = args.iconsheet;\r\n\r\n\r\n    let iconManager = new IconManager(images, sizes, args.iconsPerRow);\r\n    setIconManager(iconManager);\r\n    setIconMap(args.icons);\r\n\r\n    if (args.theme) {\r\n      setTheme(args.theme);\r\n    }\r\n\r\n    document.body.style[\"margin\"] = \"0px\";\r\n    document.body.style[\"padding\"] = \"0px\";\r\n\r\n    if (args.singlePage) {\r\n      document.body.style[\"overflow\"] = \"hidden\";\r\n    }\r\n\r\n    this.makeScreen();\r\n\r\n    Object.defineProperty(window, \"C\", {\r\n      get() {\r\n        return this._appstate.ctx;\r\n      }\r\n    });\r\n\r\n    nstructjs.validateStructs();\r\n\r\n    if (this.saveFilesInJSON && !this._fileExtSet) {\r\n      this._fileExt = \"json\";\r\n    }\r\n\r\n    if (this._fileExt.startsWith(\".\")) {\r\n      this._fileExt = this._fileExt.slice(1, this._fileExt.length).trim();\r\n    }\r\n  }\r\n}\r\n","\r\nexport class SimpleContext {\r\n  constructor() {\r\n\r\n  }\r\n\r\n  static getContextClass() {\r\n    let props = {};\r\n\r\n    let rec = (cls) => {\r\n      let prototype = cls.prototype;\r\n\r\n      if (cls.__proto__ !== Object.__proto__) {\r\n        rec(cls);\r\n      }\r\n\r\n      for (let k in cls) {\r\n        let descr = Object.getOwnPropertyDescriptor(prototype, k);\r\n\r\n        if (descr) {\r\n          props[k] = descr;\r\n        }\r\n      }\r\n    }\r\n\r\n    console.log(props);\r\n\r\n    for (let k in props) {\r\n      if (k.search(\"_save\") >= 0 || k.search(\"_load\") >= 0) {\r\n        continue;\r\n      }\r\n\r\n    }\r\n  }\r\n}","import {PlatformAPI, isMimeText} from '../platform_base.js';\r\nimport {saveFile, loadFile} from '../../path-controller/util/html5_fileapi.js';\r\n\r\nimport {FileDialogArgs, FilePath} from '../platform_base.js';\r\n\r\nimport {mimeMap} from '../platform_base.js';\r\n\r\nexport function getWebFilters(filters=[]) {\r\n  let types = [];\r\n\r\n  for (let item of filters) {\r\n    let mime = item.mime;\r\n    let exts = [];\r\n\r\n    for (let ext of item.extensions) {\r\n      ext = \".\" + ext;\r\n      if (ext.toLowerCase() in mimeMap) {\r\n        mime = mime !== undefined ? mime : mimeMap[ext.toLowerCase()];\r\n      }\r\n\r\n      exts.push(ext);\r\n    }\r\n\r\n    if (!mime) {\r\n      mime = \"application/x-octet-stream\";\r\n    }\r\n\r\n    types.push({\r\n      description: item.name,\r\n      accept     : {\r\n        [mime]: exts\r\n      }\r\n    });\r\n  }\r\n\r\n  return types;\r\n}\r\n\r\nexport class platform extends PlatformAPI {\r\n  //returns a promise\r\n  static showOpenDialog(title, args = new FileDialogArgs()) {\r\n    let types = getWebFilters(args.filters);\r\n\r\n    return new Promise((accept, reject) => {\r\n      try {\r\n        window.showOpenFilePicker({\r\n          multiple: args.multi,\r\n          types\r\n        }).then(arg => {\r\n          let paths = [];\r\n\r\n          for (let file of arg) {\r\n            paths.push(new FilePath(file, file.name));\r\n          }\r\n\r\n          accept(paths);\r\n        });\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n    });\r\n    /*\r\n    let exts = [];\r\n\r\n    for (let list of args.filters) {\r\n      for (let ext of list.extensions) {\r\n        exts.push(ext);\r\n      }\r\n    }\r\n\r\n    return new Promise((accept, reject) => {\r\n      loadFile(args.defaultPath, exts).then((file) => {\r\n        accept([new FilePath(file)]);\r\n      });\r\n    });*/\r\n  }\r\n\r\n  static writeFile(data, handle, mime) {\r\n    handle = handle.data;\r\n\r\n    return handle.createWritable().then((file) => {\r\n      file.write(data);\r\n      file.close();\r\n    });\r\n  }\r\n\r\n  static showSaveDialog(title, savedata_cb, args = new FileDialogArgs()) {\r\n    if (!window.showSaveFilePicker) {\r\n      return this.showSaveDialog_old(...arguments);\r\n    }\r\n\r\n    let types = getWebFilters(args.filters);\r\n\r\n    return new Promise((accept, reject) => {\r\n      let fname;\r\n      let saveHandle;\r\n\r\n      try {\r\n        saveHandle = window.showSaveFilePicker({types});\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n\r\n      let handle;\r\n\r\n      saveHandle.then((handle1) => {\r\n        handle = handle1;\r\n\r\n        fname = handle.name;\r\n        console.log(\"saveHandle\", handle);\r\n        return handle.createWritable();\r\n      }).then((file) => {\r\n        let savedata = savedata_cb();\r\n\r\n        if (savedata instanceof Uint8Array || savedata instanceof DataView) {\r\n          savedata = savedata.buffer;\r\n        }\r\n\r\n        file.write(savedata);\r\n        file.close();\r\n\r\n        let path = new FilePath(handle, fname);\r\n        accept(path);\r\n      });\r\n    });\r\n  }\r\n\r\n  //returns a promise\r\n  static showSaveDialog_old(title, savedata, args = new FileDialogArgs()) {\r\n\r\n    let exts = [];\r\n\r\n    for (let list of args.filters) {\r\n      if (!Array.isArray(list) && list.filters) {\r\n        list = list.filters;\r\n      }\r\n\r\n      for (let ext of list) {\r\n        exts.push(ext);\r\n      }\r\n    }\r\n\r\n    return new Promise((accept, reject) => {\r\n      saveFile(savedata);\r\n\r\n      window.setTimeout(() => {\r\n        accept(\"undefined\");\r\n      });\r\n    });\r\n  }\r\n\r\n  //path is a FilePath instance, for web this is the actual file data\r\n  static readFile(path, mime = \"\") {\r\n    if (mime === \"\") {\r\n      mime = path.filename;\r\n      let i = mime.length-1;\r\n\r\n      while (i > 0 && mime[i] !== \".\") {\r\n        i--;\r\n      }\r\n\r\n      mime = mime.slice(i, mime.length).trim().toLowerCase();\r\n      if (mime in mimeMap) {\r\n        mime = mimeMap[mime];\r\n      }\r\n    }\r\n\r\n    return new Promise((accept, reject) => {\r\n      path.data.getFile().then((file) => {\r\n        console.log(\"file!\", file);\r\n\r\n        let promise;\r\n\r\n        if (isMimeText(mime)) {\r\n          promise = file.text();\r\n        } else {\r\n          promise = file.arrayBuffer();\r\n        }\r\n\r\n        promise.then(data => {\r\n          accept(data);\r\n        });\r\n      });\r\n    });\r\n\r\n    return new Promise((accept, reject) => {\r\n      let data = path.data;\r\n\r\n      if (isMimeText(mime)) {\r\n        let s = '';\r\n        data = new Uint8Array(data);\r\n\r\n        for (let i = 0; i < data.length; i++) {\r\n          s += String.fromCharCode(data[i]);\r\n        }\r\n\r\n        data = s;\r\n      }\r\n\r\n      accept(data);\r\n    });\r\n  }\r\n}\r\n","import './path-controller/util/polyfill.js';\r\n\r\nexport * from './xmlpage/xmlpage.js';\r\n\r\nexport * from './core/ui_base.js';\r\nexport * from './core/ui.js';\r\nexport * from './widgets/ui_widgets.js';\r\nexport * from './widgets/ui_widgets2.js';\r\nexport * from './core/ui_theme.js';\r\nexport * from './core/units.js';\r\nexport * from './widgets/ui_button.js';\r\nexport * from './widgets/ui_richedit.js';\r\nexport * from './widgets/ui_curvewidget.js';\r\nexport * from './widgets/ui_panel.js';\r\nexport * from './widgets/ui_colorpicker2.js';\r\nexport * from './widgets/ui_tabs.js';\r\nexport * from './widgets/ui_listbox.js';\r\nexport * from './widgets/ui_menu.js';\r\nexport * from './widgets/ui_progress.js';\r\nexport * from './widgets/ui_table.js';\r\nexport * from './widgets/ui_noteframe.js';\r\nexport * from './widgets/ui_numsliders.js';\r\nexport * from './widgets/ui_lasttool.js';\r\nexport * from './widgets/ui_textbox.js';\r\nexport * from './path-controller/util/graphpack.js';\r\n//export * from './docbrowser/docbrowser.js';\r\n\r\nexport * from './path-controller/util/html5_fileapi.js';\r\nexport * from './path-controller/controller.js';\r\n\r\nimport * as controller from './path-controller/controller.js';\r\n\r\nexport {controller};\r\n\r\nimport * as ui_noteframe from './widgets/ui_noteframe.js';\r\n\r\ncontroller.setNotifier(ui_noteframe);\r\n\r\nexport {\r\n  PlatformAPI, getMime, isMimeText, mimeMap, textMimes, FileDialogArgs, FilePath\r\n} from './platforms/platform_base.js';\r\n\r\nimport * as platform from './platforms/platform.js';\r\n\r\nexport {platform};\r\n\r\nimport * as electron_api from './platforms/electron/electron_api.js';\r\n\r\nexport {electron_api};\r\n\r\nexport * from './widgets/theme_editor.js';\r\nexport * from './widgets/ui_treeview.js';\r\n\r\nexport * from './screen/FrameManager.js';\r\nexport * from './screen/ScreenArea.js';\r\nexport * from './util/ScreenOverdraw.js';\r\n\r\nimport cconst from './config/const.js';\r\n\r\nexport {cconst};\r\n\r\nimport * as simple from './simple/simple.js';\r\n\r\nexport {simple};\r\n"],"names":["window","global","visitgen","destroyAllCSS","visit","n","__visit","tagName","textContents","style","k","error","childNodes","c","document","head","body","sheet","styleSheets","i","rules","length","removeRule","eventDebugModule","start","debugEventLists","debugEventList","this","_addEventListener","EventTarget","prototype","addEventListener","_removeEventListener","removeEventListener","_dispatchEvent","dispatchEvent","onadd","onrem","ondispatch","add","type","data","push","a","arguments","event","thisvar","line","filename","replace","filepath","location","origin","ownerpath","apply","cb","args","pruneConnected","list","e","Node","isConnected","undefined","_debug_event_listeners","_disable_all_listeners","console","warn","EventSource","visualViewport","width","innerWidth","height","innerHeight","offsetLeft","offsetTop","pageLeft","pageTop","scale","Array","set","array","src","dst","count","RangeError","len","Math","min","Object","defineProperty","enumerable","configurable","Float64Array","Float32Array","Uint8Array","Uint8ClampedArray","Int32Array","Int16Array","Int8Array","reject","func","filter","item","Symbol","iterator","keystr","fract","f","floor","tent","abs","sign","pop_i","idx","Error","remove","suppress_error","indexOf","trace","String","contains","substr","search","Number","Boolean","key","colormap","black","red","green","yellow","blue","magenta","cyan","white","reset","grey","orange","pink","brown","lightred","peach","tab","chr","t","termColorMap","termColor","s","toString","termPrint","re1a","re1b","re2","endtag","tok","value","tokdef","s2","tokens","mintk","mini","minslice","mintype","ok","tk","slice","match","chunk","cur","stack","out","pop","iter","ret","util","freeze","__proto__","print_lines","ld","lineno","col","printColors","token","buf","lines","split","istart","max","iend","color","l","colstr","constructor","val","lexpos","lexer","parser","name","regexpr","example","re","startsWith","endsWith","trim","PUTIL_ParseError","msg","super","errfunc","lexdata","colmap","printTokens","linestart","linemap","tokints","statestack","states","__main__","statedata","logger","log","add_state","tok_int","push_state","state","pop_state","input","str","peeked_tokens","safepos","peek","next","peeknext","at_end","ignore_peek","shift","ts","tlen","results","res","exec","index","theres","max_res","def","parse","err_on_unconsumed","estr","optional","expect","test_parser","basic_types","Set","reserved_tokens","has","toUpperCase","js","rt","lex","p_Type","p","toLowerCase","arraytype","itername","iname","p_Array","p_Field","field","get","st","fields","p_Struct","JSON","stringify","struct_parseutil","NStruct","id","StructEnum","INT","FLOAT","DOUBLE","STRING","STATIC_STRING","STRUCT","TSTRUCT","ARRAY","ITER","SHORT","BYTE","BOOL","ITERKEYS","UINT","USHORT","STATIC_ARRAY","SIGNED_BYTE","ArrayTypes","ValueTypes","StructTypes","int","uint","ushort","float","double","string","static_string","struct","abstract","short","byte","bool","iterkeys","sbyte","StructTypeMap","gen_tabstr","stripComments","strlit","strs","mode","escape","StructParser","forEach","parser$1","p_Iter","p_IterKeys","size","p_StaticArray","num","maxlength","p_Static_String","jsonKeyword","p_Abstract","tname","DATAREF","p_DataRef","p_ID_or_num","check","comment","struct_parse","struct_parser","struct_typesystem","STRUCT_ENDIAN","setBinaryEndian","temp_dataview","DataView","ArrayBuffer","uint8_view","buffer","unpack_context","pack_byte","pack_sbyte","pack_bytes","bytes","pack_int","setInt32","pack_uint","setUint32","pack_ushort","setUint16","pack_float","setFloat32","pack_double","setFloat64","pack_short","setInt16","encode_utf8","arr","charCodeAt","uc","decode_utf8","sum","j","fromCharCode","test_utf8","truncate_utf8","maxlen","last_codepoint","last2","incode","_static_sbuf_ss","pack_static_string","_static_sbuf","pack_string","unpack_bytes","dview","uctx","unpack_byte","getUint8","unpack_sbyte","getInt8","unpack_int","getInt32","unpack_uint","getUint32","unpack_ushort","getUint16","unpack_float","getFloat32","unpack_double","getFloat64","unpack_short","getInt16","_static_arr_us","unpack_string","slen","_static_arr_uss","unpack_static_string","done","struct_binpack","warninglvl","debug","_static_envcode_null","packer_debug","packer_debug_start","packer_debug_end","packdebug_tablevel","_get_pack_debug","cachering","tot","static","cls","gen_tabstr$1","setWarningMode2","isNaN","setDebugMode2","funcname","StructFieldTypes","StructFieldTypeMap","packNull","manager","toJSON","obj","fromJSON","instance","formatJSON","tlvl","validateJSON","_abstractKey","unpack_field","define","unpack","fakeFields","fmt_type","format","do_pack","typeid","pack","_ws_env","StructFieldType","StructIntField","register","StructFloatField","StructDoubleField","StructStringField","StructStaticStringField","StructStructField","stt","get_struct","write_struct","validateJSONIntern","readJSON","formatJSON_intern","writeJSON","dest","cls2","get_struct_cls","read_object","field2","StructTStructField","keywords","structName","parentcls","struct_ids","get_struct_id","struct_cls","formatArrayJson","type2","formatCtx","addComments","StructArrayField","d","env","val2","_env_call","fakeField","process","exit","json","StructIterField","starti","call","StructShortField","StructByteField","StructSignedByteField","StructBoolField","StructIterKeysField","StructUintField","StructUshortField","StructStaticArrayField","_sintern2","structEval","eval","setStructEval","_struct_eval","TokSymbol","buildJSONParser","nfloat3","nfloatexp","numre","RegExp","numreTest","tests","test","char","parseFloat","tokinfo","p_Start","throwError","first","p_Object","jsonParser","nGlobal","printContext","l2","globalThis","globals","self","DEBUG","updateDEBUG","keys","sintern2","struct_eval","warninglvl$1","truncateDollarSign","JSONError","printCodeLines","code","printEvalError","setTruncateDollarSign","v","_truncateDollarSign","unmangle","_static_envcode_null$1","packer_debug$1","packer_debug_start$1","packer_debug_end$1","gen_tabstr$2","update_debug_data","setWarningMode","setDebugMode","_ws_env$1","haveCodeGen","nbtoa","natob","define_empty_class","scls","create","loadSTRUCT","reader","newSTRUCT","idgen","allowOverriding","structs","compiled_code","null_natives","define_null_native","jsonUseColors","jsonBuf","child","parent","fmt_struct","bad","fromSTRUCT","obj2","concat","getOwnPropertySymbols","internal_only","no_helper_js","keyword","nameKeyword","script","load","new","after","from","validateStructs","onerror","getType","formatStruct","parse_structs","defined_classes","struct2","clsmap","dummy","registerGraph","srcSTRUCT","recStruct","recArray","add_class","st2","unregister","inherit","isRegistered","hasOwnProperty","envcode","fullcode","code2","err","use_helper_js","useHelperJS","thestruct","t1","tinyeval","write_object","readObject","cls_or_struct_id","writeObject","json2","isArray","assign","objInstance","this2","was_run","flen","unpackInto","makeLoader","useInternalParser","useColors","consoleLogger","jsonLogger","message","keyTestJson","f2","basetype","validate","StructClass","deriveStructManager","_json_parser","_util","NewSTRUCT","write_scripts","nManager","include_code","nl","buf2","i2","versionToInt","mul","versionCoerce","major","minor","micro","setClassKeyword","btoa","Buffer","atob","ver_pat","ver","parseInt","versionLessThan","b","FileParams","magic","ext","blocktypes","version","Block","type_magic","FileeError","FileHelper","params","fp","unpack_ctx","read","dataview","FileError","scripts","blocks","dviewlen","byteLength","bdata","datalen","bstruct","block","doVersions","old","write","data2","writeBase64","makeBlock","readBase64","base64","struct_filehelper","truncateDollarSign$1","setEndian","validateJSON$1","getEndian","setAllowOverriding","__uctx","formatJSON$1","class_or_struct_id","impl","phones","iPhone","BlackBerry","HTC","Nexus","Dell","Motorola","Samsung","LG","Sony","Asus","NokiaLumia","Micromax","Palm","Vertu","Pantech","Fly","Wiko","iMobile","SimValley","Wolfgang","Alcatel","Nintendo","Amoi","INQ","OnePlus","GenericPhone","tablets","iPad","NexusTablet","GoogleTablet","SamsungTablet","Kindle","SurfaceTablet","HPTablet","AsusTablet","BlackBerryTablet","HTCtablet","MotorolaTablet","NookTablet","AcerTablet","ToshibaTablet","LGTablet","FujitsuTablet","PrestigioTablet","LenovoTablet","DellTablet","YarvikTablet","MedionTablet","ArnovaTablet","IntensoTablet","IRUTablet","MegafonTablet","EbodaTablet","AllViewTablet","ArchosTablet","AinolTablet","NokiaLumiaTablet","SonyTablet","PhilipsTablet","CubeTablet","CobyTablet","MIDTablet","MSITablet","SMiTTablet","RockChipTablet","FlyTablet","bqTablet","HuaweiTablet","NecTablet","PantechTablet","BronchoTablet","VersusTablet","ZyncTablet","PositivoTablet","NabiTablet","KoboTablet","DanewTablet","TexetTablet","PlaystationTablet","TrekstorTablet","PyleAudioTablet","AdvanTablet","DanyTechTablet","GalapadTablet","MicromaxTablet","KarbonnTablet","AllFineTablet","PROSCANTablet","YONESTablet","ChangJiaTablet","GUTablet","PointOfViewTablet","OvermaxTablet","HCLTablet","DPSTablet","VistureTablet","CrestaTablet","MediatekTablet","ConcordeTablet","GoCleverTablet","ModecomTablet","VoninoTablet","ECSTablet","StorexTablet","VodafoneTablet","EssentielBTablet","RossMoorTablet","iMobileTablet","TolinoTablet","AudioSonicTablet","AMPETablet","SkkTablet","TecnoTablet","JXDTablet","iJoyTablet","FX2Tablet","XoroTablet","ViewsonicTablet","VerizonTablet","OdysTablet","CaptivaTablet","IconbitTablet","TeclastTablet","OndaTablet","JaytechTablet","BlaupunktTablet","DigmaTablet","EvolioTablet","LavaTablet","AocTablet","MpmanTablet","CelkonTablet","WolderTablet","MediacomTablet","MiTablet","NibiruTablet","NexoTablet","LeaderTablet","UbislateTablet","PocketBookTablet","KocasoTablet","HisenseTablet","Hudl","TelstraTablet","GenericTablet","oss","AndroidOS","BlackBerryOS","PalmOS","SymbianOS","WindowsMobileOS","WindowsPhoneOS","iOS","iPadOS","MeeGoOS","MaemoOS","JavaOS","webOS","badaOS","BREWOS","uas","Chrome","Dolfin","Opera","Skyfire","Edge","IE","Firefox","Bolt","TeaShark","Blazer","Safari","WeChat","UCBrowser","baiduboxapp","baidubrowser","DiigoBrowser","Mercury","ObigoBrowser","NetFront","GenericBrowser","PaleMoon","props","Mobile","Build","Version","VendorID","iPod","Coast","Fennec","NokiaBrowser","MQQBrowser","MicroMessenger","SamsungBrowser","Iron","Tizen","Webkit","Gecko","Trident","Presto","Goanna","Android","BREW","Java","Symbian","utils","Bot","MobileBot","DesktopMode","TV","WebKit","Console","Watch","fullPattern","shortPattern","tabletPattern","hasOwnProp","equalIC","containsIC","valueLC","convertPropsToRegExp","object","MobileDetect","userAgent","maxPhoneWidth","ua","prepareUserAgent","_cache","FALLBACK_PHONE","FALLBACK_TABLET","FALLBACK_MOBILE","values","verPos","mobileDetectRules","substring","oss0","findMatch","findMatches","result","getVersionStr","propertyName","patterns","getVersion","prepareVersionNo","NaN","numbers","join","isMobileFallback","detectMobileBrowsers","isTabletFallback","prepareDetectionCache","cache","mobile","phone","tablet","phoneSized","isPhoneSized","mobileGrade","$isMobile","os","is","detectOS","getDeviceSmallerSide","screen","userAgents","versionStr","pattern","grade","_impl","module","exports","factory","amd","keyStrBase64","keyStrUriSafe","baseReverseDic","getBaseValue","alphabet","character","charAt","getInput","lzstring","compressToBase64","_compress","decompressFromBase64","_decompress","compressToUTF16","decompressFromUTF16","compressed","compressToUint8Array","uncompressed","compress","TotalLen","current_value","decompressFromUint8Array","decompress","compressToEncodedURIComponent","decompressFromEncodedURIComponent","bitsPerChar","getCharFromInt","ii","context_dictionary","context_dictionaryToCreate","context_c","context_wc","context_w","context_enlargeIn","context_dictSize","context_numBits","context_data","context_data_val","context_data_position","pow","resetValue","getNextValue","w","bits","resb","maxpower","power","dictionary","enlargeIn","dictSize","numBits","entry","position","f64tmp","u16tmp","Uint16Array","isDenormal","_isDenormal","teal","gray","MovingAvg","used","sample","timers","mdetect","mret","pollTimer","interval","time_ms","isMobile","navigator","SmartConsoleContext","random","sqrt","r","g","__console","timeInterval","timeIntervalAll","_last","last","_data","_data_length","maxCache","hash","dohash","h","WeakSet","recurse","strhash","getAllKeys","clearCache","_getData","time","_check","SmartConsole","contexts","context","tm","EmptySlot","getClassParent","iterable","searchItem","getOwnPropertyDescriptors","proto","formatNumberUI","isInt","decimals","Infinity","toFixed","performance","now","Date","getMilliseconds","color2css","merge","obja","objb","debug_cacherings","_cacherings","_clear_all_cacherings","kill_all","copy","Reflect","ownKeys","ch","_nonvector_cacherings","_stale_cacherings","sort","gen","isprivate","private","SetIter","items","freelist","equals","setb","clear","map","reduce","initial","delete","ignore_existence","HashIter","_items","_hash_null","hashtable","_keys","key2","IDGenInternalIDGen","IDGen","__cur","_debug","_internalID","isFinite","_cur","max_cur","get_callstack","print_stack","fetch_file","path","url","req","XMLHttpRequest","Promise","accept","open","onreadystatechange","status","readyState","response","statusText","send","_int32","x","nstructjs","MersenneRandom","seed","mt","Uint32Array","extract_number","nrandom","fill","twist","y","_mt","smallstr_hashes","MAXINT","hashsizes","FTAKEN","FKEY","FVAL","FTOT","digestcache","FastHash","cursize","resize","table","valueOf","probe","_i","test_fasthash","ImageReader","load_image","doaccept","createElement","promise","files","FileReader","onload","target","image","Image","canvas","getContext","drawImage","idata","getImageData","readAsDataURL","click","then","HashDigest","hashjoin","_test_hash2","fromConstructor","NullItem","MapIter","ownermap","finish","itercur","_list","return","iterstack","validateId","_test_map","m","item2","UndefinedTag","IDMap","iteritem","_test_idmap","HW","HELEM","HTOT","heaplog","MinHeapQueue","iterw","heap","end","witer","depth","ceil","swap","n1","n2","testHeapQueue","list1","Queue","initialSize","queue","enqueue","qlen","clearData","dequeue","_testQueue","steps","samples","ArrayPool","pools","Map","pool","DivLogger","elemId","maxLines","elem","update","getElementById","innerHTML","description","k2","PendingTimeoutPromises","TimeoutPromise","callback","timeout","silent","accept2","_accept2","bind","reject2","_reject2","rejected","_promise","_accept","_reject","catch","wrapPromise","finally","setInterval","EulerOrders","XYZ","XZY","YXZ","YZX","ZXY","ZYX","makeCompiledVectormathCode","es6exports","doExports","classes","Vector2","Vector3","Vector4","lens","Quat","modecode","nstructjscode","indent","pad","zero","internal_matrix","Matrix4","sin","cos","asin","exp","acos","atan2","atan","PI","E","DOT_NORM_SNAP_LIMIT","M_SQRT2","FLT_EPSILON","basic_funcs","negate","combine","interp","addFac","sub","div","mulScalar","divScalar","addScalar","subScalar","minScalar","maxScalar","clamp","bounded_acos","fac","pi","make_norm_safe_dot","_dot","dot","getBaseVector","BaseVector","vec","vectorsize","vectorDotDistance","vectorDistance","vectorDistanceSqr","line2","init_swizzle","Function","vectorLength","swapAxes","axis1","axis2","normalize","F64BaseVector","F32BaseVector","myclamp","toCSS","loadXYZW","z","loadXYZ","mulVecQuat","q","t0","t2","multVecMatrix","matrix","$matrix","m41","m11","m21","m31","m42","m12","m22","m32","m43","m13","m23","m33","m44","m14","m24","m34","cross","preNormalizedAngle","v2","th","_v3nd_n1_normalizedDot","_v3nd_n2_normalizedDot","_v3nd4_n1_normalizedDot4","_v3nd4_n2_normalizedDot4","preventExtensions","v1","v3","v4","$_v3nd4_n1_normalizedDot4","$_v3nd4_n2_normalizedDot4","center","$_v3nd4_n1_normalizedDot3","$_v3nd4_n2_normalizedDot3","loadXY","loadJSON","initVector3","normalizedDot","$_v3nd_n1_normalizedDot","$_v3nd_n2_normalizedDot","ignore_w","isPersp","rot2d","A","axis","initVector2","co","w2","vectorLengthSqr","_quat_vs3_temps","util.cachering","makeUnitQuat","isZero","mulQuat","qt","conjugate","dotWithQuat","q2","invert","conjugate_qt","mulscalar","nq2","mulScalarWithFactor","angle","si","last3","toMatrix","q0","q1","q3","qda","qdb","qdc","qaa","qab","qac","qbb","qbc","qcc","matrixToQuat","wmat","mat","temp_mats","r1","r2","r3","tr","axisAngleToQuat","nor","phi","rotationBetweenVecs","quatInterp","quat2","omega","sinom","sc1","sc2","quat","cosom","lookat_cache_vs3","lookat_cache_vs4","makenormalcache","lookat_cache_ms","euler_rotate_mats","preMultTemp","clone","addToHashDigest","m1","m2","loadColumn","have4","copyColumnTo","copyColumn","makeIdentity","getAsArray","getAsFloat32Array","setUniform","ctx","loc","transpose","setUniformArray","setUniformWebGLArray","uniformMatrix4fv","tmp","determinant","_determinant4x4","det","_makeAdjoint","translate","multiply","preTranslate","preMultiply","preScale","euler_rotate_order","order","xmat","ymat","zmat","euler_rotate","dec","rotate","sinA","cosA","sinA2","x2","y2","z2","flat","clearTranslation","set_w_to_one","setTranslation","resetW","makeNormalMatrix","normal","up","mm","mm2","divide","divisor","ortho","left","right","bottom","top","near","far","tx","ty","tz","frustum","B","C","D","orthographic","aspect","zscale","perspective","fovy","zNear","zFar","tan","lookat","pos","zvec","yvec","xvec","makeRotationOnly","l1","l3","alignAxis","inputs","transformMatrix","getValue","mat2","rot","decompose","axes","getAsVecs","axis3","loadFromVecs","_translate","_rotate","_scale","_skew","_perspective","rmat","_determinant2x2","_determinant3x3","a1","a2","a3","b1","b2","b3","c1","c2","c3","d1","d2","d3","a4","b4","c4","d4","__mat","testmat","PropTypes","ENUM","FLAG","VEC2","VEC3","VEC4","MATRIX4","QUAT","PROPLIST","STRSET","CURVE","FLOAT_ARRAY","REPORT","PropSubTypes","COLOR","PropFlags","SELECT","PRIVATE","LABEL","USE_ICONS","USE_CUSTOM_GETSET","SAVE_LAST_VALUE","READ_ONLY","SIMPLE_SLIDER","FORCE_ROLLER_SLIDER","USE_BASE_UNDO","EDIT_AS_BASE_UNIT","NO_UNDO","USE_CUSTOM_PROP_GETTER","FORCE_ENUM_CHECKBOXES","NO_DEFAULT","ToolPropertyIF","subtype","apiname","uiname","flag","icon","copyTo","_fire","arg1","arg2","on","off","setValue","setStep","step","setRange","setUnit","unit","setUIRange","setIcon","StringPropertyIF","NumPropertyIF","IntPropertyIF","setRadix","radix","FloatPropertyIF","setDecimalPlaces","EnumPropertyIF","valid_values","ui_value_names","iconmap","uin","addIcons","FlagPropertyIF","Vec2PropertyIF","Vec3PropertyIF","Vec4PropertyIF","ListPropertyIF","prop","StringSetPropertyIF","definition","destructive","soft_fail","addUINames","addDescriptions","Curve1DPropertyIF","curve","FLT_EPSILONE","myfloor","normString","myToFixed","Units","Unit","unitDefine","MeterUnit","InchUnit","foot_re","FootUnit","parts","vft","vin","square_foot_re","SquareFootUnit","MileUnit","DegreeUnit","RadianUnit","setBaseUnit","baseUnit","setMetric","isMetric","_getBaseUnit","numre1","numre2","hexre1","hexre2","binre","expre","intre","isnumber","parseValueIntern","base","getUnit","toInternal","fromInternal","parseValue","displayUnit","isNumber","PixelUnit","PercentUnit","convert","unita","unitb","buildString","decimalPlaces","unitConvert","_parseValueTest","_buildStringTest","config","doubleClickTime","autoLoadSplineTemplates","doubleClickHoldTime","setConfig","modalstack","singleMouseCBs","Screen","ContextAreaClass","debugDomEvents","cbsymbol","thsymbol","init","et","getkey","options","singletonMouseEvents","ddd","testSingleMouseUpEvent","singleMouseEvent","_mpos","doSingleCbs","touches","pageX","pageY","copyEvent","util.print_stack","capture","isLeftClick","button","DoubleClickHandler","down","dblEvent","start_mpos","_on_mouseup","_on_mousemove","mdown","mpos","devicePixelRatio","mousedown","isMouseDown","cpy","util.time_ms","cconst","ondblclick","abort","buttons","pathDebugEvent","extra","__prevdef","preventDefault","__stopprop","stopPropagation","eventWasTouch","sourceCapabilities","firesTouchEvents","was_touch","TouchEvent","PointerEvent","pointerType","getOwnPropertyNames","original","_setScreenClass","findScreen","rec","_setModalAreaClass","pushPointerModal","pointerId","autoStopPropagation","pushModalLight","handlers","last_mpos","touchmap","touchstart","touchmove","touchend","touchcancel","handleAreaContext","sarea","findScreenArea","area","push_ctx_active","pop_ctx_active","make_default_touchhandler","domEvents","e2","clientX","clientY","screenX","screenY","make_handler","found","handler","settings","passive","make_pointer","pointer","setPointerCapture","popModalLight","lock","modalEvents","unlock","releasePointerCapture","haveModal","_findScreen","_haveModal","keymap_latin_1","Space","Escape","Enter","Return","Up","Down","Left","Right","Num0","Num1","Num2","Num3","Num4","Num5","Num6","Num7","Num8","Num9","Home","End","Delete","Backspace","Insert","PageUp","PageDown","Tab","NumPlus","NumMinus","Shift","Ctrl","Control","Alt","keymap_latin_1_rev","keymap","reverse_keymap","HotKey","modifiers","action","mods","api","execTool","KeyMap","hotkeys","pathid","hk","handle","util.set","shiftKey","altKey","ctrlKey","commandKey","keyCode","EventDispatcher","_cbs","_fireEvent","stop","copyMouseEvent","_orig","exclude","DomEventTypes","on_mousemove","on_mousedown","on_mouseup","on_touchstart","on_touchcancel","on_touchmove","on_touchend","on_mousewheel","on_keydown","on_keyup","on_pointerdown","on_pointermove","on_pointercancel","on_pointerup","getDom","dom","eventtype","modalStack","isModalHead","owner","EventHandler","_modalstate","simple_events.pushPointerModal","pushModal","_is_root","simple_events.pushModalLight","popModal","simple_events.popModalLight","CurveConstructors","CURVE_VERSION","CurveFlags","TangentModes","SMOOTH","BREAK","getCurve","throw_on_error","_udigest","util.HashDigest","CurveTypeData","typeName","hasGUI","calcHashKey","digest","redraw","makeGUI","container","killGUI","evaluate","integrate","s1","quadSteps","ds","derivative","df","derivative2","inverse","best","mid","y1","ymid","onActive","draw_transform","onInactive","destroy","_on_change","draw","unitRange","evalHermiteTable","range","genHermiteTable","lastdv1","lastf3","eps","dt","f3","dv1","j2","vectormath.Vector2","SplineTemplates","CONSTANT","LINEAR","SHARP","SQRT","SMOOTHER","SHARPER","SPHERE","REVERSE_LINEAR","GUASSIAN","templates","SplineTemplateIcons","RecalcFlags","BASIS","FULL","ALL","FULL_BASIS","mySafeJSONStringify","mySafeJSONParse","bin_cache","_bin_cache","eval2_rets","bez3","bez4","binomial","bin","Curve1DPoint","rco","sco","startco","eid","tangent","seal","deg","splineCache","BSplineCache","curves","maxCurves","limit","cache_w","curve2","_last_cache_key","updateKnots","regen_basis","regen_hermite","_remove","_splineCache","BSplineCurve","_degOffset","_last_update_key","fastmode","points","interpolating","_ps","hermite","recalc","basis_tables","eidgen","util.IDGen","uidata","p2","p1","no_update","_sortPoints","degExtra","hightlight","basis","_basis","empty","_evaluate","f4","solve_interpolating","_evaluate2","error1","orig","totgs","_dbasis","ps","safe_inv","bas","kn","knn","knn1","ki","dbas","start_t","miny","mins","mindx","xmin","xmax","dx","sumx","sumy","totbasis","_wrapTouchEvent","isTouch","loadTemplate","templ","drawTransform","transpoints","transforming","draw_trans","bstrip","row","strip","makebutton","iconbutton","iconsheet","customIcon","fullUpdate","Icons","getIconEnum","LARGE_X","TINY_X","slider","simpleslider","defaultval","checked","onchange","start_transform","transform_mpos","do_highlight","highlight","minp","mindis","limitsqr","dy","dis","do_transform","xRange","yRange","getClientRects","dpi","trans","end_transform","_save_hook","save","lineWidth","strokeStyle","beginPath","fillStyle","rect","restore","makeSplineTemplateIcons","moveTo","lineTo","ls","lineCap","stroke","toDataURL","img","splineTemplatesLoaded","initSplineTemplates","_SplineTemplateIcons","setTimeout","feq","EquationCurve","equation","_last_equation","_last_xrange","_func","textbox","label","gui","updateTextBox","text","makeFunc","_haserror","cosh","sinh","cbrt","GuassianCurve","offset","deviation","hslider","oslider","dslider","Ease","linear","none","amount","getPowIn","getPowOut","getPowInOut","quadIn","quadOut","quadInOut","cubicIn","cubicOut","cubicInOut","quartIn","quartOut","quartInOut","quintIn","quintOut","quintInOut","sineIn","sineOut","sineInOut","getBackIn","backIn","getBackOut","backOut","getBackInOut","backInOut","circIn","circOut","circInOut","bounceIn","bounceOut","bounceInOut","getElasticIn","amplitude","period","pi2","elasticIn","getElasticOut","elasticOut","getElasticInOut","elasticInOut","ParamKey","BOOL_FLAG","SimpleCurveBase","_saveParams","pdef","pair","BounceCurve","decay","freq","phase","ElasticCurve","_last_hash","EaseCurve","mode_in","mode_out","amp","RandCurve","util.MersenneRandom","_seed","in_mode","Curve1D","uiZoom","clipToRange","generators","VERSION","setGenerator","generatorType","active","_fastmode","gen1","gen2","active_generator","localeCompare","getGenerator","switchGenerator","patchRange","sz","overlay_curvefunc","_active","NumberConstraintsBase","IntegerConstraints","util.list","FloatConstrinats","NumberConstraints","setPropTypes","types","customPropertyTypes","PropClasses","customPropTypeBase","wordmap","sel","unsel","defaultRadix","defaultDecimalPlaces","OnceTag","ToolProperty","PROP_TYPE_ID","wasSet","icon2","callbacks","lastc","ischar","upper","lower","subst","word","logBase","report","util.termColor","setDescription","setUIName","calcMemSize","strlen","saveLastValue","clearEventCallbacks","once","cb2","uiRange","getStep","stepIsRelative","calcRelativeStep","setRelativeStep","noUnits","setDisplayUnit","setFlag","setIcon2","FloatArrayProperty","StringProperty","multiLine","internalRegister","NumProperty","_NumberPropertyBase","slideSpeed","expRate","ui_range","setSlideSpeed","setExpRate","IntProperty","ReportProperty","BoolProperty","FloatProperty","EnumKeyPair","key_is_int","val_is_int","EnumProperty","string_or_int","descriptions","makeUIName","iconmap2","calcHash","updateDefinition","enumdef_or_prop","enumdef","addIcons2","api_update","_loadMap","_saveMap","_values","_ui_value_names","_iconmap","_iconmap2","_descriptions","data_is_int","_is_data_int","FlagProperty","bitmask","VecPropertyBase","hasUniformSlider","uniformSlider","Vec2Property","Vec3Property","isColor","Vec4Property","QuatProperty","Mat4Property","ListProperty","psize","prop1","prop2","getListItem","setListItem","StringSetProperty","Curve1DProperty","ClassIdSymbol","ScreenClass","setScreenClass","getAreaIntName","AreaTypes","TEST_CANVAS_EDITOR","setAreaTypes","areaclasses","theWrangler","AreaWrangler","stacks","lasts","lastArea","locked","_last_screen_id","makeSafeContext","wrangler","Proxy","contextWrangler","stack1","_checkWrangler","_id","findInstance","pushLastRef","updateLastRef","getLastArea","dtvtmps","quad_co_rets2","quad_bilinear","u","quad_uv_2d","u1","u2","v2x","v2y","v3x","v3y","v4x","v4y","C1","C2","ClosestModes","CLOSEST","START","END","ENDPOINTS","advs","AbstractCurve","curvature","ClosestCurveRets","cvrets","cvarrays","util.ArrayPool","cvtmp","closestPoint","poly_normal_tmps","pncent","normal_poly","vs","normal_tri","normal_quad","cent","barycentric_v2_rets","calc_proj_refs","dihedral_v3_sqr","bx","by","bz","cx","cy","cz","dz","tet_area_tmps","tet_volume","calc_projection_axes","no","ax","ay","az","_avtmps","inrect_3d","aabb_isect_line_3d","inside","closest_point_on_line","aabb_isect_cylinder_3d","radius","barycentric_v2","_linedis2","v1x","v1y","v1z","v2z","closest_p_tri_rets","uv","dist","cpt_v1","cpt_v2","cpt_v3","cpt_v4","cpt_v5","cpt_v6","cpt_p","cpt_n","cpt_mat","cpt_mat2","cpt_b","closest_point_on_quad","uvw","closest_point_on_tri","ax1","ax2","op","ax3","dist_to_tri_v3_old","planedis","p3","pp","tmp2","linedis3d","point_in_tri","dist_to_tri_v3","_dt3s_n","dist_to_tri_v3_sqr","nx","ny","nz","feps","bx2","by2","cx2","cy2","x1","z1","s3","mask","lx","ly","lz","tri_area_temps","tri_area","aabb_overlap_area","pos1","size1","pos2","size2","aabb_isect_2d","aabb_isect_3d","aabb_intersect_vs","aabb_intersect_rets","aabb_intersect_2d","test_aabb_intersect_2d","setAttribute","appendChild","clearRect","timer","_timer","clearInterval","rate","aabb_intersect_vs3","aabb_intersect_3d","min1","max1","min2","max2","aabb_union","aabb_union_2d","init_prototype","$_mh","$_swapt","COLINEAR","LINECROSS","COLINEAR_ISECT","_cross_vec1","_cross_vec2","SQRT2","FEPS_DATA","F16","F32","F64","FEPS","FLOAT_MIN","FLOAT_MAX","Matrix4UI","_static_grp_points4","_static_grp_points8","get_rect_points","cs","get_rect_lines","$vs_simple_tri_aabb_isect","simple_tri_aabb_isect","isect","MinMax","totaxis","_min","_max","_static_mr_co","_static_mr_cs","minmax_rect","minmax","winding_axis","up_axis","xaxis","yaxis","x3","winding","zero_z","tol","inrect_2d","$smin_aabb_isect_line_2d","$ssize_aabb_isect_line_2d","$sv1_aabb_isect_line_2d","$ps_aabb_isect_line_2d","$l1_aabb_isect_line_2d","$smax_aabb_isect_line_2d","$sv2_aabb_isect_line_2d","$l2_aabb_isect_line_2d","aabb_isect_line_2d","line_line_cross","expand_rect2d","margin","expand_line","colinear","_llc_l1","_llc_l2","_llc_l3","_llc_l4","lli_v1","lli_v2","lli_v3","lli_v4","_zero_cn","_tmps_cn","_rets_cn","corner_normal","vec1","vec2","line_line_isect","test_segment","xa1","xa2","ya1","ya2","xb1","xb2","yb1","yb2","w1","w3","w4","_asi_v1","_asi_v2","_asi_v3","_asi_v4","_asi_v5","_asi_v6","point_in_aabb_2d","_asi2d_v1","_asi2d_v2","_asi2d_v3","_asi2d_v4","_asi2d_v5","_asi2d_v6","aabb_sphere_isect_2d","mvec","dist_to_line_2d","point_in_aabb","asi_rect","aabb_sphere_isect_vs","aabb_sphere_isect","i3","aabb_sphere_dist","convex_quad","$e1_normal_tri","$e3_normal_tri","$e2_normal_tri","isNum","_normal_tri_rets","y3","z3","$n2_normal_quad","_q1","_q2","_q3","normal_quad_old","_len","_li_vi","line_isect","calc_t","vi","dt2l_v1","dt2l_v2","dt2l_v3","dt2l_v4","dt2l_v5","clip","closest_co_out","t_out","dt3l_v1","dt3l_v2","dt3l_v3","dt3l_v4","dt3l_v5","dist_to_line_sqr","px","py","pz","len2","dist_to_line","_cplw_vs4","_cplw_vs3","_cplw_vs2","wclip","znear","clip_line_w","_v1","_v2","zfar","doclip1","doclip","dozclip","_closest_point_on_line_cache","_closest_point_rets","_closest_tmps","_circ_from_line_tan_vs","_circ_from_line_tan_ret","circ_from_line_tan","_circ_from_line_tan2d_vs","_circ_from_line_tan2d_ret","circ_from_line_tan_2d","tanx1","tany1","div2","midx","midy","_gtc_e1","_gtc_e2","_gtc_e3","_gtc_p1","_gtc_p2","_gtc_v1","_gtc_v2","_gtc_p12","_gtc_p22","_get_tri_circ_ret","get_tri_circ","e1","e3","gen_circle","stfeps","verts","make_vert","make_edge","makeCircleMesh","gl","mesh","Mesh","verts1","verts2","make_face_complex","minmax_verts","__iter_v","__get_iter","__ival_v","unproject","ipers","iview","newvec","project","pers","view","_sh_minv","_sh_maxv","_sh_start","_sh_end","static_cent_gbw","get_boundary_winding","divideScalar","totw","round","PlaneOps","reset_axis","orig1","orig2","_isrp_ret","isect_ray_plane_rets","isect_ray_plane","planeorigin","planenormal","rayorigin","raynormal","po","pn","ro","rn","_old_isect_ray_plane","Mat4Stack","update_func","set_internal_matrix","identity","loadIdentity","tril_rets","lreport","trilinear_v3","boxverts","a1x","a1y","a1z","b1x","b1y","b1z","c1x","c1y","c1z","d1x","d1y","d1z","a2x","a2y","a2z","b2x","b2y","b2z","c2x","c2y","c2z","d2x","d2y","d2z","tril_co_rets","tril_co_tmps","tril_mat_1","tril_mat_2","wtable","pih_tmps","boxfaces_table","boxfaces_tmp","boxfacenormals_tmp","point_in_hex","boxfacecents","boxfacenormals","boxverts_tmp","trilinear_co","t3","du","dv","dw","bv","trilinear_co2","grad","totg","axis_error","angle_tri_v3_rets","angle_tri_v3_vs","tri_angles","th1","th2","th3","_clipdata","mime","_clipboards","clipboard","blob","Response","getClipboardData","desiredMimes","setClipboardData","ClipboardItem","Blob","colorSchemeType","docManualPath","docEditorPath","useNumSliderTextboxes","numSliderArrowLimit","simpleNumSliders","menusCanPopupAbove","menu_close_time","paranoidEvents","screenborders","areaContextPushes","allBordersMovable","doOnce","areaConstraintSolver","datapaths","domEventAddRemove","debugUIUpdatePerf","screenAreaPosSizeAccesses","buttonEvents","addHelpPickers","useAreaTabSwitcher","autoSizeUpdate","showPathsInToolTips","enableThemeAutoUpdate","useNativeToolTips","noElectronMenus","loadConstants","ctrlconfig","ctrlconfig.setConfig","cfg","innerText","compatMap","BoxMargin","BoxBG","BoxRadius","background","defaultWidth","defaultHeight","DefaultWidth","DefaultHeight","BoxBorder","BoxLineWidth","BoxSubBG","BoxSub2BG","DefaultPanelBG","InnerPanelBG","Background","numslider_width","numslider_height","ColorSchemeTypes","LIGHT","DARK","parsepx","css","alpha_override","css2color_rets","basic_colors","purple","color2web","tostr","css2color","part","hasAlpha","web2color","validate_pat","validateWebColor","validate_rgba","validate_rgb","validateCSSColor","rgba","theme","invertTheme","inverted","bg","CSSFont","iscolor","setColorSchemeType","_digest","_size","font","weight","variant","calcHashUpdate","util.isMobile","mobileTextSizeMultiplier","genCSS","genKey","exportTheme","theme1","addVarDecl","sortkeys","writekey","maxwid","_exportTheme","Task","taskcb","task","AnimManager","tasks","timeOut","dead","onend","AbstractCommand","cbs","end_cbs","animator","WaitCommand","ms","GoToCommand","startValue","SetCommand","Command","Animator","method","on_tick","commands","_done","wait","goto","timeMs","cmd","while","donecb","lexlen","PUTLParseError","print_tokens","print_debug","peek_i","getTraceBack","file","userdata","DataFlags","USE_FULL_UNDO","DataTypes","DYNAMIC_STRUCT","PROP","propCacheRings","getTempProp","getClass","DataPathError","getVecClass","proptype","isVecProperty","toolprop_abstract.Vec2PropertyIF","toolprop_abstract.Vec3PropertyIF","toolprop_abstract.Vec4PropertyIF","toolprop.Vec2Property","toolprop.Vec3Property","toolprop.Vec4Property","DataPath","noUndo","setProp","readOnly","read_only","customPropCallback","propGetter","customGetSet","_getValue","_setValue","getSet","dataref","datapath","customSet","customGet","simpleSlider","rollerSlider","checkStrip","editAsBaseUnit","uiNameGetter","ui_name_get","speed","relativeStep","fullSaveUndo","icons","icons2","description_map","uiNames","uinames","StructFlags","ListIface","getStruct","getKey","getActive","setActive","getIter","ToolOpIface","toolpath","is_modal","outputs","DataAPIClass","setImplementationClass","registerTool","ToolClasses","setContextClass","_ToolClasses","ToolFlags","UndoFlags","IS_UNDO_ROOT","UNDO_BARRIER","HAS_UNDO_DATA","InheritFlag","slots","defaultUndoHandlers","undoPre","undo","setDefaultUndoHandlers","ToolPropertyCache","pathmap","accessors","userSetMap","dstruct","_buildAccessors","tdef","_getFinalToolDef","partial","pathk","mapStruct","dpath","_getAccessor","tooldef","useDefault","getPropKey","ToolMacro","SavedToolDefaults","ToolOp","events.EventHandler","_pointerId","_overdraw","__memsize","undoflag","getSlots","lastp","slots2","dinputs","doutputs","hasDefault","getDefault","drawlines","getInputs","tool","_regWithNstructjs","toolop","canRun","onUndoDestroy","calcUndoMem","loadDefaults","force","toolprop","saveDefaultInputs","genToolString","modalEnd","redo","_was_redo","execPre","execPost","exec_pre","resetTempGeom","modal_ctx","dl","getOverdraw","makeTempLine","node","modalStart","modalRunning","toolCancel","was_cancelled","_on_cancel","outs","ins","_save_inputs","PropKey","_save_outputs","MacroLink","sourcetool_idx","srckey","srcprops","desttool_idx","dstkey","dstprops","source","sourceProps","destProps","sourcePropKey","destPropKey","MacroClasses","_MacroClasses","macroidgen","tools","curtool","has_modal","connects","connectLinks","_macro_class","_getTypeClass","ready","__tooldef","_macroTypeId","connect","srctool","srcoutput","dsttool","dstinput","connectCB","i1","_do_connections","on_modal_end","ToolStack","memLimit","enforceMemLimit","_undo_branch","limitMemory","maxmem","setRestrictedToolContext","toolctx","execOrRedo","compareInputs","Equals","rerun","tctx","toLocked","execCtx","modal_running","rewind","replay","onStep","_stack","_save","buildToolSysAPI","registerWithNStructjs","rootCtxStruct","datastruct","_testToolStackIO","_appstate","toolstack","ToolPaths","initToolPaths_run","buildParser","valid_datatypes","STRLIT","NUMBER","Parser","parseToolPath","check_tool_exists","initToolPaths","startstr","toolclass","testToolParser","ModelInterface","prefix","getToolDef","getToolPathHotkey","createTool","constructor_argument","pushReportContext","popReportContext","massSetProp","mass_set_path","resolveMassSetPaths","resolvePath","ignoreExistence","rootStruct","subkey","use_range","ival","getDescription","rdef","validPath","getPropName","DataPathSetOp","propType","_undo","dataPath","flagBit","useFlagBit","hadError","massSetPath","destType","value2","hashThis","__ctx","paths","parseutil.PUTLParseError","parseutil.tokdef","parseutil.lexer","pathParser","parseutil.parser","parserStack","tool_classes","tool_idgen","toolkey","ToolID","lt","lastmsg","lcount","reportstack","pushReportName","util.console","popReportName","DataList","getLength","DataStruct","members","inheritFlag","dynamicStruct","default_struct","existing_struct","getter","setter","color3","vec3","toolprop.PropSubTypes","color4","vec4","arrayList","structdef","color3List","vectorList","color4List","pstruct","toolprop.BoolProperty","toolprop.FloatProperty","textblock","toolprop.StringProperty","toolprop.ReportProperty","toolprop.IntProperty","curve1d","toolprop.Curve1DProperty","enum","toolprop.EnumProperty","funcs","flags","toolprop.ToolProperty","toolprop.FlagProperty","fromToolProp","_map_struct_idgen","_map_structs","_debug__map_structs","_dummypath","DummyIntProperty","CLS_API_KEY","CLS_API_KEY_CUSTOM","DataAPI","rootContextStruct","getStructs","setRoot","sdef","hasStruct","mergeStructs","inheritStruct","auto_create_parent","_addClass","mapStructCustom","auto_create","suffix","applyFilter","$","inpath","resolvePath_intern","getPropOverride","datactx","newprop","lastobj2","lastkey","lastdpath","lastobj","p_key","dynstructobj","act","actkey","fakeprop","val1","bitfield","resolvePathOld2","splitchars","parent1","parent2","arg","retpath","_path","resolvePathold","_parsePathOverrides","hotkey","getToolPathHotkey_intern","searchKeymap","sareas","getActiveArea","getKeyMaps","parseToolArgs","tpath","invoke","initSimpleController","dpt","getDataPathToolOp","setDataPathToolOp","rgb_to_hsv_rets","rgb_to_hsv","computedH","computedS","computedV","minRGB","maxRGB","hsv_to_rgb_rets","hsv_to_rgb","RgbF_Create","rgb_to_cmyk_rets","cmyk_to_rgb_rets","cmyk_to_rgb","rgb_to_cmyk","M","Y","var_K","K","DefaultTheme","AreaHeaderBG","BasePackFlag","BoxDepressed","BoxHighlight","mobileSizeMultiplier","DefaultText","LabelText","TitleText","oneAxisPadding","padding","disabled","pressed","checkbox","CheckSide","colorfield","circleSize","colorBoxHeight","fieldSize","hueHeight","colorpickerbutton","curvewidget","CanvasBG","CanvasHeight","CanvasWidth","dropbox","dropTextBG","depressed","iconcheck","drawCheck","listbox","ListActive","ListHighlight","menu","MenuBG","MenuBorder","MenuHighlight","MenuSeparator","border","MenuSpacing","MenuText","notification","ProgressBarBG","ProgressBar","numslider","numslider_simple","SlideHeight","TextBoxWidth","labelOnTop","addLabel","numslider_textbox","TextBoxHeight","panel","HeaderBorderRadius","HeaderRadius","TitleBackground","TitleBorder","richtext","screenborder","scrollbars","color2","contrast","sidebar","tabs","TabPadding_mobile","TabPadding","TabActive","TabBarRadius","TabHighlight","TabInactive","TabStrokeStyle1","TabStrokeStyle2","TabText","tooltip","ToolTipText","treeview","itemIndent","rowHeight","vecPopupButton","setIconMap","FOLDER","FILE","SMALL_PLUS","SMALL_MINUS","UNDO","REDO","HELP","UNCHECKED","CHECKED","LARGE_CHECK","CURSOR_ARROW","NOTE_EXCL","SCROLL_DOWN","SCROLL_UP","BACKSPACE","LEFT_ARROW","RIGHT_ARROW","UI_EXPAND","UI_COLLAPSE","BOLD","ITALIC","UNDERLINE","STRIKETHRU","TREE_EXPAND","TREE_COLLAPSE","ZOOM_OUT","ZOOM_IN","ENUM_CHECKED","ENUM_UNCHECKED","UIBase","_setUIBase","uibase","AspectKeys","_ui_base","TextBox","initAspectClass","blacklist","validProperty","descr","getOwnPropertyDescriptor","__aspect_methods","AfterAspect","clearAspectCallbacks","chain","chain2","root","_method","isDead","_method_bound","_checkbind","before","_setTextboxClass","ElementClasses","__cconst","vectormath.Vector4","Area","_setAreaClass","ErrorColors","WARNING","ERROR","OK","__theme","registered_has_happened","tagPrefix","EventCBSymbol","calcElemCBKey","setTagPrefix","getTagPrefix","class_idgen","setTheme","theme2","k3","_last_report","IsMobile","marginPaddingCSSKeys","_IconManager","tilesize","number_of_horizontal_tiles","drawsize","tilex","customIcons","onReady","util.TimeoutPromise","canvasDraw","getDPI","setCSS","fitsize","getCSS","ratio","blobUrl","CustomIcon","baseImage","images","regenIcons","doSheet","toBlob","URL","createObjectURL","iconsheets","IconManager","sizes","horizontal_tile_count","customIconIDMap","isReady","addCustomIcon","maxid","manager2","findSheet","findClosestSheet","sheets","minsheet","goal","getTileSize","getRealSize","iconmanager","_iconmanager","IconSheets","SMALL","LARGE","XLARGE","iconSheetFromPackFlag","PackFlags","CUSTOM_ICON_SHEET","CUSTOM_ICON_SHEET_START","SMALL_ICON","getIconManager","setIconManager","IconSheetsOverride","makeIconDiv","icontest","vectormath.Matrix4","dpistack","UIFlags","internalElementNames","externalElementNames","INHERIT_WIDTH","INHERIT_HEIGHT","VERTICAL","LARGE_ICON","FORCE_PROP_LABELS","PUT_FLAG_CHECKS_IN_COLUMNS","WRAP_CHECKBOXES","STRIP_HORIZ","STRIP_VERT","STRIP","SIMPLE_NUMSLIDERS","HIDE_CHECK_MARKS","NO_NUMSLIDER_TEXTBOX","NO_UPDATE","_mobile_theme_patterns","_idgen","styleScrollBars","selector","inv","_testSetScrollbars","CTX","mergeGlobalCSS","calcThemeKey","_themeUpdateKey","flagThemeUpdate","_flagThemeUpdate","setTimeoutQueue","haveTimeout","_mc","timeout_cb","internalSetTimeout","HTMLElement","_modalstack","_tool_tip_abort_delay","_tooltip_ref","_textBoxEvents","_themeOverride","_checkTheme","_last_theme_update_key","_client_disabled_set","_useNativeToolTips","_useNativeToolTips_set","_has_own_tooltips","_tooltip_timer","pathUndoGen","_lastPathUndoGen","_useDataPathUndo","_active_animations","_screenStyleTag","_screenStyleUpdateHash","shadow","attachShadow","__cbs","_appendChild","parentWidget","_wasAddedToNodeAtSomeTime","visibleToPick","_override_class","tagname","default_overrides","my_default_overrides","class_default_overrides","_last_description","_description_final","_modaldata","packflag","_internalDisabled","__disabledState","_disdata","_ctx","_description","textContent","_getFont","_init_done","do_touch","MouseEvent","havePickClipboard","_clipboardHotkeyInit","_parentWidget","useDataPathUndo","hasAttribute","getAttribute","title","__background","overrideDefault","__updateDisable","internalDisabled","_forEachChildWidget","_reportCtxName","element","customElements","internal","setUndo","hide","sethide","hidden","contents","unhide","findArea","_cb2","connectedCallback","noMarginsOrPadding","regenTabOrder","getScreen","needsTabRecalc","noMargins","noPadding","getTotalRect","doaabb","rs","parseNumber","units.parseValue","formatNumber","units.buildString","setBoxCSS","getSubDefault","genBoxCSS","boxcode","setBG","zoom","getZoom","transform","transform2","flushSetCSS","_init","replaceChild","newnode","swapWith","parentNode","getPos","tmp1","insertBefore","ptmp","traverse","type_or_set","is_set","_clipboard_over","_last_clipboard_keyevt","_clipboard_keystart","_clipboard_events","_clipboard_keydown","_clipboard_keyend","internal_mode","is_copy","is_paste","pickElement","checkTree","pasteForAllChildren","copyForAllChildren","clipboardCopy","clipboardPaste","tabIndex","_ondestroy","ondestroy","trigger_on_destroy","on_remove","removeChild","flushUpdate","checkInit","getWinWidth","getWinHeight","calcZ","marginy","nodeclass","excluded_classes","marginx","mouseEvent","isMouseMove","sx","sy","scrollX","scrollY","elementFromPoint","lastelem","reverse","getBoundingClientRect","clip2","math.aabb_intersect_2d","defaults","on_disabled","on_enabled","changed","pointerElem","_areaWrangler","bindFunc","handlers2","_flash_focus","focus","flash","rect_element","timems","autoFocus","csscolor","_flashtimer","_flashcolor","tick","PositionKey","_enterPopupSafe","_exitPopupSafe","on_resize","newsize","getPathValue","undoBreakPoint","setPathValueUndo","loadNumConstraints","onModifiedCallback","modified","getPathMeta","loadAttr","propkey","domkey","thiskey","oldmin","oldmax","oldint","oldedit","setPathValue","getPathDescription","_doOnce","_doOnce_reqs","zindex","positionKey","_ensureChildrenCtx","checkThemeUpdate","abortToolTips","delayMs","stop_timer","updateToolTipHandlers","start_timer","reset_timer","start_events","reset_events","stop_events","bind_handler","etype","lists","updateToolTips","_ToolTip","show","subclassChecksTheme","saveData","loadData","localOnly","overrideClass","overrideClassDefault","_doMobileDefault","mobilekey","hasClassDefault","hasSubDefault","_hasSubDefault","getStyleClass","hasClassSubDefault","_hasClassSubDefault","themeDef","parentStyle","backupkey","checkForMobile","getDefault_intern","getClassDefault","themeobj","overrideTheme","getStyle","animate","_extra_handlers","DOMMatrix","update_trans","background_get","background_set","dx_get","dx_set","dy_get","dy_set","pixkeys","makePixHandler","proxy","receiver","anim","abortAnimations","drawRoundBox2","drawRoundBox","no_clear","_background","quadraticCurveTo","closePath","_getFont_new","do_dpi","getFont","_ensureFont","get_measure_canvas","measureTextBlock","measureText","HTMLCanvasElement","drawText","fillText","PIDX","PSHADOW","PTOT","saveUIData","ni","is_shadow","path2","_ui_version","loadUIData","_saveUIData","_loadUIData","aspect._setUIBase","events.keymap","toolprop.PropTypes","ui_base.UIBase","ui_base.PackFlags","ui_base.IconSheets","ui_base.parsepx","ButtonEventBase","_auto_depress","_highlight","_pressed","bindEvents","depress","_redraw","onclick","_onpress","onpress","captured","blur","_focus","Button","_pressedTime","_pressedTimeout","_last_name","_last_disabled","__pressed","updateDisabled","OldButton","_last_but_update_key","_name","_namePad","_leftPad","_rightPad","_last_w","_last_h","_last_dpi","_lastw","_lasth","_last_bg","updateName","updateWidth","old_bindEvents","_repos_canvas","updateDefaultSize","cssHeight","_calcUpdateKey","updateDPI","tw","ui_base.measureText","_genLabel","updateBorders","lwid","w_add","h2","_getSubKey","draw_text","ui_base.drawRoundBox","lw","_draw_text","ui_base.drawText","TextBoxBase","modalKeyEvents","_editing","_width","_had_error","_change","oninput","isModal","_startModal","_modal","_endModal","startSelected","realtime","select","keydown","on_keypress","editing","_updatePathVal","bwid","bcolor","updateDataPath","is_num","is_int","_prop_update","units.isNumber","ui_base.ErrorColors","checkForTextBox","draggable","nodes","ui_base._setTextboxClass","IconLabel","_icon","ui_base.iconmanager","ValueButtonBase","_value","Check","_checked","span","mup","mover","mleave","_label","prepend","_updatekey","csize","ui_base.Icons","ui_base.getIconManager","updatekey","IconButton","_customIcon","_draw_pressed","_icon_pressed","drawButtonBG","_extraIcon","extraDom","_last_iconsheet","domImage","_on_press","_on_depress","loadstyle","addpx","high","unhigh","_getsize","IconCheck","_drawCheck","updateDrawCheck","_updatePressed","noEmboss","Check1","saveFile","exts","loadFile","readAsArrayBuffer","_testLoadFile","_testSaveFile","createFile","notifier","setNotifier","ContextFlags","IS_VIEW","__idgen","ContextID","CachedDef","_ret_tmp","OverlayClasses","makeDerivedOverlay","ContextOverlay","appstate","_state","last_tool","_last_tool","onRemove","have_new_file","def2","contextDefine","Context","parents","util.getClassParent","excludedKeys","LockedContext","noWarnings","warning","progbar","_props","wrapget","ctx2","loadProperty","contextSystem","overlay","getOwningOverlay","saveProperty","defineProp","setContext","next_key","_inside_map","_fix","fix","perc","progbarNote","validateOverlays","stack2","hasOverlay","getOverlay","override","overrides","pushOverlay","_val_out","inside_map","ikey","__allKeys","ensureProperty","util.getAllKeys","popOverlay","removeOverlay","Test0","Test1","Test2","Test3","resolveDef","testInheritance","Constraint","klst","glst","ks","threshold","funcDv","no_dvs","gs","Solver","constraints","gk","simple","randCons","con","solveStep","cons","ci","ri","solveStepSimple","solve","printError","PackNodeVertex","edges","_absPos","absPos","PackNode","vel","oldpos","copyGraph","idmap","getCenter","loadGraph","graphGetIslands","islands","visit1","island","graphPack","margin_or_args","updateCb","orignodes","decayi","nodemap","disableEdges","edge_c","restlen","loadBoxes","margin1","lasterr","besterr","disableArea","area_c","math.aabb_overlap_area","fakeVerts","fv","solveStep1","solver","rlen","rfac","boxPacker","getpx","debugmenu","Menu","parentMenu","_was_clicked","autoSearchMode","_ignoreFocusEvents","closeOnMouseUp","_submenu","ignoreFirstClick","itemindex","closed","started","activeItem","menustyle","buildStyle","maxx","maxy","_isMenu","onselect","close","menuWrangler","popMenu","onclose","_popup","_select","dir","hasSearchBox","scrollIntoView","selectPrev","selectNext","start_fancy","startFancy","pushMenu","dom2","sbox","dokey","addItemExtra","icon_div","ui_base.makeIconDiv","ui_base.getFont","hwid","twid","hotkey_span","addItem","li","_menu","onfocus","_getBorderStyle","pad1","boxShadow","sepcss","itemRadius","seperator","bar","calcSize","SEP","DropBox","lockTimer","_template","_searchMenuMode","_last_datapath","searchMenuMode","template","setDefault","wasError","_last_dbox_key","_build_menu_template","createMenu","_build_menu","_dropbox","valmap","enummap","uimap","desr","uk","callProp","_convertVal","rects","rheight","haveElectron","popup","ui_base.drawRoundBox2","setLabelOnly","MenuWrangler","menustack","lastPickElemTime","_closetimer","closereq","closetimer","spawnreq","endMenus","searchKeyDown","previousElementSibling","nextElementSibling","findMenu","menu2","closetime","startTimer","stopTimer","_menuWrangler","wrangerStarted","startMenuEventWrangling","setWranglerScreen","getWranglerScreen","doItem","id2","cbfunc","startMenu","safetyDelay","_startMenuEventWrangling","_ui","toolprop.PropFlags","Label","_lastText","_font","fontDefaultName","_updateFont","_enabled_font","_last_font","Container","dataPrefix","massSetPrefix","inherit_packflag","styletag","reversed","_prefixstack","_mass_prefixstack","children","changePathPrefix","newprefix","_joinPrefix","pushMassSetPrefix","pushDataPrefix","popDataPrefix","popMassSetPrefix","scrollTop","scrollLeft","scrollTo","useIcons","enabled_or_sheet","enabled","previous","wrap","rest","themeClass","margin2","horiz","RowFrame","bradius","bline","bstyle","oneAxisMargin","axisPadding","otherPadding","setMargin","setPadding","setSize","saveVisibility","localStorage","storagePrefix","loadVisibility","opened","redrawCurves","listen","on_destroy","_prepend","_add","insert","NodeList","dynamicMenu","dbox","_container_inherit","toolPanel","path_or_cls","createCb","create_cb","defaultsPath","packflag_or_args","toolob","pathlabel","helppicker","hintPickerTool","colorbutton","_getMassPath","noteframe","vecpopup","textarea","checkenum","listenum","col1","col2","wrapChars","isrow","rebuild","last_hash","frame","checks","ignorecb","makecb","checkenum_panel","enumDef","getroot","do_redraw","setHeaderToolTip","twocol","parentDepth","colorPicker","themeOverride","colorpicker","viewer","asDialogFooter","ColumnFrame","TwoColumnFrame","_colWidth","colWidth","Note","_noteid","showExclMark","append","setLabel","mark","ntext","clr","ProgBarNote","_percent","barWidth","bar2","percent","NoteFrame","ui.RowFrame","_h","noteframes","note","addNote","getNoteFrames","sendNote","ui_base.color2css","_sendNote","RichEditor","textOnlyMode","controls","makeicon","execCommand","contentEditable","toggleStrikeThru","ta","getSelection","startNode","getRangeAt","anchorNode","anchorOffset","InputEvent","CustomEvent","formatStart","formatLine","formatEnd","rc","RichViewer","hideScrollBars","showScrollBars","textTransform","VectorPopupButton","VectorPanel","sliders","makeParam","_getNumParam","_setNumParam","__range","_range","vp","uslider","uniformValue","vertical","doupdate","meta","loadNumParam","do_rebuild","ToolTip","_start_time","_estimateSize","ui_base.measureTextBlock","bwidth","toolstack_getter","registerToolStackGetter","vectormath.Vector3","simple_toolsys.UndoFlags","simple_toolsys.ToolFlags","ToolBase","simple_toolsys.ToolOp","_finished","cancel","overdraw","modaldata","AreaResizeTool","side","_side","_borders","RESIZE","getBorders","borders","otherVertex","snapScreenVerts","regenBorders","loadFromVerts","isBorderMovable","oldv1","oldv2","badcount","snapMode","moveBorder","outer","solveAreaConstraints","updateDebugBoxes","_fireResizeCB","SplitTool","canceled","splitArea","_internalRegenAll","RemoveAreaTool","collapseArea","AreaDragTool","dropArea","excludeAreas","cursorbox","boxes","TRANSLATE","_recalcAABB","getBoxRect","sa","doSplit","doSplitDrop","can_rip","floating","areasBorder","expand","removeArea","minmaxArea","editors","editormap","areaname","on_area_inactive","editor","editor2","owning_sarea","switcher","flagUpdate","replaceArea","loadFromPosSize","nsa","makeBoxes","hcolor","box","curbox","setColor","getActiveBox","on_drag","on_dragend","wid","AreaMoveAttachTool","start_mpos2","start_pos","ToolTipViewer","pick","Keymap","ele","tip","AreaFlags","HIDDEN","FLOATING","INDEPENDENT","NO_SWITCHER","NO_HEADER_CONTEXT_MENU","NO_COLLAPSE","SnapLimit","BORDER_ZINDEX_BASE","snap","snap_limit","snapi","ScreenVert","added_id","ScreenHalfEdge","ScreenBorder","_hash","halfedges","_innerstyle","_style","inner","call_menu","bindBorderMenu","movable","FrameManager_ops.AreaResizeTool","usePickElement","on_dblclick","splitTool","removeAreaTool","popupMenu","getOtherSarea","he","_verts","borderLock","valence","sv","a0x","a0y","cursor","alpha","innerbuf","sbuf","_ScreenArea","_contextWrangler","BorderMask","LEFT","BOTTOM","RIGHT","TOP","BorderSides","inactive","areaDragToolEnabled","_area_id","minSize","maxSize","areas","onover","_get_v_suffix","on_fileload","isActiveEditor","buildDataPath","idx1","idx2","areaName","oldsize","on_area_focus","on_area_blur","on_area_active","dontSetLastRef","getBarHeight","header","makeAreaSwitcher","makeAreasEnum","switch_editor","makeHeader","add_note_area","make_draggable","switcherRow","helpRow","callmenu","notef","eventdom","mpre","last_time","do_mousemove","mdown2","areaDragTool","_isDead","afterSTRUCT","ui_base.loadUIData","saved_uidata","_getSavedUIData","ui_base.saveUIData","ScreenArea","_flag","_sarea_id","_pos","wrapVector","bringToFront","snapToScreenSize","freeBorder","makeBorders","getScreenVert","getScreenBorder","existing","switchEditor","moved","checkAreaConstraint","owining_sarea","ui_base._setAreaClass","ThemeEditor","categoryMap","build","doFolder","catkey","help","row2","do_onchange","completeSetCSS","completeUpdate","getpath","cw","setRGBA","panel2","tbox","catkey2","categories","cat","category","strcmp","sliderDomAttributes","updateSliderFromDom","SliderDefaults","NumberSliderBase","skip","NumSlider","_last_label","ma","_last_overarrow","removeAttribute","_last_width","updateConstraints","swapWithTextbox","onmousedown","overArrow","_on_click","dragStart","setMpos","rwidth","rx","szmargin","_getArrowSize","doRange","fire_onchange","setDataPath","checkConstraints","over","last_background","util.MovingAvg","startvalue","startx","sumdelta","fire","dvalue","dsign","on_pointerout","on_pointerover","restore_value","unused_setBG","fromRedraw","fromCSS","backupval","subkey2","boxbg","arrowcolor_base","arrowcolor","parseArrowColor","NumSliderSimpleBase","modal","_last_slider_key","_setFromMouse","_getButtonPos","_invertButtonX","makefunc","pointermove","pointerover","pointerout","pointerleave","pointerenter","pointerup","updateSize","setHighlight","isOverButton","sh","arc","setLineDash","boxw","SliderWithTextbox","_lock_textbox","_labelOnTop","_last_label_on_top","_numslider","_last_value","realTimeTextBox","apply_textbox","linkTextBox","in_onchange","updateLabelOnTop","NumSliderSimple","NumSliderWithTextBox","pagecache","domTransferAttrs","domEventAttrs","parseXML","xml","DOMParser","parseFromString","num_re","getIconFlag","attr","isnum","getPackFlag","getbool","myParseFloat","getfloat","customHandlers","Handler","codefuncs","templateVars","attrs","inheritDomAttrs","inheritDomAttrKeys","XMLDocument","nodeName","tree","Text","Comment","elem2","__elem","getAttributeNames","_container","_basic","pathux_ctx","rule","selectorText","styleMap","stylecode","setStyle","_getattr","codeattrs","eventType","sliderMode","doBox","_handlePathPrefix","ignorePathPrefix","cell","_prop","_codelem","$scope","templateScope","mpath","column","iconflags","noIcons","isDropBox","initPage","parentContainer","loadPage","parentContainer_or_args","loadSourceOnly","modifySourceCB","fetch","makeGenEnum","Curve1DWidget","_on_draw","_gen_type","_lastGen","clipCheck","ymin","ymax","last_update_key","_lastu","updateGenUI","forward_keys","PanelFrame","titleframe","_panel","_closed","headerLabel","__label","_updateClosed","bs","defval","header_radius","boxmargin","paddingleft","paddingright","margintop","marginbottom","marginleft","marginright","_setVisible","_onchange","isClosed","noUpdateClosedContents","display","makeForward","UPW","VPW","sample_rets","inv_sample","colorClipboardCopy","getRGBA","colorClipboardPaste","fieldrand","huefields","getHueField","ImageData","rgb","putImageData","getFieldImage","fieldsize","hsva","width2","height2","fieldsize2","hue","valpow","x2sat","y2val","sat2x","val2y","image2","_update_temp","SimpleBox","HueField","setFromXY","_getPad","hsv","rselector","r_circle","SatValField","_getField","sat","force_update","globalAlpha","ColorField","ui.ColumnFrame","_recalcRGBA","_lastThemeStyle","satvalfield","huefield","setCMYK","setHSVA","getCMYK","_in_update","updateThemeOverride","ColorPicker","colorsPanel","cssText","_no_update_textbox","_setSliders","cmyk","makeCMYKSlider","_setDataPath","colorbox","updateColorBox","ColorPickerButton","_depress","customLabel","labelDom","noLabel","leave","widget","cellsize","totx","toty","verboseDataPath","_last_key","tab_idgen","FAKE_TAB_ID","TabDragEvent","TabItem","tbar","ontabclick","ontabdragstart","ontabdragmove","ontabdragend","helper","extraSize","abssize","abspos","sendEvent","forwardEvent","Event","ModalTabMove","droptarget","dragtab","dragstate","finished","dragcanvas","on_pointerleave","on_pointerenter","on_pointerstart","on_pointerend","_on_move","_dragstate","DragEvent","dragevent","disty","dragok","dataTransfer","DataTransfer","dragimg","g2","drag_g","ti","prev","swapTabs","defaultPrevented","TabBar","movableTabs","tabFontScale","_last_style_key","_last_pos","_doelement","mx","my","_domouse","_fireOnSelect","_doclick","ht","acte","_startMove","updatePos","_ensureNoModal","_tool","edom","_makeOnSelectEvt","getTab","name_or_id","taborder","ntabs","ai","bi","addIconTab","addTab","updateCanvas","tsize","_layout","hpad","iconsize","have_icons","ry","makeTabWatcher","watcher","haveTabDom","_size_cb","noSwitch","preventScroll","focusVisible","activecolor","ypad","worig","removeTab","updateStyle","_last_p_key","TabContainer","_remakeStyle","_last_horiz","_last_bar_pos","_tab","enableDrag","flexDir","bgcolor","icontab","tab2","defineTabEvent","getTabCount","moveTab","updateBarPos","barpos","updateHoriz","TableRow","td","TableFrame","maketd","_tr","_bg","ListItem","setBackground","unhighlight","shadowRoot","is_active","ListBox","onkeydown","removeItem","scrollIntoViewIfNeeded","ProgressCircle","animreq","startTime","flagRedraw","onkey","oncancel","requestAnimationFrame","dth","endTimer","LastKey","getLastToolStruct","LastToolPanel","_tool_id","getToolStackHead","buildTool","fakecls","getTool","apikey","mimeMap","svg","txt","html","cpp","cc","hh","hpp","mjs","cjs","gif","textMimes","isMimeText","getExtension","getMime","PlatformAPI","href","FileDialogArgs","savedata_cb","multi","addToRecentList","filters","FilePath","platform","getPlatformAsync","mod","resolve","electron_api$1","web_api","_nativeTheme","getNativeTheme","remote","getElectron","nativeTheme","ipcRenderer","getElectronVersion","require","myRequire","getFilename","_menu_init","electron_menu_idgen","ElectronMenu","_ipcId","initElectronIpc","closePopup","wrapRemoteCallback","keybase","ipcInit","_themeSource","themeSource","ElectronMenuItem","patchDropBox","emenu","buildElectronMenu","shouldUseDarkColors","iconcache","makeIconKey","invertColors","getNativeIcon","icongen","nativeImage","GetRequiredICOImageSizes","writeFileSync","CTRL","ALT","SHIFT","COMMAND","buildElectronHotkey","buildItem","submenu","accelerator","registerAccelerator","initMenuBar","menuEditor","_roles","roles","edit","app","setApplicationMenu","eargs","defaultPath","_sanitizeFilters","properties","cancelled","filePaths","filters2","extensions","filedata_cb","filePath","filedata","fs","readFileSync","SVG_URL","CanvasOverdraw","shapes","otherChildren","zindex_base","createElementNS","Overdraw","cssPosition","drawTextBubbles","texts","colors","elems","pat","minsize","grads","startpos","box1","box2","circle","TreeItem","treeParent","treeChildren","treeView","treeDepth","_icon1","_icon2","_labelText","_open","_close","TreeView","strokes","updateOverdraw","_forAllChildren","_makeStrokes","ox","oy","rowh","getx","math.MinMax","od","startDrag","lastx","lasty","hx","hy","DragBox","DELETE","iconenum","_onend","ignore","_FrameManager","dockerdebug","areadocker","testSnapScreenVerts","unlisten","propsbar","AreaDocker","needsRebuild","ignoreChange","getArea","switcherData","tab_onchange","detach","addicon","on_addclick","loadTabData","floatArea","moveAttachTool","addTabMenu","getInternalName","area2","areaId","newarea","parentw","newparentw","newparent","ud","makePopupArea","area_class","addEscapeKeyHandler","ScreenArea.Area","ui_menu.startMenuEventWrangling","_events_started","FrameManager_ops.registerToolStackGetter","ui_base.styleScrollBars","update_stack","screen_idgen","get_screen_cb","_on_keydown","purgeUpdateStack","snapLimit","fullScreen","globalCSS","_do_updateSize","_resize_callbacks","needsBorderRegen","_popup_safe","testAllKeyMaps","_screen_id","_popups","screenverts","_vertmap","_edgemap","_idmap","_aabb","dragging","ScreenArea.ScreenArea","listening","listen_timer","schedule_resize","setPosSize","setPos","sheet2","rule2","desc","writable","entries","sval","insertRule","CSSStyleSheet","replaceSync","tag","newScreenArea","sarea2","_allAreas","owning_node","elem_or_x","closeOnMouseOut","popupDelay","draggablePopup","touchpick","mousepick","bad_time","last_pick_time","do_timeout","calcTabOrder","popupArea","trigger_destroy","checkCSSSize","getBoolAttribute","outerHeight","customWindowSize","_DEBUG","_calcSizeKey","_last_ckey1","ui_menu.setWranglerScreen","startEvents","ui_menu.getWranglerScreen","second_pass","__pass","__destroyed","_test_save","getHotKey","execKeyMap","handled","activeElement","__pos","drawUpdate","redraw_all","move","_update_gen","update_intern","updateScrollStyling","_last_scrollstyle_key","popups","cssTextHash","util.strhash","SCOPE_POP","AREA_CTX_POP","scopestack","areastack","regenScreenMesh","regenBorders_stage2","has_he","border2","walkBorderLine","he2","hasBorder","killScreenVertex","dels","killBorder","del","isBorderOuter","_get_debug_overlay","_debug_overlay","wadd","checkOnly","chg","sidea","sideb","dh","bad2","ret2","moveBorderWithoutVerts","halfedge","strict","moveBorderSimple","moveBorderUnused","FrameManager_mesh.SnapLimit","snapArgument","repeat","fitToSize","_set_key","offx","offy","olds","sides","sb","sarea1","_updateAll","_has_evts","onblur","FrameManager_ops.ToolTipViewer","FrameManager_ops.RemoveAreaTool","FrameManager_ops.AreaMoveAttachTool","FrameManager_ops.SplitTool","FrameManager_ops.AreaDragTool","cleanupBorders","mergeBlankAreas","blank","test_struct","screen2","parentElement","ScreenArea.setScreenClass","start_cbs","stop_cbs","keyboardDom","key_event_opts","getScreenFunc","stopEvents","setKeyboardDom","setKeyboardOpts","opts","_onEventsStart","_onEventsStop","sidebar_hash","SideBar","_last_resize_key","closeIcon","_openWidth","needsSetCSS","tabbar","Editor","strct","makeMenuBar","makeSideBar","iconSvg","loadDefaultIconSheet","iconSheet","FileHeader","version_major","version_minor","version_micro","schema","FileFull","objects","FileArgs","doScreen","resetOnLoad","useJSON","fileFlags","fromFileOp","EmptyStruct","saveFilesInJSON","ob","istruct","screenClass","MenuBarEditor","updateHeight","_height","electron_api","flagRebuild","menuRow","registerMenuBarEditor","SimpleAppNewOp","createNewFile","SimpleAppSaveOp","forceDialog","fileExt","startArgs","platform.platform","showSaveDialog","currentFileRef","SimpleAppOpenOp","showOpenDialog","readFile","DataModelClasses","DataModel","EmptyContextClass","GetContextClass","ctxClass","OverlayDerived","Overlay","ui_noteframe.message","ui_noteframe.error","ui_noteframe.warning","progressBar","ui_noteframe.progbarNote","defineAPI","makeAPI","StartArgs","singlePage","iconSizes","iconTileSize","iconsPerRow","registerSaveOpenOps","SimpleScreen","AppState","_ctxClass","fileMagic","fileVersion","_fileExt","_fileExtSet","defaultEditorClass","makeScreen","saveFileSync","loadFileSync","ensureMenuBar","args2","methodsCheck","SimpleContext","getWebFilters","controller.setNotifier","ui_noteframe","showOpenFilePicker","multiple","createWritable","showSaveFilePicker","showSaveDialog_old","fname","saveHandle","handle1","savedata","getFile","arrayBuffer"],"mappings":"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"}