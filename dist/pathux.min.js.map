{"version":3,"file":"pathux.min.js","sources":["../scripts/path-controller/util/polyfill.js","../scripts/path-controller/util/nstructjs_es6.js","../scripts/path-controller/util/mobile-detect.js","../scripts/path-controller/util/util.js","../scripts/path-controller/util/vectormath.js","../scripts/path-controller/toolsys/toolprop_abstract.js","../scripts/core/units.js","../scripts/path-controller/config/config.js","../scripts/path-controller/util/simple_events.js","../scripts/path-controller/util/events.js","../scripts/path-controller/curve/curve1d_base.js","../scripts/path-controller/curve/curve1d_bspline.js","../scripts/path-controller/curve/curve1d_basic.js","../scripts/path-controller/curve/ease.js","../scripts/path-controller/curve/curve1d_anim.js","../scripts/path-controller/curve/curve1d.js","../scripts/path-controller/toolsys/toolprop.js","../scripts/screen/area_wrangler.js","../scripts/path-controller/util/cssutils.js","../scripts/path-controller/util/math.js","../scripts/config/const.js","../scripts/core/ui_theme.js","../scripts/core/anim.js","../scripts/path-controller/util/parseutil.js","../scripts/path-controller/controller/controller_base.js","../scripts/path-controller/toolsys/toolsys.js","../scripts/path-controller/toolsys/toolpath.js","../scripts/path-controller/controller/controller_abstract.js","../scripts/path-controller/controller/controller_ops.js","../scripts/path-controller/controller/controller.js","../scripts/path-controller/util/colorutils.js","../scripts/core/theme.js","../scripts/icon_enum.js","../scripts/core/aspect.js","../scripts/core/ui_base.js","../scripts/widgets/ui_button.js","../scripts/widgets/ui_textbox.js","../scripts/widgets/ui_widgets.js","../scripts/path-controller/util/html5_fileapi.js","../scripts/widgets/ui_menu.js","../scripts/core/ui.js","../scripts/widgets/ui_noteframe.js","../scripts/widgets/ui_richedit.js","../scripts/widgets/ui_widgets2.js","../scripts/screen/FrameManager_ops.js","../scripts/screen/FrameManager_mesh.js","../scripts/screen/ScreenArea.js","../scripts/widgets/theme_editor.js","../scripts/widgets/ui_numsliders.js","../scripts/xmlpage/xmlpage.js","../scripts/path-controller/curve/curve1d_utils.js","../scripts/widgets/ui_curvewidget.js","../scripts/widgets/ui_panel.js","../scripts/widgets/ui_colorpicker2.js","../scripts/widgets/ui_tabs.js","../scripts/widgets/ui_table.js","../scripts/widgets/ui_listbox.js","../scripts/widgets/ui_progress.js","../scripts/widgets/ui_lasttool.js","../scripts/path-controller/util/solver.js","../scripts/path-controller/util/graphpack.js","../scripts/path-controller/controller/context.js","../scripts/path-controller/controller.js","../scripts/platforms/platform.js","../scripts/platforms/platform_base.js","../scripts/platforms/electron/electron_api.js","../scripts/util/ScreenOverdraw.js","../scripts/widgets/ui_treeview.js","../scripts/widgets/dragbox.js","../scripts/screen/AreaDocker.js","../scripts/screen/FrameManager.js","../scripts/widgets/ui_dialog.js","../scripts/simple/editor.js","../scripts/simple/iconsheet.js","../scripts/simple/icons.js","../scripts/simple/file.js","../scripts/simple/menubar.js","../scripts/simple/app_ops.js","../scripts/simple/app.js","../scripts/simple/context_class.js","../scripts/pathux.js","../scripts/platforms/web/web_api.js"],"sourcesContent":["if (typeof window === \"undefined\" && typeof global !== \"undefined\") {\r\n  global.window = global;\r\n}\r\n\r\n(function () {\r\n  let visitgen = 0;\r\n\r\n  window.destroyAllCSS = function () {\r\n    visitgen++;\r\n\r\n    let visit = (n) => {\r\n      if (n.__visit === visitgen) {\r\n        return;\r\n      }\r\n\r\n      n.__visit = visitgen;\r\n      if (n.tagName === \"STYLE\") {\r\n        n.textContents = '';\r\n      }\r\n\r\n      if (n.style) {\r\n        for (let k in n.style) {\r\n          try {\r\n            n.style[k] = \"\";\r\n          } catch (error) {\r\n\r\n          }\r\n        }\r\n      }\r\n\r\n      if (!n.childNodes) {\r\n        return;\r\n      }\r\n\r\n      for (let c of n.childNodes) {\r\n        visit(c);\r\n      }\r\n    }\r\n\r\n    visit(document.head);\r\n    visit(document.body);\r\n\r\n    for (let sheet of document.styleSheets) {\r\n      for (let i = 0; i < sheet.rules.length; i++) {\r\n        sheet.removeRule(sheet.rules[0]);\r\n      }\r\n    }\r\n  }\r\n})();\r\n\r\nwindow.eventDebugModule = (function () {\r\n  \"use strict\";\r\n\r\n  return {\r\n    start() {\r\n      window.debugEventLists = {}\r\n      window.debugEventList = [];\r\n\r\n      this._addEventListener = EventTarget.prototype.addEventListener;\r\n      this._removeEventListener = EventTarget.prototype.removeEventListener;\r\n      this._dispatchEvent = EventTarget.prototype.dispatchEvent;\r\n\r\n      EventTarget.prototype.addEventListener = this.onadd;\r\n      EventTarget.prototype.removeEventListener = this.onrem;\r\n      EventTarget.prototype.dispatchEvent = this.ondispatch;\r\n    },\r\n\r\n    add(type, data) {\r\n      if (!(type in debugEventLists)) {\r\n        debugEventLists[type] = [];\r\n      }\r\n\r\n      debugEventLists[type].push(data);\r\n    },\r\n\r\n    ondispatch() {\r\n      let a = arguments;\r\n\r\n      eventDebugModule.add(\"Dispatch\", {\r\n        event    : a[0],\r\n        thisvar  : a[4],\r\n        line     : a[5],\r\n        filename : a[6].replace(/\\\\/g, \"/\"),\r\n        filepath : location.origin + a[6].replace(/\\\\/g, \"/\") + \":\" + a[5],\r\n        ownerpath: a[7]\r\n      });\r\n\r\n      return eventDebugModule._dispatchEvent.apply(this, arguments);\r\n    },\r\n\r\n    onadd() {\r\n      let a = arguments;\r\n\r\n      eventDebugModule.add(\"Add\", {\r\n        type     : a[0],\r\n        cb       : a[1],\r\n        args     : a[2],\r\n        thisvar  : a[4],\r\n        line     : a[5],\r\n        filename : a[6].replace(/\\\\/g, \"/\"),\r\n        filepath : location.origin + a[6].replace(/\\\\/g, \"/\") + \":\" + a[5],\r\n        ownerpath: a[7]\r\n      });\r\n\r\n\r\n      return eventDebugModule._addEventListener.apply(this, arguments);\r\n    },\r\n\r\n    pruneConnected() {\r\n      for (let k in debugEventLists) {\r\n        let list = debugEventLists[k];\r\n\r\n        for (let i = 0; i < list.length; i++) {\r\n          let e = list[i];\r\n\r\n          if (!e.thisvar || !(e.thisvar instanceof Node)) {\r\n            continue;\r\n          }\r\n\r\n          if (!e.thisvar.isConnected) {\r\n            list[i] = list[list.length - 1];\r\n            list[list.length - 1] = undefined;\r\n            list.length--;\r\n            i--;\r\n          }\r\n        }\r\n      }\r\n    },\r\n\r\n\r\n    onrem() {\r\n      let a = arguments;\r\n\r\n      eventDebugModule.add(\"Rem\", {\r\n        type     : a[0],\r\n        cb       : a[1],\r\n        args     : a[2],\r\n        thisvar  : a[4],\r\n        line     : a[5],\r\n        filename : a[6].replace(/\\\\/g, \"/\"),\r\n        filepath : location.origin + a[6].replace(/\\\\/g, \"/\") + \":\" + a[5],\r\n        ownerpath: a[7]\r\n      });\r\n\r\n\r\n      return eventDebugModule._removeEventListener.apply(this, arguments);\r\n    }\r\n  }\r\n})();\r\n\r\nif (typeof _debug_event_listeners !== \"undefined\" && _debug_event_listeners) {\r\n  eventDebugModule.start();\r\n}\r\n\r\n/*\r\nif (navigator.userAgent.toLowerCase().search(\"chrome\") >= 0) {\r\n  console.warn(\"Patching Google Chrome scrollbar bug\");\r\n\r\n  let cb = (e) => {\r\n    if (e.touches.length == 1) {\r\n      let e2 = Object.create(e);\r\n      e2.pageX = e.touches[0].pageX;\r\n      e2.pageY = e.touches[0].pageY;\r\n      e2.x = e2.screenX = e2.pageX;\r\n      e2.y = e2.screenY = e2.pageY;\r\n      e2.button = 0;\r\n      e2.buttons = 1;\r\n\r\n      let type;\r\n      if (e.type === \"touchstart\")\r\n        type = \"mousedown\";\r\n      else \r\n        type = \"mousemove\";\r\n\r\n      console.log(e2);\r\n        //console.log(e.target);\r\n      e2 = new MouseEvent(type, e);\r\n      e.target.dispatchEvent(e2);\r\n    }\r\n  };\r\n\r\n  window.addEventListener(\"touchstart\", (e) => cb(e));\r\n  window.addEventListener(\"touchmove\", (e) => cb(e));\r\n\r\n  document.addEventListener(\"touchstart\", (e) => cb(e));\r\n  document.addEventListener(\"touchmove\", (e) => cb(e));\r\n}\r\n//*/\r\n\r\nif (window._disable_all_listeners) {\r\n  console.warn(\"Disabling all event listeners\");\r\n  EventTarget.prototype.addEventListener = () => {\r\n  };\r\n  EventSource.prototype.addEventListener = () => {\r\n  };\r\n}\r\n\r\nif (typeof visualViewport === \"undefined\") {\r\n  (function () {\r\n    class MyVisualViewport {\r\n      get width() {\r\n        return window.innerWidth;\r\n      }\r\n\r\n      get height() {\r\n        return window.innerHeight;\r\n      }\r\n\r\n      get offsetLeft() {\r\n        return 0;\r\n      }\r\n\r\n      get offsetTop() {\r\n        return 0;\r\n      }\r\n\r\n      get pageLeft() {\r\n        return 0;\r\n      }\r\n\r\n      get pageTop() {\r\n        return 0;\r\n      }\r\n\r\n      get scale() {\r\n        return 1.0;\r\n      }\r\n    }\r\n\r\n    window.visualViewport = new MyVisualViewport();\r\n  })();\r\n}\r\n\r\nif (Array.prototype.set === undefined) {\r\n  Array.prototype.set = function set(array, src, dst, count) {\r\n    if (arguments.length === 0) {\r\n      //WASM somehow manages to call this\r\n      return;\r\n    }\r\n\r\n    src = src === undefined ? 0 : src;\r\n    dst = dst === undefined ? 0 : dst;\r\n    count = count === undefined ? array.length : count;\r\n\r\n    if (count < 0) {\r\n      throw new RangeError(\"Count must be >= zero\");\r\n    }\r\n\r\n    let len = Math.min(this.length - dst, array.length - src);\r\n    len = Math.min(len, count);\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      this[dst + i] = array[src + i];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  Object.defineProperty(Array.prototype, \"set\", {\r\n    enumerable  : false,\r\n    configurable: true,\r\n  });\r\n\r\n  if (Float64Array.prototype.set === undefined) {\r\n    Float64Array.prototype.set = Array.prototype.set;\r\n    Float32Array.prototype.set = Array.prototype.set;\r\n    Uint8Array.prototype.set = Array.prototype.set;\r\n    Uint8ClampedArray.prototype.set = Array.prototype.set;\r\n    Int32Array.prototype.set = Array.prototype.set;\r\n    Int16Array.prototype.set = Array.prototype.set;\r\n    Int8Array.prototype.set = Array.prototype.set;\r\n  }\r\n}\r\n\r\nif (Array.prototype.reject === undefined) {\r\n  Array.prototype.reject = function reject(func) {\r\n    return this.filter((item) => !func(item));\r\n  }\r\n\r\n  Object.defineProperty(Array.prototype, \"reject\", {\r\n    enumerable  : false,\r\n    configurable: true,\r\n  });\r\n}\r\n\r\nif (window.Symbol == undefined) { //eek!\r\n  window.Symbol = {\r\n    iterator: \"$__iterator__$\",\r\n    keystr  : \"$__keystr__$\"\r\n  }\r\n} else if (Symbol.keystr === undefined) {\r\n  Symbol.keystr = Symbol(\"keystr\");\r\n}\r\n\r\n/* use util.list\r\nwindow.list = function list(iter) {\r\n  var ret = [];\r\n\r\n  if (typeof iter == \"string\") {\r\n    iter = new String();\r\n  }\r\n\r\n  if (Symbol.iterator in iter) {\r\n    for (var item of iter) {\r\n      ret.push(item);\r\n    }\r\n  } else {\r\n    iter.forEach(function (item) {\r\n      ret.push(item);\r\n    }, this);\r\n  }\r\n\r\n  return ret;\r\n};*/\r\n\r\n//XXX surely browser vendors have fixed this by now. . .\r\n/*Override array iterator to not allocate too much*/\r\n\r\n/*\r\nfunction ArrayIter(array) {\r\n  this.array = array;\r\n  this.i = 0;\r\n  this.ret = {done : false, value : undefined};\r\n}\r\n\r\nArrayIter.prototype[Symbol.iterator] = function() {\r\n  return this;\r\n}\r\n\r\nArrayIter.prototype.next = function() {\r\n  var ret = this.ret;\r\n  \r\n  if (this.i >= this.array.length) {\r\n    ret.done = true;\r\n    ret.value = undefined;\r\n    return ret;\r\n  }\r\n  \r\n  ret.value = this.array[this.i++];\r\n  return ret;\r\n};//*/\r\n\r\n\r\n//Array.prototype[Symbol.iterator] = function() {\r\n//  return new ArrayIter(this);\r\n//}\r\n\r\nif (Math.fract === undefined) {\r\n  Math.fract = function fract(f) {\r\n    return f - Math.floor(f);\r\n  };\r\n}\r\n\r\nif (Math.tent === undefined) {\r\n  Math.tent = function tent(f) {\r\n    return 1.0 - Math.abs(Math.fract(f) - 0.5)*2.0;\r\n  };\r\n}\r\n\r\nif (Math.sign === undefined) {\r\n  Math.sign = function sign(f) {\r\n    return (f > 0.0)*2.0 - 1.0;\r\n  };\r\n}\r\n\r\nif (Array.prototype.pop_i === undefined) {\r\n  Array.prototype.pop_i = function (idx) {\r\n    if (idx < 0 || idx >= this.length) {\r\n      throw new Error(\"Index out of range\");\r\n    }\r\n\r\n    while (idx < this.length) {\r\n      this[idx] = this[idx + 1];\r\n      idx++;\r\n    }\r\n\r\n    this.length -= 1;\r\n  }\r\n\r\n  Object.defineProperty(Array.prototype, \"pop_i\", {\r\n    enumerable  : false,\r\n    configurable: true,\r\n  });\r\n}\r\n\r\nif (Array.prototype.remove === undefined) {\r\n  Array.prototype.remove = function (item, suppress_error) {\r\n    var i = this.indexOf(item);\r\n\r\n    if (i < 0) {\r\n      if (suppress_error)\r\n        console.trace(\"Warning: item not in array\", item);\r\n      else\r\n        throw new Error(\"Error: item not in array \" + item);\r\n\r\n      return;\r\n    }\r\n\r\n    this.pop_i(i);\r\n  }\r\n\r\n  Object.defineProperty(Array.prototype, \"remove\", {\r\n    enumerable  : false,\r\n    configurable: true,\r\n  });\r\n}\r\n\r\nif (String.prototype.contains === undefined) {\r\n  String.prototype.contains = function (substr) {\r\n    return String.search(substr) >= 0;\r\n  }\r\n}\r\n\r\nString.prototype[Symbol.keystr] = function () {\r\n  return this;\r\n};\r\n\r\nNumber.prototype[Symbol.keystr] = Boolean.prototype[Symbol.keystr] = function () {\r\n  return \"\" + this;\r\n};\r\n\r\nArray.prototype[Symbol.keystr] = function () {\r\n  let key = \"\";\r\n  for (let item of this) {\r\n    key += item[Symbol.keystr]() + \":\";\r\n  }\r\n\r\n  return key;\r\n};\r\n","\"use strict\";\r\n/*\r\nThe lexical scanner in this module was inspired by PyPLY\r\n\r\nhttp://www.dabeaz.com/ply/ply.html\r\n*/\r\n\r\nclass token {\r\n  constructor(type, val, lexpos, lineno, lexer, parser) {\r\n    this.type = type;\r\n    this.value = val;\r\n    this.lexpos = lexpos;\r\n    this.lineno = lineno;\r\n    this.lexer = lexer;\r\n    this.parser = parser;\r\n  }\r\n\r\n  toString() {\r\n    if (this.value !== undefined)\r\n      return \"token(type=\" + this.type + \", value='\" + this.value + \"')\";\r\n    else\r\n      return \"token(type=\" + this.type + \")\";\r\n  }\r\n}\r\n\r\nclass tokdef {\r\n  constructor(name, regexpr, func, example) {\r\n    this.name = name;\r\n    this.re = regexpr;\r\n    this.func = func;\r\n    this.example = example;\r\n    \r\n    if (example === undefined && regexpr) {\r\n      let s = \"\" + regexpr;\r\n      if (s.startsWith(\"/\") && s.endsWith(\"/\")) {\r\n        s = s.slice(1, s.length-1);\r\n      }\r\n      \r\n      if (s.startsWith(\"\\\\\")) {\r\n        s = s.slice(1, s.length);\r\n      }\r\n      s = s.trim();\r\n      \r\n      if (s.length === 1) {\r\n        this.example = s;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nclass PUTIL_ParseError extends Error {\r\n  constructor(msg) {\r\n    super();\r\n  }\r\n}\r\n\r\nclass lexer {\r\n  constructor(tokdef, errfunc) {\r\n    this.tokdef = tokdef;\r\n    this.tokens = new Array();\r\n    this.lexpos = 0;\r\n    this.lexdata = \"\";\r\n    this.lineno = 0;\r\n    this.errfunc = errfunc;\r\n    this.tokints = {};\r\n    for (let i = 0; i < tokdef.length; i++) {\r\n      this.tokints[tokdef[i].name] = i;\r\n    }\r\n    this.statestack = [[\"__main__\", 0]];\r\n    this.states = {\"__main__\": [tokdef, errfunc]};\r\n    this.statedata = 0;\r\n  }\r\n\r\n  add_state(name, tokdef, errfunc) {\r\n    if (errfunc === undefined) {\r\n      errfunc = function (lexer) {\r\n        return true;\r\n      };\r\n    }\r\n    this.states[name] = [tokdef, errfunc];\r\n  }\r\n\r\n  tok_int(name) {\r\n  }\r\n\r\n  push_state(state, statedata) {\r\n    this.statestack.push([state, statedata]);\r\n    state = this.states[state];\r\n    this.statedata = statedata;\r\n    this.tokdef = state[0];\r\n    this.errfunc = state[1];\r\n  }\r\n\r\n  pop_state() {\r\n    let item = this.statestack[this.statestack.length - 1];\r\n    let state = this.states[item[0]];\r\n    this.tokdef = state[0];\r\n    this.errfunc = state[1];\r\n    this.statedata = item[1];\r\n  }\r\n\r\n  input(str) {\r\n    while (this.statestack.length > 1) {\r\n      this.pop_state();\r\n    }\r\n    this.lexdata = str;\r\n    this.lexpos = 0;\r\n    this.lineno = 0;\r\n    this.tokens = new Array();\r\n    this.peeked_tokens = [];\r\n  }\r\n\r\n  error() {\r\n    if (this.errfunc !== undefined && !this.errfunc(this))\r\n      return;\r\n\r\n    console.log(\"Syntax error near line \" + this.lineno);\r\n\r\n    let next = Math.min(this.lexpos + 8, this.lexdata.length);\r\n    console.log(\"  \" + this.lexdata.slice(this.lexpos, next));\r\n\r\n    throw new PUTIL_ParseError(\"Parse error\");\r\n  }\r\n\r\n  peek() {\r\n    let tok = this.next(true);\r\n    if (tok === undefined)\r\n      return undefined;\r\n    this.peeked_tokens.push(tok);\r\n    return tok;\r\n  }\r\n\r\n  peeknext() {\r\n    if (this.peeked_tokens.length > 0) {\r\n      return this.peeked_tokens[0];\r\n    }\r\n\r\n    return this.peek();\r\n  }\r\n\r\n  at_end() {\r\n    return this.lexpos >= this.lexdata.length && this.peeked_tokens.length === 0;\r\n  }\r\n\r\n  //ignore_peek is optional, false\r\n  next(ignore_peek) {\r\n    if (!ignore_peek && this.peeked_tokens.length > 0) {\r\n      let tok = this.peeked_tokens[0];\r\n      this.peeked_tokens.shift();\r\n      return tok;\r\n    }\r\n\r\n    if (this.lexpos >= this.lexdata.length)\r\n      return undefined;\r\n\r\n    let ts = this.tokdef;\r\n    let tlen = ts.length;\r\n    let lexdata = this.lexdata.slice(this.lexpos, this.lexdata.length);\r\n    let results = [];\r\n\r\n    for (var i = 0; i < tlen; i++) {\r\n      let t = ts[i];\r\n      if (t.re === undefined)\r\n        continue;\r\n      let res = t.re.exec(lexdata);\r\n      if (res !== null && res !== undefined && res.index === 0) {\r\n        results.push([t, res]);\r\n      }\r\n    }\r\n\r\n    let max_res = 0;\r\n    let theres = undefined;\r\n    for (var i = 0; i < results.length; i++) {\r\n      let res = results[i];\r\n      if (res[1][0].length > max_res) {\r\n        theres = res;\r\n        max_res = res[1][0].length;\r\n      }\r\n    }\r\n\r\n    if (theres === undefined) {\r\n      this.error();\r\n      return;\r\n    }\r\n\r\n    let def = theres[0];\r\n    let tok = new token(def.name, theres[1][0], this.lexpos, this.lineno, this, undefined);\r\n    this.lexpos += tok.value.length;\r\n\r\n    if (def.func) {\r\n      tok = def.func(tok);\r\n      if (tok === undefined) {\r\n        return this.next();\r\n      }\r\n    }\r\n\r\n    return tok;\r\n  }\r\n}\r\n\r\nclass parser {\r\n  constructor(lexer, errfunc) {\r\n    this.lexer = lexer;\r\n    this.errfunc = errfunc;\r\n    this.start = undefined;\r\n  }\r\n\r\n  parse(data, err_on_unconsumed) {\r\n    if (err_on_unconsumed === undefined)\r\n      err_on_unconsumed = true;\r\n\r\n    if (data !== undefined)\r\n      this.lexer.input(data);\r\n\r\n    let ret = this.start(this);\r\n\r\n    if (err_on_unconsumed && !this.lexer.at_end() && this.lexer.next() !== undefined) {\r\n      this.error(undefined, \"parser did not consume entire input\");\r\n    }\r\n    return ret;\r\n  }\r\n\r\n  input(data) {\r\n    this.lexer.input(data);\r\n  }\r\n\r\n  error(token, msg) {\r\n    let estr;\r\n\r\n    if (msg === undefined)\r\n      msg = \"\";\r\n    if (token === undefined)\r\n      estr = \"Parse error at end of input: \" + msg;\r\n    else\r\n      estr = \"Parse error at line \" + (token.lineno + 1) + \": \" + msg;\r\n\r\n    let buf = \"1| \";\r\n    let ld = this.lexer.lexdata;\r\n    let l = 1;\r\n    for (var i = 0; i < ld.length; i++) {\r\n      let c = ld[i];\r\n      if (c === '\\n') {\r\n        l++;\r\n        buf += \"\\n\" + l + \"| \";\r\n      }\r\n      else {\r\n        buf += c;\r\n      }\r\n    }\r\n    console.log(\"------------------\");\r\n    console.log(buf);\r\n    console.log(\"==================\");\r\n    console.log(estr);\r\n    if (this.errfunc && !this.errfunc(token)) {\r\n      return;\r\n    }\r\n    throw new PUTIL_ParseError(estr);\r\n  }\r\n\r\n  peek() {\r\n    let tok = this.lexer.peek();\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n    return tok;\r\n  }\r\n\r\n  peeknext() {\r\n    let tok = this.lexer.peeknext();\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n    return tok;\r\n  }\r\n\r\n  next() {\r\n    let tok = this.lexer.next();\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n    return tok;\r\n  }\r\n\r\n  optional(type) {\r\n    let tok = this.peek();\r\n    if (tok === undefined)\r\n      return false;\r\n    if (tok.type === type) {\r\n      this.next();\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  at_end() {\r\n    return this.lexer.at_end();\r\n  }\r\n\r\n  expect(type, msg) {\r\n    let tok = this.next();\r\n    \r\n    if (msg === undefined) {\r\n      msg = type;\r\n      \r\n      for (let tk of this.lexer.tokdef) {\r\n        if (tk.name === type && tk.example) {\r\n          msg = tk.example;\r\n        }\r\n      }\r\n    }\r\n    \r\n    if (tok === undefined || tok.type !== type) {\r\n      this.error(tok, \"Expected \" + msg);\r\n    }\r\n    return tok.value;\r\n  }\r\n}\r\n\r\nfunction test_parser() {\r\n  let basic_types = new set([\"int\", \"float\", \"double\", \"vec2\", \"vec3\", \"vec4\", \"mat4\", \"string\"]);\r\n  let reserved_tokens = new set([\"int\", \"float\", \"double\", \"vec2\", \"vec3\", \"vec4\", \"mat4\", \"string\", \"static_string\", \"array\"]);\r\n\r\n  function tk(name, re, func) {\r\n    return new tokdef(name, re, func);\r\n  }\r\n\r\n  let tokens = [tk(\"ID\", /[a-zA-Z]+[a-zA-Z0-9_]*/, function (t) {\r\n    if (reserved_tokens.has(t.value)) {\r\n      t.type = t.value.toUpperCase();\r\n    }\r\n    return t;\r\n  }), tk(\"OPEN\", /\\{/), tk(\"CLOSE\", /}/), tk(\"COLON\", /:/), tk(\"JSCRIPT\", /\\|/, function (t) {\r\n    let js = \"\";\r\n    let lexer = t.lexer;\r\n    while (lexer.lexpos < lexer.lexdata.length) {\r\n      let c = lexer.lexdata[lexer.lexpos];\r\n      if (c === \"\\n\")\r\n        break;\r\n      js += c;\r\n      lexer.lexpos++;\r\n    }\r\n    if (js.endsWith(\";\")) {\r\n      js = js.slice(0, js.length - 1);\r\n      lexer.lexpos--;\r\n    }\r\n    t.value = js;\r\n    return t;\r\n  }), tk(\"LPARAM\", /\\(/), tk(\"RPARAM\", /\\)/), tk(\"COMMA\", /,/), tk(\"NUM\", /[0-9]/), tk(\"SEMI\", /;/), tk(\"NEWLINE\", /\\n/, function (t) {\r\n    t.lexer.lineno += 1;\r\n  }), tk(\"SPACE\", / |\\t/, function (t) {\r\n  })];\r\n  let __iter_rt = __get_iter(reserved_tokens);\r\n  let rt;\r\n  while (1) {\r\n    let __ival_rt = __iter_rt.next();\r\n    if (__ival_rt.done) {\r\n      break;\r\n    }\r\n    rt = __ival_rt.value;\r\n    tokens.push(tk(rt.toUpperCase()));\r\n  }\r\n  let a = \"\\n  Loop {\\n    eid : int;\\n    flag : int;\\n    index : int;\\n    type : int;\\n\\n    co : vec3;\\n    no : vec3;\\n    loop : int | eid(loop);\\n    edges : array(e, int) | e.eid;\\n\\n    loops : array(Loop);\\n  }\\n  \";\r\n\r\n  function errfunc(lexer) {\r\n    return true;\r\n  }\r\n\r\n  let lex = new lexer(tokens, errfunc);\r\n  console.log(\"Testing lexical scanner...\");\r\n  lex.input(a);\r\n  let token;\r\n  while (token = lex.next()) {\r\n    console.log(token.toString());\r\n  }\r\n  let parser = new parser(lex);\r\n  parser.input(a);\r\n\r\n  function p_Array(p) {\r\n    p.expect(\"ARRAY\");\r\n    p.expect(\"LPARAM\");\r\n    let arraytype = p_Type(p);\r\n    let itername = \"\";\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = arraytype;\r\n      arraytype = p_Type(p);\r\n    }\r\n    p.expect(\"RPARAM\");\r\n    return {type: \"array\", data: {type: arraytype, iname: itername}}\r\n  }\r\n\r\n  function p_Type(p) {\r\n    let tok = p.peek();\r\n    if (tok.type === \"ID\") {\r\n      p.next();\r\n      return {type: \"struct\", data: \"\\\"\" + tok.value + \"\\\"\"}\r\n    }\r\n    else if (basic_types.has(tok.type.toLowerCase())) {\r\n      p.next();\r\n      return {type: tok.type.toLowerCase()}\r\n    }\r\n    else if (tok.type === \"ARRAY\") {\r\n      return p_Array(p);\r\n    }\r\n    else {\r\n      p.error(tok, \"invalid type \" + tok.type);\r\n    }\r\n  }\r\n\r\n  function p_Field(p) {\r\n    let field = {};\r\n    console.log(\"-----\", p.peek().type);\r\n    field.name = p.expect(\"ID\", \"struct field name\");\r\n    p.expect(\"COLON\");\r\n    field.type = p_Type(p);\r\n    field.set = undefined;\r\n    field.get = undefined;\r\n    let tok = p.peek();\r\n    if (tok.type === \"JSCRIPT\") {\r\n      field.get = tok.value;\r\n      p.next();\r\n    }\r\n    tok = p.peek();\r\n    if (tok.type === \"JSCRIPT\") {\r\n      field.set = tok.value;\r\n      p.next();\r\n    }\r\n    p.expect(\"SEMI\");\r\n    return field;\r\n  }\r\n\r\n  function p_Struct(p) {\r\n    let st = {};\r\n    st.name = p.expect(\"ID\", \"struct name\");\r\n    st.fields = [];\r\n    p.expect(\"OPEN\");\r\n    while (1) {\r\n      if (p.at_end()) {\r\n        p.error(undefined);\r\n      }\r\n      else if (p.optional(\"CLOSE\")) {\r\n        break;\r\n      }\r\n      else {\r\n        st.fields.push(p_Field(p));\r\n      }\r\n    }\r\n    return st;\r\n  }\r\n\r\n  let ret = p_Struct(parser);\r\n  console.log(JSON.stringify(ret));\r\n}\r\n\r\nvar struct_parseutil = /*#__PURE__*/Object.freeze({\r\n  __proto__: null,\r\n  token: token,\r\n  tokdef: tokdef,\r\n  PUTIL_ParseError: PUTIL_ParseError,\r\n  lexer: lexer,\r\n  parser: parser\r\n});\r\n\r\n\"use strict\";\r\n\r\nclass NStruct {\r\n  constructor(name) {\r\n    this.fields = [];\r\n    this.id = -1;\r\n    this.name = name;\r\n  }\r\n}\r\n\r\n//the discontinuous id's are to make sure\r\n//the version I originally wrote (which had a few application-specific types)\r\n//and this one do not become totally incompatible.\r\nconst StructEnum = {\r\n  T_INT          : 0,\r\n  T_FLOAT        : 1,\r\n  T_DOUBLE       : 2,\r\n  T_STRING       : 7,\r\n  T_STATIC_STRING: 8, //fixed-length string\r\n  T_STRUCT       : 9,\r\n  T_TSTRUCT      : 10,\r\n  T_ARRAY        : 11,\r\n  T_ITER         : 12,\r\n  T_SHORT        : 13,\r\n  T_BYTE         : 14,\r\n  T_BOOL         : 15,\r\n  T_ITERKEYS     : 16,\r\n  T_UINT         : 17,\r\n  T_USHORT       : 18,\r\n  T_STATIC_ARRAY : 19,\r\n  T_SIGNED_BYTE  : 20\r\n};\r\n\r\nconst ValueTypes = new Set([\r\n  StructEnum.T_INT,\r\n  StructEnum.T_FLOAT,\r\n  StructEnum.T_DOUBLE,\r\n  StructEnum.T_STRING,\r\n  StructEnum.T_STATIC_STRING,\r\n  StructEnum.T_SHORT,\r\n  StructEnum.T_BYTE,\r\n  StructEnum.T_BOOL,\r\n  StructEnum.T_UINT,\r\n  StructEnum.T_USHORT,\r\n  StructEnum.T_SIGNED_BYTE\r\n\r\n]);\r\n\r\nlet StructTypes = {\r\n  \"int\"          : StructEnum.T_INT,\r\n  \"uint\"         : StructEnum.T_UINT,\r\n  \"ushort\"       : StructEnum.T_USHORT,\r\n  \"float\"        : StructEnum.T_FLOAT,\r\n  \"double\"       : StructEnum.T_DOUBLE,\r\n  \"string\"       : StructEnum.T_STRING,\r\n  \"static_string\": StructEnum.T_STATIC_STRING,\r\n  \"struct\"       : StructEnum.T_STRUCT,\r\n  \"abstract\"     : StructEnum.T_TSTRUCT,\r\n  \"array\"        : StructEnum.T_ARRAY,\r\n  \"iter\"         : StructEnum.T_ITER,\r\n  \"short\"        : StructEnum.T_SHORT,\r\n  \"byte\"         : StructEnum.T_BYTE,\r\n  \"bool\"         : StructEnum.T_BOOL,\r\n  \"iterkeys\"     : StructEnum.T_ITERKEYS,\r\n  \"sbyte\"        : StructEnum.T_SIGNED_BYTE\r\n};\r\n\r\nlet StructTypeMap = {};\r\n\r\nfor (let k in StructTypes) {\r\n  StructTypeMap[StructTypes[k]] = k;\r\n}\r\n\r\nfunction gen_tabstr(t) {\r\n  let s = \"\";\r\n  for (let i = 0; i < t; i++) {\r\n    s += \"  \";\r\n  }\r\n  return s;\r\n}\r\n\r\nfunction StructParser() {\r\n  let basic_types = new Set([\r\n    \"int\", \"float\", \"double\", \"string\", \"short\", \"byte\", \"sbyte\", \"bool\", \"uint\", \"ushort\"\r\n  ]);\r\n\r\n  let reserved_tokens = new Set([\r\n    \"int\", \"float\", \"double\", \"string\", \"static_string\", \"array\",\r\n    \"iter\", \"abstract\", \"short\", \"byte\", \"sbyte\", \"bool\", \"iterkeys\", \"uint\", \"ushort\",\r\n    \"static_array\"\r\n  ]);\r\n\r\n  function tk(name, re, func) {\r\n    return new tokdef(name, re, func);\r\n  }\r\n\r\n  let tokens = [\r\n    tk(\"ID\", /[a-zA-Z_$]+[a-zA-Z0-9_\\.$]*/, function (t) {\r\n\r\n      if (reserved_tokens.has(t.value)) {\r\n        t.type = t.value.toUpperCase();\r\n      }\r\n      return t;\r\n    }, \"identifier\"),\r\n    tk(\"OPEN\", /\\{/),\r\n    tk(\"EQUALS\", /=/),\r\n    tk(\"CLOSE\", /}/),\r\n    tk(\"COLON\", /:/),\r\n    tk(\"SOPEN\", /\\[/),\r\n    tk(\"SCLOSE\", /\\]/),\r\n    tk(\"JSCRIPT\", /\\|/, function (t) {\r\n      let js = \"\";\r\n      let lexer = t.lexer;\r\n      while (lexer.lexpos < lexer.lexdata.length) {\r\n        let c = lexer.lexdata[lexer.lexpos];\r\n        if (c === \"\\n\")\r\n          break;\r\n        js += c;\r\n        lexer.lexpos++;\r\n      }\r\n\r\n      while (js.trim().endsWith(\";\")) {\r\n        js = js.slice(0, js.length - 1);\r\n        lexer.lexpos--;\r\n      }\r\n      t.value = js.trim();\r\n      return t;\r\n    }),\r\n    tk(\"LPARAM\", /\\(/),\r\n    tk(\"RPARAM\", /\\)/),\r\n    tk(\"COMMA\", /,/),\r\n    tk(\"NUM\", /[0-9]+/, undefined, \"number\"),\r\n    tk(\"SEMI\", /;/),\r\n    tk(\"NEWLINE\", /\\n/, function (t) {\r\n      t.lexer.lineno += 1;\r\n    }, \"newline\"),\r\n    tk(\"SPACE\", / |\\t/, function (t) {\r\n    }, \"whitespace\")\r\n  ];\r\n\r\n  reserved_tokens.forEach(function (rt) {\r\n    tokens.push(tk(rt.toUpperCase()));\r\n  });\r\n\r\n  function errfunc(lexer) {\r\n    return true;\r\n  }\r\n\r\n  let lex = new lexer(tokens, errfunc);\r\n  let parser$1 = new parser(lex);\r\n\r\n  function p_Static_String(p) {\r\n    p.expect(\"STATIC_STRING\");\r\n    p.expect(\"SOPEN\");\r\n    let num = p.expect(\"NUM\");\r\n    p.expect(\"SCLOSE\");\r\n    return {type: StructEnum.T_STATIC_STRING, data: {maxlength: num}}\r\n  }\r\n\r\n  function p_DataRef(p) {\r\n    p.expect(\"DATAREF\");\r\n    p.expect(\"LPARAM\");\r\n    let tname = p.expect(\"ID\");\r\n    p.expect(\"RPARAM\");\r\n    return {type: StructEnum.T_DATAREF, data: tname}\r\n  }\r\n\r\n  function p_Array(p) {\r\n    p.expect(\"ARRAY\");\r\n    p.expect(\"LPARAM\");\r\n    let arraytype = p_Type(p);\r\n\r\n    let itername = \"\";\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = arraytype.data.replace(/\"/g, \"\");\r\n      arraytype = p_Type(p);\r\n    }\r\n\r\n    p.expect(\"RPARAM\");\r\n    return {type: StructEnum.T_ARRAY, data: {type: arraytype, iname: itername}}\r\n  }\r\n\r\n  function p_Iter(p) {\r\n    p.expect(\"ITER\");\r\n    p.expect(\"LPARAM\");\r\n\r\n    let arraytype = p_Type(p);\r\n    let itername = \"\";\r\n\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = arraytype.data.replace(/\"/g, \"\");\r\n      arraytype = p_Type(p);\r\n    }\r\n\r\n    p.expect(\"RPARAM\");\r\n    return {type: StructEnum.T_ITER, data: {type: arraytype, iname: itername}}\r\n  }\r\n\r\n  function p_StaticArray(p) {\r\n    p.expect(\"STATIC_ARRAY\");\r\n    p.expect(\"SOPEN\");\r\n    let arraytype = p_Type(p);\r\n    let itername = \"\";\r\n\r\n    p.expect(\"COMMA\");\r\n    let size = p.expect(\"NUM\");\r\n\r\n    if (size < 0 || Math.abs(size - Math.floor(size)) > 0.000001) {\r\n      console.log(Math.abs(size - Math.floor(size)));\r\n      p.error(\"Expected an integer\");\r\n    }\r\n\r\n    size = Math.floor(size);\r\n\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = p_Type(p).data;\r\n    }\r\n\r\n    p.expect(\"SCLOSE\");\r\n    return {type: StructEnum.T_STATIC_ARRAY, data: {type: arraytype, size: size, iname: itername}}\r\n  }\r\n\r\n  function p_IterKeys(p) {\r\n    p.expect(\"ITERKEYS\");\r\n    p.expect(\"LPARAM\");\r\n\r\n    let arraytype = p_Type(p);\r\n    let itername = \"\";\r\n\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = arraytype.data.replace(/\"/g, \"\");\r\n      arraytype = p_Type(p);\r\n    }\r\n\r\n    p.expect(\"RPARAM\");\r\n    return {type: StructEnum.T_ITERKEYS, data: {type: arraytype, iname: itername}}\r\n  }\r\n\r\n  function p_Abstract(p) {\r\n    p.expect(\"ABSTRACT\");\r\n    p.expect(\"LPARAM\");\r\n    let type = p.expect(\"ID\");\r\n    p.expect(\"RPARAM\");\r\n    return {type: StructEnum.T_TSTRUCT, data: type}\r\n  }\r\n\r\n  function p_Type(p) {\r\n    let tok = p.peek();\r\n\r\n    if (tok.type === \"ID\") {\r\n      p.next();\r\n      return {type: StructEnum.T_STRUCT, data: tok.value}\r\n    } else if (basic_types.has(tok.type.toLowerCase())) {\r\n      p.next();\r\n      return {type: StructTypes[tok.type.toLowerCase()]}\r\n    } else if (tok.type === \"ARRAY\") {\r\n      return p_Array(p);\r\n    } else if (tok.type === \"ITER\") {\r\n      return p_Iter(p);\r\n    } else if (tok.type === \"ITERKEYS\") {\r\n      return p_IterKeys(p);\r\n    } else if (tok.type === \"STATIC_ARRAY\") {\r\n      return p_StaticArray(p);\r\n    } else if (tok.type === \"STATIC_STRING\") {\r\n      return p_Static_String(p);\r\n    } else if (tok.type === \"ABSTRACT\") {\r\n      return p_Abstract(p);\r\n    } else if (tok.type === \"DATAREF\") {\r\n      return p_DataRef(p);\r\n    } else {\r\n      p.error(tok, \"invalid type \" + tok.type);\r\n    }\r\n  }\r\n\r\n  function p_ID_or_num(p) {\r\n    let t = p.peeknext();\r\n\r\n    if (t.type === \"NUM\") {\r\n      p.next();\r\n      return t.value;\r\n    } else {\r\n      return p.expect(\"ID\", \"struct field name\");\r\n    }\r\n  }\r\n\r\n  function p_Field(p) {\r\n    let field = {};\r\n\r\n    field.name = p_ID_or_num(p);\r\n    p.expect(\"COLON\");\r\n\r\n    field.type = p_Type(p);\r\n    field.set = undefined;\r\n    field.get = undefined;\r\n\r\n    let check = 0;\r\n\r\n    let tok = p.peek();\r\n    if (tok.type === \"JSCRIPT\") {\r\n      field.get = tok.value;\r\n      check = 1;\r\n      p.next();\r\n    }\r\n\r\n    tok = p.peek();\r\n    if (tok.type === \"JSCRIPT\") {\r\n      check = 1;\r\n      field.set = tok.value;\r\n      p.next();\r\n    }\r\n\r\n    p.expect(\"SEMI\");\r\n\r\n    return field;\r\n  }\r\n\r\n  function p_Struct(p) {\r\n    let name = p.expect(\"ID\", \"struct name\");\r\n\r\n    let st = new NStruct(name);\r\n\r\n    let tok = p.peek();\r\n    let id = -1;\r\n\r\n    if (tok.type === \"ID\" && tok.value === \"id\") {\r\n      p.next();\r\n      p.expect(\"EQUALS\");\r\n      st.id = p.expect(\"NUM\");\r\n    }\r\n\r\n    p.expect(\"OPEN\");\r\n    while (1) {\r\n      if (p.at_end()) {\r\n        p.error(undefined);\r\n      } else if (p.optional(\"CLOSE\")) {\r\n        break;\r\n      } else {\r\n        st.fields.push(p_Field(p));\r\n      }\r\n    }\r\n\r\n    return st;\r\n  }\r\n\r\n  parser$1.start = p_Struct;\r\n  return parser$1;\r\n}\r\n\r\nconst struct_parse = StructParser();\r\n\r\nvar struct_parser = /*#__PURE__*/Object.freeze({\r\n  __proto__: null,\r\n  NStruct: NStruct,\r\n  StructEnum: StructEnum,\r\n  ValueTypes: ValueTypes,\r\n  StructTypes: StructTypes,\r\n  StructTypeMap: StructTypeMap,\r\n  struct_parse: struct_parse\r\n});\r\n\r\n/** dead file */\r\n\r\nvar struct_typesystem = /*#__PURE__*/Object.freeze({\r\n  __proto__: null\r\n});\r\n\r\n\"use strict\";\r\n\r\nvar STRUCT_ENDIAN = true; //little endian\r\n\r\nfunction setEndian(mode) {\r\n  STRUCT_ENDIAN = !!mode;\r\n}\r\n\r\nlet temp_dataview = new DataView(new ArrayBuffer(16));\r\nlet uint8_view = new Uint8Array(temp_dataview.buffer);\r\n\r\nclass unpack_context {\r\n  constructor() {\r\n    this.i = 0;\r\n  }\r\n}\r\n\r\nfunction pack_byte(array, val) {\r\n  array.push(val);\r\n}\r\n\r\nfunction pack_sbyte(array, val) {\r\n  if (val < 0) {\r\n    val = 256 + val;\r\n  }\r\n\r\n  array.push(val);\r\n}\r\n\r\nfunction pack_bytes(array, bytes) {\r\n  for (let i = 0; i < bytes.length; i++) {\r\n    array.push(bytes[i]);\r\n  }\r\n}\r\n\r\nfunction pack_int(array, val) {\r\n  temp_dataview.setInt32(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n  array.push(uint8_view[2]);\r\n  array.push(uint8_view[3]);\r\n}\r\n\r\nfunction pack_uint(array, val) {\r\n  temp_dataview.setUint32(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n  array.push(uint8_view[2]);\r\n  array.push(uint8_view[3]);\r\n}\r\n\r\nfunction pack_ushort(array, val) {\r\n  temp_dataview.setUint16(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n}\r\n\r\nfunction pack_float(array, val) {\r\n  temp_dataview.setFloat32(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n  array.push(uint8_view[2]);\r\n  array.push(uint8_view[3]);\r\n}\r\n\r\nfunction pack_double(array, val) {\r\n  temp_dataview.setFloat64(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n  array.push(uint8_view[2]);\r\n  array.push(uint8_view[3]);\r\n  array.push(uint8_view[4]);\r\n  array.push(uint8_view[5]);\r\n  array.push(uint8_view[6]);\r\n  array.push(uint8_view[7]);\r\n}\r\n\r\nfunction pack_short(array, val) {\r\n  temp_dataview.setInt16(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n}\r\n\r\nfunction encode_utf8(arr, str) {\r\n  for (let i = 0; i < str.length; i++) {\r\n    let c = str.charCodeAt(i);\r\n\r\n    while (c !== 0) {\r\n      let uc = c & 127;\r\n      c = c >> 7;\r\n\r\n      if (c !== 0)\r\n        uc |= 128;\r\n\r\n      arr.push(uc);\r\n    }\r\n  }\r\n}\r\n\r\nfunction decode_utf8(arr) {\r\n  let str = \"\";\r\n  let i = 0;\r\n\r\n  while (i < arr.length) {\r\n    let c = arr[i];\r\n    let sum = c & 127;\r\n    let j = 0;\r\n    let lasti = i;\r\n\r\n    while (i < arr.length && (c & 128)) {\r\n      j += 7;\r\n      i++;\r\n      c = arr[i];\r\n\r\n      c = (c & 127) << j;\r\n      sum |= c;\r\n    }\r\n\r\n    if (sum === 0) break;\r\n\r\n    str += String.fromCharCode(sum);\r\n    i++;\r\n  }\r\n\r\n  return str;\r\n}\r\n\r\nfunction test_utf8() {\r\n  let s = \"a\" + String.fromCharCode(8800) + \"b\";\r\n  let arr = [];\r\n\r\n  encode_utf8(arr, s);\r\n  let s2 = decode_utf8(arr);\r\n\r\n  if (s !== s2) {\r\n    throw new Error(\"UTF-8 encoding/decoding test failed\");\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction truncate_utf8(arr, maxlen) {\r\n  let len = Math.min(arr.length, maxlen);\r\n\r\n  let last_codepoint = 0;\r\n  let last2 = 0;\r\n\r\n  let incode = false;\r\n  let i = 0;\r\n  let code = 0;\r\n  while (i < len) {\r\n    incode = arr[i] & 128;\r\n\r\n    if (!incode) {\r\n      last2 = last_codepoint + 1;\r\n      last_codepoint = i + 1;\r\n    }\r\n\r\n    i++;\r\n  }\r\n\r\n  if (last_codepoint < maxlen)\r\n    arr.length = last_codepoint;\r\n  else\r\n    arr.length = last2;\r\n\r\n  return arr;\r\n}\r\n\r\nlet _static_sbuf_ss = new Array(2048);\r\n\r\nfunction pack_static_string(data, str, length) {\r\n  if (length === undefined)\r\n    throw new Error(\"'length' paremter is not optional for pack_static_string()\");\r\n\r\n  let arr = length < 2048 ? _static_sbuf_ss : new Array();\r\n  arr.length = 0;\r\n\r\n  encode_utf8(arr, str);\r\n  truncate_utf8(arr, length);\r\n\r\n  for (let i = 0; i < length; i++) {\r\n    if (i >= arr.length) {\r\n      data.push(0);\r\n    } else {\r\n      data.push(arr[i]);\r\n    }\r\n  }\r\n}\r\n\r\nlet _static_sbuf = new Array(32);\r\n\r\n/*strings are packed as 32-bit unicode codepoints*/\r\nfunction pack_string(data, str) {\r\n  _static_sbuf.length = 0;\r\n  encode_utf8(_static_sbuf, str);\r\n\r\n  pack_int(data, _static_sbuf.length);\r\n\r\n  for (let i = 0; i < _static_sbuf.length; i++) {\r\n    data.push(_static_sbuf[i]);\r\n  }\r\n}\r\n\r\nfunction unpack_bytes(dview, uctx, len) {\r\n  let ret = new DataView(dview.buffer.slice(uctx.i, uctx.i + len));\r\n  uctx.i += len;\r\n\r\n  return ret;\r\n}\r\n\r\nfunction unpack_byte(dview, uctx) {\r\n  return dview.getUint8(uctx.i++);\r\n}\r\n\r\nfunction unpack_sbyte(dview, uctx) {\r\n  return dview.getInt8(uctx.i++);\r\n}\r\n\r\nfunction unpack_int(dview, uctx) {\r\n  uctx.i += 4;\r\n  return dview.getInt32(uctx.i - 4, STRUCT_ENDIAN);\r\n}\r\n\r\nfunction unpack_uint(dview, uctx) {\r\n  uctx.i += 4;\r\n  return dview.getUint32(uctx.i - 4, STRUCT_ENDIAN);\r\n}\r\n\r\nfunction unpack_ushort(dview, uctx) {\r\n  uctx.i += 2;\r\n  return dview.getUint16(uctx.i - 2, STRUCT_ENDIAN);\r\n}\r\n\r\nfunction unpack_float(dview, uctx) {\r\n  uctx.i += 4;\r\n  return dview.getFloat32(uctx.i - 4, STRUCT_ENDIAN);\r\n}\r\n\r\nfunction unpack_double(dview, uctx) {\r\n  uctx.i += 8;\r\n  return dview.getFloat64(uctx.i - 8, STRUCT_ENDIAN);\r\n}\r\n\r\nfunction unpack_short(dview, uctx) {\r\n  uctx.i += 2;\r\n  return dview.getInt16(uctx.i - 2, STRUCT_ENDIAN);\r\n}\r\n\r\nlet _static_arr_us = new Array(32);\r\n\r\nfunction unpack_string(data, uctx) {\r\n  let slen = unpack_int(data, uctx);\r\n\r\n  if (!slen) {\r\n    return \"\";\r\n  }\r\n\r\n  let str = \"\";\r\n  let arr = slen < 2048 ? _static_arr_us : new Array(slen);\r\n\r\n  arr.length = slen;\r\n  for (let i = 0; i < slen; i++) {\r\n    arr[i] = unpack_byte(data, uctx);\r\n  }\r\n\r\n  return decode_utf8(arr);\r\n}\r\n\r\nlet _static_arr_uss = new Array(2048);\r\n\r\nfunction unpack_static_string(data, uctx, length) {\r\n  let str = \"\";\r\n\r\n  if (length === undefined)\r\n    throw new Error(\"'length' cannot be undefined in unpack_static_string()\");\r\n\r\n  let arr = length < 2048 ? _static_arr_uss : new Array(length);\r\n  arr.length = 0;\r\n\r\n  let done = false;\r\n  for (let i = 0; i < length; i++) {\r\n    let c = unpack_byte(data, uctx);\r\n\r\n    if (c === 0) {\r\n      done = true;\r\n    }\r\n\r\n    if (!done && c !== 0) {\r\n      arr.push(c);\r\n      //arr.length++;\r\n    }\r\n  }\r\n\r\n  truncate_utf8(arr, length);\r\n  return decode_utf8(arr);\r\n}\r\n\r\nvar struct_binpack = /*#__PURE__*/Object.freeze({\r\n  __proto__: null,\r\n  get STRUCT_ENDIAN () { return STRUCT_ENDIAN; },\r\n  setEndian: setEndian,\r\n  temp_dataview: temp_dataview,\r\n  uint8_view: uint8_view,\r\n  unpack_context: unpack_context,\r\n  pack_byte: pack_byte,\r\n  pack_sbyte: pack_sbyte,\r\n  pack_bytes: pack_bytes,\r\n  pack_int: pack_int,\r\n  pack_uint: pack_uint,\r\n  pack_ushort: pack_ushort,\r\n  pack_float: pack_float,\r\n  pack_double: pack_double,\r\n  pack_short: pack_short,\r\n  encode_utf8: encode_utf8,\r\n  decode_utf8: decode_utf8,\r\n  test_utf8: test_utf8,\r\n  pack_static_string: pack_static_string,\r\n  pack_string: pack_string,\r\n  unpack_bytes: unpack_bytes,\r\n  unpack_byte: unpack_byte,\r\n  unpack_sbyte: unpack_sbyte,\r\n  unpack_int: unpack_int,\r\n  unpack_uint: unpack_uint,\r\n  unpack_ushort: unpack_ushort,\r\n  unpack_float: unpack_float,\r\n  unpack_double: unpack_double,\r\n  unpack_short: unpack_short,\r\n  unpack_string: unpack_string,\r\n  unpack_static_string: unpack_static_string\r\n});\r\n\r\nlet warninglvl = 2;\r\nlet debug = 0;\r\n\r\nlet _static_envcode_null = \"\";\r\nlet packer_debug, packer_debug_start, packer_debug_end;\r\nlet packdebug_tablevel = 0;\r\n\r\nfunction _get_pack_debug() {\r\n  return {\r\n    packer_debug, packer_debug_start, packer_debug_end,\r\n    debug, warninglvl\r\n  }\r\n}\r\n\r\nclass cachering extends Array {\r\n  constructor(cb, tot) {\r\n    super();\r\n    this.length = tot;\r\n    this.cur = 0;\r\n\r\n    for (let i = 0; i < tot; i++) {\r\n      this[i] = cb();\r\n    }\r\n  }\r\n\r\n  static fromConstructor(cls, tot) {\r\n    return new cachering(() => new cls(), tot);\r\n  }\r\n\r\n  next() {\r\n    let ret = this[this.cur];\r\n\r\n    this.cur = (this.cur + 1)%this.length;\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nfunction gen_tabstr$1(tot) {\r\n  let ret = \"\";\r\n\r\n  for (let i = 0; i < tot; i++) {\r\n    ret += \" \";\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nfunction setWarningMode(t) {\r\n  if (typeof t !== \"number\" || isNaN(t)) {\r\n    throw new Error(\"Expected a single number (>= 0) argument to setWarningMode\");\r\n  }\r\n\r\n  warninglvl = t;\r\n}\r\n\r\nfunction setDebugMode(t) {\r\n  debug = t;\r\n\r\n  if (debug) {\r\n    packer_debug = function () {\r\n      let tab = gen_tabstr$1(packdebug_tablevel);\r\n\r\n      if (arguments.length > 0) {\r\n        console.warn(tab, ...arguments);\r\n      } else {\r\n        console.warn(\"Warning: undefined msg\");\r\n      }\r\n    };\r\n    packer_debug_start = function (funcname) {\r\n      packer_debug(\"Start \" + funcname);\r\n      packdebug_tablevel++;\r\n    };\r\n\r\n    packer_debug_end = function (funcname) {\r\n      packdebug_tablevel--;\r\n\r\n      if (funcname) {\r\n        packer_debug(\"Leave \" + funcname);\r\n      }\r\n    };\r\n  } else {\r\n    packer_debug = function () {\r\n    };\r\n    packer_debug_start = function () {\r\n    };\r\n    packer_debug_end = function () {\r\n    };\r\n  }\r\n}\r\n\r\nsetDebugMode(debug);\r\n\r\nconst StructFieldTypes = [];\r\nconst StructFieldTypeMap = {};\r\n\r\nfunction packNull(manager, data, field, type) {\r\n  StructFieldTypeMap[type.type].packNull(manager, data, field, type);\r\n};\r\n\r\nfunction toJSON(manager, val, obj, field, type) {\r\n  return StructFieldTypeMap[type.type].toJSON(manager, val, obj, field, type);\r\n};\r\n\r\nfunction fromJSON(manager, val, obj, field, type, instance) {\r\n  return StructFieldTypeMap[type.type].fromJSON(manager, val, obj, field, type, instance);\r\n};\r\n\r\nfunction unpack_field(manager, data, type, uctx) {\r\n  let name;\r\n\r\n  if (debug) {\r\n    name = StructFieldTypeMap[type.type].define().name;\r\n    packer_debug_start(\"R \" + name);\r\n  }\r\n\r\n  let ret = StructFieldTypeMap[type.type].unpack(manager, data, type, uctx);\r\n\r\n  if (debug) {\r\n    packer_debug_end();\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nlet fakeFields = new cachering(() => {\r\n  return {type: undefined, get: undefined, set: undefined}\r\n}, 256);\r\n\r\nfunction fmt_type(type) {\r\n  return StructFieldTypeMap[type.type].format(type);\r\n}\r\n\r\nfunction do_pack(manager, data, val, obj, field, type) {\r\n  let name;\r\n\r\n  if (debug) {\r\n    name = StructFieldTypeMap[type.type].define().name;\r\n    packer_debug_start(\"W \" + name);\r\n  }\r\n\r\n  let typeid = type;\r\n  if (typeof typeid !== \"number\") {\r\n    typeid = typeid.type;\r\n  }\r\n\r\n  let ret = StructFieldTypeMap[typeid].pack(manager, data, val, obj, field, type);\r\n\r\n  if (debug) {\r\n    packer_debug_end();\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nlet _ws_env = [[undefined, undefined]];\r\n\r\nclass StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    this.pack(manager, data, 0, 0, field, type);\r\n  }\r\n\r\n  static format(type) {\r\n    return this.define().name;\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    return val;\r\n  }\r\n\r\n  static fromJSON(manager, val, obj, field, type, instance) {\r\n    return val;\r\n  }\r\n\r\n  /**\r\n   return false to override default\r\n   helper js for packing\r\n   */\r\n  static useHelperJS(field) {\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   Define field class info.\r\n\r\n   Example:\r\n   <pre>\r\n   static define() {return {\r\n    type : StructEnum.T_INT,\r\n    name : \"int\"\r\n  }}\r\n   </pre>\r\n   */\r\n  static define() {\r\n    return {\r\n      type: -1,\r\n      name: \"(error)\"\r\n    }\r\n  }\r\n\r\n  /**\r\n   Register field packer/unpacker class.  Will throw an error if define() method is bad.\r\n   */\r\n  static register(cls) {\r\n    if (StructFieldTypes.indexOf(cls) >= 0) {\r\n      throw new Error(\"class already registered\");\r\n    }\r\n\r\n    if (cls.define === StructFieldType.define) {\r\n      throw new Error(\"you forgot to make a define() static method\");\r\n    }\r\n\r\n    if (cls.define().type === undefined) {\r\n      throw new Error(\"cls.define().type was undefined!\");\r\n    }\r\n\r\n    if (cls.define().type in StructFieldTypeMap) {\r\n      throw new Error(\"type \" + cls.define().type + \" is used by another StructFieldType subclass\");\r\n    }\r\n\r\n    StructFieldTypes.push(cls);\r\n    StructFieldTypeMap[cls.define().type] = cls;\r\n  }\r\n}\r\n\r\nclass StructIntField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_int(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_int(data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.T_INT,\r\n      name: \"int\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructIntField);\r\n\r\nclass StructFloatField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_float(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_float(data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.T_FLOAT,\r\n      name: \"float\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructFloatField);\r\n\r\nclass StructDoubleField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_double(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_double(data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.T_DOUBLE,\r\n      name: \"double\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructDoubleField);\r\n\r\nclass StructStringField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    val = !val ? \"\" : val;\r\n\r\n    pack_string(data, val);\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    this.pack(manager, data, \"\", 0, field, type);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_string(data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.T_STRING,\r\n      name: \"string\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructStringField);\r\n\r\nclass StructStaticStringField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    val = !val ? \"\" : val;\r\n\r\n    pack_static_string(data, val, type.data.maxlength);\r\n  }\r\n\r\n  static format(type) {\r\n    return `static_string[${type.data.maxlength}]`;\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    this.pack(manager, data, \"\", 0, field, type);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_static_string(data, uctx, type.data.maxlength);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.T_STATIC_STRING,\r\n      name: \"static_string\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructStaticStringField);\r\n\r\nclass StructStructField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    packer_debug(\"struct\", stt.name);\r\n\r\n    manager.write_struct(data, val, stt);\r\n  }\r\n\r\n  static format(type) {\r\n    return type.data;\r\n  }\r\n\r\n  static fromJSON(manager, val, obj, field, type, instance) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    return manager.readJSON(val, stt, instance);\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    let stt = manager.get_struct(type.data);\r\n    return manager.writeJSON(val, stt);\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, dest) {\r\n    let cls2 = manager.get_struct_cls(type.data);\r\n\r\n    packer_debug(\"struct\", cls2 ? cls2.name : \"(error)\");\r\n    return manager.read_object(data, cls2, uctx, dest);\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    packer_debug(\"struct\", type);\r\n\r\n    for (let field2 of stt.fields) {\r\n      let type2 = field2.type;\r\n\r\n      packNull(manager, data, field2, type2);\r\n    }\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let cls2 = manager.get_struct_cls(type.data);\r\n    packer_debug(\"struct\", cls2 ? cls2.name : \"(error)\");\r\n\r\n    return manager.read_object(data, cls2, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.T_STRUCT,\r\n      name: \"struct\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructStructField);\r\n\r\nclass StructTStructField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    let cls = manager.get_struct_cls(type.data);\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    //make sure inheritance is correct\r\n    if (val.constructor.structName !== type.data && (val instanceof cls)) {\r\n      //if (DEBUG.Struct) {\r\n      //    console.log(val.constructor.structName+\" inherits from \"+cls.structName);\r\n      //}\r\n      stt = manager.get_struct(val.constructor.structName);\r\n    } else if (val.constructor.structName === type.data) {\r\n      stt = manager.get_struct(type.data);\r\n    } else {\r\n      console.trace();\r\n      throw new Error(\"Bad struct \" + val.constructor.structName + \" passed to write_struct\");\r\n    }\r\n\r\n    packer_debug(\"int \" + stt.id);\r\n\r\n    pack_int(data, stt.id);\r\n    manager.write_struct(data, val, stt);\r\n  }\r\n\r\n  static fromJSON(manager, val, obj, field, type, instance) {\r\n    let stt = manager.get_struct(val._structName);\r\n\r\n    return manager.readJSON(val, stt, instance);\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    let stt = manager.get_struct(val.constructor.structName);\r\n    let ret = manager.writeJSON(val, stt);\r\n\r\n    ret._structName = \"\" + stt.name;\r\n\r\n    return ret;\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    pack_int(data, stt.id);\r\n    packNull(manager, data, field, {type: StructEnum.T_STRUCT, data: type.data});\r\n  }\r\n\r\n  static format(type) {\r\n    return \"abstract(\" + type.data + \")\";\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, dest) {\r\n    let id = unpack_int(data, uctx);\r\n\r\n    packer_debug(\"-int \" + id);\r\n    if (!(id in manager.struct_ids)) {\r\n      packer_debug(\"tstruct id: \" + id);\r\n      console.trace();\r\n      console.log(id);\r\n      console.log(manager.struct_ids);\r\n      throw new Error(\"Unknown struct type \" + id + \".\");\r\n    }\r\n\r\n    let cls2 = manager.get_struct_id(id);\r\n\r\n    packer_debug(\"struct name: \" + cls2.name);\r\n\r\n    cls2 = manager.struct_cls[cls2.name];\r\n\r\n    return manager.read_object(data, cls2, uctx, dest);\r\n    //packer_debug(\"ret\", ret);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let id = unpack_int(data, uctx);\r\n\r\n    packer_debug(\"-int \" + id);\r\n    if (!(id in manager.struct_ids)) {\r\n      packer_debug(\"tstruct id: \" + id);\r\n      console.trace();\r\n      console.log(id);\r\n      console.log(manager.struct_ids);\r\n      throw new Error(\"Unknown struct type \" + id + \".\");\r\n    }\r\n\r\n    let cls2 = manager.get_struct_id(id);\r\n\r\n    packer_debug(\"struct name: \" + cls2.name);\r\n    cls2 = manager.struct_cls[cls2.name];\r\n\r\n    return manager.read_object(data, cls2, uctx);\r\n    //packer_debug(\"ret\", ret);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.T_TSTRUCT,\r\n      name: \"tstruct\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructTStructField);\r\n\r\nclass StructArrayField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    if (val === undefined) {\r\n      console.trace();\r\n      console.log(\"Undefined array fed to struct struct packer!\");\r\n      console.log(\"Field: \", field);\r\n      console.log(\"Type: \", type);\r\n      console.log(\"\");\r\n      packer_debug(\"int 0\");\r\n      pack_int(data, 0);\r\n      return;\r\n    }\r\n\r\n    packer_debug(\"int \" + val.length);\r\n    pack_int(data, val.length);\r\n\r\n    let d = type.data;\r\n\r\n    let itername = d.iname;\r\n    let type2 = d.type;\r\n\r\n    let env = _ws_env;\r\n    for (let i = 0; i < val.length; i++) {\r\n      let val2 = val[i];\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n      }\r\n\r\n      //XXX not sure I really need this fakeField stub here. . .\r\n      let fakeField = fakeFields.next();\r\n      fakeField.type = type2;\r\n      do_pack(manager, data, val2, obj, fakeField, type2);\r\n    }\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    pack_int(data, 0);\r\n  }\r\n\r\n  static format(type) {\r\n    if (type.data.iname !== \"\" && type.data.iname !== undefined) {\r\n      return \"array(\" + type.data.iname + \", \" + fmt_type(type.data.type) + \")\";\r\n    } else {\r\n      return \"array(\" + fmt_type(type.data.type) + \")\";\r\n    }\r\n  }\r\n\r\n  static useHelperJS(field) {\r\n    return !field.type.data.iname;\r\n  }\r\n\r\n  static fromJSON(manager, val, obj, field, type, instance) {\r\n    let ret = instance || [];\r\n\r\n    ret.length = 0;\r\n\r\n    for (let i = 0; i < val.length; i++) {\r\n      let val2 = fromJSON(manager, val[i], val, field, type.data.type, undefined);\r\n\r\n      if (val2 === undefined) {\r\n        console.log(val2);\r\n        console.error(\"eeek\");\r\n        process.exit();\r\n      }\r\n\r\n      ret.push(val2);\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    val = val || [];\r\n    let json = [];\r\n\r\n    let itername = type.data.iname;\r\n\r\n    for (let i = 0; i < val.length; i++) {\r\n      let val2 = val[i];\r\n      let env = _ws_env;\r\n\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n\r\n        //console.log(\"VAL2\", val2, toJSON(manager, val2, val, field, type.data.type));\r\n      }\r\n\r\n      json.push(toJSON(manager, val2, val, field, type.data.type));\r\n    }\r\n\r\n    return json;\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, dest) {\r\n    let len = unpack_int(data, uctx);\r\n    dest.length = 0;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      dest.push(unpack_field(manager, data, type.data.type, uctx));\r\n    }\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let len = unpack_int(data, uctx);\r\n    packer_debug(\"-int \" + len);\r\n\r\n    let arr = new Array(len);\r\n    for (let i = 0; i < len; i++) {\r\n      arr[i] = unpack_field(manager, data, type.data.type, uctx);\r\n    }\r\n\r\n    return arr;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.T_ARRAY,\r\n      name: \"array\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructArrayField);\r\n\r\nclass StructIterField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    //this was originally implemented to use ES6 iterators.\r\n    function forEach(cb, thisvar) {\r\n      if (val && val[Symbol.iterator]) {\r\n        for (let item of val) {\r\n          cb.call(thisvar, item);\r\n        }\r\n      } else if (val && val.forEach) {\r\n        val.forEach(function (item) {\r\n          cb.call(thisvar, item);\r\n        });\r\n      } else {\r\n        console.trace();\r\n        console.log(\"Undefined iterable list fed to struct struct packer!\", val);\r\n        console.log(\"Field: \", field);\r\n        console.log(\"Type: \", type);\r\n        console.log(\"\");\r\n      }\r\n    }\r\n\r\n    /* save space for length */\r\n    let starti = data.length;\r\n    data.length += 4;\r\n\r\n    let d = type.data, itername = d.iname, type2 = d.type;\r\n    let env = _ws_env;\r\n\r\n    let i = 0;\r\n    forEach(function (val2) {\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n      }\r\n\r\n      //XXX not sure I really need this fakeField stub here. . .\r\n      let fakeField = fakeFields.next();\r\n      fakeField.type = type2;\r\n      do_pack(manager, data, val2, obj, fakeField, type2);\r\n\r\n      i++;\r\n    }, this);\r\n\r\n    /* write length */\r\n    temp_dataview.setInt32(0, i, STRUCT_ENDIAN);\r\n\r\n    data[starti++] = uint8_view[0];\r\n    data[starti++] = uint8_view[1];\r\n    data[starti++] = uint8_view[2];\r\n    data[starti++] = uint8_view[3];\r\n  }\r\n\r\n  static fromJSON() {\r\n    return StructArrayField.fromJSON(...arguments);\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    val = val || [];\r\n    let json = [];\r\n\r\n    let itername = type.data.iname;\r\n\r\n    for (let val2 of val) {\r\n      let env = _ws_env;\r\n\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n\r\n        //console.log(\"VAL2\", val2, toJSON(manager, val2, val, field, type.data.type));\r\n      }\r\n\r\n      json.push(toJSON(manager, val2, val, field, type.data.type));\r\n    }\r\n\r\n    return json;\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    pack_int(data, 0);\r\n  }\r\n\r\n  static useHelperJS(field) {\r\n    return !field.type.data.iname;\r\n  }\r\n\r\n  static format(type) {\r\n    if (type.data.iname !== \"\" && type.data.iname !== undefined) {\r\n      return \"iter(\" + type.data.iname + \", \" + fmt_type(type.data.type) + \")\";\r\n    } else {\r\n      return \"iter(\" + fmt_type(type.data.type) + \")\";\r\n    }\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, arr) {\r\n    let len = unpack_int(data, uctx);\r\n    packer_debug(\"-int \" + len);\r\n\r\n    arr.length = 0;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      arr.push(unpack_field(manager, data, type.data.type, uctx));\r\n    }\r\n\r\n    return arr;\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let len = unpack_int(data, uctx);\r\n    packer_debug(\"-int \" + len);\r\n\r\n    let arr = new Array(len);\r\n    for (let i = 0; i < len; i++) {\r\n      arr[i] = unpack_field(manager, data, type.data.type, uctx);\r\n    }\r\n\r\n    return arr;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.T_ITER,\r\n      name: \"iter\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructIterField);\r\n\r\nclass StructShortField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_short(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_short(data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.T_SHORT,\r\n      name: \"short\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructShortField);\r\n\r\nclass StructByteField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_byte(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_byte(data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.T_BYTE,\r\n      name: \"byte\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructByteField);\r\n\r\nclass StructSignedByteField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_sbyte(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_sbyte(data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.T_SIGNED_BYTE,\r\n      name: \"sbyte\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructSignedByteField);\r\n\r\nclass StructBoolField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_byte(data, !!val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return !!unpack_byte(data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.T_BOOL,\r\n      name: \"bool\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructBoolField);\r\n\r\nclass StructIterKeysField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    //this was originally implemented to use ES6 iterators.\r\n    if ((typeof val !== \"object\" && typeof val !== \"function\") || val === null) {\r\n      console.warn(\"Bad object fed to iterkeys in struct packer!\", val);\r\n      console.log(\"Field: \", field);\r\n      console.log(\"Type: \", type);\r\n      console.log(\"\");\r\n\r\n      pack_int(data, 0);\r\n      return;\r\n    }\r\n\r\n    let len = 0.0;\r\n    for (let k in val) {\r\n      len++;\r\n    }\r\n\r\n    packer_debug(\"int \" + len);\r\n    pack_int(data, len);\r\n\r\n    let d = type.data, itername = d.iname, type2 = d.type;\r\n    let env = _ws_env;\r\n\r\n    let i = 0;\r\n    for (let val2 in val) {\r\n      if (i >= len) {\r\n        if (warninglvl > 0)\r\n          console.warn(\"Warning: object keys magically replaced on us\", val, i);\r\n        return;\r\n      }\r\n\r\n      if (itername && itername.trim().length > 0 && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n      } else {\r\n        val2 = val[val2]; //fetch value\r\n      }\r\n\r\n      let f2 = {type: type2, get: undefined, set: undefined};\r\n      do_pack(manager, data, val2, obj, f2, type2);\r\n\r\n      i++;\r\n    }\r\n  }\r\n\r\n  static fromJSON() {\r\n    return StructArrayField.fromJSON(...arguments);\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    val = val || [];\r\n    let json = [];\r\n\r\n    let itername = type.data.iname;\r\n\r\n    for (let k in val) {\r\n      let val2 = val[k];\r\n      let env = _ws_env;\r\n\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n\r\n        //console.log(\"VAL2\", val2, toJSON(manager, val2, val, field, type.data.type));\r\n      }\r\n\r\n      json.push(toJSON(manager, val2, val, field, type.data.type));\r\n    }\r\n\r\n    return json;\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    pack_int(data, 0);\r\n  }\r\n\r\n  static useHelperJS(field) {\r\n    return !field.type.data.iname;\r\n  }\r\n\r\n  static format(type) {\r\n    if (type.data.iname !== \"\" && type.data.iname !== undefined) {\r\n      return \"iterkeys(\" + type.data.iname + \", \" + fmt_type(type.data.type) + \")\";\r\n    } else {\r\n      return \"iterkeys(\" + fmt_type(type.data.type) + \")\";\r\n    }\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, arr) {\r\n    let len = unpack_int(data, uctx);\r\n    packer_debug(\"-int \" + len);\r\n\r\n    arr.length = 0;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      arr.push(unpack_field(manager, data, type.data.type, uctx));\r\n    }\r\n\r\n    return arr;\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let len = unpack_int(data, uctx);\r\n    packer_debug(\"-int \" + len);\r\n\r\n    let arr = new Array(len);\r\n    for (let i = 0; i < len; i++) {\r\n      arr[i] = unpack_field(manager, data, type.data.type, uctx);\r\n    }\r\n\r\n    return arr;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.T_ITERKEYS,\r\n      name: \"iterkeys\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructIterKeysField);\r\n\r\nclass StructUintField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_uint(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_uint(data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.T_UINT,\r\n      name: \"uint\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructUintField);\r\n\r\n\r\nclass StructUshortField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_ushort(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_ushort(data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.T_USHORT,\r\n      name: \"ushort\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructUshortField);\r\n\r\n//let writeEmpty = writeEmpty = function writeEmpty(stt) {\r\n//}\r\n\r\nclass StructStaticArrayField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    if (type.data.size === undefined) {\r\n      throw new Error(\"type.data.size was undefined\");\r\n    }\r\n\r\n    let itername = type.data.iname;\r\n\r\n    if (val === undefined || !val.length) {\r\n      this.packNull(manager, data, field, type);\r\n      return;\r\n    }\r\n\r\n    for (let i = 0; i < type.data.size; i++) {\r\n      let i2 = Math.min(i, Math.min(val.length - 1, type.data.size));\r\n      let val2 = val[i2];\r\n\r\n      //*\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        let env = _ws_env;\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n      }\r\n\r\n      do_pack(manager, data, val2, val, field, type.data.type);\r\n    }\r\n  }\r\n\r\n  static useHelperJS(field) {\r\n    return !field.type.data.iname;\r\n  }\r\n\r\n  static fromJSON() {\r\n    return StructArrayField.fromJSON(...arguments);\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    let size = type.data.size;\r\n    for (let i = 0; i < size; i++) {\r\n      packNull(manager, data, field, type.data.type);\r\n    }\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    return StructArrayField.toJSON(...arguments);\r\n  }\r\n\r\n  static format(type) {\r\n    let type2 = StructFieldTypeMap[type.data.type.type].format(type.data.type);\r\n\r\n    let ret = `static_array[${type2}, ${type.data.size}`;\r\n\r\n    if (type.data.iname) {\r\n      ret += `, ${type.data.iname}`;\r\n    }\r\n    ret += `]`;\r\n\r\n    return ret;\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, ret) {\r\n    packer_debug(\"-size: \" + type.data.size);\r\n\r\n    ret.length = 0;\r\n\r\n    for (let i = 0; i < type.data.size; i++) {\r\n      ret.push(unpack_field(manager, data, type.data.type, uctx));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    packer_debug(\"-size: \" + type.data.size);\r\n\r\n    let ret = [];\r\n\r\n    for (let i = 0; i < type.data.size; i++) {\r\n      ret.push(unpack_field(manager, data, type.data.type, uctx));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.T_STATIC_ARRAY,\r\n      name: \"static_array\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructStaticArrayField);\r\n\r\nvar structEval = eval;\r\n\r\nfunction setStructEval(val) {\r\n  structEval = val;\r\n}\r\n\r\nvar nGlobal;\r\n\r\nif (typeof globalThis !== \"undefined\") {\r\n  nGlobal = globalThis;\r\n} else if (typeof window !== \"undefined\") {\r\n  nGlobal = window;\r\n} else if (typeof global !== \"undefined\") {\r\n  nGlobal = global;\r\n} else if (typeof globals !== \"undefined\") {\r\n  nGlobal = globals;\r\n} else if (typeof self !== \"undefined\") {\r\n  nGlobal = self;\r\n}\r\n\r\nconst DEBUG = {};\r\n\r\nfunction updateDEBUG() {\r\n  for (let k in Object.keys(DEBUG)) {\r\n    delete DEBUG[k];\r\n  }\r\n\r\n  if (typeof nGlobal.DEBUG === \"object\") {\r\n    for (let k in nGlobal.DEBUG) {\r\n      DEBUG[k] = nGlobal.DEBUG[k];\r\n    }\r\n  }\r\n}\r\n\r\n\"use strict\";\r\n\r\nlet warninglvl$1 = 2;\r\n\r\nvar truncateDollarSign = true;\r\nvar manager;\r\n\r\nfunction setTruncateDollarSign(v) {\r\n  truncateDollarSign = !!v;\r\n}\r\n\r\nfunction _truncateDollarSign(s) {\r\n  let i = s.search(\"$\");\r\n\r\n  if (i > 0) {\r\n    return s.slice(0, i).trim();\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nfunction unmangle(name) {\r\n  if (truncateDollarSign) {\r\n    return _truncateDollarSign(name);\r\n  } else {\r\n    return name;\r\n  }\r\n}\r\n\r\nlet _static_envcode_null$1 = \"\";\r\n\r\n//truncate webpack-mangled names\r\n\r\nfunction gen_tabstr$2(tot) {\r\n  let ret = \"\";\r\n\r\n  for (let i = 0; i < tot; i++) {\r\n    ret += \" \";\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nlet packer_debug$1, packer_debug_start$1, packer_debug_end$1;\r\n\r\nfunction update_debug_data() {\r\n  let ret = _get_pack_debug();\r\n\r\n  packer_debug$1 = ret.packer_debug;\r\n  packer_debug_start$1 = ret.packer_debug_start;\r\n  packer_debug_end$1 = ret.packer_debug_end;\r\n  warninglvl$1 = ret.warninglvl;\r\n}\r\n\r\nupdate_debug_data();\r\n\r\nfunction setWarningMode$1(t) {\r\n  setWarningMode(t);\r\n\r\n  if (typeof t !== \"number\" || isNaN(t)) {\r\n    throw new Error(\"Expected a single number (>= 0) argument to setWarningMode\");\r\n  }\r\n\r\n  warninglvl$1 = t;\r\n}\r\n\r\nfunction setDebugMode$1(t) {\r\n  setDebugMode(t);\r\n  update_debug_data();\r\n}\r\n\r\nlet _ws_env$1 = [[undefined, undefined]];\r\n\r\nfunction do_pack$1(data, val, obj, thestruct, field, type) {\r\n  StructFieldTypeMap[field.type.type].pack(manager, data, val, obj, field, type);\r\n}\r\n\r\nfunction define_empty_class(name) {\r\n  let cls = function () {\r\n  };\r\n\r\n  cls.prototype = Object.create(Object.prototype);\r\n  cls.constructor = cls.prototype.constructor = cls;\r\n\r\n  cls.STRUCT = name + \" {\\n  }\\n\";\r\n  cls.structName = name;\r\n\r\n  cls.prototype.loadSTRUCT = function (reader) {\r\n    reader(this);\r\n  };\r\n\r\n  cls.newSTRUCT = function () {\r\n    return new this();\r\n  };\r\n\r\n  return cls;\r\n}\r\n\r\nclass STRUCT {\r\n  constructor() {\r\n    this.idgen = 0;\r\n    this.allowOverriding = true;\r\n\r\n    this.structs = {};\r\n    this.struct_cls = {};\r\n    this.struct_ids = {};\r\n\r\n    this.compiled_code = {};\r\n    this.null_natives = {};\r\n\r\n    function define_null_native(name, cls) {\r\n      let obj = define_empty_class(name);\r\n\r\n      let stt = struct_parse.parse(obj.STRUCT);\r\n\r\n      stt.id = this.idgen++;\r\n\r\n      this.structs[name] = stt;\r\n      this.struct_cls[name] = cls;\r\n      this.struct_ids[stt.id] = stt;\r\n\r\n      this.null_natives[name] = 1;\r\n    }\r\n\r\n    define_null_native.call(this, \"Object\", Object);\r\n  }\r\n\r\n  static inherit(child, parent, structName = child.name) {\r\n    if (!parent.STRUCT) {\r\n      return structName + \"{\\n\";\r\n    }\r\n\r\n    let stt = struct_parse.parse(parent.STRUCT);\r\n    let code = structName + \"{\\n\";\r\n    code += STRUCT.fmt_struct(stt, true);\r\n    return code;\r\n  }\r\n\r\n  /** invoke loadSTRUCT methods on parent objects.  note that\r\n   reader() is only called once.  it is called however.*/\r\n  static Super(obj, reader) {\r\n    if (warninglvl$1 > 0)\r\n      console.warn(\"deprecated\");\r\n\r\n    reader(obj);\r\n\r\n    function reader2(obj) {\r\n    }\r\n\r\n    let cls = obj.constructor;\r\n    let bad = cls === undefined || cls.prototype === undefined || cls.prototype.__proto__ === undefined;\r\n\r\n    if (bad) {\r\n      return;\r\n    }\r\n\r\n    let parent = cls.prototype.__proto__.constructor;\r\n    bad = bad || parent === undefined;\r\n\r\n    if (!bad && parent.prototype.loadSTRUCT && parent.prototype.loadSTRUCT !== obj.loadSTRUCT) { //parent.prototype.hasOwnProperty(\"loadSTRUCT\")) {\r\n      parent.prototype.loadSTRUCT.call(obj, reader2);\r\n    }\r\n  }\r\n\r\n  //defined_classes is an array of class constructors\r\n  //with STRUCT scripts, *OR* another STRUCT instance\r\n  //\r\n\r\n  /** deprecated.  used with old fromSTRUCT interface. */\r\n  static chain_fromSTRUCT(cls, reader) {\r\n    if (warninglvl$1 > 0)\r\n      console.warn(\"Using deprecated (and evil) chain_fromSTRUCT method, eek!\");\r\n\r\n    let proto = cls.prototype;\r\n    let parent = cls.prototype.prototype.constructor;\r\n\r\n    let obj = parent.fromSTRUCT(reader);\r\n    let obj2 = new cls();\r\n\r\n    let keys = Object.keys(obj).concat(Object.getOwnPropertySymbols(obj));\r\n    //let keys=Object.keys(proto);\r\n\r\n    for (let i = 0; i < keys.length; i++) {\r\n      let k = keys[i];\r\n\r\n      try {\r\n        obj2[k] = obj[k];\r\n      } catch (error) {\r\n        if (warninglvl$1 > 0)\r\n          console.warn(\"  failed to set property\", k);\r\n      }\r\n      //let k=keys[i];\r\n      //if (k==\"__proto__\")\r\n      // continue;\r\n      //obj[k] = proto[k];\r\n    }\r\n\r\n    /*\r\n    if (proto.toString !== Object.prototype.toString)\r\n      obj2.toString = proto.toString;\r\n    //*/\r\n\r\n    return obj2;\r\n  }\r\n\r\n  static formatStruct(stt, internal_only, no_helper_js) {\r\n    return this.fmt_struct(stt, internal_only, no_helper_js);\r\n  }\r\n\r\n  static fmt_struct(stt, internal_only, no_helper_js) {\r\n    if (internal_only === undefined)\r\n      internal_only = false;\r\n    if (no_helper_js === undefined)\r\n      no_helper_js = false;\r\n\r\n    let s = \"\";\r\n    if (!internal_only) {\r\n      s += stt.name;\r\n      if (stt.id !== -1)\r\n        s += \" id=\" + stt.id;\r\n      s += \" {\\n\";\r\n    }\r\n    let tab = \"  \";\r\n\r\n    function fmt_type(type) {\r\n      return StructFieldTypeMap[type.type].format(type);\r\n\r\n      if (type.type === StructEnum.T_ARRAY || type.type === StructEnum.T_ITER || type.type === StructEnum.T_ITERKEYS) {\r\n        if (type.data.iname !== \"\" && type.data.iname !== undefined) {\r\n          return \"array(\" + type.data.iname + \", \" + fmt_type(type.data.type) + \")\";\r\n        } else {\r\n          return \"array(\" + fmt_type(type.data.type) + \")\";\r\n        }\r\n      } else if (type.type === StructEnum.T_STATIC_STRING) {\r\n        return \"static_string[\" + type.data.maxlength + \"]\";\r\n      } else if (type.type === StructEnum.T_STRUCT) {\r\n        return type.data;\r\n      } else if (type.type === StructEnum.T_TSTRUCT) {\r\n        return \"abstract(\" + type.data + \")\";\r\n      } else {\r\n        return StructTypeMap[type.type];\r\n      }\r\n    }\r\n\r\n    let fields = stt.fields;\r\n    for (let i = 0; i < fields.length; i++) {\r\n      let f = fields[i];\r\n      s += tab + f.name + \" : \" + fmt_type(f.type);\r\n      if (!no_helper_js && f.get !== undefined) {\r\n        s += \" | \" + f.get.trim();\r\n      }\r\n      s += \";\\n\";\r\n    }\r\n    if (!internal_only)\r\n      s += \"}\";\r\n    return s;\r\n  }\r\n\r\n  validateStructs(onerror) {\r\n    function getType(type) {\r\n      switch (type.type) {\r\n        case StructEnum.T_ITERKEYS:\r\n        case StructEnum.T_ITER:\r\n        case StructEnum.T_STATIC_ARRAY:\r\n        case StructEnum.T_ARRAY:\r\n          return getType(type.data.type);\r\n        case StructEnum.T_TSTRUCT:\r\n          return type;\r\n        case StructEnum.T_STRUCT:\r\n        default:\r\n          return type;\r\n      }\r\n    }\r\n\r\n    function formatType(type) {\r\n      let ret = {};\r\n\r\n      ret.type = type.type;\r\n\r\n      if (typeof ret.type === \"number\") {\r\n        for (let k in StructEnum) {\r\n          if (StructEnum[k] === ret.type) {\r\n            ret.type = k;\r\n            break;\r\n          }\r\n        }\r\n      } else if (typeof ret.type === \"object\") {\r\n        ret.type = formatType(ret.type);\r\n      }\r\n\r\n      if (typeof type.data === \"object\") {\r\n        ret.data = formatType(type.data);\r\n      } else {\r\n        ret.data = type.data;\r\n      }\r\n\r\n      return ret;\r\n    }\r\n\r\n    function throwError(stt, field, msg) {\r\n      let buf = STRUCT.formatStruct(stt);\r\n\r\n      console.error(buf + \"\\n\\n\" + msg);\r\n\r\n      if (onerror) {\r\n        onerror(msg, stt, field);\r\n      } else {\r\n        throw new Error(msg);\r\n      }\r\n    }\r\n\r\n    for (let k in this.structs) {\r\n      let stt = this.structs[k];\r\n\r\n      for (let field of stt.fields) {\r\n        if (field.name === \"this\") {\r\n          let type = field.type.type;\r\n\r\n          if (ValueTypes.has(type)) {\r\n            throwError(stt, field, \"'this' cannot be used with value types\");\r\n          }\r\n        }\r\n\r\n        let type = getType(field.type);\r\n\r\n        if (type.type !== StructEnum.T_STRUCT && type.type !== StructEnum.T_TSTRUCT) {\r\n          continue;\r\n        }\r\n\r\n        if (!(type.data in this.structs)) {\r\n          let msg = stt.name + \":\" + field.name + \": Unknown struct \" + type.data + \".\";\r\n          throwError(stt, field, msg);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  forEach(func, thisvar) {\r\n    for (let k in this.structs) {\r\n      let stt = this.structs[k];\r\n\r\n      if (thisvar !== undefined)\r\n        func.call(thisvar, stt);\r\n      else\r\n        func(stt);\r\n    }\r\n  }\r\n\r\n  //defaults to structjs.manager\r\n  parse_structs(buf, defined_classes) {\r\n    if (defined_classes === undefined) {\r\n      defined_classes = manager;\r\n    }\r\n\r\n    if (defined_classes instanceof STRUCT) {\r\n      let struct2 = defined_classes;\r\n      defined_classes = [];\r\n\r\n      for (let k in struct2.struct_cls) {\r\n        defined_classes.push(struct2.struct_cls[k]);\r\n      }\r\n    }\r\n\r\n    if (defined_classes === undefined) {\r\n      defined_classes = [];\r\n\r\n      for (let k in manager.struct_cls) {\r\n        defined_classes.push(manager.struct_cls[k]);\r\n      }\r\n    }\r\n\r\n    let clsmap = {};\r\n\r\n    for (let i = 0; i < defined_classes.length; i++) {\r\n      let cls = defined_classes[i];\r\n\r\n      if (!cls.structName && cls.STRUCT) {\r\n        let stt = struct_parse.parse(cls.STRUCT.trim());\r\n        cls.structName = stt.name;\r\n      } else if (!cls.structName && cls.name !== \"Object\") {\r\n        if (warninglvl$1 > 0)\r\n          console.log(\"Warning, bad class in registered class list\", unmangle(cls.name), cls);\r\n        continue;\r\n      }\r\n\r\n      clsmap[cls.structName] = defined_classes[i];\r\n    }\r\n\r\n    struct_parse.input(buf);\r\n\r\n    while (!struct_parse.at_end()) {\r\n      let stt = struct_parse.parse(undefined, false);\r\n\r\n      if (!(stt.name in clsmap)) {\r\n        if (!(stt.name in this.null_natives))\r\n          if (warninglvl$1 > 0)\r\n            console.log(\"WARNING: struct \" + stt.name + \" is missing from class list.\");\r\n\r\n        let dummy = define_empty_class(stt.name);\r\n\r\n        dummy.STRUCT = STRUCT.fmt_struct(stt);\r\n        dummy.structName = stt.name;\r\n\r\n        dummy.prototype.structName = dummy.name;\r\n\r\n        this.struct_cls[dummy.structName] = dummy;\r\n        this.structs[dummy.structName] = stt;\r\n\r\n        if (stt.id !== -1)\r\n          this.struct_ids[stt.id] = stt;\r\n      } else {\r\n        this.struct_cls[stt.name] = clsmap[stt.name];\r\n        this.structs[stt.name] = stt;\r\n\r\n        if (stt.id !== -1)\r\n          this.struct_ids[stt.id] = stt;\r\n      }\r\n\r\n      let tok = struct_parse.peek();\r\n      while (tok && (tok.value === \"\\n\" || tok.value === \"\\r\" || tok.value === \"\\t\" || tok.value === \" \")) {\r\n        tok = struct_parse.peek();\r\n      }\r\n    }\r\n  }\r\n\r\n  /** adds all structs referenced by cls inside of srcSTRUCT\r\n   *  to this */\r\n  registerGraph(srcSTRUCT, cls) {\r\n    if (!cls.structName) {\r\n      console.warn(\"class was not in srcSTRUCT\");\r\n      return this.register(cls);\r\n    }\r\n\r\n    let recStruct;\r\n\r\n    let recArray = (t) => {\r\n      switch (t.type) {\r\n        case StructEnum.T_ARRAY:\r\n          return recArray(t.data.type);\r\n        case StructEnum.T_ITERKEYS:\r\n          return recArray(t.data.type);\r\n        case StructEnum.T_STATIC_ARRAY:\r\n          return recArray(t.data.type);\r\n        case StructEnum.T_ITER:\r\n          return recArray(t.data.type);\r\n        case StructEnum.T_STRUCT:\r\n        case StructEnum.T_TSTRUCT: {\r\n          let st = srcSTRUCT.structs[t.data];\r\n          let cls = srcSTRUCT.struct_cls[st.name];\r\n\r\n          return recStruct(st, cls);\r\n        }\r\n      }\r\n    };\r\n\r\n    recStruct = (st, cls) => {\r\n      if (!(cls.structName in this.structs)) {\r\n        this.add_class(cls, cls.structName);\r\n      }\r\n\r\n      for (let f of st.fields) {\r\n        if (f.type.type === StructEnum.T_STRUCT || f.type.type === StructEnum.T_TSTRUCT) {\r\n          let st2 = srcSTRUCT.structs[f.type.data];\r\n          let cls2 = srcSTRUCT.struct_cls[st2.name];\r\n\r\n          recStruct(st2, cls2);\r\n        } else if (f.type.type === StructEnum.T_ARRAY) {\r\n          recArray(f.type);\r\n        } else if (f.type.type === StructEnum.T_ITER) {\r\n          recArray(f.type);\r\n        } else if (f.type.type === StructEnum.T_ITERKEYS) {\r\n          recArray(f.type);\r\n        } else if (f.type.type === StructEnum.T_STATIC_ARRAY) {\r\n          recArray(f.type);\r\n        }\r\n      }\r\n    };\r\n\r\n    let st = srcSTRUCT.structs[cls.structName];\r\n    recStruct(st, cls);\r\n  }\r\n\r\n  register(cls, structName) {\r\n    return this.add_class(cls, structName);\r\n  }\r\n\r\n  unregister(cls) {\r\n    if (!cls || !cls.structName || !(cls.structName in this.struct_cls)) {\r\n      console.warn(\"Class not registered with nstructjs\", cls);\r\n      return;\r\n    }\r\n\r\n\r\n    let st = this.structs[cls.structName];\r\n\r\n    delete this.structs[cls.structName];\r\n    delete this.struct_cls[cls.structName];\r\n    delete this.struct_ids[st.id];\r\n  }\r\n\r\n  add_class(cls, structName) {\r\n    //do not register Object\r\n    if (cls === Object) {\r\n      return;\r\n    }\r\n\r\n    if (cls.STRUCT) {\r\n      let bad = false;\r\n\r\n      let p = cls;\r\n      while (p) {\r\n        p = p.__proto__;\r\n\r\n        if (p && p.STRUCT && p.STRUCT === cls.STRUCT) {\r\n          bad = true;\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (bad) {\r\n        console.warn(\"Generating STRUCT script for derived class \" + unmangle(cls.name));\r\n        if (!structName) {\r\n          structName = unmangle(cls.name);\r\n        }\r\n\r\n        cls.STRUCT = STRUCT.inherit(cls, p) + `\\n}`;\r\n      }\r\n    }\r\n\r\n    if (!cls.STRUCT) {\r\n      throw new Error(\"class \" + unmangle(cls.name) + \" has no STRUCT script\");\r\n    }\r\n\r\n    let stt = struct_parse.parse(cls.STRUCT);\r\n\r\n    stt.name = unmangle(stt.name);\r\n\r\n    cls.structName = stt.name;\r\n\r\n    //create default newSTRUCT\r\n    if (cls.newSTRUCT === undefined) {\r\n      cls.newSTRUCT = function () {\r\n        return new this();\r\n      };\r\n    }\r\n\r\n    if (structName !== undefined) {\r\n      stt.name = cls.structName = structName;\r\n    } else if (cls.structName === undefined) {\r\n      cls.structName = stt.name;\r\n    } else {\r\n      stt.name = cls.structName;\r\n    }\r\n\r\n    if (cls.structName in this.structs) {\r\n      console.warn(\"Struct \" + unmangle(cls.structName) + \" is already registered\", cls);\r\n\r\n      if (!this.allowOverriding) {\r\n        throw new Error(\"Struct \" + unmangle(cls.structName) + \" is already registered\");\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    if (stt.id === -1)\r\n      stt.id = this.idgen++;\r\n\r\n    this.structs[cls.structName] = stt;\r\n    this.struct_cls[cls.structName] = cls;\r\n    this.struct_ids[stt.id] = stt;\r\n  }\r\n\r\n  isRegistered(cls) {\r\n    if (!cls.hasOwnProperty(\"structName\")) {\r\n      return false;\r\n    }\r\n\r\n    return cls === this.struct_cls[cls.structName];\r\n  }\r\n\r\n  get_struct_id(id) {\r\n    return this.struct_ids[id];\r\n  }\r\n\r\n  get_struct(name) {\r\n    if (!(name in this.structs)) {\r\n      console.warn(\"Unknown struct\", name);\r\n      throw new Error(\"Unknown struct \" + name);\r\n    }\r\n    return this.structs[name];\r\n  }\r\n\r\n  get_struct_cls(name) {\r\n    if (!(name in this.struct_cls)) {\r\n      console.trace();\r\n      throw new Error(\"Unknown struct \" + name);\r\n    }\r\n    return this.struct_cls[name];\r\n  }\r\n\r\n  _env_call(code, obj, env) {\r\n    let envcode = _static_envcode_null$1;\r\n    if (env !== undefined) {\r\n      envcode = \"\";\r\n      for (let i = 0; i < env.length; i++) {\r\n        envcode = \"let \" + env[i][0] + \" = env[\" + i.toString() + \"][1];\\n\" + envcode;\r\n      }\r\n    }\r\n    let fullcode = \"\";\r\n    if (envcode !== _static_envcode_null$1)\r\n      fullcode = envcode + code;\r\n    else\r\n      fullcode = code;\r\n    let func;\r\n\r\n    //fullcode = fullcode.replace(/\\bthis\\b/, \"obj\");\r\n\r\n    if (!(fullcode in this.compiled_code)) {\r\n      let code2 = \"func = function(obj, env) { \" + envcode + \"return \" + code + \"}\";\r\n      try {\r\n        func = structEval(code2);\r\n      } catch (err) {\r\n        console.warn(err.stack);\r\n\r\n        console.warn(code2);\r\n        console.warn(\" \");\r\n        throw err;\r\n      }\r\n      this.compiled_code[fullcode] = func;\r\n    } else {\r\n      func = this.compiled_code[fullcode];\r\n    }\r\n    try {\r\n      return func.call(obj, obj, env);\r\n    } catch (err) {\r\n      console.warn(err.stack);\r\n\r\n      let code2 = \"func = function(obj, env) { \" + envcode + \"return \" + code + \"}\";\r\n      console.warn(code2);\r\n      console.warn(\" \");\r\n      throw err;\r\n    }\r\n  }\r\n\r\n  write_struct(data, obj, stt) {\r\n    function use_helper_js(field) {\r\n      let type = field.type.type;\r\n      let cls = StructFieldTypeMap[type];\r\n      return cls.useHelperJS(field);\r\n    }\r\n\r\n    let fields = stt.fields;\r\n    let thestruct = this;\r\n    for (let i = 0; i < fields.length; i++) {\r\n      let f = fields[i];\r\n      let t1 = f.type;\r\n      let t2 = t1.type;\r\n\r\n      if (use_helper_js(f)) {\r\n        let val;\r\n        let type = t2;\r\n        if (f.get !== undefined) {\r\n          val = thestruct._env_call(f.get, obj);\r\n        } else {\r\n          val = f.name === \"this\" ? obj : obj[f.name];\r\n        }\r\n\r\n        if (DEBUG.tinyeval) {\r\n          console.log(\"\\n\\n\\n\", f.get, \"Helper JS Ret\", val, \"\\n\\n\\n\");\r\n        }\r\n\r\n        do_pack$1(data, val, obj, thestruct, f, t1);\r\n      } else {\r\n        let val = f.name === \"this\" ? obj : obj[f.name];\r\n        do_pack$1(data, val, obj, thestruct, f, t1);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   @param data : array to write data into,\r\n   @param obj  : structable object\r\n   */\r\n  write_object(data, obj) {\r\n    let cls = obj.constructor.structName;\r\n    let stt = this.get_struct(cls);\r\n\r\n    if (data === undefined) {\r\n      data = [];\r\n    }\r\n\r\n    this.write_struct(data, obj, stt);\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   Read an object from binary data\r\n\r\n   @param data : DataView or Uint8Array instance\r\n   @param cls_or_struct_id : Structable class\r\n   @param uctx : internal parameter\r\n   @return {cls_or_struct_id} Instance of cls_or_struct_id\r\n   */\r\n  readObject(data, cls_or_struct_id, uctx) {\r\n    if (data instanceof Uint8Array || data instanceof Uint8ClampedArray) {\r\n      data = new DataView(data.buffer);\r\n    } else if (data instanceof Array) {\r\n      data = new DataView(new Uint8Array(data).buffer);\r\n    }\r\n\r\n    return this.read_object(data, cls_or_struct_id, uctx);\r\n  }\r\n\r\n  /**\r\n   @param data array to write data into,\r\n   @param obj structable object\r\n   */\r\n  writeObject(data, obj) {\r\n    return this.write_object(data, obj);\r\n  }\r\n\r\n  writeJSON(obj, stt = undefined) {\r\n    let cls = obj.constructor;\r\n    stt = stt || this.get_struct(cls.structName);\r\n\r\n    function use_helper_js(field) {\r\n      let type = field.type.type;\r\n      let cls = StructFieldTypeMap[type];\r\n      return cls.useHelperJS(field);\r\n    }\r\n\r\n    let toJSON$1 = toJSON;\r\n\r\n    let fields = stt.fields;\r\n    let thestruct = this;\r\n    let json = {};\r\n\r\n    for (let i = 0; i < fields.length; i++) {\r\n      let f = fields[i];\r\n      let val;\r\n      let t1 = f.type;\r\n\r\n      let json2;\r\n\r\n      if (use_helper_js(f)) {\r\n        if (f.get !== undefined) {\r\n          val = thestruct._env_call(f.get, obj);\r\n        } else {\r\n          val = f.name === \"this\" ? obj : obj[f.name];\r\n        }\r\n\r\n        if (DEBUG.tinyeval) {\r\n          console.log(\"\\n\\n\\n\", f.get, \"Helper JS Ret\", val, \"\\n\\n\\n\");\r\n        }\r\n\r\n        json2 = toJSON$1(this, val, obj, f, t1);\r\n      } else {\r\n        val = f.name === \"this\" ? obj : obj[f.name];\r\n        json2 = toJSON$1(this, val, obj, f, t1);\r\n      }\r\n\r\n      if (f.name !== 'this') {\r\n        json[f.name] = json2;\r\n      } else { //f.name was 'this'?\r\n        let isArray = Array.isArray(json2);\r\n        isArray = isArray || f.type.type === StructTypes.T_ARRAY;\r\n        isArray = isArray || f.type.type === StructTypes.T_STATIC_ARRAY;\r\n\r\n        if (isArray) {\r\n          json.length = json2.length;\r\n\r\n          for (let i = 0; i < json2.length; i++) {\r\n            json[i] = json2[i];\r\n          }\r\n        } else {\r\n          Object.assign(json, json2);\r\n        }\r\n      }\r\n    }\r\n\r\n    return json;\r\n  }\r\n\r\n  /**\r\n   @param data : DataView or Uint8Array instance\r\n   @param cls_or_struct_id : Structable class\r\n   @param uctx : internal parameter\r\n   */\r\n  read_object(data, cls_or_struct_id, uctx, objInstance) {\r\n    let cls, stt;\r\n\r\n    if (data instanceof Array) {\r\n      data = new DataView(new Uint8Array(data).buffer);\r\n    }\r\n\r\n    if (typeof cls_or_struct_id === \"number\") {\r\n      cls = this.struct_cls[this.struct_ids[cls_or_struct_id].name];\r\n    } else {\r\n      cls = cls_or_struct_id;\r\n    }\r\n\r\n    if (cls === undefined) {\r\n      throw new Error(\"bad cls_or_struct_id \" + cls_or_struct_id);\r\n    }\r\n\r\n    stt = this.structs[cls.structName];\r\n\r\n    if (uctx === undefined) {\r\n      uctx = new unpack_context();\r\n\r\n      packer_debug$1(\"\\n\\n=Begin reading \" + cls.structName + \"=\");\r\n    }\r\n    let thestruct = this;\r\n\r\n    let this2 = this;\r\n\r\n    function unpack_field(type) {\r\n      return StructFieldTypeMap[type.type].unpack(this2, data, type, uctx);\r\n    }\r\n\r\n    function unpack_into(type, dest) {\r\n      return StructFieldTypeMap[type.type].unpackInto(this2, data, type, uctx, dest);\r\n    }\r\n\r\n    let was_run = false;\r\n\r\n    function makeLoader(stt) {\r\n      return function load(obj) {\r\n        if (was_run) {\r\n          return;\r\n        }\r\n\r\n        was_run = true;\r\n\r\n        let fields = stt.fields;\r\n        let flen = fields.length;\r\n\r\n        for (let i = 0; i < flen; i++) {\r\n          let f = fields[i];\r\n\r\n          if (f.name === 'this') {\r\n            //load data into obj directly\r\n            unpack_into(f.type, obj);\r\n          } else {\r\n            obj[f.name] = unpack_field(f.type);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    let load = makeLoader(stt);\r\n\r\n    if (cls.prototype.loadSTRUCT !== undefined) {\r\n      let obj = objInstance;\r\n\r\n      if (!obj && cls.newSTRUCT !== undefined) {\r\n        obj = cls.newSTRUCT(load);\r\n      } else if (!obj) {\r\n        obj = new cls();\r\n      }\r\n\r\n      obj.loadSTRUCT(load);\r\n\r\n      if (!was_run) {\r\n        console.warn(\"\"+cls.structName + \".prototype.loadSTRUCT() did not execute its loader callback!\");\r\n        load(obj);\r\n      }\r\n\r\n      return obj;\r\n    } else if (cls.fromSTRUCT !== undefined) {\r\n      if (warninglvl$1 > 1)\r\n        console.warn(\"Warning: class \" + unmangle(cls.name) + \" is using deprecated fromSTRUCT interface; use newSTRUCT/loadSTRUCT instead\");\r\n      return cls.fromSTRUCT(load);\r\n    } else { //default case, make new instance and then call load() on it\r\n      let obj = objInstance;\r\n\r\n      if (!obj && cls.newSTRUCT !== undefined) {\r\n        obj = cls.newSTRUCT(load);\r\n      } else if (!obj) {\r\n        obj = new cls();\r\n      }\r\n\r\n      load(obj);\r\n\r\n      return obj;\r\n    }\r\n  }\r\n\r\n  readJSON(json, cls_or_struct_id, objInstance = undefined) {\r\n    let cls, stt;\r\n\r\n    if (typeof cls_or_struct_id === \"number\") {\r\n      cls = this.struct_cls[this.struct_ids[cls_or_struct_id].name];\r\n    } else if (cls_or_struct_id instanceof NStruct) {\r\n      cls = this.get_struct_cls(cls_or_struct_id.name);\r\n    } else {\r\n      cls = cls_or_struct_id;\r\n    }\r\n\r\n    if (cls === undefined) {\r\n      throw new Error(\"bad cls_or_struct_id \" + cls_or_struct_id);\r\n    }\r\n\r\n    stt = this.structs[cls.structName];\r\n\r\n    packer_debug$1(\"\\n\\n=Begin reading \" + cls.structName + \"=\");\r\n    let thestruct = this;\r\n    let this2 = this;\r\n    let was_run = false;\r\n    let fromJSON$1 = fromJSON;\r\n\r\n    function makeLoader(stt) {\r\n      return function load(obj) {\r\n        if (was_run) {\r\n          return;\r\n        }\r\n\r\n        was_run = true;\r\n\r\n        let fields = stt.fields;\r\n        let flen = fields.length;\r\n\r\n        for (let i = 0; i < flen; i++) {\r\n          let f = fields[i];\r\n\r\n          let val;\r\n\r\n          if (f.name === 'this') {\r\n            val = json;\r\n          } else {\r\n            val = json[f.name];\r\n          }\r\n\r\n          if (val === undefined) {\r\n            console.warn(\"nstructjs.readJSON: Missing field \" + f.name + \" in struct \" + stt.name);\r\n            continue;\r\n          }\r\n\r\n          let instance = f.name === 'this' ? obj : objInstance;\r\n\r\n          let ret = fromJSON$1(this2, val, obj, f, f.type, instance);\r\n\r\n          if (f.name !== 'this') {\r\n            obj[f.name] = ret;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    let load = makeLoader(stt);\r\n\r\n    if (cls.prototype.loadSTRUCT !== undefined) {\r\n      let obj = objInstance;\r\n\r\n      if (!obj && cls.newSTRUCT !== undefined) {\r\n        obj = cls.newSTRUCT(load);\r\n      } else if (!obj) {\r\n        obj = new cls();\r\n      }\r\n\r\n      obj.loadSTRUCT(load);\r\n      return obj;\r\n    } else if (cls.fromSTRUCT !== undefined) {\r\n      if (warninglvl$1 > 1)\r\n        console.warn(\"Warning: class \" + unmangle(cls.name) + \" is using deprecated fromSTRUCT interface; use newSTRUCT/loadSTRUCT instead\");\r\n      return cls.fromSTRUCT(load);\r\n    } else { //default case, make new instance and then call load() on it\r\n      let obj = objInstance;\r\n\r\n      if (!obj && cls.newSTRUCT !== undefined) {\r\n        obj = cls.newSTRUCT(load);\r\n      } else if (!obj) {\r\n        obj = new cls();\r\n      }\r\n\r\n      load(obj);\r\n\r\n      return obj;\r\n    }\r\n  }\r\n};\r\n\r\n//main struct script manager\r\nmanager = new STRUCT();\r\n\r\n/**\r\n * Write all defined structs out to a string.\r\n *\r\n * @param nManager STRUCT instance, defaults to nstructjs.manager\r\n * @param include_code include save code snippets\r\n * */\r\nfunction write_scripts(nManager = manager, include_code = false) {\r\n  let buf = \"\";\r\n\r\n  nManager.forEach(function (stt) {\r\n    buf += STRUCT.fmt_struct(stt, false, !include_code) + \"\\n\";\r\n  });\r\n\r\n  let buf2 = buf;\r\n  buf = \"\";\r\n\r\n  for (let i = 0; i < buf2.length; i++) {\r\n    let c = buf2[i];\r\n    if (c === \"\\n\") {\r\n      buf += \"\\n\";\r\n      let i2 = i;\r\n      while (i < buf2.length && (buf2[i] === \" \" || buf2[i] === \"\\t\" || buf2[i] === \"\\n\")) {\r\n        i++;\r\n      }\r\n      if (i !== i2)\r\n        i--;\r\n    } else {\r\n      buf += c;\r\n    }\r\n  }\r\n\r\n  return buf;\r\n}\r\n\r\n\"use strict\";\r\n\r\nlet nbtoa, natob;\r\n\r\nif (typeof btoa === \"undefined\") {\r\n  nbtoa = function btoa(str) {\r\n    let buffer = new Buffer(\"\" + str, 'binary');\r\n    return buffer.toString('base64');\r\n  };\r\n\r\n  natob = function atob(str) {\r\n    return new Buffer(str, 'base64').toString('binary');\r\n  };\r\n} else {\r\n  natob = atob;\r\n  nbtoa = btoa;\r\n}\r\n\r\n/*\r\nfile format:\r\n  magic signature              : 4 bytes\r\n  file version major           : 2 bytes\r\n  file version minor           : 1 bytes\r\n  file version micro           : 1 bytes\r\n  length of struct scripts     : 4 bytes\r\n  struct scripts for this file : ...\r\n  \r\n  block:\r\n    magic signature for block              : 4 bytes\r\n    length of data  (not including header) : 4 bytes\r\n    id of struct type                      : 4 bytes\r\n    \r\n    data                                   : ...\r\n*/\r\n\r\nfunction versionToInt(v) {\r\n  v = versionCoerce(v);\r\n  let mul = 64;\r\n  return ~~(v.major*mul*mul*mul + v.minor*mul*mul + v.micro*mul);\r\n}\r\n\r\nlet ver_pat = /[0-9]+\\.[0-9]+\\.[0-9]+$/;\r\n\r\nfunction versionCoerce(v) {\r\n  if (!v) {\r\n    throw new Error(\"empty version: \" + v);\r\n  }\r\n\r\n  if (typeof v === \"string\") {\r\n    if (!ver_pat.exec(v)) {\r\n      throw new Error(\"invalid version string \" + v);\r\n    }\r\n\r\n    let ver = v.split(\".\");\r\n    return {\r\n      major : parseInt(ver[0]),\r\n      minor : parseInt(ver[1]),\r\n      micro : parseInt(ver[2])\r\n    }\r\n  } else if (Array.isArray(v)) {\r\n    return {\r\n      major : v[0],\r\n      minor : v[1],\r\n      micro : v[2]\r\n    }\r\n  } else if (typeof v === \"object\") {\r\n    let test = (k) => k in v && typeof v[k] === \"number\";\r\n\r\n    if (!test(\"major\") || !test(\"minor\") || !test(\"micro\")) {\r\n      throw new Error(\"invalid version object: \" + v);\r\n    }\r\n\r\n    return v;\r\n  } else {\r\n    throw new Error(\"invalid version \" + v);\r\n  }\r\n}\r\n\r\nfunction versionLessThan(a, b) {\r\n  return versionToInt(a) < versionToInt(b);\r\n}\r\n\r\nclass FileParams {\r\n  constructor() {\r\n    this.magic = \"STRT\";\r\n    this.ext = \".bin\";\r\n    this.blocktypes = [\"DATA\"];\r\n\r\n    this.version = {\r\n      major: 0,\r\n      minor: 0,\r\n      micro: 1\r\n    };\r\n  }\r\n}\r\n\r\n//used to define blocks\r\nclass Block {\r\n  constructor(type_magic, data) {\r\n    this.type = type_magic;\r\n    this.data = data;\r\n  }\r\n}\r\n\r\nclass FileeError extends Error {\r\n}\r\n\r\nclass FileHelper {\r\n  //params can be FileParams instance, or object literal\r\n  //(it will convert to FileParams)\r\n  constructor(params) {\r\n    if (params === undefined) {\r\n      params = new FileParams();\r\n    } else {\r\n      let fp = new FileParams();\r\n\r\n      for (let k in params) {\r\n        fp[k] = params[k];\r\n      }\r\n      params = fp;\r\n    }\r\n\r\n    this.version = params.version;\r\n    this.blocktypes = params.blocktypes;\r\n    this.magic = params.magic;\r\n    this.ext = params.ext;\r\n    this.struct = undefined;\r\n    this.unpack_ctx = undefined;\r\n  }\r\n\r\n  read(dataview) {\r\n    this.unpack_ctx = new unpack_context();\r\n\r\n    let magic = unpack_static_string(dataview, this.unpack_ctx, 4);\r\n\r\n    if (magic !== this.magic) {\r\n      throw new FileError(\"corrupted file\");\r\n    }\r\n\r\n    this.version = {};\r\n    this.version.major = unpack_short(dataview, this.unpack_ctx);\r\n    this.version.minor = unpack_byte(dataview, this.unpack_ctx);\r\n    this.version.micro = unpack_byte(dataview, this.unpack_ctx);\r\n\r\n    let struct = this.struct = new STRUCT();\r\n\r\n    let scripts = unpack_string(dataview, this.unpack_ctx);\r\n    this.struct.parse_structs(scripts, manager);\r\n\r\n    let blocks = [];\r\n    let dviewlen = dataview.buffer.byteLength;\r\n\r\n    while (this.unpack_ctx.i < dviewlen) {\r\n      //console.log(\"reading block. . .\", this.unpack_ctx.i, dviewlen);\r\n\r\n      let type = unpack_static_string(dataview, this.unpack_ctx, 4);\r\n      let datalen = unpack_int(dataview, this.unpack_ctx);\r\n      let bstruct = unpack_int(dataview, this.unpack_ctx);\r\n      let bdata;\r\n\r\n      //console.log(type, datalen, bstruct);\r\n\r\n      if (bstruct === -2) { //string data, e.g. JSON\r\n        bdata = unpack_static_string(dataview, this.unpack_ctx, datalen);\r\n      } else {\r\n        bdata = unpack_bytes(dataview, this.unpack_ctx, datalen);\r\n        bdata = struct.read_object(bdata, bstruct, new unpack_context());\r\n      }\r\n\r\n      let block = new Block();\r\n      block.type = type;\r\n      block.data = bdata;\r\n\r\n      blocks.push(block);\r\n    }\r\n\r\n    this.blocks = blocks;\r\n    return blocks;\r\n  }\r\n\r\n  doVersions(old) {\r\n    let blocks = this.blocks;\r\n\r\n    if (versionLessThan(old, \"0.0.1\")) {\r\n      //do something\r\n    }\r\n  }\r\n\r\n  write(blocks) {\r\n    this.struct = manager;\r\n    this.blocks = blocks;\r\n\r\n    let data = [];\r\n\r\n    pack_static_string(data, this.magic, 4);\r\n    pack_short(data, this.version.major);\r\n    pack_byte(data, this.version.minor & 255);\r\n    pack_byte(data, this.version.micro & 255);\r\n\r\n    let scripts = write_scripts();\r\n    pack_string(data, scripts);\r\n\r\n    let struct = this.struct;\r\n\r\n    for (let block of blocks) {\r\n      if (typeof block.data === \"string\") { //string data, e.g. JSON\r\n        pack_static_string(data, block.type, 4);\r\n        pack_int(data, block.data.length);\r\n        pack_int(data, -2); //flag as string data\r\n        pack_static_string(data, block.data, block.data.length);\r\n        continue;\r\n      }\r\n\r\n      let structName = block.data.constructor.structName;\r\n      if (structName === undefined || !(structName in struct.structs)) {\r\n        throw new Error(\"Non-STRUCTable object \" + block.data);\r\n      }\r\n\r\n      let data2 = [];\r\n      let stt = struct.structs[structName];\r\n\r\n      struct.write_object(data2, block.data);\r\n\r\n      pack_static_string(data, block.type, 4);\r\n      pack_int(data, data2.length);\r\n      pack_int(data, stt.id);\r\n\r\n      pack_bytes(data, data2);\r\n    }\r\n\r\n    return new DataView(new Uint8Array(data).buffer);\r\n  }\r\n\r\n  writeBase64(blocks) {\r\n    let dataview = this.write(blocks);\r\n\r\n    let str = \"\";\r\n    let bytes = new Uint8Array(dataview.buffer);\r\n\r\n    for (let i = 0; i < bytes.length; i++) {\r\n      str += String.fromCharCode(bytes[i]);\r\n    }\r\n\r\n    return nbtoa(str);\r\n  }\r\n\r\n  makeBlock(type, data) {\r\n    return new Block(type, data);\r\n  }\r\n\r\n  readBase64(base64) {\r\n    let data = natob(base64);\r\n    let data2 = new Uint8Array(data.length);\r\n\r\n    for (let i = 0; i < data.length; i++) {\r\n      data2[i] = data.charCodeAt(i);\r\n    }\r\n\r\n    return this.read(new DataView(data2.buffer));\r\n  }\r\n}\r\n\r\nvar struct_filehelper = /*#__PURE__*/Object.freeze({\r\n  __proto__: null,\r\n  versionToInt: versionToInt,\r\n  versionCoerce: versionCoerce,\r\n  versionLessThan: versionLessThan,\r\n  FileParams: FileParams,\r\n  Block: Block,\r\n  FileeError: FileeError,\r\n  FileHelper: FileHelper\r\n});\r\n\r\n/** truncate webpack mangled names. defaults to true\r\n *  so Mesh$1 turns into Mesh */\r\nfunction truncateDollarSign$1(value = true) {\r\n  setTruncateDollarSign(value);\r\n}\r\n\r\nfunction validateStructs(onerror) {\r\n  return manager.validateStructs(onerror);\r\n}\r\n\r\n/**\r\n true means little endian, false means big endian\r\n */\r\nfunction setEndian$1(mode) {\r\n  let ret = STRUCT_ENDIAN;\r\n\r\n  setEndian(mode);\r\n\r\n  return ret;\r\n}\r\n\r\nfunction getEndian() {\r\n  return STRUCT_ENDIAN;\r\n}\r\n\r\nfunction setAllowOverriding(t) {\r\n  return manager.allowOverriding = !!t;\r\n}\r\n\r\nfunction isRegistered(cls) {\r\n  return manager.isRegistered(cls);\r\n}\r\n\r\n/** Register a class with nstructjs **/\r\nfunction register(cls, structName) {\r\n  return manager.register(cls, structName);\r\n}\r\n\r\nfunction unregister(cls) {\r\n  manager.unregister(cls);\r\n}\r\n\r\nfunction inherit(child, parent, structName = child.name) {\r\n\r\n  return STRUCT.inherit(...arguments);\r\n}\r\n\r\n/**\r\n @param data : DataView\r\n */\r\nfunction readObject(data, cls, __uctx = undefined) {\r\n  return manager.readObject(data, cls, __uctx);\r\n}\r\n\r\n/**\r\n @param data : Array instance to write bytes to\r\n */\r\nfunction writeObject(data, obj) {\r\n  return manager.writeObject(data, obj);\r\n}\r\n\r\nfunction writeJSON(obj) {\r\n  return manager.writeJSON(obj);\r\n}\r\n\r\nfunction readJSON(json, class_or_struct_id) {\r\n  return manager.readJSON(json, class_or_struct_id);\r\n}\r\n\r\nexport { STRUCT, _truncateDollarSign, struct_binpack as binpack, struct_filehelper as filehelper, getEndian, inherit, isRegistered, manager, struct_parser as parser, struct_parseutil as parseutil, readJSON, readObject, register, setAllowOverriding, setDebugMode$1 as setDebugMode, setEndian$1 as setEndian, setTruncateDollarSign, setWarningMode$1 as setWarningMode, truncateDollarSign$1 as truncateDollarSign, struct_typesystem as typesystem, unpack_context, unregister, validateStructs, writeJSON, writeObject, write_scripts };\r\n","// THIS FILE IS GENERATED - DO NOT EDIT!\r\n/*!mobile-detect v1.4.4 2019-09-21*/\r\n/*global module:false, define:false*/\r\n/*jshint latedef:false*/\r\n/*!@license Copyright 2013, Heinrich Goebl, License: MIT, see https://github.com/hgoebl/mobile-detect.js*/\r\n(function (define, undefined) {\r\ndefine(function () {\r\n    'use strict';\r\n\r\n    var impl = {};\r\n\r\n    impl.mobileDetectRules = {\r\n    \"phones\": {\r\n        \"iPhone\": \"\\\\biPhone\\\\b|\\\\biPod\\\\b\",\r\n        \"BlackBerry\": \"BlackBerry|\\\\bBB10\\\\b|rim[0-9]+|\\\\b(BBA100|BBB100|BBD100|BBE100|BBF100|STH100)\\\\b-[0-9]+\",\r\n        \"HTC\": \"HTC|HTC.*(Sensation|Evo|Vision|Explorer|6800|8100|8900|A7272|S510e|C110e|Legend|Desire|T8282)|APX515CKT|Qtek9090|APA9292KT|HD_mini|Sensation.*Z710e|PG86100|Z715e|Desire.*(A8181|HD)|ADR6200|ADR6400L|ADR6425|001HT|Inspire 4G|Android.*\\\\bEVO\\\\b|T-Mobile G1|Z520m|Android [0-9.]+; Pixel\",\r\n        \"Nexus\": \"Nexus One|Nexus S|Galaxy.*Nexus|Android.*Nexus.*Mobile|Nexus 4|Nexus 5|Nexus 6\",\r\n        \"Dell\": \"Dell[;]? (Streak|Aero|Venue|Venue Pro|Flash|Smoke|Mini 3iX)|XCD28|XCD35|\\\\b001DL\\\\b|\\\\b101DL\\\\b|\\\\bGS01\\\\b\",\r\n        \"Motorola\": \"Motorola|DROIDX|DROID BIONIC|\\\\bDroid\\\\b.*Build|Android.*Xoom|HRI39|MOT-|A1260|A1680|A555|A853|A855|A953|A955|A956|Motorola.*ELECTRIFY|Motorola.*i1|i867|i940|MB200|MB300|MB501|MB502|MB508|MB511|MB520|MB525|MB526|MB611|MB612|MB632|MB810|MB855|MB860|MB861|MB865|MB870|ME501|ME502|ME511|ME525|ME600|ME632|ME722|ME811|ME860|ME863|ME865|MT620|MT710|MT716|MT720|MT810|MT870|MT917|Motorola.*TITANIUM|WX435|WX445|XT300|XT301|XT311|XT316|XT317|XT319|XT320|XT390|XT502|XT530|XT531|XT532|XT535|XT603|XT610|XT611|XT615|XT681|XT701|XT702|XT711|XT720|XT800|XT806|XT860|XT862|XT875|XT882|XT883|XT894|XT901|XT907|XT909|XT910|XT912|XT928|XT926|XT915|XT919|XT925|XT1021|\\\\bMoto E\\\\b|XT1068|XT1092|XT1052\",\r\n        \"Samsung\": \"\\\\bSamsung\\\\b|SM-G950F|SM-G955F|SM-G9250|GT-19300|SGH-I337|BGT-S5230|GT-B2100|GT-B2700|GT-B2710|GT-B3210|GT-B3310|GT-B3410|GT-B3730|GT-B3740|GT-B5510|GT-B5512|GT-B5722|GT-B6520|GT-B7300|GT-B7320|GT-B7330|GT-B7350|GT-B7510|GT-B7722|GT-B7800|GT-C3010|GT-C3011|GT-C3060|GT-C3200|GT-C3212|GT-C3212I|GT-C3262|GT-C3222|GT-C3300|GT-C3300K|GT-C3303|GT-C3303K|GT-C3310|GT-C3322|GT-C3330|GT-C3350|GT-C3500|GT-C3510|GT-C3530|GT-C3630|GT-C3780|GT-C5010|GT-C5212|GT-C6620|GT-C6625|GT-C6712|GT-E1050|GT-E1070|GT-E1075|GT-E1080|GT-E1081|GT-E1085|GT-E1087|GT-E1100|GT-E1107|GT-E1110|GT-E1120|GT-E1125|GT-E1130|GT-E1160|GT-E1170|GT-E1175|GT-E1180|GT-E1182|GT-E1200|GT-E1210|GT-E1225|GT-E1230|GT-E1390|GT-E2100|GT-E2120|GT-E2121|GT-E2152|GT-E2220|GT-E2222|GT-E2230|GT-E2232|GT-E2250|GT-E2370|GT-E2550|GT-E2652|GT-E3210|GT-E3213|GT-I5500|GT-I5503|GT-I5700|GT-I5800|GT-I5801|GT-I6410|GT-I6420|GT-I7110|GT-I7410|GT-I7500|GT-I8000|GT-I8150|GT-I8160|GT-I8190|GT-I8320|GT-I8330|GT-I8350|GT-I8530|GT-I8700|GT-I8703|GT-I8910|GT-I9000|GT-I9001|GT-I9003|GT-I9010|GT-I9020|GT-I9023|GT-I9070|GT-I9082|GT-I9100|GT-I9103|GT-I9220|GT-I9250|GT-I9300|GT-I9305|GT-I9500|GT-I9505|GT-M3510|GT-M5650|GT-M7500|GT-M7600|GT-M7603|GT-M8800|GT-M8910|GT-N7000|GT-S3110|GT-S3310|GT-S3350|GT-S3353|GT-S3370|GT-S3650|GT-S3653|GT-S3770|GT-S3850|GT-S5210|GT-S5220|GT-S5229|GT-S5230|GT-S5233|GT-S5250|GT-S5253|GT-S5260|GT-S5263|GT-S5270|GT-S5300|GT-S5330|GT-S5350|GT-S5360|GT-S5363|GT-S5369|GT-S5380|GT-S5380D|GT-S5560|GT-S5570|GT-S5600|GT-S5603|GT-S5610|GT-S5620|GT-S5660|GT-S5670|GT-S5690|GT-S5750|GT-S5780|GT-S5830|GT-S5839|GT-S6102|GT-S6500|GT-S7070|GT-S7200|GT-S7220|GT-S7230|GT-S7233|GT-S7250|GT-S7500|GT-S7530|GT-S7550|GT-S7562|GT-S7710|GT-S8000|GT-S8003|GT-S8500|GT-S8530|GT-S8600|SCH-A310|SCH-A530|SCH-A570|SCH-A610|SCH-A630|SCH-A650|SCH-A790|SCH-A795|SCH-A850|SCH-A870|SCH-A890|SCH-A930|SCH-A950|SCH-A970|SCH-A990|SCH-I100|SCH-I110|SCH-I400|SCH-I405|SCH-I500|SCH-I510|SCH-I515|SCH-I600|SCH-I730|SCH-I760|SCH-I770|SCH-I830|SCH-I910|SCH-I920|SCH-I959|SCH-LC11|SCH-N150|SCH-N300|SCH-R100|SCH-R300|SCH-R351|SCH-R400|SCH-R410|SCH-T300|SCH-U310|SCH-U320|SCH-U350|SCH-U360|SCH-U365|SCH-U370|SCH-U380|SCH-U410|SCH-U430|SCH-U450|SCH-U460|SCH-U470|SCH-U490|SCH-U540|SCH-U550|SCH-U620|SCH-U640|SCH-U650|SCH-U660|SCH-U700|SCH-U740|SCH-U750|SCH-U810|SCH-U820|SCH-U900|SCH-U940|SCH-U960|SCS-26UC|SGH-A107|SGH-A117|SGH-A127|SGH-A137|SGH-A157|SGH-A167|SGH-A177|SGH-A187|SGH-A197|SGH-A227|SGH-A237|SGH-A257|SGH-A437|SGH-A517|SGH-A597|SGH-A637|SGH-A657|SGH-A667|SGH-A687|SGH-A697|SGH-A707|SGH-A717|SGH-A727|SGH-A737|SGH-A747|SGH-A767|SGH-A777|SGH-A797|SGH-A817|SGH-A827|SGH-A837|SGH-A847|SGH-A867|SGH-A877|SGH-A887|SGH-A897|SGH-A927|SGH-B100|SGH-B130|SGH-B200|SGH-B220|SGH-C100|SGH-C110|SGH-C120|SGH-C130|SGH-C140|SGH-C160|SGH-C170|SGH-C180|SGH-C200|SGH-C207|SGH-C210|SGH-C225|SGH-C230|SGH-C417|SGH-C450|SGH-D307|SGH-D347|SGH-D357|SGH-D407|SGH-D415|SGH-D780|SGH-D807|SGH-D980|SGH-E105|SGH-E200|SGH-E315|SGH-E316|SGH-E317|SGH-E335|SGH-E590|SGH-E635|SGH-E715|SGH-E890|SGH-F300|SGH-F480|SGH-I200|SGH-I300|SGH-I320|SGH-I550|SGH-I577|SGH-I600|SGH-I607|SGH-I617|SGH-I627|SGH-I637|SGH-I677|SGH-I700|SGH-I717|SGH-I727|SGH-i747M|SGH-I777|SGH-I780|SGH-I827|SGH-I847|SGH-I857|SGH-I896|SGH-I897|SGH-I900|SGH-I907|SGH-I917|SGH-I927|SGH-I937|SGH-I997|SGH-J150|SGH-J200|SGH-L170|SGH-L700|SGH-M110|SGH-M150|SGH-M200|SGH-N105|SGH-N500|SGH-N600|SGH-N620|SGH-N625|SGH-N700|SGH-N710|SGH-P107|SGH-P207|SGH-P300|SGH-P310|SGH-P520|SGH-P735|SGH-P777|SGH-Q105|SGH-R210|SGH-R220|SGH-R225|SGH-S105|SGH-S307|SGH-T109|SGH-T119|SGH-T139|SGH-T209|SGH-T219|SGH-T229|SGH-T239|SGH-T249|SGH-T259|SGH-T309|SGH-T319|SGH-T329|SGH-T339|SGH-T349|SGH-T359|SGH-T369|SGH-T379|SGH-T409|SGH-T429|SGH-T439|SGH-T459|SGH-T469|SGH-T479|SGH-T499|SGH-T509|SGH-T519|SGH-T539|SGH-T559|SGH-T589|SGH-T609|SGH-T619|SGH-T629|SGH-T639|SGH-T659|SGH-T669|SGH-T679|SGH-T709|SGH-T719|SGH-T729|SGH-T739|SGH-T746|SGH-T749|SGH-T759|SGH-T769|SGH-T809|SGH-T819|SGH-T839|SGH-T919|SGH-T929|SGH-T939|SGH-T959|SGH-T989|SGH-U100|SGH-U200|SGH-U800|SGH-V205|SGH-V206|SGH-X100|SGH-X105|SGH-X120|SGH-X140|SGH-X426|SGH-X427|SGH-X475|SGH-X495|SGH-X497|SGH-X507|SGH-X600|SGH-X610|SGH-X620|SGH-X630|SGH-X700|SGH-X820|SGH-X890|SGH-Z130|SGH-Z150|SGH-Z170|SGH-ZX10|SGH-ZX20|SHW-M110|SPH-A120|SPH-A400|SPH-A420|SPH-A460|SPH-A500|SPH-A560|SPH-A600|SPH-A620|SPH-A660|SPH-A700|SPH-A740|SPH-A760|SPH-A790|SPH-A800|SPH-A820|SPH-A840|SPH-A880|SPH-A900|SPH-A940|SPH-A960|SPH-D600|SPH-D700|SPH-D710|SPH-D720|SPH-I300|SPH-I325|SPH-I330|SPH-I350|SPH-I500|SPH-I600|SPH-I700|SPH-L700|SPH-M100|SPH-M220|SPH-M240|SPH-M300|SPH-M305|SPH-M320|SPH-M330|SPH-M350|SPH-M360|SPH-M370|SPH-M380|SPH-M510|SPH-M540|SPH-M550|SPH-M560|SPH-M570|SPH-M580|SPH-M610|SPH-M620|SPH-M630|SPH-M800|SPH-M810|SPH-M850|SPH-M900|SPH-M910|SPH-M920|SPH-M930|SPH-N100|SPH-N200|SPH-N240|SPH-N300|SPH-N400|SPH-Z400|SWC-E100|SCH-i909|GT-N7100|GT-N7105|SCH-I535|SM-N900A|SGH-I317|SGH-T999L|GT-S5360B|GT-I8262|GT-S6802|GT-S6312|GT-S6310|GT-S5312|GT-S5310|GT-I9105|GT-I8510|GT-S6790N|SM-G7105|SM-N9005|GT-S5301|GT-I9295|GT-I9195|SM-C101|GT-S7392|GT-S7560|GT-B7610|GT-I5510|GT-S7582|GT-S7530E|GT-I8750|SM-G9006V|SM-G9008V|SM-G9009D|SM-G900A|SM-G900D|SM-G900F|SM-G900H|SM-G900I|SM-G900J|SM-G900K|SM-G900L|SM-G900M|SM-G900P|SM-G900R4|SM-G900S|SM-G900T|SM-G900V|SM-G900W8|SHV-E160K|SCH-P709|SCH-P729|SM-T2558|GT-I9205|SM-G9350|SM-J120F|SM-G920F|SM-G920V|SM-G930F|SM-N910C|SM-A310F|GT-I9190|SM-J500FN|SM-G903F|SM-J330F\",\r\n        \"LG\": \"\\\\bLG\\\\b;|LG[- ]?(C800|C900|E400|E610|E900|E-900|F160|F180K|F180L|F180S|730|855|L160|LS740|LS840|LS970|LU6200|MS690|MS695|MS770|MS840|MS870|MS910|P500|P700|P705|VM696|AS680|AS695|AX840|C729|E970|GS505|272|C395|E739BK|E960|L55C|L75C|LS696|LS860|P769BK|P350|P500|P509|P870|UN272|US730|VS840|VS950|LN272|LN510|LS670|LS855|LW690|MN270|MN510|P509|P769|P930|UN200|UN270|UN510|UN610|US670|US740|US760|UX265|UX840|VN271|VN530|VS660|VS700|VS740|VS750|VS910|VS920|VS930|VX9200|VX11000|AX840A|LW770|P506|P925|P999|E612|D955|D802|MS323|M257)|LM-G710\",\r\n        \"Sony\": \"SonyST|SonyLT|SonyEricsson|SonyEricssonLT15iv|LT18i|E10i|LT28h|LT26w|SonyEricssonMT27i|C5303|C6902|C6903|C6906|C6943|D2533\",\r\n        \"Asus\": \"Asus.*Galaxy|PadFone.*Mobile\",\r\n        \"NokiaLumia\": \"Lumia [0-9]{3,4}\",\r\n        \"Micromax\": \"Micromax.*\\\\b(A210|A92|A88|A72|A111|A110Q|A115|A116|A110|A90S|A26|A51|A35|A54|A25|A27|A89|A68|A65|A57|A90)\\\\b\",\r\n        \"Palm\": \"PalmSource|Palm\",\r\n        \"Vertu\": \"Vertu|Vertu.*Ltd|Vertu.*Ascent|Vertu.*Ayxta|Vertu.*Constellation(F|Quest)?|Vertu.*Monika|Vertu.*Signature\",\r\n        \"Pantech\": \"PANTECH|IM-A850S|IM-A840S|IM-A830L|IM-A830K|IM-A830S|IM-A820L|IM-A810K|IM-A810S|IM-A800S|IM-T100K|IM-A725L|IM-A780L|IM-A775C|IM-A770K|IM-A760S|IM-A750K|IM-A740S|IM-A730S|IM-A720L|IM-A710K|IM-A690L|IM-A690S|IM-A650S|IM-A630K|IM-A600S|VEGA PTL21|PT003|P8010|ADR910L|P6030|P6020|P9070|P4100|P9060|P5000|CDM8992|TXT8045|ADR8995|IS11PT|P2030|P6010|P8000|PT002|IS06|CDM8999|P9050|PT001|TXT8040|P2020|P9020|P2000|P7040|P7000|C790\",\r\n        \"Fly\": \"IQ230|IQ444|IQ450|IQ440|IQ442|IQ441|IQ245|IQ256|IQ236|IQ255|IQ235|IQ245|IQ275|IQ240|IQ285|IQ280|IQ270|IQ260|IQ250\",\r\n        \"Wiko\": \"KITE 4G|HIGHWAY|GETAWAY|STAIRWAY|DARKSIDE|DARKFULL|DARKNIGHT|DARKMOON|SLIDE|WAX 4G|RAINBOW|BLOOM|SUNSET|GOA(?!nna)|LENNY|BARRY|IGGY|OZZY|CINK FIVE|CINK PEAX|CINK PEAX 2|CINK SLIM|CINK SLIM 2|CINK +|CINK KING|CINK PEAX|CINK SLIM|SUBLIM\",\r\n        \"iMobile\": \"i-mobile (IQ|i-STYLE|idea|ZAA|Hitz)\",\r\n        \"SimValley\": \"\\\\b(SP-80|XT-930|SX-340|XT-930|SX-310|SP-360|SP60|SPT-800|SP-120|SPT-800|SP-140|SPX-5|SPX-8|SP-100|SPX-8|SPX-12)\\\\b\",\r\n        \"Wolfgang\": \"AT-B24D|AT-AS50HD|AT-AS40W|AT-AS55HD|AT-AS45q2|AT-B26D|AT-AS50Q\",\r\n        \"Alcatel\": \"Alcatel\",\r\n        \"Nintendo\": \"Nintendo (3DS|Switch)\",\r\n        \"Amoi\": \"Amoi\",\r\n        \"INQ\": \"INQ\",\r\n        \"OnePlus\": \"ONEPLUS\",\r\n        \"GenericPhone\": \"Tapatalk|PDA;|SAGEM|\\\\bmmp\\\\b|pocket|\\\\bpsp\\\\b|symbian|Smartphone|smartfon|treo|up.browser|up.link|vodafone|\\\\bwap\\\\b|nokia|Series40|Series60|S60|SonyEricsson|N900|MAUI.*WAP.*Browser\"\r\n    },\r\n    \"tablets\": {\r\n        \"iPad\": \"iPad|iPad.*Mobile\",\r\n        \"NexusTablet\": \"Android.*Nexus[\\\\s]+(7|9|10)\",\r\n        \"GoogleTablet\": \"Android.*Pixel C\",\r\n        \"SamsungTablet\": \"SAMSUNG.*Tablet|Galaxy.*Tab|SC-01C|GT-P1000|GT-P1003|GT-P1010|GT-P3105|GT-P6210|GT-P6800|GT-P6810|GT-P7100|GT-P7300|GT-P7310|GT-P7500|GT-P7510|SCH-I800|SCH-I815|SCH-I905|SGH-I957|SGH-I987|SGH-T849|SGH-T859|SGH-T869|SPH-P100|GT-P3100|GT-P3108|GT-P3110|GT-P5100|GT-P5110|GT-P6200|GT-P7320|GT-P7511|GT-N8000|GT-P8510|SGH-I497|SPH-P500|SGH-T779|SCH-I705|SCH-I915|GT-N8013|GT-P3113|GT-P5113|GT-P8110|GT-N8010|GT-N8005|GT-N8020|GT-P1013|GT-P6201|GT-P7501|GT-N5100|GT-N5105|GT-N5110|SHV-E140K|SHV-E140L|SHV-E140S|SHV-E150S|SHV-E230K|SHV-E230L|SHV-E230S|SHW-M180K|SHW-M180L|SHW-M180S|SHW-M180W|SHW-M300W|SHW-M305W|SHW-M380K|SHW-M380S|SHW-M380W|SHW-M430W|SHW-M480K|SHW-M480S|SHW-M480W|SHW-M485W|SHW-M486W|SHW-M500W|GT-I9228|SCH-P739|SCH-I925|GT-I9200|GT-P5200|GT-P5210|GT-P5210X|SM-T311|SM-T310|SM-T310X|SM-T210|SM-T210R|SM-T211|SM-P600|SM-P601|SM-P605|SM-P900|SM-P901|SM-T217|SM-T217A|SM-T217S|SM-P6000|SM-T3100|SGH-I467|XE500|SM-T110|GT-P5220|GT-I9200X|GT-N5110X|GT-N5120|SM-P905|SM-T111|SM-T2105|SM-T315|SM-T320|SM-T320X|SM-T321|SM-T520|SM-T525|SM-T530NU|SM-T230NU|SM-T330NU|SM-T900|XE500T1C|SM-P605V|SM-P905V|SM-T337V|SM-T537V|SM-T707V|SM-T807V|SM-P600X|SM-P900X|SM-T210X|SM-T230|SM-T230X|SM-T325|GT-P7503|SM-T531|SM-T330|SM-T530|SM-T705|SM-T705C|SM-T535|SM-T331|SM-T800|SM-T700|SM-T537|SM-T807|SM-P907A|SM-T337A|SM-T537A|SM-T707A|SM-T807A|SM-T237|SM-T807P|SM-P607T|SM-T217T|SM-T337T|SM-T807T|SM-T116NQ|SM-T116BU|SM-P550|SM-T350|SM-T550|SM-T9000|SM-P9000|SM-T705Y|SM-T805|GT-P3113|SM-T710|SM-T810|SM-T815|SM-T360|SM-T533|SM-T113|SM-T335|SM-T715|SM-T560|SM-T670|SM-T677|SM-T377|SM-T567|SM-T357T|SM-T555|SM-T561|SM-T713|SM-T719|SM-T813|SM-T819|SM-T580|SM-T355Y?|SM-T280|SM-T817A|SM-T820|SM-W700|SM-P580|SM-T587|SM-P350|SM-P555M|SM-P355M|SM-T113NU|SM-T815Y|SM-T585|SM-T285|SM-T825|SM-W708|SM-T835|SM-T830|SM-T837V|SM-T720|SM-T510|SM-T387V\",\r\n        \"Kindle\": \"Kindle|Silk.*Accelerated|Android.*\\\\b(KFOT|KFTT|KFJWI|KFJWA|KFOTE|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|WFJWAE|KFSAWA|KFSAWI|KFASWI|KFARWI|KFFOWI|KFGIWI|KFMEWI)\\\\b|Android.*Silk\\/[0-9.]+ like Chrome\\/[0-9.]+ (?!Mobile)\",\r\n        \"SurfaceTablet\": \"Windows NT [0-9.]+; ARM;.*(Tablet|ARMBJS)\",\r\n        \"HPTablet\": \"HP Slate (7|8|10)|HP ElitePad 900|hp-tablet|EliteBook.*Touch|HP 8|Slate 21|HP SlateBook 10\",\r\n        \"AsusTablet\": \"^.*PadFone((?!Mobile).)*$|Transformer|TF101|TF101G|TF300T|TF300TG|TF300TL|TF700T|TF700KL|TF701T|TF810C|ME171|ME301T|ME302C|ME371MG|ME370T|ME372MG|ME172V|ME173X|ME400C|Slider SL101|\\\\bK00F\\\\b|\\\\bK00C\\\\b|\\\\bK00E\\\\b|\\\\bK00L\\\\b|TX201LA|ME176C|ME102A|\\\\bM80TA\\\\b|ME372CL|ME560CG|ME372CG|ME302KL| K010 | K011 | K017 | K01E |ME572C|ME103K|ME170C|ME171C|\\\\bME70C\\\\b|ME581C|ME581CL|ME8510C|ME181C|P01Y|PO1MA|P01Z|\\\\bP027\\\\b|\\\\bP024\\\\b|\\\\bP00C\\\\b\",\r\n        \"BlackBerryTablet\": \"PlayBook|RIM Tablet\",\r\n        \"HTCtablet\": \"HTC_Flyer_P512|HTC Flyer|HTC Jetstream|HTC-P715a|HTC EVO View 4G|PG41200|PG09410\",\r\n        \"MotorolaTablet\": \"xoom|sholest|MZ615|MZ605|MZ505|MZ601|MZ602|MZ603|MZ604|MZ606|MZ607|MZ608|MZ609|MZ615|MZ616|MZ617\",\r\n        \"NookTablet\": \"Android.*Nook|NookColor|nook browser|BNRV200|BNRV200A|BNTV250|BNTV250A|BNTV400|BNTV600|LogicPD Zoom2\",\r\n        \"AcerTablet\": \"Android.*; \\\\b(A100|A101|A110|A200|A210|A211|A500|A501|A510|A511|A700|A701|W500|W500P|W501|W501P|W510|W511|W700|G100|G100W|B1-A71|B1-710|B1-711|A1-810|A1-811|A1-830)\\\\b|W3-810|\\\\bA3-A10\\\\b|\\\\bA3-A11\\\\b|\\\\bA3-A20\\\\b|\\\\bA3-A30\",\r\n        \"ToshibaTablet\": \"Android.*(AT100|AT105|AT200|AT205|AT270|AT275|AT300|AT305|AT1S5|AT500|AT570|AT700|AT830)|TOSHIBA.*FOLIO\",\r\n        \"LGTablet\": \"\\\\bL-06C|LG-V909|LG-V900|LG-V700|LG-V510|LG-V500|LG-V410|LG-V400|LG-VK810\\\\b\",\r\n        \"FujitsuTablet\": \"Android.*\\\\b(F-01D|F-02F|F-05E|F-10D|M532|Q572)\\\\b\",\r\n        \"PrestigioTablet\": \"PMP3170B|PMP3270B|PMP3470B|PMP7170B|PMP3370B|PMP3570C|PMP5870C|PMP3670B|PMP5570C|PMP5770D|PMP3970B|PMP3870C|PMP5580C|PMP5880D|PMP5780D|PMP5588C|PMP7280C|PMP7280C3G|PMP7280|PMP7880D|PMP5597D|PMP5597|PMP7100D|PER3464|PER3274|PER3574|PER3884|PER5274|PER5474|PMP5097CPRO|PMP5097|PMP7380D|PMP5297C|PMP5297C_QUAD|PMP812E|PMP812E3G|PMP812F|PMP810E|PMP880TD|PMT3017|PMT3037|PMT3047|PMT3057|PMT7008|PMT5887|PMT5001|PMT5002\",\r\n        \"LenovoTablet\": \"Lenovo TAB|Idea(Tab|Pad)( A1|A10| K1|)|ThinkPad([ ]+)?Tablet|YT3-850M|YT3-X90L|YT3-X90F|YT3-X90X|Lenovo.*(S2109|S2110|S5000|S6000|K3011|A3000|A3500|A1000|A2107|A2109|A1107|A5500|A7600|B6000|B8000|B8080)(-|)(FL|F|HV|H|)|TB-X103F|TB-X304X|TB-X304F|TB-X304L|TB-X505F|TB-X505L|TB-X505X|TB-X605F|TB-X605L|TB-8703F|TB-8703X|TB-8703N|TB-8704N|TB-8704F|TB-8704X|TB-8704V|TB-7304F|TB-7304I|TB-7304X|Tab2A7-10F|Tab2A7-20F|TB2-X30L|YT3-X50L|YT3-X50F|YT3-X50M|YT-X705F|YT-X703F|YT-X703L|YT-X705L|YT-X705X|TB2-X30F|TB2-X30L|TB2-X30M|A2107A-F|A2107A-H|TB3-730F|TB3-730M|TB3-730X|TB-7504F|TB-7504X\",\r\n        \"DellTablet\": \"Venue 11|Venue 8|Venue 7|Dell Streak 10|Dell Streak 7\",\r\n        \"YarvikTablet\": \"Android.*\\\\b(TAB210|TAB211|TAB224|TAB250|TAB260|TAB264|TAB310|TAB360|TAB364|TAB410|TAB411|TAB420|TAB424|TAB450|TAB460|TAB461|TAB464|TAB465|TAB467|TAB468|TAB07-100|TAB07-101|TAB07-150|TAB07-151|TAB07-152|TAB07-200|TAB07-201-3G|TAB07-210|TAB07-211|TAB07-212|TAB07-214|TAB07-220|TAB07-400|TAB07-485|TAB08-150|TAB08-200|TAB08-201-3G|TAB08-201-30|TAB09-100|TAB09-211|TAB09-410|TAB10-150|TAB10-201|TAB10-211|TAB10-400|TAB10-410|TAB13-201|TAB274EUK|TAB275EUK|TAB374EUK|TAB462EUK|TAB474EUK|TAB9-200)\\\\b\",\r\n        \"MedionTablet\": \"Android.*\\\\bOYO\\\\b|LIFE.*(P9212|P9514|P9516|S9512)|LIFETAB\",\r\n        \"ArnovaTablet\": \"97G4|AN10G2|AN7bG3|AN7fG3|AN8G3|AN8cG3|AN7G3|AN9G3|AN7dG3|AN7dG3ST|AN7dG3ChildPad|AN10bG3|AN10bG3DT|AN9G2\",\r\n        \"IntensoTablet\": \"INM8002KP|INM1010FP|INM805ND|Intenso Tab|TAB1004\",\r\n        \"IRUTablet\": \"M702pro\",\r\n        \"MegafonTablet\": \"MegaFon V9|\\\\bZTE V9\\\\b|Android.*\\\\bMT7A\\\\b\",\r\n        \"EbodaTablet\": \"E-Boda (Supreme|Impresspeed|Izzycomm|Essential)\",\r\n        \"AllViewTablet\": \"Allview.*(Viva|Alldro|City|Speed|All TV|Frenzy|Quasar|Shine|TX1|AX1|AX2)\",\r\n        \"ArchosTablet\": \"\\\\b(101G9|80G9|A101IT)\\\\b|Qilive 97R|Archos5|\\\\bARCHOS (70|79|80|90|97|101|FAMILYPAD|)(b|c|)(G10| Cobalt| TITANIUM(HD|)| Xenon| Neon|XSK| 2| XS 2| PLATINUM| CARBON|GAMEPAD)\\\\b\",\r\n        \"AinolTablet\": \"NOVO7|NOVO8|NOVO10|Novo7Aurora|Novo7Basic|NOVO7PALADIN|novo9-Spark\",\r\n        \"NokiaLumiaTablet\": \"Lumia 2520\",\r\n        \"SonyTablet\": \"Sony.*Tablet|Xperia Tablet|Sony Tablet S|SO-03E|SGPT12|SGPT13|SGPT114|SGPT121|SGPT122|SGPT123|SGPT111|SGPT112|SGPT113|SGPT131|SGPT132|SGPT133|SGPT211|SGPT212|SGPT213|SGP311|SGP312|SGP321|EBRD1101|EBRD1102|EBRD1201|SGP351|SGP341|SGP511|SGP512|SGP521|SGP541|SGP551|SGP621|SGP641|SGP612|SOT31|SGP771|SGP611|SGP612|SGP712\",\r\n        \"PhilipsTablet\": \"\\\\b(PI2010|PI3000|PI3100|PI3105|PI3110|PI3205|PI3210|PI3900|PI4010|PI7000|PI7100)\\\\b\",\r\n        \"CubeTablet\": \"Android.*(K8GT|U9GT|U10GT|U16GT|U17GT|U18GT|U19GT|U20GT|U23GT|U30GT)|CUBE U8GT\",\r\n        \"CobyTablet\": \"MID1042|MID1045|MID1125|MID1126|MID7012|MID7014|MID7015|MID7034|MID7035|MID7036|MID7042|MID7048|MID7127|MID8042|MID8048|MID8127|MID9042|MID9740|MID9742|MID7022|MID7010\",\r\n        \"MIDTablet\": \"M9701|M9000|M9100|M806|M1052|M806|T703|MID701|MID713|MID710|MID727|MID760|MID830|MID728|MID933|MID125|MID810|MID732|MID120|MID930|MID800|MID731|MID900|MID100|MID820|MID735|MID980|MID130|MID833|MID737|MID960|MID135|MID860|MID736|MID140|MID930|MID835|MID733|MID4X10\",\r\n        \"MSITablet\": \"MSI \\\\b(Primo 73K|Primo 73L|Primo 81L|Primo 77|Primo 93|Primo 75|Primo 76|Primo 73|Primo 81|Primo 91|Primo 90|Enjoy 71|Enjoy 7|Enjoy 10)\\\\b\",\r\n        \"SMiTTablet\": \"Android.*(\\\\bMID\\\\b|MID-560|MTV-T1200|MTV-PND531|MTV-P1101|MTV-PND530)\",\r\n        \"RockChipTablet\": \"Android.*(RK2818|RK2808A|RK2918|RK3066)|RK2738|RK2808A\",\r\n        \"FlyTablet\": \"IQ310|Fly Vision\",\r\n        \"bqTablet\": \"Android.*(bq)?.*\\\\b(Elcano|Curie|Edison|Maxwell|Kepler|Pascal|Tesla|Hypatia|Platon|Newton|Livingstone|Cervantes|Avant|Aquaris ([E|M]10|M8))\\\\b|Maxwell.*Lite|Maxwell.*Plus\",\r\n        \"HuaweiTablet\": \"MediaPad|MediaPad 7 Youth|IDEOS S7|S7-201c|S7-202u|S7-101|S7-103|S7-104|S7-105|S7-106|S7-201|S7-Slim|M2-A01L|BAH-L09|BAH-W09|AGS-L09|CMR-AL19\",\r\n        \"NecTablet\": \"\\\\bN-06D|\\\\bN-08D\",\r\n        \"PantechTablet\": \"Pantech.*P4100\",\r\n        \"BronchoTablet\": \"Broncho.*(N701|N708|N802|a710)\",\r\n        \"VersusTablet\": \"TOUCHPAD.*[78910]|\\\\bTOUCHTAB\\\\b\",\r\n        \"ZyncTablet\": \"z1000|Z99 2G|z930|z990|z909|Z919|z900\",\r\n        \"PositivoTablet\": \"TB07STA|TB10STA|TB07FTA|TB10FTA\",\r\n        \"NabiTablet\": \"Android.*\\\\bNabi\",\r\n        \"KoboTablet\": \"Kobo Touch|\\\\bK080\\\\b|\\\\bVox\\\\b Build|\\\\bArc\\\\b Build\",\r\n        \"DanewTablet\": \"DSlide.*\\\\b(700|701R|702|703R|704|802|970|971|972|973|974|1010|1012)\\\\b\",\r\n        \"TexetTablet\": \"NaviPad|TB-772A|TM-7045|TM-7055|TM-9750|TM-7016|TM-7024|TM-7026|TM-7041|TM-7043|TM-7047|TM-8041|TM-9741|TM-9747|TM-9748|TM-9751|TM-7022|TM-7021|TM-7020|TM-7011|TM-7010|TM-7023|TM-7025|TM-7037W|TM-7038W|TM-7027W|TM-9720|TM-9725|TM-9737W|TM-1020|TM-9738W|TM-9740|TM-9743W|TB-807A|TB-771A|TB-727A|TB-725A|TB-719A|TB-823A|TB-805A|TB-723A|TB-715A|TB-707A|TB-705A|TB-709A|TB-711A|TB-890HD|TB-880HD|TB-790HD|TB-780HD|TB-770HD|TB-721HD|TB-710HD|TB-434HD|TB-860HD|TB-840HD|TB-760HD|TB-750HD|TB-740HD|TB-730HD|TB-722HD|TB-720HD|TB-700HD|TB-500HD|TB-470HD|TB-431HD|TB-430HD|TB-506|TB-504|TB-446|TB-436|TB-416|TB-146SE|TB-126SE\",\r\n        \"PlaystationTablet\": \"Playstation.*(Portable|Vita)\",\r\n        \"TrekstorTablet\": \"ST10416-1|VT10416-1|ST70408-1|ST702xx-1|ST702xx-2|ST80208|ST97216|ST70104-2|VT10416-2|ST10216-2A|SurfTab\",\r\n        \"PyleAudioTablet\": \"\\\\b(PTBL10CEU|PTBL10C|PTBL72BC|PTBL72BCEU|PTBL7CEU|PTBL7C|PTBL92BC|PTBL92BCEU|PTBL9CEU|PTBL9CUK|PTBL9C)\\\\b\",\r\n        \"AdvanTablet\": \"Android.* \\\\b(E3A|T3X|T5C|T5B|T3E|T3C|T3B|T1J|T1F|T2A|T1H|T1i|E1C|T1-E|T5-A|T4|E1-B|T2Ci|T1-B|T1-D|O1-A|E1-A|T1-A|T3A|T4i)\\\\b \",\r\n        \"DanyTechTablet\": \"Genius Tab G3|Genius Tab S2|Genius Tab Q3|Genius Tab G4|Genius Tab Q4|Genius Tab G-II|Genius TAB GII|Genius TAB GIII|Genius Tab S1\",\r\n        \"GalapadTablet\": \"Android.*\\\\bG1\\\\b(?!\\\\))\",\r\n        \"MicromaxTablet\": \"Funbook|Micromax.*\\\\b(P250|P560|P360|P362|P600|P300|P350|P500|P275)\\\\b\",\r\n        \"KarbonnTablet\": \"Android.*\\\\b(A39|A37|A34|ST8|ST10|ST7|Smart Tab3|Smart Tab2)\\\\b\",\r\n        \"AllFineTablet\": \"Fine7 Genius|Fine7 Shine|Fine7 Air|Fine8 Style|Fine9 More|Fine10 Joy|Fine11 Wide\",\r\n        \"PROSCANTablet\": \"\\\\b(PEM63|PLT1023G|PLT1041|PLT1044|PLT1044G|PLT1091|PLT4311|PLT4311PL|PLT4315|PLT7030|PLT7033|PLT7033D|PLT7035|PLT7035D|PLT7044K|PLT7045K|PLT7045KB|PLT7071KG|PLT7072|PLT7223G|PLT7225G|PLT7777G|PLT7810K|PLT7849G|PLT7851G|PLT7852G|PLT8015|PLT8031|PLT8034|PLT8036|PLT8080K|PLT8082|PLT8088|PLT8223G|PLT8234G|PLT8235G|PLT8816K|PLT9011|PLT9045K|PLT9233G|PLT9735|PLT9760G|PLT9770G)\\\\b\",\r\n        \"YONESTablet\": \"BQ1078|BC1003|BC1077|RK9702|BC9730|BC9001|IT9001|BC7008|BC7010|BC708|BC728|BC7012|BC7030|BC7027|BC7026\",\r\n        \"ChangJiaTablet\": \"TPC7102|TPC7103|TPC7105|TPC7106|TPC7107|TPC7201|TPC7203|TPC7205|TPC7210|TPC7708|TPC7709|TPC7712|TPC7110|TPC8101|TPC8103|TPC8105|TPC8106|TPC8203|TPC8205|TPC8503|TPC9106|TPC9701|TPC97101|TPC97103|TPC97105|TPC97106|TPC97111|TPC97113|TPC97203|TPC97603|TPC97809|TPC97205|TPC10101|TPC10103|TPC10106|TPC10111|TPC10203|TPC10205|TPC10503\",\r\n        \"GUTablet\": \"TX-A1301|TX-M9002|Q702|kf026\",\r\n        \"PointOfViewTablet\": \"TAB-P506|TAB-navi-7-3G-M|TAB-P517|TAB-P-527|TAB-P701|TAB-P703|TAB-P721|TAB-P731N|TAB-P741|TAB-P825|TAB-P905|TAB-P925|TAB-PR945|TAB-PL1015|TAB-P1025|TAB-PI1045|TAB-P1325|TAB-PROTAB[0-9]+|TAB-PROTAB25|TAB-PROTAB26|TAB-PROTAB27|TAB-PROTAB26XL|TAB-PROTAB2-IPS9|TAB-PROTAB30-IPS9|TAB-PROTAB25XXL|TAB-PROTAB26-IPS10|TAB-PROTAB30-IPS10\",\r\n        \"OvermaxTablet\": \"OV-(SteelCore|NewBase|Basecore|Baseone|Exellen|Quattor|EduTab|Solution|ACTION|BasicTab|TeddyTab|MagicTab|Stream|TB-08|TB-09)|Qualcore 1027\",\r\n        \"HCLTablet\": \"HCL.*Tablet|Connect-3G-2.0|Connect-2G-2.0|ME Tablet U1|ME Tablet U2|ME Tablet G1|ME Tablet X1|ME Tablet Y2|ME Tablet Sync\",\r\n        \"DPSTablet\": \"DPS Dream 9|DPS Dual 7\",\r\n        \"VistureTablet\": \"V97 HD|i75 3G|Visture V4( HD)?|Visture V5( HD)?|Visture V10\",\r\n        \"CrestaTablet\": \"CTP(-)?810|CTP(-)?818|CTP(-)?828|CTP(-)?838|CTP(-)?888|CTP(-)?978|CTP(-)?980|CTP(-)?987|CTP(-)?988|CTP(-)?989\",\r\n        \"MediatekTablet\": \"\\\\bMT8125|MT8389|MT8135|MT8377\\\\b\",\r\n        \"ConcordeTablet\": \"Concorde([ ]+)?Tab|ConCorde ReadMan\",\r\n        \"GoCleverTablet\": \"GOCLEVER TAB|A7GOCLEVER|M1042|M7841|M742|R1042BK|R1041|TAB A975|TAB A7842|TAB A741|TAB A741L|TAB M723G|TAB M721|TAB A1021|TAB I921|TAB R721|TAB I720|TAB T76|TAB R70|TAB R76.2|TAB R106|TAB R83.2|TAB M813G|TAB I721|GCTA722|TAB I70|TAB I71|TAB S73|TAB R73|TAB R74|TAB R93|TAB R75|TAB R76.1|TAB A73|TAB A93|TAB A93.2|TAB T72|TAB R83|TAB R974|TAB R973|TAB A101|TAB A103|TAB A104|TAB A104.2|R105BK|M713G|A972BK|TAB A971|TAB R974.2|TAB R104|TAB R83.3|TAB A1042\",\r\n        \"ModecomTablet\": \"FreeTAB 9000|FreeTAB 7.4|FreeTAB 7004|FreeTAB 7800|FreeTAB 2096|FreeTAB 7.5|FreeTAB 1014|FreeTAB 1001 |FreeTAB 8001|FreeTAB 9706|FreeTAB 9702|FreeTAB 7003|FreeTAB 7002|FreeTAB 1002|FreeTAB 7801|FreeTAB 1331|FreeTAB 1004|FreeTAB 8002|FreeTAB 8014|FreeTAB 9704|FreeTAB 1003\",\r\n        \"VoninoTablet\": \"\\\\b(Argus[ _]?S|Diamond[ _]?79HD|Emerald[ _]?78E|Luna[ _]?70C|Onyx[ _]?S|Onyx[ _]?Z|Orin[ _]?HD|Orin[ _]?S|Otis[ _]?S|SpeedStar[ _]?S|Magnet[ _]?M9|Primus[ _]?94[ _]?3G|Primus[ _]?94HD|Primus[ _]?QS|Android.*\\\\bQ8\\\\b|Sirius[ _]?EVO[ _]?QS|Sirius[ _]?QS|Spirit[ _]?S)\\\\b\",\r\n        \"ECSTablet\": \"V07OT2|TM105A|S10OT1|TR10CS1\",\r\n        \"StorexTablet\": \"eZee[_']?(Tab|Go)[0-9]+|TabLC7|Looney Tunes Tab\",\r\n        \"VodafoneTablet\": \"SmartTab([ ]+)?[0-9]+|SmartTabII10|SmartTabII7|VF-1497|VFD 1400\",\r\n        \"EssentielBTablet\": \"Smart[ ']?TAB[ ]+?[0-9]+|Family[ ']?TAB2\",\r\n        \"RossMoorTablet\": \"RM-790|RM-997|RMD-878G|RMD-974R|RMT-705A|RMT-701|RME-601|RMT-501|RMT-711\",\r\n        \"iMobileTablet\": \"i-mobile i-note\",\r\n        \"TolinoTablet\": \"tolino tab [0-9.]+|tolino shine\",\r\n        \"AudioSonicTablet\": \"\\\\bC-22Q|T7-QC|T-17B|T-17P\\\\b\",\r\n        \"AMPETablet\": \"Android.* A78 \",\r\n        \"SkkTablet\": \"Android.* (SKYPAD|PHOENIX|CYCLOPS)\",\r\n        \"TecnoTablet\": \"TECNO P9|TECNO DP8D\",\r\n        \"JXDTablet\": \"Android.* \\\\b(F3000|A3300|JXD5000|JXD3000|JXD2000|JXD300B|JXD300|S5800|S7800|S602b|S5110b|S7300|S5300|S602|S603|S5100|S5110|S601|S7100a|P3000F|P3000s|P101|P200s|P1000m|P200m|P9100|P1000s|S6600b|S908|P1000|P300|S18|S6600|S9100)\\\\b\",\r\n        \"iJoyTablet\": \"Tablet (Spirit 7|Essentia|Galatea|Fusion|Onix 7|Landa|Titan|Scooby|Deox|Stella|Themis|Argon|Unique 7|Sygnus|Hexen|Finity 7|Cream|Cream X2|Jade|Neon 7|Neron 7|Kandy|Scape|Saphyr 7|Rebel|Biox|Rebel|Rebel 8GB|Myst|Draco 7|Myst|Tab7-004|Myst|Tadeo Jones|Tablet Boing|Arrow|Draco Dual Cam|Aurix|Mint|Amity|Revolution|Finity 9|Neon 9|T9w|Amity 4GB Dual Cam|Stone 4GB|Stone 8GB|Andromeda|Silken|X2|Andromeda II|Halley|Flame|Saphyr 9,7|Touch 8|Planet|Triton|Unique 10|Hexen 10|Memphis 4GB|Memphis 8GB|Onix 10)\",\r\n        \"FX2Tablet\": \"FX2 PAD7|FX2 PAD10\",\r\n        \"XoroTablet\": \"KidsPAD 701|PAD[ ]?712|PAD[ ]?714|PAD[ ]?716|PAD[ ]?717|PAD[ ]?718|PAD[ ]?720|PAD[ ]?721|PAD[ ]?722|PAD[ ]?790|PAD[ ]?792|PAD[ ]?900|PAD[ ]?9715D|PAD[ ]?9716DR|PAD[ ]?9718DR|PAD[ ]?9719QR|PAD[ ]?9720QR|TelePAD1030|Telepad1032|TelePAD730|TelePAD731|TelePAD732|TelePAD735Q|TelePAD830|TelePAD9730|TelePAD795|MegaPAD 1331|MegaPAD 1851|MegaPAD 2151\",\r\n        \"ViewsonicTablet\": \"ViewPad 10pi|ViewPad 10e|ViewPad 10s|ViewPad E72|ViewPad7|ViewPad E100|ViewPad 7e|ViewSonic VB733|VB100a\",\r\n        \"VerizonTablet\": \"QTAQZ3|QTAIR7|QTAQTZ3|QTASUN1|QTASUN2|QTAXIA1\",\r\n        \"OdysTablet\": \"LOOX|XENO10|ODYS[ -](Space|EVO|Xpress|NOON)|\\\\bXELIO\\\\b|Xelio10Pro|XELIO7PHONETAB|XELIO10EXTREME|XELIOPT2|NEO_QUAD10\",\r\n        \"CaptivaTablet\": \"CAPTIVA PAD\",\r\n        \"IconbitTablet\": \"NetTAB|NT-3702|NT-3702S|NT-3702S|NT-3603P|NT-3603P|NT-0704S|NT-0704S|NT-3805C|NT-3805C|NT-0806C|NT-0806C|NT-0909T|NT-0909T|NT-0907S|NT-0907S|NT-0902S|NT-0902S\",\r\n        \"TeclastTablet\": \"T98 4G|\\\\bP80\\\\b|\\\\bX90HD\\\\b|X98 Air|X98 Air 3G|\\\\bX89\\\\b|P80 3G|\\\\bX80h\\\\b|P98 Air|\\\\bX89HD\\\\b|P98 3G|\\\\bP90HD\\\\b|P89 3G|X98 3G|\\\\bP70h\\\\b|P79HD 3G|G18d 3G|\\\\bP79HD\\\\b|\\\\bP89s\\\\b|\\\\bA88\\\\b|\\\\bP10HD\\\\b|\\\\bP19HD\\\\b|G18 3G|\\\\bP78HD\\\\b|\\\\bA78\\\\b|\\\\bP75\\\\b|G17s 3G|G17h 3G|\\\\bP85t\\\\b|\\\\bP90\\\\b|\\\\bP11\\\\b|\\\\bP98t\\\\b|\\\\bP98HD\\\\b|\\\\bG18d\\\\b|\\\\bP85s\\\\b|\\\\bP11HD\\\\b|\\\\bP88s\\\\b|\\\\bA80HD\\\\b|\\\\bA80se\\\\b|\\\\bA10h\\\\b|\\\\bP89\\\\b|\\\\bP78s\\\\b|\\\\bG18\\\\b|\\\\bP85\\\\b|\\\\bA70h\\\\b|\\\\bA70\\\\b|\\\\bG17\\\\b|\\\\bP18\\\\b|\\\\bA80s\\\\b|\\\\bA11s\\\\b|\\\\bP88HD\\\\b|\\\\bA80h\\\\b|\\\\bP76s\\\\b|\\\\bP76h\\\\b|\\\\bP98\\\\b|\\\\bA10HD\\\\b|\\\\bP78\\\\b|\\\\bP88\\\\b|\\\\bA11\\\\b|\\\\bA10t\\\\b|\\\\bP76a\\\\b|\\\\bP76t\\\\b|\\\\bP76e\\\\b|\\\\bP85HD\\\\b|\\\\bP85a\\\\b|\\\\bP86\\\\b|\\\\bP75HD\\\\b|\\\\bP76v\\\\b|\\\\bA12\\\\b|\\\\bP75a\\\\b|\\\\bA15\\\\b|\\\\bP76Ti\\\\b|\\\\bP81HD\\\\b|\\\\bA10\\\\b|\\\\bT760VE\\\\b|\\\\bT720HD\\\\b|\\\\bP76\\\\b|\\\\bP73\\\\b|\\\\bP71\\\\b|\\\\bP72\\\\b|\\\\bT720SE\\\\b|\\\\bC520Ti\\\\b|\\\\bT760\\\\b|\\\\bT720VE\\\\b|T720-3GE|T720-WiFi\",\r\n        \"OndaTablet\": \"\\\\b(V975i|Vi30|VX530|V701|Vi60|V701s|Vi50|V801s|V719|Vx610w|VX610W|V819i|Vi10|VX580W|Vi10|V711s|V813|V811|V820w|V820|Vi20|V711|VI30W|V712|V891w|V972|V819w|V820w|Vi60|V820w|V711|V813s|V801|V819|V975s|V801|V819|V819|V818|V811|V712|V975m|V101w|V961w|V812|V818|V971|V971s|V919|V989|V116w|V102w|V973|Vi40)\\\\b[\\\\s]+|V10 \\\\b4G\\\\b\",\r\n        \"JaytechTablet\": \"TPC-PA762\",\r\n        \"BlaupunktTablet\": \"Endeavour 800NG|Endeavour 1010\",\r\n        \"DigmaTablet\": \"\\\\b(iDx10|iDx9|iDx8|iDx7|iDxD7|iDxD8|iDsQ8|iDsQ7|iDsQ8|iDsD10|iDnD7|3TS804H|iDsQ11|iDj7|iDs10)\\\\b\",\r\n        \"EvolioTablet\": \"ARIA_Mini_wifi|Aria[ _]Mini|Evolio X10|Evolio X7|Evolio X8|\\\\bEvotab\\\\b|\\\\bNeura\\\\b\",\r\n        \"LavaTablet\": \"QPAD E704|\\\\bIvoryS\\\\b|E-TAB IVORY|\\\\bE-TAB\\\\b\",\r\n        \"AocTablet\": \"MW0811|MW0812|MW0922|MTK8382|MW1031|MW0831|MW0821|MW0931|MW0712\",\r\n        \"MpmanTablet\": \"MP11 OCTA|MP10 OCTA|MPQC1114|MPQC1004|MPQC994|MPQC974|MPQC973|MPQC804|MPQC784|MPQC780|\\\\bMPG7\\\\b|MPDCG75|MPDCG71|MPDC1006|MP101DC|MPDC9000|MPDC905|MPDC706HD|MPDC706|MPDC705|MPDC110|MPDC100|MPDC99|MPDC97|MPDC88|MPDC8|MPDC77|MP709|MID701|MID711|MID170|MPDC703|MPQC1010\",\r\n        \"CelkonTablet\": \"CT695|CT888|CT[\\\\s]?910|CT7 Tab|CT9 Tab|CT3 Tab|CT2 Tab|CT1 Tab|C820|C720|\\\\bCT-1\\\\b\",\r\n        \"WolderTablet\": \"miTab \\\\b(DIAMOND|SPACE|BROOKLYN|NEO|FLY|MANHATTAN|FUNK|EVOLUTION|SKY|GOCAR|IRON|GENIUS|POP|MINT|EPSILON|BROADWAY|JUMP|HOP|LEGEND|NEW AGE|LINE|ADVANCE|FEEL|FOLLOW|LIKE|LINK|LIVE|THINK|FREEDOM|CHICAGO|CLEVELAND|BALTIMORE-GH|IOWA|BOSTON|SEATTLE|PHOENIX|DALLAS|IN 101|MasterChef)\\\\b\",\r\n        \"MediacomTablet\": \"M-MPI10C3G|M-SP10EG|M-SP10EGP|M-SP10HXAH|M-SP7HXAH|M-SP10HXBH|M-SP8HXAH|M-SP8MXA\",\r\n        \"MiTablet\": \"\\\\bMI PAD\\\\b|\\\\bHM NOTE 1W\\\\b\",\r\n        \"NibiruTablet\": \"Nibiru M1|Nibiru Jupiter One\",\r\n        \"NexoTablet\": \"NEXO NOVA|NEXO 10|NEXO AVIO|NEXO FREE|NEXO GO|NEXO EVO|NEXO 3G|NEXO SMART|NEXO KIDDO|NEXO MOBI\",\r\n        \"LeaderTablet\": \"TBLT10Q|TBLT10I|TBL-10WDKB|TBL-10WDKBO2013|TBL-W230V2|TBL-W450|TBL-W500|SV572|TBLT7I|TBA-AC7-8G|TBLT79|TBL-8W16|TBL-10W32|TBL-10WKB|TBL-W100\",\r\n        \"UbislateTablet\": \"UbiSlate[\\\\s]?7C\",\r\n        \"PocketBookTablet\": \"Pocketbook\",\r\n        \"KocasoTablet\": \"\\\\b(TB-1207)\\\\b\",\r\n        \"HisenseTablet\": \"\\\\b(F5281|E2371)\\\\b\",\r\n        \"Hudl\": \"Hudl HT7S3|Hudl 2\",\r\n        \"TelstraTablet\": \"T-Hub2\",\r\n        \"GenericTablet\": \"Android.*\\\\b97D\\\\b|Tablet(?!.*PC)|BNTV250A|MID-WCDMA|LogicPD Zoom2|\\\\bA7EB\\\\b|CatNova8|A1_07|CT704|CT1002|\\\\bM721\\\\b|rk30sdk|\\\\bEVOTAB\\\\b|M758A|ET904|ALUMIUM10|Smartfren Tab|Endeavour 1010|Tablet-PC-4|Tagi Tab|\\\\bM6pro\\\\b|CT1020W|arc 10HD|\\\\bTP750\\\\b|\\\\bQTAQZ3\\\\b|WVT101|TM1088|KT107\"\r\n    },\r\n    \"oss\": {\r\n        \"AndroidOS\": \"Android\",\r\n        \"BlackBerryOS\": \"blackberry|\\\\bBB10\\\\b|rim tablet os\",\r\n        \"PalmOS\": \"PalmOS|avantgo|blazer|elaine|hiptop|palm|plucker|xiino\",\r\n        \"SymbianOS\": \"Symbian|SymbOS|Series60|Series40|SYB-[0-9]+|\\\\bS60\\\\b\",\r\n        \"WindowsMobileOS\": \"Windows CE.*(PPC|Smartphone|Mobile|[0-9]{3}x[0-9]{3})|Windows Mobile|Windows Phone [0-9.]+|WCE;\",\r\n        \"WindowsPhoneOS\": \"Windows Phone 10.0|Windows Phone 8.1|Windows Phone 8.0|Windows Phone OS|XBLWP7|ZuneWP7|Windows NT 6.[23]; ARM;\",\r\n        \"iOS\": \"\\\\biPhone.*Mobile|\\\\biPod|\\\\biPad|AppleCoreMedia\",\r\n        \"iPadOS\": \"CPU OS 13\",\r\n        \"MeeGoOS\": \"MeeGo\",\r\n        \"MaemoOS\": \"Maemo\",\r\n        \"JavaOS\": \"J2ME\\/|\\\\bMIDP\\\\b|\\\\bCLDC\\\\b\",\r\n        \"webOS\": \"webOS|hpwOS\",\r\n        \"badaOS\": \"\\\\bBada\\\\b\",\r\n        \"BREWOS\": \"BREW\"\r\n    },\r\n    \"uas\": {\r\n        \"Chrome\": \"\\\\bCrMo\\\\b|CriOS|Android.*Chrome\\/[.0-9]* (Mobile)?\",\r\n        \"Dolfin\": \"\\\\bDolfin\\\\b\",\r\n        \"Opera\": \"Opera.*Mini|Opera.*Mobi|Android.*Opera|Mobile.*OPR\\/[0-9.]+$|Coast\\/[0-9.]+\",\r\n        \"Skyfire\": \"Skyfire\",\r\n        \"Edge\": \"Mobile Safari\\/[.0-9]* Edge\",\r\n        \"IE\": \"IEMobile|MSIEMobile\",\r\n        \"Firefox\": \"fennec|firefox.*maemo|(Mobile|Tablet).*Firefox|Firefox.*Mobile|FxiOS\",\r\n        \"Bolt\": \"bolt\",\r\n        \"TeaShark\": \"teashark\",\r\n        \"Blazer\": \"Blazer\",\r\n        \"Safari\": \"Version.*Mobile.*Safari|Safari.*Mobile|MobileSafari\",\r\n        \"WeChat\": \"\\\\bMicroMessenger\\\\b\",\r\n        \"UCBrowser\": \"UC.*Browser|UCWEB\",\r\n        \"baiduboxapp\": \"baiduboxapp\",\r\n        \"baidubrowser\": \"baidubrowser\",\r\n        \"DiigoBrowser\": \"DiigoBrowser\",\r\n        \"Mercury\": \"\\\\bMercury\\\\b\",\r\n        \"ObigoBrowser\": \"Obigo\",\r\n        \"NetFront\": \"NF-Browser\",\r\n        \"GenericBrowser\": \"NokiaBrowser|OviBrowser|OneBrowser|TwonkyBeamBrowser|SEMC.*Browser|FlyFlow|Minimo|NetFront|Novarra-Vision|MQQBrowser|MicroMessenger\",\r\n        \"PaleMoon\": \"Android.*PaleMoon|Mobile.*PaleMoon\"\r\n    },\r\n    \"props\": {\r\n        \"Mobile\": \"Mobile\\/[VER]\",\r\n        \"Build\": \"Build\\/[VER]\",\r\n        \"Version\": \"Version\\/[VER]\",\r\n        \"VendorID\": \"VendorID\\/[VER]\",\r\n        \"iPad\": \"iPad.*CPU[a-z ]+[VER]\",\r\n        \"iPhone\": \"iPhone.*CPU[a-z ]+[VER]\",\r\n        \"iPod\": \"iPod.*CPU[a-z ]+[VER]\",\r\n        \"Kindle\": \"Kindle\\/[VER]\",\r\n        \"Chrome\": [\r\n            \"Chrome\\/[VER]\",\r\n            \"CriOS\\/[VER]\",\r\n            \"CrMo\\/[VER]\"\r\n        ],\r\n        \"Coast\": [\r\n            \"Coast\\/[VER]\"\r\n        ],\r\n        \"Dolfin\": \"Dolfin\\/[VER]\",\r\n        \"Firefox\": [\r\n            \"Firefox\\/[VER]\",\r\n            \"FxiOS\\/[VER]\"\r\n        ],\r\n        \"Fennec\": \"Fennec\\/[VER]\",\r\n        \"Edge\": \"Edge\\/[VER]\",\r\n        \"IE\": [\r\n            \"IEMobile\\/[VER];\",\r\n            \"IEMobile [VER]\",\r\n            \"MSIE [VER];\",\r\n            \"Trident\\/[0-9.]+;.*rv:[VER]\"\r\n        ],\r\n        \"NetFront\": \"NetFront\\/[VER]\",\r\n        \"NokiaBrowser\": \"NokiaBrowser\\/[VER]\",\r\n        \"Opera\": [\r\n            \" OPR\\/[VER]\",\r\n            \"Opera Mini\\/[VER]\",\r\n            \"Version\\/[VER]\"\r\n        ],\r\n        \"Opera Mini\": \"Opera Mini\\/[VER]\",\r\n        \"Opera Mobi\": \"Version\\/[VER]\",\r\n        \"UCBrowser\": [\r\n            \"UCWEB[VER]\",\r\n            \"UC.*Browser\\/[VER]\"\r\n        ],\r\n        \"MQQBrowser\": \"MQQBrowser\\/[VER]\",\r\n        \"MicroMessenger\": \"MicroMessenger\\/[VER]\",\r\n        \"baiduboxapp\": \"baiduboxapp\\/[VER]\",\r\n        \"baidubrowser\": \"baidubrowser\\/[VER]\",\r\n        \"SamsungBrowser\": \"SamsungBrowser\\/[VER]\",\r\n        \"Iron\": \"Iron\\/[VER]\",\r\n        \"Safari\": [\r\n            \"Version\\/[VER]\",\r\n            \"Safari\\/[VER]\"\r\n        ],\r\n        \"Skyfire\": \"Skyfire\\/[VER]\",\r\n        \"Tizen\": \"Tizen\\/[VER]\",\r\n        \"Webkit\": \"webkit[ \\/][VER]\",\r\n        \"PaleMoon\": \"PaleMoon\\/[VER]\",\r\n        \"Gecko\": \"Gecko\\/[VER]\",\r\n        \"Trident\": \"Trident\\/[VER]\",\r\n        \"Presto\": \"Presto\\/[VER]\",\r\n        \"Goanna\": \"Goanna\\/[VER]\",\r\n        \"iOS\": \" \\\\bi?OS\\\\b [VER][ ;]{1}\",\r\n        \"Android\": \"Android [VER]\",\r\n        \"BlackBerry\": [\r\n            \"BlackBerry[\\\\w]+\\/[VER]\",\r\n            \"BlackBerry.*Version\\/[VER]\",\r\n            \"Version\\/[VER]\"\r\n        ],\r\n        \"BREW\": \"BREW [VER]\",\r\n        \"Java\": \"Java\\/[VER]\",\r\n        \"Windows Phone OS\": [\r\n            \"Windows Phone OS [VER]\",\r\n            \"Windows Phone [VER]\"\r\n        ],\r\n        \"Windows Phone\": \"Windows Phone [VER]\",\r\n        \"Windows CE\": \"Windows CE\\/[VER]\",\r\n        \"Windows NT\": \"Windows NT [VER]\",\r\n        \"Symbian\": [\r\n            \"SymbianOS\\/[VER]\",\r\n            \"Symbian\\/[VER]\"\r\n        ],\r\n        \"webOS\": [\r\n            \"webOS\\/[VER]\",\r\n            \"hpwOS\\/[VER];\"\r\n        ]\r\n    },\r\n    \"utils\": {\r\n        \"Bot\": \"Googlebot|facebookexternalhit|Google-AMPHTML|s~amp-validator|AdsBot-Google|Google Keyword Suggestion|Facebot|YandexBot|YandexMobileBot|bingbot|ia_archiver|AhrefsBot|Ezooms|GSLFbot|WBSearchBot|Twitterbot|TweetmemeBot|Twikle|PaperLiBot|Wotbox|UnwindFetchor|Exabot|MJ12bot|YandexImages|TurnitinBot|Pingdom|contentkingapp\",\r\n        \"MobileBot\": \"Googlebot-Mobile|AdsBot-Google-Mobile|YahooSeeker\\/M1A1-R2D2\",\r\n        \"DesktopMode\": \"WPDesktop\",\r\n        \"TV\": \"SonyDTV|HbbTV\",\r\n        \"WebKit\": \"(webkit)[ \\/]([\\\\w.]+)\",\r\n        \"Console\": \"\\\\b(Nintendo|Nintendo WiiU|Nintendo 3DS|Nintendo Switch|PLAYSTATION|Xbox)\\\\b\",\r\n        \"Watch\": \"SM-V700\"\r\n    }\r\n};\r\n\r\n    // following patterns come from http://detectmobilebrowsers.com/\r\n    impl.detectMobileBrowsers = {\r\n        fullPattern: /(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i,\r\n        shortPattern: /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i,\r\n        tabletPattern: /android|ipad|playbook|silk/i\r\n    };\r\n\r\n    var hasOwnProp = Object.prototype.hasOwnProperty,\r\n        isArray;\r\n\r\n    impl.FALLBACK_PHONE = 'UnknownPhone';\r\n    impl.FALLBACK_TABLET = 'UnknownTablet';\r\n    impl.FALLBACK_MOBILE = 'UnknownMobile';\r\n\r\n    isArray = ('isArray' in Array) ?\r\n        Array.isArray : function (value) { return Object.prototype.toString.call(value) === '[object Array]'; };\r\n\r\n    function equalIC(a, b) {\r\n        return a != null && b != null && a.toLowerCase() === b.toLowerCase();\r\n    }\r\n\r\n    function containsIC(array, value) {\r\n        var valueLC, i, len = array.length;\r\n        if (!len || !value) {\r\n            return false;\r\n        }\r\n        valueLC = value.toLowerCase();\r\n        for (i = 0; i < len; ++i) {\r\n            if (valueLC === array[i].toLowerCase()) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function convertPropsToRegExp(object) {\r\n        for (var key in object) {\r\n            if (hasOwnProp.call(object, key)) {\r\n                object[key] = new RegExp(object[key], 'i');\r\n            }\r\n        }\r\n    }\r\n\r\n    function prepareUserAgent(userAgent) {\r\n        return (userAgent || '').substr(0, 500); // mitigate vulnerable to ReDoS\r\n    }\r\n\r\n    (function init() {\r\n        var key, values, value, i, len, verPos, mobileDetectRules = impl.mobileDetectRules;\r\n        for (key in mobileDetectRules.props) {\r\n            if (hasOwnProp.call(mobileDetectRules.props, key)) {\r\n                values = mobileDetectRules.props[key];\r\n                if (!isArray(values)) {\r\n                    values = [values];\r\n                }\r\n                len = values.length;\r\n                for (i = 0; i < len; ++i) {\r\n                    value = values[i];\r\n                    verPos = value.indexOf('[VER]');\r\n                    if (verPos >= 0) {\r\n                        value = value.substring(0, verPos) + '([\\\\w._\\\\+]+)' + value.substring(verPos + 5);\r\n                    }\r\n                    values[i] = new RegExp(value, 'i');\r\n                }\r\n                mobileDetectRules.props[key] = values;\r\n            }\r\n        }\r\n        convertPropsToRegExp(mobileDetectRules.oss);\r\n        convertPropsToRegExp(mobileDetectRules.phones);\r\n        convertPropsToRegExp(mobileDetectRules.tablets);\r\n        convertPropsToRegExp(mobileDetectRules.uas);\r\n        convertPropsToRegExp(mobileDetectRules.utils);\r\n\r\n        // copy some patterns to oss0 which are tested first (see issue#15)\r\n        mobileDetectRules.oss0 = {\r\n            WindowsPhoneOS: mobileDetectRules.oss.WindowsPhoneOS,\r\n            WindowsMobileOS: mobileDetectRules.oss.WindowsMobileOS\r\n        };\r\n    }());\r\n\r\n    /**\r\n     * Test userAgent string against a set of rules and find the first matched key.\r\n     * @param {Object} rules (key is String, value is RegExp)\r\n     * @param {String} userAgent the navigator.userAgent (or HTTP-Header 'User-Agent').\r\n     * @returns {String|null} the matched key if found, otherwise <tt>null</tt>\r\n     * @private\r\n     */\r\n    impl.findMatch = function(rules, userAgent) {\r\n        for (var key in rules) {\r\n            if (hasOwnProp.call(rules, key)) {\r\n                if (rules[key].test(userAgent)) {\r\n                    return key;\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * Test userAgent string against a set of rules and return an array of matched keys.\r\n     * @param {Object} rules (key is String, value is RegExp)\r\n     * @param {String} userAgent the navigator.userAgent (or HTTP-Header 'User-Agent').\r\n     * @returns {Array} an array of matched keys, may be empty when there is no match, but not <tt>null</tt>\r\n     * @private\r\n     */\r\n    impl.findMatches = function(rules, userAgent) {\r\n        var result = [];\r\n        for (var key in rules) {\r\n            if (hasOwnProp.call(rules, key)) {\r\n                if (rules[key].test(userAgent)) {\r\n                    result.push(key);\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n\r\n    /**\r\n     * Check the version of the given property in the User-Agent.\r\n     *\r\n     * @param {String} propertyName\r\n     * @param {String} userAgent\r\n     * @return {String} version or <tt>null</tt> if version not found\r\n     * @private\r\n     */\r\n    impl.getVersionStr = function (propertyName, userAgent) {\r\n        var props = impl.mobileDetectRules.props, patterns, i, len, match;\r\n        if (hasOwnProp.call(props, propertyName)) {\r\n            patterns = props[propertyName];\r\n            len = patterns.length;\r\n            for (i = 0; i < len; ++i) {\r\n                match = patterns[i].exec(userAgent);\r\n                if (match !== null) {\r\n                    return match[1];\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * Check the version of the given property in the User-Agent.\r\n     * Will return a float number. (eg. 2_0 will return 2.0, 4.3.1 will return 4.31)\r\n     *\r\n     * @param {String} propertyName\r\n     * @param {String} userAgent\r\n     * @return {Number} version or <tt>NaN</tt> if version not found\r\n     * @private\r\n     */\r\n    impl.getVersion = function (propertyName, userAgent) {\r\n        var version = impl.getVersionStr(propertyName, userAgent);\r\n        return version ? impl.prepareVersionNo(version) : NaN;\r\n    };\r\n\r\n    /**\r\n     * Prepare the version number.\r\n     *\r\n     * @param {String} version\r\n     * @return {Number} the version number as a floating number\r\n     * @private\r\n     */\r\n    impl.prepareVersionNo = function (version) {\r\n        var numbers;\r\n\r\n        numbers = version.split(/[a-z._ \\/\\-]/i);\r\n        if (numbers.length === 1) {\r\n            version = numbers[0];\r\n        }\r\n        if (numbers.length > 1) {\r\n            version = numbers[0] + '.';\r\n            numbers.shift();\r\n            version += numbers.join('');\r\n        }\r\n        return Number(version);\r\n    };\r\n\r\n    impl.isMobileFallback = function (userAgent) {\r\n        return impl.detectMobileBrowsers.fullPattern.test(userAgent) ||\r\n            impl.detectMobileBrowsers.shortPattern.test(userAgent.substr(0,4));\r\n    };\r\n\r\n    impl.isTabletFallback = function (userAgent) {\r\n        return impl.detectMobileBrowsers.tabletPattern.test(userAgent);\r\n    };\r\n\r\n    impl.prepareDetectionCache = function (cache, userAgent, maxPhoneWidth) {\r\n        if (cache.mobile !== undefined) {\r\n            return;\r\n        }\r\n        var phone, tablet, phoneSized;\r\n\r\n        // first check for stronger tablet rules, then phone (see issue#5)\r\n        tablet = impl.findMatch(impl.mobileDetectRules.tablets, userAgent);\r\n        if (tablet) {\r\n            cache.mobile = cache.tablet = tablet;\r\n            cache.phone = null;\r\n            return; // unambiguously identified as tablet\r\n        }\r\n\r\n        phone = impl.findMatch(impl.mobileDetectRules.phones, userAgent);\r\n        if (phone) {\r\n            cache.mobile = cache.phone = phone;\r\n            cache.tablet = null;\r\n            return; // unambiguously identified as phone\r\n        }\r\n\r\n        // our rules haven't found a match -> try more general fallback rules\r\n        if (impl.isMobileFallback(userAgent)) {\r\n            phoneSized = MobileDetect.isPhoneSized(maxPhoneWidth);\r\n            if (phoneSized === undefined) {\r\n                cache.mobile = impl.FALLBACK_MOBILE;\r\n                cache.tablet = cache.phone = null;\r\n            } else if (phoneSized) {\r\n                cache.mobile = cache.phone = impl.FALLBACK_PHONE;\r\n                cache.tablet = null;\r\n            } else {\r\n                cache.mobile = cache.tablet = impl.FALLBACK_TABLET;\r\n                cache.phone = null;\r\n            }\r\n        } else if (impl.isTabletFallback(userAgent)) {\r\n            cache.mobile = cache.tablet = impl.FALLBACK_TABLET;\r\n            cache.phone = null;\r\n        } else {\r\n            // not mobile at all!\r\n            cache.mobile = cache.tablet = cache.phone = null;\r\n        }\r\n    };\r\n\r\n    // t is a reference to a MobileDetect instance\r\n    impl.mobileGrade = function (t) {\r\n        // impl note:\r\n        // To keep in sync w/ Mobile_Detect.php easily, the following code is tightly aligned to the PHP version.\r\n        // When changes are made in Mobile_Detect.php, copy this method and replace:\r\n        //     $this-> / t.\r\n        //     self::MOBILE_GRADE_(.) / '$1'\r\n        //     , self::VERSION_TYPE_FLOAT / (nothing)\r\n        //     isIOS() / os('iOS')\r\n        //     [reg] / (nothing)   <-- jsdelivr complaining about unescaped unicode character U+00AE\r\n        var $isMobile = t.mobile() !== null;\r\n\r\n        if (\r\n            // Apple iOS 3.2-5.1 - Tested on the original iPad (4.3 / 5.0), iPad 2 (4.3), iPad 3 (5.1), original iPhone (3.1), iPhone 3 (3.2), 3GS (4.3), 4 (4.3 / 5.0), and 4S (5.1)\r\n            t.os('iOS') && t.version('iPad')>=4.3 ||\r\n            t.os('iOS') && t.version('iPhone')>=3.1 ||\r\n            t.os('iOS') && t.version('iPod')>=3.1 ||\r\n\r\n            // Android 2.1-2.3 - Tested on the HTC Incredible (2.2), original Droid (2.2), HTC Aria (2.1), Google Nexus S (2.3). Functional on 1.5 & 1.6 but performance may be sluggish, tested on Google G1 (1.5)\r\n            // Android 3.1 (Honeycomb)  - Tested on the Samsung Galaxy Tab 10.1 and Motorola XOOM\r\n            // Android 4.0 (ICS)  - Tested on a Galaxy Nexus. Note: transition performance can be poor on upgraded devices\r\n            // Android 4.1 (Jelly Bean)  - Tested on a Galaxy Nexus and Galaxy 7\r\n            ( t.version('Android')>2.1 && t.is('Webkit') ) ||\r\n\r\n            // Windows Phone 7-7.5 - Tested on the HTC Surround (7.0) HTC Trophy (7.5), LG-E900 (7.5), Nokia Lumia 800\r\n            t.version('Windows Phone OS')>=7.0 ||\r\n\r\n            // Blackberry 7 - Tested on BlackBerry Torch 9810\r\n            // Blackberry 6.0 - Tested on the Torch 9800 and Style 9670\r\n            t.is('BlackBerry') && t.version('BlackBerry')>=6.0 ||\r\n            // Blackberry Playbook (1.0-2.0) - Tested on PlayBook\r\n            t.match('Playbook.*Tablet') ||\r\n\r\n            // Palm WebOS (1.4-2.0) - Tested on the Palm Pixi (1.4), Pre (1.4), Pre 2 (2.0)\r\n            ( t.version('webOS')>=1.4 && t.match('Palm|Pre|Pixi') ) ||\r\n            // Palm WebOS 3.0  - Tested on HP TouchPad\r\n            t.match('hp.*TouchPad') ||\r\n\r\n            // Firefox Mobile (12 Beta) - Tested on Android 2.3 device\r\n            ( t.is('Firefox') && t.version('Firefox')>=12 ) ||\r\n\r\n            // Chrome for Android - Tested on Android 4.0, 4.1 device\r\n            ( t.is('Chrome') && t.is('AndroidOS') && t.version('Android')>=4.0 ) ||\r\n\r\n            // Skyfire 4.1 - Tested on Android 2.3 device\r\n            ( t.is('Skyfire') && t.version('Skyfire')>=4.1 && t.is('AndroidOS') && t.version('Android')>=2.3 ) ||\r\n\r\n            // Opera Mobile 11.5-12: Tested on Android 2.3\r\n            ( t.is('Opera') && t.version('Opera Mobi')>11 && t.is('AndroidOS') ) ||\r\n\r\n            // Meego 1.2 - Tested on Nokia 950 and N9\r\n            t.is('MeeGoOS') ||\r\n\r\n            // Tizen (pre-release) - Tested on early hardware\r\n            t.is('Tizen') ||\r\n\r\n            // Samsung Bada 2.0 - Tested on a Samsung Wave 3, Dolphin browser\r\n            // @todo: more tests here!\r\n            t.is('Dolfin') && t.version('Bada')>=2.0 ||\r\n\r\n            // UC Browser - Tested on Android 2.3 device\r\n            ( (t.is('UC Browser') || t.is('Dolfin')) && t.version('Android')>=2.3 ) ||\r\n\r\n            // Kindle 3 and Fire  - Tested on the built-in WebKit browser for each\r\n            ( t.match('Kindle Fire') ||\r\n                t.is('Kindle') && t.version('Kindle')>=3.0 ) ||\r\n\r\n            // Nook Color 1.4.1 - Tested on original Nook Color, not Nook Tablet\r\n            t.is('AndroidOS') && t.is('NookTablet') ||\r\n\r\n            // Chrome Desktop 11-21 - Tested on OS X 10.7 and Windows 7\r\n            t.version('Chrome')>=11 && !$isMobile ||\r\n\r\n            // Safari Desktop 4-5 - Tested on OS X 10.7 and Windows 7\r\n            t.version('Safari')>=5.0 && !$isMobile ||\r\n\r\n            // Firefox Desktop 4-13 - Tested on OS X 10.7 and Windows 7\r\n            t.version('Firefox')>=4.0 && !$isMobile ||\r\n\r\n            // Internet Explorer 7-9 - Tested on Windows XP, Vista and 7\r\n            t.version('MSIE')>=7.0 && !$isMobile ||\r\n\r\n            // Opera Desktop 10-12 - Tested on OS X 10.7 and Windows 7\r\n            // @reference: http://my.opera.com/community/openweb/idopera/\r\n            t.version('Opera')>=10 && !$isMobile\r\n\r\n            ){\r\n            return 'A';\r\n        }\r\n\r\n        if (\r\n            t.os('iOS') && t.version('iPad')<4.3 ||\r\n            t.os('iOS') && t.version('iPhone')<3.1 ||\r\n            t.os('iOS') && t.version('iPod')<3.1 ||\r\n\r\n            // Blackberry 5.0: Tested on the Storm 2 9550, Bold 9770\r\n            t.is('Blackberry') && t.version('BlackBerry')>=5 && t.version('BlackBerry')<6 ||\r\n\r\n            //Opera Mini (5.0-6.5) - Tested on iOS 3.2/4.3 and Android 2.3\r\n            ( t.version('Opera Mini')>=5.0 && t.version('Opera Mini')<=6.5 &&\r\n                (t.version('Android')>=2.3 || t.is('iOS')) ) ||\r\n\r\n            // Nokia Symbian^3 - Tested on Nokia N8 (Symbian^3), C7 (Symbian^3), also works on N97 (Symbian^1)\r\n            t.match('NokiaN8|NokiaC7|N97.*Series60|Symbian/3') ||\r\n\r\n            // @todo: report this (tested on Nokia N71)\r\n            t.version('Opera Mobi')>=11 && t.is('SymbianOS')\r\n            ){\r\n            return 'B';\r\n        }\r\n\r\n        if (\r\n        // Blackberry 4.x - Tested on the Curve 8330\r\n            t.version('BlackBerry')<5.0 ||\r\n            // Windows Mobile - Tested on the HTC Leo (WinMo 5.2)\r\n            t.match('MSIEMobile|Windows CE.*Mobile') || t.version('Windows Mobile')<=5.2\r\n\r\n            ){\r\n            return 'C';\r\n        }\r\n\r\n        //All older smartphone platforms and featurephones - Any device that doesn't support media queries\r\n        //will receive the basic, C grade experience.\r\n        return 'C';\r\n    };\r\n\r\n    impl.detectOS = function (ua) {\r\n        return impl.findMatch(impl.mobileDetectRules.oss0, ua) ||\r\n            impl.findMatch(impl.mobileDetectRules.oss, ua);\r\n    };\r\n\r\n    impl.getDeviceSmallerSide = function () {\r\n        return window.screen.width < window.screen.height ?\r\n            window.screen.width :\r\n            window.screen.height;\r\n    };\r\n\r\n    /**\r\n     * Constructor for MobileDetect object.\r\n     * <br>\r\n     * Such an object will keep a reference to the given user-agent string and cache most of the detect queries.<br>\r\n     * <div style=\"background-color: #d9edf7; border: 1px solid #bce8f1; color: #3a87ad; padding: 14px; border-radius: 2px; margin-top: 20px\">\r\n     *     <strong>Find information how to download and install:</strong>\r\n     *     <a href=\"https://github.com/hgoebl/mobile-detect.js/\">github.com/hgoebl/mobile-detect.js/</a>\r\n     * </div>\r\n     *\r\n     * @example <pre>\r\n     *     var md = new MobileDetect(window.navigator.userAgent);\r\n     *     if (md.mobile()) {\r\n     *         location.href = (md.mobileGrade() === 'A') ? '/mobile/' : '/lynx/';\r\n     *     }\r\n     * </pre>\r\n     *\r\n     * @param {string} userAgent typically taken from window.navigator.userAgent or http_header['User-Agent']\r\n     * @param {number} [maxPhoneWidth=600] <strong>only for browsers</strong> specify a value for the maximum\r\n     *        width of smallest device side (in logical \"CSS\" pixels) until a device detected as mobile will be handled\r\n     *        as phone.\r\n     *        This is only used in cases where the device cannot be classified as phone or tablet.<br>\r\n     *        See <a href=\"http://developer.android.com/guide/practices/screens_support.html\">Declaring Tablet Layouts\r\n     *        for Android</a>.<br>\r\n     *        If you provide a value < 0, then this \"fuzzy\" check is disabled.\r\n     * @constructor\r\n     * @global\r\n     */\r\n    function MobileDetect(userAgent, maxPhoneWidth) {\r\n        this.ua = prepareUserAgent(userAgent);\r\n        this._cache = {};\r\n        //600dp is typical 7\" tablet minimum width\r\n        this.maxPhoneWidth = maxPhoneWidth || 600;\r\n    }\r\n\r\n    MobileDetect.prototype = {\r\n        constructor: MobileDetect,\r\n\r\n        /**\r\n         * Returns the detected phone or tablet type or <tt>null</tt> if it is not a mobile device.\r\n         * <br>\r\n         * For a list of possible return values see {@link MobileDetect#phone} and {@link MobileDetect#tablet}.<br>\r\n         * <br>\r\n         * If the device is not detected by the regular expressions from Mobile-Detect, a test is made against\r\n         * the patterns of <a href=\"http://detectmobilebrowsers.com/\">detectmobilebrowsers.com</a>. If this test\r\n         * is positive, a value of <code>UnknownPhone</code>, <code>UnknownTablet</code> or\r\n         * <code>UnknownMobile</code> is returned.<br>\r\n         * When used in browser, the decision whether phone or tablet is made based on <code>screen.width/height</code>.<br>\r\n         * <br>\r\n         * When used server-side (node.js), there is no way to tell the difference between <code>UnknownTablet</code>\r\n         * and <code>UnknownMobile</code>, so you will get <code>UnknownMobile</code> here.<br>\r\n         * Be aware that since v1.0.0 in this special case you will get <code>UnknownMobile</code> only for:\r\n         * {@link MobileDetect#mobile}, not for {@link MobileDetect#phone} and {@link MobileDetect#tablet}.\r\n         * In versions before v1.0.0 all 3 methods returned <code>UnknownMobile</code> which was tedious to use.\r\n         * <br>\r\n         * In most cases you will use the return value just as a boolean.\r\n         *\r\n         * @returns {String} the key for the phone family or tablet family, e.g. \"Nexus\".\r\n         * @function MobileDetect#mobile\r\n         */\r\n        mobile: function () {\r\n            impl.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth);\r\n            return this._cache.mobile;\r\n        },\r\n\r\n        /**\r\n         * Returns the detected phone type/family string or <tt>null</tt>.\r\n         * <br>\r\n         * The returned tablet (family or producer) is one of following keys:<br>\r\n         * <br><tt>iPhone, BlackBerry, HTC, Nexus, Dell, Motorola, Samsung, LG, Sony, Asus,\r\n         * NokiaLumia, Micromax, Palm, Vertu, Pantech, Fly, Wiko, iMobile, SimValley,\r\n         * Wolfgang, Alcatel, Nintendo, Amoi, INQ, OnePlus, GenericPhone</tt><br>\r\n         * <br>\r\n         * If the device is not detected by the regular expressions from Mobile-Detect, a test is made against\r\n         * the patterns of <a href=\"http://detectmobilebrowsers.com/\">detectmobilebrowsers.com</a>. If this test\r\n         * is positive, a value of <code>UnknownPhone</code> or <code>UnknownMobile</code> is returned.<br>\r\n         * When used in browser, the decision whether phone or tablet is made based on <code>screen.width/height</code>.<br>\r\n         * <br>\r\n         * When used server-side (node.js), there is no way to tell the difference between <code>UnknownTablet</code>\r\n         * and <code>UnknownMobile</code>, so you will get <code>null</code> here, while {@link MobileDetect#mobile}\r\n         * will return <code>UnknownMobile</code>.<br>\r\n         * Be aware that since v1.0.0 in this special case you will get <code>UnknownMobile</code> only for:\r\n         * {@link MobileDetect#mobile}, not for {@link MobileDetect#phone} and {@link MobileDetect#tablet}.\r\n         * In versions before v1.0.0 all 3 methods returned <code>UnknownMobile</code> which was tedious to use.\r\n         * <br>\r\n         * In most cases you will use the return value just as a boolean.\r\n         *\r\n         * @returns {String} the key of the phone family or producer, e.g. \"iPhone\"\r\n         * @function MobileDetect#phone\r\n         */\r\n        phone: function () {\r\n            impl.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth);\r\n            return this._cache.phone;\r\n        },\r\n\r\n        /**\r\n         * Returns the detected tablet type/family string or <tt>null</tt>.\r\n         * <br>\r\n         * The returned tablet (family or producer) is one of following keys:<br>\r\n         * <br><tt>iPad, NexusTablet, GoogleTablet, SamsungTablet, Kindle, SurfaceTablet,\r\n         * HPTablet, AsusTablet, BlackBerryTablet, HTCtablet, MotorolaTablet, NookTablet,\r\n         * AcerTablet, ToshibaTablet, LGTablet, FujitsuTablet, PrestigioTablet,\r\n         * LenovoTablet, DellTablet, YarvikTablet, MedionTablet, ArnovaTablet,\r\n         * IntensoTablet, IRUTablet, MegafonTablet, EbodaTablet, AllViewTablet,\r\n         * ArchosTablet, AinolTablet, NokiaLumiaTablet, SonyTablet, PhilipsTablet,\r\n         * CubeTablet, CobyTablet, MIDTablet, MSITablet, SMiTTablet, RockChipTablet,\r\n         * FlyTablet, bqTablet, HuaweiTablet, NecTablet, PantechTablet, BronchoTablet,\r\n         * VersusTablet, ZyncTablet, PositivoTablet, NabiTablet, KoboTablet, DanewTablet,\r\n         * TexetTablet, PlaystationTablet, TrekstorTablet, PyleAudioTablet, AdvanTablet,\r\n         * DanyTechTablet, GalapadTablet, MicromaxTablet, KarbonnTablet, AllFineTablet,\r\n         * PROSCANTablet, YONESTablet, ChangJiaTablet, GUTablet, PointOfViewTablet,\r\n         * OvermaxTablet, HCLTablet, DPSTablet, VistureTablet, CrestaTablet,\r\n         * MediatekTablet, ConcordeTablet, GoCleverTablet, ModecomTablet, VoninoTablet,\r\n         * ECSTablet, StorexTablet, VodafoneTablet, EssentielBTablet, RossMoorTablet,\r\n         * iMobileTablet, TolinoTablet, AudioSonicTablet, AMPETablet, SkkTablet,\r\n         * TecnoTablet, JXDTablet, iJoyTablet, FX2Tablet, XoroTablet, ViewsonicTablet,\r\n         * VerizonTablet, OdysTablet, CaptivaTablet, IconbitTablet, TeclastTablet,\r\n         * OndaTablet, JaytechTablet, BlaupunktTablet, DigmaTablet, EvolioTablet,\r\n         * LavaTablet, AocTablet, MpmanTablet, CelkonTablet, WolderTablet, MediacomTablet,\r\n         * MiTablet, NibiruTablet, NexoTablet, LeaderTablet, UbislateTablet,\r\n         * PocketBookTablet, KocasoTablet, HisenseTablet, Hudl, TelstraTablet,\r\n         * GenericTablet</tt><br>\r\n         * <br>\r\n         * If the device is not detected by the regular expressions from Mobile-Detect, a test is made against\r\n         * the patterns of <a href=\"http://detectmobilebrowsers.com/\">detectmobilebrowsers.com</a>. If this test\r\n         * is positive, a value of <code>UnknownTablet</code> or <code>UnknownMobile</code> is returned.<br>\r\n         * When used in browser, the decision whether phone or tablet is made based on <code>screen.width/height</code>.<br>\r\n         * <br>\r\n         * When used server-side (node.js), there is no way to tell the difference between <code>UnknownTablet</code>\r\n         * and <code>UnknownMobile</code>, so you will get <code>null</code> here, while {@link MobileDetect#mobile}\r\n         * will return <code>UnknownMobile</code>.<br>\r\n         * Be aware that since v1.0.0 in this special case you will get <code>UnknownMobile</code> only for:\r\n         * {@link MobileDetect#mobile}, not for {@link MobileDetect#phone} and {@link MobileDetect#tablet}.\r\n         * In versions before v1.0.0 all 3 methods returned <code>UnknownMobile</code> which was tedious to use.\r\n         * <br>\r\n         * In most cases you will use the return value just as a boolean.\r\n         *\r\n         * @returns {String} the key of the tablet family or producer, e.g. \"SamsungTablet\"\r\n         * @function MobileDetect#tablet\r\n         */\r\n        tablet: function () {\r\n            impl.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth);\r\n            return this._cache.tablet;\r\n        },\r\n\r\n        /**\r\n         * Returns the (first) detected user-agent string or <tt>null</tt>.\r\n         * <br>\r\n         * The returned user-agent is one of following keys:<br>\r\n         * <br><tt>Chrome, Dolfin, Opera, Skyfire, Edge, IE, Firefox, Bolt, TeaShark, Blazer,\r\n         * Safari, WeChat, UCBrowser, baiduboxapp, baidubrowser, DiigoBrowser, Mercury,\r\n         * ObigoBrowser, NetFront, GenericBrowser, PaleMoon</tt><br>\r\n         * <br>\r\n         * In most cases calling {@link MobileDetect#userAgent} will be sufficient. But there are rare\r\n         * cases where a mobile device pretends to be more than one particular browser. You can get the\r\n         * list of all matches with {@link MobileDetect#userAgents} or check for a particular value by\r\n         * providing one of the defined keys as first argument to {@link MobileDetect#is}.\r\n         *\r\n         * @returns {String} the key for the detected user-agent or <tt>null</tt>\r\n         * @function MobileDetect#userAgent\r\n         */\r\n        userAgent: function () {\r\n            if (this._cache.userAgent === undefined) {\r\n                this._cache.userAgent = impl.findMatch(impl.mobileDetectRules.uas, this.ua);\r\n            }\r\n            return this._cache.userAgent;\r\n        },\r\n\r\n        /**\r\n         * Returns all detected user-agent strings.\r\n         * <br>\r\n         * The array is empty or contains one or more of following keys:<br>\r\n         * <br><tt>Chrome, Dolfin, Opera, Skyfire, Edge, IE, Firefox, Bolt, TeaShark, Blazer,\r\n         * Safari, WeChat, UCBrowser, baiduboxapp, baidubrowser, DiigoBrowser, Mercury,\r\n         * ObigoBrowser, NetFront, GenericBrowser, PaleMoon</tt><br>\r\n         * <br>\r\n         * In most cases calling {@link MobileDetect#userAgent} will be sufficient. But there are rare\r\n         * cases where a mobile device pretends to be more than one particular browser. You can get the\r\n         * list of all matches with {@link MobileDetect#userAgents} or check for a particular value by\r\n         * providing one of the defined keys as first argument to {@link MobileDetect#is}.\r\n         *\r\n         * @returns {Array} the array of detected user-agent keys or <tt>[]</tt>\r\n         * @function MobileDetect#userAgents\r\n         */\r\n        userAgents: function () {\r\n            if (this._cache.userAgents === undefined) {\r\n                this._cache.userAgents = impl.findMatches(impl.mobileDetectRules.uas, this.ua);\r\n            }\r\n            return this._cache.userAgents;\r\n        },\r\n\r\n        /**\r\n         * Returns the detected operating system string or <tt>null</tt>.\r\n         * <br>\r\n         * The operating system is one of following keys:<br>\r\n         * <br><tt>AndroidOS, BlackBerryOS, PalmOS, SymbianOS, WindowsMobileOS, WindowsPhoneOS,\r\n         * iOS, iPadOS, MeeGoOS, MaemoOS, JavaOS, webOS, badaOS, BREWOS</tt><br>\r\n         *\r\n         * @returns {String} the key for the detected operating system.\r\n         * @function MobileDetect#os\r\n         */\r\n        os: function () {\r\n            if (this._cache.os === undefined) {\r\n                this._cache.os = impl.detectOS(this.ua);\r\n            }\r\n            return this._cache.os;\r\n        },\r\n\r\n        /**\r\n         * Get the version (as Number) of the given property in the User-Agent.\r\n         * <br>\r\n         * Will return a float number. (eg. 2_0 will return 2.0, 4.3.1 will return 4.31)\r\n         *\r\n         * @param {String} key a key defining a thing which has a version.<br>\r\n         *        You can use one of following keys:<br>\r\n         * <br><tt>Mobile, Build, Version, VendorID, iPad, iPhone, iPod, Kindle, Chrome, Coast,\r\n         * Dolfin, Firefox, Fennec, Edge, IE, NetFront, NokiaBrowser, Opera, Opera Mini,\r\n         * Opera Mobi, UCBrowser, MQQBrowser, MicroMessenger, baiduboxapp, baidubrowser,\r\n         * SamsungBrowser, Iron, Safari, Skyfire, Tizen, Webkit, PaleMoon, Gecko, Trident,\r\n         * Presto, Goanna, iOS, Android, BlackBerry, BREW, Java, Windows Phone OS, Windows\r\n         * Phone, Windows CE, Windows NT, Symbian, webOS</tt><br>\r\n         *\r\n         * @returns {Number} the version as float or <tt>NaN</tt> if User-Agent doesn't contain this version.\r\n         *          Be careful when comparing this value with '==' operator!\r\n         * @function MobileDetect#version\r\n         */\r\n        version: function (key) {\r\n            return impl.getVersion(key, this.ua);\r\n        },\r\n\r\n        /**\r\n         * Get the version (as String) of the given property in the User-Agent.\r\n         * <br>\r\n         *\r\n         * @param {String} key a key defining a thing which has a version.<br>\r\n         *        You can use one of following keys:<br>\r\n         * <br><tt>Mobile, Build, Version, VendorID, iPad, iPhone, iPod, Kindle, Chrome, Coast,\r\n         * Dolfin, Firefox, Fennec, Edge, IE, NetFront, NokiaBrowser, Opera, Opera Mini,\r\n         * Opera Mobi, UCBrowser, MQQBrowser, MicroMessenger, baiduboxapp, baidubrowser,\r\n         * SamsungBrowser, Iron, Safari, Skyfire, Tizen, Webkit, PaleMoon, Gecko, Trident,\r\n         * Presto, Goanna, iOS, Android, BlackBerry, BREW, Java, Windows Phone OS, Windows\r\n         * Phone, Windows CE, Windows NT, Symbian, webOS</tt><br>\r\n         *\r\n         * @returns {String} the \"raw\" version as String or <tt>null</tt> if User-Agent doesn't contain this version.\r\n         *\r\n         * @function MobileDetect#versionStr\r\n         */\r\n        versionStr: function (key) {\r\n            return impl.getVersionStr(key, this.ua);\r\n        },\r\n\r\n        /**\r\n         * Global test key against userAgent, os, phone, tablet and some other properties of userAgent string.\r\n         *\r\n         * @param {String} key the key (case-insensitive) of a userAgent, an operating system, phone or\r\n         *        tablet family.<br>\r\n         *        For a complete list of possible values, see {@link MobileDetect#userAgent},\r\n         *        {@link MobileDetect#os}, {@link MobileDetect#phone}, {@link MobileDetect#tablet}.<br>\r\n         *        Additionally you have following keys:<br>\r\n         * <br><tt>Bot, MobileBot, DesktopMode, TV, WebKit, Console, Watch</tt><br>\r\n         *\r\n         * @returns {boolean} <tt>true</tt> when the given key is one of the defined keys of userAgent, os, phone,\r\n         *                    tablet or one of the listed additional keys, otherwise <tt>false</tt>\r\n         * @function MobileDetect#is\r\n         */\r\n        is: function (key) {\r\n            return containsIC(this.userAgents(), key) ||\r\n                   equalIC(key, this.os()) ||\r\n                   equalIC(key, this.phone()) ||\r\n                   equalIC(key, this.tablet()) ||\r\n                   containsIC(impl.findMatches(impl.mobileDetectRules.utils, this.ua), key);\r\n        },\r\n\r\n        /**\r\n         * Do a quick test against navigator::userAgent.\r\n         *\r\n         * @param {String|RegExp} pattern the pattern, either as String or RegExp\r\n         *                        (a string will be converted to a case-insensitive RegExp).\r\n         * @returns {boolean} <tt>true</tt> when the pattern matches, otherwise <tt>false</tt>\r\n         * @function MobileDetect#match\r\n         */\r\n        match: function (pattern) {\r\n            if (!(pattern instanceof RegExp)) {\r\n                pattern = new RegExp(pattern, 'i');\r\n            }\r\n            return pattern.test(this.ua);\r\n        },\r\n\r\n        /**\r\n         * Checks whether the mobile device can be considered as phone regarding <code>screen.width</code>.\r\n         * <br>\r\n         * Obviously this method makes sense in browser environments only (not for Node.js)!\r\n         * @param {number} [maxPhoneWidth] the maximum logical pixels (aka. CSS-pixels) to be considered as phone.<br>\r\n         *        The argument is optional and if not present or falsy, the value of the constructor is taken.\r\n         * @returns {boolean|undefined} <code>undefined</code> if screen size wasn't detectable, else <code>true</code>\r\n         *          when screen.width is less or equal to maxPhoneWidth, otherwise <code>false</code>.<br>\r\n         *          Will always return <code>undefined</code> server-side.\r\n         */\r\n        isPhoneSized: function (maxPhoneWidth) {\r\n            return MobileDetect.isPhoneSized(maxPhoneWidth || this.maxPhoneWidth);\r\n        },\r\n\r\n        /**\r\n         * Returns the mobile grade ('A', 'B', 'C').\r\n         *\r\n         * @returns {String} one of the mobile grades ('A', 'B', 'C').\r\n         * @function MobileDetect#mobileGrade\r\n         */\r\n        mobileGrade: function () {\r\n            if (this._cache.grade === undefined) {\r\n                this._cache.grade = impl.mobileGrade(this);\r\n            }\r\n            return this._cache.grade;\r\n        }\r\n    };\r\n\r\n    // environment-dependent\r\n    if (typeof window !== 'undefined' && window.screen) {\r\n        MobileDetect.isPhoneSized = function (maxPhoneWidth) {\r\n            return maxPhoneWidth < 0 ? undefined : impl.getDeviceSmallerSide() <= maxPhoneWidth;\r\n        };\r\n    } else {\r\n        MobileDetect.isPhoneSized = function () {};\r\n    }\r\n\r\n    // should not be replaced by a completely new object - just overwrite existing methods\r\n    MobileDetect._impl = impl;\r\n    \r\n    MobileDetect.version = '1.4.4 2019-09-21';\r\n\r\n    return MobileDetect;\r\n}); // end of call of define()\r\n})((function (undefined) {\r\n    if (typeof module !== 'undefined' && module.exports) {\r\n        return function (factory) { module.exports = factory(); };\r\n    } else if (typeof define === 'function' && define.amd) {\r\n        return define;\r\n    } else if (typeof window !== 'undefined') {\r\n        return function (factory) { window.MobileDetect = factory(); };\r\n    } else {\r\n        // please file a bug if you get this error!\r\n        throw new Error('unknown environment');\r\n    }\r\n})());","import './polyfill.js';\r\nimport './struct.js';\r\nimport './mobile-detect.js';\r\nimport nstructjs from './struct.js';\r\n\r\nlet f64tmp = new Float64Array(1);\r\nlet u16tmp = new Uint16Array(f64tmp.buffer);\r\n\r\nexport function isDenormal(f) {\r\n  f64tmp[0] = f;\r\n\r\n  let a = u16tmp[0], b = u16tmp[1], c = u16tmp[2], d = u16tmp[3];\r\n\r\n  //zero? check both positive and negative zero\r\n  if (a === 0 && b === 0 && c === 0 && (d === 0 || d === 32768)) {\r\n    return false;\r\n  }\r\n\r\n  let test = d & ~(1<<15);\r\n  test = test>>4;\r\n\r\n  //window.console.log(u16tmp[0], u16tmp[1], u16tmp[2], u16tmp[3], \"|\", test);\r\n\r\n  return test === 0;\r\n}\r\n\r\nglobalThis._isDenormal = isDenormal;\r\n\r\n\r\nlet colormap = {\r\n  \"black\"   : 30,\r\n  \"red\"     : 31,\r\n  \"green\"   : 32,\r\n  \"yellow\"  : 33,\r\n  \"blue\"    : 34,\r\n  \"magenta\" : 35,\r\n  \"cyan\"    : 36,\r\n  \"teal\"    : 36,\r\n  \"white\"   : 37,\r\n  \"reset\"   : 0,\r\n  \"grey\"    : 2,\r\n  \"gray\"    : 2,\r\n  \"orange\"  : 202,\r\n  \"pink\"    : 198,\r\n  \"brown\"   : 314,\r\n  \"lightred\": 91,\r\n  \"peach\"   : 210\r\n}\r\n\r\nexport let termColorMap = {};\r\nfor (let k in colormap) {\r\n  termColorMap[k] = colormap[k];\r\n  termColorMap[colormap[k]] = k;\r\n}\r\n\r\nexport function termColor(s, c, d = 0) {\r\n  if (typeof s === \"symbol\") {\r\n    s = s.toString();\r\n  } else {\r\n    s = \"\" + s;\r\n  }\r\n\r\n  if (c in colormap)\r\n    c = colormap[c]\r\n\r\n  if (c > 107) {\r\n    let s2 = '\\u001b[38;5;' + c + \"m\"\r\n    return s2 + s + '\\u001b[39m'\r\n  }\r\n\r\n  return '\\u001b[' + c + 'm' + s + '\\u001b[39m';\r\n};\r\n\r\nexport function termPrint() {\r\n  //let console = window.console;\r\n\r\n  let s = '';\r\n  for (let i = 0; i < arguments.length; i++) {\r\n    if (i > 0) {\r\n      s += ' ';\r\n    }\r\n    s += arguments[i];\r\n  }\r\n\r\n  let re1a = /\\u001b\\[[1-9][0-9]?m/;\r\n  let re1b = /\\u001b\\[[1-9][0-9];[0-9][0-9]?;[0-9]+m/\r\n  let re2 = /\\u001b\\[39m/;\r\n\r\n  let endtag = '\\u001b[39m';\r\n\r\n  function tok(s, type) {\r\n    return {\r\n      type : type,\r\n      value: s\r\n    }\r\n  }\r\n\r\n  let tokdef = [\r\n    [re1a, \"start\"],\r\n    [re1b, \"start\"],\r\n    [re2, \"end\"]\r\n  ];\r\n\r\n  let s2 = s;\r\n\r\n  let i = 0;\r\n  let tokens = [];\r\n\r\n  while (s2.length > 0) {\r\n    let ok = false;\r\n\r\n    let mintk = undefined, mini = undefined;\r\n    let minslice = undefined, mintype = undefined;\r\n\r\n    for (let tk of tokdef) {\r\n      let i = s2.search(tk[0]);\r\n\r\n      if (i >= 0 && (mini === undefined || i < mini)) {\r\n        minslice = s2.slice(i, s2.length).match(tk[0])[0];\r\n        mini = i;\r\n        mintype = tk[1];\r\n        mintk = tk;\r\n        ok = true;\r\n      }\r\n    }\r\n\r\n    if (!ok) {\r\n      break;\r\n    }\r\n\r\n    if (mini > 0) {\r\n      let chunk = s2.slice(0, mini);\r\n      tokens.push(tok(chunk, \"chunk\"));\r\n    }\r\n\r\n    s2 = s2.slice(mini + minslice.length, s2.length);\r\n    let t = tok(minslice, mintype);\r\n\r\n    tokens.push(t);\r\n  }\r\n\r\n  if (s2.length > 0) {\r\n    tokens.push(tok(s2, \"chunk\"));\r\n  }\r\n\r\n  let stack = [];\r\n  let cur;\r\n\r\n  let out = '';\r\n\r\n  for (let t of tokens) {\r\n    if (t.type === \"chunk\") {\r\n      out += t.value;\r\n    } else if (t.type === \"start\") {\r\n      stack.push(cur);\r\n      cur = t.value;\r\n\r\n      out += t.value;\r\n    } else if (t.type === \"end\") {\r\n      cur = stack.pop();\r\n      if (cur) {\r\n        out += cur;\r\n      } else {\r\n        out += endtag;\r\n      }\r\n    }\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\nglobalThis.termColor = termColor;\r\n\r\nexport class MovingAvg extends Array {\r\n  constructor(size = 64) {\r\n    super();\r\n\r\n    this.length = size;\r\n    this.cur = 0;\r\n    this.used = 0;\r\n    this.sum = 0;\r\n  }\r\n\r\n  reset() {\r\n    this.cur = this.used = this.sum = 0.0;\r\n\r\n    return this;\r\n  }\r\n\r\n  add(val) {\r\n    if (this.used < this.length) {\r\n      this[this.cur] = val;\r\n      this.used++;\r\n    } else {\r\n      this.sum -= this[this.cur];\r\n      this[this.cur] = val;\r\n    }\r\n\r\n    this.sum += val;\r\n    this.cur = (this.cur + 1)%this.length;\r\n\r\n    return this.sample();\r\n  }\r\n\r\n  sample() {\r\n    return this.used ? this.sum/this.used : 0.0;\r\n  }\r\n}\r\n\r\nexport let timers = {};\r\n\r\nexport function pollTimer(id, interval) {\r\n  if (!(id in timers)) {\r\n    timers[id] = time_ms();\r\n  }\r\n\r\n  if (time_ms() - timers[id] >= interval) {\r\n    timers[id] = time_ms();\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nlet mdetect = undefined;\r\nlet mret = undefined;\r\n\r\nexport function isMobile() {\r\n  if (!window.MobileDetect) {\r\n    return;\r\n  }\r\n\r\n  if (mret === undefined) {\r\n    mdetect = new MobileDetect(navigator.userAgent);\r\n    let ret = mdetect.mobile();\r\n\r\n    if (typeof ret === \"string\") {\r\n      ret = ret.toLowerCase();\r\n    }\r\n\r\n    mret = ret;\r\n  }\r\n\r\n  return mret;\r\n}\r\n\r\n//window._isMobile = isMobile;\r\n\r\n//let SmartConsoleTag = Symbol(\"SmartConsoleTag\");\r\n//let tagid = 0;\r\n\r\nexport class SmartConsoleContext {\r\n  constructor(name, console) {\r\n    this.name = name;\r\n\r\n    let c = [random(), random(), random()];\r\n    let sum = Math.sqrt(c[0]*c[0] + c[1]*c[1] + c[2]*c[2]);\r\n    sum = 255/sum;\r\n\r\n    let r = ~~(c[0]*sum);\r\n    let g = ~~(c[1]*sum);\r\n    let b = ~~(c[2]*sum);\r\n\r\n    this.color = `rgb(${r},${g},${b})`;\r\n    this.__console = console;\r\n\r\n    //minimum time between prints of same message\r\n    this.timeInterval = 375;\r\n\r\n    //minimum time in general\r\n    this.timeIntervalAll = 245;\r\n\r\n    this._last = 0;\r\n    this.last = 0;\r\n    this.last2 = 0;\r\n    this._data = {};\r\n    this._data_length = 0;\r\n    this.maxCache = 256;\r\n  }\r\n\r\n\r\n  hash(args) {\r\n    let sum = 0;\r\n    let mul = (1<<19) - 1, off = (1<<27) - 1;\r\n    let i = 0;\r\n\r\n    function dohash(h) {\r\n      h = (h*mul + off + i*mul*0.25) & mul;\r\n\r\n      i++;\r\n      sum = sum ^ h;\r\n    }\r\n\r\n    let visit = new WeakSet();\r\n\r\n    let recurse = (n) => {\r\n      if (typeof n === \"string\") {\r\n        dohash(strhash(n));\r\n      } else if (typeof n === \"undefined\" || n === null) {\r\n        dohash(0);\r\n      } else if (typeof n === \"object\") {\r\n        if (n === undefined) {\r\n          //n[SmartConsoleTag] = tagid++;\r\n        }\r\n\r\n        if (visit.has(n)) {\r\n          return;\r\n        }\r\n\r\n        visit.add(n); //[SmartConsoleTag]);\r\n\r\n        let keys = getAllKeys(n);\r\n\r\n        for (let k of keys) {\r\n          let v;\r\n\r\n          if (typeof k !== \"string\") {\r\n            continue;\r\n          }\r\n\r\n          try {\r\n            v = n[k];\r\n          } catch (error) {\r\n            continue;\r\n          }\r\n\r\n          recurse(v);\r\n        }\r\n      } else if (typeof n === \"function\") {\r\n        dohash(strhash(\"\" + n.name));\r\n      }\r\n    };\r\n\r\n    //let str = \"\";\r\n\r\n    for (let i = 0; i < args.length; i++) {\r\n      recurse(args[i]);\r\n      //str += args[i] + \" \";\r\n    }\r\n\r\n    //window.console.log(\"HASH\", sum, str);\r\n    return sum;\r\n  }\r\n\r\n  clearCache() {\r\n    this._data_length = 0;\r\n    this._data = {};\r\n    return this;\r\n  }\r\n\r\n  _getData(args) {\r\n    let key = this.hash(args);\r\n\r\n    if (!(key in this._data)) {\r\n      if (this._data_length > this.maxCache) {\r\n        this.clearCache();\r\n      }\r\n\r\n      this._data[key] = {\r\n        time : 0,\r\n        count: 0\r\n      };\r\n\r\n      this._data_length++;\r\n    }\r\n\r\n    return this._data[key];\r\n  }\r\n\r\n  _check(args) {\r\n    if (this.timeIntervalAll > 0 && time_ms() - this.last2 < this.timeIntervalAll) {\r\n      return false;\r\n    }\r\n\r\n    this.last2 = time_ms();\r\n\r\n    return true;\r\n    /*\r\n    this.last2 = time_ms();\r\n\r\n    let d = this._getData(args);\r\n    let last = this.last;\r\n\r\n    this.last = d;\r\n\r\n    if (d !== last) {\r\n      d.count = 0;\r\n      d.time = time_ms();\r\n      return true;\r\n    }\r\n\r\n    if (time_ms() - d.time > this.timeInterval) {\r\n      d.time = time_ms();\r\n      return true;\r\n    }\r\n\r\n    return false;*/\r\n  }\r\n\r\n  log() {\r\n    if (this._check(arguments)) {\r\n      window.console.log(\"%c\", \"color:\" + this.color, ...arguments);\r\n    }\r\n  }\r\n\r\n  warn() {\r\n    if (this._check(arguments)) {\r\n      window.console.log(\"%c\" + this.name, \"color : \" + this.color, ...arguments);\r\n    }\r\n  }\r\n\r\n  trace() {\r\n    if (this._check(arguments)) {\r\n      window.console.trace(...arguments);\r\n    }\r\n  }\r\n\r\n  error() {\r\n    if (this._check(arguments)) {\r\n      window.console.error(...arguments);\r\n    }\r\n  }\r\n}\r\n\r\nexport class SmartConsole {\r\n  constructor() {\r\n    this.contexts = {};\r\n  }\r\n\r\n  context(name) {\r\n    if (!(name in this.contexts)) {\r\n      this.contexts[name] = new SmartConsoleContext(name, this);\r\n    }\r\n\r\n    return this.contexts[name];\r\n  }\r\n\r\n  log() {\r\n    let c = this.context(\"default\");\r\n    return c.log(...arguments);\r\n  }\r\n\r\n  warn() {\r\n    let c = this.context(\"default\");\r\n    return c.warn(...arguments);\r\n  }\r\n\r\n  trace() {\r\n    let c = this.context(\"default\");\r\n    return c.trace(...arguments);\r\n  }\r\n\r\n  error() {\r\n    let c = this.context(\"default\");\r\n    return c.error(...arguments);\r\n  }\r\n}\r\n\r\nexport const console = new SmartConsole();\r\n\r\nglobalThis.tm = 0.0;\r\n\r\nvar EmptySlot = {};\r\n\r\nexport function getClassParent(cls) {\r\n  let p = cls.prototype;\r\n\r\n  if (p) p = p.__proto__;\r\n  if (p) p = p.constructor\r\n  ;\r\n  return p;\r\n}\r\n\r\n//make global for debugging purposes in console\r\n//window._getClassParent = getClassParent;\r\n\r\nexport function list(iterable) {\r\n  let ret = [];\r\n\r\n  for (let item of iterable) {\r\n    ret.push(item);\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n\r\n/** Count items in list; if searchItem is not undefined then a count\r\n *  of the number of times searchItem occurs will be returned.*/\r\nexport function count(iterable, searchItem=undefined) {\r\n  let count = 0;\r\n\r\n  if (searchItem !== undefined) {\r\n    for (let item of iterable) {\r\n      if (item === searchItem) {\r\n        count++;\r\n      }\r\n    }\r\n  } else {\r\n    for (let item of iterable) {\r\n      count++;\r\n    }\r\n  }\r\n\r\n  return count;\r\n}\r\n\r\n/*\r\n* returns all object keys, including\r\n* inherited ones\r\n* */\r\nexport function getAllKeys(obj) {\r\n  let keys = new Set();\r\n\r\n  if (typeof obj !== \"object\" && typeof obj !== \"function\") {\r\n    throw new Error(\"must pass an object ot getAllKeys; object was: \" + obj);\r\n  }\r\n\r\n  let p;\r\n\r\n  while (p && p !== Object) {\r\n    for (let k in Object.getOwnPropertyDescriptors(obj)) {\r\n      if (k === \"__proto__\")\r\n        continue;\r\n\r\n      keys.add(k);\r\n    }\r\n\r\n    for (let k of Object.getOwnPropertySymbols(obj)) {\r\n      keys.add(k);\r\n    }\r\n\r\n    p = p.__proto__;\r\n  }\r\n\r\n  let cls = obj.constructor;\r\n  if (!cls)\r\n    return keys;\r\n\r\n  while (cls) {\r\n    let proto = cls.prototype;\r\n    if (!proto) {\r\n      cls = getClassParent(cls);\r\n      continue;\r\n    }\r\n\r\n    for (let k in proto) {\r\n      keys.add(k);\r\n    }\r\n\r\n    for (let k in Object.getOwnPropertyDescriptors(proto)) {\r\n      keys.add(k);\r\n    }\r\n\r\n    cls = getClassParent(cls);\r\n  }\r\n\r\n  return keys;\r\n}\r\n\r\n//globalThis._getAllKeys = getAllKeys;\r\n\r\nexport function btoa(buf) {\r\n  if (buf instanceof ArrayBuffer) {\r\n    buf = new Uint8Array(buf);\r\n  }\r\n\r\n  if (typeof buf == \"string\" || buf instanceof String) {\r\n    return window.btoa(buf);\r\n  }\r\n\r\n  var ret = \"\";\r\n  for (var i = 0; i < buf.length; i++) {\r\n    ret += String.fromCharCode(buf[i]);\r\n  }\r\n\r\n  return btoa(ret);\r\n};\r\n\r\nexport function formatNumberUI(val, isInt = false, decimals = 5) {\r\n  if (val === undefined || val === null) {\r\n    val = \"0\";\r\n  } else if (isNaN(val)) {\r\n    val = \"NaN\";\r\n  } else if (val === -Infinity) {\r\n    val = \"-\" + String.fromCharCode(0x221E);\r\n  } else if (val === Infinity) {\r\n    val = \"+\" + String.fromCharCode(0x221E);\r\n  } else if (!isInt) {\r\n    val = val.toFixed(decimals);\r\n  } else {\r\n    val = \"\" + Math.floor(val);\r\n  }\r\n\r\n  return val;\r\n}\r\n\r\n//window.formatNumberUI = formatNumberUI;\r\n\r\nexport function atob(buf) {\r\n  let data = window.atob(buf);\r\n  let ret = [];\r\n\r\n  for (let i = 0; i < data.length; i++) {\r\n    ret.push(data.charCodeAt(i));\r\n  }\r\n\r\n  return new Uint8Array(ret);\r\n}\r\n\r\nexport function time_ms() {\r\n  if (window.performance)\r\n    return window.performance.now();\r\n  else\r\n    return new Date().getMilliseconds();\r\n}\r\n\r\nexport function color2css(c) {\r\n  var ret = c.length == 3 ? \"rgb(\" : \"rgba(\";\r\n\r\n  for (var i = 0; i < 3; i++) {\r\n    if (i > 0)\r\n      ret += \",\";\r\n\r\n    ret += ~~(c[i]*255);\r\n  }\r\n\r\n  if (c.length == 4)\r\n    ret += \",\" + c[3];\r\n  ret += \")\";\r\n\r\n  return ret;\r\n}\r\n\r\nexport function merge(obja, objb) {\r\n  return Object.assign({}, obja, objb);\r\n  /*\r\n  var ret = {};\r\n\r\n  for (var k in obja) {\r\n    ret[k] = obja[k];\r\n  }\r\n\r\n  for (var k in objb) {\r\n    ret[k] = objb[k];\r\n  }\r\n\r\n  return ret;\r\n  //*/\r\n};\r\n\r\nconst debug_cacherings = false;\r\n\r\nif (debug_cacherings) {\r\n  window._cacherings = [];\r\n\r\n  window._clear_all_cacherings = function (kill_all = false) {\r\n    function copy(obj) {\r\n      if (typeof obj.copy === \"function\") {\r\n        return obj.copy();\r\n      } else if (obj.constructor === Object) {\r\n        let ret = {};\r\n\r\n        for (let k of Reflect.ownKeys(obj)) {\r\n          let v;\r\n\r\n          try {\r\n            v = obj[k];\r\n          } catch (error) {\r\n            continue;\r\n          }\r\n\r\n          if (typeof v !== \"object\") {\r\n            ret[k] = v;\r\n          } else {\r\n            ret[k] = copy(v);\r\n          }\r\n        }\r\n\r\n        return ret;\r\n      } else {\r\n        return new obj.constructor();\r\n      }\r\n    }\r\n\r\n    for (let ch of window._cacherings) {\r\n      let obj = ch[0];\r\n      let len = ch.length;\r\n\r\n      ch.length = 0;\r\n      ch.cur = 0;\r\n\r\n      if (kill_all) {\r\n        continue;\r\n      }\r\n\r\n      for (let i = 0; i < len; i++) {\r\n        ch.push(copy(obj));\r\n      }\r\n    }\r\n  }\r\n\r\n  window._nonvector_cacherings = function () {\r\n    for (let ch of window._cacherings) {\r\n      if (ch.length === 0) {\r\n        continue;\r\n      }\r\n\r\n      let name = ch[0].constructor.name;\r\n      let ok = !name.startsWith(\"Vector\") && !name.startsWith(\"Quat\");\r\n      ok = ok && !name.startsWith(\"TriEditor\");\r\n      ok = ok && !name.startsWith(\"QuadEditor\");\r\n      ok = ok && !name.startsWith(\"PointEditor\");\r\n      ok = ok && !name.startsWith(\"LineEditor\");\r\n\r\n      if (ok) {\r\n        console.log(name, ch);\r\n      }\r\n    }\r\n  }\r\n\r\n  window._stale_cacherings = function () {\r\n    let ret = _cacherings.concat([]);\r\n\r\n    ret.sort((a, b) => a.gen - b.gen);\r\n    return ret;\r\n  }\r\n}\r\n\r\nexport class cachering extends Array {\r\n  constructor(func, size, isprivate = false) {\r\n    super()\r\n\r\n    this.private = isprivate;\r\n    this.cur = 0;\r\n\r\n    if (!isprivate && debug_cacherings) {\r\n      this.gen = 0;\r\n      window._cacherings.push(this);\r\n    }\r\n\r\n    for (var i = 0; i < size; i++) {\r\n      this.push(func());\r\n    }\r\n  }\r\n\r\n  static fromConstructor(cls, size, isprivate = false) {\r\n    var func = function () {\r\n      return new cls();\r\n    }\r\n\r\n    return new cachering(func, size, isprivate);\r\n  }\r\n\r\n  next() {\r\n    if (debug_cacherings) {\r\n      this.gen++;\r\n    }\r\n\r\n    let ret = this[this.cur];\r\n    this.cur = (this.cur + 1)%this.length;\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nexport class SetIter {\r\n  constructor(set) {\r\n    this.set = set;\r\n    this.i = 0;\r\n    this.ret = {done: false, value: undefined};\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return this;\r\n  }\r\n\r\n  next() {\r\n    var ret = this.ret;\r\n\r\n    while (this.i < this.set.items.length && this.set.items[this.i] === EmptySlot) {\r\n      this.i++;\r\n    }\r\n\r\n    if (this.i >= this.set.items.length) {\r\n      ret.done = true;\r\n      ret.value = undefined;\r\n\r\n      return ret;\r\n    }\r\n\r\n\r\n    ret.value = this.set.items[this.i++];\r\n    return ret;\r\n  }\r\n}\r\n\r\n/**\r\n Set\r\n\r\n Stores objects in a set; each object is converted to a value via\r\n a [Symbol.keystr] method, and if that value already exists in the set\r\n then the object is not added.\r\n\r\n\r\n * */\r\nexport class set {\r\n  constructor(input) {\r\n    this.items = [];\r\n    this.keys = {};\r\n    this.freelist = [];\r\n\r\n    this.length = 0;\r\n\r\n    if (typeof input == \"string\") {\r\n      input = new String(input);\r\n    }\r\n\r\n    if (input !== undefined) {\r\n      if (Symbol.iterator in input) {\r\n        for (var item of input) {\r\n          this.add(item);\r\n        }\r\n      } else if (\"forEach\" in input) {\r\n        input.forEach(function (item) {\r\n          this.add(item);\r\n        }, this);\r\n      } else if (input instanceof Array) {\r\n        for (var i = 0; i < input.length; i++) {\r\n          this.add(input[i]);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  get size() {\r\n    return this.length;\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return new SetIter(this);\r\n  }\r\n\r\n  equals(setb) {\r\n    for (let item of this) {\r\n      if (!setb.has(item)) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    for (let item of setb) {\r\n      if (!this.has(item)) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  clear() {\r\n    this.items.length = 0;\r\n    this.keys = {};\r\n    this.freelist.length = 0;\r\n    this.length = 0;\r\n\r\n    return this;\r\n  }\r\n\r\n  filter(f, thisvar) {\r\n    let i = 0;\r\n    let ret = new set();\r\n\r\n    for (let item of this) {\r\n      if (f.call(thisvar, item, i++, this)) {\r\n        ret.add(item);\r\n      }\r\n    }\r\n\r\n    return ret;\r\n\r\n  }\r\n\r\n  map(f, thisvar) {\r\n    let ret = new set();\r\n\r\n    let i = 0;\r\n\r\n    for (let item of this) {\r\n      ret.add(f.call(thisvar, item, i++, this));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  reduce(f, initial) {\r\n    if (initial === undefined) {\r\n      for (let item of this) {\r\n        initial = item;\r\n        break;\r\n      }\r\n    }\r\n\r\n    let i = 0;\r\n    for (let item of this) {\r\n      initial = f(initial, item, i++, this);\r\n    }\r\n\r\n    return initial;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new set();\r\n    for (let item of this) {\r\n      ret.add(item);\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  add(item) {\r\n    var key = item[Symbol.keystr]();\r\n\r\n    if (key in this.keys) return;\r\n\r\n    if (this.freelist.length > 0) {\r\n      var i = this.freelist.pop();\r\n\r\n      this.keys[key] = i;\r\n      this.items[i] = item;\r\n    } else {\r\n      var i = this.items.length;\r\n\r\n      this.keys[key] = i;\r\n      this.items.push(item);\r\n    }\r\n\r\n    this.length++;\r\n  }\r\n\r\n  delete(item, ignore_existence = true) {\r\n    this.remove(item, ignore_existence);\r\n  }\r\n\r\n  remove(item, ignore_existence) {\r\n    var key = item[Symbol.keystr]();\r\n\r\n    if (!(key in this.keys)) {\r\n      if (!ignore_existence) {\r\n        console.warn(\"Warning, item\", item, \"is not in set\");\r\n      }\r\n      return;\r\n    }\r\n\r\n    var i = this.keys[key];\r\n    this.freelist.push(i);\r\n    this.items[i] = EmptySlot;\r\n\r\n    delete this.keys[key];\r\n\r\n    this.length--;\r\n  }\r\n\r\n  has(item) {\r\n    return item[Symbol.keystr]() in this.keys;\r\n  }\r\n\r\n  forEach(func, thisvar) {\r\n    for (var i = 0; i < this.items.length; i++) {\r\n      var item = this.items[i];\r\n\r\n      if (item === EmptySlot)\r\n        continue;\r\n\r\n      thisvar !== undefined ? func.call(thisvar, item) : func(item);\r\n    }\r\n  }\r\n}\r\n\r\nexport class HashIter {\r\n  constructor(hash) {\r\n    this.hash = hash;\r\n    this.i = 0;\r\n    this.ret = {done: false, value: undefined};\r\n  }\r\n\r\n  next() {\r\n    var items = this.hash._items;\r\n\r\n    if (this.i >= items.length) {\r\n      this.ret.done = true;\r\n      this.ret.value = undefined;\r\n\r\n      return this.ret;\r\n    }\r\n\r\n    do {\r\n      this.i += 2;\r\n    } while (this.i < items.length && items[i] === _hash_null);\r\n\r\n    return this.ret;\r\n  }\r\n}\r\n\r\nvar _hash_null = {};\r\n\r\nexport class hashtable {\r\n  constructor() {\r\n    this._items = [];\r\n    this._keys = {};\r\n    this.length = 0;\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return new HashIter(this);\r\n  }\r\n\r\n  set(key, val) {\r\n    var key2 = key[Symbol.keystr]();\r\n\r\n    var i;\r\n    if (!(key2 in this._keys)) {\r\n      i = this._items.length;\r\n\r\n      try {\r\n        this._items.push(0);\r\n        this._items.push(0);\r\n      } catch (error) {\r\n        console.log(\":::\", this._items.length, key, key2, val)\r\n        throw error;\r\n      }\r\n\r\n      this._keys[key2] = i;\r\n      this.length++;\r\n    } else {\r\n      i = this._keys[key2];\r\n    }\r\n\r\n    this._items[i] = key;\r\n    this._items[i + 1] = val;\r\n  }\r\n\r\n  remove(key) {\r\n    var key2 = key[Symbol.keystr]();\r\n\r\n    if (!(key2 in this._keys)) {\r\n      console.warn(\"Warning, key not in hashtable:\", key, key2);\r\n      return;\r\n    }\r\n\r\n    var i = this._keys[key2];\r\n\r\n    this._items[i] = _hash_null;\r\n    this._items[i + 1] = _hash_null;\r\n\r\n    delete this._keys[key2];\r\n    this.length--;\r\n  }\r\n\r\n  has(key) {\r\n    var key2 = key[Symbol.keystr]();\r\n\r\n    return key2 in this._keys;\r\n  }\r\n\r\n  get(key) {\r\n    var key2 = key[Symbol.keystr]();\r\n\r\n    if (!(key2 in this._keys)) {\r\n      console.warn(\"Warning, item not in hash\", key, key2);\r\n      return undefined;\r\n    }\r\n\r\n    return this._items[this._keys[key2] + 1];\r\n  }\r\n\r\n  add(key, val) {\r\n    return this.set(key, val);\r\n  }\r\n\r\n  keys() {\r\n    var ret = [];\r\n\r\n    for (var i = 0; i < this._items.length; i += 2) {\r\n      var key = this._items[i];\r\n\r\n      if (key !== _hash_null) {\r\n        ret.push(key);\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  values() {\r\n    var ret = [];\r\n\r\n    for (var i = 0; i < this._items.length; i += 2) {\r\n      var item = this._items[i + 1];\r\n\r\n      if (item !== _hash_null) {\r\n        ret.push(item);\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  forEach(cb, thisvar) {\r\n    if (thisvar == undefined)\r\n      thisvar = self;\r\n\r\n    for (var k in this._keys) {\r\n      var i = this._keys[k];\r\n\r\n      cb.call(thisvar, k, this._items[i]);\r\n    }\r\n  }\r\n}\r\n\r\nlet IDGenInternalIDGen = 0;\r\n\r\nexport class IDGen {\r\n  constructor() {\r\n    this.__cur = 1;\r\n\r\n    this._debug = false;\r\n    this._internalID = IDGenInternalIDGen++;\r\n  }\r\n\r\n  /*\r\n  get _cur() {\r\n    return this.__cur;\r\n  }\r\n\r\n  set _cur(v) {\r\n    if (this._debug && pollTimer(\"_idgen_debug\", 450)) {\r\n      window.console.warn(\"_cur access\", v);\r\n    }\r\n\r\n    this.__cur = v;\r\n  }\r\n\r\n  // */\r\n\r\n  get cur() {\r\n    return this.__cur;\r\n  }\r\n\r\n  set cur(v) {\r\n    if (isNaN(v) || !isFinite(v)) {\r\n      throw new Error(\"NaN error in util.IDGen\");\r\n    }\r\n\r\n    this.__cur = v;\r\n  }\r\n\r\n  get _cur() {\r\n    return this.cur;\r\n  }\r\n\r\n  set _cur(v) {\r\n    window.console.warn(\"Deprecated use of IDGen._cur\");\r\n    this.cur = v;\r\n  }\r\n\r\n  static fromJSON(obj) {\r\n    let ret = new IDGen();\r\n\r\n    ret.cur = obj.cur === undefined ? obj._cur : obj.cur;\r\n\r\n    return ret;\r\n  }\r\n\r\n  next() {\r\n    return this.cur++;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new IDGen();\r\n    ret.cur = this.cur;\r\n\r\n    return ret;\r\n  }\r\n\r\n  max_cur(id) {\r\n    this.cur = Math.max(this.cur, id + 1);\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      cur: this.cur\r\n    };\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n  }\r\n}\r\n\r\nIDGen.STRUCT = `\r\nIDGen {\r\n  cur : int;\r\n}\r\n`;\r\nnstructjs.register(IDGen);\r\n\r\n\r\nfunction get_callstack(err) {\r\n  return (\"\"+err.stack).split(\"\\n\");\r\n}\r\n\r\nexport function print_stack(err) {\r\n  if (!err) {\r\n    window.console.trace();\r\n  } else {\r\n    window.console.log(err.stack);\r\n  }\r\n}\r\n\r\n\r\nglobalThis.get_callstack = get_callstack;\r\nglobalThis.print_stack = print_stack;\r\n\r\nexport function fetch_file(path) {\r\n  var url = location.origin + \"/\" + path\r\n\r\n  var req = new XMLHttpRequest(\r\n  );\r\n\r\n  return new Promise(function (accept, reject) {\r\n    req.open(\"GET\", url)\r\n    req.onreadystatechange = function (e) {\r\n      if (req.status == 200 && req.readyState == 4) {\r\n        accept(req.response);\r\n      } else if (req.status >= 400) {\r\n        reject(req.status, req.statusText);\r\n      }\r\n    }\r\n    req.send();\r\n  });\r\n}\r\n\r\n//from:https://en.wikipedia.org/wiki/Mersenne_Twister\r\nfunction _int32(x) {\r\n  // Get the 31 least significant bits.\r\n  return ~~(((1<<30) - 1) & (~~x))\r\n}\r\n\r\nexport class MersenneRandom {\r\n  constructor(seed) {\r\n    // Initialize the index to 0\r\n    this.index = 624;\r\n    this.mt = new Uint32Array(624);\r\n\r\n    this.seed(seed);\r\n  }\r\n\r\n  random() {\r\n    return this.extract_number()/(1<<30);\r\n  }\r\n\r\n  /** normal-ish distribution */\r\n  nrandom(n=3) {\r\n    let ret = 0.0;\r\n\r\n    for (let i=0; i<n; i++) {\r\n      ret += this.random();\r\n    }\r\n\r\n    return ret / n;\r\n  }\r\n\r\n  seed(seed) {\r\n    seed = ~~(seed*8192);\r\n\r\n    // Initialize the index to 0\r\n    this.index = 624;\r\n    this.mt.fill(0, 0, this.mt.length);\r\n\r\n    this.mt[0] = seed;  // Initialize the initial state to the seed\r\n\r\n    for (var i = 1; i < 624; i++) {\r\n      this.mt[i] = _int32(\r\n        1812433253*(this.mt[i - 1] ^ this.mt[i - 1]>>30) + i);\r\n    }\r\n  }\r\n\r\n  extract_number() {\r\n    if (this.index >= 624)\r\n      this.twist();\r\n\r\n    var y = this.mt[this.index];\r\n\r\n    // Right shift by 11 bits\r\n    y = y ^ y>>11;\r\n    // Shift y left by 7 and take the bitwise and of 2636928640\r\n    y = y ^ y<<7 & 2636928640;\r\n    // Shift y left by 15 and take the bitwise and of y and 4022730752\r\n    y = y ^ y<<15 & 4022730752;\r\n    // Right shift by 18 bits\r\n    y = y ^ y>>18;\r\n\r\n    this.index = this.index + 1;\r\n\r\n    return _int32(y);\r\n  }\r\n\r\n  twist() {\r\n    for (var i = 0; i < 624; i++) {\r\n      // Get the most significant bit and add it to the less significant\r\n      // bits of the next number\r\n      var y = _int32((this.mt[i] & 0x80000000) +\r\n        (this.mt[(i + 1)%624] & 0x7fffffff));\r\n      this.mt[i] = this.mt[(i + 397)%624] ^ y>>1;\r\n\r\n      if (y%2 != 0)\r\n        this.mt[i] = this.mt[i] ^ 0x9908b0df;\r\n    }\r\n\r\n    this.index = 0;\r\n  }\r\n}\r\n\r\nvar _mt = new MersenneRandom(0);\r\n\r\nexport function random() {\r\n  return _mt.extract_number()/(1<<30);\r\n}\r\n\r\nexport function seed(n) {\r\n//  console.trace(\"seed called\");\r\n  _mt.seed(n);\r\n}\r\n\r\nlet smallstr_hashes = {};\r\n\r\nexport function strhash(str) {\r\n  if (str.length <= 64) {\r\n    let hash = smallstr_hashes[str];\r\n\r\n    if (hash !== undefined) {\r\n      return hash;\r\n    }\r\n  }\r\n\r\n  var hash = 0;\r\n\r\n  for (var i = 0; i < str.length; i++) {\r\n    var ch = str.charCodeAt(i);\r\n\r\n    hash = hash < 0 ? -hash : hash;\r\n\r\n    hash ^= (ch*524287 + 4323543) & ((1<<19) - 1);\r\n  }\r\n\r\n  if (str.length <= 64) {\r\n    smallstr_hashes[str] = hash;\r\n  }\r\n\r\n  return hash;\r\n}\r\n\r\nvar hashsizes = [\r\n  /*2, 5, 11, 19, 37, 67, 127, */223, 383, 653, 1117, 1901, 3251,\r\n                                 5527, 9397, 15991, 27191, 46229, 78593, 133631, 227177, 38619,\r\n                                 656587, 1116209, 1897561, 3225883, 5484019, 9322861, 15848867,\r\n                                 26943089, 45803279, 77865577, 132371489, 225031553\r\n];\r\n\r\nvar FTAKEN = 0, FKEY = 1, FVAL = 2, FTOT = 3;\r\n\r\nexport class FastHash extends Array {\r\n  constructor() {\r\n    super();\r\n\r\n    this.cursize = 0;\r\n    this.size = hashsizes[this.cursize];\r\n    this.used = 0;\r\n\r\n    this.length = this.size*FTOT;\r\n    this.fill(0, 0, this.length);\r\n  }\r\n\r\n  resize(size) {\r\n    var table = this.slice(0, this.length);\r\n\r\n    this.length = size*FTOT;\r\n    this.size = size;\r\n    this.fill(0, 0, this.length);\r\n\r\n    for (var i = 0; i < table.length; i += FTOT) {\r\n      if (!table[i + FTAKEN]) continue;\r\n\r\n      var key = table[i + FKEY], val = table[i + FVAL];\r\n      this.set(key, val);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  get(key) {\r\n    var hash = typeof key == \"string\" ? strhash(key) : key;\r\n    hash = typeof hash == \"object\" ? hash.valueOf() : hash;\r\n\r\n    var probe = 0;\r\n\r\n    var h = (hash + probe)%this.size;\r\n\r\n    var _i = 0;\r\n    while (_i++ < 50000 && this[h*FTOT + FTAKEN]) {\r\n      if (this[h*FTOT + FKEY] == key) {\r\n        return this[h*FTOT + FVAL];\r\n      }\r\n\r\n      probe = (probe + 1)*2;\r\n      h = (hash + probe)%this.size;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  has(key) {\r\n    var hash = typeof key == \"string\" ? strhash(key) : key;\r\n    hash = typeof hash == \"object\" ? hash.valueOf() : hash;\r\n\r\n    var probe = 0;\r\n\r\n    var h = (hash + probe)%this.size;\r\n\r\n    var _i = 0;\r\n    while (_i++ < 50000 && this[h*FTOT + FTAKEN]) {\r\n      if (this[h*FTOT + FKEY] == key) {\r\n        return true;\r\n      }\r\n\r\n      probe = (probe + 1)*2;\r\n      h = (hash + probe)%this.size;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  set(key, val) {\r\n    var hash = typeof key == \"string\" ? strhash(key) : key;\r\n    hash = typeof hash == \"object\" ? hash.valueOf() : hash;\r\n\r\n    if (this.used > this.size/3) {\r\n      this.resize(hashsizes[this.cursize++]);\r\n    }\r\n\r\n    var probe = 0;\r\n\r\n    var h = (hash + probe)%this.size;\r\n\r\n    var _i = 0;\r\n    while (_i++ < 50000 && this[h*FTOT + FTAKEN]) {\r\n      if (this[h*FTOT + FKEY] == key) {\r\n        this[h*FTOT + FVAL] = val;\r\n        return;\r\n      }\r\n\r\n      probe = (probe + 1)*2;\r\n      h = (hash + probe)%this.size;\r\n    }\r\n\r\n    this[h*FTOT + FTAKEN] = 1;\r\n    this[h*FTOT + FKEY] = key;\r\n    this[h*FTOT + FVAL] = val;\r\n\r\n    this.used++;\r\n  }\r\n}\r\n\r\nexport function test_fasthash() {\r\n  var h = new FastHash();\r\n  console.log(\"bleh hash:\", strhash(\"bleh\"));\r\n\r\n  h.set(\"bleh\", 1);\r\n  h.set(\"bleh\", 2);\r\n  h.set(\"bleh\", 3);\r\n\r\n  console.log(h);\r\n\r\n  return h;\r\n};\r\n\r\nexport class ImageReader {\r\n  load_image() {\r\n    let input = document.createElement(\"input\");\r\n    input.type = \"file\";\r\n\r\n    let doaccept;\r\n\r\n    let promise = new Promise((accept, reject) => {\r\n      doaccept = accept;\r\n    });\r\n\r\n    input.addEventListener(\"change\", function (e) {\r\n      let files = this.files;\r\n      console.log(\"got file\", e, files)\r\n\r\n      if (files.length == 0) return;\r\n\r\n      var reader = new FileReader();\r\n      var this2 = this;\r\n\r\n      reader.onload = (e) => {\r\n        let data = e.target.result;\r\n        let image = new Image();\r\n\r\n        image.src = data;\r\n        image.onload = (e) => {\r\n          console.log(\"got image\", image.width, image.height);\r\n\r\n          let canvas = document.createElement(\"canvas\");\r\n          let g = canvas.getContext(\"2d\");\r\n\r\n          canvas.width = image.width;\r\n          canvas.height = image.height;\r\n\r\n          g.drawImage(image, 0, 0);\r\n          let idata = g.getImageData(0, 0, image.width, image.height);\r\n\r\n          doaccept(idata);\r\n        }\r\n      };\r\n\r\n      reader.readAsDataURL(files[0]);\r\n    });\r\n\r\n    input.click();\r\n    return promise;\r\n  }\r\n\r\n  example() {\r\n    this.load_image().then((idata) => {\r\n      console.log(idata);\r\n    });\r\n  }\r\n};\r\n\r\nlet digestcache;\r\n\r\n/** NOT CRYPTOGRAPHIC */\r\nexport class HashDigest {\r\n  constructor() {\r\n    this.i = 0;\r\n    this.hash = 0;\r\n  }\r\n\r\n  static cachedDigest() {\r\n    return digestcache.next().reset();\r\n  }\r\n\r\n  reset() {\r\n    this.i = 0;\r\n    this.hash = 0;\r\n\r\n    return this;\r\n  }\r\n\r\n  get() {\r\n    return this.hash;\r\n  }\r\n\r\n  add(v) {\r\n    if (typeof v === \"string\") {\r\n      v = strhash(v);\r\n    }\r\n\r\n    if (v >= -5 && v <= 5) {\r\n      v *= 32;\r\n    }\r\n\r\n    //try to deal with subdecimal floating point error\r\n\r\n    let f = Math.fract(v)*(1024*512);\r\n    f = (~~f)/(1024*512);\r\n    v = Math.floor(v) + f;\r\n\r\n    //glibc linear congruel generator\r\n    this.i = ((this.i + (~~v))*1103515245 + 12345) & ((1<<29) - 1);\r\n    //according to wikipedia only the top 16 bits are random\r\n    //this.i = this.i>>16;\r\n\r\n    let v2 = (v*1024*1024) & ((1<<29) - 1)\r\n    v = v | v2;\r\n\r\n    v = ~~v;\r\n\r\n    this.hash ^= v ^ this.i;\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nwindow._test_hash2 = () => {\r\n  let h = new HashDigest();\r\n\r\n  let tests = [\r\n    [0, 0, 0, 0],\r\n    [0, 0, 0],\r\n    [0, 0],\r\n    [0],\r\n    [1],\r\n    [2],\r\n    [3],\r\n    [strhash(\"yay\")],\r\n    [strhash(\"yay\"), strhash(\"yay\")],\r\n    [strhash(\"yay\"), strhash(\"yay\"), strhash(\"yay\")]\r\n  ]\r\n\r\n  for (let test of tests) {\r\n    let h = new HashDigest();\r\n    for (let f of test) {\r\n      h.add(f);\r\n    }\r\n\r\n    window.console.log(h.get());\r\n  }\r\n  for (let i = 0; i < 50; i++) {\r\n    h.add(0);\r\n    //window.console.log(h.i/((1<<30)-1), h.hash);\r\n  }\r\n}\r\n\r\ndigestcache = cachering.fromConstructor(HashDigest, 512);\r\n\r\n//globalThis._HashDigest = HashDigest;\r\n\r\nexport function hashjoin(hash, val) {\r\n  let sum = 0;\r\n  let mul = (1<<19) - 1, off = (1<<27) - 1;\r\n  let i = 0;\r\n\r\n  h = (h*mul + off + i*mul*0.25) & mul;\r\n}\r\n\r\nlet NullItem = {};\r\n\r\nexport class MapIter {\r\n  constructor(ownermap) {\r\n    this.ret = {done: true, value: undefined};\r\n    this.value = new Array(2);\r\n    this.i = 0;\r\n    this.map = ownermap;\r\n    this.done = true;\r\n  }\r\n\r\n  finish() {\r\n    if (!this.done) {\r\n      this.done = true;\r\n      this.map.itercur--;\r\n    }\r\n  }\r\n\r\n  next() {\r\n    let ret = this.ret;\r\n    let i = this.i;\r\n    let map = this.map, list = map._list;\r\n    //window.console.log(this)\r\n\r\n    while (i < list.length && list[i] === NullItem) {\r\n      i += 2;\r\n    }\r\n\r\n    //window.console.log(\"  --\", i, list[i], list[i+1]);\r\n\r\n    if (i >= list.length) {\r\n      ret.done = true;\r\n      ret.value = undefined;\r\n\r\n      this.finish();\r\n      return ret;\r\n    }\r\n\r\n    this.i = i + 2;\r\n\r\n    ret.value = this.value;\r\n    ret.value[0] = list[i];\r\n    ret.value[1] = list[i + 1];\r\n    ret.done = false;\r\n\r\n    return ret;\r\n  }\r\n\r\n  return() {\r\n    this.finish();\r\n\r\n    return this.ret;\r\n  }\r\n\r\n  reset() {\r\n    this.i = 0;\r\n    this.value[0] = undefined;\r\n    this.value[1] = undefined;\r\n    this.done = false;\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nexport class map {\r\n  constructor() {\r\n    this._items = {};\r\n    this._list = [];\r\n\r\n    this.size = 0;\r\n\r\n    this.iterstack = new Array(8);\r\n    this.itercur = 0;\r\n    for (let i = 0; i < this.iterstack.length; i++) {\r\n      this.iterstack[i] = new MapIter(this);\r\n    }\r\n\r\n    this.freelist = [];\r\n  }\r\n\r\n  has(key) {\r\n    return key[Symbol.keystr]() in this._items;\r\n  }\r\n\r\n  set(key, v) {\r\n    let k = key[Symbol.keystr]();\r\n\r\n    let i = this._items[k];\r\n\r\n    if (i === undefined) {\r\n      if (this.freelist.length > 0) {\r\n        i = this.freelist.pop();\r\n      } else {\r\n        i = this._list.length;\r\n        this._list.length += 2;\r\n      }\r\n\r\n      this.size++;\r\n    }\r\n\r\n    this._list[i] = key;\r\n    this._list[i + 1] = v;\r\n\r\n    this._items[k] = i;\r\n  }\r\n\r\n  keys() {\r\n    let this2 = this;\r\n    return (function* () {\r\n      for (let [key, val] of this2) {\r\n        yield key;\r\n      }\r\n    })()\r\n  }\r\n\r\n  values() {\r\n    let this2 = this;\r\n    return (function* () {\r\n      for (let [key, val] of this2) {\r\n        yield val;\r\n      }\r\n    })()\r\n  }\r\n\r\n  get(k) {\r\n    k = k[Symbol.keystr]();\r\n\r\n    let i = this._items[k];\r\n    if (i !== undefined) {\r\n      return this._list[i + 1];\r\n    }\r\n  }\r\n\r\n  delete(k) {\r\n    k = k[Symbol.keystr]();\r\n\r\n    if (!(k in this._items)) {\r\n      return false;\r\n    }\r\n\r\n    let i = this._items[k];\r\n\r\n    this.freelist.push(i);\r\n\r\n    this._list[i] = NullItem;\r\n    this._list[i + 1] = NullItem;\r\n\r\n    delete this._items[k];\r\n    this.size--;\r\n\r\n    return true;\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    let ret = this.iterstack[this.itercur].reset();\r\n    this.itercur++;\r\n\r\n    if (this.itercur === this.iterstack.length) {\r\n      this.iterstack.push(new MapIter(this));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n}\r\n\r\nglobalThis._test_map = function () {\r\n  let m = new map();\r\n\r\n  m.set(\"1\", 2);\r\n  m.set(11, 3);\r\n  m.set(\"5\", 4);\r\n  m.set(\"3\", 5);\r\n  m.set(\"3\", 6);\r\n  m.delete(\"3\");\r\n\r\n  for (let [key, item] of m) {\r\n    for (let [key2, item2] of m) {\r\n      window.console.log(key, item, key2, item2);\r\n    }\r\n    break;\r\n  }\r\n\r\n  console.log(\"itercur\", m.itercur);\r\n\r\n  return m;\r\n}\r\n\r\nfunction validateId(id) {\r\n  let bad = typeof id !== \"number\";\r\n  bad = bad || id !== ~~id;\r\n  bad = bad || isNaN(id);\r\n\r\n  if (bad) {\r\n    throw new Error(\"bad number \" + id);\r\n  }\r\n\r\n  return bad;\r\n}\r\n\r\nlet UndefinedTag = {};\r\n\r\nexport class IDMap extends Array {\r\n  constructor() {\r\n    super();\r\n\r\n    this._keys = new Set();\r\n    this.size = 0;\r\n  }\r\n\r\n  has(id) {\r\n    validateId(id);\r\n\r\n    if (id < 0 || id >= this.length) {\r\n      return false;\r\n    }\r\n\r\n    return this[id] !== undefined;\r\n  }\r\n\r\n  set(id, val) {\r\n    validateId(id);\r\n\r\n    if (id < 0) {\r\n      console.warn(\"got -1 id in IDMap\");\r\n      return;\r\n    }\r\n\r\n    if (id >= this.length) {\r\n      this.length = id + 1;\r\n    }\r\n\r\n    if (val === undefined) {\r\n      val = UndefinedTag;\r\n    }\r\n\r\n    let ret = false;\r\n\r\n    if (this[id] === undefined) {\r\n      this.size++;\r\n      this._keys.add(id);\r\n      ret = true;\r\n    }\r\n\r\n    this[id] = val;\r\n    return ret;\r\n  }\r\n\r\n  /* we allow -1, which always returns undefined*/\r\n  get(id) {\r\n    validateId(id);\r\n\r\n    if (id === -1) {\r\n      return undefined;\r\n    } else if (id < 0) {\r\n      console.warn(\"id was negative\");\r\n      return undefined;\r\n    }\r\n\r\n    let ret = id < this.length ? this[id] : undefined;\r\n    ret = ret === UndefinedTag ? undefined : ret;\r\n\r\n    return ret;\r\n  }\r\n\r\n  delete(id) {\r\n    if (!this.has(id)) {\r\n      return false;\r\n    }\r\n\r\n    this._keys.remove(id);\r\n    this[id] = undefined;\r\n    this.size--;\r\n\r\n    return true;\r\n  }\r\n\r\n  keys() {\r\n    let this2 = this;\r\n    return (function* () {\r\n      for (let id of this2._keys) {\r\n        yield id;\r\n      }\r\n    })();\r\n  }\r\n\r\n  values() {\r\n    let this2 = this;\r\n    return (function* () {\r\n      for (let id of this2._keys) {\r\n        yield this2[id];\r\n      }\r\n    })();\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    let this2 = this;\r\n    let iteritem = [0, 0];\r\n\r\n    return (function* () {\r\n      for (let id of this2._keys) {\r\n        iteritem[0] = id;\r\n        iteritem[1] = this2[id];\r\n\r\n        if (iteritem[1] === UndefinedTag) {\r\n          iteritem[1] = undefined;\r\n        }\r\n\r\n        yield iteritem;\r\n      }\r\n    })();\r\n  }\r\n}\r\n\r\nglobalThis._test_idmap = function () {\r\n  let map = new IDMap();\r\n\r\n  for (let i = 0; i < 5; i++) {\r\n    let id = ~~(Math.random()*55);\r\n\r\n    map.set(id, \"yay\" + i);\r\n  }\r\n\r\n  for (let [key, val] of map) {\r\n    window.console.log(key, val, map.has(key), map.get(key));\r\n  }\r\n\r\n  return map;\r\n}\r\n\r\nlet HW = 0, HELEM = 1, HTOT = 2;\r\n\r\nfunction heaplog() {\r\n  //window.console.log(...arguments);\r\n}\r\n\r\nexport class MinHeapQueue {\r\n  constructor(iter, iterw = iter) {\r\n    this.heap = [];\r\n    this.freelist = [];\r\n    this.length = 0;\r\n    this.end = 0;\r\n\r\n    if (iter) {\r\n      let witer = iterw[Symbol.iterator]();\r\n\r\n      for (let item of iter) {\r\n        let w = witer.next().value;\r\n        this.push(item, w);\r\n      }\r\n    }\r\n  }\r\n\r\n  push(e, w) {\r\n    if (typeof w !== \"number\") {\r\n      throw new Error(\"w must be a number\");\r\n    }\r\n\r\n    if (isNaN(w)) {\r\n      throw new Error(\"NaN\");\r\n    }\r\n\r\n    this.length++;\r\n    let depth = Math.ceil(Math.log(this.length)/Math.log(2.0));\r\n    let tot = Math.pow(2, depth) + 1;\r\n\r\n    heaplog(depth, tot);\r\n\r\n    if (this.heap.length < tot*HTOT) {\r\n      let start = this.heap.length/HTOT;\r\n\r\n      for (let i = start; i < tot; i++) {\r\n        this.freelist.push(i*HTOT);\r\n      }\r\n    }\r\n\r\n    let heap = this.heap;\r\n    heap.length = tot*HTOT;\r\n\r\n    let n = this.freelist.pop();\r\n\r\n    heaplog(\"freelist\", this.freelist);\r\n    this.end = Math.max(this.end, n);\r\n\r\n    heap[n] = w;\r\n    heap[n + 1] = e;\r\n\r\n    while (n > 0) {\r\n      n /= HTOT;\r\n\r\n      let p = (n - 1)>>1;\r\n      n *= HTOT;\r\n      p *= HTOT;\r\n\r\n      if (heap[p] === undefined || heap[p] > w) {\r\n        if (n === this.end) {\r\n          this.end = p;\r\n        }\r\n\r\n        heap[n] = heap[p];\r\n        heap[n + 1] = heap[p + 1];\r\n\r\n        heap[p] = w;\r\n        heap[p + 1] = e;\r\n\r\n        n = p;\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  pop() {\r\n    if (this.length === 0) {\r\n      return undefined;\r\n      //throw new Error(\"heap is empty\");\r\n    }\r\n\r\n    let heap = this.heap;\r\n\r\n    if (this.end === 0) {\r\n      let ret = heap[1];\r\n      this.freelist.push(0);\r\n      heap[0] = undefined;\r\n\r\n      this.length = 0;\r\n\r\n      return ret;\r\n    }\r\n\r\n    let ret = heap[1];\r\n\r\n    let end = this.end;\r\n\r\n    function swap(n1, n2) {\r\n      let t = heap[n1];\r\n      heap[n1] = heap[n2];\r\n      heap[n2] = t;\r\n\r\n      t = heap[n1 + 1];\r\n      heap[n1 + 1] = heap[n2 + 1];\r\n      heap[n2 + 1] = t;\r\n    }\r\n\r\n    heaplog(\"end\", end);\r\n    heaplog(heap.concat([]));\r\n\r\n    heap[0] = heap[end];\r\n    heap[1] = heap[end + 1];\r\n    heap[end] = undefined;\r\n    heap[end + 1] = undefined;\r\n\r\n    let n = 0;\r\n    while (n < heap.length) {\r\n      n /= HTOT;\r\n\r\n      let n1 = n*2 + 1;\r\n      let n2 = n*2 + 2;\r\n\r\n      n1 = ~~(n1*HTOT);\r\n      n2 = ~~(n2*HTOT);\r\n      n = ~~(n*HTOT);\r\n\r\n      heaplog(\"  \", heap[n], heap[n1], heap[n2]);\r\n\r\n      if (heap[n1] !== undefined && heap[n2] !== undefined) {\r\n        if (heap[n1] > heap[n2]) {\r\n          let t = n1;\r\n          n1 = n2;\r\n          n2 = t;\r\n        }\r\n\r\n        if (heap[n] > heap[n1]) {\r\n          swap(n, n1);\r\n          n = n1;\r\n        } else if (heap[n] > heap[n2]) {\r\n          swap(n, n2);\r\n          n = n2;\r\n        } else {\r\n          break;\r\n        }\r\n      } else if (heap[n1] !== undefined) {\r\n        if (heap[n] > heap[n1]) {\r\n          swap(n, n1);\r\n          n = n1;\r\n        } else {\r\n          break;\r\n        }\r\n      } else if (heap[n2] !== undefined) {\r\n        if (heap[n] > heap[n2]) {\r\n          swap(n, n2);\r\n          n = n2;\r\n        } else {\r\n          break;\r\n        }\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n\r\n    this.freelist.push(this.end);\r\n\r\n    heap[this.end] = undefined;\r\n    heap[this.end + 1] = undefined;\r\n\r\n    while (this.end > 0 && heap[this.end] === undefined) {\r\n      this.end -= HTOT;\r\n    }\r\n\r\n    this.length--;\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nglobalThis.testHeapQueue = function (list1 = [1, 8, -3, 11, 33]) {\r\n  let h = new MinHeapQueue(list1);\r\n\r\n  window.console.log(h.heap.concat([]));\r\n\r\n  let list = [];\r\n  let len = h.length;\r\n\r\n  for (let i = 0; i < len; i++) {\r\n    list.push(h.pop());\r\n  }\r\n\r\n  window.console.log(h.heap.concat([]));\r\n\r\n  return list;\r\n}\r\n\r\nexport class Queue {\r\n  constructor(n = 32) {\r\n    n = Math.max(n, 8);\r\n\r\n    this.initialSize = n;\r\n\r\n    this.queue = new Array(n);\r\n    this.a = 0;\r\n    this.b = 0;\r\n    this.length = 0;\r\n  }\r\n\r\n  enqueue(item) {\r\n    let qlen = this.queue.length;\r\n\r\n    let b = this.b;\r\n\r\n    this.queue[b] = item;\r\n    this.b = (this.b + 1)%qlen;\r\n\r\n    if (this.length >= qlen || this.a === this.b) {\r\n      let newsize = qlen<<1;\r\n      let queue = new Array(newsize);\r\n\r\n      for (let i = 0; i < qlen; i++) {\r\n        let i2 = (i + this.a)%qlen;\r\n\r\n        queue[i] = this.queue[i2];\r\n      }\r\n\r\n      this.a = 0;\r\n      this.b = qlen;\r\n      this.queue = queue;\r\n    }\r\n\r\n    this.length++;\r\n  }\r\n\r\n  clear(clearData = true) {\r\n    this.queue.length = this.initialSize;\r\n\r\n    if (clearData) {\r\n      for (let i = 0; i < this.queue.length; i++) {\r\n        this.queue[i] = undefined;\r\n      }\r\n    }\r\n\r\n    this.a = this.b = 0;\r\n    this.length = 0;\r\n\r\n    return this;\r\n  }\r\n\r\n  dequeue() {\r\n    if (this.length === 0) {\r\n      return undefined;\r\n    }\r\n    this.length--;\r\n\r\n    let ret = this.queue[this.a];\r\n\r\n    this.queue[this.a] = undefined;\r\n\r\n    this.a = (this.a + 1)%this.queue.length;\r\n    return ret;\r\n  }\r\n}\r\n\r\nglobalThis._testQueue = function (steps = 15, samples = 15) {\r\n  let queue = new Queue(3);\r\n\r\n  for (let i = 0; i < steps; i++) {\r\n    let list = [];\r\n\r\n    for (let j = 0; j < samples; j++) {\r\n      let item = {f: Math.random()};\r\n      list.push(item);\r\n\r\n      queue.enqueue(item);\r\n    }\r\n\r\n    let j = 0;\r\n\r\n    while (queue.length > 0) {\r\n      let item = queue.dequeue();\r\n\r\n      if (item !== list[j]) {\r\n        console.log(item, list);\r\n        throw new Error(\"got wrong item\", item);\r\n      }\r\n\r\n      j++;\r\n\r\n      if (j > 10000) {\r\n        console.error(\"Infinite loop error\");\r\n        break;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n\r\nexport class ArrayPool {\r\n  constructor() {\r\n    this.pools = new Map();\r\n    this.map = new Array(1024);\r\n  }\r\n\r\n  get(n, clear) {\r\n    let pool;\r\n\r\n    if (n < 1024) {\r\n      pool = this.map[n];\r\n    } else {\r\n      pool = this.pools.get(n);\r\n    }\r\n\r\n    if (!pool) {\r\n      let tot;\r\n\r\n      if (n > 512) {\r\n        tot = 32;\r\n      } else if (n > 256) {\r\n        tot = 64;\r\n      } else if (n > 128) {\r\n        tot = 256;\r\n      } else if (n > 64) {\r\n        tot = 512;\r\n      } else {\r\n        tot = 1024;\r\n      }\r\n\r\n      pool = new cachering(() => new Array(n), tot);\r\n      if (n < 1024) {\r\n        this.map[n] = pool;\r\n      }\r\n      this.pools.set(n, pool);\r\n\r\n      return this.get(n, clear);\r\n    }\r\n\r\n    let ret = pool.next();\r\n    if (ret.length !== n) {\r\n      console.warn(\"Array length was set\", n, ret);\r\n      ret.length = n;\r\n    }\r\n\r\n    if (clear) {\r\n      for (let i = 0; i < n; i++) {\r\n        ret[i] = undefined;\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\n/** jsFiddle-friendly */\r\nexport class DivLogger {\r\n  constructor(elemId, maxLines=16) {\r\n    this.elemId = elemId;\r\n    this.elem = undefined;\r\n    this.lines = new Array();\r\n    this.maxLines = maxLines;\r\n  }\r\n\r\n  push(line) {\r\n    if (this.lines.length > this.maxLines) {\r\n      this.lines.shift();\r\n      this.lines.push(line);\r\n    } else {\r\n      this.lines.push(line);\r\n    }\r\n\r\n    this.update();\r\n  }\r\n\r\n  update() {\r\n    let buf = this.lines.join(`<br>`);\r\n    buf = buf.replace(/[ \\t]/g, \"&nbsp;\");\r\n\r\n    if (!this.elem) {\r\n      this.elem = document.getElementById(this.elemId);\r\n    }\r\n\r\n    this.elem.innerHTML = buf;\r\n  }\r\n\r\n  toString(obj, depth=0) {\r\n    let s = '';\r\n\r\n    let tab = '';\r\n    for (let i=0; i<depth; i++) {\r\n      tab += '$TAB';\r\n    }\r\n\r\n    if (typeof obj === \"symbol\") {\r\n      return `[${obj.description}]`;\r\n    }\r\n\r\n    const DEPTH_LIMIT = 1;\r\n    const CHAR_LIMIT = 100;\r\n\r\n    if (typeof obj === \"object\" && Array.isArray(obj)) {\r\n      s = \"[$NL\";\r\n      for (let i=0; i<obj.length; i++) {\r\n        let v = obj[i];\r\n\r\n        if (depth >= DEPTH_LIMIT) {\r\n          v = typeof v;\r\n        } else {\r\n          v = this.toString(v, depth+1);\r\n        }\r\n\r\n        s += tab + \"$TAB\";\r\n        s += v + (i !== obj.length - 1 ? \",\" : \"\") + \"$NL\";\r\n      }\r\n\r\n      let keys = Reflect.ownKeys(obj);\r\n      for (let i=0; i<keys.length; i++) {\r\n        let k = keys[i];\r\n        let n;\r\n\r\n        let k2 = this.toString(k);\r\n\r\n        if (typeof k !== \"symbol\" && !isNaN(n = parseInt(k))) {\r\n          if (n >= 0 && n < obj.length) {\r\n            continue;\r\n          }\r\n        }\r\n\r\n        let v;\r\n        try {\r\n          v = obj[k];\r\n        } catch (error) {\r\n          v = \"(error)\";\r\n        }\r\n\r\n        s += tab + `$TAB${k2} : ${v}`;\r\n\r\n        if (i < keys.length-1) {\r\n          s += \",\";\r\n        }\r\n\r\n        if (!s.endsWith(\"$NL\") && !s.endsWith(\"\\n\")) {\r\n          s += \"$NL\";\r\n        }\r\n      }\r\n      s += \"$TAB]$NL\";\r\n\r\n      if (s.length < CHAR_LIMIT) {\r\n        s = s.replace(/\\$NL/g, \"\");\r\n        s = s.replace(/(\\$TAB)+/g, \" \");\r\n      } else {\r\n        s = s.replace(/\\$NL/g, \"\\n\");\r\n        s = s.replace(/\\$TAB/g, \"  \");\r\n      }\r\n    } else if (typeof obj === \"object\") {\r\n      s = '{$NL';\r\n\r\n      let keys = Reflect.ownKeys(obj);\r\n      for (let i=0; i<keys.length; i++) {\r\n        let k = keys[i];\r\n        let k2 = this.toString(k);\r\n\r\n        let v;\r\n        try {\r\n          v = obj[k];\r\n        } catch (error) {\r\n          v = '(error)';\r\n        }\r\n\r\n        if (depth >= DEPTH_LIMIT) {\r\n          v = typeof v;\r\n        } else {\r\n          v = this.toString(v, depth+1);\r\n        }\r\n\r\n        s += tab + `$TAB${k2} : ${v}`;\r\n\r\n        if (i < keys.length-1) {\r\n          s += \",\";\r\n        }\r\n\r\n        if (!s.endsWith(\"$NL\") && !s.endsWith(\"\\n\")) {\r\n          s += \"$NL\";\r\n        }\r\n      }\r\n      s += tab + \"}$NL\";\r\n\r\n      if (s.length < CHAR_LIMIT) {\r\n        s = s.replace(/\\$NL/g, \"\");\r\n        s = s.replace(/(\\$TAB)+/g, \" \");\r\n      } else {\r\n        s = s.replace(/\\$NL/g, \"\\n\");\r\n        s = s.replace(/\\$TAB/g, \"  \");\r\n      }\r\n    } else if (typeof obj === \"undefined\") {\r\n      s = 'undefined';\r\n    } else if (typeof obj === \"function\") {\r\n      s = 'function ' + obj.name;\r\n    } else {\r\n      s = \"\" + obj;\r\n    }\r\n\r\n    return s;\r\n  }\r\n}\r\n\r\nexport const PendingTimeoutPromises = new Set();\r\n\r\nexport class TimeoutPromise {\r\n  constructor(callback, timeout=3000, silent=false) {\r\n    if (!callback) {\r\n      return;\r\n    }\r\n\r\n    this.silent = silent;\r\n    this.timeout = timeout;\r\n\r\n    let accept2 = this._accept2.bind(this);\r\n    let reject2 = this._reject2.bind(this);\r\n\r\n    this.time = time_ms();\r\n\r\n    this.rejected = false;\r\n\r\n    this._promise = new Promise((accept, reject) => {\r\n      this._accept = accept;\r\n      this._reject = reject;\r\n\r\n      callback(accept2, reject2);\r\n    });\r\n\r\n    PendingTimeoutPromises.add(this);\r\n  }\r\n\r\n  _accept2(val) {\r\n    if (this.bad) {\r\n      if (!this.silent) {\r\n        this._reject(new Error(\"Timeout\"));\r\n      }\r\n    } else {\r\n      return this._accept(val);\r\n    }\r\n  }\r\n\r\n  static wrapPromise(promise, timeout=3000, callback) {\r\n    let p = new TimeoutPromise();\r\n\r\n    p._promise = promise;\r\n\r\n    p._accept = callback;\r\n    p._reject = function(error) {\r\n      throw error;\r\n    }\r\n\r\n    p.then(val => {\r\n      p._accept2(val);\r\n    }).catch(error => {\r\n      p._reject2(error);\r\n    });\r\n\r\n    return p;\r\n  }\r\n\r\n  _reject2(error) {\r\n    this._reject(error);\r\n  }\r\n\r\n  then(callback) {\r\n    let cb = (val) => {\r\n      let ret = callback(val);\r\n\r\n      if (ret instanceof Promise) {\r\n        ret = TimeoutPromise.wrapPromise(ret, this.timeout, callback);\r\n      }\r\n\r\n      return ret;\r\n    }\r\n\r\n    this._promise.then(cb);\r\n    return this;\r\n  }\r\n\r\n  catch(callback) {\r\n    this._promise.catch(callback);\r\n    return this;\r\n  }\r\n\r\n  finally(callback) {\r\n    this._promise.catch(callback);\r\n    return this;\r\n  }\r\n\r\n  get bad() {\r\n    return time_ms() - this.time > this.timeout;\r\n  }\r\n}\r\n\r\nwindow.setInterval(() => {\r\n  let bad = [];\r\n\r\n  for (let promise of PendingTimeoutPromises) {\r\n    if (promise.bad) {\r\n      bad.push(promise);\r\n    }\r\n  }\r\n\r\n  for (let promise of bad) {\r\n    PendingTimeoutPromises.delete(promise);\r\n  }\r\n\r\n  for (let promise of bad) {\r\n    try {\r\n      promise._reject(new Error(\"Timeout\"));\r\n    } catch (error) {\r\n      print_stack(error);\r\n    }\r\n  }\r\n}, 250);\r\n","import * as util from './util.js';\r\nimport nstructjs from './struct.js';\r\n\r\nexport const EulerOrders = {\r\n  XYZ: 0,\r\n  XZY: 1,\r\n  YXZ: 2,\r\n  YZX: 3,\r\n  ZXY: 4,\r\n  ZYX: 5\r\n};\r\n\r\n/**\r\n * @param mode one of 'es', 'commonjs', 'rjs'\r\n */\r\nwindow.makeCompiledVectormathCode = function (mode = \"es\") {\r\n  let s = \"\";\r\n  let es6exports = mode === \"es\";\r\n\r\n  function doExports(name) {\r\n    if (es6exports) {\r\n      return \"export\";\r\n    } else {\r\n      return `var ${name} = exports.${name} =`;\r\n    }\r\n  }\r\n\r\n  let classes = [Vector2, Vector3, Vector4, a];\r\n  let lens = {\r\n    Vector2: 2,\r\n    Vector3: 3,\r\n    Vector4: 4,\r\n    Quat   : 4\r\n  };\r\n\r\n  let modecode = \"\";\r\n\r\n  let nstructjscode = `\r\n  let g = typeof window !== \"undefined\" ? window : \"undefined\";\r\n  \r\n  g = g || (typeof global !== \"undefined\" ? global : \"undefined\");\r\n  g = g || (typeof self !== \"undefined\" ? self : \"undefined\");\r\n  g = g || (typeof globals !== \"undefined\" ? globals : \"undefined\");\r\n\r\n  if (typeof nstructjs === \"undefined\") {\r\n    //add nstructjs stub\r\n    g.nstructjs = {\r\n      register : function() {}\r\n    }\r\n  }\r\n  `\r\n\r\n  if (mode !== \"rjs\") {\r\n    if (mode === \"commonjs\") {\r\n      modecode = `if (typeof module !== \"undefined\" && typeof exports === \"undefined\") {\r\n      if (module.exports === undefined) {\r\n        module.exports = {};\r\n      }\r\n      \r\n      g.exports = module.exports;\r\n    } else if (typeof module === \"undefined\") {\r\n      g.exports = g.vectormath = {};\r\n    }\\n`;\r\n    }\r\n\r\n    s += `{\r\n      ${nstructjscode}\r\n    ${modecode}\r\n  }`;\r\n  }\r\n\r\n  s += `\r\nclass cachering extends Array {\r\n  constructor(func, size) {\r\n    super()\r\n\r\n    this.cur = 0;\r\n\r\n    for (var i=0; i<size; i++) {\r\n      this.push(func());\r\n    }\r\n  }\r\n\r\n  static fromConstructor(cls, size) {\r\n    var func = function() {\r\n      return new cls();\r\n    }\r\n\r\n    return new cachering(func, size);\r\n  }\r\n\r\n  next() {\r\n    var ret = this[this.cur];\r\n    this.cur = (this.cur+1)%this.length;\r\n\r\n    return ret;\r\n  }\r\n}\r\n`;\r\n  s += `\r\n\r\nvar M_SQRT2 = Math.sqrt(2.0);\r\nvar FLT_EPSILON = 2.22e-16;  \r\nvar sin=Math.sin, cos=Math.cos, abs=Math.abs, log=Math.log,\r\n    asin=Math.asin, exp=Math.exp, acos=Math.acos, fract=Math.fract,\r\n    sign=Math.sign, tent=Math.tent, atan2=Math.atan2, atan=Math.atan,\r\n    pow=Math.pow, sqrt=Math.sqrt, floor=Math.floor, ceil=Math.ceil,\r\n    min=Math.min, max=Math.max, PI=Math.PI, E=2.718281828459045;\r\n\r\nvar DOT_NORM_SNAP_LIMIT = 0.00000000001;\r\n\r\n${doExports(\"BaseVector\")} class BaseVector extends Array {\r\n  constructor() {\r\n    super();\r\n    \r\n    this.vec = undefined; //for compatibility with old files\r\n  }\r\n\r\n  copy() {\r\n    return new this.constructor(this);\r\n  }\r\n\r\n  load(data) {\r\n    throw new Error(\"Implement me!\");\r\n  }\r\n  \r\n  vectorLength() {\r\n    return sqrt(this.dot(this));\r\n  }\r\n  \r\n  normalize() {\r\n    var l = this.vectorLength();\r\n    if (l > 0.00000001) {\r\n      this.mulScalar(1.0/l);\r\n    }\r\n    \r\n    return this;\r\n  }\r\n}\r\n  \r\n`;\r\n\r\n  function indent(s, pad = \"  \") {\r\n    let l = s.split(\"\\n\");\r\n    let s2 = \"\";\r\n\r\n    for (let l2 of l) {\r\n      s2 += pad + l2 + \"\\n\";\r\n    }\r\n\r\n    return s2;\r\n  }\r\n\r\n  let i = 0;\r\n  for (let cls of classes) {\r\n    s += doExports(cls.name) + \" class \" + cls.name + \" extends BaseVector {\\n\";\r\n\r\n    let keys = Reflect.ownKeys(cls.prototype);\r\n\r\n    for (let k of keys) {\r\n      let v = cls.prototype[k];\r\n\r\n      if (typeof v !== \"function\") {\r\n        continue;\r\n      }\r\n\r\n      if (typeof k === \"symbol\") {\r\n        k = \"  [\" + k.toString() + \"]\";\r\n      }\r\n\r\n      v = (\"\" + v).trim();\r\n      if (v.startsWith(\"function(\") || v.startsWith(\"function (\")) {\r\n        v = k + v.slice(8, v.length).trim();\r\n      } else if (v.startsWith(\"function\")) {\r\n        v = v.slice(8, v.length).trim();\r\n      }\r\n\r\n      if (v.endsWith(\";}\")) {\r\n        v = v.slice(0, v.length - 1) + \"\\n  }\\n\";\r\n      }\r\n\r\n      let zero = \"\";\r\n      let l = lens[cls.name];\r\n\r\n      for (let j = 0; j < l; j++) {\r\n        if (j > 0) {\r\n          zero += \" = \";\r\n        }\r\n        zero += `this[${j}]`;\r\n      }\r\n\r\n      zero += \" = 0.0\";\r\n\r\n      if (k === \"constructor\") {\r\n        s += `  constructor(data) {\r\n    super(${l});\r\n        \r\n    this.vec = undefined; //for compatibility with old files\r\n    \r\n    if (arguments.length > 1) {\r\n      throw new Error(\"unexpected argument\");\r\n    }\r\n\r\n    //this.length = ${l};\r\n    ${zero};\r\n\r\n    if (data !== undefined) {\r\n      this.load(data);\r\n    }\r\n  }\r\n`;\r\n      } else {\r\n        s += indent(v);\r\n      }\r\n\r\n      s += \"\\n\";\r\n      i++;\r\n    }\r\n    s += \"}\\n\\n\"\r\n\r\n    s += `${cls.name}.STRUCT = \\`${cls.STRUCT}\\`;\\n`;\r\n    s += `nstructjs.register(${cls.name});\\n\\n`;\r\n  }\r\n\r\n  s += \"\\n\\n\" + (\"\" + internal_matrix).trim() + \"\\n\";\r\n  s += \"\\n\" + doExports(\"Matrix4\") + Matrix4;\r\n\r\n  s += `\\n  Matrix4.STRUCT = \\`${Matrix4.STRUCT}\\`;\\n`;\r\n  s += \"nstructjs.register(Matrix4)\\n\";\r\n\r\n  s += `\r\n  var _quat_vs3_temps = cachering.fromConstructor(Vector3, 64);\r\n  var _v3nd4_n1_normalizedDot4 = new Vector3();\r\n  var _v3nd4_n2_normalizedDot4 = new Vector3();\r\n  var _v3nd_n1_normalizedDot = new Vector3();\r\n  var _v3nd_n2_normalizedDot = new Vector3();\r\n\r\n  var $_v3nd4_n1_normalizedDot4 = new Vector3();\r\n  var $_v3nd4_n2_normalizedDot4 = new Vector3();\r\n  var $_v3nd_n1_normalizedDot = new Vector3();\r\n  var $_v3nd_n2_normalizedDot = new Vector3();\r\n\r\n  var lookat_cache_vs3 = cachering.fromConstructor(Vector3, 64);\r\n  var lookat_cache_vs4 = cachering.fromConstructor(Vector4, 64);\r\n\r\n  var makenormalcache = cachering.fromConstructor(Vector3, 64);\r\n`;\r\n\r\n  if (mode === \"rjs\") {\r\n    s = `define([], function() {\r\n  \"use strict\";\r\n\r\n  let exports = {};\r\n\r\n  {\r\n    ${nstructjscode}\r\n  }\r\n  ${indent(s)}\r\n\r\n  return exports;\r\n});\r\n`;\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nvar sin                                                          = Math.sin, cos                                          = Math.cos, abs                          = Math.abs, log = Math.log,\r\n    asin                                                         = Math.asin, exp                                        = Math.exp, acos = Math.acos, fract = Math.fract,\r\n    sign = Math.sign, tent = Math.tent, atan2 = Math.atan2, atan = Math.atan,\r\n    pow                                                          = Math.pow, sqrt = Math.sqrt, floor                      = Math.floor, ceil = Math.ceil,\r\n    min                                                          = Math.min, max = Math.max, PI = Math.PI, E = 2.718281828459045;\r\n\r\nvar DOT_NORM_SNAP_LIMIT = 0.00000000001;\r\nvar M_SQRT2 = Math.sqrt(2.0);\r\nvar FLT_EPSILON = 2.22e-16;\r\n\r\nvar basic_funcs = {\r\n  equals   : [[\"b\"], \"this[X] === b[X]\", \"&&\"],\r\n  /*dot is made manually so it's safe for acos\r\n  dot     : [[\"b\"], \"this[X]*b[X]\", \"+\"],\r\n   */\r\n  zero     : [[], \"0.0;\"],\r\n  negate   : [[], \"-this[X];\"],\r\n  combine  : [[\"b\", \"u\", \"v\"], \"this[X]*u + this[X]*v;\"],\r\n  interp   : [[\"b\", \"t\"], \"this[X] + (b[X] - this[X])*t;\"],\r\n  add      : [[\"b\"], \"this[X] + b[X];\"],\r\n  addFac   : [[\"b\", \"F\"], \"this[X] + b[X]*F;\"],\r\n  fract    : [[], \"Math.fract(this[X]);\"],\r\n  sub      : [[\"b\"], \"this[X] - b[X];\"],\r\n  mul      : [[\"b\"], \"this[X] * b[X];\"],\r\n  div      : [[\"b\"], \"this[X] / b[X];\"],\r\n  mulScalar: [[\"b\"], \"this[X] * b;\"],\r\n  divScalar: [[\"b\"], \"this[X] / b;\"],\r\n  addScalar: [[\"b\"], \"this[X] + b;\"],\r\n  subScalar: [[\"b\"], \"this[X] - b;\"],\r\n  minScalar: [[\"b\"], \"Math.min(this[X], b);\"],\r\n  maxScalar: [[\"b\"], \"Math.max(this[X], b);\"],\r\n  ceil     : [[], \"Math.ceil(this[X])\"],\r\n  floor    : [[], \"Math.floor(this[X])\"],\r\n  abs      : [[], \"Math.abs(this[X])\"],\r\n  min      : [[\"b\"], \"Math.min(this[X], b[X])\"],\r\n  max      : [[\"b\"], \"Math.max(this[X], b[X])\"],\r\n  clamp    : [[\"MIN\", \"MAX\"], \"min(max(this[X], MAX), MIN)\"],\r\n};\r\n\r\nfunction bounded_acos(fac) {\r\n  if (fac <= -1.0)\r\n    return Math.pi;\r\n  else if (fac >= 1.0)\r\n    return 0.0;\r\n  else\r\n    return Math.acos(fac);\r\n}\r\n\r\nfunction make_norm_safe_dot(cls) {\r\n  var _dot = cls.prototype.dot;\r\n\r\n  cls.prototype._dot = _dot;\r\n  cls.prototype.dot = function (b) {\r\n    var ret = _dot.call(this, b);\r\n\r\n    if (ret >= 1.0 - DOT_NORM_SNAP_LIMIT && ret <= 1.0 + DOT_NORM_SNAP_LIMIT)\r\n      return 1.0;\r\n    if (ret >= -1.0 - DOT_NORM_SNAP_LIMIT && ret <= -1.0 + DOT_NORM_SNAP_LIMIT)\r\n      return -1.0;\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nfunction getBaseVector(parent) {\r\n  return class BaseVector extends parent {\r\n    constructor() {\r\n      super(...arguments);\r\n\r\n      this.vec = undefined; //for compatibility with old nstructjs-saved files\r\n\r\n      //this.xyzw = this.init_swizzle(4);\r\n      //this.xyz = this.init_swizzle(3);\r\n      //this.xy = this.init_swizzle(2);\r\n    }\r\n\r\n    static inherit(cls, vectorsize) {\r\n      make_norm_safe_dot(cls);\r\n\r\n      var f;\r\n\r\n      var vectorDotDistance = \"f = function vectorDotDistance(b) {\\n\";\r\n      for (var i = 0; i < vectorsize; i++) {\r\n        vectorDotDistance += \"  let d\" + i + \" = this[\" + i + \"]-b[\" + i + \"];\\n\\n  \";\r\n      }\r\n\r\n      vectorDotDistance += \"  return \"\r\n      for (var i = 0; i < vectorsize; i++) {\r\n        if (i > 0)\r\n          vectorDotDistance += \" + \";\r\n        vectorDotDistance += \"d\" + i + \"*d\" + i;\r\n      }\r\n      vectorDotDistance += \";\\n\"\r\n      vectorDotDistance += \"};\";\r\n      cls.prototype.vectorDotDistance = eval(vectorDotDistance);\r\n\r\n      var f;\r\n      var vectorDistance = \"f = function vectorDistance(b) {\\n\";\r\n      for (var i = 0; i < vectorsize; i++) {\r\n        vectorDistance += `  let d${i} = this[${i}] - (b[${i}]||0);\\n\\n  `;\r\n        //vectorDistance += \"  let d\"+i+\" = this[\"+i+\"]-(b[\"+i+\"]||0);\\n\\n  \";\r\n      }\r\n\r\n      vectorDistance += \"  return Math.sqrt(\"\r\n      for (var i = 0; i < vectorsize; i++) {\r\n        if (i > 0)\r\n          vectorDistance += \" + \";\r\n        vectorDistance += \"d\" + i + \"*d\" + i;\r\n      }\r\n      vectorDistance += \");\\n\"\r\n      vectorDistance += \"};\";\r\n      cls.prototype.vectorDistance = eval(vectorDistance);\r\n\r\n      var vectorDistanceSqr = \"f = function vectorDistanceSqr(b) {\\n\";\r\n      for (var i = 0; i < vectorsize; i++) {\r\n        vectorDistanceSqr += `  let d${i} = this[${i}] - (b[${i}]||0);\\n\\n  `;\r\n        //vectorDistanceSqr += \"  let d\"+i+\" = this[\"+i+\"]-(b[\"+i+\"]||0);\\n\\n  \";\r\n      }\r\n\r\n      vectorDistanceSqr += \"  return (\"\r\n      for (var i = 0; i < vectorsize; i++) {\r\n        if (i > 0)\r\n          vectorDistanceSqr += \" + \";\r\n        vectorDistanceSqr += \"d\" + i + \"*d\" + i;\r\n      }\r\n      vectorDistanceSqr += \");\\n\"\r\n      vectorDistanceSqr += \"};\";\r\n      cls.prototype.vectorDistanceSqr = eval(vectorDistanceSqr);\r\n\r\n\r\n      for (var k in basic_funcs) {\r\n        var func = basic_funcs[k];\r\n        var args = func[0];\r\n        var line = func[1];\r\n        var f;\r\n\r\n        var code = \"f = function \" + k + \"(\"\r\n        for (var i = 0; i < args.length; i++) {\r\n          if (i > 0)\r\n            code += \", \";\r\n\r\n          line = line.replace(args[i], args[i].toLowerCase());\r\n          code += args[i].toLowerCase();\r\n        }\r\n        code += \") {\\n\";\r\n\r\n        if (func.length > 2) {\r\n          //make summation\r\n          code += \"  return \";\r\n\r\n          for (var i = 0; i < vectorsize; i++) {\r\n            if (i > 0)\r\n              code += func[2];\r\n\r\n            code += \"(\" + line.replace(/X/g, \"\" + i) + \")\";\r\n          }\r\n          code += \";\\n\";\r\n        } else {\r\n          for (var i = 0; i < vectorsize; i++) {\r\n            var line2 = line.replace(/X/g, \"\" + i);\r\n            code += \"  this[\" + i + \"] = \" + line2 + \";\\n\";\r\n          }\r\n          code += \"  return this;\\n\"\r\n        }\r\n\r\n        code += \"}\\n\";\r\n\r\n        //console.log(code);\r\n        var f = eval(code);\r\n\r\n        cls.prototype[k] = f;\r\n        //console.log(k, f);\r\n      }\r\n    }\r\n\r\n    copy() {\r\n      return new this.constructor(this);\r\n    }\r\n\r\n    load(data) {\r\n      throw new Error(\"Implement me!\");\r\n    }\r\n\r\n    init_swizzle(size) {\r\n      var ret = {};\r\n      var cls = size === 4 ? Vector4 : (size === 3 ? Vector3 : Vector2);\r\n\r\n      for (var k in cls.prototype) {\r\n        var v = cls.prototype[k];\r\n        if (typeof v !== \"function\" && !(v instanceof Function))\r\n          continue;\r\n\r\n        ret[k] = v.bind(this);\r\n      }\r\n\r\n      return ret;\r\n    }\r\n\r\n    vectorLength() {\r\n      return sqrt(this.dot(this));\r\n    }\r\n\r\n    swapAxes(axis1, axis2) {\r\n      let t = this[axis1];\r\n      this[axis1] = this[axis2];\r\n      this[axis2] = t;\r\n\r\n      return this;\r\n    }\r\n\r\n    normalize() {\r\n      /*\r\n      for (let i=0; i<this.length; i++) {\r\n        if (util.isDenormal(this[i])) {\r\n          console.error(\"Denormal error\", i, this[i]);\r\n          this[i] = 0.0;\r\n        }\r\n      }\r\n      //*/\r\n\r\n      let l = this.vectorLength();\r\n\r\n      /*\r\n      if (util.isDenormal(l)) {\r\n        console.error(\"Denormal error\", l);\r\n      }\r\n      //*/\r\n\r\n      if (l > 0.00000001) {\r\n        this.mulScalar(1.0/l);\r\n      }\r\n\r\n      return this;\r\n    }\r\n  }\r\n}\r\n\r\nexport const BaseVector = getBaseVector(Array);\r\nexport const F64BaseVector = getBaseVector(Float64Array);\r\nexport const F32BaseVector = getBaseVector(Float32Array);\r\n\r\nfunction myclamp(f, a, b) {\r\n  return Math.min(Math.max(f, a), b);\r\n}\r\n\r\nexport class Vector4 extends BaseVector {\r\n  constructor(data) {\r\n    super(4);\r\n\r\n    if (arguments.length > 1) {\r\n      throw new Error(\"unexpected argument\");\r\n    }\r\n\r\n    this[0] = this[1] = this[2] = this[3] = 0.0;\r\n\r\n    if (data !== undefined) {\r\n      this.load(data);\r\n    }\r\n  }\r\n\r\n  toCSS() {\r\n    let r = ~~(this[0]*255);\r\n    let g = ~~(this[1]*255);\r\n    let b = ~~(this[2]*255);\r\n    let a = this[3];\r\n    return `rgba(${r},${g},${b},${a})`\r\n  }\r\n\r\n  loadXYZW(x, y, z, w) {\r\n    this[0] = x;\r\n    this[1] = y;\r\n    this[2] = z;\r\n    this[3] = w;\r\n\r\n    return this;\r\n  }\r\n\r\n  loadXYZ(x, y, z) {\r\n    this[0] = x;\r\n    this[1] = y;\r\n    this[2] = z;\r\n\r\n    return this;\r\n  }\r\n\r\n  load(data) {\r\n    if (data === undefined)\r\n      return this;\r\n\r\n    this[0] = data[0];\r\n    this[1] = data[1];\r\n    this[2] = data[2];\r\n    this[3] = data[3];\r\n\r\n    return this;\r\n  }\r\n\r\n  dot(b) {\r\n    return this[0]*b[0] + this[1]*b[1] + this[2]*b[2] + this[3]*b[3];\r\n  }\r\n\r\n  mulVecQuat(q) {\r\n    let t0 = -q[1] * this[0] - q[2] * this[1] - q[3] * this[2];\r\n    let t1 = q[0] * this[0] + q[2] * this[2] - q[3] * this[1];\r\n    let t2 = q[0] * this[1] + q[3] * this[0] - q[1] * this[2];\r\n\r\n    this[2] = q[0] * this[2] + q[1] * this[1] - q[2] * this[0];\r\n    this[0] = t1;\r\n    this[1] = t2;\r\n\r\n    t1 = t0 * -q[1] + this[0] * q[0] - this[1] * q[3] + this[2] * q[2];\r\n    t2 = t0 * -q[2] + this[1] * q[0] - this[2] * q[1] + this[0] * q[3];\r\n\r\n    this[2] = t0 * -q[3] + this[2] * q[0] - this[0] * q[2] + this[1] * q[1];\r\n    this[0] = t1;\r\n    this[1] = t2;\r\n\r\n    return this;\r\n  }\r\n\r\n  multVecMatrix(matrix) {\r\n    var x = this[0];\r\n    var y = this[1];\r\n    var z = this[2];\r\n    var w = this[3];\r\n\r\n    this[0] = w*matrix.$matrix.m41 + x*matrix.$matrix.m11 + y*matrix.$matrix.m21 + z*matrix.$matrix.m31;\r\n    this[1] = w*matrix.$matrix.m42 + x*matrix.$matrix.m12 + y*matrix.$matrix.m22 + z*matrix.$matrix.m32;\r\n    this[2] = w*matrix.$matrix.m43 + x*matrix.$matrix.m13 + y*matrix.$matrix.m23 + z*matrix.$matrix.m33;\r\n    this[3] = w*matrix.$matrix.m44 + x*matrix.$matrix.m14 + y*matrix.$matrix.m24 + z*matrix.$matrix.m34;\r\n\r\n    return this[3];\r\n  }\r\n\r\n  cross(v) {\r\n    var x = this[1]*v[2] - this[2]*v[1];\r\n    var y = this[2]*v[0] - this[0]*v[2];\r\n    var z = this[0]*v[1] - this[1]*v[0];\r\n\r\n    this[0] = x;\r\n    this[1] = y;\r\n    this[2] = z;\r\n\r\n    return this;\r\n  }\r\n\r\n  preNormalizedAngle(v2) {\r\n    let th = this.dot(v2)*0.99999;\r\n    return Math.acos(th);\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    if (typeof this.vec !== \"undefined\") {\r\n      this.load(this.vec);\r\n      this.vec = undefined;\r\n    }\r\n  }\r\n};\r\nVector4.STRUCT = `\r\nvec4 {\r\n  0 : float;\r\n  1 : float;\r\n  2 : float;\r\n  3 : float;\r\n}\r\n`;\r\nnstructjs.manager.add_class(Vector4);\r\n\r\n\r\nvar _v3nd_n1_normalizedDot, _v3nd_n2_normalizedDot;\r\nvar _v3nd4_n1_normalizedDot4, _v3nd4_n2_normalizedDot4;\r\n\r\nexport class Vector3 extends F64BaseVector {\r\n  constructor(data) {\r\n    super(3);\r\n\r\n    if (arguments.length > 1) {\r\n      throw new Error(\"unexpected argument\");\r\n    }\r\n\r\n    this[0] = this[1] = this[2] = 0.0;\r\n\r\n    if (data !== undefined) {\r\n      this.load(data);\r\n    }\r\n\r\n    if (this.constructor === Vector3) {\r\n      Object.preventExtensions(this);\r\n    }\r\n  }\r\n\r\n  //normalizedDot4\r\n  static normalizedDot4(v1, v2, v3, v4) {\r\n    $_v3nd4_n1_normalizedDot4.load(v2).sub(v1).normalize();\r\n    $_v3nd4_n2_normalizedDot4.load(v4).sub(v3).normalize();\r\n\r\n    return $_v3nd4_n1_normalizedDot4.dot($_v3nd4_n2_normalizedDot4);\r\n  }\r\n\r\n  static normalizedDot3(v1, center, v2) {\r\n    $_v3nd4_n1_normalizedDot3.load(v1).sub(center).normalize();\r\n    $_v3nd4_n2_normalizedDot3.load(v2).sub(center).normalize();\r\n\r\n    return $_v3nd4_n1_normalizedDot3.dot($_v3nd4_n2_normalizedDot3);\r\n  }\r\n\r\n  toCSS() {\r\n    let r = ~~(this[0]*255);\r\n    let g = ~~(this[1]*255);\r\n    let b = ~~(this[2]*255);\r\n    return `rgb(${r},${g},${b})`\r\n  }\r\n\r\n  loadXYZ(x, y, z) {\r\n    this[0] = x;\r\n    this[1] = y;\r\n    this[2] = z;\r\n\r\n    return this;\r\n  }\r\n\r\n  loadXY(x, y) {\r\n    this[0] = x;\r\n    this[1] = y;\r\n\r\n    return this;\r\n  }\r\n\r\n  toJSON() {\r\n    return [this[0], this[1], this[2]];\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    return this.load(obj);\r\n  }\r\n\r\n  initVector3() {\r\n    this.length = 3;\r\n    this[0] = this[1] = this[2] = 0;\r\n    return this;\r\n  }\r\n\r\n  load(data) {\r\n    if (data === undefined)\r\n      return this;\r\n\r\n    //if (isNaN(data[0]) || isNaN(data[1]) || isNaN(data[2])) {\r\n    //  throw new Error(\"NaN\");\r\n    //}\r\n\r\n    this[0] = data[0];\r\n    this[1] = data[1];\r\n    this[2] = data[2];\r\n\r\n    return this;\r\n  }\r\n\r\n  dot(b) {\r\n    return this[0]*b[0] + this[1]*b[1] + this[2]*b[2];\r\n  }\r\n\r\n  normalizedDot(v) {\r\n    $_v3nd_n1_normalizedDot.load(this);\r\n    $_v3nd_n2_normalizedDot.load(v);\r\n    $_v3nd_n1_normalizedDot.normalize();\r\n    $_v3nd_n2_normalizedDot.normalize();\r\n    return $_v3nd_n1_normalizedDot.dot($_v3nd_n2_normalizedDot);\r\n  }\r\n\r\n  mulVecQuat(q) {\r\n    let t0 = -q[1] * this[0] - q[2] * this[1] - q[3] * this[2];\r\n    let t1 = q[0] * this[0] + q[2] * this[2] - q[3] * this[1];\r\n    let t2 = q[0] * this[1] + q[3] * this[0] - q[1] * this[2];\r\n\r\n    this[2] = q[0] * this[2] + q[1] * this[1] - q[2] * this[0];\r\n    this[0] = t1;\r\n    this[1] = t2;\r\n\r\n    t1 = t0 * -q[1] + this[0] * q[0] - this[1] * q[3] + this[2] * q[2];\r\n    t2 = t0 * -q[2] + this[1] * q[0] - this[2] * q[1] + this[0] * q[3];\r\n\r\n    this[2] = t0 * -q[3] + this[2] * q[0] - this[0] * q[2] + this[1] * q[1];\r\n    this[0] = t1;\r\n    this[1] = t2;\r\n\r\n    return this;\r\n  }\r\n\r\n  multVecMatrix(matrix, ignore_w) {\r\n    if (ignore_w === undefined) {\r\n      ignore_w = false;\r\n    }\r\n    var x = this[0];\r\n    var y = this[1];\r\n    var z = this[2];\r\n    this[0] = matrix.$matrix.m41 + x*matrix.$matrix.m11 + y*matrix.$matrix.m21 + z*matrix.$matrix.m31;\r\n    this[1] = matrix.$matrix.m42 + x*matrix.$matrix.m12 + y*matrix.$matrix.m22 + z*matrix.$matrix.m32;\r\n    this[2] = matrix.$matrix.m43 + x*matrix.$matrix.m13 + y*matrix.$matrix.m23 + z*matrix.$matrix.m33;\r\n    var w = matrix.$matrix.m44 + x*matrix.$matrix.m14 + y*matrix.$matrix.m24 + z*matrix.$matrix.m34;\r\n\r\n    if (!ignore_w && w !== 1 && w !== 0 && matrix.isPersp) {\r\n      this[0] /= w;\r\n      this[1] /= w;\r\n      this[2] /= w;\r\n    }\r\n    return w;\r\n  }\r\n\r\n  cross(v) {\r\n    var x = this[1]*v[2] - this[2]*v[1];\r\n    var y = this[2]*v[0] - this[0]*v[2];\r\n    var z = this[0]*v[1] - this[1]*v[0];\r\n\r\n    this[0] = x;\r\n    this[1] = y;\r\n    this[2] = z;\r\n\r\n    return this;\r\n  }\r\n\r\n  //axis is optional, 0\r\n  rot2d(A, axis) {\r\n    var x = this[0];\r\n    var y = this[1];\r\n\r\n    if (axis === 1) {\r\n      this[0] = x*cos(A) + y*sin(A);\r\n      this[1] = y*cos(A) - x*sin(A);\r\n    } else {\r\n      this[0] = x*cos(A) - y*sin(A);\r\n      this[1] = y*cos(A) + x*sin(A);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  preNormalizedAngle(v2) {\r\n    let th = this.dot(v2)*0.99999;\r\n    return Math.acos(th);\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    if (typeof this.vec !== \"undefined\") {\r\n      this.load(this.vec);\r\n      this.vec = undefined;\r\n    }\r\n  }\r\n}\r\n\r\nVector3.STRUCT = `\r\nvec3 {\r\n  0 : float;\r\n  1 : float;\r\n  2 : float;\r\n}\r\n`;\r\nnstructjs.manager.add_class(Vector3);\r\n\r\nexport class Vector2 extends BaseVector {\r\n  constructor(data) {\r\n    super(2);\r\n\r\n    if (arguments.length > 1) {\r\n      throw new Error(\"unexpected argument\");\r\n    }\r\n\r\n    this[0] = this[1] = 0.0;\r\n\r\n    if (data !== undefined) {\r\n      this.load(data);\r\n    }\r\n  }\r\n\r\n  initVector2(co) {\r\n    this.length = 2;\r\n\r\n    if (co !== undefined) {\r\n      this[0] = co[0];\r\n      this[1] = co[1];\r\n    } else {\r\n      this[0] = this[1] = 0.0;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  loadXY(x, y) {\r\n    this[0] = x;\r\n    this[1] = y;\r\n\r\n    return this;\r\n  }\r\n\r\n  toJSON() {\r\n    return [this[0], this[1]];\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    return this.load(obj);\r\n  }\r\n\r\n  loadXY(x, y) {\r\n    this[0] = x;\r\n    this[1] = y;\r\n\r\n    return this;\r\n  }\r\n\r\n  load(data) {\r\n    if (data === undefined)\r\n      return this;\r\n\r\n    this[0] = data[0];\r\n    this[1] = data[1];\r\n\r\n    return this;\r\n  }\r\n\r\n  //axis is optional, 0\r\n  rot2d(A, axis) {\r\n    var x = this[0];\r\n    var y = this[1];\r\n\r\n    if (axis === 1) {\r\n      this[0] = x*cos(A) + y*sin(A);\r\n      this[1] = y*cos(A) - x*sin(A);\r\n    } else {\r\n      this[0] = x*cos(A) - y*sin(A);\r\n      this[1] = y*cos(A) + x*sin(A);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  dot(b) {\r\n    return this[0]*b[0] + this[1]*b[1];\r\n  }\r\n\r\n  multVecMatrix(matrix) {\r\n    var x = this[0];\r\n    var y = this[1];\r\n\r\n    var w = 1.0;\r\n\r\n    this[0] = w*matrix.$matrix.m41 + x*matrix.$matrix.m11 + y*matrix.$matrix.m21;\r\n    this[1] = w*matrix.$matrix.m42 + x*matrix.$matrix.m12 + y*matrix.$matrix.m22;\r\n\r\n    if (matrix.isPersp) {\r\n      let w2 = w*matrix.$matrix.m44 + x*matrix.$matrix.m14 + y*matrix.$matrix.m24;\r\n\r\n      if (w2  !==  0.0) {\r\n        this[0] /= w2;\r\n        this[1] /= w2;\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  mulVecQuat(q) {\r\n    let t0 = -q[1] * this[0] - q[2] * this[1];\r\n    let t1 = q[0] * this[0] - q[3] * this[1];\r\n    let t2 = q[0] * this[1] + q[3] * this[0];\r\n\r\n    let z  = q[1] * this[1] - q[2] * this[0];\r\n    this[0] = t1;\r\n    this[1] = t2;\r\n\r\n    t1 = t0 * -q[1] + this[0] * q[0] - this[1] * q[3] + z * q[2];\r\n    t2 = t0 * -q[2] + this[1] * q[0] - z * q[1] + this[0] * q[3];\r\n\r\n    this[0] = t1;\r\n    this[1] = t2;\r\n\r\n    return this;\r\n  }\r\n\r\n  vectorLengthSqr() {\r\n    return this.dot(this);\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    if (typeof this.vec !== undefined) {\r\n      this.load(this.vec);\r\n      this.vec = undefined;\r\n    }\r\n  }\r\n};\r\nVector2.STRUCT = `\r\nvec2 {\r\n  0 : float;\r\n  1 : float;\r\n}\r\n`;\r\nnstructjs.manager.add_class(Vector2);\r\n\r\nlet _quat_vs3_temps = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport class Quat extends Vector4 {\r\n  makeUnitQuat() {\r\n    this[0] = 1.0;\r\n    this[1] = this[2] = this[3] = 0.0;\r\n  }\r\n\r\n  isZero() {\r\n    return (this[0] === 0 && this[1] === 0 && this[2] === 0 && this[3] === 0);\r\n  }\r\n\r\n  mulQuat(qt) {\r\n    var a = this[0]*qt[0] - this[1]*qt[1] - this[2]*qt[2] - this[3]*qt[3];\r\n    var b = this[0]*qt[1] + this[1]*qt[0] + this[2]*qt[3] - this[3]*qt[2];\r\n    var c = this[0]*qt[2] + this[2]*qt[0] + this[3]*qt[1] - this[1]*qt[3];\r\n    this[3] = this[0]*qt[3] + this[3]*qt[0] + this[1]*qt[2] - this[2]*qt[1];\r\n    this[0] = a;\r\n    this[1] = b;\r\n    this[2] = c;\r\n  }\r\n\r\n  conjugate() {\r\n    this[1] = -this[1];\r\n    this[2] = -this[2];\r\n    this[3] = -this[3];\r\n  }\r\n\r\n  dotWithQuat(q2) {\r\n    return this[0]*q2[0] + this[1]*q2[1] + this[2]*q2[2] + this[3]*q2[3];\r\n  }\r\n\r\n  invert() {\r\n    var f = this.dot(this);\r\n\r\n    if (f === 0.0)\r\n      return;\r\n\r\n    conjugate_qt(q);\r\n    this.mulscalar(1.0/f);\r\n  }\r\n\r\n  sub(q2) {\r\n    var nq2 = new Quat();\r\n\r\n    nq2[0] = -q2[0];\r\n    nq2[1] = q2[1];\r\n    nq2[2] = q2[2];\r\n    nq2[3] = q2[3];\r\n\r\n    this.mul(nq2);\r\n  }\r\n\r\n  mulScalarWithFactor(fac) {\r\n    var angle = fac*bounded_acos(this[0]);\r\n    var co = Math.cos(angle);\r\n    var si = Math.sin(angle);\r\n\r\n    this[0] = co;\r\n\r\n    var last3 = Vector3([this[1], this[2], this[3]]);\r\n    last3.normalize();\r\n    last3.mulScalar(si);\r\n    this[1] = last3[0];\r\n    this[2] = last3[1];\r\n    this[3] = last3[2];\r\n    return this;\r\n  }\r\n\r\n  toMatrix(m) {\r\n    if (m === undefined) {\r\n      m = new Matrix4();\r\n    }\r\n\r\n    var q0 = M_SQRT2*this[0];\r\n    var q1 = M_SQRT2*this[1];\r\n    var q2 = M_SQRT2*this[2];\r\n    var q3 = M_SQRT2*this[3];\r\n    var qda = q0*q1;\r\n    var qdb = q0*q2;\r\n    var qdc = q0*q3;\r\n    var qaa = q1*q1;\r\n    var qab = q1*q2;\r\n    var qac = q1*q3;\r\n    var qbb = q2*q2;\r\n    var qbc = q2*q3;\r\n    var qcc = q3*q3;\r\n    m.$matrix.m11 = (1.0 - qbb - qcc);\r\n    m.$matrix.m12 = (qdc + qab);\r\n    m.$matrix.m13 = (-qdb + qac);\r\n    m.$matrix.m14 = 0.0;\r\n    m.$matrix.m21 = (-qdc + qab);\r\n    m.$matrix.m22 = (1.0 - qaa - qcc);\r\n    m.$matrix.m23 = (qda + qbc);\r\n    m.$matrix.m24 = 0.0;\r\n    m.$matrix.m31 = (qdb + qac);\r\n    m.$matrix.m32 = (-qda + qbc);\r\n    m.$matrix.m33 = (1.0 - qaa - qbb);\r\n    m.$matrix.m34 = 0.0;\r\n    m.$matrix.m41 = m.$matrix.m42 = m.$matrix.m43 = 0.0;\r\n    m.$matrix.m44 = 1.0;\r\n\r\n    return m;\r\n  }\r\n\r\n  matrixToQuat(wmat) {\r\n    var mat = temp_mats.next();\r\n    mat.load(wmat);\r\n\r\n    mat.$matrix.m41 = mat.$matrix.m42 = mat.$matrix.m43 = 0;\r\n    mat.$matrix.m44 = 1.0;\r\n\r\n    var r1 = new Vector3([mat.$matrix.m11, mat.$matrix.m12, mat.$matrix.m13]);\r\n    var r2 = new Vector3([mat.$matrix.m21, mat.$matrix.m22, mat.$matrix.m23]);\r\n    var r3 = new Vector3([mat.$matrix.m31, mat.$matrix.m32, mat.$matrix.m33]);\r\n\r\n    r1.normalize();\r\n    r2.normalize();\r\n    r3.normalize();\r\n\r\n    mat.$matrix.m11 = r1[0];\r\n    mat.$matrix.m12 = r1[1];\r\n    mat.$matrix.m13 = r1[2];\r\n    mat.$matrix.m21 = r2[0];\r\n    mat.$matrix.m22 = r2[1];\r\n    mat.$matrix.m23 = r2[2];\r\n    mat.$matrix.m31 = r3[0];\r\n    mat.$matrix.m32 = r3[1];\r\n    mat.$matrix.m33 = r3[2];\r\n    var tr = 0.25*(1.0 + mat.$matrix.m11 + mat.$matrix.m22 + mat.$matrix.m33);\r\n    var s = 0;\r\n    if (tr > FLT_EPSILON) {\r\n      s = Math.sqrt(tr);\r\n      this[0] = s;\r\n      s = 1.0/(4.0*s);\r\n      this[1] = ((mat.$matrix.m23 - mat.$matrix.m32)*s);\r\n      this[2] = ((mat.$matrix.m31 - mat.$matrix.m13)*s);\r\n      this[3] = ((mat.$matrix.m12 - mat.$matrix.m21)*s);\r\n    } else {\r\n      if (mat.$matrix.m11 > mat.$matrix.m22 && mat.$matrix.m11 > mat.$matrix.m33) {\r\n        s = 2.0*Math.sqrt(1.0 + mat.$matrix.m11 - mat.$matrix.m22 - mat.$matrix.m33);\r\n        this[1] = (0.25*s);\r\n        s = 1.0/s;\r\n        this[0] = ((mat.$matrix.m32 - mat.$matrix.m23)*s);\r\n        this[2] = ((mat.$matrix.m21 + mat.$matrix.m12)*s);\r\n        this[3] = ((mat.$matrix.m31 + mat.$matrix.m13)*s);\r\n      } else if (mat.$matrix.m22 > mat.$matrix.m33) {\r\n        s = 2.0*Math.sqrt(1.0 + mat.$matrix.m22 - mat.$matrix.m11 - mat.$matrix.m33);\r\n        this[2] = (0.25*s);\r\n        s = 1.0/s;\r\n        this[0] = ((mat.$matrix.m31 - mat.$matrix.m13)*s);\r\n        this[1] = ((mat.$matrix.m21 + mat.$matrix.m12)*s);\r\n        this[3] = ((mat.$matrix.m32 + mat.$matrix.m23)*s);\r\n      } else {\r\n        s = 2.0*Math.sqrt(1.0 + mat.$matrix.m33 - mat.$matrix.m11 - mat.$matrix.m22);\r\n        this[3] = (0.25*s);\r\n        s = 1.0/s;\r\n        this[0] = ((mat.$matrix.m21 - mat.$matrix.m12)*s);\r\n        this[1] = ((mat.$matrix.m31 + mat.$matrix.m13)*s);\r\n        this[2] = ((mat.$matrix.m32 + mat.$matrix.m23)*s);\r\n      }\r\n    }\r\n    this.normalize();\r\n  }\r\n\r\n  normalize() {\r\n    var len = Math.sqrt(this.dot(this));\r\n\r\n    if (len !== 0.0) {\r\n      this.mulScalar(1.0/len);\r\n    } else {\r\n      this[1] = 1.0;\r\n      this[0] = this[2] = this[3] = 0.0;\r\n    }\r\n    return this;\r\n  }\r\n\r\n  axisAngleToQuat(axis, angle) {\r\n    let nor = _quat_vs3_temps.next().load(axis);\r\n    nor.normalize();\r\n\r\n    if (nor.dot(nor) !== 0.0) {\r\n      var phi = angle/2.0;\r\n      var si = Math.sin(phi);\r\n      this[0] = Math.cos(phi);\r\n      this[1] = nor[0]*si;\r\n      this[2] = nor[1]*si;\r\n      this[3] = nor[2]*si;\r\n    } else {\r\n      this.makeUnitQuat();\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  rotationBetweenVecs(v1, v2, fac = 1.0) {\r\n    v1 = new Vector3(v1);\r\n    v2 = new Vector3(v2);\r\n    v1.normalize();\r\n    v2.normalize();\r\n\r\n    if (Math.abs(v1.dot(v2)) > 0.9999) {\r\n      this.makeUnitQuat();\r\n      return this;\r\n    }\r\n\r\n    let axis = new Vector3(v1);\r\n    axis.cross(v2);\r\n\r\n    let angle = v1.preNormalizedAngle(v2)*fac;\r\n\r\n    this.axisAngleToQuat(axis, angle);\r\n\r\n    return this;\r\n  }\r\n\r\n  quatInterp(quat2, t) {\r\n    let quat = new Quat();\r\n    let cosom = this[0]*quat2[0] + this[1]*quat2[1] + this[2]*quat2[2] + this[3]*quat2[3];\r\n    if (cosom < 0.0) {\r\n      cosom = -cosom;\r\n      quat[0] = -this[0];\r\n      quat[1] = -this[1];\r\n      quat[2] = -this[2];\r\n      quat[3] = -this[3];\r\n    } else {\r\n      quat[0] = this[0];\r\n      quat[1] = this[1];\r\n      quat[2] = this[2];\r\n      quat[3] = this[3];\r\n    }\r\n\r\n    let omega, sinom, sc1, sc2;\r\n    if ((1.0 - cosom) > 0.0001) {\r\n      omega = Math.acos(cosom);\r\n      sinom = Math.sin(omega);\r\n      sc1 = Math.sin((1.0 - t)*omega)/sinom;\r\n      sc2 = Math.sin(t*omega)/sinom;\r\n    } else {\r\n      sc1 = 1.0 - t;\r\n      sc2 = t;\r\n    }\r\n    this[0] = sc1*quat[0] + sc2*quat2[0];\r\n    this[1] = sc1*quat[1] + sc2*quat2[1];\r\n    this[2] = sc1*quat[2] + sc2*quat2[2];\r\n    this[3] = sc1*quat[3] + sc2*quat2[3];\r\n\r\n    return this;\r\n  }\r\n};\r\n\r\nQuat.STRUCT = nstructjs.inherit(Quat, Vector4, 'quat') + `\r\n}\r\n`;\r\nnstructjs.register(Quat);\r\n\r\n_v3nd4_n1_normalizedDot4 = new Vector3();\r\n_v3nd4_n2_normalizedDot4 = new Vector3();\r\n_v3nd_n1_normalizedDot = new Vector3();\r\n_v3nd_n2_normalizedDot = new Vector3();\r\n\r\nBaseVector.inherit(Vector4, 4);\r\nF64BaseVector.inherit(Vector3, 3);\r\nBaseVector.inherit(Vector2, 2);\r\n\r\nlookat_cache_vs3 = util.cachering.fromConstructor(Vector3, 64);\r\nlookat_cache_vs4 = util.cachering.fromConstructor(Vector4, 64);\r\n\r\nmakenormalcache = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nvar $_v3nd_n1_normalizedDot = new Vector3();\r\nvar $_v3nd_n2_normalizedDot = new Vector3();\r\nvar $_v3nd4_n1_normalizedDot4 = new Vector3();\r\nvar $_v3nd4_n2_normalizedDot4 = new Vector3();\r\nvar $_v3nd4_n1_normalizedDot3 = new Vector3();\r\nvar $_v3nd4_n2_normalizedDot3 = new Vector3();\r\n\r\nvar M_SQRT2 = Math.sqrt(2.0);\r\nvar FLT_EPSILON = 2.22e-16;\r\n\r\nclass internal_matrix {\r\n  constructor() {\r\n    this.m11 = 1.0;\r\n    this.m12 = 0.0;\r\n    this.m13 = 0.0;\r\n    this.m14 = 0.0;\r\n    this.m21 = 0.0;\r\n    this.m22 = 1.0;\r\n    this.m23 = 0.0;\r\n    this.m24 = 0.0;\r\n    this.m31 = 0.0;\r\n    this.m32 = 0.0;\r\n    this.m33 = 1.0;\r\n    this.m34 = 0.0;\r\n    this.m41 = 0.0;\r\n    this.m42 = 0.0;\r\n    this.m43 = 0.0;\r\n    this.m44 = 1.0;\r\n  }\r\n}\r\n\r\nvar lookat_cache_vs3;\r\nvar lookat_cache_vs4;\r\nvar lookat_cache_ms;\r\nvar euler_rotate_mats;\r\nvar makenormalcache;\r\nvar temp_mats;\r\n\r\nlet preMultTemp;\r\n\r\nexport class Matrix4 {\r\n  constructor(m) {\r\n    this.$matrix = new internal_matrix();\r\n    this.isPersp = false;\r\n\r\n    if (typeof m === 'object') {\r\n      if (\"length\" in m && m.length >= 16) {\r\n        this.load(m);\r\n      } else if (m instanceof Matrix4) {\r\n        this.load(m);\r\n      }\r\n    }\r\n  }\r\n\r\n  static fromJSON() {\r\n    var mat = new Matrix4();\r\n    mat.load(json.items);\r\n    mat.isPersp = json.isPersp;\r\n    return mat;\r\n  }\r\n\r\n  copy() {\r\n    return this.clone();\r\n  }\r\n\r\n  clone() {\r\n    return new Matrix4(this);\r\n  }\r\n\r\n  addToHashDigest(hash) {\r\n    let m = this.$matrix;\r\n\r\n    hash.add(m.m11);\r\n    hash.add(m.m12);\r\n    hash.add(m.m13);\r\n    hash.add(m.m14);\r\n\r\n    hash.add(m.m21);\r\n    hash.add(m.m22);\r\n    hash.add(m.m23);\r\n    hash.add(m.m24);\r\n\r\n    hash.add(m.m31);\r\n    hash.add(m.m32);\r\n    hash.add(m.m33);\r\n    hash.add(m.m34);\r\n\r\n    hash.add(m.m41);\r\n    hash.add(m.m42);\r\n    hash.add(m.m43);\r\n    hash.add(m.m44);\r\n\r\n    return this;\r\n  }\r\n\r\n  equals(m) {\r\n    let m1 = this.$matrix;\r\n    let m2 = m.$matrix;\r\n\r\n    let ok = 1;\r\n\r\n    ok = ok && m1.m11 === m2.m11;\r\n    ok = ok && m1.m12 === m2.m12;\r\n    ok = ok && m1.m13 === m2.m13;\r\n    ok = ok && m1.m14 === m2.m14;\r\n\r\n    ok = ok && m1.m21 === m2.m21;\r\n    ok = ok && m1.m22 === m2.m22;\r\n    ok = ok && m1.m23 === m2.m23;\r\n    ok = ok && m1.m24 === m2.m24;\r\n\r\n    ok = ok && m1.m31 === m2.m31;\r\n    ok = ok && m1.m32 === m2.m32;\r\n    ok = ok && m1.m33 === m2.m33;\r\n    ok = ok && m1.m34 === m2.m34;\r\n\r\n    ok = ok && m1.m41 === m2.m41;\r\n    ok = ok && m1.m42 === m2.m42;\r\n    ok = ok && m1.m43 === m2.m43;\r\n    ok = ok && m1.m44 === m2.m44;\r\n\r\n    return ok;\r\n  }\r\n\r\n  loadColumn(i, vec) {\r\n    let m = this.$matrix;\r\n    let have4 = vec.length > 3;\r\n\r\n    switch (i) {\r\n      case 0:\r\n        m.m11 = vec[0];\r\n        m.m21 = vec[1];\r\n        m.m31 = vec[2];\r\n        if (have4) {\r\n          m.m41 = vec[3];\r\n        }\r\n        break;\r\n      case 1:\r\n        m.m12 = vec[0];\r\n        m.m22 = vec[1];\r\n        m.m32 = vec[2];\r\n        if (have4) {\r\n          m.m42 = vec[3];\r\n        }\r\n        break;\r\n      case 2:\r\n        m.m13 = vec[0];\r\n        m.m23 = vec[1];\r\n        m.m33 = vec[2];\r\n        if (have4) {\r\n          m.m43 = vec[3];\r\n        }\r\n        break;\r\n      case 3:\r\n        m.m14 = vec[0];\r\n        m.m24 = vec[1];\r\n        m.m34 = vec[2];\r\n        if (have4) {\r\n          m.m44 = vec[3];\r\n        }\r\n        break;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  copyColumnTo(i, vec) {\r\n    let m = this.$matrix;\r\n    let have4 = vec.length > 3;\r\n\r\n    switch (i) {\r\n      case 0:\r\n        vec[0] = m.m11;\r\n        vec[1] = m.m21;\r\n        vec[2] = m.m31;\r\n        if (have4) {\r\n          vec[3] = m.m41;\r\n        }\r\n        break;\r\n      case 1:\r\n        vec[0] = m.m12;\r\n        vec[1] = m.m22;\r\n        vec[2] = m.m32;\r\n        if (have4) {\r\n          vec[3] = m.m42;\r\n        }\r\n        break;\r\n      case 2:\r\n        vec[0] = m.m13;\r\n        vec[1] = m.m23;\r\n        vec[2] = m.m33;\r\n        if (have4) {\r\n          vec[3] = m.m43;\r\n        }\r\n        break;\r\n      case 3:\r\n        vec[0] = m.m14;\r\n        vec[1] = m.m24;\r\n        vec[2] = m.m34;\r\n        if (have4) {\r\n          vec[3] = m.m44;\r\n        }\r\n        break;\r\n    }\r\n\r\n    return vec;\r\n  }\r\n\r\n  copyColumn(i) {\r\n    return this.copyColumnTo(i, new Vector3());\r\n  }\r\n\r\n  load() {\r\n    if (arguments.length === 1 && typeof arguments[0] === 'object') {\r\n      var matrix;\r\n      if (arguments[0] instanceof Matrix4) {\r\n        matrix = arguments[0].$matrix;\r\n        this.isPersp = arguments[0].isPersp;\r\n        this.$matrix.m11 = matrix.m11;\r\n        this.$matrix.m12 = matrix.m12;\r\n        this.$matrix.m13 = matrix.m13;\r\n        this.$matrix.m14 = matrix.m14;\r\n        this.$matrix.m21 = matrix.m21;\r\n        this.$matrix.m22 = matrix.m22;\r\n        this.$matrix.m23 = matrix.m23;\r\n        this.$matrix.m24 = matrix.m24;\r\n        this.$matrix.m31 = matrix.m31;\r\n        this.$matrix.m32 = matrix.m32;\r\n        this.$matrix.m33 = matrix.m33;\r\n        this.$matrix.m34 = matrix.m34;\r\n        this.$matrix.m41 = matrix.m41;\r\n        this.$matrix.m42 = matrix.m42;\r\n        this.$matrix.m43 = matrix.m43;\r\n        this.$matrix.m44 = matrix.m44;\r\n        return this;\r\n      } else\r\n        matrix = arguments[0];\r\n      if (\"length\" in matrix && matrix.length >= 16) {\r\n        this.$matrix.m11 = matrix[0];\r\n        this.$matrix.m12 = matrix[1];\r\n        this.$matrix.m13 = matrix[2];\r\n        this.$matrix.m14 = matrix[3];\r\n        this.$matrix.m21 = matrix[4];\r\n        this.$matrix.m22 = matrix[5];\r\n        this.$matrix.m23 = matrix[6];\r\n        this.$matrix.m24 = matrix[7];\r\n        this.$matrix.m31 = matrix[8];\r\n        this.$matrix.m32 = matrix[9];\r\n        this.$matrix.m33 = matrix[10];\r\n        this.$matrix.m34 = matrix[11];\r\n        this.$matrix.m41 = matrix[12];\r\n        this.$matrix.m42 = matrix[13];\r\n        this.$matrix.m43 = matrix[14];\r\n        this.$matrix.m44 = matrix[15];\r\n        return this;\r\n      }\r\n    }\r\n\r\n    this.makeIdentity();\r\n\r\n    return this;\r\n  }\r\n\r\n  toJSON() {\r\n    return {isPersp: this.isPersp, items: this.getAsArray()}\r\n  }\r\n\r\n  getAsArray() {\r\n    return [this.$matrix.m11, this.$matrix.m12, this.$matrix.m13, this.$matrix.m14, this.$matrix.m21, this.$matrix.m22,\r\n            this.$matrix.m23, this.$matrix.m24, this.$matrix.m31, this.$matrix.m32, this.$matrix.m33, this.$matrix.m34,\r\n            this.$matrix.m41, this.$matrix.m42, this.$matrix.m43, this.$matrix.m44];\r\n  }\r\n\r\n  getAsFloat32Array() {\r\n    return new Float32Array(this.getAsArray());\r\n  }\r\n\r\n  setUniform(ctx, loc, transpose) {\r\n    if (Matrix4.setUniformArray === undefined) {\r\n      Matrix4.setUniformWebGLArray = new Float32Array(16);\r\n      Matrix4.setUniformArray = new Array(16);\r\n    }\r\n\r\n    Matrix4.setUniformArray[0] = this.$matrix.m11;\r\n    Matrix4.setUniformArray[1] = this.$matrix.m12;\r\n    Matrix4.setUniformArray[2] = this.$matrix.m13;\r\n    Matrix4.setUniformArray[3] = this.$matrix.m14;\r\n    Matrix4.setUniformArray[4] = this.$matrix.m21;\r\n    Matrix4.setUniformArray[5] = this.$matrix.m22;\r\n    Matrix4.setUniformArray[6] = this.$matrix.m23;\r\n    Matrix4.setUniformArray[7] = this.$matrix.m24;\r\n    Matrix4.setUniformArray[8] = this.$matrix.m31;\r\n    Matrix4.setUniformArray[9] = this.$matrix.m32;\r\n    Matrix4.setUniformArray[10] = this.$matrix.m33;\r\n    Matrix4.setUniformArray[11] = this.$matrix.m34;\r\n    Matrix4.setUniformArray[12] = this.$matrix.m41;\r\n    Matrix4.setUniformArray[13] = this.$matrix.m42;\r\n    Matrix4.setUniformArray[14] = this.$matrix.m43;\r\n    Matrix4.setUniformArray[15] = this.$matrix.m44;\r\n\r\n    Matrix4.setUniformWebGLArray.set(Matrix4.setUniformArray);\r\n\r\n    ctx.uniformMatrix4fv(loc, transpose, Matrix4.setUniformWebGLArray);\r\n\r\n    return this;\r\n  }\r\n\r\n  makeIdentity() {\r\n    this.$matrix.m11 = 1;\r\n    this.$matrix.m12 = 0;\r\n    this.$matrix.m13 = 0;\r\n    this.$matrix.m14 = 0;\r\n    this.$matrix.m21 = 0;\r\n    this.$matrix.m22 = 1;\r\n    this.$matrix.m23 = 0;\r\n    this.$matrix.m24 = 0;\r\n    this.$matrix.m31 = 0;\r\n    this.$matrix.m32 = 0;\r\n    this.$matrix.m33 = 1;\r\n    this.$matrix.m34 = 0;\r\n    this.$matrix.m41 = 0;\r\n    this.$matrix.m42 = 0;\r\n    this.$matrix.m43 = 0;\r\n    this.$matrix.m44 = 1;\r\n\r\n    //drop isPersp\r\n    this.isPersp = false;\r\n\r\n    return this;\r\n  }\r\n\r\n  transpose() {\r\n    var tmp = this.$matrix.m12;\r\n    this.$matrix.m12 = this.$matrix.m21;\r\n    this.$matrix.m21 = tmp;\r\n    tmp = this.$matrix.m13;\r\n    this.$matrix.m13 = this.$matrix.m31;\r\n    this.$matrix.m31 = tmp;\r\n    tmp = this.$matrix.m14;\r\n    this.$matrix.m14 = this.$matrix.m41;\r\n    this.$matrix.m41 = tmp;\r\n    tmp = this.$matrix.m23;\r\n    this.$matrix.m23 = this.$matrix.m32;\r\n    this.$matrix.m32 = tmp;\r\n    tmp = this.$matrix.m24;\r\n    this.$matrix.m24 = this.$matrix.m42;\r\n    this.$matrix.m42 = tmp;\r\n    tmp = this.$matrix.m34;\r\n    this.$matrix.m34 = this.$matrix.m43;\r\n    this.$matrix.m43 = tmp;\r\n\r\n    return this;\r\n  }\r\n\r\n  determinant() {\r\n    return this._determinant4x4();\r\n  }\r\n\r\n  invert() {\r\n    var det = this._determinant4x4();\r\n\r\n    if (Math.abs(det) < 1e-08)\r\n      return null;\r\n\r\n    this._makeAdjoint();\r\n\r\n    this.$matrix.m11 /= det;\r\n    this.$matrix.m12 /= det;\r\n    this.$matrix.m13 /= det;\r\n    this.$matrix.m14 /= det;\r\n    this.$matrix.m21 /= det;\r\n    this.$matrix.m22 /= det;\r\n    this.$matrix.m23 /= det;\r\n    this.$matrix.m24 /= det;\r\n    this.$matrix.m31 /= det;\r\n    this.$matrix.m32 /= det;\r\n    this.$matrix.m33 /= det;\r\n    this.$matrix.m34 /= det;\r\n    this.$matrix.m41 /= det;\r\n    this.$matrix.m42 /= det;\r\n    this.$matrix.m43 /= det;\r\n    this.$matrix.m44 /= det;\r\n\r\n    return this;\r\n  }\r\n\r\n  translate(x, y, z) {\r\n    if (typeof x === 'object' && \"length\" in x) {\r\n      var t = x;\r\n\r\n      x = t[0];\r\n      y = t[1];\r\n      z = t[2];\r\n    }\r\n\r\n    x = x === undefined ? 0 : x;\r\n    y = y === undefined ? 0 : y;\r\n    z = z === undefined ? 0 : z;\r\n\r\n    var matrix = temp_mats.next().makeIdentity();\r\n\r\n    matrix.$matrix.m41 = x;\r\n    matrix.$matrix.m42 = y;\r\n    matrix.$matrix.m43 = z;\r\n\r\n    this.multiply(matrix);\r\n    return this;\r\n  }\r\n\r\n  preTranslate(x, y, z) {\r\n    if (typeof x === 'object' && \"length\" in x) {\r\n      var t = x;\r\n\r\n      x = t[0];\r\n      y = t[1];\r\n      z = t[2];\r\n    }\r\n\r\n    x = x === undefined ? 0 : x;\r\n    y = y === undefined ? 0 : y;\r\n    z = z === undefined ? 0 : z;\r\n\r\n    var matrix = temp_mats.next().makeIdentity();\r\n\r\n    matrix.$matrix.m41 = x;\r\n    matrix.$matrix.m42 = y;\r\n    matrix.$matrix.m43 = z;\r\n\r\n    this.preMultiply(matrix);\r\n    return this;\r\n  }\r\n\r\n  scale(x, y, z, w = 1.0) {\r\n    if (typeof x === 'object' && \"length\" in x) {\r\n      var t = x;\r\n      x = t[0];\r\n      y = t[1];\r\n      z = t[2];\r\n    } else {\r\n      if (x === undefined)\r\n        x = 1;\r\n\r\n      if (z === undefined) {\r\n        if (y === undefined) {\r\n          y = x;\r\n          z = x;\r\n        } else {\r\n          z = x;\r\n        }\r\n      } else if (y === undefined) {\r\n        y = x;\r\n      }\r\n    }\r\n\r\n\r\n    var matrix = temp_mats.next().makeIdentity();\r\n    matrix.$matrix.m11 = x;\r\n    matrix.$matrix.m22 = y;\r\n    matrix.$matrix.m33 = z;\r\n    matrix.$matrix.m44 = w;\r\n    this.multiply(matrix);\r\n    return this\r\n  }\r\n\r\n  preScale(x, y, z, w = 1.0) {\r\n    let mat = temp_mats.next().makeIdentity();\r\n    mat.scale(x, y, z, w);\r\n\r\n    this.preMultiply(mat);\r\n    return this\r\n  }\r\n\r\n  /*\r\n  on factor;\r\n  off period;\r\n\r\n  c1 := cx; comment: cos(thx);\r\n  s1 := sx; comment: sin(thx);\r\n\r\n  c2 := cy; comment: cos(thy);\r\n  s2 := sy; comment: sin(thy);\r\n\r\n  c3 := cz; comment: cos(thz);\r\n  s3 := sz; comment: sin(thz);\r\n\r\n  cx := cos(thx);\r\n  sx := sin(thx);\r\n  cy := cos(thy);\r\n  sy := sin(thy);\r\n  cz := cos(thz);\r\n  sz := sin(thz);\r\n\r\n  imat := mat((1, 0, 0, 0),\r\n              (0, 1, 0, 0),\r\n              (0, 0, 1, 0),\r\n              (0, 0, 0, 1));\r\n\r\n  xmat :=mat((1,  0,  0,  0),\r\n             (0, c1, -s1, 0),\r\n             (0, s1,  c1, 0),\r\n             (0,  0,  0,  0));\r\n\r\n  ymat :=mat((c2, 0, s2, 0),\r\n             (0,  1,  0,  0),\r\n             (-s2, 0,  c2, 0),\r\n             (0,  0,  0,  0));\r\n\r\n  zmat :=mat(( c3, -s3, 0, 0),\r\n             (s3, c3, 0, 0),\r\n             ( 0,  0,  1, 0),\r\n             ( 0,  0,  0, 0));\r\n\r\n  mmat := mat((m11, m21, m31, 0),\r\n              (m12, m22, m32, 0),\r\n              (m13, m23, m33, 0),\r\n              (0,   0,   0,   0));\r\n\r\n  fmat := zmat * ymat * xmat;\r\n\r\n  f1 := m11**2 + m12**2 + m13**2 - 1.0;\r\n  f2 := m21**2 + m22**2 + m23**2 - 1.0;\r\n  f3 := m31**2 + m32**2 + m33**2 - 1.0;\r\n\r\n  tmat := fmat * mmat;\r\n  f1 := tmat(1, 1) - 1.0;\r\n  f2 := tmat(2, 2) - 1.0;\r\n  f3 := tmat(3, 3) - 1.0;\r\n\r\n  operator myasin;\r\n\r\n  fthy := asin(mmat(3, 1));\r\n  f1 := mmat(3,1)**2 + mmat(2,1)**2 + mmat(1,1)**2 = 1.0;\r\n\r\n  fmat2 := sub(thy=fthy, fmat);\r\n\r\n  fmat3 := fmat2 * (tp mmat);\r\n  ffz := solve(fmat2(1, 1) - m11, thz);\r\n  ffx := solve(fmat2(3, 3) - m33, thx);\r\n\r\n  fthz := part(ffz, 1, 2);\r\n  fthx := part(ffx, 1, 2);\r\n\r\n  sub(thx=fthx, thy=fthy, thz=fthz, fmat);\r\n\r\n(cos(thy)*cos(thz),         cos(thx)*sin(thz)-cos(thz)*sin(thx)*sin(thy),  -(cos(thx)*cos(thz)*sin(thy)+sin(thx)*sin(thz)), 0),\r\n\r\n(-cos(thy)*sin(thz),        cos(thx)*cos(thz) + sin(thx)*sin(thy)*sin(thz),  cos(thx)*sin(thy)*sin(thz)-cos(thz)*sin(thx), 0),\r\n\r\n(sin(thy),                  cos(thy)*sin(thx),                               cos(thx)*cos(thy),  0),\r\n\r\n    (0,0,0,1))\r\n\r\n  */\r\n\r\n  euler_rotate_order(x, y, z, order = EulerOrders.XYZ) {\r\n    if (y === undefined) {\r\n      y = 0.0;\r\n    }\r\n    if (z === undefined) {\r\n      z = 0.0;\r\n    }\r\n\r\n    x = -x;\r\n    y = -y;\r\n    z = -z;\r\n\r\n    let xmat = euler_rotate_mats.next().makeIdentity();\r\n\r\n    let m = xmat.$matrix;\r\n\r\n    let c = Math.cos(x), s = Math.sin(x);\r\n\r\n    m.m22 = c;\r\n    m.m23 = s;\r\n    m.m32 = -s;\r\n    m.m33 = c;\r\n\r\n    let ymat = euler_rotate_mats.next().makeIdentity();\r\n    c = Math.cos(y);\r\n    s = Math.sin(y);\r\n    m = ymat.$matrix;\r\n\r\n    m.m11 = c;\r\n    m.m13 = -s;\r\n    m.m31 = s;\r\n    m.m33 = c;\r\n\r\n    let zmat = euler_rotate_mats.next().makeIdentity();\r\n    c = Math.cos(z);\r\n    s = Math.sin(z);\r\n    m = zmat.$matrix;\r\n\r\n    m.m11 = c;\r\n    m.m12 = s;\r\n    m.m21 = -s;\r\n    m.m22 = c;\r\n\r\n    let a, b;\r\n\r\n    switch (order) {\r\n      case EulerOrders.XYZ:\r\n        a = xmat;\r\n        b = ymat;\r\n        c = zmat;\r\n        break;\r\n      case EulerOrders.XZY:\r\n        a = xmat;\r\n        b = zmat;\r\n        c = ymat;\r\n        break;\r\n      case EulerOrders.YXZ:\r\n        a = ymat;\r\n        b = xmat;\r\n        c = zmat;\r\n        break;\r\n      case EulerOrders.YZX:\r\n        a = ymat;\r\n        b = zmat;\r\n        c = xmat;\r\n        break;\r\n      case EulerOrders.ZXY:\r\n        a = zmat;\r\n        b = xmat;\r\n        c = ymat;\r\n        break;\r\n      case EulerOrders.ZYX:\r\n        a = zmat;\r\n        b = ymat;\r\n        c = xmat;\r\n        break;\r\n    }\r\n\r\n    b.preMultiply(c);\r\n    b.multiply(a);\r\n\r\n    this.preMultiply(b);\r\n\r\n    return this;\r\n  }\r\n\r\n  euler_rotate(x, y, z) {\r\n    if (y === undefined) {\r\n      y = 0.0;\r\n    }\r\n    if (z === undefined) {\r\n      z = 0.0;\r\n    }\r\n    window.Matrix4 = Matrix4;\r\n\r\n    var xmat = euler_rotate_mats.next().makeIdentity();\r\n    var m = xmat.$matrix;\r\n\r\n    var c = Math.cos(x), s = Math.sin(x);\r\n\r\n    m.m22 = c;\r\n    m.m23 = s;\r\n    m.m32 = -s;\r\n    m.m33 = c;\r\n\r\n    var ymat = euler_rotate_mats.next().makeIdentity();\r\n    c = Math.cos(y);\r\n    s = Math.sin(y);\r\n    var m = ymat.$matrix;\r\n\r\n    m.m11 = c;\r\n    m.m13 = -s;\r\n    m.m31 = s;\r\n    m.m33 = c;\r\n\r\n    ymat.multiply(xmat);\r\n\r\n    var zmat = euler_rotate_mats.next().makeIdentity();\r\n    c = Math.cos(z);\r\n    s = Math.sin(z);\r\n    var m = zmat.$matrix;\r\n\r\n    m.m11 = c;\r\n    m.m12 = s;\r\n    m.m21 = -s;\r\n    m.m22 = c;\r\n\r\n    zmat.multiply(ymat);\r\n\r\n    //console.log(\"\"+ymat);\r\n    //this.multiply(zmat);\r\n    this.preMultiply(zmat);\r\n\r\n    return this;\r\n  }\r\n\r\n  toString() {\r\n    var s = \"\"\r\n    var m = this.$matrix;\r\n\r\n    function dec(d) {\r\n      var ret = d.toFixed(3);\r\n\r\n      if (ret[0] !== \"-\") //make room for negative signs\r\n        ret = \" \" + ret\r\n      return ret\r\n    }\r\n\r\n    s = dec(m.m11) + \", \" + dec(m.m12) + \", \" + dec(m.m13) + \", \" + dec(m.m14) + \"\\n\";\r\n    s += dec(m.m21) + \", \" + dec(m.m22) + \", \" + dec(m.m23) + \", \" + dec(m.m24) + \"\\n\";\r\n    s += dec(m.m31) + \", \" + dec(m.m32) + \", \" + dec(m.m33) + \", \" + dec(m.m34) + \"\\n\";\r\n    s += dec(m.m41) + \", \" + dec(m.m42) + \", \" + dec(m.m43) + \", \" + dec(m.m44) + \"\\n\";\r\n\r\n    return s\r\n  }\r\n\r\n  rotate(angle, x, y, z) {\r\n    if (typeof x === 'object' && \"length\" in x) {\r\n      var t = x;\r\n      x = t[0];\r\n      y = t[1];\r\n      z = t[2];\r\n    } else {\r\n      if (arguments.length === 1) {\r\n        x = y = 0;\r\n        z = 1;\r\n      } else if (arguments.length === 3) {\r\n        this.rotate(angle, 1, 0, 0);\r\n        this.rotate(x, 0, 1, 0);\r\n        this.rotate(y, 0, 0, 1);\r\n        return;\r\n      }\r\n    }\r\n\r\n    angle /= 2;\r\n    var sinA = Math.sin(angle);\r\n    var cosA = Math.cos(angle);\r\n    var sinA2 = sinA*sinA;\r\n    var len = Math.sqrt(x*x + y*y + z*z);\r\n\r\n    if (len === 0) {\r\n      x = 0;\r\n      y = 0;\r\n      z = 1;\r\n    } else if (len !== 1) {\r\n      x /= len;\r\n      y /= len;\r\n      z /= len;\r\n    }\r\n\r\n    var mat = temp_mats.next().makeIdentity();\r\n\r\n    if (x === 1 && y === 0 && z === 0) {\r\n      mat.$matrix.m11 = 1;\r\n      mat.$matrix.m12 = 0;\r\n      mat.$matrix.m13 = 0;\r\n      mat.$matrix.m21 = 0;\r\n      mat.$matrix.m22 = 1 - 2*sinA2;\r\n      mat.$matrix.m23 = 2*sinA*cosA;\r\n      mat.$matrix.m31 = 0;\r\n      mat.$matrix.m32 = -2*sinA*cosA;\r\n      mat.$matrix.m33 = 1 - 2*sinA2;\r\n      mat.$matrix.m14 = mat.$matrix.m24 = mat.$matrix.m34 = 0;\r\n      mat.$matrix.m41 = mat.$matrix.m42 = mat.$matrix.m43 = 0;\r\n      mat.$matrix.m44 = 1;\r\n    } else if (x === 0 && y === 1 && z === 0) {\r\n      mat.$matrix.m11 = 1 - 2*sinA2;\r\n      mat.$matrix.m12 = 0;\r\n      mat.$matrix.m13 = -2*sinA*cosA;\r\n      mat.$matrix.m21 = 0;\r\n      mat.$matrix.m22 = 1;\r\n      mat.$matrix.m23 = 0;\r\n      mat.$matrix.m31 = 2*sinA*cosA;\r\n      mat.$matrix.m32 = 0;\r\n      mat.$matrix.m33 = 1 - 2*sinA2;\r\n      mat.$matrix.m14 = mat.$matrix.m24 = mat.$matrix.m34 = 0;\r\n      mat.$matrix.m41 = mat.$matrix.m42 = mat.$matrix.m43 = 0;\r\n      mat.$matrix.m44 = 1;\r\n    } else if (x === 0 && y === 0 && z === 1) {\r\n      mat.$matrix.m11 = 1 - 2*sinA2;\r\n      mat.$matrix.m12 = 2*sinA*cosA;\r\n      mat.$matrix.m13 = 0;\r\n      mat.$matrix.m21 = -2*sinA*cosA;\r\n      mat.$matrix.m22 = 1 - 2*sinA2;\r\n      mat.$matrix.m23 = 0;\r\n      mat.$matrix.m31 = 0;\r\n      mat.$matrix.m32 = 0;\r\n      mat.$matrix.m33 = 1;\r\n      mat.$matrix.m14 = mat.$matrix.m24 = mat.$matrix.m34 = 0;\r\n      mat.$matrix.m41 = mat.$matrix.m42 = mat.$matrix.m43 = 0;\r\n      mat.$matrix.m44 = 1;\r\n    } else {\r\n      var x2 = x*x;\r\n      var y2 = y*y;\r\n      var z2 = z*z;\r\n      mat.$matrix.m11 = 1 - 2*(y2 + z2)*sinA2;\r\n      mat.$matrix.m12 = 2*(x*y*sinA2 + z*sinA*cosA);\r\n      mat.$matrix.m13 = 2*(x*z*sinA2 - y*sinA*cosA);\r\n      mat.$matrix.m21 = 2*(y*x*sinA2 - z*sinA*cosA);\r\n      mat.$matrix.m22 = 1 - 2*(z2 + x2)*sinA2;\r\n      mat.$matrix.m23 = 2*(y*z*sinA2 + x*sinA*cosA);\r\n      mat.$matrix.m31 = 2*(z*x*sinA2 + y*sinA*cosA);\r\n      mat.$matrix.m32 = 2*(z*y*sinA2 - x*sinA*cosA);\r\n      mat.$matrix.m33 = 1 - 2*(x2 + y2)*sinA2;\r\n      mat.$matrix.m14 = mat.$matrix.m24 = mat.$matrix.m34 = 0;\r\n      mat.$matrix.m41 = mat.$matrix.m42 = mat.$matrix.m43 = 0;\r\n      mat.$matrix.m44 = 1;\r\n    }\r\n    this.multiply(mat);\r\n\r\n    return this;\r\n  }\r\n\r\n  normalize() {\r\n    let m = this.$matrix;\r\n\r\n    let v1 = new Vector4([m.m11, m.m12, m.m13, m.m14]);\r\n    let v2 = new Vector4([m.m21, m.m22, m.m23, m.m24]);\r\n    let v3 = new Vector4([m.m31, m.m32, m.m33, m.m34]);\r\n    let v4 = new Vector4([m.m41, m.m42, m.m43, m.m44]);\r\n\r\n    v1.normalize();\r\n    v2.normalize();\r\n    v3.normalize();\r\n\r\n    let flat = new Array().concat(v1).concat(v2).concat(v3).concat(v4);\r\n    this.load(flat);\r\n\r\n    return this;\r\n  }\r\n\r\n  clearTranslation(set_w_to_one = false) {\r\n    let m = this.$matrix;\r\n\r\n    m.m41 = m.m42 = m.m43 = 0.0;\r\n\r\n    if (set_w_to_one) {\r\n      m.m44 = 1.0;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  setTranslation(x, y, z, resetW = true) {\r\n    if (typeof x === \"object\") {\r\n      y = x[1];\r\n      z = x[2];\r\n      x = x[0];\r\n    }\r\n\r\n    let m = this.$matrix;\r\n\r\n    m.m41 = x;\r\n    m.m42 = y;\r\n    m.m43 = z;\r\n\r\n    if (resetW) {\r\n      m.m44 = 1.0;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  //this is really like the lookAt method, isn't it.\r\n  makeNormalMatrix(normal, up = undefined) {\r\n    if (normal === undefined) {\r\n      throw new Error(\"normal cannot be undefined\");\r\n    }\r\n\r\n    let n = makenormalcache.next().load(normal).normalize();\r\n\r\n    if (up === undefined) {\r\n      up = makenormalcache.next().zero();\r\n\r\n      if (Math.abs(n[2]) > 0.95) {\r\n        up[1] = 1.0;\r\n      } else {\r\n        up[2] = 1.0;\r\n      }\r\n    }\r\n\r\n    up = makenormalcache.next().load(up);\r\n\r\n    up.normalize();\r\n\r\n    if (up.dot(normal) > 0.99) {\r\n      this.makeIdentity();\r\n      return this;\r\n    } else if (up.dot(normal) < -0.99) {\r\n      this.makeIdentity();\r\n      this.scale(1.0, 1.0, -1.0);\r\n      return this;\r\n    }\r\n\r\n    let x = makenormalcache.next();\r\n    let y = makenormalcache.next();\r\n\r\n    x.load(n).cross(up).normalize();\r\n    y.load(x).cross(n).normalize();\r\n    //y.negate();\r\n\r\n    this.makeIdentity();\r\n    let m = this.$matrix;\r\n\r\n    m.m11 = x[0];\r\n    m.m12 = x[1];\r\n    m.m13 = x[2];\r\n\r\n    m.m21 = y[0];\r\n    m.m22 = y[1];\r\n    m.m23 = y[2];\r\n\r\n    m.m31 = n[0];\r\n    m.m32 = n[1];\r\n    m.m33 = n[2];\r\n    m.m44 = 1.0;\r\n\r\n    return this;\r\n  }\r\n\r\n  preMultiply(mat) {\r\n    preMultTemp.load(mat);\r\n    preMultTemp.multiply(this);\r\n\r\n    this.load(preMultTemp);\r\n\r\n    return this;\r\n  }\r\n\r\n  multiply(mat) {\r\n    let mm = this.$matrix;\r\n    let mm2 = mat.$matrix;\r\n\r\n    let m11 = (mm2.m11*mm.m11 + mm2.m12*mm.m21 + mm2.m13*mm.m31 + mm2.m14*mm.m41);\r\n    let m12 = (mm2.m11*mm.m12 + mm2.m12*mm.m22 + mm2.m13*mm.m32 + mm2.m14*mm.m42);\r\n    let m13 = (mm2.m11*mm.m13 + mm2.m12*mm.m23 + mm2.m13*mm.m33 + mm2.m14*mm.m43);\r\n    let m14 = (mm2.m11*mm.m14 + mm2.m12*mm.m24 + mm2.m13*mm.m34 + mm2.m14*mm.m44);\r\n    let m21 = (mm2.m21*mm.m11 + mm2.m22*mm.m21 + mm2.m23*mm.m31 + mm2.m24*mm.m41);\r\n    let m22 = (mm2.m21*mm.m12 + mm2.m22*mm.m22 + mm2.m23*mm.m32 + mm2.m24*mm.m42);\r\n    let m23 = (mm2.m21*mm.m13 + mm2.m22*mm.m23 + mm2.m23*mm.m33 + mm2.m24*mm.m43);\r\n    let m24 = (mm2.m21*mm.m14 + mm2.m22*mm.m24 + mm2.m23*mm.m34 + mm2.m24*mm.m44);\r\n    let m31 = (mm2.m31*mm.m11 + mm2.m32*mm.m21 + mm2.m33*mm.m31 + mm2.m34*mm.m41);\r\n    let m32 = (mm2.m31*mm.m12 + mm2.m32*mm.m22 + mm2.m33*mm.m32 + mm2.m34*mm.m42);\r\n    let m33 = (mm2.m31*mm.m13 + mm2.m32*mm.m23 + mm2.m33*mm.m33 + mm2.m34*mm.m43);\r\n    let m34 = (mm2.m31*mm.m14 + mm2.m32*mm.m24 + mm2.m33*mm.m34 + mm2.m34*mm.m44);\r\n    let m41 = (mm2.m41*mm.m11 + mm2.m42*mm.m21 + mm2.m43*mm.m31 + mm2.m44*mm.m41);\r\n    let m42 = (mm2.m41*mm.m12 + mm2.m42*mm.m22 + mm2.m43*mm.m32 + mm2.m44*mm.m42);\r\n    let m43 = (mm2.m41*mm.m13 + mm2.m42*mm.m23 + mm2.m43*mm.m33 + mm2.m44*mm.m43);\r\n    let m44 = (mm2.m41*mm.m14 + mm2.m42*mm.m24 + mm2.m43*mm.m34 + mm2.m44*mm.m44);\r\n\r\n    mm.m11 = m11;\r\n    mm.m12 = m12;\r\n    mm.m13 = m13;\r\n    mm.m14 = m14;\r\n    mm.m21 = m21;\r\n    mm.m22 = m22;\r\n    mm.m23 = m23;\r\n    mm.m24 = m24;\r\n    mm.m31 = m31;\r\n    mm.m32 = m32;\r\n    mm.m33 = m33;\r\n    mm.m34 = m34;\r\n    mm.m41 = m41;\r\n    mm.m42 = m42;\r\n    mm.m43 = m43;\r\n    mm.m44 = m44;\r\n\r\n    return this;\r\n  }\r\n\r\n  divide(divisor) {\r\n    this.$matrix.m11 /= divisor;\r\n    this.$matrix.m12 /= divisor;\r\n    this.$matrix.m13 /= divisor;\r\n    this.$matrix.m14 /= divisor;\r\n    this.$matrix.m21 /= divisor;\r\n    this.$matrix.m22 /= divisor;\r\n    this.$matrix.m23 /= divisor;\r\n    this.$matrix.m24 /= divisor;\r\n    this.$matrix.m31 /= divisor;\r\n    this.$matrix.m32 /= divisor;\r\n    this.$matrix.m33 /= divisor;\r\n    this.$matrix.m34 /= divisor;\r\n    this.$matrix.m41 /= divisor;\r\n    this.$matrix.m42 /= divisor;\r\n    this.$matrix.m43 /= divisor;\r\n    this.$matrix.m44 /= divisor;\r\n\r\n    return this;\r\n  }\r\n\r\n  ortho(left, right, bottom, top, near, far) {\r\n    console.warn(\"Matrix4.ortho() is deprecated, use .orthographic() instead\");\r\n\r\n    var tx = (left + right)/(left - right);\r\n    var ty = (top + bottom)/(top - bottom);\r\n    var tz = (far + near)/(far - near);\r\n    var matrix = temp_mats.next().makeIdentity();\r\n\r\n    matrix.$matrix.m11 = 2/(left - right);\r\n    matrix.$matrix.m12 = 0;\r\n    matrix.$matrix.m13 = 0;\r\n    matrix.$matrix.m14 = 0;\r\n    matrix.$matrix.m21 = 0;\r\n    matrix.$matrix.m22 = 2/(top - bottom);\r\n    matrix.$matrix.m23 = 0;\r\n    matrix.$matrix.m24 = 0;\r\n    matrix.$matrix.m31 = 0;\r\n    matrix.$matrix.m32 = 0;\r\n    matrix.$matrix.m33 = -2/(far - near);\r\n    matrix.$matrix.m34 = 0;\r\n    matrix.$matrix.m41 = tx;\r\n    matrix.$matrix.m42 = ty;\r\n    matrix.$matrix.m43 = tz;\r\n    matrix.$matrix.m44 = 1;\r\n\r\n    this.multiply(matrix);\r\n\r\n    return this;\r\n  }\r\n\r\n  frustum(left, right, bottom, top, near, far) {\r\n    var matrix = temp_mats.next().makeIdentity();\r\n\r\n    var A = (right + left)/(right - left);\r\n    var B = (top + bottom)/(top - bottom);\r\n    var C = -(far + near)/(far - near);\r\n    var D = -(2*far*near)/(far - near);\r\n\r\n    matrix.$matrix.m11 = (2*near)/(right - left);\r\n    matrix.$matrix.m12 = 0;\r\n    matrix.$matrix.m13 = 0;\r\n    matrix.$matrix.m14 = 0;\r\n    matrix.$matrix.m21 = 0;\r\n    matrix.$matrix.m22 = 2*near/(top - bottom);\r\n    matrix.$matrix.m23 = 0;\r\n    matrix.$matrix.m24 = 0;\r\n    matrix.$matrix.m31 = A;\r\n    matrix.$matrix.m32 = B;\r\n    matrix.$matrix.m33 = C;\r\n    matrix.$matrix.m34 = -1;\r\n    matrix.$matrix.m41 = 0;\r\n    matrix.$matrix.m42 = 0;\r\n    matrix.$matrix.m43 = D;\r\n    matrix.$matrix.m44 = 0;\r\n\r\n    this.isPersp = true;\r\n    this.multiply(matrix);\r\n\r\n    return this;\r\n  }\r\n\r\n  orthographic(scale, aspect, near, far) {\r\n    let mat = temp_mats.next().makeIdentity();\r\n\r\n    let zscale = far - near;\r\n\r\n    mat.scale(2.0/aspect, 2.0, -1.0/scale/zscale, 1.0/scale);\r\n    mat.translate(0.0, 0.0, 0.5*zscale - near);\r\n\r\n    this.isPersp = true; //we still make use of auto homogenous divide in BaseVector.multVecMatrix\r\n    this.multiply(mat);\r\n\r\n    return mat;\r\n  }\r\n\r\n  perspective(fovy, aspect, zNear, zFar) {\r\n    var top = Math.tan(fovy*Math.PI/360)*zNear;\r\n    var bottom = -top;\r\n    var left = aspect*bottom;\r\n    var right = aspect*top;\r\n\r\n    this.frustum(left, right, bottom, top, zNear, zFar);\r\n\r\n    return this;\r\n  }\r\n\r\n  lookat(pos, target, up) {\r\n    var matrix = lookat_cache_ms.next();\r\n    matrix.makeIdentity();\r\n\r\n    var vec = lookat_cache_vs3.next().load(pos).sub(target);\r\n    var len = vec.vectorLength();\r\n    vec.normalize();\r\n\r\n    var zvec = vec;\r\n    var yvec = lookat_cache_vs3.next().load(up).normalize();\r\n    var xvec = lookat_cache_vs3.next().load(yvec).cross(zvec).normalize();\r\n\r\n    let mm = matrix.$matrix;\r\n\r\n    mm.m11 = xvec[0];\r\n    mm.m12 = yvec[0];\r\n    mm.m13 = zvec[0];\r\n    mm.m14 = 0;\r\n    mm.m21 = xvec[1];\r\n    mm.m22 = yvec[1];\r\n    mm.m23 = zvec[1];\r\n    mm.m24 = 0;\r\n    mm.m31 = xvec[2];\r\n    mm.m32 = yvec[2];\r\n    mm.m33 = zvec[2];\r\n\r\n    //*\r\n    mm.m11 = xvec[0];\r\n    mm.m12 = xvec[1];\r\n    mm.m13 = xvec[2];\r\n    mm.m14 = 0;\r\n    mm.m21 = yvec[0];\r\n    mm.m22 = yvec[1];\r\n    mm.m23 = yvec[2];\r\n    mm.m24 = 0;\r\n    mm.m31 = zvec[0];\r\n    mm.m32 = zvec[1];\r\n    mm.m33 = zvec[2];\r\n    mm.m34 = 0;\r\n    mm.m41 = pos[0];\r\n    mm.m42 = pos[1];\r\n    mm.m43 = pos[2];\r\n    mm.m44 = 1;\r\n    //*/\r\n\r\n    this.multiply(matrix);\r\n\r\n\r\n    return this;\r\n  }\r\n\r\n  makeRotationOnly() {\r\n    var m = this.$matrix;\r\n\r\n    m.m41 = m.m42 = m.m43 = 0.0;\r\n    m.m44 = 1.0;\r\n\r\n    let l1 = Math.sqrt(m.m11*m.m11 + m.m12*m.m12 + m.m13*m.m13);\r\n    let l2 = Math.sqrt(m.m21*m.m21 + m.m22*m.m22 + m.m23*m.m23);\r\n    let l3 = Math.sqrt(m.m31*m.m31 + m.m32*m.m32 + m.m33*m.m33);\r\n\r\n    if (l1) {\r\n      m.m11 /= l1;\r\n      m.m12 /= l1;\r\n      m.m13 /= l1;\r\n    }\r\n\r\n    if (l2) {\r\n      m.m21 /= l2;\r\n      m.m22 /= l2;\r\n      m.m23 /= l2;\r\n    }\r\n\r\n    if (l3) {\r\n      m.m31 /= l3;\r\n      m.m32 /= l3;\r\n      m.m33 /= l3;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  alignAxis(axis, vec) {\r\n    vec = new Vector3(vec);\r\n    vec.normalize();\r\n\r\n    let mat = this.inputs.transformMatrix.getValue();\r\n    let m = mat.$matrix;\r\n\r\n    let mat2 = new Matrix4(mat);\r\n    let loc = new Vector3(), scale = new Vector3(), rot = new Vector3();\r\n\r\n    //we don't use rot\r\n    mat2.decompose(loc, rot, scale);\r\n\r\n    mat2.makeRotationOnly();\r\n    let axes = mat2.getAsVecs();\r\n\r\n    let axis2 = (axis + 1) % 3;\r\n    let axis3 = (axis + 2) % 3;\r\n\r\n    axes[axis].load(vec)\r\n    axes[axis2].cross(axes[axis]).cross(axes[axis])\r\n    axes[axis3].load(axes[axis]).cross(axes[axis2])\r\n\r\n    axes[0][3] = 1.0;\r\n    axes[1][3] = 1.0;\r\n    axes[2][3] = 1.0;\r\n\r\n    axes[0].normalize();\r\n    axes[1].normalize();\r\n    axes[2].normalize();\r\n\r\n    this.loadFromVecs(axes);\r\n    this.scale(scale[0], scale[1], scale[2]);\r\n\r\n    m.m41 = loc[0];\r\n    m.m42 = loc[1];\r\n    m.m43 = loc[2];\r\n\r\n    return this;\r\n  }\r\n\r\n  decompose(_translate, _rotate, _scale, _skew, _perspective, order = EulerOrders.XYZ) {\r\n    if (this.$matrix.m44 === 0)\r\n      return false;\r\n\r\n    let mat = temp_mats.next().load(this);\r\n    let m = mat.$matrix;\r\n\r\n    let t = _translate, r = _rotate, s = _scale;\r\n    if (t) {\r\n      t[0] = m.m41;\r\n      t[1] = m.m42;\r\n      t[2] = m.m43;\r\n    }\r\n\r\n    let l1 = Math.sqrt(m.m11*m.m11 + m.m12*m.m12 + m.m13*m.m13);\r\n    let l2 = Math.sqrt(m.m21*m.m21 + m.m22*m.m22 + m.m23*m.m23);\r\n    let l3 = Math.sqrt(m.m31*m.m31 + m.m32*m.m32 + m.m33*m.m33);\r\n\r\n    if (l1) {\r\n      m.m11 /= l1;\r\n      m.m12 /= l1;\r\n      m.m13 /= l1;\r\n    }\r\n    if (l2) {\r\n      m.m21 /= l2;\r\n      m.m22 /= l2;\r\n      m.m23 /= l2;\r\n    }\r\n    if (l3) {\r\n      m.m31 /= l3;\r\n      m.m32 /= l3;\r\n      m.m33 /= l3;\r\n    }\r\n\r\n    if (s) {\r\n      s[0] = l1;\r\n      s[1] = l2;\r\n      s[2] = l3;\r\n    }\r\n\r\n    if (r) { //THREE.js code\r\n      let clamp = myclamp;\r\n\r\n      let rmat = temp_mats.next().load(this);\r\n      rmat.normalize();\r\n\r\n      m = rmat.$matrix;\r\n\r\n      // assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n      let m11 = m.m11, m12 = m.m12, m13 = m.m13, m14 = m.m14;\r\n      let m21 = m.m21, m22 = m.m22, m23 = m.m23, m24 = m.m24;\r\n      let m31 = m.m31, m32 = m.m32, m33 = m.m33, m34 = m.m34;\r\n      //let m41 = m.m41, m42 = m.m42, m43 = m.m43, m44 = m.m44;\r\n\r\n      if (order === EulerOrders.XYZ) {\r\n\r\n        r[1] = Math.asin(clamp(m13, -1, 1));\r\n\r\n        if (Math.abs(m13) < 0.9999999) {\r\n\r\n          r[0] = Math.atan2(-m23, m33);\r\n          r[2] = Math.atan2(-m12, m11);\r\n\r\n        } else {\r\n\r\n          r[0] = Math.atan2(m32, m22);\r\n          r[2] = 0;\r\n\r\n        }\r\n\r\n      } else if (order === EulerOrders.YXZ) {\r\n\r\n        r[0] = Math.asin(-clamp(m23, -1, 1));\r\n\r\n        if (Math.abs(m23) < 0.9999999) {\r\n\r\n          r[1] = Math.atan2(m13, m33);\r\n          r[2] = Math.atan2(m21, m22);\r\n\r\n        } else {\r\n\r\n          r[1] = Math.atan2(-m31, m11);\r\n          r[2] = 0;\r\n\r\n        }\r\n\r\n      } else if (order === EulerOrders.ZXY) {\r\n\r\n        r[0] = Math.asin(clamp(m32, -1, 1));\r\n\r\n        if (Math.abs(m32) < 0.9999999) {\r\n\r\n          r[1] = Math.atan2(-m31, m33);\r\n          r[2] = Math.atan2(-m12, m22);\r\n\r\n        } else {\r\n\r\n          r[1] = 0;\r\n          r[2] = Math.atan2(m21, m11);\r\n\r\n        }\r\n\r\n      } else if (order === EulerOrders.ZYX) {\r\n\r\n        r[1] = Math.asin(-clamp(m31, -1, 1));\r\n\r\n        if (Math.abs(m31) < 0.9999999) {\r\n\r\n          r[0] = Math.atan2(m32, m33);\r\n          r[2] = Math.atan2(m21, m11);\r\n\r\n        } else {\r\n\r\n          r[0] = 0;\r\n          r[2] = Math.atan2(-m12, m22);\r\n\r\n        }\r\n\r\n      } else if (order === EulerOrders.YZX) {\r\n\r\n        r[2] = Math.asin(clamp(m21, -1, 1));\r\n\r\n        if (Math.abs(m21) < 0.9999999) {\r\n\r\n          r[0] = Math.atan2(-m23, m22);\r\n          r[1] = Math.atan2(-m31, m11);\r\n\r\n        } else {\r\n\r\n          r[0] = 0;\r\n          r[1] = Math.atan2(m13, m33);\r\n\r\n        }\r\n\r\n      } else if (order === EulerOrders.XZY) {\r\n\r\n        r[2] = Math.asin(-clamp(m12, -1, 1));\r\n\r\n        if (Math.abs(m12) < 0.9999999) {\r\n\r\n          r[0] = Math.atan2(m32, m22);\r\n          r[1] = Math.atan2(m13, m11);\r\n\r\n        } else {\r\n\r\n          r[0] = Math.atan2(-m23, m33);\r\n          r[1] = 0;\r\n\r\n        }\r\n\r\n      } else {\r\n        console.warn('unsupported euler order:', order);\r\n      }\r\n      //r[0] = Math.atan2(m.m23, m.m33);\r\n      //r[1] = Math.atan2(-m.m13, Math.sqrt(m.m23*m.m23 + m.m33*m.m33));\r\n      //r[2] = Math.atan2(m.m12, m.m11);\r\n    }\r\n  }\r\n\r\n  _determinant2x2(a, b, c, d) {\r\n    return a*d - b*c;\r\n  }\r\n\r\n  _determinant3x3(a1, a2, a3, b1, b2, b3, c1, c2, c3) {\r\n    return a1*this._determinant2x2(b2, b3, c2, c3) - b1*this._determinant2x2(a2, a3, c2, c3) + c1*this._determinant2x2(a2, a3, b2, b3);\r\n  }\r\n\r\n  determinant() {\r\n    return this._determinant4x4();\r\n  }\r\n\r\n  _determinant4x4() {\r\n    var a1 = this.$matrix.m11;\r\n    var b1 = this.$matrix.m12;\r\n    var c1 = this.$matrix.m13;\r\n    var d1 = this.$matrix.m14;\r\n    var a2 = this.$matrix.m21;\r\n    var b2 = this.$matrix.m22;\r\n    var c2 = this.$matrix.m23;\r\n    var d2 = this.$matrix.m24;\r\n    var a3 = this.$matrix.m31;\r\n    var b3 = this.$matrix.m32;\r\n    var c3 = this.$matrix.m33;\r\n    var d3 = this.$matrix.m34;\r\n    var a4 = this.$matrix.m41;\r\n    var b4 = this.$matrix.m42;\r\n    var c4 = this.$matrix.m43;\r\n    var d4 = this.$matrix.m44;\r\n    return a1*this._determinant3x3(b2, b3, b4, c2, c3, c4, d2, d3, d4) - b1*this._determinant3x3(a2, a3, a4, c2, c3, c4, d2, d3, d4) + c1*this._determinant3x3(a2, a3, a4, b2, b3, b4, d2, d3, d4) - d1*this._determinant3x3(a2, a3, a4, b2, b3, b4, c2, c3, c4);\r\n  }\r\n\r\n  _makeAdjoint() {\r\n    var a1 = this.$matrix.m11;\r\n    var b1 = this.$matrix.m12;\r\n    var c1 = this.$matrix.m13;\r\n    var d1 = this.$matrix.m14;\r\n    var a2 = this.$matrix.m21;\r\n    var b2 = this.$matrix.m22;\r\n    var c2 = this.$matrix.m23;\r\n    var d2 = this.$matrix.m24;\r\n    var a3 = this.$matrix.m31;\r\n    var b3 = this.$matrix.m32;\r\n    var c3 = this.$matrix.m33;\r\n    var d3 = this.$matrix.m34;\r\n    var a4 = this.$matrix.m41;\r\n    var b4 = this.$matrix.m42;\r\n    var c4 = this.$matrix.m43;\r\n    var d4 = this.$matrix.m44;\r\n\r\n    this.$matrix.m11 = this._determinant3x3(b2, b3, b4, c2, c3, c4, d2, d3, d4);\r\n    this.$matrix.m21 = -this._determinant3x3(a2, a3, a4, c2, c3, c4, d2, d3, d4);\r\n    this.$matrix.m31 = this._determinant3x3(a2, a3, a4, b2, b3, b4, d2, d3, d4);\r\n    this.$matrix.m41 = -this._determinant3x3(a2, a3, a4, b2, b3, b4, c2, c3, c4);\r\n    this.$matrix.m12 = -this._determinant3x3(b1, b3, b4, c1, c3, c4, d1, d3, d4);\r\n    this.$matrix.m22 = this._determinant3x3(a1, a3, a4, c1, c3, c4, d1, d3, d4);\r\n    this.$matrix.m32 = -this._determinant3x3(a1, a3, a4, b1, b3, b4, d1, d3, d4);\r\n    this.$matrix.m42 = this._determinant3x3(a1, a3, a4, b1, b3, b4, c1, c3, c4);\r\n    this.$matrix.m13 = this._determinant3x3(b1, b2, b4, c1, c2, c4, d1, d2, d4);\r\n    this.$matrix.m23 = -this._determinant3x3(a1, a2, a4, c1, c2, c4, d1, d2, d4);\r\n    this.$matrix.m33 = this._determinant3x3(a1, a2, a4, b1, b2, b4, d1, d2, d4);\r\n    this.$matrix.m43 = -this._determinant3x3(a1, a2, a4, b1, b2, b4, c1, c2, c4);\r\n    this.$matrix.m14 = -this._determinant3x3(b1, b2, b3, c1, c2, c3, d1, d2, d3);\r\n    this.$matrix.m24 = this._determinant3x3(a1, a2, a3, c1, c2, c3, d1, d2, d3);\r\n    this.$matrix.m34 = -this._determinant3x3(a1, a2, a3, b1, b2, b3, d1, d2, d3);\r\n    this.$matrix.m44 = this._determinant3x3(a1, a2, a3, b1, b2, b3, c1, c2, c3);\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    this.load(this.mat);\r\n    this.__mat = this.mat;\r\n    //delete this.mat;\r\n  }\r\n}\r\n\r\nMatrix4.STRUCT = `\r\nmat4 {\r\n  mat      : array(float) | this.getAsArray();\r\n  isPersp  : int          | this.isPersp;\r\n}\r\n`;\r\nnstructjs.register(Matrix4);\r\n\r\npreMultTemp = new Matrix4();\r\n\r\nwindow.testmat = (x = 0, y = 0, z = Math.PI*0.5) => {\r\n  let m1 = new Matrix4();\r\n  m1.euler_rotate(x, y, z);\r\n  //m1.scale(2.0, 0.5, 3.0);\r\n\r\n  let t = [0, 0, 0], r = [0, 0, 0], s = [0, 0, 0]\r\n\r\n  m1.decompose(t, r, s);\r\n\r\n  window.console.log(\"\\n\");\r\n  window.console.log(t);\r\n  window.console.log(r);\r\n  window.console.log(s);\r\n\r\n\r\n  let mat = m1.clone();\r\n  mat.transpose();\r\n  mat.multiply(m1);\r\n\r\n  console.log(mat.toString());\r\n  return r;\r\n}\r\n\r\nlookat_cache_ms = util.cachering.fromConstructor(Matrix4, 64);\r\neuler_rotate_mats = util.cachering.fromConstructor(Matrix4, 64);\r\ntemp_mats = util.cachering.fromConstructor(Matrix4, 64);\r\n","\"use strict\";\r\n\r\n/*\r\nthis file is a skeleton that defines the contract\r\nthat any tool property library must implement to interface with path.ux.\r\n*/\r\n\r\n//maps prop type names to integers\r\nimport * as util from \"../util/util.js\";\r\n\r\nexport let PropTypes = {\r\n  INT        : 1,\r\n  STRING     : 2,\r\n  BOOL       : 4,\r\n  ENUM       : 8,\r\n  FLAG       : 16,\r\n  FLOAT      : 32,\r\n  VEC2       : 64,\r\n  VEC3       : 128,\r\n  VEC4       : 256,\r\n  MATRIX4    : 512,\r\n  QUAT       : 1024,\r\n  PROPLIST   : 4096,\r\n  STRSET     : 8192,\r\n  CURVE      : 8192<<1,\r\n  FLOAT_ARRAY: 8192<<2,\r\n  REPORT     : 8192<<3\r\n  //ITER : 8192<<1\r\n};\r\n\r\nexport const PropSubTypes = {\r\n  COLOR: 1\r\n};\r\n\r\n//flags\r\nexport const PropFlags = {\r\n  SELECT                : 1,\r\n  PRIVATE               : 2,\r\n  LABEL                 : 4,\r\n  USE_ICONS             : 64,\r\n  USE_CUSTOM_GETSET     : 128, //used by controller.js interface\r\n  SAVE_LAST_VALUE       : 256,\r\n  READ_ONLY             : 512,\r\n  SIMPLE_SLIDER         : 1<<10,\r\n  FORCE_ROLLER_SLIDER   : 1<<11,\r\n  USE_BASE_UNDO         : 1<<12, //internal to simple_controller.js\r\n  EDIT_AS_BASE_UNIT     : 1<<13, //user textbox input should be interpreted in display unit\r\n  NO_UNDO               : 1<<14,\r\n  USE_CUSTOM_PROP_GETTER: 1<<15, //hrm, not sure I need this\r\n};\r\n\r\nexport class ToolPropertyIF {\r\n  constructor(type, subtype, apiname, uiname, description, flag, icon) {\r\n    this.data = undefined;\r\n\r\n    this.type = type;\r\n    this.subtype = subtype;\r\n\r\n    this.apiname = apiname;\r\n    this.uiname = uiname;\r\n    this.description = description;\r\n    this.flag = flag;\r\n    this.icon = icon;\r\n  }\r\n\r\n  equals(b) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  copyTo(b) {\r\n\r\n  }\r\n\r\n  copy() {\r\n\r\n  }\r\n\r\n  _fire(type, arg1, arg2) {\r\n  }\r\n\r\n  on(type, cb) {\r\n  }\r\n\r\n  off(type, cb) {\r\n  }\r\n\r\n  getValue() {\r\n  }\r\n\r\n  setValue(val) {\r\n  }\r\n\r\n  setStep(step) {\r\n  }\r\n\r\n  setRange(min, max) {\r\n  }\r\n\r\n  setUnit(unit) {\r\n  }\r\n\r\n  //some clients have seperate ui range\r\n  setUIRange(min, max) {\r\n  }\r\n\r\n  setIcon(icon) {\r\n  }\r\n}\r\n\r\nexport class StringPropertyIF extends ToolPropertyIF {\r\n  constructor() {\r\n    super(PropTypes.STRING);\r\n  }\r\n}\r\n\r\nexport class NumPropertyIF extends ToolPropertyIF {\r\n};\r\n\r\nexport class IntPropertyIF extends ToolPropertyIF {\r\n  constructor() {\r\n    super(PropTypes.INT);\r\n  }\r\n\r\n  setRadix(radix) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n}\r\n\r\nexport class FloatPropertyIF extends ToolPropertyIF {\r\n  constructor() {\r\n    super(PropTypes.FLOAT);\r\n  }\r\n\r\n  setDecimalPlaces(n) {\r\n  }\r\n}\r\n\r\nexport class EnumPropertyIF extends ToolPropertyIF {\r\n  constructor(value, valid_values) {\r\n    super(PropTypes.ENUM);\r\n\r\n    this.values = {}\r\n    this.keys = {};\r\n    this.ui_value_names = {};\r\n    this.iconmap = {};\r\n\r\n    if (valid_values === undefined) return this;\r\n\r\n    if (valid_values instanceof Array || valid_values instanceof String) {\r\n      for (var i = 0; i < valid_values.length; i++) {\r\n        this.values[valid_values[i]] = valid_values[i];\r\n        this.keys[valid_values[i]] = valid_values[i];\r\n      }\r\n    } else {\r\n      for (var k in valid_values) {\r\n        this.values[k] = valid_values[k];\r\n        this.keys[valid_values[k]] = k;\r\n      }\r\n    }\r\n\r\n    for (var k in this.values) {\r\n      var uin = k[0].toUpperCase() + k.slice(1, k.length);\r\n\r\n      uin = uin.replace(/\\_/g, \" \");\r\n      this.ui_value_names[k] = uin;\r\n    }\r\n  }\r\n\r\n  addIcons(iconmap) {\r\n    if (this.iconmap === undefined) {\r\n      this.iconmap = {};\r\n    }\r\n    for (var k in iconmap) {\r\n      this.iconmap[k] = iconmap[k];\r\n    }\r\n  }\r\n}\r\n\r\nexport class FlagPropertyIF extends EnumPropertyIF {\r\n  constructor(valid_values) {\r\n    super(PropTypes.FLAG);\r\n  }\r\n}\r\n\r\nexport class Vec2PropertyIF extends ToolPropertyIF {\r\n  constructor(valid_values) {\r\n    super(PropTypes.VEC2);\r\n  }\r\n}\r\n\r\nexport class Vec3PropertyIF extends ToolPropertyIF {\r\n  constructor(valid_values) {\r\n    super(PropTypes.VEC3);\r\n  }\r\n}\r\n\r\nexport class Vec4PropertyIF extends ToolPropertyIF {\r\n  constructor(valid_values) {\r\n    super(PropTypes.VEC4);\r\n  }\r\n}\r\n\r\n/**\r\n * List of other tool props (all of one type)\r\n */\r\nexport class ListPropertyIF extends ToolPropertyIF {\r\n  /*\r\n  * Prop must be a ToolProperty subclass instance\r\n  * */\r\n  constructor(prop) {\r\n    super(PropTypes.PROPLIST);\r\n\r\n    this.prop = prop;\r\n  }\r\n\r\n  get length() {\r\n  }\r\n\r\n  set length(val) {\r\n  }\r\n\r\n  copyTo(b) {\r\n  }\r\n\r\n  copy() {\r\n  }\r\n\r\n  /**\r\n   * clear list\r\n   * */\r\n  clear() {\r\n\r\n  }\r\n\r\n  push(item = this.prop.copy()) {\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n  }\r\n}\r\n\r\n//like FlagsProperty but uses strings\r\nexport class StringSetPropertyIF extends ToolPropertyIF {\r\n  constructor(value = undefined, definition = []) {\r\n    super(PropTypes.STRSET);\r\n  }\r\n\r\n  /*\r\n  * Values can be a string, undefined/null, or a list/set/object-literal of strings.\r\n  * If destructive is true, then existing set will be cleared.\r\n  * */\r\n  setValue(values, destructive = true, soft_fail = true) {\r\n  }\r\n\r\n  getValue() {\r\n  }\r\n\r\n  addIcons(iconmap) {\r\n  }\r\n\r\n\r\n  addUINames(map) {\r\n  }\r\n\r\n  addDescriptions(map) {\r\n  }\r\n\r\n  copyTo(b) {\r\n  }\r\n\r\n  copy() {\r\n  }\r\n}\r\n\r\nexport class Curve1DPropertyIF extends ToolPropertyIF {\r\n  constructor(curve, uiname) {\r\n    super(PropTypes.CURVE);\r\n\r\n    this.data = curve;\r\n  }\r\n\r\n  getValue() {\r\n    return this.curve;\r\n  }\r\n\r\n  setValue(curve) {\r\n    if (curve === undefined) {\r\n      return;\r\n    }\r\n\r\n    let json = JSON.parse(JSON.stringify(curve));\r\n    this.data.load(json);\r\n  }\r\n\r\n  copyTo(b) {\r\n    b.setValue(this.data);\r\n  }\r\n}\r\n\r\n","import * as util from '../path-controller/util/util.js';\r\nimport {Vector2, Vector3, Vector4, Quat, Matrix4} from '../path-controller/util/vectormath.js';\r\n\r\n/*\r\nall units convert to meters\r\n*/\r\n\r\nconst FLT_EPSILONE = 1.192092895507812e-07;\r\n\r\nfunction myfloor(f) {\r\n  return Math.floor(f + FLT_EPSILONE*2.0);\r\n}\r\n\r\nfunction normString(s) {\r\n  //remove all whitespace\r\n  s = s.replace(/ /g, \"\").replace(/\\t/g, \"\");\r\n  return s.toLowerCase();\r\n}\r\n\r\nfunction myToFixed(f, decimals) {\r\n  if (typeof f !== \"number\") {\r\n    return \"(error)\";\r\n  }\r\n\r\n  f = f.toFixed(decimals);\r\n  while (f.endsWith(\"0\") && f.search(/\\./) >= 0) {\r\n    f = f.slice(0, f.length - 1);\r\n  }\r\n\r\n  if (f.endsWith(\".\")) {\r\n    f = f.slice(0, f.length - 1);\r\n  }\r\n\r\n  if (f.length === 0)\r\n    f = \"0\";\r\n\r\n  return f.trim();\r\n}\r\n\r\nexport const Units = [];\r\n\r\nexport class Unit {\r\n  static getUnit(name) {\r\n    if (name === \"none\" || name === undefined) {\r\n      return undefined;\r\n    }\r\n\r\n    for (let cls of Units) {\r\n      if (cls.unitDefine().name === name) {\r\n        return cls;\r\n      }\r\n    }\r\n\r\n    throw new Error(\"Unknown unit \" + name);\r\n  }\r\n\r\n  static register(cls) {\r\n    Units.push(cls);\r\n  }\r\n\r\n  //subclassed static methods start here\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"\",\r\n      uiname : \"\",\r\n      type   : \"\", //e.g. distance\r\n      icon   : -1,\r\n      pattern: undefined //a re literal to validate strings\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n\r\n  }\r\n\r\n  static validate(string) {\r\n    string = normString(string);\r\n    let def = this.unitDefine();\r\n\r\n    let m = string.match(def.pattern);\r\n    if (!m)\r\n      return false;\r\n\r\n    return m[0] === string;\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n\r\n  }\r\n\r\n  static fromInternal(value) {\r\n\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n\r\n  }\r\n}\r\n\r\nexport class MeterUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"meter\",\r\n      uiname : \"Meter\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d*)?m$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    if (string.endsWith(\"m\")) {\r\n      string = string.slice(0, string.length - 1);\r\n    }\r\n\r\n    return parseFloat(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n    return \"\" + myToFixed(value, decimals) + \" m\";\r\n  }\r\n}\r\n\r\nUnit.register(MeterUnit);\r\n\r\nexport class InchUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"inch\",\r\n      uiname : \"Inch\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d*)?(in|inch)$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = string.toLowerCase();\r\n    let i = string.indexOf(\"i\");\r\n\r\n    if (i >= 0) {\r\n      string = string.slice(0, i);\r\n    }\r\n\r\n    return parseInt(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value*0.0254;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value/0.0254;\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n    return \"\" + myToFixed(value, decimals) + \"in\";\r\n  }\r\n}\r\n\r\nUnit.register(InchUnit);\r\n\r\nlet foot_re = /((-?\\d+(\\.\\d*)?ft)(-?\\d+(\\.\\d*)?(in|inch))?)|(-?\\d+(\\.\\d*)?(in|inch))$/\r\n\r\nexport class FootUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"foot\",\r\n      uiname : \"Foot\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: foot_re\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    let i = string.search(\"ft\");\r\n    let parts = [];\r\n    let vft = 0.0, vin = 0.0;\r\n\r\n    if (i >= 0) {\r\n      parts = string.split(\"ft\");\r\n      let j = parts[1].search(\"in\");\r\n\r\n      if (j >= 0) {\r\n        parts = [parts[0]].concat(parts[1].split(\"in\"));\r\n        vin = parseFloat(parts[1]);\r\n      }\r\n\r\n      vft = parseFloat(parts[0]);\r\n    } else {\r\n      string = string.replace(/in/g, \"\");\r\n      vin = parseFloat(string);\r\n    }\r\n\r\n    return vin/12.0 + vft;\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value*0.3048;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value/0.3048;\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n    let vft = myfloor(value);\r\n    let vin = ((value + FLT_EPSILONE*2)*12)%12;\r\n\r\n    if (vft === 0.0) {\r\n      return myToFixed(vin, decimals) + \" in\";\r\n    }\r\n\r\n    let s = \"\" + vft + \" ft\";\r\n    if (vin !== 0.0) {\r\n      s += \" \" + myToFixed(vin, decimals) + \" in\";\r\n    }\r\n\r\n    return s;\r\n  }\r\n}\r\n\r\nUnit.register(FootUnit);\r\n\r\n\r\nlet square_foot_re = /((-?\\d+(\\.\\d*)?ft(\\u00b2)?)(-?\\d+(\\.\\d*)?(in|inch)(\\u00b2)?)?)|(-?\\d+(\\.\\d*)?(in|inch)(\\u00b2)?)$/\r\n\r\nexport class SquareFootUnit extends FootUnit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"square_foot\",\r\n      uiname : \"Square Feet\",\r\n      type   : \"area\",\r\n      icon   : -1,\r\n      pattern: square_foot_re\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = string.replace(/\\u00b2/g, \"\");\r\n    return super.parse(string);\r\n  }\r\n\r\n\r\n  static buildString(value, decimals = 2) {\r\n    let vft = myfloor(value);\r\n    let vin = ((value + FLT_EPSILONE*2)*12)%12;\r\n\r\n    if (vft === 0.0) {\r\n      return myToFixed(vin, decimals) + \" in\\u00b2\";\r\n    }\r\n\r\n    let s = \"\" + vft + \" ft\\u00b2\";\r\n    if (vin !== 0.0) {\r\n      s += \" \" + myToFixed(vin, decimals) + \" in\\u00b2\";\r\n    }\r\n\r\n    return s;\r\n  }\r\n}\r\n\r\nUnit.register(SquareFootUnit);\r\n\r\n\r\nexport class MileUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"mile\",\r\n      uiname : \"Mile\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d+)?miles$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    string = string.replace(/miles/, \"\");\r\n    return parseFloat(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value*1609.34;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value/1609.34;\r\n  }\r\n\r\n  static buildString(value, decimals = 3) {\r\n    return \"\" + myToFixed(value, decimals) + \" miles\";\r\n  }\r\n}\r\n\r\nUnit.register(MileUnit);\r\n\r\nexport class DegreeUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"degree\",\r\n      uiname : \"Degrees\",\r\n      type   : \"angle\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d+)?(\\u00B0|degree|deg|d|degree|degrees)$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    if (string.search(\"d\") >= 0) {\r\n      string = string.slice(0, string.search(\"d\")).trim();\r\n    } else if (string.search(\"\\u00B0\") >= 0) {\r\n      string = string.slice(0, string.search(\"\\u00B0\")).trim();\r\n    }\r\n\r\n    return parseFloat(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value/180.0*Math.PI;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value*180.0/Math.PI;\r\n  }\r\n\r\n  static buildString(value, decimals = 3) {\r\n    return \"\" + myToFixed(value, decimals) + \" \\u00B0\";\r\n  }\r\n};\r\nUnit.register(DegreeUnit);\r\n\r\nexport class RadianUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"radian\",\r\n      uiname : \"Radians\",\r\n      type   : \"angle\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d+)?(r|rad|radian|radians)$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    if (string.search(\"r\") >= 0) {\r\n      string = string.slice(0, string.search(\"r\")).trim();\r\n    }\r\n\r\n    return parseFloat(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static buildString(value, decimals = 3) {\r\n    return \"\" + myToFixed(value, decimals) + \" r\";\r\n  }\r\n};\r\n\r\nUnit.register(RadianUnit);\r\n\r\nexport function setBaseUnit(unit) {\r\n  Unit.baseUnit = unit;\r\n}\r\n\r\nwindow._getBaseUnit = () => Unit.baseUnit;\r\n\r\nexport function setMetric(val) {\r\n  Unit.isMetric = val;\r\n}\r\n\r\nUnit.isMetric = true;\r\nUnit.baseUnit = \"meter\";\r\n\r\nlet numre1 = /[+\\-]?[0-9]+(\\.[0-9]*)?$/\r\nlet numre2 = /[+\\-]?[0-9]?(\\.[0-9]*)+$/\r\nlet hexre1 = /[+\\-]?[0-9a-fA-F]+h$/\r\nlet hexre2 = /[+\\-]?0x[0-9a-fA-F]+$/\r\nlet binre = /[+\\-]?0b[01]+$/\r\nlet expre = /[+\\-]?[0-9]+(\\.[0-9]*)?[eE]\\-?[0-9]+$/\r\nlet intre = /[+\\-]?[0-9]+$/\r\n\r\nfunction isnumber(s) {\r\n  s = (\"\" + s).trim();\r\n\r\n  function test(re) {\r\n    return s.search(re) === 0;\r\n  }\r\n\r\n  return test(intre) || test(numre1) || test(numre2) || test(hexre1) || test(hexre2) || test(binre) || test(expre);\r\n}\r\n\r\n\r\nexport function parseValueIntern(string, baseUnit = undefined) {\r\n  string = string.trim();\r\n  if (string[0] === \".\") {\r\n    string = \"0\" + string;\r\n  }\r\n\r\n  if (typeof baseUnit === \"string\") {\r\n    let base = Unit.getUnit(baseUnit);\r\n\r\n    if (base === undefined && baseUnit !== \"none\") {\r\n      console.warn(\"Unknown unit \" + baseUnit);\r\n      return NaN;\r\n    }\r\n\r\n    baseUnit = base;\r\n  }\r\n\r\n  //unannotated string?\r\n  if (isnumber(string)) {\r\n    //assume base unit\r\n    let f = parseFloat(string);\r\n\r\n    return f;\r\n  }\r\n\r\n  if (baseUnit === undefined) {\r\n    console.warn(\"No base unit in units.js:parseValueIntern\");\r\n  }\r\n\r\n  for (let unit of Units) {\r\n    let def = unit.unitDefine();\r\n\r\n    if (unit.validate(string)) {\r\n      console.log(unit);\r\n      let value = unit.parse(string);\r\n\r\n      if (baseUnit) {\r\n        value = unit.toInternal(value);\r\n        return baseUnit.fromInternal(value);\r\n      } else {\r\n        return value;\r\n      }\r\n    }\r\n  }\r\n\r\n  return NaN;\r\n}\r\n\r\n/* if displayUnit is undefined, final value will be converted from displayUnit to baseUnit */\r\nexport function parseValue(string, baseUnit = undefined, displayUnit = undefined) {\r\n  displayUnit = Unit.getUnit(displayUnit);\r\n  baseUnit = Unit.getUnit(baseUnit);\r\n\r\n  let f = parseValueIntern(string, displayUnit || baseUnit);\r\n\r\n  if (baseUnit) {\r\n    if (displayUnit) {\r\n      f = displayUnit.toInternal(f);\r\n    }\r\n\r\n    f = baseUnit.fromInternal(f);\r\n  }\r\n\r\n  return f;\r\n}\r\n\r\nexport function isNumber(string) {\r\n  if (isnumber(string)) {\r\n    return true;\r\n  }\r\n\r\n  for (let unit of Units) {\r\n    let def = unit.unitDefine();\r\n\r\n    if (unit.validate(string)) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nexport class PixelUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"pixel\",\r\n      uiname : \"Pixel\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d*)?px$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    if (string.endsWith(\"px\")) {\r\n      string = string.slice(0, string.length - 2).trim();\r\n    }\r\n\r\n    return parseFloat(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n    return \"\" + myToFixed(value, decimals) + \"px\";\r\n  }\r\n}\r\n\r\nUnit.register(PixelUnit);\r\n\r\nexport function convert(value, unita, unitb) {\r\n  if (typeof unita === \"string\")\r\n    unita = Unit.getUnit(unita);\r\n\r\n  if (typeof unitb === \"string\")\r\n    unitb = Unit.getUnit(unitb);\r\n\r\n  return unitb.fromInternal(unita.toInternal(value));\r\n}\r\n\r\n/**\r\n *\r\n * @param value Note: is not converted to internal unit\r\n * @param unit: Unit to use, should be a string referencing unit type, see unitDefine().name\r\n * @returns {*}\r\n */\r\nexport function buildString(value, baseUnit = Unit.baseUnit, decimalPlaces = 3, displayUnit = Unit.baseUnit) {\r\n  if (typeof baseUnit === \"string\" && baseUnit !== \"none\") {\r\n    baseUnit = Unit.getUnit(baseUnit);\r\n  }\r\n  if (typeof displayUnit === \"string\" && displayUnit !== \"none\") {\r\n    displayUnit = Unit.getUnit(displayUnit);\r\n  }\r\n\r\n\r\n  if (baseUnit !== \"none\" && displayUnit !== baseUnit && displayUnit !== \"none\") {\r\n    value = convert(value, baseUnit, displayUnit);\r\n  }\r\n\r\n  if (displayUnit !== \"none\") {\r\n    return displayUnit.buildString(value, decimalPlaces);\r\n  } else {\r\n    return myToFixed(value, decimalPlaces);\r\n  }\r\n}\r\n\r\nwindow._parseValueTest = parseValue;\r\nwindow._buildStringTest = buildString;\r\n","export let config = {\r\n  doubleClickTime : 500,\r\n\r\n  //auto load 1d bspline templates, can hurt startup time\r\n  autoLoadSplineTemplates : true,\r\n\r\n  //timeout for press-and-hold (touch) version of double clicking\r\n  doubleClickHoldTime : 750,\r\n  DEBUG : {\r\n\r\n  }\r\n};\r\n\r\nexport function setConfig(obj) {\r\n  for (let k in obj) {\r\n    config[k] = obj[k];\r\n  }\r\n}\r\n\r\nexport default config;\r\n","import * as util from \"./util.js\";\r\nimport cconst from '../config/config.js';\r\nimport {Vector2} from './vectormath.js';\r\n\r\nexport let modalstack = [];\r\nlet singleMouseCBs = {};\r\n\r\nfunction debugDomEvents() {\r\n  let cbsymbol = Symbol(\"event-callback\");\r\n  let thsymbol = Symbol(\"debug-info\");\r\n  \r\n  let idgen = 0;\r\n  \r\n  function init(et) {\r\n    if (!et[thsymbol]) {\r\n      et[thsymbol] = idgen++;\r\n    }\r\n  }\r\n  \r\n  function getkey(et, type, options) {\r\n    init(et);\r\n    return \"\" + et[thsymbol] + \":\" + type + \":\" + JSON.stringify(options);\r\n  }\r\n  \r\n  let addEventListener = EventTarget.prototype.addEventListener;\r\n  let removeEventListener = EventTarget.prototype.removeEventListener;\r\n  \r\n  EventTarget.prototype.addEventListener = function(type, cb, options) {\r\n    init(this);\r\n    \r\n    if (!cb[cbsymbol]) {\r\n      cb[cbsymbol] = new Set();\r\n    }\r\n    \r\n    let key = getkey(this, type, options);\r\n    cb[cbsymbol].add(key);\r\n    \r\n    return addEventListener.call(this, type, cb, options);\r\n  }\r\n  \r\n  EventTarget.prototype.removeEventListener = function(type, cb, options) {\r\n    init(this);\r\n    \r\n    if (!cb[cbsymbol]) {\r\n      console.error(\"Invalid callback in removeEventListener for\", type, this, cb);\r\n      return;\r\n    }\r\n    \r\n    let key = getkey(this, type, options);\r\n    \r\n    if (!cb[cbsymbol].has(key)) {\r\n      console.error(\"Callback not in removeEventListener;\", type, this, cb);\r\n      return;\r\n    }\r\n    \r\n    cb[cbsymbol].delete(key);\r\n    \r\n    return removeEventListener.call(this, type, cb, options);\r\n  }\r\n}\r\n\r\n//debugDomEvents();\r\n\r\nfunction singletonMouseEvents() {\r\n  let keys = [\"mousedown\", \"mouseup\", \"mousemove\"];\r\n  for (let k of keys) {\r\n    singleMouseCBs[k] = new Set();\r\n  }\r\n\r\n  let ddd = -1.0;\r\n  window.testSingleMouseUpEvent = (type = \"mousedown\") => {\r\n    let id = ddd++;\r\n    singleMouseEvent(() => {\r\n      console.log(\"mouse event\", id);\r\n    }, type)\r\n  };\r\n\r\n  let _mpos = new Vector2();\r\n\r\n  function doSingleCbs(e, type) {\r\n    let list = singleMouseCBs[type];\r\n    singleMouseCBs[type] = new Set();\r\n\r\n    if (e.type !== \"touchend\" && e.type !== \"touchcancel\") {\r\n      _mpos[0] = e.touches && e.touches.length > 0 ? e.touches[0].pageX : e.x;\r\n      _mpos[1] = e.touches && e.touches.length > 0 ? e.touches[0].pageY : e.y;\r\n    }\r\n\r\n    if (e.touches) {\r\n      e = copyEvent(e);\r\n\r\n      e.type = type;\r\n      if (e.touches.length > 0) {\r\n        e.x = e.pageX = e.touches[0].pageX;\r\n        e.y = e.pageY = e.touches[0].pageY;\r\n      } else {\r\n        e.x = _mpos[0];\r\n        e.y = _mpos[1];\r\n      }\r\n    }\r\n\r\n    for (let cb of list) {\r\n      try {\r\n        cb(e);\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        console.warn(\"Error in event callback\");\r\n      }\r\n    }\r\n  }\r\n\r\n  window.addEventListener(\"mouseup\", (e) => {\r\n    doSingleCbs(e, \"mouseup\");\r\n  }, {capture: true});\r\n  window.addEventListener(\"touchcancel\", (e) => {\r\n    doSingleCbs(e, \"mouseup\");\r\n  }, {capture: true});\r\n  document.addEventListener(\"touchend\", (e) => {\r\n    doSingleCbs(e, \"mouseup\");\r\n  }, {capture: true});\r\n\r\n  document.addEventListener(\"mousedown\", (e) => {\r\n    doSingleCbs(e, \"mousedown\");\r\n  }, {capture: true});\r\n  document.addEventListener(\"touchstart\", (e) => {\r\n    doSingleCbs(e, \"mousedown\");\r\n  }, {capture: true});\r\n\r\n  document.addEventListener(\"mousemove\", (e) => {\r\n    doSingleCbs(e, \"mousemove\");\r\n  }, {capture: true});\r\n  document.addEventListener(\"touchmove\", (e) => {\r\n    doSingleCbs(e, \"mousemove\");\r\n  }, {capture: true});\r\n\r\n  return {\r\n    singleMouseEvent(cb, type) {\r\n      if (!(type in singleMouseCBs)) {\r\n        throw new Error(\"not a mouse event\");\r\n      }\r\n\r\n      singleMouseCBs[type].add(cb);\r\n    }\r\n  };\r\n};\r\n\r\nsingletonMouseEvents = singletonMouseEvents();\r\n\r\n/**\r\n * adds a mouse event callback that only gets called once\r\n * */\r\nexport function singleMouseEvent(cb, type) {\r\n  return singletonMouseEvents.singleMouseEvent(cb, type);\r\n}\r\n\r\n\r\n/*tests if either the left mouse button is down,\r\n* or a touch event has happened and e.touches.length == 1*/\r\nexport function isLeftClick(e) {\r\n  if (e.touches !== undefined) {\r\n    return e.touches.length === 1;\r\n  }\r\n\r\n  return e.button === 0;\r\n}\r\n\r\nexport class DoubleClickHandler {\r\n  constructor() {\r\n    this.down = 0;\r\n    this.last = 0;\r\n    this.dblEvent = undefined;\r\n\r\n    this.start_mpos = new Vector2();\r\n\r\n    this._on_mouseup = this._on_mouseup.bind(this);\r\n    this._on_mousemove = this._on_mousemove.bind(this);\r\n  }\r\n\r\n  _on_mouseup(e) {\r\n    //console.log(\"mup\", e);\r\n    this.mdown = false;\r\n  }\r\n\r\n  _on_mousemove(e) {\r\n    let mpos = new Vector2();\r\n    mpos[0] = e.x;\r\n    mpos[1] = e.y;\r\n\r\n    let dist = mpos.vectorDistance(this.start_mpos)*devicePixelRatio;\r\n\r\n    if (dist > 11) {\r\n      //console.log(\"cancel\", dist);\r\n      this.mdown = false;\r\n    }\r\n\r\n    if (this.mdown) {\r\n      singleMouseEvent(this._on_mousemove, \"mousemove\");\r\n    }\r\n\r\n    this.update();\r\n  }\r\n\r\n  mousedown(e) {\r\n    //console.log(\"mdown\", e.x, e.y);\r\n\r\n    if (!this.last) {\r\n      this.last = 0;\r\n    }\r\n    if (!this.down) {\r\n      this.down = 0;\r\n    }\r\n    if (!this.up) {\r\n      this.up = 0;\r\n    }\r\n\r\n    if (isMouseDown(e)) {\r\n      this.mdown = true;\r\n\r\n      let cpy = Object.assign({}, e);\r\n\r\n      this.start_mpos[0] = e.x;\r\n      this.start_mpos[1] = e.y;\r\n\r\n      singleMouseEvent(this._on_mousemove, \"mousemove\");\r\n\r\n      if (e.type.search(\"touch\") >= 0 && e.touches.length > 0) {\r\n        cpy.x = cpy.pageX = e.touches[0].pageX;\r\n        cpy.y = cpy.pageY = e.touches[1].pageY;\r\n      } else {\r\n        cpy.x = cpy.pageX = e.x;\r\n        cpy.y = cpy.pageY = e.y;\r\n      }\r\n\r\n      //stupid real MouseEvent class zeros .x/.y\r\n      //continue using hackish copyEvent for now...\r\n\r\n      this.dblEvent = copyEvent(e);\r\n      this.dblEvent.type = \"dblclick\";\r\n\r\n      this.last = this.down;\r\n      this.down = util.time_ms();\r\n\r\n      if (this.down - this.last < cconst.doubleClickTime) {\r\n        this.mdown = false;\r\n        this.ondblclick(this.dblEvent);\r\n\r\n        this.down = this.last = 0.0;\r\n      } else {\r\n        singleMouseEvent(this._on_mouseup, \"mouseup\");\r\n      }\r\n    } else {\r\n      this.mdown = false;\r\n    }\r\n  }\r\n\r\n  //you may override this\r\n  ondblclick(e) {\r\n\r\n  }\r\n\r\n  update() {\r\n    if (modalstack.length > 0) {\r\n      //cancel double click requests\r\n      this.mdown = false;\r\n    }\r\n\r\n    if (this.mdown && util.time_ms() - this.down > cconst.doubleClickHoldTime) {\r\n      this.mdown = false;\r\n      this.ondblclick(this.dblEvent);\r\n    }\r\n  }\r\n\r\n  abort() {\r\n    this.last = this.down = 0;\r\n  }\r\n}\r\n\r\nexport function isMouseDown(e) {\r\n  let mdown = 0;\r\n\r\n  if (e.touches !== undefined) {\r\n    mdown = e.touches.length > 0;\r\n  } else {\r\n    mdown = e.buttons;\r\n  }\r\n\r\n  mdown = mdown & 1;\r\n\r\n  return mdown;\r\n}\r\n\r\nexport function pathDebugEvent(e, extra) {\r\n  e.__prevdef = e.preventDefault;\r\n  e.__stopprop = e.stopPropagation;\r\n\r\n  e.preventDefault = function () {\r\n    console.warn(\"preventDefault\", extra);\r\n    return this.__prevdef();\r\n  };\r\n\r\n  e.stopPropagation = function () {\r\n    console.warn(\"stopPropagation\", extra);\r\n    return this.__stopprop();\r\n  }\r\n}\r\n\r\n/** Returns true if event came from a touchscreen or pen device */\r\nexport function eventWasTouch(e) {\r\n  let ret = e.sourceCapabilities && e.sourceCapabilities.firesTouchEvents;\r\n  ret = ret || e.was_touch;\r\n  ret = ret || e instanceof TouchEvent;\r\n  ret = ret || e.touches !== undefined;\r\n\r\n  if (e instanceof PointerEvent) {\r\n    ret = ret || (e.pointerType === \"pen\" || e.pointerType === \"touch\");\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nexport function copyEvent(e) {\r\n  let ret = {};\r\n  let keys = [];\r\n\r\n  for (let k in e) {\r\n    keys.push(k);\r\n  }\r\n\r\n  keys = keys.concat(Object.getOwnPropertySymbols(e));\r\n  keys = keys.concat(Object.getOwnPropertyNames(e));\r\n\r\n  for (let k of keys) {\r\n    let v;\r\n\r\n    try {\r\n      v = e[k];\r\n    } catch (error) {\r\n      console.warn(\"read error for event key\", k);\r\n      continue;\r\n    }\r\n\r\n    if (typeof v == \"function\") {\r\n      ret[k] = v.bind(e);\r\n    } else {\r\n      ret[k] = v;\r\n    }\r\n  }\r\n\r\n  ret.original = e;\r\n\r\n  return ret;\r\n}\r\n\r\nlet Screen;\r\n\r\nexport function _setScreenClass(cls) {\r\n  Screen = cls;\r\n}\r\n\r\nfunction findScreen() {\r\n  let rec = (n) => {\r\n    for (let n2 of n.childNodes) {\r\n      if (n2 && typeof n2 === \"object\" && n2 instanceof Screen) {\r\n        return n2;\r\n      }\r\n    }\r\n\r\n    for (let n2 of n.childNodes) {\r\n      let ret = rec(n2);\r\n      if (ret) {\r\n        return ret;\r\n      }\r\n    }\r\n  };\r\n\r\n  return rec(document.body);\r\n}\r\n\r\nwindow._findScreen = findScreen;\r\n\r\nlet ContextAreaClass;\r\n\r\nexport function _setModalAreaClass(cls) {\r\n  ContextAreaClass = cls;\r\n}\r\n\r\nexport function pushPointerModal(obj, elem, pointerId, autoStopPropagation = true) {\r\n  return pushModalLight(obj, autoStopPropagation, elem, pointerId);\r\n}\r\n\r\nexport function pushModalLight(obj, autoStopPropagation = true, elem, pointerId) {\r\n  let keys;\r\n\r\n  if (pointerId === undefined) {\r\n    keys = new Set([\r\n      \"keydown\", \"keyup\", \"keypress\", \"mousedown\", \"mouseup\", \"touchstart\", \"touchend\",\r\n      \"touchcancel\", \"mousewheel\", \"mousemove\", \"mouseover\", \"mouseout\", \"mouseenter\",\r\n      \"mouseleave\", \"dragstart\", \"drag\", \"dragend\", \"dragexit\", \"dragleave\", \"dragover\",\r\n      \"dragenter\", \"drop\", \"pointerdown\", \"pointermove\", \"pointerup\", \"pointercancel\",\r\n      \"pointerstart\", \"pointerend\", \"pointerleave\", \"pointerexit\", \"pointerenter\",\r\n      \"pointerover\"\r\n    ]);\r\n  } else {\r\n    keys = new Set([\r\n      \"keydown\", \"keyup\", \"keypress\", \"mousewheel\"\r\n    ]);\r\n  }\r\n\r\n  let ret = {\r\n    keys     : keys,\r\n    handlers : {},\r\n    last_mpos: [0, 0]\r\n  };\r\n\r\n  let touchmap = {\r\n    \"touchstart\" : \"mousedown\",\r\n    \"touchmove\"  : \"mousemove\",\r\n    \"touchend\"   : \"mouseup\",\r\n    \"touchcancel\": \"mouseup\"\r\n  };\r\n\r\n  let mpos = [0, 0];\r\n\r\n  let screen = findScreen();\r\n  if (screen) {\r\n    mpos[0] = screen.mpos[0];\r\n    mpos[1] = screen.mpos[1];\r\n    screen = undefined;\r\n  }\r\n\r\n  function handleAreaContext() {\r\n    let screen = findScreen();\r\n    if (screen) {\r\n      let sarea = screen.findScreenArea(mpos[0], mpos[1]);\r\n      if (sarea && sarea.area) {\r\n        sarea.area.push_ctx_active();\r\n        sarea.area.pop_ctx_active();\r\n      }\r\n    }\r\n  }\r\n\r\n  function make_default_touchhandler(type, state) {\r\n    return function (e) {\r\n      //console.warn(\"touch event!\", type, touchmap[type], e.touches.length);\r\n      if (cconst.DEBUG.domEvents) {\r\n        pathDebugEvent(e);\r\n      }\r\n\r\n      if (touchmap[type] in ret.handlers) {\r\n        let type2 = touchmap[type];\r\n\r\n        let e2 = copyEvent(e);\r\n\r\n        e2.was_touch = true;\r\n        e2.type = type2;\r\n        e2.button = type == \"touchcancel\" ? 1 : 0;\r\n        e2.touches = e.touches;\r\n\r\n        if (e.touches.length > 0) {\r\n          let dpi = window.devicePixelRatio; //UIBase.getDPI();\r\n          let t = e.touches[0];\r\n\r\n          mpos[0] = t.pageX;\r\n          mpos[1] = t.pageY;\r\n\r\n          e2.pageX = e2.x = t.pageX;// * dpi;\r\n          e2.pageY = e2.y = t.pageY;// * dpi;\r\n          e2.clientX = t.clientX;// * dpi;\r\n          e2.clientY = t.clientY;// * dpi;\r\n          e2.x = t.clientX;// * dpi;\r\n          e2.y = t.clientY;// * dpi;\r\n\r\n          ret.last_mpos[0] = e2.x;\r\n          ret.last_mpos[1] = e2.y;\r\n        } else {\r\n          e2.x = e2.clientX = e2.pageX = e2.screenX = ret.last_mpos[0];\r\n          e2.y = e2.clientY = e2.pageY = e2.screenY = ret.last_mpos[1];\r\n        }\r\n\r\n        e2.was_touch = true;\r\n\r\n        handleAreaContext();\r\n        //console.log(e2.x, e2.y);\r\n        ret.handlers[type2](e2);\r\n      }\r\n\r\n      if (autoStopPropagation) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n    }\r\n  }\r\n\r\n  function make_handler(type, key) {\r\n    return function (e) {\r\n      if (cconst.DEBUG.domEvents) {\r\n        pathDebugEvent(e);\r\n      }\r\n\r\n      if (typeof key !== \"string\") {\r\n        //console.warn(\"key was undefined\", key, type);\r\n        return;\r\n      }\r\n\r\n      if (key.startsWith(\"mouse\")) {\r\n        mpos[0] = e.pageX;\r\n        mpos[1] = e.pageY;\r\n      }\r\n\r\n      handleAreaContext();\r\n\r\n      if (key !== undefined)\r\n        obj[key](e);\r\n\r\n      if (autoStopPropagation) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n    }\r\n  }\r\n\r\n  let found = {};\r\n\r\n  for (let k of keys) {\r\n    let key;\r\n\r\n    if (obj[k])\r\n      key = k;\r\n    else if (obj[\"on\" + k])\r\n      key = \"on\" + k;\r\n    else if (obj[\"on_\" + k])\r\n      key = \"on_\" + k;\r\n    else if (k in touchmap)\r\n      continue; //default touch event handlers will be done seperately\r\n    else\r\n      key = undefined; //make handler that still blocks events\r\n\r\n    //check we don't override other mouse pointer event handlers\r\n    if (key === undefined && k.search(\"pointer\") === 0) {\r\n      continue;\r\n    }\r\n\r\n    if (key !== undefined) {\r\n      found[k] = 1;\r\n    }\r\n\r\n    let handler = make_handler(k, key);\r\n    ret.handlers[k] = handler;\r\n\r\n    let settings = handler.settings = {passive: false, capture: true};\r\n    window.addEventListener(k, handler, settings);\r\n  }\r\n\r\n  for (let k in touchmap) {\r\n    if (!(k in found)) {\r\n      //console.log(\"making touch handler for\", '\"' + k + '\"', ret.handlers[k]);\r\n\r\n      ret.handlers[k] = make_default_touchhandler(k, ret);\r\n\r\n      let settings = ret.handlers[k].settings = {passive: false, capture: true};\r\n      window.addEventListener(k, ret.handlers[k], settings);\r\n    }\r\n  }\r\n\r\n  if (pointerId !== undefined) {\r\n    ret.pointer = {\r\n      elem, pointerId\r\n    };\r\n\r\n    function make_pointer(k) {\r\n      let k2 = \"on_\" + k;\r\n\r\n      ret.pointer[k] = function (e) {\r\n        if (obj[k2] !== undefined) {\r\n          obj[k2](e);\r\n        }\r\n\r\n        if (autoStopPropagation) {\r\n          e.stopPropagation();\r\n          e.preventDefault();\r\n        }\r\n      }\r\n    }\r\n\r\n    make_pointer(\"pointerdown\");\r\n    make_pointer(\"pointermove\");\r\n    make_pointer(\"pointerup\");\r\n    make_pointer(\"pointerstart\");\r\n    make_pointer(\"pointerend\");\r\n    make_pointer(\"pointerleave\");\r\n    make_pointer(\"pointerenter\");\r\n    make_pointer(\"pointerout\");\r\n    make_pointer(\"pointerover\");\r\n    make_pointer(\"pointerexit\");\r\n    make_pointer(\"pointercancel\");\r\n\r\n    for (let k in ret.pointer) {\r\n      if (k !== \"elem\" && k !== \"pointerId\") {\r\n        elem.addEventListener(k, ret.pointer[k]);\r\n      }\r\n    }\r\n\r\n    try {\r\n      elem.setPointerCapture(pointerId)\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n\r\n      console.log(\"attempting fallback\");\r\n      \r\n      for (let k in ret.pointer) {\r\n        if (k !== \"elem\" && k !== \"pointerId\") {\r\n          elem.removeEventListener(k, ret.pointer[k]);\r\n        }\r\n      }\r\n\r\n      delete ret.pointer;\r\n\r\n      modalstack.push(ret);\r\n      popModalLight(ret);\r\n\r\n      for (let k in obj) {\r\n        if (k === \"pointercancel\" || k === \"pointerend\" || k === \"pointerstart\") {\r\n          continue;\r\n        }\r\n\r\n        if (k.startsWith(\"pointer\")) {\r\n          let k2 = k.replace(/pointer/, \"mouse\");\r\n          if (k2 in obj) {\r\n            console.warn(\"warning, existing mouse handler\", k2);\r\n            continue;\r\n          }\r\n\r\n          let v = obj[k];\r\n          obj[k] = undefined;\r\n\r\n          obj[k2] = v;\r\n        }\r\n      }\r\n\r\n      console.log(obj);\r\n\r\n      return pushModalLight(obj, autoStopPropagation);\r\n    }\r\n  }\r\n\r\n  modalstack.push(ret);\r\n  ContextAreaClass.lock();\r\n\r\n  if (cconst.DEBUG.modalEvents) {\r\n    console.warn(\"pushModalLight\", ret.pointer ? \"(pointer events)\" : \"\");\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nif (0) {\r\n  let addevent = EventTarget.prototype.addEventListener;\r\n  let remevent = EventTarget.prototype.removeEventListener;\r\n\r\n  const funckey = Symbol(\"eventfunc\");\r\n\r\n  EventTarget.prototype.addEventListener = function (name, func, args) {\r\n    //if (name.startsWith(\"key\")) {\r\n    console.warn(\"listener added\", name, func, args);\r\n    //}\r\n\r\n    let func2 = function (e) {\r\n      let proxy = new Proxy(e, {\r\n        get(target, p, receiver) {\r\n          if (p === \"preventDefault\") {\r\n            return function () {\r\n              console.warn(\"preventDefault\", name, arguments);\r\n              return e.preventDefault(...arguments);\r\n            }\r\n          } else if (p === \"stopPropagation\") {\r\n            return function () {\r\n              console.warn(\"stopPropagation\", name, arguments);\r\n              return e.preventDefault(...arguments);\r\n            }\r\n          }\r\n\r\n          return e[p];\r\n        }\r\n      });\r\n\r\n      return func.call(this, proxy);\r\n    }\r\n\r\n    func[funckey] = func2;\r\n\r\n    return addevent.call(this, name, func2, args);\r\n  }\r\n\r\n  EventTarget.prototype.removeEventListener = function (name, func, args) {\r\n    //if (name.startsWith(\"key\")) {\r\n    console.warn(\"listener removed\", name, func, args);\r\n    //}\r\n\r\n    func = func[funckey];\r\n\r\n    return remevent.call(this, name, func, args);\r\n  }\r\n}\r\n\r\nexport function popModalLight(state) {\r\n  if (state === undefined) {\r\n    console.warn(\"Bad call to popModalLight: state was undefined\");\r\n    return;\r\n  }\r\n\r\n  if (state !== modalstack[modalstack.length - 1]) {\r\n    if (modalstack.indexOf(state) < 0) {\r\n      console.warn(\"Error in popModalLight; modal handler not found\");\r\n      return;\r\n    } else {\r\n      console.warn(\"Error in popModalLight; called in wrong order\");\r\n    }\r\n  }\r\n\r\n  for (let k in state.handlers) {\r\n    //console.log(k);\r\n    window.removeEventListener(k, state.handlers[k], state.handlers[k].settings);\r\n  }\r\n\r\n  state.handlers = {};\r\n  modalstack.remove(state);\r\n  ContextAreaClass.unlock();\r\n\r\n  if (cconst.DEBUG.modalEvents) {\r\n    console.warn(\"popModalLight\", modalstack, state.pointer ? \"(pointer events)\" : \"\");\r\n  }\r\n\r\n  if (state.pointer) {\r\n    let elem = state.pointer.elem;\r\n\r\n    try {\r\n      elem.releasePointerCapture(state.pointer.pointerId);\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n    }\r\n\r\n    for (let k in state.pointer) {\r\n      if (k !== \"elem\" && k !== \"pointerId\") {\r\n        elem.removeEventListener(k, state.pointer[k]);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport function haveModal() {\r\n  return modalstack.length > 0;\r\n}\r\n\r\nwindow._haveModal = haveModal; //for debugging console\r\n\r\nexport var keymap_latin_1 = {\r\n  \"Space\" : 32,\r\n  \"Escape\": 27,\r\n  \"Enter\" : 13,\r\n  \"Return\": 13,\r\n  \"Up\"    : 38,\r\n  \"Down\"  : 40,\r\n  \"Left\"  : 37,\r\n  \"Right\" : 39,\r\n\r\n  \"Num0\"     : 96,\r\n  \"Num1\"     : 97,\r\n  \"Num2\"     : 98,\r\n  \"Num3\"     : 99,\r\n  \"Num4\"     : 100,\r\n  \"Num5\"     : 101,\r\n  \"Num6\"     : 102,\r\n  \"Num7\"     : 103,\r\n  \"Num8\"     : 104,\r\n  \"Num9\"     : 105,\r\n  \"Home\"     : 36,\r\n  \"End\"      : 35,\r\n  \"Delete\"   : 46,\r\n  \"Backspace\": 8,\r\n  \"Insert\"   : 45,\r\n  \"PageUp\"   : 33,\r\n  \"PageDown\" : 34,\r\n  \"Tab\"      : 9,\r\n  \"-\"        : 189,\r\n  \"=\"        : 187,\r\n  \".\"        : 190,\r\n  \"/\"        : 191,\r\n  \",\"        : 188,\r\n  \";\"        : 186,\r\n  \"'\"        : 222,\r\n  \"[\"        : 219,\r\n  \"]\"        : 221,\r\n  \"NumPlus\"  : 107,\r\n  \"NumMinus\" : 109,\r\n  \"Shift\"    : 16,\r\n  \"Ctrl\"     : 17,\r\n  \"Control\"  : 17,\r\n  \"Alt\"      : 18\r\n}\r\n\r\nfor (var i = 0; i < 26; i++) {\r\n  keymap_latin_1[String.fromCharCode(i + 65)] = i + 65\r\n}\r\nfor (var i = 0; i < 10; i++) {\r\n  keymap_latin_1[String.fromCharCode(i + 48)] = i + 48\r\n}\r\n\r\nfor (var k in keymap_latin_1) {\r\n  if (!(k in keymap_latin_1)) {\r\n    keymap_latin_1[keymap_latin_1[k]] = k;\r\n  }\r\n}\r\n\r\nvar keymap_latin_1_rev = {}\r\nfor (var k in keymap_latin_1) {\r\n  keymap_latin_1_rev[keymap_latin_1[k]] = k\r\n}\r\n\r\nexport var keymap = keymap_latin_1;\r\nexport var reverse_keymap = keymap_latin_1_rev;\r\n\r\nexport class HotKey {\r\n  /**action can be a callback or a toolpath string*/\r\n  constructor(key, modifiers, action, uiname) {\r\n    this.action = action;\r\n    this.mods = modifiers;\r\n    this.key = keymap[key];\r\n    this.uiname = uiname;\r\n  }\r\n\r\n  exec(ctx) {\r\n    if (typeof this.action == \"string\") {\r\n      ctx.api.execTool(ctx, this.action);\r\n    } else {\r\n      this.action(ctx);\r\n    }\r\n  }\r\n\r\n  buildString() {\r\n    let s = \"\";\r\n\r\n    for (let i = 0; i < this.mods.length; i++) {\r\n      if (i > 0) {\r\n        s += \" + \";\r\n      }\r\n\r\n      let k = this.mods[i].toLowerCase();\r\n      k = k[0].toUpperCase() + k.slice(1, k.length).toLowerCase();\r\n\r\n      s += k;\r\n    }\r\n\r\n    if (this.mods.length > 0) {\r\n      s += \"+\";\r\n    }\r\n\r\n    s += reverse_keymap[this.key];\r\n\r\n    return s.trim();\r\n  }\r\n}\r\n\r\nexport class KeyMap extends Array {\r\n  /**\r\n   *\r\n   * @param pathid{string} Id of keymap, used when patching hotkeys, when\r\n   *                       that is implemented\r\n   * */\r\n  constructor(hotkeys = [], pathid = \"undefined\") {\r\n    super();\r\n\r\n    this.pathid = pathid;\r\n\r\n    for (let hk of hotkeys) {\r\n      this.add(hk);\r\n    }\r\n  }\r\n\r\n  handle(ctx, e) {\r\n    let mods = new util.set();\r\n    if (e.shiftKey)\r\n      mods.add(\"shift\");\r\n    if (e.altKey)\r\n      mods.add(\"alt\");\r\n    if (e.ctrlKey) {\r\n      mods.add(\"ctrl\");\r\n    }\r\n    if (e.commandKey) {\r\n      mods.add(\"command\");\r\n    }\r\n\r\n    for (let hk of this) {\r\n      let ok = e.keyCode === hk.key;\r\n      if (!ok) continue;\r\n\r\n      let count = 0;\r\n      for (let m of hk.mods) {\r\n        m = m.toLowerCase().trim();\r\n\r\n        if (!mods.has(m)) {\r\n          ok = false;\r\n          break;\r\n        }\r\n\r\n        count++;\r\n      }\r\n\r\n      if (count !== mods.length) {\r\n        ok = false;\r\n      }\r\n\r\n      if (ok) {\r\n        try {\r\n          hk.exec(ctx);\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n          console.log(\"failed to execute a hotkey\", keymap[e.keyCode]);\r\n        }\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n\r\n  add(hk) {\r\n    this.push(hk);\r\n  }\r\n\r\n  push(hk) {\r\n    super.push(hk);\r\n  }\r\n}\r\n\r\n","\"use strict\";\r\n\r\nimport * as util from './util.js';\r\nimport * as simple_events from './simple_events.js';\r\n\r\nexport {keymap, reverse_keymap, keymap_latin_1} from './simple_events.js';\r\n\r\nexport class EventDispatcher {\r\n  constructor() {\r\n    this._cbs = {};\r\n  }\r\n\r\n  _fireEvent(type, data) {\r\n    let stop = false;\r\n\r\n    data = {\r\n      stopPropagation() {\r\n        stop = true;\r\n      },\r\n\r\n      data : data\r\n    };\r\n\r\n    if (type in this._cbs) {\r\n      for (let cb of this._cbs[type]) {\r\n        cb(data);\r\n        if (stop) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  on(type, cb) {\r\n    if (!(type in this._cbs)) {\r\n      this._cbs[type] = [];\r\n    }\r\n\r\n    this._cbs[type].push(cb);\r\n    return this;\r\n  }\r\n\r\n  off(type, cb) {\r\n    if (!(type in this._cbs)) {\r\n      console.warn(\"event handler not in list\", type, cb);\r\n      return this;\r\n    }\r\n\r\n    let stack = this._cbs[type];\r\n    if (stack.indexOf(cb) < 0) {\r\n      console.warn(\"event handler not in list\", type, cb);\r\n      return this;\r\n    }\r\n\r\n    stack.remove(cb);\r\n    return this;\r\n  }\r\n}\r\nexport function copyMouseEvent(e) {\r\n  let ret = {};\r\n  \r\n  function bind(func, obj) {\r\n    return function() {\r\n      return this._orig.apply(func, arguments);\r\n    }\r\n  }\r\n  \r\n  let exclude = new Set([\r\n    //\"prototype\",\r\n    //\"constructor\",\r\n    \"__proto__\"\r\n  ]);\r\n  \r\n  ret._orig = e;\r\n  \r\n  for (let k in e) {\r\n    let v = e[k];\r\n    \r\n    if (exclude.has(k)) {\r\n      continue;\r\n    }\r\n    \r\n    if (typeof v == \"function\") {\r\n      v = bind(v);\r\n    }\r\n    \r\n    ret[k] = v;\r\n  }\r\n\r\n  ret.ctrlKey = e.ctrlKey;\r\n  ret.shiftKey = e.shiftKey;\r\n  ret.altKey = e.altKey;\r\n\r\n  for (let i=0; i<2; i++) {\r\n    let key = i ? \"targetTouches\" : \"touches\";\r\n\r\n    if (e[key]) {\r\n      ret[key] = [];\r\n\r\n      for (let t of e[key]) {\r\n        let t2 = {};\r\n        ret[key].push(t2);\r\n\r\n        for (let k in t) {\r\n          t2[k] = t[k];\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nexport const DomEventTypes = {\r\n  on_mousemove   : 'mousemove',\r\n  on_mousedown   : 'mousedown',\r\n  on_mouseup     : 'mouseup',\r\n  on_touchstart  : 'touchstart',\r\n  on_touchcancel : 'touchcanel',\r\n  on_touchmove   : 'touchmove',\r\n  on_touchend    : 'touchend',\r\n  on_mousewheel  : 'mousewheel',\r\n  on_keydown     : 'keydown',\r\n  on_keyup       : 'keyup',\r\n  on_pointerdown : 'pointerdown',\r\n  on_pointermove : 'pointermove',\r\n  on_pointercancel : 'pointercancel',\r\n  on_pointerup   : 'pointerup',\r\n\r\n  //on_keypress    : 'keypress'\r\n};\r\n\r\nfunction getDom(dom, eventtype) {\r\n  if (eventtype.startsWith(\"key\"))\r\n    return window;\r\n  return dom;\r\n}\r\n\r\nexport let modalStack = [];\r\nexport function isModalHead(owner) {\r\n  return modalStack.length === 0 ||\r\n         modalStack[modalStack.length-1] === owner;\r\n}\r\n\r\nexport class EventHandler {\r\n  pushPointerModal(dom, pointerId) {\r\n    if (this._modalstate) {\r\n      console.warn(\"pushPointerModal called twiced!\");\r\n      return;\r\n    }\r\n    \r\n    this._modalstate = simple_events.pushPointerModal(this, dom, pointerId);\r\n  }\r\n  pushModal(dom, _is_root) {\r\n    if (this._modalstate) {\r\n      console.warn(\"pushModal called twiced!\");\r\n      return;\r\n    }\r\n    \r\n    this._modalstate = simple_events.pushModalLight(this);\r\n  }\r\n  \r\n  popModal() {\r\n    if (this._modalstate !== undefined) {\r\n      let modalstate = this._modalstate;\r\n\r\n      //window.setTimeout(() => {\r\n        simple_events.popModalLight(modalstate);\r\n      //});\r\n\r\n      this._modalstate = undefined;\r\n    }\r\n  }\r\n}\r\n\r\nexport function pushModal(dom, handlers) {\r\n  console.warn(\"Deprecated call to pathux.events.pushModal; use api in simple_events.js instead\");\r\n  let h = new EventHandler();\r\n  \r\n  for (let k in handlers) {\r\n    h[k] = handlers[k];\r\n  }\r\n  \r\n  handlers.popModal = () => {\r\n    return h.popModal(dom);\r\n  }\r\n  \r\n  h.pushModal(dom, false);\r\n  \r\n  return h;\r\n}\r\n","import nstructjs from \"../util/struct.js\";\r\nimport * as util from '../util/util.js';\r\n\r\nexport const CurveConstructors = [];\r\nexport const CURVE_VERSION = 1.0;\r\n\r\nexport const CurveFlags = {\r\n  SELECT: 1\r\n};\r\n\r\n\r\nexport const TangentModes = {\r\n  SMOOTH: 1,\r\n  BREAK : 2\r\n};\r\n\r\nexport function getCurve(type, throw_on_error = true) {\r\n  for (let cls of CurveConstructors) {\r\n    if (cls.name === type)\r\n      return cls;\r\n    if (cls.define().name === type)\r\n      return cls;\r\n  }\r\n\r\n  if (throw_on_error) {\r\n    throw new Error(\"Unknown curve type \" + type)\r\n  } else {\r\n    console.warn(\"Unknown curve type\", type);\r\n    return getCurve(\"ease\");\r\n  }\r\n}\r\n\r\nlet _udigest = new util.HashDigest();\r\n\r\nexport class CurveTypeData {\r\n  constructor() {\r\n    this.type = this.constructor.define().typeName;\r\n  }\r\n\r\n  get hasGUI() {\r\n    throw new Error(\"get hasGUI(): implement me!\");\r\n  }\r\n\r\n  static register(cls) {\r\n    if (cls.define === CurveTypeData.define) {\r\n      throw new Error(\"missing define() static method\");\r\n    }\r\n\r\n    let def = cls.define();\r\n\r\n    if (!def.name) {\r\n      throw new Error(cls.name + \".define() result is missing 'name' field\");\r\n    }\r\n\r\n    if (!def.typeName) {\r\n      throw new Error(cls.name + \".define() is missing .typeName, which should equal class name; needed for minificaiton\");\r\n    }\r\n\r\n    CurveConstructors.push(cls);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      uiname  : \"Some Curve\",\r\n      name    : \"somecurve\",\r\n      typeName: CurveTypeData\r\n    }\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    let d = digest;\r\n\r\n    d.add(this.type);\r\n\r\n    return d.get();\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      type: this.type\r\n    }\r\n  }\r\n\r\n  equals(b) {\r\n    return this.type === b.type;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    this.type = obj.type;\r\n\r\n    return this;\r\n  }\r\n\r\n  redraw() {\r\n    if (this.parent)\r\n      this.parent.redraw();\r\n  }\r\n\r\n  makeGUI(container) {\r\n\r\n  }\r\n\r\n  killGUI(container) {\r\n    container.clear();\r\n  }\r\n\r\n  evaluate(s) {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  integrate(s1, quadSteps = 64) {\r\n    let ret = 0.0, ds = s1/quadSteps;\r\n\r\n    for (let i = 0, s = 0; i < quadSteps; i++, s += ds) {\r\n      ret += this.evaluate(s)*ds;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  derivative(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.evaluate(s) - this.evaluate(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.evaluate(s + df) - this.evaluate(s))/df;\r\n    } else {\r\n      return (this.evaluate(s + df) - this.evaluate(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  derivative2(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.derivative(s) - this.derivative(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.derivative(s + df) - this.derivative(s))/df;\r\n    } else {\r\n      return (this.derivative(s + df) - this.derivative(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  inverse(y) {\r\n    let steps = 9;\r\n    let ds = 1.0/steps, s = 0.0;\r\n    let best = undefined;\r\n    let ret = undefined;\r\n\r\n    for (let i = 0; i < steps; i++, s += ds) {\r\n      let s1 = s, s2 = s + ds;\r\n\r\n      let mid;\r\n\r\n      for (let j = 0; j < 11; j++) {\r\n        let y1 = this.evaluate(s1);\r\n        let y2 = this.evaluate(s2);\r\n        mid = (s1 + s2)*0.5;\r\n\r\n        if (Math.abs(y1 - y) < Math.abs(y2 - y)) {\r\n          s2 = mid;\r\n        } else {\r\n          s1 = mid;\r\n        }\r\n      }\r\n\r\n      let ymid = this.evaluate(mid);\r\n\r\n      if (best === undefined || Math.abs(y - ymid) < best) {\r\n        best = Math.abs(y - ymid);\r\n        ret = mid;\r\n      }\r\n    }\r\n\r\n    return ret === undefined ? 0.0 : ret;\r\n  }\r\n\r\n  onActive(parent, draw_transform) {\r\n  }\r\n\r\n  onInactive(parent, draw_transform) {\r\n  }\r\n\r\n  reset() {\r\n\r\n  }\r\n\r\n  destroy() {\r\n  }\r\n\r\n  update() {\r\n    if (this.parent)\r\n      this.parent._on_change();\r\n  }\r\n\r\n  draw(canvas, g, draw_transform) {\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n  }\r\n}\r\n\r\nCurveTypeData.STRUCT = `\r\nCurveTypeData {\r\n  type : string;\r\n}\r\n`;\r\nnstructjs.register(CurveTypeData);\r\n\r\n\r\nexport function evalHermiteTable(table, t) {\r\n  let s = t*(table.length/4);\r\n\r\n  let i = Math.floor(s);\r\n  s -= i;\r\n\r\n  i *= 4;\r\n\r\n  let a = table[i] + (table[i + 1] - table[i])*s;\r\n  let b = table[i + 2] + (table[i + 3] - table[i + 2])*s;\r\n\r\n  return a + (b - a)*s;\r\n  //return table[i] + (table[i + 3] - table[i])*s;\r\n}\r\n\r\nexport function genHermiteTable(evaluate, steps) {\r\n  //console.log(\"building spline approx\");\r\n\r\n  let table = new Array(steps);\r\n\r\n  let eps = 0.00001;\r\n  let dt = (1.0 - eps*4.001)/(steps - 1);\r\n  let t = eps*4;\r\n  let lastdv1, lastf3;\r\n\r\n  for (let j = 0; j < steps; j++, t += dt) {\r\n    //let f1 = evaluate(t - eps*2);\r\n    let f2 = evaluate(t - eps);\r\n    let f3 = evaluate(t);\r\n    let f4 = evaluate(t + eps);\r\n    //let f5 = evaluate(t + eps*2);\r\n\r\n    let dv1 = (f4 - f2)/(eps*2);\r\n    dv1 /= steps;\r\n\r\n    if (j > 0) {\r\n      let j2 = j - 1;\r\n\r\n      table[j2*4] = lastf3;\r\n      table[j2*4 + 1] = lastf3 + lastdv1/3.0;\r\n      table[j2*4 + 2] = f3 - dv1/3.0;\r\n      table[j2*4 + 3] = f3;\r\n    }\r\n\r\n    lastdv1 = dv1;\r\n    lastf3 = f3;\r\n  }\r\n\r\n  return table;\r\n}\r\n","\"use strict\";\r\n\r\nimport nstructjs from \"../util/struct.js\";\r\nimport config from '../config/config.js';\r\n\r\nimport * as util from '../util/util.js';\r\n//import * as ui_base from './ui_base.js';\r\nimport * as vectormath from '../util/vectormath.js';\r\n//import {EventDispatcher} from \"../util/events.js\";\r\n\r\nlet Vector2 = vectormath.Vector2;\r\n\r\nexport const SplineTemplates = {\r\n  CONSTANT      : 0,\r\n  LINEAR        : 1,\r\n  SHARP         : 2,\r\n  SQRT          : 3,\r\n  SMOOTH        : 4,\r\n  SMOOTHER      : 5,\r\n  SHARPER       : 6,\r\n  SPHERE        : 7,\r\n  REVERSE_LINEAR: 8,\r\n  GUASSIAN      : 9\r\n};\r\n\r\nconst templates = {\r\n  [SplineTemplates.CONSTANT]      : [\r\n    [1, 1], [1, 1]\r\n  ],\r\n  [SplineTemplates.LINEAR]        : [\r\n    [0, 0], [1, 1]\r\n  ],\r\n  [SplineTemplates.SHARP]         : [\r\n    [0, 0], [0.9999, 0.0001], [1, 1]\r\n  ],\r\n  [SplineTemplates.SQRT]          : [\r\n    [0, 0], [0.05, 0.25], [0.33, 0.65], [1, 1]\r\n  ],\r\n  [SplineTemplates.SMOOTH]        : [\r\n    \"DEG\", 2, [0, 0], [1.0/3.0, 0], [2.0/3.0, 1.0], [1, 1]\r\n  ],\r\n  [SplineTemplates.SMOOTHER]      : [\r\n    \"DEG\", 6, [0, 0], [1.0/2.25, 0], [2.0/3.0, 1.0], [1, 1]\r\n  ],\r\n  [SplineTemplates.SHARPER]       : [\r\n    [0, 0], [0.3, 0.03], [0.7, 0.065], [0.9, 0.16], [1, 1]\r\n  ],\r\n  [SplineTemplates.SPHERE]        : [\r\n    [0, 0], [0.01953, 0.23438], [0.08203, 0.43359], [0.18359, 0.625], [0.35938, 0.81641], [0.625, 0.97656], [1, 1]\r\n  ],\r\n  [SplineTemplates.REVERSE_LINEAR]: [\r\n    [0, 1], [1, 0]\r\n  ],\r\n  [SplineTemplates.GUASSIAN]      : [\r\n    \"DEG\", 5, [0, 0], [0.17969, 0.007], [0.48958, 0.01172], [0.77995, 0.99609], [1, 1]\r\n  ]\r\n};\r\n\r\n//is initialized below\r\nexport const SplineTemplateIcons = {};\r\n\r\nlet RecalcFlags = {\r\n  BASIS: 1,\r\n  FULL : 2,\r\n  ALL  : 3,\r\n\r\n  //private flag\r\n  FULL_BASIS: 4\r\n}\r\n\r\nexport function mySafeJSONStringify(obj) {\r\n  return JSON.stringify(obj.toJSON(), function (key) {\r\n    let v = this[key];\r\n\r\n    if (typeof v === \"number\") {\r\n      if (v !== Math.floor(v)) {\r\n        v = parseFloat(v.toFixed(5));\r\n      } else {\r\n        v = v;\r\n      }\r\n    }\r\n\r\n    return v;\r\n  });\r\n}\r\n\r\nexport function mySafeJSONParse(buf) {\r\n  return JSON.parse(buf, (key, val) => {\r\n\r\n  });\r\n};\r\n\r\nwindow.mySafeJSONStringify = mySafeJSONStringify;\r\n\r\n\r\nlet bin_cache = {};\r\nwindow._bin_cache = bin_cache;\r\n\r\nlet eval2_rets = util.cachering.fromConstructor(Vector2, 32);\r\n\r\n/*\r\n  I hate these stupid curve widgets.  This horrible one here works by\r\n  root-finding the x axis on a two dimensional b-spline (which works\r\n  surprisingly well).\r\n*/\r\n\r\nfunction bez3(a, b, c, t) {\r\n  let r1 = a + (b - a)*t;\r\n  let r2 = b + (c - b)*t;\r\n\r\n  return r1 + (r2 - r1)*t;\r\n}\r\n\r\nfunction bez4(a, b, c, d, t) {\r\n  let r1 = bez3(a, b, c, t);\r\n  let r2 = bez3(b, c, d, t);\r\n\r\n  return r1 + (r2 - r1)*t;\r\n}\r\n\r\nexport function binomial(n, i) {\r\n  if (i > n) {\r\n    throw new Error(\"Bad call to binomial(n, i), i was > than n\");\r\n  }\r\n\r\n  if (i === 0 || i === n) {\r\n    return 1;\r\n  }\r\n\r\n  let key = \"\" + n + \",\" + i;\r\n\r\n  if (key in bin_cache)\r\n    return bin_cache[key];\r\n\r\n  let ret = binomial(n - 1, i - 1) + bin(n - 1, i);\r\n  bin_cache[key] = ret;\r\n\r\n  return ret;\r\n}\r\n\r\nwindow.bin = binomial;\r\n\r\nimport {CurveFlags, TangentModes, CurveTypeData} from './curve1d_base.js';\r\n\r\nexport class Curve1DPoint extends Vector2 {\r\n  constructor(co) {\r\n    super(co);\r\n\r\n    this.rco = new Vector2(co);\r\n    this.sco = new Vector2(co);\r\n\r\n    //for transform\r\n    this.startco = new Vector2();\r\n    this.eid = -1;\r\n    this.flag = 0;\r\n\r\n    this.tangent = TangentModes.SMOOTH;\r\n\r\n    Object.seal(this);\r\n  }\r\n\r\n  set deg(v) {\r\n    console.warn(\"old file data detected\");\r\n  }\r\n\r\n  static fromJSON(obj) {\r\n    let ret = new Curve1DPoint(obj);\r\n\r\n    ret.eid = obj.eid;\r\n    ret.flag = obj.flag;\r\n    ret.tangent = obj.tangent;\r\n\r\n    ret.rco.load(obj.rco);\r\n\r\n    return ret;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new Curve1DPoint(this);\r\n\r\n    ret.tangent = this.tangent;\r\n    ret.flag = this.flag;\r\n    ret.eid = this.eid;\r\n\r\n    ret.startco.load(this.startco);\r\n    ret.rco.load(this.rco);\r\n    ret.sco.load(this.sco);\r\n\r\n    return ret;\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      0: this[0],\r\n      1: this[1],\r\n\r\n      eid    : this.eid,\r\n      flag   : this.flag,\r\n      tangent: this.tangent,\r\n\r\n      rco: this.rco\r\n    };\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    this.sco.load(this);\r\n    this.rco.load(this);\r\n\r\n    splineCache.update(this);\r\n  }\r\n};\r\nCurve1DPoint.STRUCT = `\r\nCurve1DPoint {\r\n  0       : float;\r\n  1       : float;\r\n  eid     : int;\r\n  flag    : int;\r\n  tangent : int;\r\n  rco     : vec2;\r\n}\r\n`;\r\nnstructjs.register(Curve1DPoint);\r\n\r\nlet _udigest = new util.HashDigest();\r\n\r\nclass BSplineCache {\r\n  constructor() {\r\n    this.curves = [];\r\n    this.map = new Map();\r\n    this.maxCurves = 32;\r\n    this.gen = 0;\r\n  }\r\n\r\n  limit() {\r\n    if (this.curves.length <= this.maxCurves) {\r\n      return;\r\n    }\r\n\r\n    this.curves.sort((a, b) => b.cache_w - a.cache_w);\r\n    while (this.curves.length > this.maxCurves) {\r\n      let curve = this.curves.pop();\r\n      this.map.delete(curve.calcHashKey());\r\n    }\r\n  }\r\n\r\n  has(curve) {\r\n    let curve2 = this.map.get(curve.calcHashKey());\r\n    return curve2 && curve2.equals(curve);\r\n  }\r\n\r\n  get(curve) {\r\n    let key = curve.calcHashKey();\r\n    curve._last_cache_key = key;\r\n\r\n    let curve2 = this.map.get(key);\r\n    if (curve2 && curve2.equals(curve)) {\r\n      curve2.cache_w = this.gen++;\r\n      return curve2;\r\n    }\r\n\r\n    curve2 = curve.copy();\r\n    curve2._last_cache_key = key;\r\n\r\n    curve2.updateKnots();\r\n    curve2.regen_basis();\r\n    curve2.regen_hermite();\r\n\r\n    this.map.set(curve2);\r\n    this.curves.push(curve2);\r\n\r\n    curve2.cache_w = this.gen++;\r\n\r\n    this.limit();\r\n\r\n    return curve2;\r\n  }\r\n\r\n  _remove(key) {\r\n    let curve = this.map.get(key);\r\n    this.map.delete(key);\r\n    this.curves.remove(curve);\r\n  }\r\n\r\n  update(curve) {\r\n    let key = curve._last_cache_key;\r\n\r\n    if (this.map.has(key)) {\r\n      this._remove(curve);\r\n      this.get(curve);\r\n    }\r\n  }\r\n}\r\n\r\nlet splineCache = new BSplineCache();\r\nwindow._splineCache = splineCache;\r\n\r\nclass BSplineCurve extends CurveTypeData {\r\n  constructor() {\r\n    super();\r\n\r\n    this.cache_w = 0;\r\n    this._last_cache_key = 0;\r\n\r\n    this._last_update_key = \"\";\r\n\r\n    this.fastmode = false;\r\n    this.points = [];\r\n    this.length = 0;\r\n    this.interpolating = false;\r\n\r\n    this.range = [new Vector2([0, 1]), new Vector2([0, 1])];\r\n\r\n    this._ps = [];\r\n    this.hermite = [];\r\n    this.fastmode = false;\r\n\r\n    this.deg = 6;\r\n    this.recalc = RecalcFlags.ALL;\r\n    this.basis_tables = [];\r\n    this.eidgen = new util.IDGen();\r\n\r\n    this.add(0, 0);\r\n    this.add(1, 1);\r\n\r\n    this.mpos = new Vector2();\r\n\r\n    this.on_mousedown = this.on_mousedown.bind(this);\r\n    this.on_mousemove = this.on_mousemove.bind(this);\r\n    this.on_mouseup = this.on_mouseup.bind(this);\r\n    this.on_keydown = this.on_keydown.bind(this);\r\n    this.on_touchstart = this.on_touchstart.bind(this);\r\n    this.on_touchmove = this.on_touchmove.bind(this);\r\n    this.on_touchend = this.on_touchend.bind(this);\r\n    this.on_touchcancel = this.on_touchcancel.bind(this);\r\n  }\r\n\r\n  get hasGUI() {\r\n    return this.uidata !== undefined;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      uiname  : \"B-Spline\",\r\n      name    : \"bspline\",\r\n      typeName: \"BSplineCurve\"\r\n    }\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    let d = digest;\r\n\r\n    super.calcHashKey(d);\r\n\r\n    d.add(this.deg);\r\n    d.add(this.interpolating);\r\n\r\n    for (let p of this.points) {\r\n      let x = ~~(p[0]*1024);\r\n      let y = ~~(p[1]*1024);\r\n\r\n      d.add(x);\r\n      d.add(y);\r\n      d.add(p.tangent); //is an enum\r\n    }\r\n\r\n    d.add(this.range[0][0]);\r\n    d.add(this.range[0][1]);\r\n    d.add(this.range[1][0]);\r\n    d.add(this.range[1][1]);\r\n\r\n    return d.get();\r\n  }\r\n\r\n  copyTo(b) {\r\n    b.deg = this.deg;\r\n    b.interpolating = this.interpolating;\r\n    b.fastmode = this.fastmode;\r\n\r\n    for (let p of this.points) {\r\n      let p2 = p.copy();\r\n\r\n      b.points.push(p2);\r\n    }\r\n\r\n    return b;\r\n  }\r\n\r\n  copy() {\r\n    let curve = new BSplineCurve();\r\n    this.copyTo(curve);\r\n    return curve;\r\n  }\r\n\r\n  equals(b) {\r\n    if (b.type !== this.type) {\r\n      return false;\r\n    }\r\n\r\n    let bad = this.points.length !== b.points.length;\r\n\r\n    bad = bad || this.deg !== b.deg;\r\n    bad = bad || this.interpolating !== b.interpolating;\r\n\r\n    if (bad) {\r\n      return false;\r\n    }\r\n\r\n    for (let i = 0; i < this.points.length; i++) {\r\n      let p1 = this.points[i];\r\n      let p2 = b.points[i];\r\n\r\n      let dist = p1.vectorDistance(p2);\r\n\r\n      if (p1.vectorDistance(p2) > 0.00001) {\r\n        return false;\r\n      }\r\n\r\n      if (p1.tangent !== p2.tangent) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  remove(p) {\r\n    let ret = this.points.remove(p);\r\n    this.length = this.points.length;\r\n\r\n    return ret;\r\n  }\r\n\r\n  add(x, y, no_update = false) {\r\n    let p = new Curve1DPoint();\r\n    this.recalc = RecalcFlags.ALL;\r\n\r\n    p.eid = this.eidgen.next();\r\n\r\n    p[0] = x;\r\n    p[1] = y;\r\n\r\n    p.sco.load(p);\r\n    p.rco.load(p);\r\n\r\n    this.points.push(p);\r\n    if (!no_update) {\r\n      this.update();\r\n    }\r\n\r\n    this.length = this.points.length;\r\n\r\n    return p;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  _sortPoints() {\r\n    if (!this.interpolating) {\r\n      for (let i = 0; i < this.points.length; i++) {\r\n        this.points[i].rco.load(this.points[i]);\r\n      }\r\n    }\r\n\r\n    this.points.sort(function (a, b) {\r\n      return a[0] - b[0];\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  updateKnots(recalc = true, points = this.points) {\r\n    if (recalc) {\r\n      this.recalc = RecalcFlags.ALL;\r\n    }\r\n\r\n    this._sortPoints();\r\n\r\n    this._ps = [];\r\n    if (points.length < 2) {\r\n      return;\r\n    }\r\n    let a = points[0][0], b = points[points.length - 1][0];\r\n\r\n    for (let i = 0; i < points.length - 1; i++) {\r\n      this._ps.push(points[i]);\r\n    }\r\n\r\n    if (points.length < 3) {\r\n      return;\r\n    }\r\n\r\n    let l1 = points[points.length - 1];\r\n    let l2 = points[points.length - 2];\r\n\r\n    let p = l1.copy();\r\n    p.rco[0] = l1.rco[0] - 0.00004;\r\n    p.rco[1] = l2.rco[1] + (l1.rco[1] - l2.rco[1])/3.0;\r\n    //this._ps.push(p);\r\n\r\n    p = l1.copy();\r\n    p.rco[0] = l1.rco[0] - 0.00003;\r\n    p.rco[1] = l2.rco[1] + (l1.rco[1] - l2.rco[1])/3.0;\r\n    //this._ps.push(p);\r\n\r\n    p = l1.copy();\r\n    p.rco[0] = l1.rco[0] - 0.00001;\r\n    p.rco[1] = l2.rco[1] + (l1.rco[1] - l2.rco[1])/3.0;\r\n    this._ps.push(p);\r\n\r\n    p = l1.copy();\r\n    p.rco[0] = l1.rco[0] - 0.00001;\r\n    p.rco[1] = l2.rco[1] + (l1.rco[1] - l2.rco[1])*2.0/3.0;\r\n    this._ps.push(p);\r\n\r\n    this._ps.push(l1);\r\n\r\n    if (!this.interpolating) {\r\n      for (let i = 0; i < this._ps.length; i++) {\r\n        this._ps[i].rco.load(this._ps[i]);\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < points.length; i++) {\r\n      let p = points[i];\r\n      let x = p[0], y = p[1];//this.evaluate(x);\r\n\r\n      p.sco[0] = x;\r\n      p.sco[1] = y;\r\n    }\r\n  }\r\n\r\n  toJSON() {\r\n    this._sortPoints();\r\n\r\n    let ret = super.toJSON();\r\n\r\n    ret = Object.assign(ret, {\r\n      points       : this.points.map(p => p.toJSON()),\r\n      deg          : this.deg,\r\n      interpolating: this.interpolating,\r\n      eidgen       : this.eidgen.toJSON(),\r\n      range        : this.range\r\n    });\r\n\r\n    return ret;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    this.interpolating = obj.interpolating;\r\n    this.deg = obj.deg;\r\n\r\n    this.length = 0;\r\n    this.points = [];\r\n    this._ps = [];\r\n\r\n    if (obj.range) {\r\n      this.range = [new Vector2(obj.range[0]), new Vector2(obj.range[1])];\r\n    }\r\n\r\n    this.hightlight = undefined;\r\n    this.eidgen = util.IDGen.fromJSON(obj.eidgen);\r\n    this.recalc = RecalcFlags.ALL;\r\n    this.mpos = [0, 0];\r\n\r\n    for (let i = 0; i < obj.points.length; i++) {\r\n      this.points.push(Curve1DPoint.fromJSON(obj.points[i]));\r\n    }\r\n\r\n    this.updateKnots();\r\n    this.redraw();\r\n\r\n    return this;\r\n  }\r\n\r\n  basis(t, i) {\r\n    if (this.recalc & RecalcFlags.FULL_BASIS) {\r\n      return this._basis(t, i);\r\n    }\r\n\r\n    if (this.recalc & RecalcFlags.BASIS) {\r\n      this.regen_basis();\r\n      this.recalc &= ~RecalcFlags.BASIS;\r\n    }\r\n\r\n    i = Math.min(Math.max(i, 0), this._ps.length - 1);\r\n    t = Math.min(Math.max(t, 0.0), 1.0)*0.999999999;\r\n\r\n    let table = this.basis_tables[i];\r\n\r\n    let s = t*(table.length/4)*0.99999;\r\n\r\n    let j = ~~s;\r\n    s -= j;\r\n\r\n    j *= 4;\r\n    return table[j] + (table[j + 3] - table[j])*s;\r\n\r\n    return bez4(table[j], table[j + 1], table[j + 2], table[j + 3], s);\r\n  }\r\n\r\n  reset(empty = false) {\r\n    this.length = 0;\r\n    this.points = [];\r\n    this._ps = [];\r\n\r\n    if (!empty) {\r\n      this.add(0, 0, true);\r\n      this.add(1, 1, true);\r\n    }\r\n\r\n    this.recalc = 1;\r\n    this.updateKnots();\r\n    this.update();\r\n\r\n    return this;\r\n  }\r\n\r\n  regen_hermite(steps) {\r\n    if (splineCache.has(this)) {\r\n      console.log(\"loading spline approx from cached bspline data\");\r\n\r\n      this.hermite = splineCache.get(this).hermite;\r\n      return;\r\n    }\r\n\r\n    if (steps === undefined) {\r\n      steps = this.fastmode ? 120 : 340;\r\n    }\r\n\r\n    if (this.interpolating) {\r\n      steps *= 2;\r\n    }\r\n\r\n    this.hermite = new Array(steps);\r\n    let table = this.hermite;\r\n\r\n    let eps = 0.00001;\r\n    let dt = (1.0 - eps*4.001)/(steps - 1);\r\n    let t = eps*4;\r\n    let lastdv1, lastf3;\r\n\r\n    for (let j = 0; j < steps; j++, t += dt) {\r\n      let f1 = this._evaluate(t - eps*2);\r\n      let f2 = this._evaluate(t - eps);\r\n      let f3 = this._evaluate(t);\r\n      let f4 = this._evaluate(t + eps);\r\n      let f5 = this._evaluate(t + eps*2);\r\n\r\n      let dv1 = (f4 - f2)/(eps*2);\r\n      dv1 /= steps;\r\n\r\n      if (j > 0) {\r\n        let j2 = j - 1;\r\n\r\n        table[j2*4] = lastf3;\r\n        table[j2*4 + 1] = lastf3 + lastdv1/3.0;\r\n        table[j2*4 + 2] = f3 - dv1/3.0;\r\n        table[j2*4 + 3] = f3;\r\n      }\r\n\r\n      lastdv1 = dv1;\r\n      lastf3 = f3;\r\n    }\r\n  }\r\n\r\n  solve_interpolating() {\r\n    //this.recalc |= RecalcFlags.FULL_BASIS;\r\n\r\n    for (let p of this._ps) {\r\n      p.rco.load(p);\r\n    }\r\n\r\n    let points = this.points.concat(this.points);\r\n\r\n\r\n    this._evaluate2(0.5);\r\n\r\n    let error1 = (p) => {\r\n      //return p.vectorDistance(this._evaluate2(p[0]));\r\n      return this._evaluate(p[0]) - p[1];\r\n    }\r\n\r\n    let error = (p) => {\r\n      return error1(p);\r\n\r\n      /*\r\n      let err = 0.0;\r\n      for (let p of this.points) {\r\n        //err += error1(p)**2;\r\n        err += Math.abs(error1(p));\r\n      }\r\n\r\n      //return Math.sqrt(err);\r\n      return err;\r\n      //*/\r\n    };\r\n\r\n    let err = 0.0;\r\n    let g = new Vector2();\r\n\r\n    for (let step = 0; step < 25; step++) {\r\n      err = 0.0;\r\n\r\n      for (let p of this._ps) {\r\n        let r1 = error(p);\r\n        const df = 0.000001;\r\n\r\n        err += Math.abs(r1);\r\n\r\n        if (p === this._ps[this._ps.length - 1]) {\r\n          continue;\r\n        }\r\n\r\n        g.zero();\r\n\r\n        for (let i = 0; i < 2; i++) {\r\n          let orig = p.rco[i];\r\n          p.rco[i] += df;\r\n          let r2 = error(p);\r\n          p.rco[i] = orig;\r\n\r\n          g[i] = (r2 - r1)/df;\r\n        }\r\n\r\n        let totgs = g.dot(g);\r\n\r\n        if (totgs < 0.00000001) {\r\n          continue;\r\n        }\r\n\r\n        r1 /= totgs;\r\n        let k = 0.5;\r\n\r\n        p.rco[0] += -r1*g[0]*k;\r\n        p.rco[1] += -r1*g[1]*k;\r\n      }\r\n\r\n      let th = this.fastmode ? 0.001 : 0.00005;\r\n      if (err < th) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    //this.recalc &= ~RecalcFlags.FULL_BASIS;\r\n  }\r\n\r\n  regen_basis() {\r\n    if (splineCache.has(this)) {\r\n      console.log(\"loading from cached bspline data\");\r\n\r\n      this.basis_tables = splineCache.get(this).basis_tables;\r\n      return;\r\n    }\r\n\r\n    //let steps = this.fastmode && !this.interpolating ? 64 : 128;\r\n    let steps = this.fastmode ? 64 : 128;\r\n\r\n    if (this.interpolating) {\r\n      steps *= 2;\r\n    }\r\n\r\n    this.basis_tables = new Array(this._ps.length);\r\n\r\n    for (let i = 0; i < this._ps.length; i++) {\r\n      let table = this.basis_tables[i] = new Array((steps - 1)*4);\r\n\r\n      let eps = 0.00001;\r\n      let dt = (1.0 - eps*8)/(steps - 1);\r\n      let t = eps*4;\r\n      let lastdv1 = 0.0, lastf3 = 0.0;\r\n\r\n      for (let j = 0; j < steps; j++, t += dt) {\r\n        //let f1 = this._basis(t - eps*2, i);\r\n        let f2 = this._basis(t - eps, i);\r\n        let f3 = this._basis(t, i);\r\n        let f4 = this._basis(t + eps, i);\r\n        //let f5 = this._basis(t + eps*2, i);\r\n\r\n        let dv1 = (f4 - f2)/(eps*2);\r\n        dv1 /= steps;\r\n\r\n        if (j > 0) {\r\n          let j2 = j - 1;\r\n\r\n          table[j2*4] = lastf3;\r\n          table[j2*4 + 1] = lastf3 + lastdv1/3.0;\r\n          table[j2*4 + 2] = f3 - dv1/3.0;\r\n          table[j2*4 + 3] = f3;\r\n        }\r\n\r\n        lastdv1 = dv1;\r\n        lastf3 = f3;\r\n      }\r\n    }\r\n  }\r\n\r\n  _basis(t, i) {\r\n    let len = this._ps.length;\r\n    let ps = this._ps;\r\n\r\n    function safe_inv(n) {\r\n      return n === 0 ? 0 : 1.0/n;\r\n    }\r\n\r\n    function bas(s, i, n) {\r\n      let kp = Math.min(Math.max(i - 1, 0), len - 1);\r\n      let kn = Math.min(Math.max(i + 1, 0), len - 1);\r\n      let knn = Math.min(Math.max(i + n, 0), len - 1);\r\n      let knn1 = Math.min(Math.max(i + n + 1, 0), len - 1);\r\n      let ki = Math.min(Math.max(i, 0), len - 1);\r\n\r\n      if (n === 0) {\r\n        return s >= ps[ki].rco[0] && s < ps[kn].rco[0] ? 1 : 0;\r\n      } else {\r\n\r\n        let a = (s - ps[ki].rco[0])*safe_inv(ps[knn].rco[0] - ps[ki].rco[0] + 0.0001);\r\n        let b = (ps[knn1].rco[0] - s)*safe_inv(ps[knn1].rco[0] - ps[kn].rco[0] + 0.0001);\r\n\r\n        return a*bas(s, i, n - 1) + b*bas(s, i + 1, n - 1);\r\n      }\r\n    }\r\n\r\n    let p = this._ps[i].rco, nk, pk;\r\n    let deg = this.deg;\r\n\r\n    let b = bas(t, i - deg, deg);\r\n\r\n    return b;\r\n  }\r\n\r\n  evaluate(t) {\r\n    let a = this.points[0].rco, b = this.points[this.points.length - 1].rco;\r\n\r\n    if (t < a[0]) return a[1];\r\n    if (t > b[0]) return b[1];\r\n\r\n    if (this.points.length === 2) {\r\n      t = (t - a[0])/(b[0] - a[0]);\r\n      return a[1] + (b[1] - a[1])*t;\r\n    }\r\n\r\n    if (this.recalc) {\r\n      this.regen_basis();\r\n\r\n      if (this.interpolating) {\r\n        this.solve_interpolating();\r\n      }\r\n\r\n      this.regen_hermite();\r\n      this.recalc = 0;\r\n    }\r\n\r\n    t *= 0.999999;\r\n\r\n    let table = this.hermite;\r\n    let s = t*(table.length/4);\r\n\r\n    let i = Math.floor(s);\r\n    s -= i;\r\n\r\n    i *= 4;\r\n\r\n    return table[i] + (table[i + 3] - table[i])*s;\r\n  }\r\n\r\n  _evaluate(t) {\r\n    let start_t = t;\r\n\r\n    if (this.points.length > 1) {\r\n      let a = this.points[0], b = this.points[this.points.length - 1];\r\n\r\n      //if (t < a[0]) return a[1];\r\n      //if (t >= b[0]) return b[1];\r\n    }\r\n\r\n    for (let i = 0; i < 35; i++) {\r\n      let df = 0.0001;\r\n      let ret1 = this._evaluate2(t < 0.5 ? t : t - df);\r\n      let ret2 = this._evaluate2(t < 0.5 ? t + df : t);\r\n\r\n      let f1 = Math.abs(ret1[0] - start_t);\r\n      let f2 = Math.abs(ret2[0] - start_t);\r\n      let g = (f2 - f1)/df;\r\n\r\n      if (f1 === f2) break;\r\n\r\n      //if (f1 < 0.0005) break;\r\n\r\n      if (f1 === 0.0 || g === 0.0)\r\n        return this._evaluate2(t)[1];\r\n\r\n      let fac = -(f1/g)*0.5;\r\n      if (fac === 0.0) {\r\n        fac = 0.01;\r\n      } else if (Math.abs(fac) > 0.1) {\r\n        fac = 0.1*Math.sign(fac);\r\n      }\r\n\r\n      t += fac;\r\n      let eps = 0.00001;\r\n      t = Math.min(Math.max(t, eps), 1.0 - eps);\r\n    }\r\n\r\n    return this._evaluate2(t)[1];\r\n  }\r\n\r\n  _evaluate2(t) {\r\n    let ret = eval2_rets.next();\r\n\r\n    t *= 0.9999999;\r\n\r\n    let totbasis = 0;\r\n    let sumx = 0;\r\n    let sumy = 0;\r\n\r\n    for (let i = 0; i < this._ps.length; i++) {\r\n      let p = this._ps[i].rco;\r\n      let b = this.basis(t, i);\r\n\r\n      sumx += b*p[0];\r\n      sumy += b*p[1];\r\n\r\n      totbasis += b;\r\n    }\r\n\r\n    if (totbasis !== 0.0) {\r\n      sumx /= totbasis;\r\n      sumy /= totbasis;\r\n    }\r\n\r\n    ret[0] = sumx;\r\n    ret[1] = sumy;\r\n\r\n    return ret;\r\n  }\r\n\r\n  _wrapTouchEvent(e) {\r\n    return {\r\n      x              : e.touches.length ? e.touches[0].pageX : this.mpos[0],\r\n      y              : e.touches.length ? e.touches[0].pageY : this.mpos[1],\r\n      button         : 0,\r\n      shiftKey       : e.shiftKey,\r\n      altKey         : e.altKey,\r\n      ctrlKey        : e.ctrlKey,\r\n      isTouch        : true,\r\n      commandKey     : e.commandKey,\r\n      stopPropagation: () => e.stopPropagation(),\r\n      preventDefault : () => e.preventDefault()\r\n    };\r\n  }\r\n\r\n  on_touchstart(e) {\r\n    this.mpos[0] = e.touches[0].pageX;\r\n    this.mpos[1] = e.touches[0].pageY;\r\n\r\n    let e2 = this._wrapTouchEvent(e);\r\n\r\n    this.on_mousemove(e2);\r\n    this.on_mousedown(e2);\r\n  }\r\n\r\n  loadTemplate(templ) {\r\n    if (templ === undefined || !templates[templ]) {\r\n      console.warn(\"Unknown bspline template\", templ);\r\n      return;\r\n    }\r\n\r\n    templ = templates[templ];\r\n\r\n    this.reset(true);\r\n    this.deg = 3.0;\r\n\r\n    for (let i = 0; i < templ.length; i++) {\r\n      let p = templ[i];\r\n\r\n      if (p === \"DEG\") {\r\n        this.deg = templ[i + 1];\r\n        i++;\r\n        continue;\r\n      }\r\n\r\n      this.add(p[0], p[1], true);\r\n    }\r\n\r\n    this.recalc = 1;\r\n    this.updateKnots();\r\n    this.update();\r\n    this.redraw();\r\n  }\r\n\r\n  on_touchmove(e) {\r\n    this.mpos[0] = e.touches[0].pageX;\r\n    this.mpos[1] = e.touches[0].pageY;\r\n\r\n    let e2 = this._wrapTouchEvent(e);\r\n    this.on_mousemove(e2);\r\n  }\r\n\r\n  on_touchend(e) {\r\n    this.on_mouseup(this._wrapTouchEvent(e));\r\n  }\r\n\r\n  on_touchcancel(e) {\r\n    this.on_touchend(e);\r\n  }\r\n\r\n  makeGUI(container, canvas, drawTransform) {\r\n    this.uidata = {\r\n      start_mpos : new Vector2(),\r\n      transpoints: [],\r\n\r\n      dom         : container,\r\n      canvas      : canvas,\r\n      g           : canvas.g,\r\n      transforming: false,\r\n      draw_trans  : drawTransform\r\n    };\r\n\r\n    canvas.addEventListener(\"touchstart\", this.on_touchstart);\r\n    canvas.addEventListener(\"touchmove\", this.on_touchmove);\r\n    canvas.addEventListener(\"touchend\", this.on_touchend);\r\n    canvas.addEventListener(\"touchcancel\", this.on_touchcancel);\r\n\r\n    canvas.addEventListener(\"mousedown\", this.on_mousedown);\r\n    canvas.addEventListener(\"mousemove\", this.on_mousemove);\r\n    canvas.addEventListener(\"mouseup\", this.on_mouseup);\r\n    canvas.addEventListener(\"keydown\", this.on_keydown);\r\n\r\n    let bstrip = container.row().strip();\r\n\r\n    let makebutton = (strip, k) => {\r\n      let uiname = k[0] + k.slice(1, k.length).toLowerCase();\r\n      uiname = uiname.replace(/_/g, \" \");\r\n\r\n      let icon = strip.iconbutton(-1, uiname, () => {\r\n        this.loadTemplate(SplineTemplates[k]);\r\n      });\r\n\r\n      icon.iconsheet = 0;\r\n      icon.customIcon = SplineTemplateIcons[k];\r\n    }\r\n\r\n    for (let k in SplineTemplates) {\r\n      makebutton(bstrip, k);\r\n    }\r\n\r\n    let row = container.row();\r\n\r\n    let fullUpdate = () => {\r\n      this.updateKnots();\r\n      this.update();\r\n      this.regen_basis();\r\n      this.recalc = RecalcFlags.ALL;\r\n      this.redraw();\r\n    };\r\n\r\n    let Icons = row.constructor.getIconEnum();\r\n\r\n    row.iconbutton(Icons.TINY_X, \"Delete Point\", () => {\r\n      for (let i = 0; i < this.points.length; i++) {\r\n        let p = this.points[i];\r\n\r\n        if (p.flag & CurveFlags.SELECT) {\r\n          this.points.remove(p);\r\n          i--;\r\n        }\r\n      }\r\n\r\n      fullUpdate();\r\n    });\r\n\r\n    row.button(\"Reset\", () => {\r\n      this.reset();\r\n    });\r\n\r\n    let slider = row.simpleslider(undefined, \"Degree\", this.deg, 1, 6, 1, true, true, (slider) => {\r\n      this.deg = Math.floor(slider.value);\r\n\r\n      fullUpdate();\r\n    });\r\n\r\n    slider.baseUnit = \"none\";\r\n    slider.displayUnit = \"none\";\r\n\r\n    row = container.row();\r\n    let check = row.check(undefined, \"Interpolating\");\r\n    check.checked = this.interpolating;\r\n\r\n    check.onchange = () => {\r\n      this.interpolating = check.value;\r\n      fullUpdate();\r\n    }\r\n\r\n    let panel = container.panel(\"Range\");\r\n\r\n    let xmin = panel.slider(undefined, \"X Min\", this.range[0][0], -10, 10, 0.1, false, undefined, (val) => {\r\n      this.range[0][0] = val.value;\r\n    });\r\n\r\n    let xmax = panel.slider(undefined, \"X Max\", this.range[0][1], -10, 10, 0.1, false, undefined, (val) => {\r\n      this.range[0][1] = val.value;\r\n    });\r\n\r\n    let ymin = panel.slider(undefined, \"Y Min\", this.range[1][0], -10, 10, 0.1, false, undefined, (val) => {\r\n      this.range[1][0] = val.value;\r\n    });\r\n\r\n    let ymax = panel.slider(undefined, \"Y Max\", this.range[1][1], -10, 10, 0.1, false, undefined, (val) => {\r\n      this.range[1][1] = val.value;\r\n    });\r\n\r\n    xmin.displayUnit = xmin.baseUnit = \"none\";\r\n    ymin.displayUnit = ymin.baseUnit = \"none\";\r\n    xmax.displayUnit = xmax.baseUnit = \"none\";\r\n    ymax.displayUnit = ymax.baseUnit = \"none\";\r\n\r\n    panel.closed = true;\r\n\r\n    container.update.after(() => {\r\n      let key = this.calcHashKey();\r\n      if (key !== this._last_update_key) {\r\n        this._last_update_key = key;\r\n\r\n        slider.setValue(this.deg);\r\n        xmin.setValue(this.range[0][0]);\r\n        xmax.setValue(this.range[0][1]);\r\n\r\n        ymin.setValue(this.range[1][0]);\r\n        ymax.setValue(this.range[1][1]);\r\n      }\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  killGUI(container, canvas) {\r\n    if (this.uidata !== undefined) {\r\n      let ud = this.uidata;\r\n      this.uidata = undefined;\r\n\r\n      canvas.removeEventListener(\"touchstart\", this.on_touchstart);\r\n      canvas.removeEventListener(\"touchmove\", this.on_touchmove);\r\n      canvas.removeEventListener(\"touchend\", this.on_touchend);\r\n      canvas.removeEventListener(\"touchcancel\", this.on_touchcancel);\r\n\r\n      canvas.removeEventListener(\"mousedown\", this.on_mousedown);\r\n      canvas.removeEventListener(\"mousemove\", this.on_mousemove);\r\n      canvas.removeEventListener(\"mouseup\", this.on_mouseup);\r\n      canvas.removeEventListener(\"keydown\", this.on_keydown);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  start_transform() {\r\n    this.uidata.transpoints = [];\r\n\r\n    for (let p of this.points) {\r\n      if (p.flag & CurveFlags.SELECT) {\r\n        this.uidata.transpoints.push(p);\r\n        p.startco.load(p);\r\n      }\r\n    }\r\n  }\r\n\r\n  on_mousedown(e) {\r\n    this.uidata.start_mpos.load(this.transform_mpos(e.x, e.y));\r\n    this.fastmode = true;\r\n\r\n    let mpos = this.transform_mpos(e.x, e.y);\r\n    let x = mpos[0], y = mpos[1];\r\n    this.do_highlight(x, y);\r\n\r\n    if (this.points.highlight !== undefined) {\r\n      if (!e.shiftKey) {\r\n        for (let i = 0; i < this.points.length; i++) {\r\n          this.points[i].flag &= ~CurveFlags.SELECT;\r\n        }\r\n\r\n        this.points.highlight.flag |= CurveFlags.SELECT;\r\n      } else {\r\n        this.points.highlight.flag ^= CurveFlags.SELECT;\r\n      }\r\n\r\n\r\n      this.uidata.transforming = true;\r\n\r\n      this.start_transform();\r\n\r\n      this.updateKnots();\r\n      this.update();\r\n      this.redraw();\r\n      return;\r\n    } else { //if (!e.isTouch) {\r\n      let p = this.add(this.uidata.start_mpos[0], this.uidata.start_mpos[1]);\r\n      this.points.highlight = p;\r\n\r\n      this.updateKnots();\r\n      this.update();\r\n      this.redraw();\r\n\r\n      this.points.highlight.flag |= CurveFlags.SELECT;\r\n\r\n      this.uidata.transforming = true;\r\n      this.uidata.transpoints = [this.points.highlight];\r\n      this.uidata.transpoints[0].startco.load(this.uidata.transpoints[0]);\r\n    }\r\n  }\r\n\r\n  do_highlight(x, y) {\r\n    let trans = this.uidata.draw_trans;\r\n    let mindis = 1e17, minp = undefined;\r\n    let limit = 19/trans[0], limitsqr = limit*limit;\r\n\r\n    for (let i = 0; i < this.points.length; i++) {\r\n      let p = this.points[i];\r\n      let dx = x - p.sco[0], dy = y - p.sco[1], dis = dx*dx + dy*dy;\r\n\r\n      if (dis < mindis && dis < limitsqr) {\r\n        mindis = dis;\r\n        minp = p;\r\n      }\r\n    }\r\n\r\n    if (this.points.highlight !== minp) {\r\n      this.points.highlight = minp;\r\n      this.redraw()\r\n    }\r\n  }\r\n\r\n  do_transform(x, y) {\r\n    let off = new Vector2([x, y]).sub(this.uidata.start_mpos);\r\n\r\n    for (let i = 0; i < this.uidata.transpoints.length; i++) {\r\n      let p = this.uidata.transpoints[i];\r\n      p.load(p.startco).add(off);\r\n\r\n      p[0] = Math.min(Math.max(p[0], this.range[0][0]), this.range[0][1]);\r\n      p[1] = Math.min(Math.max(p[1], this.range[1][0]), this.range[1][1]);\r\n    }\r\n\r\n    this.updateKnots();\r\n    this.update();\r\n    this.redraw();\r\n  }\r\n\r\n  transform_mpos(x, y) {\r\n    let r = this.uidata.canvas.getClientRects()[0];\r\n    let dpi = devicePixelRatio; //evil module cycle: UIBase.getDPI();\r\n\r\n    x -= parseInt(r.left);\r\n    y -= parseInt(r.top);\r\n\r\n    x *= dpi;\r\n    y *= dpi;\r\n\r\n    let trans = this.uidata.draw_trans;\r\n\r\n    x = x/trans[0] - trans[1][0];\r\n    y = -y/trans[0] - trans[1][1];\r\n\r\n    return [x, y];\r\n  }\r\n\r\n  on_mousemove(e) {\r\n    if (e.isTouch && this.uidata.transforming) {\r\n      e.preventDefault();\r\n    }\r\n\r\n    let mpos = this.transform_mpos(e.x, e.y);\r\n    let x = mpos[0], y = mpos[1];\r\n\r\n    if (this.uidata.transforming) {\r\n      this.do_transform(x, y);\r\n      this.evaluate(0.5);\r\n      //this.update();\r\n      //this.doSave();\r\n    } else {\r\n      this.do_highlight(x, y);\r\n    }\r\n  }\r\n\r\n  end_transform() {\r\n    this.uidata.transforming = false;\r\n    this.fastmode = false;\r\n    this.updateKnots();\r\n    this.update();\r\n\r\n    splineCache.update(this);\r\n  }\r\n\r\n  on_mouseup(e) {\r\n    this.end_transform();\r\n  }\r\n\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case 88: //xkeey\r\n      case 46: //delete\r\n        if (this.points.highlight !== undefined) {\r\n          this.points.remove(this.points.highlight);\r\n          this.recalc = RecalcFlags.ALL;\r\n\r\n          this.points.highlight = undefined;\r\n          this.updateKnots();\r\n          this.update();\r\n\r\n          if (this._save_hook !== undefined) {\r\n            this._save_hook();\r\n          }\r\n        }\r\n        break;\r\n    }\r\n  }\r\n\r\n  draw(canvas, g, draw_trans) {\r\n    g.save();\r\n\r\n    if (this.uidata === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.uidata.canvas = canvas;\r\n    this.uidata.g = g;\r\n    this.uidata.draw_trans = draw_trans;\r\n\r\n    let sz = draw_trans[0], pan = draw_trans[1];\r\n    g.lineWidth *= 3.0;\r\n\r\n    for (let ssi = 0; ssi < 2; ssi++) {\r\n      break; //uncomment to draw basis functions\r\n      for (let si = 0; si < this.points.length; si++) {\r\n        g.beginPath();\r\n\r\n        let f = 0;\r\n        for (let i = 0; i < steps; i++, f += df) {\r\n          let totbasis = 0;\r\n\r\n          for (let j = 0; j < this.points.length; j++) {\r\n            totbasis += this.basis(f, j);\r\n          }\r\n\r\n          let val = this.basis(f, si);\r\n\r\n          if (ssi)\r\n            val /= (totbasis === 0 ? 1 : totbasis);\r\n\r\n          (i === 0 ? g.moveTo : g.lineTo).call(g, f, ssi ? val : val*0.5, w, w);\r\n        }\r\n\r\n        let color, alpha = this.points[si] === this.points.highlight ? 1.0 : 0.7;\r\n\r\n        if (ssi) {\r\n          color = \"rgba(105, 25, 5,\" + alpha + \")\";\r\n        } else {\r\n          color = \"rgba(25, 145, 45,\" + alpha + \")\";\r\n        }\r\n        g.strokeStyle = color;\r\n        g.stroke();\r\n      }\r\n    }\r\n\r\n    g.lineWidth /= 3.0;\r\n\r\n    let w = 0.03;\r\n\r\n    for (let p of this.points) {\r\n      g.beginPath();\r\n\r\n      if (p === this.points.highlight) {\r\n        g.fillStyle = \"green\";\r\n      } else if (p.flag & CurveFlags.SELECT) {\r\n        g.fillStyle = \"red\";\r\n      } else {\r\n        g.fillStyle = \"orange\";\r\n      }\r\n\r\n      g.rect(p.sco[0] - w/2, p.sco[1] - w/2, w, w);\r\n\r\n      g.fill();\r\n    }\r\n\r\n    g.restore();\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n\r\n    this.updateKnots();\r\n    this.recalc = RecalcFlags.ALL;\r\n  }\r\n}\r\n\r\nBSplineCurve.STRUCT = nstructjs.inherit(BSplineCurve, CurveTypeData) + `\r\n  points        : array(Curve1DPoint);\r\n  deg           : int;\r\n  eidgen        : IDGen;\r\n  interpolating : bool;\r\n  range         : array(vec2);\r\n}\r\n`;\r\nnstructjs.register(BSplineCurve);\r\nCurveTypeData.register(BSplineCurve);\r\n\r\n\r\nfunction makeSplineTemplateIcons(size = 64) {\r\n  let dpi = devicePixelRatio;\r\n  size = ~~(size*dpi);\r\n\r\n  for (let k in SplineTemplates) {\r\n    let curve = new BSplineCurve();\r\n    curve.loadTemplate(SplineTemplates[k])\r\n\r\n    curve.fastmode = true;\r\n\r\n    let canvas = document.createElement(\"canvas\");\r\n    canvas.width = canvas.height = size;\r\n\r\n    let g = canvas.getContext(\"2d\");\r\n    let steps = 64;\r\n\r\n    curve.update();\r\n\r\n    let scale = 0.5;\r\n\r\n    g.translate(-0.5, -0.5);\r\n    g.scale(size*scale, size*scale);\r\n    g.translate(0.5, 0.5);\r\n\r\n    //margin\r\n    let m = 0.0;\r\n\r\n    let tent = f => 1.0 - Math.abs(Math.fract(f) - 0.5)*2.0;\r\n\r\n    for (let i = 0; i < steps; i++) {\r\n      let s = i/(steps - 1);\r\n      let f = 1.0 - curve.evaluate(tent(s));\r\n\r\n      s = s*(1.0 - m*2.0) + m;\r\n      f = f*(1.0 - m*2.0) + m;\r\n\r\n      //s += 0.5;\r\n      //f += 0.5;\r\n\r\n      if (i === 0) {\r\n        g.moveTo(s, f);\r\n      } else {\r\n        g.lineTo(s, f);\r\n      }\r\n    }\r\n\r\n    const ls = 7.0;\r\n\r\n    g.lineCap = \"round\";\r\n    g.strokeStyle = \"black\";\r\n    g.lineWidth = ls*3*dpi/(size*scale);\r\n    g.stroke();\r\n\r\n    g.strokeStyle = \"white\";\r\n    g.lineWidth = ls*dpi/(size*scale);\r\n    g.stroke();\r\n\r\n    let url = canvas.toDataURL();\r\n    let img = document.createElement(\"img\");\r\n    img.src = url;\r\n\r\n    SplineTemplateIcons[k] = img;\r\n    SplineTemplateIcons[SplineTemplates[k]] = img;\r\n  }\r\n}\r\n\r\nlet splineTemplatesLoaded = false;\r\n\r\nexport function initSplineTemplates() {\r\n  if (splineTemplatesLoaded) {\r\n    return;\r\n  }\r\n\r\n  splineTemplatesLoaded = true;\r\n  \r\n  for (let k in SplineTemplates) {\r\n    let curve = new BSplineCurve();\r\n    curve.loadTemplate(SplineTemplates[k]);\r\n    splineCache.get(curve);\r\n  }\r\n\r\n  makeSplineTemplateIcons();\r\n  window._SplineTemplateIcons = SplineTemplateIcons;\r\n}\r\n\r\n//delay to ensure config is fully loaded\r\nwindow.setTimeout(() => {\r\n  if (config.autoLoadSplineTemplates) {\r\n    initSplineTemplates();\r\n  }\r\n}, 0);\r\n\r\n","import nstructjs from \"../util/struct.js\";\r\nimport {CurveFlags, TangentModes, CurveTypeData} from './curve1d_base.js';\r\nimport {Vector2, Vector3, Vector4, Quat, Matrix4} from '../util/vectormath.js';\r\nimport {genHermiteTable, evalHermiteTable} from './curve1d_base.js';\r\nimport * as util from '../util/util.js';\r\n\r\nlet _udigest = new util.HashDigest();\r\n\r\nfunction feq(a, b) {\r\n  return Math.abs(a - b) < 0.00001;\r\n}\r\n\r\nclass EquationCurve extends CurveTypeData {\r\n  constructor(type) {\r\n    super();\r\n\r\n    this.equation = \"x\";\r\n    this._last_equation = \"\";\r\n    this.hermite = undefined;\r\n  }\r\n\r\n  get hasGUI() {\r\n    return this.uidata !== undefined;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      uiname  : \"Equation\",\r\n      name    : \"equation\",\r\n      typeName: \"EquationCurve\"\r\n    }\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    let d = digest;\r\n\r\n    super.calcHashKey(d);\r\n\r\n    d.add(this.equation);\r\n\r\n    return d.get();\r\n  }\r\n\r\n  equals(b) {\r\n    return super.equals(b) && this.equation === b.equation;\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = super.toJSON();\r\n\r\n    return Object.assign(ret, {\r\n      equation: this.equation\r\n    });\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    if (obj.equation !== undefined) {\r\n      this.equation = obj.equation;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  makeGUI(container, canvas, drawTransform) {\r\n    this.uidata = {\r\n      canvas    : canvas,\r\n      g         : canvas.g,\r\n      draw_trans: drawTransform,\r\n    };\r\n\r\n    let row = container.row();\r\n\r\n    let text = this.uidata.textbox = row.textbox(undefined, \"\"+this.equation);\r\n    text.onchange = (val) => {\r\n      console.log(val);\r\n      this.equation = val;\r\n      this.update();\r\n      this.redraw();\r\n    }\r\n\r\n    container.label(\"Equation\");\r\n\r\n  }\r\n\r\n  killGUI(dom, gui, canvas, g, draw_transform) {\r\n    if (this.uidata !== undefined) {\r\n      this.uidata.textbox.remove();\r\n    }\r\n\r\n    this.uidata = undefined;\r\n  }\r\n\r\n  updateTextBox() {\r\n    if (this.uidata && this.uidata.textbox) {\r\n      this.uidata.textbox.text = this.equation;\r\n    }\r\n  }\r\n\r\n  evaluate(s) {\r\n    if (!this.hermite || this._last_equation !== this.equation) {\r\n      this._last_equation = this.equation;\r\n\r\n      this.updateTextBox();\r\n\r\n      this._evaluate(0.0);\r\n\r\n      if (this._haserror) {\r\n        console.warn(\"ERROR!\");\r\n        return 0.0;\r\n      }\r\n\r\n      let steps = 32;\r\n      this.hermite = genHermiteTable((s) => this._evaluate(s), steps);\r\n    }\r\n\r\n    return evalHermiteTable(this.hermite, s);\r\n  }\r\n\r\n  _evaluate(s) {\r\n    let sin = Math.sin, cos = Math.cos, pi = Math.PI, PI = Math.PI,\r\n        e                                                = Math.E, E                                    = Math.E, tan                      = Math.tan, abs      = Math.abs,\r\n        floor                                            = Math.floor, ceil                         = Math.ceil, acos = Math.acos,\r\n        asin                                             = Math.asin, atan                           = Math.atan, cosh = Math.cos,\r\n        sinh                                             = Math.sinh, log                            = Math.log, pow = Math.pow,\r\n        exp                                              = Math.exp, sqrt                             = Math.sqrt, cbrt = Math.cbrt,\r\n        min                                              = Math.min, max = Math.max;\r\n\r\n    try {\r\n      let x = s;\r\n      let ret = eval(this.equation);\r\n\r\n      this._haserror = false;\r\n\r\n      return ret;\r\n    } catch (error) {\r\n      this._haserror = true;\r\n      console.warn(\"ERROR!\");\r\n      return 0.0;\r\n    }\r\n  }\r\n\r\n  derivative(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.evaluate(s) - this.evaluate(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.evaluate(s + df) - this.evaluate(s))/df;\r\n    } else {\r\n      return (this.evaluate(s + df) - this.evaluate(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  derivative2(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.derivative(s) - this.derivative(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.derivative(s + df) - this.derivative(s))/df;\r\n    } else {\r\n      return (this.derivative(s + df) - this.derivative(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  inverse(y) {\r\n    let steps = 9;\r\n    let ds = 1.0/steps, s = 0.0;\r\n    let best = undefined;\r\n    let ret = undefined;\r\n\r\n    for (let i = 0; i < steps; i++, s += ds) {\r\n      let s1 = s, s2 = s + ds;\r\n\r\n      let mid;\r\n\r\n      for (let j = 0; j < 11; j++) {\r\n        let y1 = this.evaluate(s1);\r\n        let y2 = this.evaluate(s2);\r\n        mid = (s1 + s2)*0.5;\r\n\r\n        if (Math.abs(y1 - y) < Math.abs(y2 - y)) {\r\n          s2 = mid;\r\n        } else {\r\n          s1 = mid;\r\n        }\r\n      }\r\n\r\n      let ymid = this.evaluate(mid);\r\n\r\n      if (best === undefined || Math.abs(y - ymid) < best) {\r\n        best = Math.abs(y - ymid);\r\n        ret = mid;\r\n      }\r\n    }\r\n\r\n    return ret === undefined ? 0.0 : ret;\r\n  }\r\n\r\n  onActive(parent, draw_transform) {\r\n  }\r\n\r\n  onInactive(parent, draw_transform) {\r\n  }\r\n\r\n  reset() {\r\n    this.equation = \"x\";\r\n  }\r\n\r\n  destroy() {\r\n  }\r\n\r\n  draw(canvas, g, draw_transform) {\r\n    g.save();\r\n    if (this._haserror) {\r\n\r\n      g.fillStyle = g.strokeStyle = \"rgba(255, 50, 0, 0.25)\";\r\n      g.beginPath();\r\n      g.rect(0, 0, 1, 1);\r\n      g.fill();\r\n\r\n      g.beginPath();\r\n      g.moveTo(0, 0);\r\n      g.lineTo(1, 1);\r\n      g.moveTo(0, 1);\r\n      g.lineTo(1, 0);\r\n\r\n      g.lineWidth *= 3;\r\n      g.stroke();\r\n\r\n      g.restore();\r\n      return;\r\n    }\r\n\r\n    g.restore();\r\n  }\r\n}\r\n\r\nEquationCurve.STRUCT = nstructjs.inherit(EquationCurve, CurveTypeData) + `\r\n  equation : string;\r\n}\r\n`;\r\nnstructjs.register(EquationCurve);\r\nCurveTypeData.register(EquationCurve);\r\n\r\n\r\nclass GuassianCurve extends CurveTypeData {\r\n  constructor(type) {\r\n    super();\r\n\r\n    this.height = 1.0;\r\n    this.offset = 1.0;\r\n    this.deviation = 0.3; //standard deviation\r\n  }\r\n\r\n  get hasGUI() {\r\n    return this.uidata !== undefined;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      uiname  : \"Guassian\",\r\n      name    : \"guassian\",\r\n      typeName: \"GuassianCurve\"\r\n    }\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    super.calcHashKey(digest);\r\n\r\n    let d = digest;\r\n\r\n    d.add(this.height);\r\n    d.add(this.offset);\r\n    d.add(this.deviation);\r\n\r\n    return d.get();\r\n  }\r\n\r\n  equals(b) {\r\n    let r = super.equals(b);\r\n\r\n    r = r && feq(this.height, b.height);\r\n    r = r && feq(this.offset, b.offset);\r\n    r = r && feq(this.deviation, b.deviation);\r\n\r\n    return r;\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = super.toJSON();\r\n\r\n    return Object.assign(ret, {\r\n      height   : this.height,\r\n      offset   : this.offset,\r\n      deviation: this.deviation\r\n    });\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    this.height = obj.height !== undefined ? obj.height : 1.0;\r\n    this.offset = obj.offset;\r\n    this.deviation = obj.deviation;\r\n\r\n    return this;\r\n  }\r\n\r\n  makeGUI(container, canvas, drawTransform) {\r\n    this.uidata = {\r\n      canvas    : canvas,\r\n      g         : canvas.g,\r\n      draw_trans: drawTransform,\r\n    };\r\n\r\n    this.uidata.hslider = container.slider(undefined, \"Height\", this.height, -10, 10, 0.0001);\r\n    this.uidata.hslider.onchange = () => {\r\n      this.height = this.uidata.hslider.value;\r\n      this.redraw();\r\n      this.update();\r\n    }\r\n    this.uidata.oslider = container.slider(undefined, \"Offset\", this.offset, -10, 10, 0.0001);\r\n    this.uidata.oslider.onchange = () => {\r\n      this.offset = this.uidata.oslider.value;\r\n      this.redraw();\r\n      this.update();\r\n    }\r\n    this.uidata.dslider = container.slider(undefined, \"STD Deviation\", this.deviation, -10, 10, 0.0001);\r\n    this.uidata.dslider.onchange = () => {\r\n      this.deviation = this.uidata.dslider.value;\r\n      this.redraw();\r\n      this.update();\r\n    }\r\n\r\n    /*\r\n    this.uidata.oslider = gui.slider(undefined, \"Offset\", this.offset,\r\n      -2.5, 2.5, 0.0001, false, false, (val) => {this.offset = val, this.update(), this.redraw();});\r\n    this.uidata.dslider = gui.slider(undefined, \"STD Deviation\", this.deviation,\r\n      0.0001, 1.25, 0.0001, false, false, (val) => {this.deviation = val, this.update(), this.redraw();});\r\n    //*/\r\n  }\r\n\r\n  killGUI(dom, gui, canvas, g, draw_transform) {\r\n    if (this.uidata !== undefined) {\r\n      this.uidata.hslider.remove();\r\n      this.uidata.oslider.remove();\r\n      this.uidata.dslider.remove();\r\n    }\r\n\r\n    this.uidata = undefined;\r\n  }\r\n\r\n  evaluate(s) {\r\n    let r = this.height*Math.exp(-((s - this.offset)*(s - this.offset))/(2*this.deviation*this.deviation));\r\n    return r;\r\n  }\r\n\r\n  derivative(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.evaluate(s) - this.evaluate(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.evaluate(s + df) - this.evaluate(s))/df;\r\n    } else {\r\n      return (this.evaluate(s + df) - this.evaluate(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  derivative2(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.derivative(s) - this.derivative(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.derivative(s + df) - this.derivative(s))/df;\r\n    } else {\r\n      return (this.derivative(s + df) - this.derivative(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  inverse(y) {\r\n    let steps = 9;\r\n    let ds = 1.0/steps, s = 0.0;\r\n    let best = undefined;\r\n    let ret = undefined;\r\n\r\n    for (let i = 0; i < steps; i++, s += ds) {\r\n      let s1 = s, s2 = s + ds;\r\n\r\n      let mid;\r\n\r\n      for (let j = 0; j < 11; j++) {\r\n        let y1 = this.evaluate(s1);\r\n        let y2 = this.evaluate(s2);\r\n        mid = (s1 + s2)*0.5;\r\n\r\n        if (Math.abs(y1 - y) < Math.abs(y2 - y)) {\r\n          s2 = mid;\r\n        } else {\r\n          s1 = mid;\r\n        }\r\n      }\r\n\r\n      let ymid = this.evaluate(mid);\r\n\r\n      if (best === undefined || Math.abs(y - ymid) < best) {\r\n        best = Math.abs(y - ymid);\r\n        ret = mid;\r\n      }\r\n    }\r\n\r\n    return ret === undefined ? 0.0 : ret;\r\n  }\r\n}\r\n\r\nGuassianCurve.STRUCT = nstructjs.inherit(GuassianCurve, CurveTypeData) + `\r\n  height    : float;\r\n  offset    : float;\r\n  deviation : float;\r\n}\r\n`;\r\nnstructjs.register(GuassianCurve);\r\nCurveTypeData.register(GuassianCurve);\r\n","/*\r\n* Ease\r\n* Visit http://createjs.com/ for documentation, updates and examples.\r\n*\r\n* Copyright (c) 2010 gskinner.com, inc.\r\n*\r\n* Permission is hereby granted, free of charge, to any person\r\n* obtaining a copy of this software and associated documentation\r\n* files (the \"Software\"), to deal in the Software without\r\n* restriction, including without limitation the rights to use,\r\n* copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n* copies of the Software, and to permit persons to whom the\r\n* Software is furnished to do so, subject to the following\r\n* conditions:\r\n*\r\n* The above copyright notice and this permission notice shall be\r\n* included in all copies or substantial portions of the Software.\r\n*\r\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\r\n* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\r\n* OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\r\n* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\r\n* HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\r\n* WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\r\n* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\r\n* OTHER DEALINGS IN THE SOFTWARE.\r\n*/\r\n\r\n/**\r\n* @module TweenJS\r\n*/\r\n\r\n\r\n/**\r\n * The Ease class provides a collection of easing functions for use with TweenJS. It does not use the standard 4 param\r\n * easing signature. Instead it uses a single param which indicates the current linear ratio (0 to 1) of the tween.\r\n *\r\n * Most methods on Ease can be passed directly as easing functions:\r\n *\r\n *      createjs.Tween.get(target).to({x:100}, 500, createjs.Ease.linear);\r\n *\r\n * However, methods beginning with \"get\" will return an easing function based on parameter values:\r\n *\r\n *      createjs.Tween.get(target).to({y:200}, 500, createjs.Ease.getPowIn(2.2));\r\n *\r\n * Please see the <a href=\"http://www.createjs.com/Demos/TweenJS/Tween_SparkTable\">spark table demo</a> for an\r\n * overview of the different ease types on <a href=\"http://tweenjs.com\">TweenJS.com</a>.\r\n *\r\n * <em>Equations derived from work by Robert Penner.</em>\r\n * @class Ease\r\n * @static\r\n **/\r\n\r\n\r\nfunction Ease() {\r\n  throw \"Ease cannot be instantiated.\";\r\n}\r\n\r\nexport default Ease;\r\n\r\n// static methods and properties\r\n/**\r\n * @method linear\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.linear = function(t) { return t; };\r\n\r\n/**\r\n * Identical to linear.\r\n * @method none\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.none = Ease.linear;\r\n\r\n/**\r\n * Mimics the simple -100 to 100 easing in Adobe Flash/Animate.\r\n * @method get\r\n * @param {Number} amount A value from -1 (ease in) to 1 (ease out) indicating the strength and direction of the ease.\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.get = function(amount) {\r\n  if (amount < -1) { amount = -1; }\r\n  else if (amount > 1) { amount = 1; }\r\n  return function(t) {\r\n    if (amount==0) { return t; }\r\n    if (amount<0) { return t*(t*-amount+1+amount); }\r\n    return t*((2-t)*amount+(1-amount));\r\n  };\r\n};\r\n\r\n/**\r\n * Configurable exponential ease.\r\n * @method getPowIn\r\n * @param {Number} pow The exponent to use (ex. 3 would return a cubic ease).\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getPowIn = function(pow) {\r\n  return function(t) {\r\n    return Math.pow(t,pow);\r\n  };\r\n};\r\n\r\n/**\r\n * Configurable exponential ease.\r\n * @method getPowOut\r\n * @param {Number} pow The exponent to use (ex. 3 would return a cubic ease).\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getPowOut = function(pow) {\r\n  return function(t) {\r\n    return 1-Math.pow(1-t,pow);\r\n  };\r\n};\r\n\r\n/**\r\n * Configurable exponential ease.\r\n * @method getPowInOut\r\n * @param {Number} pow The exponent to use (ex. 3 would return a cubic ease).\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getPowInOut = function(pow) {\r\n  return function(t) {\r\n    if ((t*=2)<1) return 0.5*Math.pow(t,pow);\r\n    return 1-0.5*Math.abs(Math.pow(2-t,pow));\r\n  };\r\n};\r\n\r\n/**\r\n * @method quadIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quadIn = Ease.getPowIn(2);\r\n/**\r\n * @method quadOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quadOut = Ease.getPowOut(2);\r\n/**\r\n * @method quadInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quadInOut = Ease.getPowInOut(2);\r\n\r\n/**\r\n * @method cubicIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.cubicIn = Ease.getPowIn(3);\r\n/**\r\n * @method cubicOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.cubicOut = Ease.getPowOut(3);\r\n/**\r\n * @method cubicInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.cubicInOut = Ease.getPowInOut(3);\r\n\r\n/**\r\n * @method quartIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quartIn = Ease.getPowIn(4);\r\n/**\r\n * @method quartOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quartOut = Ease.getPowOut(4);\r\n/**\r\n * @method quartInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quartInOut = Ease.getPowInOut(4);\r\n\r\n/**\r\n * @method quintIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quintIn = Ease.getPowIn(5);\r\n/**\r\n * @method quintOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quintOut = Ease.getPowOut(5);\r\n/**\r\n * @method quintInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quintInOut = Ease.getPowInOut(5);\r\n\r\n/**\r\n * @method sineIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.sineIn = function(t) {\r\n  return 1-Math.cos(t*Math.PI/2);\r\n};\r\n\r\n/**\r\n * @method sineOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.sineOut = function(t) {\r\n  return Math.sin(t*Math.PI/2);\r\n};\r\n\r\n/**\r\n * @method sineInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.sineInOut = function(t) {\r\n  return -0.5*(Math.cos(Math.PI*t) - 1);\r\n};\r\n\r\n/**\r\n * Configurable \"back in\" ease.\r\n * @method getBackIn\r\n * @param {Number} amount The strength of the ease.\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getBackIn = function(amount) {\r\n  return function(t) {\r\n    return t*t*((amount+1)*t-amount);\r\n  };\r\n};\r\n/**\r\n * @method backIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.backIn = Ease.getBackIn(1.7);\r\n\r\n/**\r\n * Configurable \"back out\" ease.\r\n * @method getBackOut\r\n * @param {Number} amount The strength of the ease.\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getBackOut = function(amount) {\r\n  return function(t) {\r\n    return (--t*t*((amount+1)*t + amount) + 1);\r\n  };\r\n};\r\n/**\r\n * @method backOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.backOut = Ease.getBackOut(1.7);\r\n\r\n/**\r\n * Configurable \"back in out\" ease.\r\n * @method getBackInOut\r\n * @param {Number} amount The strength of the ease.\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getBackInOut = function(amount) {\r\n  amount*=1.525;\r\n  return function(t) {\r\n    if ((t*=2)<1) return 0.5*(t*t*((amount+1)*t-amount));\r\n    return 0.5*((t-=2)*t*((amount+1)*t+amount)+2);\r\n  };\r\n};\r\n/**\r\n * @method backInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.backInOut = Ease.getBackInOut(1.7);\r\n\r\n/**\r\n * @method circIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.circIn = function(t) {\r\n  return -(Math.sqrt(1-t*t)- 1);\r\n};\r\n\r\n/**\r\n * @method circOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.circOut = function(t) {\r\n  return Math.sqrt(1-(--t)*t);\r\n};\r\n\r\n/**\r\n * @method circInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.circInOut = function(t) {\r\n  if ((t*=2) < 1) return -0.5*(Math.sqrt(1-t*t)-1);\r\n  return 0.5*(Math.sqrt(1-(t-=2)*t)+1);\r\n};\r\n\r\n/**\r\n * @method bounceIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.bounceIn = function(t) {\r\n  return 1-Ease.bounceOut(1-t);\r\n};\r\n\r\n/**\r\n * @method bounceOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.bounceOut = function(t) {\r\n  if (t < 1/2.75) {\r\n    return (7.5625*t*t);\r\n  } else if (t < 2/2.75) {\r\n    return (7.5625*(t-=1.5/2.75)*t+0.75);\r\n  } else if (t < 2.5/2.75) {\r\n    return (7.5625*(t-=2.25/2.75)*t+0.9375);\r\n  } else {\r\n    return (7.5625*(t-=2.625/2.75)*t +0.984375);\r\n  }\r\n};\r\n\r\n/**\r\n * @method bounceInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.bounceInOut = function(t) {\r\n  if (t<0.5) return Ease.bounceIn (t*2) * .5;\r\n  return Ease.bounceOut(t*2-1)*0.5+0.5;\r\n};\r\n\r\n/**\r\n * Configurable elastic ease.\r\n * @method getElasticIn\r\n * @param {Number} amplitude\r\n * @param {Number} period\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getElasticIn = function(amplitude,period) {\r\n  var pi2 = Math.PI*2;\r\n  return function(t) {\r\n    if (t==0 || t==1) return t;\r\n    var s = period/pi2*Math.asin(1/amplitude);\r\n    return -(amplitude*Math.pow(2,10*(t-=1))*Math.sin((t-s)*pi2/period));\r\n  };\r\n};\r\n/**\r\n * @method elasticIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.elasticIn = Ease.getElasticIn(1,0.3);\r\n\r\n/**\r\n * Configurable elastic ease.\r\n * @method getElasticOut\r\n * @param {Number} amplitude\r\n * @param {Number} period\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getElasticOut = function(amplitude,period) {\r\n  var pi2 = Math.PI*2;\r\n  return function(t) {\r\n    if (t==0 || t==1) return t;\r\n    var s = period/pi2 * Math.asin(1/amplitude);\r\n    return (amplitude*Math.pow(2,-10*t)*Math.sin((t-s)*pi2/period )+1);\r\n  };\r\n};\r\n/**\r\n * @method elasticOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.elasticOut = Ease.getElasticOut(1,0.3);\r\n\r\n/**\r\n * Configurable elastic ease.\r\n * @method getElasticInOut\r\n * @param {Number} amplitude\r\n * @param {Number} period\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getElasticInOut = function(amplitude,period) {\r\n  var pi2 = Math.PI*2;\r\n  return function(t) {\r\n    var s = period/pi2 * Math.asin(1/amplitude);\r\n    if ((t*=2)<1) return -0.5*(amplitude*Math.pow(2,10*(t-=1))*Math.sin( (t-s)*pi2/period ));\r\n    return amplitude*Math.pow(2,-10*(t-=1))*Math.sin((t-s)*pi2/period)*0.5+1;\r\n  };\r\n};\r\n/**\r\n * @method elasticInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.elasticInOut = Ease.getElasticInOut(1,0.3*1.5);\r\n","import nstructjs from \"../util/struct.js\";\r\nimport {CurveConstructors, CurveTypeData} from \"./curve1d_base.js\";\r\nimport Ease from './ease.js';\r\nimport * as util from '../util/util.js';\r\n\r\nfunction bez3(a, b, c, t) {\r\n  var r1 = a + (b - a)*t;\r\n  var r2 = b + (c - b)*t;\r\n\r\n  return r1 + (r2 - r1)*t;\r\n}\r\n\r\nfunction bez4(a, b, c, d, t) {\r\n  var r1 = bez3(a, b, c, t);\r\n  var r2 = bez3(b, c, d, t);\r\n\r\n  return r1 + (r2 - r1)*t;\r\n}\r\n\r\nexport class ParamKey {\r\n  constructor(key, val) {\r\n    this.key = key;\r\n    this.val = val;\r\n  }\r\n}\r\n\r\nParamKey.STRUCT = `\r\nParamKey {\r\n  key : string;\r\n  val : float;\r\n}\r\n`\r\nnstructjs.register(ParamKey);\r\nlet BOOL_FLAG = 1e17;\r\n\r\nlet _udigest = new util.HashDigest();\r\n\r\nexport class SimpleCurveBase extends CurveTypeData {\r\n  constructor() {\r\n    super();\r\n\r\n    this.type = this.constructor.name;\r\n\r\n    let def = this.constructor.define();\r\n    let params = def.params;\r\n\r\n    this.params = {};\r\n    for (let k in params) {\r\n      this.params[k] = params[k][1];\r\n    }\r\n  }\r\n\r\n  get hasGUI() {\r\n    return true;\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    let d = digest;\r\n    super.calcHashKey(d);\r\n\r\n    for (let k in this.params) {\r\n      digest.add(k);\r\n      digest.add(this.params[k]);\r\n    }\r\n\r\n    return d.get();\r\n  }\r\n\r\n  equals(b) {\r\n    if (this.type !== b.type) {\r\n      return false;\r\n    }\r\n\r\n    for (let k in this.params) {\r\n      if (Math.abs(this.params[k] - b.params[k]) > 0.000001) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  redraw() {\r\n    if (this.parent)\r\n      this.parent.redraw();\r\n  }\r\n\r\n  makeGUI(container) {\r\n    let def = this.constructor.define();\r\n    let params = def.params;\r\n\r\n    for (let k in params) {\r\n      let p = params[k];\r\n\r\n      if (p[2] === BOOL_FLAG) {\r\n        let check = container.check(undefined, p[0]);\r\n        check.checked = !!this.params[k];\r\n        check.key = k;\r\n\r\n        let this2 = this;\r\n        check.onchange = function () {\r\n          this2.params[this.key] = this.checked ? 1 : 0;\r\n          this2.update();\r\n          this2.redraw();\r\n        }\r\n      } else {\r\n        let slider = container.slider(undefined, {\r\n          name      : p[0],\r\n          defaultval: this.params[k],\r\n          min       : p[2],\r\n          max       : p[3]\r\n        })\r\n        slider.baseUnit = slider.displayUnit = \"none\";\r\n\r\n        slider.key = k;\r\n\r\n        let this2 = this;\r\n        slider.onchange = function () {\r\n          this2.params[this.key] = this.value;\r\n          this2.update();\r\n          this2.redraw();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  killGUI(container) {\r\n    container.clear();\r\n  }\r\n\r\n  evaluate(s) {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  reset() {\r\n\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  draw(canvas, g, draw_transform) {\r\n    let steps = 128;\r\n    let s = 0, ds = 1.0/(steps - 1);\r\n\r\n    g.beginPath();\r\n    for (let i = 0; i < steps; i++, s += ds) {\r\n      let co = this.evaluate(s);\r\n\r\n      if (i) {\r\n        g.lineTo(co[0], co[1]);\r\n      } else {\r\n        g.moveTo(co[0], co[1]);\r\n      }\r\n    }\r\n\r\n    g.stroke();\r\n  }\r\n\r\n  _saveParams() {\r\n    let ret = [];\r\n    for (let k in this.params) {\r\n      ret.push(new ParamKey(k, this.params[k]));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  toJSON() {\r\n    return Object.assign(super.toJSON(), {\r\n      params: this.params\r\n    });\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    for (let k in obj.params) {\r\n      this.params[k] = obj.params[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n\r\n    let ps = this.params;\r\n    this.params = {};\r\n\r\n    let pdef = this.constructor.define().params;\r\n    if (!pdef) {\r\n      console.warn(\"Missing define function for curve\", this.constructor.name)\r\n      return;\r\n    }\r\n\r\n    for (let pair of ps) {\r\n      if (pair.key in pdef) {\r\n        this.params[pair.key] = pair.val;\r\n      }\r\n    }\r\n\r\n    for (let k in pdef) {\r\n      if (!(k in this.params)) {\r\n        this.params[k] = pdef[k][1];\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nSimpleCurveBase.STRUCT = nstructjs.inherit(SimpleCurveBase, CurveTypeData) + `\r\n  params : array(ParamKey) | obj._saveParams();\r\n}\r\n`;\r\nnstructjs.register(SimpleCurveBase);\r\n\r\nexport class BounceCurve extends SimpleCurveBase {\r\n  static define() {\r\n    return {\r\n      params  : {\r\n        decay : [\"Decay\", 1.0, 0.1, 5.0],\r\n        scale : [\"Scale\", 1.0, 0.01, 10.0],\r\n        freq  : [\"Freq\", 1.0, 0.01, 50.0],\r\n        phase : [\"Phase\", 0.0, -Math.PI*2.0, Math.PI*2.0],\r\n        offset: [\"Offset\", 0.0, -2.0, 2.0]\r\n      },\r\n      name    : \"bounce\",\r\n      uiname  : \"Bounce\",\r\n      typeName: \"BounceCurve\"\r\n\r\n    }\r\n  }\r\n\r\n  _evaluate(t) {\r\n    let params = this.params;\r\n    let decay = params.decay + 1.0;\r\n    let scale = params.scale;\r\n    let freq = params.freq;\r\n    let phase = params.phase;\r\n    let offset = params.offset;\r\n\r\n    t *= freq;\r\n    let t2 = Math.abs(Math.cos(phase + t*Math.PI*2.0))*scale;\r\n    ;//+ (1.0-scale);\r\n\r\n    t2 *= Math.exp(decay*t)/Math.exp(decay);\r\n\r\n    return t2;\r\n  }\r\n\r\n  evaluate(t) {\r\n    let s = this._evaluate(0.0);\r\n    let e = this._evaluate(1.0);\r\n\r\n    return (this._evaluate(t) - s)/(e - s) + this.params.offset;\r\n  }\r\n}\r\n\r\nCurveTypeData.register(BounceCurve);\r\nBounceCurve.STRUCT = nstructjs.inherit(BounceCurve, SimpleCurveBase) + `\r\n}`;\r\nnstructjs.register(BounceCurve);\r\n\r\n\r\nexport class ElasticCurve extends SimpleCurveBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._func = undefined;\r\n    this._last_hash = undefined;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      params  : {\r\n        mode     : [\"Out Mode\", false, BOOL_FLAG, BOOL_FLAG],\r\n        amplitude: [\"Amplitude\", 1.0, 0.01, 10.0],\r\n        period   : [\"Period\", 1.0, 0.01, 5.0]\r\n      },\r\n      name    : \"elastic\",\r\n      uiname  : \"Elastic\",\r\n      typeName: \"ElasticCurve\",\r\n    }\r\n  }\r\n\r\n  evaluate(t) {\r\n    let hash = ~~(this.params.mode*127 + this.params.amplitude*256 + this.params.period*512);\r\n\r\n    if (hash !== this._last_hash || !this._func) {\r\n      this._last_hash = hash;\r\n\r\n      if (this.params.mode) {\r\n        this._func = Ease.getElasticOut(this.params.amplitude, this.params.period);\r\n      } else {\r\n        this._func = Ease.getElasticIn(this.params.amplitude, this.params.period);\r\n      }\r\n    }\r\n    return this._func(t);\r\n  }\r\n}\r\n\r\nCurveTypeData.register(ElasticCurve);\r\nElasticCurve.STRUCT = nstructjs.inherit(ElasticCurve, SimpleCurveBase) + `\r\n}`;\r\nnstructjs.register(ElasticCurve);\r\n\r\n\r\nexport class EaseCurve extends SimpleCurveBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      params  : {\r\n        mode_in  : [\"in\", true, BOOL_FLAG, BOOL_FLAG],\r\n        mode_out : [\"out\", true, BOOL_FLAG, BOOL_FLAG],\r\n        amplitude: [\"Amplitude\", 1.0, 0.01, 4.0]\r\n      },\r\n      name    : \"ease\",\r\n      uiname  : \"Ease\",\r\n      typeName: \"EaseCurve\"\r\n    }\r\n  }\r\n\r\n  evaluate(t) {\r\n    let amp = this.params.amplitude;\r\n    let a1 = this.params.mode_in ? 1.0 - amp : 1.0/3.0;\r\n    let a2 = this.params.mode_out ? amp : 2.0/3.0;\r\n\r\n    return bez4(0.0, a1, a2, 1.0, t);\r\n  }\r\n}\r\n\r\nCurveTypeData.register(EaseCurve);\r\nEaseCurve.STRUCT = nstructjs.inherit(EaseCurve, SimpleCurveBase) + `\r\n}`;\r\nnstructjs.register(EaseCurve);\r\n\r\n\r\nexport class RandCurve extends SimpleCurveBase {\r\n  constructor() {\r\n    super();\r\n    this.random = new util.MersenneRandom();\r\n    this.seed = 0;\r\n  }\r\n\r\n  get seed() {\r\n    return this._seed;\r\n  }\r\n\r\n  set seed(v) {\r\n    this.random.seed(v);\r\n    this._seed = v;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      params  : {\r\n        amplitude: [\"Amplitude\", 1.0, 0.01, 4.0],\r\n        decay    : [\"Decay\", 1.0, 0.0, 5.0],\r\n        in_mode  : [\"In\", true, BOOL_FLAG, BOOL_FLAG]\r\n      },\r\n      name    : \"random\",\r\n      uiname  : \"Random\",\r\n      typeName: \"RandCurve\"\r\n    }\r\n  }\r\n\r\n  evaluate(t) {\r\n    let r = this.random.random();\r\n    let decay = this.params.decay + 1.0;\r\n    let amp = this.params.amplitude;\r\n    let in_mode = this.params.in_mode;\r\n\r\n    if (in_mode) {\r\n      t = 1.0 - t;\r\n    }\r\n    //r *= t;\r\n\r\n    let d;\r\n\r\n    //r *= 0.5;\r\n\r\n    if (in_mode) {\r\n      d = Math.exp(t*decay)/Math.exp(decay);\r\n    } else {\r\n      d = Math.exp(t*decay)/Math.exp(decay);\r\n    }\r\n\r\n    t = t + (r - t)*d;\r\n\r\n    if (in_mode) {\r\n      t = 1.0 - t;\r\n    }\r\n\r\n    return t;\r\n  }\r\n}\r\n\r\nCurveTypeData.register(RandCurve);\r\nRandCurve.STRUCT = nstructjs.inherit(RandCurve, SimpleCurveBase) + `\r\n}`;\r\nnstructjs.register(RandCurve);\r\n\r\n\r\n","\"use strict\";\r\n\r\n/*FIXME: not sure this works anymore*/\r\nimport nstructjs from \"../util/struct.js\";\r\n\r\nimport * as util from '../util/util.js';\r\n//import * as ui_base from './ui_base.js';\r\nimport * as vectormath from '../util/vectormath.js';\r\nimport {EventDispatcher} from \"../util/events.js\";\r\n\r\nexport {getCurve} from './curve1d_base.js';\r\nexport {SplineTemplates, SplineTemplateIcons} from './curve1d_bspline.js';\r\n\r\nvar Vector2 = vectormath.Vector2;\r\n\r\nimport './curve1d_basic.js';\r\nimport './curve1d_bspline.js';\r\nimport './curve1d_anim.js';\r\n\r\nexport function mySafeJSONStringify(obj) {\r\n  return JSON.stringify(obj.toJSON(), function (key) {\r\n    let v = this[key];\r\n\r\n    if (typeof v === \"number\") {\r\n      if (v !== Math.floor(v)) {\r\n        v = parseFloat(v.toFixed(5));\r\n      } else {\r\n        v = v;\r\n      }\r\n    }\r\n\r\n    return v;\r\n  });\r\n}\r\n\r\nexport function mySafeJSONParse(buf) {\r\n  return JSON.parse(buf, (key, val) => {\r\n\r\n  });\r\n};\r\n\r\nwindow.mySafeJSONStringify = mySafeJSONStringify;\r\n\r\nexport {CurveConstructors, CURVE_VERSION, CurveTypeData} from './curve1d_base.js';\r\nimport {CurveConstructors, CURVE_VERSION, CurveTypeData} from './curve1d_base.js';\r\n\r\nlet _udigest = new util.HashDigest();\r\n\r\nexport class Curve1D extends EventDispatcher {\r\n  constructor() {\r\n    super();\r\n\r\n    this.uiZoom = 1.0;\r\n\r\n    this.generators = [];\r\n    this.VERSION = CURVE_VERSION;\r\n\r\n    for (let gen of CurveConstructors) {\r\n      gen = new gen();\r\n\r\n      gen.parent = this;\r\n      this.generators.push(gen);\r\n    }\r\n\r\n    //this.generators.active = this.generators[0];\r\n    this.setGenerator(\"bspline\");\r\n  }\r\n\r\n  get generatorType() {\r\n    return this.generators.active ? this.generators.active.type : undefined;\r\n  }\r\n\r\n  get fastmode() {\r\n    return this._fastmode;\r\n  }\r\n\r\n  set fastmode(val) {\r\n    this._fastmode = val;\r\n\r\n    for (let gen of this.generators) {\r\n      gen.fastmode = val;\r\n    }\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    let d = digest;\r\n\r\n    for (let g of this.generators) {\r\n      g.calcHashKey(d);\r\n    }\r\n\r\n    return d.get();\r\n  }\r\n\r\n  equals(b) {\r\n    let gen1 = this.generators.active;\r\n    let gen2 = b.generators.active;\r\n\r\n    if (!gen1 || !gen2 || gen1.constructor !== gen2.constructor) {\r\n      return false;\r\n    }\r\n\r\n    return gen1.equals(gen2);\r\n  }\r\n\r\n  load(b) {\r\n    if (b === undefined) {\r\n      return;\r\n    }\r\n\r\n    let buf1 = mySafeJSONStringify(b);\r\n    let buf2 = mySafeJSONStringify(this);\r\n\r\n    if (buf1 === buf2) {\r\n      return;\r\n    }\r\n\r\n    this.loadJSON(JSON.parse(buf1));\r\n    this._on_change();\r\n    this.redraw();\r\n\r\n    return this;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new Curve1D();\r\n    ret.loadJSON(JSON.parse(mySafeJSONStringify(this)));\r\n    return ret;\r\n  }\r\n\r\n  _on_change() {\r\n\r\n  }\r\n\r\n  redraw() {\r\n    this._fireEvent(\"draw\", this);\r\n  }\r\n\r\n  setGenerator(type) {\r\n    for (let gen of this.generators) {\r\n      if (gen.constructor.define().name === type\r\n        || gen.type === type\r\n        || gen.constructor.define().typeName === type\r\n        || gen.constructor === type) {\r\n        if (this.generators.active) {\r\n          this.generators.active.onInactive();\r\n        }\r\n\r\n        this.generators.active = gen;\r\n        gen.onActive();\r\n\r\n        return;\r\n      }\r\n    }\r\n\r\n    throw new Error(\"unknown curve type \" + type);\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = {\r\n      generators      : [],\r\n      uiZoom          : this.uiZoom,\r\n      VERSION         : this.VERSION,\r\n      active_generator: this.generatorType\r\n    };\r\n\r\n    for (let gen of this.generators) {\r\n      ret.generators.push(gen.toJSON());\r\n    }\r\n\r\n    ret.generators.sort((a, b) => a.type.localeCompare(b.type));\r\n\r\n    return ret;\r\n  }\r\n\r\n  getGenerator(type, throw_on_error = true) {\r\n    for (let gen of this.generators) {\r\n      if (gen.type === type) {\r\n        return gen;\r\n      }\r\n    }\r\n\r\n    //was a new generator registerd?\r\n    for (let cls of CurveConstructors) {\r\n      if (cls.define().typeName === type) {\r\n        let gen = new cls();\r\n        gen.type = type;\r\n        this.generators.push(gen);\r\n        return gen;\r\n      }\r\n    }\r\n\r\n    if (throw_on_error) {\r\n      throw new Error(\"Unknown generator \" + type + \".\");\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  switchGenerator(type) {\r\n    let gen = this.getGenerator(type);\r\n\r\n    if (gen !== this.generators.active) {\r\n      let old = this.generators.active;\r\n\r\n      this.generators.active = gen;\r\n\r\n      old.onInactive(this);\r\n      gen.onActive(this);\r\n    }\r\n\r\n    return gen;\r\n  }\r\n\r\n  destroy() {\r\n    return this;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    this.VERSION = obj.VERSION;\r\n\r\n    this.uiZoom = parseFloat(obj.uiZoom) || this.uiZoom;\r\n\r\n    //this.generators = [];\r\n    for (let gen of obj.generators) {\r\n      let gen2 = this.getGenerator(gen.type, false);\r\n\r\n      if (!gen2 || !(gen2 instanceof CurveTypeData)) {\r\n        //old curve class?\r\n        console.warn(\"Bad curve generator class:\", gen2);\r\n        if (gen2) {\r\n          this.generators.remove(gen2);\r\n        }\r\n        continue;\r\n      }\r\n\r\n      gen2.parent = undefined;\r\n      gen2.reset();\r\n      gen2.loadJSON(gen);\r\n      gen2.parent = this;\r\n\r\n      if (gen.type === obj.active_generator) {\r\n        this.generators.active = gen2;\r\n      }\r\n\r\n      //this.generators.push(gen2);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  evaluate(s) {\r\n    return this.generators.active.evaluate(s);\r\n  }\r\n\r\n  integrate(s, quadSteps) {\r\n    return this.generators.active.integrate(s, quadSteps);\r\n  }\r\n\r\n  derivative(s) {\r\n    return this.generators.active.derivative(s);\r\n  }\r\n\r\n  derivative2(s) {\r\n    return this.generators.active.derivative2(s);\r\n  }\r\n\r\n  inverse(s) {\r\n    return this.generators.active.inverse(s);\r\n  }\r\n\r\n  reset() {\r\n    this.generators.active.reset();\r\n  }\r\n\r\n  update() {\r\n    return this.generators.active.update();\r\n  }\r\n\r\n  draw(canvas, g, draw_transform) {\r\n    let w = canvas.width, h = canvas.height;\r\n\r\n    g.save();\r\n\r\n    let sz = draw_transform[0], pan = draw_transform[1];\r\n\r\n    g.beginPath();\r\n    g.moveTo(-1, 0);\r\n    g.lineTo(1, 0);\r\n    g.strokeStyle = \"red\";\r\n    g.stroke();\r\n\r\n    g.beginPath();\r\n    g.moveTo(0, -1);\r\n    g.lineTo(0, 1);\r\n    g.strokeStyle = \"green\";\r\n    g.stroke();\r\n\r\n    //g.rect(0, 0, 1, 1);\r\n    //g.fillStyle = \"rgb(50, 50, 50)\";\r\n    //g.fill();\r\n\r\n    let f = 0, steps = 64;\r\n    let df = 1/(steps - 1);\r\n    w = 6.0/sz;\r\n\r\n    let curve = this.generators.active;\r\n\r\n    g.beginPath();\r\n    for (let i = 0; i < steps; i++, f += df) {\r\n      let val = curve.evaluate(f);\r\n\r\n      (i === 0 ? g.moveTo : g.lineTo).call(g, f, val, w, w);\r\n    }\r\n\r\n    g.strokeStyle = \"grey\";\r\n    g.stroke();\r\n\r\n    if (this.overlay_curvefunc !== undefined) {\r\n      g.beginPath();\r\n      f = 0.0;\r\n\r\n      for (let i = 0; i < steps; i++, f += df) {\r\n        let val = this.overlay_curvefunc(f);\r\n\r\n        (i === 0 ? g.moveTo : g.lineTo).call(g, f, val, w, w);\r\n      }\r\n\r\n      g.strokeStyle = \"green\";\r\n      g.stroke();\r\n    }\r\n\r\n    this.generators.active.draw(canvas, g, draw_transform);\r\n\r\n    g.restore();\r\n    return this;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    this.generators = [];\r\n    reader(this);\r\n\r\n    //console.log(\"VERSION\", this.VERSION);\r\n\r\n    if (this.VERSION <= 0.75) {\r\n      this.generators = [];\r\n\r\n      for (let cls of CurveConstructors) {\r\n        this.generators.push(new cls());\r\n      }\r\n\r\n      this.generators.active = this.getGenerator(\"BSplineCurve\");\r\n    }\r\n\r\n    for (let gen of this.generators.concat([])) {\r\n      if (!(gen instanceof CurveTypeData)) {\r\n        console.warn(\"Bad generator data found:\", gen);\r\n        this.generators.remove(gen);\r\n        continue;\r\n      }\r\n\r\n      if (gen.type === this._active) {\r\n        this.generators.active = gen;\r\n      }\r\n    }\r\n\r\n    delete this._active;\r\n  }\r\n}\r\n\r\nCurve1D.STRUCT = `\r\nCurve1D {\r\n  generators  : array(abstract(CurveTypeData));\r\n  _active     : string | obj.generators.active.type;\r\n  VERSION     : float;\r\n  uiZoom      : float;\r\n}\r\n`;\r\nnstructjs.register(Curve1D);\r\n\r\n","import * as util from '../util/util.js';\r\nimport {Vector2, Vector3, Vector4, Quat, Matrix4} from '../util/vectormath.js';\r\nimport {ToolPropertyIF, PropTypes, PropFlags} from \"./toolprop_abstract.js\";\r\nimport nstructjs from '../util/struct.js';\r\n\r\nexport {PropTypes, PropFlags} from './toolprop_abstract.js';\r\n\r\nexport const NumberConstraintsBase = new Set([\r\n  'range', 'expRate', 'step', 'uiRange', 'baseUnit', 'displayUnit', 'stepIsRelative',\r\n  'slideSpeed'\r\n]);\r\n\r\nexport const IntegerConstraints = new Set([\r\n  'radix'\r\n].concat(util.list(NumberConstraintsBase)));\r\n\r\nexport const FloatConstrinats = new Set([\r\n  'decimalPlaces'\r\n].concat(util.list(NumberConstraintsBase)));\r\n\r\nexport const NumberConstraints = new Set(util.list(IntegerConstraints).concat(util.list(FloatConstrinats)));\r\n\r\nexport const PropSubTypes = {\r\n  COLOR: 1\r\n};\r\n\r\nlet first = (iter) => {\r\n  if (iter === undefined) {\r\n    return undefined;\r\n  }\r\n\r\n  if (!(Symbol.iterator in iter)) {\r\n    for (let item in iter) {\r\n      return item;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  for (let item of iter) {\r\n    return item;\r\n  }\r\n};\r\n\r\n//set PropTypes to custom type integers\r\nexport function setPropTypes(types) {\r\n  for (let k in types) {\r\n    PropTypes[k] = types[k];\r\n  }\r\n}\r\n\r\nexport let customPropertyTypes = [];\r\nexport let PropClasses = {};\r\n\r\nlet customPropTypeBase = 17;\r\n\r\nlet wordmap = {\r\n  sel  : \"select\",\r\n  unsel: \"deselect\",\r\n  eid  : \"id\",\r\n  props: \"properties\",\r\n  res  : \"resource\",\r\n\r\n};\r\n\r\nexport var defaultRadix = 10;\r\nexport var defaultDecimalPlaces = 4;\r\n\r\nclass OnceTag {\r\n  constructor(cb) {\r\n    this.cb = cb;\r\n  }\r\n}\r\n\r\nexport class ToolProperty extends ToolPropertyIF {\r\n  constructor(type, subtype, apiname, uiname = \"\", description = \"\", flag = 0, icon = -1) {\r\n    super();\r\n\r\n    this.data = undefined;\r\n\r\n    if (type === undefined) {\r\n      type = this.constructor.PROP_TYPE_ID;\r\n    }\r\n\r\n    this.type = type;\r\n    this.subtype = subtype;\r\n\r\n    //is false if this property still has its default value,\r\n    //i.e. it hasn't been set by the user or anyone else\r\n    this.wasSet = false;\r\n\r\n    this.apiname = apiname;\r\n    this.uiname = uiname !== undefined ? uiname : apiname;\r\n    this.description = description;\r\n    this.flag = flag;\r\n    this.icon = icon;\r\n    this.icon2 = icon; //another icon, e.g. unchecked state\r\n\r\n    //remember to update NumberConstraintsBase et al when adding new number\r\n    //constraints\r\n\r\n    this.decimalPlaces = defaultDecimalPlaces;\r\n    this.radix = defaultRadix;\r\n    this.step = 0.05;\r\n\r\n    this.callbacks = {};\r\n  }\r\n\r\n  static internalRegister(cls) {\r\n    PropClasses[new cls().type] = cls;\r\n  }\r\n\r\n  static getClass(type) {\r\n    return PropClasses[type];\r\n  }\r\n\r\n  static setDefaultRadix(n) {\r\n    defaultRadix = n;\r\n  }\r\n\r\n  static setDefaultDecimalPlaces(n) {\r\n    defaultDecimalPlaces = n;\r\n  }\r\n\r\n  static makeUIName(name) {\r\n    let parts = [\"\"];\r\n    let lastc = undefined;\r\n\r\n    let ischar = (c) => {\r\n      c = c.charCodeAt(0);\r\n\r\n      let upper = c >= \"A\".charCodeAt(0);\r\n      upper = upper && c <= \"Z\".charCodeAt(0);\r\n\r\n      let lower = c >= \"a\".charCodeAt(0);\r\n      lower = lower && c <= \"z\".charCodeAt(0);\r\n\r\n      return upper || lower;\r\n    }\r\n\r\n    for (let i = 0; i < name.length; i++) {\r\n      let c = name[i];\r\n\r\n      if (c === '_' || c === '-' || c === '$') {\r\n        lastc = c;\r\n        c = ' ';\r\n        parts.push('');\r\n        continue;\r\n      }\r\n\r\n      if (i > 0 && c === c.toUpperCase() && lastc !== lastc.toUpperCase()) {\r\n        if (ischar(c) && ischar(lastc)) {\r\n          parts.push('');\r\n        }\r\n      }\r\n\r\n      parts[parts.length - 1] += c;\r\n      lastc = c;\r\n    }\r\n\r\n\r\n    let subst = (word) => {\r\n      if (word in wordmap) {\r\n        return wordmap[word];\r\n      } else {\r\n        return word;\r\n      }\r\n    }\r\n\r\n    parts = parts\r\n      .filter(f => f.trim().length > 0)\r\n      .map(f => subst(f))\r\n      .map(f => f[0].toUpperCase() + f.slice(1, f.length).toLowerCase())\r\n      .join(\" \").trim();\r\n    return parts;\r\n  }\r\n\r\n  static register(cls) {\r\n    cls.PROP_TYPE_ID = (1<<customPropTypeBase);\r\n    PropTypes[cls.name] = cls.PROP_TYPE_ID;\r\n\r\n    customPropTypeBase++;\r\n    customPropertyTypes.push(cls);\r\n\r\n    PropClasses[new cls().type] = cls;\r\n\r\n    return cls.PROP_TYPE_ID;\r\n  }\r\n\r\n  static calcRelativeStep(step, value, logBase = 1.5) {\r\n    value = Math.log(Math.abs(value) + 1.0)/Math.log(logBase);\r\n    value = Math.max(value, step);\r\n\r\n    this.report(util.termColor(\"STEP\", \"red\"), value);\r\n    return value;\r\n  }\r\n\r\n  setDescription(s) {\r\n    this.description = s;\r\n    return this;\r\n  }\r\n\r\n  setUIName(s) {\r\n    this.uiname = s;\r\n    return this;\r\n  }\r\n\r\n  calcMemSize() {\r\n    function strlen(s) {\r\n      //length of string plus an assumed member pointer\r\n      return s !== undefined ? s.length + 8 : 8;\r\n    }\r\n\r\n    let tot = 0;\r\n\r\n    tot += strlen(this.apiname) + strlen(this.uiname);\r\n    tot += strlen(this.description);\r\n\r\n    tot += 11*8; //assumed member pointers\r\n    for (let k in this.callbacks) {\r\n      tot += 24;\r\n    }\r\n\r\n    return tot;\r\n  }\r\n\r\n  equals(b) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  private() {\r\n    this.flag |= PropFlags.PRIVATE;\r\n    return this;\r\n  }\r\n\r\n  saveLastValue() {\r\n    this.flag |= PropFlags.SAVE_LAST_VALUE;\r\n    return this;\r\n  }\r\n\r\n  report() {\r\n    console.warn(...arguments);\r\n  }\r\n\r\n  _fire(type, arg1, arg2) {\r\n    if (this.callbacks[type] === undefined) {\r\n      return;\r\n    }\r\n\r\n    let stack = this.callbacks[type];\r\n    stack = stack.concat([]); //copy\r\n\r\n    for (let i = 0; i < stack.length; i++) {\r\n      let cb = stack[i];\r\n\r\n      if (cb instanceof OnceTag) {\r\n        let j = i;\r\n\r\n        //remove callback;\r\n        while (j < stack.length - 1) {\r\n          stack[j] = stack[j + 1];\r\n          j++;\r\n        }\r\n\r\n        stack[j] = undefined;\r\n        stack.length--;\r\n\r\n        i--;\r\n\r\n        cb.cb.call(this, arg1, arg2);\r\n      } else {\r\n        cb.call(this, arg1, arg2);\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  clearEventCallbacks() {\r\n    this.callbacks = {}\r\n    return this;\r\n  }\r\n\r\n  once(type, cb) {\r\n    if (this.callbacks[type] === undefined) {\r\n      this.callbacks[type] = [];\r\n    }\r\n\r\n    //check if cb is already in callback list inside a OnceTag\r\n    for (let cb2 of this.callbacks[type]) {\r\n      if (cb2 instanceof OnceTag && cb2.cb === cb) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    cb = new OnceTag(cb);\r\n\r\n    this.callbacks[type].push(cb);\r\n\r\n    return this;\r\n  }\r\n\r\n  on(type, cb) {\r\n    if (this.callbacks[type] === undefined) {\r\n      this.callbacks[type] = [];\r\n    }\r\n\r\n    this.callbacks[type].push(cb);\r\n    return this;\r\n  }\r\n\r\n  off(type, cb) {\r\n    this.callbacks[type].remove(cb);\r\n    return this;\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      type       : this.type,\r\n      subtype    : this.subtype,\r\n      apiname    : this.apiname,\r\n      uiname     : this.uiname,\r\n      description: this.description,\r\n      flag       : this.flag,\r\n      icon       : this.icon,\r\n      data       : this.data,\r\n      range      : this.range,\r\n      uiRange    : this.uiRange,\r\n      step       : this.step\r\n    };\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    this.type = obj.type;\r\n    this.subtype = obj.subtype;\r\n    this.apiname = obj.apiname;\r\n    this.uiname = obj.uiname;\r\n    this.description = obj.description;\r\n    this.flag = obj.flag;\r\n    this.icon = obj.icon;\r\n    this.data = obj.data;\r\n\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  setValue(val) {\r\n    if (this.constructor === ToolProperty) {\r\n      throw new Error(\"implement me!\");\r\n    }\r\n\r\n    this.wasSet = true;\r\n\r\n    this._fire(\"change\", val);\r\n  }\r\n\r\n  copyTo(b) {\r\n    b.apiname = this.apiname;\r\n\r\n    b.uiname = this.uiname;\r\n    b.description = this.description;\r\n    b.icon = this.icon;\r\n    b.icon2 = this.icon2;\r\n\r\n    b.baseUnit = this.baseUnit;\r\n    b.subtype = this.subtype;\r\n    b.displayUnit = this.displayUnit;\r\n\r\n    b.flag = this.flag;\r\n\r\n    for (let k in this.callbacks) {\r\n      b.callbacks[k] = this.callbacks[k];\r\n    }\r\n  }\r\n\r\n  copy() { //default copy method\r\n    let ret = new this.constructor();\r\n\r\n    this.copyTo(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  setStep(step) {\r\n    this.step = step;\r\n    return this;\r\n  }\r\n\r\n  getStep(value = 1.0) {\r\n    if (this.stepIsRelative) {\r\n      return ToolProperty.calcRelativeStep(this.step, value);\r\n    } else {\r\n      return this.step;\r\n    }\r\n  }\r\n\r\n  setRelativeStep(step) {\r\n    this.step = step;\r\n    this.stepIsRelative = true;\r\n  }\r\n\r\n  setRange(min, max) {\r\n    if (min === undefined || max === undefined) {\r\n      throw new Error(\"min and/or max cannot be undefined\");\r\n    }\r\n\r\n    this.range = [min, max];\r\n    return this;\r\n  }\r\n\r\n  noUnits() {\r\n    this.baseUnit = this.displayUnit = \"none\";\r\n    return this;\r\n  }\r\n\r\n  setBaseUnit(unit) {\r\n    this.baseUnit = unit;\r\n    return this;\r\n  }\r\n\r\n  setDisplayUnit(unit) {\r\n    this.displayUnit = unit;\r\n    return this;\r\n  }\r\n\r\n  setFlag(f, combine = false) {\r\n    this.flag = combine ? this.flag | f : f;\r\n    return this;\r\n  }\r\n\r\n  setUIRange(min, max) {\r\n    if (min === undefined || max === undefined) {\r\n      throw new Error(\"min and/or max cannot be undefined\");\r\n    }\r\n\r\n    this.uiRange = [min, max];\r\n    return this;\r\n  }\r\n\r\n  setIcon(icon) {\r\n    this.icon = icon;\r\n\r\n    return this;\r\n  }\r\n\r\n  setIcon2(icon) {\r\n    this.icon2 = icon;\r\n\r\n    return this;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n  }\r\n}\r\n\r\nToolProperty.STRUCT = `\r\nToolProperty { \r\n  type           : int;\r\n  flag           : int;\r\n  subtype        : int;\r\n  icon           : int;\r\n  icon2          : int;\r\n  baseUnit       : string | \"\"+this.baseUnit;\r\n  displayUnit    : string | \"\"+this.displayUnit;\r\n  range          : array(float) | this.range ? this.range : [-1e17, 1e17];\r\n  uiRange        : array(float) | this.range ? this.range : [-1e17, 1e17];\r\n  description    : string;\r\n  stepIsRelative : bool;\r\n  step           : float;\r\n  expRate        : float;\r\n  radix          : float;\r\n  decimalPlaces  : int;\r\n}\r\n`;\r\nnstructjs.register(ToolProperty);\r\n\r\nwindow.ToolProperty = ToolProperty;\r\n\r\nexport class FloatArrayProperty extends ToolProperty {\r\n  constructor(value, apiname, uiname, description, flag, icon) {\r\n    super(PropTypes.FLOAT_ARRAY, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.value = [];\r\n\r\n    if (value !== undefined) {\r\n      this.setValue(value);\r\n    }\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return this.value[Symbol.iterator]();\r\n  }\r\n\r\n  setValue(value) {\r\n    super.setValue();\r\n\r\n    if (value === undefined) {\r\n      throw new Error(\"value was undefined in FloatArrayProperty's setValue method\");\r\n    }\r\n\r\n    this.value.length = 0;\r\n\r\n    for (let item of value) {\r\n      if (typeof item !== \"number\" && typeof item !== \"boolean\") {\r\n        console.log(value);\r\n        throw new Error(\"bad item for FloatArrayProperty \" + item);\r\n      }\r\n\r\n      this.value.push(item);\r\n    }\r\n  }\r\n\r\n  push(item) {\r\n    if (typeof item !== \"number\" && typeof item !== \"boolean\") {\r\n      console.log(value);\r\n      throw new Error(\"bad item for FloatArrayProperty \" + item);\r\n    }\r\n\r\n    this.value.push(item);\r\n  }\r\n\r\n  getValue() {\r\n    return this.value;\r\n  }\r\n\r\n  clear() {\r\n    this.value.length = 0;\r\n    return this;\r\n  }\r\n}\r\n\r\nFloatArrayProperty.STRUCT = nstructjs.inherit(FloatArrayProperty, ToolProperty) + `\r\n  value : array(float);\r\n}`;\r\nnstructjs.register(FloatArrayProperty);\r\n\r\nexport class StringProperty extends ToolProperty {\r\n  constructor(value, apiname, uiname, description, flag, icon) {\r\n    super(PropTypes.STRING, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.multiLine = false;\r\n\r\n    if (value) {\r\n      this.setValue(value);\r\n    } else {\r\n      this.setValue(\"\");\r\n    }\r\n\r\n    this.wasSet = false;\r\n  }\r\n\r\n  calcMemSize() {\r\n    return super.calcMemSize() + (this.data !== undefined ? this.data.length*4 : 0) + 8;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data === b.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n\r\n    b.data = this.data;\r\n    b.multiLine = this.multiLine;\r\n\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  setValue(val) {\r\n    //fire events\r\n    super.setValue(val);\r\n    this.data = val;\r\n  }\r\n}\r\n\r\nStringProperty.STRUCT = nstructjs.inherit(StringProperty, ToolProperty) + `\r\n  data : string;\r\n}\r\n`;\r\nnstructjs.register(StringProperty);\r\nToolProperty.internalRegister(StringProperty);\r\n\r\n/*\r\nlet num_res = [\r\n  /([0-9]+)/,\r\n  /((0x)?[0-9a-fA-F]+(h?))/,\r\n  /([0-9]+\\.[0-9]*)/,\r\n  /([0-9]*\\.[0-9]+)/,\r\n  /(\\.[0-9]+)/\r\n];\r\n//num_re = /([0-9]+\\.[0-9]*)|([0-9]*\\.[0-9]+)/\r\n*/\r\n\r\nexport {isNumber} from '../../core/units.js';\r\n/*\r\nexport function isNumber(f) {\r\n  if (f === \"NaN\" || (typeof f == \"number\" && isNaN(f))) {\r\n    return false;\r\n  }\r\n\r\n  f = (\"\" + f).trim();\r\n\r\n  let ok = false;\r\n\r\n  for (let re of num_res) {\r\n    let ret = f.match(re)\r\n    if (!ret) {\r\n      ok = false;\r\n      continue;\r\n    }\r\n\r\n    ok = ret[0].length === f.length;\r\n    if (ok) {\r\n      break;\r\n    }\r\n  }\r\n\r\n  return ok;\r\n}*/\r\n\r\n//window.isNumber = isNumber;\r\n\r\nexport class NumProperty extends ToolProperty {\r\n  constructor(type, value, apiname,\r\n              uiname, description, flag, icon) {\r\n    super(type, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.data = 0;\r\n    this.range = [0, 0];\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data == b.data;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n  }\r\n};\r\nNumProperty.STRUCT = nstructjs.inherit(NumProperty, ToolProperty) + `\r\n  range : array(float);\r\n  data  : float;\r\n}\r\n`;\r\n\r\nexport class _NumberPropertyBase extends ToolProperty {\r\n  constructor(type, value, apiname,\r\n              uiname, description, flag, icon) {\r\n    super(type, null, apiname, uiname, description, flag, icon);\r\n\r\n    this.data = 0.0;\r\n\r\n    //remember to update NumberConstraintsBase et al when adding new number\r\n    //constraints\r\n\r\n    /** controls roller slider rate */\r\n    this.slideSpeed = 1.0;\r\n\r\n    /** exponential rate, used by roller sliders */\r\n    this.expRate = 1.33;\r\n    this.step = 0.1;\r\n\r\n    this.stepIsRelative = false;\r\n\r\n    this.range = [-1e17, 1e17];\r\n\r\n    /** if undefined this.range will be used */\r\n    this.uiRange = undefined;\r\n\r\n    if (value !== undefined && value !== null) {\r\n      this.setValue(value);\r\n      this.wasSet = false;\r\n    }\r\n  }\r\n\r\n  get ui_range() {\r\n    this.report(\"NumberProperty.ui_range is deprecated\");\r\n    return this.uiRange;\r\n  }\r\n\r\n  set ui_range(val) {\r\n    this.report(\"NumberProperty.ui_range is deprecated\");\r\n    this.uiRange = val;\r\n  }\r\n\r\n  calcMemSize() {\r\n    return super.calcMemSize() + 8*8;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data === b.data;\r\n  }\r\n\r\n  toJSON() {\r\n    let json = super.toJSON();\r\n\r\n    json.data = this.data;\r\n    json.expRate = this.expRate;\r\n\r\n    return json;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    this.data = obj.data || this.data;\r\n    this.expRate = obj.expRate || this.expRate;\r\n\r\n    return this;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n\r\n    b.displayUnit = this.displayUnit;\r\n    b.baseUnit = this.baseUnit;\r\n    b.expRate = this.expRate;\r\n    b.step = this.step;\r\n    b.range = this.range ? [this.range[0], this.range[1]] : undefined;\r\n    b.uiRange = this.uiRange ? [this.uiRange[0], this.uiRange[1]] : undefined;\r\n    b.slideSpeed = this.slideSpeed;\r\n    \r\n    b.data = this.data;\r\n  }\r\n\r\n\r\n  setSlideSpeed(f) {\r\n    this.slideSpeed = f;\r\n\r\n    return this;\r\n  }\r\n\r\n  /*\r\n  * non-linear exponent for number sliders\r\n  * in roll mode\r\n  * */\r\n  setExpRate(exp) {\r\n    this.expRate = exp;\r\n  }\r\n\r\n  setValue(val) {\r\n    if (val === undefined || val === null) {\r\n      return;\r\n    }\r\n\r\n    if (typeof val !== \"number\") {\r\n      throw new Error(\"Invalid number \" + val);\r\n    }\r\n\r\n    this.data = val;\r\n\r\n    super.setValue(val);\r\n    return this;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    let get = (key) => {\r\n      if (key in obj) {\r\n        this[key] = obj[key];\r\n      }\r\n    };\r\n\r\n    get(\"range\");\r\n    get(\"step\");\r\n    get(\"expRate\");\r\n    get(\"ui_range\");\r\n\r\n    return this;\r\n  }\r\n};\r\n_NumberPropertyBase.STRUCT = nstructjs.inherit(_NumberPropertyBase, ToolProperty) + `\r\n  range      : array(float);\r\n  expRate    : float;\r\n  data       : float;\r\n  step       : float;\r\n  slideSpeed : float;\r\n}\r\n`;\r\nnstructjs.register(_NumberPropertyBase);\r\n\r\nexport class IntProperty extends _NumberPropertyBase {\r\n  constructor(value, apiname,\r\n              uiname, description, flag, icon) {\r\n    super(PropTypes.INT, value, apiname, uiname, description, flag, icon);\r\n\r\n    //remember to update NumberConstraintsBase et al when adding new number\r\n    //constraints\r\n\r\n    this.radix = 10;\r\n  }\r\n\r\n  setValue(val) {\r\n    super.setValue(Math.floor(val));\r\n    return this;\r\n  }\r\n\r\n  setRadix(radix) {\r\n    this.radix = radix;\r\n  }\r\n\r\n  toJSON() {\r\n    let json = super.toJSON();\r\n\r\n    json.data = this.data;\r\n    json.radix = this.radix;\r\n\r\n    return json;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    this.data = obj.data || this.data;\r\n    this.radix = obj.radix || this.radix;\r\n\r\n    return this;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n  }\r\n}\r\n\r\nIntProperty.STRUCT = nstructjs.inherit(IntProperty, _NumberPropertyBase) + `\r\n  data : int;\r\n}`;\r\nnstructjs.register(IntProperty);\r\n\r\nToolProperty.internalRegister(IntProperty);\r\n\r\nexport class ReportProperty extends StringProperty {\r\n  constructor(value, apiname, uiname, description, flag, icon) {\r\n    super(value, apiname, uiname, description, flag, icon);\r\n\r\n    this.type = PropTypes.REPORT;\r\n  }\r\n}\r\n\r\nReportProperty.STRUCT = nstructjs.inherit(ReportProperty, StringProperty) + `\r\n}\r\n`;\r\nnstructjs.register(ReportProperty);\r\nToolProperty.internalRegister(ReportProperty);\r\n\r\nexport class BoolProperty extends ToolProperty {\r\n  constructor(value, apiname,\r\n              uiname, description, flag, icon) {\r\n    super(PropTypes.BOOL, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.data = !!value;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data == b.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n    b.data = this.data;\r\n\r\n    return this;\r\n  }\r\n\r\n  setValue(val) {\r\n    this.data = !!val;\r\n    super.setValue(val);\r\n\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = super.toJSON();\r\n\r\n    return ret;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nToolProperty.internalRegister(BoolProperty);\r\nBoolProperty.STRUCT = nstructjs.inherit(BoolProperty, ToolProperty) + `\r\n  data : bool;\r\n}\r\n`;\r\nnstructjs.register(BoolProperty);\r\n\r\n\r\nexport class FloatProperty extends _NumberPropertyBase {\r\n  constructor(value, apiname,\r\n              uiname, description, flag, icon) {\r\n    super(PropTypes.FLOAT, value, apiname, uiname, description, flag, icon);\r\n\r\n    //remember to update NumberConstraintsBase et al when adding new number\r\n    //constraints\r\n\r\n    this.decimalPlaces = 4;\r\n  }\r\n\r\n  setDecimalPlaces(n) {\r\n    this.decimalPlaces = n;\r\n    return this;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n    b.data = this.data;\r\n    return this;\r\n  }\r\n\r\n  setValue(val) {\r\n    this.data = val;\r\n\r\n    //fire events\r\n    super.setValue(val);\r\n\r\n    return this;\r\n  }\r\n\r\n  toJSON() {\r\n    let json = super.toJSON();\r\n\r\n    json.data = this.data;\r\n    json.decimalPlaces = this.decimalPlaces;\r\n\r\n    return json;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    this.data = obj.data || this.data;\r\n    this.decimalPlaces = obj.decimalPlaces || this.decimalPlaces;\r\n\r\n    return this;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n  }\r\n}\r\n\r\nToolProperty.internalRegister(FloatProperty);\r\nFloatProperty.STRUCT = nstructjs.inherit(FloatProperty, _NumberPropertyBase) + `\r\n  decimalPlaces : int;\r\n  data          : float;\r\n}\r\n`;\r\nnstructjs.register(FloatProperty);\r\n\r\nexport class EnumKeyPair {\r\n  constructor(key, val) {\r\n    this.key = \"\" + key;\r\n    this.val = \"\" + val;\r\n    this.key_is_int = typeof key === \"number\" || typeof key === \"boolean\";\r\n    this.val_is_int = typeof val === \"number\" || typeof val === \"boolean\";\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    if (this.val_is_int) {\r\n      this.val = parseInt(this.val);\r\n    }\r\n\r\n    if (this.key_is_int) {\r\n      this.key = parseInt(this.key);\r\n    }\r\n  }\r\n}\r\n\r\nEnumKeyPair.STRUCT = `\r\nEnumKeyPair {\r\n  key        : string;\r\n  val        : string;\r\n  key_is_int : bool;\r\n  val_is_int : bool; \r\n}\r\n`\r\nnstructjs.register(EnumKeyPair);\r\n\r\nexport class EnumProperty extends ToolProperty {\r\n  constructor(string_or_int, valid_values, apiname,\r\n              uiname, description, flag, icon) {\r\n    super(PropTypes.ENUM, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.values = {};\r\n    this.keys = {};\r\n    this.ui_value_names = {};\r\n    this.descriptions = {};\r\n\r\n    if (valid_values === undefined) return this;\r\n\r\n    if (valid_values instanceof Array || valid_values instanceof String) {\r\n      for (var i = 0; i < valid_values.length; i++) {\r\n        this.values[valid_values[i]] = valid_values[i];\r\n        this.keys[valid_values[i]] = valid_values[i];\r\n      }\r\n    } else {\r\n      for (var k in valid_values) {\r\n        this.values[k] = valid_values[k];\r\n        this.keys[valid_values[k]] = k;\r\n      }\r\n    }\r\n\r\n    if (string_or_int === undefined) {\r\n      this.data = first(valid_values);\r\n    } else {\r\n      this.setValue(string_or_int);\r\n    }\r\n\r\n    for (var k in this.values) {\r\n      let uin = k.replace(/[_-]/g, \" \").trim();\r\n      uin = uin.split(\" \")\r\n\r\n      let uiname = ToolProperty.makeUIName(k);\r\n\r\n      this.ui_value_names[k] = uiname;\r\n      this.descriptions[k] = uiname;\r\n    }\r\n\r\n    this.iconmap = {};\r\n    this.iconmap2 = {};\r\n\r\n    this.wasSet = false;\r\n  }\r\n\r\n  calcHash(digest = new util.HashDigest()) {\r\n    for (let key in this.keys) {\r\n      digest.add(key);\r\n      digest.add(this.keys[key]);\r\n    }\r\n\r\n    return digest.get();\r\n  }\r\n\r\n  updateDefinition(enumdef_or_prop) {\r\n    let descriptions = this.descriptions;\r\n    let ui_value_names = this.ui_value_names;\r\n\r\n    this.values = {};\r\n    this.keys = {};\r\n    this.ui_value_names = {};\r\n    this.descriptions = {};\r\n\r\n    let enumdef;\r\n\r\n    if (enumdef_or_prop instanceof EnumProperty) {\r\n      enumdef = enumdef_or_prop.values;\r\n    } else {\r\n      enumdef = enumdef_or_prop;\r\n    }\r\n\r\n    for (let k in enumdef) {\r\n      let v = enumdef[k];\r\n\r\n      this.values[k] = v;\r\n      this.keys[v] = k;\r\n    }\r\n\r\n    if (enumdef_or_prop instanceof EnumProperty) {\r\n      let prop = enumdef_or_prop;\r\n      this.iconmap = Object.assign({}, prop.iconmap);\r\n      this.iconmap2 = Object.assign({}, prop.iconmap2);\r\n\r\n      this.ui_value_names = Object.assign({}, prop.ui_value_names);\r\n      this.descriptions = Object.assign({}, prop.descriptions);\r\n    } else {\r\n      for (let k in this.values) {\r\n        if (k in ui_value_names) {\r\n          this.ui_value_names[k] = ui_value_names[k];\r\n        } else {\r\n          this.ui_value_names[k] = ToolProperty.makeUIName(k);\r\n        }\r\n\r\n        if (k in descriptions) {\r\n          this.descriptions[k] = descriptions[k];\r\n        } else {\r\n          this.descriptions[k] = ToolProperty.makeUIName(k);\r\n        }\r\n      }\r\n    }\r\n\r\n    this._fire('metaChange', this);\r\n\r\n    return this;\r\n  }\r\n\r\n  calcMemSize() {\r\n    let tot = super.calcMemSize();\r\n\r\n    for (let k in this.values) {\r\n      tot += (k.length*4 + 16)*4;\r\n    }\r\n\r\n    if (this.descriptions) {\r\n      for (let k in this.descriptions) {\r\n        tot += (k.length + this.descriptions[k].length)*4;\r\n      }\r\n    }\r\n\r\n    return tot + 64;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.getValue() === b.getValue();\r\n  }\r\n\r\n  addUINames(map) {\r\n    for (let k in map) {\r\n      this.ui_value_names[k] = map[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addDescriptions(map) {\r\n    for (let k in map) {\r\n      this.descriptions[k] = map[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addIcons2(iconmap2) {\r\n    if (this.iconmap2 === undefined) {\r\n      this.iconmap2 = {};\r\n    }\r\n\r\n    for (let k in iconmap2) {\r\n      this.iconmap2[k] = iconmap2[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addIcons(iconmap) {\r\n    if (this.iconmap === undefined) {\r\n      this.iconmap = {};\r\n    }\r\n    for (let k in iconmap) {\r\n      this.iconmap[k] = iconmap[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  copyTo(p) {\r\n    super.copyTo(p);\r\n\r\n    p.data = this.data;\r\n\r\n    p.keys = Object.assign({}, this.keys);\r\n    p.values = Object.assign({}, this.values);\r\n    p.ui_value_names = this.ui_value_names;\r\n    p.update = this.update;\r\n    p.api_update = this.api_update;\r\n\r\n    p.iconmap = this.iconmap;\r\n    p.iconmap2 = this.iconmap2;\r\n    p.descriptions = this.descriptions;\r\n\r\n    return p;\r\n  }\r\n\r\n  copy() {\r\n    var p = new this.constructor(\"dummy\", {\"dummy\": 0}, this.apiname, this.uiname, this.description, this.flag)\r\n\r\n    this.copyTo(p);\r\n    return p;\r\n  }\r\n\r\n  getValue() {\r\n    if (this.data in this.values)\r\n      return this.values[this.data];\r\n    else\r\n      return this.data;\r\n  }\r\n\r\n  setValue(val) {\r\n    if (!(val in this.values) && (val in this.keys))\r\n      val = this.keys[val];\r\n\r\n    if (!(val in this.values)) {\r\n      this.report(\"Invalid value for enum!\", val, this.values);\r\n      return;\r\n    }\r\n\r\n    this.data = val;\r\n\r\n    //fire events\r\n    super.setValue(val);\r\n    return this;\r\n  }\r\n\r\n  _loadMap(obj) {\r\n    if (!obj) {\r\n      return {};\r\n    }\r\n\r\n    let ret = {};\r\n    for (let k of obj) {\r\n      ret[k.key] = k.val;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  _saveMap(obj) {\r\n    obj = obj === undefined ? {} : obj;\r\n    let ret = [];\r\n\r\n    for (let k in obj) {\r\n      ret.push(new EnumKeyPair(k, obj[k]));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n\r\n    this.keys = this._loadMap(this._keys);\r\n    this.values = this._loadMap(this._values);\r\n    this.ui_value_names = this._loadMap(this._ui_value_names);\r\n    this.iconmap = this._loadMap(this._iconmap);\r\n    this.iconmap2 = this._loadMap(this._iconmap2);\r\n    this.descriptions = this._loadMap(this._descriptions);\r\n\r\n    if (this.data_is_int) {\r\n      this.data = parseInt(this.data);\r\n      delete this.data_is_int;\r\n    } else if (this.data in this.keys) {\r\n      this.data = this.keys[this.data];\r\n    }\r\n  }\r\n\r\n  _is_data_int() {\r\n    return typeof this.data === \"number\";\r\n  }\r\n}\r\n\r\nToolProperty.internalRegister(EnumProperty);\r\nEnumProperty.STRUCT = nstructjs.inherit(EnumProperty, ToolProperty) + `\r\n  data            : string             | \"\"+this.data;\r\n  data_is_int     : bool               | this._is_data_int();\r\n  _keys           : array(EnumKeyPair) | this._saveMap(this.keys) ;\r\n  _values         : array(EnumKeyPair) | this._saveMap(this.values) ;\r\n  _ui_value_names : array(EnumKeyPair) | this._saveMap(this.ui_value_names) ;\r\n  _iconmap        : array(EnumKeyPair) | this._saveMap(this.iconmap) ;\r\n  _iconmap2       : array(EnumKeyPair) | this._saveMap(this.iconmap2) ;\r\n  _descriptions   : array(EnumKeyPair) | this._saveMap(this.descriptions) ;  \r\n}\r\n`;\r\nnstructjs.register(EnumProperty);\r\n\r\nexport class FlagProperty extends EnumProperty {\r\n  constructor(string, valid_values, apiname,\r\n              uiname, description, flag, icon) {\r\n    super(string, valid_values, apiname,\r\n      uiname, description, flag, icon);\r\n\r\n    this.type = PropTypes.FLAG;\r\n    this.wasSet = false;\r\n  }\r\n\r\n  setValue(bitmask) {\r\n    this.data = bitmask;\r\n\r\n    //do not trigger EnumProperty's setValue\r\n    ToolProperty.prototype.setValue.call(this, bitmask);\r\n    return this;\r\n  }\r\n}\r\n\r\nToolProperty.internalRegister(FlagProperty);\r\nFlagProperty.STRUCT = nstructjs.inherit(FlagProperty, EnumProperty) + `\r\n}\r\n`;\r\nnstructjs.register(FlagProperty);\r\n\r\n\r\nexport class VecPropertyBase extends FloatProperty {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(undefined, apiname, uiname, description);\r\n\r\n    this.hasUniformSlider = false;\r\n  }\r\n\r\n  calcMemSize() {\r\n    return super.calcMemSize() + this.data.length*8;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data.vectorDistance(b.data) < 0.00001;\r\n  }\r\n\r\n  uniformSlider(state = true) {\r\n    this.hasUniformSlider = state;\r\n    return this;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n    b.hasUniformSlider = this.hasUniformSlider;\r\n  }\r\n}\r\n\r\nVecPropertyBase.STRUCT = nstructjs.inherit(VecPropertyBase, FloatProperty) + `\r\n  hasUniformSlider : bool;\r\n}\r\n`;\r\n\r\n\r\nexport class Vec2Property extends FloatProperty {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(undefined, apiname, uiname, description);\r\n\r\n    this.type = PropTypes.VEC2;\r\n    this.data = new Vector2(data);\r\n  }\r\n\r\n  setValue(v) {\r\n    this.data.load(v);\r\n\r\n    //do not trigger parent classes's setValue\r\n    ToolProperty.prototype.setValue.call(this, v);\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    let data = b.data;\r\n    super.copyTo(b);\r\n\r\n    b.data = data;\r\n    b.data.load(this.data);\r\n  }\r\n}\r\n\r\nVec2Property.STRUCT = nstructjs.inherit(Vec2Property, VecPropertyBase) + `\r\n  data : vec2;\r\n}\r\n`;\r\nnstructjs.register(Vec2Property);\r\n\r\nToolProperty.internalRegister(Vec2Property);\r\n\r\nexport class Vec3Property extends VecPropertyBase {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(undefined, apiname, uiname, description);\r\n\r\n    this.type = PropTypes.VEC3;\r\n    this.data = new Vector3(data);\r\n  }\r\n\r\n  isColor() {\r\n    this.subtype = PropSubTypes.COLOR;\r\n    return this;\r\n  }\r\n\r\n  setValue(v) {\r\n    this.data.load(v);\r\n\r\n    //do not trigger parent classes's setValue\r\n    ToolProperty.prototype.setValue.call(this, v);\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    let data = b.data;\r\n    super.copyTo(b);\r\n\r\n    b.data = data;\r\n    b.data.load(this.data);\r\n  }\r\n}\r\n\r\nVec3Property.STRUCT = nstructjs.inherit(Vec3Property, VecPropertyBase) + `\r\n  data : vec3;\r\n}\r\n`;\r\nnstructjs.register(Vec3Property);\r\nToolProperty.internalRegister(Vec3Property);\r\n\r\nexport class Vec4Property extends FloatProperty {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(undefined, apiname, uiname, description);\r\n\r\n    this.type = PropTypes.VEC4;\r\n    this.data = new Vector4(data);\r\n  }\r\n\r\n  setValue(v, w = 1.0) {\r\n    this.data.load(v);\r\n\r\n    //do not trigger parent classes's setValue\r\n    ToolProperty.prototype.setValue.call(this, v);\r\n\r\n    if (v.length < 3) {\r\n      this.data[2] = 0.0;\r\n    }\r\n    if (v.length < 4) {\r\n      this.data[3] = w;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  isColor() {\r\n    this.subtype = PropSubTypes.COLOR;\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    let data = b.data;\r\n    super.copyTo(b);\r\n\r\n    b.data = data;\r\n    b.data.load(this.data);\r\n  }\r\n}\r\n\r\nVec4Property.STRUCT = nstructjs.inherit(Vec4Property, VecPropertyBase) + `\r\n  data : vec4;\r\n}\r\n`;\r\nnstructjs.register(Vec4Property);\r\nToolProperty.internalRegister(Vec4Property);\r\n\r\nexport class QuatProperty extends ToolProperty {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(PropTypes.QUAT, undefined, apiname, uiname, description);\r\n    this.data = new Quat(data);\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data.vectorDistance(b.data) < 0.00001;\r\n  }\r\n\r\n  setValue(v) {\r\n    this.data.load(v);\r\n    super.setValue(v);\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    let data = b.data;\r\n    super.copyTo(b);\r\n\r\n    b.data = data;\r\n    b.data.load(this.data);\r\n  }\r\n}\r\n\r\nQuatProperty.STRUCT = nstructjs.inherit(QuatProperty, VecPropertyBase) + `\r\n  data : vec4;\r\n}\r\n`;\r\nnstructjs.register(QuatProperty);\r\n\r\nToolProperty.internalRegister(QuatProperty);\r\n\r\nexport class Mat4Property extends ToolProperty {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(PropTypes.MATRIX4, undefined, apiname, uiname, description);\r\n    this.data = new Matrix4(data);\r\n  }\r\n\r\n  calcMemSize() {\r\n    return super.calcMemSize() + 16*8 + 32;\r\n  }\r\n\r\n  equals(b) {\r\n    let m1 = this.data.$matrix;\r\n    let m2 = b.data.$matrix;\r\n\r\n    for (let i = 1; i <= 4; i++) {\r\n      for (let j = 1; j <= 4; j++) {\r\n        let key = `m${i}${j}`;\r\n\r\n        if (Math.abs(m1[key] - m2[key]) > 0.00001) {\r\n          return false;\r\n        }\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  setValue(v) {\r\n    this.data.load(v);\r\n    super.setValue(v);\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    let data = b.data;\r\n    super.copyTo(b);\r\n    b.data = data;\r\n\r\n    b.data.load(this.data);\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n  }\r\n}\r\n\r\nMat4Property.STRUCT = nstructjs.inherit(Mat4Property, FloatProperty) + `\r\n  data           : mat4;\r\n}\r\n`;\r\nnstructjs.register(Mat4Property);\r\nToolProperty.internalRegister(Mat4Property);\r\n\r\n/**\r\n * List of other tool props (all of one type)\r\n */\r\nexport class ListProperty extends ToolProperty {\r\n  /*\r\n  * Prop must be a ToolProperty subclass instance\r\n  * */\r\n  constructor(prop, list = [], uiname = \"\") {\r\n    super(PropTypes.PROPLIST);\r\n\r\n    this.uiname = uiname;\r\n\r\n    if (typeof prop == \"number\") {\r\n      prop = PropClasses[prop];\r\n\r\n      if (prop !== undefined) {\r\n        prop = new prop();\r\n      }\r\n    } else if (prop !== undefined) {\r\n      if (prop instanceof ToolProperty) {\r\n        prop = prop.copy();\r\n      } else {\r\n        prop = new prop();\r\n      }\r\n    }\r\n\r\n\r\n    this.prop = prop;\r\n    this.value = [];\r\n\r\n    if (list) {\r\n      for (let val of list) {\r\n        this.push(val);\r\n      }\r\n    }\r\n\r\n    this.wasSet = false;\r\n  }\r\n\r\n  get length() {\r\n    return this.value.length;\r\n  }\r\n\r\n  set length(val) {\r\n    this.value.length = val;\r\n  }\r\n\r\n  calcMemSize() {\r\n    let tot = super.calcMemSize();\r\n\r\n    let psize = this.prop ? this.prop.calcMemSize() + 8 : 8;\r\n    if (!this.prop && this.value.length > 0) {\r\n      psize = this.value[0].calcMemSize();\r\n    }\r\n\r\n    tot += psize*this.value.length + 8;\r\n    tot += 16;\r\n\r\n    return tot;\r\n  }\r\n\r\n  equals(b) {\r\n    let l1 = this.value ? this.value.length : 0;\r\n    let l2 = b.value ? b.value.length : 0;\r\n\r\n    if (l1 !== l2) {\r\n      return false;\r\n    }\r\n\r\n    for (let i = 0; i < l1; i++) {\r\n      let prop1 = this.value[i];\r\n      let prop2 = b.value[i];\r\n\r\n      let bad = prop1.constructor !== prop2.constructor;\r\n      bad = bad || !prop1.equals(prop2);\r\n\r\n      if (bad) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n\r\n    b.prop = this.prop.copy();\r\n\r\n    for (let prop of this.value) {\r\n      b.value.push(prop.copy());\r\n    }\r\n\r\n    return b;\r\n  }\r\n\r\n  copy() {\r\n    return this.copyTo(new ListProperty(this.prop.copy()));\r\n  }\r\n\r\n  push(item = undefined) {\r\n    if (item === undefined) {\r\n      item = this.prop.copy();\r\n    }\r\n\r\n    if (!(item instanceof ToolProperty)) {\r\n      let prop = this.prop.copy();\r\n      prop.setValue(item);\r\n      item = prop;\r\n    }\r\n\r\n    this.value.push(item);\r\n    return item;\r\n  }\r\n\r\n  clear() {\r\n    this.value.length = 0;\r\n  }\r\n\r\n  getListItem(i) {\r\n    return this.value[i].getValue();\r\n  }\r\n\r\n  setListItem(i, val) {\r\n    this.value[i].setValue(val);\r\n  }\r\n\r\n  setValue(value) {\r\n    this.clear();\r\n\r\n    for (let item of value) {\r\n      let prop = this.push();\r\n\r\n      if (typeof item !== \"object\") {\r\n        prop.setValue(item);\r\n      } else if (item instanceof prop.constructor) {\r\n        item.copyTo(prop);\r\n      } else {\r\n        this.report(item);\r\n        throw new Error(\"invalid value \" + item);\r\n      }\r\n    }\r\n\r\n    super.setValue(value);\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.value;\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    let list = this.value;\r\n\r\n    return (function* () {\r\n      for (let item of list) {\r\n        yield item.getValue();\r\n      }\r\n    })();\r\n  }\r\n}\r\n\r\nListProperty.STRUCT = nstructjs.inherit(ListProperty, ToolProperty) + `\r\n  prop  : abstract(ToolProperty);\r\n  value : array(abstract(ToolProperty));\r\n}`;\r\nnstructjs.register(ListProperty);\r\n\r\nToolProperty.internalRegister(ListProperty);\r\n\r\n\r\n//like FlagsProperty but uses strings\r\nexport class StringSetProperty extends ToolProperty {\r\n  constructor(value = undefined, definition = []) {\r\n    super(PropTypes.STRSET);\r\n\r\n    let values = [];\r\n\r\n    this.value = new util.set();\r\n\r\n    let def = definition;\r\n    if (Array.isArray(def) || def instanceof util.set || def instanceof Set) {\r\n      for (let item of def) {\r\n        values.push(item);\r\n      }\r\n    } else if (typeof def === \"object\") {\r\n      for (let k in def) {\r\n        values.push(k);\r\n      }\r\n    } else if (typeof def === \"string\") {\r\n      values.push(def);\r\n    }\r\n\r\n    this.values = {};\r\n    this.ui_value_names = {};\r\n    this.descriptions = {};\r\n    this.iconmap = {};\r\n    this.iconmap2 = {};\r\n\r\n    for (let v of values) {\r\n      this.values[v] = v;\r\n\r\n      let uiname = ToolProperty.makeUIName(v);\r\n      this.ui_value_names[v] = uiname;\r\n    }\r\n\r\n    if (value !== undefined) {\r\n      this.setValue(value);\r\n    }\r\n\r\n    this.wasSet = false;\r\n  }\r\n\r\n  calcMemSize() {\r\n    let tot = super.calcMemSize();\r\n\r\n    for (let k in this.values) {\r\n      tot += (k.length + 16)*5;\r\n    }\r\n\r\n    if (this.descriptions) {\r\n      for (let k in this.descriptions) {\r\n        tot += (k.length + this.descriptions[k].length + 8)*4;\r\n      }\r\n    }\r\n\r\n    return tot + 64;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.value.equals(b.value);\r\n  }\r\n\r\n  /*\r\n  * Values can be a string, undefined/null, or a list/set/object-literal of strings.\r\n  * If destructive is true, then existing set will be cleared.\r\n  * */\r\n  setValue(values, destructive = true, soft_fail = true) {\r\n    let bad = typeof values !== \"string\";\r\n    bad = bad && typeof values !== \"object\";\r\n    bad = bad && values !== undefined && values !== null;\r\n\r\n    if (bad) {\r\n      if (soft_fail) {\r\n        this.report(\"Invalid argument to StringSetProperty.prototype.setValue() \" + values);\r\n        return;\r\n      } else {\r\n        throw new Error(\"Invalid argument to StringSetProperty.prototype.setValue() \" + values);\r\n      }\r\n    }\r\n\r\n    //handle undefined/null\r\n    if (!values) {\r\n      this.value.clear();\r\n    } else if (typeof values === \"string\") {\r\n      if (destructive)\r\n        this.value.clear();\r\n\r\n      if (!(values in this.values)) {\r\n        if (soft_fail) {\r\n          this.report(`\"${values}\" is not in this StringSetProperty`);\r\n          return;\r\n        } else {\r\n          throw new Error(`\"${values}\" is not in this StringSetProperty`);\r\n        }\r\n      }\r\n\r\n      this.value.add(values);\r\n    } else {\r\n      let data = [];\r\n\r\n      if (Array.isArray(values) || values instanceof util.set || values instanceof Set) {\r\n        for (let item of values) {\r\n          data.push(item);\r\n        }\r\n      } else { //object literal?\r\n        for (let k in values) {\r\n          data.push(k);\r\n        }\r\n      }\r\n\r\n      for (let item of data) {\r\n        if (!(item in this.values)) {\r\n          if (soft_fail) {\r\n            this.report(`\"${item}\" is not in this StringSetProperty`);\r\n            continue;\r\n          } else {\r\n            throw new Error(`\"${item}\" is not in this StringSetProperty`);\r\n          }\r\n        }\r\n\r\n        this.value.add(item);\r\n      }\r\n    }\r\n\r\n    super.setValue();\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.value;\r\n  }\r\n\r\n  addIcons2(iconmap2) {\r\n    if (iconmap2 === undefined)\r\n      return;\r\n\r\n    for (let k in iconmap2) {\r\n      this.iconmap2[k] = iconmap2[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addIcons(iconmap) {\r\n    if (iconmap === undefined)\r\n      return;\r\n\r\n    for (let k in iconmap) {\r\n      this.iconmap[k] = iconmap[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addUINames(map) {\r\n    for (let k in map) {\r\n      this.ui_value_names[k] = map[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addDescriptions(map) {\r\n    for (let k in map) {\r\n      this.descriptions[k] = map[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n\r\n    for (let val of this.value) {\r\n      b.value.add(val);\r\n    }\r\n\r\n    b.values = {};\r\n    for (let k in this.values) {\r\n      b.values[k] = this.values[k];\r\n    }\r\n\r\n    b.ui_value_names = {};\r\n    for (let k in this.ui_value_names) {\r\n      b.ui_value_names[k] = this.ui_value_names[k];\r\n    }\r\n\r\n    b.iconmap = {};\r\n    b.iconmap2 = {};\r\n\r\n    for (let k in this.iconmap) {\r\n      b.iconmap[k] = this.iconmap[k];\r\n    }\r\n\r\n    for (let k in this.iconmap2) {\r\n      b.iconmap2[k] = this.iconmap2[k];\r\n    }\r\n\r\n    b.descriptions = {};\r\n    for (let k in this.descriptions) {\r\n      b.descriptions[k] = this.descriptions[k];\r\n    }\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    let values = this.values;\r\n    this.values = {};\r\n\r\n    for (let s of values) {\r\n      this.values[s] = s;\r\n    }\r\n\r\n    this.value = new util.set(this.value);\r\n  }\r\n}\r\n\r\nStringSetProperty.STRUCT = nstructjs.inherit(StringSetProperty, ToolProperty) + `\r\n  value  : iter(string);\r\n  values : iterkeys(string);  \r\n}`;\r\nnstructjs.register(StringSetProperty);\r\n\r\nToolProperty.internalRegister(StringSetProperty);\r\n\r\nimport {Curve1D} from '../curve/curve1d.js';\r\n\r\nexport class Curve1DProperty extends ToolProperty {\r\n  constructor(curve, apiname, uiname, description, flag, icon) {\r\n    super(PropTypes.CURVE, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.data = new Curve1D();\r\n\r\n    if (curve !== undefined) {\r\n      this.setValue(curve);\r\n    }\r\n\r\n    this.wasSet = false;\r\n  }\r\n\r\n  calcMemSize() {\r\n    //bleh, just return a largish block size\r\n    return 1024;\r\n  }\r\n\r\n  equals(b) {\r\n\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  evaluate(t) {\r\n    return this.data.evaluate(t);\r\n  }\r\n\r\n  setValue(curve) {\r\n    if (curve === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.data.load(curve);\r\n    super.setValue(curve);\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n\r\n    b.setValue(this.data);\r\n  }\r\n}\r\n\r\nCurve1DProperty.STRUCT = nstructjs.inherit(Curve1DProperty, ToolProperty) + `\r\n  data : Curve1D;\r\n}\r\n`;\r\n\r\nnstructjs.register(Curve1DProperty);\r\nToolProperty.internalRegister(Curve1DProperty);\r\n\r\n","//import * as nstructjs from './struct.js';\r\nimport {haveModal, _setModalAreaClass} from '../path-controller/util/simple_events.js';\r\nimport * as util from '../path-controller/util/util.js';\r\n\r\nimport '../path-controller/util/struct.js';\r\n\r\nlet ScreenClass = undefined;\r\n\r\nimport {ClassIdSymbol} from '../core/ui_base.js';\r\n\r\n\r\nexport function setScreenClass(cls) {\r\n  ScreenClass = cls;\r\n}\r\n\r\nexport function getAreaIntName(name) {\r\n  let hash = 0;\r\n\r\n  for (let i = 0; i < name.length; i++) {\r\n    let c = name.charCodeAt(i);\r\n\r\n    if (i%2 === 0) {\r\n      hash += c<<8;\r\n      hash *= 13;\r\n      hash = hash & ((1<<15) - 1);\r\n    } else {\r\n      hash += c;\r\n    }\r\n  }\r\n\r\n  return hash;\r\n}\r\n\r\n//XXX get rid of me\r\nwindow.getAreaIntName = getAreaIntName;\r\n\r\n//XXX get rid of me\r\nexport var AreaTypes = {\r\n  TEST_CANVAS_EDITOR: 0\r\n};\r\n\r\nexport function setAreaTypes(def) {\r\n  for (let k in AreaTypes) {\r\n    delete AreaTypes[k];\r\n  }\r\n\r\n  for (let k in def) {\r\n    AreaTypes[k] = def[k];\r\n  }\r\n}\r\n\r\nexport let areaclasses = {};\r\n\r\n/*hackish! store ref an active wrangler so simple_event's modal\r\n* system can lock it!*/\r\nlet theWrangler = undefined;\r\n\r\nexport class AreaWrangler {\r\n  constructor() {\r\n    this.stacks = new Map();\r\n    this.lasts = new Map();\r\n    this.lastArea = undefined;\r\n    this.stack = [];\r\n    this.idgen = 0;\r\n    this.locked = 0;\r\n    this._last_screen_id = undefined;\r\n\r\n    theWrangler = this;\r\n  }\r\n\r\n  /*Yeek this is particularly evil, it creates a context\r\n  * that can be used by popups with the original context\r\n  * area stack intact of the elements that spawned them.*/\r\n  makeSafeContext(ctx) {\r\n    let wrangler = this.copy();\r\n    let this2 = this;\r\n\r\n    return new Proxy(ctx, {\r\n      get(target, key, rec) {\r\n        wrangler.copyTo(contextWrangler);\r\n        return target[key];\r\n      }\r\n    });\r\n  }\r\n\r\n  copyTo(ret) {\r\n    for (let [key, stack1] of this.stacks) {\r\n      ret.stack.set(key, util.list(stack1));\r\n    }\r\n\r\n    for (let [key, val] of this.lasts) {\r\n      ret.lasts.set(key, val);\r\n    }\r\n\r\n    ret.stack = util.list(this.stack);\r\n    ret.lastArea = this.lastArea;\r\n  }\r\n\r\n  copy(b) {\r\n    let ret = new AreaWrangler();\r\n    this.copyTo(ret);\r\n    return ret;\r\n  }\r\n\r\n  _checkWrangler(ctx) {\r\n    if (ctx === undefined) {\r\n      return true;\r\n    }\r\n\r\n    if (this._last_screen_id === undefined) {\r\n      this._last_screen_id = ctx.screen._id;\r\n      return true;\r\n    }\r\n\r\n    if (ctx.screen._id !== this._last_screen_id) {\r\n      this.reset();\r\n\r\n      this._last_screen_id = ctx.screen._id;\r\n      console.warn(\"contextWrangler detected a new screen; new file?\");\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  reset() {\r\n    theWrangler = this;\r\n    this.stacks = new Map();\r\n    this.lasts = new Map();\r\n    this.lastArea = undefined;\r\n    this.stack = [];\r\n    this.locked = 0;\r\n    this._last_screen_id = undefined;\r\n\r\n    return this;\r\n  }\r\n\r\n  static findInstance() {\r\n    return theWrangler;\r\n  }\r\n\r\n  static lock() {\r\n    return this.findInstance().lock();\r\n  }\r\n\r\n  static unlock() {\r\n    return this.findInstance().unlock();\r\n  }\r\n\r\n  lock() {\r\n    this.locked++;\r\n    return this;\r\n  }\r\n\r\n  unlock() {\r\n    this.locked = Math.max(this.locked - 1, 0);\r\n    return this;\r\n  }\r\n\r\n  push(type, area, pushLastRef = true) {\r\n    theWrangler = this;\r\n\r\n    if (haveModal() || this.locked) {\r\n      pushLastRef = false;\r\n    }\r\n\r\n    if (pushLastRef || !this.lasts.has(type[ClassIdSymbol])) {\r\n      this.lasts.set(type[ClassIdSymbol], area);\r\n      this.lastArea = area;\r\n    }\r\n\r\n    let stack = this.stacks.get(type[ClassIdSymbol]);\r\n    if (stack === undefined) {\r\n      stack = [];\r\n      this.stacks.set(type[ClassIdSymbol], stack);\r\n    }\r\n\r\n    let last = this.lasts.get(type[ClassIdSymbol]);\r\n\r\n    stack.push(last);\r\n    stack.push(area);\r\n\r\n    this.stack.push(area);\r\n  }\r\n\r\n  updateLastRef(type, area) {\r\n    theWrangler = this;\r\n\r\n    if ((this.locked || haveModal()) && this.lasts.has(type[ClassIdSymbol])) {\r\n      return;\r\n    }\r\n\r\n    this.lasts.set(type[ClassIdSymbol], area);\r\n    this.lastArea = area;\r\n  }\r\n\r\n  pop(type, area) {\r\n    let stack = this.stacks.get(type[ClassIdSymbol]);\r\n\r\n    if (stack === undefined) {\r\n      console.warn(\"pop_ctx_area called in error\");\r\n      //throw new Error(\"pop_ctx_area called in error\");\r\n      return;\r\n    }\r\n\r\n    if (stack.length > 0) {\r\n      stack.pop();\r\n      let last = stack.pop();\r\n\r\n      /* paranoia isConnected check to ensure stale elements don't\r\n       * pollute the lasts stack */\r\n      if (!this.locked && last && last.isConnected) {\r\n        this.lasts.set(type[ClassIdSymbol], last);\r\n      }\r\n    } else {\r\n      console.error(\"pop_ctx_area called in error\");\r\n    }\r\n\r\n    if (this.stack.length > 0) {\r\n      this.stack.pop();\r\n    }\r\n  }\r\n\r\n  getLastArea(type) {\r\n    //if (Math.random() > 0.9995) {\r\n      //console.warn(\"getLastArea!\", type, this.lasts.get(type[ClassIdSymbol]));\r\n    //}\r\n\r\n    if (type === undefined) {\r\n      if (this.stack.length > 0) {\r\n        return this.stack[this.stack.length - 1];\r\n      } else {\r\n        return this.lastArea;\r\n      }\r\n    } else {\r\n      if (this.stacks.has(type[ClassIdSymbol])) {\r\n        let stack = this.stacks.get(type[ClassIdSymbol]);\r\n\r\n        if (stack.length > 0) {\r\n          return stack[stack.length-1];\r\n        }\r\n      }\r\n\r\n      return this.lasts.get(type[ClassIdSymbol]);\r\n    }\r\n  }\r\n}\r\n_setModalAreaClass(AreaWrangler);\r\n\r\nexport let contextWrangler = new AreaWrangler();\r\n","export function css2matrix(s) {\r\n  return new DOMMatrix(s);\r\n}\r\n\r\nexport function matrix2css(m) {\r\n  if (m.$matrix) {\r\n    m = m.$matrix;\r\n  }\r\n\r\n  return `matrix(${m.m11},${m.m12},${m.m21},${m.m22},${m.m41},${m.m42})`\r\n}\r\n\r\n","\"use strict\";\r\n\r\nimport * as util from './util.js';\r\nimport * as vectormath from './vectormath.js';\r\n\r\nimport {Vector2, Vector3, Vector4, Matrix4, Quat} from './vectormath.js';\r\n\r\nlet dtvtmps = util.cachering.fromConstructor(Vector3, 32);\r\n\r\n\r\nlet quad_co_rets2 = util.cachering.fromConstructor(Vector2, 512);\r\n\r\nexport function quad_bilinear(v1, v2, v3, v4, u, v) {\r\n  return -((v1 - v2)*u - v1 - (u*v1 - u*v2 + u*v3 - u*v4 - v1 + v4)*v);\r\n}\r\n\r\n/*\r\n\r\n on factor;\r\n off period;\r\n\r\n a1 := v1 + (v2 - v1) * u;\r\n a2 := v4 + (v3 - v4) * u;\r\n bilin := a1 + (a2 - a1) * v;\r\n\r\n v1x := 0;\r\n v1y := 0;\r\n\r\n bx := sub(v1=v1x, v2=v2x, v3=v3x, v4=v4x, bilin);\r\n by := sub(v1=v1y, v2=v2y, v3=v3y, v4=v4y, bilin);\r\n\r\n f1 := bx - x;\r\n f2 := by - y;\r\n\r\n ff := solve({f1, f2}, {u, v});\r\n\r\n */\r\nfunction quad_uv_2d(p, v1, v2, v3, v4) {\r\n  let u, v;\r\n\r\n  let v2x = v2[0] - v1[0];\r\n  let v2y = v2[1] - v1[1];\r\n  let v3x = v3[0] - v1[0];\r\n  let v3y = v3[1] - v1[1];\r\n  let v4x = v4[0] - v1[0];\r\n  let v4y = v4[1] - v1[1];\r\n\r\n  let x = p[0] - v1[0];\r\n  let y = p[1] - v1[1];\r\n  let sqrt = Math.sqrt;\r\n\r\n  let A = 2*(((v4y + y)*x - 2*v4x*y)*\r\n      v3y + (v4x*y - v4y*x)*(v4y + y) - ((v4x - x)*v2y - v3x*y)*(v4y - y))*v2x - 2*(\r\n      (v4x*y - v4y*x)*(v4x + x) - (v4x - x)*v3y*x + ((2*v4y - y)*x - v4x*y)*v3x)*\r\n    v2y + (v4x*y - v4y*x + v3y*x - v3x*y)**2 + (v4x - x)**2*v2y**2 + (v4y - y)**2*\r\n    v2x**2;\r\n\r\n  let B = v4x*y - v4y*x + v3y*x - v3x*y;\r\n\r\n  let C1 = (2*(v3x - v4x)*v2y - 2*(v3y - v4y)*v2x);\r\n  let C2 = (2*(v3x*v4y - v3y*v4x + v2y*v4x) - 2*v2x*v4y);\r\n\r\n  let u1, u2;\r\n\r\n  if (A < 0.0) {\r\n    console.log(\"A was < 0\", A);\r\n    A = -A;\r\n    C1 = C2 = 0.0;\r\n  }\r\n\r\n  if (Math.abs(C1) < 0.00001) { //perfectly 90 degrees?\r\n    let dx = v2x;\r\n    let dy = v2y;\r\n\r\n    console.log(\"C1 bad\");\r\n\r\n    let l = Math.sqrt(dx*dx + dy*dy);\r\n    if (l > 0.000001) {\r\n      dx /= l*l;\r\n      dy /= l*l;\r\n    }\r\n\r\n    u1 = u2 = dx*x + dy*y;\r\n  } else {\r\n    u1 = (-(B + sqrt(A) - (v4y - y)*v2x) - (v4x - x)*v2y)/C1;\r\n    u2 = (-(B - sqrt(A) - (v4y - y)*v2x) - (v4x - x)*v2y)/C1;\r\n  }\r\n\r\n  if (Math.abs(C2) < 0.00001) { //perfectly 90 degrees?\r\n    let dx, dy;\r\n\r\n    dx = v3x - v2x;\r\n    dy = v3y - v2y;\r\n\r\n    console.log(\"C2 bad\");\r\n\r\n    let l = Math.sqrt(dx**2 + dy**2);\r\n    if (l > 0.00001) {\r\n      dx /= l*l;\r\n      dy /= l*l;\r\n    }\r\n\r\n    v1 = v2 = x*dx + y*dy;\r\n  } else {\r\n    v1 = (-(B - sqrt(A) + (v4y + y)*v2x) + (v4x + x)*v2y)/C2;\r\n    v2 = (-(B + sqrt(A) + (v4y + y)*v2x) + (v4x + x)*v2y)/C2;\r\n  }\r\n\r\n  let ret = quad_co_rets2.next();\r\n\r\n  let d1 = (u1 - 0.5)**2 + (v1 - 0.5)**2;\r\n  let d2 = (u2 - 0.5)**2 + (v2 - 0.5)**2;\r\n\r\n  if (d1 < d2) {\r\n    ret[0] = u1;\r\n    ret[1] = v1;\r\n  } else {\r\n    ret[0] = u2;\r\n    ret[1] = v2;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n\r\nexport const ClosestModes = {\r\n  CLOSEST  : 0,\r\n  START    : 1,\r\n  END      : 2,\r\n  ENDPOINTS: 3,\r\n  ALL      : 4\r\n};\r\n\r\nlet advs = util.cachering.fromConstructor(Vector4, 128);\r\n\r\nexport class AbstractCurve {\r\n  evaluate(t) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  derivative(t) {\r\n  }\r\n\r\n  curvature(t) {\r\n\r\n  }\r\n\r\n  normal(t) {\r\n\r\n  }\r\n\r\n  width(t) {\r\n\r\n  }\r\n}\r\n\r\nexport class ClosestCurveRets {\r\n  constructor() {\r\n    this.p = new Vector3();\r\n    this.t = 0;\r\n  }\r\n}\r\n\r\nlet cvrets = util.cachering.fromConstructor(ClosestCurveRets, 2048);\r\nlet cvarrays = new util.ArrayPool();\r\nlet cvtmp = new Array(1024);\r\n\r\nexport function closestPoint(p, curve, mode) {\r\n  let steps = 5;\r\n  let s = 0, ds = 1.0/steps;\r\n\r\n  let ri = 0;\r\n\r\n  for (let i = 0; i < steps; i++, s += ds) {\r\n    let c1 = curve.evaluate(s);\r\n    let c2 = curve.evaluate(s + ds);\r\n\r\n\r\n  }\r\n}\r\n\r\nlet poly_normal_tmps = util.cachering.fromConstructor(Vector3, 64);\r\nlet pncent = new Vector3();\r\n\r\nexport function normal_poly(vs) {\r\n  if (vs.length === 3) {\r\n    return poly_normal_tmps.next().load(normal_tri(vs[0], vs[1], vs[2]));\r\n  } else if (vs.length === 4) {\r\n    return poly_normal_tmps.next().load(normal_quad(vs[0], vs[1], vs[2], vs[3]));\r\n  }\r\n\r\n  if (vs.length === 0) {\r\n    return poly_normal_tmps.next().zero();\r\n  }\r\n\r\n  let cent = pncent.zero();\r\n  let tot = 0;\r\n\r\n  for (let v of vs) {\r\n    cent.add(v);\r\n    tot++;\r\n  }\r\n\r\n  cent.mulScalar(1.0/tot);\r\n  let n = poly_normal_tmps.next().zero();\r\n\r\n  for (let i = 0; i < vs.length; i++) {\r\n    let a = vs[i];\r\n    let b = vs[(i + 1)%vs.length];\r\n    let c = cent;\r\n\r\n    let n2 = normal_tri(a, b, c);\r\n    n.add(n2);\r\n  }\r\n\r\n  n.normalize();\r\n  return n;\r\n}\r\n\r\n/*\r\non factor;\r\noff period;\r\n\r\nf1 := u*v1x + v*v2x + (1.0-u-v)*v3x - px;\r\nf2 := u*v1y + v*v2y + (1.0-u-v)*v3y - py;\r\n\r\nff := solve({f1, f2}, {u, v});\r\n\r\non fort;\r\npart(ff, 1, 1);\r\npart(ff, 1, 2);\r\noff fort;\r\n\r\n*/\r\n\r\nlet barycentric_v2_rets = util.cachering.fromConstructor(Vector2, 2048);\r\nlet calc_proj_refs = new util.cachering(() => [0, 0], 64);\r\n\r\n/*\r\n  a b c d\r\n     b\r\n\r\n  a------c\r\n\r\n     d\r\n\r\n  on factor;\r\n  load_package avector;\r\n\r\n  ax := 0;\r\n  ay := 0;\r\n  az := 0;\r\n\r\n  a := avec(ax, ay, az);\r\n  b := avec(bx, by, bz);\r\n  c := avec(cx, cy, cz);\r\n  d := avec(dx, dy, dz);\r\n\r\n  n1 := d cross c;\r\n  n2 := c cross b;\r\n\r\n  n1 := n1 / (VMOD n1);\r\n  n2 := n2 / (VMOD n2);\r\n\r\n  d := n1 dot n2;\r\n  on fort;\r\n\r\n  d*d;\r\n\r\n  off fort;\r\n\r\n\r\n  */\r\n\r\n/**\r\n\r\n v2\r\n\r\n v1------v3\r\n\r\n v4\r\n\r\n */\r\nexport function dihedral_v3_sqr(v1, v2, v3, v4) {\r\n  let bx = v2[0] - v1[0];\r\n  let by = v2[1] - v1[1];\r\n  let bz = v2[2] - v1[2];\r\n\r\n  let cx = v3[0] - v1[0];\r\n  let cy = v3[1] - v1[1];\r\n  let cz = v3[2] - v1[2];\r\n\r\n  let dx = v4[0] - v1[0];\r\n  let dy = v4[1] - v1[1];\r\n  let dz = v4[2] - v1[2];\r\n\r\n\r\n  return ((bx*cz - bz*cx)*(cx*dz - cz*dx) + (by*cz - bz*cy)*(cy*dz - cz*dy) + (bx*cy - by*cx)*\r\n    (cx*dy - cy*dx))**2/(((bx*cz - bz*cx)**2 + (by*cz - bz*cy)**2\r\n    + (bx*cy - by*cx)**2)*((cx*dz - cz*dx)**2 + (cy*dz - cz*dy)**2 + (cx*dy - cy*dx)**2));\r\n}\r\n\r\nlet tet_area_tmps = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport function tet_volume(a, b, c, d) {\r\n  a = tet_area_tmps.next().load(a);\r\n  b = tet_area_tmps.next().load(b);\r\n  c = tet_area_tmps.next().load(c);\r\n  d = tet_area_tmps.next().load(d);\r\n\r\n  a.sub(d);\r\n  b.sub(d);\r\n  c.sub(d);\r\n\r\n  b.cross(c);\r\n  return a.dot(b)/6.0;\r\n}\r\n\r\nexport function calc_projection_axes(no) {\r\n  let ax = Math.abs(no[0]), ay = Math.abs(no[1]), az = Math.abs(no[2]);\r\n\r\n  let ret = calc_proj_refs.next();\r\n\r\n  if (ax > ay && ax > az) {\r\n    ret[0] = 1;\r\n    ret[1] = 2;\r\n  } else if (ay > az && ay > ax) {\r\n    ret[0] = 0;\r\n    ret[1] = 2;\r\n  } else {\r\n    ret[0] = 0;\r\n    ret[1] = 1;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nlet _avtmps = util.cachering.fromConstructor(Vector3, 128);\r\n\r\nfunction inrect_3d(p, min, max) {\r\n  let ok = p[0] >= min[0] && p[0] <= max[0];\r\n  ok = ok && p[1] >= min[1] && p[1] <= max[1];\r\n  ok = ok && p[2] >= min[2] && p[2] <= max[2];\r\n\r\n  return ok;\r\n}\r\n\r\nexport function aabb_isect_line_3d(v1, v2, min, max) {\r\n  let inside = inrect_3d(v1, min, max);\r\n  inside = inside || inrect_3d(v2, min, max);\r\n\r\n  if (inside) {\r\n    return true;\r\n  }\r\n\r\n  let cent = _avtmps.next().load(min).interp(max, 0.5);\r\n\r\n  let p = closest_point_on_line(cent, v1, v2, true);\r\n  if (!p) {\r\n    return false;\r\n  }\r\n\r\n  p = p[0];\r\n\r\n  return inrect_3d(p, min, max);\r\n}\r\n\r\nexport function aabb_isect_cylinder_3d(v1, v2, radius, min, max) {\r\n  let inside = inrect_3d(v1, min, max);\r\n  inside = inside || inrect_3d(v2, min, max);\r\n\r\n  if (inside) {\r\n    return true;\r\n  }\r\n\r\n  let cent = _avtmps.next().load(min).interp(max, 0.5);\r\n\r\n  let p = closest_point_on_line(cent, v1, v2, true);\r\n  if (!p) {\r\n    return false;\r\n  }\r\n\r\n  p = p[0];\r\n\r\n  let size = _avtmps.next().load(max).sub(min);\r\n\r\n  size.mulScalar(0.5);\r\n  size.addScalar(radius); //*(3**0.5));\r\n\r\n  p.sub(cent).abs();\r\n\r\n  return p[0] <= size[0] && p[1] <= size[1] && p[2] <= size[2];\r\n}\r\n\r\nexport function barycentric_v2(p, v1, v2, v3, axis1 = 0, axis2 = 1, out = undefined) {\r\n  let div = (v2[axis1]*v3[axis2] - v2[axis2]*v3[axis1] + (v2[axis2] - v3[axis2])*v1[axis1] - (v2[axis1] - v3[axis1])*v1[axis2]);\r\n\r\n  if (Math.abs(div) < 0.000001) {\r\n    div = 0.00001;\r\n  }\r\n\r\n  let u = (v2[axis1]*v3[axis2] - v2[axis2]*v3[axis1] + (v2[axis2] - v3[axis2])*p[axis1] - (v2[axis1] - v3[axis1])*p[axis2])/div;\r\n  let v = (-(v1[axis1]*v3[axis2] - v1[axis2]*v3[axis1] + (v1[axis2] - v3[axis2])*p[axis1]) + (v1[axis1] - v3[axis1])*p[axis2])/div;\r\n\r\n  if (!out) {\r\n    out = barycentric_v2_rets.next();\r\n  }\r\n\r\n  out[0] = u;\r\n  out[1] = v;\r\n\r\n  return out;\r\n}\r\n\r\n/*\r\n\r\non factor;\r\n\r\nload_package \"avector\";\r\n\r\npx := 0;\r\npy := 0;\r\npz := 0;\r\n\r\nv1 := avec(v1x, v1y, v1z);\r\nv2 := avec(v2x, v2y, v2z);\r\np := avec(px, py, pz);\r\n\r\nt1 := p - v1;\r\nt2 := v2 - v1;\r\n\r\nl1 := t2 / VMOD t2;\r\n\r\nt := dot(t1, t2);\r\n\r\np2 := v1 + t2*t;\r\n\r\non fort;\r\ndot(p2, p2);\r\noff fort;\r\n\r\n**/\r\n\r\nfunction _linedis2(co, v1, v2) {\r\n  let v1x = v1[0] - co[0];\r\n  let v1y = v1[1] - co[1];\r\n  let v1z = v1[2] - co[2];\r\n\r\n  let v2x = v2[0] - co[0];\r\n  let v2y = v2[1] - co[1];\r\n  let v2z = v2[2] - co[2];\r\n\r\n  let dis = (((v1y - v2y)*v1y + (v1z - v2z)*v1z + (v1x - v2x)*v1x)*(v1y - v2y) - v1y)**2 +\r\n    (((v1y - v2y)*v1y + (v1z - v2z)*v1z + (v1x - v2x)*v1x)*(v1z - v2z) - v1z)**2 +\r\n    (((v1y - v2y)*v1y + (v1z - v2z)*v1z + (v1x - v2x)*v1x)*(v1x - v2x) - v1x)**2;\r\n\r\n  return dis;\r\n}\r\n\r\nlet closest_p_tri_rets = new util.cachering(() => {\r\n  return {\r\n    co  : new Vector3(),\r\n    uv  : new Vector2(),\r\n    dist: 0\r\n  }\r\n}, 512);\r\n\r\nlet cpt_v1 = new Vector3();\r\nlet cpt_v2 = new Vector3();\r\nlet cpt_v3 = new Vector3();\r\nlet cpt_v4 = new Vector3();\r\nlet cpt_v5 = new Vector3();\r\nlet cpt_v6 = new Vector3();\r\nlet cpt_p = new Vector3();\r\nlet cpt_n = new Vector3();\r\nlet cpt_mat = new Matrix4();\r\nlet cpt_mat2 = new Matrix4();\r\nlet cpt_b = new Vector3();\r\n\r\nexport function closest_point_on_quad(p, v1, v2, v3, v4, n, uvw) {\r\n  let a = closest_point_on_tri(p, v1, v2, v3, n, uvw);\r\n  let b = closest_point_on_tri(p, v1, v3, v4, n, uvw);\r\n\r\n  return a.dist <= b.dist ? a : b;\r\n}\r\n\r\nexport function closest_point_on_tri(p, v1, v2, v3, n, uvw) {\r\n  let op = p;\r\n\r\n  if (uvw) {\r\n    uvw[0] = uvw[1] = 0.0;\r\n    if (uvw.length > 2) {\r\n      uvw[2] = 0.0;\r\n    }\r\n  }\r\n\r\n  v1 = cpt_v1.load(v1);\r\n  v2 = cpt_v2.load(v2);\r\n  v3 = cpt_v3.load(v3);\r\n  p = cpt_p.load(p);\r\n\r\n  if (n === undefined) {\r\n    n = cpt_n.load(normal_tri(v1, v2, v3));\r\n  }\r\n\r\n  v1.sub(p);\r\n  v2.sub(p);\r\n  v3.sub(p);\r\n  p.zero();\r\n\r\n\r\n  /*use least squares to solve for barycentric coordinates\r\n    then clip to triangle\r\n\r\n    we do this in 2d, as all solutions are coplanar anyway and that way we\r\n    can have one of the equations be \"u+v+w = 1\".\r\n    should investigate if this is really necassary.\r\n   */\r\n\r\n  let ax1, ax2;\r\n  let ax = Math.abs(n[0]), ay = Math.abs(n[1]), az = Math.abs(n[2]);\r\n  if (ax === 0.0 && ay === 0.0 && az === 0.0) {\r\n    console.log(\"eek1\", n, v1, v2, v3);\r\n    let ret = closest_p_tri_rets.next();\r\n\r\n    ret.dist = 1e17;\r\n    ret.co.zero();\r\n    ret.uv.zero();\r\n\r\n    return ret;\r\n  }\r\n\r\n  let ax3;\r\n  if (ax >= ay && ax >= az) {\r\n    ax1 = 1;\r\n    ax2 = 2;\r\n    ax3 = 0;\r\n  } else if (ay >= ax && ay >= az) {\r\n    ax1 = 0;\r\n    ax2 = 2;\r\n    ax3 = 1;\r\n  } else {\r\n    ax1 = 0;\r\n    ax2 = 1;\r\n    ax3 = 2;\r\n  }\r\n\r\n  let mat = cpt_mat;\r\n  let mat2 = cpt_mat2;\r\n  mat.makeIdentity();\r\n\r\n  let m = mat.$matrix;\r\n\r\n  m.m11 = v1[ax1];\r\n  m.m12 = v2[ax1];\r\n  m.m13 = v3[ax1];\r\n  m.m14 = 0.0;\r\n\r\n  m.m21 = v1[ax2];\r\n  m.m22 = v2[ax2];\r\n  m.m23 = v3[ax2];\r\n  m.m24 = 0.0;\r\n\r\n  /*\r\n  m.m31 = v1[ax3];\r\n  m.m32 = v2[ax3];\r\n  m.m33 = v3[ax3];\r\n  m.m34 = 0.0;\r\n  */\r\n\r\n  m.m31 = 1;\r\n  m.m32 = 1;\r\n  m.m33 = 1;\r\n  m.m34 = 0.0;\r\n\r\n  mat.transpose();\r\n\r\n  let b = cpt_b.zero();\r\n\r\n  b[0] = p[ax1];\r\n  b[1] = p[ax2];\r\n  //b[2] = p[ax3];\r\n  b[2] = 1.0;\r\n  b[3] = 0.0;\r\n\r\n  mat2.load(mat).transpose();\r\n\r\n  mat.preMultiply(mat2);\r\n\r\n  if (mat.invert() === null) {\r\n    console.log(\"eek2\", mat.determinant(), ax1, ax2, n);\r\n    let ret = closest_p_tri_rets.next();\r\n\r\n    ret.dist = 1e17;\r\n    ret.co.zero();\r\n    ret.uv.zero();\r\n\r\n    return ret;\r\n  }\r\n\r\n  mat.multiply(mat2);\r\n\r\n\r\n  b.multVecMatrix(mat);\r\n\r\n  let u = b[0];\r\n  let v = b[1];\r\n  let w = b[2];\r\n\r\n  for (let i = 0; i < 1; i++) {\r\n    u = Math.min(Math.max(u, 0.0), 1.0);\r\n    v = Math.min(Math.max(v, 0.0), 1.0);\r\n    w = Math.min(Math.max(w, 0.0), 1.0);\r\n\r\n    let tot = u + v + w;\r\n\r\n    if (tot !== 0.0) {\r\n      tot = 1.0/tot;\r\n      u *= tot;\r\n      v *= tot;\r\n      w *= tot;\r\n    }\r\n  }\r\n\r\n  if (uvw) {\r\n    uvw[0] = u;\r\n    uvw[1] = v;\r\n    if (uvw.length > 2) {\r\n      uvw[2] = w;\r\n    }\r\n  }\r\n\r\n  let x = v1[0]*u + v2[0]*v + v3[0]*w;\r\n  let y = v1[1]*u + v2[1]*v + v3[1]*w;\r\n  let z = v1[2]*u + v2[2]*v + v3[2]*w;\r\n\r\n  let ret = closest_p_tri_rets.next();\r\n\r\n  ret.co.loadXYZ(x, y, z);\r\n  ret.uv[0] = u;\r\n  ret.uv[1] = v;\r\n\r\n  ret.dist = ret.co.vectorLength();\r\n  ret.co.add(op);\r\n\r\n  return ret;\r\n}\r\n\r\nexport function dist_to_tri_v3_old(co, v1, v2, v3, no = undefined) {\r\n  if (!no) {\r\n    no = dtvtmps.next().load(normal_tri(v1, v2, v3));\r\n  }\r\n\r\n  let p = dtvtmps.next().load(co);\r\n  p.sub(v1);\r\n\r\n  let planedis = -p.dot(no);\r\n\r\n  let [axis, axis2] = calc_projection_axes(no);\r\n\r\n  let p1 = dtvtmps.next();\r\n  let p2 = dtvtmps.next();\r\n  let p3 = dtvtmps.next();\r\n\r\n  p1[0] = v1[axis];\r\n  p1[1] = v1[axis2];\r\n  p1[2] = 0.0;\r\n\r\n  p2[0] = v2[axis];\r\n  p2[1] = v2[axis2];\r\n  p2[2] = 0.0;\r\n\r\n  p3[0] = v3[axis];\r\n  p3[1] = v3[axis2];\r\n  p3[2] = 0.0;\r\n\r\n  let pp = dtvtmps.next();\r\n  pp[0] = co[axis];\r\n  pp[1] = co[axis2];\r\n  pp[2] = 0.0;\r\n\r\n  let dis = 1e17;\r\n\r\n  function linedis2d(a, b, c) {\r\n    let dx1 = a[0] - b[0];\r\n    let dy1 = a[1] - b[1];\r\n    let dx2 = c[0] - b[0];\r\n    let dy2 = c[1] - b[1];\r\n\r\n    let len = dx2*dx2 + dy2*dy2;\r\n    len = len > 0.000001 ? 1.0 / len : 0.0;\r\n\r\n    dx2 *= len;\r\n    dy2 *= len;\r\n\r\n    return Math.abs(dx1*dy2 - dx2*dy1);\r\n  }\r\n\r\n  let tmp = dtvtmps.next();\r\n  let tmp2 = dtvtmps.next();\r\n\r\n  function linedis3d(a, b, c) {\r\n    tmp.load(a).sub(b);\r\n    tmp2.load(c).sub(b).normalize();\r\n\r\n    let t = tmp.dot(tmp2);\r\n    t = Math.min(Math.max(t, 0.0), b.vectorDistance(c));\r\n\r\n    tmp2.mulScalar(t).add(b);\r\n\r\n    return tmp2.vectorDistance(a);\r\n  }\r\n\r\n\r\n  /* are we above the triangle? if so use plane distance */\r\n  if (point_in_tri(pp, p1, p2, p3)) {\r\n    return Math.abs(planedis);\r\n  }\r\n\r\n  /* get distance to the closest edge */\r\n  dis = Math.min(dis, linedis3d(co, v1, v2));\r\n  dis = Math.min(dis, linedis3d(co, v2, v3));\r\n  dis = Math.min(dis, linedis3d(co, v3, v1));\r\n\r\n  if (0) {\r\n    let uv = barycentric_v2(pp, p1, p2, p3);\r\n\r\n    let w = 1.0 - uv[0] - uv[1];\r\n    uv[0] = Math.min(Math.max(uv[0], 0.0), 1.0);\r\n    uv[1] = Math.min(Math.max(uv[1], 0.0), 1.0);\r\n    w = Math.min(Math.max(w, 0.0), 1.0);\r\n\r\n    let sum = (uv[0] + uv[1] + w);\r\n    sum = sum !== 0.0 ? 1.0/sum : 0.0;\r\n\r\n    w *= sum;\r\n    uv[0] *= sum;\r\n    uv[1] *= sum;\r\n\r\n    pp.zero();\r\n\r\n    pp.addFac(v1, uv[0]);\r\n    pp.addFac(v2, uv[1]);\r\n    pp.addFac(v3, 1.0 - uv[0] - uv[1]);\r\n\r\n    dis = Math.min(dis, pp.vectorDistance(co));\r\n  }\r\n\r\n  return dis;\r\n}\r\n\r\n\r\nexport function dist_to_tri_v3(p, v1, v2, v3, n) {\r\n  return dist_to_tri_v3_old(p, v1, v2, v3, n);\r\n  //return Math.sqrt(Math.abs(dist_to_tri_v3_sqr(p, v1, v2, v3, n)));\r\n}\r\n\r\n\r\n/* reduce script\r\n\r\non factor;\r\n\r\nax := 0;\r\nay := 0;\r\n\r\ne1x := bx - ax;\r\ne1y := by - ay;\r\ne2x := cx - bx;\r\ne2y := cy - by;\r\ne3x := ax - cx;\r\ne3y := ay - cy;\r\n\r\nl1 := (e1x**2 + e1y**2)**0.5;\r\nl2 := (e2x**2 + e2y**2)**0.5;\r\nl3 := (e3x**2 + e3y**2)**0.5;\r\n\r\nload_package \"avector\";\r\n\r\ne1 := avec(e1x / l1, e1y / l1, 0.0);\r\ne2 := avec(e2x / l2, e2y / l2, 0.0);\r\ne3 := avec(e3x / l3, e3y / l3, 0.0);\r\n\r\nd1 := x1*e1[1] - y1*e1[0];\r\nd2 := x1*e2[1] - y1*e2[0];\r\nd3 := x1*e3[1] - y1*e3[0];\r\n\r\nd1 := d1**2;\r\nd2 := d2**2;\r\nd3 := d3**2;\r\n\r\non fort;\r\nd1;\r\nd2;\r\nd3;\r\noff fort;\r\n\r\n*/\r\n\r\nlet _dt3s_n = new Vector3();\r\n\r\nexport function dist_to_tri_v3_sqr(p, v1, v2, v3, n) {\r\n  if (n === undefined) {\r\n    n = _dt3s_n;\r\n    n.load(normal_tri(v1, v2, v3));\r\n  }\r\n\r\n  // find projection axis;\r\n  let axis1, axis2, axis3;\r\n  let nx = n[0] < 0.0 ? -n[0] : n[0];\r\n  let ny = n[1] < 0.0 ? -n[1] : n[1];\r\n  let nz = n[2] < 0.0 ? -n[2] : n[2];\r\n\r\n  const feps = 0.0000001;\r\n\r\n  if (nx > ny && nx > nz) {\r\n    axis1 = 1;\r\n    axis2 = 2;\r\n    axis3 = 0;\r\n  } else if (ny > nx && ny > nz) {\r\n    axis1 = 0;\r\n    axis2 = 2;\r\n    axis3 = 1;\r\n  } else {\r\n    axis1 = 0;\r\n    axis2 = 1;\r\n    axis3 = 2;\r\n  }\r\n\r\n  //n.load(normal_tri(v1, v2, v3));\r\n\r\n  let planedis = (p[0] - v1[0])*n[0] + (p[1] - v1[1])*n[1] + (p[2] - v1[2])*n[2];\r\n  planedis = planedis < 0.0 ? -planedis : planedis;\r\n\r\n  let ax = v1[axis1], ay = v1[axis2], az = v1[axis3];\r\n\r\n  let bx = v2[axis1] - ax, by = v2[axis2] - ay, bz = v2[axis3] - az;\r\n  let cx = v3[axis1] - ax, cy = v3[axis2] - ay, cz = v3[axis3] - az;\r\n\r\n  let bx2 = bx*bx, by2 = by*by, bz2 = bz*bz, cx2 = cx*cx, cy2 = cy*cy, cz2 = cz*cz;\r\n\r\n  let x1 = p[axis1] - ax;\r\n  let y1 = p[axis2] - ay;\r\n  let z1 = p[axis3] - az;\r\n\r\n  const testf = 0.0;\r\n\r\n  let l1 = Math.sqrt(bx**2 + by**2);\r\n  let l2 = Math.sqrt((cx - bx)**2 + (cy - by)**2);\r\n  let l3 = Math.sqrt(cx**2 + cy**2);\r\n\r\n  let s1 = x1*by - y1*bx < testf;\r\n  let s2 = (x1 - bx)*(cy - by) - (y1 - by)*(cx - bx) < testf;\r\n  let s3 = (x1* -cy + y1*cx) < testf;\r\n\r\n  /*\r\n    (x1-cx)*-cy - (y1-cy)*-cx\r\n   reduces to:\r\n     x1*-cy + y1*cx;\r\n   */\r\n\r\n  //console.log(axis1, axis2, axis3, n);\r\n  //console.log(s1, s2, s3);\r\n  //console.log(bx, by, cx, cy);\r\n\r\n  if (1 && n[axis3] < 0.0) {\r\n    s1 = !s1;\r\n    s2 = !s2;\r\n    s3 = !s3;\r\n    /*\r\n        bx = v3[axis1];\r\n        by = v3[axis2];\r\n        bz = v3[axis3];\r\n\r\n        cx = v2[axis1];\r\n        cy = v2[axis2];\r\n        cz = v2[axis3];\r\n\r\n        bx2 = bx*bx;\r\n        by2 = by*by;\r\n        bz2 = bz*bz;\r\n\r\n        cx2 = cx*cx;\r\n        cy2 = cy*cy;\r\n        cz2 = cz*cz;*/\r\n  }\r\n\r\n  let mask = (s1 & 1) | (s2<<1) | (s3<<2);\r\n  if (mask === 0 || mask === 7) {\r\n    return planedis*planedis;\r\n  }\r\n\r\n  let d1, d2, d3, div;\r\n\r\n\r\n  /*\r\n//\\  3|\r\n//  \\ |\r\n//    b\r\n//    | \\\r\n//  1 |   \\  2\r\n//    |  0  \\\r\n// ___a_______c___\r\n//  5 |   4      \\ 6\r\n*/\r\n\r\n  let dis = 0.0;\r\n  let lx, ly, lz;\r\n\r\n  lx = bx;\r\n  ly = by;\r\n  lz = bz;\r\n\r\n  nx = n[axis1];\r\n  ny = n[axis2];\r\n  nz = n[axis3];\r\n\r\n  switch (mask) {\r\n    case 1:\r\n      div = (bx2 + by2);\r\n\r\n      if (div > feps) {\r\n        d1 = (bx*y1 - by*x1);\r\n        d1 = (d1*d1)/div;\r\n\r\n        lx = -by;\r\n        ly = bx;\r\n        lz = bz;\r\n      } else {\r\n        d1 = x1*x1 + y1*y1;\r\n\r\n        lx = x1;\r\n        ly = y1;\r\n        lz = z1;\r\n      }\r\n\r\n      dis = d1;\r\n      break;\r\n    case 3:\r\n      lx = x1 - bx;\r\n      ly = y1 - by;\r\n      lz = z1 - bz;\r\n\r\n      dis = lx*lx + ly*ly;\r\n      return lx*lx + ly*ly + lz*lz;\r\n    case 2:\r\n      div = (bx - cx)**2 + (by - cy)**2;\r\n\r\n      if (div > feps) {\r\n        d2 = ((bx - cx)*y1 - (by - cy)*x1);\r\n        d2 = d2/div;\r\n\r\n        lx = (by - cy);\r\n        ly = (cx - bx);\r\n        lz = cz - bz;\r\n      } else {\r\n        d2 = (x1 - bx)*(x1 - bx) + (y1 - by)*(y1 - by);\r\n\r\n        lx = x1 - bx;\r\n        ly = y1 - by;\r\n        lz = z1 - bz;\r\n      }\r\n\r\n      dis = d2;\r\n      break;\r\n    case 6:\r\n      lx = x1 - cx;\r\n      ly = y1 - cy;\r\n      lz = z1 - cz;\r\n\r\n      return lx*lx + ly*ly + lz*lz;\r\n    case 4:\r\n      div = (cx2 + cy2);\r\n\r\n      if (div > feps) {\r\n        d3 = (cx*y1 - cy*x1);\r\n        d3 = (d3*d3)/div;\r\n\r\n        lx = cy;\r\n        ly = -cx;\r\n        lz = cz;\r\n      } else {\r\n        d3 = (x1 - cx)*(x1 - cx) + (y1 - cy)*(y1 - cy);\r\n\r\n        lx = x1 - cx;\r\n        ly = y1 - cy;\r\n        lz = z1 - cz;\r\n      }\r\n\r\n      dis = d3;\r\n      break;\r\n    case 5:\r\n      lx = x1;\r\n      ly = y1;\r\n      lz = z1;\r\n\r\n      return lx*lx + ly*ly + lz*lz;\r\n  }\r\n\r\n  //lx = p[axis1] - v1[axis1];\r\n  //ly = p[axis2] - v1[axis2];\r\n  {\r\n    let d = lx*nx + ly*ny + lz*nz;\r\n\r\n    d = -d;\r\n\r\n    lx += nx*d;\r\n    ly += ny*d;\r\n    lz += nz*d;\r\n\r\n    //dis = lx*lx + ly*ly;\r\n\r\n    if (0 && Math.random() > 0.999) {\r\n      console.log(\"d\", d.toFixed(6));\r\n      console.log(lx*nx + ly*ny + lz*nz);\r\n    }\r\n  }\r\n\r\n  let mul = ((lx**2 + ly**2)*nz**2 + (lx*nx + ly*ny)**2)/((lx**2 + ly**2)*nz**2);\r\n  //let mul = ((lx**2+ly**2)*nz**2+(lx*nx+ly*ny)**2)/((ly**2+lz**2+lx**2)*nz**2);\r\n\r\n  //mul = 1.0 / nz;\r\n  //mul *= mul;\r\n\r\n  if (Math.random() > 0.999) {\r\n    console.log(mul.toFixed(4));\r\n  }\r\n\r\n  //mul = 1.0;\r\n\r\n  if (0) {\r\n    let odis = dis;\r\n\r\n    dis = x1**2 + y1**2 + z1**2;\r\n\r\n    if (Math.random() > 0.999) {\r\n      console.log((dis/odis).toFixed(4), mul.toFixed(4));\r\n    }\r\n    mul = 1.0;\r\n  }\r\n\r\n  /*\r\n  on factor;\r\n\r\n  dx := sqrt(dis)*(lx / sqrt(lx**2 + ly**2));\r\n  dy := sqrt(dis)*(ly / sqrt(lx**2 + ly**2));\r\n  f2 := dx*nx + dy*ny + dz*nz;\r\n\r\n  fz := solve(f2, dz);\r\n  fz := part(fz, 1, 2);\r\n\r\n  dis2 := dx*dx + dy*dy + fz*fz;\r\n  fmul := dis2/dis;\r\n\r\n  on fort;\r\n  fmul;\r\n  off fort;\r\n\r\n\r\n  */\r\n\r\n  return dis*mul + planedis*planedis;\r\n}\r\n\r\nlet tri_area_temps = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport function tri_area(v1, v2, v3) {\r\n  let l1 = v1.vectorDistance(v2);\r\n  let l2 = v2.vectorDistance(v3);\r\n  let l3 = v3.vectorDistance(v1);\r\n\r\n  let s = (l1 + l2 + l3)/2.0;\r\n  return Math.sqrt(s*(s - l1)*(s - l2)*(s - l3))\r\n}\r\n\r\nexport function aabb_overlap_area(pos1, size1, pos2, size2) {\r\n  let r1 = 0.0, r2 = 0.0;\r\n\r\n  for (let i = 0; i < 2; i++) {\r\n    let a1 = pos1[i], a2 = pos2[i];\r\n    let b1 = pos1[i] + size1[i];\r\n    let b2 = pos2[i] + size2[i];\r\n\r\n    if (b1 >= a2 && b2 >= a1) {\r\n      let r = Math.abs(a2 - b1);\r\n      r = Math.min(r, Math.abs(a1 - b2));\r\n\r\n      if (i) {\r\n        r2 = r;\r\n      } else {\r\n        r1 = r;\r\n      }\r\n    }\r\n  }\r\n\r\n  return r1*r2;\r\n}\r\n\r\n/**\r\n * Returns true if two aabbs intersect\r\n * @param {*} pos1\r\n * @param {*} size1\r\n * @param {*} pos2\r\n * @param {*} size2\r\n */\r\n\r\nexport function aabb_isect_2d(pos1, size1, pos2, size2) {\r\n  let ret = 0;\r\n  for (let i = 0; i < 2; i++) {\r\n    let a = pos1[i];\r\n    let b = pos1[i] + size1[i];\r\n    let c = pos2[i];\r\n    let d = pos2[i] + size2[i];\r\n    if (b >= c && a <= d)\r\n      ret += 1;\r\n  }\r\n  return ret === 2;\r\n};\r\n\r\n\r\nexport function aabb_isect_3d(pos1, size1, pos2, size2) {\r\n  let ret = 0;\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    let a = pos1[i];\r\n    let b = pos1[i] + size1[i];\r\n\r\n    let c = pos2[i];\r\n    let d = pos2[i] + size2[i];\r\n\r\n    if (b >= c && a <= d)\r\n      ret += 1;\r\n  }\r\n  return ret === 3;\r\n}\r\n\r\n\r\nlet aabb_intersect_vs = util.cachering.fromConstructor(Vector2, 32);\r\nlet aabb_intersect_rets = new util.cachering(() => {\r\n  return {\r\n    pos : new Vector2(),\r\n    size: new Vector2()\r\n  }\r\n}, 512);\r\n\r\n/**\r\n * Returns aabb that's the intersection of two aabbs\r\n * @param {*} pos1\r\n * @param {*} size1\r\n * @param {*} pos2\r\n * @param {*} size2\r\n */\r\nexport function aabb_intersect_2d(pos1, size1, pos2, size2) {\r\n  let v1 = aabb_intersect_vs.next().load(pos1);\r\n  let v2 = aabb_intersect_vs.next().load(pos1).add(size1);\r\n  let v3 = aabb_intersect_vs.next().load(pos2);\r\n  let v4 = aabb_intersect_vs.next().load(pos2).add(size2);\r\n\r\n  let min = aabb_intersect_vs.next().zero();\r\n  let max = aabb_intersect_vs.next().zero();\r\n\r\n  let tot = 0;\r\n\r\n  for (let i = 0; i < 2; i++) {\r\n    if (v2[i] >= v3[i] && v1[i] <= v4[i]) {\r\n      tot++;\r\n\r\n      min[i] = Math.max(v3[i], v1[i]);\r\n      max[i] = Math.min(v2[i], v4[i]);\r\n    }\r\n  }\r\n\r\n  if (tot !== 2) {\r\n    return undefined;\r\n  }\r\n\r\n  let ret = aabb_intersect_rets.next();\r\n  ret.pos.load(min);\r\n  ret.size.load(max).sub(min);\r\n\r\n  return ret;\r\n}\r\n\r\nwindow.test_aabb_intersect_2d = function () {\r\n  let canvas = document.getElementById(\"test_canvas\");\r\n\r\n  if (!canvas) {\r\n    canvas = document.createElement(\"canvas\");\r\n    canvas.setAttribute(\"id\", \"test_canvas\");\r\n    canvas.g = canvas.getContext(\"2d\");\r\n\r\n    document.body.appendChild(canvas);\r\n  }\r\n\r\n  canvas.width = ~~(window.innerWidth*devicePixelRatio);\r\n  canvas.height = ~~(window.innerHeight*devicePixelRatio);\r\n  canvas.style.width = (canvas.width/devicePixelRatio) + \"px\";\r\n  canvas.style.height = (canvas.height/devicePixelRatio) + \"px\";\r\n  canvas.style.position = \"absolute\";\r\n  canvas.style[\"z-index\"] = \"1000\";\r\n\r\n  let g = canvas.g;\r\n  g.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n  let sz = 800;\r\n  let a1 = new Vector2([Math.random()*sz, Math.random()*sz]).floor();\r\n  let a2 = new Vector2([Math.random()*sz, Math.random()*sz]).floor();\r\n  let b1 = new Vector2([Math.random()*sz, Math.random()*sz]).floor();\r\n  let b2 = new Vector2([Math.random()*sz, Math.random()*sz]).floor();\r\n\r\n  let p1 = new Vector2();\r\n  let s1 = new Vector2();\r\n  let p2 = new Vector2();\r\n  let s2 = new Vector2();\r\n\r\n  p1.load(a1).min(a2);\r\n  s1.load(a1).max(a2);\r\n  p2.load(b1).min(b2);\r\n  s2.load(b1).max(b2);\r\n\r\n  s1.sub(p1);\r\n  s2.sub(p1);\r\n\r\n  console.log(p1, s1);\r\n  console.log(p2, s2);\r\n\r\n  g.beginPath();\r\n  g.rect(0, 0, canvas.width, canvas.height);\r\n  g.fillStyle = \"white\";\r\n  g.fill();\r\n\r\n  g.beginPath();\r\n  g.rect(p1[0], p1[1], s1[0], s1[1]);\r\n  g.fillStyle = \"rgba(255, 100, 75, 1.0)\";\r\n  g.fill();\r\n\r\n  g.beginPath();\r\n  g.rect(p2[0], p2[1], s2[0], s2[1]);\r\n  g.fillStyle = \"rgba(75, 100, 255, 1.0)\";\r\n  g.fill();\r\n\r\n  let ret = aabb_intersect_2d(p1, s1, p2, s2);\r\n\r\n  if (ret) {\r\n\r\n    g.beginPath();\r\n    g.rect(ret.pos[0], ret.pos[1], ret.size[0], ret.size[1]);\r\n    g.fillStyle = \"rgba(0, 0, 0, 1.0)\";\r\n    g.fill();\r\n  }\r\n\r\n  /*\r\n  window.setTimeout(() => {\r\n    canvas.remove();\r\n  }, 2000);\r\n  //*/\r\n\r\n  return {\r\n    end  : test_aabb_intersect_2d.end,\r\n    timer: test_aabb_intersect_2d.timer\r\n  };\r\n}\r\n\r\ntest_aabb_intersect_2d.stop = function stop() {\r\n  if (test_aabb_intersect_2d._timer) {\r\n    console.log(\"stopping timer\");\r\n\r\n    window.clearInterval(test_aabb_intersect_2d._timer);\r\n    test_aabb_intersect_2d._timer = undefined;\r\n  }\r\n}\r\n\r\ntest_aabb_intersect_2d.end = function end() {\r\n  test_aabb_intersect_2d.stop();\r\n\r\n  let canvas = document.getElementById(\"test_canvas\");\r\n  if (canvas) {\r\n    canvas.remove();\r\n  }\r\n}\r\ntest_aabb_intersect_2d.timer = function timer(rate = 500) {\r\n  if (test_aabb_intersect_2d._timer) {\r\n    window.clearInterval(test_aabb_intersect_2d._timer);\r\n    test_aabb_intersect_2d._timer = undefined;\r\n    console.log(\"stopping timer\");\r\n    return;\r\n  }\r\n\r\n  console.log(\"starting timer\");\r\n\r\n  test_aabb_intersect_2d._timer = window.setInterval(() => {\r\n    test_aabb_intersect_2d();\r\n  }, rate);\r\n};\r\n\r\nlet aabb_intersect_vs3 = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport function aabb_intersect_3d(min1, max1, min2, max2) {\r\n  let tot = 0;\r\n\r\n  for (let i = 0; i < 2; i++) {\r\n    if (max1[i] >= min2[i] && min1[i] <= max2[i]) {\r\n      tot++;\r\n    }\r\n  }\r\n\r\n  if (tot !== 3) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n/**\r\n * AABB union of a and b.\r\n * Result is in a.\r\n *\r\n * @param a List of two vectors\r\n * @param b List of two vectors\r\n * @returns a\r\n */\r\nexport function aabb_union(a, b) {\r\n  for (let i = 0; i < 2; i++) {\r\n    for (let j = 0; j < a[i].length; j++) {\r\n      a[i][j] = i ? Math.max(a[i][j], b[i][j]) : Math.min(a[i][j], b[i][j]);\r\n    }\r\n  }\r\n\r\n  return a;\r\n}\r\n\r\nexport function aabb_union_2d(pos1, size1, pos2, size2) {\r\n  let v1 = aabb_intersect_vs.next();\r\n  let v2 = aabb_intersect_vs.next();\r\n  let min = aabb_intersect_vs.next();\r\n  let max = aabb_intersect_vs.next();\r\n  v1.load(pos1).add(size1);\r\n  v2.load(pos2).add(size2);\r\n\r\n  min.load(v1).min(v2);\r\n  max.load(v1).max(v2);\r\n\r\n  max.sub(min);\r\n  let ret = aabb_intersect_rets.next();\r\n\r\n  ret.pos.load(min);\r\n  ret.pos.load(max);\r\n\r\n  return ret;\r\n}\r\n\r\n//XXX refactor to use es6 classes,\r\n//    or at last the class system in typesystem.js\r\nfunction init_prototype(cls, proto) {\r\n  for (var k in proto) {\r\n    cls.prototype[k] = proto[k];\r\n  }\r\n\r\n  return cls.prototype;\r\n}\r\n\r\nfunction inherit(cls, parent, proto) {\r\n  cls.prototype = Object.create(parent.prototype);\r\n\r\n  for (var k in proto) {\r\n    cls.prototype[k] = proto[k];\r\n  }\r\n\r\n  return cls.prototype;\r\n}\r\n\r\nvar set = util.set;\r\n\r\n//everything below here was compiled from es6 code  \r\n//variables starting with $ are function static local vars,\r\n//like in C.  don't use them outside their owning functions.\r\n//\r\n//except for $_mh and $_swapt.  they were used with a C macro\r\n//preprocessor.\r\nvar $_mh, $_swapt;\r\n\r\n//XXX destroy me\r\nexport const feps = 2.22e-16;\r\n\r\nexport const COLINEAR = 1;\r\nexport const LINECROSS = 2;\r\nexport const COLINEAR_ISECT = 3;\r\n\r\nvar _cross_vec1 = new Vector3();\r\nvar _cross_vec2 = new Vector3();\r\n\r\nexport const SQRT2 = Math.sqrt(2.0);\r\nexport const FEPS_DATA = {\r\n  F16: 1.11e-16,\r\n  F32: 5.96e-08,\r\n  F64: 4.88e-04\r\n};\r\n\r\n/*use 32 bit epsilon by default, since we're often working from\r\n  32-bit float data.  note that javascript uses 64-bit doubles \r\n  internally.*/\r\nexport const FEPS = FEPS_DATA.F32;\r\nexport const FLOAT_MIN = -1e+21;\r\nexport const FLOAT_MAX = 1e+22;\r\nexport const Matrix4UI = Matrix4;\r\n\r\n/*\r\nvar Matrix4UI=exports.Matrix4UI = function(loc, rot, size) {\r\n  if (rot==undefined) {\r\n      rot = undefined;\r\n  }\r\n  \r\n  if (size==undefined) {\r\n      size = undefined;\r\n  }\r\n  \r\n  Object.defineProperty(this, \"loc\", {get: function() {\r\n    var t=new Vector3();\r\n    this.decompose(t);\r\n    return t;\r\n  }, set: function(loc) {\r\n    var l=new Vector3(), r=new Vector3(), s=new Vector3();\r\n    this.decompose(l, r, s);\r\n    this.calc(loc, r, s);\r\n  }});\r\n  \r\n  Object.defineProperty(this, \"size\", {get: function() {\r\n    var t=new Vector3();\r\n    this.decompose(undefined, undefined, t);\r\n    return t;\r\n  }, set: function(size) {\r\n    var l=new Vector3(), r=new Vector3(), s=new Vector3();\r\n    this.decompose(l, r, s);\r\n    this.calc(l, r, size);\r\n  }});\r\n  \r\n  Object.defineProperty(this, \"rot\", {get: function() {\r\n    var t=new Vector3();\r\n    this.decompose(undefined, t);\r\n    return t;\r\n  }, set: function(rot) {\r\n    var l=new Vector3(), r=new Vector3(), s=new Vector3();\r\n    this.decompose(l, r, s);\r\n    this.calc(l, rot, s);\r\n  }});\r\n  \r\n  if (loc instanceof Matrix4) {\r\n      this.load(loc);\r\n      return ;\r\n  }\r\n  \r\n  if (rot==undefined)\r\n    rot = [0, 0, 0];\r\n  if (size==undefined)\r\n    size = [1.0, 1.0, 1.0];\r\n  this.makeIdentity();\r\n  this.calc(loc, rot, size);\r\n};\r\n\r\nMatrix4UI.prototype = inherit(Matrix4UI, Matrix4, {\r\n  calc : function(loc, rot, size) {\r\n    this.rotate(rot[0], rot[1], rot[2]);\r\n    this.scale(size[0], size[1], size[2]);\r\n    this.translate(loc[0], loc[1], loc[2]);\r\n  }\r\n\r\n});\r\n*/\r\n\r\nif (FLOAT_MIN != FLOAT_MIN || FLOAT_MAX != FLOAT_MAX) {\r\n  FLOAT_MIN = 1e-05;\r\n  FLOAT_MAX = 1000000.0;\r\n  console.log(\"Floating-point 16-bit system detected!\");\r\n}\r\n\r\nvar _static_grp_points4 = new Array(4);\r\nvar _static_grp_points8 = new Array(8);\r\n\r\nexport function get_rect_points(p, size) {\r\n  var cs;\r\n  if (p.length == 2) {\r\n    cs = _static_grp_points4;\r\n    cs[0] = p;\r\n    cs[1] = [p[0] + size[0], p[1]];\r\n    cs[2] = [p[0] + size[0], p[1] + size[1]];\r\n    cs[3] = [p[0], p[1] + size[1]];\r\n  } else if (p.length == 3) {\r\n    cs = _static_grp_points8;\r\n    cs[0] = p;\r\n    cs[1] = [p[0] + size[0], p[1], p[2]];\r\n    cs[2] = [p[0] + size[0], p[1] + size[1], p[2]];\r\n    cs[3] = [p[0], p[1] + size[0], p[2]];\r\n    cs[4] = [p[0], p[1], p[2] + size[2]];\r\n    cs[5] = [p[0] + size[0], p[1], p[2] + size[2]];\r\n    cs[6] = [p[0] + size[0], p[1] + size[1], p[2] + size[2]];\r\n    cs[7] = [p[0], p[1] + size[0], p[2] + size[2]];\r\n  } else {\r\n    throw \"get_rect_points has no implementation for \" + p.length + \"-dimensional data\";\r\n  }\r\n  return cs;\r\n};\r\n\r\nexport function get_rect_lines(p, size) {\r\n  var ps = get_rect_points(p, size);\r\n  if (p.length == 2) {\r\n    return [[ps[0], ps[1]], [ps[1], ps[2]], [ps[2], ps[3]], [ps[3], ps[0]]];\r\n  } else if (p.length == 3) {\r\n    var l1 = [[ps[0], ps[1]], [ps[1], ps[2]], [ps[2], ps[3]], [ps[3], ps[0]]];\r\n    var l2 = [[ps[4], ps[5]], [ps[5], ps[6]], [ps[6], ps[7]], [ps[7], ps[4]]];\r\n    l1.concat(l2);\r\n    l1.push([ps[0], ps[4]]);\r\n    l1.push([ps[1], ps[5]]);\r\n    l1.push([ps[2], ps[6]]);\r\n    l1.push([ps[3], ps[7]]);\r\n    return l1;\r\n  } else {\r\n    throw \"get_rect_points has no implementation for \" + p.length + \"-dimensional data\";\r\n  }\r\n};\r\n\r\nvar $vs_simple_tri_aabb_isect = [0, 0, 0];\r\n\r\nexport function simple_tri_aabb_isect(v1, v2, v3, min, max) {\r\n  $vs_simple_tri_aabb_isect[0] = v1;\r\n  $vs_simple_tri_aabb_isect[1] = v2;\r\n  $vs_simple_tri_aabb_isect[2] = v3;\r\n  for (var i = 0; i < 3; i++) {\r\n    var isect = true;\r\n    for (var j = 0; j < 3; j++) {\r\n      if ($vs_simple_tri_aabb_isect[j][i] < min[i] || $vs_simple_tri_aabb_isect[j][i] >= max[i])\r\n        isect = false;\r\n    }\r\n    if (isect)\r\n      return true;\r\n  }\r\n  return false;\r\n};\r\n\r\nexport class MinMax {\r\n  constructor(totaxis) {\r\n    if (totaxis == undefined) {\r\n      totaxis = 1;\r\n    }\r\n    this.totaxis = totaxis;\r\n    if (totaxis != 1) {\r\n      let cls;\r\n\r\n      switch (totaxis) {\r\n        case 2:\r\n          cls = Vector2;\r\n          break;\r\n        case 3:\r\n          cls = Vector3;\r\n          break;\r\n        case 4:\r\n          cls = Vector4;\r\n          break;\r\n        default:\r\n          cls = Array;\r\n          break;\r\n      }\r\n\r\n      this._min = new cls(totaxis);\r\n      this._max = new cls(totaxis);\r\n      this.min = new cls(totaxis);\r\n      this.max = new cls(totaxis);\r\n    } else {\r\n      this.min = this.max = 0;\r\n      this._min = FLOAT_MAX;\r\n      this._max = FLOAT_MIN;\r\n    }\r\n    this.reset();\r\n    this._static_mr_co = new Array(this.totaxis);\r\n    this._static_mr_cs = new Array(this.totaxis*this.totaxis);\r\n  }\r\n\r\n  static fromSTRUCT(reader) {\r\n    var ret = new MinMax();\r\n    reader(ret);\r\n    return ret;\r\n  }\r\n\r\n  load(mm) {\r\n    if (this.totaxis == 1) {\r\n      this.min = mm.min;\r\n      this.max = mm.max;\r\n      this._min = mm.min;\r\n      this._max = mm.max;\r\n    } else {\r\n      this.min = new Vector3(mm.min);\r\n      this.max = new Vector3(mm.max);\r\n      this._min = new Vector3(mm._min);\r\n      this._max = new Vector3(mm._max);\r\n    }\r\n  }\r\n\r\n  reset() {\r\n    var totaxis = this.totaxis;\r\n    if (totaxis == 1) {\r\n      this.min = this.max = 0;\r\n      this._min = FLOAT_MAX;\r\n      this._max = FLOAT_MIN;\r\n    } else {\r\n      for (var i = 0; i < totaxis; i++) {\r\n        this._min[i] = FLOAT_MAX;\r\n        this._max[i] = FLOAT_MIN;\r\n        this.min[i] = 0;\r\n        this.max[i] = 0;\r\n      }\r\n    }\r\n  }\r\n\r\n  minmax_rect(p, size) {\r\n    var totaxis = this.totaxis;\r\n    var cs = this._static_mr_cs;\r\n    if (totaxis == 2) {\r\n      cs[0] = p;\r\n      cs[1] = [p[0] + size[0], p[1]];\r\n      cs[2] = [p[0] + size[0], p[1] + size[1]];\r\n      cs[3] = [p[0], p[1] + size[1]];\r\n    } else if (totaxis = 3) {\r\n      cs[0] = p;\r\n      cs[1] = [p[0] + size[0], p[1], p[2]];\r\n      cs[2] = [p[0] + size[0], p[1] + size[1], p[2]];\r\n      cs[3] = [p[0], p[1] + size[0], p[2]];\r\n      cs[4] = [p[0], p[1], p[2] + size[2]];\r\n      cs[5] = [p[0] + size[0], p[1], p[2] + size[2]];\r\n      cs[6] = [p[0] + size[0], p[1] + size[1], p[2] + size[2]];\r\n      cs[7] = [p[0], p[1] + size[0], p[2] + size[2]];\r\n    } else {\r\n      throw \"Minmax.minmax_rect has no implementation for \" + totaxis + \"-dimensional data\";\r\n    }\r\n    for (var i = 0; i < cs.length; i++) {\r\n      this.minmax(cs[i]);\r\n    }\r\n  }\r\n\r\n  minmax(p) {\r\n    var totaxis = this.totaxis;\r\n\r\n    if (totaxis == 1) {\r\n      this._min = this.min = Math.min(this._min, p);\r\n      this._max = this.max = Math.max(this._max, p);\r\n    } else if (totaxis == 2) {\r\n      this._min[0] = this.min[0] = Math.min(this._min[0], p[0]);\r\n      this._min[1] = this.min[1] = Math.min(this._min[1], p[1]);\r\n      this._max[0] = this.max[0] = Math.max(this._max[0], p[0]);\r\n      this._max[1] = this.max[1] = Math.max(this._max[1], p[1]);\r\n    } else if (totaxis == 3) {\r\n      this._min[0] = this.min[0] = Math.min(this._min[0], p[0]);\r\n      this._min[1] = this.min[1] = Math.min(this._min[1], p[1]);\r\n      this._min[2] = this.min[2] = Math.min(this._min[2], p[2]);\r\n      this._max[0] = this.max[0] = Math.max(this._max[0], p[0]);\r\n      this._max[1] = this.max[1] = Math.max(this._max[1], p[1]);\r\n      this._max[2] = this.max[2] = Math.max(this._max[2], p[2]);\r\n    } else {\r\n      for (var i = 0; i < totaxis; i++) {\r\n        this._min[i] = this.min[i] = Math.min(this._min[i], p[i]);\r\n        this._max[i] = this.max[i] = Math.max(this._max[i], p[i]);\r\n      }\r\n    }\r\n  }\r\n};\r\nMinMax.STRUCT = \"\\n  math.MinMax {\\n    min     : vec3;\\n    max     : vec3;\\n    _min    : vec3;\\n    _max    : vec3;\\n    totaxis : int;\\n  }\\n\";\r\n\r\nexport function winding_axis(a, b, c, up_axis) {\r\n  let xaxis = (up_axis + 1)%3;\r\n  let yaxis = (up_axis + 2)%3;\r\n\r\n  let x1 = a[xaxis], y1 = a[yaxis];\r\n  let x2 = b[xaxis], y2 = b[yaxis];\r\n  let x3 = c[xaxis], y3 = c[yaxis];\r\n\r\n  let dx1 = x1 - x2, dy1 = y1 - y2;\r\n  let dx2 = x3 - x2, dy2 = y3 - y2;\r\n\r\n  let f = dx1*dy2 - dy1*dx2;\r\n  return f >= 0.0;\r\n}\r\n\r\nexport function winding(a, b, c, zero_z, tol = 0.0) {\r\n  let t1 = _cross_vec1;\r\n  let t2 = _cross_vec2;\r\n\r\n  for (let i = 0; i < a.length; i++) {\r\n    t1[i] = b[i] - a[i];\r\n    t2[i] = c[i] - a[i];\r\n  }\r\n\r\n  return t1[0]*t2[1] - t1[1]*t2[0] > tol;\r\n  /*\r\n  t1.load(a).sub(b);\r\n  t2.load(c).sub(b);\r\n  return t[0]*\r\n  \r\n  for (var i=0; i<a.length; i++) {\r\n      _cross_vec1[i] = b[i]-a[i];\r\n      _cross_vec2[i] = c[i]-a[i];\r\n  }\r\n  if (a.length==2 || zero_z) {\r\n      _cross_vec1[2] = 0.0;\r\n      _cross_vec2[2] = 0.0;\r\n  }\r\n  _cross_vec1.cross(_cross_vec2);\r\n  return _cross_vec1[2]>tol;\r\n*/\r\n}\r\n\r\nexport function inrect_2d(p, pos, size) {\r\n  if (p == undefined || pos == undefined || size == undefined) {\r\n    console.trace();\r\n    console.log(\"Bad paramters to inrect_2d()\");\r\n    console.log(\"p: \", p, \", pos: \", pos, \", size: \", size);\r\n    return false;\r\n  }\r\n  return p[0] >= pos[0] && p[0] <= pos[0] + size[0] && p[1] >= pos[1] && p[1] <= pos[1] + size[1];\r\n};\r\nvar $smin_aabb_isect_line_2d = new Vector2();\r\nvar $ssize_aabb_isect_line_2d = new Vector2();\r\nvar $sv1_aabb_isect_line_2d = new Vector2();\r\nvar $ps_aabb_isect_line_2d = [new Vector2(), new Vector2(), new Vector2()];\r\nvar $l1_aabb_isect_line_2d = [0, 0];\r\nvar $smax_aabb_isect_line_2d = new Vector2();\r\nvar $sv2_aabb_isect_line_2d = new Vector2();\r\nvar $l2_aabb_isect_line_2d = [0, 0];\r\n\r\nexport function aabb_isect_line_2d(v1, v2, min, max) {\r\n  for (var i = 0; i < 2; i++) {\r\n    $smin_aabb_isect_line_2d[i] = Math.min(min[i], v1[i]);\r\n    $smax_aabb_isect_line_2d[i] = Math.max(max[i], v2[i]);\r\n  }\r\n  $smax_aabb_isect_line_2d.sub($smin_aabb_isect_line_2d);\r\n  $ssize_aabb_isect_line_2d.load(max).sub(min);\r\n  if (!aabb_isect_2d($smin_aabb_isect_line_2d, $smax_aabb_isect_line_2d, min, $ssize_aabb_isect_line_2d))\r\n    return false;\r\n  for (var i = 0; i < 4; i++) {\r\n    if (inrect_2d(v1, min, $ssize_aabb_isect_line_2d))\r\n      return true;\r\n    if (inrect_2d(v2, min, $ssize_aabb_isect_line_2d))\r\n      return true;\r\n  }\r\n  $ps_aabb_isect_line_2d[0] = min;\r\n  $ps_aabb_isect_line_2d[1][0] = min[0];\r\n  $ps_aabb_isect_line_2d[1][1] = max[1];\r\n  $ps_aabb_isect_line_2d[2] = max;\r\n  $ps_aabb_isect_line_2d[3][0] = max[0];\r\n  $ps_aabb_isect_line_2d[3][1] = min[1];\r\n  $l1_aabb_isect_line_2d[0] = v1;\r\n  $l1_aabb_isect_line_2d[1] = v2;\r\n  for (var i = 0; i < 4; i++) {\r\n    var a = $ps_aabb_isect_line_2d[i], b = $ps_aabb_isect_line_2d[(i + 1)%4];\r\n    $l2_aabb_isect_line_2d[0] = a;\r\n    $l2_aabb_isect_line_2d[1] = b;\r\n    if (line_line_cross($l1_aabb_isect_line_2d, $l2_aabb_isect_line_2d))\r\n      return true;\r\n  }\r\n  return false;\r\n};\r\n\r\n\r\nexport function expand_rect2d(pos, size, margin) {\r\n  pos[0] -= Math.floor(margin[0]);\r\n  pos[1] -= Math.floor(margin[1]);\r\n  size[0] += Math.floor(margin[0]*2.0);\r\n  size[1] += Math.floor(margin[1]*2.0);\r\n};\r\n\r\nexport function expand_line(l, margin) {\r\n  var c = new Vector3();\r\n  c.add(l[0]);\r\n  c.add(l[1]);\r\n  c.mulScalar(0.5);\r\n  l[0].sub(c);\r\n  l[1].sub(c);\r\n  var l1 = l[0].vectorLength();\r\n  var l2 = l[1].vectorLength();\r\n  l[0].normalize();\r\n  l[1].normalize();\r\n  l[0].mulScalar(margin + l1);\r\n  l[1].mulScalar(margin + l2);\r\n  l[0].add(c);\r\n  l[1].add(c);\r\n  return l;\r\n};\r\n\r\n//stupidly ancient function, todo: rewrite\r\nexport function colinear(a, b, c, limit = 2.2e-16) {\r\n  for (var i = 0; i < 3; i++) {\r\n    _cross_vec1[i] = b[i] - a[i];\r\n    _cross_vec2[i] = c[i] - a[i];\r\n  }\r\n\r\n  if (a.vectorDistance(b) < feps*100 && a.vectorDistance(c) < feps*100) {\r\n    return true;\r\n  }\r\n  if (_cross_vec1.dot(_cross_vec1) < limit || _cross_vec2.dot(_cross_vec2) < limit)\r\n    return true;\r\n  _cross_vec1.cross(_cross_vec2);\r\n  return _cross_vec1.dot(_cross_vec1) < limit;\r\n};\r\n\r\nvar _llc_l1 = [new Vector3(), new Vector3()];\r\nvar _llc_l2 = [new Vector3(), new Vector3()];\r\nvar _llc_l3 = [new Vector3(), new Vector3()];\r\nvar _llc_l4 = [new Vector3(), new Vector3()];\r\n\r\nvar lli_v1 = new Vector3(), lli_v2 = new Vector3(), lli_v3 = new Vector3(), lli_v4 = new Vector3();\r\n\r\nvar _zero_cn = new Vector3();\r\nvar _tmps_cn = util.cachering.fromConstructor(Vector3, 64);\r\nvar _rets_cn = util.cachering.fromConstructor(Vector3, 64);\r\n\r\n//vec1, vec2 should both be normalized\r\nexport function corner_normal(vec1, vec2, width) {\r\n  var ret = _rets_cn.next().zero();\r\n\r\n  var vec = _tmps_cn.next().zero();\r\n  vec.load(vec1).add(vec2).normalize();\r\n\r\n  /*\r\n  ret.load(vec).mulScalar(width);\r\n  return ret;\r\n  */\r\n\r\n  //handle colinear case\r\n  if (Math.abs(vec1.normalizedDot(vec2)) > 0.9999) {\r\n    if (vec1.dot(vec2) > 0.0001) {\r\n      ret.load(vec1).add(vec2).normalize();\r\n    } else {\r\n      ret.load(vec1).normalize();\r\n    }\r\n\r\n    ret.mulScalar(width);\r\n\r\n    return ret;\r\n  } else { //XXX\r\n    //ret.load(vec).mulScalar(width);\r\n    //return ret;\r\n  }\r\n\r\n  vec1 = _tmps_cn.next().load(vec1).mulScalar(width);\r\n  vec2 = _tmps_cn.next().load(vec2).mulScalar(width);\r\n\r\n  var p1 = _tmps_cn.next().load(vec1);\r\n  var p2 = _tmps_cn.next().load(vec2);\r\n\r\n  vec1.addFac(vec1, 0.01);\r\n  vec2.addFac(vec2, 0.01);\r\n\r\n  var sc = 1.0;\r\n\r\n  p1[0] += vec1[1]*sc;\r\n  p1[1] += -vec1[0]*sc;\r\n\r\n  p2[0] += -vec2[1]*sc;\r\n  p2[1] += vec2[0]*sc;\r\n\r\n  var p = line_line_isect(vec1, p1, vec2, p2, false);\r\n\r\n  if (p == undefined || p === COLINEAR_ISECT || p.dot(p) < 0.000001) {\r\n    ret.load(vec1).add(vec2).normalize().mulScalar(width);\r\n  } else {\r\n    ret.load(p);\r\n\r\n    if (vec.dot(vec) > 0 && vec.dot(ret) < 0) {\r\n      ret.load(vec).mulScalar(width);\r\n    }\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n//test_segment is optional, true\r\nexport function line_line_isect(v1, v2, v3, v4, test_segment) {\r\n  test_segment = test_segment === undefined ? true : test_segment;\r\n\r\n  if (!line_line_cross(v1, v2, v3, v4)) {\r\n    return undefined;\r\n  }\r\n\r\n  /*\r\n  on factor;\r\n  off period;\r\n  \r\n  xa := xa1 + (xa2 - xa1)*t1;\r\n  xb := xb1 + (xb2 - xb1)*t2;\r\n  ya := ya1 + (ya2 - ya1)*t1;\r\n  yb := yb1 + (yb2 - yb1)*t2;\r\n  \r\n  f1 := xa - xb;\r\n  f2 := ya - yb;\r\n  \r\n  f := solve({f1, f2}, {t1, t2});\r\n  ft1 := part(f, 1, 1, 2);\r\n  ft2 := part(f, 1, 2, 2);\r\n  \r\n  */\r\n\r\n  var xa1 = v1[0], xa2 = v2[0], ya1 = v1[1], ya2 = v2[1];\r\n  var xb1 = v3[0], xb2 = v4[0], yb1 = v3[1], yb2 = v4[1];\r\n\r\n  var div = ((xa1 - xa2)*(yb1 - yb2) - (xb1 - xb2)*(ya1 - ya2));\r\n  if (div < 0.00000001) { //parallel but intersecting lines.\r\n    return COLINEAR_ISECT;\r\n  } else { //intersection exists\r\n    var t1 = (-((ya1 - yb2)*xb1 - (yb1 - yb2)*xa1 - (ya1 - yb1)*xb2))/div;\r\n\r\n    return lli_v1.load(v1).interp(v2, t1);\r\n  }\r\n}\r\n\r\nexport function line_line_cross(v1, v2, v3, v4) {\r\n  var l1 = _llc_l3, l2 = _llc_l4;\r\n  //l1[0].load(v1), l1[1].load(v2), l2[0].load(v3), l2[1].load(v4);\r\n\r\n  {\r\n    var a = l1[0], b = l1[1], c = l2[0], d = l2[1];\r\n\r\n    a[0] = v1[0];\r\n    a[1] = v1[1];\r\n    a[2] = v1[2];\r\n\r\n    b[0] = v2[0];\r\n    b[1] = v2[1];\r\n    b[2] = v2[2];\r\n\r\n    c[0] = v3[0];\r\n    c[1] = v3[1];\r\n    c[2] = v3[2];\r\n\r\n    d[0] = v4[0];\r\n    d[1] = v4[1];\r\n    d[2] = v4[2];\r\n  }\r\n\r\n  /*\r\n  var limit=feps*1000;\r\n  if (Math.abs(l1[0].vectorDistance(l2[0])+l1[1].vectorDistance(l2[0])-l1[0].vectorDistance(l1[1]))<limit) {\r\n      return true;\r\n  }\r\n  if (Math.abs(l1[0].vectorDistance(l2[1])+l1[1].vectorDistance(l2[1])-l1[0].vectorDistance(l1[1]))<limit) {\r\n      return true;\r\n  }\r\n  if (Math.abs(l2[0].vectorDistance(l1[0])+l2[1].vectorDistance(l1[0])-l2[0].vectorDistance(l2[1]))<limit) {\r\n      return true;\r\n  }\r\n  if (Math.abs(l2[0].vectorDistance(l1[1])+l2[1].vectorDistance(l1[1])-l2[0].vectorDistance(l2[1]))<limit) {\r\n      return true;\r\n  }\r\n  //*/\r\n\r\n  var a = l1[0];\r\n  var b = l1[1];\r\n  var c = l2[0];\r\n  var d = l2[1];\r\n  var w1 = winding(a, b, c);\r\n  var w2 = winding(c, a, d);\r\n  var w3 = winding(a, b, d);\r\n  var w4 = winding(c, b, d);\r\n  return (w1 == w2) && (w3 == w4) && (w1 != w3);\r\n};\r\n\r\nvar _asi_v1 = new Vector3();\r\nvar _asi_v2 = new Vector3();\r\nvar _asi_v3 = new Vector3();\r\nvar _asi_v4 = new Vector3();\r\nvar _asi_v5 = new Vector3();\r\nvar _asi_v6 = new Vector3();\r\n\r\nexport function point_in_aabb_2d(p, min, max) {\r\n  return p[0] >= min[0] && p[0] <= max[0] && p[1] >= min[1] && p[1] <= max[1];\r\n}\r\n\r\nvar _asi2d_v1 = new Vector2();\r\nvar _asi2d_v2 = new Vector2();\r\nvar _asi2d_v3 = new Vector2();\r\nvar _asi2d_v4 = new Vector2();\r\nvar _asi2d_v5 = new Vector2();\r\nvar _asi2d_v6 = new Vector2();\r\n\r\nexport function aabb_sphere_isect_2d(p, r, min, max) {\r\n  var v1 = _asi2d_v1, v2 = _asi2d_v2, v3 = _asi2d_v3, mvec = _asi2d_v4;\r\n  var v4 = _asi2d_v5;\r\n\r\n  p = _asi2d_v6.load(p);\r\n  v1.load(p);\r\n  v2.load(p);\r\n\r\n  min = _asi_v5.load(min);\r\n  max = _asi_v6.load(max);\r\n\r\n  mvec.load(max).sub(min).normalize().mulScalar(r + 0.0001);\r\n\r\n  v1.sub(mvec);\r\n  v2.add(mvec);\r\n  v3.load(p);\r\n\r\n  var ret = point_in_aabb_2d(v1, min, max) || point_in_aabb_2d(v2, min, max)\r\n    || point_in_aabb_2d(v3, min, max);\r\n\r\n  if (ret)\r\n    return ret;\r\n\r\n  /*\r\n  v1.load(min).add(max).mulScalar(0.5);\r\n  ret = ret || v1.vectorDistance(p) < r;\r\n  \r\n  v1.load(min);\r\n  ret = ret || v1.vectorDistance(p) < r;\r\n  \r\n  v1.load(max);\r\n  ret = ret || v1.vectorDistance(p) < r;\r\n  \r\n  v1[0] = min[0], v1[1] = max[1];\r\n  ret = ret || v1.vectorDistance(p) < r;\r\n  \r\n  v1[0] = max[0], v1[1] = min[1];\r\n  ret = ret || v1.vectorDistance(p) < r;\r\n  */\r\n  //*\r\n  v1.load(min);\r\n  v2[0] = min[0];\r\n  v2[1] = max[1];\r\n  ret = ret || dist_to_line_2d(p, v1, v2) < r;\r\n\r\n  v1.load(max);\r\n  v2[0] = max[0];\r\n  v2[1] = max[1];\r\n  ret = ret || dist_to_line_2d(p, v1, v2) < r;\r\n\r\n  v1.load(max);\r\n  v2[0] = max[0];\r\n  v2[1] = min[1];\r\n  ret = ret || dist_to_line_2d(p, v1, v2) < r;\r\n\r\n  v1.load(max);\r\n  v2[0] = min[0];\r\n  v2[1] = min[1];\r\n  ret = ret || dist_to_line_2d(p, v1, v2) < r;\r\n  //*/\r\n  return ret;\r\n};\r\n\r\nexport function point_in_aabb(p, min, max) {\r\n  return p[0] >= min[0] && p[0] <= max[0] && p[1] >= min[1] && p[1] <= max[1]\r\n    && p[2] >= min[2] && p[2] <= max[2];\r\n}\r\n\r\nlet asi_rect = new Array(8);\r\nfor (let i = 0; i < 8; i++) {\r\n  asi_rect[i] = new Vector3();\r\n}\r\n\r\nlet aabb_sphere_isect_vs = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport function aabb_sphere_isect(p, r, min, max) {\r\n  {\r\n    let p1 = aabb_sphere_isect_vs.next().load(p);\r\n    let min1 = aabb_sphere_isect_vs.next().load(min);\r\n    let max1 = aabb_sphere_isect_vs.next().load(max);\r\n    if (p.length === 2) {\r\n      p1[2] = 0.0;\r\n    }\r\n    if (min1.length === 2) {\r\n      min1[2] = 0.0;\r\n    }\r\n    if (max.length === 2) {\r\n      max1[2] = 0.0;\r\n    }\r\n\r\n    p = p1;\r\n    min = min1;\r\n    max = max1;\r\n  }\r\n\r\n  let cent = aabb_sphere_isect_vs.next().load(min).interp(max, 0.5);\r\n  p.sub(cent);\r\n  min.sub(cent);\r\n  max.sub(cent);\r\n\r\n  r *= r;\r\n\r\n  let isect = point_in_aabb(p, min, max);\r\n\r\n  if (isect) {\r\n    return true;\r\n  }\r\n\r\n  let rect = asi_rect;\r\n\r\n  rect[0].loadXYZ(min[0], min[1], min[2]);\r\n  rect[1].loadXYZ(min[0], max[1], min[2]);\r\n  rect[2].loadXYZ(max[0], max[1], min[2]);\r\n  rect[3].loadXYZ(max[0], min[1], min[2]);\r\n\r\n  rect[4].loadXYZ(min[0], min[1], max[2]);\r\n  rect[5].loadXYZ(min[0], max[1], max[2]);\r\n  rect[6].loadXYZ(max[0], max[1], max[2]);\r\n  rect[7].loadXYZ(max[0], min[1], max[2]);\r\n\r\n  for (let i = 0; i < 8; i++) {\r\n    if (p.vectorDistanceSqr(rect[i]) < r) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  let p2 = aabb_sphere_isect_vs.next().load(p);\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    p2.load(p);\r\n\r\n    let i2 = (i + 1)%3;\r\n    let i3 = (i + 2)%3;\r\n\r\n    p2[i] = p2[i] < 0.0 ? min[i] : max[i];\r\n\r\n    p2[i2] = Math.min(Math.max(p2[i2], min[i2]), max[i2]);\r\n    p2[i3] = Math.min(Math.max(p2[i3], min[i3]), max[i3]);\r\n\r\n    let isect = p2.vectorDistanceSqr(p) <= r;\r\n\r\n    if (isect) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n};\r\n\r\nexport function aabb_sphere_dist(p, min, max) {\r\n  {\r\n    let p1 = aabb_sphere_isect_vs.next().load(p);\r\n    let min1 = aabb_sphere_isect_vs.next().load(min);\r\n    let max1 = aabb_sphere_isect_vs.next().load(max);\r\n    if (p.length === 2) {\r\n      p1[2] = 0.0;\r\n    }\r\n    if (min1.length === 2) {\r\n      min1[2] = 0.0;\r\n    }\r\n    if (max.length === 2) {\r\n      max1[2] = 0.0;\r\n    }\r\n\r\n    p = p1;\r\n    min = min1;\r\n    max = max1;\r\n  }\r\n\r\n  let cent = aabb_sphere_isect_vs.next().load(min).interp(max, 0.5);\r\n  p.sub(cent);\r\n  min.sub(cent);\r\n  max.sub(cent);\r\n\r\n  let isect = point_in_aabb(p, min, max);\r\n\r\n  if (isect) {\r\n    return 0.0;\r\n  }\r\n\r\n  let rect = asi_rect;\r\n\r\n  rect[0].loadXYZ(min[0], min[1], min[2]);\r\n  rect[1].loadXYZ(min[0], max[1], min[2]);\r\n  rect[2].loadXYZ(max[0], max[1], min[2]);\r\n  rect[3].loadXYZ(max[0], min[1], min[2]);\r\n\r\n  rect[4].loadXYZ(min[0], min[1], max[2]);\r\n  rect[5].loadXYZ(min[0], max[1], max[2]);\r\n  rect[6].loadXYZ(max[0], max[1], max[2]);\r\n  rect[7].loadXYZ(max[0], min[1], max[2]);\r\n\r\n  let mindis;\r\n\r\n  for (let i = 0; i < 8; i++) {\r\n    let dis = p.vectorDistanceSqr(rect[i]);\r\n\r\n    if (mindis === undefined || dis < mindis) {\r\n      mindis = dis;\r\n    }\r\n  }\r\n\r\n  let p2 = aabb_sphere_isect_vs.next().load(p);\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    p2.load(p);\r\n\r\n    let i2 = (i + 1)%3;\r\n    let i3 = (i + 2)%3;\r\n\r\n    p2[i] = p2[i] < 0.0 ? min[i] : max[i];\r\n\r\n    p2[i2] = Math.min(Math.max(p2[i2], min[i2]), max[i2]);\r\n    p2[i3] = Math.min(Math.max(p2[i3], min[i3]), max[i3]);\r\n\r\n    let dis = p2.vectorDistanceSqr(p);\r\n    if (mindis === undefined || dis < mindis) {\r\n      mindis = dis;\r\n    }\r\n  }\r\n\r\n  return mindis === undefined ? 1e17 : mindis;\r\n};\r\n\r\nexport function point_in_tri(p, v1, v2, v3) {\r\n  var w1 = winding(p, v1, v2);\r\n  var w2 = winding(p, v2, v3);\r\n  var w3 = winding(p, v3, v1);\r\n  return w1 == w2 && w2 == w3;\r\n};\r\n\r\nexport function convex_quad(v1, v2, v3, v4) {\r\n  return line_line_cross([v1, v3], [v2, v4]);\r\n};\r\n\r\nvar $e1_normal_tri = new Vector3();\r\nvar $e3_normal_tri = new Vector3();\r\nvar $e2_normal_tri = new Vector3();\r\n\r\nexport function isNum(f) {\r\n  let ok = typeof f === \"number\";\r\n\r\n  ok = ok && !isNaN(f) && isFinite(f);\r\n\r\n  return ok;\r\n}\r\n\r\nconst _normal_tri_rets = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport function normal_tri(v1, v2, v3) {\r\n  let x1 = v2[0] - v1[0];\r\n  let y1 = v2[1] - v1[1];\r\n  let z1 = v2[2] - v1[2];\r\n  let x2 = v3[0] - v1[0];\r\n  let y2 = v3[1] - v1[1];\r\n  let z2 = v3[2] - v1[2];\r\n\r\n  if (!isNum(x1 + y1 + z1 + z2 + y2 + z2)) {\r\n    throw new Error(\"NaN in normal_tri\");\r\n  }\r\n\r\n  let x3, y3, z3;\r\n\r\n  x1 = v2[0] - v1[0];\r\n  y1 = v2[1] - v1[1];\r\n  z1 = v2[2] - v1[2];\r\n  x2 = v3[0] - v1[0];\r\n  y2 = v3[1] - v1[1];\r\n  z2 = v3[2] - v1[2];\r\n  x3 = y1*z2 - z1*y2;\r\n  y3 = z1*x2 - x1*z2;\r\n  z3 = x1*y2 - y1*x2;\r\n\r\n  let len = Math.sqrt((x3*x3 + y3*y3 + z3*z3));\r\n\r\n  if (len > 1e-05)\r\n    len = 1.0/len;\r\n\r\n  x3 *= len;\r\n  y3 *= len;\r\n  z3 *= len;\r\n\r\n  let n = _normal_tri_rets.next();\r\n\r\n  if (!isNum(x3 + y3 + z3)) {\r\n    throw new Error(\"NaN!\");\r\n  }\r\n\r\n  n[0] = x3;\r\n  n[1] = y3;\r\n  n[2] = z3;\r\n\r\n  return n;\r\n};\r\n\r\nvar $n2_normal_quad = new Vector3();\r\n\r\nlet _q1 = new Vector3(), _q2 = new Vector3(), _q3 = new Vector3();\r\n\r\nexport function normal_quad(v1, v2, v3, v4) {\r\n  _q1.load(normal_tri(v1, v2, v3));\r\n  _q2.load(normal_tri(v2, v3, v4));\r\n\r\n  _q1.add(_q2).normalize();\r\n  return _q1;\r\n}\r\n\r\nexport function normal_quad_old(v1, v2, v3, v4) {\r\n  var n = normal_tri(v1, v2, v3);\r\n  $n2_normal_quad[0] = n[0];\r\n  $n2_normal_quad[1] = n[1];\r\n  $n2_normal_quad[2] = n[2];\r\n  n = normal_tri(v1, v3, v4);\r\n  $n2_normal_quad[0] = $n2_normal_quad[0] + n[0];\r\n  $n2_normal_quad[1] = $n2_normal_quad[1] + n[1];\r\n  $n2_normal_quad[2] = $n2_normal_quad[2] + n[2];\r\n  var _len = Math.sqrt(($n2_normal_quad[0]*$n2_normal_quad[0] + $n2_normal_quad[1]*$n2_normal_quad[1] + $n2_normal_quad[2]*$n2_normal_quad[2]));\r\n  if (_len > 1e-05)\r\n    _len = 1.0/_len;\r\n  $n2_normal_quad[0] *= _len;\r\n  $n2_normal_quad[1] *= _len;\r\n  $n2_normal_quad[2] *= _len;\r\n  return $n2_normal_quad;\r\n};\r\n\r\nvar _li_vi = new Vector3();\r\n\r\n//calc_t is optional, false\r\nexport function line_isect(v1, v2, v3, v4, calc_t) {\r\n  if (calc_t == undefined) {\r\n    calc_t = false;\r\n  }\r\n  var div = (v2[0] - v1[0])*(v4[1] - v3[1]) - (v2[1] - v1[1])*(v4[0] - v3[0]);\r\n  if (div == 0.0)\r\n    return [new Vector3(), COLINEAR, 0.0];\r\n  var vi = _li_vi;\r\n  vi[0] = 0;\r\n  vi[1] = 0;\r\n  vi[2] = 0;\r\n  vi[0] = ((v3[0] - v4[0])*(v1[0]*v2[1] - v1[1]*v2[0]) - (v1[0] - v2[0])*(v3[0]*v4[1] - v3[1]*v4[0]))/div;\r\n  vi[1] = ((v3[1] - v4[1])*(v1[0]*v2[1] - v1[1]*v2[0]) - (v1[1] - v2[1])*(v3[0]*v4[1] - v3[1]*v4[0]))/div;\r\n  if (calc_t || v1.length == 3) {\r\n    var n1 = new Vector2(v2).sub(v1);\r\n    var n2 = new Vector2(vi).sub(v1);\r\n    var t = n2.vectorLength()/n1.vectorLength();\r\n    n1.normalize();\r\n    n2.normalize();\r\n    if (n1.dot(n2) < 0.0) {\r\n      t = -t;\r\n    }\r\n    if (v1.length == 3) {\r\n      vi[2] = v1[2] + (v2[2] - v1[2])*t;\r\n    }\r\n    return [vi, LINECROSS, t];\r\n  }\r\n  return [vi, LINECROSS];\r\n};\r\n\r\nvar dt2l_v1 = new Vector2();\r\nvar dt2l_v2 = new Vector2();\r\nvar dt2l_v3 = new Vector2();\r\nvar dt2l_v4 = new Vector2();\r\nvar dt2l_v5 = new Vector2();\r\n\r\nexport function dist_to_line_2d(p, v1, v2, clip, closest_co_out = undefined, t_out = undefined) {\r\n  if (clip == undefined) {\r\n    clip = true;\r\n  }\r\n\r\n  v1 = dt2l_v4.load(v1);\r\n  v2 = dt2l_v5.load(v2);\r\n\r\n  var n = dt2l_v1;\r\n  var vec = dt2l_v3;\r\n\r\n  n.load(v2).sub(v1).normalize();\r\n  vec.load(p).sub(v1);\r\n\r\n  var t = vec.dot(n);\r\n  if (clip) {\r\n    t = Math.min(Math.max(t, 0.0), v1.vectorDistance(v2));\r\n  }\r\n\r\n  n.mulScalar(t).add(v1);\r\n\r\n  if (closest_co_out) {\r\n    closest_co_out[0] = n[0];\r\n    closest_co_out[1] = n[1];\r\n  }\r\n\r\n  if (t_out !== undefined) {\r\n    t_out = t;\r\n  }\r\n\r\n  return n.vectorDistance(p);\r\n}\r\n\r\nvar dt3l_v1 = new Vector3();\r\nvar dt3l_v2 = new Vector3();\r\nvar dt3l_v3 = new Vector3();\r\nvar dt3l_v4 = new Vector3();\r\nvar dt3l_v5 = new Vector3();\r\n\r\nexport function dist_to_line_sqr(p, v1, v2, clip = true) {\r\n  let px = p[0] - v1[0];\r\n  let py = p[1] - v1[1];\r\n  let pz = p.length < 3 ? 0.0 : p[2] - v1[2];\r\n\r\n  pz = pz === undefined ? 0.0 : pz;\r\n\r\n  let v2x = v2[0] - v1[0];\r\n  let v2y = v2[1] - v1[1];\r\n  let v2z = v2.length < 3 ? 0.0 : v2[2] - v1[2];\r\n\r\n  let len = v2x*v2x + v2y*v2y + v2z*v2z;\r\n\r\n  if (len === 0.0) {\r\n    return Math.sqrt(px*px + py*py + pz*pz);\r\n  }\r\n\r\n  let len2 = 1.0/len;\r\n  v2x *= len2;\r\n  v2y *= len2;\r\n  v2z *= len2;\r\n\r\n  let t = px*v2x + py*v2y + pz*v2z;\r\n  if (clip) {\r\n    t = Math.min(Math.max(t, 0.0), len);\r\n  }\r\n\r\n  v2x *= t;\r\n  v2y *= t;\r\n  v2z *= t;\r\n\r\n  return (v2x - px)*(v2x - px) + (v2y - py)*(v2y - py) + (v2z - pz)*(v2z - pz);\r\n}\r\n\r\nexport function dist_to_line(p, v1, v2, clip = true) {\r\n  return Math.sqrt(dist_to_line_sqr(p, v1, v2, clip));\r\n}\r\n\r\n//p cam be 2d, 3d, or 4d point, v1/v2 however must be full homogenous coordinates\r\nvar _cplw_vs4 = util.cachering.fromConstructor(Vector4, 64);\r\nvar _cplw_vs3 = util.cachering.fromConstructor(Vector3, 64);\r\nvar _cplw_vs2 = util.cachering.fromConstructor(Vector2, 64);\r\n\r\nfunction wclip(x1, x2, w1, w2, near) {\r\n  var r1 = near*w1 - x1;\r\n  var r2 = (w1 - w2)*near - (x1 - x2);\r\n\r\n  if (r2 == 0.0) return 0.0;\r\n\r\n  return r1/r2;\r\n}\r\n\r\nfunction clip(a, b, znear) {\r\n  if (a - b == 0.0) return 0.0;\r\n\r\n  return (a - znear)/(a - b);\r\n}\r\n\r\n/*clips v1 and v2 to lie within homogenous projection range\r\n  v1 and v2 are assumed to be projected, pre-division Vector4's\r\n  returns a positive number (how much the line was scaled) if either _v1 or _v2 are\r\n  in front of the near clipping plane otherwise, returns 0\r\n */\r\nexport function clip_line_w(_v1, _v2, znear, zfar) {\r\n  var v1 = _cplw_vs4.next().load(_v1);\r\n  var v2 = _cplw_vs4.next().load(_v2);\r\n\r\n  //are we fully behind the view plane?\r\n  if ((v1[2] < 1.0 && v2[2] < 1.0))\r\n    return false;\r\n\r\n  function doclip1(v1, v2, axis) {\r\n    if (v1[axis]/v1[3] < -1) {\r\n      var t = wclip(v1[axis], v2[axis], v1[3], v2[3], -1);\r\n      v1.interp(v2, t);\r\n    } else if (v1[axis]/v1[3] > 1) {\r\n      var t = wclip(v1[axis], v2[axis], v1[3], v2[3], 1);\r\n      v1.interp(v2, t);\r\n    }\r\n  }\r\n\r\n  function doclip(v1, v2, axis) {\r\n    doclip1(v1, v2, axis);\r\n    doclip1(v2, v1, axis);\r\n  }\r\n\r\n  function dozclip(v1, v2) {\r\n    if (v1[2] < 1) {\r\n      var t = clip(v1[2], v2[2], 1);\r\n      v1.interp(v2, t);\r\n    } else if (v2[2] < 1) {\r\n      var t = clip(v2[2], v1[2], 1);\r\n      v2.interp(v1, t);\r\n    }\r\n  }\r\n\r\n  dozclip(v1, v2, 1);\r\n  doclip(v1, v2, 0);\r\n  doclip(v1, v2, 1);\r\n\r\n  for (var i = 0; i < 4; i++) {\r\n    _v1[i] = v1[i];\r\n    _v2[i] = v2[i];\r\n  }\r\n\r\n  return !(v1[0]/v1[3] == v2[0]/v2[3] || v1[1]/v2[3] == v2[1]/v2[3]);\r\n};\r\n\r\n//clip is optional, true.  clip point to lie within line segment v1->v2\r\nvar _closest_point_on_line_cache = util.cachering.fromConstructor(Vector3, 64);\r\nvar _closest_point_rets = new util.cachering(function () {\r\n  return [0, 0];\r\n}, 64);\r\n\r\nvar _closest_tmps = [new Vector3(), new Vector3(), new Vector3()];\r\n\r\nexport function closest_point_on_line(p, v1, v2, clip = true) {\r\n  var l1 = _closest_tmps[0], l2 = _closest_tmps[1];\r\n  var len;\r\n\r\n\r\n  l1.load(v2).sub(v1);\r\n\r\n  if (clip) {\r\n    len = l1.vectorLength();\r\n  }\r\n\r\n  l1.normalize();\r\n  l2.load(p).sub(v1);\r\n\r\n  var t = l2.dot(l1);\r\n  if (clip) {\r\n    //t = t*(t<0.0) + t*(t>1.0) + (t>1.0);\r\n    t = t < 0.0 ? 0.0 : t;\r\n    t = t > len ? len : t;\r\n  }\r\n\r\n  var p = _closest_point_on_line_cache.next();\r\n  p.load(l1).mulScalar(t).add(v1);\r\n  var ret = _closest_point_rets.next();\r\n\r\n  ret[0] = p;\r\n  ret[1] = t;\r\n\r\n  return ret;\r\n};\r\n\r\n/*given input line (a,d) and tangent t,\r\n  returns a circle that goes through both\r\n  a and d, whose normalized tangent at a is the same\r\n  as normalized t.\r\n  \r\n  note that t need not be normalized, this function\r\n  does that itself*/\r\nvar _circ_from_line_tan_vs = util.cachering.fromConstructor(Vector3, 32);\r\nvar _circ_from_line_tan_ret = new util.cachering(function () {\r\n  return [new Vector3(), 0];\r\n}, 64);\r\n\r\nexport function circ_from_line_tan(a, b, t) {\r\n  let p1 = _circ_from_line_tan_vs.next();\r\n  let t2 = _circ_from_line_tan_vs.next();\r\n  let n1 = _circ_from_line_tan_vs.next();\r\n\r\n  p1.load(a).sub(b);\r\n  t2.load(t).normalize();\r\n  n1.load(p1).normalize().cross(t2).cross(t2).normalize();\r\n\r\n  let ax = p1[0], ay = p1[1], az = p1[2], nx = n1[0], ny = n1[1], nz = n1[2];\r\n  let r = -(ax*ax + ay*ay + az*az);\r\n  let div = (2*(ax*nx + ay*ny + az*nz));\r\n\r\n  if (Math.abs(div) > 0.000001) {\r\n    r /= div;\r\n  } else {\r\n    r = 1000000.0;\r\n  }\r\n\r\n  let ret = _circ_from_line_tan_ret.next();\r\n  ret[0].load(n1).mulScalar(r).add(a)\r\n  ret[1] = r;\r\n\r\n  return ret;\r\n}\r\n\r\n/*given input line (a,d) and tangent t,\r\n  returns a circle that goes through both\r\n  a and d, whose normalized tangent at a is the same\r\n  as normalized t.\r\n\r\n  note that t need not be normalized, this function\r\n  does that itself*/\r\nvar _circ_from_line_tan2d_vs = util.cachering.fromConstructor(Vector3, 32);\r\nvar _circ_from_line_tan2d_ret = new util.cachering(function () {\r\n  return [new Vector2(), 0];\r\n}, 64);\r\n\r\nexport function circ_from_line_tan_2d(a, b, t) {\r\n  a = _circ_from_line_tan2d_vs.next().load(a);\r\n  b = _circ_from_line_tan2d_vs.next().load(b);\r\n  t = _circ_from_line_tan2d_vs.next().load(t);\r\n\r\n  a[2] = b[2] = t[2] = 0.0;\r\n\r\n  let p1 = _circ_from_line_tan2d_vs.next();\r\n  let t2 = _circ_from_line_tan2d_vs.next();\r\n  let n1 = _circ_from_line_tan2d_vs.next();\r\n\r\n  p1.load(a).sub(b);\r\n  t2.load(t).normalize();\r\n  n1.load(p1).normalize().cross(t2).cross(t2).normalize();\r\n\r\n  if (1) {\r\n    let cx, cy, r;\r\n    let x1 = a[0], y1 = a[1];\r\n    let x2 = b[0], y2 = b[1];\r\n    let tanx1 = t[0], tany1 = t[1];\r\n\r\n    let div = (4.0*((x1 - x2)*tany1 - (y1 - y2)*tanx1)**2);\r\n    let div2 = (2.0*(x1 - x2)*tany1 - 2.0*(y1 - y2)*tanx1);\r\n\r\n    if (Math.abs(div) < 0.0001 || Math.abs(div2) < 0.0001) {\r\n      let ret = _circ_from_line_tan2d_ret.next();\r\n\r\n      ret[0].load(a).interp(b, 0.5);\r\n      let dx = a[1] - b[1];\r\n      let dy = b[0] - a[0];\r\n\r\n      r = 1000000.0;\r\n\r\n      ret[0][0] += dx*r;\r\n      ret[0][1] += dy*r;\r\n      ret[1] = r;\r\n\r\n      return ret;\r\n    }\r\n    cx = (((x1 + x2)*(x1 - x2) - (y1 - y2)**2)*tany1 - 2.0*(y1 - y2)*tanx1*x1\r\n    )/div2;\r\n\r\n    cy = (-((y1 + y2)*(y1 - y2) - x2**2 - (x1 - 2.0*x2)*x1)*tanx1 + 2.0*(x1 -\r\n      x2)*tany1*y1)/div2;\r\n\r\n    r = (((y1 - y2)**2 + x2**2 + (x1 - 2.0*x2)*x1)**2*(tanx1**2 + tany1**2)\r\n    )/div;\r\n\r\n    let midx = a[0]*0.5 + b[0]*0.5;\r\n    let midy = a[1]*0.5 + b[1]*0.5;\r\n\r\n    //mirror\r\n    cx = 2.0*midx - cx;\r\n    cy = 2.0*midy - cy;\r\n\r\n    let ret = _circ_from_line_tan2d_ret.next();\r\n    ret[0].loadXY(cx, cy);\r\n    ret[1] = Math.sqrt(r);\r\n\r\n    return ret;\r\n  } else {\r\n    let ax = p1[0], ay = p1[1], az = p1[2], nx = n1[0], ny = n1[1], nz = n1[2];\r\n    let r = -(ax*ax + ay*ay + az*az);\r\n    let div = (2*(ax*nx + ay*ny + az*nz));\r\n\r\n    if (Math.abs(div) > 0.000001) {\r\n      r /= div;\r\n    } else {\r\n      r = 1000000.0;\r\n    }\r\n\r\n    let ret = _circ_from_line_tan2d_ret.next();\r\n    ret[0].load(n1).mulScalar(r).add(a)\r\n    ret[1] = r;\r\n\r\n    return ret;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nvar _gtc_e1 = new Vector3();\r\nvar _gtc_e2 = new Vector3();\r\nvar _gtc_e3 = new Vector3();\r\nvar _gtc_p1 = new Vector3();\r\nvar _gtc_p2 = new Vector3();\r\nvar _gtc_v1 = new Vector3();\r\nvar _gtc_v2 = new Vector3();\r\nvar _gtc_p12 = new Vector3();\r\nvar _gtc_p22 = new Vector3();\r\nvar _get_tri_circ_ret = new util.cachering(function () {\r\n  return [0, 0]\r\n});\r\n\r\nexport function get_tri_circ(a, b, c) {\r\n  var v1 = _gtc_v1;\r\n  var v2 = _gtc_v2;\r\n  var e1 = _gtc_e1;\r\n  var e2 = _gtc_e2;\r\n  var e3 = _gtc_e3;\r\n  var p1 = _gtc_p1;\r\n  var p2 = _gtc_p2;\r\n\r\n  for (var i = 0; i < 3; i++) {\r\n    e1[i] = b[i] - a[i];\r\n    e2[i] = c[i] - b[i];\r\n    e3[i] = a[i] - c[i];\r\n  }\r\n\r\n  for (var i = 0; i < 3; i++) {\r\n    p1[i] = (a[i] + b[i])*0.5;\r\n    p2[i] = (c[i] + b[i])*0.5;\r\n  }\r\n\r\n  e1.normalize();\r\n\r\n  v1[0] = -e1[1];\r\n  v1[1] = e1[0];\r\n  v1[2] = e1[2];\r\n\r\n  v2[0] = -e2[1];\r\n  v2[1] = e2[0];\r\n  v2[2] = e2[2];\r\n\r\n  v1.normalize();\r\n  v2.normalize();\r\n\r\n  var cent;\r\n  var type;\r\n  for (var i = 0; i < 3; i++) {\r\n    _gtc_p12[i] = p1[i] + v1[i];\r\n    _gtc_p22[i] = p2[i] + v2[i];\r\n  }\r\n\r\n  var ret = line_isect(p1, _gtc_p12, p2, _gtc_p22);\r\n  cent = ret[0];\r\n  type = ret[1];\r\n\r\n  e1.load(a);\r\n  e2.load(b);\r\n  e3.load(c);\r\n\r\n  var r = e1.sub(cent).vectorLength();\r\n  if (r < feps)\r\n    r = e2.sub(cent).vectorLength();\r\n  if (r < feps)\r\n    r = e3.sub(cent).vectorLength();\r\n\r\n  var ret = _get_tri_circ_ret.next();\r\n  ret[0] = cent;\r\n  ret[1] = r;\r\n\r\n  return ret;\r\n};\r\n\r\nexport function gen_circle(m, origin, r, stfeps) {\r\n  var pi = Math.PI;\r\n  var f = -pi/2;\r\n  var df = (pi*2)/stfeps;\r\n  var verts = new Array();\r\n  for (var i = 0; i < stfeps; i++) {\r\n    var x = origin[0] + r*Math.sin(f);\r\n    var y = origin[1] + r*Math.cos(f);\r\n    var v = m.make_vert(new Vector3([x, y, origin[2]]));\r\n    verts.push(v);\r\n    f += df;\r\n  }\r\n  for (var i = 0; i < verts.length; i++) {\r\n    var v1 = verts[i];\r\n    var v2 = verts[(i + 1)%verts.length];\r\n    m.make_edge(v1, v2);\r\n  }\r\n  return verts;\r\n};\r\n\r\nvar cos = Math.cos;\r\nvar sin = Math.sin;\r\n\r\n//axis is optional, 0\r\nexport function rot2d(v1, A, axis) {\r\n  var x = v1[0];\r\n  var y = v1[1];\r\n\r\n  if (axis == 1) {\r\n    v1[0] = x*cos(A) + y*sin(A);\r\n    v1[2] = y*cos(A) - x*sin(A);\r\n  } else {\r\n    v1[0] = x*cos(A) - y*sin(A);\r\n    v1[1] = y*cos(A) + x*sin(A);\r\n  }\r\n}\r\n\r\nexport function makeCircleMesh(gl, radius, stfeps) {\r\n  var mesh = new Mesh();\r\n  var verts1 = gen_circle(mesh, new Vector3(), radius, stfeps);\r\n  var verts2 = gen_circle(mesh, new Vector3(), radius/1.75, stfeps);\r\n  mesh.make_face_complex([verts1, verts2]);\r\n  return mesh;\r\n};\r\n\r\nexport function minmax_verts(verts) {\r\n  var min = new Vector3([1000000000000.0, 1000000000000.0, 1000000000000.0]);\r\n  var max = new Vector3([-1000000000000.0, -1000000000000.0, -1000000000000.0]);\r\n  var __iter_v = __get_iter(verts);\r\n  var v;\r\n  while (1) {\r\n    var __ival_v = __iter_v.next();\r\n    if (__ival_v.done) {\r\n      break;\r\n    }\r\n    v = __ival_v.value;\r\n    for (var i = 0; i < 3; i++) {\r\n      min[i] = Math.min(min[i], v.co[i]);\r\n      max[i] = Math.max(max[i], v.co[i]);\r\n    }\r\n  }\r\n  return [min, max];\r\n};\r\n\r\nexport function unproject(vec, ipers, iview) {\r\n  var newvec = new Vector3(vec);\r\n  newvec.multVecMatrix(ipers);\r\n  newvec.multVecMatrix(iview);\r\n  return newvec;\r\n};\r\n\r\nexport function project(vec, pers, view) {\r\n  var newvec = new Vector3(vec);\r\n  newvec.multVecMatrix(pers);\r\n  newvec.multVecMatrix(view);\r\n  return newvec;\r\n};\r\n\r\nvar _sh_minv = new Vector3();\r\nvar _sh_maxv = new Vector3();\r\nvar _sh_start = [];\r\nvar _sh_end = [];\r\n\r\nvar static_cent_gbw = new Vector3();\r\n\r\nexport function get_boundary_winding(points) {\r\n  var cent = static_cent_gbw.zero();\r\n  if (points.length == 0)\r\n    return false;\r\n  for (var i = 0; i < points.length; i++) {\r\n    cent.add(points[i]);\r\n  }\r\n  cent.divideScalar(points.length);\r\n  var w = 0, totw = 0;\r\n  for (var i = 0; i < points.length; i++) {\r\n    var v1 = points[i];\r\n    var v2 = points[(i + 1)%points.length];\r\n    if (!colinear(v1, v2, cent)) {\r\n      w += winding(v1, v2, cent);\r\n      totw += 1;\r\n    }\r\n  }\r\n  if (totw > 0)\r\n    w /= totw;\r\n  return Math.round(w) == 1;\r\n};\r\n\r\nexport class PlaneOps {\r\n  constructor(normal) {\r\n    var no = normal;\r\n    this.axis = [0, 0, 0];\r\n    this.reset_axis(normal);\r\n  }\r\n\r\n  reset_axis(no) {\r\n    var ax, ay, az;\r\n    var nx = Math.abs(no[0]), ny = Math.abs(no[1]), nz = Math.abs(no[2]);\r\n    if (nz > nx && nz > ny) {\r\n      ax = 0;\r\n      ay = 1;\r\n      az = 2;\r\n    } else if (nx > ny && nx > nz) {\r\n      ax = 2;\r\n      ay = 1;\r\n      az = 0;\r\n    } else {\r\n      ax = 0;\r\n      ay = 2;\r\n      az = 1;\r\n    }\r\n    this.axis = [ax, ay, az];\r\n  }\r\n\r\n  convex_quad(v1, v2, v3, v4) {\r\n    var ax = this.axis;\r\n    v1 = new Vector3([v1[ax[0]], v1[ax[1]], v1[ax[2]]]);\r\n    v2 = new Vector3([v2[ax[0]], v2[ax[1]], v2[ax[2]]]);\r\n    v3 = new Vector3([v3[ax[0]], v3[ax[1]], v3[ax[2]]]);\r\n    v4 = new Vector3([v4[ax[0]], v4[ax[1]], v4[ax[2]]]);\r\n    return convex_quad(v1, v2, v3, v4);\r\n  }\r\n\r\n  line_isect(v1, v2, v3, v4) {\r\n    var ax = this.axis;\r\n    var orig1 = v1, orig2 = v2;\r\n    v1 = new Vector3([v1[ax[0]], v1[ax[1]], v1[ax[2]]]);\r\n    v2 = new Vector3([v2[ax[0]], v2[ax[1]], v2[ax[2]]]);\r\n    v3 = new Vector3([v3[ax[0]], v3[ax[1]], v3[ax[2]]]);\r\n    v4 = new Vector3([v4[ax[0]], v4[ax[1]], v4[ax[2]]]);\r\n    var ret = line_isect(v1, v2, v3, v4, true);\r\n    var vi = ret[0];\r\n    if (ret[1] == LINECROSS) {\r\n      ret[0].load(orig2).sub(orig1).mulScalar(ret[2]).add(orig1);\r\n    }\r\n    return ret;\r\n  }\r\n\r\n  line_line_cross(l1, l2) {\r\n    var ax = this.axis;\r\n    var v1 = l1[0], v2 = l1[1], v3 = l2[0], v4 = l2[1];\r\n    v1 = new Vector3([v1[ax[0]], v1[ax[1]], 0.0]);\r\n    v2 = new Vector3([v2[ax[0]], v2[ax[1]], 0.0]);\r\n    v3 = new Vector3([v3[ax[0]], v3[ax[1]], 0.0]);\r\n    v4 = new Vector3([v4[ax[0]], v4[ax[1]], 0.0]);\r\n    return line_line_cross([v1, v2], [v3, v4]);\r\n  }\r\n\r\n  winding(v1, v2, v3) {\r\n    var ax = this.axis;\r\n    if (v1 == undefined)\r\n      console.trace();\r\n    v1 = new Vector3([v1[ax[0]], v1[ax[1]], 0.0]);\r\n    v2 = new Vector3([v2[ax[0]], v2[ax[1]], 0.0]);\r\n    v3 = new Vector3([v3[ax[0]], v3[ax[1]], 0.0]);\r\n    return winding(v1, v2, v3);\r\n  }\r\n\r\n  colinear(v1, v2, v3) {\r\n    var ax = this.axis;\r\n    v1 = new Vector3([v1[ax[0]], v1[ax[1]], 0.0]);\r\n    v2 = new Vector3([v2[ax[0]], v2[ax[1]], 0.0]);\r\n    v3 = new Vector3([v3[ax[0]], v3[ax[1]], 0.0]);\r\n    return colinear(v1, v2, v3);\r\n  }\r\n\r\n  get_boundary_winding(points) {\r\n    var ax = this.axis;\r\n    var cent = new Vector3();\r\n    if (points.length == 0)\r\n      return false;\r\n    for (var i = 0; i < points.length; i++) {\r\n      cent.add(points[i]);\r\n    }\r\n    cent.divideScalar(points.length);\r\n    var w = 0, totw = 0;\r\n    for (var i = 0; i < points.length; i++) {\r\n      var v1 = points[i];\r\n      var v2 = points[(i + 1)%points.length];\r\n      if (!this.colinear(v1, v2, cent)) {\r\n        w += this.winding(v1, v2, cent);\r\n        totw += 1;\r\n      }\r\n    }\r\n    if (totw > 0)\r\n      w /= totw;\r\n    return Math.round(w) == 1;\r\n  }\r\n}\r\n\r\n/*\r\non factor;\r\n\r\npx := rox + rnx*t;\r\npy := roy + rny*t;\r\npz := roz + rnz*t;\r\n\r\nf1 := (px-pox)*pnx + (py-poy)*pny + (pz-poz)*pnz;\r\nff := solve(f1, t);\r\non fort;\r\npart(ff, 1, 2);\r\noff fort;\r\n\r\n* */\r\nvar _isrp_ret = new Vector3();\r\nlet isect_ray_plane_rets = util.cachering.fromConstructor(Vector3, 256);\r\n\r\nexport function isect_ray_plane(planeorigin, planenormal, rayorigin, raynormal) {\r\n  let po = planeorigin, pn = planenormal, ro = rayorigin, rn = raynormal;\r\n\r\n  let div = (pn[1]*rn[1] + pn[2]*rn[2] + pn[0]*rn[0]);\r\n\r\n  if (Math.abs(div) < 0.000001) {\r\n    return undefined;\r\n  }\r\n\r\n  let t = ((po[1] - ro[1])*pn[1] + (po[2] - ro[2])*pn[2] + (po[0] - ro[0])*pn[0])/div;\r\n  _isrp_ret.load(ro).addFac(rn, t);\r\n\r\n  return isect_ray_plane_rets.next().load(_isrp_ret);\r\n}\r\n\r\nexport function _old_isect_ray_plane(planeorigin, planenormal, rayorigin, raynormal) {\r\n  var p = planeorigin, n = planenormal;\r\n  var r = rayorigin, v = raynormal;\r\n\r\n  var d = p.vectorLength();\r\n  var t = -(r.dot(n) - p.dot(n))/v.dot(n);\r\n  _isrp_ret.load(v);\r\n  _isrp_ret.mulScalar(t);\r\n  _isrp_ret.add(r);\r\n  return _isrp_ret;\r\n};\r\n\r\nexport function mesh_find_tangent(mesh, viewvec, offvec, projmat, verts) {\r\n  if (verts == undefined)\r\n    verts = mesh.verts.selected;\r\n  var vset = new set();\r\n  var eset = new set();\r\n  var __iter_v = __get_iter(verts);\r\n  var v;\r\n  while (1) {\r\n    var __ival_v = __iter_v.next();\r\n    if (__ival_v.done) {\r\n      break;\r\n    }\r\n    v = __ival_v.value;\r\n    vset.add(v);\r\n  }\r\n  var __iter_v = __get_iter(vset);\r\n  var v;\r\n  while (1) {\r\n    var __ival_v = __iter_v.next();\r\n    if (__ival_v.done) {\r\n      break;\r\n    }\r\n    v = __ival_v.value;\r\n    var __iter_e = __get_iter(v.edges);\r\n    var e;\r\n    while (1) {\r\n      var __ival_e = __iter_e.next();\r\n      if (__ival_e.done) {\r\n        break;\r\n      }\r\n      e = __ival_e.value;\r\n      if (vset.has(e.other_vert(v))) {\r\n        eset.add(e);\r\n      }\r\n    }\r\n  }\r\n  if (eset.length == 0) {\r\n    return new Vector3(offvec);\r\n  }\r\n  var tanav = new Vector3();\r\n  var evec = new Vector3();\r\n  var tan = new Vector3();\r\n  var co2 = new Vector3();\r\n  var __iter_e = __get_iter(eset);\r\n  var e;\r\n  while (1) {\r\n    var __ival_e = __iter_e.next();\r\n    if (__ival_e.done) {\r\n      break;\r\n    }\r\n    e = __ival_e.value;\r\n    evec.load(e.v1.co).multVecMatrix(projmat);\r\n    co2.load(e.v2.co).multVecMatrix(projmat);\r\n    evec.sub(co2);\r\n    evec.normalize();\r\n    tan[0] = evec[1];\r\n    tan[1] = -evec[0];\r\n    tan[2] = 0.0;\r\n    if (tan.dot(offvec) < 0.0)\r\n      tan.mulScalar(-1.0);\r\n    tanav.add(tan);\r\n  }\r\n  tanav.normalize();\r\n  return tanav;\r\n};\r\n\r\nexport class Mat4Stack {\r\n  constructor() {\r\n    this.stack = [];\r\n    this.matrix = new Matrix4();\r\n    this.matrix.makeIdentity();\r\n    this.update_func = undefined;\r\n  }\r\n\r\n  set_internal_matrix(mat, update_func) {\r\n    this.update_func = update_func;\r\n    this.matrix = mat;\r\n  }\r\n\r\n  reset(mat) {\r\n    this.matrix.load(mat);\r\n    this.stack = [];\r\n    if (this.update_func != undefined)\r\n      this.update_func();\r\n  }\r\n\r\n  load(mat) {\r\n    this.matrix.load(mat);\r\n    if (this.update_func != undefined)\r\n      this.update_func();\r\n  }\r\n\r\n  multiply(mat) {\r\n    this.matrix.multiply(mat);\r\n    if (this.update_func != undefined)\r\n      this.update_func();\r\n  }\r\n\r\n  identity() {\r\n    this.matrix.loadIdentity();\r\n    if (this.update_func != undefined)\r\n      this.update_func();\r\n  }\r\n\r\n  push(mat2) {\r\n    this.stack.push(new Matrix4(this.matrix));\r\n    if (mat2 != undefined) {\r\n      this.matrix.load(mat2);\r\n      if (this.update_func != undefined)\r\n        this.update_func();\r\n    }\r\n  }\r\n\r\n  pop() {\r\n    var mat = this.stack.pop(this.stack.length - 1);\r\n    this.matrix.load(mat);\r\n    if (this.update_func != undefined)\r\n      this.update_func();\r\n    return mat;\r\n  }\r\n}\r\n\r\n\r\n/*\r\n\r\non factor;\r\noff period;\r\n\r\nload_package \"avector\";\r\n\r\n\r\na1 := avec(a1x, a1y, a1z);\r\nb1 := avec(b1x, b1y, b1z);\r\nc1 := avec(c1x, c1y, c1z);\r\nd1 := avec(d1x, d1y, d1z);\r\n\r\na1x := 0;\r\na1y := 0;\r\na1z := 0;\r\n\r\na2 := avec(a2x, a2y, a2z);\r\nb2 := avec(b2x, b2y, b2z);\r\nc2 := avec(c2x, c2y, c2z);\r\nd2 := avec(d2x, d2y, d2z);\r\n\r\np1 := a1 + (b1 - a1) * v;\r\np2 := d1 + (c1 - d1) * v;\r\np3 := p1 + (p2 - p1) * u;\r\n\r\np4 := a2 + (b2 - a2) * v;\r\np5 := d2 + (c2 - d2) * v;\r\np6 := p4 + (p5 - p4) * u;\r\n\r\np7 := p3 + (p6 - p3) * w;\r\n\r\nf1 := p7[0] - goalx;\r\nf2 := p7[1] - goaly;\r\nf3 := p7[2] - goalz;\r\n\r\ncomment: solve({f1, f2, f3}, {u, v, w});\r\n\r\non fort;\r\np7;\r\noff fort;\r\n\r\nsub(u=0, v=1, w=0, p7[0]);\r\n\r\n*/\r\n\r\nconst tril_rets = util.cachering.fromConstructor(Vector3, 128);\r\n\r\nfunction lreport() {\r\n  //console.log(...arguments);\r\n}\r\n\r\nexport function trilinear_v3(uvw, boxverts) {\r\n  let [u, v, w] = uvw;\r\n\r\n  const a1x = boxverts[0][0], a1y = boxverts[0][1], a1z = boxverts[0][2];\r\n\r\n  const b1x = boxverts[1][0] - a1x, b1y = boxverts[1][1] - a1y, b1z = boxverts[1][2] - a1z;\r\n  const c1x = boxverts[2][0] - a1x, c1y = boxverts[2][1] - a1y, c1z = boxverts[2][2] - a1z;\r\n  const d1x = boxverts[3][0] - a1x, d1y = boxverts[3][1] - a1y, d1z = boxverts[3][2] - a1z;\r\n\r\n  const a2x = boxverts[4][0] - a1x, a2y = boxverts[4][1] - a1y, a2z = boxverts[4][2] - a1z;\r\n  const b2x = boxverts[5][0] - a1x, b2y = boxverts[5][1] - a1y, b2z = boxverts[5][2] - a1z;\r\n  const c2x = boxverts[6][0] - a1x, c2y = boxverts[6][1] - a1y, c2z = boxverts[6][2] - a1z;\r\n  const d2x = boxverts[7][0] - a1x, d2y = boxverts[7][1] - a1y, d2z = boxverts[7][2] - a1z;\r\n\r\n  const x = (((a2x - b2x)*v - a2x + (c2x - d2x)*v + d2x)*u - ((a2x - b2x)*v - a2x) - (\r\n      ((c1x - d1x)*v + d1x - b1x*v)*u + b1x*v))*w + ((c1x - d1x)*v + d1x - b1x*v)*u +\r\n    b1x*v;\r\n  const y = (((a2y - b2y)*v - a2y + (c2y - d2y)*v + d2y)*u - ((a2y - b2y)*v - a2y) - (\r\n      ((c1y - d1y)*v + d1y - b1y*v)*u + b1y*v))*w + ((c1y - d1y)*v + d1y - b1y*v)*u +\r\n    b1y*v;\r\n  const z = (((a2z - b2z)*v - a2z + (c2z - d2z)*v + d2z)*u - ((a2z - b2z)*v - a2z) - (\r\n      ((c1z - d1z)*v + d1z - b1z*v)*u + b1z*v))*w + ((c1z - d1z)*v + d1z - b1z*v)*u +\r\n    b1z*v;\r\n\r\n  let p = tril_rets.next();\r\n\r\n  p[0] = x + a1x;\r\n  p[1] = y + a1y;\r\n  p[2] = z + a1z;\r\n\r\n  return p;\r\n}\r\n\r\nlet tril_co_rets = util.cachering.fromConstructor(Vector3, 128);\r\nlet tril_co_tmps = util.cachering.fromConstructor(Vector3, 16);\r\nlet tril_mat_1 = new Matrix4();\r\nlet tril_mat_2 = new Matrix4();\r\n\r\nlet wtable = [\r\n  [\r\n    [0.5, 0.5, 0], //u triplet\r\n    [0.5, 0.5, 0], //v triplet\r\n    [0.5, 0.5, 0]  //w triplet\r\n  ],\r\n  [\r\n    [0.5, 0.5, 0],\r\n    [0.0, 0.5, 0.5],\r\n    [0.5, 0.5, 0]\r\n  ],\r\n  [\r\n    [0.0, 0.5, 0.5],\r\n    [0.0, 0.5, 0.5],\r\n    [0.5, 0.5, 0]\r\n  ],\r\n  [\r\n    [0.0, 0.5, 0.5],\r\n    [0.5, 0.5, 0],\r\n    [0.5, 0.5, 0]\r\n  ],\r\n];\r\n\r\nfor (let i = 0; i < 4; i++) {\r\n  let w = wtable[i];\r\n  w = [w[0], w[1], [0.0, 0.5, 0.5]];\r\n  wtable.push(w);\r\n}\r\n\r\nconst pih_tmps = util.cachering.fromConstructor(Vector3, 16);\r\nconst boxfaces_table = [\r\n  [0, 1, 2, 3],\r\n  [7, 6, 5, 4],\r\n  [0, 4, 5, 1],\r\n  [1, 5, 6, 2],\r\n  [2, 6, 7, 3],\r\n  [3, 7, 4, 0]\r\n];\r\n\r\nlet boxfaces_tmp = new Array(6);\r\nfor (let i = 0; i < 6; i++) {\r\n  boxfaces_tmp[i] = new Vector3();\r\n}\r\n\r\nlet boxfacenormals_tmp = new Array(6);\r\nfor (let i = 0; i < 6; i++) {\r\n  boxfacenormals_tmp[i] = new Vector3();\r\n}\r\n\r\nexport function point_in_hex(p, boxverts, boxfacecents = undefined, boxfacenormals = undefined) {\r\n  if (!boxfacecents) {\r\n    boxfacecents = boxfaces_tmp;\r\n\r\n    for (let i = 0; i < 6; i++) {\r\n      let [v1, v2, v3, v4] = boxfaces_table[i];\r\n      v1 = boxverts[v1];\r\n      v2 = boxverts[v2];\r\n      v3 = boxverts[v3];\r\n      v4 = boxverts[v4];\r\n\r\n      boxfacecents[i].load(v1).add(v2).add(v3).add(v4).mulScalar(0.25);\r\n    }\r\n  }\r\n\r\n  if (!boxfacenormals) {\r\n    boxfacenormals = boxfacenormals_tmp;\r\n    for (let i = 0; i < 6; i++) {\r\n      let [v1, v2, v3, v4] = boxfaces_table[i];\r\n      v1 = boxverts[v1];\r\n      v2 = boxverts[v2];\r\n      v3 = boxverts[v3];\r\n      v4 = boxverts[v4];\r\n\r\n      let n = normal_quad(v1, v2, v3, v4);\r\n      boxfacenormals[i].load(n).negate();\r\n    }\r\n  }\r\n\r\n  let t1 = pih_tmps.next();\r\n  let t2 = pih_tmps.next();\r\n\r\n  let cent = pih_tmps.next().zero();\r\n  for (let i = 0; i < 6; i++) {\r\n    cent.add(boxfacecents[i]);\r\n  }\r\n  cent.mulScalar(1.0/6.0);\r\n\r\n  let ret = true;\r\n\r\n  for (let i = 0; i < 6; i++) {\r\n    t1.load(p).sub(boxfacecents[i]);\r\n    t2.load(cent).sub(boxfacecents[i]);\r\n    let n = boxfacenormals[i];\r\n\r\n    if (1) {\r\n      t1.normalize();\r\n      t2.normalize();\r\n\r\n      //console.log(i, \"DOT\", n.dot(t1).toFixed(5), n, t1);\r\n    }\r\n\r\n    if (t1.dot(t2) < 0) {\r\n      //console.log(\"\\n\");\r\n      ret = false;\r\n      return false;\r\n    }\r\n  }\r\n\r\n  //console.log(\"\\n\");\r\n  return ret;\r\n  //return true;\r\n}\r\n\r\nconst boxverts_tmp = new Array(8);\r\nfor (let i = 0; i < 8; i++) {\r\n  boxverts_tmp[i] = new Vector3();\r\n}\r\n\r\nexport function trilinear_co(p, boxverts) {\r\n  let uvw = tril_co_rets.next();\r\n\r\n  uvw.zero();\r\n\r\n  let u = tril_co_tmps.next();\r\n  let v = tril_co_tmps.next();\r\n  let w = tril_co_tmps.next();\r\n\r\n  u.loadXYZ(0.0, 0.5, 1.0);\r\n  v.loadXYZ(0.0, 0.5, 1.0);\r\n  w.loadXYZ(0.0, 0.5, 1.0);\r\n\r\n  let uvw2 = tril_co_tmps.next();\r\n\r\n  for (let step = 0; step < 4; step++) {\r\n    uvw.loadXYZ(u[1], v[1], w[1]);\r\n\r\n    let mini = undefined;\r\n    let mindis = trilinear_v3(uvw, boxverts).vectorDistanceSqr(p);\r\n\r\n    for (let i = 0; i < 8; i++) {\r\n      let [t1, t2, t3] = wtable[i];\r\n\r\n      let u2 = t1[0]*u[0] + t1[1]*u[1] + t1[2]*u[2];\r\n      let v2 = t2[0]*v[0] + t2[1]*v[1] + t2[2]*v[2];\r\n      let w2 = t3[0]*w[0] + t3[1]*w[1] + t3[2]*w[2];\r\n\r\n      let du = Math.abs(u2 - u[1]);\r\n      let dv = Math.abs(v2 - v[1]);\r\n      let dw = Math.abs(w2 - w[1]);\r\n\r\n      uvw.loadXYZ(u2, v2, w2);\r\n      let dis = trilinear_v3(uvw, boxverts).vectorDistanceSqr(p);\r\n\r\n      if (mindis === undefined || dis < mindis) {\r\n        //mindis = dis;\r\n        //mini = i;\r\n      }\r\n\r\n      if (1) {\r\n        let bv = boxverts_tmp;\r\n\r\n        /*\r\n        let dd = 1.0 - 0.001;\r\n\r\n        du *= dd;\r\n        dv *= dd;\r\n        dw *= dd;\r\n        //*/\r\n\r\n        bv[0].loadXYZ(u2 - du, v2 - dv, w2 - dw);\r\n        bv[1].loadXYZ(u2 - du, v2 + dv, w2 - dw);\r\n        bv[2].loadXYZ(u2 + du, v2 + dv, w2 - dw);\r\n        bv[3].loadXYZ(u2 + du, v2 - dv, w2 - dw);\r\n\r\n        bv[4].loadXYZ(u2 - du, v2 - dv, w2 + dw);\r\n        bv[5].loadXYZ(u2 - du, v2 + dv, w2 + dw);\r\n        bv[6].loadXYZ(u2 + du, v2 + dv, w2 + dw);\r\n        bv[7].loadXYZ(u2 + du, v2 - dv, w2 + dw);\r\n\r\n        for (let j = 0; j < 8; j++) {\r\n          bv[j].load(trilinear_v3(bv[j], boxverts));\r\n        }\r\n\r\n        if (point_in_hex(p, bv)) {\r\n          mini = i;\r\n          mindis = dis;\r\n          //console.log(\"DIS\", (dis**0.5).toFixed(3));\r\n          break;\r\n        }\r\n\r\n        //console.log(\"\\n\");\r\n      }\r\n    }\r\n\r\n    if (mini === undefined) {\r\n      lreport(\"mindis:\", (mindis**0.5).toFixed(3));\r\n      break;\r\n    }\r\n\r\n    let [t1, t2, t3] = wtable[mini];\r\n\r\n    let u2 = t1[0]*u[0] + t1[1]*u[1] + t1[2]*u[2];\r\n    let v2 = t2[0]*v[0] + t2[1]*v[1] + t2[2]*v[2];\r\n    let w2 = t3[0]*w[0] + t3[1]*w[1] + t3[2]*w[2];\r\n\r\n    let du = Math.abs(u2 - u[1]);\r\n    let dv = Math.abs(v2 - v[1]);\r\n    let dw = Math.abs(w2 - w[1]);\r\n\r\n    u[0] = u2 - du;\r\n    v[0] = v2 - dv;\r\n    w[0] = w2 - dw;\r\n\r\n    u[1] = u2;\r\n    v[1] = v2;\r\n    w[1] = w2;\r\n\r\n    u[2] = u2 + du;\r\n    v[2] = v2 + dv;\r\n    w[2] = w2 + dw;\r\n\r\n    lreport(\"mindis:\", (mindis**0.5).toFixed(3), u2, v2, w2);\r\n  }\r\n\r\n  uvw.loadXYZ(u[1], v[1], w[1]);\r\n\r\n  //console.log(\"uvw\", uvw);\r\n\r\n  //return uvw;\r\n\r\n  return trilinear_co2(p, boxverts, uvw);\r\n}\r\n\r\n//newton-raphson\r\nexport function trilinear_co2(p, boxverts, uvw) {\r\n  //let uvw = tril_co_rets.next();\r\n  let grad = tril_co_tmps.next();\r\n\r\n  //uvw[0] = uvw[1] = uvw[2] = 0.5;\r\n\r\n  let df = 0.00001;\r\n\r\n  let mat = tril_mat_1;\r\n  let m = mat.$matrix;\r\n  let mat2 = tril_mat_2;\r\n\r\n  let r1 = tril_co_tmps.next();\r\n\r\n  for (let step = 0; step < 55; step++) {\r\n    //let r1 = trilinear_v3(uvw, boxverts).vectorDistance(p);\r\n    let totg = 0;\r\n\r\n    for (let i = 0; i < 3; i++) {\r\n      let axis_error = 0.0;\r\n\r\n      if (uvw[i] < 0) {\r\n        axis_error = -uvw[i];\r\n      } else if (uvw[i] > 1.0) {\r\n        axis_error = uvw[i] - 1.0;\r\n      }\r\n      //r1[i] = trilinear_v3(uvw, boxverts)[i] - p[i];\r\n      r1[i] = trilinear_v3(uvw, boxverts).vectorDistance(p) + 10.0*axis_error;\r\n\r\n      let orig = uvw[i];\r\n\r\n      uvw[i] += df;\r\n      //let r2 = trilinear_v3(uvw, boxverts)[i] - p[i];\r\n\r\n      if (uvw[i] < 0) {\r\n        axis_error = -uvw[i];\r\n      } else if (uvw[i] > 1.0) {\r\n        axis_error = uvw[i] - 1.0;\r\n      } else {\r\n        axis_error = 0.0;\r\n      }\r\n      let r2 = trilinear_v3(uvw, boxverts).vectorDistance(p) + 10.0*axis_error;\r\n      uvw[i] = orig;\r\n\r\n      grad[i] = (r2 - r1[i])/df;\r\n      totg += grad[i]**2;\r\n    }\r\n\r\n    if (totg === 0.0) {\r\n      break;\r\n    }\r\n\r\n    let err = trilinear_v3(uvw, boxverts).vectorDistance(p);\r\n\r\n    if (1) {\r\n      //grad.normalize();\r\n      uvw.addFac(grad, -err/totg*0.85);\r\n    } else {\r\n      mat.makeIdentity();\r\n      m.m11 = grad[0];\r\n      m.m12 = grad[1];\r\n      m.m13 = grad[2];\r\n      m.m22 = m.m33 = m.m44 = 0.0;\r\n\r\n      mat.transpose();\r\n      mat2.load(mat).transpose();\r\n\r\n      //right-indepdenent pseudo inverse\r\n      //mat.multiply(mat2).invert();\r\n      //mat.preMultiply(mat2);\r\n\r\n      //left-independent\r\n      mat.preMultiply(mat2).invert();\r\n      mat.multiply(mat2);\r\n\r\n      grad.load(r1);\r\n      grad.multVecMatrix(mat);\r\n      uvw.addFac(grad, -1.0);\r\n    }\r\n\r\n    lreport(\"error:\", err.toFixed(3), uvw);\r\n\r\n    if (r1.dot(r1)**0.5 < 0.0001) {\r\n      break;\r\n    }\r\n  }\r\n\r\n  lreport(\"\\n\");\r\n\r\n  return uvw;\r\n}\r\n\r\nlet angle_tri_v3_rets = util.cachering.fromConstructor(Vector3, 32);\r\nlet angle_tri_v3_vs = util.cachering.fromConstructor(Vector3, 32);\r\n\r\nexport function tri_angles(v1, v2, v3) {\r\n  let t1 = angle_tri_v3_vs.next().load(v1).sub(v2);\r\n  let t2 = angle_tri_v3_vs.next().load(v3).sub(v2);\r\n  let t3 = angle_tri_v3_vs.next().load(v2).sub(v3);\r\n\r\n  t1.normalize();\r\n  t2.normalize();\r\n  t3.normalize();\r\n\r\n  let th1 = Math.acos(t1.dot(t2)*0.99999);\r\n  t2.negate();\r\n\r\n  let th2 = Math.acos(t2.dot(t3)*0.99999);\r\n  let th3 = Math.PI - (th1 + th2);\r\n\r\n  let ret = angle_tri_v3_rets.next();\r\n\r\n  ret[0] = th1;\r\n  ret[1] = th2;\r\n  ret[2] = th3;\r\n\r\n  return ret;\r\n}\r\n\r\n\r\n","let _clipdata = {\r\n  name: \"nothing\",\r\n  mime: \"nothing\",\r\n  data: undefined\r\n};\r\n\r\nlet _clipboards = {};\r\n\r\nimport * as ctrlconfig from '../path-controller/config/config.js';\r\n\r\nwindow.setInterval(() => {\r\n  let cb = navigator.clipboard;\r\n\r\n  if (!cb || !cb.read) {\r\n    return;\r\n  }\r\n\r\n  cb.read().then((data) => {\r\n    for (let item of data) {\r\n      for (let i = 0; i < item.types.length; i++) {\r\n        let type = item.types[i];\r\n\r\n        if (!(type in _clipboards)) {\r\n          _clipboards[type] = {\r\n            name: type,\r\n            mime: type,\r\n            data: undefined\r\n          };\r\n        }\r\n        ;\r\n\r\n        item.getType(type).then((blob) => new Response(blob).text()).then((text) => {\r\n          _clipboards[type].data = text;\r\n        });\r\n      }\r\n\r\n      //item.getType(\"text/css\").then((blob) => blob.text()).then((text) => {\r\n      //  console.log(\"text\", text);\r\n      //});\r\n    }\r\n    //_clipdata.mime =\r\n  }).catch(function () {\r\n  });\r\n}, 200);\r\n\r\nlet exports = {\r\n  /*client code can override this using .loadConstants, here is a simple implementation\r\n    that just handles color data\r\n\r\n    desiredMimes is either a string, or an array of strings\r\n   */\r\n  getClipboardData(desiredMimes = \"text/plain\") {\r\n    if (typeof desiredMimes === \"string\") {\r\n      desiredMimes = [desiredMimes];\r\n    }\r\n\r\n    for (let m of desiredMimes) {\r\n      let cb = _clipboards[m];\r\n\r\n      if (cb && cb.data) {\r\n        return cb;\r\n      }\r\n    }\r\n  },\r\n  /*client code can override this, here is a simple implementation\r\n    that just handles color data\r\n   */\r\n  setClipboardData(name, mime, data) {\r\n    _clipboards[mime] = {\r\n      name: name,\r\n      mime: mime,\r\n      data: data\r\n    };\r\n\r\n    let clipboard = navigator.clipboard;\r\n    if (!clipboard) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      clipboard.write([new ClipboardItem({\r\n        [mime]: new Blob([data], {type: mime})\r\n      })]).catch((error) => {\r\n        //try pushing through text/plain\r\n        if (mime.startsWith(\"text\") && mime !== \"text/plain\") {\r\n          this.setClipboardData(name, \"text/plain\", data);\r\n        } else {\r\n          console.error(error);\r\n        }\r\n      });\r\n    } catch (error) {\r\n      console.log(error.stack);\r\n      console.log(\"failed to write to system clipboard\");\r\n    }\r\n  },\r\n  colorSchemeType: \"light\",\r\n  docManualPath  : \"../simple_docsys/doc_build/\",\r\n\r\n  //add textboxes to rollar sliders,\r\n  //note that  users can also double click them to\r\n  //enter text as well\r\n  useNumSliderTextboxes: true,\r\n\r\n  numSliderArrowLimit: 3, //threshold to check if numslider arrow was clicked\r\n  simpleNumSliders   : false,\r\n\r\n  menusCanPopupAbove: false,\r\n  menu_close_time   : 500,\r\n  doubleClickTime   : 500,\r\n\r\n  //timeout for press-and-hold (touch) version of double clicking\r\n  doubleClickHoldTime: 750,\r\n  DEBUG              : {\r\n    paranoidEvents      : false,\r\n    screenborders       : false,\r\n    areaContextPushes   : false,\r\n    allBordersMovable   : false,\r\n    doOnce              : false,\r\n    modalEvents         : false,\r\n    areaConstraintSolver: false,\r\n    datapaths           : false,\r\n\r\n    domEvents        : false,\r\n    domEventAddRemove: false,\r\n\r\n    debugUIUpdatePerf: false, //turns async FrameManager.update_intern loop into sync\r\n\r\n    screenAreaPosSizeAccesses: false,\r\n    buttonEvents             : false,\r\n\r\n    /*\r\n    customWindowSize: {\r\n      width: 2048, height: 2048\r\n    },\r\n    //*/\r\n  },\r\n\r\n  //auto load 1d bspline templates, can hurt startup time\r\n  autoLoadSplineTemplates: true,\r\n\r\n  addHelpPickers: true,\r\n\r\n  useAreaTabSwitcher : false,\r\n  autoSizeUpdate     : true,\r\n  showPathsInToolTips: true,\r\n\r\n  enableThemeAutoUpdate: true,\r\n\r\n  loadConstants: function (args) {\r\n    for (let k in args) {\r\n      if (k === \"loadConstants\")\r\n        continue;\r\n\r\n      this[k] = args[k];\r\n    }\r\n\r\n    ctrlconfig.setConfig(this);\r\n  }\r\n};\r\n\r\nexport default exports;\r\nwindow.DEBUG = exports.DEBUG;\r\n\r\nlet cfg = document.getElementById(\"pathux-config\");\r\nif (cfg) {\r\n  console.error(\"CONFIG CONFIG\", cfg.innerText);\r\n  exports.loadConstants(JSON.parse(cfg.innerText));\r\n}\r\n","/*\r\nTHEME REFACTOR:\r\n\r\n* Use CSS as much as possible\r\n* Create a compatibility layer\r\n\r\n*/\r\nimport * as util from \"../path-controller/util/util.js\";\r\nimport {Vector3, Vector4} from '../path-controller/util/vectormath.js';\r\nimport nstructjs from \"../path-controller/util/struct.js\";\r\nimport cconst from '../config/const.js';\r\n\r\nexport let compatMap = {\r\n  BoxMargin : \"padding\",\r\n  BoxBG : \"background\",\r\n  BoxRadius : \"border-radius\",\r\n  background : \"background-color\",\r\n  defaultWidth : \"width\",\r\n  defaultHeight : \"height\",\r\n  DefaultWidth : \"width\",\r\n  DefaultHeight : \"height\",\r\n  BoxBorder : \"border-color\",\r\n  BoxLineWidth : \"border-width\",\r\n  BoxSubBG : \"background-color\",\r\n  BoxSub2BG : \"background-color\",\r\n  DefaultPanelBG : \"background-color\",\r\n  InnerPanelBG : \"background-color\",\r\n  Background : \"background-color\",\r\n  numslider_width : \"width\",\r\n  numslider_height : \"height\",\r\n};\r\n\r\nexport let ColorSchemeTypes = {\r\n  LIGHT : \"light\",\r\n  DARK  : \"dark\"\r\n};\r\n\r\nexport function parsepx(css) {\r\n  return parseFloat(css.trim().replace(\"px\", \"\"))\r\n}\r\n\r\nexport function color2css(c, alpha_override) {\r\n  let r = ~~(c[0]*255);\r\n  let g = ~~(c[1]*255);\r\n  let b = ~~(c[2]*255);\r\n  let a = c.length < 4 ? 1.0 : c[3];\r\n\r\n  a = alpha_override !== undefined ? alpha_override : a;\r\n\r\n  if (c.length === 3 && alpha_override === undefined) {\r\n    return `rgb(${r},${g},${b})`;\r\n  } else {\r\n    return `rgba(${r},${g},${b}, ${a})`;\r\n  }\r\n}\r\nwindow.color2css = color2css;\r\n\r\nlet css2color_rets = util.cachering.fromConstructor(Vector4, 64);\r\nlet basic_colors = {\r\n  'white' : [1,1,1],\r\n  'grey' : [0.5, 0.5, 0.5],\r\n  'gray' : [0.5, 0.5, 0.5],\r\n  'black' : [0, 0, 0],\r\n  'red' : [1, 0, 0],\r\n  'yellow' : [1, 1, 0],\r\n  'green' : [0, 1, 0],\r\n  'teal' : [0, 1, 1],\r\n  'cyan' : [0, 1, 1],\r\n  'blue' : [0, 0, 1],\r\n  'orange' : [1, 0.5, 0.25],\r\n  'brown' : [0.5, 0.4, 0.3],\r\n  'purple' : [1, 0, 1],\r\n  'pink' : [1, 0.5, 0.5]\r\n};\r\n\r\nexport function color2web(color) {\r\n  function tostr(n) {\r\n    n = ~~(n*255);\r\n    let s = n.toString(16);\r\n\r\n    if (s.length > 2) {\r\n      s = s.slice(0, 2);\r\n    }\r\n\r\n    while (s.length < 2) {\r\n      s = \"0\" + s;\r\n    }\r\n\r\n    return s;\r\n  }\r\n\r\n  if (color.length === 3 || color[3] === 1.0) {\r\n    let r = tostr(color[0]);\r\n    let g = tostr(color[1]);\r\n    let b = tostr(color[2]);\r\n\r\n    return \"#\" + r + g + b;\r\n  } else {\r\n    let r = tostr(color[0]);\r\n    let g = tostr(color[1]);\r\n    let b = tostr(color[2]);\r\n    let a = tostr(color[3]);\r\n\r\n    return \"#\" + r + g + b + a;\r\n  }\r\n}\r\n\r\nwindow.color2web = color2web;\r\n\r\nexport function css2color(color) {\r\n  if (!color) {\r\n    return new Vector4([0,0,0,1]);\r\n  }\r\n\r\n  color = (\"\"+color).trim();\r\n\r\n  let ret = css2color_rets.next();\r\n\r\n  if (color[0] === \"#\") {\r\n    color = color.slice(1, color.length);\r\n    let parts = [];\r\n\r\n    for (let i=0; i<color.length>>1; i++) {\r\n      let part = \"0x\" + color.slice(i*2, i*2+2);\r\n      parts.push(parseInt(part));\r\n    }\r\n\r\n    ret.zero();\r\n    let i;\r\n    for (i=0; i<Math.min(parts.length, ret.length); i++) {\r\n      ret[i] = parts[i] / 255.0;\r\n    }\r\n\r\n    if (i < 4) {\r\n      ret[3] = 1.0;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  if (color in basic_colors) {\r\n    ret.load(basic_colors[color]);\r\n    ret[3] = 1.0;\r\n    return ret;\r\n  }\r\n\r\n  color = color.replace(\"rgba\", \"\").replace(\"rgb\", \"\").replace(/[\\(\\)]/g, \"\").trim().split(\",\")\r\n\r\n  for (let i=0; i<color.length; i++) {\r\n    ret[i] = parseFloat(color[i]);\r\n    if (i < 3) {\r\n      ret[i] /= 255;\r\n    }\r\n  }\r\n\r\n  if (color.length === 3) {\r\n    color.push(1.0);\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nwindow.css2color = css2color\r\n\r\nexport function web2color(str) {\r\n  if (typeof str === \"string\" && str.trim()[0] !== \"#\") {\r\n    str = \"#\" + str.trim();\r\n  }\r\n\r\n  return css2color(str);\r\n}\r\nwindow.web2color = web2color;\r\n\r\nlet validate_pat = /\\#?[0-9a-fA-F]{6}([0-9a-fA-F]{2})?$/;\r\n\r\nexport function validateWebColor(str) {\r\n  if (typeof str !== \"string\" && !(str instanceof String))\r\n    return false;\r\n\r\n  return str.trim().search(validate_pat) === 0;\r\n}\r\n\r\nlet num = \"(([0-9]+\\.[0-9]+)|[0-9a-f]+)\";\r\n\r\nlet validate_rgba = new RegExp(`rgba\\\\(${num},${num},${num},${num}\\\\)$`);\r\nlet validate_rgb = new RegExp(`rgb\\\\(${num},${num},${num}\\\\)$`);\r\n\r\nexport function validateCSSColor(color) {\r\n  if (color.toLowerCase() in basic_colors) {\r\n    return true;\r\n  }\r\n\r\n  let rgba = color.toLowerCase().replace(/[ \\t]/g, \"\");\r\n  rgba = rgba.trim();\r\n\r\n  if (validate_rgba.test(rgba) || validate_rgb.exec(rgba)) {\r\n    return true;\r\n  }\r\n\r\n  return validateWebColor(color);\r\n}\r\n\r\nwindow.validateCSSColor = validateCSSColor;\r\n\r\nexport let theme = {};\r\n\r\nexport function invertTheme() {\r\n  cconst.colorSchemeType = cconst.colorSchemeType === ColorSchemeTypes.LIGHT ? ColorSchemeTypes.DARK : ColorSchemeTypes.LIGHT;\r\n\r\n  function inverted(color) {\r\n    if (Array.isArray(color)) {\r\n      for (let i = 0; i < 3; i++) {\r\n        color[i] = 1.0 - color[i];\r\n      }\r\n\r\n      return color;\r\n    }\r\n\r\n    color = css2color(color);\r\n    return color2css(inverted(color));\r\n  }\r\n\r\n  let bg = document.body.style[\"background-color\"];\r\n  //if (!bg) {\r\n  bg = cconst.colorSchemeType === ColorSchemeTypes.LIGHT ? \"rgb(200,200,200)\" : \"rgb(55, 55, 55)\";\r\n  //} else {\r\n  //  bg = inverted(bg);\r\n  //}\r\n\r\n  document.body.style[\"background-color\"] = bg;\r\n\r\n  for (let style in theme) {\r\n    style = theme[style];\r\n\r\n    for (let k in style) {\r\n      let v = style[k];\r\n\r\n      if (v instanceof CSSFont) {\r\n        v.color = inverted(v.color);\r\n      } else if (typeof v === \"string\") {\r\n        v = v.trim().toLowerCase();\r\n\r\n        let iscolor = v.search(\"rgb\") >= 0;\r\n        iscolor = iscolor || v in basic_colors;\r\n        iscolor = iscolor || validateWebColor(v);\r\n\r\n        if (iscolor) {\r\n          style[k] = inverted(v);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nwindow.invertTheme = invertTheme;\r\n\r\nexport function setColorSchemeType(mode) {\r\n  if (!!mode !== cconst.colorSchemeType) {\r\n    invertTheme();\r\n    cconst.colorSchemeType = mode;\r\n  }\r\n\r\n}\r\nwindow.validateWebColor = validateWebColor;\r\n\r\nlet _digest = new util.HashDigest();\r\n\r\nexport class CSSFont {\r\n  constructor(args={}) {\r\n    this._size = args.size ? args.size : 12;\r\n    this.font = args.font;\r\n    this.style = args.style !== undefined ? args.style : \"normal\";\r\n    this.weight = args.weight !== undefined ? args.weight : \"normal\";\r\n    this.variant = args.variant !== undefined ? args.variant : \"normal\";\r\n    this.color = args.color;\r\n  }\r\n\r\n  calcHashUpdate(digest=_digest.reset()) {\r\n    digest.add(this._size || 0);\r\n    digest.add(this.font);\r\n    digest.add(this.style);\r\n    digest.add(this.weight);\r\n    digest.add(this.variant);\r\n    digest.add(this.color);\r\n\r\n    return digest.get();\r\n  }\r\n\r\n  set size(val) {\r\n    this._size = val;\r\n  }\r\n\r\n  get size() {\r\n    if (util.isMobile()) {\r\n      let mul = theme.base.mobileTextSizeMultiplier / visualViewport.scale;\r\n      if (mul) {\r\n        return this._size * mul;;\r\n      }\r\n    }\r\n\r\n    return this._size;\r\n  }\r\n\r\n  copyTo(b) {\r\n    b._size = this._size;\r\n    b.font = this.font;\r\n    b.style = this.style;\r\n    b.color = this.color;\r\n    b.variant = this.variant;\r\n    b.weight = this.weight;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new CSSFont();\r\n    this.copyTo(ret);\r\n    return ret;\r\n  }\r\n\r\n  genCSS(size=this.size) {\r\n    return `${this.style} ${this.variant} ${this.weight} ${size}px ${this.font}`;\r\n  }\r\n\r\n  //deprecated, use genKey()\r\n  hash() {\r\n    return this.genKey();\r\n  }\r\n\r\n  genKey() {\r\n    let color = this.color;\r\n\r\n    if (typeof this.color === \"object\" || typeof this.color === \"function\") {\r\n      color = JSON.stringify(color);\r\n    }\r\n\r\n    return this.genCSS() + \":\" + this.size + \":\" + color;\r\n  }\r\n}\r\nCSSFont.STRUCT = `\r\nCSSFont {\r\n  size     : float | obj._size;\r\n  font     : string | obj.font || \"\";\r\n  style    : string | obj.font || \"\";\r\n  color    : string | \"\"+obj.color;\r\n  variant  : string | obj.variant || \"\";\r\n  weight   : string | \"\"+obj.weight;\r\n}\r\n`;\r\nnstructjs.register(CSSFont);\r\n\r\nexport function exportTheme(theme1=theme, addVarDecl=true) {\r\n  let sortkeys = (obj) => {\r\n    let keys = [];\r\n    for (let k in obj) {\r\n      keys.push(k);\r\n    }\r\n    keys.sort();\r\n\r\n    return keys;\r\n  }\r\n\r\n  let s = addVarDecl ? \"var theme = {\\n\" : \"{\\n\";\r\n\r\n  function writekey(v, indent=\"\") {\r\n    if (typeof v === \"string\") {\r\n      if (v.search(\"\\n\") >= 0) {\r\n        v = \"`\" + v + \"`\";\r\n      } else {\r\n        v = \"'\" + v + \"'\";\r\n      }\r\n\r\n      return v;\r\n    } else if (typeof v === \"object\") {\r\n      if (v instanceof CSSFont) {\r\n        return `new CSSFont({\r\n${indent}  font    : ${writekey(v.font)},\r\n${indent}  weight  : ${writekey(v.weight)},\r\n${indent}  variant : ${writekey(v.variant)},\r\n${indent}  style   : ${writekey(v.style)},\r\n${indent}  size    : ${writekey(v._size)},\r\n${indent}  color   : ${writekey(v.color)}\r\n${indent}})`;\r\n      } else {\r\n        let s = \"{\\n\";\r\n\r\n        for (let k of sortkeys(v)) {\r\n          let v2 = v[k];\r\n\r\n          if (k.search(\" \") >= 0 || k.search(\"-\") >= 0) {\r\n            k = \"'\" + k + \"'\";\r\n          }\r\n\r\n          s += indent + \"  \" + k + \" : \" + writekey(v2, indent + \"  \") + \",\\n\";\r\n        }\r\n\r\n        s += indent + \"}\";\r\n        return s;\r\n      }\r\n    } else {\r\n      return \"\"+v;\r\n    }\r\n\r\n    return \"error\";\r\n  }\r\n\r\n  for (let k of sortkeys(theme1)) {\r\n    let k2 = k;\r\n\r\n    if (k.search(\"-\") >= 0 || k.search(\" \") >= 0) {\r\n      k2 = \"'\" + k + \"'\";\r\n    }\r\n    s += \"  \" + k2 + \": \";\r\n\r\n    let v = theme1[k];\r\n    if (typeof v !== \"object\" || v instanceof CSSFont) {\r\n      s += writekey(v, \"  \") + \",\\n\";\r\n    } else {\r\n      s += \" {\\n\"\r\n      let s2 = \"\";\r\n\r\n      let maxwid = 0;\r\n\r\n      for (let k2 of sortkeys(v)) {\r\n        if (k2.search(\"-\") >= 0 || k2.search(\" \") >= 0) {\r\n          k2 = \"'\" + k2 + \"'\";\r\n        }\r\n\r\n        maxwid = Math.max(maxwid, k2.length);\r\n      }\r\n\r\n      for (let k2 of sortkeys(v)) {\r\n        let v2 = v[k2];\r\n\r\n        if (k2.search(\"-\") >= 0 || k2.search(\" \") >= 0) {\r\n          k2 = \"'\" + k2 + \"'\";\r\n        }\r\n\r\n        let pad = \"\";\r\n\r\n        for (let i=0; i<maxwid-k2.length; i++) {\r\n          pad += \" \";\r\n        }\r\n\r\n        s2 += \"    \" + k2 + pad + \": \" + writekey(v2, \"    \") + \",\\n\";\r\n      }\r\n\r\n      s += s2;\r\n      s += \"  },\\n\\n\"\r\n    }\r\n  }\r\n  s += \"};\\n\";\r\n\r\n  return s;\r\n}\r\nwindow._exportTheme = exportTheme;\r\n\r\n","import {Vector2, Matrix4, Quat, Vector3, Vector4} from '../path-controller/util/vectormath.js';\r\nimport * as math from '../path-controller/util/math.js'\r\nimport {color2css, css2color, parsepx} from './ui_theme.js';\r\nimport {Curve1D, getCurve} from \"../path-controller/curve/curve1d.js\";\r\nimport * as util from '../path-controller/util/util.js';\r\n\r\nclass Task {\r\n  constructor(taskcb) {\r\n    this.task = taskcb;\r\n    this.start = util.time_ms();\r\n    this.done = false;\r\n  }\r\n}\r\n\r\nexport class AnimManager {\r\n  constructor() {\r\n    this.tasks = [];\r\n    this.timer = undefined;\r\n\r\n    //all animation tasks that last longer then 10 seconds are terminated\r\n    this.timeOut = 10*1000.0;\r\n  }\r\n\r\n  stop() {\r\n    if (this.timer !== undefined) {\r\n      window.clearInterval(this.timer);\r\n      this.timer = undefined;\r\n    }\r\n  }\r\n\r\n  add(task) {\r\n    this.tasks.push(new Task(task));\r\n  }\r\n\r\n  remove(task) {\r\n    for (let t of this.tasks) {\r\n      if (t.task === task) {\r\n        t.dead = true;\r\n        this.tasks.remove(t);\r\n        return;\r\n      }\r\n    }\r\n  }\r\n\r\n  start() {\r\n    this.timer = window.setInterval(() => {\r\n      for (let t of this.tasks) {\r\n        try {\r\n          t.task();\r\n        } catch (error) {\r\n          t.done = true;\r\n          util.print_stack(error);\r\n        }\r\n\r\n        if (util.time_ms() - t.start > this.timeOut) {\r\n          t.dead = true;\r\n        }\r\n      }\r\n\r\n      for (let i=0; i<this.tasks.length; i++) {\r\n        if (this.tasks[i].done) {\r\n          let t = this.tasks[i];\r\n          this.tasks.remove(t);\r\n          i--;\r\n\r\n          try {\r\n            if (t.task.onend) {\r\n              t.task.onend();\r\n            }\r\n          } catch (error) {\r\n            util.print_stack(error);\r\n          }\r\n        }\r\n      }\r\n    }, 1000/40.0);\r\n  }\r\n}\r\n\r\n\r\nexport const manager = new AnimManager();\r\nmanager.start();\r\n\r\nexport class AbstractCommand {\r\n  constructor() {\r\n    this.cbs = [];\r\n    this.end_cbs = [];\r\n  }\r\n\r\n  start(animator, done) {\r\n\r\n  }\r\n\r\n  exec(animator, done) {\r\n\r\n  }\r\n}\r\n\r\nexport class WaitCommand extends AbstractCommand {\r\n  constructor(ms) {\r\n    super();\r\n    this.ms = ms;\r\n  }\r\n\r\n  start(animator, done) {\r\n    this.time = animator.time;\r\n  }\r\n\r\n  exec(animator, done) {\r\n    if (animator.time - this.time > this.ms) {\r\n      done();\r\n    }\r\n  }\r\n}\r\n\r\nexport class GoToCommand extends AbstractCommand {\r\n  constructor(obj, key, value, time, curve=\"ease\") {\r\n    super();\r\n\r\n    this.object = obj;\r\n    this.key = key;\r\n    this.value = value;\r\n    this.ms = time;\r\n\r\n    if (typeof curve === \"string\") {\r\n      this.curve = new (getCurve(curve))();\r\n    } else {\r\n      this.curve = curve;\r\n    }\r\n  }\r\n\r\n  start(animator, done) {\r\n    this.time = animator.time;\r\n\r\n    let value = this.object[this.key];\r\n\r\n    if (Array.isArray(value)) {\r\n      this.startValue = util.list(value);\r\n    } else {\r\n      this.startValue = value;\r\n    }\r\n  }\r\n\r\n  exec(animator, done) {\r\n    let t = animator.time - this.time;\r\n    let ms = this.ms;\r\n\r\n    if (t > ms) {\r\n      done();\r\n      t = ms;\r\n    }\r\n\r\n    t /= ms;\r\n\r\n    t = this.curve.evaluate(t);\r\n\r\n    if (Array.isArray(this.startValue)) {\r\n      let value = this.object[this.key];\r\n\r\n      for (let i=0; i<this.startValue.length; i++) {\r\n        if (value[i] === undefined || this.value[i] === undefined) {\r\n          continue;\r\n        }\r\n\r\n        value[i] = this.startValue[i] + (this.value[i] - this.startValue[i]) * t;\r\n      }\r\n    } else {\r\n      this.object[this.key] = this.startValue + (this.value - this.startValue) * t;\r\n\r\n    }\r\n  }\r\n}\r\n\r\nexport class SetCommand extends AbstractCommand {\r\n  constructor(obj, key, val) {\r\n    super();\r\n\r\n    this.object = obj;\r\n    this.key = key;\r\n    this.value = val;\r\n  }\r\n\r\n  start(animator, done) {\r\n    this.object[key] = val;\r\n    done();\r\n  }\r\n}\r\n\r\nexport class Command {\r\n  constructor(type, args) {\r\n    this.args = args;\r\n    this.cbs = [];\r\n  }\r\n}\r\n\r\nexport class Animator {\r\n  constructor(owner, method = \"update\") {\r\n    this.on_tick = this.on_tick.bind(this);\r\n    this.on_tick.onend = () => {\r\n      if (this.onend) {\r\n        this.onend();\r\n      }\r\n    }\r\n\r\n    this.commands = [];\r\n    this.owner = owner;\r\n    this._done = false;\r\n    this.method = method;\r\n    this.onend = null;\r\n    this.first = true;\r\n\r\n    this.time = 0.0;\r\n    this.last = util.time_ms();\r\n\r\n    this.bind(owner);\r\n  }\r\n\r\n  bind(owner) {\r\n    this._done = false;\r\n    this.owner = owner;\r\n    //this.owner[this.method].after(this.on_tick);\r\n    manager.add(this.on_tick);\r\n  }\r\n\r\n  wait(ms) {\r\n    this.commands.push(new WaitCommand(ms));\r\n    return this;\r\n  }\r\n\r\n  goto(key, val, timeMs, curve = \"ease\") {\r\n    let cmd = new GoToCommand(this.owner, key, val, timeMs, curve);\r\n    this.commands.push(cmd);\r\n    return this;\r\n  }\r\n\r\n  set(key, val, time) {\r\n    let cmd = new SetCommand(this.owner, key, val);\r\n    this.commands.push(cmd);\r\n    return this;\r\n  }\r\n\r\n  while(cb) {\r\n    this.commands[this.commands.length - 1].cbs.push(cb);\r\n    return this;\r\n  }\r\n\r\n  then(cb) {\r\n    this.commands[this.commands.length-1].end_cbs.push(cb);\r\n    return this;\r\n  }\r\n\r\n  end() {\r\n    if (this._done) {\r\n      return;\r\n    }\r\n\r\n    this._done = true;\r\n    manager.remove(this.on_tick);\r\n    //this.owner.update.remove(this.on_tick);\r\n\r\n    if (this.onend) {\r\n      this.onend();\r\n    }\r\n  }\r\n\r\n  on_tick() {\r\n    if (this._done) {\r\n      throw new Error(\"animation wasn't properly cleaned up\");\r\n    }\r\n\r\n    let dt = util.time_ms() - this.last;\r\n    this.time += dt;\r\n    this.last = util.time_ms();\r\n\r\n    if (this.commands.length === 0) {\r\n      this.end();\r\n      return\r\n    }\r\n\r\n    let cmd = this.commands[0];\r\n    let done = false;\r\n\r\n    function donecb() {\r\n      done = true;\r\n    }\r\n\r\n    if (this.first) {\r\n      this.first = false;\r\n      //console.log(cmd, cmd.start)\r\n      cmd.start(this, donecb);\r\n    }\r\n\r\n    try {\r\n      cmd.exec(this, donecb);\r\n    } catch (error) {\r\n      done = true;\r\n      util.print_stack(error);\r\n    }\r\n\r\n    for (let cb of this.commands[0].cbs) {\r\n      try {\r\n        cb();\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n      }\r\n    }\r\n\r\n    if (done) {\r\n      for (let cb of this.commands[0].end_cbs) {\r\n        try {\r\n          cb();\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n        }\r\n      }\r\n      while (this.commands.length > 0) {\r\n        this.commands.shift();\r\n\r\n        done = false;\r\n\r\n        if (this.commands.length > 0) {\r\n          this.commands[0].start(this, donecb);\r\n        }\r\n\r\n        if (!done) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","export class token {\r\n  constructor(type, val, lexpos, lexlen, lineno, lexer, parser) {\r\n    this.type = type;\r\n    this.value = val;\r\n    this.lexpos = lexpos;\r\n    this.lexlen = lexlen;\r\n    this.lineno = lineno;\r\n    this.lexer = lexer;\r\n    this.parser = parser;\r\n  }\r\n\r\n  setValue(val) {\r\n    this.value = val;\r\n    return this;\r\n  }\r\n\r\n  toString() {\r\n    if (this.value !== undefined)\r\n      return \"token(type=\" + this.type + \", value='\" + this.value + \"')\"\r\n    else\r\n      return \"token(type=\" + this.type + \")\"\r\n  }\r\n}\r\n\r\n//func is optional. it takes a function\r\n//with one parameter, token, and either\r\n//a) returns the token, or b) returns\r\n//undefined, in which case the token\r\n//should be ignored by the lexer\r\nexport class tokdef {\r\n  constructor(name, regexpr, func) {\r\n    this.name = name;\r\n    this.re = regexpr\r\n    this.func = func\r\n  }\r\n}\r\n\r\nexport class PUTLParseError extends Error {\r\n}\r\n\r\n//errfunc is optional.  it requires\r\n//a function that takes one param, lexer,\r\n//and returns true if the lexer\r\n//should propegate an error when an error\r\n//has happened\r\nexport class lexer {\r\n  constructor(tokdef, errfunc) {\r\n    this.tokdef = tokdef;\r\n    this.tokens = new Array();\r\n    this.lexpos = 0;\r\n    this.lexdata = \"\";\r\n    this.lineno = 0;\r\n    this.errfunc = errfunc;\r\n    this.tokints = {}\r\n\r\n    for (var i=0; i<tokdef.length; i++) {\r\n      this.tokints[tokdef[i].name] = i;\r\n    }\r\n\r\n    this.statestack = [[\"__main__\", 0]];\r\n    this.states = {\"__main__\" : [tokdef, errfunc]};\r\n    this.statedata = 0; //public variable\r\n  }\r\n\r\n  copy() {\r\n    let ret = new lexer(this.tokdef, this.errfunc);\r\n\r\n    for (let k in this.states) {\r\n      let state = this.states[k];\r\n\r\n      state = [state[0], state[1]];\r\n      ret.states[k] = state;\r\n    }\r\n\r\n    ret.statedata = this.statedata;\r\n\r\n    return ret;\r\n  }\r\n\r\n//errfunc is optional, defines state-specific error function\r\n  add_state(name, tokdef, errfunc) {\r\n    if (errfunc === undefined) {\r\n      errfunc = function(lexer) { return true; };\r\n    }\r\n\r\n    this.states[name] = [tokdef, errfunc];\r\n  }\r\n\r\n  tok_int(name) {\r\n\r\n  }\r\n\r\n  //statedata is optional.\r\n  //it stores state-specific data in lexer.statedata.\r\n  push_state(state, statedata) {\r\n    this.statestack.push([state, statedata])\r\n\r\n    state = this.states[state];\r\n    this.statedata = statedata;\r\n\r\n    this.tokdef = state[0];\r\n    this.errfunc = state[1];\r\n  }\r\n\r\n  pop_state() {\r\n    var item = this.statestack[this.statestack.length-1];\r\n    var state = this.states[item[0]];\r\n\r\n    this.tokdef = state[0];\r\n    this.errfunc = state[1];\r\n    this.statedata = item[1];\r\n  }\r\n\r\n  input(str) {\r\n    //go back to main state\r\n    while (this.statestack.length > 1) {\r\n      this.pop_state();\r\n    }\r\n\r\n    this.lexdata = str;\r\n    this.lexpos = 0;\r\n    this.lineno = 0;\r\n    this.tokens = new Array();\r\n\r\n    this.peeked_tokens = [];\r\n  }\r\n\r\n  error() {\r\n    if (this.errfunc !== undefined && !this.errfunc(this))\r\n      return;\r\n\r\n    console.log(\"Syntax error near line \" + this.lineno);\r\n    var next = Math.min(this.lexpos+8, this.lexdata.length);\r\n    console.log(\"  \" + this.lexdata.slice(this.lexpos, next));\r\n\r\n    throw new PUTLParseError(\"Parse error\");\r\n  }\r\n\r\n  peek() {\r\n    var tok = this.next(true);\r\n\r\n    if (tok === undefined)\r\n      return undefined;\r\n\r\n    this.peeked_tokens.push(tok);\r\n    return tok;\r\n  }\r\n\r\n\r\n  peek_i(i) {\r\n    while (this.peeked_tokens.length <= i) {\r\n      var t = this.peek();\r\n      if (t === undefined)\r\n        return undefined;\r\n    }\r\n\r\n    return this.peeked_tokens[i];\r\n  }\r\n\r\n  at_end() {\r\n    return this.lexpos >= this.lexdata.length && this.peeked_tokens.length == 0;\r\n  }\r\n\r\n  next(ignore_peek) {\r\n    if (ignore_peek !== true && this.peeked_tokens.length > 0) {\r\n      var tok = this.peeked_tokens[0];\r\n      this.peeked_tokens.shift();\r\n\r\n      return tok;\r\n    }\r\n\r\n    if (this.lexpos >= this.lexdata.length)\r\n      return undefined;\r\n\r\n    var ts = this.tokdef;\r\n    var tlen = ts.length;\r\n\r\n    var lexdata = this.lexdata.slice(this.lexpos, this.lexdata.length);\r\n\r\n    var results = []\r\n\r\n    for (var i=0; i<tlen; i++) {\r\n      var t = ts[i];\r\n\r\n      if (t.re === undefined)\r\n        continue;\r\n\r\n      var res = t.re.exec(lexdata);\r\n\r\n      if (res !== null && res !== undefined && res.index === 0) {\r\n        results.push([t, res]);\r\n      }\r\n    }\r\n\r\n    var max_res = 0;\r\n    var theres = undefined;\r\n    for (var i=0; i<results.length; i++) {\r\n      var res = results[i];\r\n\r\n      if (res[1][0].length > max_res) {\r\n        theres = res;\r\n        max_res = res[1][0].length;\r\n      }\r\n    }\r\n\r\n    if (theres === undefined) {\r\n      this.error();\r\n      return;\r\n    }\r\n\r\n    var def = theres[0];\r\n\r\n    var lexlen = max_res;\r\n    var tok = new token(def.name, theres[1][0], this.lexpos, lexlen, this.lineno, this, undefined);\r\n    this.lexpos += max_res;\r\n\r\n    if (def.func) {\r\n      tok = def.func(tok)\r\n      if (tok === undefined) {\r\n        return this.next();\r\n      }\r\n    }\r\n\r\n    return tok;\r\n  }\r\n}\r\n\r\nexport class parser {\r\n  constructor(lexer, errfunc) {\r\n    this.lexer = lexer;\r\n    this.errfunc = errfunc;\r\n    this.start = undefined;\r\n    this.userdata = undefined;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new parser(this.lexer.copy(), this.errfunc);\r\n    ret.start = this.start;\r\n\r\n    return ret;\r\n  }\r\n\r\n\r\n  parse(data, err_on_unconsumed) {\r\n    if (err_on_unconsumed === undefined)\r\n      err_on_unconsumed = true;\r\n\r\n    if (data !== undefined)\r\n      this.lexer.input(data);\r\n\r\n    var ret = this.start(this);\r\n\r\n    if (err_on_unconsumed && !this.lexer.at_end() && this.lexer.next() !== undefined) {\r\n      //console.log(this.lexer.lexdata.slice(this.lexer.lexpos-1, this.lexer.lexdata.length));\r\n      this.error(undefined, \"parser did not consume entire input\");\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  input(data) {\r\n    this.lexer.input(data);\r\n  }\r\n\r\n  error(tok, msg) {\r\n    if (msg == undefined)\r\n      msg = \"\"\r\n\r\n    if (tok == undefined)\r\n      var estr = \"Parse error at end of input: \" + msg\r\n    else\r\n      estr = \"Parse error at line \" + (tok.lineno+1) + \": \" + msg;\r\n\r\n    var buf = \"1| \"\r\n    var ld = this.lexer.lexdata;\r\n    var l = 1;\r\n    for (var i=0; i<ld.length; i++) {\r\n      var c = ld[i];\r\n      if (c == '\\n') {\r\n        l++;\r\n        buf += \"\\n\" + l + \"| \"\r\n      } else {\r\n        buf += c;\r\n      }\r\n    }\r\n\r\n    console.log(\"------------------\")\r\n    console.log(buf);\r\n    console.log(\"==================\")\r\n    console.log(estr);\r\n\r\n    if (this.errfunc && !this.errfunc(tok)) {\r\n      return;\r\n    }\r\n\r\n    throw new PUTLParseError(estr);\r\n  }\r\n\r\n  peek() {\r\n    var tok = this.lexer.peek();\r\n    if (tok != undefined)\r\n      tok.parser = this;\r\n\r\n    return tok;\r\n  }\r\n\r\n  peek_i(i) {\r\n    var tok = this.lexer.peek_i(i);\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n\r\n    return tok;\r\n  }\r\n\r\n  peeknext() {\r\n    return this.peek_i(0);\r\n  }\r\n\r\n  next() {\r\n    var tok = this.lexer.next();\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n\r\n    return tok;\r\n  }\r\n\r\n  optional(type) {\r\n    var tok = this.peek_i(0);\r\n\r\n    if (tok && tok.type === type) {\r\n      this.next();\r\n\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  at_end() {\r\n    return this.lexer.at_end();\r\n  }\r\n\r\n  expect(type, msg) {\r\n    var tok = this.next();\r\n\r\n    if (msg == undefined)\r\n      msg = type\r\n\r\n    if (tok == undefined || tok.type != type) {\r\n      this.error(tok, \"Expected \" + msg + \", not \" + tok.type);\r\n    }\r\n\r\n    return tok.value;\r\n  }\r\n}\r\n\r\nfunction test_parser() {\r\n  var basic_types = new set([\r\n    \"int\",\r\n    \"float\",\r\n    \"double\",\r\n    \"vec2\",\r\n    \"vec3\",\r\n    \"vec4\",\r\n    \"mat4\",\r\n    \"string\"]);\r\n\r\n  var reserved_tokens = new set([\r\n    \"int\",\r\n    \"float\",\r\n    \"double\",\r\n    \"vec2\",\r\n    \"vec3\",\r\n    \"vec4\",\r\n    \"mat4\",\r\n    \"string\",\r\n    \"static_string\",\r\n    \"array\"]);\r\n\r\n  function tk(name, re, func) {\r\n    return new tokdef(name, re, func);\r\n  }\r\n  var tokens = [\r\n    tk(\"ID\", /[a-zA-Z]+[a-zA-Z0-9_]*/, function(t) {\r\n      if (reserved_tokens.has(t.value)) {\r\n        t.type = t.value.toUpperCase();\r\n      }\r\n\r\n      return t;\r\n    }),\r\n    tk(\"OPEN\", /\\{/),\r\n    tk(\"CLOSE\", /}/),\r\n    tk(\"COLON\", /:/),\r\n    tk(\"JSCRIPT\", /\\|/, function(t) {\r\n      var js = \"\"\r\n      var lexer = t.lexer;\r\n      while (lexer.lexpos < lexer.lexdata.length) {\r\n        var c = lexer.lexdata[lexer.lexpos];\r\n        if (c == \"\\n\")\r\n          break;\r\n\r\n        js += c;\r\n        lexer.lexpos++;\r\n      }\r\n\r\n      if (js.endsWith(\";\")) {\r\n        js = js.slice(0, js.length-1);\r\n        lexer.lexpos--;\r\n      }\r\n\r\n      t.value = js;\r\n      return t;\r\n    }),\r\n\r\n    tk(\"LPARAM\", /\\(/),\r\n    tk(\"RPARAM\", /\\)/),\r\n    tk(\"COMMA\", /,/),\r\n    tk(\"NUM\", /[0-9]/),\r\n    tk(\"SEMI\", /;/),\r\n    tk(\"NEWLINE\", /\\n/, function(t) {\r\n      t.lexer.lineno += 1;\r\n    }),\r\n    tk(\"SPACE\", / |\\t/, function(t) {\r\n      //throw out non-newline whitespace tokens\r\n    })\r\n  ];\r\n\r\n  for (var rt in reserved_tokens) {\r\n    tokens.push(tk(rt.toUpperCase()));\r\n  }\r\n\r\n  /*var a =\r\n  Loop {\r\n    eid : int;\r\n    flag : int;\r\n    index : int;\r\n    type : int;\r\n\r\n    co : vec3;\r\n    no : vec3;\r\n    loop : int | eid(loop);\r\n    edges : array(e, int) | e.eid;\r\n\r\n    loops : array(Loop);\r\n  }\r\n  `;\r\n  */\r\n\r\n  function errfunc(lexer) {\r\n    return true; //throw error\r\n  }\r\n\r\n  var lex = new lexer(tokens, errfunc)\r\n  console.log(\"Testing lexical scanner...\")\r\n\r\n  lex.input(a);\r\n\r\n  var tok;\r\n  while (tok = lex.next()) {\r\n    console.log(tok.toString())\r\n  }\r\n\r\n  var parser = new parser(lex);\r\n  parser.input(a);\r\n\r\n  function p_Array(p) {\r\n    p.expect(\"ARRAY\");\r\n    p.expect(\"LPARAM\");\r\n\r\n    var arraytype = p_Type(p);\r\n    var itername = \"\";\r\n\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = arraytype;\r\n      arraytype = p_Type(p);\r\n    }\r\n\r\n\r\n    p.expect(\"RPARAM\");\r\n\r\n    return {type : \"array\", data : {type : arraytype, iname : itername}};\r\n  }\r\n\r\n  function p_Type(p) {\r\n    var tok = p.peek()\r\n\r\n    if (tok.type == \"ID\") {\r\n      p.next();\r\n      return {type : \"struct\", data : \"\\\"\" + tok.value + \"\\\"\"};\r\n    } else if (basic_types.has(tok.type.toLowerCase())) {\r\n      p.next();\r\n      return {type : tok.type.toLowerCase()};\r\n    } else if (tok.type == \"ARRAY\") {\r\n      return p_Array(p);\r\n    } else {\r\n      p.error(tok, \"invalid type \" + tok.type); //(tok.value == \"\" ? tok.type : tok.value));\r\n    }\r\n  }\r\n\r\n  function p_Field(p) {\r\n    var field = {}\r\n\r\n    console.log(\"-----\", p.peek().type);\r\n\r\n    field.name = p.expect(\"ID\", \"struct field name\");\r\n    p.expect(\"COLON\");\r\n\r\n    field.type = p_Type(p);\r\n    field.set = undefined;\r\n    field.get = undefined;\r\n\r\n    var tok = p.peek();\r\n    if (tok.type == \"JSCRIPT\") {\r\n      field.get =  tok.value;\r\n      p.next()\r\n    }\r\n\r\n    tok = p.peek();\r\n    if (tok.type == \"JSCRIPT\") {\r\n      field.set = tok.value;\r\n      p.next();\r\n    }\r\n\r\n    p.expect(\"SEMI\");\r\n\r\n    return field;\r\n  }\r\n\r\n  function p_Struct(p) {\r\n    var st = {}\r\n    st.name = p.expect(\"ID\", \"struct name\")\r\n    st.fields = [];\r\n\r\n    p.expect(\"OPEN\");\r\n\r\n    while (1) {\r\n      if (p.at_end()) {\r\n        p.error(undefined);\r\n      } else if (p.optional(\"CLOSE\")) {\r\n        break;\r\n      } else {\r\n        st.fields.push(p_Field(p));\r\n      }\r\n    }\r\n\r\n    return st;\r\n  }\r\n\r\n  var ret = p_Struct(parser);\r\n\r\n  console.log(JSON.stringify(ret));\r\n}\r\n","import {PropFlags, PropTypes} from '../toolsys/toolprop_abstract.js';\r\nimport {Quat, Vector2, Vector3, Vector4} from '../util/vectormath.js';\r\nimport * as toolprop_abstract from '../toolsys/toolprop_abstract.js';\r\nimport * as toolprop from '../toolsys/toolprop.js';\r\nimport {print_stack, cachering} from '../util/util.js';\r\n\r\nexport const DataFlags = {\r\n  READ_ONLY             : 1,\r\n  USE_CUSTOM_GETSET     : 2,\r\n  USE_FULL_UNDO         : 4, //DataPathSetOp in controller_ops.js saves/loads entire file for undo/redo\r\n  USE_CUSTOM_PROP_GETTER: 8,\r\n};\r\n\r\n\r\nexport const DataTypes = {\r\n  STRUCT        : 0,\r\n  DYNAMIC_STRUCT: 1,\r\n  PROP          : 2,\r\n  ARRAY         : 3\r\n};\r\n\r\nlet propCacheRings = {};\r\n\r\nexport function getTempProp(type) {\r\n  if (!(type in propCacheRings)) {\r\n    propCacheRings[type] = cachering.fromConstructor(ToolProperty.getClass(type), 32);\r\n  }\r\n\r\n  return propCacheRings[type].next();\r\n}\r\n\r\nexport class DataPathError extends Error {\r\n};\r\n\r\n\r\nexport function getVecClass(proptype) {\r\n  switch (proptype) {\r\n    case PropTypes.VEC2:\r\n      return Vector2;\r\n    case PropTypes.VEC3:\r\n      return Vector3;\r\n    case PropTypes.VEC4:\r\n      return Vector4;\r\n    case PropTypes.QUAT:\r\n      return Quat;\r\n    default:\r\n      throw new Error(\"bad prop type \" + proptype);\r\n  }\r\n}\r\n\r\nexport function isVecProperty(prop) {\r\n  if (!prop || typeof prop !== \"object\" || prop === null)\r\n    return false;\r\n\r\n  let ok = false;\r\n\r\n  ok = ok || prop instanceof toolprop_abstract.Vec2PropertyIF;\r\n  ok = ok || prop instanceof toolprop_abstract.Vec3PropertyIF;\r\n  ok = ok || prop instanceof toolprop_abstract.Vec4PropertyIF;\r\n  ok = ok || prop instanceof toolprop.Vec2Property;\r\n  ok = ok || prop instanceof toolprop.Vec3Property;\r\n  ok = ok || prop instanceof toolprop.Vec4Property;\r\n\r\n  ok = ok || prop.type === PropTypes.VEC2;\r\n  ok = ok || prop.type === PropTypes.VEC3;\r\n  ok = ok || prop.type === PropTypes.VEC4;\r\n  ok = ok || prop.type === PropTypes.QUAT;\r\n\r\n  return ok;\r\n}\r\n\r\nexport class DataPath {\r\n  constructor(path, apiname, prop, type = DataTypes.PROP) {\r\n    this.type = type;\r\n    this.data = prop;\r\n    this.apiname = apiname;\r\n    this.path = path;\r\n    this.flag = 0;\r\n    this.struct = undefined;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new DataPath();\r\n\r\n    ret.flag = this.flag;\r\n    ret.type = this.type;\r\n    ret.data = this.data;\r\n    ret.apiname = this.apiname;\r\n    ret.path = this.path;\r\n    ret.struct = this.struct;\r\n\r\n    return ret;\r\n  }\r\n\r\n  /** this property should not be treated as something\r\n   *  that should be kept track off in the undo stack*/\r\n  noUndo() {\r\n    this.data.flag |= PropFlags.NO_UNDO;\r\n    return this;\r\n  }\r\n\r\n  setProp(prop) {\r\n    this.data = prop;\r\n  }\r\n\r\n  readOnly() {\r\n    this.flag |= DataFlags.READ_ONLY;\r\n\r\n    if (this.type === DataTypes.PROP) {\r\n      this.data.flag |= PropFlags.READ_ONLY;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  read_only() {\r\n    console.warn(\"DataPath.read_only is deprecated; use readOnly\");\r\n    return this.readOnly();\r\n  }\r\n\r\n  /** used to override tool property settings,\r\n   *  e.g. ranges, units, etc; returns a\r\n   *  base class instance of ToolProperty.\r\n   *\r\n   *  The this context points to the original ToolProperty and contains\r\n   *  a few useful references:\r\n   *\r\n   *  this.dataref - an object instance of this struct type\r\n   *  this.ctx - a context\r\n   *\r\n   *  callback takes one argument, a new (freshly copied of original)\r\n   *  tool property to modify\r\n   *\r\n   * */\r\n  customPropCallback(callback) {\r\n    this.flag |= DataFlags.USE_CUSTOM_PROP_GETTER;\r\n    this.data.flag |= PropFlags.USE_CUSTOM_PROP_GETTER;\r\n    this.propGetter = callback;\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * For the callbacks 'this' points to an internal ToolProperty;\r\n   * Referencing object lives in 'this.dataref'; calling context in 'this.ctx';\r\n   * and the datapath is 'this.datapath'\r\n   **/\r\n  customGetSet(get, set) {\r\n    this.flag |= DataFlags.USE_CUSTOM_GETSET;\r\n\r\n    if (this.type !== DataTypes.DYNAMIC_STRUCT && this.type !== DataTypes.STRUCT) {\r\n      this.data.flag |= PropFlags.USE_CUSTOM_GETSET;\r\n      this.data._getValue = this.data.getValue;\r\n      this.data._setValue = this.data.setValue;\r\n\r\n      if (get)\r\n        this.data.getValue = get;\r\n\r\n      if (set)\r\n        this.data.setValue = set;\r\n    } else {\r\n      this.getSet = {\r\n        get, set\r\n      };\r\n\r\n      this.getSet.dataref = undefined;\r\n      this.getSet.datapath = undefined;\r\n      this.getSet.ctx = undefined;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  customSet(set) {\r\n    this.customGetSet(undefined, set);\r\n    return this;\r\n  }\r\n\r\n  customGet(get) {\r\n    this.customGetSet(get, undefined);\r\n    return this;\r\n  }\r\n\r\n  /**db will be executed with underlying data object\r\n   that contains this path in 'this.dataref'\r\n\r\n   main event is 'change'\r\n   */\r\n  on(type, cb) {\r\n    if (this.type == DataTypes.PROP) {\r\n      this.data.on(type, cb);\r\n    } else {\r\n      throw new Error(\"invalid call to DataPath.on\");\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  off(type, cb) {\r\n    if (this.type === DataTypes.PROP) {\r\n      this.data.off(type, cb);\r\n    }\r\n  }\r\n\r\n  simpleSlider() {\r\n    this.data.flag |= PropFlags.SIMPLE_SLIDER;\r\n    this.data.flag &= ~PropFlags.FORCE_ROLLER_SLIDER;\r\n    return this;\r\n  }\r\n\r\n  rollerSlider() {\r\n    this.data.flag &= ~PropFlags.SIMPLE_SLIDER;\r\n    this.data.flag |= PropFlags.FORCE_ROLLER_SLIDER;\r\n\r\n    return this;\r\n  }\r\n\r\n  noUnits() {\r\n    this.baseUnit(\"none\");\r\n    this.displayUnit(\"none\");\r\n    return this;\r\n  }\r\n\r\n  baseUnit(unit) {\r\n    this.data.setBaseUnit(unit);\r\n    return this;\r\n  }\r\n\r\n  displayUnit(unit) {\r\n    this.data.setDisplayUnit(unit);\r\n    return this;\r\n  }\r\n\r\n  unit(unit) {\r\n    return this.baseUnit(unit).displayUnit(unit);\r\n  }\r\n\r\n  editAsBaseUnit() {\r\n    this.data.flag |= PropFlags.EDIT_AS_BASE_UNIT;\r\n    return this;\r\n  }\r\n\r\n  range(min, max) {\r\n    this.data.setRange(min, max);\r\n    return this;\r\n  }\r\n\r\n  uiRange(min, max) {\r\n    this.data.setUIRange(min, max);\r\n    return this;\r\n  }\r\n\r\n  decimalPlaces(n) {\r\n    this.data.setDecimalPlaces(n);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * like other callbacks (until I refactor it),\r\n   * func will be called with a mysterious object that stores\r\n   * the following properties:\r\n   *\r\n   * this.dataref  : owning object reference\r\n   * this.datactx  : ctx\r\n   * this.datapath : datapath\r\n   * */\r\n  uiNameGetter(func) {\r\n    this.ui_name_get = func;\r\n    return this;\r\n  }\r\n\r\n  expRate(exp) {\r\n    this.data.setExpRate(exp);\r\n    return this;\r\n  }\r\n\r\n  slideSpeed(speed) {\r\n    this.data.setSlideSpeed(speed);\r\n    return this;\r\n  }\r\n\r\n  /**adds a slider for moving vector component sliders simultaneously*/\r\n  uniformSlider(state = true) {\r\n    this.data.uniformSlider(state);\r\n\r\n    return this;\r\n  }\r\n\r\n  radix(r) {\r\n    this.data.setRadix(r);\r\n    return this;\r\n  }\r\n\r\n  relativeStep(s) {\r\n    this.data.setRelativeStep(s);\r\n    return this;\r\n  }\r\n\r\n  step(s) {\r\n    this.data.setStep(s);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Tell DataPathSetOp to save/load entire app state for undo/redo\r\n   *\r\n   * */\r\n  fullSaveUndo() {\r\n    this.flag |= DataFlags.USE_FULL_UNDO;\r\n    this.data.flag |= PropFlags.USE_BASE_UNDO;\r\n\r\n    return this;\r\n  }\r\n\r\n  icon(i) {\r\n    this.data.setIcon(i);\r\n    return this;\r\n  }\r\n\r\n  icon2(i) {\r\n    this.data.setIcon2(i);\r\n    return this;\r\n  }\r\n\r\n  icons(icons) { //for enum/flag properties\r\n    this.data.addIcons(icons);\r\n    return this;\r\n  }\r\n\r\n  /** secondary icons (e.g. disabled states) */\r\n  icons2(icons) {\r\n    this.data.addIcons2(icons);\r\n    return this;\r\n  }\r\n\r\n  descriptions(description_map) { //for enum/flag properties\r\n    this.data.addDescriptions(description_map);\r\n    return this;\r\n  }\r\n\r\n  uiNames(uinames) {\r\n    this.data.addUINames(uinames);\r\n    return this;\r\n  }\r\n\r\n  description(d) {\r\n    this.data.description = d;\r\n    return this;\r\n  }\r\n}\r\n\r\nexport const StructFlags = {\r\n  NO_UNDO: 1 //struct and its child structs can't participate in undo\r\n             //via the DataPathToolOp\r\n};\r\n\r\nexport class ListIface {\r\n  getStruct(api, list, key) {\r\n\r\n  }\r\n\r\n  get(api, list, key) {\r\n\r\n  }\r\n\r\n  getKey(api, list, obj) {\r\n\r\n  }\r\n\r\n  getActive(api, list) {\r\n\r\n  }\r\n\r\n  setActive(api, list, val) {\r\n\r\n  }\r\n\r\n  set(api, list, key, val) {\r\n    list[key] = val;\r\n  }\r\n\r\n  getIter() {\r\n\r\n  }\r\n\r\n  filter(api, list, filter) {\r\n\r\n  }\r\n}\r\n\r\nexport class ToolOpIface {\r\n  constructor() {\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"!untitled tool\",\r\n      icon       : -1,\r\n      toolpath   : \"logical_module.tool\", //logical_module need not match up to real module name\r\n      description: undefined,\r\n      is_modal   : false,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n};\r\n\r\n\r\nlet DataAPIClass = undefined;\r\n\r\nexport function setImplementationClass(cls) {\r\n  DataAPIClass = cls;\r\n}\r\n\r\nexport function registerTool(cls) {\r\n  if (DataAPIClass === undefined) {\r\n    throw new Error(\"data api not initialized properly; call setImplementationClass\");\r\n  }\r\n\r\n  return DataAPIClass.registerTool(cls);\r\n}\r\n","\"use strict\";\r\nimport nstructjs from '../util/struct.js';\r\n\r\n/**\r\n\r\n ToolOps are base operators for modifying application state.\r\n They operate on Contexts and can use the datapath API.\r\n They make up the undo stack.\r\n\r\n ToolOp subclasses handle undo with their undoPre (run before tool execution)\r\n and undo methods.  You can set default handlers (most commonly this is just\r\n saving/reloading the app state) with setDefaultUndoHandlers.\r\n\r\n ToolOps have inputs and outputs (which are ToolProperties) and can also\r\n be modal.\r\n\r\n ## Rules\r\n\r\n Tools are never, EVER allowed to store direct pointers to the application state,\r\n with one exception: tools in modal mode may store such pointers, but they must\r\n delete them when existing modal mode by overriding modalEnd.\r\n\r\n This is to prevent very evil and difficult to debug bugs in the undo stack\r\n and nasty memory leaks.\r\n\r\n ## Example\r\n\r\n <pre>\r\n\r\n const ExampleEnum = {\r\n  ITEM1 : 0,\r\n  ITEM2 : 1\r\n}\r\n\r\n class MyTool extends ToolOp {\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Tool Name\",\r\n      toolpath   : \"my.tool\",\r\n      inputs     : {\r\n          input1 : new IntProperty(),\r\n          input2 : new EnumProperty(0, ExampleEnum)\r\n      },\r\n      outputs    : {\r\n          someoutput : new IntProperty\r\n      }\r\n    }\r\n  }\r\n\r\n  undoPre(ctx) {\r\n    //run before tool starts\r\n  }\r\n\r\n  undo(ctx) {\r\n    //undo handler\r\n  }\r\n\r\n  execPre(ctx) {\r\n    //run right before exec\r\n  }\r\n  exec(ctx) {\r\n    //main execution method\r\n  }\r\n  execPost(ctx) {\r\n    //run right after exec\r\n  }\r\n}\r\n ToolOp.register(MyTool);\r\n\r\n </pre>\r\n */\r\n\r\nimport * as events from '../util/events.js';\r\nimport {keymap} from '../util/simple_events.js';\r\nimport {PropFlags, PropTypes} from './toolprop.js';\r\nimport {DataPath} from '../controller/controller_base.js';\r\nimport * as util from '../util/util.js';\r\n\r\nexport let ToolClasses = [];\r\nwindow._ToolClasses = ToolClasses;\r\n\r\nexport function setContextClass(cls) {\r\n  console.warn(\"setContextClass is deprecated\");\r\n}\r\n\r\nexport const ToolFlags = {\r\n  PRIVATE: 1\r\n\r\n};\r\n\r\n\r\nexport const UndoFlags = {\r\n  NO_UNDO      : 2,\r\n  IS_UNDO_ROOT : 4,\r\n  UNDO_BARRIER : 8,\r\n  HAS_UNDO_DATA: 16\r\n};\r\n\r\nclass InheritFlag {\r\n  constructor(slots = {}) {\r\n    this.slots = slots;\r\n  }\r\n}\r\n\r\nlet modalstack = [];\r\n\r\nlet defaultUndoHandlers = {\r\n  undoPre(ctx) {\r\n    throw new Error(\"implement me\");\r\n  },\r\n  undo(ctx) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n}\r\n\r\nexport function setDefaultUndoHandlers(undoPre, undo) {\r\n  if (!undoPre || !undo) {\r\n    throw new Error(\"invalid parameters to setDefaultUndoHandlers\");\r\n  }\r\n\r\n  defaultUndoHandlers.undoPre = undoPre;\r\n  defaultUndoHandlers.undo = undo;\r\n}\r\n\r\nexport class ToolPropertyCache {\r\n  constructor() {\r\n    this.map = new Map();\r\n    this.pathmap = new Map();\r\n    this.accessors = {};\r\n\r\n    this.userSetMap = new Set();\r\n\r\n    this.api = undefined;\r\n    this.dstruct = undefined;\r\n  }\r\n\r\n  static getPropKey(cls, key, prop) {\r\n    return prop.apiname && prop.apiname.length > 0 ? prop.apiname : key;\r\n  }\r\n\r\n  _buildAccessors(cls, key, prop, dstruct, api) {\r\n    let tdef = cls._getFinalToolDef();\r\n\r\n    this.api = api;\r\n    this.dstruct = dstruct;\r\n\r\n    if (!tdef.toolpath) {\r\n      console.warn(\"Bad tool property\", cls, \"it's tooldef was missing a toolpath field\");\r\n      return;\r\n    }\r\n\r\n    let path = tdef.toolpath.trim().split(\".\").filter(f => f.trim().length > 0);\r\n    let obj = this.accessors;\r\n\r\n    let st = dstruct;\r\n    let partial = \"\";\r\n\r\n    for (let i = 0; i < path.length; i++) {\r\n      let k = path[i];\r\n      let pathk = k;\r\n\r\n      if (i === 0) {\r\n        pathk = \"accessors.\" + k;\r\n      }\r\n\r\n      if (i > 0) {\r\n        partial += \".\";\r\n      }\r\n      partial += k;\r\n\r\n      if (!(k in obj)) {\r\n        obj[k] = {};\r\n      }\r\n\r\n      let st2 = api.mapStruct(obj[k], true, k);\r\n      if (!(k in st.pathmap)) {\r\n        st.struct(pathk, k, k, st2);\r\n      }\r\n      st = st2;\r\n\r\n      this.pathmap.set(partial, obj[k]);\r\n\r\n      obj = obj[k];\r\n    }\r\n\r\n    let name = prop.apiname !== undefined && prop.apiname.length > 0 ? prop.apiname : key;\r\n    let prop2 = prop.copy()\r\n\r\n    let dpath = new DataPath(name, name, prop2);\r\n    let uiname = prop.uiname;\r\n\r\n    if (!uiname || uiname.trim().length === 0) {\r\n      uiname = prop.apiname;\r\n    }\r\n    if (!uiname || uiname.trim().length === 0) {\r\n      uiname = key;\r\n    }\r\n\r\n    uiname = ToolProperty.makeUIName(uiname);\r\n\r\n    prop2.uiname = uiname;\r\n    prop2.description = prop2.description || prop2.uiname;\r\n\r\n    st.add(dpath);\r\n\r\n    obj[name] = prop2.getValue();\r\n  }\r\n\r\n  _getAccessor(cls) {\r\n    let toolpath = cls.tooldef().toolpath.trim();\r\n    return this.pathmap.get(toolpath);\r\n  }\r\n\r\n  useDefault(cls, key, prop) {\r\n    key = this.userSetMap.has(cls.tooldef().trim() + \".\" + this.constructor.getPropKey(key));\r\n    key = key.trim();\r\n\r\n    return key;\r\n  }\r\n\r\n  has(cls, key, prop) {\r\n    let obj = this._getAccessor(cls);\r\n\r\n    key = this.constructor.getPropKey(cls, key, prop);\r\n    return obj && key in obj;\r\n  }\r\n\r\n  get(cls, key, prop) {\r\n    if (cls === ToolMacro) {\r\n      return;\r\n    }\r\n\r\n    let obj = this._getAccessor(cls);\r\n    key = this.constructor.getPropKey(cls, key, prop);\r\n\r\n    if (obj) {\r\n      return obj[key];\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  set(cls, key, prop) {\r\n    if (cls === ToolMacro) {\r\n      return;\r\n    }\r\n\r\n    let toolpath = cls.tooldef().toolpath.trim();\r\n    let obj = this._getAccessor(cls);\r\n\r\n    if (!obj) {\r\n      console.warn(\"Warning, toolop \" + cls.name + \" was not in the default map; unregistered?\");\r\n      this._buildAccessors(cls, key, prop, this.dstruct, this.api);\r\n\r\n      obj = this.pathmap.get(toolpath);\r\n    }\r\n\r\n    if (!obj) {\r\n      console.error(\"Malformed toolpath in toolop definition: \" + toolpath);\r\n      return;\r\n    }\r\n\r\n    key = this.constructor.getPropKey(cls, key, prop);\r\n\r\n    //copy prop first in case we're a non-primitive-value type, e.g. vector properties\r\n    obj[key] = prop.copy().getValue();\r\n\r\n    let path = toolpath + \".\" + key;\r\n    this.userSetMap.add(path);\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nexport const SavedToolDefaults = new ToolPropertyCache();\r\n\r\nexport class ToolOp extends events.EventHandler {\r\n  /**\r\n   Main ToolOp constructor.  It reads the inputs/outputs properteis from\r\n   this.constructor.tooldef() and copies them to build this.inputs and this.outputs.\r\n   If inputs or outputs are wrapped in ToolOp.inherit(), it will walk up the class\r\n   chain to fetch parent class properties.\r\n\r\n\r\n   Default input values are loaded from SavedToolDefaults.  If initialized (buildToolSysAPI\r\n   has been called) SavedToolDefaults will have a copy of all the default\r\n   property values of all registered ToolOps.\r\n   **/\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this._overdraw = undefined;\r\n    this.__memsize = undefined;\r\n\r\n    var def = this.constructor.tooldef();\r\n\r\n    if (def.undoflag !== undefined) {\r\n      this.undoflag = def.undoflag;\r\n    }\r\n\r\n    if (def.flag !== undefined) {\r\n      this.flag = def.flag;\r\n    }\r\n\r\n    this._accept = this._reject = undefined;\r\n    this._promise = undefined;\r\n\r\n    for (var k in def) {\r\n      this[k] = def[k];\r\n    }\r\n\r\n    let getSlots = (slots, key) => {\r\n      if (slots === undefined)\r\n        return {};\r\n\r\n      if (!(slots instanceof InheritFlag)) {\r\n        return slots;\r\n      }\r\n\r\n      slots = {};\r\n      let p = this.constructor;\r\n      let lastp = undefined;\r\n\r\n      while (p !== undefined && p !== Object && p !== ToolOp && p !== lastp) {\r\n        if (p.tooldef) {\r\n          let def = p.tooldef();\r\n\r\n          if (def[key] !== undefined) {\r\n            let slots2 = def[key];\r\n            let stop = !(slots2 instanceof InheritFlag);\r\n\r\n            if (slots2 instanceof InheritFlag) {\r\n              slots2 = slots2.slots;\r\n            }\r\n\r\n            for (let k in slots2) {\r\n              if (!(k in slots)) {\r\n                slots[k] = slots2[k];\r\n              }\r\n            }\r\n\r\n            if (stop) {\r\n              break;\r\n            }\r\n          }\r\n        }\r\n\r\n        lastp = p;\r\n        p = p.prototype.__proto__.constructor;\r\n      }\r\n\r\n      return slots;\r\n    };\r\n\r\n    let dinputs = getSlots(def.inputs, \"inputs\");\r\n    let doutputs = getSlots(def.outputs, \"outputs\");\r\n\r\n    this.inputs = {};\r\n    this.outputs = {};\r\n\r\n    if (dinputs) {\r\n      for (let k in dinputs) {\r\n        let prop = dinputs[k].copy();\r\n        prop.apiname = prop.apiname && prop.apiname.length > 0 ? prop.apiname : k;\r\n\r\n        if (!this.hasDefault(prop, k)) {\r\n          this.inputs[k] = prop;\r\n          continue;\r\n        }\r\n\r\n        try {\r\n          prop.setValue(this.getDefault(prop, k));\r\n        } catch (error) {\r\n          console.log(error.stack);\r\n          console.log(error.message);\r\n        }\r\n\r\n        prop.wasSet = false;\r\n        this.inputs[k] = prop;\r\n      }\r\n    }\r\n\r\n    if (doutputs) {\r\n      for (let k in doutputs) {\r\n        let prop = doutputs[k].copy();\r\n        prop.apiname = prop.apiname && prop.apiname.length > 0 ? prop.apiname : k;\r\n\r\n        this.outputs[k] = prop;\r\n      }\r\n    }\r\n\r\n    this.drawlines = [];\r\n  }\r\n\r\n  /**\r\n   ToolOp definition.\r\n\r\n   An example:\r\n   <pre>\r\n   static tooldef() {\r\n    return {\r\n      uiname   : \"Tool Name\",\r\n      toolpath : \"logical_module.tool\", //logical_module need not match up to a real module\r\n      icon     : -1, //tool's icon, or -1 if there is none\r\n      description : \"tooltip\",\r\n      is_modal : false, //tool is interactive and takes control of events\r\n      hotkey   : undefined,\r\n      undoflag : 0, //see UndoFlags\r\n      flag     : 0,\r\n      inputs   : ToolOp.inherit({\r\n        f32val : new Float32Property(1.0),\r\n        path   : new StringProperty(\"./path\");\r\n      }),\r\n      outputs  : {}\r\n      }\r\n    }\r\n   </pre>\r\n   */\r\n  static tooldef() {\r\n    if (this === ToolOp) {\r\n      throw new Error(\"Tools must implemented static tooldef() methods!\");\r\n    }\r\n\r\n    return {};\r\n  }\r\n\r\n  /** Returns a read-only map of input property values,\r\n   *  e.g. `let {prop1, prop2} = this.getValues()` */\r\n  getInputs() {\r\n    let ret = {};\r\n\r\n    for (let k in this.inputs) {\r\n      ret[k] = this.inputs[k].getValue();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  static Equals(a, b) {\r\n    if (!a || !b) return false;\r\n    if (a.constructor !== b.constructor) return false;\r\n\r\n    let bad = false;\r\n\r\n    for (let k in a.inputs) {\r\n      bad = bad || !(k in b.inputs);\r\n      bad = bad || a.inputs[k].constructor !== b.inputs[k];\r\n      bad = bad || !a.inputs[k].equals(b.inputs[k]);\r\n\r\n      if (bad) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return !bad;\r\n  }\r\n\r\n  static inherit(slots = {}) {\r\n    return new InheritFlag(slots);\r\n  }\r\n\r\n  /**\r\n\r\n   Creates a new instance of this toolop from args and a context.\r\n   This is often use to fill properties with default arguments\r\n   stored somewhere in the context.\r\n\r\n   */\r\n  static invoke(ctx, args) {\r\n    let tool = new this();\r\n\r\n    for (let k in args) {\r\n      if (!(k in tool.inputs)) {\r\n        console.warn(\"Unknown tool argument \" + k);\r\n        continue;\r\n      }\r\n\r\n      let prop = tool.inputs[k];\r\n      let val = args[k];\r\n\r\n      if ((typeof val === \"string\") && prop.type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n        if (val in prop.values) {\r\n          val = prop.values[val];\r\n        } else {\r\n          console.warn(\"Possible invalid enum/flag:\", val);\r\n          continue;\r\n        }\r\n      }\r\n\r\n      tool.inputs[k].setValue(val);\r\n    }\r\n\r\n    return tool;\r\n  }\r\n\r\n  static register(cls) {\r\n    if (ToolClasses.indexOf(cls) >= 0) {\r\n      console.warn(\"Tried to register same ToolOp class twice:\", cls.name, cls);\r\n      return;\r\n    }\r\n\r\n    ToolClasses.push(cls);\r\n  }\r\n\r\n  static _regWithNstructjs(cls, structName = cls.name) {\r\n    if (nstructjs.isRegistered(cls)) {\r\n      return;\r\n    }\r\n\r\n    let parent = cls.prototype.__proto__.constructor;\r\n\r\n    if (!cls.hasOwnProperty(\"STRUCT\")) {\r\n      if (parent !== ToolOp && parent !== ToolMacro && parent !== Object) {\r\n        this._regWithNstructjs(parent);\r\n      }\r\n\r\n      cls.STRUCT = nstructjs.inherit(cls, parent) + '}\\n';\r\n    }\r\n\r\n    nstructjs.register(cls);\r\n  }\r\n\r\n  static isRegistered(cls) {\r\n    return ToolClasses.indexOf(cls) >= 0;\r\n  }\r\n\r\n  static unregister(cls) {\r\n    if (ToolClasses.indexOf(cls) >= 0) {\r\n      ToolClasses.remove(cls);\r\n    }\r\n  }\r\n\r\n  static _getFinalToolDef() {\r\n    let def = this.tooldef();\r\n\r\n    let getSlots = (slots, key) => {\r\n      if (slots === undefined)\r\n        return {};\r\n\r\n      if (!(slots instanceof InheritFlag)) {\r\n        return slots;\r\n      }\r\n\r\n      slots = {};\r\n      let p = this\r\n\r\n      while (p !== undefined && p !== Object && p !== ToolOp) {\r\n        if (p.tooldef) {\r\n          let def = p.tooldef();\r\n\r\n          if (def[key] !== undefined) {\r\n            let slots2 = def[key];\r\n            let stop = !(slots2 instanceof InheritFlag);\r\n\r\n            if (slots2 instanceof InheritFlag) {\r\n              slots2 = slots2.slots;\r\n            }\r\n\r\n            for (let k in slots2) {\r\n              if (!(k in slots)) {\r\n                slots[k] = slots2[k];\r\n              }\r\n            }\r\n\r\n            if (stop) {\r\n              break;\r\n            }\r\n          }\r\n\r\n        }\r\n        p = p.prototype.__proto__.constructor;\r\n      }\r\n\r\n      return slots;\r\n    };\r\n\r\n    let dinputs = getSlots(def.inputs, \"inputs\");\r\n    let doutputs = getSlots(def.outputs, \"outputs\");\r\n\r\n    def.inputs = dinputs;\r\n    def.outputs = doutputs;\r\n\r\n    return def;\r\n  }\r\n\r\n  static onTick() {\r\n    for (let toolop of modalstack) {\r\n      toolop.on_tick();\r\n    }\r\n  }\r\n\r\n  static searchBoxOk(ctx) {\r\n    let flag = this.tooldef().flag;\r\n    let ret = !(flag && (flag & ToolFlags.PRIVATE));\r\n    ret = ret && this.canRun(ctx);\r\n\r\n    return ret;\r\n  }\r\n\r\n  //toolop is an optional instance of this class, may be undefined\r\n  static canRun(ctx, toolop = undefined) {\r\n    return true;\r\n  }\r\n\r\n  /** Called when the undo system needs to destroy\r\n   *  this toolop to save memory*/\r\n  onUndoDestroy() {\r\n\r\n  }\r\n\r\n  /** Used by undo system to limit memory */\r\n  calcMemSize(ctx) {\r\n    if (this.__memsize !== undefined) {\r\n      return this.__memsize;\r\n    }\r\n\r\n    let tot = 0;\r\n\r\n    for (let step = 0; step < 2; step++) {\r\n      let props = step ? this.outputs : this.inputs;\r\n\r\n      for (let k in props) {\r\n        let prop = props[k];\r\n\r\n        let size = prop.calcMemSize();\r\n\r\n        if (isNaN(size) || !isFinite(size)) {\r\n          console.warn(\"Got NaN when calculating mem size for property\", prop);\r\n          continue;\r\n        }\r\n\r\n        tot += size;\r\n      }\r\n    }\r\n\r\n    let size = this.calcUndoMem(ctx);\r\n\r\n    if (isNaN(size) || !isFinite(size)) {\r\n      console.warn(\"Got NaN in calcMemSize\", this);\r\n    } else {\r\n      tot += size;\r\n    }\r\n\r\n    this.__memsize = tot;\r\n\r\n    return tot;\r\n  }\r\n\r\n  loadDefaults(force = true) {\r\n    for (let k in this.inputs) {\r\n      let prop = this.inputs[k];\r\n\r\n      if (!force && prop.wasSet) {\r\n        continue;\r\n      }\r\n\r\n      if (this.hasDefault(prop, k)) {\r\n        prop.setValue(this.getDefault(prop, k));\r\n        prop.wasSet = false;\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  hasDefault(toolprop, key = toolprop.apiname) {\r\n    return SavedToolDefaults.has(this.constructor, key, toolprop);\r\n  }\r\n\r\n  getDefault(toolprop, key = toolprop.apiname) {\r\n    let cls = this.constructor;\r\n\r\n    if (SavedToolDefaults.has(cls, key, toolprop)) {\r\n      return SavedToolDefaults.get(cls, key, toolprop);\r\n    } else {\r\n      return toolprop.getValue();\r\n    }\r\n  }\r\n\r\n  saveDefaultInputs() {\r\n    for (let k in this.inputs) {\r\n      let prop = this.inputs[k];\r\n\r\n      if (prop.flag & PropFlags.SAVE_LAST_VALUE) {\r\n        SavedToolDefaults.set(this.constructor, k, prop);\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  genToolString() {\r\n    let def = this.constructor.tooldef();\r\n    let path = def.toolpath + \"(\";\r\n\r\n    for (let k in this.inputs) {\r\n      let prop = this.inputs[k];\r\n\r\n      path += k + \"=\";\r\n      if (prop.type === PropTypes.STRING)\r\n        path += \"'\";\r\n\r\n      if (prop.type === PropTypes.FLOAT) {\r\n        path += prop.getValue().toFixed(3);\r\n      } else {\r\n        path += prop.getValue();\r\n      }\r\n\r\n      if (prop.type === PropTypes.STRING)\r\n        path += \"'\";\r\n      path += \" \";\r\n    }\r\n    path += \")\";\r\n    return path;\r\n  }\r\n\r\n  on_tick() {\r\n\r\n  }\r\n\r\n  /**default on_keydown implementation for modal tools,\r\n   no need to call super() to execute this if you don't want to*/\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case keymap[\"Enter\"]:\r\n      case keymap[\"Space\"]:\r\n        this.modalEnd(false);\r\n        break;\r\n      case keymap[\"Escape\"]:\r\n        this.modalEnd(true);\r\n        break;\r\n    }\r\n  }\r\n\r\n  //called after undoPre\r\n  calcUndoMem(ctx) {\r\n    console.warn(\"ToolOp.prototype.calcUndoMem: implement me!\");\r\n    return 0;\r\n  }\r\n\r\n  undoPre(ctx) {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  undo(ctx) {\r\n    throw new Error(\"implement me!\");\r\n    //_appstate.loadUndoFile(this._undo);\r\n  }\r\n\r\n  redo(ctx) {\r\n    this._was_redo = true; //also set by toolstack.redo\r\n\r\n    this.undoPre(ctx);\r\n    this.execPre(ctx);\r\n    this.exec(ctx);\r\n    this.execPost(ctx);\r\n  }\r\n\r\n  //for compatibility with fairmotion\r\n  exec_pre(ctx) {\r\n    this.execPre(ctx);\r\n  }\r\n\r\n  execPre(ctx) {\r\n  }\r\n\r\n  exec(ctx) {\r\n  }\r\n\r\n  execPost(ctx) {\r\n\r\n  }\r\n\r\n  /**for use in modal mode only*/\r\n  resetTempGeom() {\r\n    var ctx = this.modal_ctx;\r\n\r\n    for (var dl of this.drawlines) {\r\n      dl.remove();\r\n    }\r\n\r\n    this.drawlines.length = 0;\r\n  }\r\n\r\n  error(msg) {\r\n    console.warn(msg);\r\n  }\r\n\r\n  getOverdraw() {\r\n    if (this._overdraw === undefined) {\r\n      this._overdraw = document.createElement(\"overdraw-x\");\r\n      this._overdraw.start(this.modal_ctx.screen);\r\n    }\r\n\r\n    return this._overdraw;\r\n  }\r\n\r\n  /**for use in modal mode only*/\r\n  makeTempLine(v1, v2, style) {\r\n    let line = this.getOverdraw().line(v1, v2, style);\r\n    this.drawlines.push(line);\r\n    return line;\r\n  }\r\n\r\n  pushModal(node) {\r\n    throw new Error(\"cannot call this; use modalStart\")\r\n  }\r\n\r\n  popModal() {\r\n    throw new Error(\"cannot call this; use modalEnd\");\r\n  }\r\n\r\n  /**returns promise to be executed on modalEnd*/\r\n  modalStart(ctx) {\r\n    if (this.modalRunning) {\r\n      console.warn(\"Warning, tool is already in modal mode consuming events\");\r\n      return this._promise;\r\n    }\r\n\r\n    this.modal_ctx = ctx;\r\n    this.modalRunning = true\r\n\r\n    this._promise = new Promise((accept, reject) => {\r\n      this._accept = accept;\r\n      this._reject = reject;\r\n\r\n      modalstack.push(this);\r\n      super.pushModal(ctx.screen);\r\n    });\r\n\r\n    return this._promise;\r\n  }\r\n\r\n  /*eek, I've not been using this.\r\n    guess it's a non-enforced contract, I've been naming\r\n    cancel methods 'cancel' all this time.\r\n\r\n    XXX fix\r\n  */\r\n  toolCancel() {\r\n  }\r\n\r\n  modalEnd(was_cancelled) {\r\n    if (this._modalstate) {\r\n      modalstack.pop();\r\n    }\r\n\r\n    if (this._overdraw !== undefined) {\r\n      this._overdraw.end();\r\n      this._overdraw = undefined;\r\n    }\r\n\r\n    if (was_cancelled && this._on_cancel !== undefined) {\r\n      if (this._accept) {\r\n        this._accept(this.modal_ctx, true);\r\n      }\r\n      this._on_cancel(this);\r\n    }\r\n\r\n    this.resetTempGeom();\r\n\r\n    var ctx = this.modal_ctx;\r\n\r\n    this.modal_ctx = undefined;\r\n    this.modalRunning = false;\r\n    this.is_modal = false;\r\n\r\n    super.popModal();\r\n\r\n    this._promise = undefined;\r\n\r\n    if (this._accept) {\r\n      this._accept(ctx, false);//Context, was_cancelled\r\n      this._accept = this._reject = undefined;\r\n    }\r\n\r\n    this.saveDefaultInputs();\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    let outs = this.outputs;\r\n    let ins = this.inputs;\r\n\r\n    this.inputs = {};\r\n    this.outputs = {};\r\n\r\n    for (let pair of ins) {\r\n      this.inputs[pair.key] = pair.val;\r\n    }\r\n\r\n    for (let pair of outs) {\r\n      this.outputs[pair.key] = pair.val;\r\n    }\r\n  }\r\n\r\n  _save_inputs() {\r\n    let ret = [];\r\n    for (let k in this.inputs) {\r\n      ret.push(new PropKey(k, this.inputs[k]));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  _save_outputs() {\r\n    let ret = [];\r\n    for (let k in this.outputs) {\r\n      ret.push(new PropKey(k, this.outputs[k]));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nToolOp.STRUCT = `\r\ntoolsys.ToolOp {\r\n  inputs  : array(toolsys.PropKey) | this._save_inputs();\r\n  outputs : array(toolsys.PropKey) | this._save_outputs();\r\n}\r\n`;\r\nnstructjs.register(ToolOp);\r\n\r\nclass PropKey {\r\n  constructor(key, val) {\r\n    this.key = key;\r\n    this.val = val;\r\n  }\r\n}\r\n\r\nPropKey.STRUCT = `\r\ntoolsys.PropKey {\r\n  key : string;\r\n  val : abstract(ToolProperty);\r\n}\r\n`;\r\nnstructjs.register(PropKey);\r\n\r\nexport class MacroLink {\r\n  constructor(sourcetool_idx, srckey, srcprops = \"outputs\", desttool_idx, dstkey, dstprops = \"inputs\") {\r\n    this.source = sourcetool_idx;\r\n    this.dest = desttool_idx;\r\n\r\n    this.sourceProps = srcprops;\r\n    this.destProps = dstprops;\r\n\r\n    this.sourcePropKey = srckey;\r\n    this.destPropKey = dstkey;\r\n  }\r\n}\r\n\r\nMacroLink.STRUCT = `\r\ntoolsys.MacroLink {\r\n  source         : int;\r\n  dest           : int;\r\n  sourcePropKey  : string;\r\n  destPropKey    : string;\r\n  sourceProps    : string;\r\n  destProps      : string; \r\n}\r\n`;\r\nnstructjs.register(MacroLink);\r\n\r\nexport const MacroClasses = {};\r\nwindow._MacroClasses = MacroClasses;\r\n\r\nlet macroidgen = 0;\r\n\r\n\r\nexport class ToolMacro extends ToolOp {\r\n  constructor() {\r\n    super();\r\n\r\n    this.tools = [];\r\n    this.curtool = 0;\r\n    this.has_modal = false;\r\n    this.connects = [];\r\n    this.connectLinks = [];\r\n\r\n    this._macro_class = undefined;\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname: \"Tool Macro\"\r\n    }\r\n  }\r\n\r\n  //toolop is an optional instance of this class, may be undefined\r\n  static canRun(ctx, toolop = undefined) {\r\n    return true;\r\n  }\r\n\r\n  _getTypeClass() {\r\n    if (this._macro_class && this._macro_class.ready) {\r\n      return this._macro_class;\r\n    }\r\n\r\n    if (!this._macro_class) {\r\n      this._macro_class = class MacroTypeClass extends ToolOp {\r\n        static tooldef() {\r\n          return this.__tooldef;\r\n        }\r\n      }\r\n\r\n      this._macro_class.__tooldef = {\r\n        toolpath: this.constructor.tooldef().toolpath || ''\r\n      };\r\n      this._macro_class.ready = false;\r\n    }\r\n\r\n    if (!this.tools || this.tools.length === 0) {\r\n      /* We've been invoked by ToolOp constructor,\r\n      *  for now just return an empty class  */\r\n      return this._macro_class;\r\n    }\r\n\r\n    let key = \"\";\r\n    for (let tool of this.tools) {\r\n      key = tool.constructor.name + \":\";\r\n    }\r\n\r\n    /* Handle child classes of ToolMacro */\r\n    if (this.constructor !== ToolMacro) {\r\n      key += \":\" + this.constructor.tooldef().toolpath;\r\n    }\r\n\r\n    for (let k in this.inputs) {\r\n      key += k + \":\";\r\n    }\r\n\r\n    if (key in MacroClasses) {\r\n      this._macro_class = MacroClasses[key];\r\n      return this._macro_class;\r\n    }\r\n\r\n    let name = \"Macro(\"\r\n    let i = 0;\r\n    let is_modal;\r\n\r\n    for (let tool of this.tools) {\r\n      let def = tool.constructor.tooldef();\r\n\r\n      if (i > 0) {\r\n        name += \", \";\r\n      } else {\r\n        is_modal = def.is_modal;\r\n      }\r\n\r\n      if (def.uiname) {\r\n        name += def.uiname;\r\n      } else if (def.toolpath) {\r\n        name += def.toolpath;\r\n      } else {\r\n        name += tool.constructor.name;\r\n      }\r\n\r\n      i++;\r\n    }\r\n\r\n    let inputs = {};\r\n\r\n    for (let k in this.inputs) {\r\n      inputs[k] = this.inputs[k].copy().clearEventCallbacks();\r\n      inputs[k].wasSet = false;\r\n    }\r\n\r\n    let tdef = {\r\n      uiname  : name,\r\n      toolpath: key,\r\n      inputs,\r\n      outputs : {},\r\n      is_modal\r\n    };\r\n\r\n    let cls = this._macro_class;\r\n    cls.__tooldef = tdef;\r\n    cls._macroTypeId = macroidgen++;\r\n    cls.ready = true;\r\n\r\n    /*\r\n    let cls = {\r\n      name : key,\r\n      tooldef() {\r\n        return tdef\r\n      },\r\n      _getFinalToolDef() {\r\n        return this.tooldef();\r\n      }\r\n    };//*/\r\n\r\n    MacroClasses[key] = cls;\r\n\r\n    return cls;\r\n  }\r\n\r\n  saveDefaultInputs() {\r\n    for (let k in this.inputs) {\r\n      let prop = this.inputs[k];\r\n\r\n      if (prop.flag & PropFlags.SAVE_LAST_VALUE) {\r\n        SavedToolDefaults.set(this._getTypeClass(), k, prop);\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  hasDefault(toolprop, key = toolprop.apiname) {\r\n    return SavedToolDefaults.has(this._getTypeClass(), key, toolprop);\r\n  }\r\n\r\n  getDefault(toolprop, key = toolprop.apiname) {\r\n    let cls = this._getTypeClass();\r\n\r\n    if (SavedToolDefaults.has(cls, key, toolprop)) {\r\n      return SavedToolDefaults.get(cls, key, toolprop);\r\n    } else {\r\n      return toolprop.getValue();\r\n    }\r\n  }\r\n\r\n  connect(srctool, srcoutput, dsttool, dstinput, srcprops = \"outputs\", dstprops = \"inputs\") {\r\n    if (typeof dsttool === \"function\") {\r\n      return this.connectCB(...arguments);\r\n    }\r\n\r\n    let i1 = this.tools.indexOf(srctool);\r\n    let i2 = this.tools.indexOf(dsttool);\r\n\r\n    if (i1 < 0 || i2 < 0) {\r\n      throw new Error(\"tool not in macro\");\r\n    }\r\n\r\n    //remove linked properties from this.inputs\r\n    if (srcprops === \"inputs\") {\r\n      let tool = this.tools[i1];\r\n\r\n      let prop = tool.inputs[srcoutput];\r\n      if (prop === this.inputs[srcoutput]) {\r\n        delete this.inputs[srcoutput];\r\n      }\r\n    }\r\n\r\n    if (dstprops === \"inputs\") {\r\n      let tool = this.tools[i2];\r\n      let prop = tool.inputs[dstinput];\r\n\r\n      if (this.inputs[dstinput] === prop) {\r\n        delete this.inputs[dstinput];\r\n      }\r\n    }\r\n\r\n    this.connectLinks.push(new MacroLink(i1, srcoutput, srcprops, i2, dstinput, dstprops));\r\n    return this;\r\n  }\r\n\r\n  connectCB(srctool, dsttool, callback, thisvar) {\r\n    this.connects.push({\r\n      srctool : srctool,\r\n      dsttool : dsttool,\r\n      callback: callback,\r\n      thisvar : thisvar\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  add(tool) {\r\n    if (tool.is_modal) {\r\n      this.is_modal = true;\r\n    }\r\n\r\n    for (let k in tool.inputs) {\r\n      let prop = tool.inputs[k];\r\n\r\n      if (!(prop.flag & PropFlags.PRIVATE)) {\r\n        this.inputs[k] = prop;\r\n      }\r\n    }\r\n\r\n    this.tools.push(tool);\r\n\r\n    return this;\r\n  }\r\n\r\n  _do_connections(tool) {\r\n    let i = this.tools.indexOf(tool);\r\n\r\n    for (let c of this.connectLinks) {\r\n      if (c.source === i) {\r\n        let tool2 = this.tools[c.dest];\r\n\r\n        tool2[c.destProps][c.destPropKey].setValue(tool[c.sourceProps][c.sourcePropKey].getValue());\r\n      }\r\n    }\r\n\r\n    for (var c of this.connects) {\r\n      if (c.srctool === tool) {\r\n        c.callback.call(c.thisvar, c.srctool, c.dsttool);\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n  canRun(ctx) {\r\n    if (this.tools.length == 0)\r\n      return false;\r\n\r\n    //poll first tool only in list\r\n    return this.tools[0].constructor.canRun(ctx);\r\n  }//*/\r\n\r\n  modalStart(ctx) {\r\n    //macros obviously can't call loadDefaults in the constructor\r\n    //like normal tool ops can.\r\n    this.loadDefaults(false);\r\n\r\n    this._promise = new Promise((function (accept, reject) {\r\n      this._accept = accept;\r\n      this._reject = reject;\r\n    }).bind(this));\r\n\r\n    this.curtool = 0;\r\n\r\n    let i;\r\n\r\n    for (i = 0; i < this.tools.length; i++) {\r\n      if (this.tools[i].is_modal)\r\n        break;\r\n\r\n      this.tools[i].undoPre(ctx);\r\n      this.tools[i].execPre(ctx);\r\n      this.tools[i].exec(ctx);\r\n      this.tools[i].execPost(ctx);\r\n      this._do_connections(this.tools[i]);\r\n    }\r\n\r\n    var on_modal_end = (function on_modal_end() {\r\n      this._do_connections(this.tools[this.curtool]);\r\n      this.curtool++;\r\n\r\n      while (this.curtool < this.tools.length &&\r\n      !this.tools[this.curtool].is_modal) {\r\n        this.tools[this.curtool].undoPre(ctx);\r\n        this.tools[this.curtool].execPre(ctx);\r\n        this.tools[this.curtool].exec(ctx);\r\n        this.tools[this.curtool].execPost(ctx);\r\n        this._do_connections(this.tools[this.curtool]);\r\n\r\n        this.curtool++;\r\n      }\r\n\r\n      if (this.curtool < this.tools.length) {\r\n        this.tools[this.curtool].undoPre(ctx);\r\n        this.tools[this.curtool].modalStart(ctx).then(on_modal_end);\r\n      } else {\r\n        this._accept(this, false);\r\n      }\r\n    }).bind(this);\r\n\r\n    if (i < this.tools.length) {\r\n      this.curtool = i;\r\n      this.tools[this.curtool].undoPre(ctx);\r\n      this.tools[this.curtool].modalStart(ctx).then(on_modal_end);\r\n    }\r\n\r\n    return this._promise;\r\n  }\r\n\r\n  loadDefaults(force = true) {\r\n    return super.loadDefaults(force);\r\n  }\r\n\r\n  exec(ctx) {\r\n    //macros obviously can't call loadDefaults in the constructor\r\n    //like normal tool ops can.\r\n    //note that this will detect if the user changes property values\r\n\r\n    this.loadDefaults(false);\r\n\r\n    for (var i = 0; i < this.tools.length; i++) {\r\n      this.tools[i].undoPre(ctx);\r\n      this.tools[i].execPre(ctx);\r\n      this.tools[i].exec(ctx);\r\n      this.tools[i].execPost(ctx);\r\n      this._do_connections(this.tools[i]);\r\n    }\r\n  }\r\n\r\n  calcUndoMem(ctx) {\r\n    let tot = 0;\r\n\r\n    for (let tool of this.tools) {\r\n      tot += tool.calcUndoMem(ctx);\r\n    }\r\n\r\n    return tot;\r\n  }\r\n\r\n  calcMemSize(ctx) {\r\n    let tot = 0;\r\n\r\n    for (let tool of this.tools) {\r\n      tot += tool.calcMemSize(ctx);\r\n    }\r\n\r\n    return tot;\r\n  }\r\n\r\n  undoPre() {\r\n    return; //undoPre is handled in exec() or modalStart()\r\n  }\r\n\r\n  undo(ctx) {\r\n    for (var i = this.tools.length - 1; i >= 0; i--) {\r\n      this.tools[i].undo(ctx);\r\n    }\r\n  }\r\n}\r\n\r\nToolMacro.STRUCT = nstructjs.inherit(ToolMacro, ToolOp, \"toolsys.ToolMacro\") + `\r\n  tools        : array(abstract(toolsys.ToolOp));\r\n  connectLinks : array(toolsys.MacroLink);\r\n}\r\n`;\r\nnstructjs.register(ToolMacro);\r\n\r\nexport class ToolStack extends Array {\r\n  constructor(ctx) {\r\n    super();\r\n\r\n    this.memLimit = 512*1024*1024;\r\n    this.enforceMemLimit = false;\r\n\r\n    this.cur = -1;\r\n    this.ctx = ctx;\r\n\r\n    this.modalRunning = 0;\r\n\r\n    this._undo_branch = undefined; //used to save undo branch in case of tool cancel\r\n  }\r\n\r\n  get head() {\r\n    return this[this.cur];\r\n  }\r\n\r\n  limitMemory(maxmem = this.memLimit, ctx = this.ctx) {\r\n    if (maxmem === undefined) {\r\n      throw new Error(\"maxmem cannot be undefined\");\r\n    }\r\n\r\n    let size = this.calcMemSize();\r\n\r\n    let start = 0;\r\n\r\n    while (start < this.cur - 2 && size > maxmem) {\r\n      size -= this[start].calcMemSize(ctx);\r\n      start++;\r\n    }\r\n\r\n    if (start === 0) {\r\n      return size;\r\n    }\r\n\r\n    for (let i = 0; i < start; i++) {\r\n      this[i].onUndoDestroy();\r\n    }\r\n\r\n    this.cur -= start;\r\n\r\n    for (let i = 0; i < this.length - start; i++) {\r\n      this[i] = this[i + start];\r\n    }\r\n    this.length -= start;\r\n\r\n    return this.calcMemSize(ctx);\r\n  }\r\n\r\n  calcMemSize(ctx = this.ctx) {\r\n    let tot = 0;\r\n\r\n    for (let tool of this) {\r\n      try {\r\n        tot += tool.calcMemSize();\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        console.error(\"Failed to execute a calcMemSize method\");\r\n      }\r\n    }\r\n\r\n    return tot;\r\n  }\r\n\r\n  setRestrictedToolContext(ctx) {\r\n    this.toolctx = ctx;\r\n  }\r\n\r\n  reset(ctx) {\r\n    if (ctx !== undefined) {\r\n      this.ctx = ctx;\r\n    }\r\n\r\n    this.modalRunning = 0;\r\n    this.cur = -1;\r\n    this.length = 0;\r\n  }\r\n\r\n  /**\r\n   * runs .undo,.redo if toolstack head is same as tool\r\n   *\r\n   * otherwise, .execTool(ctx, tool) is called.\r\n   *\r\n   * @param compareInputs : check if toolstack head has identical input values, defaults to false\r\n   * */\r\n  execOrRedo(ctx, tool, compareInputs = false) {\r\n    let head = this.head;\r\n\r\n    let ok = compareInputs ? ToolOp.Equals(head, tool) : head && head.constructor === tool.constructor;\r\n\r\n    tool.__memsize = undefined; //reset cache memsize\r\n\r\n    if (ok) {\r\n      //console.warn(\"Same tool detected\");\r\n\r\n      this.undo();\r\n\r\n      //can inputs differ? in that case, execute new tool\r\n      if (!compareInputs) {\r\n        this.execTool(ctx, tool);\r\n      } else {\r\n        this.rerun();\r\n      }\r\n\r\n      return false;\r\n    } else {\r\n      this.execTool(ctx, tool);\r\n      return true;\r\n    }\r\n  }\r\n\r\n  execTool(ctx, toolop) {\r\n    if (this.enforceMemLimit) {\r\n      this.limitMemory(this.memLimit, ctx);\r\n    }\r\n\r\n    if (!toolop.constructor.canRun(ctx, toolop)) {\r\n      console.log(\"toolop.constructor.canRun returned false\");\r\n      return;\r\n    }\r\n\r\n    let tctx = ctx.toLocked();\r\n\r\n    let undoflag = toolop.constructor.tooldef().undoflag;\r\n    if (toolop.undoflag !== undefined) {\r\n      undoflag = toolop.undoflag;\r\n    }\r\n    undoflag = undoflag === undefined ? 0 : undoflag;\r\n\r\n    //if (!(undoflag & UndoFlags.IS_UNDO_ROOT) && !(undoflag & UndoFlags.NO_UNDO)) {\r\n    //tctx = new SavedContext(ctx, ctx.datalib);\r\n    //}\r\n\r\n    toolop.execCtx = tctx;\r\n\r\n    if (!(undoflag & UndoFlags.NO_UNDO)) {\r\n      this.cur++;\r\n\r\n      //save branch for if tool cancel\r\n      this._undo_branch = this.slice(this.cur + 1, this.length);\r\n\r\n      //truncate\r\n      this.length = this.cur + 1;\r\n\r\n      this[this.cur] = toolop;\r\n      toolop.undoPre(tctx);\r\n    }\r\n\r\n    if (toolop.is_modal) {\r\n      ctx = toolop.modal_ctx = ctx;\r\n\r\n      this.modal_running = true;\r\n\r\n      toolop._on_cancel = (function (toolop) {\r\n        if (!(toolop.undoflag & UndoFlags.NO_UNDO)) {\r\n          this[this.cur].undo(ctx);\r\n          this.pop_i(this.cur);\r\n          this.cur--;\r\n        }\r\n      }).bind(this);\r\n\r\n      //will handle calling .exec itself\r\n      toolop.modalStart(ctx);\r\n    } else {\r\n      toolop.execPre(tctx);\r\n      toolop.exec(tctx);\r\n      toolop.execPost(tctx);\r\n      toolop.saveDefaultInputs();\r\n    }\r\n  }\r\n\r\n  toolCancel(ctx, tool) {\r\n    if (tool._was_redo) { //also set by toolstack.redo\r\n      //ignore tool cancel requests on redo\r\n      return;\r\n    }\r\n\r\n    if (tool !== this[this.cur]) {\r\n      console.warn(\"toolCancel called in error\", this, tool);\r\n      return;\r\n    }\r\n\r\n    this.undo();\r\n    this.length = this.cur + 1;\r\n\r\n    if (this._undo_branch !== undefined) {\r\n      for (let item of this._undo_branch) {\r\n        this.push(item);\r\n      }\r\n    }\r\n  }\r\n\r\n  undo() {\r\n    if (this.enforceMemLimit) {\r\n      this.limitMemory(this.memLimit);\r\n    }\r\n\r\n    if (this.cur >= 0 && !(this[this.cur].undoflag & UndoFlags.IS_UNDO_ROOT)) {\r\n      let tool = this[this.cur];\r\n\r\n      tool.undo(tool.execCtx);\r\n\r\n      this.cur--;\r\n    }\r\n  }\r\n\r\n  //reruns a tool if it's at the head of the stack\r\n  rerun(tool) {\r\n    if (this.enforceMemLimit) {\r\n      this.limitMemory(this.memLimit);\r\n    }\r\n\r\n    if (tool === this[this.cur]) {\r\n      tool._was_redo = false;\r\n\r\n      if (!tool.execCtx) {\r\n        tool.execCtx = this.ctx;\r\n      }\r\n\r\n      tool.undo(tool.execCtx);\r\n\r\n      tool._was_redo = true; //also set by toolstack.redo\r\n\r\n      tool.undoPre(tool.execCtx);\r\n      tool.execPre(tool.execCtx);\r\n      tool.exec(tool.execCtx);\r\n      tool.execPost(tool.execCtx);\r\n    } else {\r\n      console.warn(\"Tool wasn't at head of stack\", tool);\r\n    }\r\n  }\r\n\r\n  redo() {\r\n    if (this.enforceMemLimit) {\r\n      this.limitMemory(this.memLimit);\r\n    }\r\n\r\n    if (this.cur >= -1 && this.cur + 1 < this.length) {\r\n      //console.log(\"redo!\", this.cur, this.length);\r\n\r\n      this.cur++;\r\n      let tool = this[this.cur];\r\n\r\n\r\n      if (!tool.execCtx) {\r\n        tool.execCtx = this.ctx;\r\n      }\r\n\r\n      tool._was_redo = true;\r\n      tool.redo(tool.execCtx);\r\n\r\n      tool.saveDefaultInputs();\r\n    }\r\n  }\r\n\r\n  save() {\r\n    let data = [];\r\n    nstructjs.writeObject(data, this);\r\n    return data;\r\n  }\r\n\r\n  rewind() {\r\n    while (this.cur >= 0) {\r\n      let last = this.cur;\r\n      this.undo();\r\n\r\n      //prevent infinite loops\r\n      if (last === this.cur) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**cb is a function(ctx), if it returns the value false then playback stops\r\n   promise will still be fulfilled.\r\n\r\n   onstep is a callback, if it returns a promise that promise will be\r\n   waited on, otherwise execution is queue with window.setTimeout().\r\n   */\r\n  replay(cb, onStep) {\r\n    let cur = this.cur;\r\n\r\n    this.rewind();\r\n\r\n    let last = this.cur;\r\n\r\n    let start = util.time_ms();\r\n\r\n    return new Promise((accept, reject) => {\r\n      let next = () => {\r\n        last = this.cur;\r\n\r\n        if (cb && cb(ctx) === false) {\r\n          accept();\r\n          return;\r\n        }\r\n\r\n        if (this.cur < this.length) {\r\n          this.cur++;\r\n          this.rerun();\r\n        }\r\n\r\n        if (last === this.cur) {\r\n          console.warn(\"time:\", (util.time_ms() - start)/1000.0);\r\n          accept(this);\r\n        } else {\r\n          if (onStep) {\r\n            let ret = onStep();\r\n\r\n            if (ret && ret instanceof Promise) {\r\n              ret.then(() => {\r\n                next();\r\n              });\r\n            } else {\r\n              window.setTimeout(() => {\r\n                next();\r\n              })\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      next();\r\n    });\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    for (let item of this._stack) {\r\n      this.push(item);\r\n    }\r\n\r\n    delete this._stack;\r\n  }\r\n\r\n  //note that this makes sure tool classes are registered with nstructjs\r\n  //during save\r\n  _save() {\r\n    for (let tool of this) {\r\n      let cls = tool.constructor;\r\n\r\n      if (!nstructjs.isRegistered(cls)) {\r\n        cls._regWithNstructjs(cls);\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nToolStack.STRUCT = `\r\ntoolsys.ToolStack {\r\n  cur    : int;\r\n  _stack : array(abstract(toolsys.ToolOp)) | this._save();\r\n}\r\n`;\r\nnstructjs.register(ToolStack);\r\n\r\nwindow._testToolStackIO = function () {\r\n  let data = [];\r\n  let cls = _appstate.toolstack.constructor;\r\n\r\n  nstructjs.writeObject(data, _appstate.toolstack);\r\n  data = new DataView(new Uint8Array(data).buffer);\r\n\r\n  let toolstack = nstructjs.readObject(data, cls);\r\n\r\n  _appstate.toolstack.rewind();\r\n\r\n  toolstack.cur = -1;\r\n  toolstack.ctx = _appstate.toolstack.ctx;\r\n  _appstate.toolstack = toolstack;\r\n\r\n  return toolstack;\r\n}\r\n\r\nexport function buildToolSysAPI(api, registerWithNStructjs = true, rootCtxStruct = undefined) {\r\n  let datastruct = api.mapStruct(ToolPropertyCache, true);\r\n\r\n  for (let cls of ToolClasses) {\r\n    let def = cls._getFinalToolDef();\r\n\r\n    for (let k in def.inputs) {\r\n      let prop = def.inputs[k];\r\n\r\n      if (!(prop.flag & (PropFlags.PRIVATE | PropFlags.READ_ONLY))) {\r\n        SavedToolDefaults._buildAccessors(cls, k, prop, datastruct, api);\r\n      }\r\n    }\r\n  }\r\n\r\n  if (rootCtxStruct) {\r\n    rootCtxStruct.struct(\"toolDefaults\", \"toolDefaults\", \"Tool Defaults\", api.mapStruct(ToolPropertyCache));\r\n  }\r\n\r\n  if (!registerWithNStructjs) {\r\n    return;\r\n  }\r\n\r\n  //register tools with nstructjs\r\n  for (let cls of ToolClasses) {\r\n    try {\r\n      if (!nstructjs.isRegistered(cls)) {\r\n        ToolOp._regWithNstructjs(cls);\r\n      }\r\n    } catch (error) {\r\n      console.log(error.stack);\r\n      console.error(\"Failed to register a tool with nstructjs\");\r\n    }\r\n  }\r\n}\r\n","import {ToolClasses, ToolOp, ToolFlags, UndoFlags, ToolMacro} from './toolsys.js';\r\nimport {tokdef, lexer, parser, PUTLParseError} from '../util/parseutil.js';\r\nimport {DataPathError} from '../controller/controller_base.js';\r\nimport {cachering} from '../util/util.js';\r\n\r\nexport let ToolPaths = {};\r\n\r\nvar initToolPaths_run = false;\r\n\r\nexport function buildParser() {\r\n  let t = (name, re, func) => new tokdef(name, re, func);\r\n\r\n  let tokens = [\r\n    t('ID', /[a-zA-Z_$]+[a-zA-Z0-9_$]*/, (t) => {\r\n      if (t.value == \"true\" || t.value == \"false\") {\r\n        t.type = \"BOOL\";\r\n        t.value = t.value == \"true\";\r\n      }\r\n\r\n      return t;\r\n    }),\r\n    t('LPAREN', /\\(/),\r\n    t('RPAREN', /\\)/),\r\n    t('LSBRACKET', /\\[/),\r\n    t('RSBRACKET', /\\]/),\r\n    t('DOT', /\\./),\r\n    t('COMMA', /\\,/),\r\n    t('EQUALS', /\\=/),\r\n    t('STRLIT', /\"[^\"]*\"/, (t) => {\r\n      t.value = t.value.slice(1, t.value.length-1);\r\n      return t;\r\n    }),\r\n    t('STRLIT', /'[^']*'/, (t) => {\r\n      t.value = t.value.slice(1, t.value.length-1);\r\n      return t;\r\n    }),\r\n    t('NUMBER', /-?[0-9]+/, (t) => {\r\n      t.value = parseInt(t.value);\r\n      return t;\r\n    }),\r\n    t('NUMBER', /-?[0-9]+\\.[0-9]*/, (t) => {\r\n      t.value = parseFloat(t.value);\r\n      return t;\r\n    }),\r\n    t('WS', /[ \\n\\r\\t]/, (t) => undefined) //ignore whitespace\r\n  ];\r\n\r\n  let lexerror = (t) => {\r\n    console.warn(\"Parse error\");\r\n    return true;\r\n  };\r\n\r\n  let valid_datatypes = {\r\n    \"STRLIT\" : 1, \"NUMBER\" : 1, \"BOOL\" : 1\r\n  };\r\n\r\n  function p_Start(p) {\r\n    let args = {};\r\n\r\n    while (!p.at_end()) {\r\n      let keyword = p.expect(\"ID\");\r\n\r\n      p.expect(\"EQUALS\");\r\n\r\n      let t = p.next();\r\n      if (!(t.type in valid_datatypes)) {\r\n        throw new PUTLParseError(\"parse error: unexpected \" + t.type);\r\n      }\r\n\r\n      args[keyword] = t.value;\r\n    }\r\n\r\n    return args;\r\n  }\r\n\r\n  let lex = new lexer(tokens, lexerror)\r\n  let p = new parser(lex);\r\n  p.start = p_Start;\r\n\r\n  return p;\r\n}\r\n\r\nexport let Parser = buildParser();\r\n/*\r\nlet parse_rets = new cachering(() => return {\r\n  toolclass : undefined,\r\n  args : {}\r\n}, 64);\r\n//*/\r\n\r\nexport function parseToolPath(str, check_tool_exists=true) {\r\n  if (!initToolPaths_run) {\r\n    initToolPaths_run = true;\r\n    initToolPaths();\r\n  }\r\n\r\n  let startstr = str;\r\n\r\n  let i1 = str.search(/\\(/);\r\n  let i2 = str.search(/\\)/);\r\n  let args = \"\";\r\n\r\n  if (i1 >= 0 && i2 >= 0) {\r\n    args = str.slice(i1+1, i2).trim();\r\n    str = str.slice(0, i1).trim();\r\n  }\r\n\r\n  if (!(str in ToolPaths) && check_tool_exists) {\r\n    throw new DataPathError(\"unknown tool \" + str);\r\n  }\r\n\r\n  let ret;\r\n\r\n  try {\r\n    ret = Parser.parse(args);\r\n  } catch (error) {\r\n    console.log(error);\r\n    throw new DataPathError(`\"${startstr}\"\\n  ${error.message}`);\r\n  }\r\n\r\n  return {\r\n    toolclass : ToolPaths[str],\r\n    args      : ret\r\n  };\r\n}\r\n\r\nexport function testToolParser() {\r\n  let ret = parseToolPath(\"view3d.sometool(selectmode=1 str='str' bool=true)\", false);\r\n\r\n  return ret;\r\n}\r\n\r\nwindow.parseToolPath = parseToolPath;\r\n//window._ToolPaths = ToolPaths;\r\n\r\n//tool path parser for simple_toolsys.js\r\nexport function initToolPaths() {\r\n  for (let cls of ToolClasses) {\r\n    if (!cls.hasOwnProperty(\"tooldef\")) { //ignore abstract classes\r\n      continue;\r\n    }\r\n\r\n    let def = cls.tooldef();\r\n    let path = def.toolpath;\r\n\r\n    ToolPaths[path] = cls;\r\n  }\r\n}","import {ToolOp} from '../toolsys/toolsys.js';\r\nimport {print_stack} from '../util/util.js';\r\nimport {PropFlags, PropTypes} from '../toolsys/toolprop_abstract.js';\r\nimport {ToolProperty} from '../toolsys/toolprop.js';\r\nimport {DataPathError, isVecProperty, ListIface} from './controller_base.js';\r\n\r\nexport class ModelInterface {\r\n  constructor() {\r\n    this.prefix = \"\";\r\n  }\r\n\r\n  getToolDef(path) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  getToolPathHotkey(ctx, path) {\r\n    return undefined;\r\n  }\r\n\r\n  get list() {\r\n    throw new Error(\"implement me\");\r\n    return ListIface;\r\n  }\r\n\r\n  createTool(path, inputs={}, constructor_argument=undefined) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  //returns tool class, or undefined if one cannot be found for path\r\n  parseToolPath(path) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  /**\r\n   * runs .undo,.redo if toolstack head is same as tool\r\n   *\r\n   * otherwise, .execTool(ctx, tool) is called.\r\n   *\r\n   * @param compareInputs : check if toolstack head has identical input values, defaults to false\r\n   * */\r\n  execOrRedo(ctx, toolop, compareInputs=false) {\r\n    return ctx.toolstack.execOrRedo(ctx, toolop, compareInputs);\r\n  }\r\n\r\n  execTool(ctx, path, inputs={}, constructor_argument=undefined) {\r\n    return new Promise((accept, reject) => {\r\n      let tool = path;\r\n\r\n      try {\r\n        if (typeof tool == \"string\" || !(tool instanceof ToolOp)) {\r\n          tool = this.createTool(ctx, path, inputs, constructor_argument);\r\n        }\r\n      } catch (error) {\r\n        print_stack(error);\r\n        reject(error);\r\n        return;\r\n      }\r\n\r\n      //give client a chance to change tool instance directly\r\n      accept(tool);\r\n\r\n      //execute\r\n      try {\r\n        ctx.toolstack.execTool(ctx, tool);\r\n      } catch (error) { //for some reason chrome is suppressing errors\r\n        print_stack(error);\r\n        throw error;\r\n      }\r\n    });\r\n  }\r\n\r\n  //used by simple_controller.js for tagging error messages\r\n  pushReportContext(name) {\r\n\r\n  }\r\n\r\n  //used by simple_controller.js for tagging error messages\r\n  popReportContext() {\r\n\r\n  }\r\n\r\n  static toolRegistered(tool) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  static registerTool(tool) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  //not yet supported by path.ux's controller implementation\r\n  massSetProp(ctx, mass_set_path, value) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  /** takes a mass_set_path and returns an array of individual paths */\r\n  resolveMassSetPaths(ctx, mass_set_path) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  /**\r\n   * @example\r\n   *\r\n   * return {\r\n   *   obj      : [object owning property key]\r\n   *   parent   : [parent of obj]\r\n   *   key      : [property key]\r\n   *   subkey   : used by flag properties, represents a key within the property\r\n   *   value    : [value of property]\r\n   *   prop     : [optional toolprop.ToolProperty representing the property definition]\r\n   *   struct   : [optional datastruct representing the type, if value is an object]\r\n   *   mass_set : mass setter string, if controller implementation supports it\r\n   * }\r\n   */\r\n  resolvePath(ctx, path, ignoreExistence, rootStruct) {\r\n  }\r\n\r\n  setValue(ctx, path, val, rootStruct) {\r\n    let res = this.resolvePath(ctx, path, undefined,  rootStruct);\r\n    let prop = res.prop;\r\n\r\n    if (prop !== undefined && (prop.flag & PropFlags.READ_ONLY)) {\r\n      throw new DataPathError(\"Tried to set read only property\");\r\n    }\r\n\r\n    if (prop !== undefined && (prop.flag & PropFlags.USE_CUSTOM_GETSET)) {\r\n      prop.dataref = res.obj;\r\n      prop.ctx = ctx;\r\n      prop.datapath = path;\r\n\r\n      if (res.subkey !== undefined) {\r\n        let val2 = prop.getValue();\r\n        if (typeof val2 === \"object\") {\r\n          val2 = val2.copy();\r\n        }\r\n\r\n        if (prop.type === PropTypes.FLAG) {\r\n          if (val) {\r\n            val2 |= prop.values[res.subkey];\r\n          } else {\r\n            val2 &= ~prop.values[res.subkey];\r\n          }\r\n\r\n          val = val2;\r\n        } else if (prop.type === PropTypes.ENUM) {\r\n          val = prop.values[res.subkey];\r\n        } else {\r\n          val2[res.subkey] = val;\r\n          val = val2;\r\n        }\r\n      }\r\n\r\n      prop.setValue(val);\r\n      return;\r\n    }\r\n\r\n    if (prop !== undefined) {\r\n      if (prop.type === PropTypes.CURVE && !val) {\r\n        throw new DataPathError(\"can't set curve data to nothing\");\r\n      }\r\n\r\n      let use_range = (prop.type & (PropTypes.INT | PropTypes.FLOAT));\r\n\r\n      use_range = use_range || (res.subkey && (prop.type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4)));\r\n      use_range = use_range && prop.range;\r\n      use_range = use_range && !(prop.range[0] === 0.0 && prop.range[1] === 0.0);\r\n      use_range = use_range && typeof val === \"number\";\r\n\r\n      if (use_range) {\r\n        val = Math.min(Math.max(val, prop.range[0]), prop.range[1]);\r\n      }\r\n    }\r\n\r\n    let old = res.obj[res.key];\r\n\r\n    if (res.subkey !== undefined && res.prop !== undefined && res.prop.type === PropTypes.ENUM) {\r\n      let ival = res.prop.values[res.subkey];\r\n\r\n      if (val) {\r\n        res.obj[res.key] = ival;\r\n      }\r\n    } else if (res.prop !== undefined && res.prop.type === PropTypes.FLAG) {\r\n      if (res.subkey !== undefined) {\r\n        let ival = res.prop.values[res.subkey];\r\n\r\n        if (val) {\r\n          res.obj[res.key] |= ival;\r\n        } else {\r\n          res.obj[res.key] &= ~ival;\r\n        }\r\n      } else if (typeof val === \"number\" || typeof val === \"boolean\") {\r\n        val = typeof val === \"boolean\" ? (val & 1) : val;\r\n\r\n        res.obj[res.key] = val;\r\n      } else {\r\n        throw new DataPathError(\"Expected a number for a bitmask property\");\r\n      }\r\n    } else if (res.subkey !== undefined && isVecProperty(res.prop)) {\r\n      if (res.key !== \"\") {\r\n        res.obj[res.key][res.subkey] = val;\r\n      } else {\r\n        res.obj[res.subkey] = val;\r\n      }\r\n    } else if (res.key === \"\" && isVecProperty(res.prop)) {\r\n      for (let i=0; i<res.obj.length; i++) {\r\n        res.obj[i] = val[i];\r\n      }\r\n    } else if (!(prop !== undefined && prop instanceof ListIface)) {\r\n      res.obj[res.key] = val;\r\n    }\r\n\r\n    if (prop !== undefined && prop instanceof ListIface) {\r\n      prop.set(this, res.obj, res.key, val);\r\n    } else if (prop !== undefined) {\r\n      prop.dataref = res.obj;\r\n      prop.datapath = path;\r\n      prop.ctx = ctx;\r\n\r\n      prop._fire(\"change\", res.obj[res.key], old);\r\n    }\r\n  }\r\n\r\n  getDescription(ctx, path) {\r\n    let rdef = this.resolvePath(ctx, path);\r\n    if (rdef === undefined) {\r\n      throw new DataPathError(\"invalid path \" + path);\r\n    }\r\n\r\n    if (!rdef.prop || !(rdef.prop instanceof ToolProperty)) {\r\n      return \"\";\r\n    }\r\n\r\n    let type = rdef.prop.type;\r\n    let prop = rdef.prop;\r\n\r\n    if (rdef.subkey !== undefined) {\r\n      let subkey = rdef.subkey;\r\n\r\n      if (type & (PropTypes.VEC2|PropTypes.VEC3|PropTypes.VEC4)) {\r\n        if (prop.descriptions && subkey in prop.descriptions) {\r\n          return prop.descriptions[subkey];\r\n        }\r\n      } else if (type & (PropTypes.ENUM|PropTypes.FLAG)) {\r\n        if (!(subkey in prop.values) && subkey in prop.keys) {\r\n          subkey = prop.keys[subkey]\r\n        };\r\n\r\n        if (prop.descriptions && subkey in prop.descriptions) {\r\n          return prop.descriptions[subkey];\r\n        }\r\n      } else if (type === PropTypes.PROPLIST) {\r\n        let val = tdef.value;\r\n        if (typeof val === \"object\" && val instanceof ToolProperty) {\r\n          return val.description;\r\n        }\r\n      }\r\n    }\r\n\r\n    return rdef.prop.description ? rdef.prop.description : rdef.prop.uiname;\r\n  }\r\n\r\n  validPath(ctx, path, rootStruct) {\r\n    try {\r\n      this.getValue(ctx, path, rootStruct);\r\n      return true;\r\n    } catch (error) {\r\n      if (!(error instanceof DataPathError)) {\r\n        throw error;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  getPropName(ctx, path) {\r\n    let i = path.length-1;\r\n    while (i >= 0 && path[i] !== \".\") {\r\n      i--;\r\n    }\r\n\r\n    path = path.slice(i+1, path.length).trim();\r\n\r\n    if (path.endsWith(\"]\")) {\r\n      i = path.length - 1;\r\n      while (i >= 0 && path[i] !== \"[\") {\r\n        i--;\r\n      }\r\n\r\n      path = path.slice(0, i).trim();\r\n\r\n      return this.getPropName(ctx, path);\r\n    }\r\n\r\n    return path;\r\n  }\r\n\r\n  getValue(ctx, path, rootStruct=undefined) {\r\n    if (typeof ctx == \"string\") {\r\n      throw new Error(\"You forgot to pass context to getValue\");\r\n    }\r\n\r\n    let ret = this.resolvePath(ctx, path, undefined, rootStruct);\r\n\r\n    if (ret === undefined) {\r\n      throw new DataPathError(\"invalid path \" + path);\r\n    }\r\n\r\n    let exec = ret.prop !== undefined && (ret.prop.flag & PropFlags.USE_CUSTOM_GETSET);\r\n\r\n    //resolvePath handles the case of vector properties with custom callbacks for us\r\n    //(and possibly all the other cases too, need to check)\r\n    exec = exec && !(ret.prop !== undefined && (ret.prop.type & (PropTypes.VEC2|PropTypes.VEC3|PropTypes.VEC4|PropTypes.QUAT)));\r\n\r\n    if (exec) {\r\n      ret.prop.dataref = ret.obj;\r\n      ret.prop.datapath = path;\r\n      ret.prop.ctx = ctx;\r\n\r\n      let val = ret.prop.getValue();\r\n\r\n      if (typeof val === \"string\" && (ret.prop.type & (PropTypes.FLAG|PropTypes.ENUM))) {\r\n        val = ret.prop.values[val];\r\n      }\r\n\r\n      if (ret.subkey && ret.prop.type === PropTypes.ENUM) {\r\n        val = val === ret.prop.values[ret.subkey];\r\n      } else if (ret.subkey && ret.prop.type === PropTypes.FLAG) {\r\n        val = val & ret.prop.values[ret.subkey];\r\n      }\r\n\r\n      return val;\r\n\r\n    }\r\n\r\n    return ret.value;\r\n  }\r\n}\r\n","import {ToolOp, ToolFlags} from \"../toolsys/toolsys.js\";\r\nimport {\r\n  PropTypes, PropFlags, BoolProperty, IntProperty, FloatProperty, FlagProperty,\r\n  EnumProperty, StringProperty, Vec3Property, Vec2Property, Vec4Property,\r\n  QuatProperty, Mat4Property\r\n} from \"../toolsys/toolprop.js\";\r\n\r\nimport * as util from '../util/util.js';\r\nimport {isVecProperty, getVecClass} from \"./controller_base.js\";\r\n\r\nexport class DataPathSetOp extends ToolOp {\r\n  constructor() {\r\n    super();\r\n\r\n    this.propType = -1;\r\n    this._undo = undefined;\r\n  }\r\n\r\n  setValue(ctx, val, object) {\r\n    let prop = this.inputs.prop;\r\n    let path = this.inputs.dataPath.getValue();\r\n\r\n    if (prop.type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n      let rdef = ctx.api.resolvePath(ctx, path);\r\n      if (rdef.subkey !== undefined) {\r\n        let subkey = rdef.subkey;\r\n        if (typeof subkey === \"string\") {\r\n          subkey = rdef.prop.values[subkey];\r\n        }\r\n\r\n        this.inputs.flagBit.setValue(subkey);\r\n        this.inputs.useFlagBit.setValue(true);\r\n      }\r\n\r\n      //if (rdef.subkey !== undefined) {\r\n      //  val = rdef.value;\r\n      //val = !!val;\r\n      //}\r\n    }\r\n\r\n    prop.dataref = object;\r\n    prop.ctx = ctx;\r\n    prop.datapath = path;\r\n\r\n    try {\r\n      prop.setValue(val);\r\n      this.hadError = false;\r\n    } catch (error) {\r\n      console.error(\"Error setting datapath\", path);\r\n      this.hadError = true;\r\n    }\r\n  }\r\n\r\n  static create(ctx, datapath, value, id, massSetPath) {\r\n    let rdef = ctx.api.resolvePath(ctx, datapath);\r\n\r\n    if (rdef === undefined || rdef.prop === undefined) {\r\n      console.warn(\"DataPathSetOp failed\", rdef, rdef.prop);\r\n      return;\r\n    }\r\n\r\n    let prop = rdef.prop;\r\n    let tool = new DataPathSetOp();\r\n\r\n    tool.propType = prop.type;\r\n    tool.inputs.destType.setValue(prop.type);\r\n\r\n    if (prop && (prop.flag & PropFlags.USE_BASE_UNDO)) {\r\n      tool.inputs.fullSaveUndo.setValue(true);\r\n    }\r\n\r\n    let mask = PropTypes.FLAG | PropTypes.ENUM;\r\n    mask |= PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4 | PropTypes.QUAT;\r\n\r\n    if (rdef.subkey !== undefined && (prop.type & mask)) {\r\n      if (prop.type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n        let i = datapath.length - 1;\r\n\r\n        //chope off enum selector\r\n        while (i >= 0 && datapath[i] !== '[') {\r\n          i--;\r\n        }\r\n\r\n        if (i >= 0) {\r\n          datapath = datapath.slice(0, i);\r\n        }\r\n\r\n        tool.inputs.prop = new IntProperty();\r\n      } else {\r\n        tool.inputs.prop = new FloatProperty();\r\n      }\r\n\r\n      let subkey = rdef.subkey;\r\n      if (typeof subkey !== \"number\") {\r\n        subkey = rdef.prop.values[subkey];\r\n      }\r\n\r\n      if (prop.type === PropTypes.FLAG) {\r\n        tool.inputs.flagBit.setValue(subkey);\r\n        tool.inputs.useFlagBit.setValue(true);\r\n      }\r\n\r\n      if (prop.type === PropTypes.ENUM) {\r\n        value = subkey;\r\n      } else if (prop.type === PropTypes.FLAG) {\r\n        let value2 = ctx.api.getValue(ctx, datapath);\r\n\r\n        if (typeof value2 !== \"number\") {\r\n          value2 = typeof value2 === \"boolean\" ? (value & 1) : 0;\r\n        }\r\n\r\n        if (value) {\r\n          value2 |= subkey;\r\n        } else {\r\n          value2 &= ~subkey;\r\n        }\r\n\r\n        value = value2;\r\n      }\r\n      //value = rdef.obj[rdef.key];\r\n      //console.log(\"rdef.value\", value);\r\n    } else {\r\n      tool.inputs.prop = prop.copy();\r\n    }\r\n\r\n    tool.inputs.dataPath.setValue(datapath);\r\n\r\n    if (massSetPath) {\r\n      tool.inputs.massSetPath.setValue(massSetPath);\r\n    } else {\r\n      tool.inputs.massSetPath.setValue(\"\");\r\n    }\r\n\r\n    tool.id = id;\r\n\r\n    tool.setValue(ctx, value, rdef.obj);\r\n\r\n    return tool;\r\n  }\r\n\r\n  hash(massSetPath, dataPath, prop, id) {\r\n    massSetPath = massSetPath === undefined ? \"\" : massSetPath;\r\n    massSetPath = massSetPath === null ? \"\" : massSetPath;\r\n\r\n    let ret = \"\" + massSetPath + \":\" + dataPath + \":\" + prop + \":\" + id;\r\n\r\n    return ret;\r\n  }\r\n\r\n  hashThis() {\r\n    return this.hash(this.inputs.massSetPath.getValue(),\r\n      this.inputs.dataPath.getValue(),\r\n      this.propType,\r\n      this.id);\r\n  }\r\n\r\n  undoPre(ctx) {\r\n    if (this.inputs.fullSaveUndo.getValue()) {\r\n      return super.undoPre(ctx);\r\n    }\r\n\r\n    if (this.__ctx)\r\n      ctx = this.__ctx;\r\n\r\n    this._undo = {};\r\n\r\n    let paths = new Set();\r\n\r\n    if (this.inputs.massSetPath.getValue().trim()) {\r\n      let massSetPath = this.inputs.massSetPath.getValue().trim();\r\n\r\n      paths = new Set(ctx.api.resolveMassSetPaths(ctx, massSetPath));\r\n\r\n    }\r\n\r\n    paths.add(this.inputs.dataPath.getValue());\r\n\r\n    for (let path of paths) {\r\n      let val = ctx.api.getValue(ctx, path);\r\n\r\n      if (typeof val === \"object\") {\r\n        val = val.copy();\r\n      }\r\n\r\n      this._undo[path] = val;\r\n    }\r\n\r\n    /*\r\n    for (let path of paths) {\r\n      let rdef = ctx.api.resolvePath(ctx, path);\r\n\r\n      if (rdef === undefined) {\r\n        console.warn(\"Failed to lookup path in DataPathSetOp.undoPre\", path);\r\n        continue;\r\n      }\r\n\r\n      let prop = rdef.prop;\r\n      let value = rdef.value;\r\n\r\n      if (prop.type & (PropTypes.ENUM|PropTypes.FLAG)) {\r\n        this._undo[path] = rdef.obj[rdef.key];\r\n      } else if (isVecProperty(prop)) {\r\n        if (rdef.subkey) {\r\n          this._undo[path] = rdef.value;\r\n        } else {\r\n          let cls = getVecClass(prop.type);\r\n          this._undo[path] = new cls(rdef.value);\r\n        }\r\n      } else {\r\n        let prop2 = prop.copy();\r\n\r\n        prop2.dataref = rdef.obj;\r\n        prop2.datapath = path;\r\n        prop2.ctx = ctx;\r\n\r\n        prop2.setValue(value);\r\n\r\n        this._undo[path] = prop2.getValue();\r\n      }\r\n    }*/\r\n  }\r\n\r\n  undo(ctx) {\r\n    if (this.__ctx)\r\n      ctx = this.__ctx;\r\n\r\n    if (this.inputs.fullSaveUndo.getValue()) {\r\n      return super.undo(ctx);\r\n    }\r\n\r\n    for (let path in this._undo) {\r\n      let rdef = ctx.api.resolvePath(ctx, path);\r\n\r\n      if (rdef.prop !== undefined && (rdef.prop.type & (PropTypes.ENUM | PropTypes.FLAG))) {\r\n        let old = rdef.obj[rdef.key];\r\n\r\n        if (rdef.subkey) {\r\n          let key = rdef.subkey;\r\n\r\n          if (typeof key !== \"number\") {\r\n            key = rdef.prop.values[key];\r\n          }\r\n\r\n          if (rdef.prop.type === PropTypes.FLAG) {\r\n            if (this._undo[path]) {\r\n              rdef.obj[rdef.key] |= key;\r\n            } else {\r\n              rdef.obj[rdef.key] &= ~key;\r\n            }\r\n          } else {\r\n            rdef.obj[rdef.key] = key;\r\n          }\r\n        } else {\r\n          rdef.obj[rdef.key] = this._undo[path];\r\n        }\r\n\r\n        rdef.prop.dataref = rdef.obj;\r\n        rdef.prop.datapath = path;\r\n        rdef.prop.ctx = ctx;\r\n\r\n        rdef.prop._fire(\"change\", rdef.obj[rdef.key], old);\r\n      } else {\r\n        try {\r\n          ctx.api.setValue(ctx, path, this._undo[path]);\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n          console.warn(\"Failed to set property in undo for DataPathSetOp\");\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  exec(ctx) {\r\n    //use saved ctx we got from modal start\r\n    if (this.__ctx) {\r\n      ctx = this.__ctx;\r\n    }\r\n\r\n    let path = this.inputs.dataPath.getValue();\r\n    let massSetPath = this.inputs.massSetPath.getValue().trim();\r\n\r\n    try {\r\n      ctx.api.setValue(ctx, path, this.inputs.prop.getValue());\r\n      this.hadError = false;\r\n    } catch (error) {\r\n      console.log(error.stack);\r\n      console.log(error.message);\r\n      console.log(\"error setting \" + path);\r\n\r\n      this.hadError = true;\r\n    }\r\n\r\n    if (massSetPath) {\r\n      let value = this.inputs.prop.getValue();\r\n      let useFlagBit = this.inputs.useFlagBit.getValue();\r\n\r\n      if (useFlagBit && this.inputs.destType.getValue() === PropTypes.FLAG) {\r\n        let bit = this.inputs.flagBit.getValue();\r\n\r\n        value = !!(value & bit);\r\n      }\r\n      try {\r\n        ctx.api.massSetProp(ctx, massSetPath, value);\r\n      } catch (error) {\r\n        console.log(error.stack);\r\n        console.log(error.message);\r\n        console.log(\"error setting \" + path);\r\n\r\n        this.hadError = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  modalStart(ctx) {\r\n    this.__ctx = ctx.toLocked();\r\n\r\n    //save full, modal ctx\r\n    super.modalStart(this.__ctx);\r\n\r\n    this.exec(this.__ctx);\r\n    this.modalEnd(false);\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname  : \"Property Set\",\r\n      toolpath: \"app.prop_set\",\r\n      icon    : -1,\r\n      flag    : ToolFlags.PRIVATE,\r\n      is_modal: true,\r\n      inputs  : {\r\n        dataPath    : new StringProperty(),\r\n        massSetPath : new StringProperty(),\r\n        fullSaveUndo: new BoolProperty(false),\r\n        flagBit     : new IntProperty(),\r\n        useFlagBit  : new BoolProperty(),\r\n        destType    : new EnumProperty(PropTypes.INT, PropTypes),\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nToolOp.register(DataPathSetOp);\r\n","/**\r\n\r\n This is the main datapath controller module, inspired by Blender's RNA system.\r\n\r\n Datapaths are special bindings for objects; they store types (e.g. float, int, enumeration, string),\r\n as well as lots of UI-specific metadata (like human-readable names, tooltips, icons, numeric ranges, etc).\r\n\r\n Controller bindings are intended to present a more unified and coherent model of the\r\n application model than may actually exists.  This is inspired by Blender's RNA system, which\r\n hides almost all of Blender's core data structure complexity (Blender is written in C) from\r\n users who e.g. write python scripts, extend the UI, use advanced animation features, or anything else\r\n that uses RNA paths.\r\n\r\n ## Contexts\r\n\r\n The datapath system works in tandem with the context module.  Contexts are client-provided classes\r\n that the datapath API and ToolOps use to communicate with the application state.\r\n\r\n ## Example\r\n\r\n <pre>\r\n\r\n function initMyDataAPI() {\r\n  let api = new DataAPI();\r\n\r\n  //map MyContextClass to a struct, true tells mapStruct to auto-create\r\n  //the struct if it doesn't already exist\r\n  let st = api.mapStruct(MyContextClass, true);\r\n\r\n  //set fields of struct, e.g. st.int, st.float, st.enum, st.struct, etc\r\n\r\n  //build toolsys api\r\n  buildToolSysAPI(api);\r\n\r\n  //create bindings for default tool operator settings\r\n  cstruct.struct(\"propCache\", \"toolDefaults\", \"Tool Defaults\", api.mapStruct(ToolPropertyCache));\r\n\r\n  return api;\r\n}\r\n </pre>\r\n */\r\nimport * as toolprop from '../toolsys/toolprop.js';\r\nimport * as parseutil from '../util/parseutil.js';\r\nimport {print_stack} from '../util/util.js';\r\nimport {ToolOp, UndoFlags, ToolFlags} from \"../toolsys/toolsys.js\";\r\nimport {Vec2Property, Vec3Property, Vec4Property, PropTypes, PropFlags} from '../toolsys/toolprop.js';\r\nimport * as toolprop_abstract from '../toolsys/toolprop_abstract.js';\r\nimport * as util from '../util/util.js';\r\n\r\nimport {DataPath, DataFlags, DataTypes, DataPathError, StructFlags, getTempProp} from './controller_base.js';\r\n\r\nexport * from './controller_base.js';\r\n\r\nlet PUTLParseError = parseutil.PUTLParseError;\r\n\r\nlet tk = (name, re, func) => new parseutil.tokdef(name, re, func);\r\nlet tokens = [\r\n  tk(\"ID\", /[a-zA-Z_$]+[a-zA-Z_$0-9]*/),\r\n  tk(\"NUM\", /-?[0-9]+/, (t) => {\r\n    t.value = parseInt(t.value);\r\n    return t;\r\n  }),\r\n  tk('NUMBER', /-?[0-9]+\\.[0-9]*/, (t) => {\r\n    t.value = parseFloat(t.value);\r\n    return t;\r\n  }),\r\n  tk(\"STRLIT\", /'.*?'/, (t) => {\r\n    t.value = t.value.slice(1, t.value.length - 1);\r\n    return t;\r\n  }),\r\n  tk(\"STRLIT\", /\".*?\"/, (t) => {\r\n    t.value = t.value.slice(1, t.value.length - 1);\r\n    return t;\r\n  }),\r\n  tk(\"DOT\", /\\./),\r\n  tk(\"EQUALS\", /(\\=)|(\\=\\=)/),\r\n  tk(\"LSBRACKET\", /\\[/),\r\n  tk(\"RSBRACKET\", /\\]/),\r\n  tk(\"AND\", /\\&/),\r\n  tk(\"WS\", /[ \\t\\n\\r]+/, (t) => undefined) //drok token\r\n];\r\n\r\nlet lexer = new parseutil.lexer(tokens, (t) => {\r\n  console.warn(\"Parse error\", t);\r\n  throw new DataPathError();\r\n});\r\n\r\nexport let pathParser = new parseutil.parser(lexer);\r\n\r\nlet parserStack = new Array(32);\r\nfor (let i = 0; i < parserStack.length; i++) {\r\n  parserStack[i] = pathParser.copy();\r\n}\r\nparserStack.cur = 0;\r\n\r\nimport {\r\n  setImplementationClass, isVecProperty, ListIface\r\n} from './controller_base.js';\r\nimport {initToolPaths, parseToolPath} from '../toolsys/toolpath.js';\r\nimport {ModelInterface} from './controller_abstract.js';\r\n\r\nexport {DataPathError, DataFlags} from './controller_base.js';\r\n\r\nimport {ToolClasses} from '../toolsys/toolsys.js';\r\nimport {ToolProperty, IntProperty} from \"../toolsys/toolprop.js\";\r\n\r\nlet tool_classes = ToolClasses;\r\n\r\nlet tool_idgen = 1;\r\nSymbol.ToolID = Symbol(\"toolid\");\r\n\r\nfunction toolkey(cls) {\r\n  if (!(Symbol.ToolID in cls)) {\r\n    cls[Symbol.ToolID] = tool_idgen++;\r\n  }\r\n\r\n  return cls[Symbol.ToolID];\r\n}\r\n\r\nlet lt = util.time_ms();\r\nlet lastmsg = undefined;\r\nlet lcount = 0;\r\n\r\nlet reportstack = [\"api\"];\r\n\r\nexport function pushReportName(name) {\r\n  if (reportstack.length > 1024) {\r\n    console.trace(\"eerk, reportstack overflowed\");\r\n    reportstack.length = 0;\r\n    reportstack.push(\"api\");\r\n  }\r\n\r\n  reportstack.push(name);\r\n}\r\n\r\nfunction report(msg) {\r\n  let name = reportstack.length === 0 ? \"api\" : reportstack[reportstack.length - 1];\r\n\r\n  util.console.context(name).warn(msg);\r\n}\r\n\r\nexport function popReportName() {\r\n  reportstack.pop();\r\n}\r\n\r\n\r\nexport class DataList extends ListIface {\r\n  constructor(callbacks) {\r\n    super();\r\n\r\n    if (callbacks === undefined) {\r\n      throw new DataPathError(\"missing callbacks argument to DataList\");\r\n    }\r\n\r\n    this.cb = {};\r\n\r\n    if (typeof callbacks === \"object\" && !Array.isArray(callbacks)) {\r\n      for (let k in callbacks) {\r\n        this.cb[k] = callbacks[k];\r\n      }\r\n    } else {\r\n      for (let cb of callbacks) {\r\n        this.cb[cb.name] = cb;\r\n      }\r\n    }\r\n\r\n    let check = (key) => {\r\n      if (!(key in this.cbs)) {\r\n        throw new DataPathError(`Missing ${key} callback in DataList`);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   Generic list API.\r\n\r\n   * Callbacks is an array of name functions, like so:\r\n   - function getStruct(api, list, key) //return DataStruct type of object in key, key is optional if omitted return base type of all objects?\r\n   - function get(api, list, key)\r\n   - function set(api, list, key, val) //this one has default behavior: list[key] = val\r\n   - function getLength(api, list)\r\n   - function getActive(api, list)\r\n   - function setActive(api, list, key)\r\n   - function getIter(api, list)\r\n   - function getKey(api, list, object) returns object's key in this list, either a string or a number\r\n   * */\r\n\r\n  copy() {\r\n    let ret = new DataList([this.cb.get]);\r\n\r\n    for (let k in this.cb) {\r\n      ret.cb[k] = this.cb[k];\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  get(api, list, key) {\r\n    return this.cb.get(api, list, key);\r\n  }\r\n\r\n  getLength(api, list) {\r\n    this._check(\"getLength\");\r\n    return this.cb.getLength(api, list);\r\n  }\r\n\r\n  _check(cb) {\r\n    if (!(cb in this.cb)) {\r\n      throw new DataPathError(cb + \" not supported by this list\");\r\n    }\r\n  }\r\n\r\n  set(api, list, key, val) {\r\n    if (this.cb.set === undefined) {\r\n      list[key] = val;\r\n    } else {\r\n      this.cb.set(api, list, key, val);\r\n    }\r\n  }\r\n\r\n  getIter(api, list) {\r\n    this._check(\"getIter\");\r\n    return this.cb.getIter(api, list);\r\n  }\r\n\r\n  filter(api, list, bitmask) {\r\n    this._check(\"filter\");\r\n    return this.cb.filter(api, list, bitmask);\r\n  }\r\n\r\n  getActive(api, list) {\r\n    this._check(\"getActive\");\r\n    return this.cb.getActive(api, list);\r\n  }\r\n\r\n  setActive(api, list, key) {\r\n    this._check(\"setActive\");\r\n    this.cb.setActive(api, list, key);\r\n  }\r\n\r\n  getKey(api, list, obj) {\r\n    this._check(\"getKey\");\r\n    return this.cb.getKey(api, list, obj);\r\n  }\r\n\r\n  getStruct(api, list, key) {\r\n    if (this.cb.getStruct !== undefined) {\r\n      return this.cb.getStruct(api, list, key);\r\n    }\r\n\r\n    let obj = this.get(api, list, key);\r\n\r\n    if (obj === undefined)\r\n      return undefined;\r\n\r\n    return api.getStruct(obj.constructor);\r\n  }\r\n}\r\n\r\nexport class DataStruct {\r\n  constructor(members = [], name = \"unnamed\") {\r\n    this.members = [];\r\n    this.name = name;\r\n    this.pathmap = {};\r\n    this.flag = 0;\r\n    this.dpath = undefined; //owning DataPath\r\n\r\n    this.inheritFlag = 0;\r\n\r\n    for (let m of members) {\r\n      this.add(m);\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this.pathmap = {};\r\n    this.members = [];\r\n\r\n    return this;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new DataStruct();\r\n\r\n    ret.name = this.name;\r\n    ret.flag = this.flag;\r\n    ret.inheritFlag = this.inheritFlag;\r\n\r\n    for (let m of this.members) {\r\n      let m2 = m.copy();\r\n\r\n      //don't copy struct or list references, just\r\n      //direct properties\r\n\r\n      if (m2.type === DataTypes.PROP) {\r\n        m2.data = m2.data.copy();\r\n      }\r\n\r\n      ret.add(m2);\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   * Like .struct, but the type of struct is looked up\r\n   * for objects at runtime.  Note that to work correctly each object\r\n   * must create its own struct definition via api.mapStruct\r\n   *\r\n   * @param path\r\n   * @param apiname\r\n   * @param uiname\r\n   * @param default_struct : default struct if one can't be looked up\r\n   * @returns {*}\r\n   */\r\n  dynamicStruct(path, apiname, uiname, default_struct = undefined) {\r\n    let ret = default_struct ? default_struct : new DataStruct();\r\n\r\n    let dpath = new DataPath(path, apiname, ret, DataTypes.DYNAMIC_STRUCT);\r\n    ret.inheritFlag |= this.inheritFlag;\r\n\r\n    ret.dpath = dpath;\r\n\r\n    this.add(dpath);\r\n    return ret;\r\n  }\r\n\r\n  struct(path, apiname, uiname, existing_struct = undefined) {\r\n    let ret = existing_struct ? existing_struct : new DataStruct();\r\n\r\n    let dpath = new DataPath(path, apiname, ret, DataTypes.STRUCT);\r\n    ret.inheritFlag |= this.inheritFlag;\r\n\r\n    ret.dpath = dpath;\r\n\r\n    this.add(dpath);\r\n    return ret;\r\n  }\r\n\r\n  customGet(getter) {\r\n    this.dpath.customGet(getter);\r\n\r\n    return this;\r\n  }\r\n\r\n  customGetSet(getter, setter) {\r\n    this.dpath.customGetSet(getter, setter);\r\n\r\n    return this;\r\n  }\r\n\r\n  color3(path, apiname, uiname, description) {\r\n    let ret = this.vec3(path, apiname, uiname, description);\r\n\r\n    ret.data.subtype = toolprop.PropSubTypes.COLOR;\r\n    ret.range(0, 1);\r\n    ret.simpleSlider();\r\n\r\n    ret.noUnits();\r\n\r\n    return ret;\r\n  }\r\n\r\n  color4(path, apiname, uiname, description = uiname) {\r\n    let ret = this.vec4(path, apiname, uiname, description);\r\n\r\n    ret.data.subtype = toolprop.PropSubTypes.COLOR;\r\n    ret.range(0, 1);\r\n    ret.simpleSlider();\r\n\r\n    ret.noUnits();\r\n\r\n    return ret;\r\n  }\r\n\r\n  arrayList(path, apiname, structdef, uiname, description) {\r\n    let ret = this.list(path, apiname, [\r\n      function getIter(api, list) {\r\n        return list[Symbol.iterator]();\r\n      },\r\n      function getLength(api, list) {\r\n        return list.length;\r\n      },\r\n      function get(api, list, key) {\r\n        return list[key];\r\n      },\r\n      function set(api, list, key, val) {\r\n        if (typeof key === \"string\") {\r\n          key = parseInt(key);\r\n        }\r\n\r\n        if (key < 0 || key >= list.length) {\r\n          throw new DataPathError(\"Invalid index \" + key);\r\n        }\r\n\r\n        list[key] = val;\r\n        window.redraw_viewport();\r\n      },\r\n      function getKey(api, list, obj) {\r\n        return list.indexOf(obj);\r\n      },\r\n      function getStruct(api, list, key) {\r\n        return structdef;\r\n      }]);\r\n\r\n    return ret;\r\n  }\r\n\r\n  color3List(path, apiname, uiname, description) {\r\n    return this.vectorList(3, path, apiname, uiname, description, toolprop.PropSubTypes.COLOR);\r\n  }\r\n\r\n  color4List(path, apiname, uiname, description) {\r\n    return this.vectorList(4, path, apiname, uiname, description, toolprop.PropSubTypes.COLOR);\r\n  }\r\n\r\n  vectorList(size, path, apiname, uiname, description, subtype) {\r\n    let type;\r\n\r\n    switch (size) {\r\n      case 2:\r\n        type = toolprop.Vec2Property;\r\n        break;\r\n      case 3:\r\n        type = toolprop.Vec3Property;\r\n      case 4:\r\n        type = toolprop.Vec4Property;\r\n    }\r\n\r\n    if (type === undefined) {\r\n      throw new DataPathError(\"Invalid size for vectorList; expected 2 3 or 4\");\r\n    }\r\n\r\n    let prop = new type(undefined, apiname, uiname, description);\r\n\r\n    let pstruct = new DataStruct(undefined, \"Vector\");\r\n    pstruct.vec3(\"\", \"co\", \"Coords\", \"Coordinates\");\r\n\r\n    let ret = this.list(path, apiname, [\r\n      function getIter(api, list) {\r\n        return list[Symbol.iterator]();\r\n      },\r\n      function getLength(api, list) {\r\n        return list.length;\r\n      },\r\n      function get(api, list, key) {\r\n        return list[key];\r\n      },\r\n      function set(api, list, key, val) {\r\n        if (typeof key == \"string\") {\r\n          key = parseInt(key);\r\n        }\r\n\r\n        if (key < 0 || key >= list.length) {\r\n          throw new DataPathError(\"Invalid index \" + key);\r\n        }\r\n\r\n        list[key] = val;\r\n        window.redraw_viewport();\r\n      },\r\n      function getKey(api, list, obj) {\r\n        return list.indexOf(obj);\r\n      },\r\n      function getStruct(api, list, key) {\r\n        return pstruct;\r\n      }]);\r\n\r\n    return ret;\r\n  }\r\n\r\n  bool(path, apiname, uiname, description) {\r\n    let prop = new toolprop.BoolProperty(undefined, apiname, uiname, description);\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  vec2(path, apiname, uiname, description) {\r\n    let prop = new toolprop.Vec2Property(undefined, apiname, uiname, description);\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  vec3(path, apiname, uiname, description) {\r\n    let prop = new toolprop.Vec3Property(undefined, apiname, uiname, description);\r\n    //prop.uiname = uiname;\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  vec4(path, apiname, uiname, description) {\r\n    let prop = new toolprop.Vec4Property(undefined, apiname, uiname, description);\r\n    //prop.uiname = uiname;\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  float(path, apiname, uiname, description) {\r\n    let prop = new toolprop.FloatProperty(0, apiname, uiname, description);\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  textblock(path, apiname, uiname, description) {\r\n    let prop = new toolprop.StringProperty(undefined, apiname, uiname, description);\r\n    prop.multiLine = true;\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  report(path, apiname, uiname, description) {\r\n    let prop = new toolprop.ReportProperty(undefined, apiname, uiname, description);\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  string(path, apiname, uiname, description) {\r\n    let prop = new toolprop.StringProperty(undefined, apiname, uiname, description);\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  int(path, apiname, uiname, description, prop = undefined) {\r\n    if (!prop) {\r\n      prop = new toolprop.IntProperty(0, apiname, uiname, description);\r\n    }\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  curve1d(path, apiname, uiname, description) {\r\n    let prop = new toolprop.Curve1DProperty(undefined);\r\n\r\n    prop.apiname = apiname;\r\n    prop.uiname = uiname;\r\n    prop.description = description;\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  enum(path, apiname, enumdef, uiname, description) {\r\n    let prop;\r\n\r\n    if (enumdef instanceof toolprop.EnumProperty) {\r\n      prop = enumdef;\r\n    } else {\r\n      prop = new toolprop.EnumProperty(undefined, enumdef, apiname, uiname, description);\r\n    }\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  list(path, apiname, funcs) {\r\n    let array = new DataList(funcs);\r\n\r\n    let dpath = new DataPath(path, apiname, array);\r\n    dpath.type = DataTypes.ARRAY;\r\n\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  flags(path, apiname, enumdef, uiname, description) {\r\n    let prop;\r\n\r\n    if (enumdef === undefined || !(enumdef instanceof toolprop.ToolProperty)) {\r\n      prop = new toolprop.FlagProperty(undefined, enumdef, apiname, uiname, description);\r\n    } else {\r\n      prop = enumdef;\r\n    }\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  remove(m) {\r\n    if (typeof m === \"string\") {\r\n      m = this.pathmap[m];\r\n    }\r\n\r\n    if (!(m.apiname in this.pathmap)) {\r\n      throw new Error(\"Member not in struct \" + m.apiname);\r\n    }\r\n\r\n    delete this.pathmap[m.apiname];\r\n    this.members.remove(m);\r\n  }\r\n\r\n  fromToolProp(path, prop, apiname) {\r\n    if (apiname === undefined) {\r\n      apiname = prop.apiname !== undefined && prop.apiname.length > 0 ? prop.apiname : k;\r\n    }\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n\r\n    this.add(dpath);\r\n\r\n    return dpath;\r\n  }\r\n\r\n  add(m) {\r\n    if (m.apiname in this.pathmap) {\r\n      if (window.DEBUG.datapaths) {\r\n        console.warn(\"Overriding existing member '\" + m.apiname + \"' in datapath struct\", this.name);\r\n      }\r\n\r\n      this.remove(this.pathmap[m.apiname]);\r\n    }\r\n\r\n    m.flag |= this.inheritFlag;\r\n\r\n    this.members.push(m);\r\n    m.parent = this;\r\n\r\n    this.pathmap[m.apiname] = m;\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nlet _map_struct_idgen = 1;\r\nlet _map_structs = {};\r\n\r\nwindow._debug__map_structs = _map_structs; //global for debugging purposes only\r\n\r\nlet _dummypath = new DataPath();\r\n\r\nlet DummyIntProperty = new IntProperty();\r\nconst CLS_API_KEY = Symbol(\"dp_map_id\");\r\nconst CLS_API_KEY_CUSTOM = Symbol(\"dp_map_custom\");\r\n\r\nexport class DataAPI extends ModelInterface {\r\n  constructor() {\r\n    super();\r\n\r\n    this.rootContextStruct = undefined;\r\n    this.structs = [];\r\n  }\r\n\r\n  get list() {\r\n    return undefined;\r\n  }\r\n\r\n  static toolRegistered(cls) {\r\n    return ToolOp.isRegistered(cls);\r\n    //let key = toolkey(cls);\r\n    //return key in tool_classes;\r\n  }\r\n\r\n  static registerTool(cls) {\r\n    console.warn(\"Outdated function simple_controller.DataAPI.registerTool called\");\r\n\r\n    return ToolOp.register(cls);\r\n\r\n    //let key = toolkey(cls);\r\n    //\r\n    //if (!(key in tool_classes)) {\r\n    //  tool_classes[key] = cls;\r\n    //}\r\n  }\r\n\r\n  getStructs() {\r\n    return this.structs;\r\n  }\r\n\r\n  setRoot(sdef) {\r\n    this.rootContextStruct = sdef;\r\n  }\r\n\r\n  hasStruct(cls) {\r\n    return cls.hasOwnProperty(CLS_API_KEY);\r\n  }\r\n\r\n  getStruct(cls) {\r\n    return this.mapStruct(cls, false);\r\n  }\r\n\r\n  mergeStructs(dest, src) {\r\n    for (let m of src.members) {\r\n      dest.add(m.copy());\r\n    }\r\n  }\r\n\r\n  inheritStruct(cls, parent, auto_create_parent = false) {\r\n    let st = this.mapStruct(parent, auto_create_parent);\r\n\r\n    if (st === undefined) {\r\n      throw new Error(\"parent has no struct definition\");\r\n    }\r\n\r\n    st = st.copy();\r\n    st.name = cls.name;\r\n\r\n    this._addClass(cls, st);\r\n    return st;\r\n  }\r\n\r\n  /**\r\n   * Look up struct definition for a class.\r\n   *\r\n   * @param cls: the class\r\n   * @param auto_create: If true, automatically create definition if not already existing.\r\n   * @returns {IterableIterator<*>}\r\n   */\r\n\r\n  _addClass(cls, dstruct) {\r\n    let key = _map_struct_idgen++;\r\n    cls[CLS_API_KEY] = key;\r\n\r\n    this.structs.push(dstruct);\r\n\r\n    _map_structs[key] = dstruct;\r\n  }\r\n\r\n  /* Associate cls with a DataStruct\r\n   * via callback, which will be called\r\n   * with an instance of cls as its argument*/\r\n  mapStructCustom(cls, callback) {\r\n    this.mapStruct(cls, true);\r\n    cls[CLS_API_KEY_CUSTOM] = callback;\r\n  }\r\n\r\n  mapStruct(cls, auto_create = true, name = cls.name) {\r\n    let key;\r\n\r\n    if (!cls.hasOwnProperty(CLS_API_KEY)) {\r\n      key = undefined;\r\n    } else {\r\n      key = cls[CLS_API_KEY];\r\n    }\r\n\r\n    if (key === undefined && auto_create) {\r\n      let dstruct = new DataStruct(undefined, name);\r\n      this._addClass(cls, dstruct);\r\n      return dstruct;\r\n    } else if (key === undefined) {\r\n      throw new Error(\"class does not have a struct definition: \" + name);\r\n    }\r\n\r\n    return _map_structs[key];\r\n  }\r\n\r\n  //used for tagging error messages\r\n  pushReportContext(name) {\r\n    pushReportName(name);\r\n  }\r\n\r\n  //used for tagging error messages\r\n  popReportContext() {\r\n    popReportName();\r\n  }\r\n\r\n  /*\r\n  massSetProp operate on lists.  The idea is to\r\n  write a filter str inside a data path, e.g.\r\n\r\n  ctx.api.massSetProp(ctx, \"obj.list[{$.select}].value\", 1);\r\n\r\n\r\n  * */\r\n  massSetProp(ctx, massSetPath, value) {\r\n    for (let path of this.resolveMassSetPaths(ctx, massSetPath)) {\r\n      this.setValue(ctx, path, value);\r\n    }\r\n  }\r\n\r\n  resolveMassSetPaths(ctx, massSetPath) {\r\n    if (massSetPath.startsWith(\"/\")) {\r\n      massSetPath = massSetPath.slice(1, massSetPath.length);\r\n    }\r\n\r\n    let start = massSetPath.search(\"{\");\r\n    let end = massSetPath.search(\"}\");\r\n\r\n    if (start < 0 || end < 0) {\r\n      throw new DataPathError(\"Invalid mass set datapath: \" + massSetPath);\r\n      return;\r\n    }\r\n\r\n    let prefix = massSetPath.slice(0, start - 1);\r\n    let filter = massSetPath.slice(start + 1, end);\r\n    let suffix = massSetPath.slice(end + 2, massSetPath.length);\r\n\r\n    let rdef = this.resolvePath(ctx, prefix);\r\n\r\n    if (!(rdef.prop instanceof DataList)) {\r\n      throw new DataPathError(\"massSetPath expected a path resolving to a DataList: \" + massSetPath);\r\n    }\r\n\r\n    let paths = [];\r\n\r\n    let list = rdef.prop;\r\n    let api = ctx.api;\r\n\r\n    function applyFilter(obj) {\r\n      //console.log(filter, obj, obj.constructor.name);\r\n\r\n      if (obj === undefined) {\r\n        return undefined;\r\n      } else if (typeof obj === \"object\" || typeof obj === \"function\") {\r\n        let st = api.mapStruct(obj.constructor, false);\r\n\r\n        let path = filter;\r\n        if (path.startsWith(\"$\")) {\r\n          path = path.slice(1, filter.length).trim();\r\n        }\r\n        if (path.startsWith(\".\")) {\r\n          path = path.slice(1, filter.length).trim();\r\n        }\r\n\r\n        try {\r\n          return api.getValue(obj, path, st);\r\n        } catch (error) {\r\n          if (!(error instanceof DataPathError)) {\r\n            util.print_stack(error);\r\n            console.error(\"Error in datapath callback\");\r\n          }\r\n\r\n          return false;\r\n        }\r\n      } else {\r\n        let $ = obj;\r\n        return eval(filter);\r\n      }\r\n    }\r\n\r\n    for (let obj of list.getIter(this, rdef.value)) {\r\n      if (!applyFilter(obj)) {\r\n        continue;\r\n      }\r\n\r\n      let key = \"\" + list.getKey(this, rdef.value, obj);\r\n      let path = `${prefix}[${key}]${suffix}`;\r\n\r\n      /* validate the final path */\r\n      try {\r\n        this.getValue(ctx, path);\r\n      } catch (error) {\r\n        if (!(error instanceof DataPathError)) {\r\n          util.print_stack(error);\r\n          console.error(path + \": Error in datapath API\");\r\n        }\r\n\r\n        continue;\r\n      }\r\n\r\n      paths.push(path);\r\n    }\r\n\r\n    return paths;\r\n  }\r\n\r\n  resolvePath(ctx, inpath, ignoreExistence = false, dstruct = undefined) {\r\n    let parser = parserStack[parserStack.cur++];\r\n    let ret = undefined;\r\n\r\n    if (inpath[0] === \"/\") {\r\n      inpath = inpath.slice(1, inpath.length).trim();\r\n    }\r\n\r\n    try {\r\n      ret = this.resolvePath_intern(ctx, inpath, ignoreExistence, parser, dstruct)\r\n    } catch (error) {\r\n      //throw new DataPathError(\"bad path \" + path);\r\n      if (!(error instanceof DataPathError)) {\r\n        util.print_stack(error);\r\n        report(\"error while evaluating path \" + inpath);\r\n      }\r\n\r\n      if (window.DEBUG && window.DEBUG.datapaths) {\r\n        util.print_stack(error);\r\n      }\r\n\r\n      ret = undefined;\r\n    }\r\n\r\n    parserStack.cur--;\r\n\r\n    if (ret !== undefined && ret.prop && ret.dpath && (ret.dpath.flag & DataFlags.USE_CUSTOM_PROP_GETTER)) {\r\n      let prop = ret.prop;\r\n\r\n      prop.ctx = ctx;\r\n      prop.datapath = inpath;\r\n      prop.dataref = ret.obj;\r\n\r\n      let newprop = getTempProp(prop.type);\r\n      prop.copyTo(newprop);\r\n\r\n      ret.dpath.propGetter.call(prop, newprop);\r\n      ret.prop = newprop;\r\n\r\n      prop.ctx = prop.datapath = prop.dataref = undefined;\r\n    }\r\n\r\n    if (ret !== undefined && ret.prop && ret.dpath && ret.dpath.ui_name_get) {\r\n      let dummy = {\r\n        datactx : ctx,\r\n        datapath: inpath,\r\n        dataref : ret.obj\r\n      };\r\n\r\n      let name = ret.dpath.ui_name_get.call(dummy);\r\n\r\n      ret.prop.uiname = \"\" + name;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   get meta information for a datapath.\r\n\r\n   @param ignoreExistence: don't try to get actual data associated with path,\r\n   just want meta information\r\n   */\r\n  resolvePath_intern(ctx, inpath, ignoreExistence = false, p = pathParser, dstruct = undefined) {\r\n    inpath = inpath.replace(\"==\", \"=\");\r\n\r\n    p.input(inpath);\r\n\r\n    dstruct = dstruct || this.rootContextStruct;\r\n\r\n    let obj = ctx;\r\n    let lastobj = ctx;\r\n    let subkey;\r\n    let lastobj2 = undefined;\r\n    let lastkey = undefined;\r\n    let prop = undefined;\r\n    let lastdpath = undefined;\r\n\r\n    function p_key() {\r\n      let t = p.peeknext();\r\n      if (t.type === \"NUM\" || t.type === \"STRLIT\") {\r\n        p.next();\r\n        return t.value;\r\n      } else {\r\n        throw new PUTLParseError(\"Expected list key\");\r\n      }\r\n    }\r\n\r\n    let _i = 0;\r\n    while (!p.at_end()) {\r\n      let key = p.expect(\"ID\");\r\n      let dpath = dstruct.pathmap[key];\r\n\r\n      lastdpath = dpath;\r\n\r\n      if (dpath === undefined) {\r\n        if (key === \"length\" && prop !== undefined && prop instanceof DataList) {\r\n          prop.getLength(this, obj);\r\n          key = \"length\";\r\n\r\n          prop = DummyIntProperty;\r\n\r\n          prop.name = \"length\";\r\n          prop.flag = PropFlags.READ_ONLY;\r\n\r\n          dpath = _dummypath;\r\n          dpath.type = DataTypes.PROP;\r\n          dpath.data = prop;\r\n          dpath.struct = dpath.parent = dstruct;\r\n          dpath.flag = DataFlags.READ_ONLY;\r\n          dpath.path = \"length\";\r\n\r\n          /*\r\n          parent: lastobj2,\r\n            obj: lastobj,\r\n            value: obj,\r\n            key: lastkey,\r\n            //*/\r\n        } else if (key === \"active\" && prop !== undefined && prop instanceof DataList) {\r\n          let act = prop.getActive(this, obj);\r\n\r\n          if (act === undefined && !ignoreExistence) {\r\n            throw new DataPathError(\"no active elem ent for list\");\r\n          }\r\n\r\n          let actkey = obj !== undefined && act !== undefined ? prop.getKey(this, obj, act) : undefined;\r\n\r\n          dstruct = prop.getStruct(this, obj, actkey);\r\n          if (dstruct === undefined) {\r\n            throw new DataPathError(\"couldn't get data type for \" + inpath + \"'s element '\" + key + \"'\");\r\n          }\r\n\r\n          _dummypath.parent = dpath;\r\n          dpath = _dummypath;\r\n\r\n          lastobj = obj;\r\n          obj = act;\r\n\r\n          dpath.type = DataTypes.STRUCT;\r\n          dpath.data = dstruct;\r\n          dpath.path = key;\r\n\r\n          p.optional(\"DOT\");\r\n\r\n          continue;\r\n        } else {\r\n          throw new DataPathError(inpath + \": unknown property \" + key);\r\n        }\r\n      }\r\n\r\n      let dynstructobj = undefined;\r\n\r\n      if (dpath.type === DataTypes.STRUCT) {\r\n        dstruct = dpath.data;\r\n      } else if (dpath.type === DataTypes.DYNAMIC_STRUCT) {\r\n        let ok = false;\r\n\r\n        if (obj !== undefined) {\r\n          let obj2;\r\n\r\n          if (dpath.flag & DataFlags.USE_CUSTOM_GETSET) {\r\n            let fakeprop = dpath.getSet;\r\n            fakeprop.ctx = ctx;\r\n            fakeprop.dataref = obj;\r\n            fakeprop.datapath = inpath;\r\n\r\n            obj2 = fakeprop.get();\r\n\r\n            fakeprop.ctx = fakeprop.datapath = fakeprop.dataref = undefined;\r\n          } else {\r\n            obj2 = obj[dpath.path];\r\n          }\r\n\r\n          dynstructobj = obj2;\r\n\r\n          if (obj2 !== undefined) {\r\n            if (CLS_API_KEY_CUSTOM in obj2.constructor) {\r\n              dstruct = obj2.constructor[CLS_API_KEY_CUSTOM](obj2);\r\n            } else {\r\n              dstruct = this.mapStruct(obj2.constructor, false);\r\n            }\r\n          } else {\r\n            dstruct = dpath.data;\r\n          }\r\n\r\n          if (dstruct === undefined) {\r\n            dstruct = dpath.data;\r\n          }\r\n\r\n          ok = dstruct !== undefined;\r\n        }\r\n\r\n        if (!ok) {\r\n          throw new DataPathError(\"dynamic struct error for path: \" + inpath);\r\n        }\r\n      } else {\r\n        prop = dpath.data;\r\n      }\r\n\r\n      if (dpath.path.search(/\\./) >= 0) {\r\n        let keys = dpath.path.split(/\\./);\r\n\r\n        for (let key of keys) {\r\n          lastobj2 = lastobj;\r\n          lastobj = obj;\r\n          lastkey = key;\r\n\r\n          if (obj === undefined && !ignoreExistence) {\r\n            throw new DataPathError(\"no data for \" + inpath);\r\n          } else if (obj !== undefined) {\r\n            obj = obj[key.trim()];\r\n          }\r\n        }\r\n      } else {\r\n        lastobj2 = lastobj;\r\n        lastobj = obj;\r\n\r\n        lastkey = dpath.path;\r\n\r\n        if (dpath.flag & DataFlags.USE_CUSTOM_GETSET) {\r\n          let fakeprop = dpath.getSet;\r\n\r\n          if (!fakeprop && dpath.type === DataTypes.PROP) {\r\n            let prop = dpath.data;\r\n\r\n            prop.ctx = ctx;\r\n            prop.dataref = obj;\r\n            prop.datapath = inpath;\r\n\r\n            try {\r\n              obj = prop.getValue();\r\n            } catch (error) {\r\n              util.print_stack(error);\r\n              obj = undefined;\r\n            }\r\n\r\n            if (typeof obj === \"string\" && (prop.type & (PropTypes.ENUM | PropTypes.FLAG))) {\r\n              obj = prop.values[obj];\r\n            }\r\n\r\n            prop.ctx = prop.dataref = prop.datapath = undefined;\r\n          } else {\r\n            fakeprop.ctx = ctx;\r\n            fakeprop.dataref = obj;\r\n            fakeprop.datapath = inpath;\r\n\r\n            obj = fakeprop.get();\r\n            fakeprop.ctx = fakeprop.datapath = fakeprop.dataref = undefined;\r\n          }\r\n        } else if (obj === undefined && !ignoreExistence) {\r\n          throw new DataPathError(\"no data for \" + inpath);\r\n        } else if (dpath.type === DataTypes.DYNAMIC_STRUCT) {\r\n          obj = dynstructobj;\r\n        } else if (obj !== undefined && dpath.path !== \"\") {\r\n          obj = obj[dpath.path];\r\n        }\r\n      }\r\n\r\n      let t = p.peeknext();\r\n      if (t === undefined) {\r\n        break;\r\n      }\r\n\r\n      if (t.type === \"DOT\") {\r\n        p.next();\r\n      } else if (t.type === \"EQUALS\" && prop !== undefined && (prop.type & (PropTypes.ENUM | PropTypes.FLAG))) {\r\n        p.expect(\"EQUALS\");\r\n\r\n        let t2 = p.peeknext();\r\n        let type = t2 && t2.type === \"ID\" ? \"ID\" : \"NUM\";\r\n\r\n        let val = p.expect(type);\r\n\r\n        let val1 = val;\r\n\r\n        if (typeof val == \"string\") {\r\n          val = prop.values[val];\r\n        }\r\n\r\n        if (val === undefined) {\r\n          throw new DataPathError(\"unknown value \" + val1);\r\n        }\r\n\r\n        if (val in prop.keys) {\r\n          subkey = prop.keys[val];\r\n        }\r\n\r\n        key = dpath.path;\r\n        obj = !!(lastobj[key] == val);\r\n      } else if (t.type === \"AND\" && prop !== undefined && (prop.type & (PropTypes.ENUM | PropTypes.FLAG))) {\r\n        p.expect(\"AND\");\r\n\r\n        let t2 = p.peeknext();\r\n        let type = t2 && t2.type === \"ID\" ? \"ID\" : \"NUM\";\r\n\r\n        let val = p.expect(type);\r\n\r\n        let val1 = val;\r\n\r\n        if (typeof val == \"string\") {\r\n          val = prop.values[val];\r\n        }\r\n\r\n        if (val === undefined) {\r\n          throw new DataPathError(\"unknown value \" + val1);\r\n        }\r\n\r\n        if (val in prop.keys) {\r\n          subkey = prop.keys[val];\r\n        }\r\n\r\n        key = dpath.path;\r\n        obj = !!(lastobj[key] & val);\r\n      } else if (t.type === \"LSBRACKET\" && prop !== undefined && (prop.type & (PropTypes.ENUM | PropTypes.FLAG))) {\r\n        p.expect(\"LSBRACKET\");\r\n\r\n        let t2 = p.peeknext();\r\n        let type = t2 && t2.type === \"ID\" ? \"ID\" : \"NUM\";\r\n\r\n        let val = p.expect(type);\r\n\r\n        let val1 = val;\r\n\r\n        if (typeof val == \"string\") {\r\n          val = prop.values[val];\r\n        }\r\n\r\n        if (val === undefined) {\r\n          console.warn(inpath, prop.values, val1, prop);\r\n          throw new DataPathError(\"unknown value \" + val1);\r\n        }\r\n\r\n        if (val in prop.keys) {\r\n          subkey = prop.keys[val];\r\n        }\r\n\r\n        let bitfield;\r\n        key = dpath.path;\r\n\r\n        if (!(prop.flag & PropFlags.USE_CUSTOM_GETSET)) {\r\n          bitfield = lastobj ? lastobj[key] : 0;\r\n        } else {\r\n          prop.dataref = lastobj;\r\n          prop.datapath = inpath;\r\n          prop.ctx = ctx;\r\n\r\n          try {\r\n            bitfield = prop.getValue();\r\n          } catch (error) {\r\n            util.print_stack(error);\r\n\r\n            bitfield = NaN;\r\n          }\r\n        }\r\n\r\n        if (lastobj === undefined && !ignoreExistence) {\r\n          throw new DataPathError(\"no data for path \" + inpath);\r\n        } else if (lastobj !== undefined) {\r\n          if (prop.type === PropTypes.ENUM) {\r\n            obj = !!(bitfield === val);\r\n          } else {\r\n            obj = !!(bitfield & val);\r\n          }\r\n        }\r\n\r\n        p.expect(\"RSBRACKET\");\r\n      } else if (t.type === \"LSBRACKET\" && prop !== undefined && isVecProperty(prop)) {\r\n        p.expect(\"LSBRACKET\");\r\n        let num = p.expect(\"NUM\");\r\n        p.expect(\"RSBRACKET\");\r\n\r\n        subkey = num;\r\n\r\n        if (prop !== undefined && !(prop.type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4 | PropTypes.QUAT))) {\r\n          lastobj = obj;\r\n        }\r\n\r\n        obj = obj[num];\r\n      } else if (t.type === \"LSBRACKET\") {\r\n        p.expect(\"LSBRACKET\")\r\n\r\n        if (lastobj && lastkey && typeof lastkey === \"string\" && lastkey.length > 0) {\r\n          lastobj = lastobj[lastkey];\r\n        }\r\n\r\n        lastkey = p_key();\r\n        p.expect(\"RSBRACKET\");\r\n\r\n        if (!(prop instanceof DataList)) {\r\n          throw new DataPathError(\"bad property, not a list\");\r\n        }\r\n\r\n        obj = prop.get(this, lastobj, lastkey);\r\n        dstruct = prop.getStruct(this, lastobj, lastkey);\r\n\r\n        if (!dstruct) {\r\n          throw new DataPathError(inpath + \": list has no entry \" + lastkey);\r\n        }\r\n\r\n        if (p.peeknext() !== undefined && p.peeknext().type === \"DOT\") {\r\n          p.next();\r\n        }\r\n      }\r\n\r\n      if (_i++ > 1000) {\r\n        console.warn(\"infinite loop in resolvePath parser\");\r\n        break;\r\n      }\r\n    }\r\n\r\n    return {\r\n      dpath  : lastdpath,\r\n      parent : lastobj2,\r\n      obj    : lastobj,\r\n      value  : obj,\r\n      key    : lastkey,\r\n      dstruct: dstruct,\r\n      prop   : prop,\r\n      subkey : subkey\r\n    };\r\n  }\r\n\r\n  resolvePathOld2(ctx, path) {\r\n    let splitchars = new Set([\".\", \"[\", \"]\", \"=\", \"&\"]);\r\n    let subkey = undefined;\r\n\r\n    path = path.replace(/\\=\\=/g, \"=\");\r\n\r\n    path = \".\" + this.prefix + path;\r\n\r\n    let p = [\"\"];\r\n    for (let i = 0; i < path.length; i++) {\r\n      let s = path[i];\r\n\r\n      if (splitchars.has(s)) {\r\n        if (s !== \"]\") {\r\n          p.push(s);\r\n        }\r\n\r\n        p.push(\"\");\r\n        continue;\r\n      }\r\n\r\n      p[p.length - 1] += s;\r\n    }\r\n\r\n    for (let i = 0; i < p.length; i++) {\r\n      p[i] = p[i].trim();\r\n\r\n      if (p[i].length === 0) {\r\n        p.remove(p[i]);\r\n        i--;\r\n      }\r\n\r\n      let c = parseInt(p[i]);\r\n      if (!isNaN(c)) {\r\n        p[i] = c;\r\n      }\r\n    }\r\n\r\n    let i = 0;\r\n\r\n    let parent1, obj = ctx, parent2;\r\n    let key = undefined;\r\n    let dstruct = undefined;\r\n    let arg = undefined;\r\n    let type = \"normal\";\r\n    let retpath = p;\r\n    let prop;\r\n    let lastkey = key, a;\r\n    let apiname = key;\r\n\r\n    while (i < p.length - 1) {\r\n      lastkey = key;\r\n      apiname = key;\r\n\r\n      if (dstruct !== undefined && dstruct.pathmap[lastkey]) {\r\n        let dpath = dstruct.pathmap[lastkey];\r\n\r\n        apiname = dpath.apiname;\r\n      }\r\n\r\n      let a = p[i];\r\n      let b = p[i + 1];\r\n\r\n      //check for enum/flag propertys with [] form\r\n      if (a === \"[\") {\r\n        let ok = false;\r\n\r\n        key = b;\r\n        prop = undefined;\r\n\r\n        if (dstruct !== undefined && dstruct.pathmap[lastkey]) {\r\n          let dpath = dstruct.pathmap[lastkey];\r\n\r\n          if (dpath.type === DataTypes.PROP) {\r\n            prop = dpath.data;\r\n          }\r\n        }\r\n\r\n        if (prop !== undefined && (prop.type === PropTypes.ENUM || prop.type === PropTypes.FLAG)) {\r\n          util.console.context(\"api\").log(\"found flag/enum property\");\r\n          ok = true;\r\n        }\r\n\r\n        if (ok) {\r\n          if (isNaN(parseInt(key))) {\r\n            key = prop.values[key];\r\n          } else if (typeof key == \"int\") {\r\n            key = parseInt(key);\r\n          }\r\n\r\n          let value = obj;\r\n          if (typeof value == \"string\") {\r\n            value = prop.values[key];\r\n          }\r\n\r\n          if (prop.type === PropTypes.ENUM) {\r\n            value = !!(value == key);\r\n          } else { //flag\r\n            value = !!(value & key);\r\n          }\r\n\r\n          if (key in prop.keys) {\r\n            subkey = prop.keys[key];\r\n          }\r\n\r\n          obj = value;\r\n          i++;\r\n          continue;\r\n        }\r\n      }\r\n\r\n      if (dstruct !== undefined && dstruct.pathmap[lastkey]) {\r\n        let dpath = dstruct.pathmap[lastkey];\r\n\r\n        if (dpath.type == DataTypes.PROP) {\r\n          prop = dpath.data;\r\n        }\r\n      }\r\n\r\n      if (a === \".\" || a === \"[\") {\r\n        key = b;\r\n\r\n        parent2 = parent1;\r\n        parent1 = obj;\r\n        obj = obj[b];\r\n\r\n        if (obj === undefined || obj === null) {\r\n          break;\r\n        }\r\n\r\n        if (typeof obj == \"object\") {\r\n          dstruct = this.mapStruct(obj.constructor, false);\r\n        }\r\n\r\n        i += 2;\r\n        continue;\r\n      } else if (a === \"&\") {\r\n        obj &= b;\r\n        arg = b;\r\n\r\n        if (b in prop.keys) {\r\n          subkey = prop.keys[b];\r\n        }\r\n\r\n        i += 2;\r\n        type = \"flag\";\r\n        continue;\r\n      } else if (a === \"=\") {\r\n        obj = obj == b;\r\n        arg = b;\r\n\r\n        if (b in prop.keys) {\r\n          subkey = prop.keys[b];\r\n        }\r\n\r\n        i += 2;\r\n        type = \"enum\";\r\n        continue;\r\n      } else {\r\n        throw new DataPathError(\"bad path \" + path);\r\n      }\r\n\r\n      i++;\r\n    }\r\n\r\n    if (lastkey !== undefined && dstruct !== undefined && dstruct.pathmap[lastkey]) {\r\n      let dpath = dstruct.pathmap[key];\r\n\r\n      apiname = dpath.apiname;\r\n    }\r\n\r\n\r\n    if (dstruct !== undefined && dstruct.pathmap[key]) {\r\n      let dpath = dstruct.pathmap[key];\r\n\r\n      if (dpath.type == DataTypes.PROP) {\r\n        prop = dpath.data;\r\n      }\r\n    }\r\n\r\n    return {\r\n      parent : parent2,\r\n      obj    : parent1,\r\n      value  : obj,\r\n      key    : key,\r\n      dstruct: dstruct,\r\n      subkey : subkey,\r\n      prop   : prop,\r\n      arg    : arg,\r\n      type   : type,\r\n      _path  : retpath\r\n    };\r\n  }\r\n\r\n  /*returns {\r\n    obj : [object owning property key]\r\n    parent : [parent of obj]\r\n    key : [property key]\r\n    value : [value of property]\r\n    prop : [optional toolprop.ToolProperty representing the property definition]\r\n    struct : [optional datastruct representing the type, if value is an object]\r\n  }\r\n  */\r\n  resolvePathold(ctx, path) {\r\n    path = this.prefix + path;\r\n    path = path.replace(/\\[/g, \".\").replace(/\\]/g, \"\").trim().split(\".\");\r\n\r\n    let parent1, obj = ctx, parent2;\r\n    let key = undefined;\r\n    let dstruct = undefined;\r\n\r\n    for (let c of path) {\r\n      let c2 = parseInt(c);\r\n      if (!isNaN(c2)) {\r\n        c = c2;\r\n      }\r\n\r\n      parent2 = parent1;\r\n      parent1 = obj;\r\n      key = c;\r\n\r\n      if (typeof obj == \"number\") {\r\n        //bitmask test\r\n        obj = obj & c;\r\n        break;\r\n      }\r\n\r\n      obj = obj[c];\r\n\r\n      if (typeof obj == \"object\") {\r\n        dstruct = this.mapStruct(obj.constructor, false);\r\n      }\r\n    }\r\n\r\n    let prop;\r\n\r\n    if (dstruct !== undefined && dstruct.pathmap[key]) {\r\n      let dpath = dstruct.pathmap[key];\r\n\r\n      if (dpath.type == DataTypes.PROP) {\r\n        prop = dpath.data;\r\n      }\r\n    }\r\n\r\n    return {\r\n      parent : parent2,\r\n      obj    : parent1,\r\n      value  : obj,\r\n      key    : key,\r\n      dstruct: dstruct,\r\n      prop   : prop\r\n    };\r\n  }\r\n\r\n  _stripToolUIName(path, uiNameOut = undefined) {\r\n    if (path.search(/\\|/) >= 0) {\r\n      if (uiNameOut) {\r\n        uiNameOut[0] = path.slice(path.search(/\\|/) + 1, path.length).trim();\r\n      }\r\n      path = path.slice(0, path.search(/\\|/)).trim();\r\n    }\r\n\r\n    return path.trim();\r\n  }\r\n\r\n  getToolDef(path) {\r\n    let uiname = [undefined];\r\n\r\n    path = this._stripToolUIName(path, uiname);\r\n    uiname = uiname[0];\r\n\r\n    let cls = this.parseToolPath(path);\r\n    if (cls === undefined) {\r\n      throw new DataPathError(\"unknown path \\\"\" + path + \"\\\"\");\r\n    }\r\n\r\n    let def = cls.tooldef();\r\n    if (uiname) {\r\n      def.uiname = uiname;\r\n    }\r\n\r\n    return def;\r\n  }\r\n\r\n  getToolPathHotkey(ctx, path) {\r\n    path = this._stripToolUIName(path);\r\n\r\n    try {\r\n      return this.getToolPathHotkey_intern(ctx, path);\r\n    } catch (error) {\r\n      print_stack(error);\r\n      util.console.context(\"api\").log(\"failed to fetch tool path: \" + path);\r\n\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  getToolPathHotkey_intern(ctx, path) {\r\n    let screen = ctx.screen;\r\n    let this2 = this;\r\n\r\n    function searchKeymap(keymap) {\r\n      if (keymap === undefined) {\r\n        return undefined;\r\n      }\r\n\r\n      for (let hk of keymap) {\r\n        if (typeof hk.action !== \"string\") {\r\n          continue;\r\n        }\r\n\r\n        let tool = this2._stripToolUIName(hk.action);\r\n        if (tool === path) {\r\n          return hk.buildString();\r\n        }\r\n      }\r\n    }\r\n\r\n    if (screen.sareas.length === 0) {\r\n      return searchKeymap(screen.keymap);\r\n    }\r\n\r\n    //client might have its own area subclass with\r\n    //getActiveArea defined (that's encouraged),\r\n    //which is why we don't just call Area.getActiveArea\r\n    let areacls = screen.sareas[0].area.constructor;\r\n    let area = areacls.getActiveArea();\r\n\r\n    if (area) {\r\n      for (let keymap of area.getKeyMaps()) {\r\n        let ret = searchKeymap(keymap);\r\n\r\n        if (ret !== undefined) {\r\n          return ret;\r\n        }\r\n      }\r\n    }\r\n\r\n    //search all other areas\r\n    for (let sarea of screen.sareas) {\r\n      if (!sarea.area) continue;\r\n\r\n      for (let keymap of sarea.area.getKeyMaps()) {\r\n        let ret = searchKeymap(keymap);\r\n\r\n        if (ret) {\r\n          return ret;\r\n        }\r\n      }\r\n    }\r\n\r\n    return this.keymap ? searchKeymap(this.keymap) : false;\r\n  }\r\n\r\n  parseToolPath(path) {\r\n    try {\r\n      return parseToolPath(path).toolclass;\r\n    } catch (error) {\r\n      if (error instanceof DataPathError) {\r\n        console.warn(\"warning, bad tool path \" + path);\r\n        return undefined;\r\n      } else {\r\n        throw error;\r\n      }\r\n    }\r\n  }\r\n\r\n  parseToolArgs(path) {\r\n    return parseToolPath(path).args;\r\n  }\r\n\r\n  createTool(ctx, path, inputs = {}) {\r\n    let cls;\r\n    let args;\r\n\r\n    if (typeof path == \"string\" || path instanceof String) {\r\n      //parseToolPath will raise DataPathError if path is malformed\r\n      let tpath = parseToolPath(path);\r\n\r\n      cls = tpath.toolclass;\r\n      args = tpath.args;\r\n    } else {\r\n      cls = path;\r\n      args = {};\r\n    }\r\n\r\n    if (!cls) {\r\n      debugger;\r\n      console.error(\"Unknown tool \" + path);\r\n    }\r\n\r\n    let tool = cls.invoke(ctx, args);\r\n\r\n    if (inputs !== undefined) {\r\n      for (let k in inputs) {\r\n        if (!(k in tool.inputs)) {\r\n          console.warn(cls.tooldef().uiname + \": Unknown tool property \\\"\" + k + \"\\\"\");\r\n          continue;\r\n        }\r\n\r\n        tool.inputs[k].setValue(inputs[k]);\r\n      }\r\n    }\r\n\r\n    return tool;\r\n  }\r\n}\r\n\r\nexport function initSimpleController() {\r\n  initToolPaths();\r\n}\r\n\r\nimport {DataPathSetOp} from \"./controller_ops.js\";\r\n\r\nlet dpt = DataPathSetOp;\r\n\r\nexport function getDataPathToolOp() {\r\n  return dpt;\r\n}\r\n\r\nexport function setDataPathToolOp(cls) {\r\n  ToolOp.unregister(DataPathSetOp);\r\n\r\n  if (!ToolOp.isRegistered(cls)) {\r\n    ToolOp.register(cls);\r\n  }\r\n\r\n  dpt = cls;\r\n}\r\n\r\nsetImplementationClass(DataAPI);\r\n","import * as util from '../util/util.js';\r\nimport * as vectormath from '../util/vectormath.js';\r\nimport {Vector3, Vector4} from '../util/vectormath.js';\r\n\r\nlet rgb_to_hsv_rets = new util.cachering(() => [0, 0, 0], 64);\r\n\r\nexport function rgb_to_hsv(r, g, b) {\r\n  let computedH = 0;\r\n  let computedS = 0;\r\n  let computedV = 0;\r\n\r\n  if (r == null || g == null || b == null ||\r\n    isNaN(r) || isNaN(g) || isNaN(b)) {\r\n    throw new Error(`Please enter numeric RGB values! r: ${r} g: ${g} b: ${b}`);\r\n  }\r\n  /*\r\n  if (r<0 || g<0 || b<0 || r>1.0 || g>1.0 || b>1.0) {\r\n   throw new Error('RGB values must be in the range 0 to 1.0');\r\n   return;\r\n  }//*/\r\n\r\n  let minRGB = Math.min(r, Math.min(g, b));\r\n  let maxRGB = Math.max(r, Math.max(g, b));\r\n\r\n  // Black-gray-white\r\n  if (minRGB === maxRGB) {\r\n    computedV = minRGB;\r\n\r\n    let ret = rgb_to_hsv_rets.next();\r\n    ret[0] = 0, ret[1] = 0, ret[2] = computedV;\r\n    return ret;\r\n  }\r\n\r\n  // Colors other than black-gray-white:\r\n  let d = (r === minRGB) ? g - b : ((b === minRGB) ? r - g : b - r);\r\n  let h = (r === minRGB) ? 3 : ((b === minRGB) ? 1 : 5);\r\n\r\n  computedH = (60*(h - d/(maxRGB - minRGB)))/360.0;\r\n  computedS = (maxRGB - minRGB)/maxRGB;\r\n  computedV = maxRGB;\r\n\r\n  let ret = rgb_to_hsv_rets.next();\r\n  ret[0] = computedH, ret[1] = computedS, ret[2] = computedV;\r\n  return ret;\r\n}\r\n\r\nlet hsv_to_rgb_rets = new util.cachering(() => [0, 0, 0], 64);\r\n\r\nexport function hsv_to_rgb(h, s, v) {\r\n  let c = 0, m = 0, x = 0;\r\n  let ret = hsv_to_rgb_rets.next();\r\n\r\n  ret[0] = ret[1] = ret[2] = 0.0;\r\n  h *= 360.0;\r\n\r\n  c = v*s;\r\n  x = c*(1.0 - Math.abs(((h/60.0)%2) - 1.0));\r\n  m = v - c;\r\n  let color;\r\n\r\n  function RgbF_Create(r, g, b) {\r\n    ret[0] = r;\r\n    ret[1] = g;\r\n    ret[2] = b;\r\n\r\n    return ret;\r\n  }\r\n\r\n  if (h >= 0.0 && h < 60.0) {\r\n    color = RgbF_Create(c + m, x + m, m);\r\n  } else if (h >= 60.0 && h < 120.0) {\r\n    color = RgbF_Create(x + m, c + m, m);\r\n  } else if (h >= 120.0 && h < 180.0) {\r\n    color = RgbF_Create(m, c + m, x + m);\r\n  } else if (h >= 180.0 && h < 240.0) {\r\n    color = RgbF_Create(m, x + m, c + m);\r\n  } else if (h >= 240.0 && h < 300.0) {\r\n    color = RgbF_Create(x + m, m, c + m);\r\n  } else if (h >= 300.0) {\r\n    color = RgbF_Create(c + m, m, x + m);\r\n  } else {\r\n    color = RgbF_Create(m, m, m);\r\n  }\r\n\r\n  return color;\r\n}\r\n\r\nlet rgb_to_cmyk_rets = util.cachering.fromConstructor(Vector4, 512);\r\nlet cmyk_to_rgb_rets = util.cachering.fromConstructor(Vector3, 512);\r\n\r\nexport function cmyk_to_rgb(c, m, y, k) {\r\n  let ret = cmyk_to_rgb_rets.next();\r\n\r\n  if (k === 1.0) {\r\n    ret.zero();\r\n    return ret;\r\n  }\r\n\r\n  c = c - c*k + k;\r\n  m = m - m*k + k;\r\n  y = y - y*k + k;\r\n\r\n  ret[0] = 1.0 - c;\r\n  ret[1] = 1.0 - m;\r\n  ret[2] = 1.0 - y;\r\n\r\n  return ret;\r\n}\r\n\r\nexport function rgb_to_cmyk(r, g, b) {\r\n  //CMYK and CMY values from 0 to 1\r\n  let ret = rgb_to_cmyk_rets.next();\r\n\r\n  let C = 1.0 - r;\r\n  let M = 1.0 - g;\r\n  let Y = 1.0 - b;\r\n\r\n  let var_K = 1\r\n\r\n  if (C < var_K) var_K = C\r\n  if (M < var_K) var_K = M\r\n  if (Y < var_K) var_K = Y\r\n  if (var_K === 1) { //Black\r\n    C = 0\r\n    M = 0\r\n    Y = 0\r\n  } else {\r\n    C = (C - var_K)/(1 - var_K)\r\n    M = (M - var_K)/(1 - var_K)\r\n    Y = (Y - var_K)/(1 - var_K)\r\n  }\r\n\r\n  let K = var_K\r\n\r\n  ret[0] = C;\r\n  ret[1] = M;\r\n  ret[2] = Y;\r\n  ret[3] = K;\r\n\r\n  return ret;\r\n}\r\n\r\n","import {CSSFont} from './ui_theme.js';\r\n\r\nexport const DefaultTheme = {\r\n  base: {\r\n    AreaHeaderBG        : 'rgba(200, 200, 200, 0.95)',\r\n    BasePackFlag        : 0,\r\n    BoxDepressed        : 'rgba(130,130,130, 1)',\r\n    BoxHighlight        : 'rgba(151,208,239, 1)',\r\n    \"flex-grow\"         : \"unset\",\r\n    DefaultText         : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 14,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n    LabelText           : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 14,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n    TitleText           : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 12,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n    'background-color'  : 'rgba(207,207,207, 0.5)',\r\n    'border-color'      : 'rgba(34,34,34, 1)',\r\n    'border-radius'     : 12.010619764585666,\r\n    'focus-border-width': 2,\r\n    oneAxisPadding      : 2,\r\n    padding             : 1,\r\n  },\r\n\r\n  button: {\r\n    DefaultText        : new CSSFont({\r\n      font   : 'poppins',\r\n      weight : 'bold',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 12,\r\n      color  : 'rgba(35,35,35, 1)'\r\n    }),\r\n    'background-color' : 'rgba(238,238,238, 0.8672412740773168)',\r\n    'border-color'     : 'rgba(255,255,255, 1)',\r\n    'border-radius'    : 4,\r\n    'border-style'     : 'solid',\r\n    'border-width'     : 2,\r\n    disabled           : {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgb(109,109,109)'\r\n      }),\r\n      'background-color': 'rgb(19,19,19)',\r\n      'border-color'    : '#f58f8f',\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 1,\r\n    },\r\n    height             : 25,\r\n    highlight          : {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgba(255,255,255, 1)'\r\n      }),\r\n      'background-color': 'rgba(138,222,255, 1)',\r\n      'border-color'    : 'rgba(255,255,255, 1)',\r\n      'border-radius'   : 4,\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 2,\r\n    },\r\n    'highlight-pressed': {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgba(35,35,35, 1)'\r\n      }),\r\n      'background-color': 'rgba(113,113,113, 1)',\r\n      'border-color'    : '#DADCE0',\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 1,\r\n    },\r\n    margin             : 4,\r\n    'margin-left'      : 4,\r\n    'margin-right'     : 4,\r\n    padding            : 1,\r\n    pressed            : {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgba(35,35,35, 1)'\r\n      }),\r\n      'background-color': 'rgba(113,113,113, 1)',\r\n      'border-color'    : '#DADCE0',\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 1,\r\n    },\r\n    width              : 25,\r\n  },\r\n\r\n  checkbox: {\r\n    CheckSide: 'left',\r\n    height   : 32,\r\n    width    : 32,\r\n    \"background-color\" : \"rgb(168,168,168)\",\r\n  },\r\n\r\n  colorfield: {\r\n    circleSize    : 11,\r\n    colorBoxHeight: 24,\r\n    fieldSize     : 400,\r\n    height        : 256,\r\n    hueHeight     : 32,\r\n    width         : 256,\r\n  },\r\n\r\n  colorpickerbutton: {\r\n    height: 32,\r\n    width : 95,\r\n  },\r\n\r\n  curvewidget: {\r\n    CanvasBG    : 'rgb(44,44,44)',\r\n    CanvasHeight: 256,\r\n    CanvasWidth : 256,\r\n  },\r\n\r\n  dropbox: {\r\n    dropTextBG: 'rgba(233,233,233, 1)',\r\n    height    : 25,\r\n    width     : 32,\r\n  },\r\n\r\n  iconbutton: {\r\n    highlight: {\r\n      'background-color': 'rgba(133,182,255,0.8)',\r\n      'border-color'    : 'black',\r\n      'border-radius'   : 5,\r\n      'border-width'    : 1,\r\n      height            : 32,\r\n      'margin-bottom'   : 1,\r\n      'margin-left'     : 2,\r\n      'margin-right'    : 2,\r\n      'margin-top'      : 1,\r\n      padding           : 2,\r\n      width             : 32,\r\n    },\r\n    depressed: {\r\n      'background-color': 'rgba(42,61,77,0.8)',\r\n      'border-color'    : 'black',\r\n      'border-radius'   : 5,\r\n      'border-width'    : 1,\r\n      height            : 32,\r\n      'margin-bottom'   : 1,\r\n      'margin-left'     : 2,\r\n      'margin-right'    : 2,\r\n      'margin-top'      : 1,\r\n      padding           : 2,\r\n      width             : 32,\r\n    },\r\n\r\n    'background-color': 'rgba(15,15,15, 0)',\r\n    'border-color'    : 'black',\r\n    'border-radius'   : 5,\r\n    'border-width'    : 1,\r\n    height            : 32,\r\n    'margin-bottom'   : 1,\r\n    'margin-left'     : 2,\r\n    'margin-right'    : 2,\r\n    'margin-top'      : 1,\r\n    padding           : 2,\r\n    width             : 32,\r\n  },\r\n\r\n  iconcheck: {\r\n    highlight         : {\r\n      'background-color': 'rgba(133,182,255,0.8)',\r\n      'border-color'    : 'black',\r\n      'border-radius'   : 5,\r\n      'border-width'    : 1,\r\n      height            : 32,\r\n      'margin-bottom'   : 1,\r\n      'margin-left'     : 2,\r\n      'margin-right'    : 2,\r\n      'margin-top'      : 1,\r\n      padding           : 2,\r\n      width             : 32,\r\n    },\r\n    depressed         : {\r\n      'background-color': 'rgba(42,61,77,0.8)',\r\n      'border-color'    : 'black',\r\n      'border-radius'   : 5,\r\n      'border-width'    : 1,\r\n      height            : 32,\r\n      'margin-bottom'   : 1,\r\n      'margin-left'     : 2,\r\n      'margin-right'    : 2,\r\n      'margin-top'      : 1,\r\n      padding           : 2,\r\n      width             : 32,\r\n    },\r\n    'background-color': 'rgba(15,15,15, 0)',\r\n    'border-color'    : 'rgba(237,209,209, 1)',\r\n    'border-radius'   : 5,\r\n    'border-width'    : 0,\r\n    drawCheck         : true,\r\n    height            : 32,\r\n    'margin-bottom'   : 1,\r\n    'margin-left'     : 2,\r\n    'margin-right'    : 2,\r\n    'margin-top'      : 1,\r\n    padding           : 2,\r\n    width             : 32,\r\n  },\r\n\r\n  label: {\r\n    LabelText: new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 14,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n  },\r\n\r\n  listbox: {\r\n    ListActive   : 'rgba(200, 205, 215, 1.0)',\r\n    ListHighlight: 'rgba(155, 220, 255, 0.5)',\r\n    height       : 200,\r\n    width        : 110,\r\n  },\r\n\r\n  menu: {\r\n    MenuBG          : 'rgba(250, 250, 250, 1.0)',\r\n    \"item-radius\"   : 0,\r\n    MenuBorder      : '1px solid grey',\r\n    MenuHighlight   : 'rgba(155, 220, 255, 1.0)',\r\n    MenuSeparator   : {\r\n      width             : \"100%\",\r\n      height            : 2,\r\n      padding           : 0,\r\n      margin            : 0,\r\n      border            : \"none\",\r\n      \"background-color\": \"grey\"\r\n    },\r\n    'box-shadow'    : '5px 5px 25px rgba(0,0,0,0.75)',\r\n    MenuSpacing     : 5,\r\n    MenuText        : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 12,\r\n      color  : 'rgba(25, 25, 25, 1.0)'\r\n    }),\r\n    \"padding-top\"   : 0,\r\n    \"padding-left\"  : 0,\r\n    \"padding-right\" : 0,\r\n    \"padding-bottom\": 0,\r\n    'border-color'  : 'grey',\r\n    'border-radius' : 5,\r\n    'border-style'  : 'solid',\r\n    'border-width'  : 1,\r\n  },\r\n\r\n  notification: {\r\n    DefaultText       : new CSSFont({\r\n      font   : 'poppins',\r\n      weight : 'bold',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 12,\r\n      color  : 'rgb(55,55,55)'\r\n    }),\r\n    \"background-color\": \"rgba(72,72,72,0)\",\r\n    \"border-radius\"   : 5,\r\n    \"border-color\"    : \"grey\",\r\n    \"border-width\"    : 1,\r\n    \"border-style\"    : \"solid\",\r\n    ProgressBarBG     : \"rgb(74,148,183)\",\r\n    ProgressBar       : \"rgb(250,132,58)\",\r\n  },\r\n\r\n  numslider: {\r\n    'background-color': 'rgba(219,219,219, 1)',\r\n    'border-color'    : 'black',\r\n    'border-radius'   : 1,\r\n    height            : 18,\r\n    width             : 90,\r\n  },\r\n\r\n  numslider_simple: {\r\n    SlideHeight       : 10,\r\n    TextBoxWidth      : 45,\r\n    'background-color': 'rgba(219,219,219, 1)',\r\n    height            : 18,\r\n    labelOnTop        : true,\r\n    width             : 135,\r\n  },\r\n\r\n  numslider_textbox: {\r\n    TextBoxHeight     : 25,\r\n    TextBoxWidth      : 50,\r\n    'background-color': 'rgba(219,219,219, 1)',\r\n    height            : 25,\r\n    labelOnTop        : true,\r\n    width             : 120,\r\n  },\r\n\r\n  panel: {\r\n    HeaderBorderRadius    : 5.329650280441558,\r\n    HeaderRadius          : 4,\r\n    TitleBackground       : 'rgba(177,219,255, 1)',\r\n    TitleBorder           : 'rgba(104,104,104, 1)',\r\n    TitleText             : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 14,\r\n      color  : 'rgba(0,0,0, 1)'\r\n    }),\r\n    'background-color'    : 'rgba(184,184,184, 0.7594818376068376)',\r\n    'border-color'        : 'rgba(0,0,0, 0.5598061397157866)',\r\n    'border-radius'       : 4,\r\n    'border-style'        : 'groove',\r\n    'border-width'        : 1.141,\r\n    'margin-bottom'       : 0,\r\n    'margin-bottom-closed': 0,\r\n    'margin-left'         : 5.6584810220495445,\r\n    'margin-right'        : 0,\r\n    'margin-top'          : 0,\r\n    'margin-top-closed'   : 0,\r\n    'padding-bottom'      : 0,\r\n    'padding-left'        : 0,\r\n    'padding-right'       : 0,\r\n    'padding-top'         : 0,\r\n  },\r\n\r\n  richtext: {\r\n    DefaultText       : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 16,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n    'background-color': 'rgb(245, 245, 245)',\r\n  },\r\n\r\n  screenborder: {\r\n    'border-inner'   : 'grey',\r\n    'border-outer'   : 'rgba(228,228,228, 1)',\r\n    'border-width'   : 2,\r\n    'mouse-threshold': 8,\r\n  },\r\n\r\n  scrollbars: {\r\n    border  : undefined,\r\n    color   : undefined,\r\n    color2  : undefined,\r\n    contrast: undefined,\r\n    width   : undefined,\r\n  },\r\n\r\n  sidebar: {\r\n    'background-color': 'rgba(55, 55, 55, 0.5)',\r\n  },\r\n\r\n  strip: {\r\n    'background-color': 'rgba(75,75,75, 0.33213141025641024)',\r\n    'border-color'    : 'rgba(0,0,0, 0.31325409987877156)',\r\n    'border-radius'   : 8.76503417507447,\r\n    'border-style'    : 'solid',\r\n    'border-width'    : 1,\r\n    margin            : 2,\r\n    oneAxisPadding    : 2,\r\n    padding           : 1,\r\n    \"flex-grow\"       : \"unset\",\r\n  },\r\n\r\n  tabs: {\r\n    \"movable-tabs\"    : \"true\",\r\n    TabActive         : 'rgba(212,212,212, 1)',\r\n    TabBarRadius      : 6,\r\n    TabHighlight      : 'rgba(50, 50, 50, 0.2)',\r\n    TabInactive       : 'rgba(183,183,183, 1)',\r\n    TabStrokeStyle1   : 'rgba(0,0,0, 1)',\r\n    TabStrokeStyle2   : 'rgba(0,0,0, 1)',\r\n    TabText           : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'bold',\r\n      style  : 'normal',\r\n      size   : 15,\r\n      color  : 'rgba(0,0,0, 1)'\r\n    }),\r\n    'background-color': 'rgba(222,222,222, 1)',\r\n  },\r\n\r\n  textbox: {\r\n    DefaultText       : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 14,\r\n      color  : 'rgba(3,3,3, 1)'\r\n    }),\r\n    'background-color': 'rgba(245,245,245, 1)',\r\n  },\r\n\r\n  tooltip: {\r\n    ToolTipText       : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'bold',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 12,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n    'background-color': 'rgba(255,255,255, 1)',\r\n    'border-color'    : 'rgba(139,139,139, 1)',\r\n    'border-radius'   : 3,\r\n    'border-style'    : 'solid',\r\n    'border-width'    : 1,\r\n    padding           : 5,\r\n  },\r\n\r\n  treeview: {\r\n    itemIndent: 10,\r\n    rowHeight : 18,\r\n  },\r\n\r\n  vecPopupButton: {\r\n    height : 18,\r\n    padding: 3,\r\n    width  : 100,\r\n  },\r\n\r\n};\r\n","\"use strict\";\r\n\r\n/*\r\nIcons are defined in spritesheets that live in\r\nthe iconsheet16/32 dom nodes.  Icons are numbered start from\r\nthe upper left sprite tile.\r\n\r\nThis function sets the mapping between icon numbers and names.\r\n\r\nThe following icons should be in the icon sheet and in this map:\r\n\r\nRESIZE      :\r\nSMALL_PLUS  :\r\nTRANSLATE   : for moving things\r\nUI_EXPAND   : panel open icon\r\nUI_COLLAPSE : panel close icon\r\nNOTE_EXCL   : exclamation mark for notifications\r\nHELP        : help symbol\r\n*/\r\nexport function setIconMap(icons) {\r\n  for (let k in icons) {\r\n    Icons[k] = icons[k];\r\n  }\r\n}\r\n\r\nlet a = 0;\r\nexport let Icons = {\r\n  FOLDER: a++,\r\n  FILE  : a++,\r\n  TINY_X: a++,\r\n\r\n  SMALL_PLUS : a++,\r\n  SMALL_MINUS: a++,\r\n  UNDO       : a++,\r\n\r\n  REDO: a++,\r\n  HELP: a++,\r\n\r\n  UNCHECKED   : a++,\r\n  CHECKED     : a++,\r\n  LARGE_CHECK : a++,\r\n  CURSOR_ARROW: a++,\r\n  NOTE_EXCL   : a++,\r\n  SCROLL_DOWN : a++,\r\n  SCROLL_UP   : a++,\r\n  BACKSPACE   : a++,\r\n  LEFT_ARROW  : a++,\r\n  RIGHT_ARROW : a++,\r\n  UI_EXPAND   : a++, //triangle\r\n  UI_COLLAPSE : a++, //triangle\r\n\r\n\r\n  BOLD         : a++,\r\n  ITALIC       : a++,\r\n  UNDERLINE    : a++,\r\n  STRIKETHRU   : a++,\r\n  TREE_EXPAND  : a++,\r\n  TREE_COLLAPSE: a++,\r\n  ZOOM_OUT     : a++,\r\n  ZOOM_IN      : a++\r\n};\r\n/* used for icon checkboxes with overlayed check marks */\r\nIcons.ENUM_CHECKED = Icons.CHECKED;\r\nIcons.ENUM_UNCHECKED = Icons.UNCHECKED;\r\n\r\n\r\n","let exclude = new Set([\r\n  \"toString\", \"constructor\", \"prototype\", \"__proto__\", \"toLocaleString\",\r\n  \"hasOwnProperty\", \"shadow\"\r\n]);\r\n\r\nlet UIBase = undefined;\r\n\r\n//deal with circular module refrence\r\nexport function _setUIBase(uibase) {\r\n  UIBase = uibase;\r\n}\r\n\r\nlet AspectKeys = Symbol(\"aspect-keys\");\r\n\r\nexport function initAspectClass(object, blacklist = new Set()) {\r\n  let cls = object.constructor;\r\n\r\n  if (!cls[AspectKeys]) {\r\n    cls[AspectKeys] = [];\r\n    let keys = [];\r\n\r\n    let p = object.__proto__;\r\n    while (p) {\r\n      keys = keys.concat(Reflect.ownKeys(p));\r\n      p = p.__proto__;\r\n    }\r\n    keys = new Set(keys);\r\n\r\n    function validProperty(obj, key) {\r\n      let descr = Object.getOwnPropertyDescriptor(obj, key);\r\n\r\n      if (descr && (descr.get || descr.set)) {\r\n        return false;\r\n      }\r\n\r\n      let p = obj.constructor;\r\n      do {\r\n        if (p.prototype) {\r\n          let descr = Object.getOwnPropertyDescriptor(p.prototype, key);\r\n\r\n          if (descr && (descr.set || descr.get)) {\r\n            return false;\r\n          }\r\n        }\r\n\r\n        p = p.__proto__;\r\n      } while (p && p !== p.__proto__);\r\n\r\n      return true;\r\n    }\r\n\r\n    for (let k of keys) {\r\n      let v;\r\n\r\n      if (typeof k === \"string\" && k.startsWith(\"_\")) {\r\n        continue;\r\n      }\r\n\r\n      if (k === \"constructor\") {\r\n        continue;\r\n      }\r\n\r\n      if (blacklist.has(k) || exclude.has(k)) {\r\n        continue;\r\n      }\r\n\r\n      if (!validProperty(object, k)) {\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        v = object[k];\r\n      } catch (error) {\r\n        continue;\r\n      }\r\n\r\n      if (typeof v !== \"function\") {\r\n        continue;\r\n      }\r\n\r\n      cls[AspectKeys].push(k);\r\n    }\r\n  }\r\n\r\n  object.__aspect_methods = new Set();\r\n\r\n  for (let k of cls[AspectKeys]) {\r\n    AfterAspect.bind(object, k);\r\n  }\r\n}\r\n\r\nexport function clearAspectCallbacks(obj) {\r\n  for (let key of obj.__aspect_methods) {\r\n    obj[key].clear();\r\n  }\r\n}\r\n\r\n/**\r\n *\r\n * example:\r\n *\r\n * someobject.update.after(() => {\r\n *   do_something();\r\n *   return someobject.update.value;\r\n * }\r\n *\r\n * */\r\nexport class AfterAspect {\r\n  constructor(owner, key) {\r\n    this.owner = owner;\r\n    this.key = key;\r\n\r\n    this.chain = [[owner[key], false]];\r\n    this.chain2 = [[owner[key], false]];\r\n\r\n    this.root = [[owner[key], false]];\r\n\r\n    let this2 = this;\r\n\r\n    let method = this._method = function () {\r\n      let chain = this2.chain;\r\n      let chain2 = this2.chain2;\r\n\r\n      chain2.length = chain.length;\r\n\r\n      for (let i = 0; i < chain.length; i++) {\r\n        chain2[i] = chain[i];\r\n      }\r\n\r\n      for (let i = 0; i < chain2.length; i++) {\r\n        let [cb, node, once] = chain2[i];\r\n\r\n        if (node) {\r\n          let isDead = !node.isConnected;\r\n\r\n          if (node instanceof UIBase) {\r\n            isDead = isDead || node.isDead();\r\n          }\r\n\r\n          if (isDead) {\r\n            console.warn(\"pruning dead AfterAspect callback\", node);\r\n            chain.remove(chain2[i]);\r\n            continue;\r\n          }\r\n        }\r\n\r\n\r\n        if (once && chain.indexOf(chain2[i]) >= 0) {\r\n          chain.remove(chain2[i]);\r\n        }\r\n\r\n        if (cb && cb.apply) {\r\n          method.value = cb.apply(this, arguments);\r\n          //method.value = Reflect.apply(cb, this, arguments);\r\n          //cb.apply(this, args);\r\n        }\r\n      }\r\n\r\n      let ret = method.value;\r\n      method.value = undefined;\r\n\r\n      return ret;\r\n    };\r\n\r\n    this._method_bound = false;\r\n\r\n    method.after = this.after.bind(this);\r\n    method.once = this.once.bind(this);\r\n    method.remove = this.remove.bind(this);\r\n\r\n    owner[key].after = this.after.bind(this);\r\n    owner[key].once = this.once.bind(this);\r\n    owner[key].remove = this.remove.bind(this);\r\n  }\r\n\r\n  static bind(owner, key) {\r\n    owner.__aspect_methods.add(key);\r\n\r\n    return new AfterAspect(owner, key);\r\n  }\r\n\r\n  remove(cb) {\r\n    for (let item of this.chain) {\r\n      if (item[0] === cb) {\r\n        this.chain.remove(item);\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  once(cb, node) {\r\n    return this.after(cb, node, true);\r\n  }\r\n\r\n  _checkbind() {\r\n    if (!this._method_bound) {\r\n      this.owner[this.key] = this._method;\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this._checkbind();\r\n    this.chain = [[this.root[0][0], this.root[0][1]]];\r\n    this.chain2 = [[this.root[0][0], this.root[0][1]]];\r\n\r\n    return this;\r\n  }\r\n\r\n  before(cb, node, once) {\r\n    this._checkbind();\r\n\r\n    if (cb === undefined) {\r\n      console.warn(\"invalid call to .after(); cb was undefined\");\r\n      return;\r\n    }\r\n    this.chain = [[cb, node, once]].concat(this.chain);\r\n  }\r\n\r\n  after(cb, node, once) {\r\n    this._checkbind();\r\n\r\n    if (cb === undefined) {\r\n      console.warn(\"invalid call to .after(); cb was undefined\");\r\n      return;\r\n    }\r\n    this.chain.push([cb, node, once]);\r\n  }\r\n}\r\n","import {contextWrangler} from '../screen/area_wrangler.js';\r\n\r\nlet _ui_base = undefined;\r\n\r\n//avoid circular module references\r\nlet TextBox = undefined;\r\n\r\nexport function _setTextboxClass(cls) {\r\n  TextBox = cls;\r\n}\r\n\r\n//import * as ui_save from './ui_save.js';\r\n\r\n/*\r\nif (window.document && document.body) {\r\n  console.log(\"ensuring body.style.margin/padding are zero\");\r\n  document.body.style[\"margin\"] = \"0px\";\r\n  document.body.style[\"padding\"] = \"0px\";\r\n}\r\n */\r\n\r\nimport * as cssutils from '../path-controller/util/cssutils.js';\r\nimport {Animator} from \"./anim.js\";\r\nimport './units.js';\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as math from '../path-controller/util/math.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport * as controller from '../path-controller/controller/controller.js';\r\nimport {\r\n  pushModalLight, popModalLight, copyEvent, pathDebugEvent,\r\n  haveModal, keymap, reverse_keymap, pushPointerModal\r\n} from '../path-controller/util/simple_events.js';\r\nimport {getDataPathToolOp} from '../path-controller/controller/controller.js';\r\nimport * as units from './units.js';\r\nimport {rgb_to_hsv, hsv_to_rgb} from \"../util/colorutils.js\";\r\n\r\nexport * from './ui_theme.js';\r\n\r\nimport {CSSFont, theme, parsepx, compatMap} from \"./ui_theme.js\";\r\n\r\nimport {DefaultTheme} from './theme.js';\r\n\r\n//global list of elements to, hopefully, prevent minification tree shaking\r\n//of live elements\r\nexport let ElementClasses = [];\r\n\r\nexport {theme} from \"./ui_theme.js\";\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nwindow.__cconst = cconst;\r\n\r\nlet Vector4 = vectormath.Vector4;\r\n\r\nexport {Icons} from '../icon_enum.js';\r\nimport {Icons} from '../icon_enum.js';\r\n\r\nexport {setIconMap} from '../icon_enum.js';\r\nimport {setIconMap} from '../icon_enum.js';\r\n\r\nimport {AfterAspect, initAspectClass} from \"./aspect.js\";\r\nimport * as aspect from './aspect.js';\r\n\r\nconst EnumProperty = toolprop.EnumProperty;\r\n\r\nlet Area;\r\nexport let _setAreaClass = (cls) => {\r\n  Area = cls;\r\n}\r\n\r\nexport const ErrorColors = {\r\n  WARNING: \"yellow\",\r\n  ERROR  : \"red\",\r\n  OK     : \"green\"\r\n};\r\n\r\nwindow.__theme = theme;\r\n\r\nlet registered_has_happened = false;\r\nlet tagPrefix = \"\";\r\nconst EventCBSymbol = Symbol(\"wrapped event callback\");\r\n\r\nfunction calcElemCBKey(elem, type, options) {\r\n  return elem._id + \":\" + type + \":\" + JSON.stringify(options || {});\r\n}\r\n\r\n/**\r\n * Sets tag prefix for pathux html elements.\r\n * Must be called prior to loading other modules.\r\n * Since this is tricky, you can alternatively\r\n * add a script tag with the prefix with the id \"pathux-tag-prefix\",\r\n * e.g.<pre> <script type=\"text/plain\" id=\"pathux-tag-prefix\">prefix</script> </pre>\r\n * */\r\nexport function setTagPrefix(prefix) {\r\n  if (registered_has_happened) {\r\n    throw new Error(\"have to call ui_base.setTagPrefix before loading any other path.ux modules\");\r\n  }\r\n\r\n  tagPrefix = \"\" + prefix;\r\n}\r\n\r\nexport function getTagPrefix(prefix) {\r\n  return tagPrefix;\r\n}\r\n\r\nlet prefix = document.getElementById(\"pathux-tag-prefix\");\r\nif (prefix) {\r\n  console.log(\"Found pathux-tag-prefix element\");\r\n  prefix = prefix.innerText.trim();\r\n  setTagPrefix(prefix);\r\n}\r\n\r\nexport const ClassIdSymbol = Symbol(\"pathux-class-id\");\r\nlet class_idgen = 1;\r\n\r\nexport function setTheme(theme2) {\r\n  //merge theme\r\n  for (let k in theme2) {\r\n    let v = theme2[k];\r\n\r\n    if (typeof v !== \"object\") {\r\n      theme[k] = v;\r\n      continue;\r\n    }\r\n\r\n    let v0 = theme[k];\r\n\r\n    if (!(k in theme)) {\r\n      theme[k] = {};\r\n    }\r\n\r\n    for (let k2 in v) {\r\n      //if (v0 && !(k2 in v0)) {\r\n      //  continue;\r\n      //}\r\n\r\n      if (k2 in compatMap) {\r\n        let k3 = compatMap[k2];\r\n\r\n        if (v[k3] === undefined) {\r\n          v[k3] = v[k2];\r\n        }\r\n\r\n        delete v[k2];\r\n        k2 = k3;\r\n      }\r\n\r\n      theme[k][k2] = v[k2];\r\n    }\r\n  }\r\n}\r\n\r\nsetTheme(DefaultTheme);\r\n\r\nlet _last_report = util.time_ms();\r\n\r\nexport function report() {\r\n  if (util.time_ms() - _last_report > 350) {\r\n    console.warn(...arguments);\r\n    _last_report = util.time_ms();\r\n  }\r\n}\r\n\r\n//this function is deprecated\r\nexport function getDefault(key, elem) {\r\n  console.warn(\"Deprecated call to ui_base.js:getDefault\");\r\n\r\n  if (key in theme.base) {\r\n    return theme.base[key];\r\n  } else {\r\n    throw new Error(\"Unknown default \" + key);\r\n  }\r\n}\r\n\r\n//XXX implement me!\r\nexport function IsMobile() {\r\n  console.warn(\"ui_base.IsMobile is deprecated; use util.isMobile instead\")\r\n  return util.isMobile();\r\n};\r\n\r\nlet keys = [\"margin\", \"padding\", \"margin-block-start\", \"margin-block-end\"];\r\nkeys = keys.concat([\"padding-block-start\", \"padding-block-end\"]);\r\n\r\nkeys = keys.concat([\"margin-left\", \"margin-top\", \"margin-bottom\", \"margin-right\"]);\r\nkeys = keys.concat([\"padding-left\", \"padding-top\", \"padding-bottom\", \"padding-right\"]);\r\nexport const marginPaddingCSSKeys = keys;\r\n\r\n\r\nclass _IconManager {\r\n  constructor(image, tilesize, number_of_horizontal_tiles, drawsize) {\r\n    this.tilex = number_of_horizontal_tiles;\r\n    this.tilesize = tilesize;\r\n    this.drawsize = drawsize;\r\n\r\n    this.customIcons = new Map();\r\n\r\n    this.image = image;\r\n    this.promise = undefined;\r\n    this._accept = undefined;\r\n    this._reject = undefined;\r\n  }\r\n\r\n  get ready() {\r\n    return this.image && this.image.width;\r\n  }\r\n\r\n  onReady() {\r\n    if (this.ready) {\r\n      return new Promise((accept, reject) => {\r\n        accept(this);\r\n      });\r\n    }\r\n\r\n    if (this.promise) {\r\n      return this.promise;\r\n    }\r\n\r\n    let onload = this.image.onload;\r\n    this.image.onload = (e) => {\r\n      if (onload) {\r\n        onload.call(this.image, e);\r\n      }\r\n\r\n      if (!this._accept) {\r\n        return;\r\n      }\r\n\r\n      let accept = this._accept;\r\n      this._accept = this._reject = this.promise = undefined;\r\n\r\n      if (this.image.width) {\r\n        accept(this);\r\n      }\r\n    }\r\n\r\n    this.promise = new util.TimeoutPromise((accept, reject) => {\r\n      this._accept = accept;\r\n      this._reject = reject;\r\n    }, 15000, true); /* silently rejects on timeout */\r\n\r\n    this.promise.catch(error => {\r\n      util.print_stack(error);\r\n      this.promise = this._accept = this._reject = undefined;\r\n    });\r\n\r\n    return this.promise;\r\n  }\r\n\r\n  canvasDraw(elem, canvas, g, icon, x = 0, y = 0) {\r\n    let customIcon = this.customIcons.get(icon);\r\n\r\n    if (customIcon) {\r\n      g.drawImage(customIcon.canvas, x, y);\r\n      return;\r\n    }\r\n\r\n    let tx = icon%this.tilex;\r\n    let ty = ~~(icon/this.tilex);\r\n\r\n    let dpi = elem.getDPI();\r\n    let ts = this.tilesize;\r\n    let ds = this.drawsize;\r\n\r\n    if (!this.image) {\r\n      //console.warn(\"Failed to render an iconsheet\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      g.drawImage(this.image, tx*ts, ty*ts, ts, ts, x, y, ds*dpi, ds*dpi);\r\n    } catch (error) {\r\n      console.log(\"failed to draw an icon\");\r\n    }\r\n  }\r\n\r\n  setCSS(icon, dom, fitsize = undefined) {\r\n    if (!fitsize) {\r\n      fitsize = this.drawsize;\r\n    }\r\n\r\n    if (typeof fitsize === \"object\") {\r\n      fitsize = Math.max(fitsize[0], fitsize[1]);\r\n    }\r\n\r\n    dom.style[\"background\"] = this.getCSS(icon, fitsize);\r\n    if (this.customIcons.has(icon)) {\r\n      dom.style[\"background-size\"] = (fitsize) + \"px\";\r\n    } else {\r\n      dom.style[\"background-size\"] = (fitsize*this.tilex) + \"px\";\r\n    }\r\n\r\n    dom.style[\"background-clip\"] = \"content-box\";\r\n\r\n    if (!dom.style[\"width\"]) {\r\n      dom.style[\"width\"] = this.drawsize + \"px\";\r\n    }\r\n    if (!dom.style[\"height\"]) {\r\n      dom.style[\"height\"] = this.drawsize + \"px\";\r\n    }\r\n  }\r\n\r\n  //icon is an integer\r\n  getCSS(icon, fitsize = this.drawsize) {\r\n    if (icon === -1) { //-1 means no icon\r\n      return '';\r\n    }\r\n\r\n    if (typeof fitsize === \"object\") {\r\n      fitsize = Math.max(fitsize[0], fitsize[1]);\r\n    }\r\n\r\n    let ratio = fitsize/this.tilesize;\r\n\r\n    let customIcon = this.customIcons.get(icon);\r\n    if (customIcon !== undefined) {\r\n      //ratio = fitsize / this.drawsize;\r\n      //let d = this.drawsize*0.25;\r\n      let d = 0.0;\r\n\r\n      let css = `url(\"${customIcon.blobUrl}\")`;\r\n\r\n      return css;\r\n    }\r\n\r\n    let x = (-(icon%this.tilex)*this.tilesize)*ratio;\r\n    let y = (-(~~(icon/this.tilex))*this.tilesize)*ratio;\r\n\r\n    //x = ~~x;\r\n    //y = ~~y;\r\n\r\n    //console.log(this.tilesize, this.drawsize, x, y);\r\n    //let ts = this.tilesize;\r\n    //return `image('${this.image.src}#xywh=${x},${y},${ts},${ts}')`;\r\n    return `url(\"${this.image.src}\") ${x}px ${y}px`;\r\n  }\r\n}\r\n\r\nexport class CustomIcon {\r\n  constructor(manager, key, id, baseImage) {\r\n    this.key = key;\r\n    this.baseImage = baseImage;\r\n    this.images = []\r\n    this.id = id;\r\n    this.manager = manager;\r\n  }\r\n\r\n  regenIcons() {\r\n    let manager = this.manager;\r\n\r\n    let doSheet = (sheet) => {\r\n      let size = sheet.drawsize;\r\n      let canvas = document.createElement(\"canvas\");\r\n      let g = canvas.getContext(\"2d\");\r\n\r\n      canvas.width = canvas.height = size;\r\n      g.drawImage(this.baseImage, 0, 0, size, size);\r\n\r\n      canvas.toBlob((blob) => {\r\n        let blobUrl = URL.createObjectURL(blob);\r\n\r\n        sheet.customIcons.set(this.id, {\r\n          blobUrl,\r\n          canvas\r\n        });\r\n      })\r\n    }\r\n\r\n    for (let sheet of manager.iconsheets) {\r\n      doSheet(sheet);\r\n    }\r\n  }\r\n}\r\n\r\nexport class IconManager {\r\n  /**\r\n   images is a list of dom ids of img tags\r\n\r\n   sizes is a list of tile sizes, one per image.\r\n   you can control the final *draw* size by passing an array\r\n   of [tilesize, drawsize] instead of just a number.\r\n   */\r\n  constructor(images, sizes, horizontal_tile_count) {\r\n    this.iconsheets = [];\r\n    this.tilex = horizontal_tile_count;\r\n\r\n    this.customIcons = new Map();\r\n    this.customIconIDMap = new Map();\r\n\r\n    for (let i = 0; i < images.length; i++) {\r\n      let size, drawsize;\r\n\r\n      if (typeof sizes[i] == \"object\") {\r\n        size = sizes[i][0], drawsize = sizes[i][1];\r\n      } else {\r\n        size = drawsize = sizes[i];\r\n      }\r\n\r\n      if (util.isMobile()) {\r\n        drawsize = ~~(drawsize*theme.base.mobileSizeMultiplier);\r\n      }\r\n\r\n      this.iconsheets.push(new _IconManager(images[i], size, horizontal_tile_count, drawsize));\r\n    }\r\n  }\r\n\r\n  isReady(sheet = 0) {\r\n    return this.iconsheets[sheet].ready;\r\n  }\r\n\r\n  addCustomIcon(key, image) {\r\n    let icon = this.customIcons.get(key);\r\n\r\n    if (!icon) {\r\n      let maxid = 0;\r\n\r\n      for (let k in Icons) {\r\n        maxid = Math.max(maxid, Icons[k] + 1);\r\n      }\r\n      for (let icon of this.customIcons.values()) {\r\n        maxid = Math.max(maxid, icon.id + 1);\r\n      }\r\n\r\n      maxid = Math.max(maxid, 1000); //just to be on the safe side\r\n\r\n      let id = maxid;\r\n      icon = new CustomIcon(this, key, id, image);\r\n\r\n      this.customIcons.set(key, icon);\r\n      this.customIconIDMap.set(id, icon);\r\n    }\r\n\r\n    icon.baseImage = image;\r\n    icon.regenIcons();\r\n\r\n    return icon.id;\r\n  }\r\n\r\n  load(manager2) {\r\n    this.iconsheets = manager2.iconsheets;\r\n    this.tilex = manager2.tilex;\r\n\r\n    return this;\r\n  }\r\n\r\n  reset(horizontal_tile_count) {\r\n    this.iconsheets.length = 0;\r\n    this.tilex = horizontal_tile_count;\r\n  }\r\n\r\n  add(image, size, drawsize = size) {\r\n    this.iconsheets.push(new _IconManager(image, size, this.tilex, drawsize));\r\n    return this;\r\n  }\r\n\r\n  canvasDraw(elem, canvas, g, icon, x = 0, y = 0, sheet = 0) {\r\n    let base = this.iconsheets[sheet];\r\n\r\n    sheet = this.findSheet(sheet);\r\n    let ds = sheet.drawsize;\r\n\r\n    sheet.drawsize = base.drawsize;\r\n    sheet.canvasDraw(elem, canvas, g, icon, x, y);\r\n    sheet.drawsize = ds;\r\n  }\r\n\r\n  findClosestSheet(size) {\r\n    let sheets = this.iconsheets.concat([]);\r\n\r\n    sheets.sort((a, b) => a.drawsize - b.drawsize);\r\n    let sheet;\r\n\r\n    for (let i = 0; i < sheets.length; i++) {\r\n      if (sheets[i].drawsize <= size) {\r\n        sheet = sheets[i];\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (!sheet)\r\n      sheet = sheets[sheets.length - 1];\r\n\r\n    return this.iconsheets.indexOf(sheet);\r\n  }\r\n\r\n  findSheet(sheet) {\r\n    if (sheet === undefined) {\r\n      console.warn(\"sheet was undefined\");\r\n      sheet = 0;\r\n    }\r\n\r\n    let base = this.iconsheets[sheet];\r\n\r\n    /**sigh**/\r\n    let dpi = UIBase.getDPI();\r\n    let minsheet = undefined;\r\n    let goal = dpi*base.drawsize;\r\n\r\n    for (let sheet of this.iconsheets) {\r\n      minsheet = sheet;\r\n\r\n      if (sheet.drawsize >= goal) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return minsheet === undefined ? base : minsheet;\r\n  }\r\n\r\n  getTileSize(sheet = 0) {\r\n    return this.iconsheets[sheet].drawsize;\r\n    return this.findSheet(sheet).drawsize;\r\n  }\r\n\r\n  getRealSize(sheet = 0) {\r\n    return this.iconsheets[sheet].tilesize;\r\n    return this.findSheet(sheet).tilesize;\r\n    //return this.iconsheets[sheet].tilesize;\r\n  }\r\n\r\n  //icon is an integer\r\n  getCSS(icon, sheet = 0) {\r\n    //return this.iconsheets[sheet].getCSS(icon);\r\n    //return this.findSheet(sheet).getCSS(icon);\r\n\r\n    let base = this.iconsheets[sheet];\r\n    sheet = this.findSheet(sheet);\r\n    let ds = sheet.drawsize;\r\n\r\n    sheet.drawsize = base.drawsize;\r\n    let ret = sheet.getCSS(icon);\r\n    sheet.drawsize = ds;\r\n\r\n    return ret;\r\n  }\r\n\r\n  setCSS(icon, dom, sheet = 0, fitsize = undefined) {\r\n    //return this.iconsheets[sheet].setCSS(icon, dom);\r\n\r\n    let base = this.iconsheets[sheet];\r\n    sheet = this.findSheet(sheet);\r\n    let ds = sheet.drawsize;\r\n\r\n    sheet.drawsize = base.drawsize;\r\n    let ret = sheet.setCSS(icon, dom, fitsize);\r\n    sheet.drawsize = ds;\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nexport let iconmanager = new IconManager([\r\n  document.getElementById(\"iconsheet16\"),\r\n  document.getElementById(\"iconsheet32\"),\r\n  document.getElementById(\"iconsheet48\")\r\n], [16, 32, 64], 16);\r\n\r\nwindow._iconmanager = iconmanager; //debug global\r\n\r\n//if client code overrides iconsheets, they must follow logical convention\r\n//that the first one is \"small\" and the second is \"large\"\r\nexport let IconSheets = {\r\n  SMALL : 0,\r\n  LARGE : 1,\r\n  XLARGE: 2\r\n};\r\n\r\nexport function iconSheetFromPackFlag(flag) {\r\n  if (flag & PackFlags.CUSTOM_ICON_SHEET) {\r\n    //console.log(\"Custom Icon Sheet:\", flag>>PackFlags.CUSTOM_ICON_SHEET_START);\r\n    return flag>>PackFlags.CUSTOM_ICON_SHEET_START;\r\n  }\r\n\r\n  if ((flag & PackFlags.SMALL_ICON) && !(PackFlags.LARGE_ICON)) {\r\n    return 0//IconSheets.SMALL; //0\r\n  } else {\r\n    return 1//IconSheets.LARGE; //1\r\n  }\r\n}\r\n\r\nexport function getIconManager() {\r\n  return iconmanager;\r\n}\r\n\r\nexport function setIconManager(manager, IconSheetsOverride) {\r\n  iconmanager.load(manager);\r\n\r\n  if (IconSheetsOverride !== undefined) {\r\n    for (let k in IconSheetsOverride) {\r\n      IconSheets[k] = IconSheetsOverride[k];\r\n    }\r\n  }\r\n}\r\n\r\nexport function makeIconDiv(icon, sheet = 0) {\r\n  let size = iconmanager.getRealSize(sheet);\r\n\r\n  let drawsize = iconmanager.getTileSize(sheet);\r\n\r\n  let icontest = document.createElement(\"div\");\r\n\r\n  icontest.style[\"width\"] = icontest.style[\"min-width\"] = drawsize + \"px\";\r\n  icontest.style[\"height\"] = icontest.style[\"min-height\"] = drawsize + \"px\";\r\n\r\n  //icontest.style[\"background-color\"] = \"orange\";\r\n\r\n  icontest.style[\"margin\"] = \"0px\";\r\n  icontest.style[\"padding\"] = \"0px\";\r\n\r\n  iconmanager.setCSS(icon, icontest, sheet);\r\n\r\n  return icontest;\r\n}\r\n\r\nlet Vector2 = vectormath.Vector2;\r\nlet Matrix4 = vectormath.Matrix4;\r\n\r\nexport let dpistack = [];\r\n\r\nexport const UIFlags = {};\r\n\r\nconst internalElementNames = {};\r\nconst externalElementNames = {};\r\n\r\nexport const PackFlags = {\r\n  INHERIT_WIDTH : 1,\r\n  INHERIT_HEIGHT: 2,\r\n  VERTICAL      : 4,\r\n  USE_ICONS     : 8,\r\n  SMALL_ICON    : 16,\r\n  LARGE_ICON    : 32,\r\n\r\n  FORCE_PROP_LABELS         : 64, //force propeties (Container.prototype.prop()) to always have labels\r\n  PUT_FLAG_CHECKS_IN_COLUMNS: 128, //group flag property checkmarks in columns (doesn't apply to icons)\r\n\r\n  WRAP_CHECKBOXES: 256,\r\n\r\n  //internal flags\r\n  STRIP_HORIZ            : 512,\r\n  STRIP_VERT             : 1024,\r\n  STRIP                  : 512 | 1024,\r\n  SIMPLE_NUMSLIDERS      : 2048,\r\n  FORCE_ROLLER_SLIDER    : 4096,\r\n  HIDE_CHECK_MARKS       : (1<<13),\r\n  NO_NUMSLIDER_TEXTBOX   : (1<<14),\r\n  CUSTOM_ICON_SHEET      : 1<<15,\r\n  CUSTOM_ICON_SHEET_START: 20, //custom icon sheet bits are shifted to here\r\n  NO_UPDATE              : 1<<16\r\n};\r\n\r\nlet first = (iter) => {\r\n  if (iter === undefined) {\r\n    return undefined;\r\n  }\r\n\r\n  if (!(Symbol.iterator in iter)) {\r\n    for (let item in iter) {\r\n      return item;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  for (let item of iter) {\r\n    return item;\r\n  }\r\n}\r\n\r\nimport {DataPathError} from '../path-controller/controller/controller.js';\r\nimport {TimeoutPromise} from '../path-controller/util/util.js';\r\n\r\nlet _mobile_theme_patterns = [\r\n  /.*width.*/,\r\n  /.*height.*/,\r\n  /.*size.*/,\r\n  /.*margin.*/,\r\n  /.*pad/,\r\n  /.*radius.*/\r\n];\r\n\r\n\r\nlet _idgen = 0;\r\n\r\nwindow._testSetScrollbars = function (color = \"grey\", contrast = 0.5, width = 15, border = \"solid\") {\r\n  let buf = styleScrollBars(color, undefined, contrast, width, border, \"*\");\r\n  CTX.screen.mergeGlobalCSS(buf);\r\n\r\n  //document.body.style[\"overflow\"] = \"scroll\";\r\n\r\n  /*\r\n  if (!window._tsttag) {\r\n    window._tsttag = document.createElement(\"style\");\r\n    document.body.prepend(_tsttag);\r\n  }\r\n\r\n  _tsttag.textContent = buf;\r\n  //*/\r\n\r\n  return buf;\r\n};\r\n\r\nexport function styleScrollBars(color = \"grey\", color2 = undefined, contrast = 0.5, width = 15,\r\n                                border                                                    = \"1px groove black\", selector = \"*\") {\r\n\r\n  if (!color2) {\r\n    let c = css2color(color);\r\n    let a = c.length > 3 ? c[3] : 1.0;\r\n\r\n    c = rgb_to_hsv(c[0], c[1], c[2]);\r\n    let inv = c.slice(0, c.length);\r\n\r\n    inv[2] = 1.0 - inv[2];\r\n    inv[2] += (c[2] - inv[2])*(1.0 - contrast);\r\n\r\n    inv = hsv_to_rgb(inv[0], inv[1], inv[2]);\r\n\r\n    inv.length = 4;\r\n    inv[3] = a;\r\n\r\n    inv = color2css(inv);\r\n    color2 = inv;\r\n  }\r\n\r\n  let buf = `\r\n\r\n${selector} {\r\n  scrollbar-width : ${width <= 16 ? 'thin' : 'auto'};\r\n  scrollbar-color : ${color2} ${color};\r\n}\r\n\r\n${selector}::-webkit-scrollbar {\r\n  width : ${width}px;\r\n  background-color : ${color};\r\n}\r\n\r\n${selector}::-webkit-scrollbar-track {\r\n  background-color : ${color};\r\n  border : ${border};\r\n}\r\n\r\n${selector}::-webkit-scrollbar-thumb {\r\n  background-color : ${color2};\r\n  border : ${border};\r\n}\r\n    `;\r\n\r\n  //console.log(buf);\r\n  return buf;\r\n}\r\n\r\nwindow.styleScrollBars = styleScrollBars;\r\n\r\nlet _digest = new util.HashDigest();\r\n\r\nexport function calcThemeKey(digest = _digest.reset()) {\r\n  for (let k in theme) {\r\n    let obj = theme[k];\r\n\r\n    if (typeof obj !== \"object\") {\r\n      continue;\r\n    }\r\n\r\n    for (let k2 in obj) {\r\n      let v2 = obj[k2];\r\n\r\n      if (typeof v2 === \"number\" || typeof v2 === \"boolean\" || typeof v2 === \"string\") {\r\n        digest.add(v2);\r\n      } else if (typeof v2 === \"object\" && v2 instanceof CSSFont) {\r\n        v2.calcHashUpdate(digest);\r\n      }\r\n    }\r\n  }\r\n\r\n  return digest.get();\r\n}\r\n\r\nexport var _themeUpdateKey = calcThemeKey();\r\n\r\nexport function flagThemeUpdate() {\r\n  _themeUpdateKey = calcThemeKey();\r\n}\r\n\r\nexport class UIBase extends HTMLElement {\r\n  constructor() {\r\n    super();\r\n\r\n    this._modalstack = [];\r\n\r\n    this._tool_tip_abort_delay = undefined;\r\n    this._tooltip_ref = undefined;\r\n\r\n    this._textBoxEvents = false;\r\n\r\n    this._themeOverride = undefined;\r\n\r\n    this._checkTheme = true;\r\n    this._last_theme_update_key = _themeUpdateKey;\r\n\r\n    this._client_disabled_set = undefined;\r\n    //this._parent_disabled_set = 0;\r\n\r\n    this._useNativeToolTips = cconst.useNativeToolTips;\r\n    this._useNativeToolTips_set = false;\r\n    this._has_own_tooltips = undefined;\r\n    this._tooltip_timer = util.time_ms();\r\n\r\n    this.pathUndoGen = 0;\r\n    this._lastPathUndoGen = 0;\r\n    this._useDataPathUndo = undefined;\r\n\r\n    this._active_animations = [];\r\n\r\n    //ref to Link element referencing Screen style node\r\n    //Screen.update_intern sets the contents of this\r\n    this._screenStyleTag = document.createElement(\"style\");\r\n    this._screenStyleUpdateHash = 0;\r\n\r\n    initAspectClass(this, new Set([\"appendChild\", \"animate\", \"shadow\", \"removeNode\", \"prepend\", \"add\", \"init\"]));\r\n\r\n    this.shadow = this.attachShadow({mode: 'open'});\r\n\r\n    if (cconst.DEBUG.paranoidEvents) {\r\n      this.__cbs = [];\r\n    }\r\n\r\n    this.shadow.appendChild(this._screenStyleTag);\r\n    this.shadow._appendChild = this.shadow.appendChild;\r\n\r\n    ///*\r\n    let appendChild = this.shadow.appendChild;\r\n    this.shadow.appendChild = (child) => {\r\n      if (child && typeof child === \"object\" && child instanceof UIBase) {\r\n        child.parentWidget = this;\r\n      }\r\n\r\n      return this.shadow._appendChild(child, ...arguments);\r\n    };\r\n    //*/\r\n\r\n    this._wasAddedToNodeAtSomeTime = false;\r\n\r\n    this.visibleToPick = true;\r\n\r\n    this._override_class = undefined;\r\n    this.parentWidget = undefined;\r\n\r\n    /*\r\n    this.shadow._appendChild = this.shadow.appendChild;\r\n    this.shadow.appendChild = (child) => {\r\n      if (child instanceof UIBase) {\r\n        child.ctx = this.ctx;\r\n        child.parentWidget = this;\r\n\r\n        if (child._useDataPathUndo === undefined) {\r\n          child.useDataPathUndo = this.useDataPathUndo;\r\n        }\r\n      }\r\n\r\n      return this.shadow._appendChild(child);\r\n    };\r\n    //*/\r\n\r\n    let tagname = this.constructor.define().tagname;\r\n    this._id = tagname.replace(/\\-/g, \"_\") + (_idgen++);\r\n\r\n    this.default_overrides = {}; //inherited by child widgets\r\n    this.my_default_overrides = {}; //not inherited to child widgets\r\n    this.class_default_overrides = {};\r\n\r\n    this._last_description = undefined;\r\n    this._description_final = undefined;\r\n\r\n    //getting css to flow down properly can be a pain, so\r\n    //some packing settings are set as bitflags here,\r\n    //see PackFlags\r\n\r\n    /*\r\n    setInterval(() => {\r\n      this.update();\r\n    }, 200);\r\n    //*/\r\n\r\n    this._modaldata = undefined;\r\n    this.packflag = this.getDefault(\"BasePackFlag\");\r\n    this._internalDisabled = false;\r\n    this.__disabledState = false;\r\n    this._disdata = undefined;\r\n    this._ctx = undefined;\r\n\r\n    this._description = undefined;\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n    .DefaultText {\r\n      font: ` + _getFont(this) + `;\r\n    }\r\n    `;\r\n    this.shadow.appendChild(style);\r\n    this._init_done = false;\r\n\r\n    //make default touch handlers that send mouse events\r\n    let do_touch = (e, type, button) => {\r\n      if (haveModal()) {\r\n        return;\r\n      }\r\n\r\n      button = button === undefined ? 0 : button;\r\n      let e2 = copyEvent(e);\r\n\r\n      if (e.touches.length === 0) {\r\n        //hrm, what to do, what to do. . .\r\n      } else {\r\n        let t = e.touches[0];\r\n\r\n        e2.pageX = t.pageX;\r\n        e2.pageY = t.pageY;\r\n        e2.screenX = t.screenX;\r\n        e2.screenY = t.screenY;\r\n        e2.clientX = t.clientX;\r\n        e2.clientY = t.clientY;\r\n        e2.x = t.x;\r\n        e2.y = t.y;\r\n      }\r\n\r\n      e2.button = button;\r\n\r\n      e2 = new MouseEvent(type, e2);\r\n\r\n      e2.was_touch = true;\r\n      e2.stopPropagation = e.stopPropagation.bind(e);\r\n      e2.preventDefault = e.preventDefault.bind(e);\r\n      e2.touches = e.touches;\r\n\r\n      this.dispatchEvent(e2);\r\n    };\r\n\r\n    this.addEventListener(\"touchstart\", (e) => {\r\n      do_touch(e, \"mousedown\", 0);\r\n    }, {passive: false});\r\n    this.addEventListener(\"touchmove\", (e) => {\r\n      do_touch(e, \"mousemove\");\r\n    }, {passive: false});\r\n    this.addEventListener(\"touchcancel\", (e) => {\r\n      do_touch(e, \"mouseup\", 2);\r\n    }, {passive: false});\r\n    this.addEventListener(\"touchend\", (e) => {\r\n      do_touch(e, \"mouseup\", 0);\r\n    }, {passive: false});\r\n  }\r\n\r\n  /*\r\n  set default_overrides(v) {\r\n    console.error(\"default_overrides was set\", v);\r\n    this._default_overrides = v;\r\n  }\r\n\r\n  get default_overrides() {\r\n    return this._default_overrides;\r\n  }//*/\r\n\r\n  get useNativeToolTips() {\r\n    return this._useNativeToolTips;\r\n  }\r\n\r\n  set useNativeToolTips(val) {\r\n    this._useNativeToolTips = val;\r\n    this._useNativeToolTips_set = true;\r\n  }\r\n\r\n  get parentWidget() {\r\n    return this._parentWidget;\r\n  }\r\n\r\n  set parentWidget(val) {\r\n    if (val) {\r\n      this._wasAddedToNodeAtSomeTime = true;\r\n    }\r\n\r\n    this._parentWidget = val;\r\n  }\r\n\r\n  get useDataPathUndo() {\r\n    let p = this;\r\n\r\n    while (p) {\r\n      if (p._useDataPathUndo !== undefined) {\r\n        return p._useDataPathUndo;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   causes calls to setPathValue to go through\r\n   toolpath app.datapath_set(path=\"\" newValueJSON=\"\")\r\n\r\n   every child will inherit\r\n   */\r\n  set useDataPathUndo(val) {\r\n    this._useDataPathUndo = val;\r\n  }\r\n\r\n  get description() {\r\n\r\n    return this._description;\r\n  }\r\n\r\n  set description(val) {\r\n    if (val === null) {\r\n      this._description = undefined;\r\n      return;\r\n    }\r\n\r\n    this._description = val;\r\n\r\n    if (val === undefined || val === null) {\r\n      return;\r\n    }\r\n\r\n    if (cconst.showPathsInToolTips && this.hasAttribute(\"datapath\")) {\r\n      let s = \"\" + this._description;\r\n\r\n      let path = this.getAttribute(\"datapath\");\r\n      s += \"\\n    path: \" + path;\r\n\r\n      if (this.hasAttribute(\"mass_set_path\")) {\r\n        let m = this.getAttribute(\"mass_set_path\");\r\n        s += \"\\n    massSetPath: \" + m;\r\n      }\r\n\r\n      this._description_final = s;\r\n    }\r\n\r\n    if (cconst.useNativeToolTips) {\r\n      this.title = \"\" + this._description_final;\r\n    }\r\n  }\r\n\r\n  get background() {\r\n    return this.__background;\r\n  }\r\n\r\n  set background(bg) {\r\n    this.__background = bg;\r\n\r\n    this.overrideDefault(\"background-color\", bg, true);\r\n    this.style[\"background-color\"] = bg;\r\n  }\r\n\r\n  get disabled() {\r\n    //hrm, I could just propegate checks upward. . .\r\n\r\n    if (this.parentWidget && this.parentWidget.disabled) {\r\n      return true;\r\n    }\r\n\r\n    return !!this._client_disabled_set || !!this._internalDisabled;// || !!this._parent_disabled_set;\r\n  }\r\n\r\n  set disabled(v) {\r\n    this._client_disabled_set = v;\r\n    this.__updateDisable(this.disabled);\r\n  }\r\n\r\n  get internalDisabled() {\r\n    return this._internalDisabled;\r\n  }\r\n\r\n  set internalDisabled(val) {\r\n    this._internalDisabled = !!val;\r\n\r\n    this.__updateDisable(this.disabled);\r\n  }\r\n\r\n  get ctx() {\r\n    return this._ctx;\r\n  }\r\n\r\n  set ctx(c) {\r\n    this._ctx = c;\r\n\r\n    this._forEachChildWidget((n) => {\r\n      n.ctx = c;\r\n    });\r\n  }\r\n\r\n  get _reportCtxName() {\r\n    return \"\" + this._id;\r\n  }\r\n\r\n  get modalRunning() {\r\n    return this._modaldata !== undefined;\r\n  }\r\n\r\n  static getIconEnum() {\r\n    return Icons;\r\n  }\r\n\r\n  static setDefault(element) {\r\n    return element;\r\n  }\r\n\r\n  /**DEPRECATED\r\n\r\n   scaling ratio (e.g. for high-resolution displays)\r\n   */\r\n  static getDPI() {\r\n    //if (dpistack.length > 0) {\r\n    //  return dpistack[this.dpistack.length-1];\r\n    //} else {\r\n    //if (util.isMobile()) {\r\n    return window.devicePixelRatio; // * visualViewport.scale;\r\n    //}\r\n\r\n    return window.devicePixelRatio;\r\n    //}\r\n  }\r\n\r\n  static prefix(name) {\r\n    return tagPrefix + name;\r\n  }\r\n\r\n  static internalRegister(cls) {\r\n    cls[ClassIdSymbol] = class_idgen++;\r\n\r\n    registered_has_happened = true;\r\n\r\n    internalElementNames[cls.define().tagname] = this.prefix(cls.define().tagname);\r\n    customElements.define(this.prefix(cls.define().tagname), cls);\r\n  }\r\n\r\n  static getInternalName(name) {\r\n    return internalElementNames[name];\r\n  }\r\n\r\n  static createElement(name, internal = false) {\r\n    if (!internal && name in externalElementNames) {\r\n      return document.createElement(name);\r\n    } else if (name in internalElementNames) {\r\n      return document.createElement(internalElementNames[name]);\r\n    } else {\r\n      return document.createElement(name)\r\n    }\r\n  }\r\n\r\n  static register(cls) {\r\n    registered_has_happened = true;\r\n\r\n    cls[ClassIdSymbol] = class_idgen++;\r\n\r\n    ElementClasses.push(cls);\r\n\r\n    externalElementNames[cls.define().tagname] = cls.define().tagname;\r\n    customElements.define(cls.define().tagname, cls);\r\n  }\r\n\r\n  /**\r\n   * Defines core attributes of the class\r\n   *\r\n   * @example\r\n   *\r\n   * static define() {return {\r\n   *   tagname             : \"custom-element-x\",\r\n   *   style               : \"[style class in theme]\"\r\n   *   subclassChecksTheme : boolean //set to true to disable base class invokation of checkTheme()\r\n   *   havePickClipboard   : boolean //whether element supports mouse hover copy/paste\r\n   *   pasteForAllChildren : boolean //mouse hover paste happens even over child widgets\r\n   *   copyForAllChildren  : boolean //mouse hover copy happens even over child widgets\r\n   * }}\r\n   */\r\n  static define() {\r\n    throw new Error(\"Missing define() for ux element\");\r\n  }\r\n\r\n  setUndo(val) {\r\n    this.useDataPathUndo = val;\r\n    return this;\r\n  }\r\n\r\n  hide(sethide = true) {\r\n    this.hidden = sethide;\r\n\r\n    for (let n of this.shadow.childNodes) {\r\n      n.hidden = sethide;\r\n    }\r\n\r\n    this._forEachChildWidget((n) => {\r\n      n.hide(sethide);\r\n    })\r\n  }\r\n\r\n  getElementById(id) {\r\n    let ret;\r\n\r\n    let rec = (n) => {\r\n      if (ret) {\r\n        return;\r\n      }\r\n\r\n      if (n.getAttribute(\"id\") === id || n.id === id) {\r\n        ret = n;\r\n      }\r\n\r\n      if (n instanceof UIBase && n.constructor.define().tagname === \"panelframe-x\") {\r\n        rec(n.contents);\r\n      } else if (n instanceof UIBase && n.constructor.define().tagname === \"tabcontainer-x\") {\r\n        for (let k in n.tabs) {\r\n          let tab = n.tabs[k];\r\n\r\n          if (tab) {\r\n            rec(tab);\r\n          }\r\n        }\r\n      }\r\n\r\n      for (let n2 of n.childNodes) {\r\n        if (n2 instanceof HTMLElement) {\r\n          rec(n2);\r\n\r\n          if (ret) {\r\n            break;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (n.shadow) {\r\n        for (let n2 of n.shadow.childNodes) {\r\n          if (n2 instanceof HTMLElement) {\r\n            rec(n2);\r\n\r\n            if (ret) {\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    rec(this);\r\n\r\n    return ret;\r\n  }\r\n\r\n  unhide() {\r\n    this.hide(false);\r\n  }\r\n\r\n  findArea() {\r\n    let p = this;\r\n\r\n    while (p) {\r\n      if (p instanceof Area) {\r\n        return p;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    return p;\r\n  }\r\n\r\n  addEventListener(type, cb, options) {\r\n    if (cconst.DEBUG.domEventAddRemove) {\r\n      console.log(\"addEventListener\", type, this._id, options);\r\n    }\r\n\r\n    let cb2 = (e) => {\r\n      if (cconst.DEBUG.paranoidEvents) {\r\n        if (this.isDead()) {\r\n          this.removeEventListener(type, cb, options);\r\n          return;\r\n        }\r\n      }\r\n\r\n      if (cconst.DEBUG.domEvents) {\r\n        pathDebugEvent(e);\r\n      }\r\n\r\n      let area = this.findArea();\r\n\r\n      if (area) {\r\n        area.push_ctx_active();\r\n        try {\r\n          let ret = cb(e);\r\n          area.pop_ctx_active();\r\n          return ret;\r\n        } catch (error) {\r\n          area.pop_ctx_active();\r\n          throw error;\r\n        }\r\n      } else {\r\n        if (cconst.DEBUG.areaContextPushes) {\r\n          console.warn(\"Element is not part of an area?\", element);\r\n        }\r\n\r\n        return cb(e);\r\n      }\r\n    };\r\n\r\n    if (!cb[EventCBSymbol]) {\r\n      cb[EventCBSymbol] = new Map();\r\n    }\r\n\r\n    let key = calcElemCBKey(this, type, options);\r\n    cb[EventCBSymbol].set(key, cb2);\r\n\r\n    if (cconst.DEBUG.paranoidEvents) {\r\n      this.__cbs.push([type, cb2, options]);\r\n    }\r\n\r\n    return super.addEventListener(type, cb2, options);\r\n  }\r\n\r\n  removeEventListener(type, cb, options) {\r\n    if (cconst.DEBUG.paranoidEvents) {\r\n      for (let item of this.__cbs) {\r\n        if (item[0] == type && item[1] === cb._cb2 && (\"\" + item[2]) === (\"\" + options)) {\r\n          this.__cbs.remove(item);\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (cconst.DEBUG.domEventAddRemove) {\r\n      console.log(\"removeEventListener\", type, this._id, options);\r\n    }\r\n\r\n    let key = calcElemCBKey(this, type, options);\r\n\r\n    if (!cb[EventCBSymbol] || !cb[EventCBSymbol].has(key)) {\r\n      return super.removeEventListener(type, cb, options);\r\n    } else {\r\n      let cb2 = cb[EventCBSymbol].get(key);\r\n\r\n      let ret = super.removeEventListener(type, cb2, options);\r\n\r\n      cb[EventCBSymbol].delete(key);\r\n      return ret;\r\n    }\r\n  }\r\n\r\n  connectedCallback() {\r\n\r\n  }\r\n\r\n  noMarginsOrPadding() {\r\n    return;\r\n    let keys = [\"margin\", \"padding\", \"margin-block-start\", \"margin-block-end\"];\r\n    keys = keys.concat([\"padding-block-start\", \"padding-block-end\"]);\r\n\r\n    keys = keys.concat([\"margin-left\", \"margin-top\", \"margin-bottom\", \"margin-right\"]);\r\n    keys = keys.concat([\"padding-left\", \"padding-top\", \"padding-bottom\", \"padding-right\"]);\r\n\r\n    for (let k of keys) {\r\n      this.style[k] = \"0px\";\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * find owning screen and tell it to update\r\n   * the global tab order\r\n   * */\r\n  regenTabOrder() {\r\n    let screen = this.getScreen();\r\n    if (screen !== undefined) {\r\n      screen.needsTabRecalc = true;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  noMargins() {\r\n    this.style[\"margin\"] = this.style[\"margin-left\"] = this.style[\"margin-right\"] = \"0px\";\r\n    this.style[\"margin-top\"] = this.style[\"margin-bottom\"] = \"0px\";\r\n    return this;\r\n  }\r\n\r\n  noPadding() {\r\n    this.style[\"padding\"] = this.style[\"padding-left\"] = this.style[\"padding-right\"] = \"0px\";\r\n    this.style[\"padding-top\"] = this.style[\"padding-bottom\"] = \"0px\";\r\n    return this;\r\n  }\r\n\r\n  getTotalRect() {\r\n    let found = false;\r\n\r\n    let min = new Vector2([1e17, 1e17]);\r\n    let max = new Vector2([-1e17, -1e17]);\r\n\r\n    let doaabb = (n) => {\r\n      let rs = n.getClientRects();\r\n\r\n      for (let r of rs) {\r\n        min[0] = Math.min(min[0], r.x);\r\n        min[1] = Math.min(min[1], r.y);\r\n        max[0] = Math.max(max[0], r.x + r.width);\r\n        max[1] = Math.max(max[1], r.y + r.height);\r\n\r\n        found = true;\r\n      }\r\n    };\r\n\r\n    doaabb(this);\r\n\r\n    this._forEachChildWidget((n) => {\r\n      doaabb(n);\r\n    });\r\n\r\n    if (found) {\r\n      return {\r\n        width : max[0] - min[0],\r\n        height: max[1] - min[1],\r\n        x     : min[0],\r\n        y     : min[1],\r\n        left  : min[0],\r\n        top   : min[1],\r\n        right : max[0],\r\n        bottom: max[1]\r\n      };\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  parseNumber(value, args = {}) {\r\n    value = (\"\" + value).trim().toLowerCase();\r\n\r\n    let baseUnit = args.baseUnit || this.baseUnit;\r\n    let isInt = args.isInt || this.isInt;\r\n\r\n    let sign = 1.0;\r\n\r\n    if (value.startsWith(\"-\")) {\r\n      value = value.slice(1, value.length).trim();\r\n      sign = -1;\r\n    }\r\n\r\n    let hexre = /-?[0-9a-f]+h$/;\r\n\r\n    if (value.startsWith(\"0b\")) {\r\n      value = value.slice(2, value.length).trim();\r\n      value = parseInt(value, 2);\r\n    } else if (value.startsWith(\"0x\")) {\r\n      value = value.slice(2, value.length).trim();\r\n      value = parseInt(value, 16);\r\n    } else if (value.search(hexre) === 0) {\r\n      value = value.slice(0, value.length - 1).trim();\r\n      value = parseInt(value, 16);\r\n    } else {\r\n      value = units.parseValue(value, baseUnit);\r\n    }\r\n\r\n    if (isInt) {\r\n      value = ~~value;\r\n    }\r\n\r\n    return value*sign;\r\n  }\r\n\r\n  formatNumber(value, args = {}) {\r\n    let baseUnit = args.baseUnit || this.baseUnit;\r\n    let displayUnit = args.displayUnit || this.displayUnit;\r\n    let isInt = args.isInt || this.isInt;\r\n    let radix = args.radix || this.radix || 10;\r\n    let decimalPlaces = args.decimalPlaces || this.decimalPlaces;\r\n\r\n    //console.log(this.baseUnit, this.displayUnit);\r\n\r\n    if (isInt && radix !== 10) {\r\n      let ret = Math.floor(value).toString(radix);\r\n\r\n      if (radix === 2)\r\n        return \"0b\" + ret;\r\n      else if (radix === 16)\r\n        return ret + \"h\";\r\n    }\r\n\r\n    return units.buildString(value, baseUnit, decimalPlaces, displayUnit);\r\n  }\r\n\r\n  setBoxCSS(subkey) {\r\n    let boxcode = '';\r\n\r\n    //debugger;\r\n\r\n    let keys = [\"left\", \"right\", \"top\", \"bottom\"];\r\n\r\n    let sub;\r\n    if (subkey) {\r\n      sub = this.getAttribute(subkey) || {};\r\n    }\r\n\r\n    let def = (key) => {\r\n      if (sub) {\r\n        return this.getSubDefault(subkey, key);\r\n      }\r\n\r\n      return this.getDefault(key);\r\n    }\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let key = i ? \"padding\" : \"margin\";\r\n\r\n      this.style[key] = \"unset\";\r\n\r\n      let val = def(key);\r\n      if (val !== undefined) { //handle default first\r\n        for (let j = 0; j < 4; j++) {\r\n          this.style[key + \"-\" + keys[j]] = val + \"px\";\r\n        }\r\n      }\r\n\r\n      for (let j = 0; j < 4; j++) { //now do box sides\r\n        let key2 = `${key}-${keys[j]}`;\r\n        let val2 = def(key2);\r\n\r\n        if (val2 !== undefined) {\r\n          this.style[key2] = val2 + \"px\";\r\n        }\r\n      }\r\n\r\n    }\r\n\r\n    this.style[\"border-radius\"] = def(\"border-radius\") + \"px\";\r\n    this.style[\"border\"] = `${def(\"border-width\")}px ${def(\"border-style\")} ${def(\"border-color\")}`;\r\n  }\r\n\r\n  genBoxCSS(subkey) {\r\n    let boxcode = '';\r\n\r\n    let keys = [\"left\", \"right\", \"top\", \"bottom\"];\r\n\r\n    let sub;\r\n    if (subkey) {\r\n      sub = this.getAttribute(subkey) || {};\r\n    }\r\n\r\n    let def = (key) => {\r\n      if (sub) {\r\n        return this.getSubDefault(subkey, key);\r\n      }\r\n\r\n      return this.getDefault(key);\r\n    }\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let key = i ? \"padding\" : \"margin\";\r\n\r\n      let val = def(key);\r\n      if (val !== undefined) {\r\n        boxcode += `${key}: ${val} px;\\n`;\r\n      }\r\n\r\n      for (let j = 0; j < 4; j++) {\r\n        let key2 = `${key}-${keys[j]}`;\r\n        let val2 = def(key2);\r\n\r\n        if (val2 !== undefined) {\r\n          boxcode += `${key2}: ${val}px;\\n`;\r\n        }\r\n      }\r\n    }\r\n\r\n    boxcode += `border-radius: ${def(\"border-radius\")}px;\\n`;\r\n    boxcode += `border: ${def(\"border-width\")}px ${def(\"border-style\")} ${def(\"border-color\")};\\n`;\r\n\r\n    return boxcode;\r\n  }\r\n\r\n  setCSS(setBG = true) {\r\n    if (setBG) {\r\n      let bg = this.getDefault(\"background-color\");\r\n      if (bg) {\r\n        this.style[\"background-color\"] = bg;\r\n      }\r\n    }\r\n\r\n    let zoom = this.getZoom();\r\n    if (zoom === 1.0) {\r\n      return;\r\n    }\r\n\r\n    let transform = \"\" + this.style[\"transform\"];\r\n\r\n    //try to preserve user set transform by selectively deleting scale\r\n    //kind of hackish. . .\r\n\r\n    //normalize whitespace\r\n    transform = transform.replace(/[ \\t\\n\\r]+/g, ' ');\r\n    transform = transform.replace(/, /g, ',');\r\n\r\n    //cut out scale\r\n    let transform2 = transform.replace(/scale\\([^)]+\\)/, '').trim();\r\n    this.style[\"transform\"] = transform2 + ` scale(${zoom},${zoom})`;\r\n  }\r\n\r\n  flushSetCSS() {\r\n    //check init\r\n    this._init();\r\n\r\n    this.setCSS();\r\n\r\n    this._forEachChildWidget((c) => {\r\n      if (!(c.packflag & PackFlags.NO_UPDATE)) {\r\n        c.flushSetCSS();\r\n      }\r\n    });\r\n  }\r\n\r\n  /* Why is the DOM API argument order swapped here?*/\r\n  replaceChild(newnode, node) {\r\n    for (let i = 0; i < this.childNodes.length; i++) {\r\n      if (this.childNodes[i] === node) {\r\n        super.replaceChild(newnode, node);\r\n        return true;\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < this.shadow.childNodes.length; i++) {\r\n      if (this.shadow.childNodes[i] === node) {\r\n        this.shadow.replaceChild(newnode, node);\r\n        return true;\r\n      }\r\n    }\r\n\r\n    console.error(\"Unknown child node\", node);\r\n    return false;\r\n  }\r\n\r\n  swapWith(b) {\r\n    let p1 = this.parentNode;\r\n    let p2 = b.parentNode;\r\n\r\n    if (this.parentWidget && (p1 === this.parentWidget.shadow) || p1 === null) {\r\n      p1 = this.parentWidget;\r\n    }\r\n\r\n    if (b.parentWidget && (p2 === b.parentWidget.shadow) || p2 === null) {\r\n      p2 = b.parentWidget;\r\n    }\r\n\r\n    if (!p1 || !p2) {\r\n      console.error(\"Invalid call to UIBase.prototype.swapWith\", this, b, p1, p2);\r\n      return false;\r\n    }\r\n\r\n    let getPos = (n, p) => {\r\n      let i = Array.prototype.indexOf.call(p.childNodes, n);\r\n\r\n      if (i < 0 && p.shadow) {\r\n        p = p.shadow;\r\n        i = Array.prototype.indexOf.call(p.childNodes, n);\r\n      }\r\n\r\n      return [i, p];\r\n    }\r\n\r\n    let [i1, n1] = getPos(this, p1);\r\n    let [i2, n2] = getPos(b, p2);\r\n\r\n    console.log(\"i1, i2, n1, n2\", i1, i2, n1, n2);\r\n\r\n    let tmp1 = document.createElement(\"div\");\r\n    let tmp2 = document.createElement(\"div\");\r\n\r\n    n1.insertBefore(tmp1, this);\r\n    n2.insertBefore(tmp2, b);\r\n\r\n    //HTMLElement.prototype.remove.call(this);\r\n    //HTMLElement.prototype.remove.call(b);\r\n\r\n    n1.replaceChild(b, tmp1);\r\n    n2.replaceChild(this, tmp2);\r\n\r\n    let ptmp = this.parentWidget;\r\n    this.parentWidget = b.parentWidget;\r\n    b.parentWidget = ptmp;\r\n\r\n    tmp1.remove();\r\n    tmp2.remove();\r\n\r\n    return true;\r\n  }\r\n\r\n  traverse(type_or_set) {\r\n    let this2 = this;\r\n\r\n    let classes = type_or_set;\r\n\r\n    let is_set = type_or_set instanceof Set;\r\n    is_set = is_set || type_or_set instanceof util.set;\r\n    is_set = is_set || Array.isArray(type_or_set);\r\n\r\n    if (!is_set) {\r\n      classes = [type_or_set];\r\n    }\r\n\r\n    let visit = new Set();\r\n\r\n    return (function* () {\r\n      let stack = [this2];\r\n\r\n      while (stack.length > 0) {\r\n        let n = stack.pop();\r\n\r\n        visit.add(n);\r\n\r\n        if (!n || !n.childNodes) {\r\n          continue;\r\n        }\r\n\r\n        for (let cls of classes) {\r\n          if (n instanceof cls) {\r\n            yield n;\r\n          }\r\n        }\r\n\r\n        for (let c of n.childNodes) {\r\n          if (!visit.has(c)) {\r\n            stack.push(c);\r\n          }\r\n        }\r\n\r\n        if (n.shadow) {\r\n          for (let c of n.shadow.childNodes) {\r\n            if (!visit.has(c)) {\r\n              stack.push(c);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    })();\r\n  }\r\n\r\n  appendChild(child) {\r\n    if (child instanceof UIBase) {\r\n      child.ctx = this.ctx;\r\n      child.parentWidget = this;\r\n\r\n      child.useDataPathUndo = this.useDataPathUndo;\r\n    }\r\n\r\n    return super.appendChild(child);\r\n  }\r\n\r\n  _clipboardHotkeyInit() {\r\n    this._clipboard_over = false;\r\n    this._last_clipboard_keyevt = undefined;\r\n\r\n    this._clipboard_keystart = () => {\r\n      if (this._clipboard_events) {\r\n        return;\r\n      }\r\n\r\n      this._clipboard_events = true;\r\n      window.addEventListener(\"keydown\", this._clipboard_keydown, {capture: true, passive: false});\r\n    }\r\n\r\n    this._clipboard_keyend = () => {\r\n      if (!this._clipboard_events) {\r\n        return;\r\n      }\r\n\r\n      this._clipboard_events = false;\r\n      window.removeEventListener(\"keydown\", this._clipboard_keydown, {capture: true, passive: false});\r\n    }\r\n\r\n    this._clipboard_keydown = (e, internal_mode) => {\r\n      if (!this.isConnected || !cconst.getClipboardData) {\r\n        this._clipboard_keyend();\r\n        return;\r\n      }\r\n\r\n      if (e === this._last_clipboard_keyevt || !this._clipboard_over) {\r\n        return;\r\n      }\r\n\r\n      /* the user's mouse cursor might not be over the element\r\n      *  if they've tabbed to it */\r\n\r\n      let is_copy = e.keyCode === keymap[\"C\"] && (e.ctrlKey || e.commandKey) && !e.shiftKey && !e.altKey;\r\n      let is_paste = e.keyCode === keymap[\"V\"] && (e.ctrlKey || e.commandKey) && !e.shiftKey && !e.altKey;\r\n\r\n      if (!is_copy && !is_paste) {\r\n        //early out, remember that pickElement is highly expensive to run\r\n        return;\r\n      }\r\n\r\n      //pasteForAllChildren\r\n      if (!internal_mode) {\r\n        let screen = this.ctx.screen;\r\n        let elem = screen.pickElement(screen.mpos[0], screen.mpos[1]);\r\n\r\n        let checkTree = is_paste && this.constructor.define().pasteForAllChildren;\r\n        checkTree = checkTree || (is_copy && this.constructor.define().copyForAllChildren);\r\n\r\n        while (checkTree && !(elem instanceof TextBox) && elem !== this && elem.parentWidget) {\r\n          console.log(\"  \" + elem._id);\r\n\r\n          elem = elem.parentWidget;\r\n        }\r\n\r\n        console.warn(\"COLOR\", this._id, elem._id);\r\n\r\n        if (elem !== this) {\r\n          //remove global keyhandler\r\n          this._clipboard_keyend();\r\n          return;\r\n        }\r\n      } else {\r\n        console.warn(\"COLOR\", this._id);\r\n      }\r\n\r\n      this._last_clipboard_keyevt = e;\r\n\r\n      if (is_copy) {\r\n        this.clipboardCopy();\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n\r\n      if (is_paste) {\r\n        this.clipboardPaste();\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n    }\r\n\r\n    let start = (e) => {\r\n      this._clipboard_over = true;\r\n      this._clipboard_keystart();\r\n    }\r\n\r\n    let stop = (e) => {\r\n      this._clipboard_over = false;\r\n      this._clipboard_keyend();\r\n    }\r\n\r\n    this.tabIndex = 0; //enable self key events when element has focus\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      return this._clipboard_keydown(e, true);\r\n    });\r\n\r\n    this.addEventListener(\"pointerover\", start, {capture: true, passive: true});\r\n    this.addEventListener(\"pointerout\", stop, {capture: true, passive: true});\r\n    this.addEventListener(\"focus\", stop, {capture: true, passive: true});\r\n  }\r\n\r\n  /** set havePickClipboard to true in define() to\r\n   *  enable mouseover pick clipboarding */\r\n  clipboardCopy() {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  clipboardPaste() {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  //delayed init\r\n  init() {\r\n    this._init_done = true;\r\n\r\n    if (!this.hasAttribute(\"id\") && this._id) {\r\n      this.setAttribute(\"id\", this._id);\r\n    }\r\n\r\n    if (this.constructor.define().havePickClipboard) {\r\n      this._clipboardHotkeyInit();\r\n    }\r\n  }\r\n\r\n  _ondestroy() {\r\n    if (this.tabIndex >= 0) {\r\n      this.regenTabOrder();\r\n    }\r\n\r\n    if (cconst.DEBUG.paranoidEvents) {\r\n      for (let item of this.__cbs) {\r\n        this.removeEventListener(item[0], item[1], item[2]);\r\n      }\r\n\r\n      this.__cbs = [];\r\n    }\r\n\r\n\r\n    if (this.ondestroy !== undefined) {\r\n      this.ondestroy();\r\n    }\r\n  }\r\n\r\n  remove(trigger_on_destroy = true) {\r\n    if (this.tabIndex >= 0) {\r\n      this.regenTabOrder();\r\n    }\r\n\r\n    super.remove();\r\n\r\n    if (trigger_on_destroy) {\r\n      this._ondestroy();\r\n    }\r\n\r\n    if (this.on_remove) {\r\n      this.on_remove();\r\n    }\r\n\r\n    this.parentWidget = undefined;\r\n  }\r\n\r\n  /*\r\n  *\r\n  * called when elements are removed.\r\n  * you should assume the element will be reused later;\r\n  * on_destroy is the callback for when elements are permanently destroyed\r\n  * */\r\n  on_remove() {\r\n\r\n  }\r\n\r\n  removeChild(child, trigger_on_destroy = true) {\r\n    super.removeChild(child);\r\n\r\n    if (trigger_on_destroy) {\r\n      child._ondestroy();\r\n    }\r\n  }\r\n\r\n  flushUpdate(force = false) {\r\n    //check init\r\n    this._init();\r\n\r\n    this.update();\r\n\r\n    this._forEachChildWidget((c) => {\r\n      if (force || !(c.packflag & PackFlags.NO_UPDATE)) {\r\n        if (!c.ctx) {\r\n          c.ctx = this.ctx;\r\n        }\r\n\r\n        c.flushUpdate(force);\r\n      }\r\n    });\r\n  }\r\n\r\n  //used by container nodes\r\n  /**\r\n   * Iterates over all child widgets,\r\n   * including ones that might be inside\r\n   * of normal DOM nodes.\r\n   *\r\n   * This is done by recursing into the dom\r\n   * tree and stopping at any node that's\r\n   * descended from ui_base.UIBase\r\n   **/\r\n  _forEachChildWidget(cb, thisvar) {\r\n    let rec = (n) => {\r\n      if (n instanceof UIBase) {\r\n        if (thisvar !== undefined) {\r\n          cb.call(thisvar, n);\r\n        } else {\r\n          cb(n);\r\n        }\r\n      } else {\r\n        for (let n2 of n.childNodes) {\r\n          rec(n2);\r\n        }\r\n\r\n        if (n.shadow !== undefined) {\r\n          for (let n2 of n.shadow.childNodes) {\r\n            rec(n2);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    for (let n of this.childNodes) {\r\n      rec(n);\r\n    }\r\n\r\n    if (this.shadow) {\r\n      for (let n of this.shadow.childNodes) {\r\n        rec(n);\r\n      }\r\n    }\r\n  }\r\n\r\n  checkInit() {\r\n    return this._init();\r\n  }\r\n\r\n  _init() {\r\n    if (this._init_done) {\r\n      return false;\r\n    }\r\n\r\n    this._init_done = true;\r\n    this.init();\r\n\r\n    return true;\r\n  }\r\n\r\n  getWinWidth() {\r\n    return window.innerWidth;\r\n  }\r\n\r\n  getWinHeight() {\r\n    return window.innerHeight;\r\n  }\r\n\r\n  calcZ() {\r\n    let p = this;\r\n    let n = this;\r\n\r\n    while (n) {\r\n      if (n.style && n.style[\"z-index\"]) {\r\n        let z = parseFloat(n.style[\"z-index\"]);\r\n        return z;\r\n      }\r\n\r\n      n = n.parentNode;\r\n\r\n      if (!n) {\r\n        n = p = p.parentWidget;\r\n      }\r\n    }\r\n\r\n    return 0;\r\n  }\r\n\r\n  pickElement(x, y, args = {}, marginy = 0, nodeclass = UIBase, excluded_classes = undefined) {\r\n    let marginx;\r\n    let clip;\r\n    let mouseEvent;\r\n    let isMouseMove, isMouseDown;\r\n\r\n    if (typeof args === \"object\") {\r\n      marginx = args.sx || 0;\r\n      marginy = args.sy || 0;\r\n      nodeclass = args.nodeclass || UIBase;\r\n      excluded_classes = args.excluded_classes;\r\n      clip = args.clip;\r\n      mouseEvent = args.mouseEvent;\r\n    } else {\r\n      marginx = args;\r\n\r\n      args = {\r\n        marginx         : marginx || 0,\r\n        marginy         : marginy || 0,\r\n        nodeclass       : nodeclass || UIBase,\r\n        excluded_classes: excluded_classes,\r\n        clip            : clip\r\n      }\r\n    }\r\n\r\n    if (mouseEvent) {\r\n      isMouseMove = mouseEvent.type === \"mousemove\" || mouseEvent.type === \"touchmove\" || mouseEvent.type === \"pointermove\";\r\n      isMouseDown = mouseEvent.buttons || (mouseEvent.touches && mouseEvent.touches.length > 0);\r\n    }\r\n\r\n    x -= window.scrollX;\r\n    y -= window.scrollY;\r\n\r\n    let elem = document.elementFromPoint(x, y);\r\n\r\n    if (!elem) {\r\n      return;\r\n    }\r\n\r\n    let path = [elem];\r\n    let lastelem = elem;\r\n    let i = 0;\r\n\r\n    while (elem.shadow) {\r\n      if (i++ > 1000) {\r\n        console.error(\"Infinite loop error\");\r\n        break;\r\n      }\r\n\r\n      elem = elem.shadow.elementFromPoint(x, y);\r\n\r\n      if (elem === lastelem) {\r\n        break;\r\n      }\r\n\r\n      if (elem) {\r\n        path.push(elem);\r\n      }\r\n\r\n      lastelem = elem;\r\n    }\r\n\r\n    path.reverse();\r\n\r\n    //console.warn(path);\r\n\r\n    for (let i = 0; i < path.length; i++) {\r\n      let node = path[i];\r\n      let ok = node instanceof nodeclass;\r\n\r\n      if (excluded_classes) {\r\n        for (let cls of excluded_classes) {\r\n          ok = ok && !(node instanceof cls);\r\n        }\r\n      }\r\n\r\n      if (clip) {\r\n        let rect = node.getBoundingClientRect();\r\n        let clip2 = math.aabb_intersect_2d(clip.pos, clip.size, [rect.x, rect.y], [rect.width, rect.height]);\r\n\r\n        ok = ok && clip2;\r\n      }\r\n\r\n      if (ok) {\r\n        window.elem = node;\r\n        //console.log(node._id);\r\n        return node;\r\n      }\r\n    }\r\n  }\r\n\r\n  __updateDisable(val) {\r\n    if (!!val === !!this.__disabledState) {\r\n      return;\r\n    }\r\n\r\n    this.__disabledState = !!val;\r\n\r\n    if (val && !this._disdata) {\r\n      let style = this.getDefault(\"disabled\") || this.getDefault(\"internalDisabled\") || {\r\n        \"background-color\": this.getDefault(\"DisabledBG\")\r\n      };\r\n\r\n      this._disdata = {\r\n        style   : {},\r\n        defaults: {}\r\n      };\r\n\r\n      for (let k in style) {\r\n        //save old style information\r\n        this._disdata.style[k] = this.style[k];\r\n        this._disdata.defaults[k] = this.default_overrides[k];\r\n\r\n        let v = style[k];\r\n\r\n        if (typeof v === \"object\" && v instanceof CSSFont) {\r\n          this.style[k] = style[k].genCSS();\r\n        } else {\r\n          this.style[k] = style[k];\r\n        }\r\n\r\n        this.default_overrides[k] = style[k];\r\n      }\r\n\r\n      this.__disabledState = !!val;\r\n      this.on_disabled();\r\n    } else if (!val && this._disdata) {\r\n\r\n      //load old style information\r\n      for (let k in this._disdata.style) {\r\n        this.style[k] = this._disdata.style[k];\r\n      }\r\n\r\n      for (let k in this._disdata.defaults) {\r\n        let v = this._disdata.defaults[k];\r\n\r\n        if (v === undefined) {\r\n          delete this.default_overrides[k];\r\n        } else {\r\n          this.default_overrides[k] = v;\r\n        }\r\n      }\r\n\r\n      //this.background = this.style[\"background-color\"];\r\n      this._disdata = undefined;\r\n\r\n      this.__disabledState = !!val;\r\n      this.on_enabled();\r\n    }\r\n\r\n    this.__disabledState = !!val;\r\n\r\n    let visit = (n) => {\r\n      if (n instanceof UIBase) {\r\n        let changed = !!n.__disabledState;\r\n\r\n        /*\r\n        if (val) {\r\n          n._parent_disabled_set = Math.max(n._parent_disabled_set + 1, 0);\r\n        } else {\r\n          n._parent_disabled_set = Math.max(n._parent_disabled_set - 1, 0);\r\n        }//*/\r\n\r\n        n.__updateDisable(n.disabled);\r\n\r\n        changed = changed !== !!n.__disabledState;\r\n        if (changed) {\r\n          n.update();\r\n          n.setCSS();\r\n        }\r\n      }\r\n    };\r\n\r\n    this._forEachChildWidget(visit);\r\n  }\r\n\r\n  on_disabled() {\r\n\r\n  }\r\n\r\n  on_enabled() {\r\n\r\n  }\r\n\r\n  pushModal(handlers = this, autoStopPropagation = true, pointerId = undefined, pointerElem = this) {\r\n    if (this._modaldata !== undefined) {\r\n      console.warn(\"UIBase.prototype.pushModal called when already in modal mode\");\r\n      this.popModal();\r\n    }\r\n\r\n    let _areaWrangler = contextWrangler.copy();\r\n\r\n    contextWrangler.copy(this.ctx);\r\n\r\n    function bindFunc(func) {\r\n      return function () {\r\n        _areaWrangler.copyTo(contextWrangler);\r\n\r\n        return func.apply(handlers, arguments);\r\n      }\r\n    }\r\n\r\n    let handlers2 = {};\r\n    for (let k in handlers) {\r\n      let func = handlers[k];\r\n\r\n      if (typeof func !== \"function\") {\r\n        continue;\r\n      }\r\n\r\n      handlers2[k] = bindFunc(func);\r\n    }\r\n    //this._modalstack.push(this.ctx);\r\n    //this.ctx = this.ctx.toLocked();\r\n\r\n    if (pointerId !== undefined && pointerElem) {\r\n      this._modaldata = pushPointerModal(handlers2, autoStopPropagation);\r\n    } else {\r\n      this._modaldata = pushModalLight(handlers2, autoStopPropagation);\r\n    }\r\n\r\n    return this._modaldata;\r\n  }\r\n\r\n  popModal() {\r\n    if (this._modaldata === undefined) {\r\n      console.warn(\"Invalid call to UIBase.prototype.popModal\");\r\n      return;\r\n    }\r\n\r\n    this.ctx = this._modalstack.pop();\r\n    popModalLight(this._modaldata);\r\n    this._modaldata = undefined;\r\n  }\r\n\r\n  /** child classes can override this to prevent focus on flash*/\r\n  _flash_focus() {\r\n    this.focus();\r\n  }\r\n\r\n  flash(color, rect_element = this, timems = 355, autoFocus = true) {\r\n    if (typeof color != \"object\") {\r\n      color = css2color(color);\r\n    }\r\n    color = new Vector4(color);\r\n    let csscolor = color2css(color);\r\n\r\n    if (this._flashtimer !== undefined && this._flashcolor !== csscolor) {\r\n      window.setTimeout(() => {\r\n        this.flash(color, rect_element, timems, autoFocus);\r\n      }, 100);\r\n\r\n      return;\r\n    } else if (this._flashtimer !== undefined) {\r\n      return;\r\n    }\r\n\r\n    //let rect = rect_element.getClientRects()[0];\r\n    let rect = rect_element.getBoundingClientRect();\r\n\r\n    if (rect === undefined) {\r\n      return;\r\n    }\r\n\r\n    //okay, dom apparently calls onchange() on .remove, so we have\r\n    //to put the timer code first to avoid loops\r\n    let timer;\r\n    let tick = 0;\r\n    let max = ~~(timems/20);\r\n\r\n    let x = rect.x, y = rect.y;\r\n\r\n    let cb = (e) => {\r\n      if (timer === undefined) {\r\n        return\r\n      }\r\n\r\n      let a = 1.0 - tick/max;\r\n      div.style[\"background-color\"] = color2css(color, a*a*0.5);\r\n\r\n      if (tick > max) {\r\n        window.clearInterval(timer);\r\n\r\n        this._flashtimer = undefined;\r\n        this._flashcolor = undefined;\r\n        timer = undefined;\r\n\r\n        div.remove();\r\n\r\n        if (autoFocus) {\r\n          this._flash_focus();\r\n        }\r\n      }\r\n\r\n      tick++;\r\n    };\r\n\r\n    setTimeout(cb, 5);\r\n    this._flashtimer = timer = window.setInterval(cb, 20);\r\n\r\n    let div = document.createElement(\"div\");\r\n\r\n    div.style[\"pointer-events\"] = \"none\";\r\n    div.tabIndex = undefined;\r\n    div.style[\"z-index\"] = \"900\";\r\n    div.style[\"display\"] = \"float\";\r\n    div.style[\"position\"] = UIBase.PositionKey;\r\n    div.style[\"margin\"] = \"0px\";\r\n    div.style[\"left\"] = x + \"px\";\r\n    div.style[\"top\"] = y + \"px\";\r\n\r\n    div.style[\"background-color\"] = color2css(color, 0.5);\r\n    div.style[\"width\"] = rect.width + \"px\";\r\n    div.style[\"height\"] = rect.height + \"px\";\r\n    div.setAttribute(\"class\", \"UIBaseFlash\");\r\n\r\n    let screen = this.getScreen();\r\n    if (screen !== undefined) {\r\n      screen._enterPopupSafe();\r\n    }\r\n\r\n    document.body.appendChild(div);\r\n    if (autoFocus) {\r\n      this._flash_focus();\r\n    }\r\n\r\n    this._flashcolor = csscolor;\r\n\r\n    if (screen !== undefined) {\r\n      screen._exitPopupSafe();\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n  }\r\n\r\n  on_resize(newsize) {\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = {};\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      ret.datapath = this.getAttribute(\"datapath\");\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    if (!this._init_done) {\r\n      this._init();\r\n    }\r\n  }\r\n\r\n  getPathValue(ctx, path) {\r\n    try {\r\n      return ctx.api.getValue(ctx, path);\r\n    } catch (error) {\r\n      //report(\"data path error in ui for\" + path);\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  undoBreakPoint() {\r\n    this.pathUndoGen++;\r\n  }\r\n\r\n  setPathValueUndo(ctx, path, val) {\r\n    let mass_set_path = this.getAttribute(\"mass_set_path\");\r\n    let rdef = ctx.api.resolvePath(ctx, path);\r\n    let prop = rdef.prop;\r\n\r\n    if (ctx.api.getValue(ctx, path) === val) {\r\n      return;\r\n    }\r\n\r\n    let toolstack = this.ctx.toolstack;\r\n    let head = toolstack.head;\r\n\r\n    let bad = head === undefined || !(head instanceof getDataPathToolOp());\r\n    bad = bad || head.hashThis() !== head.hash(mass_set_path, path, prop.type, this._id);\r\n    bad = bad || this.pathUndoGen !== this._lastPathUndoGen;\r\n\r\n    //if (head !== undefined && head instanceof getDataPathToolOp()) {\r\n    //console.log(\"===>\", bad, head.hashThis());\r\n    //console.log(\"    ->\", head.hash(mass_set_path, path, prop.type, this._id));\r\n    //}\r\n\r\n    if (!bad) {\r\n      toolstack.undo();\r\n      head.setValue(ctx, val, rdef.obj);\r\n      toolstack.redo();\r\n    } else {\r\n      this._lastPathUndoGen = this.pathUndoGen;\r\n\r\n      let toolop = getDataPathToolOp().create(ctx, path, val, this._id, mass_set_path);\r\n      ctx.toolstack.execTool(this.ctx, toolop);\r\n      head = toolstack.head;\r\n    }\r\n\r\n    if (!head || head.hadError === true) {\r\n      throw new Error(\"toolpath error\");\r\n    }\r\n  }\r\n\r\n  /*\r\n    adds a method call to the event queue,\r\n    but only if that method (for this instance, as differentiated\r\n    by ._id) isn't there already.\r\n\r\n    also, method won't be ran until this.ctx exists\r\n  */\r\n\r\n  pushReportContext(key) {\r\n    if (this.ctx.api.pushReportContext) {\r\n      this.ctx.api.pushReportContext(key);\r\n    }\r\n  }\r\n\r\n  popReportContext() {\r\n    if (this.ctx.api.popReportContext)\r\n      this.ctx.api.popReportContext();\r\n  }\r\n\r\n  setPathValue(ctx, path, val) {\r\n    if (this.useDataPathUndo) {\r\n      this.pushReportContext(this._reportCtxName);\r\n\r\n      try {\r\n        this.setPathValueUndo(ctx, path, val);\r\n      } catch (error) {\r\n        this.popReportContext();\r\n\r\n        if (!(error instanceof DataPathError)) {\r\n          throw error;\r\n        } else {\r\n          return;\r\n        }\r\n      }\r\n\r\n      this.popReportContext();\r\n      return;\r\n    }\r\n\r\n    this.pushReportContext(this._reportCtxName);\r\n\r\n    try {\r\n      if (this.hasAttribute(\"mass_set_path\")) {\r\n        ctx.api.massSetProp(ctx, this.getAttribute(\"mass_set_path\"), val);\r\n        ctx.api.setValue(ctx, path, val);\r\n      } else {\r\n        ctx.api.setValue(ctx, path, val);\r\n      }\r\n    } catch (error) {\r\n      this.popReportContext();\r\n\r\n      if (!(error instanceof DataPathError)) {\r\n        throw error;\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    this.popReportContext();\r\n  }\r\n\r\n  getPathMeta(ctx, path) {\r\n    this.pushReportContext(this._reportCtxName);\r\n    let ret = ctx.api.resolvePath(ctx, path);\r\n    this.popReportContext();\r\n\r\n    return ret !== undefined ? ret.prop : undefined;\r\n  }\r\n\r\n  getPathDescription(ctx, path) {\r\n    let ret;\r\n    this.pushReportContext(this._reportCtxName);\r\n\r\n    try {\r\n      ret = ctx.api.getDescription(ctx, path);\r\n    } catch (error) {\r\n      this.popReportContext();\r\n\r\n      if (error instanceof DataPathError) {\r\n        //console.warn(\"Invalid data path '\" + path + \"'\");\r\n        return undefined;\r\n      } else {\r\n        throw error;\r\n      }\r\n    }\r\n\r\n    this.popReportContext();\r\n    return ret;\r\n  }\r\n\r\n  getScreen() {\r\n    if (this.ctx !== undefined)\r\n      return this.ctx.screen;\r\n  }\r\n\r\n  isDead() {\r\n    return !this.isConnected;\r\n    let p = this, lastp = this;\r\n\r\n    function find(c, n) {\r\n      for (let n2 of c) {\r\n        if (n2 === n) {\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n\r\n    while (p) {\r\n      lastp = p;\r\n\r\n      let parent = p.parentWidget;\r\n      if (!parent) {\r\n        parent = p.parentElement ? p.parentElement : p.parentNode;\r\n      }\r\n\r\n      if (parent && p && !find(parent.childNodes, p)) {\r\n        if (parent.shadow !== undefined && !find(parent.shadow.childNodes)) {\r\n          return true;\r\n        }\r\n      }\r\n      p = parent;\r\n\r\n      if (p === document.body) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  doOnce(func, timeout = undefined) {\r\n    if (func._doOnce === undefined) {\r\n      func._doOnce_reqs = new Set();\r\n\r\n      func._doOnce = function (thisvar, trace) {\r\n        if (func._doOnce_reqs.has(thisvar._id)) {\r\n          return;\r\n        }\r\n\r\n        func._doOnce_reqs.add(thisvar._id);\r\n\r\n        function f() {\r\n          if (thisvar.isDead()) {\r\n            func._doOnce_reqs.delete(thisvar._id);\r\n\r\n            if (func === thisvar._init || !cconst.DEBUG.doOnce) {\r\n              return;\r\n            }\r\n\r\n            console.warn(\"Ignoring doOnce call for dead element\", thisvar._id, func, trace);\r\n            return;\r\n          }\r\n\r\n          if (!thisvar.ctx) {\r\n            if (cconst.DEBUG.doOnce) {\r\n              console.warn(\"doOnce call is waiting for context...\", thisvar._id, func);\r\n            }\r\n\r\n            window.setTimeout(f, 0);\r\n            return;\r\n          }\r\n\r\n          func._doOnce_reqs.delete(thisvar._id);\r\n          func.call(thisvar);\r\n        };\r\n\r\n        window.setTimeout(f, timeout);\r\n      }\r\n    }\r\n\r\n    let trace = new Error().stack;\r\n    func._doOnce(this, trace);\r\n  }\r\n\r\n  float(x = 0, y = 0, zindex = undefined, positionKey = UIBase.PositionKey) {\r\n    this.style.position = positionKey;\r\n\r\n    this.style.left = x + \"px\";\r\n    this.style.top = y + \"px\";\r\n\r\n    if (zindex !== undefined) {\r\n      this.style[\"z-index\"] = zindex\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  _ensureChildrenCtx() {\r\n    let ctx = this.ctx;\r\n    if (ctx === undefined) {\r\n      return;\r\n    }\r\n\r\n    this._forEachChildWidget((n) => {\r\n      n.parentWidget = this;\r\n\r\n      if (n.ctx === undefined) {\r\n        n.ctx = ctx;\r\n      }\r\n\r\n      n._ensureChildrenCtx(ctx);\r\n    });\r\n  }\r\n\r\n  checkThemeUpdate() {\r\n    if (!cconst.enableThemeAutoUpdate) {\r\n      return false;\r\n    }\r\n\r\n    if (_themeUpdateKey !== this._last_theme_update_key) {\r\n      this._last_theme_update_key = _themeUpdateKey;\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  abortToolTips(delayMs = 500) {\r\n    if (this._has_own_tooltips) {\r\n      this._has_own_tooltips.stop_timer();\r\n    }\r\n\r\n    if (this._tooltip_ref) {\r\n      this._tooltip_ref.remove();\r\n      this._tooltip_ref = undefined;\r\n    }\r\n\r\n    this._tool_tip_abort_delay = util.time_ms() + delayMs;\r\n\r\n    return this;\r\n  }\r\n\r\n  updateToolTipHandlers() {\r\n    if (!this._useNativeToolTips_set && !cconst.useNativeToolTips !== !this._useNativeToolTips) {\r\n      this._useNativeToolTips = cconst.useNativeToolTips;\r\n    }\r\n\r\n    if (!!this.useNativeToolTips === !this._has_own_tooltips) {\r\n      return;\r\n    }\r\n\r\n    if (!this.useNativeToolTips) {\r\n      let state = this._has_own_tooltips = {\r\n        start_timer : (e) => {\r\n          this._tooltip_timer = util.time_ms();\r\n          //console.warn(this._id, \"tooltip timer start\", e.type);\r\n        },\r\n        stop_timer  : (e) => {\r\n          //console.warn(this._id, \"tooltip timer end\", util.time_ms()-this._tooltip_timer, e.type);\r\n          this._tooltip_timer = undefined;\r\n        },\r\n        reset_timer : (e) => {\r\n          //console.warn(this._id, \"tooltip timer reset\", util.time_ms()-this._tooltip_timer, e.type);\r\n          if (this._tooltip_timer !== undefined) {\r\n            this._tooltip_timer = util.time_ms();\r\n          }\r\n        },\r\n        start_events: [\r\n          \"mouseover\"\r\n        ],\r\n        reset_events: [\r\n          \"mousemove\", \"mousedown\", \"mouseup\",\r\n          \"touchstart\", \"touchend\", \"keydown\", \"focus\"\r\n        ],\r\n        stop_events : [\r\n          \"mouseleave\", \"blur\", \"mouseout\"\r\n        ],\r\n        handlers    : {}\r\n      }\r\n\r\n      let bind_handler = (type, etype) => {\r\n        let handler = (e) => {\r\n          if (this._tool_tip_abort_delay !== undefined && util.time_ms() < this._tool_tip_abort_delay) {\r\n            this._tooltip_timer = undefined;\r\n            return;\r\n          }\r\n\r\n          state[type](e);\r\n        };\r\n\r\n        if (etype in state.handlers) {\r\n          console.error(type, \"is in handlers already\");\r\n          return;\r\n        }\r\n\r\n        state.handlers[etype] = handler;\r\n        return handler;\r\n      }\r\n\r\n      let i = 0;\r\n      let lists = [state.start_events, state.stop_events, state.reset_events];\r\n\r\n      for (let type of [\"start_timer\", \"stop_timer\", \"reset_timer\"]) {\r\n        for (let etype of lists[i]) {\r\n          this.addEventListener(etype, bind_handler(type, etype), {passive: true});\r\n        }\r\n\r\n        i++;\r\n      }\r\n    } else {\r\n      console.warn(this.id, \"removing tooltip handlers\");\r\n      let state = this._has_own_tooltips;\r\n\r\n      for (let k in this.state.handlers) {\r\n        let handler = this.state.handlers[k];\r\n        this.removeEventListener(k, handler);\r\n      }\r\n\r\n      this._has_own_tooltips = undefined;\r\n      this._tooltip_timer = undefined;\r\n    }\r\n  }\r\n\r\n  updateToolTips() {\r\n    if (this._description_final === undefined || this._description_final === null ||\r\n      this._description_final.trim().length === 0) {\r\n      return;\r\n    }\r\n\r\n    if (!this.ctx || !this.ctx.screen) {\r\n      return;\r\n    }\r\n\r\n    this.updateToolTipHandlers();\r\n\r\n    if (this.useNativeToolTips || this._tooltip_timer === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this._tool_tip_abort_delay !== undefined && util.time_ms() < this._tool_tip_abort_delay) {\r\n      return;\r\n    }\r\n\r\n    this._tool_tip_abort_delay = undefined;\r\n\r\n    let screen = this.ctx.screen;\r\n\r\n    const timelimit = 500;\r\n    let ok = util.time_ms() - this._tooltip_timer > timelimit;\r\n\r\n    let x = screen.mpos[0], y = screen.mpos[1];\r\n\r\n    let r = this.getClientRects();\r\n    r = r ? r[0] : r;\r\n\r\n    if (!r) {\r\n      ok = false;\r\n    } else {\r\n      ok = ok && x >= r.x && x < r.x + r.width;\r\n      ok = ok && y >= r.y && y < r.y + r.height;\r\n    }\r\n\r\n\r\n    //console.log(r);\r\n    if (r) {\r\n      //console.warn(this._id, \"possible tooltip\", x, y, r.x-3, r.y-3, r.width, r.height);\r\n    }\r\n\r\n    ok = ok && !haveModal();\r\n    ok = ok && screen.pickElement(x, y) === this;\r\n    ok = ok && this._description_final;\r\n\r\n    if (ok) {\r\n      //console.warn(\"Showing tooltop\", this.id);\r\n      this._tooltip_ref = _ToolTip.show(this._description_final, this.ctx.screen, x, y);\r\n    } else {\r\n      if (this._tooltip_ref) {\r\n        this._tooltip_ref.remove();\r\n      }\r\n\r\n      this._tooltip_ref = undefined;\r\n    }\r\n\r\n    //console.warn(this._id, \"tooltip timer end\");\r\n    if (util.time_ms() - this._tooltip_timer > timelimit) {\r\n      this._tooltip_timer = undefined;\r\n    }\r\n  }\r\n\r\n  //called regularly\r\n  update() {\r\n    this.updateToolTips();\r\n\r\n    if (this.ctx && this._description === undefined && this.getAttribute(\"datapath\")) {\r\n      let d = this.getPathDescription(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n      this.description = d;\r\n    }\r\n\r\n    if (!this._init_done) {\r\n      this._init();\r\n    }\r\n\r\n    if (this._init_done && !this.constructor.define().subclassChecksTheme) {\r\n      if (this.checkThemeUpdate()) {\r\n        console.log(\"theme update!\");\r\n\r\n        this.setCSS();\r\n      }\r\n    }\r\n  }\r\n\r\n  onadd() {\r\n    //if (this.parentWidget !== undefined) {\r\n    //  this._useDataPathUndo = this.parentWidget._useDataPathUndo;\r\n    //}\r\n\r\n    if (!this._init_done) {\r\n      this.doOnce(this._init);\r\n    }\r\n\r\n    if (this.tabIndex >= 0) {\r\n      this.regenTabOrder();\r\n    }\r\n  }\r\n\r\n  getZoom() {\r\n    if (this.parentWidget !== undefined) {\r\n      return this.parentWidget.getZoom();\r\n    }\r\n\r\n    return 1.0;\r\n  }\r\n\r\n  /**try to use this method\r\n\r\n   scaling ratio (e.g. for high-resolution displays)\r\n   for zoom ratio use getZoom()\r\n   */\r\n  getDPI() {\r\n    if (this.parentWidget !== undefined) {\r\n      return this.parentWidget.getDPI();\r\n    }\r\n\r\n    return UIBase.getDPI();\r\n  }\r\n\r\n  /**\r\n   * for saving ui state.\r\n   * see saveUIData() export\r\n   *\r\n   * should fail gracefully.\r\n   */\r\n  saveData() {\r\n    return {};\r\n  }\r\n\r\n  /**\r\n   * for saving ui state.\r\n   * see saveUIData() export\r\n   *\r\n   * should fail gracefully.\r\n   *\r\n   * also, it doesn't rebuild the object graph,\r\n   * it patches it; for true serialization use\r\n   * the toJSON/loadJSON or STRUCT interfaces.\r\n   */\r\n  loadData(obj) {\r\n    return this;\r\n  }\r\n\r\n  overrideDefault(key, val, localOnly = false) {\r\n    this.my_default_overrides[key] = val;\r\n\r\n    if (!localOnly) {\r\n      this.default_overrides[key] = val;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  overrideClass(style) {\r\n    this._override_class = style;\r\n  }\r\n\r\n  overrideClassDefault(style, key, val) {\r\n    if (!(style in this.class_default_overrides)) {\r\n      this.class_default_overrides[style] = {};\r\n    }\r\n\r\n    this.class_default_overrides[style][key] = val;\r\n  }\r\n\r\n  _doMobileDefault(key, val) {\r\n    if (!util.isMobile())\r\n      return val;\r\n\r\n    key = key.toLowerCase();\r\n    let ok = false;\r\n\r\n    for (let re of _mobile_theme_patterns) {\r\n      if (key.search(re) >= 0) {\r\n        ok = true;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (ok) {\r\n      val *= theme.base.mobileSizeMultiplier;\r\n    }\r\n\r\n    return val;\r\n  }\r\n\r\n  hasDefault(key) {\r\n    let p = this;\r\n\r\n    while (p) {\r\n      if (key in p.default_overrides) {\r\n        return true;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    return this.hasClassDefault(key);\r\n  }\r\n\r\n  /** get a sub style from a theme style class.\r\n   *  note that if key is falsy then it just forwards to this.getDefault directly*/\r\n  getSubDefault(key, subkey, backupkey = subkey, defaultval = undefined) {\r\n    if (!key) {\r\n      return this.getDefault(subkey, undefined, defaultval);\r\n    }\r\n\r\n    let style = this.getDefault(key);\r\n\r\n    if (!style || typeof style !== \"object\" || !(subkey in style)) {\r\n      if (defaultval !== undefined) {\r\n        return defaultval;\r\n      } else if (backupkey !== undefined) {\r\n        return this.getDefault(backupkey);\r\n      }\r\n    } else {\r\n      return style[subkey];\r\n    }\r\n  }\r\n\r\n  getDefault(key, checkForMobile = true, defaultval = undefined) {\r\n    let ret = this.getDefault_intern(key, checkForMobile, defaultval);\r\n\r\n    //convert pixel units straight to numbers\r\n    if (typeof ret === \"string\" && ret.trim().toLowerCase().endsWith(\"px\")) {\r\n      let s = ret.trim().toLowerCase();\r\n      s = s.slice(0, s.length - 2).trim();\r\n\r\n      let f = parseFloat(s);\r\n      if (!isNaN(f) && isFinite(f)) {\r\n        return f;\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  getDefault_intern(key, checkForMobile = true, defaultval = undefined) {\r\n    if (this.my_default_overrides[key] !== undefined) {\r\n      let v = this.my_default_overrides[key];\r\n      return checkForMobile ? this._doMobileDefault(key, v) : v;\r\n    }\r\n\r\n    let p = this;\r\n    while (p) {\r\n      if (p.default_overrides[key] !== undefined) {\r\n        let v = p.default_overrides[key];\r\n        checkForMobile ? this._doMobileDefault(key, v) : v;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    return this.getClassDefault(key, checkForMobile, defaultval);\r\n  }\r\n\r\n  getStyleClass() {\r\n    if (this._override_class !== undefined) {\r\n      return this._override_class;\r\n    }\r\n\r\n    let p = this.constructor, lastp = undefined;\r\n\r\n    while (p && p !== lastp && p !== UIBase && p !== Object) {\r\n      let def = p.define();\r\n\r\n      if (def.style) {\r\n        return def.style;\r\n      }\r\n\r\n      if (!p.prototype || !p.prototype.__proto__)\r\n        break;\r\n\r\n      p = p.prototype.__proto__.constructor;\r\n    }\r\n\r\n    return \"base\";\r\n  }\r\n\r\n  hasClassDefault(key) {\r\n    let style = this.getStyleClass();\r\n\r\n    let p = this;\r\n    while (p) {\r\n      let def = p.class_default_overrides[style];\r\n\r\n      if (def && (key in def)) {\r\n        return true;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    let th = this._themeOverride;\r\n\r\n    if (th && style in th && key in th[style]) {\r\n      return true;\r\n    }\r\n\r\n    if (style in theme && key in theme[style]) {\r\n      return true;\r\n    }\r\n\r\n    return key in theme.base;\r\n  }\r\n\r\n  getClassDefault(key, checkForMobile = true, defaultval = undefined) {\r\n    let style = this.getStyleClass();\r\n\r\n    if (style === \"none\") {\r\n      return undefined;\r\n    }\r\n\r\n    let val = undefined;\r\n    let p = this;\r\n    while (p) {\r\n      let def = p.class_default_overrides[style];\r\n\r\n      if (def && (key in def)) {\r\n        val = def[key];\r\n        break;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    if (val === undefined && style in theme && !(key in theme[style]) && !(key in theme.base)) {\r\n      if (window.DEBUG.theme) {\r\n        report(\"Missing theme key \", key, \"for\", style);\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let th = !i ? this._themeOverride : theme;\r\n\r\n      if (!th) {\r\n        continue;\r\n      }\r\n\r\n      if (val === undefined && style in th && key in th[style]) {\r\n        val = th[style][key];\r\n      } else if (defaultval !== undefined) {\r\n        val = defaultval;\r\n      } else if (val === undefined) {\r\n        let def = this.constructor.define();\r\n\r\n        if (def.parentStyle && key in th[def.parentStyle]) {\r\n          val = th[def.parentStyle][key];\r\n        } else {\r\n          val = th.base[key];\r\n        }\r\n      }\r\n    }\r\n\r\n    return checkForMobile ? this._doMobileDefault(key, val) : val;\r\n  }\r\n\r\n  overrideTheme(theme) {\r\n    this._themeOverride = theme;\r\n\r\n    this._forEachChildWidget((child) => {\r\n      child.overrideTheme(theme);\r\n    });\r\n\r\n    if (this.ctx) {\r\n      this.flushSetCSS();\r\n      this.flushUpdate();\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  getStyle() {\r\n    console.warn(\"deprecated call to UIBase.getStyle\");\r\n    return this.getStyleClass();\r\n  }\r\n\r\n  /** returns a new Animator instance\r\n   *\r\n   * example:\r\n   *\r\n   * container.animate().goto(\"style.width\", 500, 100, \"ease\");\r\n   * */\r\n  animate(_extra_handlers = {}) {\r\n    let transform = new DOMMatrix(this.style[\"transform\"]);\r\n\r\n    let update_trans = () => {\r\n      let t = transform;\r\n      let css = \"matrix(\" + t.a + \",\" + t.b + \",\" + t.c + \",\" + t.d + \",\" + t.e + \",\" + t.f + \")\";\r\n      this.style[\"transform\"] = css;\r\n    }\r\n\r\n    let handlers = {\r\n      background_get() {\r\n        return css2color(this.background);\r\n      },\r\n\r\n      background_set(c) {\r\n        if (typeof c !== \"string\") {\r\n          c = color2css(c);\r\n        }\r\n        this.background = c;\r\n      },\r\n\r\n      dx_get() {\r\n        return transform.m41;\r\n      },\r\n      dx_set(x) {\r\n        transform.m41 = x;\r\n        update_trans();\r\n      },\r\n\r\n      dy_get() {\r\n        return transform.m42;\r\n      },\r\n      dy_set(x) {\r\n        transform.m42 = x;\r\n        update_trans();\r\n      }\r\n    }\r\n\r\n    let pixkeys = [\"width\", \"height\", \"left\", \"top\", \"right\", \"bottom\", \"border-radius\",\r\n                   \"border-width\", \"margin\", \"padding\", \"margin-left\", \"margin-right\",\r\n                   \"margin-top\", \"margin-bottom\", \"padding-left\", \"padding-right\", \"padding-bottom\",\r\n                   \"padding-top\"];\r\n    handlers = Object.assign(handlers, _extra_handlers);\r\n\r\n    let makePixHandler = (k, k2) => {\r\n      handlers[k2 + \"_get\"] = () => {\r\n        let s = this.style[k];\r\n\r\n        if (s.endsWith(\"px\")) {\r\n          return parsepx(s);\r\n        } else {\r\n          return 0.0;\r\n        }\r\n      }\r\n\r\n      handlers[k2 + \"_set\"] = (val) => {\r\n        this.style[k] = val + \"px\";\r\n      }\r\n    }\r\n\r\n    for (let k of pixkeys) {\r\n      if (!(k in handlers)) {\r\n        makePixHandler(k, `style.${k}`);\r\n        makePixHandler(k, `style[\"${k}\"]`);\r\n        makePixHandler(k, `style['${k}']`);\r\n      }\r\n    }\r\n\r\n    let handler = {\r\n      get: (target, key, receiver) => {\r\n        console.log(key, handlers[key + \"_get\"], handlers);\r\n\r\n        if ((key + \"_get\") in handlers) {\r\n          return handlers[key + \"_get\"].call(target);\r\n        } else {\r\n          return target[key];\r\n        }\r\n      },\r\n      set: (target, key, val, receiver) => {\r\n        console.log(key);\r\n\r\n        if ((key + \"_set\") in handlers) {\r\n          handlers[key + \"_set\"].call(target, val);\r\n        } else {\r\n          target[key] = val;\r\n        }\r\n\r\n        return true;\r\n      }\r\n    }\r\n\r\n    let proxy = new Proxy(this, handler);\r\n    let anim = new Animator(proxy);\r\n\r\n    anim.onend = () => {\r\n      this._active_animations.remove(anim);\r\n    }\r\n\r\n    this._active_animations.push(anim);\r\n    return anim;\r\n  }\r\n\r\n  abortAnimations() {\r\n    for (let anim of util.list(this._active_animations)) {\r\n      anim.end();\r\n    }\r\n\r\n    this._active_animations = [];\r\n  }\r\n}\r\n\r\nexport function drawRoundBox2(elem, options = {}) {\r\n  drawRoundBox(elem, options.canvas, options.g, options.width, options.height, options.r, options.op, options.color, options.margin, options.no_clear);\r\n}\r\n\r\n/**okay, I need to refactor this function,\r\n it needs to take x, y as well as width, height,\r\n and be usable for more use cases.*/\r\nexport function drawRoundBox(elem, canvas, g, width, height, r      = undefined,\r\n                             op = \"fill\", color = undefined, margin = undefined,\r\n                             no_clear                               = false) {\r\n  width = width === undefined ? canvas.width : width;\r\n  height = height === undefined ? canvas.height : height;\r\n  g.save();\r\n\r\n  let dpi = elem.getDPI();\r\n\r\n  r = r === undefined ? elem.getDefault(\"border-radius\") : r;\r\n\r\n  if (margin === undefined) {\r\n    margin = 1;\r\n  }\r\n\r\n  r *= dpi;\r\n  let r1 = r, r2 = r;\r\n\r\n  if (r > (height - margin*2)*0.5) {\r\n    r1 = (height - margin*2)*0.5;\r\n  }\r\n\r\n  if (r > (width - margin*2)*0.5) {\r\n    r2 = (width - margin*2)*0.5;\r\n  }\r\n\r\n  let bg = color;\r\n\r\n  if (bg === undefined && canvas._background !== undefined) {\r\n    bg = canvas._background;\r\n  } else if (bg === undefined) {\r\n    bg = elem.getDefault(\"background-color\");\r\n  }\r\n\r\n  if (op === \"fill\" && !no_clear) {\r\n    g.clearRect(0, 0, width, height);\r\n  }\r\n\r\n  g.fillStyle = bg;\r\n  //hackish!\r\n  g.strokeStyle = color === undefined ? elem.getDefault(\"border-color\") : color;\r\n\r\n  let w = width, h = height;\r\n\r\n  let th = Math.PI/4;\r\n  let th2 = Math.PI*0.75;\r\n\r\n  g.beginPath();\r\n\r\n  g.moveTo(margin, margin + r1);\r\n  g.lineTo(margin, h - r1 - margin);\r\n\r\n  g.quadraticCurveTo(margin, h - margin, margin + r2, h - margin);\r\n  g.lineTo(w - margin - r2, h - margin);\r\n\r\n  g.quadraticCurveTo(w - margin, h - margin, w - margin, h - margin - r1);\r\n  g.lineTo(w - margin, margin + r1);\r\n\r\n  g.quadraticCurveTo(w - margin, margin, w - margin - r2, margin);\r\n  g.lineTo(margin + r2, margin);\r\n\r\n  g.quadraticCurveTo(margin, margin, margin, margin + r1);\r\n  g.closePath();\r\n\r\n  if (op === \"clip\") {\r\n    g.clip();\r\n  } else if (op === \"fill\") {\r\n    g.fill();\r\n  } else {\r\n    g.stroke();\r\n  }\r\n\r\n  g.restore();\r\n};\r\n\r\nexport function _getFont_new(elem, size, font = \"DefaultText\", do_dpi = true) {\r\n\r\n  font = elem.getDefault(font);\r\n\r\n  return font.genCSS(size);\r\n}\r\n\r\nexport function getFont(elem, size, font = \"DefaultText\", do_dpi = true) {\r\n  return _getFont_new(elem, size, font = \"DefaultText\", do_dpi = true);\r\n}\r\n\r\n//size is optional, defaults to font's default size\r\nexport function _getFont(elem, size, font = \"DefaultText\", do_dpi = true) {\r\n  let dpi = elem.getDPI();\r\n\r\n  let font2 = elem.getDefault(font);\r\n  if (font2 !== undefined) {\r\n    //console.warn(\"New style font detected\", font2, font2.genCSS(size));\r\n    return _getFont_new(elem, size, font, do_dpi);\r\n  }\r\n\r\n  throw new Error(\"unknown font \" + font);\r\n}\r\n\r\nexport function _ensureFont(elem, canvas, g, size) {\r\n  if (canvas.font) {\r\n    g.font = canvas.font;\r\n  } else {\r\n    let font = elem.getDefault(\"DefaultText\");\r\n    g.font = font.genCSS(size);\r\n  }\r\n}\r\n\r\nlet _mc;\r\n\r\nfunction get_measure_canvas() {\r\n  if (_mc !== undefined) {\r\n    return _mc;\r\n  }\r\n\r\n  _mc = document.createElement(\"canvas\");\r\n  _mc.width = 256;\r\n  _mc.height = 256;\r\n  _mc.g = _mc.getContext(\"2d\");\r\n\r\n  return _mc;\r\n}\r\n\r\nexport function measureTextBlock(elem, text, canvas                    = undefined,\r\n                                 g = undefined, size = undefined, font = undefined) {\r\n  let lines = text.split(\"\\n\");\r\n\r\n  let ret = {\r\n    width : 0,\r\n    height: 0\r\n  };\r\n\r\n  if (size === undefined) {\r\n    if (font !== undefined && typeof font === \"object\") {\r\n      size = font.size;\r\n    }\r\n\r\n    if (size === undefined) {\r\n      size = elem.getDefault(\"DefaultText\").size;\r\n    }\r\n  }\r\n\r\n  for (let line of lines) {\r\n    let m = measureText(elem, line, canvas, g, size, font);\r\n\r\n    ret.width = Math.max(ret.width, m.width);\r\n    let h = m.height !== undefined ? m.height : size*1.25;\r\n\r\n    ret.height += h;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nexport function measureText(elem, text, canvas                    = undefined,\r\n                            g = undefined, size = undefined, font = undefined) {\r\n  if (typeof canvas === \"object\" && canvas !== null && !(canvas instanceof HTMLCanvasElement) && canvas.tagName !== \"CANVAS\") {\r\n    let args = canvas;\r\n\r\n    canvas = args.canvas;\r\n    g = args.g;\r\n    size = args.size;\r\n    font = args.font;\r\n\r\n  }\r\n\r\n  if (g === undefined) {\r\n    canvas = get_measure_canvas();\r\n    g = canvas.g;\r\n  }\r\n\r\n  if (font !== undefined) {\r\n    if (typeof font === \"object\" && font instanceof CSSFont) {\r\n      font = font.genCSS(size);\r\n    }\r\n\r\n    g.font = font;\r\n  } else {\r\n    _ensureFont(elem, canvas, g, size);\r\n  }\r\n\r\n  let ret = g.measureText(text);\r\n\r\n  if (ret && util.isMobile()) {\r\n    let ret2 = {};\r\n    let dpi = UIBase.getDPI();\r\n\r\n    for (let k in ret) {\r\n      let v = ret[k];\r\n\r\n      if (typeof v === \"number\") {\r\n        v *= dpi;\r\n        //v *= window.devicePixelRatio;\r\n      }\r\n\r\n      ret2[k] = v;\r\n    }\r\n\r\n    ret = ret2;\r\n  }\r\n\r\n  if (size !== undefined) {\r\n    //clear custom font for next time\r\n    g.font = undefined;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n//export function drawText(elem, x, y, text, canvas, g, color=undefined, size=undefined, font=undefined) {\r\nexport function drawText(elem, x, y, text, args = {}) {\r\n  let canvas = args.canvas, g = args.g, color = args.color, font = args.font;\r\n  let size = args.size;\r\n\r\n  if (size === undefined) {\r\n    if (font !== undefined && font instanceof CSSFont) {\r\n      size = font.size;\r\n    } else {\r\n      size = elem.getDefault(\"DefaultText\").size;\r\n    }\r\n  }\r\n\r\n  size *= UIBase.getDPI();\r\n\r\n\r\n  if (color === undefined) {\r\n    if (font && font.color) {\r\n      color = font.color;\r\n    } else {\r\n      color = elem.getDefault(\"DefaultText\").color;\r\n    }\r\n  }\r\n\r\n  if (font === undefined) {\r\n    _ensureFont(elem, canvas, g, size);\r\n  } else if (typeof font === \"object\" && font instanceof CSSFont) {\r\n    g.font = font = font.genCSS(size);\r\n  } else if (font) {\r\n    g.font = font;\r\n  }\r\n\r\n  if (typeof color === \"object\") {\r\n    color = color2css(color);\r\n  }\r\n\r\n\r\n  g.fillStyle = color;\r\n  g.fillText(text, x + 0.5, y + 0.5);\r\n\r\n  if (size !== undefined) {\r\n    //clear custom font for next time\r\n    g.font = undefined;\r\n  }\r\n}\r\n\r\nlet PIDX = 0, PSHADOW = 1, PTOT = 2;\r\n\r\n/**\r\n\r\n Saves UI layout data, like panel layouts, active tabs, etc.\r\n Uses the UIBase.prototype.[save/load]Data interface.\r\n\r\n Note that this is error-tolerant.\r\n */\r\nexport function saveUIData(node, key) {\r\n  if (key === undefined) {\r\n    throw new Error(\"ui_base.saveUIData(): key cannot be undefined\");\r\n  }\r\n\r\n  let paths = [];\r\n\r\n  let rec = (n, path, ni, is_shadow) => {\r\n    path = path.slice(0, path.length); //copy path\r\n\r\n    let pi = path.length;\r\n    for (let i = 0; i < PTOT; i++) {\r\n      path.push(undefined);\r\n    }\r\n\r\n    path[pi] = ni;\r\n    path[pi + 1] = is_shadow ? 1 : 0;\r\n\r\n    if (n instanceof UIBase) {\r\n      let path2 = path.slice(0, path.length);\r\n      let data = n.saveData();\r\n\r\n      let bad = !data;\r\n      bad = bad || (typeof data === \"object\" && Object.keys(data).length === 0);\r\n\r\n      if (!bad) {\r\n        path2.push(data);\r\n\r\n        if (path2[pi + 2]) {\r\n          paths.push(path2);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < n.childNodes.length; i++) {\r\n      let n2 = n.childNodes[i];\r\n\r\n      rec(n2, path, i, false);\r\n    }\r\n\r\n    let shadow = n.shadow;\r\n\r\n    if (!shadow)\r\n      return;\r\n\r\n    for (let i = 0; i < shadow.childNodes.length; i++) {\r\n      let n2 = shadow.childNodes[i];\r\n\r\n      rec(n2, path, i, true);\r\n    }\r\n  }\r\n\r\n  rec(node, [], 0, false);\r\n\r\n  return JSON.stringify({\r\n    key        : key,\r\n    paths      : paths,\r\n    _ui_version: 1\r\n  });\r\n}\r\n\r\nwindow._saveUIData = saveUIData;\r\n\r\nexport function loadUIData(node, buf) {\r\n  if (buf === undefined || buf === null) {\r\n    return;\r\n  }\r\n\r\n  let obj = JSON.parse(buf);\r\n  let key = buf.key;\r\n\r\n  for (let path of obj.paths) {\r\n    let n = node;\r\n\r\n    let data = path[path.length - 1];\r\n    path = path.slice(2, path.length - 1); //in case some api doesn't want me calling .pop()\r\n\r\n    for (let pi = 0; pi < path.length; pi += PTOT) {\r\n      let ni = path[pi], shadow = path[pi + 1];\r\n\r\n      let list;\r\n\r\n      if (shadow) {\r\n        list = n.shadow;\r\n\r\n        if (list) {\r\n          list = list.childNodes;\r\n        }\r\n      } else {\r\n        list = n.childNodes;\r\n      }\r\n\r\n      if (list === undefined || list[ni] === undefined) {\r\n        //console.log(\"failed to load a ui data block\", path);\r\n        n = undefined;\r\n        break;\r\n      }\r\n\r\n      n = list[ni];\r\n    }\r\n\r\n    if (n !== undefined && n instanceof UIBase) {\r\n      n._init(); //ensure init's been called, _init will check if it has\r\n      n.loadData(data);\r\n\r\n      //console.log(n, path, data);\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.PositionKey = \"fixed\";\r\n\r\nwindow._loadUIData = loadUIData;\r\n\r\n//avoid explicit circular references\r\naspect._setUIBase(UIBase);\r\n//ui_save.setUIBase(UIBase);\r\n","\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as simple_toolsys from '../path-controller/toolsys/toolsys.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport {DataPathError} from '../path-controller/controller/controller.js';\r\nimport {Vector3, Vector4, Quat, Matrix4} from '../path-controller/util/vectormath.js';\r\nimport cconst from '../config/const.js';\r\nimport {_themeUpdateKey, CSSFont} from \"../core/ui_base.js\";\r\n\r\nlet keymap = events.keymap;\r\n\r\nlet EnumProperty = toolprop.EnumProperty,\r\n    PropTypes = toolprop.PropTypes;\r\n\r\nlet UIBase = ui_base.UIBase,\r\n    PackFlags = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nlet parsepx = ui_base.parsepx;\r\n\r\ncconst.DEBUG.buttonEvents = true;\r\n\r\nexport class ButtonEventBase extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._auto_depress = true;\r\n    this._highlight = false;\r\n    this._pressed = false;\r\n  }\r\n\r\n  bindEvents() {\r\n    let press_gen = 0;\r\n    let depress;\r\n\r\n    let press = (e) => {\r\n      e.stopPropagation();\r\n\r\n      if (!this.modalRunning) {\r\n        let this2 = this;\r\n\r\n        this.pushModal({\r\n          on_pointerdown(e) {\r\n            this.end(e);\r\n          },\r\n\r\n          on_pointerup(e) {\r\n            this.end(e);\r\n          },\r\n\r\n          on_pointercancel(e) {\r\n            console.warn(\"Pointer cancel in button\");\r\n            this2.popModal();\r\n          },\r\n\r\n          on_keydown(e) {\r\n            switch (e.keyCode) {\r\n              case keymap[\"Enter\"]:\r\n              case keymap[\"Escape\"]:\r\n              case keymap[\"Space\"]:\r\n                this.end();\r\n                break;\r\n            }\r\n          },\r\n\r\n          end(e) {\r\n            if (!this2.modalRunning) {\r\n              return;\r\n            }\r\n\r\n            this2.popModal();\r\n            depress(e);\r\n          }\r\n        }, undefined, e.pointerId);\r\n      }\r\n\r\n      if (cconst.DEBUG.buttonEvents) {\r\n        console.log(\"button press\", this._pressed, this.disabled, e.button);\r\n      }\r\n\r\n      if (this.disabled) return;\r\n\r\n      this._pressed = true;\r\n\r\n      if (this._onpress) {\r\n        this._onpress(this);\r\n      }\r\n\r\n      this._redraw();\r\n\r\n      e.preventDefault();\r\n    };\r\n\r\n    depress = (e) => {\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(\"button depress\", e.button, e.was_touch);\r\n\r\n      if (this._auto_depress) {\r\n        this._pressed = false;\r\n\r\n        if (this.disabled) return;\r\n\r\n        this._redraw();\r\n      }\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n\r\n      if (util.isMobile() || e.type === \"pointerup\" && e.button) {\r\n        return;\r\n      }\r\n\r\n      this._redraw();\r\n\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(\"button click callback:\", this.onclick, this._onpress, this.onpress);\r\n\r\n      if (this.onclick && e.pointerType !== \"mouse\") {\r\n        this.onclick(this);\r\n      }\r\n\r\n      this.undoBreakPoint();\r\n    }\r\n\r\n    this.addEventListener(\"click\", () => {\r\n      this._pressed = false;\r\n      this._highlight = false;\r\n      this._redraw();\r\n    });\r\n\r\n    this.addEventListener(\"pointerdown\", press, {captured : true, passive : false});\r\n    this.addEventListener(\"pointerup\", depress, {captured : true, passive : false});\r\n    this.addEventListener(\"pointerover\", (e) => {\r\n      if (this.disabled)\r\n        return;\r\n\r\n      this._highlight = true;\r\n      this._redraw();\r\n    })\r\n\r\n    this.addEventListener(\"pointerout\", (e) => {\r\n      if (this.disabled)\r\n        return;\r\n\r\n      this._highlight = false;\r\n      this._redraw();\r\n    })\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      if (this.disabled) return;\r\n\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(e.keyCode);\r\n\r\n      switch (e.keyCode) {\r\n        case 27: //escape\r\n          this.blur();\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          break;\r\n        case 32: //spacebar\r\n        case 13: //enter\r\n          this.click();\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          break;\r\n      }\r\n    });\r\n\r\n    this.addEventListener(\"focusin\", () => {\r\n      if (this.disabled) return;\r\n\r\n      this._focus = 1;\r\n      this._redraw();\r\n      this.focus();\r\n    });\r\n\r\n    this.addEventListener(\"blur\", () => {\r\n      if (this.disabled) return;\r\n\r\n      this._focus = 0;\r\n      this._redraw();\r\n    });\r\n  }\r\n\r\n  _redraw() {\r\n\r\n  }\r\n}\r\n\r\nexport class Button extends ButtonEventBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.label = document.createElement(\"span\");\r\n    this.label.innerText = \"button\";\r\n    this.shadow.appendChild(this.label);\r\n\r\n    this.label.style[\"pointer-events\"] = \"none\";\r\n\r\n    this._pressed = false;\r\n    this._highlight = false;\r\n\r\n    this._auto_depress = true;\r\n\r\n    this._last_name = undefined;\r\n    this._last_disabled = undefined;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this.tabIndex = 0;\r\n\r\n    this.bindEvents();\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  get name() {\r\n    return \"\" + this.getAttribute(\"name\");\r\n  }\r\n\r\n  set name(val) {\r\n    this.setAttribute(\"name\", val);\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    let subkey = undefined;\r\n\r\n    if (this.disabled) {\r\n      subkey = \"disabled\";\r\n    } else if (this._pressed && this._highlight) {\r\n      subkey = \"highlight-pressed\";\r\n    } else if (this._pressed) {\r\n      subkey = \"pressed\";\r\n    } else if (this._highlight) {\r\n      subkey = \"highlight\";\r\n    }\r\n\r\n    let h = this.getDefault(\"height\");\r\n\r\n    this.setBoxCSS(subkey);\r\n\r\n    this.label.style[\"padding\"] = this.label.style[\"margin\"] = \"0px\";\r\n    this.style[\"background-color\"] = this.getSubDefault(subkey, \"background-color\");\r\n\r\n    let font = this.getSubDefault(subkey, \"DefaultText\");\r\n    this.label.style[\"font\"] = font.genCSS();\r\n    this.label.style[\"color\"] = font.color;\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"align-items\"] = \"center\";\r\n    this.style[\"width\"] = \"max-content\";\r\n    this.style[\"height\"] = h + \"px\";\r\n\r\n    this.style[\"user-select\"] = \"none\";\r\n    this.label.style[\"user-select\"] = \"none\";\r\n  }\r\n\r\n  click() {\r\n    if (this._onpress) {\r\n      let rect = this.getClientRects();\r\n      let x = rect.x + rect.width*0.5;\r\n      let y = rect.y + rect.height*0.5;\r\n\r\n      let e = {x : x, y : y, stopPropagation : () => {}, preventDefault : () => {}};\r\n\r\n      this._onpress(e);\r\n    }\r\n\r\n    super.click();\r\n  }\r\n\r\n\r\n  _redraw() {\r\n    this.setCSS();\r\n  }\r\n\r\n  updateDisabled() {\r\n    if (this._last_disabled !== this.disabled) {\r\n      this._last_disabled = this.disabled;\r\n\r\n      //setTimeout(() => {\r\n\r\n      this._redraw();\r\n\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(\"disabled update!\", this.disabled, this.style[\"background-color\"]);\r\n      //}, 100);\r\n    }\r\n  }\r\n\r\n  update() {\r\n    if (this._last_name !== this.name) {\r\n      this.label.innerHTML = this.name;\r\n      this._last_name = this.name;\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"button-x\",\r\n      style  : \"button\"\r\n    };\r\n  }\r\n}\r\nUIBase.register(Button);\r\n\r\n//use .setAttribute(\"linear\") to disable nonlinear sliding\r\nexport class OldButton extends ButtonEventBase {\r\n  constructor() {\r\n    super();\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    this._last_but_update_key = \"\";\r\n\r\n    this._name = \"\";\r\n    this._namePad = undefined;\r\n    this._leftPad = 5; //extra pad before text\r\n    this._rightPad = 5; //extra pad after text\r\n\r\n    this._last_w = 0;\r\n    this._last_h = 0;\r\n\r\n    this._last_dpi = dpi;\r\n\r\n    this._lastw = undefined;\r\n    this._lasth = undefined;\r\n\r\n    this.dom = document.createElement(\"canvas\");\r\n    this.g = this.dom.getContext(\"2d\");\r\n\r\n    this.dom.setAttribute(\"class\", \"canvas1\");\r\n    this.dom.tabIndex = 0;\r\n\r\n    this._last_bg = undefined;\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      if (this.disabled) return;\r\n\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(e.keyCode);\r\n\r\n      switch (e.keyCode) {\r\n        case 27: //escape\r\n          this.blur();\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          break;\r\n        case 32: //spacebar\r\n        case 13: //enter\r\n          this.click();\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          break;\r\n      }\r\n    });\r\n\r\n    this.addEventListener(\"focusin\", () => {\r\n      if (this.disabled) return;\r\n\r\n      this._focus = 1;\r\n      this._redraw();\r\n      this.focus();\r\n    });\r\n\r\n    this.addEventListener(\"blur\", () => {\r\n      if (this.disabled) return;\r\n\r\n      this._focus = 0;\r\n      this._redraw();\r\n    });\r\n\r\n    this._last_disabled = false;\r\n    this._auto_depress = true;\r\n\r\n    this.shadow.appendChild(this.dom);\r\n  }\r\n\r\n  click() {\r\n    if (this._onpress) {\r\n      let rect = this.getClientRects();\r\n      let x = rect.x + rect.width*0.5;\r\n      let y = rect.y + rect.height*0.5;\r\n\r\n      let e = {x : x, y : y, stopPropagation : () => {}, preventDefault : () => {}};\r\n\r\n      this._onpress(e);\r\n    }\r\n\r\n    super.click();\r\n  }\r\n\r\n  init() {\r\n    let dpi = this.getDPI();\r\n\r\n    //set default dimensions\r\n    let width = ~~(this.getDefault(\"width\"));\r\n    let height = ~~(this.getDefault(\"height\"));\r\n\r\n    this.dom.style[\"width\"] = width + \"px\";\r\n    this.dom.style[\"height\"] = height + \"px\";\r\n    this.dom.style[\"padding\"] = this.dom.style[\"margin\"] = \"0px\";\r\n\r\n    this.dom.width = Math.ceil(width*dpi); //parsepx(this.dom.style[\"width\"])*dpi;\r\n    this.dom.height = Math.ceil(parsepx(this.dom.style[\"height\"])*dpi);\r\n\r\n    this._name = undefined;\r\n    this.updateName();\r\n\r\n    this.bindEvents();\r\n    this._redraw();\r\n  }\r\n\r\n  setAttribute(key, val) {\r\n    super.setAttribute(key, val);\r\n\r\n    if (key === \"name\") {\r\n      this.updateName();\r\n      this.updateWidth();\r\n    }\r\n  }\r\n\r\n  get r() {\r\n    return this.getDefault(\"border-radius\");\r\n  }\r\n\r\n  set r(val) {\r\n    this.overrideDefault(\"border-radius\", val);\r\n  }\r\n\r\n  old_bindEvents() {\r\n    let press_gen = 0;\r\n\r\n    let press = (e) => {\r\n      e.stopPropagation();\r\n\r\n      if (cconst.DEBUG.buttonEvents) {\r\n        console.log(\"button press\", this._pressed, this.disabled, e.button);\r\n      }\r\n\r\n      if (this.disabled) return;\r\n\r\n      this._pressed = true;\r\n\r\n      if (util.isMobile() && this.onclick && e.button === 0) {\r\n        this.onclick();\r\n      }\r\n\r\n      if (this._onpress) {\r\n        this._onpress(this);\r\n      }\r\n\r\n      this._redraw();\r\n\r\n      e.preventDefault();\r\n    };\r\n\r\n    let depress = (e) => {\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(\"button depress\", e.button, e.was_touch);\r\n\r\n      if (this._auto_depress) {\r\n        this._pressed = false;\r\n\r\n        if (this.disabled) return;\r\n\r\n        this._redraw();\r\n      }\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n\r\n      if (util.isMobile() || e.type === \"pointerup\" && e.button) {\r\n        return;\r\n      }\r\n\r\n      this._redraw();\r\n\r\n      if (cconst.DEBUG.buttonEvents) {\r\n        console.log(\"button click callback:\", this.onclick, this._onpress, this.onpress);\r\n      }\r\n\r\n      if (this.onclick && e.pointerType !== \"mouse\") {\r\n        this.onclick(this);\r\n      }\r\n\r\n      this.undoBreakPoint();\r\n    }\r\n\r\n    this.addEventListener(\"mousedown\", press, {captured : true, passive : false});\r\n    this.addEventListener(\"mouseup\", depress, {captured : true, passive : false});\r\n    this.addEventListener(\"mouseover\", (e) => {\r\n      if (this.disabled)\r\n        return;\r\n\r\n      this._highlight = true;\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    })\r\n\r\n    this.addEventListener(\"mouseout\", (e) => {\r\n      if (this.disabled)\r\n        return;\r\n\r\n      this._highlight = false;\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    })\r\n  }\r\n\r\n  updateDisabled() {\r\n    if (this._last_disabled !== this.disabled) {\r\n      this._last_disabled = this.disabled;\r\n\r\n      //setTimeout(() => {\r\n      this.dom._background = this.getDefault(\"background-color\");\r\n\r\n      this._repos_canvas();\r\n      this._redraw();\r\n\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(\"disabled update!\", this.disabled, this.style[\"background-color\"]);\r\n      //}, 100);\r\n    }\r\n  }\r\n\r\n  updateDefaultSize() {\r\n    let height = ~~(this.getDefault(\"height\")) + this.getDefault(\"padding\");\r\n    let size = this.getDefault(\"DefaultText\").size * 1.33;\r\n\r\n    if (height === undefined || size === undefined || isNaN(height) || isNaN(size)) {\r\n      return;\r\n    }\r\n\r\n    height = ~~Math.max(height, size);\r\n    height = height + \"px\";\r\n\r\n    if (height !== this.style[\"height\"]) {\r\n      this.style[\"height\"] = height;\r\n      this.dom.style[\"height\"] = height;\r\n\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _calcUpdateKey() {\r\n    return _themeUpdateKey;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.style[\"user-select\"] = \"none\";\r\n    this.dom.style[\"user-select\"] = \"none\";\r\n\r\n    this.updateDefaultSize();\r\n    this.updateWidth();\r\n    this.updateDPI();\r\n    this.updateName();\r\n    this.updateDisabled();\r\n\r\n    if (this.background !== this._last_bg) {\r\n      this._last_bg = this.background;\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n\r\n    let key = this._calcUpdateKey();\r\n    if (key !== this._last_but_update_key) {\r\n      this._last_but_update_key = key;\r\n\r\n      this.setCSS();\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.dom.style[\"margin\"] = this.getDefault(\"margin\", undefined, 0) + \"px\";\r\n    this.dom.style[\"margin-left\"] = this.getDefault(\"margin-left\", undefined, 0) + \"px\";\r\n    this.dom.style[\"margin-right\"] = this.getDefault(\"margin-right\", undefined, 0) + \"px\";\r\n    this.dom.style[\"margin-top\"] = this.getDefault(\"margin-top\", undefined, 0) + \"px\";\r\n    this.dom.style[\"margin-bottom\"] = this.getDefault(\"margin-bottom\", undefined, 0) + \"px\";\r\n\r\n    let name = this._name;\r\n    if (name === undefined) {\r\n      return;\r\n    }\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let pad = this.getDefault(\"padding\");\r\n    let ts = this.getDefault(\"DefaultText\").size;\r\n\r\n    let tw = ui_base.measureText(this, this._genLabel(),{\r\n      size : ts,\r\n      font : this.getDefault(\"DefaultText\")\r\n    }).width + 2.0*pad + this._leftPad + this._rightPad;\r\n\r\n    if (this._namePad !== undefined) {\r\n      tw += this._namePad;\r\n    }\r\n\r\n    let w = this.getDefault(\"width\");\r\n\r\n    w = Math.max(w, tw);\r\n    w = ~~w;\r\n    this.dom.style[\"width\"] = w+\"px\";\r\n    this.updateBorders();\r\n  }\r\n\r\n  updateBorders() {\r\n    let lwid = this.getDefault(\"border-width\");\r\n\r\n    if (lwid) {\r\n      this.dom.style[\"border-color\"] = this.getDefault(\"border-color\");\r\n      this.dom.style[\"border-width\"] = lwid + \"px\";\r\n      this.dom.style[\"border-style\"] = \"solid\";\r\n      this.dom.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n    } else {\r\n      this.dom.style[\"border-color\"] = \"none\";\r\n      this.dom.style[\"border-width\"] = \"0px\";\r\n      this.dom.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n    }\r\n\r\n  }\r\n\r\n  updateName() {\r\n    if (!this.hasAttribute(\"name\")) {\r\n      return;\r\n    }\r\n\r\n    let name = this.getAttribute(\"name\");\r\n\r\n    if (name !== this._name) {\r\n      this._name = name;\r\n\r\n      this.setCSS();\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  updateWidth(w_add=0) {\r\n  }\r\n\r\n  _repos_canvas() {\r\n    let dpi = this.getDPI();\r\n\r\n    let w = parsepx(this.dom.style[\"width\"]);\r\n    let h = parsepx(this.dom.style[\"height\"]);\r\n\r\n    let w2 = ~~(w*dpi);\r\n    let h2 = ~~(h*dpi);\r\n\r\n    w = w2/dpi;\r\n    h = h2/dpi;\r\n\r\n    this.dom.width = w2;\r\n    this.dom.style[\"width\"] = w + \"px\";\r\n\r\n    this.dom.height = h2;\r\n    this.dom.style[\"height\"] = h + \"px\";\r\n  }\r\n\r\n  updateDPI() {\r\n    let dpi = this.getDPI();\r\n\r\n    if (this._last_dpi !== dpi) {\r\n      //console.log(\"update dpi\", dpi);\r\n\r\n      this._last_dpi = dpi;\r\n\r\n      this.g.font = undefined; //reset font\r\n\r\n      this.setCSS();\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n\r\n    if (this.style[\"background-color\"]) {\r\n      this.dom._background = this.style[\"background-color\"];\r\n      this.style[\"background-color\"] = \"\";\r\n    }\r\n\r\n    //console.log(\">\", this.dom.style[\"background-color\"], \"-----\");\r\n    //console.log(\"width:\", this.clientWidth)\r\n  }\r\n\r\n  _genLabel() {\r\n    return \"\" + this._name;\r\n  }\r\n\r\n  _getSubKey() {\r\n    if (this._pressed) {\r\n      return 'depressed';\r\n    } else if (this._highlight) {\r\n      return 'highlight';\r\n    } else {\r\n      return undefined; //make getSubDefault forward to getDefault\r\n    }\r\n  }\r\n\r\n  _redraw(draw_text=true) {\r\n    //console.log(\"button draw\");\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let subkey = this._getSubKey();\r\n\r\n    if (this._pressed && this._highlight) {\r\n      this.dom._background = this.getSubDefault(subkey, \"highlight-pressed\", \"BoxHighlight\");\r\n    } else if (this._pressed) {\r\n      this.dom._background = this.getSubDefault(subkey, \"pressed\",\"BoxDepressed\");\r\n    } else if (this._highlight) {\r\n      this.dom._background = this.getSubDefault(subkey, \"highlight\", \"BoxHighlight\");\r\n    } else {\r\n      this.dom._background = this.getSubDefault(subkey, \"background-color\", \"background-color\");\r\n    }\r\n\r\n    ui_base.drawRoundBox(this, this.dom, this.g);\r\n\r\n    //drawn with CSS now\r\n    /*\r\n    let lwid = this.getDefault(\"border-width\");\r\n    if (lwid) {\r\n      this.g.lineWidth = lwid*dpi;\r\n      ui_base.drawRoundBox(this, this.dom, this.g, undefined, undefined, undefined, \"stroke\");\r\n    }\r\n     */\r\n\r\n    this.updateBorders();\r\n\r\n    if (this._focus) {\r\n      let w = this.dom.width, h = this.dom.height;\r\n      let p = 1/dpi;\r\n\r\n      //XXX remove this.g.translate lines after refactoring drawRoundBox, see comment in ui_base.js\r\n      this.g.translate(p, p);\r\n      let lw = this.g.lineWidth;\r\n\r\n\r\n      this.g.lineWidth = this.getDefault(\"focus-border-width\", undefined, 1.0)*dpi;\r\n\r\n      ui_base.drawRoundBox(this, this.dom, this.g, w-p*2, h-p*2, this.r, \"stroke\", this.getDefault(\"BoxHighlight\"));\r\n\r\n      this.g.lineWidth = lw;\r\n      this.g.translate(-p, -p);\r\n    }\r\n\r\n    if (draw_text) {\r\n      this._draw_text();\r\n    }\r\n  }\r\n\r\n  _draw_text() {\r\n    let dpi = this.getDPI();\r\n\r\n    let subkey = this._getSubKey();\r\n\r\n    //if (util.isMobile()) {\r\n    //dpi = dpi; //visualViewport.scale;\r\n    //}\r\n\r\n    let font = this.getSubDefault(subkey, \"DefaultText\");\r\n\r\n    let pad = this.getDefault(\"padding\") * dpi;\r\n    let ts = font.size * dpi;\r\n\r\n    let text = this._genLabel();\r\n\r\n    //console.log(text, \"text\", this._name);\r\n\r\n    let w = this.dom.width, h = this.dom.height;\r\n\r\n    let tw = ui_base.measureText(this, text, undefined, undefined, ts, font).width;\r\n\r\n    let cx = pad*0.5 + this._leftPad*dpi;\r\n    let cy = ts + (h-ts)/3.0;\r\n\r\n    let g = this.g;\r\n\r\n    ui_base.drawText(this, ~~cx, ~~cy, text, {\r\n      canvas : this.dom,\r\n      g : this.g,\r\n      size : ts / dpi,\r\n      font : font\r\n    });\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"old-button-x\",\r\n      style  : \"button\"\r\n    };\r\n  }\r\n}\r\nUIBase.internalRegister(OldButton);\r\n","\"use strict\";\r\n\r\nimport * as units from '../core/units.js';\r\nimport * as util from '../path-controller/util/util.js';\r\nimport {Vector2, Vector3, Vector4, Matrix4, Quat} from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nfunction myToFixed(s, n) {\r\n  s = s.toFixed(n);\r\n\r\n  while (s.endsWith('0')) {\r\n    s = s.slice(0, s.length-1);\r\n  }\r\n  if (s.endsWith(\"\\.\")) {\r\n    s = s.slice(0, s.length-1);\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nlet keymap = events.keymap;\r\n\r\nlet EnumProperty = toolprop.EnumProperty,\r\n    PropTypes = toolprop.PropTypes;\r\n\r\nlet UIBase = ui_base.UIBase,\r\n    PackFlags = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nlet parsepx = ui_base.parsepx;\r\n\r\nimport {Button} from './ui_button.js';\r\nimport {_setTextboxClass} from '../core/ui_base.js';\r\n\r\nexport class TextBoxBase extends UIBase {\r\n  static define() {return {\r\n    modalKeyEvents : true\r\n  }}\r\n}\r\n\r\nexport class TextBox extends TextBoxBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._width = this.getDefault(\"width\") + \"px\";\r\n    this._textBoxEvents = true;\r\n\r\n    let margin = Math.ceil(3 * this.getDPI());\r\n\r\n    this._had_error = false;\r\n\r\n    this.decimalPlaces = undefined; //will inherit from property defaults\r\n\r\n    this.baseUnit = undefined; //will automatically use defaults\r\n    this.displayUnit = undefined; //will automatically use defaults\r\n\r\n    this.dom = document.createElement(\"input\");\r\n\r\n    this.dom.tabIndex = 0;\r\n    this.dom.setAttribute(\"tabindex\", 0);\r\n    this.dom.setAttribute(\"tab-index\", 0);\r\n    this.dom.style[\"margin\"] = margin + \"px\";\r\n\r\n    this.dom.setAttribute(\"type\", \"textbox\");\r\n    this.dom.onchange = (e) => {\r\n      this._change(this.dom.value);\r\n    }\r\n\r\n    this.radix = 16;\r\n\r\n    this.dom.oninput = (e) => {\r\n      this._change(this.dom.value);\r\n    }\r\n\r\n    this.shadow.appendChild(this.dom);\r\n\r\n    this.dom.addEventListener(\"focus\", (e) => {\r\n      console.log(\"Textbox focus\", this.isModal);\r\n\r\n      this._focus = 1;\r\n\r\n      if (this.isModal) {\r\n        this._startModal();\r\n        this.setCSS();\r\n      }\r\n    });\r\n\r\n    this.dom.addEventListener(\"blur\", (e) => {\r\n      console.log(\"Textbox blur\");\r\n\r\n      this._focus = 0;\r\n\r\n      if (this._modal) {\r\n        this._endModal(true);\r\n        this.setCSS();\r\n      }\r\n    });\r\n\r\n  }\r\n\r\n  /** realtime dom attribute getter, defaults to true in absence of attribute*/\r\n  get realtime() {\r\n    let ret = this.getAttribute(\"realtime\");\r\n\r\n    if (!ret) {\r\n      return true;\r\n    }\r\n\r\n    ret = ret.toLowerCase().trim();\r\n\r\n    return ret === 'yes' || ret === 'true' || ret === 'on';\r\n  }\r\n\r\n  set realtime(val) {\r\n    this.setAttribute('realtime', val ? 'true' : 'false');\r\n  }\r\n\r\n  get isModal() {\r\n    let ret = this.getAttribute(\"modal\");\r\n\r\n    if (!ret) {\r\n      return false;\r\n    }\r\n\r\n    ret = ret.toLowerCase().trim();\r\n\r\n    return ret === 'yes' || ret === 'true' || ret === 'on';\r\n  }\r\n\r\n  set isModal(val) {\r\n    this.setAttribute('modal', val ? 'true' : 'false');\r\n  }\r\n\r\n  _startModal() {\r\n    console.warn(\"textbox modal\");\r\n\r\n    if (this._modal) {\r\n      this._endModal(true);\r\n    }\r\n\r\n    let ignore = 0;\r\n\r\n    let finish = (ok) => {\r\n      this._endModal(ok);\r\n    }\r\n\r\n    let keydown = (e) => {\r\n      e.stopPropagation();\r\n\r\n      switch (e.keyCode) {\r\n        case keymap.Enter:\r\n          finish(true);\r\n          break;\r\n        case keymap.Escape:\r\n          finish(false);\r\n          break;\r\n      }\r\n\r\n      return;\r\n      if (ignore) return;\r\n\r\n      let e2 = new KeyboardEvent(e.type, e);\r\n\r\n      ignore = 1;\r\n      this.dom.dispatchEvent(e2);\r\n      ignore = 0;\r\n    };\r\n\r\n    this._modal = true;\r\n    this.pushModal({\r\n      on_mousemove : (e) => {\r\n        e.stopPropagation();\r\n      },\r\n\r\n      on_keydown : keydown,\r\n      on_keypress : keydown,\r\n      on_keyup : keydown,\r\n\r\n      on_mousedown : (e) => {\r\n        e.stopPropagation();\r\n        console.log(\"mouse down\", e, e.x, e.y);\r\n      }\r\n    }, false)\r\n  }\r\n\r\n  _flash_focus() {\r\n    //don't focus on flash\r\n  }\r\n\r\n  _endModal(ok) {\r\n    console.log(\"textbox end modal\");\r\n\r\n    this._modal = false;\r\n    this.popModal();\r\n\r\n    this.blur();\r\n\r\n    if (this.onend) {\r\n      this.onend(ok);\r\n    } else {\r\n      this._updatePathVal(this.dom.value);\r\n    }\r\n\r\n    this.blur();\r\n  }\r\n\r\n  get tabIndex() {\r\n    return this.dom.tabIndex;\r\n  }\r\n\r\n  set tabIndex(val) {\r\n    this.dom.tabIndex = val;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    //set isModal default\r\n    if (!this.hasAttribute('modal')) {\r\n      this.isModal = true;\r\n    }\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"width\"] = this._width;\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  set width(val) {\r\n    if (typeof val === \"number\") {\r\n      val += \"px\";\r\n    }\r\n\r\n    this._width = val;\r\n    this.style[\"width\"] = val;\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.overrideDefault(\"background-color\", this.getDefault(\"background-color\"));\r\n\r\n    this.background = this.getDefault(\"background-color\");\r\n    this.dom.style[\"margin\"] = this.dom.style[\"padding\"] = \"0px\";\r\n\r\n    if (this.getDefault(\"background-color\")) {\r\n      this.dom.style[\"background-color\"] = this.getDefault(\"background-color\");\r\n    }\r\n\r\n    if (this._focus) {\r\n      this.dom.style[\"border\"] = `2px dashed ${this.getDefault('focus-border-color')}`;\r\n    } else {\r\n      this.dom.style[\"border\"] = \"none\";\r\n    }\r\n\r\n    if (this.style[\"font\"]) {\r\n      this.dom.style[\"font\"] = this.style[\"font\"];\r\n    } else {\r\n      this.dom.style[\"font\"] = this.getDefault(\"DefaultText\").genCSS();\r\n      this.dom.style[\"color\"] = this.getDefault(\"DefaultText\").color;\r\n    }\r\n\r\n    this.dom.style[\"width\"] = \"100%\";\r\n    this.dom.style[\"height\"] = \"100%\";\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.ctx || !this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n    if (this._focus || this._flashtimer !== undefined || (this._had_error && this._focus)) {\r\n      return;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n    if (val === undefined || val === null) {\r\n      console.error(\"invalid datapath \" + this.getAttribute(\"datapath\"), val);\r\n\r\n      this.internalDisabled = true;\r\n      return;\r\n    } else {\r\n      this.internalDisabled = false;\r\n    }\r\n\r\n\r\n    let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    let text = this.text;\r\n\r\n    if (!prop) {\r\n      console.error(\"datapath error \" + this.getAttribute(\"datapath\"), val);\r\n      return;\r\n    }\r\n\r\n    let is_num = prop.type & (PropTypes.FLOAT|PropTypes.INT);\r\n    if (typeof val === \"number\" && (prop.type & (PropTypes.VEC2|PropTypes.VEC3|PropTypes.VEC4|PropTypes.QUAT))) {\r\n      is_num = true;\r\n    }\r\n\r\n    if (is_num) {\r\n      let is_int = prop.type === PropTypes.INT;\r\n\r\n      this.radix = prop.radix;\r\n\r\n      let decimalPlaces = this.decimalPlaces !== undefined ? this.decimalPlaces : prop.decimalPlaces;\r\n      if (this.hasAttribute(\"decimalPlaces\")) {\r\n        decimalPlaces = parseInt(this.getAttribute(\"decimalPlaces\"));\r\n      }\r\n\r\n      let baseUnit = this.baseUnit ?? prop.baseUnit;\r\n      if (this.hasAttribute(\"baseUnit\")) {\r\n        baseUnit = this.getAttribute(\"baseUnit\");\r\n      }\r\n\r\n      let displayUnit = this.displayUnit ?? prop.displayUnit;\r\n      if (this.hasAttribute(\"displayUnit\")) {\r\n        displayUnit = this.getAttribute(\"displayUnit\");\r\n      }\r\n\r\n      if (is_int && this.radix === 2) {\r\n        text = val.toString(this.radix);\r\n        text = \"0b\" + text;\r\n      } else if (is_int && this.radix === 16) {\r\n        text += \"h\";\r\n      } else {\r\n        text = units.buildString(val, baseUnit, decimalPlaces, displayUnit);\r\n      }\r\n    } else if (prop !== undefined && prop.type === PropTypes.STRING) {\r\n      text = val;\r\n    }\r\n\r\n    if (this.text !== text) {\r\n      this.text = text;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    if (this.dom.style[\"width\"] !== this.style[\"width\"]) {\r\n      this.dom.style[\"width\"] = this.style[\"width\"];\r\n    }\r\n    if (this.dom.style[\"height\"] !== this.style[\"height\"]) {\r\n      this.dom.style[\"height\"] = this.style[\"height\"];\r\n    }\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  select() {\r\n    this.dom.select();\r\n    //return this.dom.select.apply(this, arguments);\r\n  }\r\n\r\n  focus() {\r\n    return this.dom.focus();\r\n  }\r\n\r\n  blur() {\r\n    return this.dom.blur();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"textbox-x\",\r\n    style   : \"textbox\",\r\n    modalKeyEvents : true\r\n  };}\r\n\r\n  get text() {\r\n    return this.dom.value;\r\n  }\r\n\r\n  set text(value) {\r\n    this.dom.value = value;\r\n  }\r\n\r\n  _prop_update(prop, text) {\r\n    let is_num = prop.type & (PropTypes.FLOAT|PropTypes.INT);\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (typeof val === \"number\" && (prop.type & (PropTypes.VEC2|PropTypes.VEC3|PropTypes.VEC4|PropTypes.QUAT))) {\r\n      is_num = true;\r\n    }\r\n\r\n    if (is_num) {\r\n      let is_int = prop.type === PropTypes.INT;\r\n\r\n      this.radix = prop.radix;\r\n\r\n      let decimalPlaces = this.decimalPlaces !== undefined ? this.decimalPlaces : prop.decimalPlaces;\r\n      if (this.hasAttribute(\"decimalPlaces\")) {\r\n        decimalPlaces = parseInt(this.getAttribute(\"decimalPlaces\"));\r\n      }\r\n\r\n      let baseUnit = this.baseUnit ?? prop.baseUnit;\r\n      if (this.hasAttribute(\"baseUnit\")) {\r\n        baseUnit = this.getAttribute(\"baseUnit\");\r\n      }\r\n\r\n      let displayUnit = this.displayUnit ?? prop.displayUnit;\r\n      if (this.hasAttribute(\"displayUnit\")) {\r\n        displayUnit = this.getAttribute(\"displayUnit\");\r\n      }\r\n\r\n      if (!units.isNumber(text.trim())) {\r\n        this.flash(ui_base.ErrorColors.ERROR, this.dom, undefined, false);\r\n        this.focus();\r\n        this.dom.focus();\r\n        this._had_error = true;\r\n      } else {\r\n        let val = units.parseValue(text, baseUnit, displayUnit);\r\n\r\n        if (this._had_error) {\r\n          this.flash(ui_base.ErrorColors.OK, this.dom, undefined, false);\r\n        }\r\n\r\n        this._had_error = false;\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), val);\r\n      }\r\n    } else if (prop.type === PropTypes.STRING) {\r\n      try {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this.text);\r\n\r\n        if (this._had_error) {\r\n          this.flash(ui_base.ErrorColors.OK, this.dom, undefined, false);\r\n          this.dom.focus();\r\n        }\r\n\r\n        this._had_error = false;\r\n      } catch (error) {\r\n        console.log(error.stack);\r\n        console.log(error.message);\r\n        console.warn(\"textbox error!\");\r\n        //this._had_error = true;\r\n\r\n        this.flash(ui_base.ErrorColors.ERROR, this.dom, undefined, false);\r\n        this.dom.focus();\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  _updatePathVal(text) {\r\n    if (this.hasAttribute(\"datapath\") && this.ctx !== undefined) {\r\n      let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n      console.log(prop);\r\n\r\n      if (prop) {\r\n        this._prop_update(prop, text);\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  _change(text) {\r\n    //console.log(\"onchange\", this.ctx, this, this.dom.__proto__, this.hasFocus);\r\n    //console.log(\"onchange\", this._focus);\r\n\r\n    console.log(\"change\", text);\r\n\r\n    if (this.realtime) {\r\n      this._updatePathVal(text);\r\n    }\r\n\r\n    if (this.onchange) {\r\n      this.onchange(text);\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(TextBox);\r\n\r\n/**\r\n\r\n Returns false if it's safe to call preventDefault.\r\n\r\n Returns true if the element at position x,y is\r\n either a textbox or is draggable.\r\n */\r\nexport function checkForTextBox(screen, x, y) {\r\n  let p = screen.pickElement(x, y);\r\n  //console.log(p, x, y);\r\n\r\n  while (p) {\r\n    //don't prevent draggable elements from dragging\r\n    if (p.draggable) {\r\n      return true;\r\n    }\r\n\r\n    if (p instanceof UIBase) {\r\n      //check immediate children of p\r\n      for (let i=0; i<2; i++) {\r\n        let nodes = i ? p.childNodes : p.shadow.childNodes;\r\n\r\n        for (let child of nodes) {\r\n          if (child.draggable) {\r\n            return true;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    let ok = p instanceof TextBoxBase;\r\n    ok = ok || p.constructor.define && p.constructor.define().modalKeyEvents;\r\n\r\n    if (ok) {\r\n      return true;\r\n    }\r\n\r\n    p = p.parentWidget ? p.parentWidget : p.parentNode;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nui_base._setTextboxClass(TextBox);\r\n","\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as toolsys from '../path-controller/toolsys/toolsys.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport {DataPathError} from '../path-controller/controller/controller.js';\r\nimport {Vector3, Vector4, Quat, Matrix4} from '../path-controller/util/vectormath.js';\r\nimport {isNumber, PropFlags} from \"../path-controller/toolsys/toolprop.js\";\r\nimport * as units from '../core/units.js';\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nfunction myToFixed(s, n) {\r\n  s = s.toFixed(n);\r\n\r\n  while (s.endsWith('0')) {\r\n    s = s.slice(0, s.length - 1);\r\n  }\r\n  if (s.endsWith(\"\\.\")) {\r\n    s = s.slice(0, s.length - 1);\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nlet keymap = events.keymap;\r\n\r\nlet EnumProperty = toolprop.EnumProperty,\r\n    PropTypes    = toolprop.PropTypes;\r\n\r\nlet UIBase     = ui_base.UIBase,\r\n    PackFlags  = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nlet parsepx = ui_base.parsepx;\r\n\r\nimport {Button, OldButton} from './ui_button.js';\r\nimport {eventWasTouch, popModalLight, pushModalLight} from '../path-controller/util/simple_events.js';\r\n\r\nexport {Button} from './ui_button.js';\r\n\r\nexport class IconLabel extends UIBase {\r\n  constructor() {\r\n    super();\r\n    this._icon = -1;\r\n    this.iconsheet = 1;\r\n  }\r\n\r\n  get icon() {\r\n    return this._icon;\r\n  }\r\n\r\n  set icon(id) {\r\n    this._icon = id;\r\n    this.setCSS();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"icon-label-x\"\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"margin\"] = this.style[\"padding\"] = \"0px\";\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  setCSS() {\r\n    let size = ui_base.iconmanager.getTileSize(this.iconsheet);\r\n\r\n\r\n    ui_base.iconmanager.setCSS(this.icon, this);\r\n\r\n    this.style[\"width\"] = size + \"px\";\r\n    this.style[\"height\"] = size + \"px\";\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(IconLabel);\r\n\r\nexport class ValueButtonBase extends OldButton {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(val) {\r\n    this._value = val;\r\n\r\n    if (this.ctx && this.hasAttribute(\"datapath\")) {\r\n      this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this._value);\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) return;\r\n    if (this.ctx === undefined) return;\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (val === undefined) {\r\n      let redraw = !this.disabled;\r\n\r\n      this.internalDisabled = true;\r\n\r\n      if (redraw) this._redraw();\r\n\r\n      return;\r\n    } else {\r\n      let redraw = this.disabled;\r\n\r\n      this.internalDisabled = false;\r\n      if (redraw) this._redraw();\r\n    }\r\n\r\n    if (val !== this._value) {\r\n      this._value = val;\r\n      this.updateWidth();\r\n      this._repos_canvas();\r\n      this._redraw();\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    this.updateDataPath();\r\n\r\n    super.update();\r\n  }\r\n}\r\n\r\nexport class Check extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._checked = false;\r\n    this._highlight = false;\r\n    this._focus = false;\r\n\r\n    let shadow = this.shadow;\r\n\r\n    //let form = document.createElement(\"form\");\r\n\r\n    let span = document.createElement(\"span\");\r\n    span.setAttribute(\"class\", \"checkx\");\r\n\r\n    span.style[\"display\"] = \"flex\";\r\n    span.style[\"flex-direction\"] = \"row\";\r\n    span.style[\"margin\"] = span.style[\"padding\"] = \"0px\";\r\n    //span.style[\"background\"] = ui_base.iconmanager.getCSS(1);\r\n\r\n    let sheet = 0;\r\n    let size = ui_base.iconmanager.getTileSize(0);\r\n\r\n    let check = this.canvas = document.createElement(\"canvas\");\r\n    this.g = check.getContext(\"2d\");\r\n\r\n    check.setAttribute(\"id\", check._id);\r\n    check.setAttribute(\"name\", check._id);\r\n\r\n    let mdown = (e) => {\r\n      this._highlight = false;\r\n      this.checked = !this.checked;\r\n    };\r\n\r\n    let mup = (e) => {\r\n      this._highlight = false;\r\n      this.blur();\r\n      this._redraw();\r\n    };\r\n\r\n    let mover = (e) => {\r\n      this._highlight = true;\r\n      this._redraw();\r\n    };\r\n\r\n    let mleave = (e) => {\r\n      this._highlight = false;\r\n      this._redraw();\r\n    };\r\n\r\n    span.addEventListener(\"pointerover\", mover, {passive: true});\r\n    span.addEventListener(\"mousein\", mover, {passive: true});\r\n    span.addEventListener(\"mouseleave\", mleave, {passive: true});\r\n    span.addEventListener(\"pointerout\", mleave, {passive: true});\r\n\r\n    this.addEventListener(\"blur\", (e) => {\r\n      this._highlight = this._focus = false;\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"focusin\", (e) => {\r\n      this._focus = true;\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"focus\", (e) => {\r\n      this._focus = true;\r\n      this._redraw();\r\n    });\r\n\r\n\r\n    span.addEventListener(\"pointerdown\", mdown, {passive: true});\r\n    span.addEventListener(\"pointerup\", mup, {passive: true});\r\n    span.addEventListener(\"pointercancel\", mup, {passive: true});\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Escape\"]:\r\n          this._highlight = undefined;\r\n          this._redraw();\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n\r\n          this.blur();\r\n          break;\r\n        case keymap[\"Enter\"]:\r\n        case keymap[\"Space\"]:\r\n          this.checked = !this.checked;\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          break;\r\n      }\r\n    });\r\n    this.checkbox = check;\r\n\r\n    span.appendChild(check);\r\n\r\n    let label = this._label = document.createElement(\"label\");\r\n    label.setAttribute(\"class\", \"checkx\");\r\n    span.setAttribute(\"class\", \"checkx\");\r\n    label.style[\"align-self\"] = \"center\";\r\n\r\n    let side = this.getDefault(\"CheckSide\");\r\n    if (side === \"right\") {\r\n      span.prepend(label);\r\n    } else {\r\n      span.appendChild(label);\r\n    }\r\n\r\n    shadow.appendChild(span);\r\n  }\r\n\r\n  get internalDisabled() {\r\n    return super.internalDisabled;\r\n  }\r\n\r\n  set internalDisabled(val) {\r\n    if (!!this.internalDisabled === !!val) {\r\n      return;\r\n    }\r\n\r\n    super.internalDisabled = val;\r\n    this._redraw();\r\n  }\r\n\r\n  get value() {\r\n    return this.checked;\r\n  }\r\n\r\n  set value(v) {\r\n    this.checked = v;\r\n  }\r\n\r\n  get checked() {\r\n    return this._checked;\r\n  }\r\n\r\n  set checked(v) {\r\n    v = !!v;\r\n\r\n    if (this._checked !== v) {\r\n      this._checked = v;\r\n\r\n      this.setCSS();\r\n\r\n      //this.dom.checked = v;\r\n      this._redraw();\r\n\r\n      if (this.onclick) {\r\n        this.onclick(v);\r\n      }\r\n      if (this.onchange) {\r\n        this.onchange(v);\r\n      }\r\n\r\n      if (this.hasAttribute(\"datapath\")) {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this._checked);\r\n      }\r\n    }\r\n  }\r\n\r\n  get label() {\r\n    return this._label.textContent;\r\n  }\r\n\r\n  set label(l) {\r\n    this._label.textContent = l;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname    : \"check-x\",\r\n      style      : \"checkbox\",\r\n      parentStyle: \"button\"\r\n    };\r\n  }\r\n\r\n  init() {\r\n    this.tabIndex = 1;\r\n    this.setAttribute(\"class\", \"checkx\");\r\n\r\n\r\n    let style = document.createElement(\"style\");\r\n    //let style = this.cssStyleTag();\r\n\r\n    let color = this.getDefault(\"focus-border-color\");\r\n\r\n    style.textContent = `\r\n      .checkx:focus {\r\n        outline : none;\r\n      }\r\n    `;\r\n\r\n    //document.body.prepend(style);\r\n    this.prepend(style);\r\n  }\r\n\r\n  setCSS() {\r\n    this._label.style[\"font\"] = this.getDefault(\"DefaultText\").genCSS();\r\n    this._label.style[\"color\"] = this.getDefault(\"DefaultText\").color;\r\n\r\n    this._label.style['font'] = 'normal 14px poppins'; // TODO - Jordan - add to settings\r\n\r\n    super.setCSS();\r\n\r\n    //force clear background\r\n    this.style[\"background-color\"] = \"rgba(0,0,0,0)\";\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.getAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    let redraw = false;\r\n\r\n    if (val === undefined) {\r\n      this.internalDisabled = true;\r\n      return;\r\n    } else {\r\n      redraw = this.internalDisabled;\r\n\r\n      this.internalDisabled = false;\r\n    }\r\n\r\n    val = !!val;\r\n\r\n    redraw = redraw || !!this._checked !== !!val;\r\n\r\n    if (redraw) {\r\n      this._checked = val;\r\n      this._repos_canvas();\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _repos_canvas() {\r\n  }\r\n\r\n  _redraw() {\r\n    if (this.canvas === undefined) {\r\n      //flag update\r\n      this._updatekey = \"\";\r\n      return;\r\n    }\r\n\r\n    let canvas = this.canvas, g = this.g;\r\n    let dpi = UIBase.getDPI();\r\n    let tilesize = ui_base.iconmanager.getTileSize(0);\r\n    let pad = this.getDefault(\"padding\");\r\n\r\n    let csize = tilesize + pad*2;\r\n\r\n    canvas.style[\"margin\"] = \"2px\";\r\n    canvas.style[\"width\"] = csize + \"px\";\r\n    canvas.style[\"height\"] = csize + \"px\";\r\n\r\n    csize = ~~(csize*dpi + 0.5);\r\n    tilesize = ~~(tilesize*dpi + 0.5);\r\n\r\n    canvas.width = csize;\r\n    canvas.height = csize;\r\n\r\n    g.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    g.beginPath();\r\n    g.rect(0, 0, canvas.width, canvas.height);\r\n    g.fill();\r\n\r\n    let color;\r\n\r\n    if (!this._checked && this._highlight) {\r\n      color = this.getDefault(\"BoxHighlight\");\r\n    }\r\n\r\n    ui_base.drawRoundBox(this, canvas, g, undefined, undefined, undefined, undefined, color);\r\n    if (this._checked) {\r\n      //canvasDraw(elem, canvas, g, icon, x=0, y=0, sheet=0) {\r\n      let x = (csize - tilesize)*0.5, y = (csize - tilesize)*0.5;\r\n      ui_base.iconmanager.canvasDraw(this, canvas, g, ui_base.Icons.LARGE_CHECK, x, y);\r\n    }\r\n\r\n    if (this._focus) {\r\n      color = this.getDefault(\"focus-border-color\");\r\n      g.lineWidth *= dpi;\r\n      ui_base.drawRoundBox(this, canvas, g, undefined, undefined, undefined, \"stroke\", color);\r\n    }\r\n  }\r\n\r\n  updateDPI() {\r\n    let dpi = UIBase.getDPI();\r\n\r\n    if (dpi !== this._last_dpi) {\r\n      this._last_dpi = dpi;\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateDPI();\r\n\r\n    let ready = ui_base.getIconManager().isReady(0);\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n\r\n    let updatekey = this.getDefault(\"DefaultText\").hash();\r\n    updatekey += this._checked + \":\" + this._label.textContent;\r\n    updatekey += \":\" + ready;\r\n\r\n    if (updatekey !== this._updatekey) {\r\n      this._repos_canvas();\r\n      this.setCSS();\r\n\r\n      this._updatekey = updatekey;\r\n      this._redraw();\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(Check);\r\n\r\nexport class IconButton extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._customIcon = undefined;\r\n\r\n    this._pressed = false;\r\n    this._highlight = false;\r\n    this._draw_pressed = true;\r\n\r\n    this._icon = -1;\r\n    this._icon_pressed = undefined;\r\n    this.iconsheet = 0;\r\n    this.drawButtonBG = true;\r\n\r\n    this._extraIcon = undefined; //draw another icon on top\r\n\r\n    this.extraDom = undefined;\r\n\r\n    //have to put icon in subdiv\r\n    this.dom = document.createElement(\"div\");\r\n    this.shadow.appendChild(this.dom);\r\n\r\n    this._last_iconsheet = undefined;\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Enter\"]:\r\n        case keymap[\"Space\"]:\r\n          this.click();\r\n          break;\r\n      }\r\n    });\r\n  }\r\n\r\n  click() {\r\n    if (this._onpress) {\r\n      let rect = this.getClientRects();\r\n      let x = rect.x + rect.width*0.5;\r\n      let y = rect.y + rect.height*0.5;\r\n\r\n      let e = {x : x, y : y, stopPropagation : () => {}, preventDefault : () => {}};\r\n\r\n      this._onpress(e);\r\n    }\r\n\r\n    super.click();\r\n  }\r\n\r\n  get customIcon() {\r\n    return this._customIcon;\r\n  }\r\n\r\n  set customIcon(domImage) {\r\n    this._customIcon = domImage;\r\n    this.setCSS();\r\n  }\r\n\r\n  get icon() {\r\n    return this._icon;\r\n  }\r\n\r\n  set icon(val) {\r\n    this._icon = val;\r\n    this.setCSS();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"iconbutton-x\",\r\n      style  : \"iconbutton\"\r\n    };\r\n  }\r\n\r\n  _on_press() {\r\n    this._pressed = true;\r\n    this.setCSS();\r\n  }\r\n\r\n  _on_depress() {\r\n    this._pressed = false;\r\n    this.setCSS();\r\n  }\r\n\r\n  updateDefaultSize() {\r\n\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    let def;\r\n    let pstyle = this.getDefault(\"depressed\");\r\n    let hstyle = this.getDefault(\"highlight\");\r\n\r\n    this.noMarginsOrPadding();\r\n\r\n    if (this._pressed && this._draw_pressed) {\r\n      def = k => pstyle && k in pstyle ? pstyle[k] : this.getDefault(k);\r\n    } else if (this._highlight) {\r\n      def = k => hstyle && k in hstyle ? hstyle[k] : this.getDefault(k);\r\n    } else {\r\n      def = k => this.getDefault(k);\r\n    }\r\n\r\n    let loadstyle = (key, addpx) => {\r\n      let val = def(key);\r\n      if (addpx) {\r\n        val = (\"\" + val).trim();\r\n\r\n        if (!val.toLowerCase().endsWith(\"px\")) {\r\n          val += \"px\";\r\n        }\r\n      }\r\n\r\n      this.style[key] = val;\r\n    }\r\n\r\n    let keys = [\"margin\", \"padding\", \"margin-left\", \"margin-right\", \"margin-top\", \"margin-botton\",\r\n                \"padding-left\", \"padding-bottom\", \"padding-top\", \"padding-right\",\r\n                \"border-radius\"]\r\n\r\n    for (let k of keys) {\r\n      loadstyle(k, true);\r\n    }\r\n    loadstyle(\"background-color\", false);\r\n    loadstyle(\"color\", false);\r\n\r\n    let border = `${def(\"border-width\", true)} ${def(\"border-style\", false)} ${def(\"border-color\", false)}`\r\n    this.style[\"border\"] = border;\r\n\r\n    let w = this.getDefault(\"width\");\r\n\r\n    let size = ui_base.iconmanager.getTileSize(this.iconsheet);\r\n    w = size;\r\n\r\n    this.style[\"width\"] = w + \"px\";\r\n    this.style[\"height\"] = w + \"px\";\r\n\r\n    this.dom.style[\"width\"] = w + \"px\";\r\n    this.dom.style[\"height\"] = w + \"px\";\r\n    this.dom.style[\"margin\"] = this.dom.style[\"padding\"] = \"0px\";\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"align-items\"] = \"center\";\r\n\r\n    if (this._customIcon) {\r\n      this.dom.style[\"background-image\"] = `url(\"${this._customIcon.src}\")`\r\n      this.dom.style[\"background-size\"] = \"contain\";\r\n      this.dom.style[\"background-repeat\"] = \"no-repeat\";\r\n    } else {\r\n      let icon = this.icon;\r\n\r\n      if (this._pressed && this._icon_pressed !== undefined) {\r\n        icon = this._icon_pressed;\r\n      }\r\n\r\n      ui_base.iconmanager.setCSS(icon, this.dom, this.iconsheet);\r\n    }\r\n\r\n    if (this._extraIcon !== undefined) {\r\n      let dom;\r\n\r\n      if (!this.extraDom) {\r\n        this.extraDom = dom = document.createElement(\"div\");\r\n\r\n        this.shadow.appendChild(dom);\r\n      } else {\r\n        dom = this.extraDom;\r\n      }\r\n\r\n      dom.style[\"position\"] = \"absolute\";\r\n      dom.style[\"margin\"] = dom.style[\"padding\"] = \"0px\";\r\n      dom.style[\"pointer-events\"] = \"none\";\r\n      dom.style[\"width\"] = size + \"px\";\r\n      dom.style[\"height\"] = size + \"px\";\r\n\r\n      ui_base.iconmanager.setCSS(this._extraIcon, dom, this.iconsheet);\r\n    } else if (this.extraDom) {\r\n      this.extraDom.remove();\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    let press = (e) => {\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n\r\n      if (this.modalRunning) {\r\n        this.popModal();\r\n      }\r\n\r\n      if (!eventWasTouch(e) && e.button !== 0) {\r\n        return;\r\n      }\r\n\r\n      if (1) { //!eventWasTouch(e)) {\r\n        let this2 = this;\r\n\r\n        this.pushModal({\r\n          on_mouseup(e) {\r\n            //touch events aren't fireing onclick automatically the way mouse ones are\r\n\r\n            if (this2.onclick && eventWasTouch(e)) {\r\n              this2.onclick();\r\n            }\r\n            this.end();\r\n          },\r\n          on_touchcancel(e) {\r\n            this.on_mouseup(e);\r\n            this.end();\r\n          },\r\n          on_touchend(e) {\r\n            this.on_mouseup(e);\r\n            this.end();\r\n          },\r\n          on_keydown(e) {\r\n            this.end();\r\n          },\r\n          end() {\r\n            if (this2.modalRunning) {\r\n              this2.popModal();\r\n              this2._on_depress(e)\r\n              this2.setCSS();\r\n            }\r\n          }\r\n        });\r\n      }\r\n\r\n      this._on_press(e);\r\n    }\r\n\r\n    let depress = (e) => {\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n\r\n      this._on_depress();\r\n      this.setCSS();\r\n    }\r\n\r\n    let high = (e) => {\r\n      this._highlight = true;\r\n      this.setCSS();\r\n    }\r\n\r\n    let unhigh = (e) => {\r\n      this._highlight = false;\r\n      this.setCSS();\r\n    }\r\n\r\n    this.tabIndex = 0;\r\n\r\n    this.addEventListener(\"mouseover\", high);\r\n    this.addEventListener(\"mouseexit\", unhigh);\r\n    this.addEventListener(\"mouseleave\", unhigh);\r\n    this.addEventListener(\"focus\", high);\r\n    this.addEventListener(\"blur\", unhigh);\r\n\r\n    this.addEventListener(\"mousedown\", press, {capture: true});\r\n    this.addEventListener(\"mouseup\", depress, {capture: true});\r\n    //this.addEventListener(\"touchstart\", press, {capture: true});\r\n    //this.addEventListener(\"touchcancel\", depress, {capture: true});\r\n    //this.addEventListener(\"touchend\", depress, {capture: true});\r\n    this.setCSS();\r\n\r\n    this.dom.style[\"pointer-events\"] = \"none\";\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    if (this.iconsheet !== this._last_iconsheet) {\r\n      this.setCSS();\r\n      this._last_iconsheet = this.iconsheet;\r\n    }\r\n  }\r\n\r\n  _getsize() {\r\n    let margin = this.getDefault(\"padding\");\r\n\r\n    return ui_base.iconmanager.getTileSize(this.iconsheet) + margin*2;\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(IconButton);\r\n\r\n\r\nexport class IconCheck extends IconButton {\r\n  constructor() {\r\n    super();\r\n\r\n    this._checked = undefined;\r\n    this._drawCheck = undefined;\r\n  }\r\n\r\n  get drawCheck() {\r\n    let ret = this._drawCheck;\r\n\r\n    ret = ret === undefined ? this.getDefault(\"drawCheck\") : ret;\r\n    ret = ret === undefined ? true : ret;\r\n\r\n    return ret;\r\n  }\r\n\r\n  set drawCheck(val) {\r\n    val = !!val;\r\n\r\n    if (val && (this.packflag & PackFlags.HIDE_CHECK_MARKS)) {\r\n      this.packflag &= ~PackFlags.HIDE_CHECK_MARKS;\r\n    }\r\n\r\n    let old = !!this.drawCheck;\r\n    this._drawCheck = val;\r\n\r\n    if (val !== old) {\r\n      this.updateDrawCheck();\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  click() {\r\n    super.click();\r\n    this.checked ^= true;\r\n  }\r\n\r\n  get icon() {\r\n    return this._icon;\r\n  }\r\n\r\n  set icon(val) {\r\n    this._icon = val;\r\n    this.setCSS();\r\n  }\r\n\r\n  get checked() {\r\n    return this._checked;\r\n  }\r\n\r\n  set checked(val) {\r\n    if (!!val !== !!this._checked) {\r\n      this._checked = val\r\n      this._updatePressed(!!val);\r\n      this.setCSS();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(val);\r\n      }\r\n    }\r\n  }\r\n\r\n  get noEmboss() {\r\n    let ret = this.getAttribute(\"no-emboss\");\r\n\r\n    if (!ret) {\r\n      return false;\r\n    }\r\n\r\n    ret = ret.toLowerCase().trim();\r\n\r\n    return ret === 'true' || ret === 'yes' || ret === 'on';\r\n  }\r\n\r\n  set noEmboss(val) {\r\n    this.setAttribute('no-emboss', val ? 'true' : 'false');\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname    : \"iconcheck-x\",\r\n      style      : \"iconcheck\",\r\n      parentStyle: \"iconbutton\"\r\n    };\r\n  }\r\n\r\n  _updatePressed(val) {\r\n    //don't set _pressed if we have a custom icon for press state\r\n    if (this._icon_pressed) {\r\n      this._draw_pressed = false;\r\n    }\r\n\r\n    this._pressed = val;\r\n    this.setCSS();\r\n  }\r\n\r\n  _on_depress() {\r\n    return;\r\n  }\r\n\r\n  _on_press() {\r\n    this.checked ^= true;\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), !!this.checked);\r\n    }\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  updateDefaultSize() {\r\n\r\n  }\r\n\r\n  _calcUpdateKey() {\r\n    return super._calcUpdateKey() + \":\" + this._icon;\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\") || !this.ctx) {\r\n      return;\r\n    }\r\n\r\n    if (this._icon < 0) {\r\n      let rdef;\r\n      try {\r\n        rdef = this.ctx.api.resolvePath(this.ctx, this.getAttribute(\"datapath\"));\r\n      } catch (error) {\r\n        if (error instanceof DataPathError) {\r\n          return;\r\n        } else {\r\n          throw error;\r\n        }\r\n      }\r\n\r\n      if (rdef !== undefined && rdef.prop) {\r\n        let icon, icon2, title;\r\n\r\n        if (rdef.prop.flag & PropFlags.NO_UNDO) {\r\n          this.setUndo(false);\r\n        } else {\r\n          this.setUndo(true);\r\n        }\r\n\r\n        //console.log(\"SUBKEY\", rdef.subkey, rdef.prop.iconmap);\r\n\r\n        if (rdef.subkey && (rdef.prop.type === PropTypes.FLAG || rdef.prop.type === PropTypes.ENUM)) {\r\n          icon = rdef.prop.iconmap[rdef.subkey];\r\n          icon2 = rdef.prop.iconmap2[rdef.subkey];\r\n          title = rdef.prop.descriptions[rdef.subkey];\r\n\r\n          if (title === undefined && rdef.subkey.length > 0) {\r\n            title = rdef.subkey;\r\n            title = title[0].toUpperCase() + title.slice(1, title.length).toLowerCase();\r\n          }\r\n        } else {\r\n          icon2 = rdef.prop.icon2;\r\n          icon = rdef.prop.icon;\r\n          title = rdef.prop.description;\r\n        }\r\n\r\n        if (icon2 !== undefined && icon2 !== -1) {\r\n          this._icon_pressed = icon;\r\n          icon = icon2;\r\n        }\r\n\r\n        if (icon !== undefined && icon !== this.icon)\r\n          this.icon = icon;\r\n        if (title !== undefined)\r\n          this.description = title;\r\n      }\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (val === undefined) {\r\n      this.internalDisabled = true;\r\n      return;\r\n    } else {\r\n      this.internalDisabled = false;\r\n    }\r\n\r\n    val = !!val;\r\n\r\n    if (val !== !!this._checked) {\r\n      this._checked = val;\r\n      this._updatePressed(!!val);\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  updateDrawCheck() {\r\n    if (this.drawCheck) {\r\n      this._extraIcon = this._checked ? ui_base.Icons.ENUM_CHECKED : ui_base.Icons.ENUM_UNCHECKED;\r\n    } else {\r\n      this._extraIcon = undefined;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    if (this.packflag & PackFlags.HIDE_CHECK_MARKS) {\r\n      this.drawCheck = false;\r\n    }\r\n\r\n    this.updateDrawCheck();\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n\r\n    super.update();\r\n  }\r\n\r\n  _getsize() {\r\n    let margin = this.getDefault(\"padding\");\r\n    return ui_base.iconmanager.getTileSize(this.iconsheet) + margin*2;\r\n  }\r\n\r\n  setCSS() {\r\n    this.updateDrawCheck();\r\n    super.setCSS();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(IconCheck);\r\n\r\nexport class Check1 extends Button {\r\n  constructor() {\r\n    super();\r\n\r\n    this._namePad = 40;\r\n    this._value = undefined;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname    : \"check1-x\",\r\n      parentStyle: \"button\"\r\n    };\r\n  }\r\n\r\n  _redraw() {\r\n    //console.log(\"button draw\");\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let box = 40;\r\n    ui_base.drawRoundBox(this, this.dom, this.g, box);\r\n\r\n    let ts = this.getDefault(\"DefaultText\").size;\r\n\r\n    let text = this._genLabel();\r\n\r\n    //console.log(text, \"text\", this._name);\r\n\r\n    let tw = ui_base.measureText(this, text, this.dom, this.g).width;\r\n    let cx = this.dom.width/2 - tw/2;\r\n    let cy = this.dom.height/2;\r\n\r\n    ui_base.drawText(this, box, cy + ts/2, text, {\r\n      canvas: this.dom, g: this.g\r\n    });\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(Check1);\r\n\r\nexport {checkForTextBox} from './ui_textbox.js';\r\n","export function saveFile(data, filename=\"unnamed\", exts=[], mime=\"application/x-octet-stream\") {\r\n  let blob = new Blob([data], {type : mime});\r\n  let url = URL.createObjectURL(blob);\r\n\r\n  let a = document.createElement(\"a\");\r\n  a.setAttribute(\"href\", url);\r\n  a.setAttribute(\"download\", filename);\r\n\r\n  a.click();\r\n}\r\n\r\n//returns a promise\r\nexport function loadFile(filename=\"unnamed\", exts=[]) {\r\n  let input = document.createElement(\"input\");\r\n  input.type = \"file\";\r\n\r\n  exts = exts.join(\",\");\r\n\r\n  input.setAttribute(\"accept\", exts)\r\n  return new Promise((accept, reject) => {\r\n    input.onchange = function(e) {\r\n      if (this.files === undefined || this.files.length !== 1) {\r\n        reject(\"file load error\");\r\n        return;\r\n      }\r\n\r\n      let file = this.files[0];\r\n      let reader = new FileReader();\r\n\r\n      reader.onload = function(e2) {\r\n        accept(e2.target.result);\r\n      };\r\n\r\n      reader.readAsArrayBuffer(file);\r\n    }\r\n    input.click();\r\n  });\r\n}\r\n\r\nwindow._testLoadFile = function(exts=[\"*.*\"]) {\r\n  loadFile(undefined, exts).then((data) => {\r\n    console.log(\"got file data:\", data);\r\n  });\r\n};\r\n\r\nwindow._testSaveFile = function() {\r\n  let buf = _appstate.createFile();\r\n  //console.log(buf);\r\n  saveFile(buf, \"unnamed.w3d\", [\".w3d\"]);\r\n}","\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport cconst from '../config/const.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport {OldButton} from \"./ui_button.js\";\r\nimport {DomEventTypes} from '../path-controller/util/events.js';\r\n\r\nimport {HotKey, keymap} from '../path-controller/util/simple_events.js';\r\n\r\nlet EnumProperty = toolprop.EnumProperty,\r\n    PropTypes    = toolprop.PropTypes;\r\n\r\nlet UIBase     = ui_base.UIBase,\r\n    PackFlags  = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nfunction getpx(css) {\r\n  return parseFloat(css.trim().replace(\"px\", \"\"))\r\n}\r\n\r\nfunction debugmenu() {\r\n  if (window.DEBUG && window.DEBUG.menu) {\r\n    console.warn(\"%cmenu:\", \"color:blue\", ...arguments);\r\n  }\r\n}\r\n\r\n\r\nexport class Menu extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.parentMenu = undefined;\r\n\r\n    this._was_clicked = false;\r\n\r\n    this.items = [];\r\n    this.autoSearchMode = true;\r\n\r\n    this._ignoreFocusEvents = false;\r\n    this.closeOnMouseUp = true;\r\n\r\n    this._submenu = undefined;\r\n\r\n    this.ignoreFirstClick = false;\r\n\r\n    this.itemindex = 0;\r\n    this.closed = false;\r\n    this.started = false;\r\n    this.activeItem = undefined;\r\n\r\n    this.overrideDefault(\"DefaultText\", this.getDefault(\"MenuText\"));\r\n\r\n    //we have to make a container for any submenus to\r\n    this.container = document.createElement(\"span\");\r\n    this.container.style[\"display\"] = \"flex\";\r\n    this.container.style[\"color\"] = this.getDefault(\"MenuText\").color;\r\n\r\n    //this.container.style[\"background-color\"] = \"red\";\r\n    this.container.setAttribute(\"class\", \"menucon\");\r\n\r\n    this.dom = document.createElement(\"ul\");\r\n    this.dom.setAttribute(\"class\", \"menu\");\r\n    /*\r\n              place-items: start start;\r\n              flex-wrap : nowrap;\r\n              align-content : start;\r\n              place-content : start;\r\n              justify-content : start;\r\n\r\n              align-items : start;\r\n              place-items : start;\r\n              justify-items : start;\r\n    */\r\n\r\n    let style = this.menustyle = document.createElement(\"style\");\r\n    this.buildStyle();\r\n\r\n    this.dom.setAttribute(\"tabindex\", -1);\r\n\r\n    //the menu wrangler handles key events\r\n\r\n    this.shadow.appendChild(style);\r\n    this.shadow.appendChild(this.container);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"menu-x\",\r\n      style  : \"menu\"\r\n    };\r\n  }\r\n\r\n  float(x, y, zindex = undefined) {\r\n    let dpi = this.getDPI();\r\n    let rect = this.dom.getClientRects();\r\n    let maxx = this.getWinWidth() - 10;\r\n    let maxy = this.getWinHeight() - 10;\r\n\r\n    if (rect.length > 0) {\r\n      rect = rect[0];\r\n      if (y + rect.height > maxy) {\r\n        y = maxy - rect.height - 1;\r\n      }\r\n\r\n      if (x + rect.width > maxx) {\r\n        x = maxx - rect.width - 1;\r\n      }\r\n    }\r\n\r\n    super.float(x, y, 50);\r\n  }\r\n\r\n  click() {\r\n    if (this._was_clicked) {\r\n      return;\r\n    }\r\n\r\n    if (this.ignoreFirstClick) {\r\n      this.ignoreFirstClick = Math.max(this.ignoreFirstClick - 1, 0);\r\n      return;\r\n    }\r\n\r\n    if (!this.activeItem || this.activeItem._isMenu) {\r\n      return;\r\n    }\r\n\r\n    this._was_clicked = true;\r\n\r\n    if (this.onselect) {\r\n      try {\r\n        this.onselect(this.activeItem._id);\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        console.log(\"Error in menu callback\");\r\n      }\r\n    }\r\n\r\n    this.close();\r\n  }\r\n\r\n  _ondestroy() {\r\n    if (this.started) {\r\n      menuWrangler.popMenu(this);\r\n\r\n      if (this.onclose) {\r\n        this.onclose();\r\n      }\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this.setCSS();\r\n  }\r\n\r\n  close() {\r\n    if (this.closed) {\r\n      return;\r\n    }\r\n\r\n    this.closed = true;\r\n\r\n    if (this.started) {\r\n      menuWrangler.popMenu(this);\r\n    }\r\n\r\n    this.started = false;\r\n\r\n    if (this._popup) {\r\n      this._popup.end();\r\n      this._popup = undefined;\r\n    }\r\n\r\n    this.remove();\r\n    this.dom.remove();\r\n\r\n    if (this.onclose) {\r\n      this.onclose(this);\r\n    }\r\n  }\r\n\r\n  _select(dir, focus = true) {\r\n    if (this.activeItem === undefined) {\r\n      for (let item of this.items) {\r\n        if (!item.hidden) {\r\n          this.setActive(item, focus);\r\n          break;\r\n        }\r\n      }\r\n    } else {\r\n      let i = this.items.indexOf(this.activeItem);\r\n      let item = this.activeItem;\r\n\r\n      do {\r\n        i = (i + dir + this.items.length)%this.items.length;\r\n        item = this.items[i];\r\n\r\n        if (!item.hidden) {\r\n          break;\r\n        }\r\n      } while (item !== this.activeItem);\r\n\r\n      this.setActive(item, focus);\r\n    }\r\n\r\n    if (this.hasSearchBox) {\r\n      this.activeItem.scrollIntoView();\r\n    }\r\n  }\r\n\r\n  selectPrev(focus = true) {\r\n    return this._select(-1, focus);\r\n  }\r\n\r\n  selectNext(focus = true) {\r\n    return this._select(1, focus);\r\n  }\r\n\r\n  start_fancy(prepend, setActive = true) {\r\n    return this.startFancy(prepend, setActive);\r\n  }\r\n\r\n  setActive(item, focus = true) {\r\n    if (this.activeItem === item) {\r\n      return;\r\n    }\r\n\r\n    if (this.activeItem) {\r\n      this.activeItem.style[\"background-color\"] = this.getDefault(\"MenuBG\");\r\n\r\n      if (focus) {\r\n        this.activeItem.blur();\r\n      }\r\n    }\r\n\r\n    if (item) {\r\n      item.style[\"background-color\"] = this.getDefault(\"MenuHighlight\");\r\n\r\n      if (focus) {\r\n        item.focus();\r\n      }\r\n    }\r\n\r\n    this.activeItem = item;\r\n  }\r\n\r\n  startFancy(prepend, setActive = true) {\r\n    this.hasSearchBox = true;\r\n    this.started = true;\r\n    menuWrangler.pushMenu(this);\r\n\r\n    let dom2 = document.createElement(\"div\");\r\n    //let dom2 = document.createElement(\"div\");\r\n\r\n    this.dom.setAttribute(\"class\", \"menu\");\r\n    dom2.setAttribute(\"class\", \"menu\");\r\n\r\n    let sbox = this.textbox = UIBase.createElement(\"textbox-x\");\r\n    this.textbox.parentWidget = this;\r\n\r\n    dom2.appendChild(sbox);\r\n    dom2.appendChild(this.dom);\r\n\r\n    dom2.style[\"height\"] = \"300px\";\r\n    this.dom.style[\"height\"] = \"300px\";\r\n    this.dom.style[\"overflow\"] = \"scroll\";\r\n\r\n    if (prepend) {\r\n      this.container.prepend(dom2);\r\n    } else {\r\n      this.container.appendChild(dom2);\r\n    }\r\n\r\n    dom2.parentWidget = this.container;\r\n\r\n    sbox.focus();\r\n    sbox.onchange = () => {\r\n      let t = sbox.text.trim().toLowerCase();\r\n\r\n      for (let item of this.items) {\r\n        item.hidden = true;\r\n        item.remove();\r\n      }\r\n\r\n      for (let item of this.items) {\r\n        let ok = t == \"\";\r\n        ok = ok || item.innerHTML.toLowerCase().search(t) >= 0;\r\n\r\n        if (ok) {\r\n          item.hidden = false;\r\n          this.dom.appendChild(item);\r\n        } else if (item === this.activeItem) {\r\n          this.selectNext(false);\r\n        }\r\n        //item.hidden = !ok;\r\n      }\r\n    }\r\n\r\n    sbox.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case 27: //escape key\r\n          this.close();\r\n          break;\r\n        case 13: //enter key\r\n          this.click(this.activeItem);\r\n          this.close();\r\n          break;\r\n      }\r\n    });\r\n  }\r\n\r\n  start(prepend = false, setActive = true) {\r\n    this.closed = false;\r\n\r\n    this.started = true;\r\n    this.focus();\r\n\r\n    menuWrangler.pushMenu(this);\r\n\r\n    let dokey = (key) => {\r\n      let val = this.getDefault(key);\r\n      if (typeof val === \"number\") {\r\n        val = \"\" + val + \"px\";\r\n      }\r\n\r\n      if (val !== undefined) {\r\n        this.dom.style[key] = val;\r\n      }\r\n    }\r\n\r\n    dokey(\"padding\");\r\n    dokey(\"padding-top\");\r\n    dokey(\"padding-left\");\r\n    dokey(\"padding-right\");\r\n    dokey(\"padding-bottom\");\r\n\r\n    if (this.items.length > 15 && this.autoSearchMode) {\r\n      return this.start_fancy(prepend, setActive);\r\n    }\r\n\r\n    if (prepend) {\r\n      this.container.prepend(this.dom);\r\n    } else {\r\n      this.container.appendChild(this.dom);\r\n    }\r\n\r\n    if (!setActive)\r\n      return;\r\n\r\n    this.setCSS();\r\n    this.flushUpdate();\r\n\r\n    window.setTimeout(() => {\r\n      this.flushUpdate();\r\n\r\n      //select first child\r\n      //TODO: cache last child entry\r\n\r\n      if (this.activeItem === undefined) {\r\n        this.activeItem = this.dom.childNodes[0];\r\n      }\r\n\r\n      if (this.activeItem === undefined) {\r\n        return;\r\n      }\r\n\r\n      this.activeItem.focus();\r\n    }, 0);\r\n  }\r\n\r\n  addItemExtra(text, id = undefined, hotkey, icon = -1, add = true, tooltip = undefined) {\r\n    let dom = document.createElement(\"span\");\r\n\r\n    dom.style[\"display\"] = \"inline-flex\";\r\n\r\n    dom.hotkey = hotkey;\r\n    dom.icon = icon;\r\n\r\n    let icon_div;\r\n\r\n    if (1) { //icon >= 0) {\r\n      icon_div = ui_base.makeIconDiv(icon, IconSheets.SMALL);\r\n    } else {\r\n      let tilesize = ui_base.iconmanager.getTileSize(IconSheets.SMALL);\r\n\r\n      //tilesize *= window.devicePixelRatio;\r\n\r\n      icon_div = document.createElement(\"span\");\r\n      icon_div.style[\"padding\"] = icon_div.style[\"margin\"] = \"0px\";\r\n      icon_div.style[\"width\"] = tilesize + \"px\";\r\n      icon_div.style[\"height\"] = tilesize + \"px\";\r\n    }\r\n\r\n    icon_div.style[\"display\"] = \"inline-flex\";\r\n    icon_div.style[\"margin-right\"] = \"1px\";\r\n    icon_div.style[\"align\"] = \"left\";\r\n\r\n    let span = document.createElement(\"span\");\r\n\r\n    //stupid css doesn't get width right. . .\r\n    span.style[\"font\"] = ui_base.getFont(this, undefined, \"MenuText\");\r\n\r\n    let dpi = this.getDPI();\r\n    let tsize = this.getDefault(\"MenuText\").size;\r\n    //XXX proportional font fail\r\n\r\n    //XXX stupid!\r\n    let canvas = document.createElement(\"canvas\");\r\n    let g = canvas.getContext(\"2d\");\r\n\r\n    g.font = span.style[\"font\"];\r\n\r\n    let rect = span.getClientRects();\r\n\r\n    let twid = Math.ceil(g.measureText(text).width);\r\n    let hwid;\r\n    if (hotkey) {\r\n      dom.hotkey = hotkey;\r\n      g.font = ui_base.getFont(this, undefined, \"HotkeyText\");\r\n      hwid = Math.ceil(g.measureText(hotkey).width/UIBase.getDPI());\r\n      twid += hwid + 8;\r\n    }\r\n\r\n    //let twid = Math.ceil(text.trim().length * tsize / dpi);\r\n\r\n    span.innerText = text;\r\n\r\n    span.style[\"word-wrap\"] = \"none\";\r\n    span.style[\"white-space\"] = \"pre\";\r\n    span.style[\"overflow\"] = \"hidden\";\r\n    span.style[\"text-overflow\"] = \"clip\";\r\n\r\n    span.style[\"width\"] = ~~(twid) + \"px\";\r\n    span.style[\"padding\"] = \"0px\";\r\n    span.style[\"margin\"] = \"0px\";\r\n\r\n    dom.style[\"width\"] = \"100%\";\r\n\r\n    dom.appendChild(icon_div);\r\n    dom.appendChild(span);\r\n\r\n    if (hotkey) {\r\n      let hotkey_span = document.createElement(\"span\");\r\n      hotkey_span.innerText = hotkey;\r\n      hotkey_span.style[\"display\"] = \"inline-flex\";\r\n\r\n      hotkey_span.style[\"margin\"] = \"0px\";\r\n      hotkey_span.style[\"margin-left\"] = \"auto\";\r\n      hotkey_span.style[\"margin-right\"] = \"0px\";\r\n      hotkey_span.style[\"padding\"] = \"0px\";\r\n\r\n      hotkey_span.style[\"font\"] = ui_base.getFont(this, undefined, \"HotkeyText\");\r\n      hotkey_span.style[\"color\"] = this.getDefault(\"HotkeyTextColor\");\r\n\r\n      //hotkey_span.style[\"width\"] = ~~((hwid + 7)) + \"px\";\r\n      hotkey_span.style[\"width\"] = \"max-content\";\r\n\r\n      //hotkey_span.style[\"background-color\"] = \"rgba(0,0,0,0)\";\r\n\r\n      hotkey_span.style[\"text-align\"] = \"right\";\r\n      hotkey_span.style[\"justify-content\"] = \"right\";\r\n      hotkey_span[\"flex-wrap\"] = \"nowrap\";\r\n      hotkey_span[\"text-wrap\"] = \"nowrap\";\r\n\r\n      //hotkey_span.style[\"border\"] = \"1px solid red\";\r\n\r\n      //hotkey_span.style[\"display\"] = \"inline\";\r\n      //hotkey_span.style[\"float\"] = \"right\";\r\n\r\n      dom.appendChild(hotkey_span);\r\n    }\r\n\r\n    let ret = this.addItem(dom, id, add);\r\n\r\n    ret.hotkey = hotkey;\r\n    ret.icon = icon;\r\n    ret.label = text ? text : ret.innerText;\r\n\r\n    if (tooltip) {\r\n      ret.title = tooltip;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  //item can be menu or text\r\n  addItem(item, id, add = true, tooltip = undefined) {\r\n    id = id === undefined ? item : id;\r\n    let text = item;\r\n\r\n    if (typeof item === \"string\" || item instanceof String) {\r\n      let dom = document.createElement(\"dom\");\r\n      dom.style[\"text-align\"] = \"left\";\r\n\r\n      dom.textContent = item;\r\n      item = dom;\r\n      //return this.addItemExtra(item, id);\r\n    } else {\r\n      text = item.textContent;\r\n    }\r\n\r\n    let li = document.createElement(\"li\");\r\n\r\n    li.setAttribute(\"tabindex\", this.itemindex++);\r\n    li.setAttribute(\"class\", \"menuitem\");\r\n\r\n    if (tooltip !== undefined) {\r\n      li.title = tooltip;\r\n    }\r\n\r\n    if (item instanceof Menu) {\r\n      //let dom = this.addItemExtra(\"\"+item.title, id, \"\", -1, false);\r\n      let dom = document.createElement(\"span\");\r\n      dom.innerHTML = \"\" + item.title;\r\n      dom._id = dom.id = id;\r\n      dom.setAttribute(\"class\", \"menu\")\r\n\r\n      //dom = document.createElement(\"div\");\r\n      //dom.innerText = \"\"+item.title;\r\n\r\n      //dom.style[\"display\"] = \"inline-block\";\r\n      li.style[\"width\"] = \"100%\"\r\n      li.appendChild(dom);\r\n\r\n      li._isMenu = true;\r\n      li._menu = item;\r\n      item.parentMenu = this;\r\n\r\n      item.hidden = false;\r\n      item.container = this.container;\r\n    } else {\r\n      li._isMenu = false;\r\n      li.appendChild(item);\r\n    }\r\n\r\n    li._id = id;\r\n\r\n    this.items.push(li);\r\n\r\n    li.label = text ? text : li.innerText.trim();\r\n\r\n    if (add) {\r\n      li.addEventListener(\"blur\", (e) => {\r\n        if (this._ignoreFocusEvents) {\r\n          return;\r\n        }\r\n\r\n        if (this.activeItem && !this.activeItem._isMenu) {\r\n          this.setActive(undefined, false);\r\n        }\r\n      });\r\n\r\n      let onfocus = (e) => {\r\n        if (this._ignoreFocusEvents) {\r\n          return;\r\n        }\r\n\r\n        let active = this.activeItem;\r\n\r\n        if (this._submenu) {\r\n          this._submenu.close();\r\n          this._submenu = undefined;\r\n        }\r\n\r\n        if (li._isMenu) {\r\n          li._menu.onselect = (item) => {\r\n            this.onselect(item);\r\n            li._menu.close();\r\n            this.close();\r\n          };\r\n\r\n          li._menu.start(false, false);\r\n          this._submenu = li._menu;\r\n        }\r\n\r\n        this.setActive(li, false);\r\n      };\r\n\r\n      let onclick = (e) => {\r\n        onfocus(e);\r\n\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n\r\n        if (this.activeItem !== undefined && this.activeItem._isMenu) {\r\n          //ignore\r\n          return;\r\n        }\r\n\r\n        this.click();\r\n      }\r\n\r\n      li.addEventListener(\"contextmenu\", e => e.preventDefault());\r\n      this.addEventListener(\"contextmenu\", e => e.preventDefault());\r\n\r\n      li.addEventListener(\"pointerup\", onclick, {capture: true});\r\n      li.addEventListener(\"click\", onclick, {capture: true});\r\n      li.addEventListener(\"pointerdown\", onclick, {capture: true});\r\n\r\n      li.addEventListener(\"focus\", (e) => {\r\n        onfocus(e);\r\n        onfocus(e);\r\n      })\r\n\r\n      li.addEventListener(\"pointermove\", (e) => {\r\n        onfocus(e);\r\n        li.focus();\r\n      });\r\n      li.addEventListener(\"mouseover\", (e) => {\r\n        onfocus(e);\r\n        li.focus();\r\n      });\r\n      li.addEventListener(\"mouseenter\", (e) => {\r\n        onfocus(e);\r\n        li.focus();\r\n      });\r\n\r\n      li.addEventListener(\"pointerover\", (e) => {\r\n        onfocus(e);\r\n        li.focus();\r\n      });\r\n\r\n      this.dom.appendChild(li);\r\n    }\r\n\r\n    return li;\r\n  }\r\n\r\n  _getBorderStyle() {\r\n    let r = this.getDefault(\"border-width\");\r\n    let s = this.getDefault(\"border-style\");\r\n    let c = this.getDefault(\"border-color\");\r\n\r\n    return `${r}px ${s} ${c}`;\r\n  }\r\n\r\n  buildStyle() {\r\n    let pad1 = util.isMobile() ? 2 : 0;\r\n    pad1 += this.getDefault(\"MenuSpacing\");\r\n\r\n    let boxShadow = \"\";\r\n    if (this.hasDefault(\"box-shadow\")) {\r\n      boxShadow = \"box-shadow: \" + this.getDefault(\"box-shadow\") + ';';\r\n    }\r\n\r\n    let sepcss = this.getDefault(\"MenuSeparator\");\r\n    if (typeof sepcss === \"object\") {\r\n      let s = '';\r\n\r\n      for (let k in sepcss) {\r\n        let v = sepcss[k];\r\n\r\n        if (typeof v === \"number\") {\r\n          v = v.toFixed(4) + \"px\";\r\n        }\r\n\r\n        s += `    ${k}: ${v};\\n`;\r\n      }\r\n\r\n      sepcss = s;\r\n    }\r\n\r\n    let itemRadius = 0;\r\n\r\n    if (this.hasDefault(\"item-radius\")) {\r\n      itemRadius = this.getDefault(\"item-radius\");\r\n    } else {\r\n      itemRadius = this.getDefault(\"border-radius\");\r\n    }\r\n\r\n    this.menustyle.textContent = `\r\n        .menucon {\r\n          position:fixed;\r\n          float:left;\r\n          \r\n          border-radius : ${this.getDefault(\"border-radius\")}px;\r\n\r\n          display: block;\r\n          -moz-user-focus: normal;\r\n          ${boxShadow}\r\n        }\r\n        \r\n        ul.menu {\r\n          display        : flex;\r\n          flex-direction : column;\r\n          flex-wrap      : nowrap;\r\n          width          : max-content;\r\n          \r\n          margin : 0px;\r\n          padding : 0px;\r\n          border : ${this._getBorderStyle()};\r\n          border-radius : ${this.getDefault(\"border-radius\")}px;\r\n          -moz-user-focus: normal;\r\n          background-color: ${this.getDefault(\"MenuBG\")};\r\n          color : ${this.getDefault(\"MenuText\").color};\r\n        }\r\n        \r\n        .menuitem {\r\n          display : flex;\r\n          flex-wrap : nowrap;\r\n          flex-direction : row;          \r\n          \r\n          list-style-type:none;\r\n          -moz-user-focus: normal;\r\n          \r\n          margin : 0;\r\n          padding : 0px;\r\n          padding-right: 16px;\r\n          padding-left: 16px;\r\n          padding-top : ${pad1}px;\r\n          padding-bottom : ${pad1}px;\r\n          \r\n          border-radius : ${itemRadius}px;\r\n          \r\n          color : ${this.getDefault(\"MenuText\").color};\r\n          font : ${this.getDefault(\"MenuText\").genCSS()};\r\n          background-color: ${this.getDefault(\"MenuBG\")};\r\n        }\r\n        \r\n        .menuseparator {\r\n          ${sepcss}\r\n        }\r\n        \r\n        .menuitem:focus {\r\n          display : flex;\r\n          text-align: left;\r\n          \r\n          border : none;\r\n          outline : none;\r\n          border-radius : ${itemRadius}px;\r\n          \r\n          background-color: ${this.getDefault(\"MenuHighlight\")};\r\n          color : ${this.getDefault(\"MenuText\").color};\r\n          -moz-user-focus: normal;\r\n        }\r\n      `;\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.buildStyle();\r\n\r\n    this.container.style[\"color\"] = this.getDefault(\"MenuText\").color;\r\n    this.style[\"color\"] = this.getDefault(\"MenuText\").color;\r\n  }\r\n\r\n  seperator() {\r\n    let bar = document.createElement(\"div\");\r\n    bar.setAttribute(\"class\", \"menuseparator\");\r\n\r\n    this.dom.appendChild(bar);\r\n\r\n    return this;\r\n  }\r\n\r\n  menu(title) {\r\n    let ret = UIBase.createElement(\"menu-x\");\r\n\r\n    ret.setAttribute(\"name\", title);\r\n    this.addItem(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  calcSize() {\r\n\r\n  }\r\n}\r\n\r\nMenu.SEP = Symbol(\"menu seperator\");\r\nUIBase.internalRegister(Menu);\r\n\r\nexport class DropBox extends OldButton {\r\n  constructor() {\r\n    super();\r\n\r\n    this.lockTimer = 0;\r\n\r\n    this._template = undefined;\r\n\r\n    this._searchMenuMode = false;\r\n    this.altKey = undefined;\r\n\r\n    this._value = 0;\r\n\r\n    this._last_datapath = undefined;\r\n\r\n    this.r = 5;\r\n    this._menu = undefined;\r\n    this._auto_depress = false;\r\n    //this.prop = new ui_base.EnumProperty(undefined, {}, \"\", \"\", 0);\r\n\r\n    this._onpress = this._onpress.bind(this);\r\n  }\r\n\r\n  get searchMenuMode() {\r\n    return this._searchMenuMode;\r\n  }\r\n\r\n  set searchMenuMode(v) {\r\n    this._searchMenuMode = v;\r\n  }\r\n\r\n  get template() {\r\n    return this._template;\r\n  }\r\n\r\n  set template(v) {\r\n    this._template = v;\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(v) {\r\n    this.setValue(v);\r\n  }\r\n\r\n  get menu() {\r\n    return this._menu;\r\n  }\r\n\r\n  set menu(val) {\r\n    this._menu = val;\r\n\r\n    if (val !== undefined) {\r\n      this._name = val.title;\r\n      this.updateName();\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"dropbox-x\",\r\n      style  : \"dropbox\"\r\n    };\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.setAttribute(\"menu-button\", \"true\");\r\n\r\n    this.updateWidth();\r\n  }\r\n\r\n  setCSS() {\r\n    //do not call parent classes's setCSS here\r\n\r\n    this.style[\"user-select\"] = \"none\";\r\n    this.dom.style[\"user-select\"] = \"none\";\r\n\r\n    let keys;\r\n    if (this.getAttribute(\"simple\")) {\r\n      keys = [\"margin-left\", \"margin-right\", \"padding-left\", \"padding-right\"];\r\n    } else {\r\n      keys = [\r\n        \"margin\", \"margin-left\", \"margin-right\",\r\n        \"margin-top\", \"margin-bottom\", \"padding\",\r\n        \"padding-left\", \"padding-right\", \"padding-top\",\r\n        \"padding-bottom\"];\r\n    }\r\n\r\n    let setDefault = (key) => {\r\n      if (this.hasDefault(key)) {\r\n        this.dom.style[key] = this.getDefault(key, undefined, 0) + \"px\";\r\n      }\r\n    }\r\n\r\n    for (let k of keys) {\r\n      setDefault(k);\r\n    }\r\n  }\r\n\r\n  _genLabel() {\r\n    let s = super._genLabel();\r\n    let ret = \"\";\r\n\r\n    if (s.length === 0) {\r\n      s = \"(error)\";\r\n    }\r\n\r\n    this.altKey = s[0].toUpperCase().charCodeAt(0);\r\n\r\n    for (let i = 0; i < s.length; i++) {\r\n      if (s[i] === \"&\" && i < s.length - 1 && s[i + 1] !== \"&\") {\r\n        this.altKey = s[i + 1].toUpperCase().charCodeAt(0);\r\n      } else if (s[i] === \"&\" && i < s.length - 1 && s[i + 1] === \"&\") {\r\n        continue;\r\n      } else {\r\n        ret += s[i];\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  updateWidth() {\r\n    //let ret = super.updateWidth(10);\r\n    let dpi = this.getDPI();\r\n\r\n    let ts = this.getDefault(\"DefaultText\").size;\r\n    let tw = this.g.measureText(this._genLabel()).width/dpi;\r\n    //let tw = ui_base.measureText(this, this._genLabel(), undefined, undefined, ts).width + 8;\r\n    tw = ~~tw;\r\n\r\n    tw += 15;\r\n\r\n    if (!this.getAttribute(\"simple\")) {\r\n      tw += 35;\r\n    }\r\n\r\n    if (tw !== this._last_w) {\r\n      this._last_w = tw;\r\n      this.dom.style[\"width\"] = tw + \"px\";\r\n      this.style[\"width\"] = tw + \"px\";\r\n      this.width = tw;\r\n\r\n      this.overrideDefault(\"width\", tw);\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n\r\n    return 0;\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.ctx || !this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let wasError = false;\r\n    let prop, val;\r\n\r\n    try {\r\n      this.pushReportContext(this._reportCtxName);\r\n      prop = this.ctx.api.resolvePath(this.ctx, this.getAttribute(\"datapath\")).prop;\r\n      val = this.ctx.api.getValue(this.ctx, this.getAttribute(\"datapath\"));\r\n      this.popReportContext();\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n      wasError = true;\r\n    }\r\n\r\n    if (wasError) {\r\n      this.disabled = true;\r\n      this.setCSS();\r\n      this._redraw();\r\n\r\n      return;\r\n    } else {\r\n      this.disabled = false;\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n\r\n    if (!prop) {\r\n      return;\r\n    }\r\n\r\n    if (this.prop === undefined) {\r\n      this.prop = prop;\r\n    }\r\n\r\n    prop = this.prop;\r\n\r\n    let name = this.getAttribute(\"name\");\r\n\r\n    if (prop.type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n      name = prop.ui_value_names[prop.keys[val]];\r\n    } else {\r\n      name = \"\" + val;\r\n    }\r\n\r\n    if (name !== this.getAttribute(\"name\")) {\r\n      this.setAttribute(\"name\", name);\r\n      this.updateName();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    let path = this.getAttribute(\"datapath\");\r\n\r\n    if (path && path !== this._last_datapath) {\r\n      this._last_datapath = path;\r\n      this.prop = undefined;\r\n\r\n      this.updateDataPath();\r\n    }\r\n\r\n    super.update();\r\n\r\n    let key = this.getDefault(\"dropTextBG\");\r\n    if (key !== this._last_dbox_key) {\r\n      this._last_dbox_key = key;\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n  }\r\n\r\n  _build_menu_template() {\r\n    if (this._menu !== undefined && this._menu.parentNode !== undefined) {\r\n      this._menu.remove();\r\n    }\r\n\r\n    //let name = \"\" + this.getAttribute(\"name\");\r\n    let template = this._template;\r\n\r\n    if (typeof template === \"function\") {\r\n      template = template();\r\n    }\r\n\r\n    this._menu = createMenu(this.ctx, \"\", template);\r\n    return this._menu;\r\n  }\r\n\r\n  _build_menu() {\r\n    if (this._template) {\r\n      this._build_menu_template();\r\n      return;\r\n    }\r\n\r\n    let prop = this.prop;\r\n\r\n    if (this.prop === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this._menu !== undefined && this._menu.parentNode !== undefined) {\r\n      this._menu.remove();\r\n    }\r\n\r\n    let menu = this._menu = UIBase.createElement(\"menu-x\");\r\n\r\n    //let name = \"\" + this.getAttribute(\"name\");\r\n    menu.setAttribute(\"name\", \"\");\r\n    menu._dropbox = this;\r\n\r\n    let valmap = {};\r\n    let enummap = prop.values;\r\n    let iconmap = prop.iconmap;\r\n    let uimap = prop.ui_value_names;\r\n    let desr = prop.descriptions || {};\r\n\r\n    for (let k in enummap) {\r\n      let uk = k;\r\n\r\n      valmap[enummap[k]] = k;\r\n\r\n      if (uimap !== undefined && k in uimap) {\r\n        uk = uimap[k];\r\n      }\r\n\r\n      let tooltip = desr[k];\r\n\r\n      //menu.addItem(k, enummap[k], \":\");\r\n      if (iconmap && iconmap[k]) {\r\n        menu.addItemExtra(uk, enummap[k], undefined, iconmap[k], undefined, tooltip);\r\n      } else {\r\n        menu.addItem(uk, enummap[k], undefined, tooltip);\r\n      }\r\n    }\r\n\r\n    menu.onselect = (id) => {\r\n      this._pressed = false;\r\n\r\n      this._pressed = false;\r\n      this._redraw();\r\n\r\n      this._menu = undefined;\r\n\r\n      //check if datapath system will be calling .prop.setValue instead of us\r\n      let callProp = true;\r\n      if (this.hasAttribute(\"datapath\")) {\r\n        let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n        callProp = !prop || prop !== this.prop;\r\n      }\r\n\r\n      this._value = this._convertVal(id);\r\n\r\n      if (callProp) {\r\n        this.prop.setValue(id);\r\n      }\r\n\r\n      this.setAttribute(\"name\", this.prop.ui_value_names[valmap[id]]);\r\n      if (this.onselect) {\r\n        this.onselect(id);\r\n      }\r\n\r\n      if (this.hasAttribute(\"datapath\") && this.ctx) {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), id);\r\n      }\r\n    };\r\n  }\r\n\r\n  _onpress(e) {\r\n    this.abortToolTips(1000);\r\n\r\n    if (this._menu !== undefined) {\r\n      this.lockTimer = util.time_ms();\r\n\r\n      this._pressed = false;\r\n      this._redraw();\r\n\r\n      let menu = this._menu;\r\n      this._menu = undefined;\r\n      menu.close();\r\n      return;\r\n    }\r\n\r\n    if (util.time_ms() - this.lockTimer < 200) {\r\n      return;\r\n    }\r\n\r\n    this._build_menu();\r\n\r\n    if (this._menu === undefined) {\r\n      return;\r\n    }\r\n\r\n    this._menu.autoSearchMode = false;\r\n\r\n    this._menu._dropbox = this;\r\n    this.dom._background = this.getDefault(\"BoxDepressed\");\r\n    this._background = this.getDefault(\"BoxDepressed\");\r\n    this._redraw();\r\n    this._pressed = true;\r\n    this.setCSS();\r\n\r\n    let onclose = this._menu.onclose;\r\n    this._menu.onclose = () => {\r\n      this.lockTimer = util.time_ms();\r\n\r\n      this._pressed = false;\r\n      this._redraw();\r\n\r\n      let menu = this._menu;\r\n      if (menu) {\r\n        this._menu = undefined;\r\n        menu._dropbox = undefined;\r\n      }\r\n\r\n      if (onclose) {\r\n        onclose.call(menu);\r\n      }\r\n    }\r\n\r\n    let menu = this._menu;\r\n    let screen = this.getScreen();\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let x = e.x, y = e.y;\r\n    let rects = this.dom.getBoundingClientRect(); //getClientRects();\r\n\r\n    let rheight = rects.height;\r\n    x = rects.x - window.scrollX;\r\n    y = rects.y + rheight - window.scrollY; // + rects[0].height; // visualViewport.scale;\r\n\r\n    if (!window.haveElectron) {\r\n      //y -= 8;\r\n    }\r\n\r\n    /* need to figure out a better way to pop up a menu\r\n    *  above a given y position */\r\n    if (cconst.menusCanPopupAbove && y > screen.size[1]*0.5 && !this.searchMenuMode) {\r\n      let con = screen.popup(this, 500, 400, false, 0);\r\n\r\n      con.style[\"z-index\"] = \"-10000\";\r\n      con.style[\"position\"] = UIBase.PositionKey;\r\n      document.body.appendChild(con);\r\n\r\n      con.style[\"visibility\"] = \"hidden\";\r\n\r\n      con.add(menu);\r\n      menu.start();\r\n\r\n      let time = util.time_ms();\r\n\r\n      let timer = window.setInterval(() => {\r\n        if (util.time_ms() - time > 1500) {\r\n          window.clearInterval(timer);\r\n          return;\r\n        }\r\n\r\n        let r = menu.dom.getBoundingClientRect();\r\n\r\n        if (!r || r.height < 55) {\r\n          return;\r\n        }\r\n\r\n        window.clearInterval(timer);\r\n\r\n        y -= r.height + rheight;\r\n\r\n        menu.dom.remove();\r\n        con.remove();\r\n\r\n        let popup = this._popup = menu._popup = screen.popup(this, x, y, false, 0);\r\n        popup.noMarginsOrPadding();\r\n\r\n        //popup.shadow.appendChild(menu.dom);\r\n        popup.add(menu);\r\n        menu.start();\r\n\r\n        popup.style[\"left\"] = x + \"px\";\r\n        popup.style[\"top\"] = y + \"px\";\r\n        //menu.setCSS();\r\n      }, 1);\r\n\r\n      return;\r\n    }\r\n\r\n    /*\r\n    let w = document.createElement(\"div\");\r\n    w.style[\"width\"] = w.style[\"height\"] = \"15px\";\r\n    w.style[\"background-color\"] = \"red\";\r\n    w.style[\"z-index\"] = \"5000\";\r\n    w.style[\"position\"] = UIBase.PositionKey;\r\n    w.style[\"pointer-events\"] = \"none\";\r\n    w.style[\"left\"] = x + \"px\";\r\n    w.style[\"top\"] = y + \"px\";\r\n\r\n    document.body.appendChild(w);\r\n    //*/\r\n\r\n    let con = this._popup = menu._popup = screen.popup(this, x, y, false, 0);\r\n    con.noMarginsOrPadding();\r\n\r\n    con.add(menu);\r\n    if (this.searchMenuMode) {\r\n      menu.startFancy();\r\n    } else {\r\n      menu.start();\r\n    }\r\n  }\r\n\r\n  _redraw() {\r\n    if (this.getAttribute(\"simple\")) {\r\n      let color;\r\n\r\n      this.g.clearRect(0, 0, this.dom.width, this.dom.height);\r\n      \r\n      if (this._highlight) {\r\n        ui_base.drawRoundBox2(this, {canvas: this.dom, g: this.g, color: this.getDefault(\"BoxHighlight\")});\r\n      }\r\n\r\n      if (this._focus) {\r\n        ui_base.drawRoundBox2(this, {\r\n          canvas: this.dom, g: this.g, color: this.getDefault(\"BoxHighlight\"), op: \"stroke\", no_clear: true\r\n        });\r\n        ui_base.drawRoundBox(this, this.dom, this.g, undefined, undefined, 2, \"stroke\");\r\n      }\r\n\r\n      this._draw_text();\r\n      return;\r\n    }\r\n\r\n    super._redraw(false);\r\n\r\n    let g = this.g;\r\n    let w = this.dom.width, h = this.dom.height;\r\n    let dpi = this.getDPI();\r\n\r\n    let p = 10*dpi;\r\n    let p2 = dpi;\r\n\r\n    //*\r\n    let bg = this.getDefault(\"dropTextBG\");\r\n    if (bg !== undefined) {\r\n      g.fillStyle = bg;\r\n\r\n      g.beginPath();\r\n      g.rect(p2, p2, this.dom.width - p2 - h, this.dom.height - p2*2);\r\n      g.fill();\r\n    }\r\n    //*/\r\n\r\n    g.fillStyle = \"rgba(50, 50, 50, 0.2)\";\r\n    g.strokeStyle = \"rgba(50, 50, 50, 0.8)\";\r\n    g.beginPath();\r\n    /*\r\n    g.moveTo(w-p, p);\r\n    g.lineTo(w-(p+h*0.25), h-p);\r\n    g.lineTo(w-(p+h*0.5), p);\r\n    g.closePath();\r\n    //*/\r\n\r\n    let sz = 0.3;\r\n    g.moveTo(w - h*0.5 - p, p);\r\n    g.lineTo(w - p, p);\r\n    g.moveTo(w - h*0.5 - p, p + sz*h/3);\r\n    g.lineTo(w - p, p + sz*h/3);\r\n    g.moveTo(w - h*0.5 - p, p + sz*h*2/3);\r\n    g.lineTo(w - p, p + sz*h*2/3);\r\n\r\n    g.lineWidth = 1;\r\n    g.stroke();\r\n\r\n    this._draw_text();\r\n  }\r\n\r\n  _convertVal(val) {\r\n    if (typeof val === \"string\" && this.prop) {\r\n      if (val in this.prop.values) {\r\n        return this.prop.values[val];\r\n      } else if (val in this.prop.keys) {\r\n        return this.prop.keys[val];\r\n      } else {\r\n        return undefined;\r\n      }\r\n    }\r\n\r\n    return val;\r\n  }\r\n\r\n  setValue(val, setLabelOnly = false) {\r\n    if (val === undefined || val === this._value) {\r\n      return;\r\n    }\r\n\r\n    val = this._convertVal(val);\r\n\r\n    if (val === undefined) {\r\n      console.warn(\"Bad val\", arguments[0]);\r\n      return;\r\n    }\r\n\r\n    this._value = val;\r\n\r\n    if (this.prop !== undefined && !setLabelOnly) {\r\n      this.prop.setValue(val);\r\n      let val2 = val;\r\n\r\n      if (val2 in this.prop.keys)\r\n        val2 = this.prop.keys[val2];\r\n      val2 = this.prop.ui_value_names[val2];\r\n\r\n      this.setAttribute(\"name\", \"\" + val2);\r\n      this._name = \"\" + val2;\r\n    } else {\r\n      this.setAttribute(\"name\", \"\" + val);\r\n      this._name = \"\" + val;\r\n    }\r\n\r\n    if (this.onchange && !setLabelOnly) {\r\n      this.onchange(val);\r\n    }\r\n\r\n    this.setCSS();\r\n    this.updateDataPath();\r\n    this._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(DropBox);\r\n\r\nexport class MenuWrangler {\r\n  constructor() {\r\n    this.screen = undefined;\r\n    this.menustack = [];\r\n\r\n    this.lastPickElemTime = util.time_ms();\r\n\r\n    this._closetimer = 0;\r\n    this.closeOnMouseUp = undefined;\r\n    this.closereq = undefined;\r\n\r\n    this.timer = undefined;\r\n  }\r\n\r\n  get closetimer() {\r\n    return this._closetimer;\r\n  }\r\n\r\n  set closetimer(v) {\r\n    debugmenu(\"set closertime\", v);\r\n    this._closetimer = v;\r\n  }\r\n\r\n  get menu() {\r\n    return this.menustack.length > 0 ? this.menustack[this.menustack.length - 1] : undefined;\r\n  }\r\n\r\n  pushMenu(menu) {\r\n    debugmenu(\"pushMenu\");\r\n\r\n    this.spawnreq = undefined;\r\n\r\n    if (this.menustack.length === 0 && menu.closeOnMouseUp) {\r\n      this.closeOnMouseUp = true;\r\n    }\r\n\r\n    this.menustack.push(menu);\r\n  }\r\n\r\n  popMenu(menu) {\r\n    debugmenu(\"popMenu\");\r\n\r\n    return this.menustack.pop();\r\n  }\r\n\r\n  endMenus() {\r\n    debugmenu(\"endMenus\");\r\n\r\n    for (let menu of this.menustack) {\r\n      menu.close();\r\n    }\r\n\r\n    this.menustack = [];\r\n  }\r\n\r\n  searchKeyDown(e) {\r\n    let menu = this.menu;\r\n\r\n    e.stopPropagation();\r\n    menu._ignoreFocusEvents = true;\r\n    menu.textbox.focus();\r\n    menu._ignoreFocusEvents = false;\r\n\r\n    //if (e.shiftKey || e.altKey || e.ctrlKey || e.commandKey) {\r\n    //  return;\r\n    //}\r\n\r\n    switch (e.keyCode) {\r\n      case keymap[\"Enter\"]: //return key\r\n        menu.click(menu.activeItem);\r\n        break;\r\n      case keymap[\"Escape\"]: //escape key\r\n        menu.close();\r\n        break;\r\n      case keymap[\"Up\"]:\r\n        menu.selectPrev(false);\r\n        break;\r\n      case keymap[\"Down\"]:\r\n        menu.selectNext(false);\r\n        break;\r\n    }\r\n  }\r\n\r\n  on_keydown(e) {\r\n    window.menu = this.menu;\r\n\r\n    if (this.menu === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this.menu.hasSearchBox) {\r\n      return this.searchKeyDown(e);\r\n    }\r\n\r\n    let menu = this.menu;\r\n\r\n    switch (e.keyCode) {\r\n      case keymap[\"Left\"]: //left\r\n      case keymap[\"Right\"]: //right\r\n        if (menu._dropbox) {\r\n          let dropbox = menu._dropbox;\r\n\r\n          if (e.keyCode === keymap[\"Left\"]) {\r\n            dropbox = dropbox.previousElementSibling;\r\n          } else {\r\n            dropbox = dropbox.nextElementSibling;\r\n          }\r\n\r\n          if (dropbox !== undefined && dropbox instanceof DropBox) {\r\n            this.endMenus();\r\n            dropbox._onpress(e);\r\n          }\r\n        }\r\n        break;\r\n      case keymap[\"Up\"]: //up\r\n        menu.selectPrev();\r\n        break;\r\n      case keymap[\"Down\"]: //down\r\n        menu.selectNext();\r\n        break;\r\n      /*\r\n      let item = menu.activeItem;\r\n      if (!item) {\r\n        item = menu.items[0];\r\n      }\r\n\r\n      if (!item) {\r\n        return;\r\n      }\r\n\r\n      let item2;\r\n      let i = menu.items.indexOf(item);\r\n\r\n      if (e.keyCode == 38) {\r\n        i = (i - 1 + menu.items.length) % menu.items.length;\r\n      } else {\r\n        i = (i + 1) % menu.items.length;\r\n      }\r\n\r\n      item2 = menu.items[i];\r\n\r\n      if (item2) {\r\n        menu.setActive(item2);\r\n      }\r\n      break;//*/\r\n      case 13: //return key\r\n      case 32: //space key\r\n        menu.click(menu.activeItem);\r\n        break;\r\n      case 27: //escape key\r\n        menu.close();\r\n        break;\r\n    }\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    if (this.menu === undefined || this.screen === undefined) {\r\n      this.closetimer = util.time_ms();\r\n      return;\r\n    }\r\n\r\n    let screen = this.screen;\r\n    let x = e.pageX, y = e.pageY;\r\n\r\n    let element = screen.pickElement(x, y);\r\n\r\n    if (element !== undefined && (element instanceof DropBox || util.isMobile())) {\r\n      this.endMenus();\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    if (this.menu === undefined || this.screen === undefined) {\r\n      this.closetimer = util.time_ms();\r\n      return;\r\n    }\r\n\r\n    let screen = this.screen;\r\n    let x = e.pageX, y = e.pageY;\r\n\r\n    let element = screen.pickElement(x, y, undefined, undefined, DropBox);\r\n    if (element !== undefined) {\r\n      this.closeOnMouseUp = false;\r\n    } else {\r\n      element = screen.pickElement(x, y, undefined, undefined, Menu);\r\n\r\n      //closeOnMouseUp\r\n      if (element && this.closeOnMouseUp) {\r\n        element.click();\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  findMenu(x, y) {\r\n    let screen = this.screen;\r\n\r\n    let element = screen.pickElement(x, y);\r\n\r\n    if (element === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (element instanceof Menu) {\r\n      return element;\r\n    }\r\n\r\n    let w = element;\r\n\r\n    while (w) {\r\n      if (w instanceof Menu) {//w === this.menu) {\r\n        return w;\r\n        break;\r\n      }\r\n\r\n      w = w.parentWidget;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    if (this.menu && this.menu.hasSearchBox) {\r\n      this.closetimer = util.time_ms();\r\n      this.closereq = undefined;\r\n      return;\r\n    }\r\n\r\n    if (this.menu === undefined || this.screen === undefined) {\r\n      this.closetimer = util.time_ms();\r\n      this.closereq = undefined;\r\n      return;\r\n    }\r\n\r\n    let screen = this.screen;\r\n    let x = e.pageX, y = e.pageY;\r\n\r\n    let element;\r\n    let menu = this.menu;\r\n\r\n    if (menu) {\r\n      let r = menu.getBoundingClientRect();\r\n      let pad = 15;\r\n\r\n      if (r && x >= r.x - pad && y >= r.y - pad && x <= r.x + r.width + pad*2 && y <= r.y + r.height + pad*2) {\r\n        element = menu;\r\n      }\r\n    }\r\n\r\n    if (!element && util.time_ms() - this.lastPickElemTime > 250) {\r\n      element = screen.pickElement(x, y);\r\n      this.lastPickElemTime = util.time_ms();\r\n    }\r\n\r\n    if (element === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (element instanceof Menu) {\r\n      this.closetimer = util.time_ms();\r\n      this.closereq = undefined;\r\n      return;\r\n    }\r\n\r\n    let destroy = element.hasAttribute(\"menu-button\") && element.hasAttribute(\"simple\");\r\n    destroy = destroy && element.menu !== this.menu;\r\n\r\n    if (destroy) {\r\n      /* check that dropbox doesn't contain our parent menu either */\r\n\r\n      let menu2 = this.menu;\r\n      while (menu2 !== element.menu) {\r\n        menu2 = menu2.parentMenu;\r\n        destroy = destroy && menu2 !== element.menu;\r\n      }\r\n    }\r\n\r\n    if (destroy) {\r\n      //destroy entire menu stack\r\n      this.endMenus();\r\n\r\n      this.closetimer = util.time_ms();\r\n      this.closereq = undefined;\r\n\r\n      //start new menu\r\n      element._onpress(e);\r\n      return;\r\n    }\r\n\r\n    let ok = false;\r\n\r\n    let w = element;\r\n    while (w) {\r\n      if (w instanceof Menu) {//w === this.menu) {\r\n        ok = true;\r\n        break;\r\n      }\r\n\r\n      if (w.hasAttribute(\"menu-button\") && w.menu === this.menu) {\r\n        ok = true;\r\n        break;\r\n      }\r\n\r\n      w = w.parentWidget;\r\n    }\r\n\r\n    if (!ok) {\r\n      this.closereq = this.menu;\r\n    } else {\r\n      this.closetimer = util.time_ms();\r\n      this.closereq = undefined;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    let closetime = cconst.menu_close_time;\r\n    closetime = closetime === undefined ? 50 : closetime;\r\n\r\n    let close = this.closereq && this.closereq === this.menu;\r\n    close = close && util.time_ms() - this.closetimer > closetime;\r\n\r\n    if (close) {\r\n      this.closereq = undefined;\r\n      this.endMenus();\r\n    }\r\n  }\r\n\r\n  startTimer() {\r\n    if (this.timer) {\r\n      this.stopTimer();\r\n    }\r\n\r\n    this.timer = setInterval(() => {\r\n      debugmenu(\"start menu wrangler interval\");\r\n\r\n      this.update();\r\n    }, 150);\r\n  }\r\n\r\n  stopTimer() {\r\n    if (this.timer) {\r\n      debugmenu(\"stop menu wrangler interval\");\r\n\r\n      clearInterval(this.timer);\r\n      this.timer = undefined;\r\n    }\r\n  }\r\n}\r\n\r\nexport let menuWrangler = new MenuWrangler();\r\nlet wrangerStarted = false;\r\n\r\nexport function startMenuEventWrangling(screen) {\r\n  menuWrangler.screen = screen;\r\n\r\n  if (wrangerStarted) {\r\n    return;\r\n  }\r\n\r\n  wrangerStarted = true;\r\n\r\n  for (let k in DomEventTypes) {\r\n    if (menuWrangler[k] === undefined) {\r\n      continue;\r\n    }\r\n\r\n    let dom = k.search(\"key\") >= 0 ? window : document.body;\r\n    dom = window;\r\n    dom.addEventListener(DomEventTypes[k], menuWrangler[k].bind(menuWrangler), {passive: false, capture: true})\r\n  }\r\n\r\n  menuWrangler.screen = screen;\r\n  menuWrangler.startTimer();\r\n}\r\n\r\nexport function setWranglerScreen(screen) {\r\n  startMenuEventWrangling(screen);\r\n}\r\n\r\nexport function getWranglerScreen() {\r\n  return menuWrangler.screen;\r\n}\r\n\r\nexport function createMenu(ctx, title, templ) {\r\n  let menu = UIBase.createElement(\"menu-x\");\r\n  menu.ctx = ctx;\r\n  menu.setAttribute(\"name\", title);\r\n\r\n  let SEP = menu.constructor.SEP;\r\n  let id = 0;\r\n  let cbs = {};\r\n\r\n  let doItem = (item) => {\r\n    if (item !== undefined && item instanceof Menu) {\r\n      menu.addItem(item);\r\n    } else if (typeof item == \"string\") {\r\n      let def, hotkey;\r\n\r\n      try {\r\n        def = ctx.api.getToolDef(item);\r\n      } catch (error) {\r\n        menu.addItem(\"(tool path error)\", id++);\r\n        return;\r\n      }\r\n\r\n      //3Extra(text, id=undefined, hotkey, icon=-1, add=true) {\r\n      if (!def.hotkey) {\r\n        try {\r\n          hotkey = ctx.api.getToolPathHotkey(ctx, item);\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n          console.warn(\"error getting hotkey for tool \" + item);\r\n          hotkey = undefined;\r\n        }\r\n      } else {\r\n        hotkey = def.hotkey;\r\n      }\r\n\r\n      menu.addItemExtra(def.uiname, id, hotkey, def.icon);\r\n\r\n      cbs[id] = (function (toolpath) {\r\n        return function () {\r\n          ctx.api.execTool(ctx, toolpath);\r\n        }\r\n      })(item);\r\n\r\n      id++;\r\n    } else if (item === SEP) {\r\n      menu.seperator();\r\n    } else if (typeof item === \"function\" || item instanceof Function) {\r\n      doItem(item());\r\n    } else if (item instanceof Array) { //old array-based api for custom entries\r\n      let hotkey = item.length > 2 ? item[2] : undefined;\r\n      let icon = item.length > 3 ? item[3] : undefined;\r\n      let tooltip = item.length > 4 ? item[4] : undefined;\r\n      let id2 = item.length > 5 ? item[5] : id++;\r\n\r\n      if (hotkey !== undefined && hotkey instanceof HotKey) {\r\n        hotkey = hotkey.buildString();\r\n      }\r\n\r\n      menu.addItemExtra(item[0], id2, hotkey, icon, undefined, tooltip);\r\n\r\n      cbs[id2] = (function (cbfunc, arg) {\r\n        return function () {\r\n          cbfunc(arg);\r\n        }\r\n      })(item[1], id2);\r\n    } else if (typeof item === \"object\") { //new object-based api for custom entries\r\n      let {name, callback, hotkey, icon, tooltip} = item;\r\n\r\n      let id2 = item.id !== undefined ? item.id : id++;\r\n      if (hotkey !== undefined && hotkey instanceof HotKey) {\r\n        hotkey = hotkey.buildString();\r\n      }\r\n\r\n      menu.addItemExtra(name, id2, hotkey, icon, undefined, tooltip);\r\n\r\n      cbs[id2] = (function (cbfunc, arg) {\r\n        return function () {\r\n          cbfunc(arg);\r\n        }\r\n      })(callback, id2);\r\n    }\r\n  }\r\n\r\n  for (let item of templ) {\r\n    doItem(item);\r\n  }\r\n\r\n  menu.onselect = (id) => {\r\n    cbs[id]();\r\n  }\r\n\r\n  return menu;\r\n}\r\n\r\nexport function startMenu(menu, x, y, searchMenuMode = false, safetyDelay = 55) {\r\n  menuWrangler.endMenus();\r\n\r\n  let screen = menu.ctx.screen;\r\n  let con = menu._popup = screen.popup(undefined, x, y, false, safetyDelay);\r\n  con.noMarginsOrPadding();\r\n\r\n  con.add(menu);\r\n  if (searchMenuMode) {\r\n    menu.startFancy();\r\n  } else {\r\n    menu.start();\r\n  }\r\n\r\n  menu.flushUpdate();\r\n  menu.flushSetCSS();\r\n\r\n  menu._popup.flushUpdate();\r\n  menu._popup.flushSetCSS();\r\n}\r\n","//bind module to global var to get at it in console.\r\n//\r\n//note that require has an api for handling circular \r\n//module refs, in such cases do not use these vars.\r\n\r\nvar _ui = undefined;\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as units from '../core/units.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from './ui_base.js';\r\nimport * as ui_widgets from '../widgets/ui_widgets.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport '../path-controller/util/html5_fileapi.js';\r\nimport {HotKey} from '../path-controller/util/simple_events.js';\r\nimport {CSSFont} from './ui_theme.js';\r\nimport {theme, iconSheetFromPackFlag} from './ui_base.js';\r\n\r\nimport {createMenu, startMenu} from \"../widgets/ui_menu.js\";\r\n\r\nlet PropFlags = toolprop.PropFlags;\r\nlet PropSubTypes = toolprop.PropSubTypes;\r\n\r\nlet EnumProperty = toolprop.EnumProperty;\r\n\r\nlet Vector2   = vectormath.Vector2,\r\n    UIBase    = ui_base.UIBase,\r\n    PackFlags = ui_base.PackFlags,\r\n    PropTypes = toolprop.PropTypes;\r\n\r\nimport {DataPathError} from '../path-controller/controller/controller_base.js';\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nexport class Label extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._label = \"\";\r\n\r\n    this._lastText = \"\";\r\n\r\n    this.dom = document.createElement(\"div\");\r\n    this.dom.setAttribute(\"class\", \"_labelx\");\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n      div._labelx::selection {\r\n        color: none;\r\n        background: none;\r\n         -webkit-user-select:none;\r\n         user-select:none;\r\n      }\r\n    `;\r\n\r\n    this.shadow.appendChild(style);\r\n    this.shadow.appendChild(this.dom);\r\n\r\n    this.font = \"LabelText\";\r\n  }\r\n\r\n  get font() {\r\n    return this._font;\r\n  }\r\n\r\n  /**Set a font defined in ui_base.defaults\r\n   e.g. DefaultText*/\r\n  set font(fontDefaultName) {\r\n    if (typeof fontDefaultName === \"string\") {\r\n      this._font = this.getDefault(fontDefaultName);\r\n      if (!this._font) {\r\n        console.warn(\"Invalid font\", fontDefaultName);\r\n      }\r\n    } else if (typeof fontDefaultName === \"object\" && fontDefaultName instanceof CSSFont) {\r\n      this._font = fontDefaultName;\r\n    } else {\r\n      console.warn(\"Invalid font\", fontDefaultName);\r\n    }\r\n\r\n    this._updateFont();\r\n  }\r\n\r\n  get text() {\r\n    return this._label;\r\n    //return this.dom.innerText;\r\n  }\r\n\r\n  set text(text) {\r\n    this._label = text;\r\n\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      this.dom.innerText = text;\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"label-x\",\r\n      style  : \"label\"\r\n    };\r\n  }\r\n\r\n  init() {\r\n    this.dom.style[\"width\"] = \"max-content\";\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS(false);\r\n    this.setBoxCSS();\r\n  }\r\n\r\n  on_disabled() {\r\n    super.on_disabled();\r\n    this._enabled_font = this.font;\r\n    this.font = \"DefaultText\";\r\n    this._updateFont();\r\n  }\r\n\r\n  on_enabled() {\r\n    super.on_enabled();\r\n    this.font = this._enabled_font;\r\n    this._updateFont();\r\n  }\r\n\r\n  _updateFont() {\r\n    let font = this._font;\r\n    if (!font) return;\r\n\r\n    this.dom.style[\"font\"] = font.genCSS();\r\n    this.dom.style[\"color\"] = font.color;\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (this.ctx === undefined) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n    let prop = this.getPathMeta(this.ctx, path);\r\n    let val = this.getPathValue(this.ctx, path);\r\n\r\n    if (val === undefined) {\r\n      return;\r\n    }\r\n\r\n    //console.log(path);\r\n    if (prop.type & (PropTypes.INT | PropTypes.FLOAT)) {\r\n      val = units.buildString(val, prop.baseUnit, prop.decimalPlaces, prop.displayUnit);\r\n    }\r\n\r\n    val = \"\" + this._label + \" \" + val;\r\n\r\n    if (val !== this._lastText) {\r\n      this._lastText = val;\r\n      this.dom.innerText = val;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    let key = \"\";\r\n\r\n    if (this._font !== undefined && this._font instanceof CSSFont) {\r\n      key += this._font.genKey();\r\n    }\r\n\r\n    if (key !== this._last_font) {\r\n      this._last_font = key;\r\n      this._updateFont();\r\n    }\r\n\r\n    this.dom.style[\"pointer-events\"] = this.style[\"pointer-events\"];\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n  }\r\n}\r\n\r\nui_base.UIBase.internalRegister(Label);\r\n\r\nexport class Container extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.dataPrefix = '';\r\n    this.massSetPrefix = '';\r\n\r\n    this.inherit_packflag = 0;\r\n\r\n    let style = this.styletag = document.createElement(\"style\")\r\n    style.textContent = `\r\n    `;\r\n\r\n    this.shadow.appendChild(style);\r\n    this.reversed = false;\r\n\r\n    this._prefixstack = [];\r\n    this._mass_prefixstack = [];\r\n  }\r\n\r\n  set background(bg) {\r\n    this.__background = bg;\r\n\r\n    this.styletag.textContent = `div.containerx {\r\n        background-color : ${bg};\r\n      }\r\n    `;\r\n    this.style[\"background-color\"] = bg;\r\n  }\r\n\r\n  get children() {\r\n    let list = [];\r\n\r\n    this._forEachChildWidget((n) => {\r\n      list.push(n);\r\n    });\r\n\r\n    return list\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"container-x\"\r\n    };\r\n  }\r\n\r\n  /** recursively change path prefix for all children*/\r\n  changePathPrefix(newprefix) {\r\n    let prefix = this.dataPrefix.trim();\r\n    this.dataPrefix = newprefix;\r\n\r\n    if (prefix.length > 0) {\r\n      prefix += \".\";\r\n    }\r\n\r\n    let rec = (n, con) => {\r\n      if (n instanceof Container && n !== this) {\r\n        if (n.dataPrefix.startsWith(prefix)) {\r\n          n.dataPrefix = n.dataPath.slice(prefix.length, n.dataPrefix.length);\r\n          n.dataPrefix = con._joinPrefix(n.dataPrefix);\r\n          con = n;\r\n        }\r\n      }\r\n\r\n      if (n.hasAttribute(\"datapath\")) {\r\n        let path = n.getAttribute(\"datapath\");\r\n\r\n        if (path.startsWith(prefix)) {\r\n          path = path.slice(prefix.length, path.length);\r\n          path = con._joinPrefix(path);\r\n          n.setAttribute(\"datapath\", path);\r\n\r\n          //update helper tooltips\r\n          n.description = n.description;\r\n        }\r\n      }\r\n\r\n      n._forEachChildWidget((n2) => {\r\n        rec(n2, con);\r\n      });\r\n    }\r\n\r\n    rec(this, this);\r\n  }\r\n\r\n  reverse() {\r\n    this.reversed ^= true;\r\n    return this;\r\n  }\r\n\r\n  pushMassSetPrefix(val) {\r\n    this._mass_prefixstack.push(this.massSetPrefix);\r\n    this.massSetPrefix = val;\r\n    return this;\r\n  }\r\n\r\n  pushDataPrefix(val) {\r\n    this._prefixstack.push(this.dataPrefix);\r\n    this.dataPrefix = val;\r\n    return this;\r\n  }\r\n\r\n  popDataPrefix() {\r\n    this.dataPrefix = this._prefixstack.pop();\r\n    return this;\r\n  }\r\n\r\n  popMassSetPrefix() {\r\n    this.massSetPrefix = this._mass_prefixstack.pop();\r\n    return this;\r\n  }\r\n\r\n  saveData() {\r\n    if (this.scrollTop || this.scrollLeft) {\r\n      return {\r\n        scrollTop : this.scrollTop,\r\n        scrollLeft: this.scrollLeft\r\n      }\r\n    } else {\r\n      return {};\r\n    }\r\n  }\r\n\r\n  loadData(obj) {\r\n    if (!obj) return;\r\n\r\n    let x = obj.scrollLeft || 0;\r\n    let y = obj.scrollTop || 0;\r\n\r\n    this.doOnce(() => {\r\n      this.scrollTo(x, y);\r\n    }, 12);\r\n  }\r\n\r\n  init() {\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-direction\"] = this.reversed ? \"column-reverse\" : \"column\";\r\n    this.style[\"flex-wrap\"] = \"nowrap\";\r\n    this.style[\"flex-grow\"] = \"\" + this.getDefault(\"flex-grow\", undefined, \"1\");\r\n\r\n    this.setCSS();\r\n\r\n    super.init();\r\n\r\n    this.setAttribute(\"class\", \"containerx\");\r\n  }\r\n\r\n  /** Returns previous icon flags */\r\n  useIcons(enabled_or_sheet = true) {\r\n    let enabled = !!enabled_or_sheet;\r\n\r\n    let mask = PackFlags.USE_ICONS | PackFlags.SMALL_ICON | PackFlags.LARGE_ICON;\r\n    mask = mask | PackFlags.CUSTOM_ICON_SHEET;\r\n    mask = mask | (255<<PackFlags.CUSTOM_ICON_SHEET_START);\r\n\r\n    let previous = this.packflag & mask;\r\n\r\n    if (!enabled) {\r\n      this.packflag &= ~PackFlags.USE_ICONS;\r\n      this.inherit_packflag &= ~PackFlags.USE_ICONS;\r\n\r\n      return previous;\r\n    }\r\n\r\n    let sheet = enabled_or_sheet;\r\n\r\n    if (sheet === true) {\r\n      sheet = PackFlags.SMALL_ICON;\r\n    } else if (sheet === 1) {\r\n      sheet = PackFlags.LARGE_ICON;\r\n    } else {\r\n      sheet = PackFlags.CUSTOM_ICON_SHEET | (sheet<<(PackFlags.CUSTOM_ICON_SHEET_START));\r\n    }\r\n\r\n    //clear any existing sizing flags\r\n    this.packflag &= ~(PackFlags.SMALL_ICON | PackFlags.LARGE_ICON | PackFlags.CUSTOM_ICON_SHEET);\r\n    this.packflag &= ~(255<<PackFlags.CUSTOM_ICON_SHEET_START);\r\n\r\n    this.packflag |= PackFlags.USE_ICONS | sheet;\r\n    this.inherit_packflag |= PackFlags.USE_ICONS | sheet;\r\n\r\n    return previous;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param mode: flexbox wrap mode, can be wrap, nowrap, or wrap-reverse\r\n   * @returns {Container}\r\n   */\r\n  wrap(mode = \"wrap\") {\r\n    this.style[\"flex-wrap\"] = mode;\r\n    return this;\r\n  }\r\n\r\n  noMarginsOrPadding() {\r\n    super.noMarginsOrPadding();\r\n\r\n    let keys = [\"margin\", \"padding\", \"margin-block-start\", \"margin-block-end\"];\r\n    keys = keys.concat([\"padding-block-start\", \"padding-block-end\"]);\r\n\r\n    for (let k of keys) {\r\n      this.style[k] = \"0px\";\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  setCSS() {\r\n    let rest = '';\r\n\r\n    let add = (style) => {\r\n      if (!this.hasDefault(style)) {\r\n        return;\r\n      }\r\n\r\n      let val = this.getDefault(style);\r\n\r\n      if (val !== undefined) {\r\n        rest += `  ${style} = ${val};\\n`;\r\n        this.style[style] = val;\r\n      }\r\n    }\r\n\r\n    add(\"border-radius\");\r\n    add(\"border-width\");\r\n    add(\"border-top\");\r\n    add(\"border-bottom\");\r\n    add(\"border-left\");\r\n    add(\"border-right\");\r\n\r\n    this.styletag.textContent = `div.containerx {\r\n        background-color : ${this.getDefault(\"background-color\")};\r\n        ${rest}\r\n      }\r\n      `;\r\n  }\r\n\r\n  overrideDefault(key, val) {\r\n    super.overrideDefault(key, val);\r\n    this.setCSS();\r\n\r\n    return this;\r\n  }\r\n\r\n  /*\r\n  * shorthand for:\r\n  *\r\n  * .row().noMarginsOrPadding().oneAxisPadding()\r\n  * */\r\n  strip(themeClass = \"strip\", margin1 = this.getDefault(\"oneAxisPadding\"), margin2 = 1, horiz = undefined) {\r\n    if (horiz === undefined) {\r\n      horiz = this instanceof RowFrame;\r\n      horiz = horiz || this.style[\"flex-direction\"] === \"row\";\r\n    }\r\n\r\n    let flag = horiz ? PackFlags.STRIP_HORIZ : PackFlags.STRIP_VERT;\r\n\r\n    let strip = (horiz ? this.row() : this.col());\r\n\r\n    if (typeof margin1 !== \"number\") {\r\n      throw new Error(\"margin1 was not a number\");\r\n    }\r\n    if (typeof margin2 !== \"number\") {\r\n      throw new Error(\"margin2 was not a number\");\r\n    }\r\n\r\n    strip.packflag |= flag;\r\n    strip.dataPrefix = this.dataPrefix;\r\n    strip.massSetPrefix = this.massSetPrefix;\r\n\r\n    if (themeClass in theme) {\r\n      strip.overrideClass(themeClass);\r\n      strip.background = strip.getDefault(\"background-color\");\r\n      strip.setCSS();\r\n      strip.overrideClass(themeClass);\r\n\r\n      let lastkey;\r\n\r\n      strip.update.after(function () {\r\n        let bradius = strip.getDefault(\"border-radius\");\r\n        let bline = strip.getDefault(\"border-width\");\r\n        let bstyle = strip.getDefault(\"border-style\") || 'solid';\r\n        let padding = strip.getDefault(\"padding\");\r\n        let bcolor = strip.getDefault(\"border-color\") || \"rgba(0,0,0,0)\";\r\n        let margin = strip.getDefault(\"margin\") || 0;\r\n\r\n        bline = bline === undefined ? 0 : bline;\r\n        bradius = bradius === undefined ? 0 : bradius;\r\n        padding = padding === undefined ? 5 : padding;\r\n\r\n        let bg = strip.getDefault(\"background-color\");\r\n\r\n        let key = \"\" + bradius + \":\" + bline + \":\" + bg + \":\" + padding + \":\";\r\n        key += bstyle + \":\" + padding + \":\" + bcolor + \":\" + margin;\r\n\r\n        if (key !== lastkey) {\r\n          lastkey = key;\r\n\r\n          strip.oneAxisPadding(margin1 + padding, margin2 + padding);\r\n          strip.setCSS();\r\n\r\n          strip.background = bg;\r\n\r\n          strip.style[\"margin\"] = \"\" + margin + \"px\";\r\n          strip.style[\"border\"] = `${bline}px ${bstyle} ${bcolor}`;\r\n          strip.style[\"border-radius\"] = \"\" + bradius + \"px\";\r\n        }\r\n      })\r\n    } else {\r\n      console.warn(this.constructor.name + \".strip(): unknown theme class \" + themeClass);\r\n    }\r\n\r\n    /*\r\n    let prev = strip.previousElementSibling;\r\n    if (prev !== undefined && (prev.packflag & flag)) {\r\n      if (horiz) {\r\n        prev.style[\"padding-right\"] = \"0px\";\r\n      } else {\r\n        prev.style[\"padding-top\"] = \"0px\";\r\n      }\r\n    }//*/\r\n\r\n    return strip;\r\n  }\r\n\r\n  /**\r\n   * tries to set margin along one axis only in smart manner\r\n   * */\r\n  oneAxisMargin(m = this.getDefault(\"oneAxisMargin\"), m2 = 0) {\r\n    this.style[\"margin-top\"] = this.style[\"margin-bottom\"] = \"\" + m + \"px\";\r\n    this.style[\"margin-left\"] = this.style[\"margin-right\"] = \"\" + m2 + \"px\";\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * tries to set padding along one axis only in smart manner\r\n   * */\r\n  oneAxisPadding(axisPadding = this.getDefault(\"oneAxisPadding\"), otherPadding = 0) {\r\n    this.style[\"padding-top\"] = this.style[\"padding-bottom\"] = \"\" + axisPadding + \"px\";\r\n    this.style[\"padding-left\"] = this.style[\"padding-right\"] = \"\" + otherPadding + \"px\";\r\n\r\n    return this;\r\n  }\r\n\r\n  setMargin(m) {\r\n    this.style[\"margin\"] = m + \"px\";\r\n\r\n    return this;\r\n  }\r\n\r\n  setPadding(m) {\r\n    this.style[\"padding\"] = m + \"px\";\r\n\r\n    return this;\r\n  }\r\n\r\n  setSize(width, height) {\r\n    if (width !== undefined) {\r\n      if (typeof width == \"number\")\r\n        this.style[\"width\"] = this.div.style[\"width\"] = ~~width + \"px\";\r\n      else\r\n        this.style[\"width\"] = this.div.style[\"width\"] = width;\r\n    }\r\n\r\n    if (height !== undefined) {\r\n      if (typeof height == \"number\")\r\n        this.style[\"height\"] = this.div.style[\"height\"] = ~~height + \"px\";\r\n      else\r\n        this.style[\"height\"] = this.div.style[\"height\"] = height;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  save() {\r\n  }\r\n\r\n  load() {\r\n  }\r\n\r\n  saveVisibility() {\r\n    localStorage[this.storagePrefix + \"_settings\"] = JSON.stringify(this);\r\n    return this;\r\n  }\r\n\r\n  loadVisibility() {\r\n    let key = this.storagePrefix + \"_settings\";\r\n    let ok = true;\r\n\r\n    if (key in localStorage) {\r\n      console.log(\"loading UI visibility state. . .\");\r\n\r\n      try {\r\n        this.loadJSON(JSON.parse(localStorage[key]));\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        ok = false;\r\n      }\r\n    }\r\n\r\n    return ok;\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = {\r\n      opened: !this.closed\r\n    };\r\n\r\n    return Object.assign(super.toJSON(), ret);\r\n  }\r\n\r\n  _ondestroy() {\r\n    this._forEachChildWidget((n) => {\r\n      n._ondestroy();\r\n    });\r\n\r\n    super._ondestroy();\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    //console.error(\"ui.js:Container.loadJSON: implement me!\");\r\n\r\n    return this;\r\n  }\r\n\r\n  redrawCurves() {\r\n    throw new Error(\"Implement me (properly!)\");\r\n\r\n    if (this.closed)\r\n      return;\r\n\r\n    for (let cw of this.curve_widgets) {\r\n      cw.draw();\r\n    }\r\n  }\r\n\r\n  listen() {\r\n    window.setInterval(() => {\r\n      this.update();\r\n    }, 150);\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  appendChild(child) {\r\n    if (child instanceof ui_base.UIBase) {\r\n      child.ctx = this.ctx;\r\n      child.parentWidget = this;\r\n      this.shadow.appendChild(child);\r\n\r\n      if (child.onadd) {\r\n        child.onadd();\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    return super.appendChild(child);\r\n  }\r\n\r\n  clear(trigger_on_destroy = true) {\r\n    for (let child of this.children) {\r\n      if (child instanceof ui_base.UIBase) {\r\n        child.remove(trigger_on_destroy);\r\n      }\r\n    }\r\n  }\r\n\r\n  removeChild(child, trigger_on_destroy = true) {\r\n    let ret = super.removeChild(child);\r\n\r\n    if (child.on_remove) {\r\n      child.on_remove();\r\n    }\r\n\r\n    if (trigger_on_destroy && child.on_destroy) {\r\n      child.on_destroy();\r\n    }\r\n\r\n    child.parentWidget = undefined;\r\n\r\n    return ret;\r\n  }\r\n\r\n  prepend(child) {\r\n    if (child instanceof UIBase) {\r\n      this._prepend(child);\r\n    } else {\r\n      super.prepend(child);\r\n    }\r\n  }\r\n\r\n  //*\r\n  _prepend(child) {\r\n    return this._add(child, true);\r\n  }//*/\r\n\r\n  add(child) {\r\n    return this._add(child);\r\n  }\r\n\r\n  insert(i, ch) {\r\n    ch.parentWidget = this;\r\n    ch.ctx = this;\r\n\r\n    if (i >= this.shadow.childNodes.length) {\r\n      this.add(ch);\r\n    } else {\r\n      this.shadow.insertBefore(ch, util.list(this.children)[i]);\r\n    }\r\n\r\n    if (ch.onadd) {\r\n      ch.onadd();\r\n    }\r\n  }\r\n\r\n  _add(child, prepend = false) {\r\n    //paranoia check for if we accidentally got a DOM NodeList\r\n    if (child instanceof NodeList) {\r\n      throw new Error(\"eek!\");\r\n    }\r\n\r\n    child.ctx = this.ctx;\r\n    child.parentWidget = this;\r\n    child._useDataPathUndo = this._useDataPathUndo;\r\n\r\n    if (!child._themeOverride && this._themeOverride) {\r\n      child.overrideTheme(this._themeOverride);\r\n    }\r\n\r\n    if (prepend) {\r\n      this.shadow.prepend(child);\r\n    } else {\r\n      this.shadow.appendChild(child);\r\n    }\r\n\r\n    /*\r\n    if (child._ctx) {\r\n      child._init();\r\n    }//*/\r\n\r\n    if (child.onadd)\r\n      child.onadd();\r\n\r\n    return child;\r\n  }\r\n\r\n  //TODO: make sure this works on Electron?\r\n  dynamicMenu(title, list, packflag = 0) {\r\n    //actually, .menu works for now\r\n    return this.menu(title, list, packflag);\r\n  }\r\n\r\n  /**example usage:\r\n\r\n   .menu([\r\n   \"some_tool_path.tool()|CustomLabel\",\r\n   ui_widgets.Menu.SEP,\r\n   \"some_tool_path.another_tool()\",\r\n   [\"Name\", () => {console.log(\"do something\")}]\r\n   ])\r\n\r\n   **/\r\n  menu(title, list, packflag = 0) {\r\n    let dbox = UIBase.createElement(\"dropbox-x\");\r\n\r\n    dbox._name = title;\r\n    dbox.setAttribute(\"simple\", true);\r\n    dbox.setAttribute(\"name\", title);\r\n\r\n    if (list instanceof HTMLElement && list.constructor.name === \"Menu\") {\r\n      dbox._build_menu = function () {\r\n        if (this._menu !== undefined && this._menu.parentNode !== undefined) {\r\n          this._menu.remove();\r\n        }\r\n\r\n        this._menu = createMenu(this.ctx, title, templ);\r\n        return this._menu;\r\n      }\r\n    } else if (list) {\r\n      dbox.template = list;\r\n    }\r\n\r\n    this._container_inherit(dbox, packflag);\r\n\r\n    this._add(dbox);\r\n    return dbox;\r\n  }\r\n\r\n  toolPanel(path_or_cls, args = {}) {\r\n    let tdef;\r\n    let cls;\r\n\r\n    if (typeof path_or_cls === \"string\") {\r\n      cls = this.ctx.api.parseToolPath(path_or_cls);\r\n    } else {\r\n      cls = path_or_cls;\r\n    }\r\n\r\n    tdef = cls._getFinalToolDef();\r\n\r\n    let packflag = args.packflag || 0;\r\n    let label = args.label || tdef.uiname;\r\n    let createCb = args.createCb || args.create_cb;\r\n    let container = args.container || this.panel(label);\r\n    let defaultsPath = args.defaultsPath || \"toolDefaults\";\r\n\r\n    if (defaultsPath.length > 0 && !defaultsPath.endsWith(\".\")) {\r\n      defaultsPath += \".\";\r\n    }\r\n\r\n    let path = defaultsPath + tdef.toolpath;\r\n\r\n    container.useIcons(false);\r\n\r\n    let inputs = tdef.inputs || {};\r\n    for (let k in inputs) {\r\n      let prop = inputs[k];\r\n\r\n      if (prop.flag & PropFlags.PRIVATE) {\r\n        continue;\r\n      }\r\n\r\n      let apiname = prop.apiname || k;\r\n      let path2 = path + \".\" + apiname;\r\n\r\n      container.prop(path2);\r\n    }\r\n\r\n    container.tool(path_or_cls, packflag, createCb, label);\r\n\r\n    return container;\r\n  }\r\n\r\n  tool(path_or_cls, packflag_or_args = {}, createCb = undefined, label = undefined) {\r\n    let cls;\r\n    let packflag;\r\n\r\n    if (typeof packflag_or_args === \"object\") {\r\n      let args = packflag_or_args;\r\n\r\n      packflag = args.packflag;\r\n      createCb = args.createCb;\r\n      label = args.label;\r\n    } else {\r\n      packflag = packflag_or_args || 0;\r\n    }\r\n\r\n    if (typeof path_or_cls == \"string\") {\r\n      if (path_or_cls.search(/\\|/) >= 0) {\r\n        path_or_cls = path_or_cls.split(\"|\");\r\n\r\n        if (label === undefined && path_or_cls.length > 1) {\r\n          label = path_or_cls[1].trim();\r\n        }\r\n\r\n        path_or_cls = path_or_cls[0].trim();\r\n      }\r\n\r\n      if (this.ctx === undefined) {\r\n        console.warn(\"this.ctx was undefined in tool()\");\r\n        return;\r\n      }\r\n\r\n      cls = this.ctx.api.parseToolPath(path_or_cls);\r\n\r\n      if (cls === undefined) {\r\n        console.warn(\"Unknown tool for toolpath \\\"\" + path_or_cls + \"\\\"\");\r\n        return;\r\n      }\r\n    } else {\r\n      cls = path_or_cls;\r\n    }\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n    let hotkey;\r\n\r\n    if (createCb === undefined) {\r\n      createCb = (cls) => {\r\n        return this.ctx.api.createTool(this.ctx, path_or_cls);\r\n      }\r\n    }\r\n\r\n    let cb = () => {\r\n      console.log(\"tool run\");\r\n\r\n      let toolob = createCb(cls);\r\n      this.ctx.api.execTool(this.ctx, toolob);\r\n    }\r\n\r\n    let def = typeof path_or_cls === \"string\" ? this.ctx.api.getToolDef(path_or_cls) : cls.tooldef();\r\n    let tooltip = def.description === undefined ? def.uiname : def.description;\r\n\r\n    //is there a hotkey hardcoded in the class?\r\n    if (def.hotkey !== undefined) {\r\n      tooltip += \"\\n\\t\" + def.hotkey;\r\n      hotkey = def.hotkey;\r\n    } else { //if not, use getToolPathHotkey api\r\n      let path = path_or_cls;\r\n\r\n      if (typeof path != \"string\") {\r\n        path = def.toolpath;\r\n      }\r\n\r\n      let hotkey = this.ctx.api.getToolPathHotkey(this.ctx, path);\r\n      if (hotkey) {\r\n        tooltip += \"\\n\\tHotkey: \" + hotkey;\r\n      }\r\n    }\r\n\r\n    let ret;\r\n\r\n    if (def.icon !== undefined && (packflag & PackFlags.USE_ICONS)) {\r\n      label = label === undefined ? tooltip : label;\r\n\r\n      ret = this.iconbutton(def.icon, label, cb);\r\n\r\n      ret.iconsheet = iconSheetFromPackFlag(packflag);\r\n      ret.packflag |= packflag;\r\n    } else {\r\n      label = label === undefined ? def.uiname : label;\r\n\r\n      ret = this.button(label, cb);\r\n      ret.description = tooltip;\r\n      ret.packflag |= packflag;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  //supports number types\r\n  textbox(inpath, text, cb = undefined, packflag = 0) {\r\n    let path;\r\n\r\n    if (inpath) {\r\n      path = this._joinPrefix(inpath);\r\n    }\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let ret = UIBase.createElement(\"textbox-x\");\r\n\r\n    if (path !== undefined) {\r\n      ret.setAttribute(\"datapath\", path);\r\n    }\r\n\r\n    ret.ctx = this.ctx;\r\n    ret.parentWidget = this;\r\n    ret._init();\r\n    this._add(ret);\r\n\r\n    ret.setCSS();\r\n    ret.update();\r\n\r\n    ret.packflag |= packflag;\r\n    ret.onchange = cb;\r\n    ret.text = text;\r\n\r\n    return ret;\r\n  }\r\n\r\n  pathlabel(inpath, label = \"\", packflag = 0) {\r\n    let path;\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    if (inpath) {\r\n      path = this._joinPrefix(inpath);\r\n    }\r\n\r\n    let ret = UIBase.createElement(\"label-x\");\r\n\r\n    ret.text = label;\r\n    ret.packflag = packflag;\r\n    ret.setAttribute(\"datapath\", path);\r\n\r\n    this._add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  label(text) {\r\n    let ret = UIBase.createElement(\"label-x\");\r\n    ret.text = text;\r\n\r\n    this._add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * makes a button for a help picker tool\r\n   * to view tooltips on mobile devices\r\n   * */\r\n  helppicker() {\r\n    let ret = this.iconbutton(ui_base.Icons.HELP, \"Help Picker\", () => {\r\n      this.getScreen().hintPickerTool();\r\n    })\r\n\r\n    if (util.isMobile()) {\r\n      //ret.iconsheet = 2;\r\n      //XXX look up in mobile theme properly\r\n    }\r\n\r\n    if (ret.ctx) {\r\n      ret._init();\r\n      ret.setCSS();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  iconbutton(icon, description, cb, thisvar, packflag = 0) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let ret = UIBase.createElement(\"iconbutton-x\")\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    ret.setAttribute(\"icon\", icon);\r\n    ret.description = description;\r\n    ret.icon = icon;\r\n\r\n    ret.iconsheet = iconSheetFromPackFlag(packflag);\r\n\r\n    ret.onclick = cb;\r\n\r\n    this._add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  button(label, cb, thisvar, id, packflag = 0) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let ret = UIBase.createElement(\"button-x\")\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    ret.setAttribute(\"name\", label);\r\n    ret.setAttribute(\"buttonid\", id); //XXX no longer used?\r\n    ret.onclick = cb;\r\n\r\n    this._add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  _joinPrefix(path, prefix = this.dataPrefix.trim()) {\r\n    if (path === undefined) {\r\n      return undefined;\r\n    }\r\n\r\n    path = path.trim();\r\n    if (path[0] === \"/\") {\r\n      return path;\r\n    }\r\n\r\n    if (prefix.length > 0 && path.length > 0 && !prefix.endsWith(\".\") && !path.startsWith(\".\")) {\r\n      path = \".\" + path;\r\n    }\r\n\r\n    return prefix + path;\r\n  }\r\n\r\n  colorbutton(inpath, packflag, mass_set_path = undefined) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    let ret = UIBase.createElement(\"color-picker-button-x\");\r\n\r\n    if (inpath !== undefined) {\r\n      inpath = this._joinPrefix(inpath);\r\n      ret.setAttribute(\"datapath\", inpath);\r\n    }\r\n\r\n    if (mass_set_path !== undefined) {\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n    }\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  noteframe(packflag = 0) {\r\n    let ret = UIBase.createElement(\"noteframe-x\");\r\n\r\n    ret.packflag |= (this.inherit_packflag & ~PackFlags.NO_UPDATE) | packflag;\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  curve1d(inpath, packflag = 0, mass_set_path = undefined) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    let ret = UIBase.createElement(\"curve-widget-x\");\r\n\r\n    ret.ctx = this.ctx;\r\n    ret.packflag |= packflag;\r\n\r\n    if (inpath) {\r\n      inpath = this._joinPrefix(inpath);\r\n      ret.setAttribute(\"datapath\", inpath);\r\n    }\r\n\r\n    if (mass_set_path)\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n\r\n    this.add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  vecpopup(inpath, packflag = 0, mass_set_path = undefined) {\r\n    let button = UIBase.createElement(\"vector-popup-button-x\");\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n    let name = \"vector\";\r\n\r\n    if (inpath) {\r\n      inpath = this._joinPrefix(inpath);\r\n\r\n      button.setAttribute(\"datapath\", inpath);\r\n      if (mass_set_path) {\r\n        button.setAttribute(\"mass_set_path\", mass_set_path);\r\n      }\r\n\r\n      let rdef = this.ctx.api.resolvePath(this.ctx, inpath);\r\n      if (rdef && rdef.prop) {\r\n        name = rdef.prop.uiname || rdef.prop.name;\r\n      }\r\n    }\r\n\r\n    button.setAttribute(\"name\", name);\r\n    button.packflag |= packflag;\r\n\r\n    this.add(button);\r\n    return button;\r\n  }\r\n\r\n  _getMassPath(ctx, inpath, mass_set_path) {\r\n    if (mass_set_path === undefined && this.massSetPrefix.length > 0) {\r\n      mass_set_path = ctx.api.getPropName(ctx, inpath);\r\n    }\r\n\r\n    if (mass_set_path === undefined) {\r\n      return undefined;\r\n    }\r\n\r\n    return this._joinPrefix(mass_set_path, this.massSetPrefix);\r\n  }\r\n\r\n  prop(inpath, packflag = 0, mass_set_path = undefined) {\r\n    if (!this.ctx) {\r\n      console.warn(this.id + \".ctx was undefined\");\r\n      let p = this.parentWidget;\r\n\r\n      while (p) {\r\n        if (p.ctx) {\r\n          console.warn(\"Fetched this.ctx from parent\");\r\n          this.ctx = p.ctx;\r\n          break;\r\n        }\r\n\r\n        p = p.parentWidget;\r\n      }\r\n\r\n      if (!this.ctx) {\r\n        throw new Error(\"ui.Container.prototype.prop(): this.ctx was undefined\");\r\n      }\r\n    }\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let rdef = this.ctx.api.resolvePath(this.ctx, this._joinPrefix(inpath), true);\r\n\r\n    if (rdef === undefined || rdef.prop === undefined) {\r\n      console.warn(\"Unknown property at path\", this._joinPrefix(inpath), this.ctx.api.resolvePath(this.ctx, this._joinPrefix(inpath), true));\r\n      return;\r\n    }\r\n    //slider(path, name, defaultval, min, max, step, is_int, do_redraw, callback, packflag=0) {\r\n    let prop = rdef.prop;\r\n\r\n    let useDataPathUndo = !(prop.flag & PropFlags.NO_UNDO);\r\n\r\n    //console.log(prop, PropTypes, PropSubTypes);\r\n\r\n    function makeUIName(name) {\r\n      if (typeof name === \"number\" && isNaN(name)) {\r\n        console.warn(\"Subkey error in data api\", inpath);\r\n        return \"\" + name;\r\n      }\r\n\r\n      name = \"\" + name;\r\n      name = name[0].toUpperCase() + name.slice(1, name.length).toLowerCase();\r\n      name = name.replace(/_/g, \" \");\r\n      return name;\r\n    }\r\n\r\n    if (prop.type === PropTypes.REPORT) {\r\n      return this.pathlabel(inpath, prop.uiname);\r\n    } else if (prop.type === PropTypes.STRING) {\r\n      let ret;\r\n\r\n      if (prop.flag & PropFlags.READ_ONLY) {\r\n        ret = this.pathlabel(inpath, prop.uiname);\r\n      } else if (prop.multiLine) {\r\n        ret = this.textarea(inpath, rdef.value, packflag, mass_set_path);\r\n        ret.useDataPathUndo = useDataPathUndo;\r\n      } else {\r\n        let strip = this.strip();\r\n\r\n        let uiname = prop.uiname !== undefined ? prop.uiname : ToolProperty.makeUIName(prop.apiname);\r\n\r\n        strip.label(prop.uiname);\r\n\r\n        ret = strip.textbox(inpath);\r\n        ret.useDataPathUndo = useDataPathUndo;\r\n\r\n        if (mass_set_path) {\r\n          ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n        }\r\n      }\r\n\r\n      ret.packflag |= packflag;\r\n      return ret;\r\n    } else if (prop.type === PropTypes.CURVE) {\r\n      let ret = this.curve1d(inpath, packflag, mass_set_path);\r\n      ret.useDataPathUndo = useDataPathUndo;\r\n      return ret;\r\n    } else if (prop.type === PropTypes.INT || prop.type === PropTypes.FLOAT) {\r\n      let ret;\r\n      if (packflag & PackFlags.SIMPLE_NUMSLIDERS) {\r\n        ret = this.simpleslider(inpath, {packflag: packflag});\r\n      } else {\r\n        ret = this.slider(inpath, {packflag: packflag});\r\n      }\r\n\r\n      ret.useDataPathUndo = useDataPathUndo;\r\n      ret.packflag |= packflag;\r\n\r\n      if (mass_set_path) {\r\n        ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n      }\r\n\r\n      return ret;\r\n    } else if (prop.type === PropTypes.BOOL) {\r\n      let ret = this.check(inpath, prop.uiname, packflag, mass_set_path);\r\n      ret.useDataPathUndo = useDataPathUndo;\r\n      return ret;\r\n    } else if (prop.type === PropTypes.ENUM) {\r\n      if (rdef.subkey !== undefined) {\r\n        let subkey = rdef.subkey;\r\n        let name = rdef.prop.ui_value_names[rdef.subkey];\r\n\r\n        if (name === undefined) {\r\n          name = makeUIName(rdef.subkey);\r\n        }\r\n\r\n        let check = this.check(inpath, name, packflag, mass_set_path);\r\n        let tooltip = rdef.prop.descriptions[subkey];\r\n\r\n        check.useDataPathUndo = useDataPathUndo;\r\n\r\n        check.description = tooltip === undefined ? rdef.prop.ui_value_names[subkey] : tooltip;\r\n        check.icon = rdef.prop.iconmap[rdef.subkey];\r\n\r\n        return check;\r\n      }\r\n\r\n      if (!(packflag & PackFlags.USE_ICONS)) {\r\n        if (packflag & PackFlags.FORCE_PROP_LABELS) {\r\n          let strip = this.strip();\r\n          strip.label(prop.uiname);\r\n\r\n          return strip.listenum(inpath, {packflag, mass_set_path}).setUndo(useDataPathUndo);\r\n        } else {\r\n          return this.listenum(inpath, {packflag, mass_set_path}).setUndo(useDataPathUndo);\r\n        }\r\n\r\n      } else {\r\n        if (packflag & PackFlags.FORCE_PROP_LABELS) {\r\n          let strip = thdis.strip();\r\n          strip.label(prop.uiname);\r\n\r\n          return strip.checkenum(inpath, undefined, packflag).setUndo(useDataPathUndo);\r\n        } else {\r\n          return this.checkenum(inpath, undefined, packflag).setUndo(useDataPathUndo);\r\n        }\r\n      }\r\n    } else if (prop.type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4)) {\r\n      if (rdef.subkey !== undefined) {\r\n        let ret;\r\n\r\n        if (packflag & PackFlags.SIMPLE_NUMSLIDERS)\r\n          ret = this.simpleslider(inpath, {packflag: packflag});\r\n        else\r\n          ret = this.slider(inpath, {packflag: packflag});\r\n\r\n        ret.packflag |= packflag;\r\n        return ret.setUndo(useDataPathUndo);\r\n      } else if (prop.subtype === PropSubTypes.COLOR) {\r\n        return this.colorbutton(inpath, packflag, mass_set_path).setUndo(useDataPathUndo);\r\n        //return this.colorPicker(inpath, packflag, mass_set_path);\r\n      } else {\r\n        let ret = UIBase.createElement(\"vector-panel-x\");\r\n\r\n        mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n        ret.packflag |= packflag | (this.inherit_packflag & ~PackFlags.NO_UPDATE);\r\n        ret.inherit_packflag |= packflag | (this.inherit_packflag & ~PackFlags.NO_UPDATE);\r\n\r\n        if (inpath) {\r\n          ret.setAttribute(\"datapath\", this._joinPrefix(inpath));\r\n        }\r\n\r\n        if (mass_set_path) {\r\n          ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n        }\r\n\r\n        this.add(ret);\r\n\r\n        return ret.setUndo(useDataPathUndo);\r\n      }\r\n    } else if (prop.type === PropTypes.FLAG) {\r\n      if (rdef.subkey !== undefined) {\r\n        let tooltip = rdef.prop.descriptions[rdef.subkey];\r\n        let name = rdef.prop.ui_value_names[rdef.subkey];\r\n\r\n        if (typeof rdef.subkey === \"number\") {\r\n          name = rdef.prop.keys[rdef.subkey];\r\n          if (name && name in rdef.prop.ui_value_names) {\r\n            name = rdef.prop.ui_value_names[name];\r\n          } else {\r\n            name = makeUIName(name ? name : \"(error)\");\r\n          }\r\n        }\r\n\r\n        if (name === undefined) {\r\n          name = \"(error)\";\r\n        }\r\n\r\n        let ret = this.check(inpath, name, packflag, mass_set_path);\r\n\r\n        ret.icon = rdef.prop.iconmap[rdef.subkey];\r\n\r\n        if (tooltip) {\r\n          ret.description = tooltip;\r\n        }\r\n\r\n        return ret.setUndo(useDataPathUndo);\r\n      } else {\r\n        let con = this;\r\n\r\n        if (packflag & PackFlags.FORCE_PROP_LABELS) {\r\n          con = this.strip();\r\n          con.label(prop.uiname);\r\n        }\r\n\r\n        if (packflag & PackFlags.PUT_FLAG_CHECKS_IN_COLUMNS) {\r\n          let i = 0;\r\n          let row = con.row();\r\n          let col1 = row.col();\r\n          let col2 = row.col();\r\n\r\n          for (let k in prop.values) {\r\n            let name = prop.ui_value_names[k];\r\n            let tooltip = prop.descriptions[k];\r\n\r\n            if (name === undefined) {\r\n              name = makeUIName(k);\r\n            }\r\n\r\n            let con2 = i & 1 ? col1 : col2;\r\n            let check = con2.check(`${inpath}[${k}]`, name, packflag, mass_set_path);\r\n\r\n            if (tooltip) {\r\n              check.description = tooltip;\r\n            }\r\n\r\n            check.setUndo(useDataPathUndo);\r\n\r\n            i++;\r\n          }\r\n\r\n          return row;\r\n        }\r\n\r\n        if (packflag & PackFlags.WRAP_CHECKBOXES) {\r\n          let isrow = this.style[\"flex-direction\"] === \"row\";\r\n          isrow = isrow || this.style[\"flex-direction\"] === \"row-reverse\";\r\n\r\n          let wrapChars;\r\n\r\n          let strip, con;\r\n\r\n          if (isrow) {\r\n            wrapChars = this.getDefault(\"checkRowWrapLimit\", undefined, 24);\r\n            strip = this.col().strip();\r\n            strip.packflag |= packflag;\r\n            strip.inherit_packflag |= packflag;\r\n\r\n            con = strip.row();\r\n          } else {\r\n            wrapChars = this.getDefault(\"checkColWrapLimit\", undefined, 5);\r\n            strip = this.row().strip();\r\n            strip.packflag |= packflag;\r\n            strip.inherit_packflag |= packflag;\r\n\r\n            con = strip.col();\r\n          }\r\n\r\n          let x = 0;\r\n          let y = 0;\r\n\r\n          for (let k in prop.values) {\r\n            let name = prop.ui_value_names[k];\r\n            let tooltip = prop.descriptions[k];\r\n\r\n            if (name === undefined) {\r\n              name = makeUIName(k);\r\n            }\r\n\r\n            let check = con.check(`${inpath}[${k}]`, name, packflag, mass_set_path);\r\n\r\n            if (tooltip) {\r\n              check.description = tooltip;\r\n            }\r\n\r\n            x += name.length;\r\n            y += 1;\r\n\r\n            if (isrow && x > wrapChars) {\r\n              x = 0;\r\n              con = strip.row();\r\n            } else if (!isrow && y > wrapChars) {\r\n              y = 0;\r\n              con = strip.col();\r\n            }\r\n          }\r\n\r\n          return strip;\r\n        }\r\n\r\n        if (con === this) {\r\n          con = this.strip();\r\n        }\r\n\r\n        let rebuild = () => {\r\n          con.clear();\r\n\r\n          for (let k in prop.values) {\r\n            let name = prop.ui_value_names[k];\r\n            let tooltip = prop.descriptions[k];\r\n\r\n            if (name === undefined) {\r\n              name = makeUIName(k);\r\n            }\r\n\r\n            let check = con.check(`${inpath}[${k}]`, name, packflag, mass_set_path);\r\n            check.useDataPathUndo = useDataPathUndo;\r\n\r\n            if (tooltip) {\r\n              check.description = tooltip;\r\n            }\r\n\r\n            check.setUndo(useDataPathUndo);\r\n          }\r\n        }\r\n\r\n        rebuild();\r\n        let last_hash = prop.calcHash();\r\n\r\n        con.update.after(() => {\r\n          let hash = prop.calcHash();\r\n\r\n          if (last_hash !== hash) {\r\n            last_hash = hash;\r\n            console.error(\"Property definition update\");\r\n            rebuild();\r\n          }\r\n        });\r\n\r\n        return con;\r\n      }\r\n    }\r\n  }\r\n\r\n  iconcheck(inpath, icon, name, mass_set_path) {\r\n    let ret = UIBase.createElement(\"iconcheck-x\");\r\n    ret.icon = icon;\r\n    ret.description = name;\r\n\r\n    if (inpath) {\r\n      ret.setAttribute(\"datapath\", inpath);\r\n    }\r\n\r\n    if (mass_set_path) {\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n    }\r\n\r\n    this.add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  check(inpath, name, packflag = 0, mass_set_path = undefined) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let path = inpath !== undefined ? this._joinPrefix(inpath) : undefined;\r\n\r\n    //let prop = this.ctx.getProp(path);\r\n    let ret;\r\n    if (packflag & PackFlags.USE_ICONS) {\r\n      ret = UIBase.createElement(\"iconcheck-x\");\r\n\r\n      ret.iconsheet = iconSheetFromPackFlag(packflag);\r\n    } else {\r\n      ret = UIBase.createElement(\"check-x\");\r\n    }\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    ret.packflag |= packflag;\r\n    ret.label = name;\r\n    ret.noMarginsOrPadding();\r\n\r\n    if (inpath) {\r\n      ret.setAttribute(\"datapath\", path);\r\n    }\r\n\r\n    if (mass_set_path) {\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n    }\r\n\r\n    this._add(ret);\r\n\r\n    //ret.update();\r\n\r\n    return ret;\r\n  }\r\n\r\n  /*\r\n  *\r\n  * new (optional) form: checkenum(inpath, args)\r\n  * */\r\n  checkenum(inpath, name, packflag, enummap, defaultval, callback, iconmap, mass_set_path) {\r\n    if (typeof name === \"object\" && name !== null) {\r\n      let args = name;\r\n\r\n      name = args.name;\r\n      packflag = args.packflag;\r\n      enummap = args.enummap;\r\n      defaultval = args.defaultval;\r\n      callback = args.callback;\r\n      iconmap = args.iconmap;\r\n      mass_set_path = args.mass_set_path;\r\n    }\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    packflag = packflag === undefined ? 0 : packflag;\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let path = this._joinPrefix(inpath);\r\n\r\n    let has_path = path !== undefined;\r\n    let prop;\r\n    let frame;\r\n\r\n    if (path !== undefined) {\r\n      prop = this.ctx.api.resolvePath(this.ctx, path, true);\r\n\r\n      if (prop !== undefined)\r\n        prop = prop.prop;\r\n    }\r\n\r\n    if (path !== undefined) {\r\n      if (prop === undefined) {\r\n        console.warn(\"Bad path in checkenum\", path);\r\n        return;\r\n      }\r\n\r\n      frame = this.strip();\r\n      frame.oneAxisPadding();\r\n\r\n      if (packflag & PackFlags.USE_ICONS) {\r\n        for (let key in prop.values) {\r\n          let check = frame.check(inpath + \"[\" + key + \"]\", \"\", packflag);\r\n\r\n          check.packflag |= PackFlags.HIDE_CHECK_MARKS;\r\n\r\n          check.icon = prop.iconmap[key];\r\n          check.drawCheck = false;\r\n\r\n          check.style[\"padding\"] = \"0px\";\r\n          check.style[\"margin\"] = \"0px\";\r\n\r\n          check.dom.style[\"padding\"] = \"0px\";\r\n          check.dom.style[\"margin\"] = \"0px\";\r\n\r\n          check.description = prop.descriptions[key];\r\n          //console.log(check.description, key, prop.keys[key], prop.descriptions, prop.keys);\r\n        }\r\n      } else {\r\n        if (name === undefined) {\r\n          name = prop.uiname;\r\n        }\r\n\r\n        frame.label(name).font = \"TitleText\";\r\n\r\n        let checks = {};\r\n\r\n        let ignorecb = false;\r\n\r\n        function makecb(key) {\r\n          return () => {\r\n            if (ignorecb) return;\r\n\r\n            ignorecb = true;\r\n            for (let k in checks) {\r\n              if (k !== key) {\r\n                checks[k].checked = false;\r\n              }\r\n            }\r\n            ignorecb = false;\r\n\r\n            if (callback) {\r\n              callback(key);\r\n            }\r\n          }\r\n        }\r\n\r\n        for (let key in prop.values) {\r\n          let check = frame.check(inpath + \" = \" + prop.values[key], prop.ui_value_names[key]);\r\n          checks[key] = check;\r\n\r\n          if (mass_set_path) {\r\n            check.setAttribute(\"mass_set_path\", mass_set_path);\r\n          }\r\n\r\n\r\n          check.description = prop.descriptions[prop.keys[key]];\r\n          if (!check.description) {\r\n            check.description = \"\" + prop.ui_value_names[key];\r\n          }\r\n          check.onchange = makecb(key);\r\n          //console.log(\"PATH\", path);\r\n        }\r\n      }\r\n    }\r\n\r\n    return frame;\r\n  }\r\n\r\n  checkenum_panel(inpath, name, packflag = 0, callback = undefined, mass_set_path = undefined, prop = undefined) {\r\n    packflag = packflag === undefined ? 0 : packflag;\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let path = this._joinPrefix(inpath);\r\n    let frame;\r\n\r\n    let has_path = path !== undefined;\r\n\r\n    if (path !== undefined && prop === undefined) {\r\n      prop = this.ctx.api.resolvePath(this.ctx, path, true);\r\n\r\n      if (prop !== undefined)\r\n        prop = prop.prop;\r\n    }\r\n\r\n    if (!name && prop) {\r\n      name = prop.uiname;\r\n    }\r\n\r\n    if (path !== undefined) {\r\n      if (prop === undefined) {\r\n        console.warn(\"Bad path in checkenum\", path);\r\n        return;\r\n      }\r\n\r\n      frame = this.panel(name, name, packflag);\r\n\r\n      frame.oneAxisPadding();\r\n      frame.setCSS.after(frame.background = this.getDefault(\"BoxSub2BG\"));\r\n\r\n      if (packflag & PackFlags.USE_ICONS) {\r\n        for (let key in prop.values) {\r\n          let check = frame.check(inpath + \" == \" + prop.values[key], \"\", packflag);\r\n\r\n          check.icon = prop.iconmap[key];\r\n          check.drawCheck = false;\r\n\r\n          check.style[\"padding\"] = \"0px\";\r\n          check.style[\"margin\"] = \"0px\";\r\n\r\n          check.dom.style[\"padding\"] = \"0px\";\r\n          check.dom.style[\"margin\"] = \"0px\";\r\n\r\n          check.description = prop.descriptions[key];\r\n          //console.log(check.description, key, prop.keys[key], prop.descriptions, prop.keys);\r\n        }\r\n      } else {\r\n        if (name === undefined) {\r\n          name = prop.uiname;\r\n        }\r\n\r\n        frame.label(name).font = \"TitleText\";\r\n\r\n        let checks = {};\r\n\r\n        let ignorecb = false;\r\n\r\n        function makecb(key) {\r\n          return () => {\r\n            if (ignorecb) return;\r\n\r\n            ignorecb = true;\r\n            for (let k in checks) {\r\n              if (k !== key) {\r\n                checks[k].checked = false;\r\n              }\r\n            }\r\n            ignorecb = false;\r\n\r\n            if (callback) {\r\n              callback(key);\r\n            }\r\n          }\r\n        }\r\n\r\n        for (let key in prop.values) {\r\n          let check = frame.check(inpath + \" = \" + prop.values[key], prop.ui_value_names[key]);\r\n          checks[key] = check;\r\n\r\n          if (mass_set_path) {\r\n            check.setAttribute(\"mass_set_path\", mass_set_path);\r\n          }\r\n\r\n\r\n          check.description = prop.descriptions[prop.keys[key]];\r\n          if (!check.description) {\r\n            check.description = \"\" + prop.ui_value_names[key];\r\n          }\r\n          check.onchange = makecb(key);\r\n          //console.log(\"PATH\", path);\r\n        }\r\n      }\r\n    }\r\n\r\n    return frame;\r\n  }\r\n\r\n  /*\r\n    enummap is an object that maps\r\n    ui names to keys, e.g.:\r\n\r\n    ui.listenum(\"color\", \"Color\", {\r\n      RED   : 0,\r\n      GREEN : 1,\r\n      BLUE  : 2\r\n    });\r\n\r\n    path can be undefined, in which case, use callback,\r\n    which gets the current enum as an argument\r\n\r\n    defaultval cannot be undefined\r\n  */\r\n  listenum(inpath, name, enumDef, defaultval, callback, iconmap, packflag = 0) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n    let mass_set_path;\r\n\r\n    if (name && typeof name === \"object\") {\r\n      let args = name;\r\n\r\n      name = args.name;\r\n      enumDef = args.enumDef;\r\n      defaultval = args.defaultval;\r\n      callback = args.callback;\r\n      iconmap = args.iconmap;\r\n      packflag = args.packflag || 0;\r\n      mass_set_path = args.mass_set_path;\r\n    }\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    let path;\r\n\r\n    if (inpath !== undefined) {\r\n      path = this._joinPrefix(inpath);\r\n    }\r\n\r\n    let ret = UIBase.createElement(\"dropbox-x\")\r\n    if (enumDef !== undefined) {\r\n      if (enumDef instanceof toolprop.EnumProperty) {\r\n        ret.prop = enumDef;\r\n      } else {\r\n        ret.prop = new toolprop.EnumProperty(defaultval, enumDef, path, name);\r\n      }\r\n\r\n      if (iconmap !== undefined) {\r\n        ret.prop.addIcons(iconmap)\r\n      }\r\n    } else {\r\n      let res = this.ctx.api.resolvePath(this.ctx, path, true);\r\n\r\n      if (res !== undefined) {\r\n        ret.prop = res.prop;\r\n\r\n        name = name === undefined ? res.prop.uiname : name;\r\n      }\r\n    }\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    if (path !== undefined) {\r\n      ret.setAttribute(\"datapath\", path);\r\n    }\r\n    if (mass_set_path !== undefined) {\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n    }\r\n\r\n    ret.setAttribute(\"name\", name);\r\n\r\n    if (defaultval) {\r\n      ret.setValue(defaultval);\r\n    }\r\n\r\n    ret.onchange = callback;\r\n    ret.onselect = callback;\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  getroot() {\r\n    let p = this;\r\n\r\n    while (p.parent !== undefined) {\r\n      p = p.parent;\r\n    }\r\n\r\n    return p;\r\n  }\r\n\r\n  simpleslider(inpath, name, defaultval, min, max, step, is_int, do_redraw, callback, packflag = 0) {\r\n    if (arguments.length === 2 || typeof name === \"object\") {\r\n      let args = Object.assign({}, name);\r\n\r\n      args.packflag = (args.packflag || 0) | PackFlags.SIMPLE_NUMSLIDERS;\r\n      return this.slider(inpath, args);\r\n      //new-style api call\r\n    } else {\r\n      return this.slider(inpath, name, defaultval, min, max, step, is_int, do_redraw, callback, packflag | PackFlags.SIMPLE_NUMSLIDERS);\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * usage: .slider(inpath, {\r\n   *  name : bleh,\r\n   *  defaultval : number,\r\n   *  etc...\r\n   * });\r\n   * */\r\n  slider(inpath, name, defaultval, min, max, step, is_int, do_redraw, callback, packflag = 0) {\r\n    if (arguments.length === 2 || typeof name === \"object\") {\r\n      //new-style api call\r\n\r\n      let args = name;\r\n\r\n      name = args.name;\r\n      defaultval = args.defaultval;\r\n      min = args.min;\r\n      max = args.max;\r\n      step = args.step;\r\n      is_int = args.is_int || args.isInt;\r\n      do_redraw = args.do_redraw;\r\n      callback = args.callback;\r\n      packflag = args.packflag || 0;\r\n    }\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n    let ret;\r\n\r\n    if (inpath) {\r\n      inpath = this._joinPrefix(inpath);\r\n\r\n      let rdef = this.ctx.api.resolvePath(this.ctx, inpath, true);\r\n      if (rdef && rdef.prop && (rdef.prop.flag & PropFlags.SIMPLE_SLIDER)) {\r\n        packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n      }\r\n      if (rdef && rdef.prop && (rdef.prop.flag & PropFlags.FORCE_ROLLER_SLIDER)) {\r\n        packflag |= PackFlags.FORCE_ROLLER_SLIDER;\r\n      }\r\n    }\r\n\r\n    let simple = (packflag & PackFlags.SIMPLE_NUMSLIDERS) || cconst.simpleNumSliders;\r\n    simple = simple && !(packflag & PackFlags.FORCE_ROLLER_SLIDER);\r\n\r\n    let extraTextBox = cconst.useNumSliderTextboxes && !(packflag & PackFlags.NO_NUMSLIDER_TEXTBOX);\r\n\r\n    if (extraTextBox) {\r\n      if (simple) {\r\n        ret = UIBase.createElement(\"numslider-simple-x\");\r\n      } else {\r\n        ret = UIBase.createElement(\"numslider-textbox-x\");\r\n      }\r\n    } else {\r\n      if (simple) {\r\n        ret = UIBase.createElement(\"numslider-simple-x\");\r\n      } else {\r\n        ret = UIBase.createElement(\"numslider-x\");\r\n      }\r\n    }\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    let decimals;\r\n\r\n    if (inpath) {\r\n      ret.setAttribute(\"datapath\", inpath);\r\n    }\r\n\r\n    if (name) {\r\n      ret.setAttribute(\"name\", name);\r\n    }\r\n\r\n    if (min !== undefined) {\r\n      ret.setAttribute(\"min\", min);\r\n    }\r\n    if (max !== undefined) {\r\n      ret.setAttribute(\"max\", max);\r\n    }\r\n\r\n    if (defaultval !== undefined) {\r\n      ret.setValue(defaultval);\r\n    }\r\n\r\n    if (is_int) {\r\n      ret.setAttribute(\"integer\", is_int);\r\n    }\r\n\r\n    if (decimals !== undefined) {\r\n      ret.decimalPlaces = decimals;\r\n    }\r\n\r\n    if (callback) {\r\n      ret.onchange = callback;\r\n    }\r\n\r\n    this._add(ret);\r\n\r\n    if (this.ctx) {\r\n      ret.setCSS();\r\n      ret.update();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  _container_inherit(elem, packflag = 0) {\r\n    //don't inherit NO_UPDATE\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    elem.packflag |= packflag;\r\n    elem.inherit_packflag |= packflag;\r\n    elem.dataPrefix = this.dataPrefix;\r\n    elem.massSetPrefix = this.massSetPrefix;\r\n  }\r\n\r\n  treeview() {\r\n    let ret = UIBase.createElement(\"tree-view-x\");\r\n    ret.ctx = this.ctx;\r\n    this.add(ret);\r\n\r\n    this._container_inherit(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  panel(name, id, packflag = 0, tooltip = undefined) {\r\n    id = id === undefined ? name : id;\r\n\r\n    let ret = UIBase.createElement(\"panelframe-x\");\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    if (tooltip) {\r\n      ret.setHeaderToolTip(tooltip);\r\n    }\r\n\r\n    ret.setAttribute(\"label\", name);\r\n    ret.setAttribute(\"id\", id);\r\n\r\n    this._add(ret);\r\n\r\n\r\n    if (this.ctx) {//check init was called\r\n      ret.ctx = this.ctx;\r\n      ret._init();\r\n      //ret.headerLabel = name;\r\n\r\n      ret.contents.ctx = ret.ctx;\r\n    }\r\n\r\n    ret.contents.dataPrefix = this.dataPrefix;\r\n    ret.contents.massSetPrefix = this.massSetPrefix;\r\n\r\n    return ret;\r\n  }\r\n\r\n  row(packflag = 0) {\r\n    let ret = UIBase.createElement(\"rowframe-x\");\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n\r\n    ret.ctx = this.ctx;\r\n\r\n    return ret;\r\n  }\r\n\r\n  listbox(packflag = 0) {\r\n    let ret = UIBase.createElement(\"listbox-x\");\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  table(packflag = 0) {\r\n    let ret = UIBase.createElement(\"tableframe-x\");\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  twocol(parentDepth = 1, packflag = 0) {\r\n    let ret = UIBase.createElement(\"two-column-x\");\r\n\r\n    ret.parentDepth = parentDepth;\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  col(packflag = 0) {\r\n    let ret = UIBase.createElement(\"colframe-x\");\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  colorPicker(inpath, packflag_or_args = 0, mass_set_path = undefined, themeOverride = undefined) {\r\n    let packflag;\r\n\r\n    if (typeof packflag_or_args === \"object\") {\r\n      let args = packflag_or_args;\r\n\r\n      packflag = args.packflag !== undefined ? args.packflag : 0;\r\n      mass_set_path = args.massSetPath;\r\n      themeOverride = args.themeOverride;\r\n    }\r\n\r\n    let path;\r\n\r\n    if (inpath) {\r\n      path = this._joinPrefix(inpath);\r\n    }\r\n\r\n    let ret = UIBase.createElement(\"colorpicker-x\");\r\n\r\n    if (themeOverride) {\r\n      ret.overrideClass(themeOverride);\r\n    }\r\n\r\n    packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    ret.ctx = this.ctx;\r\n    ret.parentWidget = this;\r\n    ret._init();\r\n    ret.packflag |= packflag;\r\n    ret.inherit_packflag |= packflag;\r\n    ret.constructor.setDefault(ret);\r\n\r\n    if (path !== undefined) {\r\n      ret.setAttribute(\"datapath\", path);\r\n    }\r\n\r\n    console.warn(\"mass_set_path\", mass_set_path);\r\n    if (mass_set_path) {\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n    }\r\n\r\n    //XXX\r\n    window.colorpicker = ret;\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  textarea(datapath = undefined, value = \"\", packflag = 0, mass_set_path = undefined) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, datapath, mass_set_path);\r\n\r\n    let ret = UIBase.createElement(\"rich-text-editor-x\");\r\n    ret.ctx = this.ctx;\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    if (value !== undefined) {\r\n      ret.value = value;\r\n    }\r\n\r\n    if (datapath)\r\n      ret.setAttribute(\"datapath\", datapath)\r\n    if (mass_set_path)\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path)\r\n\r\n    this.add(ret);\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   * html5 viewer\r\n   * */\r\n  viewer(datapath = undefined, value = \"\", packflag = 0, mass_set_path = undefined) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, datapath, mass_set_path);\r\n\r\n    let ret = UIBase.createElement(\"html-viewer-x\");\r\n    ret.ctx = this.ctx;\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    if (value !== undefined) {\r\n      ret.value = value;\r\n    }\r\n\r\n    if (datapath)\r\n      ret.setAttribute(\"datapath\", datapath)\r\n    if (mass_set_path)\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path)\r\n\r\n    this.add(ret);\r\n    return ret;\r\n  }\r\n\r\n  //\r\n  tabs(position = \"top\", packflag = 0) {\r\n\r\n    let ret = UIBase.createElement(\"tabcontainer-x\");\r\n\r\n    ret.constructor.setDefault(ret);\r\n    ret.setAttribute(\"bar_pos\", position);\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  asDialogFooter() {\r\n    this.style['margin-top'] = '15px';\r\n    this.style['justify-content'] = 'flex-end';\r\n\r\n    return this;\r\n  }\r\n\r\n};\r\n\r\nui_base.UIBase.internalRegister(Container, \"div\");\r\n\r\n\r\nexport class RowFrame extends Container {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: 'rowframe-x'\r\n    };\r\n  }\r\n\r\n  //try to set styling as early as possible\r\n  connectedCallback() {\r\n    super.connectedCallback();\r\n\r\n    this.style['display'] = 'flex';\r\n    this.style['flex-direction'] = this.reversed ? 'row-reverse' : 'row';\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style['display'] = 'flex';\r\n    this.style['flex-direction'] = this.reversed ? 'row-reverse' : 'row';\r\n\r\n    if (!this.style['align-items'] || this.style['align-items'] == '') {\r\n      this.style['align-items'] = 'center';\r\n    }\r\n\r\n    if (this.getDefault(\"slider-style\") === \"simple\") {\r\n      this.packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n      this.inherit_packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n    }\r\n  }\r\n\r\n  oneAxisMargin(m = this.getDefault('oneAxisMargin'), m2 = 0) {\r\n    this.style['margin-left'] = this.style['margin-right'] = m + 'px';\r\n    this.style['margin-top'] = this.style['margin-bottom'] = '' + m2 + 'px';\r\n\r\n    return this;\r\n  }\r\n\r\n  oneAxisPadding(m = this.getDefault('oneAxisPadding'), m2 = 0) {\r\n    this.style['padding-left'] = this.style['padding-right'] = '' + m + 'px';\r\n    this.style['padding-top'] = this.style['padding-bottom'] = '' + m2 + 'px';\r\n\r\n    return this;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(RowFrame);\r\n\r\nexport class ColumnFrame extends Container {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"colframe-x\"\r\n    };\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-direction\"] = \"column\";\r\n    this.style[\"justify-content\"] = \"right\";\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  oneAxisMargin(m = this.getDefault('oneAxisMargin'), m2 = 0) {\r\n    this.style['margin-top'] = this.style['margin-bottom'] = '' + m + 'px';\r\n    this.style['margin-left'] = this.style['margin-right'] = m2 + 'px';\r\n\r\n    return this;\r\n  }\r\n\r\n  oneAxisPadding(m = this.getDefault('oneAxisPadding'), m2 = 0) {\r\n    this.style['padding-top'] = this.style['padding-bottom'] = '' + m + 'px';\r\n    this.style['padding-left'] = this.style['padding-right'] = '' + m2 + 'px';\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ColumnFrame);\r\n\r\n\r\nexport class TwoColumnFrame extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this._colWidth = 256;\r\n    this.parentDepth = 1;\r\n  }\r\n\r\n  get colWidth() {\r\n    if (this.hasAttribute(\"colWidth\")) {\r\n      return parsepx(this.getAttribute(\"colWidth\"));\r\n    }\r\n\r\n    return this._colWidth;\r\n  }\r\n\r\n  set colWidth(v) {\r\n    if (this.hasAttribute(\"colWidth\")) {\r\n      this.setAttribute(\"colWidth\", \"\" + v);\r\n    } else {\r\n      this._colWidth = v;\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"two-column-x\"\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-direction\"] = \"column\";\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    let p = this;\r\n\r\n    for (let i = 0; i < this.parentDepth; i++) {\r\n      p = p.parentWidget ? p.parentWidget : p;\r\n    }\r\n\r\n    if (!p) {\r\n      return;\r\n    }\r\n\r\n    let r = p.getBoundingClientRect();\r\n\r\n    if (!r) {\r\n      return;\r\n    }\r\n\r\n    let style = r.width > this.colWidth*2.0 ? 'row' : 'column';\r\n\r\n    if (this.style[\"flex-direction\"] !== style) {\r\n      this.style[\"flex-direction\"] = style;\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(TwoColumnFrame);\r\n","import * as util from '../path-controller/util/util.js';\r\nimport * as ui from '../core/ui.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport {Icons, css2color, color2css} from '../core/ui_base.js';\r\n\r\nlet UIBase = ui_base.UIBase;\r\n\r\nexport class Note extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    let style = document.createElement(\"style\");\r\n\r\n    this._noteid = undefined;\r\n    this.height = 20;\r\n\r\n    this.showExclMark = true;\r\n\r\n    style.textContent = `\r\n    .notex {\r\n      display : flex;\r\n      flex-direction : row;\r\n      flex-wrap : nowrap;\r\n      height : {this.height}px;\r\n      padding : 0px;\r\n      margin : 0px;\r\n    }\r\n    `;\r\n\r\n    this.dom = document.createElement(\"div\");\r\n    this.dom.setAttribute(\"class\", \"notex\");\r\n    this.color = \"red\";\r\n\r\n    this.shadow.appendChild(style);\r\n    this.shadow.append(this.dom);\r\n    this.setLabel(\"\");\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"note-x\",\r\n      style  : 'notification',\r\n    }\r\n  }\r\n\r\n  setLabel(s) {\r\n    let color = this.color;\r\n    if (this.showExclMark && this.mark === undefined) {\r\n      this.mark = document.createElement(\"div\");\r\n      this.mark.style[\"display\"] = \"flex\";\r\n      this.mark.style[\"flex-direction\"] = \"row\";\r\n      this.mark.style[\"flex-wrap\"] = \"nowrap\";\r\n\r\n      //this.mark.style[\"width\"]\r\n      let sheet = 0;\r\n\r\n      let size = ui_base.iconmanager.getTileSize(sheet);\r\n\r\n      this.mark.style[\"width\"] = \"\" + size + \"px\";\r\n      this.mark.style[\"height\"] = \"\" + size + \"px\";\r\n\r\n      this.dom.appendChild(this.mark);\r\n\r\n      this.ntext = document.createElement(\"div\");\r\n      this.ntext.style[\"display\"] = \"inline-flex\";\r\n      this.ntext.style[\"flex-wrap\"] = \"nowrap\";\r\n\r\n      this.dom.appendChild(this.ntext);\r\n\r\n      ui_base.iconmanager.setCSS(Icons.NOTE_EXCL, this.mark, sheet);\r\n\r\n      //this.mark.style[\"margin\"] = this.ntext.style[\"margin\"] = \"0px\"\r\n      //this.mark.style[\"padding\"] = this.ntext.style[\"padding\"] = \"0px\"\r\n      //this.mark.style[\"background-color\"] = color;\r\n    } else if (!this.showExclMark && this.mark) {\r\n      this.mark.remove();\r\n      this.mark = undefined;\r\n    }\r\n\r\n    let ntext = this.ntext;\r\n    //mark.innerText = \"!\";\r\n    ntext.innerText = \" \" + s;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.setAttribute(\"class\", \"notex\");\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-wrap\"] = \"nowrap\";\r\n    this.style[\"flex-direction\"] = \"row\";\r\n    this.style[\"border-radius\"] = \"7px\";\r\n    this.style[\"padding\"] = \"2px\";\r\n\r\n    this.style[\"color\"] = this.getDefault(\"DefaultText\").color;\r\n    let clr = css2color(this.color);\r\n    clr = color2css([clr[0], clr[1], clr[2], 0.25]);\r\n\r\n    this.style[\"background-color\"] = clr;\r\n    this.setCSS();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS(false);\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(Note);\r\n\r\nexport class ProgBarNote extends Note {\r\n  constructor() {\r\n    super();\r\n\r\n    this._percent = 0.0;\r\n    this.barWidth = 100;\r\n\r\n    let bar = this.bar = document.createElement(\"div\");\r\n    bar.style[\"display\"] = \"flex\";\r\n    bar.style[\"flex-direction\"] = \"row\";\r\n    bar.style[\"width\"] = this.barWidth + \"px\";\r\n    bar.style[\"height\"] = this.height + \"px\";\r\n    bar.style[\"background-color\"] = this.getDefault(\"ProgressBarBG\");\r\n    bar.style[\"border-radius\"] = \"12px\";\r\n    bar.style[\"align-items\"] = \"center\";\r\n    bar.style[\"padding\"] = bar.style[\"margin\"] = \"0px\";\r\n\r\n    let bar2 = this.bar2 = document.createElement(\"div\");\r\n    let w = 50.0;\r\n\r\n    bar2.style[\"display\"] = \"flex\";\r\n    bar2.style[\"flex-direction\"] = \"row\";\r\n    bar2.style[\"height\"] = this.height + \"px\";\r\n    bar2.style[\"background-color\"] = this.getDefault(\"ProgressBar\");\r\n    bar2.style[\"border-radius\"] = \"12px\";\r\n    bar2.style[\"align-items\"] = \"center\";\r\n    bar2.style[\"padding\"] = bar2.style[\"margin\"] = \"0px\";\r\n\r\n    this.bar.appendChild(bar2);\r\n    this.dom.appendChild(this.bar);\r\n  }\r\n\r\n  get percent() {\r\n    return this._percent;\r\n  }\r\n\r\n  set percent(val) {\r\n    this._percent = val;\r\n    this.setCSS();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"note-progress-x\",\r\n      style  : 'notification',\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    let w = ~~(this.percent*this.barWidth + 0.5);\r\n\r\n    this.bar2.style[\"width\"] = w + \"px\";\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ProgBarNote);\r\n\r\nexport class NoteFrame extends ui.RowFrame {\r\n  constructor() {\r\n    super();\r\n    this._h = 20;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"noteframe-x\",\r\n      style  : 'noteframe',\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.noMarginsOrPadding();\r\n\r\n    noteframes.push(this);\r\n    this.background = this.getDefault(\"background-color\");\r\n    this.style['flex-grow'] = 'unset';\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.style[\"width\"] = \"min-contents\";\r\n    this.style[\"height\"] = this._h + \"px\";\r\n  }\r\n\r\n  _ondestroy() {\r\n    if (noteframes.indexOf(this) >= 0) {\r\n      noteframes.remove(this)\r\n    }\r\n\r\n    super._ondestroy();\r\n  }\r\n\r\n  progbarNote(msg, percent, color = \"rgba(255,0,0,0.2)\", timeout = 700, id = msg) {\r\n    let note;\r\n\r\n    for (let child of this.children) {\r\n      if (child._noteid === id) {\r\n        note = child;\r\n        break;\r\n      }\r\n    }\r\n\r\n    let f = (100.0*Math.min(percent, 1.0)).toFixed(1);\r\n\r\n    if (note === undefined) {\r\n      note = this.addNote(msg, color, -1, \"note-progress-x\");\r\n      note._noteid = id;\r\n    }\r\n\r\n    //note.setLabel(msg + \" \" + f + \"%\");\r\n    note.percent = percent;\r\n\r\n    if (percent >= 1.0) {\r\n      //note.setLabel(msg + \" \" + f + \"%\");\r\n\r\n      window.setTimeout(() => {\r\n        note.remove();\r\n      }, timeout);\r\n    }\r\n\r\n    return note;\r\n  }\r\n\r\n  addNote(msg, color = \"rgba(255,0,0,0.2)\", timeout = 1200, tagname = \"note-x\", showExclMark=true) {\r\n    //let note = UIBase.createElement(\"note-x\");\r\n\r\n    //note.ctx = this.ctx;\r\n    //note.background = \"red\";\r\n    //note.dom.innerText = msg;\r\n\r\n    //this._add(note);\r\n\r\n    let note = UIBase.createElement(tagname);\r\n\r\n    note.color = color;\r\n    note.setLabel(msg);\r\n\r\n    note.style[\"text-align\"] = \"center\";\r\n\r\n    note.style[\"font\"] = ui_base.getFont(note, \"DefaultText\");\r\n    note.style[\"color\"] = this.getDefault(\"DefaultText\").color;\r\n    note.showExclMark = showExclMark;\r\n\r\n    this.add(note);\r\n\r\n    this.noMarginsOrPadding();\r\n    note.noMarginsOrPadding();\r\n\r\n    //this.dom.style[\"position\"] = UIBase.PositionKey;\r\n    //this.style[\"position\"] = UIBase.PositionKey;\r\n    //note.style[\"position\"] = UIBase.PositionKey;\r\n\r\n    note.style[\"height\"] = this._h + \"px\";\r\n    note.height = this._h;\r\n\r\n    if (timeout !== -1) {\r\n      window.setTimeout(() => {\r\n        //console.log(\"remove!\");\r\n        note.remove();\r\n      }, timeout);\r\n    }\r\n\r\n    //this.appendChild(note);\r\n    return note;\r\n\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(NoteFrame);\r\n\r\nexport function getNoteFrames(screen) {\r\n  let ret = [];\r\n\r\n  let rec = (n) => {\r\n\r\n    if (n instanceof NoteFrame) {\r\n      ret.push(n);\r\n    }\r\n\r\n    if (n.childNodes !== undefined) {\r\n      for (let node of n.childNodes) {\r\n        rec(node);\r\n      }\r\n    }\r\n\r\n    if (n instanceof ui_base.UIBase && n.shadow !== undefined && n.shadow.childNodes) {\r\n      for (let node of n.shadow.childNodes) {\r\n        rec(node);\r\n      }\r\n    }\r\n  }\r\n\r\n  rec(screen);\r\n  return ret;\r\n}\r\n\r\nexport let noteframes = [];\r\n\r\nexport function sendNote(screen, msg, color, timeout = 3000, showExclMark=true) {\r\n  noteframes = getNoteFrames(screen);\r\n\r\n  for (let frame of noteframes) {\r\n    try {\r\n      frame.addNote(msg, color, timeout, undefined, showExclMark);\r\n    } catch (error) {\r\n      print_stack(error);\r\n      console.log(error.stack, error.message);\r\n      console.log(\"bad notification frame\");\r\n    }\r\n  }\r\n}\r\n\r\nwindow._sendNote = sendNote;\r\n\r\nexport function error(screen, msg, timeout) {\r\n  return sendNote(screen, msg, ui_base.color2css([1.0, 0.0, 0.0, 1.0]), timeout);\r\n}\r\n\r\nexport function warning(screen, msg, timeout) {\r\n  return sendNote(screen, msg, ui_base.color2css([0.78, 0.78, 0.2, 1.0]), timeout);\r\n}\r\n\r\nexport function message(screen, msg, timeout) {\r\n  return sendNote(screen, msg, ui_base.color2css([0.2, 0.9, 0.1, 1.0]), timeout, false);\r\n}\r\n\r\n\r\nexport function progbarNote(screen, msg, percent, color, timeout) {\r\n  noteframes = getNoteFrames(screen);\r\n\r\n  for (let frame of noteframes) {\r\n    try {\r\n      frame.progbarNote(msg, percent, color, timeout);\r\n    } catch (error) {\r\n      print_stack(error);\r\n      console.log(error.stack, error.message);\r\n      console.log(\"bad notification frame\");\r\n    }\r\n  }\r\n}\r\n","import * as ui_base from '../core/ui_base.js'\r\nimport * as util from '../path-controller/util/util.js';\r\nimport {ColumnFrame, RowFrame, Container} from \"../core/ui.js\";\r\nlet UIBase = ui_base.UIBase, Icons = ui_base.Icons;\r\nimport {TextBoxBase} from './ui_textbox.js';\r\nimport {keymap} from \"../path-controller/util/simple_events.js\";\r\n\r\nexport class RichEditor extends TextBoxBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._internalDisabled = false;\r\n    this._value = \"\";\r\n\r\n    this.textOnlyMode = false;\r\n\r\n    this.styletag = document.createElement(\"style\");\r\n    this.styletag.textContent = `\r\n      div.rich-text-editor-x {\r\n        width        :   100%;\r\n        height       :   100%;\r\n        min-height   :   150px;\r\n        overflow     :   scroll;\r\n        padding      :   5px;\r\n        white-space  :   pre-wrap;\r\n      }\r\n      \r\n      rich-text-editor-x {\r\n        display        : flex;\r\n        flex-direction : column;\r\n      }\r\n    `;\r\n\r\n    this.shadow.appendChild(this.styletag);\r\n\r\n    let controls = this.controls = UIBase.createElement(\"rowframe-x\");\r\n\r\n\r\n    let makeicon = (icon, description, cb) => {\r\n      icon = controls.iconbutton(icon, description, cb);\r\n      icon.iconsheet = 1; //use second smallest icon size\r\n      icon.overrideDefault(\"padding\", 3);\r\n\r\n      return icon;\r\n    };\r\n\r\n    makeicon(Icons.BOLD, \"Bold\", () => {\r\n      document.execCommand(\"bold\");\r\n    });\r\n    makeicon(Icons.ITALIC, \"Italic\", () => {\r\n      document.execCommand(\"italic\");\r\n    });\r\n    makeicon(Icons.UNDERLINE, \"Underline\", () => {\r\n      document.execCommand(\"underline\");\r\n    });\r\n    makeicon(Icons.STRIKETHRU, \"Strikethrough\", () => {\r\n      document.execCommand(\"strikeThrough\");\r\n    });\r\n\r\n    controls.background = this.getDefault(\"background-color\");\r\n\r\n    this.shadow.appendChild(controls);\r\n\r\n    this.textarea = document.createElement(\"div\");\r\n    this.textarea.contentEditable = true;\r\n    this.textarea.setAttribute(\"class\", \"rich-text-editor-x\");\r\n\r\n    this.textarea.style[\"font\"] = this.getDefault(\"DefaultText\").genCSS();\r\n    this.textarea.style[\"background-color\"] = this.getDefault(\"background-color\");\r\n    this.textarea.setAttribute(\"white-space\", \"pre-wrap\");\r\n\r\n    this.textarea.addEventListener(\"keydown\", (e) => {\r\n      if (e.keyCode === keymap[\"S\"] && e.shiftKey && (e.ctrlKey || e.commandKey)) {\r\n        this.toggleStrikeThru();\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n    });\r\n\r\n    this.textarea.addEventListener(\"focus\", (e) => {\r\n      this._focus = 1;\r\n      this.setCSS();\r\n    });\r\n    this.textarea.addEventListener(\"blur\", (e) => {\r\n      this._focus = 0;\r\n      this.setCSS();\r\n    });\r\n\r\n    document.execCommand(\"styleWithCSS\", true);\r\n\r\n    window.ta = this;\r\n\r\n    this.textarea.addEventListener(\"selectionchange\", (e) => {\r\n      console.log(\"sel1\");\r\n    });\r\n\r\n    document.addEventListener(\"selectionchange\", (e, b) => {\r\n      console.log(\"sel2\", document.getSelection().startNode, b);\r\n    });\r\n\r\n    this.textarea.addEventListener(\"input\", (e) => {\r\n      if (this.internalDisabled) {\r\n        return;\r\n      }\r\n\r\n      console.log(\"text input\", e);\r\n\r\n      let text;\r\n\r\n      if (this.textOnlyMode) {\r\n        text = this.textarea.innerText;\r\n      } else {\r\n        text = this.textarea.innerHTML;\r\n      }\r\n\r\n      if (this.textOnlyMode && text === this._value) {\r\n        //formatting changed?\r\n        console.log(\"detected formatting change\");\r\n        return;\r\n      }\r\n\r\n      //console.log(\"text changed\", ...arguments);\r\n      let sel = document.getSelection();\r\n      let range = sel.getRangeAt(0);\r\n      //console.log(range.startOffset, range.endOffset, range.startContainer);\r\n\r\n      let node = sel.anchorNode;\r\n      let off = sel.anchorOffset;\r\n\r\n      this._value = text;\r\n\r\n      //sel.collapse(node, off);\r\n\r\n      if (this.hasAttribute(\"datapath\")) {\r\n        let path = this.getAttribute(\"datapath\");\r\n        this.setPathValue(this.ctx, path, this.value);\r\n      }\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this._value);\r\n      }\r\n      if (this.oninput) {\r\n        this.oninput(this._value);\r\n      }\r\n\r\n      this.dispatchEvent(new InputEvent(this));\r\n      this.dispatchEvent(new CustomEvent('change'));\r\n    });\r\n\r\n    this.shadow.appendChild(this.textarea);\r\n  }\r\n\r\n  /**\r\n   * Only available in textOnlyMode.  Called when starting text formatting\r\n  */\r\n  formatStart() {\r\n  }\r\n\r\n  /**\r\n  * Only available in textOnlyMode.  Formats html-formated line.\r\n   *\r\n   * @param line : line to format\r\n   * @parem text : whole text\r\n  * */\r\n  formatLine(line, text) {\r\n    return line;\r\n  }\r\n\r\n  toggleStrikeThru() {\r\n    console.log(\"strike thru!\");\r\n    document.execCommand(\"strikeThrough\");\r\n  }\r\n  /**\r\n   * Only available in textOnlyMode.  Called when starting text formatting\r\n   */\r\n  formatEnd() {\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    window.rc = this;\r\n\r\n    document.execCommand(\"defaultParagraphSeparator\", false, \"div\");\r\n\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  get internalDisabled() {\r\n    return this._internalDisabled;\r\n  }\r\n\r\n  set internalDisabled(val) {\r\n    let changed = !!this._internalDisabled !== !!val;\r\n\r\n    if (changed || 1) {\r\n      this._internalDisabled = !!val;\r\n      super.internalDisabled = val;\r\n\r\n      this.textarea.internalDisabled = val;\r\n      this.textarea.contentEditable = !val;\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  set value(val) {\r\n    this._value = val;\r\n\r\n    if (this.textOnlyMode) {\r\n      let val2 = \"\";\r\n      for (let l of val.split(\"\\n\")) {\r\n        val2 += l + \"<br>\";\r\n      }\r\n      val = val2;\r\n    }\r\n\r\n    this.textarea.innerHTML = val;\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.controls.background = this.getDefault(\"background-color\");\r\n\r\n    if (this._focus) {\r\n      this.textarea.style[\"border\"] = `2px dashed ${this.getDefault('focus-border-color')}`;\r\n    } else {\r\n      this.textarea.style[\"border\"] = \"none\";\r\n    }\r\n\r\n    if (this.style[\"font\"]) {\r\n      this.textarea.style[\"font\"] = this.style[\"font\"];\r\n    } else {\r\n      this.textarea.style[\"font\"] = this.getDefault(\"DefaultText\").genCSS();\r\n    }\r\n\r\n    if (this.style[\"color\"]) {\r\n      this.textarea.style[\"color\"] = this.style[\"color\"];\r\n    }  else {\r\n      this.textarea.style[\"color\"] = this.getDefault(\"DefaultText\").color;\r\n    }\r\n\r\n\r\n    if (this.disabled) {\r\n      this.textarea.style[\"background-color\"] = this.getDefault(\"DisabledBG\");\r\n    } else {\r\n      this.textarea.style[\"background-color\"] = this.getDefault(\"background-color\");\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n    let prop = this.getPathMeta(this.ctx, path);\r\n\r\n    if (prop === undefined) {\r\n      console.warn(\"invalid datapath \" + path);\r\n\r\n      this.internalDisabled = true;\r\n      return;\r\n    }\r\n\r\n    this.internalDisabled = false;\r\n    let value = this.getPathValue(this.ctx, path);\r\n\r\n    if (value !== this._value) {\r\n      console.log(\"text change\");\r\n      this.value = value;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateDataPath();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"rich-text-editor-x\",\r\n    style   : \"richtext\",\r\n    modalKeyEvents : true\r\n  }}\r\n}\r\nUIBase.internalRegister(RichEditor);\r\n\r\nexport class RichViewer extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.contents = document.createElement(\"div\");\r\n    this.contents.style[\"padding\"] = \"10px\";\r\n    this.contents.style[\"margin\"] = \"10px\";\r\n    this.contents.style[\"overflow\"] = \"scroll\";\r\n\r\n    this.shadow.appendChild(this.contents);\r\n    this._value = \"\";\r\n  }\r\n\r\n  hideScrollBars() {\r\n    this.contents.style[\"overflow\"] = \"hidden\"\r\n  }\r\n\r\n  showScrollBars() {\r\n    this.contents.style[\"overflow\"] = \"scroll\"\r\n  }\r\n\r\n  //transforms text into final html form\r\n  //note that client code is allowed to override this directly\r\n  textTransform(text) {\r\n    return text;\r\n  }\r\n  set value(val) {\r\n    this._value = val;\r\n\r\n    this.contents.innerHTML = this.textTransform(val);\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n    let prop = this.getPathMeta(this.ctx, path);\r\n\r\n    if (prop === undefined) {\r\n      console.warn(\"invalid datapath \" + path);\r\n\r\n      this.internalDisabled = true;\r\n      return;\r\n    }\r\n\r\n    this.internalDisabled = false;\r\n    let value = this.getPathValue(this.ctx, path);\r\n\r\n    if (value !== this.value) {\r\n      this.value = value;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateDataPath();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"html-viewer-x\",\r\n    style   : \"html_viewer\"\r\n  }}\r\n}\r\nUIBase.internalRegister(RichViewer);\r\n","\"use strict\";\r\nimport './ui_richedit.js';\r\n\r\nimport * as util from '../util/util.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport {Vector2, Vector3, Vector4, Quat, Matrix4} from '../path-controller/util/vectormath.js';\r\nimport {RowFrame, ColumnFrame} from \"../core/ui.js\";\r\nimport {isNumber, PropFlags} from \"../path-controller/toolsys/toolprop.js\";\r\n\r\nimport './ui_widgets.js';\r\n\r\nlet keymap = events.keymap;\r\n\r\nimport {EnumProperty, PropTypes} from '../path-controller/toolsys/toolprop.js';\r\nimport {UIBase, PackFlags, IconSheets, parsepx} from '../core/ui_base.js';\r\n\r\nimport * as units from '../core/units.js';\r\nimport {ToolProperty} from '../path-controller/toolsys/toolprop.js';\r\nimport {Button} from \"./ui_button.js\";\r\n\r\nexport class VectorPopupButton extends Button {\r\n  constructor() {\r\n    super();\r\n\r\n    this.value = new Vector4();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"vector-popup-button-x\",\r\n    style : \"vecPopupButton\"\r\n  }}\r\n\r\n  _onpress(e) {\r\n    if (e.button && e.button !== 0) {\r\n      return;\r\n    }\r\n\r\n    let panel = UIBase.createElement(\"vector-panel-x\");\r\n    let screen = this.ctx.screen;\r\n\r\n    let popup = screen.popup(this, this);\r\n\r\n    popup.add(panel);\r\n    popup.button(\"ok\", () => {\r\n      popup.end();\r\n    })\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      panel.setAttribute(\"datapath\", this.getAttribute(\"datapath\"));\r\n    }\r\n    if (this.hasAttribute(\"mass_set_path\")) {\r\n      panel.setAttribute(\"mass_set_path\", this.getAttribute(\"mass_set_path\"));\r\n    }\r\n\r\n    popup.flushUpdate();\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let value = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (!value) {\r\n      this.internalDisabled = true;\r\n      return;\r\n    }\r\n\r\n    if (this.internalDisabled) {\r\n      this.internalDisabled = false;\r\n    }\r\n\r\n    if (this.value.length !== value.length) {\r\n      switch (value.length) {\r\n        case 2:\r\n          this.value = new Vector2();\r\n          break;\r\n        case 3:\r\n          this.value = new Vector3();\r\n          break;\r\n        case 4:\r\n          this.value = new Vector4();\r\n          break;\r\n      }\r\n    }\r\n\r\n    if (this.value.vectorDistance(value) > 0.0001) {\r\n      this.value.load(value);\r\n      console.log(\"updated vector popup button value\");\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n    this.updateDataPath();\r\n  }\r\n\r\n}\r\nUIBase.internalRegister(VectorPopupButton);\r\n\r\nexport class VectorPanel extends ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this.range = [-1e17, 1e17];\r\n\r\n    this.name = \"\";\r\n\r\n    this.axes = \"XYZW\";\r\n    this.value = new Vector3();\r\n    this.sliders = [];\r\n    this.hasUniformSlider = false;\r\n\r\n    this.packflag |= PackFlags.FORCE_ROLLER_SLIDER|PackFlags.NO_NUMSLIDER_TEXTBOX;\r\n\r\n    let makeParam = (key) => {\r\n      Object.defineProperty(this, key, {\r\n        get : function() {\r\n          return this._getNumParam(key);\r\n        },\r\n\r\n        set : function(val) {\r\n          this._setNumParam(key, val);\r\n        }\r\n      });\r\n    };\r\n\r\n    this.__range = [-1e17, 1e17];\r\n    this._range = new Array(2);\r\n\r\n    Object.defineProperty(this._range, 0, {\r\n      get : () => this.__range[0],\r\n      set : (val) => this.__range[0] = val\r\n    });\r\n    Object.defineProperty(this._range, 1, {\r\n      get : () => this.__range[1],\r\n      set : (val) => this.__range[1] = val\r\n    });\r\n\r\n    makeParam(\"isInt\");\r\n    makeParam(\"radix\");\r\n    makeParam(\"decimalPlaces\");\r\n    makeParam(\"baseUnit\");\r\n    makeParam(\"displayUnit\");\r\n    makeParam(\"step\");\r\n    makeParam(\"expRate\");\r\n    makeParam(\"stepIsRelative\");\r\n\r\n    window.vp = this;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this.rebuild();\r\n    this.setCSS();\r\n\r\n    this.background = this.getDefault(\"InnerPanelBG\");\r\n  }\r\n\r\n  _getNumParam(key) {\r\n    return this[\"_\"+key];\r\n  }\r\n\r\n  _setNumParam(key, val) {\r\n    if (key === \"range\") {\r\n      this.__range[0] = val[0];\r\n      this.__range[1] = val[1];\r\n\r\n      return;\r\n    }\r\n\r\n    this[\"_\"+key] = val;\r\n\r\n    for (let slider of this.sliders) {\r\n      slider[key] = val;\r\n    }\r\n  }\r\n\r\n  rebuild() {\r\n    this.clear();\r\n\r\n    if (this.name) {\r\n      this.label(this.name);\r\n    }\r\n\r\n    let frame, row;\r\n\r\n    if (this.hasUniformSlider) {\r\n      row = this.row();\r\n      frame = row.col();\r\n    } else {\r\n      frame = this;\r\n    }\r\n\r\n    this.sliders = [];\r\n\r\n    for (let i=0; i<this.value.length; i++) {\r\n      //inpath, name, defaultval, min, max, step, is_int, do_redraw, callback, packflag = 0) {\r\n\r\n      let slider = frame.slider(undefined, {\r\n        name       : this.axes[i],\r\n        defaultval : this.value[i],\r\n        min        : this.range[0],\r\n        max        : this.range[1],\r\n        step       : this.step || 0.001,\r\n        is_int     : this.isInt,\r\n        packflag   : this.packflag\r\n      });\r\n\r\n      //let slider = frame.slider(undefined, this.axes[i], this.value[i], this.range[0], this.range[1], 0.001, this.isInt);\r\n      slider.axis = i;\r\n      let this2 = this;\r\n\r\n      slider.baseUnit = this.baseUnit;\r\n      slider.displayUnit = this.displayUnit;\r\n      slider.isInt = this.isInt;\r\n      slider.range = this.__range;\r\n      slider.radix = this.radix;\r\n      slider.step = this.step;\r\n      slider.expRate = this.expRate;\r\n      slider.stepIsRelative= this.stepIsRelative;\r\n\r\n      if (this.stepIsRelative) {\r\n        slider.step = ToolProperty.calcRelativeStep(this.step, this.value[i]);\r\n      }\r\n\r\n      slider.onchange = function(e) {\r\n        this2.value[this.axis] = this.value;\r\n\r\n        if (this2.hasAttribute(\"datapath\")) {\r\n          this2.setPathValue(this2.ctx, this2.getAttribute(\"datapath\"), this2.value);\r\n        }\r\n\r\n        if (this2.uslider) {\r\n          this2.uslider.setValue(this2.uniformValue, false);\r\n        }\r\n\r\n        if (this2.onchange) {\r\n          this2.onchange(this2.value);\r\n        }\r\n      }\r\n\r\n      this.sliders.push(slider);\r\n    }\r\n\r\n    if (this.hasUniformSlider) {\r\n      let uslider = this.uslider = UIBase.createElement(\"numslider-x\");\r\n      row._prepend(uslider);\r\n\r\n      uslider.range = this.range;\r\n      uslider.baseUnit = this.baseUnit;\r\n      uslider.displayUnit = this.displayUnit;\r\n      uslider.expRate = this.expRate;\r\n      uslider.step = this.step;\r\n      uslider.expRate = this.expRate;\r\n      uslider.isInt = this.isInt;\r\n      uslider.radix = this.radix;\r\n      uslider.decimalPlaces = this.decimalPlaces;\r\n      uslider.stepIsRelative= this.stepIsRelative;\r\n\r\n      uslider.vertical = true;\r\n      uslider.setValue(this.uniformValue, false);\r\n\r\n      this.sliders.push(uslider);\r\n\r\n      uslider.onchange = () => {\r\n        this.uniformValue = uslider.value;\r\n      }\r\n    } else {\r\n      this.uslider = undefined;\r\n    }\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  get uniformValue() {\r\n    let sum = 0.0;\r\n\r\n    for (let i=0; i<this.value.length; i++) {\r\n      sum += isNaN(this.value[i]) ? 0.0 : this.value[i];\r\n    }\r\n\r\n    return sum / this.value.length;\r\n  }\r\n\r\n  set uniformValue(val) {\r\n    let old = this.uniformValue;\r\n    let doupdate = false;\r\n\r\n    if (old === 0.0 || val === 0.0) {\r\n      doupdate = this.value.dot(this.value) !== 0.0\r\n\r\n      this.value.zero();\r\n    } else {\r\n      let ratio = val / old;\r\n      for (let i = 0; i < this.value.length; i++) {\r\n        this.value[i] *= ratio;\r\n      }\r\n\r\n      doupdate = true;\r\n    }\r\n\r\n    if (doupdate) {\r\n      if (this.hasAttribute(\"datapath\")) {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this.value);\r\n      }\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.value);\r\n      }\r\n\r\n      for (let i=0; i<this.value.length; i++) {\r\n        this.sliders[i].setValue(this.value[i], false);\r\n        this.sliders[i]._redraw();\r\n      }\r\n\r\n      if (this.uslider) {\r\n        this.uslider.setValue(val, false);\r\n        this.uslider._redraw();\r\n      }\r\n    }\r\n  }\r\n\r\n  setValue(value) {\r\n    if (!value) {\r\n      return;\r\n    }\r\n\r\n    if (value.length !== this.value.length) {\r\n      switch (value.length) {\r\n        case 2:\r\n          this.value = new Vector2(value);\r\n          break;\r\n        case 3:\r\n          this.value = new Vector3(value);\r\n          break;\r\n        case 4:\r\n          this.value = new Vector4(value);\r\n          break;\r\n        default:\r\n          throw new Error(\"invalid vector size \" + value.length);\r\n      }\r\n\r\n      this.rebuild();\r\n    } else {\r\n      this.value.load(value);\r\n    }\r\n\r\n    if (this.onchange) {\r\n      this.onchange(this.value);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n\r\n    let val = this.getPathValue(this.ctx, path);\r\n    if (val === undefined) {\r\n      this.internalDisabled = true;\r\n      return;\r\n    }\r\n\r\n\r\n    let meta = this.getPathMeta(this.ctx, path);\r\n    let name = meta.uiname !== undefined ? meta.uiname : meta.name;\r\n    if (this.hasAttribute(\"name\")) {\r\n      name = this.getAttribute(\"name\");\r\n    }\r\n\r\n    if (name && name !== this.name) {\r\n      this.name = name;\r\n      this.rebuild();\r\n      return;\r\n    }\r\n\r\n    let loadNumParam = (k, do_rebuild=false) => {\r\n      if (meta && meta[k] !== undefined && this[k] === undefined) {\r\n        this[k] = meta[k];\r\n\r\n        if (this[k] !== meta[k] && do_rebuild) {\r\n          this.doOnce(this.rebuild);\r\n        }\r\n      }\r\n    }\r\n\r\n\r\n    loadNumParam(\"baseUnit\");\r\n    loadNumParam(\"displayUnit\");\r\n    loadNumParam(\"decimalPlaces\");\r\n    loadNumParam(\"isInt\");\r\n    loadNumParam(\"radix\");\r\n    loadNumParam(\"step\");\r\n    loadNumParam(\"expRate\");\r\n    loadNumParam(\"stepIsRelative\");\r\n\r\n    if (meta && meta.hasUniformSlider !== undefined && meta.hasUniformSlider !== this.hasUniformSlider) {\r\n      this.hasUniformSlider = meta.hasUniformSlider;\r\n      this.doOnce(this.rebuild);\r\n    }\r\n\r\n    if (meta && meta.range) {\r\n      let update = this.range[0] !== meta.range[0];\r\n      update= update || this.range[1] !== meta.range[1];\r\n\r\n      this.range[0] = meta.range[0];\r\n      this.range[1] = meta.range[1];\r\n\r\n      if (update) {\r\n        this.doOnce(this.rebuild);\r\n      }\r\n    }\r\n\r\n    this.internalDisabled = false;\r\n\r\n    let length = val.length;\r\n\r\n    if (meta && (meta.flag & PropFlags.USE_CUSTOM_GETSET)) {\r\n      let rdef = this.ctx.api.resolvePath(this.ctx, path);\r\n\r\n      meta.ctx = this.ctx;\r\n      meta.dataref = rdef.obj;\r\n      meta.datapath = path;\r\n\r\n      length = meta.getValue().length;\r\n\r\n      meta.dataref = undefined;\r\n    }\r\n\r\n    if (this.value.length !== length) {\r\n      switch (length) {\r\n        case 2:\r\n          val = new Vector2(val);\r\n          break;\r\n        case 3:\r\n          val = new Vector3(val);\r\n          break;\r\n        case 4:\r\n          val = new Vector4(val);\r\n          break;\r\n        default:\r\n          val = meta.getValue().copy().load(val);\r\n          break;\r\n      }\r\n\r\n      this.value = val;\r\n      this.rebuild();\r\n\r\n      for (let i=0; i<this.value.length; i++) {\r\n        this.sliders[i].setValue(val[i], false);\r\n        this.sliders[i]._redraw();\r\n      }\r\n    } else {\r\n      if (this.value.vectorDistance(val) > 0) {\r\n        this.value.load(val);\r\n\r\n        if (this.uslider) {\r\n          this.uslider.setValue(this.uniformValue, false);\r\n        }\r\n\r\n        for (let i=0; i<this.value.length; i++) {\r\n          this.sliders[i].setValue(val[i], false);\r\n          this.sliders[i]._redraw();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateDataPath();\r\n\r\n    if (this.stepIsRelative) {\r\n      for (let slider of this.sliders) {\r\n        slider.step = ToolProperty.calcRelativeStep(this.step, slider.value);\r\n      }\r\n    }\r\n\r\n    if (this.uslider) {\r\n      this.uslider.step = this.step;\r\n      if (this.stepIsRelative) {\r\n        this.uslider.step = ToolProperty.calcRelativeStep(this.step, this.uniformValue);\r\n      }\r\n\r\n    }\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"vector-panel-x\"\r\n  }}\r\n}\r\nUIBase.internalRegister(VectorPanel);\r\n\r\n\r\nexport class ToolTip extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.visibleToPick = false;\r\n    this.div = document.createElement(\"div\");\r\n\r\n    this.shadow.appendChild(this.div);\r\n    this._start_time = undefined;\r\n    this.timeout = undefined;\r\n  }\r\n\r\n  static show(message, screen, x, y) {\r\n    let ret = UIBase.createElement(this.define().tagname);\r\n\r\n    ret._start_time = util.time_ms();\r\n    ret.timeout = ret.getDefault(\"timeout\");\r\n\r\n    ret.text = message;\r\n    let size = ret._estimateSize();\r\n\r\n    let pad = 5;\r\n    size = [size[0] + pad, size[1] + pad];\r\n\r\n    console.log(size);\r\n    x = Math.min(Math.max(x, 0), screen.size[0] - size[0]);\r\n    y = Math.min(Math.max(y, 0), screen.size[1] - size[1]);\r\n\r\n    let dpi = UIBase.getDPI();\r\n\r\n    x += 10/dpi;\r\n    y += 15/dpi;\r\n\r\n    ret._popup = screen.popup(ret, x, y);\r\n    ret._popup.background = \"rgba(0,0,0,0)\";\r\n    ret._popup.style[\"border\"] = \"none\";\r\n    ret.div.style[\"padding\"] = \"15px\";\r\n\r\n    ret._popup.add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  end() {\r\n    this._popup.end();\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this.setCSS();\r\n  }\r\n\r\n  set text(val) {\r\n    this.div.innerHTML = val.replace(/[\\n]/g, \"<br>\\n\");\r\n  }\r\n\r\n  get text() {\r\n    return this.div.innerHTML;\r\n  }\r\n\r\n  _estimateSize() {\r\n    let text = this.div.textContent;\r\n    let block = ui_base.measureTextBlock(this, text, undefined, undefined, undefined, this.getDefault(\"ToolTipText\"));\r\n\r\n    return [block.width+50, block.height+30];\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    if (util.time_ms() - this._start_time > this.timeout) {\r\n      this.end();\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    let color = this.getDefault(\"background-color\");\r\n    let bcolor = this.getDefault(\"border-color\");\r\n\r\n    this.background = color;\r\n\r\n    let radius = this.getDefault(\"border-radius\", undefined, 5);\r\n    let bstyle = this.getDefault(\"border-style\", undefined, \"solid\");\r\n    let bwidth = this.getDefault(\"border-width\", undefined, 1);\r\n    let padding = this.getDefault(\"padding\", undefined, 15);\r\n\r\n    this.noMarginsOrPadding();\r\n\r\n    this.div.style[\"padding\"] = padding + \"px\";\r\n\r\n    this.div.style[\"background-color\"] = \"rgba(0,0,0,0)\";\r\n    this.div.style[\"border\"] = `${bwidth}px ${bstyle} ${bcolor}`;\r\n    this.div.style[\"border-radius\"] = radius + \"px\";\r\n    this.style[\"border-radius\"] = radius + \"px\";\r\n\r\n    let font = this.getDefault(\"ToolTipText\");\r\n    this.div.style[\"color\"] = font.color;\r\n    this.div.style[\"font\"] = font.genCSS();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"tool-tip-x\",\r\n    style   : \"tooltip\"\r\n  }}\r\n};\r\nUIBase.internalRegister(ToolTip);\r\n\r\nwindow._ToolTip = ToolTip;\r\n","\"use strict\";\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as simple_toolsys from '../path-controller/toolsys/toolsys.js';\r\nimport {ToolTip} from \"../widgets/ui_widgets2.js\";\r\n\r\n/*\r\nwhy am I using a toolstack here at all?  time to remove!\r\n*/\r\n\r\nlet toolstack_getter = function () {\r\n  throw new Error(\"must pass a toolstack getter to registerToolStackGetter\")\r\n}\r\n\r\nexport function registerToolStackGetter(func) {\r\n  toolstack_getter = func;\r\n}\r\n\r\nlet Vector2   = vectormath.Vector2,\r\n    Vector3   = vectormath.Vector3,\r\n    UndoFlags = simple_toolsys.UndoFlags,\r\n    ToolFlags = simple_toolsys.ToolFlags;\r\n\r\nimport {pushModalLight, popModalLight, keymap, pushPointerModal} from \"../util/simple_events.js\";\r\n\r\n//import {keymap} from './events';\r\n\r\nexport class ToolBase extends simple_toolsys.ToolOp {\r\n  constructor(screen) {\r\n    super();\r\n    this.screen = screen;\r\n    //super();\r\n\r\n    this._finished = false;\r\n  }\r\n\r\n  start(elem, pointerId) {\r\n    //toolstack_getter().execTool(this);\r\n    this.modalStart(undefined, elem, pointerId);\r\n  }\r\n\r\n  cancel() {\r\n    this.finish();\r\n  }\r\n\r\n  finish() {\r\n    this._finished = true;\r\n    this.popModal(this.screen);\r\n  }\r\n\r\n  popModal() {\r\n    this.overdraw.end();\r\n    popModalLight(this.modaldata);\r\n    this.modaldata = undefined;\r\n  }\r\n\r\n  modalStart(ctx, elem, pointerId) {\r\n    this.ctx = ctx;\r\n\r\n    if (this.modaldata !== undefined) {\r\n      console.log(\"Error, modaldata was not undefined\");\r\n      popModalLight(this.modaldata);\r\n    }\r\n\r\n    this.overdraw = ui_base.UIBase.createElement(\"overdraw-x\");\r\n    this.overdraw.start(this.screen);\r\n\r\n    let handlers = {};\r\n    let keys = Object.getOwnPropertyNames(this);\r\n    for (let k in this.__proto__) {\r\n      keys.push(k);\r\n    }\r\n    for (let k of Object.getOwnPropertyNames(this.__proto__)) {\r\n      keys.push(k);\r\n    }\r\n\r\n    for (let k in this) {\r\n      keys.push(k);\r\n    }\r\n\r\n    for (let k of keys) {\r\n      if (k.startsWith(\"on\")) {\r\n        handlers[k] = this[k].bind(this);\r\n      }\r\n    }\r\n\r\n    //window.setTimeout(() => {\r\n    if (pointerId !== undefined) {\r\n      handlers.on_pointerdown = handlers.on_mousedown;\r\n      handlers.on_pointermove = handlers.on_mousemove;\r\n      handlers.on_pointerup = handlers.on_mouseup;\r\n      handlers.on_pointercancel = handlers.on_mouseup;\r\n      handlers.on_pointerend = handlers.on_mouseup;\r\n\r\n      this.modaldata = pushPointerModal(handlers, elem, pointerId);\r\n    } else {\r\n      this.modaldata = pushModalLight(handlers);\r\n    }\r\n    //console.log(\"HANDLERS\", this.modaldata.handlers);\r\n\r\n    //}, 100);\r\n\r\n    //window.addEventListener(\"touchmove\", (e) => {\r\n    //  console.log(\"touchmove\");\r\n    //}, {passive : false});\r\n  }\r\n\r\n  on_mousemove(e) {\r\n  }\r\n\r\n  on_mouseup(e) {\r\n    this.finish();\r\n  }\r\n\r\n  on_keydown(e) {\r\n    console.log(\"s\", e.keyCode);\r\n\r\n    switch (e.keyCode) {\r\n      case keymap.Escape: //esc\r\n        this.cancel();\r\n        break;\r\n      case keymap.Space: //space\r\n      case keymap.Enter: //return\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\nexport class AreaResizeTool extends ToolBase {\r\n  constructor(screen, border, mpos) {\r\n    if (screen === undefined) screen = _appstate.screen; //XXX hackish!\r\n\r\n    super(screen);\r\n\r\n    this.start_mpos = new Vector2(mpos);\r\n\r\n    this.sarea = border.sareas[0];\r\n    if (!this.sarea || border.dead) {\r\n      console.log(border.dead, border);\r\n      throw new Error(\"border corruption\");\r\n    }\r\n\r\n    this.screen = screen;\r\n\r\n    this.side = this.sarea._side(border);\r\n  }\r\n\r\n  get border() {\r\n    return this.sarea._borders[this.side];\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Resize Area\",\r\n      toolpath   : \"screen.area.resize\",\r\n      icon       : ui_base.Icons.RESIZE,\r\n      description: \"change size of area\",\r\n      is_modal   : true,\r\n      undoflag   : UndoFlags.NO_UNDO,\r\n      flag       : 0,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n\r\n  getBorders() {\r\n    let horiz = this.border.horiz;\r\n\r\n    let ret = [];\r\n    let visit = new Set();\r\n\r\n    let rec = (v) => {\r\n      if (visit.has(v._id)) {\r\n        return;\r\n      }\r\n\r\n      visit.add(v._id);\r\n\r\n      for (let border of v.borders) {\r\n        if (border.horiz == horiz && !visit.has(border._id)) {\r\n          visit.add(border._id);\r\n          ret.push(border);\r\n\r\n          rec(border.otherVertex(v));\r\n        }\r\n      }\r\n    }\r\n\r\n    rec(this.border.v1);\r\n    rec(this.border.v2);\r\n\r\n    return ret;\r\n  }\r\n\r\n  on_mouseup(e) {\r\n    this.finish();\r\n  }\r\n\r\n  finish() {\r\n    super.finish();\r\n    this.screen.snapScreenVerts();\r\n    this.screen.regenBorders();\r\n    this.screen.snapScreenVerts();\r\n    this.screen.loadFromVerts();\r\n  }\r\n\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case keymap[\"Escape\"]:\r\n      case keymap[\"Enter\"]:\r\n      case keymap[\"Space\"]:\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n\r\n  on_mousemove(e) {\r\n    let mpos = new Vector2([e.x, e.y]);\r\n\r\n    mpos.sub(this.start_mpos);\r\n\r\n    let axis = this.border.horiz ? 1 : 0;\r\n\r\n    //console.log(this.border.horiz);\r\n\r\n    this.overdraw.clear();\r\n\r\n    let visit = new Set();\r\n    let borders = this.getBorders();\r\n\r\n    let color = cconst.DEBUG.screenborders ? \"rgba(1.0, 0.5, 0.0, 0.1)\" : \"rgba(1.0, 0.5, 0.0, 1.0)\";\r\n\r\n    let bad = false;\r\n\r\n    for (let border of borders) {\r\n      bad = bad || !this.screen.isBorderMovable(border);\r\n\r\n      border.oldv1 = new Vector2(border.v1);\r\n      border.oldv2 = new Vector2(border.v2);\r\n    }\r\n\r\n    if (bad) {\r\n      console.log(\"border is not movable\");\r\n      return;\r\n    }\r\n\r\n    let check = () => {\r\n      let count = 0;\r\n\r\n      for (let sarea of this.screen.sareas) {\r\n        if (sarea.size[0] < 15 || sarea.size[1] < 15) {\r\n          count++;\r\n        }\r\n      }\r\n\r\n      return count;\r\n    };\r\n\r\n    let badcount = check();\r\n\r\n\r\n    let snapMode = true;\r\n\r\n    let df = mpos[axis];\r\n    let border = this.border;\r\n\r\n    this.screen.moveBorder(border, df, false);\r\n\r\n    for (let border of borders) {\r\n      //if false, stead of forcing areas to fit within screen bounds\r\n      //in snapScreenVerts the screen bounds will be modified instead.\r\n\r\n      if (border.outer) {\r\n        snapMode = false;\r\n      }\r\n\r\n      this.overdraw.line(border.v1, border.v2, color);\r\n    }\r\n\r\n    this.start_mpos[0] = e.x;\r\n    this.start_mpos[1] = e.y;\r\n    this.screen.loadFromVerts();\r\n    this.screen.setCSS();\r\n\r\n    if (check() != badcount) {\r\n      console.log(\"bad\");\r\n\r\n      for (let border of borders) {\r\n        border.v1.load(border.oldv1);\r\n        border.v2.load(border.oldv2);\r\n      }\r\n    }\r\n\r\n\r\n    this.screen.snapScreenVerts(snapMode);\r\n    this.screen.loadFromVerts();\r\n    this.screen.solveAreaConstraints(snapMode);\r\n    this.screen.setCSS();\r\n    this.screen.updateDebugBoxes();\r\n    this.screen._fireResizeCB();\r\n  }\r\n}\r\n\r\n//controller.registerTool(AreaResizeTool);\r\n\r\nexport class SplitTool extends ToolBase {\r\n  constructor(screen) {\r\n    if (screen === undefined) screen = _appstate.screen; //XXX hackish!\r\n\r\n    super(screen);\r\n\r\n    this.done = false;\r\n    this.screen = screen;\r\n    this.ctx = screen.ctx;\r\n    this.sarea = undefined;\r\n    this.t = undefined;\r\n\r\n    this.started = false;\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Split Area\",\r\n      toolpath   : \"screen.area.split\",\r\n      icon       : ui_base.Icons.SMALL_PLUS,\r\n      description: \"split an area in two\",\r\n      is_modal   : true,\r\n      undoflag   : UndoFlags.NO_UNDO,\r\n      flag       : 0,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n\r\n  modalStart(ctx) {\r\n    if (this.started) {\r\n      console.trace(\"double call to modalStart()\");\r\n      return;\r\n    }\r\n\r\n    this.overdraw = ui_base.UIBase.createElement(\"overdraw-x\");\r\n    this.overdraw.start(this.screen);\r\n\r\n    super.modalStart(ctx);\r\n  }\r\n\r\n  cancel() {\r\n    return this.finish(true);\r\n  }\r\n\r\n  finish(canceled = false) {\r\n    if (this.done) {\r\n      return;\r\n    }\r\n\r\n    this.done = true;\r\n    this.overdraw.end();\r\n\r\n    this.popModal(this.screen);\r\n\r\n    if (canceled || !this.sarea) {\r\n      return;\r\n    }\r\n\r\n    let sarea = this.sarea, screen = this.screen;\r\n    let t = this.t;\r\n\r\n    screen.splitArea(sarea, t, this.horiz);\r\n    screen._internalRegenAll();\r\n  }\r\n\r\n  on_mousemove(e) {\r\n    let x = e.x, y = e.y;\r\n\r\n    let screen = this.screen;\r\n\r\n    let sarea = screen.findScreenArea(x, y);\r\n\r\n    this.overdraw.clear();\r\n\r\n    if (sarea !== undefined) {\r\n      //x -= sarea.pos[0];\r\n      //y -= sarea.pos[1];\r\n      x = (x - sarea.pos[0])/(sarea.size[0]);\r\n      y = (y - sarea.pos[1])/(sarea.size[1]);\r\n\r\n      let dx = 1.0 - Math.abs(x - 0.5);\r\n      let dy = 1.0 - Math.abs(y - 0.5);\r\n\r\n      this.sarea = sarea;\r\n      let horiz = this.horiz = dx < dy;\r\n\r\n      if (horiz) {\r\n        this.t = y;\r\n        this.overdraw.line([sarea.pos[0], e.y], [sarea.pos[0] + sarea.size[0], e.y]);\r\n      } else {\r\n        this.t = x;\r\n        this.overdraw.line([e.x, sarea.pos[1]], [e.x, sarea.pos[1] + sarea.size[1]]);\r\n      }\r\n    }\r\n    //console.warn(\"sarea:\", sarea);\r\n\r\n    //let sarea = this.\r\n    //console.log(e.x, e.y);\r\n    //this.overdraw.clear();\r\n    //this.overdraw.line([e.x, e.y-200], [e.x, e.y+200], \"grey\");\r\n  }\r\n\r\n  on_mousedown(e) {\r\n  }\r\n\r\n  on_mouseup(e) {\r\n    this.finish();\r\n\r\n    if (e.button) {\r\n      this.stopPropagation();\r\n      this.preventDefault();\r\n    }\r\n  }\r\n\r\n  on_keydown(e) {\r\n    console.log(\"s\", e.keyCode);\r\n\r\n    switch (e.keyCode) {\r\n      case keymap.Escape: //esc\r\n        this.cancel();\r\n        break;\r\n      case keymap.Space: //space\r\n      case keymap.Enter: //return\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\n\r\nexport class RemoveAreaTool extends ToolBase {\r\n  constructor(screen, border) {\r\n    if (screen === undefined) screen = _appstate.screen; //XXX hackish!\r\n\r\n    super(screen);\r\n\r\n    this.border = border;\r\n\r\n    this.done = false;\r\n    this.screen = screen;\r\n    this.ctx = screen.ctx;\r\n    this.sarea = undefined;\r\n    this.t = undefined;\r\n\r\n    this.started = false;\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Remove Area\",\r\n      toolpath   : \"screen.area.pick_remove\",\r\n      icon       : ui_base.Icons.SMALL_PLUS,\r\n      description: \"Collapse a window\",\r\n      is_modal   : true,\r\n      undoflag   : UndoFlags.NO_UNDO,\r\n      flag       : 0,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n\r\n  modalStart(ctx) {\r\n    if (this.started) {\r\n      console.trace(\"double call to modalStart()\");\r\n      return;\r\n    }\r\n\r\n    this.overdraw = ui_base.UIBase.createElement(\"overdraw-x\");\r\n    this.overdraw.start(this.screen);\r\n\r\n    super.modalStart(ctx);\r\n  }\r\n\r\n  cancel() {\r\n    return this.finish(true);\r\n  }\r\n\r\n  finish(canceled = false) {\r\n    if (this.done) {\r\n      return;\r\n    }\r\n\r\n    this.done = true;\r\n    this.overdraw.end();\r\n\r\n    this.popModal(this.screen);\r\n\r\n    if (canceled || !this.sarea) {\r\n      return;\r\n    }\r\n\r\n    let sarea = this.sarea, screen = this.screen;\r\n    let t = this.t;\r\n\r\n    if (sarea) {\r\n      screen.collapseArea(sarea, this.border);\r\n      screen._internalRegenAll();\r\n    }\r\n  }\r\n\r\n  on_mousemove(e) {\r\n    let x = e.x, y = e.y;\r\n\r\n    let screen = this.screen;\r\n\r\n    let sarea = screen.findScreenArea(x, y);\r\n\r\n    this.overdraw.clear();\r\n\r\n    if (sarea !== undefined) {\r\n      this.sarea = sarea;\r\n      this.overdraw.rect(sarea.pos, sarea.size, \"rgba(0,0,0,0.1)\");\r\n    }\r\n    //console.warn(\"sarea:\", sarea);\r\n\r\n    //let sarea = this.\r\n    //console.log(e.x, e.y);\r\n    //this.overdraw.clear();\r\n    //this.overdraw.line([e.x, e.y-200], [e.x, e.y+200], \"grey\");\r\n  }\r\n\r\n  on_mousedown(e) {\r\n  }\r\n\r\n  on_mouseup(e) {\r\n    this.finish();\r\n\r\n    if (e.button) {\r\n      this.stopPropagation();\r\n      this.preventDefault();\r\n    }\r\n  }\r\n\r\n  on_keydown(e) {\r\n    console.log(\"s\", e.keyCode);\r\n\r\n    switch (e.keyCode) {\r\n      case keymap.Escape: //esc\r\n        this.cancel();\r\n        break;\r\n      case keymap.Space: //space\r\n      case keymap.Enter: //return\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\n//controller.registerTool(SplitTool);\r\n\r\n\r\nexport class AreaDragTool extends ToolBase {\r\n  constructor(screen, sarea, mpos) {\r\n    if (screen === undefined) screen = _appstate.screen; //XXX hackish!\r\n\r\n    super(screen);\r\n\r\n    this.dropArea = false;\r\n    this.excludeAreas = new Set();\r\n    this.cursorbox = undefined;\r\n    this.boxes = [];\r\n    this.boxes.active = undefined;\r\n\r\n    this.sarea = sarea;\r\n    this.start_mpos = new Vector2(mpos);\r\n    this.screen = screen;\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Drag Area\",\r\n      toolpath   : \"screen.area.drag\",\r\n      icon       : ui_base.Icons.TRANSLATE,\r\n      description: \"move or duplicate area\",\r\n      is_modal   : true,\r\n      undoflag   : UndoFlags.NO_UNDO,\r\n      flag       : 0,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n\r\n  finish() {\r\n    super.finish();\r\n\r\n    this.screen.regenBorders();\r\n    this.screen.solveAreaConstraints();\r\n    this.screen.snapScreenVerts();\r\n    this.screen._recalcAABB();\r\n  }\r\n\r\n  getBoxRect(b) {\r\n    let sa = b.sarea;\r\n    let pos, size;\r\n\r\n    if (b.horiz == -1) {\r\n      //replacement mode\r\n      pos = sa.pos;\r\n      size = sa.size;\r\n    } else if (b.horiz) {\r\n      if (b.side == 'b') {\r\n        pos = [sa.pos[0], sa.pos[1] + sa.size[1]*b.t]\r\n        size = [sa.size[0], sa.size[1]*(1.0 - b.t)]\r\n      } else {\r\n        pos = [sa.pos[0], sa.pos[1]];\r\n        size = [sa.size[0], sa.size[1]*b.t]\r\n      }\r\n    } else {\r\n      if (b.side == 'r') {\r\n        pos = [sa.pos[0] + sa.size[0]*b.t, sa.pos[1]]\r\n        size = [sa.size[0]*(1.0 - b.t), sa.size[1]]\r\n      } else {\r\n        pos = [sa.pos[0], sa.pos[1]];\r\n        size = [sa.size[0]*b.t, sa.size[1]]\r\n      }\r\n    }\r\n\r\n    let color = \"rgba(100, 100, 100, 0.2)\";\r\n\r\n    let ret = this.overdraw.rect(pos, size, color);\r\n    ret.style[\"pointer-events\"] = \"none\";\r\n\r\n    return ret;\r\n  }\r\n\r\n  doSplit(b) {\r\n    if (this.sarea) {\r\n      return this.doSplitDrop(b);\r\n    }\r\n\r\n    let src = this.sarea, dst = b.sarea;\r\n    let screen = this.screen;\r\n\r\n    let t = b.t;\r\n\r\n    screen.splitArea(dst, t, b.horiz);\r\n\r\n    screen._internalRegenAll();\r\n  }\r\n\r\n  doSplitDrop(b) {\r\n    //first check if there was no change\r\n    if (b.horiz === -1 && b.sarea === this.sarea) {\r\n      return;\r\n    }\r\n\r\n    let can_rip = false;\r\n    let sa = this.sarea;\r\n    let screen = this.screen;\r\n\r\n    //rip conditions\r\n    can_rip = sa.size[0] === screen.size[0] || sa.size[1] === screen.size[1];\r\n    can_rip = can_rip || this.sarea.floating;\r\n    can_rip = can_rip && b.sarea !== sa;\r\n    can_rip = can_rip && (b.horiz === -1 || !screen.areasBorder(sa, b.sarea));\r\n\r\n    let expand = b.horiz === -1 && b.sarea !== sa && screen.areasBorder(b.sarea, sa);\r\n\r\n    can_rip = can_rip || expand;\r\n\r\n    console.log(\"can_rip:\", can_rip, expand);\r\n\r\n    if (can_rip) {\r\n      screen.removeArea(sa);\r\n      screen.snapScreenVerts();\r\n    }\r\n\r\n    if (b.horiz === -1) {\r\n      //replacement\r\n      let src = this.sarea, dst = b.sarea;\r\n\r\n      if (can_rip && src !== dst) {\r\n        let mm;\r\n\r\n        //handle case of one area \"consuming\" another\r\n        if (expand) {\r\n          mm = screen.minmaxArea(src);\r\n          screen.minmaxArea(dst, mm);\r\n        }\r\n\r\n        console.log(\"replacing. . .\", expand);\r\n\r\n        if (src.floating) {\r\n          let old = dst.editors;\r\n\r\n          dst.editors = [];\r\n          dst.editormap = {};\r\n\r\n          if (dst.area && !(dst.area.constructor.define().areaname in src.editormap)) {\r\n            dst.area.push_ctx_active();\r\n            dst.area.on_area_inactive();\r\n            dst.area.remove();\r\n            dst.area.pop_ctx_active();\r\n          }\r\n\r\n          for (let editor of old) {\r\n            let def = editor.constructor.define();\r\n\r\n            let bad = false;\r\n            //bad = !(def.areaname in src.editormap);\r\n\r\n            for (let editor2 of src.editors) {\r\n              if (editor.constructor === editor2.constructor) {\r\n                bad = true;\r\n                break;\r\n              }\r\n            }\r\n\r\n            if (!bad) {\r\n              dst.editors.push(editor);\r\n              dst.editormap[def.areaname] = editor;\r\n            }\r\n          }\r\n\r\n          for (let editor of src.editors) {\r\n            let def = editor.constructor.define();\r\n\r\n            dst.editormap[def.areaname] = editor;\r\n            dst.editors.push(editor);\r\n\r\n            if (editor.owning_sarea) {\r\n              editor.owning_sarea = dst;\r\n            }\r\n\r\n            if (editor.parentWidget) {\r\n              editor.parentWidget = dst;\r\n            }\r\n          }\r\n\r\n          if (cconst.useAreaTabSwitcher) {\r\n            for (let editor of dst.editors) {\r\n              if (editor.switcher) {\r\n                editor.switcher.flagUpdate();\r\n              }\r\n            }\r\n          }\r\n\r\n          dst.area = src.area;\r\n          dst.shadow.appendChild(src.area);\r\n\r\n          src.area = undefined;\r\n          src.editors = [];\r\n          src.editormap = {};\r\n\r\n          dst.on_resize(dst.size, dst.size);\r\n\r\n          dst.flushSetCSS();\r\n          dst.flushUpdate();\r\n\r\n          screen.removeArea(src);\r\n          screen.snapScreenVerts();\r\n\r\n          return;\r\n        } else {\r\n          screen.replaceArea(dst, src);\r\n        }\r\n\r\n        if (expand) {\r\n          console.log(\"\\nEXPANDING:\", src.size[0], src.size[1]);\r\n\r\n          src.pos[0] = mm.min[0];\r\n          src.pos[1] = mm.min[1];\r\n\r\n          src.size[0] = mm.max[0] - mm.min[0];\r\n          src.size[1] = mm.max[1] - mm.min[1];\r\n\r\n          src.loadFromPosSize();\r\n\r\n          screen._internalRegenAll();\r\n        }\r\n      } else {\r\n        //console.log(\"copying. . .\");\r\n        screen.replaceArea(dst, src.copy());\r\n        screen._internalRegenAll();\r\n      }\r\n    } else {\r\n      let src = this.sarea, dst = b.sarea;\r\n\r\n      let t = b.t;\r\n\r\n      let nsa = screen.splitArea(dst, t, b.horiz);\r\n\r\n      if (b.side === 'l' || b.side === 't') {\r\n        nsa = dst;\r\n      }\r\n\r\n      if (can_rip) {\r\n        //console.log(\"replacing\");\r\n        screen.replaceArea(nsa, src);\r\n      } else {\r\n        //console.log(\"copying\");\r\n        screen.replaceArea(nsa, src.copy());\r\n      }\r\n\r\n      screen._internalRegenAll();\r\n    }\r\n  }\r\n\r\n  makeBoxes(sa) {\r\n    let sz = util.isMobile() ? 100 : 40;\r\n    let cx = sa.pos[0] + sa.size[0]*0.5;\r\n    let cy = sa.pos[1] + sa.size[1]*0.5;\r\n\r\n    let color = this.color = \"rgba(200, 200, 200, 0.55)\";\r\n    let hcolor = this.hcolor = \"rgba(230, 230, 230, 0.75)\";\r\n    let idgen = 0;\r\n    let boxes = this.boxes;\r\n\r\n    let box = (x, y, sz, horiz, t, side) => {\r\n      //console.log(x, y, sz);\r\n\r\n      let b = this.overdraw.rect([x - sz[0]*0.5, y - sz[1]*0.5], sz, color);\r\n      b.style[\"border-radius\"] = \"14px\";\r\n\r\n      boxes.push(b);\r\n\r\n      b.sarea = sa;\r\n\r\n      let style = document.createElement(\"style\")\r\n      let cls = `mybox_${idgen++}`;\r\n\r\n      b.horiz = horiz;\r\n      b.t = t;\r\n      b.side = side;\r\n      b.setAttribute(\"class\", cls);\r\n      b.setAttribute(\"is_box\", true);\r\n\r\n      b.addEventListener(\"mousemove\", this.on_mousemove.bind(this));\r\n\r\n      let onclick = b.onclick = (e) => {\r\n        let type = e.type.toLowerCase();\r\n\r\n        if ((e.type === \"mousedown\" || e.type === \"mouseup\") && e.button !== 0) {\r\n          return; //another handler will cancel\r\n        }\r\n\r\n        console.log(\"split click\");\r\n\r\n        if (!this._finished) {\r\n          this.finish();\r\n          this.doSplit(b);\r\n\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n        }\r\n      }\r\n\r\n      b.addEventListener(\"click\", onclick);\r\n      b.addEventListener(\"mousedown\", onclick);\r\n      b.addEventListener(\"mouseup\", onclick);\r\n\r\n      b.addEventListener(\"mouseenter\", (e) => {\r\n        if (this.curbox !== undefined) {\r\n          if (this.curbox.rect) {\r\n            this.curbox.rect.remove()\r\n            this.curbox.rect = undefined;\r\n          }\r\n        }\r\n\r\n        if (b.rect !== undefined) {\r\n          b.rect.remove();\r\n          b.rect = undefined;\r\n        }\r\n\r\n        b.rect = this.getBoxRect(b);\r\n        this.curbox = b;\r\n\r\n        b.setColor(hcolor);\r\n        //b.style[\"background-color\"] = hcolor;\r\n      })\r\n\r\n      b.addEventListener(\"mouseleave\", (e) => {\r\n        if (b.rect) {\r\n          b.rect.remove();\r\n          b.rect = undefined;\r\n        }\r\n\r\n        if (this.curbox === b) {\r\n          this.curbox = undefined;\r\n        }\r\n\r\n        b.setColor(color);\r\n        //b.style[\"background-color\"] = color;\r\n      })\r\n\r\n      style.textContent = `\r\n        .${cls}:hover {\r\n          background-color : orange;\r\n          fill:orange;stroke-width:2\r\n        }\r\n      `\r\n      //console.log(style.textContent);\r\n      b.appendChild(style);\r\n      b.setAttribute(\"class\", cls);\r\n\r\n      return b;\r\n    }\r\n\r\n    let pad = 5;\r\n\r\n    if (this.sarea) {\r\n      box(cx, cy, [sz, sz], -1, -1, -1);\r\n    }\r\n\r\n    box(cx - sz*0.75 - pad, cy, [sz*0.5, sz], false, 0.5, 'l');\r\n    box(cx - sz*1.2 - pad, cy, [sz*0.25, sz], false, 0.3, 'l');\r\n\r\n    box(cx + sz*0.75 + pad, cy, [sz*0.5, sz], false, 0.5, 'r');\r\n    box(cx + sz*1.2 + pad, cy, [sz*0.25, sz], false, 0.7, 'r');\r\n\r\n    box(cx, cy - sz*0.75 - pad, [sz, sz*0.5], true, 0.5, 't');\r\n    box(cx, cy - sz*1.2 - pad, [sz, sz*0.25], true, 0.3, 't');\r\n\r\n    box(cx, cy + sz*0.75 + pad, [sz, sz*0.5], true, 0.5, 'b');\r\n    box(cx, cy + sz*1.2 + pad, [sz, sz*0.25], true, 0.7, 'b');\r\n  }\r\n\r\n  getActiveBox(x, y) {\r\n    for (let n of this.boxes) {\r\n      if (n.hasAttribute && n.hasAttribute(\"is_box\")) {\r\n        let rect = n.getClientRects()[0];\r\n\r\n        //console.log(rect.x, rect.y);\r\n        if (x >= rect.x && y >= rect.y && x < rect.x + rect.width && y < rect.y + rect.height) {\r\n          //console.log(\"found rect\");\r\n          return n;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  on_drag(e) {\r\n    this.on_mousemove(e);\r\n  }\r\n\r\n  on_dragend(e) {\r\n    this.on_mouseup(e);\r\n  }\r\n\r\n  on_mousemove(e) {\r\n    let wid = 55;\r\n    let color = \"rgb(200, 200, 200, 0.7)\";\r\n\r\n    //console.trace(\"mouse move!\", e.x, e.y, this.sarea);\r\n\r\n    /*\r\n     manually feed events to boxes so as to work right\r\n     with touch events; note that pushModalLight routes\r\n     touch to mouse events (if no touch handlers are present).\r\n     */\r\n    let n = this.getActiveBox(e.x, e.y);\r\n\r\n    if (n !== undefined) {\r\n      n.setColor(this.hcolor); //\"rgba(250, 250, 250, 0.75)\");\r\n    }\r\n    //console.log(\"mouse move\", n);\r\n\r\n    if (this.boxes.active !== undefined && this.boxes.active !== n) {\r\n      this.boxes.active.setColor(this.color);\r\n      this.boxes.active.dispatchEvent(new MouseEvent(\"mouseleave\", e));\r\n    }\r\n\r\n    if (n !== undefined) {\r\n      n.dispatchEvent(new MouseEvent(\"mouseenter\", e));\r\n    }\r\n\r\n    this.boxes.active = n;\r\n    /*\r\n    let rec = (n) => {\r\n      if (n.hasAttribute && n.hasAttribute(\"is_box\")) {\r\n        let rect = n.getClientRects()[0];\r\n\r\n        console.log(rect.x, rect.y);\r\n        if (x >= rect.x && x >= rect.y && x < rect.x+rect.width && y < rect.y+rect.height) {\r\n          console.log(\"found rect\");\r\n          n.dispatchEvent(\"mouseenter\", new MouseEvent(\"mouseenter\", e));\r\n        }\r\n      }\r\n      if (n === undefined || n.childNodes === undefined) {\r\n        return;\r\n      }\r\n\r\n      for (let n2 of n.childNodes) {\r\n        rec(n2);\r\n      }\r\n      if (n.shadow) {\r\n        for (let n2 of n.shadow.childNodes) {\r\n          rec(n2);\r\n        }\r\n      }\r\n    };\r\n\r\n    rec(this.overdraw);\r\n    //*/\r\n    if (this.sarea === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this.cursorbox === undefined) {\r\n      wid = 25;\r\n      this.cursorbox = this.overdraw.rect([e.x - wid*0.5, e.y - wid*0.5], [wid, wid], color);\r\n      this.cursorbox.style[\"pointer-events\"] = \"none\";\r\n    } else {\r\n      this.cursorbox.style[\"x\"] = (e.x - wid*0.5) + \"px\";\r\n      this.cursorbox.style[\"y\"] = (e.y - wid*0.5) + \"px\";\r\n    }\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    this.on_mouseup(e);\r\n  }\r\n\r\n  on_mouseup(e) {\r\n    console.log(\"e.button\", e.button, e, e.x, e.y, this.getActiveBox(e.x, e.y));\r\n\r\n    if (e.button) {\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n    } else {\r\n      let box = this.getActiveBox(e.x, e.y);\r\n\r\n      if (box !== undefined) {\r\n        box.onclick(e);\r\n      }\r\n    }\r\n\r\n    this.finish();\r\n  }\r\n\r\n  modalStart(ctx) {\r\n    super.modalStart(...arguments);\r\n\r\n    let screen = this.screen;\r\n\r\n    this.overdraw.clear();\r\n\r\n    if (this.sarea && !this.excludeAreas.has(this.sarea)) {\r\n      let sa = this.sarea;\r\n      let box = this.overdraw.rect(sa.pos, sa.size, \"rgba(100, 100, 100, 0.5)\");\r\n\r\n      box.style[\"pointer-events\"] = \"none\";\r\n    }\r\n\r\n    for (let sa of screen.sareas) {\r\n      if (this.excludeAreas.has(sa)) {\r\n        continue;\r\n      }\r\n\r\n      this.makeBoxes(sa);\r\n    }\r\n  }\r\n\r\n  on_keydown(e) {\r\n    switch (e.keyCode){\r\n      case keymap[\"Escape\"]:\r\n      case keymap[\"Enter\"]:\r\n      case keymap[\"Space\"]:\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\n\r\nexport class AreaMoveAttachTool extends AreaDragTool {\r\n  constructor(screen, sarea, mpos) {\r\n    super(screen, sarea, mpos);\r\n\r\n    this.excludeAreas = new Set([sarea]);\r\n\r\n    this.dropArea = true;\r\n    this.first = true;\r\n    this.sarea = sarea;\r\n    this.mpos = new Vector2(mpos);\r\n    this.start_mpos2 = new Vector2(mpos);\r\n    this.start_pos = new Vector2(sarea.pos);\r\n  }\r\n\r\n  on_mousemove(e) {\r\n    let dx = e.x - this.start_mpos2[0];\r\n    let dy = e.y - this.start_mpos2[1];\r\n\r\n    let sarea = this.sarea;\r\n\r\n    if (this.first) {\r\n      this.start_mpos2 = new Vector2([e.x, e.y]);\r\n      this.first = false;\r\n      return;\r\n    }\r\n\r\n\r\n    sarea.pos[0] = this.start_pos[0] + dx;\r\n    sarea.pos[1] = this.start_pos[1] + dy;\r\n\r\n    sarea.loadFromPosSize();\r\n\r\n    this.mpos.loadXY(e.x, e.y);\r\n    super.on_mousemove(e);\r\n  }\r\n\r\n  on_mouseup(e) {\r\n    super.on_mouseup(e);\r\n  }\r\n\r\n  on_mousedown(e) {\r\n    super.on_mousedown(e);\r\n  }\r\n\r\n  on_keydown(e) {\r\n    super.on_keydown(e);\r\n  }\r\n}\r\n\r\n//controller.registerTool(AreaDragTool);\r\n\r\nexport class ToolTipViewer extends ToolBase {\r\n  constructor(screen) {\r\n    super(screen);\r\n\r\n    this.tooltip = undefined;\r\n    this.element = undefined;\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Help Tool\",\r\n      toolpath   : \"screen.help_picker\",\r\n      icon       : ui_base.Icons.HELP,\r\n      description: \"view tooltips\",\r\n      is_modal   : true,\r\n      undoflag   : UndoFlags.NO_UNDO,\r\n      flag       : 0,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n\r\n  on_mousemove(e) {\r\n    this.pick(e);\r\n  }\r\n\r\n  on_mousedown(e) {\r\n    this.pick(e);\r\n  }\r\n\r\n  on_mouseup(e) {\r\n    this.finish();\r\n  }\r\n\r\n  finish() {\r\n    super.finish();\r\n  }\r\n\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case keymap.Escape:\r\n      case keymap.Enter:\r\n      case Keymap.Space:\r\n        if (this.tooltip) {\r\n          this.tooltip.end();\r\n        }\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n\r\n  pick(e) {\r\n    let x = e.x, y = e.y;\r\n\r\n    let ele = this.screen.pickElement(x, y);\r\n    console.log(ele ? ele.tagName : ele);\r\n\r\n    if (ele !== undefined && ele !== this.element && ele.title) {\r\n      if (this.tooltip) {\r\n        this.tooltip.end();\r\n      }\r\n\r\n      this.element = ele;\r\n      let tip = ele.title;\r\n\r\n      this.tooltip = ToolTip.show(tip, this.screen, x, y);\r\n    }\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n  }\r\n}\r\n\r\n","import nstructjs from '../path-controller/util/struct.js';\r\nimport * as ui_base from \"../core/ui_base.js\";\r\nimport * as FrameManager_ops from \"./FrameManager_ops.js\";\r\nimport cconst from \"../config/const.js\";\r\nimport {UIBase} from '../core/ui_base.js';\r\n\r\nimport {Vector2} from '../path-controller/util/vectormath.js';\r\nimport {createMenu, Menu} from '../widgets/ui_menu.js';\r\nimport {popModalLight, pushModalLight} from '../path-controller/util/simple_events.js';\r\nimport {AreaFlags} from './ScreenArea.js';\r\n\r\nexport let SnapLimit = 1;\r\n\r\nexport const BORDER_ZINDEX_BASE = 25\r\n\r\nexport function snap(c, snap_limit = SnapLimit) {\r\n  if (Array.isArray(c)) {\r\n    for (let i = 0; i < c.length; i++) {\r\n      c[i] = Math.floor(c[i]/snap_limit)*snap_limit;\r\n    }\r\n  } else {\r\n    c = Math.floor(c/snap_limit)*snap_limit;\r\n  }\r\n\r\n  return c;\r\n}\r\n\r\nexport function snapi(c, snap_limit = SnapLimit) {\r\n  //return snap(c, snap_limit);\r\n\r\n  if (Array.isArray(c)) {\r\n    for (let i = 0; i < c.length; i++) {\r\n      c[i] = Math.ceil(c[i]/snap_limit)*snap_limit;\r\n    }\r\n  } else {\r\n    c = Math.ceil(c/snap_limit)*snap_limit;\r\n  }\r\n\r\n  return c;\r\n}\r\n\r\nexport class ScreenVert extends Vector2 {\r\n  constructor(pos, id, added_id) {\r\n    super(pos);\r\n\r\n    this.added_id = added_id;\r\n    this.sareas = [];\r\n    this.borders = [];\r\n\r\n    this._id = id;\r\n  }\r\n\r\n  static hash(pos, added_id, limit) {\r\n    let x = snap(pos[0], limit);\r\n    let y = snap(pos[1], limit);\r\n\r\n    return \"\" + x + \":\" + y + \": + added_id\";\r\n  }\r\n\r\n  valueOf() {\r\n    return ScreenVert.hash(this, this.added_id);\r\n  }\r\n\r\n  [Symbol.keystr]() {\r\n    return ScreenVert.hash(this, this.added_id);\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n  }\r\n}\r\n\r\nScreenVert.STRUCT = `\r\npathux.ScreenVert {\r\n  0 : float;\r\n  1 : float;\r\n}\r\n`;\r\nnstructjs.register(ScreenVert);\r\n\r\nexport class ScreenHalfEdge {\r\n  constructor(border, sarea) {\r\n    this.sarea = sarea;\r\n    this.border = border;\r\n    this.side = sarea._side(border);\r\n  }\r\n\r\n  get v1() {\r\n    return this.border.v1;\r\n  }\r\n\r\n  get v2() {\r\n    return this.border.v2;\r\n  }\r\n\r\n  [Symbol.keystr]() {\r\n    return this.sarea._id + \":\" + this.border._id;\r\n  }\r\n\r\n}\r\n\r\nexport class ScreenBorder extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.visibleToPick = false;\r\n\r\n    this.screen = undefined;\r\n    this.v1 = undefined;\r\n    this.v2 = undefined;\r\n    this._id = undefined;\r\n\r\n    this._hash = undefined;\r\n\r\n    this.outer = undefined;\r\n\r\n    this.halfedges = []; //all bordering borders, including ones with nonshared verts\r\n    this.sareas = [];\r\n\r\n    this._innerstyle = document.createElement(\"style\");\r\n    this._style = undefined;\r\n\r\n    this.shadow.appendChild(this._innerstyle);\r\n\r\n    this.inner = document.createElement(\"div\");\r\n    //this.inner.innerText = \"sdfsdfsdf\";\r\n    this.shadow.appendChild(this.inner);\r\n\r\n    let call_menu = ScreenBorder.bindBorderMenu(this);\r\n\r\n    this.addEventListener(\"mousedown\", (e) => {\r\n      let ok = this.movable;\r\n\r\n      if (e.button === 2) {\r\n        call_menu(e);\r\n        return;\r\n      }\r\n\r\n      if (!ok) {\r\n        console.log(\"border is not movable\");\r\n        return;\r\n      }\r\n\r\n      console.log(\"area resize start!\");\r\n      let tool = new FrameManager_ops.AreaResizeTool(this.screen, this, [e.x, e.y]);\r\n\r\n      tool.start();\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }, {capture: true});\r\n  }\r\n\r\n  static bindBorderMenu(elem, usePickElement=false) {\r\n    let on_dblclick = (e) => {\r\n      if (usePickElement && elem.pickElement(e.x, e.y) !== elem) {\r\n        return;\r\n      }\r\n\r\n      let menu = [\r\n        [\"Split Area\", () => {\r\n          elem.ctx.screen.splitTool();\r\n        }],\r\n        Menu.SEP,\r\n        [\"Collapse Area\", () => {\r\n          elem.ctx.screen.removeAreaTool(elem instanceof ScreenBorder ? elem : undefined);\r\n        }],\r\n      ];\r\n\r\n      menu = createMenu(elem.ctx, \"\", menu);\r\n      //if (e.button === 2) {\r\n      menu.ignoreFirstClick = 2;\r\n      //}\r\n\r\n      elem.ctx.screen.popupMenu(menu, e.x-15, e.y-15);\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n\r\n    elem.addEventListener(\"contextmenu\", (e) => e.preventDefault());\r\n    elem.addEventListener(\"dblclick\", on_dblclick, {capture: true});\r\n\r\n    return on_dblclick;\r\n  }\r\n  getOtherSarea(sarea) {\r\n    console.log(this.halfedges, this.halfedges.length);\r\n\r\n    for (let he of this.halfedges) {\r\n      console.log(he);\r\n\r\n      let ok = he.sarea !== sarea;\r\n      ok = ok && he.sarea._verts.indexOf(this.v1) >= 0;\r\n      ok = ok && he.sarea._verts.indexOf(this.v2) >= 0;\r\n\r\n      if (ok) {\r\n        return he.sarea;\r\n      }\r\n    }\r\n  }\r\n\r\n  get locked() {\r\n    for (let sarea of this.sareas) {\r\n      let mask = 1<<sarea._borders.indexOf(this);\r\n      let lock = sarea.borderLock & mask;\r\n\r\n      if (lock || (sarea.flag & AreaFlags.NO_COLLAPSE)) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  get dead() {\r\n    return !this.parentNode;\r\n  }\r\n\r\n  get side() {\r\n    throw new Error(\"side accedd\");\r\n  }\r\n\r\n  set side(val) {\r\n    throw new Error(\"side accedd\");\r\n  }\r\n\r\n  get valence() {\r\n    let ret = 0; //this.sareas.length;\r\n    let horiz = this.horiz;\r\n\r\n    let visit = {};\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let sv = i ? this.v2 : this.v1;\r\n      //console.log(sv);\r\n\r\n      for (let sa of sv.borders) {\r\n        if (sa.horiz != this.horiz)\r\n          continue;\r\n        if (sa._id in visit)\r\n          continue;\r\n\r\n        visit[sa._id] = 1;\r\n\r\n        let a0x = Math.min(this.v1[0], this.v2[0]);\r\n        let a0y = Math.min(this.v1[1], this.v2[1]);\r\n        let a1x = Math.max(this.v1[0], this.v2[0]);\r\n        let a1y = Math.max(this.v1[1], this.v2[1]);\r\n\r\n        let b0x = Math.min(sa.v1[0], sa.v2[0]);\r\n        let b0y = Math.min(sa.v1[1], sa.v2[1]);\r\n        let b1x = Math.min(sa.v1[0], sa.v2[0]);\r\n        let b1y = Math.min(sa.v1[1], sa.v2[1]);\r\n\r\n        let ok;\r\n\r\n        let eps = 0.001;\r\n        if (horiz) {\r\n          ok = (a0y <= b1y + eps && a1y >= a0y - eps);\r\n        } else {\r\n          ok = (a0x <= b1x + eps && a1x >= a0x - eps);\r\n        }\r\n\r\n        if (ok) {\r\n          //console.log(\"found\");\r\n          ret += sa.sareas.length;\r\n        }\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  get horiz() {\r\n    let dx = this.v2[0] - this.v1[0];\r\n    let dy = this.v2[1] - this.v1[1];\r\n\r\n    return Math.abs(dx) > Math.abs(dy);\r\n  }\r\n\r\n  static hash(v1, v2) {\r\n    return Math.min(v1._id, v2._id) + \":\" + Math.max(v1._id, v2._id);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"screenborder-x\",\r\n      style  : \"screenborder\"\r\n    };\r\n  }\r\n\r\n  otherVertex(v) {\r\n    if (v === this.v1)\r\n      return this.v2;\r\n    else\r\n      return this.v1;\r\n  }\r\n\r\n  setCSS() {\r\n    this.style[\"pointer-events\"] = this.movable ? \"auto\" : \"none\";\r\n\r\n    if (this._style === undefined) {\r\n      this._style = document.createElement(\"style\");\r\n      this.appendChild(this._style);\r\n    }\r\n\r\n    let dpi = UIBase.getDPI();\r\n\r\n    let pad = this.getDefault(\"mouse-threshold\") / dpi;\r\n    let wid = this.getDefault(\"border-width\");\r\n\r\n    let v1 = this.v1, v2 = this.v2;\r\n    let vec = new Vector2(v2).sub(v1);\r\n\r\n    let x = Math.min(v1[0], v2[0]), y = Math.min(v1[1], v2[1]);\r\n    let w, h;\r\n    let cursor, bstyle;\r\n\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"display\"] = this.horiz ? \"row\" : \"column\";\r\n    this.style[\"justify-content\"] = \"center\";\r\n    this.style[\"align-items\"] = \"center\";\r\n\r\n    if (!this.horiz) {\r\n      this.style[\"padding-left\"] = this.style[\"padding-right\"] = pad + \"px\";\r\n      x -= wid*0.5 + pad;\r\n\r\n      w = wid*2;\r\n      h = Math.abs(vec[1]);\r\n\r\n      cursor = 'e-resize';\r\n      bstyle = \"border-left-style : solid;\\n    border-right-style : solid;\\n\";\r\n      bstyle = \"border-top-style : none;\\n    border-bottom-style : none;\\n\";\r\n    } else {\r\n      this.style[\"padding-top\"] = this.style[\"padding-bottom\"] = pad + \"px\";\r\n      y -= wid*0.5 + pad;\r\n\r\n      w = Math.abs(vec[0]);\r\n      h = wid;\r\n\r\n      cursor = 'n-resize';\r\n      bstyle = \"border-top-style : solid;\\n    border-bottom-style : solid;\\n\";\r\n    }\r\n\r\n\r\n    let color = this.getDefault(\"border-outer\");\r\n    let debug = cconst.DEBUG.screenborders;\r\n\r\n    if (debug) {\r\n      wid = 4;\r\n      let alpha = 1.0;\r\n      let c = this.sareas.length*75;\r\n\r\n      let r = 0, g = 0, b = 0;\r\n\r\n      if (this.movable) {\r\n        b = 255;\r\n      }\r\n      if (this.halfedges.length > 1) {\r\n        g = 255;\r\n      }\r\n      if (this.outer) {\r\n        r = 255;\r\n      }\r\n      color = `rgba(${r}, ${g}, ${b}, ${alpha})`;\r\n    }\r\n\r\n\r\n    let innerbuf = `\r\n        .screenborder_inner_${this._id} {\r\n          ${bstyle}\r\n          ${this.horiz ? 'height' : 'width'} : ${wid}px;\r\n          ${!this.horiz ? 'height' : 'width'} : 100%;\r\n          margin : 0px;\r\n          padding : 0px;\r\n          \r\n          background-color : ${this.getDefault(\"border-inner\")};\r\n          border-color : ${color};\r\n          border-width : ${wid*0.5}px;\r\n          border-style : ${debug && this.outer ? \"dashed\" : \"solid\"};\r\n          pointer-events : none;\r\n        }`;\r\n\r\n    let sbuf = `\r\n        .screenborder_${this._id} {\r\n        }\r\n    `;\r\n\r\n    let ok = this.movable;\r\n    if (!this.outer) {\r\n      for (let sarea of this.sareas) {\r\n        ok = ok || sarea.floating;\r\n      }\r\n    }\r\n\r\n    if (ok) {\r\n      sbuf += `\r\n        .screenborder_${this._id}:hover {\r\n          cursor : ${cursor};\r\n        }\r\n      `;\r\n    }\r\n\r\n    this._style.textContent = sbuf;\r\n    this._innerstyle.textContent = innerbuf;\r\n\r\n    this.setAttribute(\"class\", \"screenborder_\" + this._id);\r\n    this.inner.setAttribute(\"class\", \"screenborder_inner_\" + this._id);\r\n\r\n    this.style[\"position\"] = UIBase.PositionKey;\r\n    this.style[\"left\"] = x + \"px\";\r\n    this.style[\"top\"] = y + \"px\";\r\n    this.style[\"width\"] = w + \"px\";\r\n    this.style[\"height\"] = h + \"px\";\r\n    this.style[\"z-index\"] = \"\" + BORDER_ZINDEX_BASE;\r\n  }\r\n\r\n  valueOf() {\r\n    return ScreenBorder.hash(this.v1, this.v2);\r\n  }\r\n\r\n  [Symbol.keystr]() {\r\n    return ScreenBorder.hash(this.v1, this.v2);\r\n  }\r\n}\r\n\r\nui_base.UIBase.internalRegister(ScreenBorder);\r\n","let _ScreenArea = undefined;\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as ui from '../core/ui.js';\r\nimport * as ui_noteframe from '../widgets/ui_noteframe.js';\r\nimport {haveModal} from '../path-controller/util/simple_events.js';\r\nimport cconst from '../config/const.js';\r\n\r\nimport nstructjs from '../path-controller/util/struct.js';\r\n\r\nlet UIBase = ui_base.UIBase;\r\n\r\nimport {EnumProperty} from \"../path-controller/toolsys/toolprop.js\";\r\n\r\nlet Vector2 = vectormath.Vector2;\r\nlet Screen = undefined;\r\n\r\nimport {BORDER_ZINDEX_BASE, ScreenBorder, snap, snapi} from './FrameManager_mesh.js';\r\n\r\nexport const AreaFlags = {\r\n  HIDDEN                : 1,\r\n  FLOATING              : 2,\r\n  INDEPENDENT           : 4, //area is indpendent of the screen mesh\r\n  NO_SWITCHER           : 8,\r\n  NO_HEADER_CONTEXT_MENU: 16,\r\n  NO_COLLAPSE           : 32,\r\n};\r\n\r\n\r\nexport * from './area_wrangler.js';\r\nimport {getAreaIntName, setAreaTypes, contextWrangler, AreaWrangler, areaclasses} from './area_wrangler.js';\r\n\r\nexport {contextWrangler};\r\n\r\nwindow._contextWrangler = contextWrangler;\r\n\r\nexport const BorderMask = {\r\n  LEFT  : 1,\r\n  BOTTOM: 2,\r\n  RIGHT : 4,\r\n  TOP   : 8,\r\n  ALL   : 1 | 2 | 4 | 8\r\n};\r\n\r\nexport const BorderSides = {\r\n  LEFT  : 0,\r\n  BOTTOM: 1,\r\n  RIGHT : 2,\r\n  TOP   : 3\r\n};\r\n\r\n/**\r\n * Base class for all editors\r\n **/\r\nexport class Area extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    /**\r\n     * -----b4----\r\n     *\r\n     * b1       b3\r\n     *\r\n     * -----b2----\r\n     *\r\n     * */\r\n\r\n    let def = this.constructor.define();\r\n\r\n    //set bits in mask to keep\r\n    //borders from moving\r\n    this.borderLock = def.borderLock || 0;\r\n    this.flag = def.flag || 0;\r\n\r\n    this.inactive = true;\r\n    this.areaDragToolEnabled = true;\r\n\r\n    this.owning_sarea = undefined;\r\n    this._area_id = contextWrangler.idgen++;\r\n\r\n    this.pos = undefined; //set by screenarea parent\r\n    this.size = undefined; //set by screenarea parent\r\n    this.minSize = [5, 5];\r\n    this.maxSize = [undefined, undefined];\r\n\r\n    let appendChild = this.shadow.appendChild;\r\n    this.shadow.appendChild = (child) => {\r\n      appendChild.call(this.shadow, child);\r\n      if (child instanceof UIBase) {\r\n        child.parentWidget = this;\r\n      }\r\n    }\r\n\r\n    let prepend = this.shadow.prepend;\r\n    this.shadow.prepend = (child) => {\r\n      prepend.call(this.shadow, child);\r\n\r\n      if (child instanceof UIBase) {\r\n        child.parentWidget = this;\r\n      }\r\n    };\r\n  }\r\n\r\n  get floating() {\r\n    return ~~(this.flag & AreaFlags.FLOATING);\r\n  }\r\n\r\n  set floating(val) {\r\n    if (val) {\r\n      this.flag |= AreaFlags.FLOATING;\r\n    } else {\r\n      this.flag &= ~AreaFlags.FLOATING;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get active area as defined by push_ctx_active and pop_ctx_active.\r\n   *\r\n   * Type should be an Area subclass, if undefined the last accessed area\r\n   * will be returned.\r\n   * */\r\n  static getActiveArea(type) {\r\n    return contextWrangler.getLastArea(type);\r\n  }\r\n\r\n  static unregister(cls) {\r\n    let def = cls.define();\r\n\r\n    if (!def.areaname) {\r\n      throw new Error(\"Missing areaname key in define()\");\r\n    }\r\n\r\n    if (def.areaname in areaclasses) {\r\n      delete areaclasses[def.areaname];\r\n    }\r\n  }\r\n\r\n  /*\r\n  addEventListener(type, cb, options) {\r\n    let cb2 = (e) => {\r\n      let x, y;\r\n      let screen = this.getScreen();\r\n\r\n      if (!screen) {\r\n        console.warn(\"no screen!\");\r\n        return cb(elem);\r\n      }\r\n\r\n      if (type.startsWith(\"mouse\")) {\r\n        x = e.x; y = e.y;\r\n      } else if (type.startsWith(\"touch\") && e.touches && e.touches.length > 0) {\r\n        x = e.touches[0].pageX; y = e.touches[0].pageY;\r\n      } else if (type.startsWith(\"pointer\")) {\r\n        x = e.x; y = e.y;\r\n      } else {\r\n        if (screen) {\r\n          x = screen.mpos[0];\r\n          y = screen.mpos[1];\r\n        } else {\r\n          x = y = -100;\r\n        }\r\n      }\r\n\r\n      let elem = screen.pickElement(x, y);\r\n      console.log(elem ? elem.tagName : undefined);\r\n\r\n      if (elem === this || elem === this.owning_sarea) {\r\n        return cb(elem);\r\n      }\r\n    };\r\n\r\n    cb.__cb2 = cb2;\r\n    return super.addEventListener(type, cb2, options);\r\n  }\r\n\r\n  removeEventListener(type, cb, options) {\r\n    super.removeEventListener(type, cb.__cb2, options);\r\n  }\r\n  //*/\r\n\r\n  static register(cls) {\r\n    let def = cls.define();\r\n\r\n    if (!def.areaname) {\r\n      throw new Error(\"Missing areaname key in define()\");\r\n    }\r\n\r\n    areaclasses[def.areaname] = cls;\r\n\r\n    ui_base.UIBase.internalRegister(cls);\r\n  }\r\n\r\n  static makeAreasEnum() {\r\n    let areas = {};\r\n    let icons = {};\r\n    let i = 0;\r\n\r\n    for (let k in areaclasses) {\r\n      let cls = areaclasses[k];\r\n      let def = cls.define();\r\n\r\n      if (def.flag & AreaFlags.HIDDEN)\r\n        continue;\r\n\r\n      let uiname = def.uiname;\r\n\r\n      if (uiname === undefined) {\r\n        uiname = k.replace(\"_\", \" \").toLowerCase();\r\n        uiname = uiname[0].toUpperCase() + uiname.slice(1, uiname.length);\r\n      }\r\n\r\n      areas[uiname] = k;\r\n      icons[uiname] = def.icon !== undefined ? def.icon : -1;\r\n    }\r\n\r\n    let prop = new EnumProperty(undefined, areas);\r\n    prop.addIcons(icons);\r\n\r\n    return prop;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname : \"pathux-editor-x\", // tag name, e.g. editor-x\r\n      areaname: undefined, //api name for area type\r\n      flag    : 0, //see AreaFlags\r\n      uiname  : undefined,\r\n      icon    : undefined //icon representing area in MakeHeader's area switching menu. Integer.\r\n    };\r\n  }\r\n\r\n  static newSTRUCT() {\r\n    return UIBase.createElement(this.define().tagname);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"overflow\"] = \"hidden\";\r\n    this.noMarginsOrPadding();\r\n\r\n    let onover = (e) => {\r\n      //console.log(this._area_id, this.ctx.workspace._area_id);\r\n\r\n      //try to trigger correct entry in context area stacks\r\n      this.push_ctx_active();\r\n      this.pop_ctx_active();\r\n    };\r\n\r\n    //*\r\n    super.addEventListener(\"mouseover\", onover, {passive: true});\r\n    super.addEventListener(\"mousemove\", onover, {passive: true});\r\n    super.addEventListener(\"mousein\", onover, {passive: true});\r\n    super.addEventListener(\"mouseenter\", onover, {passive: true});\r\n    super.addEventListener(\"touchstart\", onover, {passive: true});\r\n    super.addEventListener(\"focusin\", onover, {passive: true});\r\n    super.addEventListener(\"focus\", onover, {passive: true});\r\n    //*/\r\n  }\r\n\r\n  _get_v_suffix() {\r\n    if (this.flag & AreaFlags.INDEPENDENT) {\r\n      return this._id;\r\n    } else {\r\n      return \"\";\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Return a list of keymaps used by this editor\r\n   * @returns {Array<KeyMap>}\r\n   */\r\n  getKeyMaps() {\r\n    return this.keymap !== undefined ? [this.keymap] : [];\r\n  }\r\n\r\n  on_fileload(isActiveEditor) {\r\n    contextWrangler.reset();\r\n  }\r\n\r\n  buildDataPath() {\r\n    let p = this;\r\n\r\n    let sarea = this.owning_sarea;\r\n\r\n    if (sarea === undefined || sarea.screen === undefined) {\r\n      console.warn(\"Area.buildDataPath(): Failed to build data path\");\r\n      return \"\";\r\n    }\r\n\r\n    let screen = sarea.screen;\r\n\r\n    let idx1 = screen.sareas.indexOf(sarea);\r\n    let idx2 = sarea.editors.indexOf(this);\r\n\r\n    if (idx1 < 0 || idx2 < 0) {\r\n      throw new Error(\"malformed area data\");\r\n    }\r\n\r\n    let ret = `screen.sareas[${idx1}].editors[${idx2}]`;\r\n    return ret;\r\n  }\r\n\r\n  saveData() {\r\n    return {\r\n      _area_id: this._area_id,\r\n      areaName: this.areaName\r\n    };\r\n  }\r\n\r\n  loadData(obj) {\r\n    let id = obj._area_id;\r\n\r\n    if (id !== undefined && id !== null) {\r\n      this._area_id = id;\r\n    }\r\n  }\r\n\r\n  draw() {\r\n  }\r\n\r\n  copy() {\r\n    console.warn(\"You might want to implement this, Area.prototype.copy based method called\");\r\n    let ret = UIBase.createElement(this.constructor.define().tagname);\r\n    return ret;\r\n  }\r\n\r\n  on_resize(size, oldsize) {\r\n    super.on_resize(size, oldsize);\r\n  }\r\n\r\n  on_area_focus() {\r\n\r\n  }\r\n\r\n  on_area_blur() {\r\n\r\n  }\r\n\r\n  /** called when editors are swapped with another editor type*/\r\n  on_area_active() {\r\n  }\r\n\r\n  /** called when editors are swapped with another editor type*/\r\n  on_area_inactive() {\r\n  }\r\n\r\n  /*\r\n  * This is needed so UI controls can know what their parent area is.\r\n  * For example, a slider with data path \"view2d.zoomfac\" needs to know where\r\n  * to find view2d.\r\n  *\r\n  * Typically this works by adding a field to a ContextOverlay:\r\n  *\r\n  * class ContextOverlay {\r\n  *   get view3d() {\r\n  *     return Area.getActiveArea(View3D);\r\n  *   }\r\n  * }\r\n  *\r\n  * Make sure to wrap event callbacks in push_ctx_active and pop_ctx_active.\r\n  * */\r\n  push_ctx_active(dontSetLastRef = false) {\r\n    contextWrangler.push(this.constructor, this, !dontSetLastRef);\r\n  }\r\n\r\n  /**\r\n   * see push_ctx_active\r\n   * */\r\n  pop_ctx_active(dontSetLastRef = false) {\r\n    contextWrangler.pop(this.constructor, this, !dontSetLastRef);\r\n  }\r\n\r\n  getScreen() {\r\n    //XXX\r\n    //return _appstate.screen;\r\n    throw new Error(\"replace me in Area.prototype\");\r\n  }\r\n\r\n  toJSON() {\r\n    return Object.assign(super.toJSON(), {\r\n      areaname: this.constructor.define().areaname,\r\n      _area_id: this._area_id\r\n    });\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n    this._area_id = obj._area_id;\r\n\r\n    return this;\r\n  }\r\n\r\n  getBarHeight() {\r\n    return this.header.getClientRects()[0].height;\r\n  }\r\n\r\n  makeAreaSwitcher(container) {\r\n    if (cconst.useAreaTabSwitcher) {\r\n      let ret = UIBase.createElement(\"area-docker-x\");\r\n      container.add(ret);\r\n      return ret;\r\n    }\r\n\r\n    let prop = Area.makeAreasEnum();\r\n\r\n    let dropbox = container.listenum(undefined, {\r\n      name    : this.constructor.define().uiname,\r\n      enumDef : prop,\r\n      callback: (id) => {\r\n        let cls = areaclasses[id];\r\n        this.owning_sarea.switch_editor(cls);\r\n      }\r\n    });\r\n\r\n    dropbox.update.after(() => {\r\n      let name = this.constructor.define().uiname;\r\n      let val = prop.values[name];\r\n\r\n      if (dropbox.value !== val && val in prop.keys) {\r\n        val = prop.keys[val];\r\n      }\r\n\r\n      if (dropbox.value !== val) {\r\n        dropbox.setValue(prop.values[name], true);\r\n      }\r\n    });\r\n\r\n    return dropbox;\r\n  }\r\n\r\n  makeHeader(container, add_note_area = true, make_draggable = true) {\r\n    let switcherRow;\r\n    let row;\r\n    let helpRow;\r\n\r\n    if (!(this.flag & AreaFlags.NO_SWITCHER) && cconst.useAreaTabSwitcher) {\r\n      let col = this.header = container.col();\r\n\r\n      switcherRow = helpRow = col.row();\r\n      row = col.row();\r\n    } else {\r\n      row = helpRow = this.header = container.row();\r\n    }\r\n\r\n    if (!(this.flag & AreaFlags.NO_HEADER_CONTEXT_MENU)) {\r\n      let callmenu = ScreenBorder.bindBorderMenu(this.header, true);\r\n\r\n      this.addEventListener(\"mousedown\", e => {\r\n        if (e.button !== 2 || this.header.pickElement(e.x, e.y) !== this.header) {\r\n          return;\r\n        }\r\n\r\n        callmenu(e);\r\n      });\r\n    }\r\n\r\n    this.header.remove();\r\n    container._prepend(this.header);\r\n\r\n    row.setCSS.after(() => row.background = this.getDefault(\"AreaHeaderBG\"));\r\n\r\n    let rh = ~~(16*this.getDPI());\r\n\r\n    //container.setSize(undefined, rh);\r\n    //row.setSize(undefined, rh);\r\n    //row.setSize(undefined, rh);\r\n\r\n    container.noMarginsOrPadding();\r\n    row.noMarginsOrPadding();\r\n\r\n    row.style[\"width\"] = \"100%\";\r\n    row.style[\"margin\"] = \"0px\";\r\n    row.style[\"padding\"] = \"0px\";\r\n\r\n    if (!(this.flag & AreaFlags.NO_SWITCHER)) {\r\n      if (this.switcher) {\r\n        //add back same switcher\r\n        switcherRow.add(this.switcher);\r\n      } else {\r\n        this.switcher = this.makeAreaSwitcher(cconst.useAreaTabSwitcher ? switcherRow : row);\r\n      }\r\n    }\r\n\r\n    if (util.isMobile() || cconst.addHelpPickers) {\r\n      if (this.helppicker) {\r\n        this.helppicker.remove();\r\n      }\r\n\r\n      this.helppicker = helpRow.helppicker();\r\n      this.helppicker.iconsheet = 0;\r\n    }\r\n\r\n    if (add_note_area) {\r\n      let notef = UIBase.createElement(\"noteframe-x\");\r\n      notef.ctx = this.ctx;\r\n      row._add(notef);\r\n    }\r\n\r\n    /* don't do normal dragging for tab switchers */\r\n    if (cconst.useAreaTabSwitcher) {\r\n      return row;\r\n    }\r\n\r\n    let eventdom = this.header;\r\n\r\n    let mdown = false;\r\n    let mpos = new Vector2();\r\n\r\n    let mpre = (e, pageX, pageY) => {\r\n      if (haveModal()) {\r\n        return;\r\n      }\r\n\r\n      pageX = pageX === undefined ? e.x : pageX;\r\n      pageY = pageY === undefined ? e.y : pageY;\r\n\r\n      let node = this.getScreen().pickElement(pageX, pageY);\r\n\r\n      /*\r\n      while (node) {\r\n        if (node === row) {\r\n          break;\r\n        }\r\n        node = node.parentWidget;\r\n      }//*/\r\n\r\n      //console.log(node === row, node ? node._id : undefined, row._id)\r\n\r\n      if (node !== row) {\r\n        return false;\r\n      }\r\n\r\n      return true;\r\n    }\r\n\r\n    eventdom.addEventListener(\"pointerout\", (e) => {\r\n      //console.log(\"pointerout\", e);\r\n      mdown = false;\r\n    });\r\n    eventdom.addEventListener(\"pointerleave\", (e) => {\r\n      mdown = false;\r\n      //console.log(\"pointerleave\", e);\r\n    });\r\n\r\n    eventdom.addEventListener(\"pointerdown\", (e) => {\r\n      //console.log(\"pointerdown\", e, mpre(e));\r\n\r\n      if (!mpre(e)) return;\r\n\r\n      mpos[0] = e.pageX;\r\n      mpos[1] = e.pageY;\r\n      mdown = true;\r\n    });\r\n\r\n    let last_time = util.time_ms();\r\n\r\n    let do_mousemove = (e, pageX, pageY) => {\r\n      if (haveModal() || !make_draggable) {\r\n        return;\r\n      }\r\n\r\n      let mdown2 = e.buttons !== 0 || (e.touches && e.touches.length > 0);\r\n      mdown2 = mdown2 && mdown;\r\n\r\n      //console.log(\"area drag?\", e, mdown2, e.pageX, e.pageY, mpre(e, pageX, pageY), e.was_touch);\r\n\r\n      //calls to pickElement in mpre are expensive\r\n      if (util.time_ms() - last_time < 250) {\r\n        return;\r\n      }\r\n\r\n      last_time = util.time_ms;\r\n\r\n      if (!mdown2 || !mpre(e, pageX, pageY)) return;\r\n\r\n\r\n      if (e.type === \"mousemove\" && e.was_touch) {\r\n        //okay how are patched events getting here?\r\n        //avoid double call. . .\r\n        return;\r\n      }\r\n\r\n      //console.log(mdown);\r\n      let dx = pageX - mpos[0];\r\n      let dy = pageY - mpos[1];\r\n\r\n      let dis = dx*dx + dy*dy;\r\n      let limit = 7;\r\n\r\n      if (dis > limit*limit) {\r\n        let sarea = this.owning_sarea;\r\n        if (sarea === undefined) {\r\n          console.warn(\"Error: missing sarea ref\");\r\n          return;\r\n        }\r\n\r\n        let screen = sarea.screen;\r\n        if (screen === undefined) {\r\n          console.log(\"Error: missing screen ref\");\r\n          return;\r\n        }\r\n\r\n        if (!this.areaDragToolEnabled) {\r\n          return;\r\n        }\r\n        mdown = false;\r\n        console.log(\"area drag tool!\", e.type, e);\r\n        screen.areaDragTool(this.owning_sarea);\r\n      }\r\n    };\r\n\r\n    //not working on mobile\r\n    //row.setAttribute(\"draggable\", true);\r\n    //row.draggable = true;\r\n    /*\r\n    eventdom.addEventListener(\"dragstart\", (e) => {\r\n      return;\r\n      console.log(\"drag start!\", e);\r\n      e.dataTransfer.setData(\"text/json\", \"SplitAreaDrag\");\r\n\r\n      let canvas = document.createElement(\"canvas\");\r\n      let g = canvas.g;\r\n\r\n      canvas.width = 32;\r\n      canvas.height = 32;\r\n\r\n      e.dataTransfer.setDragImage(canvas, 0, 0);\r\n\r\n      mdown = false;\r\n      console.log(\"area drag tool!\");\r\n      this.getScreen().areaDragTool(this.owning_sarea);\r\n    });\r\n\r\n    eventdom.addEventListener(\"drag\", (e) => {\r\n      console.log(\"drag!\", e);\r\n    });*/\r\n\r\n    eventdom.addEventListener(\"pointermove\", (e) => {\r\n      return do_mousemove(e, e.pageX, e.pageY);\r\n    }, false);\r\n    eventdom.addEventListener(\"pointerup\", (e) => {\r\n      console.log(\"pointerup\", e);\r\n      mdown = false;\r\n    }, false);\r\n    eventdom.addEventListener(\"pointercancel\", (e) => {\r\n      console.log(\"pointercancel\", e);\r\n      mdown = false;\r\n    }, false);\r\n\r\n    return row;\r\n  }\r\n\r\n  setCSS() {\r\n    if (this.size !== undefined) {\r\n      this.style[\"position\"] = UIBase.PositionKey;\r\n      //this.style[\"left\"] = this.pos[0] + \"px\";\r\n      //this.style[\"top\"] = this.pos[1] + \"px\";\r\n      this.style[\"width\"] = this.size[0] + \"px\";\r\n      this.style[\"height\"] = this.size[1] + \"px\";\r\n    }\r\n  }\r\n\r\n  update() {\r\n    //don't update non-active editors\r\n    if (this.owning_sarea === undefined || this !== this.owning_sarea.area) {\r\n      return;\r\n    }\r\n\r\n    super.update();\r\n\r\n    //see FrameManager.js, we use a single update\r\n    //function for everything now\r\n    //this._forEachChildWidget((n) => {\r\n    //  n.update();\r\n    //});\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n  }\r\n\r\n  _isDead() {\r\n    if (this.dead) {\r\n      return true;\r\n    }\r\n\r\n    let screen = this.getScreen();\r\n\r\n    if (screen === undefined)\r\n      return true;\r\n\r\n    if (screen.parentNode === undefined)\r\n      return true;\r\n  }\r\n\r\n  //called by owning ScreenArea on file load\r\n  afterSTRUCT() {\r\n    let f = () => {\r\n      if (this._isDead()) {\r\n        return;\r\n      }\r\n      if (!this.ctx) {\r\n        this.doOnce(f);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        ui_base.loadUIData(this, this.saved_uidata);\r\n        this.saved_uidata = undefined;\r\n      } catch (error) {\r\n        console.log(\"failed to load ui data\");\r\n        util.print_stack(error);\r\n      }\r\n    };\r\n\r\n    this.doOnce(f);\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n  }\r\n\r\n  _getSavedUIData() {\r\n    return ui_base.saveUIData(this, \"area\");\r\n  }\r\n}\r\n\r\nArea.STRUCT = `\r\npathux.Area { \r\n  flag : int;\r\n  saved_uidata : string | obj._getSavedUIData();\r\n}\r\n`\r\n\r\nnstructjs.register(Area, \"pathux.Area\");\r\nui_base.UIBase.internalRegister(Area);\r\n\r\nexport class ScreenArea extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._flag = undefined;\r\n\r\n    this.flag = 0; /** holds AreaFlags.FLOATING and AreaFlags.INDEPENDENT */\r\n\r\n    this._borders = [];\r\n    this._verts = [];\r\n    this.dead = false;\r\n\r\n    this._sarea_id = contextWrangler.idgen++;\r\n\r\n    this._pos = new Vector2();\r\n    this._size = new Vector2([512, 512]);\r\n\r\n    if (cconst.DEBUG.screenAreaPosSizeAccesses) {\r\n      let wrapVector = (name, axis) => {\r\n        Object.defineProperty(this[name], axis, {\r\n          get: function () {\r\n            return this[\"_\" + axis];\r\n          },\r\n\r\n          set: function (val) {\r\n            console.warn(`ScreenArea.${name}[${axis}] set:`, val);\r\n            this[\"_\" + axis] = val;\r\n          }\r\n        });\r\n      };\r\n\r\n      wrapVector(\"size\", 0);\r\n      wrapVector(\"size\", 1);\r\n      wrapVector(\"pos\", 0);\r\n      wrapVector(\"pos\", 1);\r\n    }\r\n\r\n    this.area = undefined;\r\n    this.editors = [];\r\n    this.editormap = {};\r\n\r\n    this.addEventListener(\"mouseover\", (e) => {\r\n      if (haveModal()) {\r\n        return;\r\n      }\r\n\r\n      //console.log(\"screen area mouseover\");\r\n      let screen = this.getScreen();\r\n      if (screen.sareas.active !== this && screen.sareas.active && screen.sareas.active.area) {\r\n        screen.sareas.active.area.on_area_blur();\r\n      }\r\n\r\n      if (this.area && screen.sareas.active !== this) {\r\n        this.area.on_area_focus();\r\n      }\r\n\r\n      screen.sareas.active = this;\r\n    });\r\n\r\n    //this.addEventListener(\"mouseleave\", (e) => {\r\n    //console.log(\"screen area mouseleave\");\r\n    //});\r\n  }\r\n\r\n  /*\r\n  saveData() {\r\n    return {\r\n      _sarea_id : this._sarea_id,\r\n      pos       : this.pos,\r\n      size      : this.size,\r\n    };\r\n  }\r\n  loadData(obj) {\r\n    super.loadData(obj);\r\n\r\n    let id = obj._sarea_id;\r\n    \r\n    let type = obj.areatype;\r\n    \r\n    if (id !== undefined && id !== null) {\r\n      this._sarea_id = id;\r\n    }\r\n    \r\n    for (let area of this.editors) {\r\n      if (area.areaType == type) {\r\n        console.log(\"             found saved area type\");\r\n        \r\n        this.switch_editor(area.constructor);\r\n      }\r\n    }\r\n    \r\n    this.pos.load(obj.pos);\r\n    this.size.load(obj.size);\r\n  }//*/\r\n\r\n  get floating() {\r\n    return this.flag & AreaFlags.FLOATING;\r\n  }\r\n\r\n  set floating(val) {\r\n    if (val) {\r\n      this.flag |= AreaFlags.FLOATING;\r\n    } else {\r\n      this.flag &= ~AreaFlags.FLOATING;\r\n    }\r\n  }\r\n\r\n  get flag() {\r\n    let flag = this._flag & (AreaFlags.FLOATING | AreaFlags.INDEPENDENT);\r\n\r\n    if (this.area) {\r\n      flag |= this.area.flag;\r\n    }\r\n\r\n    return flag;\r\n  }\r\n\r\n  set flag(v) {\r\n    this._flag &= ~(AreaFlags.FLOATING | AreaFlags.INDEPENDENT);\r\n    this._flag |= v & (AreaFlags.FLOATING | AreaFlags.INDEPENDENT);\r\n\r\n    if (this.area) {\r\n      this.area.flag |= v & ~(AreaFlags.FLOATING | AreaFlags.INDEPENDENT);\r\n    }\r\n  }\r\n\r\n  get borderLock() {\r\n    return this.area !== undefined ? this.area.borderLock : 0;\r\n  }\r\n\r\n  get minSize() {\r\n    return this.area !== undefined ? this.area.minSize : this.size;\r\n  }\r\n\r\n  get maxSize() {\r\n    return this.area !== undefined ? this.area.maxSize : this.size;\r\n  }\r\n\r\n  get pos() {\r\n    return this._pos;\r\n  }\r\n\r\n  set pos(val) {\r\n    if (cconst.DEBUG.screenAreaPosSizeAccesses) {\r\n      console.log(\"ScreenArea set pos\", val);\r\n    }\r\n    this._pos.load(val);\r\n  }\r\n\r\n  get size() {\r\n    return this._size;\r\n  }\r\n\r\n  set size(val) {\r\n    if (cconst.DEBUG.screenAreaPosSizeAccesses) {\r\n      console.log(\"ScreenArea set size\", val);\r\n    }\r\n    this._size.load(val);\r\n  }\r\n\r\n  static newSTRUCT() {\r\n    return UIBase.createElement(\"screenarea-x\");\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"screenarea-x\"\r\n    };\r\n  }\r\n\r\n  _get_v_suffix() {\r\n    return this.area ? this.area._get_v_suffix() : \"\";\r\n  }\r\n\r\n  bringToFront() {\r\n    let screen = this.getScreen();\r\n\r\n    HTMLElement.prototype.remove.call(this);\r\n    screen.sareas.remove(this);\r\n\r\n    screen.appendChild(this);\r\n\r\n    let zindex = BORDER_ZINDEX_BASE + 1;\r\n\r\n    if (screen.style[\"z-index\"]) {\r\n      zindex = parseInt(screen.style[\"z-index\"]) + 1;\r\n    }\r\n\r\n    for (let sarea of screen.sareas) {\r\n      let zindex = sarea.style[\"z-index\"];\r\n      if (sarea.style[\"z-index\"]) {\r\n        zindex = Math.max(zindex, parseInt(sarea.style[\"z-index\"]) + 1);\r\n      }\r\n    }\r\n\r\n    this.style[\"z-index\"] = zindex;\r\n  }\r\n\r\n  _side(border) {\r\n    let ret = this._borders.indexOf(border);\r\n    if (ret < 0) {\r\n      throw new Error(\"border not in screen area\");\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.noMarginsOrPadding();\r\n  }\r\n\r\n  draw() {\r\n    if (this.area && this.area.draw) {\r\n      this.area.push_ctx_active();\r\n      this.area.draw();\r\n      this.area.pop_ctx_active();\r\n    }\r\n  }\r\n\r\n  _isDead() {\r\n    if (this.dead) {\r\n      return true;\r\n    }\r\n\r\n    let screen = this.getScreen();\r\n\r\n    if (screen === undefined)\r\n      return true;\r\n\r\n    if (screen.parentNode === undefined)\r\n      return true;\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = {\r\n      editors  : this.editors,\r\n      _sarea_id: this._sarea_id,\r\n      area     : this.area.constructor.define().areaname,\r\n      pos      : this.pos,\r\n      size     : this.size\r\n    };\r\n\r\n    return Object.assign(super.toJSON(), ret);\r\n  }\r\n\r\n  on_keydown(e) {\r\n    if (this.area.on_keydown) {\r\n      this.area.push_ctx_active();\r\n      this.area.on_keydown(e);\r\n      this.area.pop_ctx_active();\r\n    }\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    if (obj === undefined) {\r\n      console.warn(\"undefined in loadJSON\");\r\n      return;\r\n    }\r\n\r\n    super.loadJSON(obj);\r\n\r\n    this.pos.load(obj.pos);\r\n    this.size.load(obj.size);\r\n\r\n    for (let editor of obj.editors) {\r\n      let areaname = editor.areaname;\r\n\r\n      //console.log(editor);\r\n\r\n      let tagname = areaclasses[areaname].define().tagname;\r\n      let area = UIBase.createElement(tagname);\r\n\r\n      area.owning_sarea = this;\r\n      this.editormap[areaname] = area;\r\n      this.editors.push(this.editormap[areaname]);\r\n\r\n      area.pos = new Vector2(obj.pos);\r\n      area.size = new Vector2(obj.size);\r\n      area.ctx = this.ctx;\r\n\r\n      area.inactive = true;\r\n      area.loadJSON(editor);\r\n      area.owning_sarea = undefined;\r\n\r\n      if (areaname === obj.area) {\r\n        this.area = area;\r\n      }\r\n    }\r\n\r\n    if (this.area !== undefined) {\r\n      this.area.ctx = this.ctx;\r\n      this.area.style[\"width\"] = \"100%\";\r\n      this.area.style[\"height\"] = \"100%\";\r\n      this.area.owning_sarea = this;\r\n      this.area.parentWidget = this;\r\n\r\n      this.area.pos = this.pos;\r\n      this.area.size = this.size;\r\n\r\n      this.area.inactive = false;\r\n      this.shadow.appendChild(this.area);\r\n      this.area.on_area_active();\r\n      this.area.onadd();\r\n    }\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  _ondestroy() {\r\n    super._ondestroy();\r\n\r\n    this.dead = true;\r\n\r\n    for (let editor of this.editors) {\r\n      if (editor === this.area) continue;\r\n\r\n      editor._ondestroy();\r\n    }\r\n  }\r\n\r\n  getScreen() {\r\n    if (this.screen !== undefined) {\r\n      return this.screen;\r\n    }\r\n\r\n    //try to walk up graph, if possible\r\n    let p = this.parentNode;\r\n    let _i = 0;\r\n\r\n    while (p && !(p instanceof Screen) && p !== p.parentNode) {\r\n      p = this.parentNode;\r\n\r\n      if (_i++ > 1000) {\r\n        console.warn(\"infinite loop detected in ScreenArea.prototype.getScreen()\");\r\n        return undefined;\r\n      }\r\n    }\r\n\r\n    return p && p instanceof Screen ? p : undefined;\r\n  }\r\n\r\n  copy(screen) {\r\n    let ret = UIBase.createElement(\"screenarea-x\");\r\n\r\n    ret.screen = screen;\r\n    ret.ctx = this.ctx;\r\n\r\n    ret.pos[0] = this.pos[0];\r\n    ret.pos[1] = this.pos[1];\r\n\r\n    ret.size[0] = this.size[0];\r\n    ret.size[1] = this.size[1];\r\n\r\n    for (let area of this.editors) {\r\n      let cpy = area.copy();\r\n\r\n      cpy.ctx = this.ctx;\r\n\r\n      cpy.parentWidget = ret;\r\n      ret.editors.push(cpy);\r\n      ret.editormap[cpy.constructor.define().areaname] = cpy;\r\n\r\n      if (area === this.area) {\r\n        ret.area = cpy;\r\n      }\r\n    }\r\n\r\n    //console.trace(\"RET.AREA\", this.area, ret.area);\r\n\r\n    ret.ctx = this.ctx;\r\n\r\n    if (ret.area !== undefined) {\r\n      ret.area.ctx = this.ctx;\r\n\r\n      ret.area.pos = ret.pos;\r\n      ret.area.size = ret.size;\r\n      ret.area.owning_sarea = ret;\r\n      ret.area.parentWidget = ret;\r\n\r\n      ret.shadow.appendChild(ret.area);\r\n      //ret.area.onadd();\r\n\r\n      if (ret.area._init_done) {\r\n        ret.area.push_ctx_active();\r\n        ret.area.on_area_active();\r\n        ret.area.pop_ctx_active();\r\n      } else {\r\n        ret.doOnce(() => {\r\n          if (this.dead) {\r\n            return;\r\n          }\r\n          ret._init();\r\n          ret.area._init();\r\n          ret.area.push_ctx_active();\r\n          ret.area.on_area_active();\r\n          ret.area.pop_ctx_active();\r\n        });\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  snapToScreenSize() {\r\n    let screen = this.getScreen();\r\n    let co = new Vector2();\r\n    let changed = 0;\r\n\r\n    for (let v of this._verts) {\r\n      co.load(v);\r\n\r\n      v[0] = Math.min(Math.max(v[0], 0), screen.size[0]);\r\n      v[1] = Math.min(Math.max(v[1], 0), screen.size[1]);\r\n\r\n      if (co.vectorDistance(v) > 0.1) {\r\n        changed = 1;\r\n      }\r\n    }\r\n\r\n    if (changed) {\r\n      this.loadFromVerts();\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Sets screen verts from pos/size\r\n   * */\r\n  loadFromPosSize() {\r\n    if (this.floating && this._verts.length > 0) {\r\n      let p = this.pos, s = this.size;\r\n\r\n      this._verts[0].loadXY(p[0], p[1]);\r\n      this._verts[1].loadXY(p[0], p[1] + s[1]);\r\n      this._verts[2].loadXY(p[0] + s[0], p[1] + s[1]);\r\n      this._verts[3].loadXY(p[0] + s[0], p[1]);\r\n\r\n      for (let border of this._borders) {\r\n        border.setCSS();\r\n      }\r\n\r\n      this.setCSS();\r\n      return;\r\n    }\r\n\r\n    let screen = this.getScreen();\r\n    if (!screen) return;\r\n\r\n    for (let b of this._borders) {\r\n      screen.freeBorder(b);\r\n    }\r\n\r\n    this.makeBorders(screen);\r\n    this.setCSS();\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Sets pos/size from screen verts\r\n   * */\r\n  loadFromVerts() {\r\n    if (this._verts.length == 0) {\r\n      return;\r\n    }\r\n\r\n    let min = new Vector2([1e17, 1e17]);\r\n    let max = new Vector2([-1e17, -1e17]);\r\n\r\n    for (let v of this._verts) {\r\n      min.min(v);\r\n      max.max(v);\r\n    }\r\n\r\n    this.pos[0] = min[0];\r\n    this.pos[1] = min[1];\r\n\r\n    this.size[0] = max[0] - min[0];\r\n    this.size[1] = max[1] - min[1];\r\n\r\n    this.setCSS();\r\n    return this;\r\n  }\r\n\r\n  on_resize(size, oldsize) {\r\n    super.on_resize(size, oldsize);\r\n\r\n    if (this.area !== undefined) {\r\n      this.area.on_resize(size, oldsize);\r\n    }\r\n  }\r\n\r\n  makeBorders(screen) {\r\n    this._borders.length = 0;\r\n    this._verts.length = 0;\r\n\r\n    let p = this.pos, s = this.size;\r\n\r\n    //s = snapi(new Vector2(s));\r\n\r\n    let vs = [\r\n      new Vector2([p[0], p[1]]),\r\n      new Vector2([p[0], p[1] + s[1]]),\r\n      new Vector2([p[0] + s[0], p[1] + s[1]]),\r\n      new Vector2([p[0] + s[0], p[1]])\r\n    ];\r\n\r\n    let floating = this.floating;\r\n\r\n    for (let i = 0; i < vs.length; i++) {\r\n      vs[i] = snap(vs[i]);\r\n      vs[i] = screen.getScreenVert(vs[i], i, floating);\r\n      this._verts.push(vs[i]);\r\n    }\r\n\r\n    for (let i = 0; i < vs.length; i++) {\r\n      let v1 = vs[i], v2 = vs[(i + 1)%vs.length];\r\n\r\n      let b = screen.getScreenBorder(this, v1, v2, i);\r\n\r\n\r\n      for (let j = 0; j < 2; j++) {\r\n        let v = j ? b.v2 : b.v1;\r\n\r\n        if (v.sareas.indexOf(this) < 0) {\r\n          v.sareas.push(this);\r\n        }\r\n      }\r\n\r\n      if (b.sareas.indexOf(this) < 0) {\r\n        b.sareas.push(this);\r\n      }\r\n\r\n      this._borders.push(b);\r\n\r\n      b.movable = screen.isBorderMovable(b);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  setCSS() {\r\n    this.style[\"position\"] = UIBase.PositionKey;\r\n\r\n    this.style[\"left\"] = this.pos[0] + \"px\";\r\n    this.style[\"top\"] = this.pos[1] + \"px\";\r\n\r\n    this.style[\"width\"] = this.size[0] + \"px\";\r\n    this.style[\"height\"] = this.size[1] + \"px\";\r\n    \r\n    this.style[\"overflow\"] = \"hidden\";\r\n    this.style[\"contain\"] = \"layout\"; //ensure we have a new positioning stack\r\n\r\n    if (this.area !== undefined) {\r\n      this.area.setCSS();\r\n    }\r\n  }\r\n\r\n  appendChild(child) {\r\n    if (child instanceof Area) {\r\n      let def = child.constructor.define();\r\n      let existing = this.editormap[def.areaname];\r\n\r\n      if (existing && existing !== child) {\r\n        console.warn(\"Warning, replacing an exising editor instance\", child, existing);\r\n\r\n        if (this.area === existing) {\r\n          this.area = child;\r\n        }\r\n\r\n        existing.remove();\r\n        this.editormap[def.areaname] = child;\r\n      }\r\n\r\n      child.ctx = this.ctx;\r\n      child.pos = this.pos;\r\n      child.size = this.size;\r\n\r\n      if (this.editors.indexOf(child) < 0) {\r\n        this.editors.push(child);\r\n      }\r\n\r\n      child.owning_sarea = undefined;\r\n      if (this.area === undefined) {\r\n        this.area = child;\r\n      }\r\n    }\r\n\r\n    super.appendChild(child);\r\n\r\n    if (child instanceof ui_base.UIBase) {\r\n      child.parentWidget = this;\r\n      child.onadd();\r\n    }\r\n  }\r\n\r\n  switch_editor(cls) {\r\n    return this.switchEditor(cls);\r\n  }\r\n\r\n  switchEditor(cls) {\r\n    let def = cls.define();\r\n    let name = def.areaname;\r\n\r\n    //areaclasses[name]\r\n    if (!(name in this.editormap)) {\r\n      this.editormap[name] = UIBase.createElement(def.tagname);\r\n      this.editormap[name].ctx = this.ctx;\r\n      this.editormap[name].parentWidget = this;\r\n      this.editormap[name].owning_sarea = this;\r\n      this.editormap[name].inactive = false;\r\n\r\n      this.editors.push(this.editormap[name]);\r\n    }\r\n\r\n    //var finish = () => {\r\n    if (this.area) {\r\n      //break direct pos/size references for old active area\r\n      this.area.pos = new Vector2(this.area.pos);\r\n      this.area.size = new Vector2(this.area.size);\r\n\r\n      this.area.owning_sarea = undefined;\r\n      this.area.inactive = true;\r\n      this.area.push_ctx_active();\r\n      this.area._init(); //check that init was called\r\n      this.area.on_area_inactive();\r\n      this.area.pop_ctx_active();\r\n\r\n      this.area.remove();\r\n    } else {\r\n      this.area = undefined;\r\n    }\r\n\r\n    this.area = this.editormap[name];\r\n\r\n    this.area.inactive = false;\r\n    this.area.parentWidget = this;\r\n\r\n    //. . .and set references to pos/size\r\n    this.area.pos = this.pos;\r\n    this.area.size = this.size;\r\n    this.area.owning_sarea = this;\r\n    this.area.ctx = this.ctx;\r\n\r\n    this.area.packflag |= this.packflag;\r\n\r\n    this.shadow.appendChild(this.area);\r\n\r\n    this.area.style[\"width\"] = \"100%\";\r\n    this.area.style[\"height\"] = \"100%\";\r\n\r\n    //propegate new size\r\n    this.area.push_ctx_active();\r\n    this.area._init(); //check that init was called\r\n    this.area.on_resize(this.size, this.size);\r\n    this.area.pop_ctx_active();\r\n\r\n    this.area.push_ctx_active();\r\n    this.area.on_area_active();\r\n    this.area.pop_ctx_active();\r\n\r\n    this.regenTabOrder();\r\n    //}\r\n  }\r\n\r\n  _checkWrangler() {\r\n    if (this.ctx)\r\n      contextWrangler._checkWrangler(this.ctx);\r\n  }\r\n\r\n  update() {\r\n    this._checkWrangler();\r\n\r\n    super.update();\r\n\r\n    //flag client controller implementation that\r\n    //this area is active for its type\r\n    if (this.area !== undefined) {\r\n      this.area.owning_sarea = this;\r\n      this.area.parentWidget = this;\r\n      this.area.size = this.size;\r\n      this.area.pos = this.pos;\r\n\r\n      let screen = this.getScreen();\r\n      let oldsize = [this.size[0], this.size[1]];\r\n\r\n      let moved = screen ? screen.checkAreaConstraint(this, true) : 0;\r\n      //*\r\n      if (moved) {\r\n        if (cconst.DEBUG.areaConstraintSolver) {\r\n          console.log(\"screen constraint solve\", moved, this.area.minSize, this.area.maxSize, this.area.tagName, this.size);\r\n        }\r\n\r\n        screen.solveAreaConstraints();\r\n        screen.regenBorders();\r\n        this.on_resize(oldsize);\r\n      }//*/\r\n\r\n      this.area.push_ctx_active(true);\r\n    }\r\n\r\n    this._forEachChildWidget((n) => {\r\n      n.update();\r\n    });\r\n\r\n    if (this.area !== undefined) {\r\n      this.area.pop_ctx_active(true);\r\n    }\r\n  }\r\n\r\n  appendChild(ch) {\r\n    if (ch instanceof Area) {\r\n      this.editors.push(ch);\r\n      this.editormap[ch.constructor.define().areaname] = ch;\r\n    } else {\r\n      super.appendChild(ch);\r\n    }\r\n  }\r\n\r\n  removeChild(ch) {\r\n    if (ch instanceof Area) {\r\n      ch.owining_sarea = undefined;\r\n      ch.pos = undefined;\r\n      ch.size = undefined;\r\n\r\n      if (this.area === ch && this.editors.length > 1) {\r\n        let i = (this.editors.indexOf(ch) + 1)%this.editors.length;\r\n        this.switchEditor(this.editors[i].constructor);\r\n      } else if (this.area === ch) {\r\n        this.editors = [];\r\n        this.editormap = {};\r\n        this.area = undefined;\r\n\r\n        ch.remove();\r\n        return;\r\n      }\r\n\r\n      let areaname = ch.constructor.define().areaname;\r\n\r\n      this.editors.remove(ch);\r\n      delete this.editormap[areaname];\r\n\r\n      ch.parentWidget = undefined;\r\n    } else {\r\n      return super.removeChild(ch);\r\n    }\r\n  }\r\n\r\n  afterSTRUCT() {\r\n    for (let area of this.editors) {\r\n      area.pos = this.pos;\r\n      area.size = this.size;\r\n      area.owning_sarea = this;\r\n\r\n      area.push_ctx_active();\r\n      area._ctx = this.ctx;\r\n      area.afterSTRUCT();\r\n      area.pop_ctx_active();\r\n    }\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    this.pos = new Vector2(this.pos);\r\n    this.size = new Vector2(this.size);\r\n\r\n    //find active editor\r\n\r\n    let editors = [];\r\n\r\n    for (let area of this.editors) {\r\n      if (!area.constructor || !area.constructor.define || area.constructor === Area) {\r\n        //failed to load this area\r\n        continue;\r\n      }\r\n\r\n      /*\r\n      if (area.constructor === undefined || area.constructor.define === undefined) {\r\n        console.warn(\"Missing class for area\", area, \"maybe buggy loadSTRUCT()?\");\r\n        continue;\r\n      }\r\n      //*/\r\n\r\n      let areaname = area.constructor.define().areaname;\r\n\r\n      area.inactive = true;\r\n      area.owning_sarea = undefined;\r\n      this.editormap[areaname] = area;\r\n\r\n      if (areaname === this.area) {\r\n        this.area = area;\r\n      }\r\n\r\n      /*\r\n      * originally inactive areas weren't supposed to have\r\n      * a reference to their owning ScreenAreas.\r\n      *\r\n      * Unfortunately this will cause isDead() to return true,\r\n      * which might lead to nasty problems.\r\n      * */\r\n      area.parentWidget = this;\r\n\r\n      editors.push(area);\r\n    }\r\n    this.editors = editors;\r\n\r\n    if (typeof this.area !== \"object\") {\r\n      let area = this.editors[0];\r\n\r\n      console.warn(\"Failed to find active area!\", this.area);\r\n\r\n      if (typeof area !== \"object\") {\r\n        for (let k in areaclasses) {\r\n          area = areaclasses[k].define().tagname;\r\n          area = UIBase.createElement(area);\r\n          let areaname = area.constructor.define().areaname;\r\n\r\n          this.editors.push(area);\r\n          this.editormap[areaname] = area;\r\n\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (area) {\r\n        this.area = area;\r\n      }\r\n    }\r\n\r\n    if (this.area !== undefined) {\r\n      this.area.style[\"width\"] = \"100%\";\r\n      this.area.style[\"height\"] = \"100%\";\r\n      this.area.owning_sarea = this;\r\n      this.area.parentWidget = this;\r\n\r\n      this.area.pos = this.pos;\r\n      this.area.size = this.size;\r\n\r\n      this.area.inactive = false;\r\n      this.shadow.appendChild(this.area);\r\n\r\n      let f = () => {\r\n        if (this._isDead()) {\r\n          return;\r\n        }\r\n\r\n        if (!this.ctx && this.parentNode) {\r\n          console.log(\"waiting to start. . .\");\r\n          this.doOnce(f);\r\n          return;\r\n        }\r\n\r\n        this.area.ctx = this.ctx;\r\n        this.area._init(); //ensure init has been called already\r\n        this.area.on_area_active();\r\n        this.area.onadd();\r\n      };\r\n\r\n      this.doOnce(f);\r\n    }\r\n\r\n  }\r\n}\r\n\r\nScreenArea.STRUCT = `\r\npathux.ScreenArea { \r\n  pos      : vec2;\r\n  size     : vec2;\r\n  type     : string;\r\n  hidden   : bool;\r\n  editors  : array(abstract(pathux.Area));\r\n  area     : string | this.area ? this.area.constructor.define().areaname : \"\";\r\n}\r\n`;\r\n\r\nnstructjs.register(ScreenArea, \"pathux.ScreenArea\");\r\nui_base.UIBase.internalRegister(ScreenArea);\r\n\r\nui_base._setAreaClass(Area);\r\n\r\nexport function setScreenClass(cls) {\r\n  Screen = cls;\r\n}\r\n","import {Area} from '../screen/ScreenArea.js';\r\nimport * as nstructjs from '../path-controller/util/struct.js';\r\nimport {UIBase, theme, flagThemeUpdate} from '../core/ui_base.js';\r\nimport {Container} from '../core/ui.js';\r\nimport {validateCSSColor, color2css, css2color, CSSFont} from '../core/ui_theme.js';\r\n\r\nexport class ThemeEditor extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.categoryMap = {};\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"theme-editor-x\",\r\n      style  : \"theme-editor\"\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.build();\r\n  }\r\n\r\n  doFolder(catkey, obj, container = this) {\r\n    let key = catkey.key;\r\n\r\n    let panel = container.panel(key, undefined, undefined, catkey.help);\r\n    panel.style[\"margin-left\"] = \"15px\";\r\n\r\n    let row = panel.row();\r\n    let col1 = row.col();\r\n    let col2 = row.col();\r\n\r\n\r\n    let do_onchange = (key, k, obj) => {\r\n      flagThemeUpdate();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(key, k, obj);\r\n      }\r\n\r\n      this.ctx.screen.completeSetCSS();\r\n      this.ctx.screen.completeUpdate();\r\n    };\r\n\r\n    let getpath = (path) => {\r\n      let obj = theme;\r\n\r\n      for (let i = 0; i < path.length; i++) {\r\n        obj = obj[path[i]];\r\n      }\r\n\r\n      return obj;\r\n    }\r\n\r\n    let ok = false;\r\n    let _i = 0;\r\n\r\n    let dokey = (k, v, path) => {\r\n      let col = _i%2 === 0 ? col1 : col2;\r\n\r\n      if (k.toLowerCase().search(\"flag\") >= 0) {\r\n        return; //don't do flags\r\n      }\r\n\r\n      if (typeof v === \"string\") {\r\n        let v2 = v.toLowerCase().trim();\r\n\r\n        let iscolor = validateCSSColor(v2);\r\n\r\n        if (iscolor) {\r\n          let cw = col.colorbutton();\r\n          ok = true;\r\n          _i++;\r\n\r\n          let color = css2color(v2);\r\n          if (color.length < 3) {\r\n            color = [color[0], color[1], color[2], 1.0];\r\n          }\r\n\r\n          try {\r\n            cw.setRGBA(color);\r\n          } catch (error) {\r\n            console.warn(\"Failed to set color \" + k, v2);\r\n          }\r\n\r\n          cw.onchange = () => {\r\n            console.log(\"setting '\" + k + \"' to \" + color2css(cw.rgba), key);\r\n            getpath(path)[k] = color2css(cw.rgba);\r\n\r\n            do_onchange(key, k);\r\n          }\r\n          cw.label = k;\r\n        } else {\r\n          col.label(k);\r\n\r\n          let box = col.textbox();\r\n          box.onchange = () => {\r\n            getpath(path)[k] = box.text;\r\n            do_onchange(key, k);\r\n          }\r\n          box.text = v;\r\n        }\r\n      } else if (typeof v === \"number\") {\r\n        let slider = col.slider(undefined, k, v, 0, 256, 0.01, false);\r\n\r\n        slider.baseUnit = slider.displayUnit = \"none\";\r\n\r\n        ok = true;\r\n        _i++;\r\n\r\n        slider.onchange = () => {\r\n          getpath(path)[k] = slider.value;\r\n\r\n          do_onchange(key, k);\r\n        }\r\n      } else if (typeof v === \"boolean\") {\r\n        let check = col.check(undefined, k);\r\n\r\n        check.value = getpath(path)[k];\r\n\r\n        check.onchange = () => {\r\n          getpath(path)[k] = !!check.value;\r\n          do_onchange(key, k);\r\n        }\r\n      } else if (typeof v === \"object\" && v instanceof CSSFont) {\r\n        let panel2 = col.panel(k);\r\n        ok = true;\r\n        _i++;\r\n\r\n        let textbox = (key) => {\r\n          panel2.label(key);\r\n          let tbox = panel2.textbox(undefined, v[key]);\r\n\r\n          tbox.width = tbox.getDefault(\"width\");\r\n\r\n          tbox.onchange = function () {\r\n            v[key] = this.text;\r\n            do_onchange(key, k);\r\n          }\r\n        }\r\n\r\n        textbox(\"font\");\r\n        textbox(\"variant\");\r\n        textbox(\"weight\");\r\n        textbox(\"style\");\r\n\r\n        let cw = panel2.colorbutton();\r\n        cw.label = \"color\";\r\n        cw.setRGBA(css2color(v.color));\r\n        cw.onchange = () => {\r\n          v.color = color2css(cw.rgba);\r\n          do_onchange(key, k);\r\n        }\r\n\r\n        let slider = panel2.slider(undefined, \"size\", v.size);\r\n        slider.onchange = () => {\r\n          v.size = slider.value;\r\n          do_onchange(key, k);\r\n        }\r\n        slider.setAttribute(\"min\", 1);\r\n        slider.setAttribute(\"max\", 100);\r\n\r\n        slider.baseUnit = slider.displayUnit = \"none\";\r\n\r\n        panel2.closed = true;\r\n      } else if (typeof v === \"object\") {\r\n        let old = {\r\n          panel, row, col1, col2\r\n        };\r\n\r\n        let path2 = path.slice(0, path.length);\r\n        path2.push(k);\r\n\r\n        panel = panel.panel(k);\r\n        row = panel.row();\r\n        col1 = row.col();\r\n        col2 = row.col();\r\n        for (let k2 in v) {\r\n          let v2 = v[k2];\r\n\r\n          dokey(k2, v2, path2);\r\n        }\r\n\r\n        panel = old.panel;\r\n        row = old.row;\r\n        col1 = old.col1;\r\n        col2 = old.col2;\r\n      }\r\n    };\r\n\r\n    for (let k in obj) {\r\n      let v = obj[k];\r\n\r\n      dokey(k, v, [key]);\r\n    }\r\n\r\n    if (!ok) {\r\n      panel.remove();\r\n    } else {\r\n      panel.closed = true;\r\n    }\r\n\r\n  }\r\n\r\n  build() {\r\n    let categories = {};\r\n\r\n    for (let k of Object.keys(theme)) {\r\n      let catkey;\r\n\r\n      if (k in this.categoryMap) {\r\n        let cat = this.categoryMap[k];\r\n\r\n        if (typeof cat === \"string\") {\r\n          cat = {\r\n            category: cat,\r\n            help    : \"\",\r\n            key     : k\r\n          }\r\n        }\r\n\r\n        catkey = cat;\r\n      } else {\r\n        catkey = {category: k, help: '', key: k};\r\n      }\r\n\r\n      if (!catkey.key) {\r\n        catkey.key = k;\r\n      }\r\n\r\n      if (!(catkey.category in categories)) {\r\n        categories[catkey.category] = [];\r\n      }\r\n\r\n      categories[catkey.category].push(catkey);\r\n    }\r\n\r\n    function strcmp(a, b) {\r\n      a = a.trim().toLowerCase();\r\n      b = b.trim().toLowerCase();\r\n      return a < b ? -1 : (a === b ? 0 : 1);\r\n    }\r\n\r\n    let keys = Object.keys(categories);\r\n    keys.sort(strcmp);\r\n\r\n    for (let k of keys) {\r\n      let list = categories[k];\r\n      list.sort((a, b) => strcmp(a.key, b.key));\r\n\r\n      let panel = this;\r\n\r\n      if (list.length > 1) {\r\n        panel = this.panel(k);\r\n      }\r\n\r\n      for (let cat of list) {\r\n        let k2 = cat.key;\r\n        let v = theme[k2];\r\n\r\n        if (typeof v === \"object\") {\r\n          this.doFolder(cat, v, panel);\r\n        }\r\n      }\r\n\r\n      if (list.length > 1) {\r\n        panel.closed = true;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ThemeEditor);\r\n","import {UIBase, drawText} from \"../core/ui_base.js\";\r\nimport {ValueButtonBase} from \"./ui_widgets.js\";\r\nimport cconst from '../config/const.js';\r\nimport * as ui_base from \"../core/ui_base.js\";\r\nimport * as units from \"../core/units.js\";\r\nimport {Vector2} from \"../path-controller/util/vectormath.js\";\r\nimport {ColumnFrame} from \"../core/ui.js\";\r\nimport * as util from \"../path-controller/util/util.js\";\r\nimport {\r\n  PropTypes, isNumber, PropSubTypes, PropFlags, NumberConstraints, IntProperty\r\n} from \"../path-controller/toolsys/toolprop.js\";\r\nimport {eventWasTouch} from \"../path-controller/util/simple_events.js\";\r\nimport {KeyMap, keymap} from \"../path-controller/util/simple_events.js\";\r\nimport {color2css, css2color} from \"../core/ui_theme.js\";\r\nimport {ThemeEditor} from \"./theme_editor.js\";\r\n\r\nexport const sliderDomAttributes = new Set([\r\n  \"min\", \"max\", \"integer\", \"displayUnit\", \"baseUnit\", \"labelOnTop\",\r\n  \"radix\", \"step\", \"expRate\", \"stepIsRelative\", \"decimalPlaces\",\r\n  \"slideSpeed\"\r\n]);\r\n\r\nfunction updateSliderFromDom(dom, slider = dom) {\r\n  let redraw = false;\r\n\r\n  function getbool(attr, prop = attr) {\r\n    if (!dom.hasAttribute(attr)) {\r\n      return;\r\n    }\r\n\r\n    let v = dom.getAttribute(attr);\r\n    let ret = v === null || v.toLowerCase() === \"true\" || v.toLowerCase === \"yes\";\r\n\r\n    let old = slider[prop];\r\n    if (old !== undefined && old !== ret) {\r\n      redraw = true;\r\n    }\r\n\r\n    slider[prop] = ret;\r\n    return ret;\r\n  }\r\n\r\n  function getfloat(attr, prop = attr) {\r\n    if (!dom.hasAttribute(attr)) {\r\n      return;\r\n    }\r\n\r\n    let v = dom.getAttribute(attr);\r\n    let ret = parseFloat(v);\r\n\r\n    let old = slider[prop];\r\n    if (old !== undefined && Math.abs(old - v) < 0.00001) {\r\n      redraw = true;\r\n    }\r\n\r\n    slider[prop] = ret;\r\n    return ret;\r\n  }\r\n\r\n  function getint(attr, prop = attr) {\r\n    if (!dom.hasAttribute(attr)) {\r\n      return;\r\n    }\r\n\r\n    let v = (\"\" + dom.getAttribute(attr)).toLowerCase();\r\n    let ret;\r\n\r\n    if (v === \"true\") {\r\n      ret = true;\r\n    } else if (v === \"false\") {\r\n      ret = false;\r\n    } else {\r\n      ret = parseInt(v);\r\n    }\r\n\r\n    if (isNaN(ret)) {\r\n      console.error(\"bad value \" + v);\r\n      return 0.0;\r\n    }\r\n\r\n    let old = slider[prop];\r\n    if (old !== undefined && Math.abs(old - v) < 0.00001) {\r\n      redraw = true;\r\n    }\r\n\r\n    slider[prop] = ret;\r\n    return ret;\r\n  }\r\n\r\n  if (dom.hasAttribute(\"min\")) {\r\n    slider.range = slider.range || [-1e17, 1e17];\r\n\r\n    let r = slider.range[0];\r\n    slider.range[0] = parseFloat(dom.getAttribute(\"min\"));\r\n    redraw = Math.abs(slider.range[0] - r) > 0.0001;\r\n  }\r\n\r\n  if (dom.hasAttribute(\"max\")) {\r\n    slider.range = slider.range || [-1e17, 1e17];\r\n\r\n    let r = slider.range[1];\r\n    slider.range[1] = parseFloat(dom.getAttribute(\"max\"));\r\n    redraw = redraw || Math.abs(slider.range[1] - r) > 0.0001;\r\n  }\r\n\r\n  if (dom.hasAttribute(\"displayUnit\")) {\r\n    let old = slider.displayUnit;\r\n    slider.displayUnit = dom.getAttribute(\"displayUnit\").trim();\r\n\r\n    redraw = redraw || old !== slider.displayUnit;\r\n  }\r\n\r\n  getint(\"integer\", \"isInt\");\r\n\r\n  getint(\"radix\");\r\n  getint(\"decimalPlaces\");\r\n\r\n  getbool(\"labelOnTop\");\r\n  getbool(\"stepIsRelative\");\r\n  getfloat(\"expRate\");\r\n  getfloat(\"step\");\r\n\r\n  return redraw;\r\n}\r\n\r\nexport const SliderDefaults = {\r\n  stepIsRelative: false,\r\n  expRate       : 1.0 + 1.0/3.0,\r\n  radix         : 10,\r\n  decimalPlaces : 4,\r\n  baseUnit      : \"none\",\r\n  displayUnit   : \"none\",\r\n  slideSpeed    : 1.0,\r\n  step          : 0.1,\r\n}\r\n\r\nexport function NumberSliderBase(cls = UIBase, skip = new Set(), defaults = SliderDefaults) {\r\n  skip = new Set(skip);\r\n\r\n  return class NumberSliderBase extends cls {\r\n    constructor() {\r\n      super();\r\n\r\n      for (let key of NumberConstraints) {\r\n        if (skip.has(key)) {\r\n          continue;\r\n        }\r\n\r\n        if (key in defaults) {\r\n          this[key] = defaults[key];\r\n        } else {\r\n          this[key] = undefined;\r\n        }\r\n      }\r\n    }\r\n\r\n    loadConstraints(prop = undefined) {\r\n      if (!this.hasAttribute(\"datapath\")) {\r\n        return;\r\n      }\r\n\r\n      if (!prop) {\r\n        prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n      }\r\n\r\n      let loadAttr = (propkey, domkey = key, thiskey = key) => {\r\n        if (this.hasAttribute(domkey)) {\r\n          this[thiskey] = parseFloat(this.getAttribute(domkey));\r\n        } else {\r\n          this[thiskey] = prop[propkey];\r\n        }\r\n      }\r\n\r\n      for (let key of NumberConstraints) {\r\n        let thiskey = key, domkey = key;\r\n\r\n        if (key === \"range\") { //handled later\r\n          continue;\r\n        }\r\n\r\n        loadAttr(key, domkey, thiskey);\r\n      }\r\n\r\n      let range = prop.range;\r\n      if (range && !this.hasAttribute(\"min\")) {\r\n        this.range[0] = range[0];\r\n      } else if (this.hasAttribute(\"min\")) {\r\n        this.range[0] = parseFloat(this.getAttribute(\"min\"));\r\n      }\r\n\r\n      if (range && !this.hasAttribute(\"max\")) {\r\n        this.range[1] = range[1];\r\n      } else if (this.hasAttribute(\"max\")) {\r\n        this.range[1] = parseFloat(this.getAttribute(\"max\"));\r\n      }\r\n\r\n      if (this.getAttribute(\"integer\")) {\r\n        let val = this.getAttribute(\"integer\");\r\n        val = (\"\" + val).toLowerCase();\r\n\r\n        //handles anonymouse <numslider-x integer> case\r\n        this.isInt = val === \"null\" || val === \"true\" || val === \"yes\" || val === \"1\";\r\n      } else {\r\n        this.isInt = prop instanceof IntProperty;\r\n      }\r\n\r\n      if (this.editAsBaseUnit === undefined) {\r\n        if (prop.flag & PropFlags.EDIT_AS_BASE_UNIT) {\r\n          this.editAsBaseUnit = true;\r\n        } else {\r\n          this.editAsBaseUnit = false;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n//use .setAttribute(\"linear\") to disable nonlinear sliding\r\nexport class NumSlider extends NumberSliderBase(ValueButtonBase) {\r\n  constructor() {\r\n    super();\r\n\r\n    this._highlight = undefined;\r\n    this._last_label = undefined;\r\n\r\n    this.mdown = false;\r\n    this.ma = undefined;\r\n\r\n    this.mpos = new Vector2();\r\n    this.start_mpos = new Vector2();\r\n\r\n    this._last_overarrow = false;\r\n\r\n    this._name = \"\";\r\n    this._value = 0.0;\r\n    this.expRate = SliderDefaults.expRate;\r\n\r\n    this.vertical = false;\r\n    this._last_disabled = false;\r\n\r\n    this.range = [-1e17, 1e17];\r\n    this.isInt = false;\r\n    this.editAsBaseUnit = undefined;\r\n\r\n    this._redraw();\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(val) {\r\n    this.setValue(val);\r\n  }\r\n\r\n  /** Current name label.  If set to null label will\r\n   * be pulled from the datapath api.*/\r\n  get name() {\r\n    return this.getAttribute(\"name\") || this._name;\r\n  }\r\n\r\n  /** Current name label.  If set to null label will\r\n   * be pulled from the datapath api.*/\r\n  set name(name) {\r\n    if (name === undefined || name === null) {\r\n      this.removeAttribute(\"name\");\r\n    } else {\r\n      this.setAttribute(\"name\", name);\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname    : \"numslider-x\",\r\n      style      : \"numslider\",\r\n      parentStyle: \"button\"\r\n    };\r\n  }\r\n\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (!prop) {\r\n      return;\r\n    }\r\n\r\n    let name;\r\n\r\n    if (this.hasAttribute(\"name\")) {\r\n      name = this.getAttribute(\"name\");\r\n    } else {\r\n      name = \"\" + prop.uiname;\r\n    }\r\n\r\n    //lazily load constraints, since there's so much\r\n    //accessing of DOM attributes\r\n    let updateConstraints = false;\r\n\r\n    if (name !== this._name) {\r\n      this._name = name;\r\n      this.setCSS();\r\n      updateConstraints = true;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (val !== this._value) {\r\n      updateConstraints = true;\r\n      /* Note that super.updateDataPath will update .value for us*/\r\n    }\r\n\r\n    if (updateConstraints) {\r\n      this.loadConstraints(prop);\r\n    }\r\n\r\n    super.updateDataPath();\r\n  }\r\n\r\n  update() {\r\n    if (!!this._last_disabled !== !!this.disabled) {\r\n      this._last_disabled = !!this.disabled;\r\n      this._redraw();\r\n      this.setCSS();\r\n    }\r\n\r\n    super.update(); //calls this.updateDataPath\r\n\r\n    updateSliderFromDom(this);\r\n  }\r\n\r\n  swapWithTextbox() {\r\n    let tbox = UIBase.createElement(\"textbox-x\");\r\n\r\n    tbox.ctx = this.ctx;\r\n    tbox._init();\r\n\r\n    tbox.decimalPlaces = this.decimalPlaces;\r\n    tbox.isInt = this.isInt;\r\n    tbox.editAsBaseUnit = this.editAsBaseUnit;\r\n\r\n    if (this.isInt && this.radix != 10) {\r\n      let text = this.value.toString(this.radix);\r\n      if (this.radix === 2)\r\n        text = \"0b\" + text;\r\n      else if (this.radix === 16)\r\n        text += \"h\";\r\n\r\n      tbox.text = text;\r\n    } else {\r\n      tbox.text = units.buildString(this.value, this.baseUnit, this.decimalPlaces, this.displayUnit);\r\n    }\r\n\r\n    this.parentNode.insertBefore(tbox, this);\r\n    //this.remove();\r\n    this.hidden = true;\r\n    //this.dom.hidden = true;\r\n\r\n    let finish = (ok) => {\r\n      tbox.remove();\r\n      this.hidden = false;\r\n\r\n      if (ok) {\r\n        let val = tbox.text.trim();\r\n\r\n        if (this.isInt && this.radix !== 10) {\r\n          val = parseInt(val);\r\n        } else {\r\n          let displayUnit = this.editAsBaseUnit ? undefined : this.displayUnit;\r\n\r\n          val = units.parseValue(val, this.baseUnit, displayUnit);\r\n        }\r\n\r\n        if (isNaN(val)) {\r\n          console.log(\"Text input error\", val, tbox.text.trim(), this.isInt);\r\n          this.flash(ui_base.ErrorColors.ERROR);\r\n        } else {\r\n          this.setValue(val);\r\n\r\n          if (this.onchange) {\r\n            this.onchange(this);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    tbox.onend = finish;\r\n    tbox.focus();\r\n    tbox.select();\r\n\r\n    //this.shadow.appendChild(tbox);\r\n    return;\r\n  }\r\n\r\n  bindEvents() {\r\n    let dir = this.range && this.range[0] > this.range[1] ? -1 : 1;\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Left\"]:\r\n        case keymap[\"Down\"]:\r\n          this.setValue(this.value - dir*5*this.step);\r\n          break;\r\n        case keymap[\"Up\"]:\r\n        case keymap[\"Right\"]:\r\n          this.setValue(this.value + dir*5*this.step);\r\n          break;\r\n      }\r\n    });\r\n\r\n    let onmousedown = (e) => {\r\n      e.preventDefault();\r\n\r\n      if (this.disabled) {\r\n        this.mdown = false;\r\n        e.stopPropagation();\r\n\r\n        return;\r\n      }\r\n\r\n      if (e.button) {\r\n        return;\r\n      }\r\n\r\n      this.mdown = true;\r\n\r\n      if (e.shiftKey) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        this.swapWithTextbox();\r\n      } else if (this.overArrow(e.x, e.y)) {\r\n        this._on_click(e);\r\n      } else {\r\n        this.dragStart(e);\r\n        e.stopPropagation();\r\n      }\r\n    }\r\n\r\n    this._on_click = (e) => {\r\n      this.setMpos(e);\r\n\r\n      if (this.disabled) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        return;\r\n      }\r\n\r\n      let step;\r\n\r\n      if (step = this.overArrow(e.x, e.y)) {\r\n        if (e.shiftKey) {\r\n          step *= 0.1;\r\n        }\r\n\r\n        this.setValue(this.value + step);\r\n      }\r\n    }\r\n\r\n    this.addEventListener(\"mousemove\", (e) => {\r\n      this.setMpos(e);\r\n\r\n      if (this.mdown && !this._modaldata && this.mpos.vectorDistance(this.start_mpos) > 13) {\r\n        this.dragStart(e);\r\n      }\r\n    });\r\n\r\n    this.addEventListener(\"dblclick\", (e) => {\r\n      this.setMpos(e);\r\n\r\n      this.mdown = false;\r\n\r\n      if (this.disabled || this.overArrow(e.x, e.y)) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        return;\r\n      }\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n\r\n      this.swapWithTextbox();\r\n    });\r\n\r\n    this.addEventListener(\"mousedown\", (e) => {\r\n      this.setMpos(e);\r\n\r\n      if (this.disabled) return;\r\n      onmousedown(e);\r\n    }, {capture: true});\r\n\r\n    this.addEventListener(\"mouseup\", (e) => {\r\n      this.mdown = false;\r\n    })\r\n    /*\r\n    this.addEventListener(\"touchstart\", (e) => {\r\n      if (this.disabled) return;\r\n\r\n      e.x = e.touches[0].screenX;\r\n      e.y = e.touches[0].screenY;\r\n\r\n      this.dragStart(e);\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }, {passive : false});\r\n    //*/\r\n\r\n    //this.addEventListener(\"mouseup\", (e) => {\r\n    //  return onmouseup(e);\r\n    //});\r\n\r\n    this.addEventListener(\"mouseover\", (e) => {\r\n      this.setMpos(e);\r\n      if (this.disabled) return;\r\n\r\n      if (!this._highlight) {\r\n        this._highlight = true;\r\n        this._repos_canvas();\r\n        this._redraw();\r\n      }\r\n    })\r\n\r\n    this.addEventListener(\"blur\", (e) => {\r\n      this._highlight = false;\r\n      this.mdown = false;\r\n    });\r\n\r\n    this.addEventListener(\"mouseout\", (e) => {\r\n      this.setMpos(e);\r\n      if (this.disabled) return;\r\n\r\n      this._highlight = false;\r\n\r\n      this.dom._background = this.getDefault(\"background-color\");\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    })\r\n  }\r\n\r\n  overArrow(x, y) {\r\n    let r = this.getBoundingClientRect();\r\n    let rwidth, rx;\r\n\r\n    if (this.vertical) {\r\n      rwidth = r.height;\r\n      rx = r.y;\r\n      x = y;\r\n    } else {\r\n      rwidth = r.width;\r\n      rx = r.x;\r\n    }\r\n\r\n    x -= rx;\r\n    let sz = this._getArrowSize();\r\n\r\n    let szmargin = sz + cconst.numSliderArrowLimit;\r\n\r\n    let step = this.step || 0.01;\r\n\r\n    if (this.isInt) {\r\n      step = Math.max(step, 1);\r\n    }\r\n\r\n    if (isNaN(step)) {\r\n      console.error(\"NaN step size\", \"step:\", this.step, \"numslider:\", this._id);\r\n      this.flash(\"red\");\r\n      step = this.isInt ? 1 : 0.1;\r\n    }\r\n\r\n    if (x < szmargin) {\r\n      return -step;\r\n    } else if (x > rwidth - szmargin) {\r\n      return step;\r\n    }\r\n\r\n    return 0;\r\n  }\r\n\r\n  doRange() {\r\n    console.warn(\"Deprecated: NumSlider.prototype.doRange, use loadConstraints instead!\");\r\n    this.loadConstraints();\r\n  }\r\n\r\n  setValue(value, fire_onchange = true, setDataPath = true, checkConstraints = true) {\r\n    value = Math.min(Math.max(value, this.range[0]), this.range[1]);\r\n    \r\n    this._value = value;\r\n\r\n    if (this.hasAttribute(\"integer\")) {\r\n      this.isInt = true;\r\n    }\r\n\r\n    if (this.isInt) {\r\n      this._value = Math.floor(this._value);\r\n    }\r\n\r\n    if (checkConstraints) {\r\n      this.loadConstraints();\r\n    }\r\n\r\n    if (setDataPath && this.ctx && this.hasAttribute(\"datapath\")) {\r\n      this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this._value);\r\n    }\r\n\r\n    if (fire_onchange && this.onchange) {\r\n      this.onchange(this.value);\r\n    }\r\n\r\n    this._redraw();\r\n  }\r\n\r\n  setMpos(e) {\r\n    this.mpos[0] = e.x;\r\n    this.mpos[1] = e.y;\r\n\r\n    if (!this.mdown) {\r\n      this.start_mpos[0] = e.x;\r\n      this.start_mpos[1] = e.y;\r\n    }\r\n\r\n    let over = this.overArrow(e.x, e.y);\r\n\r\n    if (over !== this._last_overarrow) {\r\n      this._last_overarrow = over;\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  dragStart(e) {\r\n    this.mdown = false;\r\n\r\n    if (this.disabled) return;\r\n\r\n    if (this.modalRunning) {\r\n      console.log(\"modal already running for numslider\", this);\r\n      return;\r\n    }\r\n\r\n    this.last_time = util.time_ms();\r\n\r\n    let last_background = this.dom._background;\r\n    let cancel;\r\n\r\n    this.ma = new util.MovingAvg(eventWasTouch(e) ? 8 : 2);\r\n\r\n    let startvalue = this.value;\r\n    let value = startvalue;\r\n\r\n    let startx = this.vertical ? e.y : e.x, starty = this.vertical ? e.x : e.y;\r\n    let sumdelta = 0;\r\n\r\n    this.dom._background = this.getDefault(\"BoxDepressed\");\r\n    let fire = () => {\r\n      if (this.onchange) {\r\n        this.onchange(this);\r\n      }\r\n    }\r\n\r\n    let handlers = {\r\n      on_keydown: (e) => {\r\n        switch (e.keyCode) {\r\n          case 27: //escape key\r\n            cancel(true);\r\n          case 13: //enter key\r\n            cancel(false);\r\n            break;\r\n        }\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      },\r\n\r\n      on_mousemove: (e) => {\r\n        if (this.disabled) return;\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        let x = this.ma.add(this.vertical ? e.y : e.x);\r\n        let dx = x - startx;\r\n        startx = x;\r\n\r\n        if (util.time_ms() - this.last_time < 35) {\r\n          return;\r\n        }\r\n        this.last_time = util.time_ms();\r\n\r\n        if (e.shiftKey) {\r\n          dx *= 0.1;\r\n        }\r\n\r\n        dx *= this.vertical ? -1 : 1;\r\n\r\n        sumdelta += Math.abs(dx);\r\n\r\n        value += dx*this.step*0.1*this.slideSpeed;\r\n\r\n        let dvalue = value - startvalue;\r\n        let dsign = Math.sign(dvalue);\r\n\r\n        let expRate = this.expRate;\r\n\r\n        //if (eventWasTouch(e)) {\r\n        //  expRate = (1 + expRate)*0.5;\r\n        //}\r\n\r\n        if (!this.hasAttribute(\"linear\")) {\r\n          dvalue = Math.pow(Math.abs(dvalue), expRate)*dsign;\r\n        }\r\n\r\n        this.value = startvalue + dvalue;\r\n\r\n        /*\r\n        if (e.shiftKey) {\r\n          dx *= 0.1;\r\n          this.value = startvalue2 + dx*0.1*this.step*this.slideSpeed;\r\n          startvalue3 = this.value;\r\n        } else {\r\n          startvalue2 = this.value;\r\n          this.value = startvalue3 + dx*0.1*this.step*this.slideSpeed;\r\n        }*/\r\n\r\n        this.updateWidth();\r\n        this._redraw();\r\n        fire();\r\n      },\r\n\r\n      on_mouseup: (e) => {\r\n        this.setMpos(e);\r\n\r\n        this.undoBreakPoint();\r\n        cancel(false);\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      },\r\n\r\n      on_mouseout: (e) => {\r\n        last_background = this.getDefault(\"background-color\");\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      },\r\n\r\n      on_mouseover: (e) => {\r\n        last_background = this.getDefault(\"BoxHighlight\");\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      },\r\n\r\n      on_mousedown: (e) => {\r\n        this.popModal();\r\n      },\r\n    };\r\n\r\n    //events.pushModal(this.getScreen(), handlers);\r\n    this.pushModal(handlers);\r\n\r\n    cancel = (restore_value) => {\r\n      if (restore_value) {\r\n        this.value = startvalue;\r\n        this.updateWidth();\r\n        fire();\r\n      }\r\n\r\n      this.dom._background = last_background; //ui_base.getDefault(\"background-color\");\r\n      this._redraw();\r\n\r\n      this.popModal();\r\n    }\r\n\r\n    /*\r\n    cancel = (restore_value) => {\r\n      if (restore_value) {\r\n        this.value = startvalue;\r\n        this.updateWidth();\r\n        fire();\r\n      }\r\n\r\n      this.dom._background = last_background; //ui_base.getDefault(\"background-color\");\r\n      this._redraw();\r\n\r\n      console.trace(\"end\");\r\n\r\n      window.removeEventListener(\"keydown\", keydown, true);\r\n      window.removeEventListener(\"mousemove\", mousemove, {captured : true, passive : false});\r\n\r\n      window.removeEventListener(\"touchend\", touchend, true);\r\n      window.removeEventListener(\"touchmove\", touchmove, {captured : true, passive : false});\r\n      window.removeEventListener(\"touchcancel\", touchcancel, true);\r\n      window.removeEventListener(\"mouseup\", mouseup, true);\r\n\r\n      this.removeEventListener(\"mouseover\", mouseover, true);\r\n      this.removeEventListener(\"mouseout\", mouseout, true);\r\n    }\r\n\r\n    window.addEventListener(\"keydown\", keydown, true);\r\n    window.addEventListener(\"mousemove\", mousemove, true);\r\n    window.addEventListener(\"touchend\", touchend, true);\r\n    window.addEventListener(\"touchmove\", touchmove, {captured : true, passive : false});\r\n    window.addEventListener(\"touchcancel\", touchcancel, true);\r\n    window.addEventListener(\"mouseup\", mouseup, true);\r\n\r\n    this.addEventListener(\"mouseover\", mouseover, true);\r\n    this.addEventListener(\"mouseout\", mouseout, true);\r\n    //*/\r\n  }\r\n\r\n  setCSS() {\r\n    //do not call parent class implementation\r\n    let dpi = this.getDPI();\r\n\r\n    let ts = this.getDefault(\"DefaultText\").size*UIBase.getDPI();\r\n\r\n    let dd = this.isInt ? 5 : this.decimalPlaces + 8;\r\n\r\n    let label = this._genLabel();\r\n\r\n    let tw = ui_base.measureText(this, label, {\r\n      size: ts,\r\n      font: this.getDefault(\"DefaultText\")\r\n    }).width/dpi;\r\n\r\n    tw = Math.max(tw + this._getArrowSize()*0, this.getDefault(\"width\"));\r\n\r\n    tw += ts;\r\n    tw = ~~tw;\r\n\r\n    //tw = Math.max(tw, w);\r\n    if (this.vertical) {\r\n      this.style[\"width\"] = this.dom.style[\"width\"] = this.getDefault(\"height\") + \"px\";\r\n\r\n      this.style[\"height\"] = tw + \"px\";\r\n      this.dom.style[\"height\"] = tw + \"px\";\r\n    } else {\r\n      this.style[\"height\"] = this.dom.style[\"height\"] = this.getDefault(\"height\") + \"px\";\r\n\r\n      this.style[\"width\"] = tw + \"px\";\r\n      this.dom.style[\"width\"] = tw + \"px\";\r\n    }\r\n\r\n    this._repos_canvas();\r\n    this._redraw();\r\n  }\r\n\r\n  updateName(force) {\r\n    if (!this.hasAttribute(\"name\")) {\r\n      return;\r\n    }\r\n\r\n    let name = this.getAttribute(\"name\");\r\n\r\n    if (force || name !== this._name) {\r\n      this._name = name;\r\n      this.setCSS();\r\n    }\r\n\r\n    let label = this._genLabel();\r\n    if (label !== this._last_label) {\r\n      this._last_label = label;\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  _genLabel() {\r\n    let val = this.value;\r\n    let text;\r\n\r\n    if (val === undefined) {\r\n      text = \"error\";\r\n    } else {\r\n      val = val === undefined ? 0.0 : val;\r\n\r\n      if (this.isInt) {\r\n        val = Math.floor(val);\r\n      }\r\n\r\n      val = units.buildString(val, this.baseUnit, this.decimalPlaces, this.displayUnit);\r\n\r\n      text = val;\r\n      if (this._name) {\r\n        text = this._name + \": \" + text;\r\n      }\r\n    }\r\n\r\n    return text;\r\n  }\r\n\r\n  _redraw() {\r\n    let g = this.g;\r\n    let canvas = this.dom;\r\n\r\n    let dpi = this.getDPI();\r\n    let disabled = this.disabled;\r\n\r\n    let r = this.getDefault(\"border-radius\");\r\n    if (this.isInt) {\r\n      r *= 0.25;\r\n    }\r\n\r\n    let boxbg = this.getDefault(this._highlight ? \"BoxHighlight\" : \"background-color\");\r\n\r\n    ui_base.drawRoundBox(this, this.dom, this.g, undefined, undefined,\r\n      r, \"fill\", disabled ? this.getDefault(\"DisabledBG\") : boxbg);\r\n    ui_base.drawRoundBox(this, this.dom, this.g, undefined, undefined,\r\n      r, \"stroke\", disabled ? this.getDefault(\"DisabledBG\") : this.getDefault(\"border-color\"));\r\n\r\n    r *= dpi;\r\n    let pad = this.getDefault(\"padding\");\r\n    let ts = this.getDefault(\"DefaultText\").size;\r\n\r\n    let text = this._genLabel();\r\n\r\n    let tw = ui_base.measureText(this, text, this.dom, this.g).width;\r\n    let cx = ts + this._getArrowSize();\r\n    let cy = this.dom.height/2;\r\n\r\n    this.dom.font = undefined;\r\n\r\n    g.save();\r\n\r\n    let th = Math.PI*0.5;\r\n\r\n    if (this.vertical) {\r\n      g.rotate(th);\r\n\r\n      ui_base.drawText(this, cx, -ts*0.5, text, {\r\n        canvas: this.dom,\r\n        g     : this.g,\r\n        size  : ts\r\n      });\r\n      g.restore();\r\n    } else {\r\n      ui_base.drawText(this, cx, cy + ts/2, text, {\r\n        canvas: this.dom,\r\n        g     : this.g,\r\n        size  : ts\r\n      });\r\n    }\r\n\r\n    //}\r\n\r\n    let arrowcolor = this.getDefault(\"arrow-color\") || \"33%\";\r\n    arrowcolor = arrowcolor.trim();\r\n\r\n    if (arrowcolor.endsWith(\"%\")) {\r\n      arrowcolor = arrowcolor.slice(0, arrowcolor.length - 1).trim();\r\n      let perc = parseFloat(arrowcolor)/100.0;\r\n      let c = css2color(this.getDefault(\"arrow-color\"));\r\n\r\n      let f = 1.0 - (c[0] + c[1] + c[2])*perc;\r\n\r\n      f = ~~(f*255);\r\n      arrowcolor = `rgba(${f},${f},${f},0.95)`;\r\n\r\n    }\r\n\r\n    arrowcolor = css2color(arrowcolor);\r\n    let higharrow = css2color(this.getDefault(\"BoxHighlight\"));\r\n    higharrow.interp(arrowcolor, 0.5);\r\n\r\n    arrowcolor = color2css(arrowcolor);\r\n    higharrow = color2css(higharrow);\r\n\r\n    let over = this._highlight ? this.overArrow(this.mpos[0], this.mpos[1]) : 0;\r\n\r\n    let d = 7, w = canvas.width, h = canvas.height;\r\n    let sz = this._getArrowSize();\r\n\r\n    if (this.vertical) {\r\n      g.beginPath();\r\n      g.moveTo(w*0.5, d);\r\n      g.lineTo(w*0.5 + sz*0.5, d + sz);\r\n      g.lineTo(w*0.5 - sz*0.5, d + sz);\r\n\r\n      g.fillStyle = over < 0 ? higharrow : arrowcolor;\r\n      g.fill();\r\n\r\n      g.beginPath();\r\n      g.moveTo(w*0.5, h - d);\r\n      g.lineTo(w*0.5 + sz*0.5, h - sz - d);\r\n      g.lineTo(w*0.5 - sz*0.5, h - sz - d);\r\n\r\n      g.fillStyle = over > 0 ? higharrow : arrowcolor;\r\n      g.fill();\r\n    } else {\r\n      g.beginPath();\r\n      g.moveTo(d, h*0.5);\r\n      g.lineTo(d + sz, h*0.5 + sz*0.5);\r\n      g.lineTo(d + sz, h*0.5 - sz*0.5);\r\n\r\n      g.fillStyle = over < 0 ? higharrow : arrowcolor;\r\n      g.fill();\r\n\r\n      g.beginPath();\r\n      g.moveTo(w - d, h*0.5);\r\n      g.lineTo(w - sz - d, h*0.5 + sz*0.5);\r\n      g.lineTo(w - sz - d, h*0.5 - sz*0.5);\r\n\r\n      g.fillStyle = over > 0 ? higharrow : arrowcolor;\r\n      g.fill();\r\n    }\r\n\r\n    g.fill();\r\n  }\r\n\r\n  _getArrowSize() {\r\n    return UIBase.getDPI()*10;\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(NumSlider);\r\n\r\n\r\nexport class NumSliderSimpleBase extends NumberSliderBase(UIBase) {\r\n  constructor() {\r\n    super();\r\n\r\n    this.baseUnit = undefined;\r\n    this.displayUnit = undefined;\r\n    this.editAsBaseUnit = undefined;\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.g = this.canvas.getContext(\"2d\");\r\n\r\n    this.canvas.style[\"width\"] = this.getDefault(\"width\") + \"px\";\r\n    this.canvas.style[\"height\"] = this.getDefault(\"height\") + \"px\";\r\n    this.canvas.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.highlight = false;\r\n    this.isInt = false;\r\n\r\n    this.shadow.appendChild(this.canvas);\r\n    this.range = [0, 1];\r\n\r\n    /** if not undefined defines subrange of visible slider */\r\n    this.uiRange = undefined;\r\n\r\n    this.step = 0.1;\r\n    this._value = 0.5;\r\n    this.ma = undefined;\r\n    this._focus = false;\r\n\r\n    this.modal = undefined;\r\n\r\n    this._last_slider_key = '';\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(val) {\r\n    this.setValue(val);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname    : \"numslider-simple-base-x\",\r\n      style      : \"numslider_simple\",\r\n      parentStyle: \"button\"\r\n    }\r\n  }\r\n\r\n  setValue(val, fire_onchange = true, setDataPath = true) {\r\n    val = Math.min(Math.max(val, this.range[0]), this.range[1]);\r\n\r\n    if (this.isInt) {\r\n      val = Math.floor(val);\r\n    }\r\n\r\n    if (this._value !== val) {\r\n      this._value = val;\r\n      this._redraw();\r\n\r\n      if (this.onchange && fire_onchange) {\r\n        this.onchange(val);\r\n      }\r\n\r\n      if (setDataPath && this.getAttribute(\"datapath\")) {\r\n        let path = this.getAttribute(\"datapath\");\r\n        this.setPathValue(this.ctx, path, this._value);\r\n      }\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n\r\n    if (!path || path === \"null\" || path === \"undefined\") {\r\n      return;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, path);\r\n\r\n    if (this.isInt) {\r\n      val = Math.floor(val);\r\n    }\r\n\r\n    if (val !== this._value) {\r\n      let prop = this.getPathMeta(this.ctx, path);\r\n      if (!prop) {\r\n        return;\r\n      }\r\n\r\n      this.loadConstraints(prop);\r\n      this.setValue(val, true, false);\r\n    }\r\n  }\r\n\r\n  _setFromMouse(e) {\r\n    let rect = this.getClientRects()[0];\r\n    if (rect === undefined) {\r\n      return;\r\n    }\r\n\r\n    let x = e.x - rect.left;\r\n    let dpi = UIBase.getDPI();\r\n    let co = this._getButtonPos();\r\n\r\n    let val = this._invertButtonX(x*dpi);\r\n    this.value = val;\r\n  }\r\n\r\n  _startModal(e) {\r\n    if (this.disabled) {\r\n      return;\r\n    }\r\n\r\n    if (e !== undefined) {\r\n      this._setFromMouse(e);\r\n    }\r\n    let dom = window;\r\n    let evtargs = {capture: false};\r\n\r\n    if (this.modal) {\r\n      console.warn(\"Double call to _startModal!\");\r\n      return;\r\n    }\r\n\r\n    this.ma = new util.MovingAvg(eventWasTouch(e) ? 4 : 2);\r\n    let handlers;\r\n\r\n    let end = () => {\r\n      if (handlers === undefined) {\r\n        return;\r\n      }\r\n\r\n      this.popModal();\r\n      handlers = undefined;\r\n    };\r\n\r\n    handlers = {\r\n      mousemove: (e) => {\r\n        let x = e.x, y = e.y;\r\n\r\n        x = this.ma.add(x);\r\n\r\n        let e2 = new MouseEvent(e, {\r\n          x, y\r\n        });\r\n        this._setFromMouse(e);\r\n      },\r\n\r\n      mouseover : (e) => {\r\n      },\r\n      mouseout  : (e) => {\r\n      },\r\n      mouseleave: (e) => {\r\n      },\r\n      mouseenter: (e) => {\r\n      },\r\n      blur      : (e) => {\r\n      },\r\n      focus     : (e) => {\r\n      },\r\n\r\n      mouseup: (e) => {\r\n        this.undoBreakPoint();\r\n        end();\r\n      },\r\n\r\n      keydown: (e) => {\r\n        switch (e.keyCode) {\r\n          case keymap[\"Enter\"]:\r\n          case keymap[\"Space\"]:\r\n          case keymap[\"Escape\"]:\r\n            end();\r\n        }\r\n      }\r\n    };\r\n\r\n    function makefunc(f) {\r\n      return (e) => {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n\r\n        return f(e);\r\n      }\r\n    }\r\n\r\n    for (let k in handlers) {\r\n      handlers[k] = makefunc(handlers[k]);\r\n    }\r\n\r\n    this.pushModal(handlers);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    if (!this.hasAttribute(\"tab-index\")) {\r\n      this.setAttribute(\"tab-index\", 0);\r\n    }\r\n\r\n    this.updateSize();\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      let dt = this.range[1] > this.range[0] ? 1 : -1;\r\n\r\n      switch (e.keyCode) {\r\n        case keymap[\"Left\"]:\r\n        case keymap[\"Right\"]:\r\n          let fac = this.step;\r\n\r\n          if (e.shiftKey) {\r\n            fac *= 0.1;\r\n          }\r\n\r\n          if (this.isInt) {\r\n            fac = Math.max(fac, 1);\r\n          }\r\n\r\n          this.value += e.keyCode === keymap[\"Left\"] ? -dt*fac : dt*fac;\r\n\r\n          break;\r\n      }\r\n    });\r\n\r\n    this.addEventListener(\"focusin\", () => {\r\n      if (this.disabled) return;\r\n\r\n      this._focus = 1;\r\n      this._redraw();\r\n      this.focus();\r\n    });\r\n\r\n    this.addEventListener(\"mousedown\", (e) => {\r\n      if (this.disabled) {\r\n        return;\r\n      }\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n      this._startModal(e);\r\n    });\r\n\r\n    this.addEventListener(\"mousein\", (e) => {\r\n      this.setHighlight(e);\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"mouseout\", (e) => {\r\n      this.highlight = false;\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"mouseover\", (e) => {\r\n      this.setHighlight(e);\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"mousemove\", (e) => {\r\n      this.setHighlight(e);\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"mouseleave\", (e) => {\r\n      this.highlight = false;\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"blur\", (e) => {\r\n      this._focus = 0;\r\n      this.highlight = false;\r\n      this._redraw();\r\n    });\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  setHighlight(e) {\r\n    this.highlight = this.isOverButton(e) ? 2 : 1;\r\n  }\r\n\r\n  _redraw() {\r\n    let g = this.g, canvas = this.canvas;\r\n    let w = canvas.width, h = canvas.height;\r\n    let dpi = UIBase.getDPI();\r\n\r\n    let color = this.getDefault(\"background-color\");\r\n    let sh = ~~(this.getDefault(\"SlideHeight\")*dpi + 0.5);\r\n\r\n    g.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    g.fillStyle = color;\r\n\r\n    let y = (h - sh)*0.5;\r\n\r\n    let r = this.getDefault(\"border-radius\");\r\n\r\n    g.translate(0, y);\r\n    ui_base.drawRoundBox(this, this.canvas, g, w, sh, r, \"fill\", color, undefined, true);\r\n\r\n    let bcolor = this.getDefault('border-color');\r\n    ui_base.drawRoundBox(this, this.canvas, g, w, sh, r, \"stroke\", bcolor, undefined, true);\r\n    g.translate(0, -y);\r\n\r\n    if (this.highlight === 1) {\r\n      color = this.getDefault(\"BoxHighlight\");\r\n    } else {\r\n      color = this.getDefault(\"border-color\");\r\n    }\r\n\r\n    g.strokeStyle = color;\r\n    g.stroke();\r\n\r\n    let co = this._getButtonPos();\r\n\r\n    g.beginPath();\r\n\r\n    if (this.highlight === 2) {\r\n      color = this.getDefault(\"BoxHighlight\");\r\n    } else {\r\n      color = this.getDefault(\"border-color\");\r\n    }\r\n\r\n    g.arc(co[0], co[1], Math.abs(co[2]), -Math.PI, Math.PI);\r\n    g.fill();\r\n\r\n    g.strokeStyle = color;\r\n    g.stroke();\r\n\r\n    g.beginPath();\r\n    g.setLineDash([4, 4]);\r\n\r\n    if (this._focus) {\r\n      g.strokeStyle = this.getDefault(\"BoxHighlight\");\r\n      g.arc(co[0], co[1], co[2] - 4, -Math.PI, Math.PI);\r\n      g.stroke();\r\n    }\r\n\r\n    g.setLineDash([]);\r\n  }\r\n\r\n  isOverButton(e) {\r\n    let x = e.x, y = e.y;\r\n    let rect = this.getClientRects()[0];\r\n\r\n    if (!rect) {\r\n      return false;\r\n    }\r\n\r\n    x -= rect.left;\r\n    y -= rect.top;\r\n\r\n    let co = this._getButtonPos();\r\n\r\n    let dpi = UIBase.getDPI();\r\n    let dv = new Vector2([co[0]/dpi - x, co[1]/dpi - y]);\r\n    let dis = dv.vectorLength();\r\n\r\n    return dis < co[2]/dpi;\r\n  }\r\n\r\n  _invertButtonX(x) {\r\n    let w = this.canvas.width;\r\n    let dpi = UIBase.getDPI();\r\n    let sh = ~~(this.getDefault(\"SlideHeight\")*dpi + 0.5);\r\n    let boxw = this.canvas.height - 4;\r\n    let w2 = w - boxw;\r\n\r\n    let range = this.uiRange || this.range;\r\n\r\n    x = (x - boxw*0.5)/w2;\r\n    x = x*(range[1] - range[0]) + range[0];\r\n\r\n    return x;\r\n  }\r\n\r\n  _getButtonPos() {\r\n    let w = this.canvas.width;\r\n    let dpi = UIBase.getDPI();\r\n    let sh = ~~(this.getDefault(\"SlideHeight\")*dpi + 0.5);\r\n    let x = this._value;\r\n\r\n    let range = this.uiRange || this.range;\r\n\r\n    x = (x - range[0])/(range[1] - range[0]);\r\n\r\n    let boxw = this.canvas.height - 4;\r\n    let w2 = w - boxw;\r\n\r\n    x = x*w2 + boxw*0.5;\r\n\r\n    return [x, boxw*0.5, boxw*0.5];\r\n  }\r\n\r\n  setCSS() {\r\n    //UIBase.setCSS does annoying thing with background-color\r\n    //super.setCSS();\r\n\r\n    this.canvas.style[\"width\"] = \"min-contents\";\r\n    this.canvas.style[\"min-width\"] = this.getDefault(\"width\") + \"px\";\r\n    this.canvas.style[\"height\"] = this.getDefault(\"height\") + \"px\";\r\n\r\n    this.canvas.height = this.getDefault(\"height\")*UIBase.getDPI();\r\n\r\n    this.style[\"min-width\"] = this.getDefault(\"width\") + \"px\";\r\n    this._redraw();\r\n  }\r\n\r\n  updateSize() {\r\n    if (this.canvas === undefined) {\r\n      return;\r\n    }\r\n\r\n    let rect = this.getClientRects()[0];\r\n\r\n    if (rect === undefined) {\r\n      return;\r\n    }\r\n\r\n    let dpi = UIBase.getDPI();\r\n    let w = ~~(rect.width*dpi), h = ~~(rect.height*dpi);\r\n    let canvas = this.canvas;\r\n\r\n    if (w !== canvas.width || h !== canvas.height) {\r\n      this.canvas.width = w;\r\n      this.canvas.height = h;\r\n\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _ondestroy() {\r\n    if (this.modalRunning) {\r\n      this.popModal();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    let key = this.getDefault(\"width\") + this.getDefault(\"height\") + this.getDefault(\"SlideHeight\");\r\n    if (key !== this._last_slider_key) {\r\n      this._last_slider_key = key;\r\n\r\n      this.flushUpdate();\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n\r\n    if (this.getAttribute(\"tab-index\") !== this.tabIndex) {\r\n      this.tabIndex = this.getAttribute(\"tab-index\");\r\n    }\r\n\r\n    this.updateSize();\r\n    this.updateDataPath();\r\n    updateSliderFromDom(this);\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(NumSliderSimpleBase);\r\n\r\nexport class SliderWithTextbox extends ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this._value = 0;\r\n    this._name = undefined;\r\n    this._lock_textbox = false;\r\n    this._labelOnTop = undefined;\r\n\r\n    this._last_label_on_top = undefined;\r\n\r\n    this.container = this;\r\n\r\n    this.textbox = UIBase.createElement(\"textbox-x\");\r\n    this.textbox.width = 55;\r\n    this._numslider = undefined;\r\n\r\n    this.textbox.overrideDefault(\"width\", this.getDefault(\"TextBoxWidth\"));\r\n    this.textbox.setAttribute(\"class\", \"numslider_simple_textbox\");\r\n\r\n    this._last_value = undefined;\r\n  }\r\n\r\n  /**\r\n   * whether to put label on top or to the left of sliders\r\n   *\r\n   * If undefined value will be either this.getAtttribute(\"labelOnTop\"),\r\n   * if \"labelOnTop\" attribute exists, or it will be this.getDefault(\"labelOnTop\")\r\n   * (theme default)\r\n   **/\r\n  get labelOnTop() {\r\n    let ret = this._labelOnTop;\r\n\r\n    if (ret === undefined && this.hasAttribute(\"labelOnTop\")) {\r\n      let val = this.getAttribute(\"labelOnTop\");\r\n      if (typeof val === \"string\") {\r\n        val = val.toLowerCase();\r\n        ret = val === \"true\" || val === \"yes\";\r\n      } else {\r\n        ret = !!val;\r\n      }\r\n    }\r\n\r\n    if (ret === undefined) {\r\n      ret = this.getDefault(\"labelOnTop\");\r\n    }\r\n\r\n    return !!ret;\r\n  }\r\n\r\n  set labelOnTop(v) {\r\n    this._labelOnTop = v;\r\n  }\r\n\r\n  get numslider() {\r\n    return this._numslider;\r\n  }\r\n\r\n  //child classes set this in their constructors\r\n  set numslider(v) {\r\n    this._numslider = v;\r\n    this.textbox.range = this._numslider.range;\r\n  }\r\n\r\n  get editAsBaseUnit() {\r\n    return this.numslider.editAsBaseUnit;\r\n  }\r\n\r\n  set editAsBaseUnit(v) {\r\n    this.numslider.editAsBaseUnit = v;\r\n  }\r\n\r\n  get range() {\r\n    return this.numslider.range;\r\n  }\r\n\r\n  set range(v) {\r\n    this.numslider.range = v;\r\n  }\r\n\r\n  get step() {\r\n    return this.numslider.step;\r\n  }\r\n\r\n  set step(v) {\r\n    this.numslider.step = v;\r\n  }\r\n\r\n  get expRate() {\r\n    return this.numslider.expRate;\r\n  }\r\n\r\n  set expRate(v) {\r\n    this.numslider.expRate = v;\r\n  }\r\n\r\n  get decimalPlaces() {\r\n    return this.numslider.decimalPlaces;\r\n  }\r\n\r\n  set decimalPlaces(v) {\r\n    this.numslider.decimalPlaces = v;\r\n  }\r\n\r\n  get isInt() {\r\n    return this.numslider.isInt;\r\n  }\r\n\r\n  set isInt(v) {\r\n    this.numslider.isInt = v;\r\n  }\r\n\r\n  get slideSpeed() {\r\n    return this.numslider.slideSpeed;\r\n  }\r\n\r\n  set slideSpeed(v) {\r\n    this.numslider.slideSpeed = v;\r\n  }\r\n\r\n  get radix() {\r\n    return this.numslider.radix;\r\n  }\r\n\r\n  set radix(v) {\r\n    this.numslider.radix = v;\r\n  }\r\n\r\n  get stepIsRelative() {\r\n    return this.numslider.stepIsRelative;\r\n  }\r\n\r\n  set stepIsRelative(v) {\r\n    this.numslider.stepIsRelative = v;\r\n  }\r\n\r\n  get displayUnit() {\r\n    return this.numslider.displayUnit;\r\n  }\r\n\r\n  set displayUnit(val) {\r\n    let update = val !== this.displayUnit;\r\n\r\n    this.numslider.displayUnit = this.textbox.displayUnit = val;\r\n\r\n    if (update) {\r\n      //this.numslider._redraw();\r\n      this.updateTextBox();\r\n    }\r\n  }\r\n\r\n  get baseUnit() {\r\n    return this.textbox.baseUnit;\r\n  }\r\n\r\n  set baseUnit(val) {\r\n    let update = val !== this.baseUnit;\r\n\r\n    this.numslider.baseUnit = this.textbox.baseUnit = val;\r\n\r\n    if (update) {\r\n      //this.slider._redraw();\r\n      this.updateTextBox();\r\n    }\r\n  }\r\n\r\n  get realTimeTextBox() {\r\n    let ret = this.getAttribute(\"realtime\");\r\n\r\n    if (!ret) {\r\n      return false;\r\n    }\r\n\r\n    ret = ret.toLowerCase().trim();\r\n\r\n    return ret === 'true' || ret === 'on' || ret === 'yes';\r\n  }\r\n\r\n  set realTimeTextBox(val) {\r\n    this.setAttribute(\"realtime\", val ? \"true\" : \"false\");\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(val) {\r\n    this.setValue(val);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.rebuild();\r\n    window.setTimeout(() => this.updateTextBox(), 500);\r\n  }\r\n\r\n  rebuild() {\r\n    this._last_label_on_top = this.labelOnTop;\r\n\r\n    this.container.clear();\r\n\r\n    if (!this.labelOnTop) {\r\n      this.container = this.row();\r\n    } else {\r\n      this.container = this;\r\n    }\r\n\r\n    if (this.hasAttribute(\"name\")) {\r\n      this._name = this.hasAttribute(\"name\");\r\n    } else {\r\n      this._name = \"slider\";\r\n    }\r\n\r\n\r\n    this.l = this.container.label(this._name);\r\n    this.l.overrideClass(\"numslider_textbox\");\r\n    this.l.font = \"TitleText\";\r\n    this.l.style[\"display\"] = \"float\";\r\n    this.l.style[\"position\"] = \"relative\";\r\n\r\n    let strip = this.container.row();\r\n    //strip.style['justify-content'] = 'space-between';\r\n    strip.add(this.numslider);\r\n\r\n    let path = this.hasAttribute(\"datapath\") ? this.getAttribute(\"datapath\") : undefined;\r\n\r\n    let textbox = this.textbox;\r\n    this.textbox.overrideDefault(\"width\", this.getDefault(\"TextBoxWidth\"));\r\n\r\n    let apply_textbox = () => {\r\n      let text = textbox.text;\r\n\r\n      if (!units.isNumber(text)) {\r\n        textbox.flash(\"red\");\r\n        return;\r\n      } else {\r\n        textbox.flash(\"green\");\r\n\r\n        let displayUnit = this.editAsBaseUnit ? undefined : this.displayUnit;\r\n\r\n        let f = units.parseValue(text, this.baseUnit, displayUnit);\r\n\r\n        if (isNaN(f)) {\r\n          this.flash(\"red\");\r\n          return;\r\n        }\r\n\r\n        if (this.isInt) {\r\n          f = Math.floor(f);\r\n        }\r\n\r\n        this._lock_textbox = 1;\r\n        this.setValue(f);\r\n        this._lock_textbox = 0;\r\n\r\n      }\r\n    };\r\n\r\n    if (this.realTimeTextBox) {\r\n      textbox.onchange = apply_textbox;\r\n    }\r\n\r\n    textbox.onend = apply_textbox;\r\n\r\n    textbox.ctx = this.ctx;\r\n    textbox.packflag |= this.inherit_packflag;\r\n    textbox.overrideDefault(\"width\", this.getDefault(\"TextBoxWidth\"));\r\n\r\n    textbox.style[\"height\"] = (this.getDefault(\"height\") - 2) + \"px\";\r\n    textbox._init();\r\n\r\n    strip.add(textbox);\r\n\r\n    textbox.setCSS();\r\n    this.linkTextBox();\r\n\r\n    let in_onchange = 0;\r\n\r\n    this.numslider.onchange = (val) => {\r\n      this._value = this.numslider.value;\r\n      this.updateTextBox();\r\n\r\n      if (in_onchange) {\r\n        return;\r\n      }\r\n\r\n      if (this.onchange !== undefined) {\r\n        in_onchange++;\r\n        try {\r\n          if (this.onchange) {\r\n            this.onchange(this);\r\n          }\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n        }\r\n      }\r\n\r\n      in_onchange--;\r\n    }\r\n  }\r\n\r\n  updateTextBox() {\r\n    if (!this._init_done) {\r\n      return;\r\n    }\r\n\r\n    if (this._lock_textbox > 0)\r\n      return;\r\n\r\n    this.textbox.text = this.formatNumber(this._value);\r\n    this.textbox.update();\r\n\r\n    updateSliderFromDom(this, this.numslider);\r\n  }\r\n\r\n  linkTextBox() {\r\n    this.updateTextBox();\r\n\r\n    let onchange = this.numslider.onchange;\r\n    this.numslider.onchange = (e) => {\r\n      this._value = e.value;\r\n      this.updateTextBox();\r\n\r\n      onchange(e);\r\n    }\r\n  }\r\n\r\n  setValue(val, fire_onchange = true) {\r\n    this._value = val;\r\n    this.numslider.setValue(val, fire_onchange);\r\n    this.updateTextBox();\r\n  }\r\n\r\n  updateName() {\r\n    let name = this.getAttribute(\"name\");\r\n\r\n    if (!name && this.hasAttribute(\"datapath\")) {\r\n      let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n      if (prop) {\r\n        name = prop.uiname;\r\n      }\r\n    }\r\n\r\n    if (!name) {\r\n      name = \"[error]\";\r\n    }\r\n\r\n    if (name !== this._name) {\r\n      this._name = name;\r\n      this.l.text = name;\r\n    }\r\n  }\r\n\r\n  updateLabelOnTop() {\r\n    if (this.labelOnTop !== this._last_label_on_top) {\r\n      this._last_label_on_top = this.labelOnTop;\r\n      this.rebuild();\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.ctx || !this.getAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"))\r\n\r\n    if (!prop) {\r\n      return;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n    if (val !== this._last_value) {\r\n      this._last_value = this._value = val;\r\n      this.updateTextBox();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    this.updateLabelOnTop();\r\n    super.update();\r\n\r\n    this.updateDataPath();\r\n    let redraw = false;\r\n\r\n    updateSliderFromDom(this.numslider, this);\r\n    updateSliderFromDom(this.textbox, this);\r\n\r\n    if (redraw) {\r\n      this.setCSS();\r\n      this.numslider.setCSS();\r\n      this.numslider._redraw();\r\n    }\r\n\r\n    this.updateName();\r\n\r\n    this.numslider.description = this.description;\r\n    this.textbox.description = this.title; //get full, transformed toolip\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.numslider.setAttribute(\"datapath\", this.getAttribute(\"datapath\"));\r\n    }\r\n\r\n    if (this.hasAttribute(\"mass_set_path\")) {\r\n      this.numslider.setAttribute(\"mass_set_path\", this.getAttribute(\"mass_set_path\"))\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n    this.textbox.setCSS();\r\n    //textbox.style[\"margin\"] = \"5px\";\r\n\r\n  }\r\n}\r\n\r\nexport class NumSliderSimple extends SliderWithTextbox {\r\n  constructor() {\r\n    super();\r\n\r\n    this.numslider = UIBase.createElement(\"numslider-simple-base-x\");\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"numslider-simple-x\",\r\n      style  : \"numslider_simple\"\r\n    }\r\n  }\r\n\r\n  _redraw() {\r\n    this.numslider._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(NumSliderSimple);\r\n\r\nexport class NumSliderWithTextBox extends SliderWithTextbox {\r\n  constructor() {\r\n    super();\r\n\r\n    this.numslider = UIBase.createElement(\"numslider-x\");\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"numslider-textbox-x\",\r\n      style  : \"numslider_textbox\"\r\n    }\r\n  }\r\n\r\n  _redraw() {\r\n    this.numslider._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(NumSliderWithTextBox);\r\n\r\n","//stores xml sources\r\nimport {isNumber} from '../path-controller/toolsys/toolprop.js';\r\n\r\nlet pagecache = new Map()\r\nimport {PackFlags, UIBase} from '../core/ui_base.js';\r\nimport {sliderDomAttributes} from '../widgets/ui_numsliders.js';\r\nimport * as util from '../util/util.js';\r\nimport {Menu} from '../widgets/ui_menu.js';\r\nimport {Icons} from '../core/ui_base.js';\r\nimport {Container} from '../core/ui.js';\r\n\r\nexport var domTransferAttrs = new Set([\"id\", \"title\", \"tab-index\"]);\r\nexport var domEventAttrs = new Set([\"click\", \"mousedown\", \"mouseup\", \"mousemove\", \"keydown\", \"keypress\"]);\r\n\r\nexport function parseXML(xml) {\r\n  let parser = new DOMParser()\r\n  xml = `<root>${xml}</root>`;\r\n  return parser.parseFromString(xml.trim(), \"application/xml\");\r\n}\r\n\r\nlet num_re = /[0-9]+$/;\r\n\r\nfunction getIconFlag(elem) {\r\n  if (!elem.hasAttribute(\"useIcons\")) {\r\n    return 0;\r\n  }\r\n\r\n  let attr = elem.getAttribute(\"useIcons\");\r\n\r\n  if (typeof attr === \"string\") {\r\n    attr = attr.toLowerCase().trim();\r\n  }\r\n\r\n  if (attr === \"false\" || attr === \"no\") {\r\n    return 0;\r\n  }\r\n\r\n  if (attr === \"true\" || attr === \"yes\") {\r\n    return PackFlags.USE_ICONS;\r\n  } else if (attr === \"small\") {\r\n    return PackFlags.SMALL_ICON | PackFlags.USE_ICONS;\r\n  } else if (attr === \"large\") {\r\n    return PackFlags.LARGE_ICON | PackFlags.USE_ICONS;\r\n  } else {\r\n    let isnum = typeof attr === \"number\";\r\n    let sheet = attr;\r\n\r\n    if (typeof sheet === \"string\" && sheet.search(num_re) === 0) {\r\n      sheet = parseInt(sheet);\r\n      isnum = true;\r\n    }\r\n\r\n    if (!isnum) {\r\n      return PackFlags.USE_ICONS;\r\n    }\r\n\r\n    let flag = PackFlags.USE_ICONS | PackFlags.CUSTOM_ICON_SHEET;\r\n    flag |= ((sheet - 1)<<PackFlags.CUSTOM_ICON_SHEET_START);\r\n\r\n    return flag;\r\n  }\r\n\r\n  return 0;\r\n}\r\n\r\nfunction getPackFlag(elem) {\r\n  let packflag = getIconFlag(elem);\r\n\r\n  if (elem.hasAttribute(\"drawChecks\")) {\r\n    if (!getbool(elem, \"drawChecks\")) {\r\n      packflag |= PackFlags.HIDE_CHECK_MARKS;\r\n    } else {\r\n      packflag &= ~PackFlags.HIDE_CHECK_MARKS;\r\n    }\r\n  }\r\n\r\n  if (getbool(elem, \"simpleSlider\")) {\r\n    packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n  }\r\n  if (getbool(elem, \"rollarSlider\")) {\r\n    packflag |= PackFlags.FORCE_ROLLER_SLIDER;\r\n  }\r\n\r\n  return packflag;\r\n}\r\n\r\nfunction myParseFloat(s) {\r\n  s = '' + s;\r\n  s = s.trim().toLowerCase();\r\n\r\n  if (s.endsWith(\"px\")) {\r\n    s = s.slice(0, s.length - 2);\r\n  }\r\n\r\n  return parseFloat(s);\r\n}\r\n\r\nfunction getbool(elem, attr) {\r\n  let ret = elem.getAttribute(attr);\r\n  if (!ret) {\r\n    return false;\r\n  }\r\n\r\n  ret = ret.toLowerCase();\r\n  return ret === \"1\" || ret === \"true\" || ret === \"yes\";\r\n}\r\n\r\nfunction getfloat(elem, attr, defaultval) {\r\n  if (!elem.hasAttribute(attr)) {\r\n    return defaultval;\r\n  }\r\n\r\n  return myParseFloat(elem.getAttribute(attr));\r\n}\r\n\r\n/*\r\n**\r\n*\r\n* a customHandler can be a callback, or the string \"default\", e.g.\r\n*\r\n* xmlpage.customHandlers[\"homegig-element-x\"] = \"default\".\r\n*\r\n* The default case simply suppresses the warning that would otherwise\r\n* be printed to the console.\r\n* */\r\nexport const customHandlers = {};\r\n\r\nclass Handler {\r\n  constructor(ctx, container) {\r\n    this.container = container;\r\n    this.stack = [];\r\n    this.ctx = ctx;\r\n    this.codefuncs = {};\r\n\r\n    this.templateVars = {};\r\n\r\n    let attrs = util.list(sliderDomAttributes);\r\n\r\n    //note that useIcons, showLabel and sliderMode are PackFlag bits and are inherited through that system\r\n\r\n    this.inheritDomAttrs = {};\r\n    this.inheritDomAttrKeys = new Set(attrs);\r\n  }\r\n\r\n  push() {\r\n    this.stack.push(this.container);\r\n    this.stack.push(new Set(this.inheritDomAttrKeys));\r\n    this.stack.push(Object.assign({}, this.inheritDomAttrs));\r\n  }\r\n\r\n  pop() {\r\n    this.inheritDomAttrs = this.stack.pop();\r\n    this.inheritDomAttrKeys = this.stack.pop();\r\n    this.container = this.stack.pop();\r\n  }\r\n\r\n  handle(elem) {\r\n    if (elem.constructor === XMLDocument || elem.nodeName === 'root') {\r\n      for (let child of elem.childNodes) {\r\n        this.handle(child);\r\n      }\r\n\r\n      window.tree = elem\r\n      return;\r\n    } else if (elem.constructor === Text || elem.constructor === Comment) {\r\n      return;\r\n    }\r\n\r\n    let tagname = \"\" + elem.tagName;\r\n\r\n    if (tagname in customHandlers) {\r\n      customHandlers[tagname](this, elem);\r\n    } else if (this[tagname]) {\r\n      this[tagname](elem);\r\n    } else {\r\n      let elem2 = UIBase.createElement(tagname.toLowerCase());\r\n\r\n      window.__elem = elem;\r\n      //transfer DOM attributes\r\n      for (let k of elem.getAttributeNames()) {\r\n        elem2.setAttribute(k, elem.getAttribute(k));\r\n      }\r\n\r\n      if (elem2 instanceof UIBase) {\r\n        if (!elem2.hasAttribute(\"datapath\") && elem2.hasAttribute(\"path\")) {\r\n          elem2.setAttribute(\"datapath\", elem2.getAttribute(\"path\"));\r\n        }\r\n\r\n        if (elem2.hasAttribute(\"datapath\")) {\r\n          let path = elem2.getAttribute(\"datapath\");\r\n          path = this.container._joinPrefix(path);\r\n          elem2.setAttribute(\"datapath\", path);\r\n        }\r\n\r\n        if (elem2.hasAttribute(\"massSetPath\") || this.container.massSetPrefix) {\r\n          let massSetPath = \"\";\r\n\r\n          if (elem2.hasAttribute(\"massSetPath\")) {\r\n            massSetPath = elem2.getAttribute(\"massSetPath\");\r\n          }\r\n\r\n          let path = elem2.getAttribute(\"datapath\");\r\n\r\n          path = this.container._getMassPath(this.container.ctx, path, massSetPath);\r\n          elem2.setAttribute(\"massSetPath\", path);\r\n          elem2.setAttribute(\"mass_set_path\", path);\r\n        }\r\n\r\n        this.container.add(elem2);\r\n        this._style(elem, elem2);\r\n\r\n        if (elem2 instanceof Container) {\r\n          this.push();\r\n\r\n          this.container = elem2;\r\n          this._container(elem, elem2, true);\r\n          this.visit(elem);\r\n\r\n          this.pop();\r\n\r\n          return;\r\n        }\r\n      } else {\r\n        console.warn(\"Unknown element \" + elem.tagName + \" (\" + elem.constructor.name + \")\");\r\n        let elem2 = document.createElement(elem.tagName.toLowerCase());\r\n\r\n        for (let attr of elem.getAttributeNames()) {\r\n          elem2.setAttribute(attr, elem.getAttribute(attr));\r\n        }\r\n\r\n        this._basic(elem, elem2);\r\n\r\n        this.container.shadow.appendChild(elem2);\r\n\r\n        if (!(elem2 instanceof UIBase)) {\r\n          elem2.pathux_ctx = this.container.ctx;\r\n        } else {\r\n          elem2.ctx = this.container.ctx;\r\n        }\r\n      }\r\n\r\n      this.visit(elem);\r\n    }\r\n  }\r\n\r\n  _style(elem, elem2) {\r\n    let style = {};\r\n\r\n    //try to handle class attribute, at least somewhat\r\n\r\n    if (elem.hasAttribute(\"class\")) {\r\n      elem2.setAttribute(\"class\", elem.getAttribute(\"class\"));\r\n\r\n      let cls = elem2.getAttribute(\"class\").trim();\r\n      let keys = [\r\n        cls,\r\n        (elem2.tagName.toLowerCase() + \".\" + cls).trim(),\r\n        \"#\" + elem.getAttribute(\"id\").trim()\r\n      ];\r\n\r\n      for (let sheet of document.styleSheets) {\r\n        for (let rule of sheet.rules) {\r\n          for (let k of keys) {\r\n            if (rule.selectorText.trim() === k) {\r\n              for (let k2 of rule.styleMap.keys()) {\r\n                let val = rule.style[k2]\r\n\r\n                style[k2] = val;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (elem.hasAttribute(\"style\")) {\r\n      let stylecode = elem.getAttribute(\"style\");\r\n\r\n      stylecode = stylecode.split(\";\");\r\n\r\n      for (let row of stylecode) {\r\n        row = row.trim();\r\n\r\n        let i = row.search(/\\:/);\r\n        if (i >= 0) {\r\n          let key = row.slice(0, i).trim();\r\n          let val = row.slice(i + 1, row.length).trim();\r\n\r\n          style[key] = val;\r\n        }\r\n      }\r\n    }\r\n\r\n    let keys = Object.keys(style);\r\n    if (keys.length === 0) {\r\n      return;\r\n    }\r\n\r\n    function setStyle() {\r\n      for (let k of keys) {\r\n        elem2.style[k] = style[k];\r\n      }\r\n    }\r\n\r\n    if (elem2 instanceof UIBase) {\r\n      elem2.setCSS.after(() => {\r\n        setStyle();\r\n      });\r\n    }\r\n\r\n    setStyle();\r\n  }\r\n\r\n  visit(node) {\r\n    for (let child of node.childNodes) {\r\n      this.handle(child)\r\n    }\r\n  }\r\n\r\n  _getattr(elem, k) {\r\n    let val = elem.getAttribute(k);\r\n\r\n    if (!val) {\r\n      return val;\r\n    }\r\n\r\n    if (val.startsWith(\"##\")) {\r\n      val = val.slice(2, val.length).trim();\r\n\r\n      if (!(val in this.templateVars)) {\r\n        console.error(`unknown template variable '${val}'`);\r\n        val = '';\r\n      } else {\r\n        val = this.templateVars[val];\r\n      }\r\n    }\r\n\r\n    return val;\r\n  }\r\n\r\n  _basic(elem, elem2) {\r\n    this._style(elem, elem2);\r\n\r\n    for (let k of elem.getAttributeNames()) {\r\n      if (k.startsWith(\"custom\")) {\r\n        elem2.setAttribute(k, this._getattr(elem, k));\r\n      }\r\n    }\r\n\r\n    let codeattrs = [];\r\n\r\n    for (let k of elem.getAttributeNames()) {\r\n      let val = \"\"+elem.getAttribute(k);\r\n\r\n      if (val.startsWith('ng[')) {\r\n        val = val.slice(3, val.endsWith(\"]\") ? val.length-1 : val.length);\r\n\r\n        codeattrs.push([k, \"ng\", val]);\r\n      }\r\n    }\r\n\r\n    for (let k of domEventAttrs) {\r\n      let k2 = 'on' + k;\r\n\r\n      if (elem.hasAttribute(k2)) {\r\n        codeattrs.push([k, \"dom\", elem.getAttribute(k2)]);\r\n      }\r\n    }\r\n\r\n    for (let [k, eventType, id] of codeattrs) {\r\n      if (!(id in this.codefuncs)) {\r\n        console.error(\"Unknown code fragment \" + id);\r\n        continue;\r\n      }\r\n\r\n      if (eventType === \"dom\") {\r\n        //click events usually don't go through normal\r\n        //dom event system\r\n        if (k === 'click') {\r\n          let onclick = elem2.onclick;\r\n          let func = this.codefuncs[id];\r\n\r\n          elem2.onclick = function () {\r\n            if (onclick) {\r\n              onclick.apply(this, arguments);\r\n            }\r\n\r\n            return func.apply(this, arguments);\r\n          }\r\n        } else {\r\n          elem2.addEventListener(k, this.codefuncs[id]);\r\n        }\r\n      } else if (eventType === \"ng\") {\r\n        elem2.addEventListener(k, this.codefuncs[id]);\r\n      }\r\n    }\r\n\r\n\r\n    for (let k of domTransferAttrs) {\r\n      if (elem.hasAttribute(k)) {\r\n        elem2.setAttribute(k, elem.getAttribute(k));\r\n      }\r\n    }\r\n\r\n    for (let k in this.inheritDomAttrs) {\r\n      if (!elem.hasAttribute(k)) {\r\n        elem.setAttribute(k, this.inheritDomAttrs[k]);\r\n      }\r\n    }\r\n\r\n    for (let k of sliderDomAttributes) {\r\n      if (elem.hasAttribute(k)) {\r\n        elem2.setAttribute(k, elem.getAttribute(k));\r\n      }\r\n    }\r\n\r\n    if (!(elem2 instanceof UIBase)) {\r\n      return;\r\n    }\r\n\r\n    if (elem.hasAttribute(\"theme-class\")) {\r\n      elem2.overrideClass(elem.getAttribute(\"theme-class\"));\r\n\r\n      if (elem2._init_done) {\r\n        elem2.setCSS();\r\n        elem2.flushUpdate();\r\n      }\r\n    }\r\n\r\n    if (elem.hasAttribute(\"useIcons\") && typeof elem2.useIcons === \"function\") {\r\n      let val = elem.getAttribute(\"useIcons\").trim().toLowerCase();\r\n\r\n      if (val === \"small\" || val === \"true\" || val === \"yes\") {\r\n        val = true;\r\n      } else if (val === \"large\") {\r\n        val = 1;\r\n      } else if (val === \"false\" || val === \"no\") {\r\n        val = false;\r\n      } else {\r\n        val = parseInt(val) - 1;\r\n      }\r\n\r\n      elem2.useIcons(val);\r\n    }\r\n\r\n    if (elem.hasAttribute(\"sliderTextBox\")) {\r\n      let textbox = getbool(elem, \"sliderTextBox\");\r\n\r\n      if (textbox) {\r\n        elem2.packflag &= ~PackFlags.NO_NUMSLIDER_TEXTBOX;\r\n        elem2.inherit_packflag &= ~PackFlags.NO_NUMSLIDER_TEXTBOX;\r\n      } else {\r\n        elem2.packflag |= PackFlags.NO_NUMSLIDER_TEXTBOX;\r\n        elem2.inherit_packflag |= PackFlags.NO_NUMSLIDER_TEXTBOX;\r\n      }\r\n\r\n      //console.error(\"textBox\", textbox, elem2, elem.getAttribute(\"sliderTextBox\"), elem2.packflag);\r\n    }\r\n\r\n    if (elem.hasAttribute(\"sliderMode\")) {\r\n      let sliderMode = elem.getAttribute(\"sliderMode\");\r\n\r\n      if (sliderMode === \"slider\") {\r\n        elem2.packflag &= ~PackFlags.FORCE_ROLLER_SLIDER;\r\n        elem2.inherit_packflag &= ~PackFlags.FORCE_ROLLER_SLIDER;\r\n\r\n        elem2.packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n        elem2.inherit_packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n      } else if (sliderMode === \"roller\") {\r\n        elem2.packflag &= ~PackFlags.SIMPLE_NUMSLIDERS;\r\n        elem2.packflag |= PackFlags.FORCE_ROLLER_SLIDER;\r\n\r\n        elem2.inherit_packflag &= ~PackFlags.SIMPLE_NUMSLIDERS;\r\n        elem2.inherit_packflag |= PackFlags.FORCE_ROLLER_SLIDER;\r\n      }\r\n\r\n      //console.error(\"sliderMode\", sliderMode, elem2, elem2.packflag & (PackFlags.SIMPLE_NUMSLIDERS | PackFlags.FORCE_ROLLER_SLIDER));\r\n    }\r\n\r\n    if (elem.hasAttribute(\"showLabel\")) {\r\n      let state = getbool(elem, \"showLabel\");\r\n\r\n      if (state) {\r\n        elem2.packflag |= PackFlags.FORCE_PROP_LABELS;\r\n        elem2.inherit_packflag |= PackFlags.FORCE_PROP_LABELS;\r\n      } else {\r\n        elem2.packflag &= ~PackFlags.FORCE_PROP_LABELS;\r\n        elem2.inherit_packflag &= ~PackFlags.FORCE_PROP_LABELS;\r\n      }\r\n    }\r\n\r\n    function doBox(key) {\r\n      if (elem.hasAttribute(key)) {\r\n        let val = elem.getAttribute(key).toLowerCase().trim();\r\n\r\n        if (val.endsWith(\"px\")) {\r\n          val = val.slice(0, val.length - 2).trim();\r\n        }\r\n\r\n        if (val.endsWith(\"%\")) {\r\n          //eek! don't support at all?\r\n          //or use aspect overlay?\r\n\r\n          console.warn(`Relative styling of '${key}' may be unstable for this element`, elem);\r\n\r\n          elem.setCSS.after(function () {\r\n            this.style[key] = val;\r\n          });\r\n        } else {\r\n          val = parseFloat(val);\r\n\r\n          if (isNaN(val) || typeof val !== \"number\") {\r\n            console.error(`Invalid style ${key}:${elem.getAttribute(key)}`);\r\n            return;\r\n          }\r\n\r\n          elem2.overrideDefault(key, val);\r\n          elem2.setCSS();\r\n          elem2.style[key] = \"\" + val + \"px\";\r\n        }\r\n      }\r\n    }\r\n\r\n    doBox(\"width\");\r\n    doBox(\"height\");\r\n    doBox(\"margin\");\r\n    doBox(\"padding\");\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let key = i ? \"margin\" : \"padding\";\r\n\r\n      doBox(key + \"-bottom\");\r\n      doBox(key + \"-top\");\r\n      doBox(key + \"-left\");\r\n      doBox(key + \"-right\");\r\n    }\r\n  }\r\n\r\n  _handlePathPrefix(elem, con) {\r\n    if (elem.hasAttribute(\"path\")) {\r\n      let prefix = con.dataPrefix;\r\n      let path = elem.getAttribute(\"path\").trim();\r\n\r\n      if (prefix.length > 0) {\r\n        prefix += \".\";\r\n      }\r\n\r\n      prefix += path;\r\n      con.dataPrefix = prefix;\r\n    }\r\n\r\n    if (elem.hasAttribute(\"massSetPath\")) {\r\n      let prefix = con.massSetPrefix;\r\n      let path = elem.getAttribute(\"massSetPath\").trim();\r\n\r\n      if (prefix.length > 0) {\r\n        prefix += \".\";\r\n      }\r\n\r\n      prefix += path;\r\n      con.massSetPrefix = prefix;\r\n    }\r\n  }\r\n\r\n  _container(elem, con, ignorePathPrefix=false) {\r\n    for (let k of this.inheritDomAttrKeys) {\r\n      if (elem.hasAttribute(k)) {\r\n        this.inheritDomAttrs[k] = elem.getAttribute(k);\r\n      }\r\n    }\r\n\r\n    let packflag = getPackFlag(elem);\r\n\r\n    con.packflag |= packflag;\r\n    con.inherit_packflag |= packflag;\r\n\r\n    this._basic(elem, con);\r\n\r\n    if (!ignorePathPrefix) {\r\n      this._handlePathPrefix(elem, con);\r\n    }\r\n  }\r\n  noteframe(elem) {\r\n    let ret = this.container.noteframe();\r\n\r\n    if (ret) {\r\n      this._basic(elem, ret);\r\n    }\r\n  }\r\n\r\n  cell(elem) {\r\n    this.push();\r\n    this.container = this.container.cell();\r\n    this._container(elem, this.container);\r\n    this.visit(elem);\r\n    this.pop();\r\n  }\r\n\r\n  table(elem) {\r\n    this.push();\r\n    this.container = this.container.table();\r\n    this._container(elem, this.container);\r\n    this.visit(elem);\r\n    this.pop();\r\n  }\r\n\r\n  panel(elem) {\r\n    let title = \"\" + elem.getAttribute(\"label\")\r\n    let closed = getbool(elem, \"closed\")\r\n\r\n    this.push()\r\n    this.container = this.container.panel(title);\r\n    this.container.closed = closed;\r\n\r\n    this._container(elem, this.container);\r\n\r\n    this.visit(elem)\r\n\r\n    this.pop();\r\n  }\r\n\r\n  pathlabel(elem) {\r\n    this._prop(elem, \"pathlabel\")\r\n  }\r\n\r\n  /**\r\n   handle a code element, which are wrapped in functions\r\n   */\r\n  code(elem) {\r\n    window._codelem = elem;\r\n\r\n    let buf = '';\r\n\r\n    for (let elem2 of elem.childNodes) {\r\n      if (elem2.nodeName === \"#text\") {\r\n        buf += elem2.textContent + '\\n';\r\n      }\r\n    }\r\n\r\n    var func, $scope = this.templateScope;\r\n\r\n    buf = `\r\nfunc = function() {\r\n  ${buf};\r\n}\r\n    `;\r\n\r\n    eval(buf);\r\n\r\n    let id = \"\" + elem.getAttribute(\"id\");\r\n\r\n    this.codefuncs[id] = func;\r\n  }\r\n\r\n  textbox(elem) {\r\n    if (elem.hasAttribute(\"path\")) {\r\n      this._prop(elem, 'textbox');\r\n    } else {\r\n      //let elem2 = this.container.textbox();\r\n      //this._basic(elem, elem2);\r\n    }\r\n  }\r\n\r\n  label(elem) {\r\n    let elem2 = this.container.label(elem.innerHTML);\r\n    this._basic(elem, elem2);\r\n  }\r\n\r\n  colorfield(elem) {\r\n    this._prop(elem, \"colorfield\");\r\n  }\r\n\r\n  /** simpleSliders=true enables simple sliders */\r\n  prop(elem) {\r\n    this._prop(elem, \"prop\")\r\n  }\r\n\r\n  _prop(elem, key) {\r\n    let packflag = getPackFlag(elem);\r\n    let path = elem.getAttribute(\"path\");\r\n\r\n    let elem2;\r\n    if (key === 'pathlabel') {\r\n      elem2 = this.container.pathlabel(path, elem.innerHTML, packflag);\r\n    } else if (key === 'textbox') {\r\n      elem2 = this.container.textbox(path, undefined, undefined, packflag);\r\n\r\n      elem2.update();\r\n\r\n      //make textboxes non-modal by default\r\n      if (elem.hasAttribute(\"modal\")) {\r\n        elem2.setAttribute(\"modal\", elem.getAttribute(\"modal\"));\r\n      }\r\n\r\n      if (elem.hasAttribute(\"realtime\")) {\r\n        elem2.setAttribute(\"realtime\", elem.getAttribute(\"realtime\"));\r\n      }\r\n    } else if (key === \"colorfield\") {\r\n      elem2 = this.container.colorPicker(path, {\r\n        packflag,\r\n        themeOverride: elem.hasAttribute(\"theme-class\") ? elem.getAttribute(\"theme-class\") : undefined\r\n      });\r\n    } else {\r\n      elem2 = this.container[key](path, packflag);\r\n    }\r\n\r\n    if (!elem2) {\r\n      elem2 = document.createElement(\"span\");\r\n      elem2.innerHTML = \"error\";\r\n      this.container.shadow.appendChild(elem2);\r\n    } else {\r\n      this._basic(elem, elem2);\r\n\r\n      if (elem.hasAttribute(\"massSetPath\") || this.container.massSetPrefix) {\r\n        let mpath = elem.getAttribute(\"massSetPath\");\r\n        if (!mpath) {\r\n          mpath = elem.getAttribute(\"path\");\r\n        }\r\n\r\n        mpath = this.container._getMassPath(this.container.ctx, path, mpath);\r\n\r\n        elem2.setAttribute(\"mass_set_path\", mpath);\r\n      }\r\n    }\r\n  }\r\n\r\n  strip(elem) {\r\n    this.push();\r\n\r\n    let dir;\r\n    if (elem.hasAttribute(\"mode\")) {\r\n      dir = elem.getAttribute(\"mode\").toLowerCase().trim();\r\n      dir = dir === \"horizontal\";\r\n    }\r\n\r\n    let margin1 = getfloat(elem, \"margin1\", undefined);\r\n    let margin2 = getfloat(elem, \"margin2\", undefined);\r\n\r\n    this.container = this.container.strip(undefined, margin1, margin2, dir);\r\n    this._container(elem, this.container);\r\n    this.visit(elem);\r\n\r\n    this.pop();\r\n  }\r\n\r\n  column(elem) {\r\n    this.push();\r\n    this.container = this.container.col();\r\n    this._container(elem, this.container);\r\n    this.visit(elem);\r\n    this.pop();\r\n  }\r\n\r\n  row(elem) {\r\n    this.push();\r\n    this.container = this.container.row();\r\n    this._container(elem, this.container);\r\n    this.visit(elem);\r\n    this.pop();\r\n  }\r\n\r\n  toolPanel(elem) {\r\n    this.tool(elem, \"toolPanel\");\r\n  }\r\n\r\n  tool(elem, key = \"tool\") {\r\n    let path = elem.getAttribute(\"path\");\r\n    let packflag = getPackFlag(elem);\r\n\r\n    let noIcons = false, iconflags;\r\n\r\n    if (getbool(elem, \"useIcons\")) {\r\n      packflag |= PackFlags.USE_ICONS;\r\n    } else if (elem.hasAttribute(\"useIcons\")) {\r\n      packflag &= ~PackFlags.USE_ICONS;\r\n      noIcons = true;\r\n    }\r\n\r\n    let label = (\"\" + elem.textContent).trim()\r\n    if (label.length > 0) {\r\n      path += \"|\" + label;\r\n    }\r\n\r\n    if (noIcons) {\r\n      iconflags = this.container.useIcons(false);\r\n    }\r\n\r\n    let elem2 = this.container[key](path, packflag);\r\n\r\n    if (elem2) {\r\n      this._basic(elem, elem2);\r\n    } else {\r\n      elem2 = document.createElement(\"strip\")\r\n      elem2.innerHTML = \"error\"\r\n      this.container.shadow.appendChild(elem2);\r\n      this._basic(elem, elem2);\r\n    }\r\n\r\n    if (noIcons) {\r\n      this.container.inherit_packflag |= iconflags;\r\n      this.container.packflag |= iconflags;\r\n    }\r\n  }\r\n\r\n  dropbox(elem) {\r\n    return this.menu(elem, true);\r\n  }\r\n\r\n  menu(elem, isDropBox = false) {\r\n    let packflag = getPackFlag(elem);\r\n    let title = elem.getAttribute(\"name\")\r\n\r\n    let list = [];\r\n\r\n    for (let child of elem.childNodes) {\r\n      if (child.tagName === \"tool\") {\r\n        let path = child.getAttribute(\"path\");\r\n        let label = child.innerHTML.trim();\r\n\r\n        if (label.length > 0) {\r\n          path += \"|\" + label;\r\n        }\r\n\r\n        list.push(path);\r\n      } else if (child.tagName === \"sep\") {\r\n        list.push(Menu.SEP);\r\n      } else if (child.tagName === \"item\") {\r\n        let id, icon, hotkey, description;\r\n\r\n        if (child.hasAttribute(\"id\")) {\r\n          id = child.getAttribute(\"id\");\r\n        }\r\n\r\n        if (child.hasAttribute(\"icon\")) {\r\n          icon = child.getAttribute(\"icon\").toUpperCase().trim();\r\n          icon = Icons[icon];\r\n        }\r\n\r\n        if (child.hasAttribute(\"hotkey\")) {\r\n          hotkey = child.getAttribute(\"hotkey\");\r\n        }\r\n\r\n        if (child.hasAttribute(\"description\")) {\r\n          description = child.getAttribute(\"description\");\r\n        }\r\n\r\n        list.push({\r\n          name: child.innerHTML.trim(),\r\n          id, icon, hotkey, description\r\n        });\r\n      }\r\n    }\r\n\r\n    let ret = this.container.menu(title, list, packflag);\r\n    if (isDropBox) {\r\n      ret.removeAttribute(\"simple\");\r\n    }\r\n\r\n    if (elem.hasAttribute(\"id\")) {\r\n      ret.setAttribute(\"id\", elem.getAttribute(\"id\"));\r\n    }\r\n\r\n    this._basic(elem, ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  button(elem) {\r\n    let title = elem.innerHTML.trim();\r\n\r\n    let ret = this.container.button(title);\r\n\r\n    if (elem.hasAttribute(\"id\")) {\r\n      ret.setAttribute(\"id\", elem.getAttribute(\"id\"));\r\n    }\r\n\r\n    this._basic(elem, ret);\r\n  }\r\n\r\n  iconbutton(elem) {\r\n    let title = elem.innerHTML.trim();\r\n\r\n    let icon = elem.getAttribute(\"icon\");\r\n    if (icon) {\r\n      icon = UIBase.getIconEnum()[icon];\r\n    }\r\n    let ret = this.container.iconbutton(icon, title);\r\n\r\n    if (elem.hasAttribute(\"id\")) {\r\n      ret.setAttribute(\"id\", elem.getAttribute(\"id\"));\r\n    }\r\n\r\n    this._basic(elem, ret);\r\n  }\r\n\r\n  tab(elem) {\r\n    this.push();\r\n\r\n    let title = \"\" + elem.getAttribute(\"label\");\r\n\r\n    let tabs = this.container;\r\n\r\n    this.container = this.container.tab(title);\r\n\r\n    if (elem.hasAttribute(\"overflow\")) {\r\n      this.container.setAttribute(\"overflow\", elem.getAttribute(\"overflow\"));\r\n    }\r\n\r\n    if (elem.hasAttribute(\"overflow-y\")) {\r\n      this.container.setAttribute(\"overflow-y\", elem.getAttribute(\"overflow-y\"));\r\n    }\r\n\r\n    this._container(elem, this.container)\r\n    this.visit(elem);\r\n\r\n    this.pop();\r\n  }\r\n\r\n  tabs(elem) {\r\n    let pos = elem.getAttribute(\"pos\") || \"left\"\r\n\r\n    this.push();\r\n\r\n    let tabs = this.container.tabs(pos)\r\n    this.container = tabs;\r\n\r\n    if (elem.hasAttribute(\"movable-tabs\")) {\r\n      tabs.setAttribute(\"movable-tabs\", elem.getAttribute(\"movable-tabs\"));\r\n    }\r\n\r\n    this._container(elem, tabs);\r\n    this.visit(elem);\r\n\r\n    this.pop();\r\n  }\r\n}\r\n\r\nexport function initPage(ctx, xml, parentContainer = undefined, templateVars = {}, templateScope = {}) {\r\n  let tree = parseXML(xml);\r\n  let container = UIBase.createElement(\"container-x\");\r\n\r\n  container.ctx = ctx;\r\n  if (ctx) {\r\n    container._init();\r\n  }\r\n\r\n  if (parentContainer) {\r\n    parentContainer.add(container);\r\n  }\r\n\r\n  let handler = new Handler(ctx, container);\r\n\r\n  handler.templateVars = Object.assign({}, templateVars);\r\n  handler.templateScope = templateScope;\r\n\r\n  handler.handle(tree);\r\n\r\n  return container;\r\n\r\n}\r\n\r\nexport function loadPage(ctx, url, parentContainer_or_args = undefined, loadSourceOnly = false,\r\n                         modifySourceCB, templateVars, templateScope) {\r\n  let source;\r\n  let parentContainer;\r\n\r\n  if (parentContainer_or_args !== undefined && !(parentContainer_or_args instanceof HTMLElement)) {\r\n    let args = parentContainer_or_args;\r\n\r\n    parentContainer = args.parentContainer;\r\n    loadSourceOnly = args.loadSourceOnly;\r\n    modifySourceCB = args.modifySourceCB;\r\n    templateVars = args.templateVars;\r\n    templateScope = args.templateScope;\r\n  } else {\r\n    parentContainer = parentContainer_or_args;\r\n  }\r\n\r\n  if (pagecache.has(url)) {\r\n    source = pagecache.get(url);\r\n\r\n    if (modifySourceCB) {\r\n      source = modifySourceCB(source);\r\n    }\r\n\r\n    return new Promise((accept, reject) => {\r\n      if (loadSourceOnly) {\r\n        accept(source);\r\n      } else {\r\n        accept(initPage(ctx, source, parentContainer, templateVars, templateScope));\r\n      }\r\n    });\r\n  } else {\r\n    return new Promise((accept, reject) => {\r\n      fetch(url).then(res => res.text()).then(data => {\r\n        pagecache.set(url, data);\r\n\r\n        if (modifySourceCB) {\r\n          data = modifySourceCB(data);\r\n        }\r\n\r\n        if (loadSourceOnly) {\r\n          accept(data);\r\n        } else {\r\n          accept(initPage(ctx, data, parentContainer, templateVars, templateScope));\r\n        }\r\n      });\r\n    });\r\n  }\r\n}\r\n","import {CurveConstructors} from \"./curve1d_base.js\";\r\nimport {EnumProperty} from \"../toolsys/toolprop.js\";\r\n\r\nexport function makeGenEnum() {\r\n  let enumdef = {};\r\n  let uinames = {};\r\n  let icons = {};\r\n\r\n  for (let cls of CurveConstructors) {\r\n    let def = cls.define();\r\n\r\n    let uiname = def.uiname;\r\n    uiname = uiname === undefined ? def.name : uiname;\r\n\r\n    enumdef[def.name] = cls.name;\r\n    uinames[def.name] = uiname;\r\n    icons[def.name] = def.icon !== undefined ? def.icon : -1;\r\n  }\r\n\r\n  //return enumdef;\r\n  return new EnumProperty(undefined, enumdef).addUINames(uinames).addIcons(icons);\r\n}\r\n","import {Curve1DProperty} from \"../path-controller/toolsys/toolprop.js\";\r\nimport {UIBase, Icons} from '../core/ui_base.js';\r\nimport {ColumnFrame, RowFrame} from \"../core/ui.js\";\r\nimport * as util from '../path-controller/util/util.js';\r\nimport {Vector2, Vector3} from \"../path-controller/util/vectormath.js\";\r\nimport {Curve1D,  mySafeJSONStringify} from \"../path-controller/curve/curve1d.js\";\r\nimport {makeGenEnum} from '../path-controller/curve/curve1d_utils.js';\r\n\r\nexport class Curve1DWidget extends ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this.useDataPathUndo = false;\r\n\r\n    this._on_draw = this._on_draw.bind(this);\r\n    this.drawTransform = [1.0, [0, 0]];\r\n\r\n    this._value = new Curve1D();\r\n    this._value.on(\"draw\", this._on_draw);\r\n\r\n    this._value._on_change = (msg) => {\r\n      if (this.onchange) {\r\n        this.onchange(this._value);\r\n      }\r\n\r\n      if (this.hasAttribute(\"datapath\")) {\r\n        let path = this.getAttribute(\"datapath\");\r\n        if (this._value !== undefined) {\r\n          let val = this.getPathValue(this.ctx, path);\r\n\r\n          if (val) {\r\n            val.load(this._value);\r\n            this.setPathValue(this.ctx, path, val);\r\n          } else {\r\n            val = this._value.copy();\r\n            this.setPathValue(this.ctx, path, val);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    this._gen_type = undefined;\r\n    this._lastGen = undefined;\r\n\r\n    this._last_dpi = undefined;\r\n    this.canvas = document.createElement(\"canvas\");\r\n\r\n    this.g = this.canvas.getContext(\"2d\");\r\n    this.canvas.g = this.g;\r\n\r\n    window.cw = this;\r\n    this.shadow.appendChild(this.canvas);\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  _on_draw(e) {\r\n    let curve = e.data;\r\n\r\n    //console.log(\"draw\");\r\n    this._redraw();\r\n  }\r\n\r\n  set value(val) {\r\n    this._value.load(val);\r\n    this.update();\r\n    this._redraw();\r\n  }\r\n\r\n  _on_change() {\r\n    if (this.onchange) {\r\n      this.onchange(this);\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.useDataPathUndo = false;\r\n    let row = this.row();\r\n\r\n    let prop = makeGenEnum();\r\n\r\n    prop.setValue(this.value.generatorType);\r\n\r\n    this.dropbox = row.listenum(undefined, \"Type\", prop, this.value.generatorType, (id) => {\r\n      console.warn(\"SELECT\", id, prop.keys[id]);\r\n\r\n      this.value.setGenerator(id);\r\n      this.value._on_change(\"curve type change\");\r\n    });\r\n    this.dropbox._init();\r\n\r\n    row.iconbutton(Icons.ZOOM_OUT, \"Zoom Out\", () => {\r\n      let curve = this._value;\r\n      if (!curve) return;\r\n      //if (isNaN(curve.uiZoom))\r\n      //  curve.uiZoom = 1.0;\r\n\r\n      curve.uiZoom *= 0.9;\r\n      if (this.getAttribute(\"datapath\")) {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), curve);\r\n      }\r\n\r\n      this._redraw();\r\n    }).iconsheet = 0;\r\n    row.iconbutton(Icons.ZOOM_IN, \"Zoom In\", () => {\r\n      let curve = this._value;\r\n      if (!curve) return;\r\n      //if (isNaN(curve.uiZoom))\r\n      //  curve.uiZoom = 1.0;\r\n\r\n      curve.uiZoom *= 1.1;\r\n      if (this.getAttribute(\"datapath\")) {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), curve);\r\n      }\r\n\r\n      this._redraw();\r\n\r\n    }).iconsheet = 0;\r\n\r\n    this.container = this.col();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.style[\"width\"] = \"min-contents\";\r\n    this.style[\"height\"] = \"min-contents\";\r\n    this.updateSize();\r\n  }\r\n\r\n  updateSize() {\r\n    let dpi = UIBase.getDPI();\r\n    let w = ~~(this.getDefault(\"CanvasWidth\")*dpi);\r\n    let h = ~~(this.getDefault(\"CanvasHeight\")*dpi);\r\n\r\n    let bad = w !== this.canvas.width || h !== this.canvas.height;\r\n    bad = bad || dpi !== this._last_dpi;\r\n\r\n    if (!bad) {\r\n      return;\r\n    }\r\n\r\n    this._last_dpi = dpi;\r\n    this.canvas.width = w;\r\n    this.canvas.height = h;\r\n\r\n    this.canvas.style[\"width\"] = (w/dpi) + \"px\";\r\n    this.canvas.style[\"height\"] = (h/dpi) + \"px\";\r\n\r\n    this._redraw();\r\n  }\r\n\r\n  _redraw() {\r\n    //forcibly clear canvas, works better then clearRect\r\n    this.canvas.width = this.canvas.width;\r\n    this.canvas.height = this.canvas.height;\r\n\r\n    let canvas = this.canvas, g = this.g;\r\n\r\n    //g.clearRect(0, 0, canvas.width, canvas.height);\r\n    g.beginPath();\r\n    g.rect(0, 0, canvas.width, canvas.height);\r\n    g.fillStyle = this.getDefault(\"CanvasBG\");\r\n    g.fill();\r\n\r\n    g.save();\r\n\r\n    let zoom = this._value.uiZoom;\r\n    let scale = Math.max(canvas.width, canvas.height);\r\n\r\n    g.lineWidth /= scale;\r\n\r\n\r\n    this.drawTransform[0] = scale*zoom;\r\n    this.drawTransform[1][0] =  0.0;\r\n    this.drawTransform[1][1] = -1.0;\r\n\r\n    this.drawTransform[1][0] -= 0.5 - 0.5/zoom;\r\n    this.drawTransform[1][1] += 0.5 - 0.5/zoom;\r\n\r\n    //g.scale(scale, scale);\r\n\r\n    g.scale(this.drawTransform[0], -this.drawTransform[0]);\r\n    g.translate(this.drawTransform[1][0], this.drawTransform[1][1]);\r\n\r\n    g.lineWidth /= zoom;\r\n\r\n    this._value.draw(this.canvas, this.g, this.drawTransform);\r\n    g.restore();\r\n  }\r\n\r\n  rebuild() {\r\n    let ctx = this.ctx;\r\n    if (ctx === undefined || this.container === undefined) {\r\n      return;\r\n    }\r\n\r\n\r\n    this._gen_type = this.value.generatorType;\r\n    let col = this.container;\r\n\r\n    if (this._lastGen !== undefined) {\r\n      this._lastGen.killGUI(col, this.canvas);\r\n    }\r\n\r\n    let onchange = this.dropbox.onchange;\r\n    this.dropbox.onchange = undefined\r\n    this.dropbox.setValue(this.value.generatorType);\r\n    this.dropbox.onchange = onchange;\r\n\r\n    col.clear();\r\n\r\n    let gen = this.value.generators.active;\r\n    gen.makeGUI(col, this.canvas);\r\n\r\n    this._lastGen = gen;\r\n\r\n    this._redraw();\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n    let val = this.getPathValue(this.ctx, path);\r\n\r\n    if (this._lastu === undefined) {\r\n      this._lastu = 0;\r\n    }\r\n\r\n    if (val && !val.equals(this._value) && util.time_ms() - this._lastu > 200) {\r\n      this._lastu = util.time_ms();\r\n\r\n      this._value.load(val);\r\n      this.update();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  updateGenUI() {\r\n    let bad = this._lastGen !== this.value.generators.active;\r\n    \r\n    if (bad) {\r\n      this.rebuild();\r\n      this._redraw();\r\n    }\r\n  }\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateDataPath();\r\n    this.updateSize();\r\n    this.updateGenUI();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"curve-widget-x\",\r\n    style   : \"curvewidget\"\r\n  }}\r\n}\r\nUIBase.internalRegister(Curve1DWidget);\r\n","//bind module to global var to get at it in console.\r\n//\r\n//note that require has an api for handling circular\r\n//module refs, in such cases do not use these vars.\r\n\r\nimport {CSSFont} from \"../core/ui_base.js\";\r\n\r\nvar _ui = undefined;\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as ui_widgets from './ui_widgets.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport '../path-controller/util/html5_fileapi.js';\r\nimport {ColumnFrame, RowFrame, Container} from \"../core/ui.js\";\r\n\r\nlet PropFlags = toolprop.PropFlags;\r\nlet PropSubTypes = toolprop.PropSubTypes;\r\n\r\nlet EnumProperty = toolprop.EnumProperty;\r\n\r\nlet Vector2   = vectormath.Vector2,\r\n    UIBase    = ui_base.UIBase,\r\n    PackFlags = ui_base.PackFlags,\r\n    PropTypes = toolprop.PropTypes;\r\n\r\n\r\n//methods to forward to this.contents\r\nlet forward_keys = new Set([\r\n  \"row\", \"col\", \"strip\", \"noteframe\", \"helppicker\", \"vecpopup\",\r\n  \"tabs\", \"table\", \"menu\", \"listbox\", \"panel\",\r\n  \"pathlabel\", \"label\", \"listenum\", \"check\", \"iconcheck\",\r\n  \"button\", \"iconbutton\", \"colorPicker\", \"twocol\",\r\n  \"treeview\", \"slider\", \"simpleslider\", \"curve1d\",\r\n  \"noteframe\", \"vecpopup\",\r\n  \"prop\", \"tool\", \"toolPanel\", \"textbox\", \"dynamicMenu\",\r\n  \"add\", \"prepend\", \"useIcons\", \"noMarginsOrPadding\", \"wrap\"\r\n]);\r\n\r\nexport class PanelFrame extends ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this.titleframe = super.row();\r\n\r\n    this.contents = super.col();\r\n    this.contents._remove = this.contents.remove;\r\n    this.contents.remove = () => {\r\n      this.remove();\r\n    };\r\n\r\n    this._panel = this; //compatibility alias\r\n\r\n    this.contents._panel = this;\r\n    this.iconcheck = UIBase.createElement(\"iconcheck-x\");\r\n    this.iconcheck.noEmboss = true;\r\n\r\n    Object.defineProperty(this.contents, \"closed\", {\r\n      get: () => {\r\n        return this.closed;\r\n      },\r\n\r\n      set: (v) => {\r\n        this.closed = v;\r\n      }\r\n    })\r\n\r\n    Object.defineProperty(this.contents, \"title\", {\r\n      get: () => this.titleframe.getAttribute(\"title\"),\r\n      set: (v) => this.setHeaderToolTip(v)\r\n    });\r\n\r\n    this.packflag = this.inherit_packflag = 0;\r\n\r\n    this._closed = false;\r\n\r\n    this.makeHeader();\r\n  }\r\n\r\n  get inherit_packflag() {\r\n    if (!this.contents) return;\r\n    return this.contents.inherit_packflag;\r\n  }\r\n\r\n  set inherit_packflag(val) {\r\n    if (!this.contents) return;\r\n    this.contents.inherit_packflag = val;\r\n  }\r\n\r\n  get packflag() {\r\n    if (!this.contents) return;\r\n    return this.contents.packflag;\r\n  }\r\n\r\n  set packflag(val) {\r\n    if (!this.contents) return;\r\n    this.contents.packflag = val;\r\n  }\r\n\r\n  appendChild(child) {\r\n    return this.contents.shadow.appendChild(child);\r\n  }\r\n\r\n  get headerLabel() {\r\n    return this.__label.text;\r\n  }\r\n\r\n  set headerLabel(v) {\r\n    this.__label.text = v;\r\n    this.__label._updateFont();\r\n\r\n    if (this.hasAttribute(\"label\")) {\r\n      this.setAttribute(\"label\", v);\r\n    }\r\n\r\n    if (this.ctx) {\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  get dataPrefix() {\r\n    return this.contents ? this.contents.dataPrefix : \"\";\r\n  }\r\n\r\n  set dataPrefix(v) {\r\n    if (this.contents) {\r\n      this.contents.dataPrefix = v;\r\n    }\r\n  }\r\n\r\n  get closed() {\r\n    return this._closed;\r\n  }\r\n\r\n  set closed(val) {\r\n    let update = !!val !== !!this.closed;\r\n    this._closed = val;\r\n\r\n    //console.log(\"closed set\", update);\r\n    if (update) {\r\n      this._updateClosed(true);\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname            : \"panelframe-x\",\r\n      style              : \"panel\",\r\n      subclassChecksTheme: true\r\n    };\r\n  }\r\n\r\n  setHeaderToolTip(tooltip) {\r\n    this.titleframe.setAttribute(\"title\", tooltip);\r\n\r\n    this.titleframe._forEachChildWidget((child) => {\r\n      child.setAttribute(\"title\", tooltip);\r\n    });\r\n  }\r\n\r\n  saveData() {\r\n    let ret = {\r\n      closed: this._closed\r\n    };\r\n\r\n    return Object.assign(super.saveData(), ret);\r\n  }\r\n\r\n  loadData(obj) {\r\n    if (!(\"closed\" in obj)) {\r\n      this.closed = obj._closed;\r\n    } else {\r\n      this.closed = obj.closed;\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this.contents.clear();\r\n    return this;\r\n  }\r\n\r\n  makeHeader() {\r\n    let row = this.titleframe;\r\n\r\n    let iconcheck = this.iconcheck;\r\n\r\n    if (!iconcheck) {\r\n      return;\r\n    }\r\n\r\n    iconcheck.overrideDefault(\"padding\", 0);\r\n\r\n    iconcheck.noMarginsOrPadding();\r\n\r\n    iconcheck.overrideDefault(\"background-color\", \"rgba(0,0,0,0)\");\r\n    iconcheck.overrideDefault(\"BoxDepressed\", \"rgba(0,0,0,0)\");\r\n    iconcheck.overrideDefault(\"border-color\", \"rgba(0,0,0,0)\");\r\n\r\n    iconcheck.ctx = this.ctx;\r\n    iconcheck._icon_pressed = ui_base.Icons.UI_EXPAND;\r\n    iconcheck._icon = ui_base.Icons.UI_COLLAPSE;\r\n    iconcheck.drawCheck = false;\r\n    iconcheck.iconsheet = ui_base.IconSheets.SMALL;\r\n    iconcheck.checked = this._closed;\r\n\r\n    this.iconcheck.onchange = (e) => {\r\n      this.closed = this.iconcheck.checked;\r\n    };\r\n\r\n    row._add(iconcheck);\r\n\r\n    //stupid css, let's just hackishly put \" \" to create spacing2\r\n\r\n    let onclick = (e) => {\r\n      iconcheck.checked = !iconcheck.checked;\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n    };\r\n\r\n    let label = this.__label = row.label(this.getAttribute(\"label\"));\r\n\r\n    this.__label.overrideClass(\"panel\");\r\n    this.__label.font = \"TitleText\";\r\n\r\n    label._updateFont();\r\n\r\n    label.noMarginsOrPadding();\r\n    label.addEventListener(\"mousedown\", onclick);\r\n    label.addEventListener(\"touchdown\", onclick);\r\n\r\n    let bs = this.getDefault(\"border-style\");\r\n\r\n    row.background = this.getDefault(\"TitleBackground\");\r\n    row.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n    row.style[\"border\"] = `${this.getDefault(\"border-width\")}px ${bs} ${this.getDefault(\"border-color\")}`;\r\n\r\n    row.style[\"padding-right\"] = \"20px\";\r\n    row.style[\"padding-left\"] = \"5px\";\r\n    row.style[\"padding-top\"] = this.getDefault(\"padding-top\") + \"px\";\r\n    row.style[\"padding-bottom\"] = this.getDefault(\"padding-bottom\") + \"px\";\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.background = this.getDefault(\"background-color\");\r\n    this.style[\"width\"] = \"100%\";\r\n\r\n    this.contents.ctx = this.ctx;\r\n    if (!this._closed) {\r\n      super.add(this.contents);\r\n      this.contents.flushUpdate();\r\n    }\r\n\r\n    this.contents.dataPrefix = this.dataPrefix;\r\n\r\n    //con.style[\"margin-left\"] = \"5px\";\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    if (!this.titleframe || !this.__label) {\r\n      return;\r\n    }\r\n\r\n    let getDefault = (key, defval) => {\r\n      let val = this.getDefault(key);\r\n      return val !== undefined ? val : defval;\r\n    };\r\n\r\n    let bs = this.getDefault(\"border-style\");\r\n\r\n    let header_radius = this.getDefault(\"HeaderRadius\");\r\n    if (header_radius === undefined) {\r\n      header_radius = this.getDefault(\"border-radius\");\r\n    }\r\n\r\n    let boxmargin = getDefault(\"padding\", 0);\r\n\r\n    let paddingleft = getDefault(\"padding-left\", 0);\r\n    let paddingright = getDefault(\"padding-right\", 0);\r\n\r\n    paddingleft += boxmargin;\r\n    paddingright += boxmargin;\r\n\r\n    this.titleframe.background = this.getDefault(\"TitleBackground\");\r\n    this.titleframe.style[\"border-radius\"] = header_radius + \"px\";\r\n    this.titleframe.style[\"border\"] = `${this.getDefault(\"border-width\")}px ${bs} ${this.getDefault(\"TitleBorder\")}`;\r\n    this.style[\"border\"] = `${this.getDefault(\"border-width\")}px ${bs} ${this.getDefault(\"border-color\")}`;\r\n    this.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n\r\n    this.titleframe.style[\"padding-top\"] = this.getDefault(\"padding-top\") + \"px\";\r\n    this.titleframe.style[\"padding-bottom\"] = this.getDefault(\"padding-bottom\") + \"px\";\r\n    this.titleframe.style[\"padding-left\"] = paddingleft + \"px\";\r\n    this.titleframe.style[\"padding-right\"] = paddingright + \"px\";\r\n    this.titleframe.style[\"margin-bottom\"] = \"0px\";\r\n    this.titleframe.style[\"margin-top\"] = \"0px\";\r\n\r\n    this.__label.style[\"border\"] = \"unset\";\r\n    this.__label.style[\"border-radius\"] = \"unset\";\r\n\r\n    let bg = this.getDefault(\"background-color\");\r\n\r\n    this.background = bg;\r\n    this.contents.background = bg;\r\n    this.contents.parentWidget = this;\r\n    this.contents.style[\"background-color\"] = bg;\r\n    this.style[\"background-color\"] = bg;\r\n\r\n    let margintop, marginbottom;\r\n\r\n    if (this._closed) {\r\n      margintop = getDefault('margin-top-closed', 0);\r\n      marginbottom = getDefault('margin-bottom-closed', 5);\r\n    } else {\r\n      margintop = getDefault('margin-top', 0);\r\n      marginbottom = getDefault('margin-bottom', 0);\r\n    }\r\n\r\n    let marginleft = getDefault('margin-left', 0);\r\n    let marginright = getDefault('margin-right', 0);\r\n\r\n    this.style['margin-left'] = marginleft + \"px\";\r\n    this.style['margin-right'] = marginright + \"px\";\r\n\r\n    this.style['margin-top'] = margintop + \"px\";\r\n    this.style['margin-bottom'] = marginbottom + \"px\";\r\n\r\n    //this.style[\"padding-left\"] = paddingleft + \"px\";\r\n    //this.style[\"padding-right\"] = paddingright + \"px\";\r\n\r\n    this.__label._updateFont();\r\n  }\r\n\r\n  on_disabled() {\r\n    super.on_disabled();\r\n\r\n    this.__label._updateFont();\r\n    this.setCSS();\r\n  }\r\n\r\n  on_enabled() {\r\n    super.on_enabled();\r\n\r\n    this.__label.setCSS();\r\n    this.__label.style[\"color\"] = this.style[\"color\"];\r\n    this.setCSS();\r\n  }\r\n\r\n  update() {\r\n    let text = this.getAttribute(\"label\");\r\n\r\n    let update = text !== this.__label.text;\r\n\r\n    if (this.checkThemeUpdate()) {\r\n      update = true;\r\n      this._setVisible(this.closed, true);\r\n      this.setCSS();\r\n      this.flushSetCSS();\r\n    }\r\n\r\n    if (update) {\r\n      this.headerLabel = this.getAttribute(\"label\")\r\n\r\n      this.__label._updateFont();\r\n      this.setCSS();\r\n    }\r\n\r\n    super.update();\r\n  }\r\n\r\n  _onchange(isClosed) {\r\n    if (this.onchange) {\r\n      this.onchange(isClosed);\r\n    }\r\n\r\n    if (this.contents.onchange) {\r\n      this.contents.onchange(isClosed);\r\n    }\r\n  }\r\n\r\n  //catch setAttribute so we can detect label update\r\n  //even if close and updates disabled\r\n  setAttribute(key, value) {\r\n    let ret = super.setAttribute(key, value);\r\n\r\n    if (this.ctx) {\r\n      this.update();\r\n      this.flushUpdate();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  get noUpdateClosedContents() {\r\n    if (!this.hasAttribute(\"update-closed-contents\")) {\r\n      return false;\r\n    }\r\n\r\n    let ret = this.getAttribute(\"update-closed-contents\");\r\n    return ret === \"true\" || ret === \"on\";\r\n  }\r\n\r\n  set noUpdateClosedContents(v) {\r\n    this.setAttribute(\"update-closed-contents\", v ? \"true\" : \"false\");\r\n  }\r\n\r\n  _setVisible(isClosed, changed) {\r\n    changed = changed || !!isClosed !== !!this._closed;\r\n\r\n    this._state = isClosed;\r\n\r\n    if (isClosed) {\r\n      this.contents.style.display = \"none\";\r\n\r\n      //this.contents._remove();\r\n      //this.contents.hide(true);\r\n      if (!this.noUpdateClosedContents) {\r\n        this.contents.packflag |= PackFlags.NO_UPDATE;\r\n      }\r\n    } else {\r\n      //this.contents.hide(false);\r\n      this.contents.style.display = \"flex\";\r\n      this.contents.packflag &= ~PackFlags.NO_UPDATE;\r\n      this.contents.flushUpdate();\r\n    }\r\n\r\n    this.contents.hidden = isClosed;\r\n\r\n    if (this.parentWidget) {\r\n      this.parentWidget.flushUpdate();\r\n    } else {\r\n      this.flushUpdate();\r\n    }\r\n\r\n    if (changed) {\r\n      this._onchange(isClosed);\r\n    }\r\n\r\n    /*\r\n    for (let c of this.shadow.childNodes) {\r\n      if (c !== this.titleframe) {\r\n        c.hidden = state;\r\n      }\r\n    }*/\r\n  }\r\n\r\n  _updateClosed(changed) {\r\n    this._setVisible(this._closed, changed);\r\n\r\n    if (this.iconcheck) {\r\n      this.iconcheck.checked = this._closed;\r\n    }\r\n  }\r\n}\r\n\r\n\r\nlet makeForward = (k) => {\r\n  return function() {\r\n    return this.contents[k](...arguments);\r\n  }\r\n};\r\n\r\nfor (let k of forward_keys) {\r\n  PanelFrame.prototype[k] = makeForward(k);\r\n}\r\n\r\nUIBase.internalRegister(PanelFrame);\r\n","\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as ui from '../core/ui.js';\r\nimport {PropTypes} from '../path-controller/toolsys/toolprop.js';\r\nimport {keymap} from '../path-controller/util/simple_events.js';\r\nimport cconst from '../config/const.js';\r\nimport {color2web, web2color, validateWebColor} from \"../core/ui_base.js\";\r\n\r\nlet Vector2 = vectormath.Vector2,\r\n    Vector3 = vectormath.Vector3,\r\n    Vector4 = vectormath.Vector4,\r\n    Matrix4 = vectormath.Matrix4;\r\n\r\nexport {rgb_to_hsv, hsv_to_rgb} from \"../path-controller/util/colorutils.js\";\r\nimport {rgb_to_hsv, hsv_to_rgb, cmyk_to_rgb, rgb_to_cmyk} from \"../path-controller/util/colorutils.js\";\r\nimport {contextWrangler} from '../screen/area_wrangler.js';\r\n\r\nlet UIBase     = ui_base.UIBase,\r\n    PackFlags  = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nlet UPW = 1.25, VPW = 0.75;\r\n\r\n//*\r\nlet sample_rets = new util.cachering(() => [0, 0], 64);\r\n\r\nexport function inv_sample(u, v) {\r\n  let ret = sample_rets.next();\r\n\r\n  ret[0] = Math.pow(u, UPW);\r\n  ret[1] = Math.pow(v, VPW);\r\n\r\n  return ret;\r\n}\r\n\r\nexport function sample(u, v) {\r\n  let ret = sample_rets.next();\r\n\r\n  ret[0] = Math.pow(u, 1.0/UPW);\r\n  ret[1] = Math.pow(v, 1.0/VPW);\r\n\r\n  return ret;\r\n}\r\n\r\n//*/\r\n\r\n/* shared methods for clipboard handling */\r\nfunction colorClipboardCopy() {\r\n  let rgba = this.getRGBA();\r\n\r\n  let r = rgba[0]*255;\r\n  let g = rgba[1]*255;\r\n  let b = rgba[2]*255;\r\n  let a = rgba[3];\r\n\r\n  let data = `rgba(${r.toFixed(4)}, ${g.toFixed(4)}, ${b.toFixed(4)}, ${a.toFixed(4)})`;\r\n  //cconst.setClipboardData(\"color\", \"text/css\", data);\r\n\r\n  cconst.setClipboardData(\"color\", \"text/plain\", data);\r\n}\r\n\r\nfunction colorClipboardPaste() {\r\n  let data = cconst.getClipboardData(\"text/plain\");\r\n\r\n  if (!data || !validateCSSColor(\"\" + data.data)) {// || data.mime !== \"text/css\") {\r\n    return;\r\n  }\r\n\r\n  let color;\r\n\r\n  try {\r\n    color = css2color(data.data);\r\n  } catch (error) {\r\n    //not a color\r\n    console.log(error.stack);\r\n    console.log(error.message);\r\n  }\r\n\r\n  if (color) {\r\n    if (color.length < 4) {\r\n      color.push(1.0);\r\n    }\r\n\r\n    this.setRGBA(color);\r\n  }\r\n}\r\n\r\nlet fieldrand = new util.MersenneRandom(0);\r\n\r\nlet huefields = {};\r\n\r\nexport function getHueField(width, height, dpi) {\r\n  let key = width + \":\" + height + \":\" + dpi.toFixed(4);\r\n\r\n  if (key in huefields) {\r\n    return huefields[key];\r\n  }\r\n\r\n  let field = new ImageData(width, height);\r\n  let idata = field.data;\r\n\r\n  for (let i = 0; i < width*height; i++) {\r\n    let ix = i%width, iy = ~~(i/width);\r\n    let idx = i*4;\r\n\r\n    let rgb = hsv_to_rgb(ix/width, 1, 1);\r\n\r\n    idata[idx] = rgb[0]*255;\r\n    idata[idx + 1] = rgb[1]*255;\r\n    idata[idx + 2] = rgb[2]*255;\r\n    idata[idx + 3] = 255;\r\n  }\r\n\r\n  //*\r\n  let canvas = document.createElement(\"canvas\");\r\n  canvas.width = field.width;\r\n  canvas.height = field.height;\r\n  let g = canvas.getContext(\"2d\");\r\n  g.putImageData(field, 0, 0);\r\n  field = canvas;\r\n  //*/\r\n\r\n  huefields[key] = field;\r\n  return field;\r\n}\r\n\r\nlet fields = {};\r\n\r\nexport function getFieldImage(fieldsize, width, height, hsva) {\r\n  fieldrand.seed(0);\r\n\r\n  /* render field at half res and upscale via canvas2d */\r\n  let width2 = width>>1;\r\n  let height2 = height>>1;\r\n  let fieldsize2 = fieldsize>>1;\r\n\r\n  let hue = hsva[0];\r\n  let hue_rgb = hsv_to_rgb(hue, 1.0, 1.0);\r\n  let key = fieldsize + \":\" + width2 + \":\" + height2 + \":\" + hue.toFixed(5);\r\n\r\n  if (key in fields)\r\n    return fields[key];\r\n\r\n  let size2 = fieldsize2;\r\n  let valpow = 0.75;\r\n\r\n  let image = {\r\n    width : width,\r\n    height: height,\r\n    image : new ImageData(fieldsize2, fieldsize2),\r\n\r\n    x2sat: (x) => {\r\n      return Math.min(Math.max(x/width, 0), 1);\r\n    },\r\n    y2val: (y) => {\r\n      y = 1.0 - Math.min(Math.max(y/height, 0), 1);\r\n\r\n      return y === 0.0 ? 0.0 : y**valpow;\r\n    },\r\n    sat2x: (s) => {\r\n      return s*width;\r\n    },\r\n    val2y: (v) => {\r\n      if (v === 0)\r\n        return height;\r\n\r\n      v = v**(1.0/valpow);\r\n      return (1.0 - v)*height;\r\n    }\r\n  };\r\n\r\n  image.params = {\r\n    box: {\r\n      x     : 0,\r\n      y     : 0,\r\n      width : width,\r\n      height: height\r\n    }\r\n  };\r\n\r\n  let idata = image.image.data;\r\n  for (let i = 0; i < idata.length; i += 4) {\r\n    let i2 = i/4;\r\n    let x = i2%size2, y = ~~(i2/size2);\r\n\r\n    let v = 1.0 - (y/size2);\r\n    let s = (x/size2);\r\n\r\n    let rgb = hsv_to_rgb(hsva[0], s, v**valpow);\r\n\r\n    idata[i] = rgb[0]*255;\r\n    idata[i + 1] = rgb[1]*255;\r\n    idata[i + 2] = rgb[2]*255;\r\n    idata[i + 3] = 255;\r\n  }\r\n\r\n  //*\r\n  let image2 = document.createElement(\"canvas\");\r\n  image2.width = size2;\r\n  image2.height = size2;\r\n  let g = image2.getContext(\"2d\");\r\n  g.putImageData(image.image, 0, 0);\r\n  //*/\r\n  image.canvas = image2;\r\n  image.scale = width/size2;\r\n\r\n  fields[key] = image;\r\n  return image;\r\n}\r\n\r\n\r\nlet _update_temp = new Vector4();\r\n\r\nexport class SimpleBox {\r\n  constructor(pos = [0, 0], size = [1, 1]) {\r\n    this.pos = new Vector2(pos);\r\n    this.size = new Vector2(size);\r\n    this.r = 0;\r\n  }\r\n}\r\n\r\nexport class HueField extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.g = this.canvas.getContext(\"2d\");\r\n    this.shadow.appendChild(this.canvas);\r\n\r\n    let setFromXY = (x, y) => {\r\n      let dpi = this.getDPI();\r\n      let pad = this._getPad();\r\n\r\n      let w = this.canvas.width/dpi - pad*2.0;\r\n      x -= pad;\r\n\r\n      let h = x/w;\r\n      h = Math.min(Math.max(h, 0.0), 1.0);\r\n\r\n      this.hsva[0] = h;\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.hsva);\r\n      }\r\n\r\n      this._redraw();\r\n    };\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Left\"]:\r\n        case keymap[\"Right\"]:\r\n          let sign = e.keyCode === keymap[\"Left\"] ? -1 : 1;\r\n\r\n          this.hsva[0] = Math.min(Math.max(this.hsva[0] + 0.05*sign, 0.0), 1.0);\r\n          this._redraw();\r\n\r\n          if (this.onchange) {\r\n            this.onchange();\r\n          }\r\n          break;\r\n      }\r\n    });\r\n\r\n    this.addEventListener(\"mousedown\", (e) => {\r\n      if (this.modalRunning) {\r\n        return;\r\n      }\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n\r\n      let rect = this.canvas.getClientRects()[0];\r\n      let x = e.clientX - rect.x, y = e.clientY - rect.y;\r\n\r\n      setFromXY(x, y);\r\n\r\n      this.pushModal({\r\n        on_mousemove: (e) => {\r\n          let rect = this.canvas.getClientRects()[0];\r\n          let x = e.clientX - rect.x, y = e.clientY - rect.y;\r\n\r\n          setFromXY(x, y);\r\n        },\r\n        on_mousedown: (e) => {\r\n          this.popModal();\r\n        },\r\n        on_mouseup  : (e) => {\r\n          this.popModal();\r\n        },\r\n        on_keydown  : (e) => {\r\n          if (e.keyCode === keymap[\"Enter\"] || e.keyCode === keymap[\"Escape\"] || e.keyCode === keymap[\"Space\"]) {\r\n            this.popModal();\r\n          }\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n\r\n  static define() {\r\n    return {\r\n      tagname          : \"huefield-x\",\r\n      style            : \"colorfield\",\r\n      havePickClipboard: true\r\n    };\r\n  }\r\n\r\n  getRGBA() {\r\n    let rgb = hsv_to_rgb(this.hsva[0], this.hsva[1], this.hsva[2]);\r\n    return new Vector4().loadXYZW(rgb[0], rgb[1], rgb[2], this.hsva[3]);\r\n  }\r\n\r\n  setRGBA(rgba) {\r\n    let hsv = rgb_to_hsv(rgba[0], rgba[1], rgba[2]);\r\n    this.hsva.loadXYZW(hsv[0], hsv[1], hsv[2], rgba[3]);\r\n\r\n    this._redraw();\r\n\r\n    if (this.onchange) {\r\n      this.onchange(this.hsva);\r\n    }\r\n  }\r\n\r\n  clipboardCopy() {\r\n    colorClipboardCopy.apply(this, arguments);\r\n  }\r\n\r\n  clipboardPaste() {\r\n    colorClipboardPaste.apply(this, arguments);\r\n  }\r\n\r\n  _getPad() {\r\n    return Math.max(this.getDefault(\"circleSize\"), 15);\r\n  }\r\n\r\n  _redraw() {\r\n    let g = this.g, canvas = this.canvas;\r\n    let dpi = this.getDPI();\r\n\r\n    let w = this.getDefault(\"width\");\r\n    let h = this.getDefault(\"hueHeight\");\r\n\r\n    canvas.width = ~~(w*dpi);\r\n    canvas.height = ~~(h*dpi);\r\n\r\n    canvas.style[\"width\"] = w + \"px\";\r\n    canvas.style[\"height\"] = h + \"px\";\r\n\r\n    /* create horizontal padding to make selection of\r\n     *  endpoint hue easier */\r\n\r\n    let rselector = ~~(this._getPad()*dpi); //~~(this.getDefault(\"circleSize\")*dpi);\r\n    let r_circle = this.getDefault(\"circleSize\")*dpi;\r\n\r\n    let w2 = canvas.width, h2 = canvas.height;\r\n\r\n    w2 -= rselector*2.0;\r\n\r\n    //g.drawImage(getHueField(w2, h2, dpi), 0, 0, w2, h2, rselector*2, 0, w2, h2);\r\n    g.drawImage(getHueField(w2, h2, dpi), 0, 0, w2, h2, rselector, 0, w2, h2);\r\n\r\n    let x = this.hsva[0]*w2 + rselector;\r\n    let y = canvas.height*0.5;\r\n\r\n    g.beginPath();\r\n    g.arc(x, y, r_circle, -Math.PI, Math.PI);\r\n    g.closePath();\r\n\r\n    g.strokeStyle = \"white\";\r\n    g.lineWidth = 3*dpi;\r\n    g.stroke();\r\n\r\n    g.strokeStyle = \"grey\";\r\n    g.lineWidth = 1*dpi;\r\n    g.stroke();\r\n\r\n    if (this.disabled) {\r\n      g.beginPath();\r\n      g.fillStyle = \"rgba(25,25,25,0.75)\"\r\n      g.rect(0, 0, this.canvas.width, this.canvas.height);\r\n      g.fill();\r\n    }\r\n  }\r\n\r\n  on_disabled() {\r\n    this._redraw();\r\n  }\r\n\r\n  on_enabled() {\r\n    this._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(HueField);\r\n\r\nexport class SatValField extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.hsva = [0, 0, 0, 1];\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.g = this.canvas.getContext(\"2d\");\r\n    this.shadow.appendChild(this.canvas);\r\n\r\n    this.onchange = undefined;\r\n\r\n    let setFromXY = (x, y) => {\r\n      let field = this._getField();\r\n      let r = ~~(this.getDefault(\"circleSize\")*this.getDPI());\r\n\r\n      let sat = field.x2sat(x - r);\r\n      let val = field.y2val(y - r);\r\n\r\n      this.hsva[1] = sat;\r\n      this.hsva[2] = val;\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.hsva);\r\n      }\r\n\r\n      this._redraw();\r\n    };\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Left\"]:\r\n        case keymap[\"Right\"]: {\r\n          let sign = e.keyCode === keymap[\"Left\"] ? -1 : 1;\r\n\r\n          this.hsva[1] = Math.min(Math.max(this.hsva[1] + 0.05*sign, 0.0), 1.0);\r\n          this._redraw();\r\n\r\n          if (this.onchange) {\r\n            this.onchange(this.hsva);\r\n          }\r\n          break;\r\n        }\r\n\r\n        case keymap[\"Up\"]:\r\n        case keymap[\"Down\"]: {\r\n          let sign = e.keyCode === keymap[\"Down\"] ? -1 : 1;\r\n\r\n          this.hsva[2] = Math.min(Math.max(this.hsva[2] + 0.05*sign, 0.0), 1.0);\r\n          this._redraw();\r\n\r\n          if (this.onchange) {\r\n            this.onchange(this.hsva);\r\n          }\r\n          break;\r\n        }\r\n      }\r\n    });\r\n\r\n    this.canvas.addEventListener(\"mousedown\", (e) => {\r\n      if (this.modalRunning) {\r\n        return;\r\n      }\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n\r\n      let rect = this.canvas.getClientRects()[0];\r\n      let x = e.clientX - rect.x, y = e.clientY - rect.y;\r\n\r\n      setFromXY(x, y);\r\n\r\n      this.pushModal({\r\n        on_pointermove(e) {\r\n          this.on_mousemove(e);\r\n        },\r\n        on_mousemove: (e) => {\r\n          let rect = this.canvas.getClientRects()[0];\r\n          if (rect === undefined) {\r\n            return;\r\n          }\r\n\r\n          let x = e.clientX - rect.x, y = e.clientY - rect.y;\r\n\r\n          setFromXY(x, y);\r\n        },\r\n        on_mousedown: (e) => {\r\n          this.popModal();\r\n        },\r\n        on_mouseup  : (e) => {\r\n          this.popModal();\r\n        },\r\n        on_keydown  : (e) => {\r\n          if (e.keyCode === keymap[\"Enter\"] || e.keyCode === keymap[\"Escape\"] || e.keyCode === keymap[\"Space\"]) {\r\n            this.popModal();\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    this.canvas.addEventListener(\"touchstart\", (e) => {\r\n      if (this.modalRunning) {\r\n        return;\r\n      }\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n\r\n      let rect = this.canvas.getClientRects()[0];\r\n      let x = e.touches[0].clientX - rect.x, y = e.touches[0].clientY - rect.y;\r\n\r\n      setFromXY(x, y);\r\n\r\n      this.pushModal({\r\n        on_mousemove  : (e) => {\r\n          let rect = this.canvas.getClientRects()[0];\r\n          let x, y;\r\n\r\n          if (e.touches && e.touches.length) {\r\n            x = e.touches[0].clientX - rect.x;\r\n            y = e.touches[0].clientY - rect.y;\r\n          } else {\r\n            x = e.x;\r\n            y = e.y;\r\n          }\r\n\r\n          setFromXY(x, y);\r\n        },\r\n        on_touchmove  : (e) => {\r\n          let rect = this.canvas.getClientRects()[0];\r\n          let x = e.touches[0].clientX - rect.x, y = e.touches[0].clientY - rect.y;\r\n\r\n          setFromXY(x, y);\r\n        },\r\n        on_mousedown  : (e) => {\r\n          this.popModal();\r\n        },\r\n        on_touchcancel: (e) => {\r\n          this.popModal();\r\n        },\r\n        on_touchend   : (e) => {\r\n          this.popModal();\r\n        },\r\n        on_mouseup    : (e) => {\r\n          this.popModal();\r\n        },\r\n        on_keydown    : (e) => {\r\n          if (e.keyCode === keymap[\"Enter\"] || e.keyCode === keymap[\"Escape\"] || e.keyCode === keymap[\"Space\"]) {\r\n            this.popModal();\r\n          }\r\n        }\r\n      });\r\n    })\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname          : \"satvalfield-x\",\r\n      style            : \"colorfield\",\r\n      havePickClipboard: true\r\n    };\r\n  }\r\n\r\n  getRGBA() {\r\n    let rgb = hsv_to_rgb(this.hsva[0], this.hsva[1], this.hsva[2]);\r\n    return new Vector4().loadXYZW(rgb[0], rgb[1], rgb[2], this.hsva[3]);\r\n  }\r\n\r\n  setRGBA(rgba) {\r\n    let hsv = rgb_to_hsv(rgba[0], rgba[1], rgba[2]);\r\n    this.hsva.loadXYZW(hsv[0], hsv[1], hsv[2], rgba[3]);\r\n\r\n    this.update(true);\r\n    this._redraw();\r\n\r\n    if (this.onchange) {\r\n      this.onchange(this.hsva);\r\n    }\r\n  }\r\n\r\n  clipboardCopy() {\r\n    colorClipboardCopy.apply(this, arguments);\r\n  }\r\n\r\n  clipboardPaste() {\r\n    colorClipboardPaste.apply(this, arguments);\r\n  }\r\n\r\n  _getField() {\r\n    let dpi = this.getDPI();\r\n    let canvas = this.canvas;\r\n    let r = this.getDefault(\"circleSize\");\r\n    let w = this.getDefault(\"width\");\r\n    let h = this.getDefault(\"height\");\r\n\r\n    //r = ~~(r*dpi);\r\n\r\n    return getFieldImage(this.getDefault(\"fieldSize\"), w - r*2, h - r*2, this.hsva);\r\n  }\r\n\r\n  update(force_update = false) {\r\n    super.update();\r\n\r\n    if (force_update) {\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _redraw() {\r\n    let g = this.g, canvas = this.canvas;\r\n    let dpi = this.getDPI();\r\n\r\n    let w = this.getDefault(\"width\");\r\n    let h = this.getDefault(\"height\");\r\n\r\n    canvas.width = ~~(w*dpi);\r\n    canvas.height = ~~(h*dpi);\r\n\r\n    canvas.style[\"width\"] = w + \"px\";\r\n    canvas.style[\"height\"] = h + \"px\";\r\n    //SatValField\r\n\r\n    let rselector = ~~(this.getDefault(\"circleSize\")*dpi);\r\n\r\n    let field = this._getField()\r\n    let image = field.canvas;\r\n\r\n    g.globalAlpha = 1.0;\r\n    g.beginPath();\r\n    g.rect(0, 0, canvas.width, canvas.height);\r\n    g.fillStyle = \"rgb(200, 200, 200)\";\r\n    g.fill();\r\n\r\n    g.beginPath();\r\n\r\n    let steps = 17;\r\n    let dx = canvas.width/steps;\r\n    let dy = canvas.height/steps;\r\n\r\n    for (let i = 0; i < steps*steps; i++) {\r\n      let x = (i%steps)*dx, y = (~~(i/steps))*dy;\r\n\r\n      if (i%2 === 0) {\r\n        continue;\r\n      }\r\n      g.rect(x, y, dx, dy);\r\n    }\r\n\r\n    g.fillStyle = \"rgb(110, 110, 110)\";\r\n    g.fill();\r\n\r\n    g.globalAlpha = this.hsva[3];\r\n    g.drawImage(image, 0, 0, image.width, image.height, rselector, rselector, canvas.width - rselector*2, canvas.height - rselector*2);\r\n\r\n    let hsva = this.hsva;\r\n\r\n    let x = field.sat2x(hsva[1])*dpi + rselector;\r\n    let y = field.val2y(hsva[2])*dpi + rselector;\r\n    let r = rselector;\r\n\r\n    g.beginPath();\r\n    g.arc(x, y, r, -Math.PI, Math.PI);\r\n    g.closePath();\r\n\r\n    g.strokeStyle = \"white\";\r\n    g.lineWidth = 3*dpi;\r\n    g.stroke();\r\n\r\n    g.strokeStyle = \"grey\";\r\n    g.lineWidth = 1*dpi;\r\n    g.stroke();\r\n\r\n    if (this.disabled) {\r\n      g.beginPath();\r\n      g.fillStyle = \"rgba(25,25,25,0.75)\";\r\n      g.rect(0, 0, this.canvas.width, this.canvas.height);\r\n      g.fill();\r\n    }\r\n  }\r\n\r\n  on_disabled() {\r\n    this._redraw();\r\n  }\r\n\r\n  on_enabled() {\r\n    this._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(SatValField);\r\n\r\nexport class ColorField extends ui.ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this.hsva = new Vector4([0.05, 0.6, 0.15, 1.0]);\r\n    this.rgba = new Vector4([0, 0, 0, 0]);\r\n\r\n    this._recalcRGBA();\r\n\r\n    this._lastThemeStyle = this.constructor.define().style;\r\n\r\n    /*\r\n    this.hbox = new SimpleBox();\r\n    this.svbox = new SimpleBox();\r\n    //*/\r\n\r\n    this._last_dpi = undefined;\r\n\r\n    let satvalfield = this.satvalfield = UIBase.createElement(\"satvalfield-x\");\r\n    satvalfield.hsva = this.hsva;\r\n\r\n    let huefield = this.huefield = UIBase.createElement(\"huefield-x\");\r\n    huefield.hsva = this.hsva;\r\n\r\n    huefield.onchange = (e) => {\r\n      this.satvalfield._redraw();\r\n      this._recalcRGBA();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.rgba);\r\n      }\r\n    };\r\n\r\n    satvalfield.onchange = (e) => {\r\n      this._recalcRGBA();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.rgba);\r\n      }\r\n    };\r\n\r\n    this._add(satvalfield);\r\n    this._add(huefield);\r\n    //this.shadow.appendChild(canvas);\r\n    //this.shadow.appendChild(huecanvas);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"colorfield-x\",\r\n      style  : \"colorfield\"\r\n    };\r\n  }\r\n\r\n  setCMYK(c, m, y, k) {\r\n    let rgb = cmyk_to_rgb(c, m, y, k);\r\n    let hsv = rgb_to_hsv(rgb[0], rgb[1], rgb[2]);\r\n\r\n    this.setHSVA(hsv[0], hsv[1], hsv[2], this.hsva[3]);\r\n  }\r\n\r\n  getCMYK() {\r\n    let rgb = hsv_to_rgb(this.hsva[0], this.hsva[1], this.hsva[2]);\r\n    return rgb_to_cmyk(rgb[0], rgb[1], rgb[2]);\r\n  }\r\n\r\n  setHSVA(h, s, v, a = 1.0, fire_onchange = true) {\r\n    this.hsva[0] = h;\r\n    this.hsva[1] = s;\r\n    this.hsva[2] = v;\r\n    this.hsva[3] = a;\r\n\r\n    this._recalcRGBA();\r\n    this.update(true);\r\n\r\n    if (this.onchange && fire_onchange) {\r\n      this.onchange(this.hsva, this.rgba);\r\n    }\r\n  }\r\n\r\n  _recalcRGBA() {\r\n    let ret = hsv_to_rgb(this.hsva[0], this.hsva[1], this.hsva[2]);\r\n\r\n    this.rgba[0] = ret[0];\r\n    this.rgba[1] = ret[1];\r\n    this.rgba[2] = ret[2];\r\n    this.rgba[3] = this.hsva[3];\r\n\r\n    return this;\r\n  }\r\n\r\n  updateDPI(force_update = false, _in_update = false) {\r\n    let dpi = this.getDPI();\r\n\r\n    let update = force_update;\r\n    update = update || dpi != this._last_dpi;\r\n\r\n    if (update) {\r\n      this._last_dpi = dpi;\r\n\r\n      if (!_in_update)\r\n        this._redraw();\r\n\r\n      return true;\r\n    }\r\n  }\r\n\r\n  getRGBA() {\r\n    let rgb = hsv_to_rgb(this.hsva[0], this.hsva[1], this.hsva[2]);\r\n    return new Vector4().loadXYZW(rgb[0], rgb[1], rgb[2], this.hsva[3]);\r\n  }\r\n\r\n  setRGBA(r, g, b, a = 1.0, fire_onchange = true) {\r\n    if (typeof r === \"object\") {\r\n      g = r[1];\r\n      b = r[2];\r\n      a = r[3];\r\n      r = r[0];\r\n    }\r\n\r\n    let hsv = rgb_to_hsv(r, g, b);\r\n\r\n    this.hsva[0] = hsv[0];\r\n    this.hsva[1] = hsv[1];\r\n    this.hsva[2] = hsv[2];\r\n    this.hsva[3] = a;\r\n\r\n    this._recalcRGBA();\r\n    this.update(true);\r\n\r\n    if (this.onchange && fire_onchange) {\r\n      this.onchange(this.hsva, this.rgba);\r\n    }\r\n  }\r\n\r\n  updateThemeOverride() {\r\n    let theme = this.getStyleClass();\r\n    if (theme === this._lastThemeStyle) {\r\n      return false;\r\n    }\r\n\r\n    this._lastThemeStyle = theme;\r\n    this.huefield.overrideClass(theme);\r\n    this.satvalfield.overrideClass(theme);\r\n\r\n    for (let i=0; i<3; i++) {\r\n      this.flushSetCSS();\r\n      this.flushUpdate();\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  update(force_update = false) {\r\n    super.update();\r\n\r\n    this.updateThemeOverride();\r\n\r\n    let redraw = this.updateDPI(force_update, true);\r\n    redraw = redraw || force_update;\r\n\r\n    if (redraw) {\r\n      this.satvalfield.update(true);\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.style[\"flex-grow\"] = this.getDefault(\"flex-grow\");\r\n  }\r\n\r\n  _redraw() {\r\n    this.satvalfield._redraw();\r\n    this.huefield._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ColorField);\r\n\r\nexport class ColorPicker extends ui.ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this._lastThemeStyle = this.constructor.define().style;\r\n  }\r\n\r\n  //*\r\n  get hsva() {\r\n    return this.field.hsva;\r\n  }\r\n\r\n  get rgba() {\r\n    return this.field.rgba;\r\n  }//*/\r\n\r\n  set description(val) {\r\n    //do not allow setting description of the colorpicker container\r\n  }\r\n\r\n  static setDefault(node) {\r\n    let tabs, colorsPanel = node;\r\n\r\n    if (node.getClassDefault(\"usePanels\")) {\r\n      let panel = colorsPanel = node.panel(\"Color\");\r\n      tabs = panel.tabs();\r\n      panel.closed = true;\r\n\r\n      panel.style[\"flex-grow\"] = \"unset\";\r\n\r\n      /* force compactness */\r\n      panel.titleframe.style[\"flex-grow\"] = \"unset\";\r\n      //panel.titleframe.style[\"align-items\"] = \"unset\";\r\n    } else {\r\n      tabs = node.tabs();\r\n    }\r\n\r\n    node.cssText = node.textbox();\r\n    node.cssText.onchange = (val) => {\r\n      let ok = validateWebColor(val);\r\n      if (!ok) {\r\n        node.cssText.flash(\"red\");\r\n        return;\r\n      } else {\r\n        node.cssText.flash(\"green\");\r\n      }\r\n\r\n      val = val.trim();\r\n\r\n      let color = web2color(val);\r\n\r\n      node._no_update_textbox = true;\r\n      node.field.setRGBA(color[0], color[1], color[2], color[3]);\r\n      node._setSliders();\r\n\r\n      node._no_update_textbox = false;\r\n    };\r\n\r\n    //tabs.overrideDefault(\"background-color\", node.getDefault(\"background-color\"));\r\n\r\n    let tab = tabs.tab(\"HSV\");\r\n\r\n    node.h = tab.slider(undefined, \"Hue\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let hsva = node.hsva;\r\n      node.setHSVA(e.value, hsva[1], hsva[2], hsva[3]);\r\n    });\r\n\r\n    node.s = tab.slider(undefined, \"Saturation\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let hsva = node.hsva;\r\n      node.setHSVA(hsva[0], e.value, hsva[2], hsva[3]);\r\n    });\r\n    node.v = tab.slider(undefined, \"Value\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let hsva = node.hsva;\r\n      node.setHSVA(hsva[0], hsva[1], e.value, hsva[3]);\r\n    });\r\n    node.a = tab.slider(undefined, \"Alpha\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let hsva = node.hsva;\r\n      node.setHSVA(hsva[0], hsva[1], hsva[2], e.value);\r\n    });\r\n\r\n    node.h.baseUnit = node.h.displayUnit = \"none\";\r\n    node.s.baseUnit = node.s.displayUnit = \"none\";\r\n    node.v.baseUnit = node.v.displayUnit = \"none\";\r\n    node.a.baseUnit = node.a.displayUnit = \"none\";\r\n\r\n    tab = tabs.tab(\"RGB\");\r\n\r\n    node.r = tab.slider(undefined, \"R\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let rgba = node.rgba;\r\n      node.setRGBA(e.value, rgba[1], rgba[2], rgba[3]);\r\n    });\r\n    node.g = tab.slider(undefined, \"G\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let rgba = node.rgba;\r\n      node.setRGBA(rgba[0], e.value, rgba[2], rgba[3]);\r\n    });\r\n    node.b = tab.slider(undefined, \"B\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let rgba = node.rgba;\r\n      node.setRGBA(rgba[0], rgba[1], e.value, rgba[3]);\r\n    });\r\n    node.a2 = tab.slider(undefined, \"Alpha\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let rgba = node.rgba;\r\n      node.setRGBA(rgba[0], rgba[1], rgba[2], e.value);\r\n    });\r\n\r\n    node.r.baseUnit = node.r.displayUnit = \"none\";\r\n    node.g.baseUnit = node.g.displayUnit = \"none\";\r\n    node.b.baseUnit = node.b.displayUnit = \"none\";\r\n    node.a2.baseUnit = node.a2.displayUnit = \"none\";\r\n\r\n    if (!node.getDefault(\"noCMYK\")) {\r\n      tab = tabs.tab(\"CMYK\")\r\n      let cmyk = node.getCMYK();\r\n\r\n      let makeCMYKSlider = (label, idx) => {\r\n        let slider = tab.slider(undefined, {\r\n          name      : label,\r\n          min       : 0.0,\r\n          max       : 1.0,\r\n          is_int    : false,\r\n          defaultval: cmyk[idx],\r\n          callback  : (e) => {\r\n            let cmyk = node.getCMYK();\r\n            cmyk[idx] = e.value;\r\n            node.setCMYK(cmyk[0], cmyk[1], cmyk[2], cmyk[3]);\r\n          },\r\n          step      : 0.001\r\n        });\r\n\r\n        slider.baseUnit = slider.displayUnit = \"none\";\r\n\r\n        return slider;\r\n      }\r\n\r\n      node.cmyk = [\r\n        makeCMYKSlider(\"C\", 0),\r\n        makeCMYKSlider(\"M\", 1),\r\n        makeCMYKSlider(\"Y\", 2),\r\n        makeCMYKSlider(\"K\", 3),\r\n      ];\r\n    }\r\n\r\n    node._setSliders();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname            : \"colorpicker-x\",\r\n      style              : \"colorfield\",\r\n      havePickClipboard  : true,\r\n      copyForAllChildren : true,\r\n      pasteForAllChildren: true,\r\n    };\r\n  }\r\n\r\n  clipboardCopy() {\r\n    colorClipboardCopy.apply(this, arguments);\r\n  }\r\n\r\n  clipboardPaste() {\r\n    colorClipboardPaste.apply(this, arguments);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.field = UIBase.createElement(\"colorfield-x\");\r\n    this.field.setAttribute(\"class\", \"colorpicker\");\r\n\r\n    this.field.packflag |= this.inherit_packflag;\r\n    this.field.packflag |= this.packflag;\r\n\r\n    this.field.onchange = () => {\r\n      this._setDataPath();\r\n      this._setSliders();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.field.rgba);\r\n      }\r\n    };\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n      .colorpicker {\r\n        background-color : ${this.getDefault(\"background-color\")};\r\n      }\r\n    `;\r\n\r\n    this._style = style;\r\n\r\n    let cb = this.colorbox = document.createElement(\"div\");\r\n    cb.style[\"width\"] = \"100%\";\r\n    cb.style[\"height\"] = this.getDefault(\"colorBoxHeight\") + \"px\";\r\n    cb.style[\"background-color\"] = \"black\";\r\n\r\n    this.shadow.appendChild(style);\r\n    this.field.ctx = this.ctx;\r\n\r\n    this.add(this.colorbox);\r\n    this.add(this.field);\r\n\r\n    this.style[\"width\"] = this.getDefault(\"width\") + \"px\";\r\n  }\r\n\r\n  updateColorBox() {\r\n    let r = this.field.rgba[0], g = this.field.rgba[1], b = this.field.rgba[2];\r\n    //let a = this.field.rgba[3];\r\n\r\n    r = ~~(r*255);\r\n    g = ~~(g*255);\r\n    b = ~~(b*255);\r\n\r\n    let css = `rgb(${r},${g},${b})`;\r\n    this.colorbox.style[\"background-color\"] = css;\r\n  }\r\n\r\n  _setSliders() {\r\n    if (this.h === undefined) {\r\n      //setDefault() wasn't called\r\n      console.warn(\"colorpicker ERROR\");\r\n      return;\r\n    }\r\n\r\n    let hsva = this.field.hsva;\r\n    this.h.setValue(hsva[0], false);\r\n    this.s.setValue(hsva[1], false);\r\n    this.v.setValue(hsva[2], false);\r\n    this.a.setValue(hsva[3], false);\r\n\r\n    let rgba = this.field.rgba;\r\n\r\n    this.r.setValue(rgba[0], false);\r\n    this.g.setValue(rgba[1], false);\r\n    this.b.setValue(rgba[2], false);\r\n    this.a2.setValue(rgba[3], false);\r\n\r\n    if (this.cmyk) {\r\n      let cmyk = this.field.getCMYK();\r\n\r\n      for (let i = 0; i < 4; i++) {\r\n        this.cmyk[i].setValue(cmyk[i], false);\r\n      }\r\n    }\r\n\r\n    this.updateColorBox();\r\n\r\n    if (!this._no_update_textbox) {\r\n      this.cssText.text = color2web(this.field.rgba);\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (val === undefined) {\r\n      //console.warn(\"Bad datapath\", this.getAttribute(\"datapath\"));\r\n      this.internalDisabled = true;\r\n      return;\r\n    }\r\n\r\n    this.internalDisabled = false;\r\n\r\n    _update_temp.load(val);\r\n\r\n    if (prop.type === PropTypes.VEC3) {\r\n      _update_temp[3] = 1.0;\r\n    }\r\n\r\n    if (_update_temp.vectorDistance(this.field.rgba) > 0.01) {\r\n      this.field.setRGBA(_update_temp[0], _update_temp[1], _update_temp[2], _update_temp[3], false);\r\n      this._setSliders();\r\n      this.field.update(true);\r\n    }\r\n  }\r\n\r\n  updateThemeOverride() {\r\n    let theme = this.getStyleClass();\r\n    if (theme === this._lastThemeStyle) {\r\n      return false;\r\n    }\r\n\r\n    this._lastThemeStyle = theme;\r\n    this.field.overrideClass(theme);\r\n\r\n    this.flushSetCSS();\r\n    this.flushUpdate();\r\n\r\n    return true;\r\n  }\r\n\r\n  update() {\r\n    this.updateThemeOverride();\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n\r\n    super.update();\r\n  }\r\n\r\n  _setDataPath() {\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n      if (prop === undefined) {\r\n        console.warn(\"Bad data path for color field:\", this.getAttribute(\"datapath\"));\r\n      }\r\n\r\n      let val = this.field.rgba;\r\n      if (prop !== undefined && prop.type === PropTypes.VEC3) {\r\n        val = new Vector3();\r\n        val.load(this.field.rgba);\r\n      }\r\n\r\n      this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), val);\r\n    }\r\n  }\r\n\r\n  getCMYK() {\r\n    return this.field.getCMYK();\r\n  }\r\n\r\n  setCMYK(c, m, y, k) {\r\n    this.field.setCMYK(c, m, y, k);\r\n    this._setSliders();\r\n    this._setDataPath();\r\n  }\r\n\r\n  setHSVA(h, s, v, a) {\r\n    this.field.setHSVA(h, s, v, a);\r\n    this._setSliders();\r\n    this._setDataPath();\r\n  }\r\n\r\n  getRGBA() {\r\n    return this.field.getRGBA();\r\n  }\r\n\r\n  setRGBA(r, g, b, a) {\r\n    this.field.setRGBA(r, g, b, a)\r\n    this._setSliders();\r\n    this._setDataPath();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ColorPicker);\r\n\r\n\r\nexport class ColorPickerButton extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._highlight = false;\r\n    this._depress = false;\r\n    this._label = \"error\";\r\n\r\n    this.customLabel = undefined;\r\n\r\n    this.rgba = new Vector4([1, 1, 1, 1]);\r\n\r\n    this.labelDom = document.createElement(\"span\");\r\n    this.labelDom.textContent = this._label;\r\n    this.dom = document.createElement(\"canvas\");\r\n    this.g = this.dom.getContext(\"2d\");\r\n\r\n    this.shadow.appendChild(this.labelDom);\r\n    this.shadow.appendChild(this.dom);\r\n  }\r\n\r\n  get label() {\r\n    return this._label;\r\n  }\r\n\r\n  set label(val) {\r\n    this._label = val;\r\n    this.labelDom.textContent = val;\r\n  }\r\n\r\n  get font() {\r\n    return this._font;\r\n  }\r\n\r\n  set font(val) {\r\n    this._font = val;\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  get noLabel() {\r\n    let ret = \"\" + this.getAttribute(\"no-label\");\r\n    ret = ret.toLowerCase();\r\n\r\n    return ret === \"true\" || ret === \"yes\" || ret === \"on\";\r\n  }\r\n\r\n  set noLabel(v) {\r\n    this.setAttribute(\"no-label\", v ? \"true\" : \"false\");\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname          : \"color-picker-button-x\",\r\n      style            : \"colorpickerbutton\",\r\n      havePickClipboard: true\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this._font = \"DefaultText\"; //this.getDefault(\"defaultFont\");\r\n\r\n    let enter = (e) => {\r\n      this._highlight = true;\r\n      this._redraw();\r\n    }\r\n\r\n    let leave = (e) => {\r\n      this._highlight = false;\r\n      this._redraw();\r\n    }\r\n\r\n    this.addEventListener(\"pointerover\", enter, {capture: true, passive: true});\r\n    this.addEventListener(\"pointerout\", leave, {capture: true, passive: true});\r\n    this.addEventListener(\"focus\", leave, {capture: true, passive: true});\r\n\r\n\r\n    this.addEventListener(\"mousedown\", (e) => {\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n\r\n      this.click(e);\r\n    });\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  clipboardCopy() {\r\n    colorClipboardCopy.apply(this, arguments);\r\n  }\r\n\r\n  clipboardPaste() {\r\n    colorClipboardPaste.apply(this, arguments);\r\n  }\r\n\r\n  getRGBA() {\r\n    return this.rgba;\r\n  }\r\n\r\n  click(e) {\r\n    this.abortToolTips(4000);\r\n    console.warn(\"CLICK COLORPICKER\");\r\n    this.blur();\r\n\r\n    if (this.onclick) {\r\n      this.onclick(e);\r\n    }\r\n\r\n    let colorpicker = this.ctx.screen.popup(this, this);\r\n    let ctx = contextWrangler.makeSafeContext(this.ctx);\r\n\r\n    colorpicker.ctx = ctx;\r\n    colorpicker.useDataPathUndo = this.useDataPathUndo;\r\n\r\n    let path = this.hasAttribute(\"datapath\") ? this.getAttribute(\"datapath\") : undefined;\r\n\r\n    let widget = colorpicker.colorPicker(path, undefined, this.getAttribute(\"mass_set_path\"));\r\n\r\n    widget.ctx = ctx;\r\n    widget._init();\r\n    widget.setRGBA(this.rgba[0], this.rgba[1], this.rgba[2], this.rgba[3]);\r\n\r\n    widget.style[\"padding\"] = \"20px\";\r\n\r\n    let onchange = () => {\r\n      this.rgba.load(widget.rgba);\r\n      this.redraw();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this);\r\n      }\r\n    }\r\n\r\n    widget.onchange = onchange;\r\n\r\n    colorpicker.style[\"background-color\"] = widget.getDefault(\"background-color\");\r\n    //colorpicker.style[\"border-radius\"] = \"25px\";\r\n    colorpicker.style[\"border-width\"] = widget.getDefault(\"border-width\");\r\n  }\r\n\r\n  setRGBA(val) {\r\n    let a = this.rgba[3];\r\n\r\n    let old = new Vector4(this.rgba);\r\n\r\n    this.rgba.load(val);\r\n\r\n    if (val.length < 4) {\r\n      this.rgba[3] = a;\r\n    }\r\n\r\n    if (this.rgba.vectorDistance(old) < 0.001) {\r\n      return;\r\n    }\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this.rgba);\r\n    }\r\n\r\n    if (this.onchange) {\r\n      this.onchange();\r\n    }\r\n\r\n    this._redraw();\r\n    return this;\r\n  }\r\n\r\n  on_disabled() {\r\n    this.setCSS();\r\n    this._redraw();\r\n  }\r\n\r\n  _redraw() {\r\n    let canvas = this.dom, g = this.g;\r\n\r\n    g.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    if (this.disabled) {\r\n      let color = \"rgb(55, 55, 55)\";\r\n\r\n      g.save();\r\n\r\n      ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"fill\", color);\r\n      ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"clip\");\r\n      let steps = 5;\r\n      let dt = canvas.width/steps, t = 0;\r\n\r\n      g.beginPath();\r\n      g.lineWidth = 2;\r\n      g.strokeStyle = \"black\";\r\n\r\n      for (let i = 0; i < steps; i++, t += dt) {\r\n        g.moveTo(t, 0);\r\n        g.lineTo(t + dt, canvas.height);\r\n        g.moveTo(t + dt, 0);\r\n        g.lineTo(t, canvas.height);\r\n      }\r\n\r\n      g.stroke();\r\n      g.restore();\r\n      return;\r\n    }\r\n\r\n    //do checker pattern for alpha\r\n    g.save();\r\n\r\n    let grid1 = \"rgb(100, 100, 100)\";\r\n    let grid2 = \"rgb(175, 175, 175)\";\r\n\r\n    ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"clip\");\r\n    ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"fill\", grid1);\r\n\r\n    let cellsize = 10;\r\n    let totx = Math.ceil(canvas.width/cellsize), toty = Math.ceil(canvas.height/cellsize);\r\n\r\n    ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"clip\", undefined, undefined, true);\r\n    g.clip();\r\n\r\n    g.beginPath();\r\n    for (let x = 0; x < totx; x++) {\r\n      for (let y = 0; y < toty; y++) {\r\n        if ((x + y) & 1) {\r\n          continue;\r\n        }\r\n\r\n        g.rect(x*cellsize, y*cellsize, cellsize, cellsize);\r\n      }\r\n    }\r\n\r\n    g.fillStyle = grid2;\r\n    g.fill();\r\n\r\n    //g.fillStyle = \"orange\";\r\n    //g.beginPath();\r\n    //g.rect(0, 0, canvas.width, canvas.height);\r\n    //g.fill();\r\n\r\n    let color = color2css(this.rgba);\r\n    ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"fill\", color, undefined, true);\r\n    //drawRoundBox(elem, canvas, g, width, height, r=undefined, op=\"fill\", color=undefined, pad=undefined) {\r\n\r\n    if (this._highlight) {\r\n      //let color = \"rgba(200, 200, 255, 0.5)\";\r\n      let color = this.getDefault(\"BoxHighlight\");\r\n      ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"fill\", color);\r\n    }\r\n\r\n    g.restore();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    let w = this.getDefault(\"width\");\r\n    let h = this.getDefault(\"height\");\r\n    let dpi = this.getDPI();\r\n\r\n    this.style[\"width\"] = \"min-contents\" + \"px\";\r\n    this.style[\"height\"] = h + \"px\";\r\n\r\n    this.style[\"flex-direction\"] = \"row\";\r\n    this.style[\"display\"] = \"flex\";\r\n\r\n    this.labelDom.style[\"color\"] = this.getDefault(this._font).color;\r\n    this.labelDom.style[\"font\"] = ui_base.getFont(this, undefined, this._font, false);\r\n\r\n    let canvas = this.dom;\r\n\r\n    canvas.style[\"width\"] = w + \"px\";\r\n    canvas.style[\"height\"] = h + \"px\";\r\n    canvas.width = ~~(w*dpi);\r\n    canvas.height = ~~(h*dpi);\r\n\r\n    this.style[\"background-color\"] = \"rgba(0,0,0,0)\";\r\n    this._redraw();\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!(this.hasAttribute(\"datapath\"))) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n    let prop = this.getPathMeta(this.ctx, path);\r\n\r\n    if ((prop === undefined || prop.data === undefined) && cconst.DEBUG.verboseDataPath) {\r\n      console.log(\"bad path\", path);\r\n      return;\r\n    } else if (prop === undefined) {\r\n      let redraw = !this.disabled;\r\n\r\n      this.internalDisabled = true;\r\n\r\n      if (redraw) {\r\n        this._redraw();\r\n      }\r\n      return;\r\n    }\r\n\r\n    let redraw = this.disabled;\r\n\r\n    this.internalDisabled = false;\r\n\r\n    if (this.customLabel === undefined && prop.uiname !== this._label) {\r\n      this.label = prop.uiname;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, path);\r\n\r\n    if (val === undefined) {\r\n      redraw = redraw || this.disabled !== true;\r\n\r\n      this.internalDisabled = true;\r\n\r\n      if (redraw) {\r\n        this._redraw();\r\n      }\r\n\r\n    } else {\r\n      this.internalDisabled = false;\r\n\r\n      let dis;\r\n\r\n      if (val.length === 3) {\r\n        dis = Vector3.prototype.vectorDistance.call(val, this.rgba);\r\n      } else {\r\n        dis = this.rgba.vectorDistance(val);\r\n      }\r\n\r\n      if (dis > 0.0001) {\r\n        if (prop.type === PropTypes.VEC3) {\r\n          this.rgba.load(val);\r\n          this.rgba[3] = 1.0;\r\n        } else {\r\n          this.rgba.load(val);\r\n        }\r\n\r\n        redraw = true;\r\n      }\r\n\r\n      if (redraw) {\r\n        this._redraw();\r\n      }\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    if (this.noLabel && this.labelDom.isConnected) {\r\n      this.labelDom.remove();\r\n    }\r\n\r\n    if (this.customLabel !== undefined && this.customLabel !== this._label) {\r\n      this.label = this.customLabel;\r\n    }\r\n\r\n    for (let i = 0; i < this.rgba.length; i++) {\r\n      if (this.rgba[i] === undefined) {\r\n        console.warn(\"corrupted color or alpha detected\", this.rgba);\r\n        this.rgba[i] = 1.0;\r\n      }\r\n    }\r\n\r\n    let key = \"\" + this.rgba[0].toFixed(4) + \" \" + this.rgba[1].toFixed(4) + \" \" + this.rgba[2].toFixed(4) + \" \" + this.rgba[3].toFixed(4);\r\n    key += this.disabled;\r\n\r\n    if (key !== this._last_key) {\r\n      this._last_key = key;\r\n      this.redraw();\r\n    }\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n  }\r\n\r\n  redraw() {\r\n    this._redraw();\r\n  }\r\n};\r\nUIBase.internalRegister(ColorPickerButton);\r\n","\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as ui from '../core/ui.js';\r\nimport {loadUIData, saveUIData} from '../core/ui_base.js';\r\n\r\nlet UIBase      = ui_base.UIBase,\r\n    PackFlags   = ui_base.PackFlags,\r\n    IconSheets  = ui_base.IconSheets,\r\n    iconmanager = ui_base.iconmanager;\r\n\r\nexport let tab_idgen = 1;\r\nlet debug = false;\r\nlet Vector2 = vectormath.Vector2;\r\n\r\nfunction getpx(css) {\r\n  return parseFloat(css.trim().replace(\"px\", \"\"))\r\n}\r\n\r\nlet FAKE_TAB_ID = Symbol(\"fake_tab_id\");\r\n\r\n\r\nclass TabDragEvent extends PointerEvent {\r\n}\r\n\r\n\r\n/* subclass HTMLElement so tabs can be used as the .target\r\n*  member of events*/\r\nexport class TabItem extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.name = name;\r\n    this.icon = undefined;\r\n    this.tooltip = \"\";\r\n    this.movable = true;\r\n    this.tbar = undefined;\r\n\r\n    this.ontabclick = null;\r\n    this.ontabdragstart = null;\r\n    this.ontabdragmove = null;\r\n    this.ontabdragend = null;\r\n\r\n    let helper = (key) => {\r\n      let key2 = \"on\" + key;\r\n\r\n      this.addEventListener(key, (e) => {\r\n        if (this[key2]) {\r\n          return this[key2](e);\r\n        }\r\n      });\r\n    }\r\n\r\n    helper(\"tabclick\");\r\n    helper(\"tabdragstart\");\r\n    helper(\"tabdragmove\");\r\n    helper(\"tabdragend\");\r\n\r\n    this.dom = undefined;\r\n    this.extra = undefined;\r\n    this.extraSize = undefined;\r\n\r\n    this.size = new Vector2();\r\n    this.pos = new Vector2();\r\n\r\n    this.abssize = new Vector2();\r\n    this.abspos = new Vector2();\r\n\r\n    this.addEventListener(\"pointerdown\", (e) => {\r\n      this.parentWidget.on_pointerdown(e);\r\n    });\r\n\r\n    this.addEventListener(\"pointermove\", (e) => {\r\n      this.parentWidget.on_pointermove(e);\r\n    });\r\n\r\n    this.addEventListener(\"pointerup\", (e) => {\r\n      this.parentWidget.on_pointerup(e);\r\n    });\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"tab-item-x\"\r\n    }\r\n  }\r\n\r\n  sendEvent(type, forwardEvent) {\r\n    let cls;\r\n\r\n    if (type === \"tabdragstart\" || type === \"tabdragend\") {\r\n      cls = TabDragEvent;\r\n    } else if (forwardEvent && forwardEvent instanceof Event) {\r\n      cls = forwardEvent.constructor;\r\n    } else {\r\n      cls = PointerEvent;\r\n    }\r\n\r\n    let e2 = {};\r\n\r\n    if (forwardEvent) {\r\n      for (let k in forwardEvent) {\r\n        if (k === \"defaultPrevented\" || k === \"cancelBubble\") {\r\n          continue;\r\n        }\r\n\r\n        e2[k] = forwardEvent[k];\r\n      }\r\n    }\r\n\r\n    e2.target = this;\r\n\r\n    e2 = new cls(type, e2);\r\n\r\n    this.dispatchEvent(e2);\r\n    return e2;\r\n  }\r\n\r\n  getClientRects() {\r\n    let r = this.tbar.getClientRects()[0];\r\n\r\n    let s = this.abssize, p = this.abspos;\r\n\r\n    s.load(this.size);\r\n    p.load(this.pos);\r\n\r\n    if (r) {\r\n      p[0] += r.x;\r\n      p[1] += r.y;\r\n    }\r\n\r\n    return [{\r\n      x  : p[0], y: p[1], width: s[0], height: s[1], left: p[0],\r\n      top: p[1], right: p[0] + s[0], bottom: p[1] + s[1]\r\n    }];\r\n  }\r\n\r\n  setCSS() {\r\n    let dpi = UIBase.getDPI();\r\n    let x = this.pos[0]/dpi;\r\n    let y = this.pos[1]/dpi;\r\n    let w = this.size[0]/dpi;\r\n    let h = this.size[1]/dpi;\r\n\r\n    this.style[\"background-color\"] = \"transparent\";\r\n\r\n    this.style[\"margin\"] = this.style[\"padding\"] = \"0px\";\r\n    this.style[\"position\"] = \"absolute\";\r\n    this.style[\"pointer-events\"] = \"auto\";\r\n\r\n    this.style[\"left\"] = x + \"px\";\r\n    this.style[\"top\"] = y + \"px\";\r\n    this.style[\"width\"] = w + \"px\";\r\n    this.style[\"height\"] = h + \"px\";\r\n  }\r\n}\r\nUIBase.internalRegister(TabItem);\r\n\r\nexport class ModalTabMove extends events.EventHandler {\r\n  constructor(tab, tbar, dom) {\r\n    super();\r\n\r\n    this.dom = dom;\r\n    this.tab = tab;\r\n    this.tbar = tbar;\r\n    this.first = true;\r\n\r\n    this.droptarget = undefined;\r\n    this.start_mpos = new Vector2();\r\n    this.mpos = undefined;\r\n\r\n    this.dragtab = undefined;\r\n    this.dragstate = false;\r\n    this.finished = false;\r\n  }\r\n\r\n  finish() {\r\n    if (debug) if (debug) console.log(\"finish\");\r\n\r\n    if (this.finished) {\r\n      return;\r\n    }\r\n\r\n    this.finished = true;\r\n\r\n    if (this.tbar.tool === this) {\r\n      this.tbar.tool = undefined;\r\n    }\r\n\r\n    this.popModal(this.dom);\r\n    this.tbar.update(true);\r\n  }\r\n\r\n  popModal() {\r\n    if (this.dragcanvas !== undefined) {\r\n      this.dragcanvas.remove();\r\n    }\r\n    let ret = super.popModal(...arguments);\r\n\r\n    this.tab.sendEvent(\"tabdragend\");\r\n\r\n    return ret;\r\n  }\r\n\r\n  on_pointerleave(e) {\r\n  }\r\n  on_pointerenter(e) {\r\n  }\r\n  on_pointerenter(e) {\r\n  }\r\n  on_pointerstart(e) {\r\n  }\r\n  on_pointerend(e) {\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    this.finish();\r\n  }\r\n\r\n  on_pointercancel(e) {\r\n    this.finish();\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    this.finish();\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    return this._on_move(e, e.x, e.y);\r\n  }\r\n\r\n  _dragstate(e, x, y) {\r\n    this.dragcanvas.style[\"left\"] = x + \"px\";\r\n    this.dragcanvas.style[\"top\"] = y + \"px\";\r\n\r\n    let ctx = this.tbar.ctx;\r\n    let screen = ctx.screen;\r\n    let elem = screen.pickElement(x, y);\r\n\r\n    let e2 = new DragEvent(\"dragenter\", this.dragevent);\r\n    if (elem !== this.droptarget) {\r\n      let e2 = new DragEvent(\"dragexit\", this.dragevent);\r\n      if (this.droptarget) {\r\n        this.droptarget.dispatchEvent(e2);\r\n      }\r\n\r\n      e2 = new DragEvent(\"dragover\", this.dragevent);\r\n      this.droptarget = elem;\r\n      if (elem) {\r\n        elem.dispatchEvent(e2);\r\n      }\r\n    }\r\n    //console.log(elem);\r\n  }\r\n\r\n  _on_move(e, x, y) {\r\n    let r = this.tbar.getClientRects()[0];\r\n    let dpi = UIBase.getDPI();\r\n\r\n    if (r === undefined) {\r\n      //element was removed during/before move\r\n      this.finish();\r\n      return;\r\n    }\r\n\r\n    if (this.dragstate) {\r\n      this._dragstate(e, x, y);\r\n      return;\r\n    }\r\n\r\n    x -= r.x;\r\n    y -= r.y;\r\n\r\n    let dx, dy;\r\n\r\n    x *= dpi;\r\n    y *= dpi;\r\n\r\n    if (this.first) {\r\n      this.first = false;\r\n      this.start_mpos[0] = x;\r\n      this.start_mpos[1] = y;\r\n    }\r\n    if (this.mpos === undefined) {\r\n      this.mpos = [0, 0];\r\n      dx = dy = 0;\r\n    } else {\r\n      dx = x - this.mpos[0];\r\n      dy = y - this.mpos[1];\r\n    }\r\n\r\n    if (debug) console.log(x, y, dx, dy);\r\n\r\n    let tab = this.tab, tbar = this.tbar;\r\n    let axis = tbar.horiz ? 0 : 1;\r\n    let distx, disty;\r\n\r\n    if (tbar.horiz) {\r\n      tab.pos[0] += dx;\r\n      disty = Math.abs(y - this.start_mpos[1]);\r\n    } else {\r\n      tab.pos[1] += dy;\r\n      disty = Math.abs(x - this.start_mpos[0]);\r\n    }\r\n\r\n    let limit = 50;\r\n    let csize = tbar.horiz ? this.tbar.canvas.width : this.tbar.canvas.height;\r\n\r\n    let dragok = tab.pos[axis] + tab.size[axis] < -limit || tab.pos[axis] >= csize + limit;\r\n    dragok = dragok || disty > limit*1.5;\r\n    dragok = dragok && (this.tbar.draggable || this.tbar.getAttribute(\"draggable\"));\r\n\r\n    //console.log(dragok, disty, this.tbar.draggable);\r\n\r\n    if (dragok) {\r\n      this.dragstate = true;\r\n      this.dragevent = new DragEvent(\"dragstart\", {\r\n        dataTransfer: new DataTransfer()\r\n      });\r\n\r\n      this.dragtab = tab;\r\n      let g = this.tbar.g;\r\n      this.dragimg = g.getImageData(~~tab.pos[0], ~~tab.pos[1], ~~tab.size[0], ~~tab.size[1]);\r\n      this.dragcanvas = document.createElement(\"canvas\");\r\n      let g2 = this.drag_g = this.dragcanvas.getContext(\"2d\");\r\n\r\n      this.dragcanvas.visibleToPick = false;\r\n      this.dragcanvas.width = ~~tab.size[0];\r\n      this.dragcanvas.height = ~~tab.size[1];\r\n      this.dragcanvas.style[\"width\"] = (tab.size[0]/dpi) + \"px\";\r\n      this.dragcanvas.style[\"height\"] = (tab.size[1]/dpi) + \"px\";\r\n      this.dragcanvas.style[\"position\"] = UIBase.PositionKey;\r\n      this.dragcanvas.style[\"left\"] = e.x + \"px\";\r\n      this.dragcanvas.style[\"top\"] = e.y + \"px\";\r\n      this.dragcanvas.style[\"z-index\"] = \"500\";\r\n      document.body.appendChild(this.dragcanvas);\r\n      g2.putImageData(this.dragimg, 0, 0);\r\n\r\n\r\n      this.tbar.dispatchEvent(this.dragevent);\r\n\r\n      return;\r\n    }\r\n\r\n    let ti = tbar.tabs.indexOf(tab);\r\n    let next = ti < tbar.tabs.length - 1 ? tbar.tabs[ti + 1] : undefined;\r\n    let prev = ti > 0 ? tbar.tabs[ti - 1] : undefined;\r\n\r\n    if (next !== undefined && next.movable && tab.pos[axis] > next.pos[axis]) {\r\n      tbar.swapTabs(tab, next);\r\n    } else if (prev !== undefined && prev.movable && tab.pos[axis] < prev.pos[axis] + prev.size[axis]*0.5) {\r\n      tbar.swapTabs(tab, prev);\r\n    }\r\n\r\n    tbar.update(true);\r\n\r\n    this.mpos[0] = x;\r\n    this.mpos[1] = y;\r\n\r\n    let e2 = tab.sendEvent(\"tabdragmove\", e);\r\n\r\n    if (e2.defaultPrevented) {\r\n      this.finish();\r\n    }\r\n  }\r\n\r\n  on_keydown(e) {\r\n    if (debug) console.log(e.keyCode);\r\n\r\n    switch (e.keyCode) {\r\n      case 27: //escape\r\n      case 32: //space\r\n      case 13: //enter\r\n      case 9: //tab\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\nexport class TabBar extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    let style = document.createElement(\"style\");\r\n    let canvas = document.createElement(\"canvas\");\r\n\r\n    this.iconsheet = 0;\r\n    this.movableTabs = true;\r\n\r\n    this.tabFontScale = 1.0;\r\n\r\n    this.tabs = [];\r\n    this.tabs.active = undefined;\r\n    this.tabs.highlight = undefined;\r\n\r\n    this._last_style_key = undefined;\r\n\r\n    canvas.style[\"width\"] = \"145px\";\r\n    canvas.style[\"height\"] = \"45px\";\r\n\r\n    this.r = 8;\r\n\r\n    this.canvas = canvas;\r\n    this.g = canvas.getContext(\"2d\");\r\n\r\n    this.canvas.style[\"touch-action\"] = \"none\";\r\n\r\n    style.textContent = `\r\n    `;\r\n\r\n    this.shadow.appendChild(style);\r\n    this.shadow.appendChild(canvas);\r\n\r\n    this._last_dpi = undefined;\r\n    this._last_pos = undefined;\r\n\r\n    this.horiz = true;\r\n    this.onchange = null;\r\n    this.onselect = null; //onselect is like onchange, but fires even if tab hasn't changed\r\n\r\n    let mx, my;\r\n\r\n    this.canvas.addEventListener(\"pointermove\", (e) => {\r\n      this.on_pointermove(e);\r\n    }, false);\r\n\r\n\r\n    this.canvas.addEventListener(\"pointerdown\", (e) => {\r\n      this.on_pointerdown(e);\r\n    });\r\n  }\r\n\r\n  _doelement(e, mx, my){\r\n    for (let tab of this.tabs) {\r\n      let ok;\r\n\r\n      if (this.horiz) {\r\n        ok = mx >= tab.pos[0] && mx <= tab.pos[0] + tab.size[0];\r\n      } else {\r\n        ok = my >= tab.pos[1] && my <= tab.pos[1] + tab.size[1];\r\n      }\r\n\r\n      if (ok && this.tabs.highlight !== tab) {\r\n        this.tabs.highlight = tab;\r\n        this.update(true);\r\n      }\r\n    }\r\n  }\r\n\r\n  _domouse (e) {\r\n    let r = this.canvas.getClientRects()[0];\r\n\r\n    let mx = e.x - r.x;\r\n    let my = e.y - r.y;\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    mx *= dpi;\r\n    my *= dpi;\r\n\r\n    this._doelement(e, mx, my);\r\n\r\n    const is_mdown = e.type === \"mousedown\";\r\n    if (is_mdown && this.onselect && this._fireOnSelect().defaultPrevented) {\r\n      e.preventDefault();\r\n    }\r\n  }\r\n\r\n  _doclick (e) {\r\n    this._domouse(e);\r\n\r\n    if (e.defaultPrevented) {\r\n      return;\r\n    }\r\n\r\n    if (debug) console.log(\"mdown\");\r\n\r\n    if (e.button !== 0) {\r\n      return;\r\n    }\r\n\r\n    let ht = this.tabs.highlight;\r\n\r\n    let acte = {};\r\n    for (let k in e) {\r\n      if (k === \"defaultPrevented\" || k === \"cancelBubble\") {\r\n        continue;\r\n      }\r\n\r\n      acte[k] = e[k];\r\n    }\r\n\r\n    acte.target = ht;\r\n    acte.pointerId = e.pointerId;\r\n\r\n    acte = new PointerEvent(\"tabactive\", acte);\r\n\r\n    let e2 = ht.sendEvent(\"tabclick\", e);\r\n\r\n    if (e2.defaultPrevented) {\r\n      acte.preventDefault();\r\n    }\r\n\r\n    if (ht !== undefined && this.tool === undefined) {\r\n      this.setActive(ht, acte);\r\n\r\n      if (this.movableTabs && !acte.defaultPrevented) {\r\n        this._startMove(ht, e);\r\n      }\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    this._doclick(e);\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let r = this.canvas.getClientRects()[0];\r\n    this._domouse(e);\r\n\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n  }\r\n\r\n  on_pointerup(e) {\r\n\r\n  }\r\n\r\n\r\n  static setDefault(e) {\r\n    e.setAttribute(\"bar_pos\", \"top\");\r\n    e.updatePos(true);\r\n\r\n    return e;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"tabbar-x\",\r\n      style  : \"tabs\"\r\n    };\r\n  }\r\n\r\n  _ensureNoModal() {\r\n    if (this.tool) {\r\n      this.tool.finish();\r\n      this.tool = undefined;\r\n    }\r\n  }\r\n\r\n  get tool() {\r\n    return this._tool;\r\n  }\r\n\r\n  set tool(v) {\r\n    //console.warn(\"SET TOOL\", v, this._id);\r\n    this._tool = v;\r\n  }\r\n\r\n  _startMove(tab=this.tabs.active, event, pointerId=event ? event.pointerId : undefined, pointerElem=tab) {\r\n    if (this.movableTabs) {\r\n      let e2 = tab.sendEvent(\"tabdragstart\", event);\r\n\r\n      if (e2.defaultPrevented) {\r\n        return;\r\n      }\r\n\r\n      if (this.tool) {\r\n        this.tool.finish();\r\n      }\r\n\r\n      let edom = this.getScreen();\r\n      let tool = this.tool = new ModalTabMove(tab, this, edom);\r\n\r\n      if (event && pointerElem && pointerId !== undefined) {\r\n        tool.pushPointerModal(pointerElem, pointerId);\r\n      } else {\r\n        tool.pushModal(edom, false);\r\n      }\r\n    }\r\n  }\r\n\r\n  _fireOnSelect() {\r\n    let e = this._makeOnSelectEvt();\r\n\r\n    if (this.onselect) {\r\n      this.onselect(e);\r\n    }\r\n\r\n    return e;\r\n  }\r\n\r\n  _makeOnSelectEvt() {\r\n    return {\r\n      tab             : this.tabs.highlight,\r\n      defaultPrevented: false,\r\n      preventDefault() {\r\n        this.defaultPrevented = true;\r\n      }\r\n    }\r\n    /*\r\n      return new MouseEvent(\"mousedown\", {\r\n        target : [this.tabs.highlight],\r\n        tab : \"sdfdsf\"\r\n      });\r\n\r\n   */\r\n  }\r\n\r\n  getTab(name_or_id) {\r\n    for (let tab of this.tabs) {\r\n      if (tab.id === name_or_id || tab.name === name_or_id)\r\n        return tab;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  clear() {\r\n    for (let t of this.tabs) {\r\n      if (t.dom) {\r\n        t.dom.remove();\r\n        t.dom = undefined;\r\n      }\r\n    }\r\n\r\n    this.tabs = [];\r\n    this.setCSS();\r\n    this._redraw();\r\n  }\r\n\r\n  saveData() {\r\n    let taborder = [];\r\n\r\n    for (let tab of this.tabs) {\r\n      taborder.push(tab.name);\r\n    }\r\n\r\n    let act = this.tabs.active !== undefined ? this.tabs.active.name : \"null\";\r\n\r\n    return {\r\n      taborder: taborder,\r\n      active  : act\r\n    };\r\n  }\r\n\r\n  loadData(obj) {\r\n    if (!obj.taborder) {\r\n      return;\r\n    }\r\n\r\n    let tabs = this.tabs;\r\n    let active = undefined;\r\n    let ntabs = [];\r\n\r\n    ntabs.active = undefined;\r\n    ntabs.highlight = undefined;\r\n\r\n    for (let tname of obj.taborder) {\r\n      let tab = this.getTab(tname);\r\n\r\n      if (tab === undefined) {\r\n        continue;\r\n      }\r\n\r\n      if (tab.name === obj.active) {\r\n        active = tab;\r\n      }\r\n\r\n      ntabs.push(tab);\r\n    }\r\n\r\n    for (let tab of tabs) {\r\n      if (ntabs.indexOf(tab) < 0) {\r\n        ntabs.push(tab);\r\n      }\r\n    }\r\n\r\n    this.tabs = ntabs;\r\n\r\n    try {\r\n      if (active !== undefined) {\r\n        this.setActive(active);\r\n      } else if (this.tabs.length > 0) {\r\n        this.setActive(this.tabs[0]);\r\n      }\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n    }\r\n\r\n    this.update(true);\r\n\r\n    return this;\r\n  }\r\n\r\n  swapTabs(a, b) {\r\n    let tabs = this.tabs;\r\n\r\n    let ai = tabs.indexOf(a);\r\n    let bi = tabs.indexOf(b);\r\n\r\n    tabs[ai] = b;\r\n    tabs[bi] = a;\r\n\r\n    this.update(true);\r\n  }\r\n\r\n  addIconTab(icon, id, tooltip, movable = true) {\r\n    let tab = this.addTab(\"\", id, tooltip, movable);\r\n    tab.icon = icon;\r\n\r\n    return tab;\r\n  }\r\n\r\n  addTab(name, id, tooltip = \"\", movable) {\r\n    let tab = UIBase.createElement(\"tab-item-x\", true);\r\n\r\n    this.shadow.appendChild(tab);\r\n    tab.parentWidget = this;\r\n\r\n\r\n    tab.name = name;\r\n    tab.id = id;\r\n    tab.tooltip = tooltip;\r\n    tab.movable = movable;\r\n    tab.tbar = this;\r\n\r\n    this.tabs.push(tab);\r\n    this.update(true);\r\n\r\n    if (this.tabs.length === 1) {\r\n      this.setActive(this.tabs[0]);\r\n    }\r\n\r\n    return tab;\r\n  }\r\n\r\n  updatePos(force_update = false) {\r\n    let pos = this.getAttribute(\"bar_pos\");\r\n\r\n    if (pos !== this._last_pos || force_update) {\r\n      this._last_pos = pos;\r\n\r\n      this.horiz = pos === \"top\" || pos === \"bottom\";\r\n      if (debug) console.log(\"tab bar position update\", this.horiz);\r\n\r\n      if (this.horiz) {\r\n        this.style[\"width\"] = \"100%\";\r\n        delete this.style[\"height\"];\r\n      } else {\r\n        this.style[\"height\"] = \"100%\";\r\n        delete this.style[\"width\"];\r\n      }\r\n\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  updateDPI(force_update = false) {\r\n    let dpi = this.getDPI();\r\n\r\n    if (dpi !== this._last_dpi) {\r\n      if (debug) console.log(\"DPI update!\");\r\n      this._last_dpi = dpi;\r\n\r\n      this.updateCanvas(true);\r\n    }\r\n  }\r\n\r\n  updateCanvas(force_update = false) {\r\n    let canvas = this.canvas;\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let rwidth = getpx(this.canvas.style[\"width\"]);\r\n    let rheight = getpx(this.canvas.style[\"height\"]);\r\n\r\n    let width = ~~(rwidth*dpi);\r\n    let height = ~~(rheight*dpi);\r\n\r\n    let update = force_update;\r\n    update = update || canvas.width !== width || canvas.height !== height;\r\n\r\n    if (update) {\r\n      canvas.width = width;\r\n      canvas.height = height;\r\n\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _getFont(tsize) {\r\n    let font = this.getDefault(\"TabText\");\r\n\r\n    if (this.tabFontScale !== 1.0) {\r\n      font = font.copy();\r\n      font.size *= this.tabFontScale;\r\n    }\r\n\r\n    return font;\r\n  }\r\n\r\n  _layout() {\r\n    if ((!this.ctx || !this.ctx.screen) && !this.isDead()) {\r\n      this.doOnce(this._layout);\r\n    }\r\n\r\n    let g = this.g;\r\n\r\n    if (debug) console.log(\"tab layout\");\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let font = this._getFont();\r\n    let tsize = (font.size*dpi);\r\n\r\n    g.font = font.genCSS(tsize);\r\n\r\n    let axis = this.horiz ? 0 : 1;\r\n\r\n    let pad = 4*dpi + Math.ceil(tsize*0.25);\r\n    let x = pad;\r\n    let y = 0;\r\n\r\n    let h = tsize + Math.ceil(tsize*0.5);\r\n    let iconsize = iconmanager.getTileSize(this.iconsheet);\r\n    let have_icons = false;\r\n\r\n    for (let tab of this.tabs) {\r\n      if (tab.icon !== undefined) {\r\n        have_icons = true;\r\n        h = Math.max(h, iconsize + 4);\r\n        break;\r\n      }\r\n    }\r\n\r\n    let r1 = this.parentWidget ? this.parentWidget.getClientRects()[0] : undefined;\r\n    let r2 = this.canvas.getClientRects()[0];\r\n\r\n    let rx = 0, ry = 0;\r\n    if (r1 && r2) {\r\n      rx = r2.x;//r2.x - r1.x;\r\n      ry = r2.y; //r2.y - r1.y;\r\n    }\r\n\r\n    let ti = -1;\r\n\r\n    let makeTabWatcher = (tab) => {\r\n      if (tab.watcher) {\r\n        clearInterval(tab.watcher.timer);\r\n      }\r\n\r\n      let watcher = () => {\r\n        let dead = this.tabs.indexOf(tab) < 0;\r\n        dead = dead || this.isDead();\r\n\r\n        if (dead) {\r\n          if (tab.dom)\r\n            tab.dom.remove();\r\n          tab.dom = undefined;\r\n\r\n          if (tab.watcher.timer)\r\n            clearInterval(tab.watcher.timer);\r\n        }\r\n      };\r\n\r\n      tab.watcher = watcher;\r\n      tab.watcher.timer = window.setInterval(watcher, 750);\r\n\r\n      return tab.watcher.timer;\r\n    };\r\n\r\n    let haveTabDom = false;\r\n    for (let tab of this.tabs) {\r\n      if (tab.extra) {\r\n        haveTabDom = true;\r\n      }\r\n    }\r\n\r\n    if (haveTabDom && this.ctx && this.ctx.screen && !this._size_cb) {\r\n      this._size_cb = () => {\r\n        if (this.isDead()) {\r\n          this.ctx.screen.removeEventListener(\"resize\", this._size_cb);\r\n          this._size_cb = undefined;\r\n          return;\r\n        }\r\n        if (!this.ctx) return;\r\n\r\n        this._layout();\r\n        this._redraw();\r\n      };\r\n\r\n      this.ctx.screen.addEventListener(\"resize\", this._size_cb);\r\n    }\r\n\r\n    for (let tab of this.tabs) {\r\n      ti++;\r\n\r\n      if (tab.extra && !tab.dom) {\r\n\r\n        tab.dom = document.createElement(\"div\");\r\n        tab.dom.style[\"margin\"] = tab.dom.style[\"padding\"] = \"0px\";\r\n\r\n        let z = this.calcZ();\r\n        tab.dom.style[\"z-index\"] = z + 1 + ti;\r\n\r\n        document.body.appendChild(tab.dom);\r\n        tab.dom.style[\"position\"] = UIBase.PositionKey;\r\n        tab.dom.style[\"display\"] = \"flex\";\r\n        tab.dom.style[\"flex-direction\"] = this.horiz ? \"row\" : \"column\";\r\n\r\n        tab.dom.style[\"pointer-events\"] = \"none\";\r\n\r\n        if (!this.horiz) {\r\n          tab.dom.style[\"width\"] = (tab.size[0]/dpi) + \"px\";\r\n          tab.dom.style[\"height\"] = (tab.size[1]/dpi) + \"px\";\r\n          tab.dom.style[\"left\"] = (rx + tab.pos[0]/dpi) + \"px\";\r\n          tab.dom.style[\"top\"] = (ry + tab.pos[1]/dpi) + \"px\";\r\n        } else {\r\n          tab.dom.style[\"width\"] = (tab.size[0]/dpi) + \"px\";\r\n          tab.dom.style[\"height\"] = (tab.size[1]/dpi) + \"px\";\r\n          tab.dom.style[\"left\"] = (rx + tab.pos[0]/dpi) + \"px\";\r\n          tab.dom.style[\"top\"] = (ry + tab.pos[1]/dpi) + \"px\";\r\n        }\r\n\r\n        let font = this._getFont();\r\n        tab.dom.style[\"font\"] = font.genCSS();\r\n        tab.dom.style[\"color\"] = font.color;\r\n\r\n        tab.dom.appendChild(tab.extra);\r\n\r\n        //tab.dom.style[\"background-color\"] = \"red\";\r\n\r\n        makeTabWatcher(tab);\r\n      }\r\n\r\n      let w = g.measureText(tab.name).width;\r\n\r\n      if (tab.extra) {\r\n        w += tab.extraSize || tab.extra.getClientRects()[0].width;\r\n\r\n      }\r\n\r\n      if (tab.icon !== undefined) {\r\n        w += iconsize;\r\n      }\r\n\r\n      //don't interfere with tab dragging\r\n      let bad = this.tool !== undefined && tab === this.tabs.active;\r\n\r\n      if (!bad) {\r\n        tab.pos[axis] = x;\r\n        tab.pos[axis ^ 1] = y;\r\n      }\r\n\r\n      //tab.size = [0, 0];\r\n      tab.size[axis] = w + pad*2;\r\n      tab.size[axis ^ 1] = h;\r\n\r\n      x += w + pad*2;\r\n    }\r\n\r\n    x = (~~(x + pad))/dpi;\r\n    h = (~~h)/dpi;\r\n\r\n\r\n    if (this.horiz) {\r\n      this.canvas.style[\"width\"] = x + \"px\";\r\n      this.canvas.style[\"height\"] = h + \"px\";\r\n    } else {\r\n      this.canvas.style[\"height\"] = x + \"px\";\r\n      this.canvas.style[\"width\"] = h + \"px\";\r\n    }\r\n\r\n    for (let tab of this.tabs) {\r\n      tab.setCSS();\r\n    }\r\n\r\n    //this.canvas.width = x;\r\n  }\r\n\r\n  /** tab is a TabItem instance */\r\n  setActive(tab, event) {\r\n    if (tab.noSwitch) {\r\n      return;\r\n    }\r\n\r\n    let update = tab !== this.tabs.active;\r\n    this.tabs.active = tab;\r\n\r\n    if (update) {\r\n      if (this.onchange)\r\n        this.onchange(tab, event);\r\n\r\n      this.update(true);\r\n    }\r\n  }\r\n\r\n  _redraw() {\r\n    let g = this.g;\r\n\r\n    let activecolor = this.getDefault(\"TabActive\") || \"rgba(0,0,0,0)\";\r\n\r\n    if (debug) console.log(\"tab draw\");\r\n\r\n    g.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n\r\n    let dpi = this.getDPI();\r\n    let font = this._getFont();\r\n\r\n    let tsize = font.size;\r\n    let iconsize = iconmanager.getTileSize(this.iconsheet);\r\n\r\n    tsize = (tsize*dpi);\r\n    g.font = font.genCSS(tsize);\r\n\r\n    g.lineWidth = 2;\r\n    g.strokeStyle = this.getDefault(\"TabStrokeStyle1\");\r\n\r\n    let r = this.r*dpi;\r\n    this._layout();\r\n    let tab;\r\n\r\n    let ti = -1;\r\n    for (tab of this.tabs) {\r\n      ti++;\r\n\r\n      if (tab === this.tabs.active)\r\n        continue;\r\n\r\n      let x = tab.pos[0], y = tab.pos[1];\r\n      let w = tab.size[0], h = tab.size[1];\r\n      //let tw = g.measureText(tab.name).width;\r\n      let tw = ui_base.measureText(this, tab.name, this.canvas, g, tsize, font).width;\r\n\r\n      let x2 = x + (tab.size[this.horiz ^ 1] - tw)*0.5;\r\n      let y2 = y + tsize;\r\n\r\n      if (tab === this.tabs.highlight) {\r\n        let p = 2;\r\n\r\n        g.beginPath();\r\n        g.rect(x + p, y + p, w - p*2, h - p*2);\r\n        g.fillStyle = this.getDefault(\"TabHighlight\");\r\n        g.fill();\r\n      }\r\n\r\n      g.fillStyle = this.getDefault(\"TabText\").color;\r\n\r\n      if (!this.horiz) {\r\n        let x3 = 0, y3 = y2;\r\n\r\n        g.save();\r\n        g.translate(x3, y3);\r\n        g.rotate(Math.PI/2);\r\n        g.translate(x3 - tsize, -y3 - tsize*0.5);\r\n      }\r\n\r\n      if (tab.icon !== undefined) {\r\n        iconmanager.canvasDraw(this, this.canvas, g, tab.icon, x, y, this.iconsheet);\r\n        x2 += iconsize + 4;\r\n      }\r\n\r\n      g.fillText(tab.name, x2, y2);\r\n\r\n      if (!this.horiz) {\r\n        g.restore();\r\n      }\r\n\r\n      let prev = this.tabs[Math.max(ti - 1 + this.tabs.length, 0)];\r\n      let next = this.tabs[Math.min(ti + 1, this.tabs.length - 1)];\r\n\r\n      if (tab !== this.tabs[this.tabs.length - 1] && prev !== this.tabs.active && next !== this.tabs.active) {\r\n        g.beginPath();\r\n        if (this.horiz) {\r\n          g.moveTo(x + w, h - 5);\r\n          g.lineTo(x + w, 5);\r\n        } else {\r\n          g.moveTo(w - 5, y + h);\r\n          g.lineTo(5, y + h);\r\n        }\r\n        g.strokeStyle = this.getDefault(\"TabStrokeStyle1\");\r\n        g.stroke();\r\n      }\r\n    }\r\n\r\n    let th = tsize;\r\n\r\n    //draw active tab\r\n    tab = this.tabs.active;\r\n    if (tab) {\r\n      let x = tab.pos[0], y = tab.pos[1];\r\n      let w = tab.size[0], h = tab.size[1];\r\n      //let tw = g.measureText(tab.name).width;\r\n      let tw = ui_base.measureText(this, tab.name, this.canvas, g, tsize, font).width;\r\n\r\n      if (this.horiz) {\r\n        h += 2;\r\n      } else {\r\n        w += 2;\r\n      }\r\n\r\n      let x2 = x + (tab.size[this.horiz ^ 1] - tw)*0.5;\r\n      let y2 = y + tsize;\r\n\r\n      if (tab === this.tabs.active) {\r\n        /*\r\n        let x = !this.horiz ? tab.y : tab.x;\r\n        let y = !this.horiz ? tab.x : tab.y;\r\n        let w = !this.horiz ? tab.size[1] : tab.size[0];\r\n        let h = !this.horiz ? tab.size[0] : tab.size[1];\r\n\r\n        if (!this.horiz) {\r\n          //g.save();\r\n          //g.translate(0, y);\r\n          //g.rotate(Math.PI/16);\r\n          //g.translate(0, -y);\r\n        }//*/\r\n\r\n        g.beginPath();\r\n        //g.lineWidth *= 5;\r\n        let ypad = 2;\r\n\r\n        g.strokeStyle = this.getDefault(\"TabStrokeStyle2\");\r\n        g.fillStyle = activecolor;\r\n        let r2 = r*1.5;\r\n\r\n        if (this.horiz) {\r\n          g.moveTo(x - r, h);\r\n          g.quadraticCurveTo(x, h, x, h - r);\r\n          g.lineTo(x, r2);\r\n          g.quadraticCurveTo(x, ypad, x + r2, ypad)\r\n          g.lineTo(x + w - r2, ypad);\r\n          g.quadraticCurveTo(x + w, 0, x + w, r2);\r\n          g.lineTo(x + w, h - r2);\r\n          g.quadraticCurveTo(x + w, h, x + w + r, h);\r\n\r\n          g.stroke()\r\n          //\r\n          g.closePath()\r\n        } else {\r\n          g.moveTo(w, y - r);\r\n          g.quadraticCurveTo(w, y, w - r, y);\r\n          ///*\r\n          g.lineTo(r2, y);\r\n          g.quadraticCurveTo(ypad, y, ypad, y + r2);\r\n          g.lineTo(ypad, y + h - r2);\r\n          g.quadraticCurveTo(0, y + h, r2, y + h);\r\n          g.lineTo(w - r2, y + h);\r\n          g.quadraticCurveTo(w, y + h, w, y + h + r);\r\n          //*/\r\n          g.stroke()\r\n          //\r\n          g.closePath()\r\n        }\r\n\r\n        let cw = this.horiz ? this.canvas.width : this.canvas.height;\r\n\r\n        let worig = g.lineWidth;\r\n\r\n        g.lineWidth *= 0.5;\r\n\r\n        g.fill();\r\n        //g.stroke();\r\n\r\n        g.lineWidth = worig;\r\n\r\n        if (!this.horiz) {\r\n          let x3 = 0, y3 = y2;\r\n\r\n          g.save();\r\n          g.translate(x3, y3);\r\n          g.rotate(Math.PI/2);\r\n          g.translate(-x3 - tsize, -y3 - tsize*0.5);\r\n        }\r\n\r\n        g.fillStyle = this.getDefault(\"TabText\").color;\r\n\r\n        //y2 += tsize*0.3;\r\n        g.fillText(tab.name, x2, y2);\r\n\r\n        if (!this.horiz) {\r\n          g.restore();\r\n        }\r\n\r\n        if (!this.horiz) {\r\n          //g.restore();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  removeTab(tab) {\r\n    this.tabs.remove(tab);\r\n    if (tab === this.tabs.active) {\r\n      this.tabs.active = this.tabs[0];\r\n    }\r\n\r\n    this._layout();\r\n    this._redraw();\r\n    this.setCSS();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS(false);\r\n\r\n    /* create a no stacking context */\r\n    this.style[\"contain\"] = \"layout\";\r\n    \r\n    let r = this.getDefault(\"TabBarRadius\");\r\n    r = r !== undefined ? r : 3;\r\n\r\n    this.style[\"touch-action\"] = \"none\";\r\n\r\n\r\n    this.canvas.style[\"background-color\"] = this.getDefault(\"TabInactive\");\r\n    this.canvas.style[\"border-radius\"] = r + \"px\";\r\n    //this.style[\"background-color\"] = this.getDefault(\"TabInactive\");\r\n  }\r\n\r\n  updateStyle() {\r\n    let key = \"\" + this.getDefault(\"background-color\");\r\n    key += this.getDefault(\"TabActive\");\r\n    key += this.getDefault(\"TabInactive\");\r\n    key += this.getDefault(\"TabBarRadius\");\r\n    key += this.getDefault(\"TabStrokeStyle1\");\r\n    key += this.getDefault(\"TabStrokeStyle2\");\r\n    key += this.getDefault(\"TabHighlight\");\r\n    key += JSON.stringify(this.getDefault(\"TabText\"));\r\n    key += this.tabFontScale;\r\n\r\n    if (key !== this._last_style_key) {\r\n      this._last_style_key = key;\r\n\r\n      this._layout();\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  update(force_update = false) {\r\n    let rect = this.getClientRects()[0];\r\n    if (rect) {\r\n      let key = Math.floor(rect.x*4.0) + \":\" + Math.floor(rect.y*4.0);\r\n      if (key !== this._last_p_key) {\r\n        this._last_p_key = key;\r\n\r\n        //console.log(\"tab bar autobuild\");\r\n        this._layout();\r\n      }\r\n    }\r\n    super.update();\r\n\r\n    this.updateStyle();\r\n    this.updatePos(force_update);\r\n    this.updateDPI(force_update);\r\n    this.updateCanvas(force_update);\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(TabBar);\r\n\r\nexport class TabContainer extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._last_style_key = \"\";\r\n\r\n    this.dataPrefix = \"\";\r\n\r\n    this.inherit_packflag = 0;\r\n    this.packflag = 0;\r\n\r\n    this.tabFontScale = 1.0;\r\n\r\n    this.tbar = UIBase.createElement(\"tabbar-x\");\r\n    this.tbar.parentWidget = this;\r\n    this.tbar.setAttribute(\"class\", \"_tbar_\" + this._id);\r\n    this.tbar.constructor.setDefault(this.tbar);\r\n    this.tbar.tabFontScale = this.tabFontScale;\r\n\r\n    this._remakeStyle();\r\n\r\n    this.tabs = {};\r\n\r\n    this._last_horiz = undefined;\r\n    this._last_bar_pos = undefined;\r\n    this._tab = undefined;\r\n\r\n    let div = document.createElement(\"div\");\r\n    div.setAttribute(\"class\", `_tab_${this._id}`);\r\n    div.appendChild(this.tbar);\r\n    this.shadow.appendChild(div);\r\n\r\n    this.tbar.parentWidget = this;\r\n\r\n    this.tbar.onselect = (e) => {\r\n      if (this.onselect) {\r\n        this.onselect(e);\r\n      }\r\n    };\r\n\r\n    this.tbar.onchange = (tab, event) => {\r\n      if (this._tab) {\r\n        HTMLElement.prototype.remove.call(this._tab);\r\n      }\r\n\r\n      this._tab = this.tabs[tab.id];\r\n      //this._tab = document.createElement(\"div\");\r\n      //this._tab.innerText = \"SDfdsfsdyay\";\r\n\r\n      this._tab.parentWidget = this;\r\n\r\n      //ensure we get full update convergence when switching\r\n      //tabs\r\n      for (let i = 0; i < 2; i++) {\r\n        this._tab.flushUpdate();\r\n      }\r\n\r\n      let div = document.createElement(\"div\");\r\n\r\n      this.tbar.setCSS.once(() => div.style[\"background-color\"] = this.getDefault(\"background-color\"), div);\r\n\r\n      div.setAttribute(\"class\", `_tab_${this._id}`);\r\n      div.appendChild(this._tab);\r\n\r\n      //XXX why is this necassary?\r\n      //this._tab.style[\"margin-left\"] = \"40px\";\r\n      this.shadow.appendChild(div);\r\n\r\n      if (this.onchange) {\r\n        this.onchange(tab, event);\r\n      }\r\n    }\r\n  }\r\n\r\n  get movableTabs() {\r\n    let attr;\r\n\r\n    if (!this.hasAttribute(\"movable-tabs\")) {\r\n      attr = this.getDefault(\"movable-tabs\");\r\n\r\n      if (attr === undefined || attr === null) {\r\n        attr = \"true\";\r\n      }\r\n\r\n      if (typeof attr === \"boolean\" || typeof attr === \"number\") {\r\n        attr = attr ? \"true\" : \"false\";\r\n      }\r\n    } else {\r\n      attr = \"\" + this.getAttribute(\"movable-tabs\");\r\n    }\r\n\r\n    attr = attr.toLowerCase();\r\n\r\n    return attr === \"true\";\r\n  }\r\n\r\n  set movableTabs(val) {\r\n    val = !!val;\r\n\r\n    this.setAttribute(\"movable-tabs\", val ? \"true\" : \"false\");\r\n    this.tbar.movableTabs = this.movableTabs;\r\n  }\r\n\r\n  get hideScrollBars() {\r\n    let attr = (\"\" + this.getAttribute(\"hide-scrollbars\")).toLowerCase();\r\n    return attr === \"true\" || attr === \"yes\";\r\n  }\r\n\r\n  set hideScrollBars(val) {\r\n    val = !!val;\r\n\r\n    this.setAttribute(\"hide-scrollbars\", \"\" + val);\r\n  }\r\n\r\n  static setDefault(e) {\r\n    e.setAttribute(\"bar_pos\", \"top\");\r\n\r\n    return e;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"tabcontainer-x\",\r\n      style  : \"tabs\"\r\n    };\r\n  }\r\n\r\n  _startMove(tab=this.tbar.tabs.active, event) {\r\n    return this.tbar._startMove(tab, event);\r\n  }\r\n\r\n  _ensureNoModal() {\r\n    return this.tbar._ensureNoModal();\r\n  }\r\n\r\n  saveData() {\r\n    let json = super.saveData() || {};\r\n    json.tabs = {};\r\n\r\n    for (let k in this.tabs) {\r\n      let tab = this.tabs[k];\r\n\r\n      if (k === this.tbar.tabs.active.id) {\r\n        //no need to save active tab here\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        json.tabs[tab.id] = JSON.parse(saveUIData(tab, \"tab\"));\r\n      } catch (error) {\r\n        console.error(\"Failed to save tab UI layout\", tab.id);\r\n      }\r\n    }\r\n\r\n    return json;\r\n  }\r\n\r\n  loadData(json) {\r\n    if (!json.tabs) {\r\n      return;\r\n    }\r\n\r\n    for (let k in json.tabs) {\r\n      if (!(k in this.tabs)) {\r\n        continue;\r\n      }\r\n\r\n      let uidata = JSON.stringify(json.tabs[k]);\r\n      loadUIData(this.tabs[k], uidata);\r\n    }\r\n  }\r\n\r\n  enableDrag() {\r\n    this.tbar.draggable = this.draggable = true;\r\n    this.tbar.addEventListener(\"dragstart\", (e) => {\r\n      this.dispatchEvent(new DragEvent(\"dragstart\", e));\r\n    });\r\n    this.tbar.addEventListener(\"dragover\", (e) => {\r\n      this.dispatchEvent(new DragEvent(\"dragover\", e));\r\n    });\r\n    this.tbar.addEventListener(\"dragexit\", (e) => {\r\n      this.dispatchEvent(new DragEvent(\"dragexit\", e));\r\n    });\r\n    /*\r\n    let doms = [this, this.tbar, this.tbar.canvas];\r\n    for (let dom of doms) {\r\n      dom.setAttribute(\"draggable\", \"true\");\r\n      dom.draggable = true;\r\n\r\n      dom.addEventListener(\"dragstart\", (e) => {\r\n        console.log(\"drag start\", e);\r\n      });\r\n\r\n      dom.addEventListener(\"drag\", (e) => {\r\n        console.log(\"drag\", e);\r\n      });\r\n    }*/\r\n  }\r\n\r\n  clear() {\r\n    this.tbar.clear();\r\n    if (this._tab !== undefined) {\r\n      HTMLElement.prototype.remove.call(this._tab);\r\n      this._tab = undefined;\r\n    }\r\n\r\n    this.tabs = {};\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.background = this.getDefault(\"background-color\");\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.background = this.getDefault(\"background-color\");\r\n    this._remakeStyle();\r\n  }\r\n\r\n  _remakeStyle() {\r\n    let horiz = this.tbar.horiz;\r\n    let display = \"flex\";\r\n    let flexDir = !horiz ? \"row\" : \"column\";\r\n    let bgcolor = this.__background; //this.getDefault(\"background-color\");\r\n\r\n    //display = \"inline\" //XXX\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n      ._tab_${this._id} {\r\n        display : ${display};\r\n        flex-direction : ${flexDir};\r\n        margin : 0px;\r\n        padding : 0px;\r\n        align-self : flex-start;\r\n        ${!horiz ? \"vertical-align : top;\" : \"\"}\r\n      }\r\n      \r\n      ._tbar_${this._id} {\r\n        list-style-type : none;\r\n        align-self : flex-start;\r\n        background-color : ${bgcolor};\r\n        flex-direction : ${flexDir};\r\n        ${!horiz ? \"vertical-align : top;\" : \"\"}\r\n      }\r\n    `;\r\n\r\n    if (this._style)\r\n      this._style.remove();\r\n    this._style = style;\r\n\r\n    this.shadow.prepend(style);\r\n  }\r\n\r\n  icontab(icon, id, tooltip) {\r\n    let t = this.tab(\"\", id, tooltip);\r\n    t._tab.icon = icon;\r\n\r\n    return t;\r\n  }\r\n\r\n  removeTab(tab) {\r\n    let tab2 = tab._tab;\r\n    this.tbar.removeTab(tab2);\r\n    tab.remove();\r\n  }\r\n\r\n  tab(name, id = undefined, tooltip = undefined, movable = true) {\r\n    if (id === undefined) {\r\n      id = tab_idgen++;\r\n    }\r\n\r\n    let col = UIBase.createElement(\"colframe-x\");\r\n\r\n    this.tabs[id] = col;\r\n\r\n    col.dataPrefix = this.dataPrefix;\r\n\r\n    col.ctx = this.ctx;\r\n    col._tab = this.tbar.addTab(name, id, tooltip, movable);\r\n\r\n    col.inherit_packflag |= this.inherit_packflag;\r\n    col.packflag |= this.packflag;\r\n\r\n    //let cls = this.tbar.horiz ? ui.ColumnFrame : ui.RowFrame;\r\n\r\n    col.parentWidget = this;\r\n\r\n    if (col.ctx) {\r\n      col._init();\r\n    }\r\n\r\n    col.setCSS();\r\n\r\n    if (this._tab === undefined) {\r\n      this.setActive(col);\r\n    }\r\n\r\n    col.noSwitch = function () {\r\n      this._tab.noSwitch = true;\r\n      return this;\r\n    }\r\n\r\n    function defineTabEvent(key) {\r\n      key = \"on\" + key;\r\n\r\n      Object.defineProperty(col, key, {\r\n        get() {\r\n          return this._tab[key];\r\n        },\r\n        set(v) {\r\n          this._tab[key] = v;\r\n        }\r\n      });\r\n    }\r\n\r\n    defineTabEvent(\"tabclick\");\r\n    defineTabEvent(\"tabdragmove\");\r\n    defineTabEvent(\"tabdragstart\");\r\n    defineTabEvent(\"tabdragend\");\r\n\r\n    return col;\r\n  }\r\n\r\n  setActive(tab) {\r\n    if (typeof tab === \"string\") {\r\n      tab = this.getTab(tab);\r\n    }\r\n\r\n    if (!tab) {\r\n      return;\r\n    }\r\n\r\n    if (tab._tab !== this.tbar.tabs.active) {\r\n      this.tbar.setActive(tab._tab);\r\n    }\r\n  }\r\n\r\n  getTabCount() {\r\n    return this.tbar.tabs.length;\r\n  }\r\n\r\n  moveTab(tab, i) {\r\n    tab = tab._tab;\r\n\r\n    let tab2 = this.tbar.tabs[i];\r\n\r\n    if (tab !== tab2) {\r\n      this.tbar.swapTabs(tab, tab2);\r\n    }\r\n\r\n    this.tbar.setCSS();\r\n    this.tbar._layout();\r\n    this.tbar._redraw();\r\n  }\r\n\r\n  getTab(name_or_id) {\r\n    if (name_or_id in this.tabs) {\r\n      return this.tabs[name_or_id];\r\n    }\r\n\r\n    for (let k in this.tabs) {\r\n      let t = this.tabs[k];\r\n\r\n      if (t.name === name_or_id) {\r\n        return t;\r\n      }\r\n    }\r\n\r\n    throw new Error(\"Unknown tab \" + name_or_id);\r\n  }\r\n\r\n  updateBarPos() {\r\n    let barpos = this.getAttribute(\"bar_pos\");\r\n\r\n    if (barpos !== this._last_bar_pos) {\r\n      this.horiz = barpos === \"top\" || barpos === \"bottom\";\r\n      this._last_bar_pos = barpos;\r\n\r\n      this.tbar.setAttribute(\"bar_pos\", barpos);\r\n      this.tbar.update(true);\r\n      this.update();\r\n    }\r\n  }\r\n\r\n  updateHoriz() {\r\n    let horiz = this.tbar.horiz;\r\n\r\n    if (this._last_horiz !== horiz) {\r\n      this._last_horiz = horiz;\r\n      this._remakeStyle();\r\n    }\r\n  }\r\n\r\n  updateStyle() {\r\n    let key = \"\" + this.getDefault(\"background-color\");\r\n\r\n    if (key !== this._last_style_key) {\r\n      this._last_style_key = key;\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  getActive() {\r\n    return this.tbar.tabs.active;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.tbar.movableTabs = this.movableTabs;\r\n\r\n    if (this._tab !== undefined) {\r\n      this._tab.update();\r\n    }\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-direction\"] = !this.horiz ? \"row\" : \"column\";\r\n\r\n    this.tbar.tabFontScale = this.tabFontScale;\r\n\r\n    this.updateStyle();\r\n    this.updateHoriz();\r\n    this.updateBarPos();\r\n    this.tbar.update();\r\n\r\n    let act = this.tbar.tabs.active;\r\n\r\n    if (act && !this.hideScrollBars) {\r\n      let container = this.tabs[act.id];\r\n\r\n      //propegate overflow-y to tab container as a whole\r\n\r\n      if (container.hasAttribute(\"overflow-y\") && this.style[\"overflow-y\"] !== container.getAttribute(\"overflow-y\")) {\r\n        this.style[\"overflow-y\"] = container.getAttribute(\"overflow-y\");\r\n        //container.style[\"overflow-y\"] = \"unset\";\r\n      } else if (!container.hasAttribute(\"overflow-y\")) {\r\n        this.style[\"overflow-y\"] = this.getDefault(\"overflow-y\") || \"unset\";\r\n      }\r\n\r\n      if (container.hasAttribute(\"overflow\") && this.style[\"overflow\"] !== container.getAttribute(\"overflow\")) {\r\n        this.style[\"overflow\"] = container.getAttribute(\"overflow\");\r\n        //container.style[\"overflow-y\"] = \"unset\";\r\n      } else if (!container.hasAttribute(\"overflow\")) {\r\n        this.style[\"overflow\"] = this.getDefault(\"overflow\") || \"unset\";\r\n      }\r\n    } else if (this.hideScrollBars) {\r\n      this.style[\"overflow\"] = this.style[\"overflow-y\"] = \"unset\";\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(TabContainer);\r\n","//bind module to global var to get at it in console.\r\n//\r\n//note that require has an api for handling circular\r\n//module refs, in such cases do not use these vars.\r\n\r\nimport {Container} from \"../core/ui.js\";\r\n\r\nvar _ui = undefined;\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_curvewidget from './ui_curvewidget.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as ui_widgets from './ui_widgets.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\n\r\nlet PropFlags = toolprop.PropFlags;\r\nlet PropSubTypes = toolprop.PropSubTypes;\r\n\r\nlet EnumProperty = toolprop.EnumProperty;\r\n\r\nlet Vector2 = vectormath.Vector2,\r\n  UIBase = ui_base.UIBase,\r\n  PackFlags = ui_base.PackFlags,\r\n  PropTypes = toolprop.PropTypes;\r\n\r\n\r\nconst list = util.list;\r\n\r\nexport class TableRow extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.dom.remove();\r\n    this.dom = document.createElement(\"tr\");\r\n\r\n    //kind of dumb, but this.dom doesn't live within this element itself, bleh\r\n    //this.shadow.appendChild(this.dom);\r\n    this.dom.setAttribute(\"class\", \"containerx\");\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"tablerow-x\"\r\n  };}\r\n\r\n  _add(child) {\r\n    child.ctx = this.ctx;\r\n    child.parentWidget = this;\r\n\r\n    let td = document.createElement(\"td\");\r\n    td.appendChild(child);\r\n\r\n    this.dom.appendChild(td);\r\n    child.onadd();\r\n  }\r\n};\r\nUIBase.internalRegister(TableRow);\r\n\r\nexport class TableFrame extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.dom = document.createElement(\"table\");\r\n    this.shadow.appendChild(this.dom);\r\n    this.dom.setAttribute(\"class\", \"containerx\");\r\n\r\n    //this.dom.style[\"display\"] = \"block\";\r\n  }\r\n\r\n  update() {\r\n    this.style[\"display\"] = \"inline-block\";\r\n    super.update();\r\n  }\r\n\r\n  _add(child) {\r\n    child.ctx = this.ctx;\r\n    child.parentWidget = this;\r\n    this.dom.appendChild(child);\r\n    child.onadd();\r\n  }\r\n\r\n  add(child) {\r\n    this._add(child);\r\n  }\r\n\r\n  row() {\r\n    let tr = document.createElement(\"tr\");\r\n    let cls = \"table-tr\";\r\n\r\n    tr.setAttribute(\"class\", cls);\r\n    this.dom.appendChild(tr);\r\n    let this2 = this;\r\n\r\n    function maketd() {\r\n      let td = document.createElement(\"td\");\r\n      tr.appendChild(td);\r\n\r\n      td.style[\"margin\"] = tr.style[\"margin\"];\r\n      td.style[\"padding\"] = tr.style[\"padding\"];\r\n\r\n      let container = UIBase.createElement(\"rowframe-x\");\r\n\r\n      container.ctx = this2.ctx;\r\n      container.parentWidget = this2;\r\n      container.setAttribute(\"class\", cls);\r\n\r\n      td.setAttribute(\"class\", cls);\r\n      td.appendChild(container);\r\n\r\n      return container;\r\n    }\r\n\r\n    //hrm wish I could subclass html elements easier\r\n    let ret = {\r\n      _tr : tr,\r\n\r\n      style : tr.style,\r\n\r\n      focus : function(args) {\r\n        tr.focus(args);\r\n      },\r\n\r\n      blur : function(args) {\r\n        tr.blur(args);\r\n      },\r\n\r\n      remove : () => {\r\n        tr.remove();\r\n      },\r\n\r\n      addEventListener : function(type, cb, arg) {\r\n        tr.addEventListener(type, cb, arg);\r\n      },\r\n\r\n      removeEventListener : function(type, cb, arg) {\r\n        tr.removeEventListener(type, cb, arg);\r\n      },\r\n\r\n      setAttribute : function(attr, val) {\r\n        if (attr == \"class\") {\r\n          cls = val;\r\n        }\r\n\r\n        tr.setAttribute(attr, val);\r\n      },\r\n\r\n      scrollTo : function() {\r\n        return this._tr.scrollTo(...arguments);\r\n      },\r\n\r\n      scrollIntoView : function() {\r\n        return this._tr.scrollIntoView(...arguments);\r\n      },\r\n\r\n      clear : function() {\r\n        for (let node of list(tr.childNodes)) {\r\n          tr.removeChild(node);\r\n        }\r\n      }\r\n    };\r\n\r\n    function makefunc(f) {\r\n      ret[f] = function() {\r\n        let container = maketd();\r\n\r\n        container.background = tr.style[\"background-color\"]; //\"rgba(0,0,0,0)\";\r\n        return container[f].apply(container, arguments);\r\n      }\r\n    }\r\n\r\n    let _bg = \"\";\r\n\r\n    //need to implement proper proxy here!\r\n    Object.defineProperty(ret, \"tabIndex\", {\r\n      set : function(f) {\r\n        tr.tabIndex = f;\r\n      },\r\n\r\n      get : function(f) {\r\n        return tr.tabIndex;\r\n      }\r\n    });\r\n\r\n    Object.defineProperty(ret, \"background\", {\r\n      set : function(bg) {\r\n        _bg = bg;\r\n        tr.style[\"background-color\"] = bg;\r\n\r\n        for (let node of tr.childNodes) {\r\n          if (node.childNodes.length > 0) {\r\n            node.childNodes[0].background = bg;\r\n            node.style[\"background-color\"] = bg;\r\n          }\r\n        }\r\n      }, get : function() {\r\n        return _bg;\r\n      }\r\n    });\r\n\r\n    /*\r\n    Object.defineProperty(ret, \"class\", {\r\n      set(bg) {\r\n        tr.class = bg;\r\n      }\r\n    });//*/\r\n\r\n    ret.cell = () => {\r\n      let container = maketd();\r\n      container.background = tr.style[\"background-color\"];\r\n      return container;\r\n    };\r\n    \r\n    //makefunc(\"cell\");\r\n    makefunc(\"label\");\r\n    makefunc(\"tool\");\r\n    makefunc(\"prop\");\r\n    makefunc(\"pathlabel\");\r\n    makefunc(\"button\");\r\n    makefunc(\"iconbutton\");\r\n    makefunc(\"textbox\");\r\n    makefunc(\"col\");\r\n    makefunc(\"row\");\r\n    makefunc(\"table\");\r\n    makefunc(\"listenum\");\r\n    makefunc(\"check\");\r\n\r\n    return ret;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  clear() {\r\n    super.clear();\r\n    for (let child of list(this.dom.childNodes)) {\r\n      child.remove();\r\n    }\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"tableframe-x\"\r\n  };}\r\n}\r\nUIBase.internalRegister(TableFrame);\r\n\r\n","\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as simple_toolsys from '../path-controller/toolsys/toolsys.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\n\r\nimport {TableFrame} from './ui_table.js';\r\nimport {Container, ColumnFrame, RowFrame} from '../core/ui.js';\r\nimport {keymap} from '../path-controller/util/events.js';\r\n\r\nlet EnumProperty = toolprop.EnumProperty,\r\n    PropTypes    = toolprop.PropTypes;\r\n\r\nlet UIBase     = ui_base.UIBase,\r\n    PackFlags  = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nfunction getpx(css) {\r\n  return parseFloat(css.trim().replace(\"px\", \"\"))\r\n}\r\n\r\nclass ListItem extends RowFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    let highlight = () => {\r\n      //console.log(\"listitem mouseover\");\r\n      this.highlight = true;\r\n      this.setBackground();\r\n    };\r\n\r\n    let unhighlight = () => {\r\n      //console.log(\"listitem mouseleave\");\r\n      this.highlight = false;\r\n      this.setBackground();\r\n    };\r\n\r\n    this.addEventListener(\"mouseover\", highlight);\r\n    this.addEventListener(\"mousein\", highlight);\r\n\r\n    this.addEventListener(\"mouseleave\", unhighlight);\r\n    this.addEventListener(\"mouseout\", unhighlight);\r\n    this.addEventListener(\"blur\", unhighlight);\r\n\r\n    this.addEventListener(\"click\", (e) => {\r\n      //console.log(\"click!\");\r\n      if (this.onclick) {\r\n        this.onclick();\r\n      }\r\n    });\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n      .listitem {\r\n        -moz-user-focus: normal;\r\n        moz-user-focus: normal;\r\n        user-focus: normal;\r\n      }\r\n    `;\r\n\r\n    this.shadowRoot.prepend(style);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"listitem-x\",\r\n      style  : \"listbox\"\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.setAttribute(\"class\", \"listitem\");\r\n\r\n    this.style[\"width\"] = \"100%\";\r\n    this.style[\"height\"] = this.getDefault(\"ItemHeight\") + \"px\";\r\n    this.style[\"flex-grow\"] = \"unset\";\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  setBackground() {\r\n    if (this.highlight && this.is_active) {\r\n      this.background = this.getDefault(\"ListActiveHighlight\");\r\n    } else if (this.highlight) {\r\n      this.background = this.getDefault(\"ListHighlight\");\r\n    } else if (this.is_active) {\r\n      this.background = this.getDefault(\"ListActive\");\r\n    } else {\r\n      this.background = this.getDefault(\"background-color\");\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ListItem);\r\n\r\nclass ListBox extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.items = [];\r\n    this.idmap = {};\r\n    this.items.active = undefined;\r\n    this.highlight = false;\r\n    this.is_active = false;\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n      .listbox {\r\n        -moz-user-focus: normal;\r\n        moz-user-focus: normal;\r\n        user-focus: normal;\r\n      }\r\n    `;\r\n    this.shadow.prepend(style);\r\n\r\n    this.onkeydown = (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Up\"]:\r\n        case keymap[\"Down\"]:\r\n          if (this.items.length == 0)\r\n            return;\r\n\r\n          if (this.items.active === undefined) {\r\n            this.setActive(this.items[0]);\r\n            return;\r\n          }\r\n\r\n          let i = this.items.indexOf(this.items.active);\r\n          let dir = e.keyCode == keymap[\"Up\"] ? -1 : 1;\r\n\r\n          i = Math.max(Math.min(i + dir, this.items.length - 1), 0);\r\n          this.setActive(this.items[i]);\r\n\r\n          break;\r\n      }\r\n    };\r\n\r\n    //this.addEventListener(\"keydown\", on_keydown);\r\n\r\n    //this._table =  this.table();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"listbox-x\",\r\n      style  : \"listbox\"\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.setCSS();\r\n\r\n    this.style[\"width\"] = this.getDefault(\"width\") + \"px\";\r\n    this.style[\"height\"] = this.getDefault(\"height\") + \"px\";\r\n    this.style[\"overflow\"] = \"scroll\";\r\n\r\n    //this.setAttribute(\"class\", \"listbox\");\r\n    //this.setAttribute(\"tabindex\", 0);\r\n    //this.tabIndex = 0;\r\n  }\r\n\r\n  addItem(name, id) {\r\n    let item = UIBase.createElement(\"listitem-x\");\r\n\r\n    item._id = id === undefined ? this.items.length : id;\r\n    this.idmap[item._id] = item;\r\n\r\n    //item.addEventListener(\"keydown\", this.onkeydown);\r\n    this.tabIndex = 1;\r\n    this.setAttribute(\"tabindex\", 1);\r\n\r\n    this.add(item);\r\n    this.items.push(item);\r\n\r\n    item.label(name);\r\n    let this2 = this;\r\n\r\n    item.onclick = function () {\r\n      this2.setActive(this);\r\n      this.setBackground();\r\n    };\r\n\r\n    return item;\r\n  }\r\n\r\n  removeItem(item) {\r\n    if (typeof item == \"number\") {\r\n      item = this.idmap[item];\r\n    }\r\n\r\n    item.remove();\r\n    delete this.idmap[item._id];\r\n    this.items.remove(item);\r\n  }\r\n\r\n  setActive(item) {\r\n    if (typeof item == \"number\") {\r\n      item = this.idmap[item];\r\n    }\r\n\r\n    //console.log(\"set active!\");\r\n\r\n    if (item === this.items.active) {\r\n      return;\r\n    }\r\n\r\n    if (this.items.active !== undefined) {\r\n      this.items.active.highlight = false;\r\n      this.items.active.is_active = false;\r\n      this.items.active.setBackground();\r\n    }\r\n\r\n    this.items.active = item;\r\n\r\n    if (item) {\r\n      item.is_active = true;\r\n\r\n      item.setBackground();\r\n      item.scrollIntoViewIfNeeded();\r\n    }\r\n\r\n    if (this.onchange) {\r\n      this.onchange(item ? item._id : undefined, item);\r\n    }\r\n  }\r\n\r\n  clear() {\r\n\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ListBox);\r\n","import {UIBase} from '../core/ui_base.js';\r\nimport * as util from '../path-controller/util/util.js';\r\nimport {keymap} from '../path-controller/util/simple_events.js';\r\n\r\nexport class ProgressCircle extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.g = this.canvas.getContext(\"2d\");\r\n\r\n    this.shadow.appendChild(this.canvas);\r\n    this.size = 150;\r\n    this.animreq = undefined;\r\n    this._value = 0.0;\r\n    this.startTime = util.time_ms();\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this.flagRedraw();\r\n    this.update();\r\n\r\n    //enable keyboard focus\r\n    this.tabIndex = 0;\r\n    this.setAttribute(\"tab-index\", 0);\r\n    this.setAttribute(\"tabindex\", 0);\r\n\r\n    let onkey = (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Escape\"]:\r\n          if (this.oncancel) {\r\n            this.oncancel(this);\r\n          }\r\n          break;\r\n      }\r\n    }\r\n\r\n    this.addEventListener(\"keydown\", onkey);\r\n    this.canvas.addEventListener(\"keydown\", onkey);\r\n  }\r\n\r\n  flagRedraw() {\r\n    if (this.animreq !== undefined) {\r\n      return;\r\n    }\r\n\r\n    this.animreq = requestAnimationFrame(() => {\r\n      this.animreq = undefined;\r\n      this.draw();\r\n    })\r\n  }\r\n\r\n  draw() {\r\n    let c = this.canvas, g = this.g;\r\n\r\n    let clr1 = \"rgb(68,69,83)\";\r\n    let clr2 = \"rgb(141,154,196)\";\r\n    let clr3 = \"rgb(214,110,54)\";\r\n\r\n    let t = (util.time_ms() - this.startTime) / 1000.0;\r\n\r\n    g.save();\r\n    g.clearRect(0, 0, c.width, c.height);\r\n\r\n    g.lineWidth /= c.width*0.5;\r\n    g.scale(c.width, c.height);\r\n    g.translate(0.5, 0.5);\r\n\r\n    g.fillStyle = clr2;\r\n    g.strokeStyle = clr1;\r\n\r\n    g.beginPath();\r\n    g.moveTo(0, 0);\r\n    g.arc(0, 0, 0.45, Math.PI, -Math.PI);\r\n    //g.closePath()\r\n\r\n    g.moveTo(0, 0);\r\n    g.arc(0, 0, 0.2, Math.PI, -Math.PI);\r\n    //g.closePath()\r\n\r\n    g.clip(\"evenodd\");\r\n\r\n    g.beginPath();\r\n    g.arc(0, 0, 0.45, -Math.PI, Math.PI);\r\n    g.fill();\r\n    g.stroke();\r\n\r\n    g.beginPath();\r\n    g.arc(0, 0, 0.2, Math.PI, -Math.PI);\r\n    g.stroke();\r\n\r\n    g.beginPath();\r\n\r\n    let th = this._value*Math.PI*2.0;\r\n\r\n    let steps = 12;\r\n    let dth = (Math.PI*2.0) / steps;\r\n    let lwid = g.lineWidth;\r\n    g.lineWidth *= 3;\r\n\r\n    for (let i=0; i<steps; i++) {\r\n      let th1 = i * dth;\r\n      th1 += t;\r\n\r\n      let r1 = 0.2;\r\n      let r2 = 0.45;\r\n      let th2 = th1 + dth*0.5;\r\n\r\n      g.beginPath();\r\n      g.moveTo(Math.cos(th1)*r1, Math.sin(th1)*r1);\r\n      g.lineTo(Math.cos(th2)*r2, Math.sin(th2)*r2);\r\n      g.strokeStyle = \"rgba(255,255,255,0.5)\";\r\n      g.stroke();\r\n    }\r\n\r\n    g.lineWidth = lwid;\r\n\r\n    g.beginPath();\r\n    g.moveTo(0, 0);\r\n    g.arc(0, 0, 0.4, Math.PI, -Math.PI);\r\n    //g.closePath()\r\n\r\n    g.clip(\"evenodd\");\r\n\r\n    g.beginPath();\r\n    g.fillStyle = clr3;\r\n    g.moveTo(0, 0);\r\n    g.arc(0, 0, 0.45, 0, th);\r\n    g.lineTo(0, 0);\r\n    g.fill();\r\n\r\n    g.strokeStyle = \"rgb(141,154,196)\";\r\n    g.stroke();\r\n\r\n    g.restore();\r\n  }\r\n\r\n  set value(percent) {\r\n    this._value = percent;\r\n    this.flagRedraw();\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  startTimer() {\r\n    if (this.timer !== undefined) {\r\n      return;\r\n    }\r\n\r\n    this.focus();\r\n\r\n    window.setInterval(() => {\r\n      if (!this.isConnected) {\r\n        this.endTimer();\r\n        return;\r\n      }\r\n\r\n      this.flagRedraw();\r\n    }, 50);\r\n  }\r\n\r\n  endTimer() {\r\n    if (this.timer !== undefined) {\r\n      window.clearInterval(this.timer);\r\n    }\r\n    this.timer = undefined;\r\n  }\r\n\r\n  update() {\r\n    if (!this.isConnected && this.timer) {\r\n      this.endTimer();\r\n    }\r\n\r\n    let size = ~~(this.size*UIBase.getDPI());\r\n\r\n    if (size !== this.canvas.width) {\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    let c = this.canvas;\r\n\r\n    let size = ~~(this.size*UIBase.getDPI());\r\n\r\n    if (c.width !== size) {\r\n      c.width = c.height = size;\r\n\r\n      size /= UIBase.getDPI();\r\n      c.style[\"width\"] = size + \"px\";\r\n      c.style[\"height\"] = size + \"px\";\r\n\r\n      c.style[\"display\"] = \"flex\";\r\n\r\n      this.style[\"width\"] = size + \"px\";\r\n      this.style[\"height\"] = size + \"px\";\r\n\r\n      //forcibly redraw in this case, do not queue with flagRedraw\r\n      this.draw();\r\n    }\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"align-items\"] = \"center\";\r\n    this.style[\"justify-content\"] = \"center\";\r\n    this.style[\"width\"] = \"100%\";\r\n    this.style[\"height\"] = \"100%\";\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname : \"progress-circle-x\"\r\n    }\r\n  }\r\n}\r\nUIBase.register(ProgressCircle);\r\n","import {PackFlags, UIBase} from \"../core/ui_base.js\";\r\nimport {ColumnFrame} from \"../core/ui.js\";\r\nimport {PropTypes, PropFlags} from \"../path-controller/toolsys/toolprop.js\";\r\n\r\nimport {UndoFlags, ToolFlags} from \"../path-controller/toolsys/toolsys.js\";\r\nimport {DataPath, DataTypes} from \"../path-controller/controller/controller.js\";\r\n\r\nimport {ToolProperty} from '../path-controller/toolsys/toolprop.js';\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport cconst from '../config/const.js';\r\n\r\nconst LastKey = Symbol(\"LastToolPanelId\");\r\nlet tool_idgen = 0;\r\n\r\nexport function getLastToolStruct(ctx) {\r\n  let ret = ctx.state._last_tool;\r\n\r\n  if (!ret) {\r\n    ret = ctx.toolstack.head;\r\n  } else {\r\n    let msg = \"Passing the last tool to last-tool-panel via appstate._last_tool is deprecated;\";\r\n    msg += \"\\nctx.toolstack.head is now used instead.\";\r\n\r\n    console.warn(msg);\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n/*\r\n*\r\n* This panel shows the most recently executed ToolOp's\r\n* settings.  It assumes that recent toolops are accessible\r\n* in ctx.last_tool.\r\n* */\r\nexport class LastToolPanel extends ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this._tool_id = undefined;\r\n    this.useDataPathUndo = false;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.useDataPathUndo = false;\r\n    this.rebuild();\r\n  }\r\n\r\n  /** client code can subclass and override this method */\r\n  getToolStackHead(ctx) {\r\n    //don't process the root toolop\r\n    let bad = ctx.toolstack.length === 0 || ctx.toolstack.cur >= ctx.toolstack.length;\r\n    bad = bad || ctx.toolstack.cur < 0;\r\n    bad = bad || ctx.toolstack[ctx.toolstack.cur].undoflag & UndoFlags.IS_UNDO_ROOT;\r\n\r\n    if (bad) {\r\n      return undefined;\r\n    }\r\n\r\n    return ctx.toolstack[ctx.toolstack.cur];\r\n  }\r\n\r\n  rebuild() {\r\n    let ctx = this.ctx;\r\n    if (ctx === undefined) {\r\n      this._tool_id = -1; //wait for .ctx\r\n      return;\r\n    }\r\n\r\n    this.clear();\r\n\r\n    this.label(\"Recent Command Settings\");\r\n\r\n    let tool = this.getToolStackHead(ctx);\r\n\r\n    if (!tool) {\r\n      this.setCSS();\r\n      return;\r\n    }\r\n\r\n    let def = tool.constructor.tooldef();\r\n    let name = def.uiname !== undefined ? def.uiname : def.name;\r\n\r\n    let panel = this.panel(def.uiname);\r\n\r\n    this.buildTool(ctx, tool, panel);\r\n    this.flushUpdate();\r\n  }\r\n\r\n  /** client code can subclass and override this method */\r\n  buildTool(ctx, tool, panel) {\r\n    let fakecls = {};\r\n    fakecls.constructor = fakecls;\r\n\r\n    //in theory it shouldn't matter if multiple last tool panels\r\n    //override _last_tool, since they all access the same data\r\n    this.ctx.state._last_tool = fakecls;\r\n    let lastkey = tool[LastKey];\r\n\r\n    let getTool = () => {\r\n      let tool = this.ctx.toolstack[this.ctx.toolstack.cur];\r\n      if (!tool || tool[LastKey] !== lastkey) {\r\n        return undefined;\r\n      }\r\n\r\n      return tool;\r\n    };\r\n\r\n    if (tool.flag & ToolFlags.PRIVATE) {\r\n      return;\r\n    }\r\n\r\n    let st = this.ctx.api.mapStruct(fakecls, true);\r\n    let paths = [];\r\n\r\n    function defineProp(k, key) {\r\n      Object.defineProperty(fakecls, key, {\r\n        get : function() {\r\n          let tool = getTool();\r\n          if (tool) {\r\n            if (!tool.inputs[k]) {\r\n              console.error(\"Missing property \" + k, tool);\r\n            }\r\n            return tool.inputs[k].getValue();\r\n          }\r\n        },\r\n\r\n        set : function(val) {\r\n          let tool = getTool();\r\n          if (tool) {\r\n            tool.inputs[k].setValue(val);\r\n            tool.saveDefaultInputs();\r\n\r\n            ctx.toolstack.rerun(tool);\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    for (let k in tool.inputs) {\r\n      let prop = tool.inputs[k];\r\n\r\n      if (prop.flag & (PropFlags.PRIVATE|PropFlags.READ_ONLY)) {\r\n        continue;\r\n      }\r\n\r\n      let uiname = prop.uiname;\r\n      if (!uiname) {\r\n        uiname = ToolProperty.makeUIName(k);\r\n      }\r\n\r\n      prop.uiname = uiname;\r\n      let apikey = k.replace(/[\\t ]/g, \"_\");\r\n\r\n      let dpath = new DataPath(apikey, apikey, prop, DataTypes.PROP);\r\n      st.add(dpath);\r\n\r\n      paths.push(dpath);\r\n\r\n      defineProp(k, apikey);\r\n    }\r\n\r\n    panel.useDataPathUndo = false;\r\n\r\n    for (let dpath of paths) {\r\n      let path = \"last_tool.\" + dpath.path;\r\n\r\n      panel.label(dpath.data.uiname);\r\n      let ret = panel.prop(path, PackFlags.FORCE_ROLLER_SLIDER);\r\n\r\n      if (ret) {\r\n        ret.useDataPathUndo = false;\r\n      }\r\n    }\r\n    this.setCSS();\r\n\r\n    //console.log(\"Building last tool settings\");\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n    let ctx = this.ctx;\r\n\r\n    if (!ctx) {\r\n      return;\r\n    }\r\n\r\n    let tool = this.getToolStackHead(ctx);\r\n\r\n    if (tool && (!(LastKey in tool) || tool[LastKey] !== this._tool_id)) {\r\n      tool[LastKey] = tool_idgen++;\r\n      this._tool_id = tool[LastKey];\r\n\r\n      this.rebuild();\r\n    }\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"last-tool-panel-x\"\r\n  }}\r\n}\r\nUIBase.internalRegister(LastToolPanel);\r\n","import {Vector2} from \"./vectormath.js\";\r\nimport * as math from './math.js';\r\nimport * as util from './util.js';\r\n\r\nexport class Constraint {\r\n  constructor(name, func, klst, params, k=1.0) {\r\n    this.glst = [];\r\n    this.klst = klst;\r\n    this.k = k;\r\n    this.params = params;\r\n    this.name = name;\r\n\r\n    for (let ks of klst) {\r\n      this.glst.push(new Float64Array(ks.length));\r\n    }\r\n\r\n    this.df = 0.0005;\r\n    this.threshold = 0.0001;\r\n    this.func = func;\r\n\r\n    this.funcDv = null;\r\n  }\r\n\r\n  evaluate(no_dvs=false) {\r\n    let r1 = this.func(this.params);\r\n\r\n    if (this.funcDv) {\r\n      this.funcDv(this.params, this.glst);\r\n      return r1;\r\n    }\r\n\r\n    if (Math.abs(r1) < this.threshold)\r\n      return 0.0;\r\n\r\n    let df = this.df;\r\n\r\n    if (no_dvs)\r\n      return r1;\r\n\r\n    for (let i=0; i<this.klst.length; i++) {\r\n      let gs = this.glst[i];\r\n      let ks = this.klst[i];\r\n\r\n      for (let j=0; j<ks.length; j++) {\r\n        let orig = ks[j];\r\n        ks[j] += df;\r\n        let r2 = this.func(this.params);\r\n        ks[j] = orig;\r\n\r\n        gs[j] = (r2 - r1) / df;\r\n      }\r\n    }\r\n\r\n    return r1;\r\n  }\r\n}\r\n\r\nexport class Solver {\r\n  constructor() {\r\n    this.constraints = [];\r\n    this.gk = 0.99;\r\n    this.simple = false;\r\n    this.randCons = false;\r\n  }\r\n\r\n  add(con) {\r\n    this.constraints.push(con);\r\n  }\r\n\r\n  solveStep(gk=this.gk) {\r\n    let err = 0.0;\r\n\r\n    let cons = this.constraints;\r\n    for (let ci=0; ci<cons.length; ci++ ){\r\n      let ri = ci;\r\n      if (this.randCons) {\r\n        ri = ~~(Math.random()*this.constraints.length*0.99999);\r\n      }\r\n\r\n      let con = cons[ri];\r\n\r\n      let r1 = con.evaluate();\r\n\r\n      if (r1 === 0.0)\r\n        continue;\r\n\r\n      err += Math.abs(r1);\r\n      let totgs = 0.0;\r\n\r\n      for (let i=0; i<con.klst.length; i++) {\r\n        let ks = con.klst[i], gs = con.glst[i];\r\n        for (let j=0; j<ks.length; j++) {\r\n          totgs += gs[j]*gs[j];\r\n        }\r\n      }\r\n\r\n      if (totgs === 0.0)  {\r\n        continue;\r\n      }\r\n\r\n      r1 /= totgs;\r\n\r\n      for (let i=0; i<con.klst.length; i++) {\r\n        let ks = con.klst[i], gs = con.glst[i];\r\n        for (let j=0; j<ks.length; j++) {\r\n          ks[j] += -r1*gs[j]*con.k*gk;\r\n        }\r\n      }\r\n    }\r\n\r\n    return err;\r\n  }\r\n\r\n  solveStepSimple(gk=this.gk) {\r\n    let err = 0.0;\r\n\r\n    let cons = this.constraints;\r\n    for (let ci=0; ci<cons.length; ci++ ){\r\n      let ri = ci;\r\n      if (this.randCons) {\r\n        ri = ~~(Math.random()*this.constraints.length*0.99999);\r\n      }\r\n\r\n      let con = cons[ri];\r\n\r\n      let r1 = con.evaluate();\r\n\r\n      if (r1 === 0.0)\r\n        continue;\r\n\r\n      err += Math.abs(r1);\r\n      let totgs = 0.0;\r\n\r\n      for (let i=0; i<con.klst.length; i++) {\r\n        let ks = con.klst[i], gs = con.glst[i];\r\n        for (let j=0; j<ks.length; j++) {\r\n          totgs += gs[j]*gs[j];\r\n        }\r\n      }\r\n\r\n      if (totgs === 0.0)  {\r\n        continue;\r\n      }\r\n\r\n      totgs = 0.0001 / Math.sqrt(totgs);\r\n\r\n      for (let i=0; i<con.klst.length; i++) {\r\n        let ks = con.klst[i], gs = con.glst[i];\r\n        for (let j=0; j<ks.length; j++) {\r\n          ks[j] += -totgs*gs[j]*con.k*gk;\r\n        }\r\n      }\r\n    }\r\n\r\n    return err;\r\n  }\r\n\r\n  solve(steps, gk=this.gk, printError=false) {\r\n    let err = 0.0;\r\n\r\n    for (let i=0; i<steps; i++) {\r\n      if (this.simple) {\r\n        err = this.solveStepSimple(gk);\r\n      } else {\r\n        err = this.solveStep(gk);\r\n      }\r\n\r\n\r\n      if (printError) {\r\n        console.warn(\"average error:\", (err/this.constraints.length).toFixed(4));\r\n      }\r\n      if (err < 0.01 / this.constraints.length) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return err;\r\n  }\r\n}\r\n","\"use strict\";\r\n\r\nimport {Vector2} from \"./vectormath.js\";\r\nimport * as math from './math.js';\r\nimport * as util from './util.js';\r\n\r\nimport {Constraint, Solver} from './solver.js';\r\n\r\nlet idgen = 0;\r\n\r\nexport class PackNodeVertex extends Vector2 {\r\n  constructor(node, co) {\r\n    super(co);\r\n\r\n    this.node = node;\r\n    this._id = idgen++;\r\n    this.edges = [];\r\n    this._absPos = new Vector2();\r\n  }\r\n\r\n  get absPos() {\r\n    this._absPos.load(this).add(this.node.pos);\r\n    return this._absPos;\r\n  }\r\n\r\n  [Symbol.keystr]() {\r\n    return this._id;\r\n  }\r\n}\r\n\r\nexport class PackNode {\r\n  constructor() {\r\n    this.pos = new Vector2();\r\n    this.vel = new Vector2();\r\n    this.oldpos = new Vector2();\r\n    this._id = idgen++;\r\n    this.size = new Vector2();\r\n    this.verts = [];\r\n  }\r\n\r\n  [Symbol.keystr]() {\r\n    return this._id;\r\n  }\r\n}\r\n\r\nfunction copyGraph(nodes) {\r\n  let ret = [];\r\n  let idmap = {};\r\n\r\n  for (let n of nodes) {\r\n    let n2 = new PackNode();\r\n    n2._id = n._id;\r\n    n2.pos.load(n.pos);\r\n    n2.vel.load(n.vel);\r\n    n2.size.load(n.size);\r\n\r\n    n2.verts = [];\r\n    idmap[n2._id] = n2;\r\n\r\n    for (let v of n.verts) {\r\n      let v2 = new PackNodeVertex(n2, v);\r\n      v2._id = v._id;\r\n      idmap[v2._id] = v2;\r\n\r\n      n2.verts.push(v2);\r\n    }\r\n\r\n    ret.push(n2);\r\n  }\r\n\r\n  for (let n of nodes) {\r\n    for (let v of n.verts) {\r\n      let v2 = idmap[v._id];\r\n\r\n      for (let v3 of v.edges) {\r\n        v2.edges.push(idmap[v3._id]);\r\n      }\r\n    }\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nfunction getCenter(nodes) {\r\n  let cent = new Vector2();\r\n\r\n  for (let n of nodes) {\r\n    cent.add(n.pos);\r\n  }\r\n\r\n  if (nodes.length === 0)\r\n    return cent;\r\n\r\n  cent.mulScalar(1.0 / nodes.length);\r\n\r\n  return cent;\r\n}\r\n\r\nfunction loadGraph(nodes, copy) {\r\n  let idmap = {};\r\n\r\n  for (let i=0; i<nodes.length; i++) {\r\n    nodes[i].pos.load(copy[i].pos);\r\n    nodes[i].oldpos.load(copy[i].oldpos);\r\n    nodes[i].vel.load(copy[i].vel);\r\n  }\r\n}\r\n\r\nexport function graphGetIslands(nodes) {\r\n  let islands = [];\r\n  let visit1 = new util.set();\r\n\r\n  let rec = (n, island) => {\r\n    island.push(n);\r\n    visit1.add(n);\r\n\r\n    for (let v of n.verts) {\r\n      for (let e of v.edges) {\r\n        let n2 = e.node;\r\n        if (n2 !== n && !visit1.has(n2)) {\r\n          rec(n2, island);\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  for (let n of nodes) {\r\n    if (visit1.has(n)) {\r\n      continue;\r\n    }\r\n\r\n    let island = [];\r\n    islands.push(island);\r\n    rec(n, island);\r\n  }\r\n\r\n  return islands;\r\n}\r\n\r\nexport function graphPack(nodes, margin_or_args=15, steps=10, updateCb=undefined) {\r\n  let margin = margin_or_args;\r\n  let speed = 1.0;\r\n\r\n  if (typeof margin === \"object\") {\r\n    let args = margin;\r\n\r\n    margin = args.margin ?? 15;\r\n    steps = args.steps ?? 10;\r\n    updateCb = args.updateCb;\r\n    speed = args.speed ?? 1.0;\r\n  }\r\n\r\n  let orignodes = nodes;\r\n  nodes = copyGraph(nodes);\r\n\r\n  let decay = 1.0;\r\n  let decayi = 0;\r\n\r\n\r\n  let min = new Vector2().addScalar(1e17);\r\n  let max = new Vector2().addScalar(-1e17);\r\n\r\n  let tmp = new Vector2();\r\n  for (let n of nodes) {\r\n    min.min(n.pos);\r\n    tmp.load(n.pos).add(n.size);\r\n    max.max(tmp);\r\n  }\r\n\r\n  let size = new Vector2(max).sub(min);\r\n\r\n  for (let n of nodes) {\r\n    n.pos[0] += (Math.random()-0.5)*5.0/size[0]*speed;\r\n    n.pos[1] += (Math.random()-0.5)*5.0/size[1]*speed;\r\n  }\r\n\r\n  let nodemap = {};\r\n  for (let n of nodes) {\r\n    n.vel.zero();\r\n    nodemap[n._id] = n;\r\n    for (let v of n.verts) {\r\n      nodemap[v._id] = v;\r\n    }\r\n  }\r\n\r\n  let visit = new util.set();\r\n  let verts = new util.set();\r\n  let isect = [];\r\n\r\n  let disableEdges = false;\r\n\r\n  function edge_c(params) {\r\n    let [v1, v2, restlen] = params;\r\n\r\n    if (disableEdges) return 0;\r\n\r\n    return Math.abs(v1.absPos.vectorDistance(v2.absPos) - restlen);\r\n  }\r\n\r\n  let p1 = new Vector2();\r\n  let p2 = new Vector2();\r\n  let s1 = new Vector2();\r\n  let s2 = new Vector2();\r\n\r\n  function loadBoxes(n1, n2, margin1=margin) {\r\n    p1.load(n1.pos);\r\n    p2.load(n2.pos);\r\n    s1.load(n1.size);\r\n    s2.load(n2.size);\r\n\r\n    p1.subScalar(margin1);\r\n    p2.subScalar(margin1);\r\n    s1.addScalar(margin1*2.0);\r\n    s2.addScalar(margin1*2.0);\r\n  }\r\n\r\n  let disableArea = false;\r\n\r\n  function area_c(params) {\r\n    let [n1, n2] = params;\r\n\r\n    if (disableArea)\r\n      return 0.0;\r\n\r\n    loadBoxes(n1, n2);\r\n\r\n    let a1 = n1.size[0]*n1.size[1];\r\n    let a2 = n2.size[0]*n2.size[1];\r\n\r\n    return math.aabb_overlap_area(p1, s1, p2, s2);\r\n    return (math.aabb_overlap_area(p1, s1, p2, s2) / (a1+a2));\r\n  }\r\n\r\n  let lasterr, besterr, best;\r\n  let err;\r\n\r\n  let islands = graphGetIslands(nodes);\r\n  let fakeVerts = [];\r\n  for (let island of islands) {\r\n    let n = island[0];\r\n    let fv = new PackNodeVertex(n);\r\n    fakeVerts.push(fv);\r\n  }\r\n\r\n  let solveStep1 = (gk=1.0) => {\r\n    let solver = new Solver();\r\n\r\n    isect.length = 0;\r\n    visit = new util.set();\r\n\r\n    if (fakeVerts.length > 1) {\r\n      for (let i=1; i<fakeVerts.length; i++) {\r\n        let v1 = fakeVerts[0];\r\n        let v2 = fakeVerts[i];\r\n\r\n        let rlen = 1.0;\r\n\r\n        let con = new Constraint(\"edge_c\", edge_c, [v1.node.pos, v2.node.pos], [v1, v2, rlen]);\r\n        con.k = 0.25;\r\n        solver.add(con);\r\n      }\r\n    }\r\n\r\n    for (let n1 of nodes) {\r\n      for (let v of n1.verts) {\r\n        verts.add(v);\r\n        for (let v2 of v.edges) {\r\n          //hueristic to avoid adding same constraint twice\r\n          if (v2._id < v._id) continue;\r\n\r\n          let rlen = n1.size.vectorLength()*0.0;\r\n\r\n          let con = new Constraint(\"edge_c\", edge_c, [v.node.pos, v2.node.pos], [v, v2, rlen]);\r\n          con.k = 1.0;\r\n          solver.add(con);\r\n        }\r\n      }\r\n\r\n      for (let n2 of nodes) {\r\n        if (n1 === n2) continue;\r\n        let key = Math.min(n1._id, n2._id) + \":\" + Math.max(n1._id, n2._id);\r\n        if (visit.has(key)) continue;\r\n\r\n        loadBoxes(n1, n2);\r\n        let area = math.aabb_overlap_area(p1, s1, p2, s2);\r\n\r\n        if (area > 0.01) {\r\n          let size = decay*(n1.size.vectorLength() + n2.size.vectorLength())*speed;\r\n          //*\r\n          n1.pos[0] += (Math.random() - 0.5)*size;\r\n          n1.pos[1] += (Math.random() - 0.5)*size;\r\n          n2.pos[0] += (Math.random() - 0.5)*size;\r\n          n2.pos[1] += (Math.random() - 0.5)*size;\r\n          //*/\r\n\r\n          isect.push([n1, n2]);\r\n          visit.add(key);\r\n        }\r\n      }\r\n\r\n      for (let [n1, n2] of isect) {\r\n        let con = new Constraint(\"area_c\", area_c, [n1.pos, n2.pos], [n1, n2]);\r\n        solver.add(con);\r\n        con.k = 1.0;\r\n      }\r\n    }\r\n\r\n    return solver;\r\n  };\r\n\r\n  let i = 1;\r\n  let solveStep = (gk=0.5) => {\r\n    let solver = solveStep1();\r\n\r\n    if (i % 40 === 0.0) {\r\n      let c1 = getCenter(nodes);\r\n\r\n      let rfac = 1000.0;\r\n\r\n      if (best) loadGraph(nodes, best);\r\n\r\n      for (let n of nodes) {\r\n        n.pos[0] += (Math.random() - 0.5) * rfac * speed;\r\n        n.pos[1] += (Math.random() - 0.5) * rfac * speed;\r\n        n.vel.zero();\r\n      }\r\n\r\n      let c2 = getCenter(nodes);\r\n      c1.sub(c2);\r\n\r\n      for (let n of nodes) {\r\n        n.pos.add(c1);\r\n      }\r\n    }\r\n\r\n    let err = 1e17;\r\n\r\n    for (let n of nodes) {\r\n      n.oldpos.load(n.pos);\r\n      n.pos.addFac(n.vel, 0.5);\r\n    }\r\n\r\n    disableEdges = false;\r\n    disableArea = true;\r\n    solver.solve(1, gk);\r\n\r\n    //solve so boxes don't overlap\r\n    disableEdges = true;\r\n    disableArea = false;\r\n\r\n    for (let j=0; j<10; j++) {\r\n      solver = solveStep1();\r\n      err = solver.solve(10, gk*speed);\r\n    }\r\n\r\n    for (let n of nodes) {\r\n      n.vel.load(n.pos).sub(n.oldpos);\r\n    }\r\n\r\n    //get error from edge constraints\r\n\r\n    disableEdges = false;\r\n    disableArea = true;\r\n\r\n    err = 0.0;\r\n    for (let con of solver.constraints) {\r\n      err += con.evaluate(true);\r\n    }\r\n\r\n    disableEdges = false;\r\n    disableArea = false;\r\n\r\n    /*\r\n    loadGraph(orignodes, nodes);\r\n    if (updateCb) {\r\n      updateCb();\r\n    }//*/\r\n\r\n    lasterr = err;\r\n\r\n    let add = Math.random()*besterr*Math.exp(-i*0.1);\r\n\r\n    if (besterr === undefined || err < besterr+add) {\r\n      best = copyGraph(nodes);\r\n      besterr = err;\r\n    }\r\n\r\n    i++;\r\n\r\n    return err;\r\n  };\r\n\r\n\r\n  for (let j=0; j<steps; j++) {\r\n    solveStep();\r\n\r\n    decayi++;\r\n    decay = Math.exp(-decayi*0.1);\r\n  }\r\n\r\n  min.zero().addScalar(1e17);\r\n  max.zero().addScalar(-1e17);\r\n\r\n  for (let node of (best ? best : nodes)) {\r\n    min.min(node.pos);\r\n    p2.load(node.pos).add(node.size);\r\n    max.max(p2);\r\n  }\r\n\r\n  for (let node of (best ? best : nodes)) {\r\n    node.pos.sub(min);\r\n  }\r\n\r\n  loadGraph(orignodes, best ? best : nodes);\r\n\r\n  if (updateCb) {\r\n    if (nodes._timer !== undefined) {\r\n      window.clearInterval(nodes._timer);\r\n    }\r\n\r\n    nodes._timer = window.setInterval(() => {\r\n      let time = util.time_ms();\r\n\r\n      while (util.time_ms() - time < 50) {\r\n        let err = solveStep();\r\n      }\r\n\r\n      if (cconst.DEBUG.boxPacker) {\r\n        console.log(\"err\", (besterr / nodes.length).toFixed(2), (lasterr / nodes.length).toFixed(2), \"isects\", isect.length);\r\n      }\r\n\r\n      if (best) loadGraph(orignodes, best);\r\n\r\n      if (updateCb() === false) {\r\n        clearInterval(nodes._timer);\r\n        return;\r\n      }\r\n    }, 100);\r\n\r\n    let timer = nodes._timer;\r\n\r\n    return {\r\n      stop : () => {\r\n        if (best) loadGraph(nodes, best);\r\n\r\n        window.clearInterval(timer);\r\n        nodes._timer = undefined;\r\n      }\r\n    }\r\n  }\r\n}\r\n","/**\r\n see doc_src/context.md\r\n */\r\n\r\nimport * as util from '../util/util.js';\r\n\r\nimport cconst from '../config/config.js';\r\n\r\nlet notifier = undefined;\r\n\r\nexport function setNotifier(cls) {\r\n  notifier = cls;\r\n}\r\n\r\nexport const ContextFlags = {\r\n  IS_VIEW : 1\r\n};\r\n\r\nclass InheritFlag {\r\n  constructor(data) {\r\n    this.data = data;\r\n  }\r\n}\r\n\r\nlet __idgen = 1;\r\n\r\nif (Symbol.ContextID === undefined) {\r\n  Symbol.ContextID = Symbol(\"ContextID\");\r\n}\r\n\r\nif (Symbol.CachedDef === undefined) {\r\n  Symbol.CachedDef = Symbol(\"CachedDef\");\r\n}\r\n\r\nconst _ret_tmp = [undefined];\r\n\r\nexport const OverlayClasses = [];\r\n\r\nexport class ContextOverlay {\r\n  constructor(appstate) {\r\n    this.ctx = undefined; //owning context\r\n    this._state = appstate;\r\n  }\r\n\r\n  get state() {\r\n    return this._state;\r\n  }\r\n\r\n  /*\r\n  Ugly hack, ui_lasttool.js saves\r\n  a DataStruct wrapping the most recently executed ToolOp\r\n  in this.state._last_tool.\r\n  */\r\n  get last_tool() {\r\n    return this.state._last_tool;\r\n  }\r\n\r\n\r\n  onRemove(have_new_file=false) {\r\n  }\r\n\r\n  copy() {\r\n    return new this.constructor(this._state);\r\n  }\r\n\r\n  validate() {\r\n    throw new Error(\"Implement me!\");\r\n  }\r\n\r\n\r\n  //base classes override this\r\n  static contextDefine() {\r\n    throw new Error(\"implement me!\");\r\n    return {\r\n      name   :   \"\",\r\n      flag   :   0\r\n    }\r\n  }\r\n\r\n  //don't override this\r\n  static resolveDef() {\r\n    if (this.hasOwnProperty(Symbol.CachedDef)) {\r\n      return this[Symbol.CachedDef];\r\n    }\r\n\r\n    let def2 = Symbol.CachedDef = {};\r\n\r\n    let def = this.contextDefine();\r\n\r\n    if (def === undefined) {\r\n      def = {};\r\n    }\r\n\r\n    for (let k in def) {\r\n      def2[k] = def[k];\r\n    }\r\n\r\n    if (!(\"flag\") in def) {\r\n      def2.flag = Context.inherit(0);\r\n    }\r\n\r\n    let parents = [];\r\n    let p = util.getClassParent(this);\r\n\r\n    while (p && p !== ContextOverlay) {\r\n      parents.push(p);\r\n      p = util.getClassParent(p);\r\n    }\r\n\r\n    if (def2.flag instanceof InheritFlag) {\r\n      let flag = def2.flag.data;\r\n      for (let p of parents) {\r\n        let def = p.contextDefine();\r\n\r\n        if (!def.flag) {\r\n          continue;\r\n        }else if (def.flag instanceof InheritFlag) {\r\n          flag |= def.flag.data;\r\n        } else {\r\n          flag |= def.flag;\r\n          //don't go past non-inheritable parents\r\n          break;\r\n        }\r\n      }\r\n\r\n      def2.flag = flag;\r\n    }\r\n\r\n    return def2;\r\n  }\r\n}\r\n\r\nexport const excludedKeys = new Set([\"onRemove\", \"reset\", \"toString\", \"_fix\",\r\n                                     \"valueOf\", \"copy\", \"next\", \"save\", \"load\", \"clear\", \"hasOwnProperty\",\r\n                                     \"toLocaleString\", \"constructor\", \"propertyIsEnumerable\", \"isPrototypeOf\",\r\n                                     \"state\", \"saveProperty\", \"loadProperty\", \"getOwningOverlay\", \"_props\"]);\r\n\r\nexport class LockedContext {\r\n  constructor(ctx) {\r\n    this.props = {};\r\n\r\n    this.state = ctx.state;\r\n    this.api = ctx.api;\r\n    this.toolstack = ctx.toolstack;\r\n\r\n    this.load(ctx);\r\n  }\r\n\r\n  toLocked() {\r\n    //just return itself\r\n    return this;\r\n  }\r\n\r\n  error() {\r\n    return this.ctx.error(...arguments);\r\n  }\r\n  warning() {\r\n    return this.ctx.warning(...arguments);\r\n  }\r\n  message() {\r\n    return this.ctx.message(...arguments);\r\n  }\r\n  progbar() {\r\n    return this.ctx.progbar(...arguments);\r\n  }\r\n\r\n  load(ctx) {\r\n    //let keys = util.getAllKeys(ctx);\r\n    let keys = ctx._props;\r\n\r\n    function wrapget(name) {\r\n      return function(ctx2, data) {\r\n        return ctx.loadProperty(ctx2, name, data);\r\n      }\r\n    }\r\n\r\n    for (let k of keys) {\r\n      let v;\r\n      if (k === \"state\" || k === \"toolstack\" || k === \"api\") {\r\n        continue;\r\n      }\r\n\r\n      if (typeof k === \"string\" && (k.endsWith(\"_save\") || k.endsWith(\"_load\"))) {\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        v = ctx[k];\r\n      } catch (error) {\r\n        if (cconst.DEBUG.contextSystem) {\r\n          console.warn(\"failed to look up property in context: \", k);\r\n        }\r\n        continue;\r\n      }\r\n\r\n      let data, getter;\r\n      let overlay = ctx.getOwningOverlay(k);\r\n\r\n      if (overlay === undefined) {\r\n        //property must no longer be used?\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        if (typeof k === \"string\" && (overlay[k + \"_save\"] && overlay[k + \"_load\"])) {\r\n          data = overlay[k + \"_save\"]();\r\n          getter = overlay[k + \"_load\"];\r\n        } else {\r\n          data = ctx.saveProperty(k);\r\n          getter = wrapget(k);\r\n        }\r\n      } catch (error) {\r\n        //util.print_stack(error);\r\n        console.warn(\"Failed to save context property\", k);\r\n        continue;\r\n      }\r\n\r\n      this.props[k] = {\r\n        data : data,\r\n        get  : getter\r\n      };\r\n    }\r\n\r\n    let defineProp = (name) => {\r\n      Object.defineProperty(this, name, {\r\n        get : function() {\r\n          let def = this.props[name];\r\n          return def.get(this.ctx, def.data)\r\n        }\r\n      })\r\n    };\r\n\r\n    for (let k in this.props) {\r\n      defineProp(k);\r\n    }\r\n\r\n    this.ctx = ctx;\r\n  }\r\n\r\n  setContext(ctx) {\r\n    this.ctx = ctx;\r\n\r\n    this.state = ctx.state;\r\n    this.api = ctx.api;\r\n    this.toolstack = ctx.toolstack;\r\n  }\r\n}\r\n\r\nlet next_key = {};\r\nlet idgen = 1;\r\n\r\nexport class Context {\r\n  constructor(appstate) {\r\n    this.state = appstate;\r\n\r\n    this._props = new Set();\r\n    this._stack = [];\r\n    this._inside_map = {};\r\n  }\r\n\r\n  /** chrome's debug console corrupts this._inside_map,\r\n   this method fixes it*/\r\n  _fix() {\r\n    this._inside_map = {};\r\n  }\r\n\r\n  fix() {\r\n    this._fix();\r\n  }\r\n\r\n  error(message, timeout=1500) {\r\n    let state = this.state;\r\n\r\n    console.warn(message);\r\n\r\n    if (state && state.screen) {\r\n      return notifier.error(state.screen, message, timeout);\r\n    }\r\n  }\r\n\r\n  warning(message, timeout=1500) {\r\n    let state = this.state;\r\n\r\n    console.warn(message);\r\n\r\n    if (state && state.screen) {\r\n      return notifier.warning(state.screen, message, timeout);\r\n    }\r\n  }\r\n\r\n  message(msg, timeout=1500) {\r\n    let state = this.state;\r\n\r\n    console.warn(msg);\r\n\r\n    if (state && state.screen) {\r\n      return notifier.message(state.screen, msg, timeout);\r\n    }\r\n  }\r\n\r\n  progbar(msg, perc=0.0, timeout=1500, id=msg) {\r\n    let state = this.state;\r\n\r\n    if (state && state.screen) {\r\n      //progbarNote(screen, msg, percent, color, timeout) {\r\n      return notifier.progbarNote(state.screen, msg, perc, \"green\", timeout, id);\r\n    }\r\n  }\r\n\r\n  validateOverlays() {\r\n    let stack = this._stack;\r\n    let stack2 = [];\r\n\r\n    for (let i=0; i<stack.length; i++) {\r\n      if (stack[i].validate()) {\r\n        stack2.push(stack[i]);\r\n      }\r\n    }\r\n\r\n    this._stack = stack2;\r\n  }\r\n\r\n  hasOverlay(cls) {\r\n    return this.getOverlay(cls) !== undefined;\r\n  }\r\n\r\n  getOverlay(cls) {\r\n    for (let overlay of this._stack) {\r\n      if (overlay.constructor === cls) {\r\n        return overlay;\r\n      }\r\n    }\r\n  }\r\n\r\n  clear(have_new_file=false) {\r\n    for (let overlay of this._stack) {\r\n      overlay.onRemove(have_new_file);\r\n    }\r\n\r\n    this._stack = [];\r\n  }\r\n\r\n  //this is implemented by child classes\r\n  //it should load the same default overlays as in constructor\r\n  reset(have_new_file=false) {\r\n    this.clear(have_new_file);\r\n  }\r\n\r\n  //returns a new context with overriden properties\r\n  //unlike pushOverlay, overrides can be a simple object\r\n  override(overrides) {\r\n    if (overrides.copy === undefined) {\r\n      overrides.copy = function() {\r\n        return Object.assign({}, this);\r\n      }\r\n    }\r\n\r\n    let ctx = this.copy();\r\n    ctx.pushOverlay(overrides);\r\n    return ctx;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new this.constructor(this.state);\r\n\r\n    for (let item of this._stack) {\r\n      ret.pushOverlay(item.copy());\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   Used by overlay property getters.  If returned,\r\n   the next overlay in the struct will have its getter used.\r\n\r\n   Example:\r\n\r\n   class overlay {\r\n      get scene() {\r\n        if (some_reason) {\r\n          return Context.super();\r\n        }\r\n\r\n        return something_else;\r\n      }\r\n    }\r\n   */\r\n  static super() {\r\n    return next_key;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * saves a property into some kind of non-object-reference form\r\n   *\r\n   * */\r\n  saveProperty(key) {\r\n    //console.warn(\"Missing saveProperty implementation in Context; passing through values...\", key)\r\n    return this[key];\r\n  }\r\n\r\n  /**\r\n   *\r\n   * lookup property based on saved data\r\n   *\r\n   * */\r\n  loadProperty(ctx, key, data) {\r\n    //console.warn(\"Missing loadProperty implementation in Context; passing through values...\", key)\r\n    return data;\r\n  }\r\n\r\n  getOwningOverlay(name, _val_out) {\r\n    let inside_map = this._inside_map;\r\n    let stack = this._stack;\r\n\r\n    if (cconst.DEBUG.contextSystem) {\r\n      console.log(name, inside_map);\r\n    }\r\n\r\n    for (let i=stack.length-1; i >= 0; i--) {\r\n      let overlay = stack[i];\r\n      let ret = next_key;\r\n\r\n      if (overlay[Symbol.ContextID] === undefined) {\r\n        throw new Error(\"context corruption\");\r\n      }\r\n\r\n      let ikey = overlay[Symbol.ContextID];\r\n\r\n      if (cconst.DEBUG.contextSystem) {\r\n        console.log(ikey, overlay);\r\n      }\r\n\r\n      //prevent infinite recursion\r\n      if (inside_map[ikey]) {\r\n        continue;\r\n      }\r\n\r\n      if (overlay.__allKeys.has(name)) {\r\n        if (cconst.DEBUG.contextSystem) {\r\n          console.log(\"getting value\");\r\n        }\r\n\r\n        //Chrome's console messes this up\r\n\r\n        inside_map[ikey] = 1;\r\n\r\n        try {\r\n          ret = overlay[name];\r\n        } catch (error) {\r\n\r\n          inside_map[ikey] = 0;\r\n          throw error;\r\n        }\r\n\r\n        inside_map[ikey] = 0;\r\n      }\r\n\r\n      if (ret !== next_key) {\r\n        if (_val_out !== undefined) {\r\n          _val_out[0] = ret;\r\n        }\r\n        return overlay;\r\n      }\r\n    }\r\n\r\n    if (_val_out !== undefined) {\r\n      _val_out[0] = undefined;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  ensureProperty(name) {\r\n    if (this.hasOwnProperty(name)) {\r\n      return;\r\n    }\r\n\r\n    this._props.add(name);\r\n\r\n    Object.defineProperty(this, name, {\r\n      get : function() {\r\n        let ret = _ret_tmp;\r\n        _ret_tmp[0] = undefined;\r\n\r\n        this.getOwningOverlay(name, ret);\r\n        return ret[0];\r\n      }, set : function() {\r\n        throw new Error(\"Cannot set ctx properties\")\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Returns a new context that doesn't\r\n   * contain any direct object references\r\n   * except for .state .datalib and .api, but\r\n   * instead uses those three to look up references\r\n   * on property access.\r\n   * */\r\n  toLocked() {\r\n    return new LockedContext(this);\r\n  }\r\n\r\n  pushOverlay(overlay) {\r\n    if (!overlay.hasOwnProperty(Symbol.ContextID)) {\r\n      overlay[Symbol.ContextID] = idgen++;\r\n    }\r\n\r\n    let keys = new Set();\r\n    for (let key of util.getAllKeys(overlay)) {\r\n      if (!excludedKeys.has(key) && !(typeof key === \"string\" && key[0] === \"_\")) {\r\n        keys.add(key);\r\n      }\r\n    }\r\n\r\n    overlay.ctx = this;\r\n\r\n    if (overlay.__allKeys === undefined) {\r\n      overlay.__allKeys = keys;\r\n    }\r\n\r\n    for (let k of keys) {\r\n      let bad = typeof k === \"symbol\" || excludedKeys.has(k);\r\n      bad = bad || (typeof k === \"string\" && k[0] === \"_\");\r\n      bad = bad || (typeof k === \"string\" && k.endsWith(\"_save\"));\r\n      bad = bad || (typeof k === \"string\" && k.endsWith(\"_load\"));\r\n\r\n      if (bad) {\r\n        continue;\r\n      }\r\n\r\n      this.ensureProperty(k);\r\n    }\r\n\r\n    if (this._stack.indexOf(overlay) >= 0) {\r\n      console.warn(\"Overlay already added once\");\r\n      if (this._stack[this._stack.length-1] === overlay) {\r\n        console.warn(\"  Definitely an error, overlay is already at top of stack\");\r\n        return;\r\n      }\r\n    }\r\n\r\n    this._stack.push(overlay);\r\n  }\r\n\r\n  popOverlay(overlay) {\r\n    if (overlay !== this._stack[this._stack.length-1]) {\r\n      console.warn(\"Context.popOverlay called in error\", overlay);\r\n      return;\r\n    }\r\n\r\n    overlay.onRemove();\r\n    this._stack.pop();\r\n  }\r\n\r\n  removeOverlay(overlay) {\r\n    if (this._stack.indexOf(overlay) < 0) {\r\n      console.warn(\"Context.removeOverlay called in error\", overlay);\r\n      return;\r\n    }\r\n\r\n    overlay.onRemove();\r\n    this._stack.remove(overlay);\r\n  }\r\n\r\n  static inherit(data) {\r\n    return new InheritFlag(data);\r\n  }\r\n\r\n  static register(cls) {\r\n    if (cls[Symbol.ContextID]) {\r\n      console.warn(\"Tried to register same class twice:\", cls);\r\n      return;\r\n    }\r\n\r\n    cls[Symbol.ContextID] = __idgen++;\r\n    OverlayClasses.push(cls);\r\n  }\r\n}\r\n\r\nexport function test() {\r\n  function testInheritance() {\r\n    class Test0 extends ContextOverlay {\r\n      static contextDefine() {\r\n        return {\r\n          flag: 1\r\n        }\r\n      }\r\n    }\r\n\r\n    class Test1 extends Test0 {\r\n      static contextDefine() {\r\n        return {\r\n          flag: 2\r\n        }\r\n      }\r\n    }\r\n\r\n    class Test2 extends Test1 {\r\n      static contextDefine() {\r\n        return {\r\n          flag: Context.inherit(4)\r\n        }\r\n      }\r\n    }\r\n\r\n    class Test3 extends Test2 {\r\n      static contextDefine() {\r\n        return {\r\n          flag: Context.inherit(8)\r\n        }\r\n      }\r\n    }\r\n\r\n    class Test4 extends Test3 {\r\n      static contextDefine() {\r\n        return {\r\n          flag: Context.inherit(16)\r\n        }\r\n      }\r\n    }\r\n\r\n    return Test4.resolveDef().flag === 30;\r\n  }\r\n\r\n  return testInheritance();\r\n}\r\n\r\nif (!test()) {\r\n  throw new Error(\"Context test failed\");\r\n}\r\n","export * from './controller/context.js';\r\nexport * from './controller/controller.js';\r\nexport * from './controller/controller_abstract.js';\r\nexport * from './controller/controller_ops.js';\r\nexport * from './controller/controller_abstract.js';\r\nexport * from './controller/controller_base.js';\r\nexport * from './toolsys/toolsys.js';\r\nexport * from './toolsys/toolprop.js';\r\nexport * from './toolsys/toolpath.js';\r\nexport * from './curve/curve1d_base.js';\r\nexport * from './curve/curve1d.js';\r\n\r\nimport * as solver1 from './util/solver.js';\r\nexport const solver = solver1;\r\n\r\nimport * as util1 from './util/util.js';\r\nexport const util = util1;\r\n\r\nimport * as vectormath1 from './util/vectormath.js';\r\nexport const vectormath = vectormath1;\r\n\r\nimport * as math1 from \"./util/math.js\";\r\nexport const math = math1;\r\n\r\nimport * as toolprop_abstract1 from './toolsys/toolprop_abstract.js';\r\nexport const toolprop_abstract = toolprop_abstract1;\r\n\r\nimport * as html5_fileapi1 from './util/html5_fileapi.js';\r\nexport const html5_fileapi = html5_fileapi1;\r\n\r\nimport * as parseutil1 from './util/parseutil.js';\r\nexport const parseutil = parseutil1;\r\n\r\nimport * as config1 from './config/config.js';\r\nexport const config = config1;\r\n\r\nimport nstructjs1 from './util/struct.js';\r\nexport const nstructjs = nstructjs1;\r\n\r\nexport * from './util/vectormath.js';\r\nexport * from './util/math.js';\r\nexport * from './util/colorutils.js';\r\nexport * from './util/graphpack.js';\r\nexport * from './util/solver.js';\r\nexport * from './util/simple_events.js';\r\n","let promise;\r\n\r\nif (window.haveElectron) {\r\n  promise = import('./electron/electron_api.js');\r\n} else {\r\n  promise = import('./web/web_api.js');\r\n}\r\n\r\nexport var platform;\r\n\r\npromise.then((module) => {\r\n  platform = module.platform;\r\n  promise = undefined;\r\n});\r\n\r\nexport function getPlatformAsync() {\r\n  if (promise) {\r\n    return promise;\r\n  }\r\n\r\n  return new Promise((accept, reject) => {\r\n    accept(platform);\r\n  })\r\n}\r\n","export const mimeMap = {\r\n  \".js\"  : \"application/javascript\",\r\n  \".json\": \"text/json\",\r\n  \".html\": \"text/html\",\r\n  \".txt\" : \"text/plain\",\r\n  \".jpg\" : \"image/jpeg\",\r\n  \".png\" : \"image/png\",\r\n  \".tiff\": \"image/tiff\",\r\n  \".gif\" : \"image/gif\",\r\n  \".bmp\" : \"image/bitmap\",\r\n  \".tga\" : \"image/targa\",\r\n  \".svg\" : \"image/svg+xml\",\r\n  \".xml\" : \"text/xml\"\r\n};\r\n\r\nexport var textMimes = new Set([\r\n  \"application/javascript\", \"application/x-javscript\",\r\n  \"image/svg+xml\", \"application/xml\"\r\n]);\r\n\r\nexport function isMimeText(mime) {\r\n  if (!mime) {\r\n    return false;\r\n  }\r\n\r\n  if (mime.startsWith(\"text\")) {\r\n    return true;\r\n  }\r\n\r\n  return textMimes.has(mime);\r\n}\r\n\r\nexport function getExtension(path) {\r\n  if (!path) {\r\n    return \"\";\r\n  }\r\n\r\n  let i = path.length;\r\n  while (i > 0 && path[i] !== \".\") {\r\n    i--;\r\n  }\r\n\r\n  return path.slice(i, path.length).trim().toLowerCase();\r\n}\r\n\r\nexport function getMime(path) {\r\n  let ext = getExtension(path);\r\n  if (ext in mimeMap) {\r\n    return mimeMap[ext];\r\n  }\r\n\r\n  return \"application/x-octet-stream\";\r\n}\r\n\r\nexport class PlatformAPI {\r\n  static writeFile(data, handle, mime) {\r\n    throw new Error(\"implement me\");\r\n    //returns a promise\r\n  }\r\n\r\n  static resolveURL(path, base=location.href) {\r\n    base = base.trim();\r\n\r\n    if (path.startsWith(\"./\")) {\r\n      path = path.slice(2, path.length).trim();\r\n    }\r\n\r\n    while (path.startsWith(\"/\")) {\r\n      path = path.slice(1, path.length).trim();\r\n    }\r\n\r\n    while (base.endsWith(\"/\")) {\r\n      base = base.slice(0, base.length-1).trim();\r\n    }\r\n\r\n    let exts = [\"html\", \"txt\", \"js\", \"php\", \"cgi\"]\r\n    for (let ext of exts) {\r\n      ext = \".\" + ext;\r\n      if (base.endsWith(ext)) {\r\n        let i = base.length-1;\r\n        while (i > 0 && base[i] !== \"/\") {\r\n          i--;\r\n        }\r\n\r\n        base = base.slice(0, i).trim();\r\n      }\r\n    }\r\n\r\n    while (base.endsWith(\"/\")) {\r\n      base = base.slice(0, base.length-1).trim();\r\n    }\r\n\r\n    path = (base + \"/\" + path).split(\"/\")\r\n    let path2 = [];\r\n\r\n    for (let i=0; i<path.length; i++) {\r\n      if (path[i] === \"..\") {\r\n        path2.pop();\r\n      } else {\r\n        path2.push(path[i]);\r\n      }\r\n    }\r\n\r\n    return path2.join(\"/\");\r\n  }\r\n\r\n  //returns a promise that resolves to a FilePath that can be used for re-saving.\r\n  static showOpenDialog(title, args=new FileDialogArgs()) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  //returns a promise\r\n  static showSaveDialog(title, savedata_cb, args=new FileDialogArgs()) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  //returns a promise.  if mime is a text type, a string will be fed to the promise,\r\n  //otherwise it will be an ArrayBuffer\r\n  static readFile(path, mime) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n}\r\n\r\nexport class FileDialogArgs {\r\n  constructor() {\r\n    this.multi = false; //allow selecting multiple files\r\n    this.addToRecentList = false; //update recent file list\r\n\r\n    /* example for filters:\r\n    [{\r\n      name : \"Images\",\r\n      mime : \"image/png\"\r\n      extensions : \"[\"png\", \"jpg\"]\r\n    }]\r\n    * */\r\n    this.filters = []\r\n  }\r\n}\r\n\r\n/*a file path, some platforms may not return real payhs*/\r\nexport class FilePath {\r\n  constructor(data, filename=\"unnamed\") {\r\n    this.data = data;\r\n    this.filename = filename;\r\n  }\r\n}\r\n","\"use strict\";\r\n\r\nfunction getElectronVersion() {\r\n  let key = navigator.userAgent;\r\n  let i = key.search(\"Electron\");\r\n  key = key.slice(i + 9, key.length);\r\n\r\n  i = key.search(/[ \\t]/);\r\n  if (i >= 0) {\r\n    key = key.slice(0, i);\r\n  }\r\n\r\n  key = key.trim();\r\n  key = key.split(\".\").map(f => parseInt(f));\r\n\r\n  return key;\r\n}\r\n\r\n/*\r\n* wrap require to keep angular from auto-importing\r\n* this api in browsers\r\n* */\r\nfunction getElectron() {\r\n  return require('electron');\r\n}\r\n\r\nfunction myRequire(mod) {\r\n  return globalThis.require(mod);\r\n}\r\n\r\nimport {Menu, DropBox} from '../../widgets/ui_menu.js';\r\nimport {getIconManager} from \"../../core/ui_base.js\";\r\nimport cconst from \"../../config/const.js\";\r\nimport * as util from '../../util/util.js';\r\n\r\nimport {FileDialogArgs, FilePath} from '../platform_base.js';\r\n\r\nfunction getFilename(path) {\r\n  let filename = path.replace(/\\\\/g, \"/\");\r\n  let i = filename.length - 1;\r\n  while (i >= 0 && filename[i] !== \"/\") {\r\n    i--;\r\n  }\r\n  if (i > 0) {\r\n    filename = filename.slice(i, filename.length).trim();\r\n  }\r\n\r\n  return filename;\r\n}\r\n\r\nlet _menu_init = false;\r\nlet _init = false;\r\n\r\nlet mimemap = {\r\n  \"js\"  : \"application/javascript\",\r\n  \"json\": \"text/json\",\r\n  \"png\" : \"image/png\",\r\n  \"svg\" : \"image/svg+xml\",\r\n  \"jpg\" : \"image/jpeg\",\r\n  \"txt\" : \"text/plain\",\r\n  \"html\": \"text/html\",\r\n  \"css\" : \"text/css\",\r\n  \"ts\"  : \"application/typescript\",\r\n  \"py\"  : \"application/python\",\r\n  \"c\"   : \"application/c\",\r\n  \"cpp\" : \"application/cpp\",\r\n  \"cc\"  : \"application/cpp\",\r\n  \"h\"   : \"application/c\",\r\n  \"hh\"  : \"application/cpp\",\r\n  \"hpp\" : \"application/cpp\",\r\n  \"xml\" : \"text/xml\",\r\n  \"sh\"  : \"application/bash\",\r\n  \"mjs\" : \"application/javascript\",\r\n  \"cjs\" : \"application/javascript\",\r\n  \"gif\" : \"image/gif\"\r\n};\r\n\r\n\r\nlet electron_menu_idgen = 1;\r\nlet ipcRenderer;\r\n\r\nexport class ElectronMenu extends Array {\r\n  constructor(args = {}) {\r\n    super();\r\n\r\n    this._ipcId = electron_menu_idgen++;\r\n\r\n    for (let k in args) {\r\n      this[k] = args[k];\r\n    }\r\n  }\r\n\r\n  insert(i, item) {\r\n    this.length++;\r\n\r\n    let j = this.length-1;\r\n    while (j > i) {\r\n      this[j] = this[j-1];\r\n      j--;\r\n    }\r\n    this[i] = item;\r\n\r\n    return this;\r\n  }\r\n\r\n  static setApplicationMenu(menu) {\r\n    initElectronIpc();\r\n\r\n    ipcRenderer.invoke(\"set-menu-bar\", menu);\r\n  }\r\n\r\n  closePopup() {\r\n    ipcRenderer.invoke(\"close-menu\", this._ipcId);\r\n  }\r\n\r\n  append(item) {\r\n    this.push(item);\r\n  }\r\n\r\n  popup(args) {\r\n    let {x, y, callback} = args;\r\n\r\n    callback = wrapRemoteCallback(\"popup_menu_click\", callback);\r\n\r\n    const {ipcRenderer} = require('electron')\r\n    ipcRenderer.invoke(\"popup-menu\", this, x, y, callback);\r\n  }\r\n}\r\n\r\nlet callbacks = {};\r\nlet keybase = 1;\r\n\r\nexport function wrapRemoteCallback(key, callback) {\r\n  key = \"remote_\" + key + (keybase++);\r\n  callbacks[key] = callback;\r\n\r\n  return key;\r\n}\r\n\r\nlet ipcInit = false;\r\n\r\nfunction initElectronIpc() {\r\n  if (ipcInit) {\r\n    return;\r\n  }\r\n\r\n  ipcInit = true;\r\n  ipcRenderer = require('electron').ipcRenderer;\r\n\r\n  ipcRenderer.on('invoke-menu-callback', (event, key, args) => {\r\n    //console.error(\"Electron menu callback\", key, args);\r\n    callbacks[key].apply(undefined, args);\r\n  });\r\n}\r\n\r\n\r\nexport class ElectronMenuItem {\r\n  constructor(args) {\r\n    for (let k in args) {\r\n      this[k] = args[k];\r\n    }\r\n\r\n    if (this.click) {\r\n      this.click = wrapRemoteCallback(\"menu_click\", this.click);\r\n    }\r\n  }\r\n}\r\n\r\nfunction patchDropBox() {\r\n  initElectronIpc();\r\n\r\n  //haveElectron = false;\r\n  //return;\r\n  DropBox.prototype._onpress = function _onpress(e) {\r\n    if (this._menu !== undefined) {\r\n      this._menu.close();\r\n      this._menu = undefined;\r\n      this._pressed = false;\r\n      this._redraw();\r\n      return;\r\n    }\r\n\r\n    this._build_menu();\r\n\r\n    let emenu = buildElectronMenu(this._menu);\r\n\r\n    this._menu.close = () => {\r\n      emenu.closePopup(); //getCurrentWindow);\r\n    };\r\n\r\n    //console.log(\"menu dropbox click\", this._menu);\r\n\r\n    if (this._menu === undefined) {\r\n      return;\r\n    }\r\n\r\n    this._menu._dropbox = this;\r\n    this.dom._background = this.getDefault(\"BoxDepressed\");\r\n    this._background = this.getDefault(\"BoxDepressed\");\r\n    this._redraw();\r\n    this._pressed = true;\r\n    this.setCSS();\r\n\r\n    let onclose = this._menu.onclose;\r\n    this._menu.onclose = () => {\r\n      this._pressed = false;\r\n      this._redraw();\r\n\r\n      let menu = this._menu;\r\n      if (menu) {\r\n        this._menu = undefined;\r\n        menu._dropbox = undefined;\r\n      }\r\n\r\n      if (onclose) {\r\n        onclose.call(menu);\r\n      }\r\n    }\r\n\r\n    let menu = this._menu;\r\n    let screen = this.getScreen();\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let x = e.x, y = e.y;\r\n    let rects = this.dom.getClientRects();\r\n\r\n    x = rects[0].x;\r\n    y = rects[0].y + Math.ceil(rects[0].height);\r\n\r\n    x = ~~x;\r\n    y = ~~y;\r\n\r\n    emenu.popup({\r\n      x       : x,\r\n      y       : y,\r\n      callback: () => {\r\n\r\n        if (this._menu) {\r\n          this._menu.onclose();\r\n        }\r\n      }\r\n    })\r\n  };\r\n}\r\n\r\nlet on_tick = () => {\r\n  let nativeTheme = getElectron().remote.nativeTheme;\r\n\r\n  let mode = nativeTheme.shouldUseDarkColors ? \"dark\" : \"light\";\r\n\r\n  if (mode !== cconst.colorSchemeType) {\r\n    nativeTheme.themeSource = cconst.colorSchemeType;\r\n  }\r\n}\r\n\r\nexport function checkInit() {\r\n  if (window.haveElectron && !_init) {\r\n    _init = true;\r\n\r\n\r\n    patchDropBox();\r\n    setInterval(on_tick, 350);\r\n  }\r\n}\r\n\r\nexport let iconcache = {};\r\n\r\nfunction makeIconKey(icon, iconsheet, invertColors) {\r\n  return \"\" + icon + \":\" + iconsheet + \":\" + invertColors;\r\n}\r\n\r\nexport function getNativeIcon(icon, iconsheet = 0, invertColors = false, size = 16) {\r\n  //let key = makeIconKey(icon, iconsheet, invertColors);\r\n  //if (key in iconcache) {\r\n  //  return iconcache[key];\r\n  //}\r\n\r\n  let icongen;\r\n\r\n  try {\r\n    icongen = myRequire(\"./icogen.js\");\r\n  } catch (error) {\r\n    icongen = myRequire(\"./icogen.cjs\");\r\n  }\r\n\r\n\r\n  window.icongen = icongen;\r\n  let nativeImage = getElectron().nativeImage;\r\n\r\n  let manager = getIconManager();\r\n  let sheet = manager.findSheet(iconsheet);\r\n  let images = [];\r\n\r\n  let sizes = icongen.GetRequiredICOImageSizes();\r\n\r\n  //for (let size of sizes) {\r\n  if (1) {\r\n    let iconsheet = manager.findClosestSheet(size);\r\n    let tilesize = manager.getTileSize(iconsheet);\r\n\r\n    let canvas = document.createElement(\"canvas\");\r\n    let g = canvas.getContext(\"2d\");\r\n\r\n    canvas.width = canvas.height = size;\r\n\r\n    if (invertColors) {\r\n      g.filter = \"invert(100%)\";\r\n    }\r\n\r\n    let scale = size/tilesize;\r\n    g.scale(scale, scale);\r\n\r\n    manager.canvasDraw({getDPI: () => 1.0}, canvas, g, icon, 0, 0, iconsheet);\r\n\r\n    let header = \"data:image/png;base64,\";\r\n    let data = canvas.toDataURL();\r\n\r\n    data = data.slice(header.length, data.length);\r\n    data = Buffer.from(data, \"base64\");\r\n\r\n    myRequire(\"fs\").writeFileSync(\"./myicon2.png\", data);\r\n\r\n    images.push(data);\r\n  }\r\n  //}\r\n\r\n  //let ico = icongen.GenerateICO(images);\r\n  //icon = nativeImage.createFromBuffer(ico);\r\n  //icon = nativeImage.createFromBitmap(ico);\r\n  //myRequire(\"fs\").writeFileSync(\"myicon2.ico\", ico);\r\n  return \"myicon2.png\"\r\n  return icon;\r\n  return undefined\r\n\r\n  window._icon = icon;\r\n  return icon;\r\n}\r\n\r\nlet map = {\r\n  CTRL   : \"Control\",\r\n  ALT    : \"Alt\",\r\n  SHIFT  : \"Shift\",\r\n  COMMAND: \"Command\"\r\n};\r\n\r\nexport function buildElectronHotkey(hk) {\r\n  hk = hk.trim().replace(/[ \\t-]+/g, \"+\");\r\n  for (let k in map) {\r\n    hk = hk.replace(k, map[k]);\r\n  }\r\n\r\n  return hk;\r\n}\r\n\r\nexport function buildElectronMenu(menu) {\r\n  let electron = getElectron().remote;\r\n\r\n  initElectronIpc();\r\n\r\n  //let ElectronMenu = electron.Menu;\r\n  //let ElectronMenuItem = electron.MenuItem;\r\n\r\n  let emenu = new ElectronMenu();\r\n\r\n  let buildItem = (item) => {\r\n    if (item._isMenu) {\r\n      let menu2 = item._menu;\r\n\r\n      return new ElectronMenuItem({\r\n        submenu: buildElectronMenu(item._menu),\r\n        label  : menu2.getAttribute(\"title\")\r\n      });\r\n    }\r\n\r\n\r\n    let hotkey = item.hotkey;\r\n    let icon = item.icon;\r\n    let label = \"\" + item.label;\r\n\r\n    if (hotkey && typeof hotkey !== \"string\") {\r\n      hotkey = buildElectronHotkey(hotkey);\r\n    } else {\r\n      hotkey = \"\" + hotkey;\r\n    }\r\n\r\n    if (icon < 0) {\r\n      icon = undefined;\r\n    }\r\n\r\n    let args = {\r\n      id                 : \"\" + item._id,\r\n      label              : label,\r\n      accelerator        : hotkey,\r\n      icon               : icon ? getNativeIcon(icon) : undefined,\r\n      click              : function () {\r\n        menu.onselect(item._id);\r\n      },\r\n      registerAccelerator: false\r\n    };\r\n\r\n    return new ElectronMenuItem(args);\r\n  }\r\n\r\n  for (let item of menu.items) {\r\n    //buildItem(item);\r\n    emenu.append(buildItem(item));\r\n\r\n  }\r\n\r\n  return emenu;\r\n}\r\n\r\nexport function initMenuBar(menuEditor, override = false) {\r\n  checkInit();\r\n\r\n  if (!window.haveElectron) {\r\n    return;\r\n  }\r\n\r\n  if (_menu_init && !override) {\r\n    return;\r\n  }\r\n\r\n  _menu_init = true;\r\n\r\n  let electron = getElectron().remote;\r\n\r\n  //let win = electron.getCurrentWindow();\r\n\r\n  let menu = new ElectronMenu();\r\n\r\n  let _roles = new Set([\"undo\", \"redo\", \"cut\", \"copy\", \"paste\", \"delete\", \"about\",\r\n                        \"quit\", \"open\", \"save\", \"load\", \"paste\", \"cut\", \"zoom\"]);\r\n  let roles = {};\r\n  for (let k of _roles) {\r\n    roles[k] = k;\r\n  }\r\n\r\n  roles = Object.assign(roles, {\r\n    \"select all\": \"selectAll\",\r\n    \"file\"      : \"fileMenu\",\r\n    \"edit\"      : \"editMenu\",\r\n    \"view\"      : \"viewMenu\",\r\n    \"app\"       : \"appMenu\",\r\n    \"help\"      : \"help\",\r\n    \"zoom in\"   : \"zoomIn\",\r\n    \"zoom out\"  : \"zoomOut\"\r\n  });\r\n\r\n  /*\r\n  let item = new MenuItem({\r\n    label : \"Label\",\r\n    tooltip : \"Tooltip\",\r\n    icon : getNativeIcon(0),\r\n    accelerator : \"Control+Z\",\r\n    checked : true,\r\n    id : 0,\r\n    role : undefined,\r\n    click : (arg) => {\r\n      console.log(\"menu click!\", arg)\r\n    },\r\n    submenu : undefined,\r\n    role :  undo, redo, cut, copy, paste, pasteAndMatchStyle, delete, selectAll, reload,\r\n            forceReload, toggleDevTools, resetZoom, zoomIn, zoomOut, togglefullscreen, window,\r\n             minimize, close, help, about, services, hide, hideOthers, unhide, quit, startSpeaking,\r\n             stopSpeaking, close, minimize, zoom, front, appMenu, fileMenu, editMenu, viewMenu, recentDocuments,\r\n              toggleTabBar, selectNextTab, selectPreviousTab, mergeAllWindows, clearRecentDocuments, moveTabToNewWindow\r\n               or windowMenu - Define the action of the menu item, when specified the click property will be ignored.\r\n                See roles.\r\n\r\n  });//*/\r\n\r\n\r\n  let header = menuEditor.header;\r\n  for (let dbox of header.traverse(DropBox)) {\r\n    dbox._build_menu();\r\n    dbox.update();\r\n\r\n    dbox._build_menu();\r\n    let menu2 = dbox._menu;\r\n    menu2.ctx = dbox.ctx;\r\n    menu2._init();\r\n    menu2.update();\r\n\r\n    let title = dbox._genLabel();\r\n    let args = {\r\n      label  : title,\r\n      tooltip: dbox.description,\r\n      submenu: buildElectronMenu(menu2)\r\n    };\r\n\r\n    menu.insert(0, new ElectronMenuItem(args));\r\n  }\r\n\r\n\r\n  ElectronMenu.setApplicationMenu(menu);\r\n  //win.setMenu(menu);\r\n}\r\n\r\nimport {PlatformAPI, isMimeText} from '../platform_base.js';\r\n\r\nexport class platform extends PlatformAPI {\r\n  static showOpenDialog(title, args = new FileDialogArgs()) {\r\n    const {dialog} = require('electron').remote\r\n\r\n    console.log(args.filters);\r\n\r\n    let eargs = {\r\n      defaultPath: args.defaultPath,\r\n      filters    : this._sanitizeFilters(args.filters ?? []),\r\n      properties : [\r\n        \"openFile\", \"showHiddenFiles\", \"createDirectory\"\r\n      ]\r\n    }\r\n\r\n    if (args.multi) {\r\n      eargs.properties.push(\"multiSelections\");\r\n    }\r\n\r\n    if (!args.addToRecentList) {\r\n      eargs.properties.push(\"dontAddToRecent\");\r\n    }\r\n\r\n    initElectronIpc();\r\n\r\n    return new Promise((accept, reject) => {\r\n      ipcRenderer.invoke('show-open-dialog', eargs, wrapRemoteCallback(\"open-dialog\", (ret) => {\r\n        if (ret.canceled || ret.cancelled) {\r\n          reject(\"cancel\");\r\n        } else {\r\n          accept(ret.filePaths.map(f => new FilePath(f, getFilename(f))));\r\n        }\r\n      }), wrapRemoteCallback(\"show-open-dialog\", (error) => {\r\n        reject(error);\r\n      }));\r\n    });\r\n  }\r\n\r\n  static _sanitizeFilters(filters) {\r\n    let filters2 = [];\r\n\r\n    for (let filter of filters) {\r\n      if (Array.isArray(filter)) {\r\n        let ext = filter[0];\r\n\r\n        filter = {extensions: filter};\r\n\r\n        ext = ext.replace(/\\./g, \"\").trim().toLowerCase();\r\n        if (ext in mimemap) {\r\n          filter.mime = mimemap[ext];\r\n        }\r\n\r\n        filter.name = ext;\r\n      }\r\n\r\n      console.log(filter.extensions);\r\n      filter.extensions = filter.extensions.map(f => f.startsWith(\".\") ? f.slice(1, f.length) : f);\r\n\r\n      filters2.push(filter);\r\n    }\r\n\r\n    return filters2;\r\n  }\r\n\r\n  static showSaveDialog(title, filedata_cb, args = new FileDialogArgs()) {\r\n    const {dialog} = require('electron').remote\r\n\r\n    console.log(args.filters);\r\n\r\n    let eargs = {\r\n      defaultPath: args.defaultPath,\r\n      filters    : this._sanitizeFilters(args.filters ?? []),\r\n      properties : [\r\n        \"openFile\", \"showHiddenFiles\", \"createDirectory\"\r\n      ]\r\n    }\r\n\r\n    if (args.multi) {\r\n      eargs.properties.push(\"multiSelections\");\r\n    }\r\n\r\n    if (!args.addToRecentList) {\r\n      eargs.properties.push(\"dontAddToRecent\");\r\n    }\r\n\r\n    return new Promise((accept, reject) => {\r\n      initElectronIpc();\r\n\r\n      let onthen = (ret) => {\r\n        if (ret.canceled) {\r\n          reject(\"cancel\");\r\n        } else {\r\n          let path = ret.filePath;\r\n          let filedata = filedata_cb();\r\n\r\n          if (filedata instanceof ArrayBuffer) {\r\n            filedata = new Uint8Array(filedata);\r\n          }\r\n\r\n          require('fs').writeFileSync(path, filedata);\r\n          console.log(\"saved file\", filedata);\r\n\r\n          accept(new FilePath(path, getFilename(path)));\r\n        }\r\n      }\r\n\r\n      let oncatch = (error) => {\r\n        reject(error);\r\n      }\r\n\r\n      ipcRenderer.invoke('show-save-dialog', eargs, wrapRemoteCallback('dialog', onthen), wrapRemoteCallback('dialog', oncatch));\r\n\r\n    });\r\n  }\r\n\r\n  static readFile(path, mime) {\r\n    return new Promise((accept, reject) => {\r\n      let fs = require('fs');\r\n\r\n      if (isMimeText(mime)) {\r\n        accept(fs.readFileSync(path.data, \"utf8\"));\r\n      } else {\r\n        accept(fs.readFileSync(path.data).buffer);\r\n      }\r\n    });\r\n  }\r\n\r\n  static writeFile(data, handle, mime) {\r\n    return new Promise((accept, reject) => {\r\n      let fs = require('fs');\r\n\r\n      fs.writeFileSync(handle.data, data);\r\n      accept(handle);\r\n    });\r\n  }\r\n}\r\n","\"use strict\";\r\nexport const SVG_URL = 'http://www.w3.org/2000/svg';\r\n\r\nimport * as util from './util.js';\r\nimport * as vectormath from './vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as ui from '../core/ui.js';\r\nimport * as math from './math.js';\r\n\r\nconst Vector2 = vectormath.Vector2;\r\n\r\nexport class CanvasOverdraw extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.shadow.appendChild(this.canvas);\r\n    this.g = this.canvas.getContext(\"2d\");\r\n\r\n    this.screen = undefined;\r\n    this.shapes = [];\r\n    this.otherChildren = []; //non-svg elements\r\n    this.font = undefined;\r\n\r\n    let style = document.createElement(\"style\")\r\n    style.textContent = `\r\n      .overdrawx {\r\n        pointer-events : none;\r\n      }\r\n    `;\r\n\r\n    this.shadow.appendChild(style);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname : 'screen-overdraw-canvas-x'\r\n    }\r\n  }\r\n\r\n  startNode(node, screen) {\r\n    if (screen) {\r\n      this.screen = screen;\r\n      this.ctx = screen.ctx;\r\n    }\r\n\r\n    if (!this.parentNode) {\r\n      node.appendChild(this);\r\n    }\r\n\r\n    this.style[\"display\"] = \"float\";\r\n    this.style[\"z-index\"] = this.zindex_base;\r\n\r\n    this.style[\"position\"] = \"absolute\";\r\n    this.style[\"left\"] = \"0px\";\r\n    this.style[\"top\"] = \"0px\";\r\n\r\n    this.style[\"width\"] = \"100%\" //screen.size[0] + \"px\";\r\n    this.style[\"height\"] = \"100%\" //screen.size[1] + \"px\";\r\n\r\n    this.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.svg = document.createElementNS(SVG_URL, \"svg\");\r\n    this.svg.style[\"width\"] = \"100%\";\r\n    this.svg.style[\"height\"] = \"100%\";\r\n\r\n    this.svg.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.shadow.appendChild(this.svg);\r\n    //this.style[\"background-color\"] = \"green\";\r\n  }\r\n\r\n  start(screen) {\r\n    this.screen = screen;\r\n    this.ctx = screen.ctx;\r\n\r\n    screen.parentNode.appendChild(this);\r\n\r\n    this.style[\"display\"] = \"float\";\r\n    this.style[\"z-index\"] = this.zindex_base;\r\n\r\n    this.style[\"position\"] = \"absolute\";\r\n    this.style[\"left\"] = \"0px\";\r\n    this.style[\"top\"] = \"0px\";\r\n\r\n    this.style[\"width\"] = screen.size[0] + \"px\";\r\n    this.style[\"height\"] = screen.size[1] + \"px\";\r\n\r\n    this.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.svg = document.createElementNS(SVG_URL, \"svg\");\r\n    this.svg.style[\"width\"] = \"100%\";\r\n    this.svg.style[\"height\"] = \"100%\";\r\n\r\n    this.shadow.appendChild(this.svg);\r\n\r\n    //this.style[\"background-color\"] = \"green\";\r\n  }\r\n}\r\n\r\nexport class Overdraw extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.visibleToPick = false;\r\n\r\n    this.screen = undefined;\r\n    this.shapes = [];\r\n    this.otherChildren = []; //non-svg elements\r\n    this.font = undefined;\r\n\r\n    let style = document.createElement(\"style\")\r\n    style.textContent = `\r\n      .overdrawx {\r\n        pointer-events : none;\r\n      }\r\n    `;\r\n\r\n    this.shadow.appendChild(style);\r\n\r\n    this.zindex_base = 1000;\r\n  }\r\n\r\n  startNode(node, screen) {\r\n    if (screen) {\r\n      this.screen = screen;\r\n      this.ctx = screen.ctx;\r\n    }\r\n\r\n    if (!this.parentNode) {\r\n      node.appendChild(this);\r\n    }\r\n\r\n    this.style[\"z-index\"] = this.zindex_base;\r\n\r\n    this.style[\"position\"] = \"relative\";\r\n    //this.style[\"left\"] = \"0px\";\r\n    //this.style[\"top\"] = \"0px\";\r\n    this.style[\"margin\"] = this.style[\"padding\"] = \"0px\";\r\n\r\n    this.style[\"width\"] = \"100%\" //screen.size[0] + \"px\";\r\n    this.style[\"height\"] = \"100%\" //screen.size[1] + \"px\";\r\n\r\n    this.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.svg = document.createElementNS(SVG_URL, \"svg\");\r\n    this.svg.style[\"width\"] = \"100%\";\r\n    this.svg.style[\"height\"] = \"100%\";\r\n\r\n    this.svg.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.shadow.appendChild(this.svg);\r\n    //this.style[\"background-color\"] = \"green\";\r\n  }\r\n\r\n  start(screen) {\r\n    this.screen = screen;\r\n    this.ctx = screen.ctx;\r\n\r\n    screen.parentNode.appendChild(this);\r\n\r\n    this.style[\"display\"] = \"float\";\r\n    this.style[\"z-index\"] = this.zindex_base;\r\n\r\n    this.style[\"position\"] = \"absolute\";\r\n    this.style[\"left\"] = \"0px\";\r\n    this.style[\"top\"] = \"0px\";\r\n\r\n    this.style[\"width\"] = screen.size[0] + \"px\";\r\n    this.style[\"height\"] = screen.size[1] + \"px\";\r\n\r\n    this.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.svg = document.createElementNS(SVG_URL, \"svg\");\r\n    this.svg.style[\"width\"] = \"100%\";\r\n    this.svg.style[\"height\"] = \"100%\";\r\n\r\n    this.shadow.appendChild(this.svg);\r\n\r\n    //this.style[\"background-color\"] = \"green\";\r\n  }\r\n\r\n  clear() {\r\n    for (let child of util.list(this.svg.childNodes)) {\r\n      child.remove();\r\n    }\r\n\r\n    for (let child of this.otherChildren) {\r\n      child.remove();\r\n    }\r\n\r\n    this.otherChildren.length = 0;\r\n  }\r\n\r\n  drawTextBubbles(texts, cos, colors) {\r\n    let boxes = [];\r\n    let elems = [];\r\n\r\n    let cent = new Vector2();\r\n\r\n    for (let i=0; i<texts.length; i++) {\r\n      let co = cos[i];\r\n      let text = texts[i];\r\n      let color;\r\n\r\n      if (colors !== undefined) {\r\n        color = colors[i];\r\n      }\r\n\r\n      cent.add(co);\r\n      let box = this.text(texts[i], co[0], co[1], {color : color});\r\n\r\n      boxes.push(box);\r\n      let font = box.style[\"font\"];\r\n      let pat = /[0-9]+px/;\r\n      let size = font.match(pat)[0];\r\n\r\n      //console.log(\"size\", size);\r\n\r\n      if (size === undefined) {\r\n        size = this.getDefault(\"DefaultText\").size;\r\n      } else {\r\n        size = ui_base.parsepx(size);\r\n      }\r\n\r\n      //console.log(size);\r\n      let tsize = ui_base.measureTextBlock(this, text, undefined, undefined, size, font);\r\n\r\n      box.minsize = [\r\n        ~~tsize.width,\r\n        ~~tsize.height\r\n      ];\r\n\r\n      let pad = ui_base.parsepx(box.style[\"padding\"]);\r\n\r\n      box.minsize[0] += pad*2;\r\n      box.minsize[1] += pad*2;\r\n\r\n      let x = ui_base.parsepx(box.style[\"left\"]);\r\n      let y = ui_base.parsepx(box.style[\"top\"]);\r\n\r\n      box.grads = new Array(4);\r\n      box.params = [x, y, box.minsize[0], box.minsize[1]];\r\n      box.startpos = new Vector2([x, y]);\r\n\r\n      box.setCSS = function() {\r\n        this.style[\"padding\"] = \"0px\";\r\n        this.style[\"margin\"] = \"0px\";\r\n        this.style[\"left\"] = ~~this.params[0] + \"px\";\r\n        this.style[\"top\"] = ~~this.params[1] + \"px\";\r\n        this.style[\"width\"] = ~~this.params[2] + \"px\";\r\n        this.style[\"height\"] = ~~this.params[3] + \"px\";\r\n      };\r\n\r\n      box.setCSS();\r\n      //console.log(box.params);\r\n      elems.push(box);\r\n    }\r\n\r\n    if (boxes.length === 0) {\r\n      return;\r\n    }\r\n\r\n    cent.mulScalar(1.0 / boxes.length);\r\n\r\n    function error() {\r\n      let p1 = [0, 0], p2 = [0, 0];\r\n      let s1 = [0, 0], s2 = [0, 0];\r\n\r\n      let ret = 0.0;\r\n\r\n      for (let box1 of boxes) {\r\n        for (let box2 of boxes) {\r\n          if (box2 === box1) {\r\n            continue;\r\n          }\r\n\r\n          s1[0] = box1.params[2];\r\n          s1[1] = box1.params[3];\r\n          s2[0] = box2.params[2];\r\n          s2[1] = box2.params[3];\r\n\r\n          let overlap = math.aabb_overlap_area(box1.params, s1, box2.params, s2);\r\n          ret += overlap;\r\n        }\r\n\r\n        ret += box1.startpos.vectorDistance(box1.params)*0.25;\r\n      }\r\n\r\n      return ret;\r\n    }\r\n\r\n    function solve() {\r\n      //console.log(\"ERROR\", error());\r\n      let r1 = error();\r\n      if (r1 === 0.0) {\r\n        return;\r\n      }\r\n\r\n      let df = 0.0001;\r\n      let totgs = 0.0;\r\n\r\n      for (let box of boxes) {\r\n        for (let i=0; i<box.params.length; i++) {\r\n          let orig = box.params[i];\r\n          box.params[i] += df;\r\n          let r2 = error();\r\n          box.params[i] = orig;\r\n\r\n          box.grads[i] = (r2 - r1) / df;\r\n          totgs += box.grads[i]**2;\r\n        }\r\n      }\r\n\r\n      if (totgs === 0.0) {\r\n        return;\r\n      }\r\n\r\n      r1 /= totgs;\r\n      let k = 0.4;\r\n\r\n      for (let box of boxes) {\r\n        for (let i = 0; i < box.params.length; i++) {\r\n          box.params[i] += -r1*box.grads[i]*k;\r\n        }\r\n\r\n        box.params[2] = Math.max(box.params[2], box.minsize[0]);\r\n        box.params[3] = Math.max(box.params[3], box.minsize[1]);\r\n\r\n        box.setCSS();\r\n      }\r\n    }\r\n\r\n    for (let i=0; i<15; i++) {\r\n      solve();\r\n    }\r\n\r\n    for (let box of boxes) {\r\n      elems.push(this.line(box.startpos, box.params));\r\n    }\r\n\r\n    return elems;\r\n  }\r\n\r\n  text(text, x, y, args={}) {\r\n    args = Object.assign({}, args);\r\n\r\n    if (args.font === undefined) {\r\n      if (this.font !== undefined)\r\n        args.font = this.font;\r\n      else\r\n        args.font = this.getDefault(\"DefaultText\").genCSS();\r\n    }\r\n\r\n    if (!args[\"background-color\"]) {\r\n      args[\"background-color\"] = \"rgba(75, 75, 75, 0.75)\";\r\n    }\r\n\r\n    args.color = args.color ? args.color : \"white\";\r\n    if (typeof args.color === \"object\") {\r\n      args.color = ui_base.color2css(args.color);\r\n    }\r\n\r\n    args[\"padding\"] = args[\"padding\"] === undefined ? \"5px\" : args[\"padding\"];\r\n    args[\"border-color\"] = args[\"border-color\"] ? args[\"border-color\"] : \"grey\";\r\n    args[\"border-radius\"] = args[\"border-radius\"] ? args[\"border-radius\"] : \"25px\";\r\n    args[\"border-width\"] = args[\"border-width\"] !== undefined ? args[\"border-width\"] : \"2px\";\r\n\r\n    if (typeof args[\"border-width\"] === \"number\") {\r\n      args[\"border-width\"] = \"\" + args[\"border-width\"] + \"px\";\r\n    }\r\n    if (typeof args[\"border-radius\"] === \"number\") {\r\n      args[\"border-radius\"] = \"\" + args[\"border-radius\"] + \"px\";\r\n    }\r\n\r\n    //not sure I need SVG for this. . .\r\n    let box = document.createElement(\"div\")\r\n\r\n    box.setAttribute(\"class\", \"overdrawx\");\r\n\r\n    box.style[\"position\"] = \"fixed\";\r\n    box.style[\"width\"] = \"min-contents\";\r\n    box.style[\"height\"] = \"min-contents\";\r\n    box.style[\"border-width\"] = args[\"border-width\"]\r\n    box.style[\"border-radius\"] = \"25px\";\r\n    box.style[\"pointer-events\"] = \"none\";\r\n    box.style[\"z-index\"] = this.zindex_base + 1;\r\n    box.style[\"background-color\"] = args[\"background-color\"];\r\n    box.style[\"padding\"] = args[\"padding\"];\r\n\r\n    box.style[\"left\"] = x + \"px\";\r\n    box.style[\"top\"] = y + \"px\";\r\n\r\n    box.style[\"display\"] = \"flex\";\r\n    box.style[\"justify-content\"] = \"center\";\r\n    box.style[\"align-items\"] = \"center\";\r\n\r\n    box.innerText = text;\r\n    box.style[\"font\"] = args.font;\r\n    box.style[\"color\"] = args.color;\r\n\r\n    this.otherChildren.push(box);\r\n    this.shadow.appendChild(box);\r\n\r\n    return box;\r\n  }\r\n\r\n  circle(p, r, stroke=\"black\", fill=\"none\") {\r\n    let circle = document.createElementNS(SVG_URL, \"circle\");\r\n    circle.setAttribute(\"cx\", p[0]);\r\n    circle.setAttribute(\"cy\", p[1]);\r\n    circle.setAttribute(\"r\", r);\r\n\r\n    if (fill) {\r\n      circle.setAttribute(\"style\", `stroke:${stroke};stroke-width:2;fill:${fill}`);\r\n    } else {\r\n      circle.setAttribute(\"style\", `stroke:${stroke};stroke-width:2`);\r\n    }\r\n\r\n    this.svg.appendChild(circle);\r\n\r\n    return circle;\r\n  }\r\n\r\n  line(v1, v2, color=\"black\") {\r\n    let line = document.createElementNS(SVG_URL, \"line\");\r\n    line.setAttribute(\"x1\", v1[0]);\r\n    line.setAttribute(\"y1\", v1[1]);\r\n    line.setAttribute(\"x2\", v2[0]);\r\n    line.setAttribute(\"y2\", v2[1]);\r\n    line.setAttribute(\"style\", `stroke:${color};stroke-width:2`);\r\n\r\n    this.svg.appendChild(line);\r\n    return line;\r\n  }\r\n\r\n  rect(p, size, color=\"black\") {\r\n    let line = document.createElementNS(SVG_URL, \"rect\");\r\n    line.setAttribute(\"x\", p[0]);\r\n    line.setAttribute(\"y\", p[1]);\r\n    line.setAttribute(\"width\", size[0]);\r\n    line.setAttribute(\"height\", size[1]);\r\n    line.setAttribute(\"style\", `fill:${color};stroke-width:2`);\r\n\r\n    line.setColor = (color) => {\r\n      line.setAttribute(\"style\", `fill:${color};stroke-width:2`);\r\n    };\r\n\r\n    this.svg.appendChild(line);\r\n    return line;\r\n  }\r\n\r\n  end() {\r\n    this.clear();\r\n    this.remove();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"overdraw-x\",\r\n    style   : \"overdraw\"\r\n  };}\r\n}\r\n\r\nui_base.UIBase.internalRegister(Overdraw);\r\n","import '../util/ScreenOverdraw.js';\r\nimport {UIBase, Icons} from '../core/ui_base.js';\r\nimport {Container} from '../core/ui.js';\r\nimport {pushModalLight, popModalLight, keymap} from '../path-controller/util/simple_events.js';\r\nimport {parsepx} from '../core/ui_theme.js';\r\nimport {Vector2} from '../path-controller/util/vectormath.js';\r\nimport * as math from '../path-controller/util/math.js';\r\n\r\nexport class TreeItem extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.treeParent = undefined;\r\n    this.treeChildren = [];\r\n    this.treeView = undefined;\r\n    this.treeDepth = 0;\r\n\r\n    this.header = this.row();\r\n\r\n    this._icon1 = this.header.iconbutton(Icons.TREE_COLLAPSE);\r\n    this._icon1.iconsheet = 0;\r\n    this._icon1.drawButtonBG = false;\r\n\r\n    this._icon2 = undefined;\r\n\r\n    this._icon1.onclick = () => {\r\n      if (this.opened) {\r\n        this.close();\r\n      }  else {\r\n        this.open();\r\n      }\r\n    }\r\n\r\n    this.opened = true;\r\n\r\n    this._label = this.header.label(\"unlabeled\");\r\n    this._labelText = \"unlabeled\";\r\n  }\r\n\r\n  set icon(id) {\r\n    if (this._icon2) {\r\n      this._icon2 = id;\r\n    } else {\r\n      this._icon2 = UIBase.createElement(\"icon-label-x\");\r\n      this._icon2.icon = id;\r\n      this._icon2.iconsheet = 0;\r\n\r\n\r\n      this.header.insert(1, this._icon2);\r\n    }\r\n  }\r\n\r\n  get icon() {\r\n    if (this._icon2)\r\n      return this._icon2.icon;\r\n    else\r\n      return -1;\r\n  }\r\n\r\n  open() {\r\n    this._icon1.icon = Icons.TREE_COLLAPSE;\r\n    this.opened = true;\r\n    this.treeView._open(this);\r\n  }\r\n\r\n  close() {\r\n    this._icon1.icon = Icons.TREE_EXPAND;\r\n    this.opened = false;\r\n    this.treeView._close(this);\r\n  }\r\n\r\n  set text(b) {\r\n    if (typeof b === \"string\") {\r\n      this._label.text = b;\r\n      this._labelText = b;\r\n    } else if (b instanceof HTMLElement) {\r\n      this._label.remove();\r\n      this.header.add(b);\r\n\r\n      this._label = b;\r\n      this._labelText = b;\r\n    }\r\n  }\r\n\r\n  get text() {\r\n    return this._labelText;\r\n  }\r\n\r\n\r\n  item(name, args={}) {\r\n    args.treeParent = this;\r\n    return this.parentWidget.item(name, args);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"tree-item-x\",\r\n    style   : \"treeview\"\r\n  }}\r\n}\r\nUIBase.internalRegister(TreeItem);\r\n\r\nexport class TreeView extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.items = [];\r\n    this.strokes = [];\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-direction\"] = \"column\";\r\n\r\n    //this.shadow.appendChild(this.overdraw);\r\n\r\n    this.overdraw = UIBase.createElement(\"overdraw-x\");\r\n    console.log(this.overdraw.startNode);\r\n    this.overdraw.startNode(this);\r\n\r\n    this.style[\"margin\"] = this.style[\"padding\"] = \"0px\";\r\n\r\n    this.updateOverdraw();\r\n  }\r\n\r\n  _forAllChildren(item, cb) {\r\n    let visit = (n) => {\r\n      cb(n);\r\n\r\n      for (let c of n.treeChildren) {\r\n        visit(c);\r\n      }\r\n    }\r\n\r\n    for (let c of item.treeChildren) {\r\n      visit(c);\r\n    }\r\n  }\r\n\r\n  _open(item) {\r\n    this._forAllChildren(item, (c) => {\r\n      if (c.opened) {\r\n        c.unhide();\r\n      }\r\n    })\r\n\r\n    this._makeStrokes();\r\n  }\r\n\r\n  _close(item) {\r\n    this._forAllChildren(item, (c) => {\r\n      c.hide();\r\n    })\r\n\r\n    this._makeStrokes();\r\n  }\r\n\r\n  _makeStrokes() {\r\n    if (!this.overdraw) {\r\n      //this.doOnce(this._makeStrokes);\r\n      return;\r\n    }\r\n\r\n    for (let elem of this.strokes) {\r\n      elem.remove();\r\n    }\r\n    this.strokes.length = 0;\r\n\r\n    let hidden = (item) => {\r\n      return item.hidden;\r\n      let p = item;\r\n\r\n      while (p) {\r\n        if (!p.opened)\r\n          return true;\r\n        p = p.treeParent;\r\n      }\r\n\r\n      return false;\r\n    }\r\n\r\n    let items = this.items;\r\n    if (items.length == 0) {\r\n      return;\r\n    }\r\n\r\n    this.overdraw.clear();\r\n\r\n    let next = (i) => {\r\n      i++;\r\n\r\n      while (i < items.length && hidden(items[i])) {\r\n        i++;\r\n        continue;\r\n      }\r\n\r\n      return i;\r\n    }\r\n\r\n    let i = 0;\r\n    if (hidden(items[i]))\r\n      i = next(i);\r\n\r\n    let origin = this.overdraw.getBoundingClientRect();\r\n    let overdraw = this.overdraw;\r\n\r\n    let line = function(x1, y1, x2, y2) {\r\n      let ox = origin.x, oy = origin.y;\r\n\r\n      x1 -= ox; y1 -= oy;\r\n      x2 -= ox; y2 -= oy;\r\n\r\n      overdraw.line([x1, y1], [x2, y2]);\r\n    }\r\n\r\n    console.log(\"making lines\", i);\r\n\r\n    let indent = this.getDefault(\"itemIndent\");\r\n    let rowh = this.getDefault(\"rowHeight\");\r\n\r\n    let getx = (depth) => {\r\n      return (depth+2.2)*indent + origin.x;\r\n    }\r\n\r\n    this.overdraw.style[\"z-index\"] = \"0\";\r\n\r\n    let prev = undefined;\r\n\r\n    for (; i<items.length; i = next(i)) {\r\n      let item = this.items[i];\r\n      let item2 = next(i);\r\n      item2 = item2 < items.length ? items[item2] : undefined;\r\n\r\n      let r = item._icon1.getBoundingClientRect();\r\n\r\n      if (!r) continue;\r\n\r\n      let x1 = getx(item.treeDepth);\r\n      let y1 = origin.y + (i+1)*rowh - rowh*0.25;\r\n\r\n\r\n      if (item2 && item2.treeDepth > item.treeDepth) {//} && (!prev || prev.treeDepth !== item.treeDepth)) {\r\n        let y2 = y1 + rowh*0.75;\r\n\r\n        line(x1, y1, x1, y2)\r\n        line(x1, y2, getx(item2.treeDepth)-3, y2);\r\n\r\n      } else if (item2 && item2.treeDepth === item.treeDepth) {\r\n        line(x1, y1, x1, y1+rowh*0.5)\r\n      }\r\n\r\n      prev = item;\r\n    }\r\n  }\r\n\r\n  updateOverdraw() {\r\n    let mm = new math.MinMax(2);\r\n    let ok = false;\r\n\r\n    for (let item of this.items) {\r\n      if (item.hidden) {\r\n        //continue;\r\n      }\r\n\r\n      for (let r of item.getClientRects()) {\r\n        //console.log(r.y);\r\n        mm.minmax([r.x, r.y]);\r\n        mm.minmax([r.x+r.width, r.y+r.height]);\r\n        ok = true;\r\n      }\r\n    }\r\n\r\n    if (!ok) {\r\n      return;\r\n    }\r\n\r\n    let r = this.getClientRects()[0];\r\n    if (!r) return;\r\n\r\n    let x = r.left;\r\n    let y = r.top;// - r.y;\r\n\r\n    let od = this.overdraw;\r\n    let w = mm.max[0] - mm.min[0];\r\n    let h = mm.max[1] - mm.min[1];\r\n\r\n    od.style[\"margin\"] = \"0px\";\r\n    od.style[\"padding\"] = \"0px\";\r\n    od.svg.style[\"margin\"] = \"0px\";\r\n\r\n    od.style[\"position\"] = UIBase.PositionKey;\r\n\r\n    od.style[\"width\"] = (r.width-1) + \"px\";\r\n    od.style[\"height\"] = (r.height-1) + \"px\";\r\n\r\n    od.style[\"left\"] = x + \"px\";\r\n    od.style[\"top\"] =  y + \"px\";\r\n\r\n    //od.style[\"background-color\"] = \"rgba(50, 50, 50, 0.25)\";\r\n    //od.svg.style[\"background-color\"] = \"rgba(50, 50, 50, 0.25)\";\r\n\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateOverdraw();\r\n  }\r\n\r\n  item(name, args={icon : undefined}) {\r\n    let ret = UIBase.createElement(\"tree-item-x\");\r\n    this.add(ret);\r\n    ret._init();\r\n\r\n    ret.text = name;\r\n\r\n    if (args.icon) {\r\n      ret.icon = args.icon;\r\n    }\r\n\r\n    ret.treeParent = args.treeParent;\r\n    ret.treeView = this;\r\n\r\n    //ret.style[\"margin-bottom\"] = ret.style[\"margin-top\"] = \"0px\";\r\n    //ret.style[\"padding-bottom\"] = ret.style[\"padding-top\"] = \"0px\";\r\n    ret.style[\"max-height\"] = this.getDefault(\"rowHeight\") + \"px\";\r\n\r\n    if (ret.treeParent) {\r\n      ret.treeParent.treeChildren.push(ret);\r\n      ret.treeDepth = ret.treeParent.treeDepth + 1;\r\n    }\r\n\r\n    let p = ret.treeParent;\r\n    let i = 1;\r\n    while (p) {\r\n      p = p.treeParent;\r\n      i++;\r\n    }\r\n\r\n    ret.style[\"margin-left\"] = (i*this.getDefault(\"itemIndent\")) + \"px\";\r\n    this.items.push(ret);\r\n\r\n    this.doOnce(() => {\r\n      this._makeStrokes();\r\n    });\r\n\r\n    return ret;\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"tree-view-x\",\r\n    style   : \"treeview\"\r\n  }}\r\n}\r\nUIBase.internalRegister(TreeView);\r\n\r\n","import {UIBase, Icons} from '../core/ui_base.js';\r\nimport {Container} from '../core/ui.js';\r\nimport {pushModalLight, popModalLight, keymap} from '../path-controller/util/simple_events.js';\r\nimport {parsepx} from '../core/ui_theme.js';\r\n\r\nfunction startDrag(box) {\r\n  if (box._modal) {\r\n    popModalLight(box._modal);\r\n    box._modal = undefined;\r\n    return;\r\n  }\r\n\r\n  let first = true;\r\n  let lastx = 0;\r\n  let lasty = 0;\r\n\r\n  let handlers = {\r\n    on_mousemove(e) {\r\n      let x = e.x, y = e.y;\r\n\r\n      if (first) {\r\n        lastx = x;\r\n        lasty = y;\r\n        first = false;\r\n\r\n        return;\r\n      }\r\n\r\n      let dx = x - lastx;\r\n      let dy = y - lasty;\r\n\r\n      let hx = parsepx(box.style[\"left\"]);\r\n      let hy = parsepx(box.style[\"top\"]);\r\n\r\n      hx += dx;\r\n      hy += dy;\r\n\r\n      console.log(hx, hy);\r\n\r\n      box.style[\"left\"] = hx + \"px\";\r\n      box.style[\"top\"] = hy + \"px\";\r\n\r\n      lastx = x;\r\n      lasty = y;\r\n    },\r\n\r\n    end() {\r\n      if (box._modal) {\r\n        popModalLight(box._modal);\r\n        box._modal = undefined;\r\n      }\r\n    },\r\n\r\n    on_mouseup(e) {\r\n      this.end();\r\n    },\r\n\r\n    on_keydown(e) {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Escape\"]:\r\n        case keymap[\"Return\"]:\r\n          this.end();\r\n          break;\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  box._modal = pushModalLight(handlers);\r\n}\r\n\r\nexport class DragBox extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this._done = false;\r\n    this.header = UIBase.createElement(\"rowframe-x\");\r\n    this.contents = UIBase.createElement(\"container-x\");\r\n\r\n    this.header.style[\"border-radius\"] = \"20px\";\r\n\r\n    this.header.parentWidget = this;\r\n    this.contents.parentWidget = this;\r\n\r\n    this.shadow.appendChild(this.header);\r\n    this.shadow.appendChild(this.contents);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    let header = this.header;\r\n\r\n    header.ctx = this.ctx;\r\n    this.contents.ctx = this.ctx;\r\n    header._init();\r\n    this.contents._init();\r\n\r\n    this.style[\"min-width\"] = \"350px\";\r\n    header.style[\"height\"] = \"35px\";\r\n\r\n    let icon = header.iconbutton(Icons.DELETE, \"Hide\", () => {\r\n      this.end();\r\n    });\r\n    icon.iconsheet = 0; //use small icons\r\n\r\n    this.addEventListener(\"mousedown\", (e) => {\r\n      console.log(\"start drag\");\r\n      startDrag(this);\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n\r\n    }, {capture : false})\r\n\r\n    header.background = this.getDefault(\"background-color\");\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  add() {\r\n    return this.contents.add(...arguments);\r\n  }\r\n\r\n  prepend(n) {\r\n    return this.contents.prepend(n);\r\n  }\r\n\r\n  appendChild(n) {\r\n    return this.contents.appendChild(n);\r\n  }\r\n  col() {\r\n    return this.contents.col(...arguments);\r\n  }\r\n\r\n  row() {\r\n    return this.contents.row(...arguments);\r\n  }\r\n\r\n  strip() {\r\n    return this.contents.strip(...arguments);\r\n  }\r\n  button() {\r\n    return this.contents.button(...arguments);\r\n  }\r\n  iconbutton() {\r\n    return this.contents.iconbutton(...arguments);\r\n  }\r\n  iconcheck() {\r\n    return this.contents.iconcheck(...arguments);\r\n  }\r\n  tool() {\r\n    return this.contents.tool(...arguments);\r\n  }\r\n  menu() {\r\n    return this.contents.menu(...arguments);\r\n  }\r\n  prop() {\r\n    return this.contents.prop(...arguments);\r\n  }\r\n  listenum() {\r\n    return this.contents.listenum(...arguments);\r\n  }\r\n  check() {\r\n    return this.contents.check(...arguments);\r\n  }\r\n  iconenum() {\r\n    return this.contents.iconenum(...arguments);\r\n  }\r\n  slider() {\r\n    return this.contents.slider(...arguments);\r\n  }\r\n  simpleslider() {\r\n    return this.contents.simpleslider(...arguments);\r\n  }\r\n  curve() {\r\n    return this.contents.curve(...arguments);\r\n  }\r\n  textbox() {\r\n    return this.contents.textbox(...arguments);\r\n  }\r\n  textarea() {\r\n    return this.contents.textarea(...arguments);\r\n  }\r\n  viewer() {\r\n    return this.contents.viewer(...arguments);\r\n  }\r\n  panel() {\r\n    return this.contents.panel(...arguments);\r\n  }\r\n  tabs() {\r\n    return this.contents.tabs(...arguments);\r\n  }\r\n  table() {\r\n    return this.contents.table(...arguments);\r\n  }\r\n\r\n\r\n  end() {\r\n    if (this._done) {\r\n      return;\r\n    }\r\n    this.remove();\r\n\r\n    if (this._onend) {\r\n      this._onend();\r\n    }\r\n\r\n    if (this.onend) {\r\n      this.onend();\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.background = this.getDefault(\"background-color\");\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"drag-box-x\",\r\n    style   : \"panel\"\r\n  }}\r\n}\r\nUIBase.internalRegister(DragBox);\r\n","import {UIBase, saveUIData, loadUIData} from '../core/ui_base.js';\r\n\r\nimport * as util from \"../path-controller/util/util.js\"\r\nimport cconst from \"../config/const.js\";\r\nimport * as nstructjs from \"../path-controller/util/struct.js\";\r\n\r\nimport {Vector2} from '../path-controller/util/vectormath.js';\r\nimport {Container} from \"../core/ui.js\";\r\nimport {Area} from \"./ScreenArea.js\";\r\nimport {Icons} from \"../core/ui_base.js\";\r\n\r\nimport {startMenu} from \"../widgets/ui_menu.js\";\r\nimport {getAreaIntName, setAreaTypes, AreaWrangler, areaclasses} from './area_wrangler.js';\r\n\r\nlet ignore = 0;\r\n\r\nfunction dockerdebug() {\r\n  if (cconst.DEBUG.areadocker) {\r\n    console.warn(...arguments);\r\n  }\r\n}\r\n\r\nwindow.testSnapScreenVerts = function (arg) {\r\n  let screen = CTX.screen;\r\n\r\n  screen.unlisten();\r\n  screen.on_resize([screen.size[0] - 75, screen.size[1]], screen.size);\r\n  screen.on_resize = screen.updateSize = () => {\r\n  };\r\n\r\n  let p = CTX.propsbar;\r\n  p.pos[0] += 50;\r\n  p.owning_sarea.loadFromPosSize();\r\n  screen.regenBorders();\r\n\r\n  screen.size[0] = window.innerWidth - 5;\r\n\r\n  screen.snapScreenVerts(arg);\r\n}\r\n\r\nexport class AreaDocker extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this._last_update_key = undefined;\r\n    this.mpos = new Vector2();\r\n    this.needsRebuild = true;\r\n    this.ignoreChange = 0;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"area-docker-x\",\r\n      style  : \"areadocker\"\r\n    }\r\n  }\r\n\r\n  rebuild() {\r\n    if (!this.parentWidget) {\r\n      return;\r\n    }\r\n\r\n    let sarea = this.getArea().parentWidget;\r\n    if (!sarea) {\r\n      this.needsRebuild = true;\r\n      return;\r\n    }\r\n\r\n    this.needsRebuild = false;\r\n    this.ignoreChange++;\r\n\r\n    dockerdebug(\"Rebuild\", this.getArea());\r\n\r\n    let uidata = sarea.switcherData = saveUIData(this, \"switcherTabs\");\r\n\r\n    this.clear();\r\n\r\n    let tabs = this.tbar = this.tabs()\r\n    tabs.onchange = this.tab_onchange.bind(this);\r\n\r\n    let tab;\r\n\r\n    dockerdebug(sarea._id, sarea.area ? sarea.area._id : \"(no active area)\", sarea.editors)\r\n\r\n    sarea.switcherData = uidata;\r\n\r\n    for (let editor of sarea.editors) {\r\n      let def = editor.constructor.define();\r\n      let name = def.uiname;\r\n\r\n      if (!name) {\r\n        name = def.areaname || def.tagname.replace(/-x/, '');\r\n        name = ToolProperty.makeUIName(name);\r\n      }\r\n\r\n      let tab = tabs.tab(name, editor._id);\r\n\r\n      let start_mpos = new Vector2();\r\n      let mpos = new Vector2();\r\n\r\n      tab._tab.addEventListener(\"tabdragstart\", (e) => {\r\n        if (e.x !== 0 && e.y !== 0) {\r\n          start_mpos.loadXY(e.x, e.y);\r\n          this.mpos.loadXY(e.x, e.y);\r\n        } else {\r\n          start_mpos.load(this.mpos);\r\n        }\r\n\r\n        dockerdebug(\"tab drag start!\", start_mpos, e);\r\n      });\r\n      tab._tab.addEventListener(\"tabdragmove\", (e) => {\r\n        this.mpos.loadXY(e.x, e.y);\r\n\r\n        let rect = this.tbar.tbar.canvas.getBoundingClientRect();\r\n\r\n        let x = e.x, y = e.y;\r\n\r\n        let m = 8;\r\n        if (x < rect.x - m || x > rect.x + rect.width + m || y < rect.y - m || y >= rect.y + rect.height + m) {\r\n          dockerdebug(\"tab detach!\");\r\n          e.preventDefault(); //end dragging\r\n          this.detach(e);\r\n        }\r\n      });\r\n      tab._tab.addEventListener(\"tabdragend\", (e) => {\r\n\r\n        this.mpos.loadXY(e.x, e.y);\r\n        dockerdebug(\"tab drag end!\", e);\r\n      });\r\n    }\r\n\r\n    tab = this.tbar.icontab(Icons.SMALL_PLUS, \"add\", \"Add Editor\", false).noSwitch();\r\n    dockerdebug(\"Add Menu Tab\", tab);\r\n\r\n    let icon = this.addicon = tab._tab;\r\n\r\n    icon.ontabclick = e => this.on_addclick(e);\r\n    icon.setAttribute(\"menu-button\", \"true\");\r\n    icon.setAttribute(\"simple\", \"true\");\r\n\r\n    this.loadTabData(uidata);\r\n\r\n    this.ignoreChange--;\r\n  }\r\n\r\n  detach(event) {\r\n    this.tbar._ensureNoModal();\r\n\r\n    let area = this.getArea();\r\n    let sarea = this.ctx.screen.floatArea(area);\r\n\r\n    sarea.size.min([300, 300]);\r\n    sarea.loadFromPosSize();\r\n\r\n    let mpos = event ? new Vector2([event.x, event.y]) : this.mpos;\r\n\r\n    dockerdebug(\"EVENT\", event);\r\n\r\n    if (event && event instanceof PointerEvent) {\r\n      this.ctx.screen.moveAttachTool(sarea, mpos, document.body, event.pointerId);\r\n    } else {\r\n      this.ctx.screen.moveAttachTool(sarea, mpos);\r\n    }\r\n  }\r\n\r\n  loadTabData(uidata) {\r\n    this.ignoreChange++;\r\n    loadUIData(this, uidata);\r\n    this.ignoreChange--;\r\n  }\r\n\r\n  on_addclick(e) {\r\n    let mpos = new Vector2([e.x, e.y]);\r\n\r\n    if (this.addicon.menu && !this.addicon.menu.closed) {\r\n      this.addicon.menu.close();\r\n    } else {\r\n      this.addTabMenu(e.target, mpos);\r\n    }\r\n  }\r\n\r\n  tab_onchange(tab, event) {\r\n    if (this.ignoreChange) {\r\n      return;\r\n    }\r\n\r\n    dockerdebug(\"EVENT\", event);\r\n\r\n    if (event && (!(event instanceof PointerEvent) || event.pointerType === \"mouse\")) {\r\n      //event.preventDefault(); //prevent tab dragging\r\n    }\r\n\r\n    this.select(tab.id, event);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"touch-action\"] = \"none\";\r\n\r\n    this.addEventListener(\"pointermove\", (e) => {\r\n      this.mpos.loadXY(e.x, e.y);\r\n    });\r\n\r\n    this.rebuild();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n  }\r\n\r\n  getArea() {\r\n    let p = this.parentWidget;\r\n    let lastp = p;\r\n\r\n    let name = UIBase.getInternalName(\"screenarea-x\");\r\n    while (p && p.tagName.toLowerCase() !== name) {\r\n      lastp = p;\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    return lastp\r\n  }\r\n\r\n  flagUpdate() {\r\n    this.needsRebuild = true;\r\n    return this;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    let active = this.tbar.getActive();\r\n    let area = this.getArea();\r\n\r\n    let key = this.parentWidget._id;\r\n    for (let area2 of area.parentWidget.editors) {\r\n      key += area2._id + \":\";\r\n    }\r\n\r\n    if (key !== this._last_update_key) {\r\n      this._last_update_key = key;\r\n      this.needsRebuild = true;\r\n    }\r\n\r\n    if (this.needsRebuild) {\r\n      this.rebuild();\r\n      return;\r\n    }\r\n\r\n    if (this.addicon) {\r\n      let tabs = this.tbar.tbar.tabs;\r\n      let idx = tabs.indexOf(this.addicon);\r\n      if (idx !== tabs.length - 1) {\r\n        this.tbar.tbar.swapTabs(this.addicon, tabs[tabs.length - 1]);\r\n\r\n      }\r\n    }\r\n\r\n    if (!active || active._id !== area._id) {\r\n      this.ignoreChange++;\r\n\r\n      try {\r\n        this.tbar.setActive(area._id);\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        this.needsRebuild = true;\r\n      }\r\n\r\n      this.ignoreChange--;\r\n    }\r\n\r\n    window.tabs = this.tbar;\r\n\r\n    this.ignoreChange = 0;\r\n  }\r\n\r\n  select(areaId, event) {\r\n    dockerdebug(\"Tab Select!\", areaId);\r\n\r\n    this.ignoreChange++;\r\n\r\n    let area = this.getArea();\r\n    let sarea = area.parentWidget;\r\n\r\n    let uidata = saveUIData(this.tbar, \"switcherTabs\");\r\n    let newarea;\r\n\r\n    for (let area2 of sarea.editors) {\r\n      if (area2._id === areaId) {\r\n        newarea = area2;\r\n        sarea.switchEditor(area2.constructor);\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (newarea === area || !newarea.switcher) {\r\n      return;\r\n    }\r\n\r\n    //this.ctx.screen.completeSetCSS();\r\n    //this.ctx.screen.completeUpdate();\r\n    sarea.flushSetCSS();\r\n    sarea.flushUpdate();\r\n\r\n    newarea = sarea.area;\r\n\r\n    /* unswap switchers to avoid a bug in Chrome where\r\n    *  touch-action appears to not be respected due to our\r\n    *  swapping elements */\r\n\r\n    let parentw = area.switcher.parentWidget;\r\n    let newparentw = newarea.switcher.parentWidget;\r\n\r\n    let parent = area.switcher.parentNode;\r\n    let newparent = newarea.switcher.parentNode;\r\n\r\n    area.switcher = newarea.switcher;\r\n    newarea.switcher = this;\r\n\r\n    HTMLElement.prototype.remove.call(area.switcher);\r\n    HTMLElement.prototype.remove.call(newarea.switcher);\r\n\r\n    if (parent instanceof UIBase) {\r\n      parent.shadow.appendChild(area.switcher);\r\n    } else {\r\n      parent.appendChild(area.switcher);\r\n    }\r\n\r\n    if (newparent instanceof UIBase) {\r\n      newparent.shadow.prepend(newarea.switcher);\r\n    } else {\r\n      newparent.prepend(newarea.switcher);\r\n    }\r\n\r\n    area.switcher.parentWidget = parentw;\r\n    newarea.switcher.parentWidget = newparentw;\r\n\r\n    area.switcher.tbar._ensureNoModal();\r\n    newarea.switcher.tbar._ensureNoModal();\r\n\r\n    newarea.switcher.loadTabData(uidata);\r\n    area.switcher.loadTabData(uidata);\r\n\r\n    newarea.switcher.setCSS();\r\n    newarea.switcher.update();\r\n\r\n    if (event && (event instanceof PointerEvent || event instanceof MouseEvent || event instanceof TouchEvent)) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n      newarea.switcher.tbar._startMove(undefined, event);\r\n    }\r\n\r\n    //console.log(this._id);\r\n\r\n    sarea.switcherData = uidata;\r\n    this.ignoreChange--;\r\n  }\r\n\r\n  addTabMenu(tab, mpos) {\r\n    let rect = tab.getClientRects()[0];\r\n\r\n    dockerdebug(tab, tab.getClientRects());\r\n\r\n    if (!mpos) {\r\n      mpos = this.ctx.screen.mpos;\r\n    }\r\n\r\n    let menu = UIBase.createElement(\"menu-x\");\r\n\r\n    menu.closeOnMouseUp = false;\r\n    menu.ctx = this.ctx;\r\n    menu._init();\r\n\r\n    let prop = Area.makeAreasEnum();\r\n    let sarea = this.getArea().parentWidget;\r\n\r\n    if (!sarea) {\r\n      return;\r\n    }\r\n\r\n    for (let k in Object.assign({}, prop.values)) {\r\n      let ok = true;\r\n      for (let area of sarea.editors) {\r\n        if (area.constructor.define().uiname === k) {\r\n          ok = false;\r\n        }\r\n      }\r\n\r\n      if (!ok) {\r\n        continue;\r\n      }\r\n\r\n      let icon = prop.iconmap[k];\r\n      menu.addItemExtra(k, prop.values[k], undefined, icon);\r\n    }\r\n\r\n    if (!rect) {\r\n      console.warn(\"no rect!\");\r\n      return;\r\n    }\r\n\r\n    dockerdebug(mpos[0], mpos[1], rect.x, rect.y);\r\n\r\n    menu.onselect = (val) => {\r\n      dockerdebug(\"menu select\", val, this.getArea().parentWidget);\r\n\r\n      this.addicon.menu = undefined;\r\n\r\n      let sarea = this.getArea().parentWidget;\r\n      if (sarea) {\r\n        let cls = areaclasses[val];\r\n\r\n        this.ignoreChange++;\r\n        let area, ud;\r\n\r\n        try {\r\n          let uidata = saveUIData(this.tbar, \"switcherTabs\");\r\n          sarea.switchEditor(cls);\r\n\r\n          dockerdebug(\"switching\", cls);\r\n          area = sarea.area;\r\n          area._init();\r\n\r\n          if (area.switcher) {\r\n            area.switcher.rebuild();\r\n            area.switcher.loadTabData(uidata);\r\n            sarea.switcherData = uidata;\r\n          }\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n          throw error;\r\n        } finally {\r\n          this.ignoreChange = Math.max(this.ignoreChange - 1, 0);\r\n        }\r\n\r\n        dockerdebug(\"AREA\", area.switcher, area);\r\n\r\n        if (area.switcher) {\r\n          this.ignoreChange++;\r\n\r\n          try {\r\n            area.parentWidget = sarea;\r\n            area.owning_sarea = sarea;\r\n            area.switcher.parentWidget = area;\r\n            area.switcher.ctx = area.ctx;\r\n            area.switcher._init();\r\n            area.switcher.update();\r\n\r\n            dockerdebug(\"loading data\", ud);\r\n            area.switcher.loadTabData(ud);\r\n\r\n            area.switcher.rebuild(); //make sure plus tab is at end\r\n            area.flushUpdate();\r\n          } catch (error) {\r\n            throw error;\r\n          } finally {\r\n            this.ignoreChange = Math.max(this.ignoreChange - 1, 0);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    this.addicon.menu = menu;\r\n\r\n    startMenu(menu, mpos[0] - 35, rect.y + rect.height, false, 0);\r\n    return menu;\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(AreaDocker);\r\n","import {ToolTipViewer} from \"./FrameManager_ops.js\";\r\n\r\nlet _FrameManager = undefined;\r\nimport '../widgets/dragbox.js';\r\nimport '../widgets/ui_widgets2.js';\r\nimport '../widgets/ui_panel.js';\r\nimport '../widgets/ui_treeview.js';\r\n\r\nimport {DataPathError, nstructjs} from '../path-controller/controller.js';\r\n\r\nimport '../util/ScreenOverdraw.js';\r\nimport cconst from '../config/const.js';\r\nimport {haveModal, pushModalLight, popModalLight, _setScreenClass} from '../path-controller/util/simple_events.js';\r\nimport * as util from '../path-controller/util/util.js';\r\nimport '../widgets/ui_curvewidget.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as ScreenArea from './ScreenArea.js';\r\nimport * as FrameManager_ops from './FrameManager_ops.js';\r\nimport * as math from '../path-controller/util/math.js';\r\nimport * as ui_menu from '../widgets/ui_menu.js';\r\nimport '../path-controller/util/struct.js';\r\nimport {KeyMap, HotKey} from '../path-controller/util/simple_events.js';\r\nimport {keymap} from \"../path-controller/util/simple_events.js\";\r\n\r\nimport {AreaDocker} from './AreaDocker.js';\r\n\r\nimport {snap, snapi, ScreenBorder, ScreenVert, ScreenHalfEdge, SnapLimit} from \"./FrameManager_mesh.js\";\r\n\r\nexport {ScreenBorder, ScreenVert, ScreenHalfEdge} from \"./FrameManager_mesh.js\";\r\nimport {theme, PackFlags} from '../core/ui_base.js';\r\nimport * as FrameManager_mesh from './FrameManager_mesh.js';\r\nimport {makePopupArea} from \"../widgets/ui_dialog.js\";\r\n\r\nlet Area = ScreenArea.Area;\r\n\r\nimport '../widgets/ui_widgets.js';\r\nimport '../widgets/ui_tabs.js';\r\nimport '../widgets/ui_colorpicker2.js';\r\nimport '../widgets/ui_noteframe.js';\r\nimport '../widgets/ui_listbox.js';\r\nimport '../widgets/ui_table.js';\r\nimport {AreaFlags, setScreenClass} from \"./ScreenArea.js\";\r\nimport {checkForTextBox} from '../widgets/ui_textbox.js';\r\nimport {startMenu} from '../widgets/ui_menu.js';\r\n\r\nfunction list(iter) {\r\n  let ret = [];\r\n\r\n  for (let item of iter) {\r\n    ret.push(item);\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nui_menu.startMenuEventWrangling();\r\n\r\nlet _events_started = false;\r\n\r\nexport function registerToolStackGetter(func) {\r\n  FrameManager_ops.registerToolStackGetter(func);\r\n}\r\n\r\nlet Vector2         = vectormath.Vector2,\r\n    UIBase          = ui_base.UIBase,\r\n    styleScrollBars = ui_base.styleScrollBars;\r\n\r\nlet update_stack = new Array(8192);\r\nupdate_stack.cur = 0;\r\n\r\nlet screen_idgen = 0;\r\n\r\nexport function purgeUpdateStack() {\r\n  for (let i = 0; i < update_stack.length; i++) {\r\n    update_stack[i] = undefined;\r\n  }\r\n}\r\n\r\n/**\r\n * Base class for app workspaces\r\n *\r\n attributes:\r\n\r\n inherit-scale : don't resize to fit whole screen, use cssbox scaling\r\n\r\n */\r\nexport class Screen extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.snapLimit = 1;\r\n    this.fullScreen = true;\r\n\r\n    //all widget shadow DOMs reference this style tag,\r\n    //or rather they copy it\r\n    this.globalCSS = document.createElement(\"style\");\r\n    this.shadow.prepend(this.globalCSS);\r\n\r\n    this._do_updateSize = true;\r\n    this._resize_callbacks = [];\r\n\r\n    this.allBordersMovable = cconst.DEBUG.allBordersMovable;\r\n    this.needsBorderRegen = true;\r\n\r\n    this._popup_safe = 0;\r\n\r\n    //if true, will test all areas for keymaps on keypress,\r\n    //not just the active one\r\n    this.testAllKeyMaps = false;\r\n\r\n    this.needsTabRecalc = true;\r\n    this._screen_id = screen_idgen++;\r\n\r\n    this._popups = [];\r\n\r\n    this._ctx = undefined;\r\n\r\n    this.keymap = new KeyMap();\r\n\r\n    this.size = new Vector2([window.innerWidth, window.innerHeight]);\r\n    this.pos = new Vector2();\r\n    this.oldpos = new Vector2();\r\n\r\n    this.idgen = 0;\r\n    this.sareas = [];\r\n    this.sareas.active = undefined;\r\n    this.mpos = [0, 0];\r\n\r\n    this.screenborders = [];\r\n    this.screenverts = [];\r\n    this._vertmap = {};\r\n    this._edgemap = {};\r\n    this._idmap = {};\r\n\r\n    //effective bounds of screen\r\n    this._aabb = [new Vector2(), new Vector2()];\r\n\r\n    let on_mousemove = (e, x, y) => {\r\n      //let elem = this.pickElement(x, y, 1, 1, ScreenArea.ScreenArea);\r\n      let dragging = e.type === \"mousemove\" || e.type === \"touchmove\" || e.type === \"pointermove\";\r\n      dragging = dragging && (e.buttons || (e.touches && e.touches.length > 0));\r\n\r\n      /*\r\n      make sure active area is up to date.\r\n      but don't call pickElement too often as it's slow\r\n      */\r\n      if (!dragging && Math.random() > 0.9) {\r\n        let elem = this.pickElement(x, y, {\r\n          sx        : 1,\r\n          sy        : 1,\r\n          nodeclass : ScreenArea.ScreenArea,\r\n          mouseEvent: e\r\n        });\r\n\r\n        if (0) {\r\n          let elem2 = this.pickElement(x, y, 1, 1);\r\n          console.log(\"\" + this.sareas.active, elem2 ? elem2.tagName : undefined, elem !== undefined);\r\n        }\r\n\r\n        if (elem !== undefined) {\r\n          if (elem.area) {\r\n            //make sure context area stacks are up to date\r\n            elem.area.push_ctx_active();\r\n            elem.area.pop_ctx_active();\r\n          }\r\n\r\n          this.sareas.active = elem;\r\n        }\r\n      }\r\n\r\n      this.mpos[0] = x;\r\n      this.mpos[1] = y;\r\n    }\r\n    this.shadow.addEventListener(\"mousemove\", (e) => {\r\n      return on_mousemove(e, e.x, e.y);\r\n    }, {passive: true});\r\n\r\n    /*UIBase forwards touch events already\r\n    this.shadow.addEventListener(\"touchmove\", (e) => {\r\n      if (e.touches.length === 0) {\r\n        return;\r\n      }\r\n\r\n      return on_mousemove(e, e.touches[0].pageX, e.touches[0].pagesY);\r\n    }, {passive : true});\r\n    */\r\n  }\r\n\r\n  get borders() {\r\n    let this2 = this;\r\n\r\n    return (function* () {\r\n      for (let k in this2._edgemap) {\r\n        yield this2._edgemap[k];\r\n      }\r\n    })();\r\n  }\r\n\r\n  get listening() {\r\n    return this.listen_timer !== undefined;\r\n  }\r\n\r\n  get ctx() {\r\n    return this._ctx;\r\n  }\r\n\r\n  set ctx(val) {\r\n    this._ctx = val;\r\n\r\n    //fully recurse tree\r\n    let rec = (n) => {\r\n      if (n instanceof UIBase) {\r\n        n.ctx = val;\r\n      }\r\n\r\n      for (let n2 of n.childNodes) {\r\n        rec(n2);\r\n      }\r\n\r\n      if (n.shadow) {\r\n        for (let n2 of n.shadow.childNodes) {\r\n          rec(n2);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let n of this.childNodes) {\r\n      rec(n);\r\n    }\r\n\r\n    for (let n of this.shadow.childNodes) {\r\n      rec(n);\r\n    }\r\n  }\r\n\r\n  static fromJSON(obj, schedule_resize = false) {\r\n    let ret = UIBase.createElement(this.define().tagname);\r\n    return ret.loadJSON(obj, schedule_resize);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"pathux-screen-x\"\r\n    };\r\n  }\r\n\r\n  static newSTRUCT() {\r\n    return UIBase.createElement(this.define().tagname);\r\n  }\r\n\r\n  setPosSize(x, y, w, h) {\r\n    this.pos[0] = x;\r\n    this.pos[1] = y;\r\n    this.size[0] = w;\r\n    this.size[1] = h;\r\n\r\n    this.setCSS();\r\n    this._internalRegenAll();\r\n  }\r\n\r\n  setSize(w, h) {\r\n    this.size[0] = w;\r\n    this.size[1] = h;\r\n\r\n    this.setCSS();\r\n    this._internalRegenAll();\r\n  }\r\n\r\n  setPos(x, y) {\r\n    this.pos[0] = x;\r\n    this.pos[1] = y;\r\n\r\n    this.setCSS();\r\n    this._internalRegenAll();\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    if (this.hasAttribute(\"listen\")) {\r\n      this.listen();\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {*} style May be a string, a CSSStyleSheet instance, or a style tag\r\n   * @returns Promise fulfilled when style has been merged\r\n   */\r\n  mergeGlobalCSS(style) {\r\n    return new Promise((accept, reject) => {\r\n      let sheet;\r\n\r\n      let finish = () => {\r\n        let sheet2 = this.globalCSS.sheet;\r\n        if (!sheet2) {\r\n          this.doOnce(finish);\r\n          return;\r\n        }\r\n\r\n        let map = {};\r\n        for (let rule of sheet2.rules) {\r\n          map[rule.selectorText] = rule;\r\n        }\r\n\r\n        for (let rule of sheet.rules) {\r\n          let k = rule.selectorText;\r\n          if (k in map) {\r\n            let rule2 = map[k];\r\n\r\n            if (!rule.styleMap) { //handle firefox\r\n              for (let k in rule.style) {\r\n                let desc = Object.getOwnPropertyDescriptor(rule.style, k);\r\n\r\n                if (!desc || !desc.writable) {\r\n                  continue;\r\n                }\r\n                let v = rule.style[k];\r\n\r\n                if (v) {\r\n                  rule2.style[k] = rule.style[k];\r\n                }\r\n              }\r\n              continue;\r\n            }\r\n            for (let [key, val] of list(rule.styleMap.entries())) {\r\n              if (1 || rule2.styleMap.has(key)) {\r\n                //rule2.styleMap.delete(key);\r\n                let sval = \"\";\r\n\r\n                if (Array.isArray(val)) {\r\n                  for (let item of val) {\r\n                    sval += \" \" + val;\r\n                  }\r\n                  sval = sval.trim();\r\n                } else {\r\n                  sval = (\"\" + val).trim();\r\n                }\r\n\r\n                rule2.style[key] = sval;\r\n                rule2.styleMap.set(key, val);\r\n              } else {\r\n                rule2.styleMap.append(key, val);\r\n              }\r\n            }\r\n          } else {\r\n            sheet2.insertRule(rule.cssText);\r\n          }\r\n        }\r\n      }\r\n\r\n      if (typeof style === \"string\") {\r\n        try { //stupid firefox\r\n          sheet = new CSSStyleSheet();\r\n        } catch (error) {\r\n          sheet = undefined;\r\n        }\r\n\r\n        if (sheet && sheet.replaceSync) {\r\n          sheet.replaceSync(style);\r\n          finish();\r\n        } else {\r\n          let tag = document.createElement(\"style\");\r\n          tag.textContent = style;\r\n          document.body.appendChild(tag);\r\n\r\n          let cb = () => {\r\n            if (!tag.sheet) {\r\n              this.doOnce(cb);\r\n              return;\r\n            }\r\n\r\n            sheet = tag.sheet;\r\n            finish();\r\n            tag.remove();\r\n          };\r\n\r\n          this.doOnce(cb)\r\n        }\r\n      } else if (!(style instanceof CSSStyleSheet)) {\r\n        sheet = style.sheet;\r\n        finish();\r\n      } else {\r\n        sheet = style;\r\n        finish();\r\n      }\r\n    });\r\n  }\r\n\r\n  newScreenArea() {\r\n    let ret = UIBase.createElement(\"screenarea-x\");\r\n    ret.ctx = this.ctx;\r\n\r\n    if (ret.ctx) {\r\n      ret.init();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  copy() {\r\n    let ret = UIBase.createElement(this.constructor.define().tagname);\r\n    ret.ctx = this.ctx;\r\n    ret._init();\r\n\r\n    for (let sarea of this.sareas) {\r\n      let sarea2 = sarea.copy(ret);\r\n\r\n      sarea2._ctx = this.ctx;\r\n      sarea2.screen = ret;\r\n      sarea2.parentWidget = ret;\r\n\r\n      ret.appendChild(sarea2);\r\n    }\r\n\r\n    for (let sarea of ret.sareas) {\r\n      sarea.ctx = this.ctx;\r\n      sarea.area.ctx = this.ctx;\r\n\r\n      sarea.area.push_ctx_active();\r\n      sarea._init();\r\n      sarea.area._init();\r\n      sarea.area.pop_ctx_active();\r\n\r\n      for (let area of sarea.editors) {\r\n        area.ctx = this.ctx;\r\n\r\n        area.push_ctx_active();\r\n        area._init();\r\n        area.pop_ctx_active();\r\n      }\r\n    }\r\n\r\n    ret.update();\r\n    ret.regenBorders();\r\n    ret.setCSS();\r\n\r\n    return ret;\r\n  }\r\n\r\n  findScreenArea(x, y) {\r\n    for (let i = this.sareas.length - 1; i >= 0; i--) {\r\n      let sarea = this.sareas[i];\r\n\r\n      let ok = x >= sarea.pos[0] && x <= sarea.pos[0] + sarea.size[0];\r\n      ok = ok && (y >= sarea.pos[1] && y <= sarea.pos[1] + sarea.size[1]);\r\n\r\n      if (ok) {\r\n        return sarea;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param x\r\n   * @param y\r\n   * @param args arguments : {sx, sy, nodeclass, excluded_classes}\r\n   */\r\n  pickElement(x, y, args, sy, nodeclass, excluded_classes) {\r\n    let sx;\r\n    let clip;\r\n\r\n    if (typeof args === \"object\") {\r\n      sx = args.sx;\r\n      sy = args.sy;\r\n      nodeclass = args.nodeclass;\r\n      excluded_classes = args.excluded_classes;\r\n      clip = args.clip;\r\n    } else {\r\n      sx = args;\r\n\r\n      args = {\r\n        sx              : sx,\r\n        sy              : sy,\r\n        nodeclass       : nodeclass,\r\n        excluded_classes: excluded_classes\r\n      };\r\n    }\r\n\r\n    if (!this.ctx) {\r\n      console.warn(\"no ctx in screen\");\r\n      return;\r\n    }\r\n\r\n    let ret;\r\n\r\n    for (let i = this._popups.length - 1; i >= 0; i--) {\r\n      let popup = this._popups[i];\r\n\r\n      ret = ret || popup.pickElement(x, y, args);\r\n    }\r\n\r\n    ret = ret || super.pickElement(x, y, args);\r\n\r\n    return ret;\r\n  }\r\n\r\n  _enterPopupSafe() {\r\n    if (this._popup_safe === undefined) {\r\n      this._popup_safe = 0;\r\n    }\r\n\r\n    this._popup_safe++;\r\n  }\r\n\r\n  * _allAreas() {\r\n    for (let sarea of this.sareas) {\r\n      for (let area of sarea.editors) {\r\n        yield [area, area._area_id, sarea];\r\n      }\r\n    }\r\n  }\r\n\r\n  _exitPopupSafe() {\r\n    this._popup_safe = Math.max(this._popup_safe - 1, 0);\r\n  }\r\n\r\n  popupMenu(menu, x, y) {\r\n    startMenu(menu, x, y);\r\n\r\n    for (let i = 0; i < 3; i++) {\r\n      menu.flushSetCSS();\r\n      menu.flushUpdate();\r\n    }\r\n\r\n    return menu;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param popupDelay : if non-zero, wait for popup to layout for popupDelay miliseconds,\r\n   *                     then move the popup so it's fully inside the window (if it's outsize).\r\n   *\r\n   * */\r\n  popup(owning_node, elem_or_x, y, closeOnMouseOut = true, popupDelay = 5) {\r\n    let ret = this._popup(...arguments);\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      ret.flushUpdate();\r\n      ret.flushSetCSS();\r\n    }\r\n\r\n    if (popupDelay === 0) {\r\n      return ret;\r\n    }\r\n\r\n    let z = ret.style[\"z-index\"];\r\n\r\n    ret.style[\"z-index\"] = \"-10\";\r\n\r\n    let cb = () => {\r\n      let rect = ret.getClientRects()[0];\r\n      let size = this.size;\r\n\r\n      if (!rect) {\r\n        this.doOnce(cb);\r\n        return;\r\n      }\r\n\r\n      //console.log(\"rect\", rect);\r\n\r\n      if (rect.bottom > size[1]) {\r\n        ret.style[\"top\"] = (size[1] - rect.height - 10) + \"px\";\r\n      } else if (rect.top < 0) {\r\n        ret.style[\"top\"] = \"10px\";\r\n      }\r\n      if (rect.right > size[0]) {\r\n        ret.style[\"left\"] = (size[0] - rect.width - 10) + \"px\";\r\n      } else if (rect.left < 0) {\r\n        ret.style[\"left\"] = \"10px\";\r\n      }\r\n\r\n\r\n      ret.style[\"z-index\"] = z;\r\n\r\n      ret.flushUpdate();\r\n      ret.flushSetCSS();\r\n    }\r\n\r\n    setTimeout(cb, popupDelay);\r\n    //this.doOnce(cb);\r\n\r\n    return ret;\r\n  }\r\n\r\n  draggablePopup(x, y) {\r\n    let ret = UIBase.createElement(\"drag-box-x\");\r\n    ret.ctx = this.ctx;\r\n    ret.parentWidget = this;\r\n    ret._init();\r\n\r\n    this._popups.push(ret);\r\n\r\n    ret._onend = () => {\r\n      if (this._popups.indexOf(ret) >= 0) {\r\n        this._popups.remove(ret);\r\n      }\r\n    }\r\n\r\n    ret.style[\"z-index\"] = 205;\r\n    ret.style[\"position\"] = UIBase.PositionKey;\r\n    ret.style[\"left\"] = x + \"px\";\r\n    ret.style[\"top\"] = y + \"px\";\r\n\r\n    document.body.appendChild(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  /** makes a popup at x,y and returns a new container-x for it */\r\n  _popup(owning_node, elem_or_x, y, closeOnMouseOut = true) {\r\n    let x;\r\n\r\n    let sarea = this.sareas.active;\r\n\r\n    let w = owning_node;\r\n    while (w) {\r\n      if (w instanceof ScreenArea.ScreenArea) {\r\n        sarea = w;\r\n        break;\r\n      }\r\n      w = w.parentWidget;\r\n    }\r\n\r\n    if (typeof elem_or_x === \"object\") {\r\n      let r = elem_or_x.getClientRects()[0];\r\n\r\n      x = r.x;\r\n      y = r.y;\r\n    } else {\r\n      x = elem_or_x;\r\n    }\r\n\r\n    x += window.scrollX;\r\n    y += window.scrollY;\r\n\r\n    let container = UIBase.createElement(\"container-x\");\r\n\r\n    container.ctx = this.ctx;\r\n    container._init();\r\n\r\n    let remove = container.remove;\r\n    container.remove = () => {\r\n      if (this._popups.indexOf(container) >= 0) {\r\n        this._popups.remove(container);\r\n      }\r\n\r\n      return remove.apply(container, arguments);\r\n    };\r\n\r\n    container.overrideClass(\"popup\");\r\n\r\n    container.background = container.getDefault(\"background-color\");\r\n    container.style[\"border-radius\"] = container.getDefault(\"border-radius\") + \"px\";\r\n    container.style[\"border-color\"] = container.getDefault(\"border-color\");\r\n    container.style[\"border-style\"] = container.getDefault(\"border-style\");\r\n    container.style[\"border-width\"] = container.getDefault(\"border-width\") + \"px\";\r\n    container.style[\"box-shadow\"] = container.getDefault(\"box-shadow\");\r\n\r\n    container.style[\"position\"] = UIBase.PositionKey;\r\n    container.style[\"z-index\"] = \"2205\";\r\n    container.style[\"left\"] = x + \"px\";\r\n    container.style[\"top\"] = y + \"px\";\r\n    container.style[\"margin\"] = \"0px\";\r\n\r\n    container.parentWidget = this;\r\n\r\n    let mm = new math.MinMax(2);\r\n    let p = new Vector2();\r\n\r\n    let _update = container.update;\r\n    container.update.after(() => {\r\n      container.style[\"z-index\"] = \"2205\";\r\n    });\r\n\r\n    /*causes weird bugs\r\n    container.update = () => {\r\n      _update.call(container);\r\n\r\n      let rects = container.getClientRects();\r\n      mm.reset();\r\n\r\n      for (let r of rects) {\r\n        p[0] = r.x;\r\n        p[1] = r.y;\r\n        mm.minmax(p);\r\n\r\n        p[0] += r.width;\r\n        p[1] += r.height;\r\n        mm.minmax(p);\r\n      }\r\n\r\n      let x = mm.min[0], y = mm.min[1];\r\n\r\n      x = Math.min(x, this.size[0]-(mm.max[0]-mm.min[0]));\r\n      y = Math.min(y, this.size[1]-(mm.max[1]-mm.min[1]));\r\n\r\n      container.style[\"left\"] = x + \"px\";\r\n      container.style[\"top\"] = y + \"px\";\r\n    }//*/\r\n\r\n    document.body.appendChild(container);\r\n    //this.shadow.appendChild(container);\r\n    this.setCSS();\r\n\r\n    this._popups.push(container);\r\n\r\n    let touchpick, mousepick, keydown;\r\n\r\n    let done = false;\r\n    let end = () => {\r\n      if (this._popup_safe) {\r\n        return;\r\n      }\r\n\r\n      if (done) return;\r\n\r\n      //this.ctx.screen.removeEventListener(\"touchstart\", touchpick, true);\r\n      //this.ctx.screen.removeEventListener(\"touchmove\", touchpick, true);\r\n      this.ctx.screen.removeEventListener(\"mousedown\", mousepick, true);\r\n      this.ctx.screen.removeEventListener(\"mousemove\", mousepick, {passive: true});\r\n      this.ctx.screen.removeEventListener(\"mouseup\", mousepick, true);\r\n      window.removeEventListener(\"keydown\", keydown);\r\n\r\n      done = true;\r\n      container.remove();\r\n    };\r\n\r\n    container.end = end;\r\n\r\n    let _remove = container.remove;\r\n    container.remove = function () {\r\n      if (arguments.length == 0) {\r\n        end();\r\n      }\r\n      _remove.apply(this, arguments);\r\n    };\r\n\r\n    container._ondestroy = () => {\r\n      end();\r\n    };\r\n\r\n    let bad_time = util.time_ms();\r\n    let last_pick_time = util.time_ms();\r\n\r\n    mousepick = (e, x, y, do_timeout = true) => {\r\n      if (!container.isConnected) {\r\n        end();\r\n        return;\r\n      }\r\n\r\n      if (sarea && sarea.area) {\r\n        sarea.area.push_ctx_active();\r\n        sarea.area.pop_ctx_active();\r\n      }\r\n      //console.log(\"=======================================================popup touch start\");\r\n      //console.log(e);\r\n\r\n      if (util.time_ms() - last_pick_time < 350) {\r\n        return;\r\n      }\r\n      last_pick_time = util.time_ms();\r\n\r\n      x = x === undefined ? e.x : x;\r\n      y = y === undefined ? e.y : y;\r\n\r\n      //let elem = this.pickElement(x, y, 2, 2, undefined, [ScreenBorder]);\r\n      let elem = this.pickElement(x, y, {\r\n        sx              : 2,\r\n        sy              : 2,\r\n        excluded_classes: [ScreenBorder],\r\n        mouseEvent      : e\r\n      });\r\n\r\n      let startelem = elem;\r\n\r\n      if (elem === undefined) {\r\n        if (closeOnMouseOut) {\r\n          end();\r\n        }\r\n        return;\r\n      }\r\n\r\n      let ok = false;\r\n      let elem2 = elem;\r\n\r\n      while (elem) {\r\n        if (elem === container) {\r\n          ok = true;\r\n          break;\r\n        }\r\n        elem = elem.parentWidget;\r\n      }\r\n\r\n      if (!ok) {\r\n        do_timeout = !do_timeout || (util.time_ms() - bad_time > 100);\r\n\r\n        if (closeOnMouseOut && do_timeout) {\r\n          end();\r\n        }\r\n      } else {\r\n        bad_time = util.time_ms();\r\n      }\r\n    };\r\n\r\n    touchpick = (e) => {\r\n      let x = e.touches[0].pageX, y = e.touches[0].pageY;\r\n\r\n      return mousepick(e, x, y, false);\r\n    };\r\n\r\n    keydown = (e) => {\r\n      if (!container.isConnected) {\r\n        window.removeEventListener(\"keydown\", keydown);\r\n        return;\r\n      }\r\n\r\n      switch (e.keyCode) {\r\n        case keymap[\"Escape\"]:\r\n          end();\r\n          break;\r\n      }\r\n    };\r\n\r\n    //this.ctx.screen.addEventListener(\"touchstart\", touchpick, true);\r\n    //this.ctx.screen.addEventListener(\"touchmove\", touchpick, true);\r\n    this.ctx.screen.addEventListener(\"mousedown\", mousepick, true);\r\n    this.ctx.screen.addEventListener(\"mousemove\", mousepick, {passive: true});\r\n    this.ctx.screen.addEventListener(\"mouseup\", mousepick, true);\r\n    window.addEventListener(\"keydown\", keydown);\r\n\r\n    /*\r\n    container.addEventListener(\"mouseleave\", (e) => {\r\n      console.log(\"popup mouse leave\");\r\n      if (closeOnMouseOut)\r\n        end();\r\n    });\r\n    container.addEventListener(\"mouseout\", (e) => {\r\n      console.log(\"popup mouse out\");\r\n      if (closeOnMouseOut)\r\n        end();\r\n    });\r\n    //*/\r\n\r\n    this.calcTabOrder();\r\n\r\n    return container;\r\n  }\r\n\r\n  _recalcAABB(save = true) {\r\n    let mm = new math.MinMax(2);\r\n\r\n    for (let v of this.screenverts) {\r\n      mm.minmax(v);\r\n    }\r\n\r\n    if (save) {\r\n      this._aabb[0].load(mm.min);\r\n      this._aabb[1].load(mm.max);\r\n    }\r\n\r\n    return [new Vector2(mm.min), new Vector2(mm.max)];\r\n  }\r\n\r\n  //XXX look at if this is referenced anywhere\r\n  load() {\r\n  }\r\n\r\n  //XXX look at if this is referenced anywhere\r\n  save() {\r\n  }\r\n\r\n  popupArea(area_class) {\r\n    return makePopupArea(area_class, this);\r\n  }\r\n\r\n  remove(trigger_destroy = true) {\r\n    this.unlisten();\r\n\r\n    if (trigger_destroy) {\r\n      return super.remove();\r\n    } else {\r\n      HTMLElement.prototype.remove.call(this);\r\n    }\r\n  }\r\n\r\n  unlisten() {\r\n    if (this.listen_timer !== undefined) {\r\n      window.clearInterval(this.listen_timer);\r\n      this.listen_timer = undefined;\r\n    }\r\n  }\r\n\r\n  checkCSSSize() {\r\n    let w = this.style.width.toLowerCase().trim();\r\n    let h = this.style.height.toLowerCase().trim();\r\n\r\n    if (w.endsWith(\"px\") && h.endsWith(\"px\")) {\r\n      w = parseFloat(w.slice(0, w.length - 2).trim());\r\n      h = parseFloat(h.slice(0, h.length - 2).trim());\r\n\r\n      if (w !== this.size[0] || h !== this.size[1]) {\r\n        this.on_resize([this.size[0], this.size[1]], [w, h]);\r\n        this.size[0] = w;\r\n        this.size[1] = h;\r\n      }\r\n    }\r\n  }\r\n\r\n  getBoolAttribute(attr, defaultval = false) {\r\n    if (!this.hasAttribute(attr)) {\r\n      return defaultval;\r\n    }\r\n\r\n    let ret = this.getAttribute(attr);\r\n\r\n    if (typeof ret === \"number\") {\r\n      return !!ret;\r\n    } else if (typeof ret === \"string\") {\r\n      ret = ret.toLowerCase().trim();\r\n      ret = ret === \"true\" || ret === \"1\" || ret === \"yes\";\r\n    }\r\n\r\n    return !!ret;\r\n  }\r\n\r\n  updateSize() {\r\n    if (this.getBoolAttribute(\"inherit-scale\") || !this.fullScreen || !cconst.autoSizeUpdate) {\r\n      this.checkCSSSize();\r\n      return;\r\n    }\r\n\r\n    let width = window.innerWidth;\r\n    let height = window.innerHeight;\r\n\r\n    let ratio = window.outerHeight/window.innerHeight;\r\n    let scale = visualViewport.scale;\r\n\r\n    let pad = 4;\r\n    width = visualViewport.width*scale - pad;\r\n    height = visualViewport.height*scale - pad;\r\n\r\n    let ox = visualViewport.offsetLeft;\r\n    let oy = visualViewport.offsetTop;\r\n\r\n    if (cconst.DEBUG.customWindowSize) {\r\n      let s = cconst.DEBUG.customWindowSize;\r\n      width = s.width;\r\n      height = s.height;\r\n      ox = 0;\r\n      oy = 0;\r\n      window._DEBUG = cconst.DEBUG;\r\n    }\r\n\r\n    let key = this._calcSizeKey(width, height, ox, oy, devicePixelRatio, scale);\r\n\r\n    /* CSS IS EVIL! WHY DOES BODY HAVE A MARGIN? */\r\n    document.body.style.margin = document.body.style.padding = \"0px\";\r\n    document.body.style[\"transform-origin\"] = \"top left\";\r\n    document.body.style[\"transform\"] = `translate(${ox}px,${oy}px) scale(${1.0/scale})`;\r\n\r\n    //document.body.style[\"transform\"] = `scale(${1.0 / scale}, ${1.0 / scale})`; // translate(${ox*scale2}px, ${oy*scale2}px)`;\r\n\r\n    if (key !== this._last_ckey1) {\r\n      //console.log(\"resizing\", key, this._last_ckey1);\r\n      this._last_ckey1 = key;\r\n\r\n      this.on_resize(this.size, [width, height], false);\r\n      this.on_resize(this.size, this.size, false);\r\n\r\n      let scale = visualViewport.scale;\r\n\r\n\r\n      this.regenBorders();\r\n\r\n      this.setCSS();\r\n      this.completeUpdate();\r\n    }\r\n  }\r\n\r\n  listen(args = {updateSize: true}) {\r\n    ui_menu.setWranglerScreen(this);\r\n\r\n    let ctx = this.ctx;\r\n    startEvents(() => ctx.screen);\r\n\r\n    if (this.listen_timer !== undefined) {\r\n      return; //already listening\r\n    }\r\n\r\n    this._do_updateSize = args.updateSize !== undefined ? args.updateSize : true;\r\n\r\n    this.listen_timer = window.setInterval(() => {\r\n      if (this.isDead()) {\r\n        console.log(\"dead screen\");\r\n        this.unlisten();\r\n        return;\r\n      }\r\n\r\n      this.update();\r\n    }, 150);\r\n  }\r\n\r\n  _calcSizeKey(w, h, x, y, dpi, scale) {\r\n    if (arguments.length !== 6) {\r\n      throw new Error(\"eek\");\r\n    }\r\n\r\n    let s = \"\";\r\n    for (let i = 0; i < arguments.length; i++) {\r\n      s += arguments[i].toFixed(0) + \":\";\r\n    }\r\n\r\n    return s;\r\n  }\r\n\r\n  _ondestroy() {\r\n    if (ui_menu.getWranglerScreen() === this) {\r\n      //ui_menu.setWranglerScreen(undefined);\r\n    }\r\n\r\n    this.unlisten();\r\n\r\n    //unlike other ondestroy functions, this one physically dismantles the DOM tree\r\n    let recurse = (n, second_pass, parent) => {\r\n      if (n.__pass === second_pass) {\r\n        console.warn(\"CYCLE IN DOM TREE!\", n, parent);\r\n        return;\r\n      }\r\n\r\n      n.__pass = second_pass;\r\n\r\n      n._forEachChildWidget(n2 => {\r\n        if (n === n2)\r\n          return;\r\n        recurse(n2, second_pass, n);\r\n\r\n        try {\r\n          if (!second_pass && !n2.__destroyed) {\r\n            n2.__destroyed = true;\r\n            n2._ondestroy();\r\n          }\r\n        } catch (error) {\r\n          print_stack(error);\r\n          console.log(\"failed to exectue an ondestroy callback\");\r\n        }\r\n\r\n        n2.__destroyed = true;\r\n\r\n        try {\r\n          if (second_pass) {\r\n            n2.remove();\r\n          }\r\n        } catch (error) {\r\n          print_stack(error);\r\n          console.log(\"failed to remove element after ondestroy callback\");\r\n        }\r\n      });\r\n    };\r\n\r\n    let id = ~~(Math.random()*1024*1024);\r\n\r\n    recurse(this, id);\r\n    recurse(this, id + 1);\r\n  }\r\n\r\n  destroy() {\r\n    this._ondestroy();\r\n  }\r\n\r\n  clear() {\r\n    this._ondestroy();\r\n\r\n    this.sareas = [];\r\n    this.sareas.active = undefined;\r\n\r\n    for (let child of list(this.childNodes)) {\r\n      child.remove();\r\n    }\r\n    for (let child of list(this.shadow.childNodes)) {\r\n      child.remove();\r\n    }\r\n  }\r\n\r\n  _test_save() {\r\n    let obj = JSON.parse(JSON.stringify(this));\r\n    console.log(JSON.stringify(this));\r\n\r\n    this.loadJSON(obj);\r\n  }\r\n\r\n  loadJSON(obj, schedule_resize = false) {\r\n    this.clear();\r\n    super.loadJSON();\r\n\r\n    for (let sarea of obj.sareas) {\r\n      let sarea2 = UIBase.createElement(\"screenarea-x\");\r\n\r\n      sarea2.ctx = this.ctx;\r\n      sarea2.screen = this;\r\n\r\n      this.appendChild(sarea2);\r\n\r\n      sarea2.loadJSON(sarea);\r\n    }\r\n\r\n    this.regenBorders();\r\n    this.setCSS();\r\n\r\n    if (schedule_resize) {\r\n      window.setTimeout(() => {\r\n        this.on_resize(this.size, [window.innerWidth, window.innerHeight]);\r\n      }, 50);\r\n    }\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = {\r\n      sareas: this.sareas\r\n    };\r\n\r\n    ret.size = this.size;\r\n    ret.idgen = this.idgen;\r\n\r\n    return Object.assign(super.toJSON(), ret);\r\n  }\r\n\r\n  getHotKey(toolpath) {\r\n    let test = (keymap) => {\r\n      for (let hk of keymap) {\r\n        if (typeof hk.action != \"string\")\r\n          continue;\r\n\r\n        if (hk.action.trim().startsWith(toolpath.trim())) {\r\n          return hk;\r\n        }\r\n      }\r\n    };\r\n\r\n    let ret = test(this.keymap);\r\n    if (ret)\r\n      return ret;\r\n\r\n    if (this.sareas.active && this.sareas.active.keymap) {\r\n      let area = this.sareas.active.area;\r\n\r\n      for (let keymap of area.getKeyMaps()) {\r\n        ret = test(keymap);\r\n\r\n        if (ret)\r\n          return ret;\r\n      }\r\n    }\r\n\r\n    if (ret === undefined) {\r\n      //just to be safe, check all areas in case the\r\n      //context is confused as to which area is currently \"active\"\r\n\r\n      for (let sarea of this.sareas) {\r\n        let area = sarea.area;\r\n\r\n        for (let keymap of area.getKeyMaps()) {\r\n          ret = test(keymap);\r\n\r\n          if (ret) {\r\n            return ret;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  addEventListener(type, cb, options) {\r\n    if (type === \"resize\") {\r\n      this._resize_callbacks.push(cb);\r\n    } else {\r\n      return super.addEventListener(type, cb, options);\r\n    }\r\n  }\r\n\r\n  removeEventListener(type, cb, options) {\r\n    if (type === \"resize\") {\r\n      if (this._resize_callbacks.indexOf(cb) >= 0)\r\n        this._resize_callbacks.remove(cb);\r\n    } else {\r\n      return super.removeEventListener(type, cb, options);\r\n    }\r\n  }\r\n\r\n  execKeyMap(e) {\r\n    let handled = false;\r\n\r\n    if (window.DEBUG && window.DEBUG.keymap) {\r\n      console.warn(\"execKeyMap called\", e.keyCode, document.activeElement.tagName);\r\n    }\r\n\r\n    if (this.sareas.active) {\r\n      let area = this.sareas.active.area;\r\n\r\n      if (!area) {\r\n        return;\r\n      }\r\n\r\n      area.push_ctx_active();\r\n\r\n      for (let keymap of area.getKeyMaps()) {\r\n        if (keymap === undefined) {\r\n          continue;\r\n        }\r\n\r\n        if (keymap.handle(this.ctx, e)) {\r\n          handled = true;\r\n          break;\r\n        }\r\n      }\r\n\r\n      area.pop_ctx_active();\r\n    }\r\n\r\n    handled = handled || this.keymap.handle(this.ctx, e);\r\n\r\n    if (!handled && this.testAllKeyMaps) {\r\n      for (let sarea of this.sareas) {\r\n        if (handled) {\r\n          break;\r\n        }\r\n\r\n        sarea.area.push_ctx_active();\r\n\r\n        for (let keymap of sarea.area.getKeyMaps()) {\r\n          if (keymap.handle(this.ctx, e)) {\r\n            handled = true;\r\n            break;\r\n          }\r\n        }\r\n\r\n        sarea.area.pop_ctx_active();\r\n      }\r\n    }\r\n\r\n    return handled;\r\n  }\r\n\r\n  calcTabOrder() {\r\n    let nodes = [];\r\n    let visit = {};\r\n\r\n    let rec = (n) => {\r\n      let bad = n.tabIndex < 0 || n.tabIndex === undefined || n.tabIndex === null;\r\n      bad = bad || !(n instanceof UIBase);\r\n\r\n      if (n._id in visit || n.hidden) {\r\n        return;\r\n      }\r\n\r\n      visit[n._id] = 1;\r\n\r\n      if (!bad) {\r\n        n.__pos = n.getClientRects()[0];\r\n        if (n.__pos) {\r\n          nodes.push(n);\r\n        }\r\n      }\r\n\r\n      n._forEachChildWidget((n2) => {\r\n        rec(n2);\r\n      });\r\n    };\r\n\r\n    for (let sarea of this.sareas) {\r\n      rec(sarea);\r\n    }\r\n\r\n    for (let popup of this._popups) {\r\n      rec(popup);\r\n    }\r\n\r\n    //console.log(\"nodes2\", nodes2);\r\n    for (let i = 0; i < nodes.length; i++) {\r\n      let n = nodes[i];\r\n\r\n      n.tabIndex = i + 1;\r\n      //console.log(n.tabIndex);\r\n    }\r\n  }\r\n\r\n  drawUpdate() {\r\n    if (window.redraw_all !== undefined) {\r\n      window.redraw_all();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    let move = [];\r\n    for (let child of this.childNodes) {\r\n      if (child instanceof ScreenArea) {\r\n        move.push(child);\r\n      }\r\n    }\r\n\r\n    for (let child of move) {\r\n      console.warn(\"moved screen area to shadow\");\r\n\r\n      HTMLElement.prototype.remove.call(child);\r\n      this.shadow.appendChild(child);\r\n    }\r\n\r\n    if (this._do_updateSize) {\r\n      this.updateSize();\r\n    }\r\n\r\n    if (this.needsTabRecalc) {\r\n      this.needsTabRecalc = false;\r\n      this.calcTabOrder();\r\n    }\r\n\r\n    outer: for (let sarea of this.sareas) {\r\n      for (let b of sarea._borders) {\r\n        let movable = this.isBorderMovable(b);\r\n\r\n        if (movable !== b.movable) {\r\n          console.log(\"detected change in movable borders\");\r\n          this.regenBorders();\r\n          break outer;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (this._update_gen) {\r\n      let ret;\r\n\r\n      /*\r\n      if (cconst.DEBUG.debugUIUpdatePerf) {\r\n          for (ret = this._update_gen.next(); !ret.done; ret = this._update_gen.next()) {}\r\n\r\n        this._update_gen = this.update_intern();\r\n        return;\r\n      }\r\n      //*/\r\n\r\n      try {\r\n        ret = this._update_gen.next();\r\n      } catch (error) {\r\n        if (!(error instanceof DataPathError)) {\r\n          util.print_stack(error);\r\n          console.log(\"error in update_intern tasklet\");\r\n        }\r\n        return;\r\n      }\r\n\r\n      if (ret !== undefined && ret.done) {\r\n        this._update_gen = undefined;\r\n      }\r\n    } else {\r\n      this._update_gen = this.update_intern();\r\n    }\r\n  }\r\n\r\n  purgeUpdateStack() {\r\n    this._update_gen = undefined;\r\n    purgeUpdateStack();\r\n  }\r\n\r\n  completeSetCSS() {\r\n    let rec = (n) => {\r\n      n.setCSS();\r\n\r\n      if (n.packflag & PackFlags.NO_UPDATE) {\r\n        return;\r\n      }\r\n\r\n      n._forEachChildWidget((c) => {\r\n        rec(c);\r\n      })\r\n    }\r\n\r\n    rec(this);\r\n  }\r\n\r\n  completeUpdate() {\r\n    for (let step of this.update_intern()) {\r\n    }\r\n  }\r\n\r\n  updateScrollStyling() {\r\n    let s = theme.scrollbars;\r\n\r\n    if (!s || !s.color) return;\r\n\r\n    let key = \"\" + s.color + \":\" + s.color2 + \":\" + s.border + \":\" + s.contrast + \":\" + s.width;\r\n\r\n    if (key !== this._last_scrollstyle_key) {\r\n      this._last_scrollstyle_key = key;\r\n\r\n      //console.log(\"updating scrollbar styling\");\r\n\r\n      this.mergeGlobalCSS(styleScrollBars(s.color, s.color2, s.contrast, s.width, s.border, \"*\"));\r\n    }\r\n  }\r\n\r\n  //XXX race condition warning\r\n  update_intern() {\r\n    this.updateScrollStyling();\r\n\r\n    let popups = this._popups;\r\n\r\n    let cssText = \"\";\r\n    let sheet = this.globalCSS.sheet;\r\n    if (sheet) {\r\n      for (let rule of sheet.rules) {\r\n        cssText += rule.cssText + \"\\n\";\r\n      }\r\n\r\n      window.cssText = cssText\r\n    }\r\n    let cssTextHash = util.strhash(cssText);\r\n\r\n    if (this.needsBorderRegen) {\r\n      this.needsBorderRegen = false;\r\n      this.regenBorders();\r\n    }\r\n\r\n    super.update();\r\n    let this2 = this;\r\n\r\n    //ensure each area has proper ctx set\r\n    for (let sarea of this.sareas) {\r\n      sarea.ctx = this.ctx;\r\n    }\r\n\r\n    return (function* () {\r\n      let stack = update_stack;\r\n      stack.cur = 0;\r\n\r\n      let lastn = this2;\r\n\r\n      function push(n) {\r\n        stack[stack.cur++] = n;\r\n      }\r\n\r\n      function pop(n) {\r\n        if (stack.cur < 0) {\r\n          throw new Error(\"Screen.update(): stack overflow!\");\r\n        }\r\n\r\n        return stack[--stack.cur];\r\n      }\r\n\r\n      let ctx = this2.ctx;\r\n\r\n      let SCOPE_POP = Symbol(\"pop\");\r\n      let AREA_CTX_POP = Symbol(\"pop2\");\r\n\r\n      let scopestack = [];\r\n      let areastack = [];\r\n\r\n      let t = util.time_ms();\r\n      push(this2);\r\n\r\n      for (let p of popups) {\r\n        push(p);\r\n      }\r\n\r\n      while (stack.cur > 0) {\r\n        let n = pop();\r\n\r\n        if (n === undefined) {\r\n          //console.log(\"eek!\", stack.length);\r\n          continue;\r\n        } else if (n === SCOPE_POP) {\r\n          scopestack.pop();\r\n          continue;\r\n        } else if (n === AREA_CTX_POP) {\r\n          //console.log(\"POP\", areastack[areastack.length-1].constructor.name);\r\n          areastack.pop().pop_ctx_active(ctx, true);\r\n          continue;\r\n        }\r\n\r\n        if (n instanceof Area) {\r\n          //console.log(\"PUSH\", n.constructor.name);\r\n          areastack.push(n);\r\n          n.push_ctx_active(ctx, true);\r\n          push(AREA_CTX_POP);\r\n        }\r\n\r\n        if (!n.hidden && n !== this2 && n instanceof UIBase) {\r\n          if (!n._ctx) {\r\n            n._ctx = ctx;\r\n          }\r\n\r\n          if (n._screenStyleUpdateHash !== cssTextHash) {\r\n            n._screenStyleTag.textContent = cssText;\r\n            n._screenStyleUpdateHash = cssTextHash;\r\n          }\r\n\r\n          if (scopestack.length > 0 && scopestack[scopestack.length - 1]) {\r\n            n.parentWidget = scopestack[scopestack.length - 1];\r\n\r\n            //if (n.parentWidget && n._useDataPathUndo === undefined && n.parentWidget._useDataPathUndo !== undefined) {\r\n            //  n._useDataPathUndo = n.parentWidget._useDataPathUndo;\r\n            //}\r\n          }\r\n\r\n          n.update();\r\n        }\r\n\r\n        if (util.time_ms() - t > 20) {\r\n          yield;\r\n          t = util.time_ms();\r\n        }\r\n\r\n        for (let n2 of n.childNodes) {\r\n          if (!(n2 instanceof UIBase) || !(n2.packflag & PackFlags.NO_UPDATE)) {\r\n            push(n2);\r\n          }\r\n        }\r\n\r\n        if (n.shadow === undefined) {\r\n          continue;\r\n        }\r\n\r\n        for (let n2 of n.shadow.childNodes) {\r\n          if (!(n2 instanceof UIBase) || !(n2.packflag & PackFlags.NO_UPDATE)) {\r\n            push(n2);\r\n          }\r\n        }\r\n\r\n        if (n instanceof UIBase) {\r\n          if (!(n.packflag & PackFlags.NO_UPDATE)) {\r\n            scopestack.push(n);\r\n            push(SCOPE_POP);\r\n          }\r\n        }\r\n      }\r\n    })();\r\n  }\r\n\r\n  //load pos/size from screenverts\r\n  loadFromVerts() {\r\n    let old = [0, 0];\r\n    for (let sarea of this.sareas) {\r\n      old[0] = sarea.size[0];\r\n      old[1] = sarea.size[1];\r\n\r\n      sarea.loadFromVerts();\r\n      sarea.on_resize(old);\r\n      sarea.setCSS();\r\n    }\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  /** merges sarea into the screen area opposite to sarea*/\r\n  collapseArea(sarea, border) {\r\n    let sarea2;\r\n\r\n    if (!border) {\r\n      for (let b of sarea._borders) {\r\n        let sarea2 = b.getOtherSarea(sarea);\r\n\r\n        if (sarea2 && !b.locked) {\r\n          border = b;\r\n          break;\r\n        }\r\n      }\r\n    } else if (border.locked) {\r\n      console.warn(\"Cannot remove screen border\");\r\n    }\r\n\r\n    console.warn(\"SAREA2\", border, sarea2, sarea2 !== sarea);\r\n\r\n    if (border) {\r\n      sarea2 = border.getOtherSarea(sarea);\r\n\r\n      if (!sarea2) {\r\n        console.error(\"Error merging sarea\");\r\n        return;\r\n      }\r\n\r\n      let size1 = new Vector2(sarea.pos).add(sarea.size);\r\n      let size2 = new Vector2(sarea2.pos).add(sarea2.size);\r\n\r\n      sarea2.pos.min(sarea.pos);\r\n      sarea2.size.load(size1).max(size2).sub(sarea2.pos);\r\n\r\n      sarea2.loadFromPosSize();\r\n    }\r\n\r\n    this.sareas.remove(sarea);\r\n    sarea.remove();\r\n\r\n    this.regenScreenMesh();\r\n    this._internalRegenAll();\r\n\r\n    return this;\r\n  }\r\n\r\n  splitArea(sarea, t = 0.5, horiz = true) {\r\n    let w = sarea.size[0], h = sarea.size[1];\r\n    let x = sarea.pos[0], y = sarea.size[1];\r\n    let s1, s2;\r\n\r\n    if (!horiz) {\r\n      s1 = sarea;\r\n      if (s1.ctx === undefined) {\r\n        s1.ctx = this.ctx;\r\n      }\r\n      s2 = s1.copy(this);\r\n\r\n      s1.size[0] *= t;\r\n      s2.size[0] *= (1.0 - t);\r\n\r\n      s2.pos[0] += w*t;\r\n    } else {\r\n      s1 = sarea;\r\n      if (s1.ctx === undefined) {\r\n        s1.ctx = this.ctx;\r\n      }\r\n      s2 = s1.copy(this);\r\n\r\n      s1.size[1] *= t;\r\n      s2.size[1] *= (1.0 - t);\r\n\r\n      s2.pos[1] += h*t;\r\n    }\r\n\r\n    s2.ctx = this.ctx;\r\n    this.appendChild(s2);\r\n\r\n    s1.on_resize(s1.size);\r\n    s2.on_resize(s2.size);\r\n\r\n    this.regenBorders();\r\n    this.solveAreaConstraints();\r\n\r\n    s1.setCSS();\r\n    s2.setCSS();\r\n\r\n    this.setCSS();\r\n\r\n    //XXX not sure if this is right place to do this or really necassary\r\n    if (s2.area !== undefined)\r\n      s2.area.onadd();\r\n\r\n    return s2;\r\n  }\r\n\r\n  setCSS() {\r\n    if (!this.getBoolAttribute(\"inherit-scale\")) {\r\n      this.style[\"width\"] = this.size[0] + \"px\";\r\n      this.style[\"height\"] = this.size[1] + \"px\";\r\n    }\r\n\r\n    this.style[\"overflow\"] = \"hidden\";\r\n\r\n    //call setCSS on borders\r\n    for (let key in this._edgemap) {\r\n      let b = this._edgemap[key];\r\n\r\n      b.setCSS();\r\n    }\r\n  }\r\n\r\n  regenScreenMesh(snapLimit = SnapLimit) {\r\n    this.snapLimit = snapLimit;\r\n\r\n    this.regenBorders();\r\n  }\r\n\r\n  regenBorders_stage2() {\r\n    for (let b of this.screenborders) {\r\n      b.halfedges = []\r\n    }\r\n\r\n    function hashHalfEdge(border, sarea) {\r\n      return border._id + \":\" + sarea._id;\r\n    }\r\n\r\n    function has_he(border, border2, sarea) {\r\n      for (let he of border.halfedges) {\r\n        if (border2 === he.border && sarea === he.sarea) {\r\n          return true;\r\n        }\r\n      }\r\n\r\n      return false;\r\n    }\r\n\r\n    for (let b1 of this.screenborders) {\r\n      for (let sarea of b1.sareas) {\r\n        let he = new ScreenHalfEdge(b1, sarea);\r\n        b1.halfedges.push(he);\r\n      }\r\n\r\n      let axis = b1.horiz ? 1 : 0;\r\n\r\n      let min = Math.min(b1.v1[axis], b1.v2[axis]);\r\n      let max = Math.max(b1.v1[axis], b1.v2[axis]);\r\n\r\n      for (let b2 of this.walkBorderLine(b1)) {\r\n        if (b1 === b2) {\r\n          continue;\r\n        }\r\n\r\n        let ok = b2.v1[axis] >= min && b2.v1[axis] <= max;\r\n        ok = ok || (b2.v2[axis] >= min && b2.v2[axis] <= max);\r\n\r\n        for (let sarea of b2.sareas) {\r\n          let ok2 = ok && !has_he(b2, b1, sarea);\r\n          if (ok2) {\r\n            let he2 = new ScreenHalfEdge(b2, sarea);\r\n            b1.halfedges.push(he2);\r\n          }\r\n        }\r\n\r\n      }\r\n    }\r\n\r\n\r\n    for (let b of this.screenborders) {\r\n      let movable = true;\r\n\r\n      for (let sarea of b.sareas) {\r\n        movable = movable && this.isBorderMovable(b);\r\n      }\r\n\r\n      b.movable = movable;\r\n    }\r\n  }\r\n\r\n  hasBorder(b) {\r\n    return b._id in this._idmap;\r\n  }\r\n\r\n  killScreenVertex(v) {\r\n    this.screenverts.remove(v);\r\n\r\n    delete this._edgemap[ScreenVert.hash(v, undefined, this.snapLimit)];\r\n    delete this._idmap[v._id];\r\n\r\n    return this;\r\n  }\r\n\r\n  freeBorder(b, sarea) {\r\n    if (b.sareas.indexOf(sarea) >= 0) {\r\n      b.sareas.remove(sarea);\r\n    }\r\n\r\n    let dels = [];\r\n\r\n    for (let he of b.halfedges) {\r\n      if (he.sarea === sarea) {\r\n        dels.push([b, he]);\r\n      }\r\n\r\n      for (let he2 of he.border.halfedges) {\r\n        if (he2 === he)\r\n          continue;\r\n\r\n        if (he2.sarea === sarea) {\r\n          dels.push([he.border, he2]);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let d of dels) {\r\n      if (d[0].halfedges.indexOf(d[1]) < 0) {\r\n        console.warn(\"Double remove detected; use util.set?\");\r\n        continue;\r\n      }\r\n\r\n      d[0].halfedges.remove(d[1]);\r\n    }\r\n\r\n    if (b.sareas.length === 0) {\r\n      this.killBorder(b);\r\n    }\r\n  }\r\n\r\n  killBorder(b) {\r\n    console.log(\"killing border\", b._id, b);\r\n\r\n    if (this.screenborders.indexOf(b) < 0) {\r\n      console.log(\"unknown border\", b);\r\n      b.remove();\r\n      return;\r\n    }\r\n\r\n    this.screenborders.remove(b);\r\n\r\n    let del = [];\r\n\r\n    for (let he of b.halfedges) {\r\n      if (he === he2)\r\n        continue;\r\n\r\n      for (let he2 of he.border.halfedges) {\r\n        if (he2.border === b) {\r\n          del.push([he.border, he2]);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let d of del) {\r\n      d[0].halfedges.remove(d[1]);\r\n    }\r\n\r\n    delete this._edgemap[ScreenBorder.hash(b.v1, b.v2)];\r\n    delete this._idmap[b._id];\r\n\r\n    b.v1.borders.remove(b);\r\n    b.v2.borders.remove(b);\r\n\r\n    if (b.v1.borders.length === 0) {\r\n      this.killScreenVertex(b.v1);\r\n    }\r\n    if (b.v2.borders.length === 0) {\r\n      this.killScreenVertex(b.v2);\r\n    }\r\n\r\n    b.remove();\r\n\r\n    return this;\r\n  }\r\n\r\n  //XXX rename to regenScreenMesh\r\n  regenBorders() {\r\n\r\n    for (let b of this.screenborders) {\r\n      b.remove();\r\n      HTMLElement.prototype.remove.call(b);\r\n    }\r\n\r\n    this._idmap = {};\r\n    this.screenborders = [];\r\n    this._edgemap = {};\r\n    this._vertmap = {};\r\n    this.screenverts = []\r\n\r\n    for (let sarea of this.sareas) {\r\n      if (sarea.hidden) continue;\r\n\r\n      sarea.makeBorders(this);\r\n    }\r\n\r\n    for (let key in this._edgemap) {\r\n      let b = this._edgemap[key];\r\n\r\n      b.setCSS();\r\n    }\r\n\r\n    this.regenBorders_stage2();\r\n    this._recalcAABB();\r\n\r\n    for (let b of this.screenborders) {\r\n      b.outer = this.isBorderOuter(b);\r\n      b.movable = this.isBorderMovable(b);\r\n      b.setCSS();\r\n    }\r\n\r\n    this.updateDebugBoxes();\r\n  }\r\n\r\n  _get_debug_overlay() {\r\n    if (!this._debug_overlay) {\r\n      this._debug_overlay = UIBase.createElement(\"overdraw-x\");\r\n      let s = this._debug_overlay;\r\n\r\n      s.startNode(this, this);\r\n    }\r\n\r\n    return this._debug_overlay;\r\n  }\r\n\r\n  updateDebugBoxes() {\r\n    if (cconst.DEBUG.screenborders) {\r\n      let overlay = this._get_debug_overlay();\r\n      overlay.clear();\r\n\r\n      for (let b of this.screenborders) {\r\n        overlay.line(b.v1, b.v2, \"red\");\r\n      }\r\n      let del = [];\r\n      for (let child of document.body.childNodes) {\r\n        if (child.getAttribute && child.getAttribute(\"class\") === \"__debug\") {\r\n          del.push(child);\r\n        }\r\n      }\r\n      for (let n of del) {\r\n        n.remove();\r\n      }\r\n\r\n      let box = (x, y, s, text, color = \"red\") => {\r\n        x -= s*0.5;\r\n        y -= s*0.5;\r\n\r\n        x = Math.min(Math.max(x, 0.0), this.size[0] - s);\r\n        y = Math.min(Math.max(y, 0.0), this.size[1] - s);\r\n\r\n        let ret = UIBase.createElement(\"div\");\r\n        ret.setAttribute(\"class\", \"__debug\");\r\n\r\n\r\n        ret.style[\"position\"] = UIBase.PositionKey;\r\n        ret.style[\"left\"] = x + \"px\";\r\n        ret.style[\"top\"] = y + \"px\";\r\n        ret.style[\"height\"] = s + \"px\";\r\n        ret.style[\"width\"] = s + \"px\";//\"200px\";\r\n        ret.style[\"z-index\"] = \"1000\";\r\n        ret.style[\"pointer-events\"] = \"none\";\r\n        ret.style[\"padding\"] = ret.style[\"margin\"] = \"0px\";\r\n        ret.style['display'] = \"float\";\r\n        ret.style[\"background-color\"] = color;\r\n        document.body.appendChild(ret);\r\n\r\n        let colors = [\r\n          \"orange\",\r\n          \"black\",\r\n          \"white\",\r\n        ];\r\n\r\n        for (let i = 2; i >= 0; i--) {\r\n          ret = UIBase.createElement(\"div\");\r\n\r\n          ret.setAttribute(\"class\", \"__debug\");\r\n\r\n          ret.style[\"position\"] = UIBase.PositionKey;\r\n          ret.style[\"left\"] = x + \"px\";\r\n          ret.style[\"top\"] = y + \"px\";\r\n          ret.style[\"height\"] = s + \"px\";\r\n          ret.style[\"width\"] = \"250px\";//\"200px\";\r\n          ret.style[\"z-index\"] = \"\" + (1005 - i - 1);\r\n          ret.style[\"pointer-events\"] = \"none\";\r\n          ret.style[\"color\"] = colors[i];\r\n\r\n          let w = (i)*2;\r\n          ret.style[\"-webkit-text-stroke-width\"] = w + \"px\";\r\n          ret.style[\"-webkit-text-stroke-color\"] = colors[i];\r\n          ret.style[\"text-stroke-width\"] = w + \"px\";\r\n          ret.style[\"text-stroke-color\"] = colors[i];\r\n\r\n          ret.style[\"padding\"] = ret.style[\"margin\"] = \"0px\";\r\n          ret.style['display'] = \"float\";\r\n          ret.style[\"background-color\"] = \"rgba(0,0,0,0)\";\r\n          ret.innerText = \"\" + text;\r\n          document.body.appendChild(ret);\r\n        }\r\n\r\n      };\r\n\r\n      for (let v of this.screenverts) {\r\n        box(v[0], v[1], 10*v.borders.length, \"\" + v.borders.length, \"rgba(255,0,0,0.5)\");\r\n      }\r\n\r\n      for (let b of this.screenborders) {\r\n        for (let he of b.halfedges) {\r\n          let txt = `${he.side}, ${b.sareas.length}, ${b.halfedges.length}`;\r\n          let p = new Vector2(b.v1).add(b.v2).mulScalar(0.5);\r\n          let size = 10*b.halfedges.length;\r\n\r\n          let wadd = 25 + size*0.5;\r\n          let axis = b.horiz & 1;\r\n\r\n          if (p[axis] > he.sarea.pos[axis]) {\r\n            p[axis] -= wadd;\r\n          } else {\r\n            p[axis] += wadd;\r\n          }\r\n          box(p[0], p[1], size, txt, \"rgba(155,255,75,0.5)\")\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  checkAreaConstraint(sarea, checkOnly = false) {\r\n    let min = sarea.minSize, max = sarea.maxSize;\r\n    let vs = sarea._verts;\r\n    let chg = 0.0;\r\n    let mask = 0;\r\n\r\n    let moveBorder = (sidea, sideb, dh) => {\r\n      let b1 = sarea._borders[sidea];\r\n      let b2 = sarea._borders[sideb];\r\n      let bad = 0;\r\n\r\n      for (let i = 0; i < 2; i++) {\r\n        let b = i ? b2 : b1;\r\n        let bad2 = sarea.borderLock & (1<<sidea);\r\n\r\n        bad2 = bad2 || !b.movable;\r\n        bad2 = bad2 || this.isBorderOuter(b);\r\n\r\n        if (bad2)\r\n          bad |= 1<<i;\r\n      }\r\n\r\n      if (bad === 0) {\r\n        this.moveBorder(b1, dh*0.5);\r\n        this.moveBorder(b2, -dh*0.5);\r\n      } else if (bad === 1) {\r\n        this.moveBorder(b2, -dh);\r\n      } else if (bad === 2) {\r\n        this.moveBorder(b1, dh);\r\n      } else if (bad === 3) {\r\n        //both borders are bad, yet we need to move anyway. . .\r\n        //console.warn(\"got case of two borders being bad\");\r\n\r\n        if (!this.isBorderOuter(b1)) {\r\n          this.moveBorder(b1, dh);\r\n        } else if (!this.isBorderOuter(b2)) {\r\n          this.moveBorder(b2, -dh);\r\n        } else {\r\n          this.moveBorder(b1, dh*0.5);\r\n          this.moveBorder(b2, -dh*0.5);\r\n        }\r\n      }\r\n    };\r\n\r\n    if (max[0] !== undefined && sarea.size[0] > max[0]) {\r\n      let dh = (sarea.size[0] - max[0]);\r\n      chg += Math.abs(dh);\r\n      mask |= 1;\r\n\r\n      moveBorder(0, 2, dh);\r\n    }\r\n\r\n    if (min[0] !== undefined && sarea.size[0] < min[0]) {\r\n      let dh = (min[0] - sarea.size[0]);\r\n      chg += Math.abs(dh);\r\n      mask |= 2;\r\n\r\n      moveBorder(2, 0, dh);\r\n    }\r\n\r\n\r\n    if (max[1] !== undefined && sarea.size[1] > max[1]) {\r\n      let dh = (sarea.size[1] - max[1]);\r\n      chg += Math.abs(dh);\r\n      mask |= 4;\r\n\r\n      moveBorder(3, 1, dh);\r\n    }\r\n\r\n    if (min[1] !== undefined && sarea.size[1] < min[1]) {\r\n      let dh = (min[1] - sarea.size[1]);\r\n      chg += Math.abs(dh);\r\n      mask |= 8;\r\n\r\n      moveBorder(1, 3, dh);\r\n    }\r\n\r\n    if (sarea.pos[0] + sarea.size[0] > this.size[0]) {\r\n      mask |= 16;\r\n      let dh = ((this.size[0] - sarea.size[0]) - sarea.pos[0]);\r\n\r\n      chg += Math.abs(dh);\r\n\r\n      if (sarea.floating) {\r\n        sarea.pos[0] = this.size[0] - sarea.size[0];\r\n        sarea.loadFromPosSize();\r\n      } else {\r\n        this.moveBorder(sarea._borders[0], dh);\r\n        this.moveBorder(sarea._borders[2], dh);\r\n      }\r\n    }\r\n\r\n    if (chg === 0.0) {\r\n      return false;\r\n    }\r\n\r\n    return mask;\r\n  }\r\n\r\n  walkBorderLine(b) {\r\n    let visit = new util.set();\r\n    let ret = [b];\r\n    visit.add(b);\r\n\r\n    let rec = (b, v) => {\r\n      for (let b2 of v.borders) {\r\n        if (b2 === b) {\r\n          continue;\r\n        }\r\n\r\n        if (b2.horiz === b.horiz && !visit.has(b2)) {\r\n          visit.add(b2);\r\n          ret.push(b2);\r\n          rec(b2, b2.otherVertex(v));\r\n        }\r\n      }\r\n    }\r\n\r\n    rec(b, b.v1);\r\n    let ret2 = ret;\r\n    ret = [];\r\n\r\n    rec(b, b.v2);\r\n    ret2.reverse();\r\n\r\n    return ret2.concat(ret);\r\n  }\r\n\r\n  moveBorderWithoutVerts(halfedge, df) {\r\n    let side = halfedge.side;\r\n    let sarea = halfedge.sarea;\r\n\r\n    switch (side) {\r\n      case 0:\r\n        sarea.pos[0] += df;\r\n        sarea.size[0] -= df;\r\n        break;\r\n      case 1:\r\n        sarea.size[1] += df;\r\n        break;\r\n      case 2:\r\n        sarea.size[0] += df;\r\n        break;\r\n      case 3:\r\n        sarea.pos[1] += df;\r\n        sarea.size[1] -= df;\r\n        break;\r\n    }\r\n  }\r\n\r\n  moveBorder(b, df, strict = true) {\r\n    return this.moveBorderSimple(b, df, strict);\r\n  }\r\n\r\n  moveBorderSimple(b, df, strict = true) {\r\n    let axis = b.horiz & 1;\r\n    let axis2 = axis ^ 1;\r\n\r\n    let min = Math.min(b.v1[axis2], b.v2[axis2]);\r\n    let max = Math.max(b.v1[axis2], b.v2[axis2]);\r\n\r\n    let test = (v) => {\r\n      return v[axis2] >= min && v[axis2] <= max;\r\n    };\r\n\r\n    let vs = new util.set();\r\n\r\n    for (let b2 of this.walkBorderLine(b)) {\r\n      if (strict && !test(b2.v1) && !test(b2.v2)) {\r\n        return false;\r\n      }\r\n\r\n      vs.add(b2.v1);\r\n      vs.add(b2.v2);\r\n    }\r\n\r\n    for (let v of vs) {\r\n      v[axis] += df;\r\n    }\r\n\r\n    for (let v of vs) {\r\n      for (let b of v.borders) {\r\n        for (let sarea of b.sareas) {\r\n          sarea.loadFromVerts();\r\n        }\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  moveBorderUnused(b, df, strict = true) {\r\n    if (!b) {\r\n      console.warn(\"missing border\");\r\n      return false;\r\n    }\r\n\r\n    let axis = b.horiz & 1;\r\n\r\n    let vs = new util.set();\r\n\r\n    let visit = new util.set();\r\n\r\n    let axis2 = axis ^ 1;\r\n\r\n    let min = Math.min(b.v1[axis2], b.v2[axis2]);\r\n    let max = Math.max(b.v1[axis2], b.v2[axis2]);\r\n\r\n    let test = (v) => {\r\n      return v[axis2] >= min && v[axis2] <= max;\r\n    };\r\n\r\n    let first = true;\r\n    let found = false;\r\n    let halfedges = new util.set();\r\n    let borders = new util.set();\r\n\r\n    for (let b2 of this.walkBorderLine(b)) {\r\n      /*\r\n      if (first) {\r\n        first = false;\r\n        df = Math.max(Math.abs(df), FrameManager_mesh.SnapLimit) * Math.sign(df);\r\n      }\r\n      found = true;\r\n      for (let sarea of b2.sareas) {\r\n        halfedges.add(new ScreenHalfEdge(b2, sarea))\r\n      }\r\n      vs.add(b2.v1);\r\n      vs.add(b2.v2);\r\n      continue;\r\n      //*/\r\n\r\n      if (!strict) {\r\n        vs.add(b2.v1);\r\n        vs.add(b2.v2);\r\n        continue;\r\n      }\r\n\r\n\r\n      let t1 = test(b2.v1), t2 = test(b2.v2);\r\n\r\n      if (!t1 || !t2) {\r\n        found = true;\r\n\r\n        if (first) {\r\n          first = false;\r\n          df = Math.max(Math.abs(df), FrameManager_mesh.SnapLimit)*Math.sign(df);\r\n        }\r\n      }\r\n      if (!t1 && !t2) {\r\n        continue;\r\n      }\r\n\r\n      borders.add(b2);\r\n\r\n      //make dummy half edges to keep track of border/sarea pairs\r\n      //and especailly what the border side is\r\n      for (let sarea of b2.sareas) {\r\n        halfedges.add(new ScreenHalfEdge(b2, sarea))\r\n      }\r\n\r\n      vs.add(b2.v1);\r\n      vs.add(b2.v2);\r\n    }\r\n\r\n    for (let b2 of this.walkBorderLine(b)) {\r\n      if (borders.has(b2)) {\r\n        continue;\r\n      }\r\n\r\n      for (let he of b2.halfedges) {\r\n        borders.remove(he.border);\r\n        if (halfedges.has(he)) {\r\n          halfedges.remove(he);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let v of vs) {\r\n      let ok = v[axis2] >= min && v[axis2] <= max;\r\n\r\n      if (!ok && strict) {\r\n        //   return false;\r\n      }\r\n    }\r\n\r\n    if (!found || !strict) {\r\n      for (let v of vs) {\r\n        v[axis] += df;\r\n      }\r\n    } else {\r\n      let borders = new util.set();\r\n\r\n      for (let he of halfedges) {\r\n        borders.add(he.border);\r\n        this.moveBorderWithoutVerts(he, df);\r\n      }\r\n\r\n      for (let he of halfedges) {\r\n        he.sarea.loadFromPosSize();\r\n      }\r\n\r\n      for (let b of borders) {\r\n        let sareas = b.sareas.slice(0, b.sareas.length);\r\n\r\n        this.killBorder(b);\r\n        for (let sarea of sareas) {\r\n          sarea.loadFromPosSize();\r\n        }\r\n      }\r\n\r\n      return halfedges.length > 0;\r\n    }\r\n\r\n\r\n    for (let sarea of b.sareas) {\r\n      sarea.loadFromVerts();\r\n    }\r\n\r\n    for (let he of b.halfedges) {\r\n      he.sarea.loadFromVerts();\r\n\r\n      for (let sarea of he.border.sareas) {\r\n        sarea.loadFromVerts();\r\n        for (let b2 of sarea._borders) {\r\n          b2.setCSS();\r\n        }\r\n      }\r\n    }\r\n\r\n    b.setCSS();\r\n\r\n    return true;\r\n  }\r\n\r\n  solveAreaConstraints(snapArgument = true) {\r\n    let repeat = false;\r\n    let found = false;\r\n\r\n    let time = util.time_ms();\r\n\r\n    for (let i = 0; i < 10; i++) {\r\n      repeat = false;\r\n\r\n      for (let sarea of this.sareas) {\r\n        if (sarea.hidden) continue;\r\n\r\n        repeat = repeat || this.checkAreaConstraint(sarea);\r\n      }\r\n\r\n      found = found || repeat;\r\n\r\n      if (repeat) {\r\n        for (let sarea of this.sareas) {\r\n          sarea.loadFromVerts();\r\n        }\r\n\r\n        this.snapScreenVerts(snapArgument);\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (found) {\r\n      this.snapScreenVerts(snapArgument);\r\n      if (cconst.DEBUG.areaConstraintSolver) {\r\n        time = util.time_ms() - time;\r\n\r\n        console.log(`enforced area constraint ${time.toFixed(2)}ms`);\r\n      }\r\n      this._recalcAABB();\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  snapScreenVerts(fitToSize = true) {\r\n    let this2 = this;\r\n\r\n    function* screenverts() {\r\n      for (let v of this2.screenverts) {\r\n        let ok = 0;\r\n\r\n        for (let sarea of v.sareas) {\r\n          if (!(sarea.flag & AreaFlags.INDEPENDENT)) {\r\n            ok = 1;\r\n          }\r\n        }\r\n\r\n        if (ok) {\r\n          yield v;\r\n        }\r\n      }\r\n    }\r\n\r\n    let mm = new math.MinMax(2);\r\n    for (let v of screenverts()) {\r\n      mm.minmax(v);\r\n    }\r\n\r\n    let min = mm.min, max = mm.max;\r\n\r\n    //snap(min);\r\n    //snapi(max);\r\n\r\n    if (fitToSize) {\r\n      //fit entire screen to, well, the entire screen (size)\r\n      let vec = new Vector2(max).sub(min);\r\n      let sz = new Vector2(this.size);\r\n\r\n      sz.div(vec);\r\n\r\n      for (let v of screenverts()) {\r\n        v.sub(min).mul(sz);\r\n        //snap(v.sub(min).mul(sz));//.add(this.pos);\r\n      }\r\n\r\n      for (let v of screenverts()) {\r\n        v[0] += this.pos[0];\r\n        v[1] += this.pos[1];\r\n      }\r\n\r\n      //this.pos.zero();\r\n    } else {\r\n      for (let v of screenverts()) {\r\n        //snap(v);\r\n      }\r\n\r\n      [min, max] = this._recalcAABB();\r\n\r\n      //snap(min);\r\n      //snapi(max);\r\n\r\n      this.size.load(max).sub(min);\r\n      //this.pos.zero();\r\n      //this.pos.load(min);\r\n    }\r\n\r\n    let found = 1;\r\n\r\n    for (let sarea of this.sareas) {\r\n      if (sarea.hidden) continue;\r\n\r\n      let old = new Vector2(sarea.size);\r\n      let oldpos = new Vector2(sarea.pos);\r\n\r\n      sarea.loadFromVerts();\r\n\r\n      found = found || old.vectorDistance(sarea.size) > 1;\r\n      found = found || oldpos.vectorDistance(sarea.pos) > 1;\r\n\r\n      sarea.on_resize(old);\r\n    }\r\n\r\n    if (found) {\r\n      //this.regenBorders();\r\n      this._recalcAABB();\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  on_resize(oldsize, newsize = this.size, _set_key = true) {\r\n    //console.warn(\"resizing\");\r\n\r\n    if (_set_key) {\r\n      this._last_ckey1 = this._calcSizeKey(newsize[0], newsize[1], this.pos[0], this.pos[1], devicePixelRatio, visualViewport.scale);\r\n    }\r\n\r\n    let ratio = [newsize[0]/oldsize[0], newsize[1]/oldsize[1]];\r\n\r\n    let offx = this.pos[0] - this.oldpos[0];\r\n    let offy = this.pos[1] - this.oldpos[1];\r\n\r\n    this.oldpos.load(this.pos);\r\n\r\n    //console.log(\"resize!\", ratio);\r\n\r\n    for (let v of this.screenverts) {\r\n      v[0] *= ratio[0];\r\n      v[1] *= ratio[1];\r\n      v[0] += offx;\r\n      v[1] += offy;\r\n    }\r\n\r\n    let min = [1e17, 1e17], max = [-1e17, -1e17];\r\n    let olds = [];\r\n\r\n    for (let sarea of this.sareas) {\r\n      olds.push([sarea.size[0], sarea.size[1]]);\r\n\r\n      sarea.loadFromVerts();\r\n    }\r\n\r\n    this.size[0] = newsize[0];\r\n    this.size[1] = newsize[1];\r\n\r\n    this.snapScreenVerts();\r\n    this.solveAreaConstraints();\r\n    this._recalcAABB();\r\n\r\n\r\n    let i = 0;\r\n    for (let sarea of this.sareas) {\r\n      sarea.on_resize(sarea.size, olds[i]);\r\n      sarea.setCSS();\r\n      i++;\r\n    }\r\n\r\n    this.regenBorders();\r\n    this.setCSS();\r\n    this.calcTabOrder();\r\n\r\n    this._fireResizeCB(oldsize);\r\n  }\r\n\r\n  _fireResizeCB(oldsize = this.size) {\r\n    for (let cb of this._resize_callbacks) {\r\n      cb(oldsize);\r\n    }\r\n  }\r\n\r\n  getScreenVert(pos, added_id = \"\", floating = false) {\r\n    let key = ScreenVert.hash(pos, added_id, this.snapLimit);\r\n\r\n    if (floating || !(key in this._vertmap)) {\r\n      let v = new ScreenVert(pos, this.idgen++, added_id);\r\n\r\n      this._vertmap[key] = v;\r\n      this._idmap[v._id] = v;\r\n\r\n      this.screenverts.push(v);\r\n    }\r\n\r\n    return this._vertmap[key];\r\n  }\r\n\r\n  isBorderOuter(border) {\r\n    let sides = 0;\r\n\r\n    for (let he of border.halfedges) {\r\n      sides |= 1<<he.side;\r\n    }\r\n\r\n    let bits = 0;\r\n    for (let i = 0; i < 4; i++) {\r\n      bits += (sides & (1<<i)) ? 1 : 0;\r\n    }\r\n\r\n    let ret = bits < 2;\r\n    let floating = false;\r\n\r\n    for (let sarea of border.sareas) {\r\n      floating = floating || sarea.floating;\r\n    }\r\n\r\n    if (floating) {\r\n      //check if border is on screen limits\r\n      let axis = border.horiz ? 1 : 0;\r\n\r\n      ret = Math.abs(border.v1[axis] - this.pos[axis]) < 4;\r\n      ret = ret || Math.abs(border.v1[axis] - this.pos[axis] - this.size[axis]) < 4;\r\n    }\r\n\r\n    border.outer = ret;\r\n    return ret;\r\n  }\r\n\r\n  isBorderMovable(b, limit = 5) {\r\n    if (this.allBordersMovable)\r\n      return true;\r\n\r\n    for (let he of b.halfedges) {\r\n      if (he.sarea.borderLock & (1<<he.side)) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    let ok = !this.isBorderOuter(b);\r\n\r\n    for (let sarea of b.sareas) {\r\n      if (sarea.floating) {\r\n        ok = true;\r\n        break;\r\n      }\r\n    }\r\n\r\n    return ok;\r\n  }\r\n\r\n  getScreenBorder(sarea, v1, v2, side) {\r\n    let suffix = sarea._get_v_suffix();\r\n\r\n    if (!(v1 instanceof ScreenVert)) {\r\n      v1 = this.getScreenVert(v1, suffix);\r\n    }\r\n\r\n    if (!(v2 instanceof ScreenVert)) {\r\n      v2 = this.getScreenVert(v2, suffix);\r\n    }\r\n\r\n    let hash = ScreenBorder.hash(v1, v2);\r\n\r\n    if (!(hash in this._edgemap)) {\r\n      let sb = this._edgemap[hash] = UIBase.createElement(\"screenborder-x\");\r\n\r\n      sb._hash = hash;\r\n      sb.screen = this;\r\n      sb.v1 = v1;\r\n      sb.v2 = v2;\r\n      sb._id = this.idgen++;\r\n\r\n      v1.borders.push(sb);\r\n      v2.borders.push(sb);\r\n\r\n      sb.ctx = this.ctx;\r\n\r\n      this.screenborders.push(sb);\r\n      this.appendChild(sb);\r\n\r\n      sb.setCSS();\r\n\r\n      this._edgemap[hash] = sb;\r\n      this._idmap[sb._id] = sb;\r\n    }\r\n\r\n    return this._edgemap[hash];\r\n  }\r\n\r\n  minmaxArea(sarea, mm = undefined) {\r\n    if (mm === undefined) {\r\n      mm = new math.MinMax(2);\r\n    }\r\n\r\n    for (let b of sarea._borders) {\r\n      mm.minmax(b.v1);\r\n      mm.minmax(b.v2);\r\n    }\r\n\r\n    return mm;\r\n  }\r\n\r\n  //does sarea1 border sarea2?\r\n  areasBorder(sarea1, sarea2) {\r\n    for (let b of sarea1._borders) {\r\n      for (let sa of b.sareas) {\r\n        if (sa === sarea2)\r\n          return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  //regenerates borders, sets css and calls this.update\r\n\r\n  replaceArea(dst, src) {\r\n    if (dst === src)\r\n      return;\r\n\r\n    src.pos[0] = dst.pos[0];\r\n    src.pos[1] = dst.pos[1];\r\n    src.size[0] = dst.size[0];\r\n    src.size[1] = dst.size[1];\r\n\r\n    src.floating = dst.floating;\r\n    src._borders = dst._borders;\r\n    src._verts = dst._verts;\r\n\r\n    if (this.sareas.indexOf(src) < 0) {\r\n      this.sareas.push(src);\r\n      this.shadow.appendChild(src);\r\n    }\r\n\r\n    if (this.sareas.active === dst) {\r\n      this.sareas.active = src;\r\n    }\r\n\r\n    //this.sareas.remove(dst);\r\n    //dst.remove();\r\n\r\n    this.sareas.remove(dst);\r\n    dst.remove();\r\n\r\n    this.regenScreenMesh();\r\n    this.snapScreenVerts();\r\n    this._updateAll();\r\n  }\r\n\r\n  _internalRegenAll() {\r\n    this.snapScreenVerts();\r\n    this._recalcAABB();\r\n    this.calcTabOrder();\r\n    this.setCSS();\r\n\r\n    this.completeUpdate();\r\n    this.completeSetCSS();\r\n    this.completeUpdate();\r\n  }\r\n\r\n  _updateAll() {\r\n    for (let sarea of this.sareas) {\r\n      sarea.setCSS();\r\n    }\r\n    this.setCSS();\r\n    this.update();\r\n  }\r\n\r\n  removeArea(sarea) {\r\n    if (this.sareas.indexOf(sarea) < 0) {\r\n      console.warn(sarea, \"<- Warning: tried to remove unknown area\");\r\n      return;\r\n    }\r\n\r\n    this.sareas.remove(sarea);\r\n    sarea.remove();\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      this.snapScreenVerts();\r\n      this.regenScreenMesh();\r\n    }\r\n\r\n    this._updateAll();\r\n    this.drawUpdate();\r\n  }\r\n\r\n  appendChild(child) {\r\n    /*\r\n    if (child instanceof UIBase) {\r\n      if (child._useDataPathUndo === undefined) {\r\n        child.useDataPathUndo = this.useDataPathUndo;\r\n      }\r\n    }*/\r\n\r\n    if (child instanceof ScreenArea.ScreenArea) {\r\n      child.screen = this;\r\n      child.ctx = this.ctx;\r\n      child.parentWidget = this;\r\n\r\n      this.sareas.push(child);\r\n\r\n      if (child.size.dot(child.size) === 0) {\r\n        child.size[0] = this.size[0];\r\n        child.size[1] = this.size[1];\r\n      }\r\n\r\n      if (!child._has_evts) {\r\n        child._has_evts = true;\r\n\r\n        let onfocus = (e) => {\r\n          this.sareas.active = child;\r\n        }\r\n\r\n        let onblur = (e) => {\r\n          //XXX this is causing bugs\r\n\r\n          //if (this.sareas.active === child) {\r\n          //  this.sareas.active = undefined;\r\n          //}\r\n        }\r\n\r\n        child.addEventListener(\"focus\", onfocus);\r\n        child.addEventListener(\"mouseenter\", onfocus);\r\n        child.addEventListener(\"blur\", onblur);\r\n        child.addEventListener(\"mouseleave\", onblur);\r\n      }\r\n\r\n      this.regenBorders();\r\n      child.setCSS();\r\n      this.drawUpdate();\r\n      child._init();\r\n    }\r\n\r\n    return this.shadow.appendChild(child);\r\n    //return super.appendChild(child);\r\n  }\r\n\r\n  add(child) {\r\n    return this.appendChild(child);\r\n  }\r\n\r\n  hintPickerTool() {\r\n    (new FrameManager_ops.ToolTipViewer(this)).start();\r\n  }\r\n\r\n  removeAreaTool(border) {\r\n    let tool = new FrameManager_ops.RemoveAreaTool(this, border);\r\n    //let tool = new FrameManager_ops.AreaDragTool(this, undefined, this.mpos);\r\n    tool.start();\r\n  }\r\n\r\n  moveAttachTool(sarea, mpos = this.mpos, elem, pointerId) {\r\n    let tool = new FrameManager_ops.AreaMoveAttachTool(this, sarea, mpos);\r\n    tool.start(elem, pointerId);\r\n  }\r\n\r\n  splitTool() {\r\n    let tool = new FrameManager_ops.SplitTool(this);\r\n    //let tool = new FrameManager_ops.AreaDragTool(this, undefined, this.mpos);\r\n    tool.start();\r\n  }\r\n\r\n  areaDragTool(sarea = this.sareas.active) {\r\n    if (sarea === undefined) {\r\n      console.warn(\"no active screen area\");\r\n      return;\r\n    }\r\n\r\n    let mpos = this.mpos;\r\n    let tool = new FrameManager_ops.AreaDragTool(this, this.sareas.active, mpos);\r\n\r\n    tool.start();\r\n  }\r\n\r\n  makeBorders() {\r\n    for (let sarea of this.sareas) {\r\n      sarea.makeBorders(this);\r\n    }\r\n  }\r\n\r\n  cleanupBorders() {\r\n    let del = new Set();\r\n\r\n    for (let b of this.screenborders) {\r\n      if (b.halfedges.length === 0) {\r\n        del.add(b);\r\n      }\r\n    }\r\n\r\n    for (let b of del) {\r\n      delete this._edgemap[b._hash];\r\n      HTMLElement.prototype.remove.call(b);\r\n    }\r\n  }\r\n\r\n  mergeBlankAreas() {\r\n    for (let b of this.screenborders) {\r\n      if (b.locked) {\r\n        continue;\r\n      }\r\n\r\n      let blank, sarea;\r\n\r\n      for (let he of b.halfedges) {\r\n        if (!he.sarea.area) {\r\n          blank = he.sarea;\r\n          sarea = b.getOtherSarea(blank);\r\n\r\n          let axis = b.horiz ^ 1;\r\n\r\n          if (blank && sarea && blank.size[axis] !== sarea.size[axis]) {\r\n            blank = sarea = undefined;\r\n          }\r\n\r\n          if (blank && sarea) {\r\n            break;\r\n          } else {\r\n            blank = undefined;\r\n            sarea = undefined;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (blank && sarea && blank !== sarea) {\r\n        this.collapseArea(blank, b);\r\n      }\r\n    }\r\n\r\n    this.cleanupBorders();\r\n  }\r\n\r\n  floatArea(area) {\r\n    let sarea = area.parentWidget;\r\n\r\n    /* already floating? */\r\n    if (sarea.floating) {\r\n      return sarea;\r\n    }\r\n\r\n    sarea.editors.remove(area);\r\n    delete sarea.editormap[area.constructor.define().areaname];\r\n    sarea.area = undefined;\r\n\r\n    HTMLElement.prototype.remove.call(area);\r\n\r\n    let sarea2 = UIBase.createElement(\"screenarea-x\", true);\r\n    sarea2.floating = true;\r\n\r\n    sarea2.pos = new Vector2(sarea.pos);\r\n    sarea2.pos.addScalar(5);\r\n\r\n    sarea2.size = new Vector2(sarea.size);\r\n\r\n    sarea2.editors.push(area);\r\n    sarea2.editormap[area.constructor.define().areaname] = area;\r\n\r\n    sarea2.shadow.appendChild(area);\r\n    sarea2.area = area;\r\n\r\n    area.push_ctx_active();\r\n    area.pop_ctx_active();\r\n\r\n    area.pos = sarea2.pos;\r\n    area.size = sarea2.size;\r\n    area.parentWidget = sarea2;\r\n    area.owning_sarea = sarea2;\r\n\r\n    sarea.flushSetCSS();\r\n    sarea.flushUpdate();\r\n\r\n    sarea2.flushSetCSS();\r\n    sarea2.flushUpdate();\r\n\r\n    this.appendChild(sarea2);\r\n\r\n    if (sarea.editors.length > 0) {\r\n      let area2 = sarea.editors[0];\r\n      sarea.switch_editor(area2.constructor);\r\n\r\n      sarea.flushSetCSS();\r\n      sarea.flushUpdate();\r\n    }\r\n\r\n    sarea2.loadFromPosSize();\r\n    sarea2.bringToFront();\r\n\r\n    this.mergeBlankAreas();\r\n    this.cleanupBorders();\r\n\r\n    return sarea2;\r\n  }\r\n\r\n  on_keydown(e) {\r\n    if (checkForTextBox(this, this.mpos[0], this.mpos[1])) {\r\n      console.log(\"textbox detected\");\r\n      return;\r\n    }\r\n\r\n    if (!haveModal() && this.execKeyMap(e)) {\r\n      e.preventDefault();\r\n      return;\r\n    }\r\n\r\n    if (!haveModal() && this.sareas.active !== undefined && this.sareas.active.on_keydown) {\r\n      let area = this.sareas.active;\r\n      return this.sareas.active.on_keydown(e);\r\n    }\r\n  }\r\n\r\n  on_keyup(e) {\r\n    if (!haveModal() && this.sareas.active !== undefined && this.sareas.active.on_keyup) {\r\n      return this.sareas.active.on_keyup(e);\r\n    }\r\n  }\r\n\r\n  on_keypress(e) {\r\n    if (!haveModal() && this.sareas.active !== undefined && this.sareas.active.on_keypress) {\r\n      return this.sareas.active.on_keypress(e);\r\n    }\r\n  }\r\n\r\n  draw() {\r\n    for (let sarea of this.sareas) {\r\n      sarea.draw();\r\n    }\r\n  }\r\n\r\n  afterSTRUCT() {\r\n    for (let sarea of this.sareas) {\r\n      sarea._ctx = this.ctx;\r\n      sarea.afterSTRUCT();\r\n    }\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    this.clear();\r\n\r\n    reader(this);\r\n\r\n    //handle old files that might have saved as simple arrays\r\n    this.size = new Vector2(this.size);\r\n\r\n    let sareas = this.sareas;\r\n    this.sareas = [];\r\n\r\n    /*\r\n    let push = this.sareas.push;\r\n\r\n    this.sareas.push = function(item) {\r\n      console.error(\"this.sareas.push\", item);\r\n      push.call(this, item);\r\n    }\r\n    */\r\n\r\n    for (let sarea of sareas) {\r\n      sarea.screen = this;\r\n      sarea.parentWidget = this;\r\n\r\n      this.appendChild(sarea);\r\n    }\r\n\r\n    this.regenBorders();\r\n    this.setCSS();\r\n\r\n    this.doOnce(() => {\r\n      this.loadUIData(this.uidata);\r\n      this.uidata = undefined;\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  test_struct(appstate = _appstate) {\r\n    let data = [];\r\n    //let scripts = nstructjs.write_scripts();\r\n    nstructjs.manager.write_object(data, this);\r\n    data = new DataView(new Uint8Array(data).buffer);\r\n\r\n    let screen2 = nstructjs.manager.read_object(data, this.constructor);\r\n    screen2.ctx = this.ctx;\r\n\r\n    for (let sarea of screen2.sareas) {\r\n      sarea.screen = screen2;\r\n      sarea.ctx = this.ctx;\r\n      sarea.area.ctx = this.ctx;\r\n    }\r\n\r\n    let parent = this.parentElement;\r\n    this.remove();\r\n\r\n    appstate.screen = screen2;\r\n\r\n    parent.appendChild(screen2);\r\n\r\n    //for (let \r\n    screen2.regenBorders();\r\n    screen2.update();\r\n    screen2.listen();\r\n\r\n    screen2.doOnce(() => {\r\n      screen2.on_resize(screen2.size, [window.innerWidth, window.innerHeight]);\r\n    });\r\n\r\n    console.log(data)\r\n    return screen2;\r\n  }\r\n\r\n  saveUIData() {\r\n    try {\r\n      return ui_base.saveUIData(this, \"screen\");\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n      console.log(\"Failed to save UI state data\");\r\n    }\r\n  }\r\n\r\n  loadUIData(str) {\r\n    try {\r\n      ui_base.loadUIData(this, str);\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n      console.log(\"Failed to load UI state data\");\r\n    }\r\n  }\r\n}\r\n\r\nScreen.STRUCT = `\r\npathux.Screen { \r\n  size  : vec2;\r\n  pos   : vec2;\r\n  sareas : array(pathux.ScreenArea);\r\n  idgen : int;\r\n  uidata : string | obj.saveUIData();\r\n}\r\n`;\r\n\r\nnstructjs.register(Screen);\r\nui_base.UIBase.internalRegister(Screen);\r\n\r\nScreenArea.setScreenClass(Screen);\r\n_setScreenClass(Screen);\r\n\r\nlet get_screen_cb;\r\nlet _on_keydown;\r\n\r\nlet start_cbs = [];\r\nlet stop_cbs = [];\r\nlet keyboardDom = window;\r\n\r\nlet key_event_opts = undefined;\r\n\r\nexport function startEvents(getScreenFunc) {\r\n  get_screen_cb = getScreenFunc;\r\n\r\n  if (_events_started) {\r\n    return;\r\n  }\r\n\r\n  _events_started = true;\r\n\r\n  _on_keydown = (e) => {\r\n    let screen = get_screen_cb();\r\n\r\n    return screen.on_keydown(e);\r\n  };\r\n\r\n  window.addEventListener(\"keydown\", _on_keydown, key_event_opts);\r\n\r\n  for (let cb of start_cbs) {\r\n    cb();\r\n  }\r\n}\r\n\r\nexport function stopEvents() {\r\n  window.removeEventListener(\"keydown\", _on_keydown, key_event_opts);\r\n  _on_keydown = undefined;\r\n  _events_started = false;\r\n\r\n  for (let cb of stop_cbs) {\r\n    try {\r\n      cb();\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n    }\r\n  }\r\n\r\n  return get_screen_cb;\r\n}\r\n\r\nexport function setKeyboardDom(dom) {\r\n  let started = _events_started;\r\n  if (started) {\r\n    stopEvents();\r\n  }\r\n\r\n  keyboardDom = dom;\r\n\r\n  if (started) {\r\n    startEvents(get_screen_cb);\r\n  }\r\n}\r\n\r\n/** Sets options passed to addEventListener() for on_keydown hotkey handler */\r\nexport function setKeyboardOpts(opts) {\r\n  key_event_opts = opts;\r\n}\r\n\r\nexport function _onEventsStart(cb) {\r\n  start_cbs.push(cb);\r\n}\r\n\r\nexport function _onEventsStop(cb) {\r\n  stop_cbs.push(cb);\r\n}\r\n\r\n/*\r\ndocument.addEventListener(\"touchstart\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"touchmove\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"scroll\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"resize\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"pointerdown\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"pointerstart\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"pointermove\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\n*/\r\n","import {AreaFlags} from \"../screen/ScreenArea.js\";\r\nimport {keymap} from \"../path-controller/util/simple_events.js\";\r\n\r\nexport function makePopupArea(area_class, screen, args={}) {\r\n  let sarea = UIBase.createElement(\"screenarea-x\");\r\n\r\n  let width = args.width || (screen.size[0]*0.7);\r\n  let height = args.height || (screen.size[1]*0.7);\r\n  let addEscapeKeyHandler = args.addEscapeKeyHandler !== undefined ? args.addEscapeKeyHandler : true;\r\n\r\n  sarea.ctx = screen.ctx;\r\n  sarea.size[0] = width;\r\n  sarea.size[1] = height;\r\n  sarea.pos[0] = 100;\r\n  sarea.pos[1] = 100;\r\n\r\n  sarea.pos[0] = Math.min(sarea.pos[0], screen.size[0] - sarea.size[0] - 2);\r\n  sarea.pos[1] = Math.min(sarea.pos[1], screen.size[1] - sarea.size[1] - 2);\r\n\r\n  sarea.switch_editor(area_class);\r\n\r\n  sarea.overrideClass(\"popup\");\r\n  sarea.style[\"background-color\"] = sarea.getDefault(\"background-color\");\r\n  sarea.style[\"border-radius\"] = sarea.getDefault(\"border-radius\") + \"px\";\r\n  sarea.style[\"border-color\"] = sarea.getDefault(\"border-color\");\r\n  sarea.style[\"border-style\"] = sarea.getDefault(\"border-style\");\r\n  sarea.style[\"border-width\"] = sarea.getDefault(\"border-width\") + \"px\";\r\n\r\n  sarea.flag |= AreaFlags.FLOATING | AreaFlags.INDEPENDENT;\r\n\r\n  screen.appendChild(sarea);\r\n  sarea.setCSS();\r\n\r\n  if (addEscapeKeyHandler) {\r\n    sarea.on_keydown = (e) => {\r\n      if (e.keyCode === keymap.Escape) {\r\n        screen.removeArea(sarea);\r\n      }\r\n    }\r\n  }\r\n\r\n  sarea.bringToFront();\r\n\r\n  return sarea;\r\n}","import {Area, contextWrangler} from '../screen/ScreenArea.js';\r\nimport {nstructjs} from '../path-controller/controller.js';\r\nimport {UIBase} from '../core/ui_base.js';\r\nimport {Container} from '../core/ui.js';\r\nimport {parsepx} from '../core/ui_base.js';\r\nimport {Icons} from '../core/ui_base.js';\r\nimport * as util from '../util/util.js';\r\n\r\nlet sidebar_hash = new util.HashDigest();\r\n\r\nexport class SideBar extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.header = this.row();\r\n    this.header.style[\"height\"] = \"45px\";\r\n\r\n    this._last_resize_key = undefined;\r\n\r\n    this._closed = false;\r\n\r\n    this.closeIcon = this.header.iconbutton(Icons.RIGHT_ARROW, \"Close/Open sidebar\", () => {\r\n      console.log(\"click!\");\r\n      this.closed = !this._closed;\r\n    });\r\n\r\n    this._openWidth = undefined;\r\n    this.needsSetCSS = true;\r\n    this.tabbar = this.tabs(\"left\");\r\n    //this.tabbar.style[\"flex-grow\"] = \"8\";\r\n  }\r\n\r\n  saveData() {\r\n    return {\r\n      closed : this.closed\r\n    }\r\n  }\r\n\r\n  loadData(obj) {\r\n    this.closed = obj.closed;\r\n  }\r\n\r\n  set closed(val) {\r\n    if (!!this._closed === !!val) {\r\n      return;\r\n    }\r\n\r\n    if (this._openWidth === undefined && !this._closed && val) {\r\n      this._openWidth = this.width;\r\n    }\r\n\r\n    console.log(\"animate!\");\r\n    let w = val ? 50 : this._openWidth;\r\n    this.animate().goto(\"width\", w, 500);\r\n\r\n\r\n    if (val) {\r\n      this.closeIcon.icon = Icons.LEFT_ARROW;\r\n    } else {\r\n      this.closeIcon.icon = Icons.RIGHT_ARROW;\r\n    }\r\n\r\n    this._closed = val;\r\n  }\r\n\r\n  get closed() {\r\n    return this._closed;\r\n  }\r\n\r\n  get width() {\r\n    return parsepx(\"\" + this.getAttribute(\"width\"));\r\n  }\r\n\r\n  set width(val) {\r\n    this.setAttribute(\"width\", \"\" + val + \"px\");\r\n    this.update();\r\n  }\r\n\r\n  get height() {\r\n    return parsepx(\"\" + this.getAttribute(\"height\"));\r\n  }\r\n\r\n  set height(val) {\r\n    this.setAttribute(\"height\", \"\" + val + \"px\");\r\n    this.update();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"sidebar-base-x\",\r\n      style  : \"sidebar\"\r\n    }\r\n  }\r\n\r\n  tab(name) {\r\n    return this.tabbar.tab(name);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    let closed = this._closed;\r\n    this._closed = false;\r\n\r\n    if (!this.getAttribute(\"width\")) {\r\n      this.width = 300;\r\n    }\r\n    if (!this.getAttribute(\"height\")) {\r\n      this.height = 700;\r\n    }\r\n\r\n    this.setCSS();\r\n\r\n    if (closed) {\r\n      this.closed = true;\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    if (!this.parentWidget) {\r\n      return;\r\n    }\r\n\r\n    let editor = this.parentWidget;\r\n\r\n    //happens when editors are inactive\r\n    if (!editor.pos || !editor.size) {\r\n      return;\r\n    }\r\n\r\n    this.needsSetCSS = false;\r\n\r\n    let w = this.width, h = this.height;\r\n\r\n    w = isNaN(w) ? 500 : w;\r\n    h = isNaN(h) ? 500 : h;\r\n\r\n    h = Math.min(h, editor.size[1]-25);\r\n\r\n    this.style[\"position\"] = UIBase.PositionKey;\r\n    this.style[\"width\"] = w + \"px\";\r\n    this.style[\"height\"] = h + \"px\";\r\n    this.style[\"z-index\"] = \"100\";\r\n    this.style[\"overflow\"] = \"scroll\";\r\n\r\n    this.style[\"background-color\"] = this.getDefault(\"AreaHeaderBG\");\r\n\r\n    this.tabbar.style[\"height\"] = (h - 45) + \"px\";\r\n    this.style[\"left\"] = (editor.pos[0] + editor.size[0] - w) + \"px\";\r\n  }\r\n\r\n  update() {\r\n    sidebar_hash.reset();\r\n    sidebar_hash.add(this.width);\r\n    sidebar_hash.add(this.height);\r\n\r\n    let key = sidebar_hash.get();\r\n    if (key !== this._last_resize_key) {\r\n      this._last_resize_key = key;\r\n      this.needsSetCSS = true;\r\n    }\r\n\r\n    if (this.needsSetCSS) {\r\n      this.setCSS();\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.register(SideBar);\r\n\r\nexport class Editor extends Area {\r\n  constructor() {\r\n    super();\r\n\r\n    this.container = UIBase.createElement(\"container-x\");\r\n    this.container.parentWidget = this;\r\n    this.shadow.appendChild(this.container);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      areaname: \"areaname\",\r\n      tagname : \"tagname-x\"\r\n    }\r\n  }\r\n\r\n  static defineAPI(api, strct) {\r\n    return strct;\r\n  }\r\n\r\n  /** \\param makeMenuBar function(ctx, container, menuBarEditor)\r\n   *\r\n   * example:\r\n   *\r\n   * function makeMenuBar(ctx, container, menuBarEditor) {\r\n   *\r\n   *  container.menu(\"File\", [\r\n   *    \"app.new()\",\r\n   *    simple.Menu.SEP,\r\n   *    \"app.save()\",\r\n   *    \"app.save(forceDialog=true)|Save As\",\r\n   *    \"app.open\"\r\n   *  ]);\r\n   * }\r\n   * */\r\n  static registerAppMenu(makeMenuBar) {\r\n    if (this !== Editor) {\r\n      throw new Error(\"must call registerAppMenu from simple.Editor base class\");\r\n    }\r\n\r\n    this.makeMenuBar = makeMenuBar;\r\n  }\r\n\r\n  static register(cls) {\r\n    if (!cls.hasOwnProperty(\"define\")) {\r\n      throw new Error(\"missing define() method\");\r\n    }\r\n\r\n    if (!cls.hasOwnProperty(\"STRUCT\")) {\r\n      cls.STRUCT = nstructjs.inherit(cls, this) + `\\n}`;\r\n    }\r\n\r\n    super.register(cls);\r\n    nstructjs.register(cls);\r\n  }\r\n\r\n  makeSideBar() {\r\n    if (this.sidebar) {\r\n      this.sidebar.remove();\r\n    }\r\n\r\n    let sidebar = this.sidebar = UIBase.createElement(\"sidebar-base-x\");\r\n    sidebar.parentWidget = this;\r\n    sidebar.ctx = this.ctx;\r\n    this.shadow.appendChild(sidebar);\r\n\r\n    if (this.ctx) {\r\n      sidebar._init();\r\n\r\n      this.sidebar.flushSetCSS();\r\n      this.sidebar.flushUpdate();\r\n    }\r\n\r\n\r\n    return this.sidebar;\r\n  }\r\n\r\n  on_resize(size, oldsize) {\r\n    super.on_resize(size, oldsize);\r\n\r\n    if (this.sidebar) {\r\n      if (this.ctx && this.pos) {\r\n        this.sidebar.setCSS();\r\n      } else {\r\n        this.sidebar.needsSetCSS = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  static findEditor(cls) {\r\n    return contextWrangler.getLastArea(cls);\r\n  }\r\n  \r\n  getScreen() {\r\n    return this.ctx.screen;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.makeHeader(this.container);\r\n  }\r\n\r\n  /** creates default header and puts it in this.header */\r\n  makeHeader(container, add_note_area = true, make_draggable = true) {\r\n    return super.makeHeader(container, add_note_area, make_draggable);\r\n  }\r\n\r\n  /** called regularly */\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  /** */\r\n  setCSS() {\r\n    super.setCSS();\r\n  }\r\n}\r\n\r\n","let text = `<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\r\n<svg\r\n   xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\r\n   xmlns:cc=\"http://creativecommons.org/ns#\"\r\n   xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"\r\n   xmlns:svg=\"http://www.w3.org/2000/svg\"\r\n   xmlns=\"http://www.w3.org/2000/svg\"\r\n   xmlns:xlink=\"http://www.w3.org/1999/xlink\"\r\n   xmlns:sodipodi=\"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\"\r\n   xmlns:inkscape=\"http://www.inkscape.org/namespaces/inkscape\"\r\n   width=\"512\"\r\n   height=\"512\"\r\n   id=\"svg16099\"\r\n   version=\"1.1\"\r\n   inkscape:version=\"1.0 (4035a4fb49, 2020-05-01)\"\r\n   sodipodi:docname=\"iconsheet.svg\"\r\n   inkscape:export-filename=\"C:\\dev\\allshape\\src\\datafiles\\iconsheet16.png\"\r\n   inkscape:export-xdpi=\"45\"\r\n   inkscape:export-ydpi=\"45\">\r\n  <defs\r\n     id=\"defs16101\">\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1587\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1307\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1303\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1299\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1295\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1291\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1231\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1186\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1182\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4974\"\r\n       is_visible=\"true\" />\r\n    <linearGradient\r\n       id=\"linearGradient5481\">\r\n      <stop\r\n         id=\"stop4865\"\r\n         offset=\"0\"\r\n         style=\"stop-color:#e66700;stop-opacity:1;\" />\r\n      <stop\r\n         style=\"stop-color:#f47712;stop-opacity:1;\"\r\n         offset=\"0.52777779\"\r\n         id=\"stop4867\" />\r\n      <stop\r\n         id=\"stop4869\"\r\n         offset=\"1\"\r\n         style=\"stop-color:#f8bb8a;stop-opacity:1;\" />\r\n    </linearGradient>\r\n    <linearGradient\r\n       id=\"linearGradient17116-6\">\r\n      <stop\r\n         id=\"stop4860\"\r\n         offset=\"0\"\r\n         style=\"stop-color:#b3a500;stop-opacity:1;\" />\r\n      <stop\r\n         id=\"stop4862\"\r\n         offset=\"1\"\r\n         style=\"stop-color:#eaa500;stop-opacity:1;\" />\r\n    </linearGradient>\r\n    <linearGradient\r\n       id=\"linearGradient17116\">\r\n      <stop\r\n         id=\"stop4853\"\r\n         offset=\"0\"\r\n         style=\"stop-color:#b3a500;stop-opacity:1;\" />\r\n      <stop\r\n         id=\"stop4855\"\r\n         offset=\"1\"\r\n         style=\"stop-color:#eaa500;stop-opacity:1;\" />\r\n    </linearGradient>\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4290\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4286\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4122\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4118\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4194\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect3225\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect5012\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect5008\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4108\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect3264\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect5465\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4613\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4609\"\r\n       is_visible=\"true\" />\r\n    <linearGradient\r\n       id=\"linearGradient5609\">\r\n      <stop\r\n         id=\"stop5611\"\r\n         offset=\"0\"\r\n         style=\"stop-color:#0089e6;stop-opacity:1;\" />\r\n      <stop\r\n         style=\"stop-color:#1280f4;stop-opacity:1;\"\r\n         offset=\"0.52777779\"\r\n         id=\"stop5613\" />\r\n      <stop\r\n         id=\"stop5615\"\r\n         offset=\"1\"\r\n         style=\"stop-color:#d4eefc;stop-opacity:1;\" />\r\n    </linearGradient>\r\n    <linearGradient\r\n       id=\"linearGradient5481-8\">\r\n      <stop\r\n         style=\"stop-color:#ffc700;stop-opacity:1\"\r\n         offset=\"0\"\r\n         id=\"stop5483\" />\r\n      <stop\r\n         id=\"stop5491\"\r\n         offset=\"0.52777779\"\r\n         style=\"stop-color:#ffc700;stop-opacity:1\" />\r\n      <stop\r\n         style=\"stop-color:#ffa41c;stop-opacity:1\"\r\n         offset=\"1\"\r\n         id=\"stop5485\" />\r\n    </linearGradient>\r\n    <inkscape:perspective\r\n       sodipodi:type=\"inkscape:persp3d\"\r\n       inkscape:vp_x=\"-108.10967 : 516.24314 : 1\"\r\n       inkscape:vp_y=\"0 : 323.31882 : 0\"\r\n       inkscape:vp_z=\"57.429562 : 516.24314 : 1\"\r\n       inkscape:persp3d-origin=\"-25.340056 : 488.65327 : 1\"\r\n       id=\"perspective18342\" />\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0.0\"\r\n       refX=\"0.0\"\r\n       id=\"Arrow2Send\"\r\n       style=\"overflow:visible;\">\r\n      <path\r\n         id=\"path17173\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.62500000;stroke-linejoin:round;\"\r\n         d=\"M 8.7185878,4.0337352 L -2.2072895,0.016013256 L 8.7185884,-4.0017078 C 6.9730900,-1.6296469 6.9831476,1.6157441 8.7185878,4.0337352 z \"\r\n         transform=\"scale(0.3) rotate(180) translate(-2.3,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Mend\"\r\n       orient=\"auto\"\r\n       refY=\"0.0\"\r\n       refX=\"0.0\"\r\n       id=\"Arrow2Mend\"\r\n       style=\"overflow:visible;\">\r\n      <path\r\n         id=\"path17167\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.62500000;stroke-linejoin:round;\"\r\n         d=\"M 8.7185878,4.0337352 L -2.2072895,0.016013256 L 8.7185884,-4.0017078 C 6.9730900,-1.6296469 6.9831476,1.6157441 8.7185878,4.0337352 z \"\r\n         transform=\"scale(0.6) rotate(180) translate(0,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow1Send\"\r\n       orient=\"auto\"\r\n       refY=\"0.0\"\r\n       refX=\"0.0\"\r\n       id=\"Arrow1Send\"\r\n       style=\"overflow:visible;\">\r\n      <path\r\n         id=\"path17155\"\r\n         d=\"M 0.0,0.0 L 5.0,-5.0 L -12.5,0.0 L 5.0,5.0 L 0.0,0.0 z \"\r\n         style=\"fill-rule:evenodd;stroke:#000000;stroke-width:1.0pt;\"\r\n         transform=\"scale(0.2) rotate(180) translate(6,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Lend\"\r\n       orient=\"auto\"\r\n       refY=\"0.0\"\r\n       refX=\"0.0\"\r\n       id=\"Arrow2Lend\"\r\n       style=\"overflow:visible;\">\r\n      <path\r\n         id=\"path17161\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.62500000;stroke-linejoin:round;\"\r\n         d=\"M 8.7185878,4.0337352 L -2.2072895,0.016013256 L 8.7185884,-4.0017078 C 6.9730900,-1.6296469 6.9831476,1.6157441 8.7185878,4.0337352 z \"\r\n         transform=\"scale(1.1) rotate(180) translate(1,0)\" />\r\n    </marker>\r\n    <linearGradient\r\n       id=\"linearGradient17126\">\r\n      <stop\r\n         style=\"stop-color:#008080;stop-opacity:1;\"\r\n         offset=\"0\"\r\n         id=\"stop17128\" />\r\n      <stop\r\n         style=\"stop-color:#00b3b3;stop-opacity:1;\"\r\n         offset=\"1\"\r\n         id=\"stop17130\" />\r\n    </linearGradient>\r\n    <linearGradient\r\n       id=\"linearGradient17116-6-9\">\r\n      <stop\r\n         style=\"stop-color:#b3a500;stop-opacity:1;\"\r\n         offset=\"0\"\r\n         id=\"stop17118\" />\r\n      <stop\r\n         style=\"stop-color:#eaa500;stop-opacity:1;\"\r\n         offset=\"1\"\r\n         id=\"stop17120\" />\r\n    </linearGradient>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-2\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-2\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-6\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-8\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-7\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-6\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-8\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-9\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-79\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-5\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-3\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-1\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-33\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-4\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-1\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-3\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <linearGradient\r\n       inkscape:collect=\"always\"\r\n       xlink:href=\"#linearGradient5481-5\"\r\n       id=\"linearGradient5489-4\"\r\n       x1=\"355.89935\"\r\n       y1=\"17.125025\"\r\n       x2=\"380.47559\"\r\n       y2=\"17.125025\"\r\n       gradientUnits=\"userSpaceOnUse\" />\r\n    <linearGradient\r\n       id=\"linearGradient5481-5\">\r\n      <stop\r\n         style=\"stop-color:#e66700;stop-opacity:1;\"\r\n         offset=\"0\"\r\n         id=\"stop5483-2\" />\r\n      <stop\r\n         id=\"stop5491-9\"\r\n         offset=\"0.52777779\"\r\n         style=\"stop-color:#f47712;stop-opacity:1;\" />\r\n      <stop\r\n         style=\"stop-color:#f8bb8a;stop-opacity:1;\"\r\n         offset=\"1\"\r\n         id=\"stop5485-9\" />\r\n    </linearGradient>\r\n    <linearGradient\r\n       y2=\"17.125025\"\r\n       x2=\"380.47559\"\r\n       y1=\"17.125025\"\r\n       x1=\"355.89935\"\r\n       gradientUnits=\"userSpaceOnUse\"\r\n       id=\"linearGradient5588\"\r\n       xlink:href=\"#linearGradient5609\"\r\n       inkscape:collect=\"always\"\r\n       gradientTransform=\"matrix(1.2151103,0,0,1.1804992,-207.06775,536.98221)\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4108-1\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4108-4\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4108-9\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect3225-1\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect3225-4\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4122-2\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4122-7\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1587-6\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4194-5\"\r\n       is_visible=\"true\" />\r\n  </defs>\r\n  <sodipodi:namedview\r\n     id=\"base\"\r\n     pagecolor=\"#9c9c9c\"\r\n     bordercolor=\"#666666\"\r\n     borderopacity=\"1.0\"\r\n     inkscape:pageopacity=\"0\"\r\n     inkscape:pageshadow=\"2\"\r\n     inkscape:zoom=\"3.8325453\"\r\n     inkscape:cx=\"144.17961\"\r\n     inkscape:cy=\"49.96269\"\r\n     inkscape:document-units=\"px\"\r\n     inkscape:current-layer=\"layer1\"\r\n     showgrid=\"true\"\r\n     inkscape:window-width=\"1606\"\r\n     inkscape:window-height=\"962\"\r\n     inkscape:window-x=\"177\"\r\n     inkscape:window-y=\"71\"\r\n     inkscape:window-maximized=\"0\"\r\n     inkscape:snap-global=\"false\"\r\n     inkscape:pagecheckerboard=\"true\"\r\n     inkscape:document-rotation=\"0\">\r\n    <inkscape:grid\r\n       type=\"xygrid\"\r\n       id=\"grid16107\"\r\n       empspacing=\"1\"\r\n       visible=\"true\"\r\n       enabled=\"true\"\r\n       snapvisiblegridlinesonly=\"false\"\r\n       spacingx=\"32\"\r\n       spacingy=\"32\"\r\n       dotted=\"false\"\r\n       originx=\"0\"\r\n       originy=\"0\" />\r\n  </sodipodi:namedview>\r\n  <metadata\r\n     id=\"metadata16104\">\r\n    <rdf:RDF>\r\n      <cc:Work\r\n         rdf:about=\"\">\r\n        <dc:format>image/svg+xml</dc:format>\r\n        <dc:type\r\n           rdf:resource=\"http://purl.org/dc/dcmitype/StillImage\" />\r\n        <dc:title />\r\n      </cc:Work>\r\n    </rdf:RDF>\r\n  </metadata>\r\n  <g\r\n     inkscape:label=\"Layer 1\"\r\n     inkscape:groupmode=\"layer\"\r\n     id=\"layer1\"\r\n     transform=\"translate(0,-540.36218)\">\r\n    <ellipse\r\n       style=\"opacity:0.79203539;fill:url(#linearGradient5588);fill-opacity:1;stroke:#3c3c3c;stroke-width:1.1393038;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1\"\r\n       id=\"path3171-8\"\r\n       cx=\"240.32063\"\r\n       cy=\"557.19836\"\r\n       rx=\"14.353489\"\r\n       ry=\"14.165989\" />\r\n    <flowRoot\r\n       xml:space=\"preserve\"\r\n       id=\"flowRoot5564\"\r\n       style=\"font-style:normal;font-weight:normal;line-height:0.01%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none\"\r\n       transform=\"matrix(0.64571833,0,0,0.61432912,8.6966653,558.72048)\"><flowRegion\r\n         id=\"flowRegion5566\"\r\n         style=\"font-family:sans-serif\"><rect\r\n           id=\"rect5568\"\r\n           width=\"78.749992\"\r\n           height=\"72.5\"\r\n           x=\"346.24997\"\r\n           y=\"-21.999973\"\r\n           style=\"font-family:sans-serif\" /></flowRegion><flowPara\r\n         id=\"flowPara5570\"\r\n         style=\"font-weight:bold;font-size:40px;line-height:1.25;font-family:sans-serif;-inkscape-font-specification:'Sans Bold'\">?</flowPara></flowRoot>\r\n    <path\r\n       style=\"fill:none;stroke:#ec6900;stroke-width:4.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;marker-mid:none;marker-end:none\"\r\n       d=\"m 187.1235,559.26606 c -3.71166,-5.87882 -12.04056,-10.0009 -18.86169,0.34701\"\r\n       id=\"path4144-1\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\" />\r\n    <path\r\n       style=\"fill:#ec6900;fill-opacity:1;stroke:none;stroke-width:0.001;stroke-miterlimit:4;stroke-dasharray:none\"\r\n       d=\"m 170.01417,560.40163 2.05175,2.63036 -9.89352,4.33226 2.83717,-13.08504 z\"\r\n       id=\"path5370-7\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <path\r\n       style=\"fill:none;stroke:#1f9000;stroke-width:4.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;marker-mid:none;marker-end:none\"\r\n       d=\"m 197.1805,559.70121 c 3.69186,-5.88365 11.97631,-10.00911 18.76103,0.3473\"\r\n       id=\"path4144-1-9\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\" />\r\n    <path\r\n       style=\"fill:#1f9000;fill-opacity:1;stroke:none\"\r\n       d=\"m 213.95021,560.59037 -2.0408,2.63252 9.84072,4.33582 -2.82203,-13.09579 z\"\r\n       id=\"path5370-7-4\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <rect\r\n       style=\"fill:#000000;fill-opacity:1;stroke:none\"\r\n       id=\"rect3224\"\r\n       width=\"23.641272\"\r\n       height=\"8.4057856\"\r\n       x=\"487.73776\"\r\n       y=\"552.41565\" />\r\n    <path\r\n       style=\"fill:none;stroke:#000000;stroke-width:5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"M 498.18023,567.81152 484.7754,556.20378 498.93081,545.77569\"\r\n       id=\"path4074\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccc\" />\r\n    <path\r\n       style=\"fill:#000000;fill-opacity:1;stroke:none\"\r\n       d=\"m 17.866009,585.82436 -0.09,-4.53232 -14.5167501,7.49748 14.5683701,7.84238 z\"\r\n       id=\"path5370-5-0-6-5\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <path\r\n       style=\"fill:#000000;fill-opacity:1;stroke:none\"\r\n       d=\"m 46.366429,592.31275 0.0109,4.6129 14.90287,-7.37024 -14.68289,-8.23782 z\"\r\n       id=\"path5370-5-1-2\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <rect\r\n       style=\"opacity:0.94690265;fill:#000000;fill-opacity:1;stroke:none\"\r\n       id=\"rect5558-3-3\"\r\n       width=\"10.726034\"\r\n       height=\"5.6689787\"\r\n       x=\"-3.0812507\"\r\n       y=\"587.85645\"\r\n       transform=\"matrix(1,0,0.06880209,0.99763033,0,0)\" />\r\n    <rect\r\n       style=\"opacity:0.94690265;fill:#000000;fill-opacity:1;stroke:none\"\r\n       id=\"rect5558-1\"\r\n       width=\"10.540748\"\r\n       height=\"5.5710502\"\r\n       x=\"-22.93788\"\r\n       y=\"587.9295\"\r\n       transform=\"matrix(1,0,0.06880209,0.99763033,0,0)\" />\r\n    <path\r\n       style=\"fill:#2e2e2e;fill-opacity:1;stroke:none;stroke-width:0.685581\"\r\n       d=\"m 71.46269,592.27473 0.01481,6.27371 20.268436,-10.02379 -19.969263,-11.20374 z\"\r\n       id=\"path5370-5-1-2-1\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <path\r\n       style=\"fill:#2e2e2e;fill-opacity:1;stroke:none;stroke-width:0.685581\"\r\n       d=\"m 108.87703,578.56977 -6.27262,0.11779 10.35514,20.10117 10.87444,-20.15049 z\"\r\n       id=\"path5370-5-1-2-1-7\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <path\r\n       style=\"fill:#000000;fill-opacity:1;stroke:#363636;stroke-width:2.23946524;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 69.769603,567.95981 5.60449,-5.39601\"\r\n       id=\"path5452-5-5-1-7\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\"\r\n       inkscape:transform-center-x=\"3.061478\"\r\n       inkscape:transform-center-y=\"-0.63275351\" />\r\n    <path\r\n       style=\"fill:#000000;fill-opacity:1;stroke:#363636;stroke-width:2.23946524;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 75.172083,567.8747 -5.47097,-5.53134\"\r\n       id=\"path5452-5-5-1-7-4\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\"\r\n       inkscape:transform-center-x=\"3.196728\"\r\n       inkscape:transform-center-y=\"-0.78552851\" />\r\n    <path\r\n       style=\"fill:#ffe87e;fill-opacity:1;stroke:#a58000;stroke-width:1.02573335px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 36.512525,599.08328 -0.0847,-15.30469 14.76623,-0.079 1.13455,-5.3121 h 6.7663 l 0.52197,5.56549 h 2.38874 l -0.0349,15.41642 z\"\r\n       id=\"path4607\"\r\n       inkscape:path-effect=\"#path-effect4609\"\r\n       inkscape:original-d=\"m 36.512525,599.08328 -0.0847,-15.30469 14.76623,-0.079 1.13455,-5.3121 h 6.7663 l 0.52197,5.56549 h 2.38874 l -0.0349,15.41642 z\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccccccccc\"\r\n       transform=\"translate(-33.065965,-31.819347)\" />\r\n    <path\r\n       style=\"fill:#dfc449;fill-opacity:1;stroke:#a58000;stroke-width:1.04236829px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 38.651325,583.64804 2.27904,-5.34039 8.11475,0.19058 1.53729,4.93611 z\"\r\n       id=\"path5463\"\r\n       inkscape:path-effect=\"#path-effect5465\"\r\n       inkscape:original-d=\"m 38.651325,583.64804 2.27904,-5.34039 8.11475,0.19058 1.53729,4.93611 z\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccccc\"\r\n       transform=\"translate(-33.065965,-31.819347)\" />\r\n    <path\r\n       style=\"fill:#d7f0fb;fill-opacity:1;stroke:#4f4f4f;stroke-width:1.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;stroke-miterlimit:4;stroke-dasharray:none\"\r\n       d=\"m 71.789265,599.90744 0.17512,-24.69199 h 15.41061 l 4.378,4.90337 0.17513,19.96374 z\"\r\n       id=\"path3262\"\r\n       inkscape:path-effect=\"#path-effect3264\"\r\n       inkscape:original-d=\"m 71.789265,599.90744 0.17512,-24.69199 h 15.41061 l 4.378,4.90337 0.17513,19.96374 z\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cccccc\"\r\n       transform=\"translate(-33.561281,-31.819347)\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 73.190225,596.58015 16.81157,-0.35024\"\r\n       id=\"path4106\"\r\n       inkscape:path-effect=\"#path-effect4108\"\r\n       inkscape:original-d=\"m 73.190225,596.58015 16.81157,-0.35024\"\r\n       inkscape:connector-curvature=\"0\"\r\n       transform=\"translate(-33.561281,-31.819347)\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 73.540465,591.50166 16.81157,-0.35024\"\r\n       id=\"path4106-7\"\r\n       inkscape:path-effect=\"#path-effect4108-1\"\r\n       inkscape:original-d=\"m 73.540465,591.50166 16.81157,-0.35024\"\r\n       inkscape:connector-curvature=\"0\"\r\n       transform=\"translate(-33.561281,-31.819347)\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 73.365345,586.59829 16.81157,-0.35024\"\r\n       id=\"path4106-0\"\r\n       inkscape:path-effect=\"#path-effect4108-4\"\r\n       inkscape:original-d=\"m 73.365345,586.59829 16.81157,-0.35024\"\r\n       inkscape:connector-curvature=\"0\"\r\n       transform=\"translate(-33.561281,-31.819347)\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 73.365345,582.22027 16.81157,-0.35024\"\r\n       id=\"path4106-4\"\r\n       inkscape:path-effect=\"#path-effect4108-9\"\r\n       inkscape:original-d=\"m 73.365345,582.22027 16.81157,-0.35024\"\r\n       inkscape:connector-curvature=\"0\"\r\n       transform=\"translate(-33.561281,-31.819347)\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#f1f1f1;stroke-width:4.65793133;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 103.19489,558.19446 16.18158,0.0627\"\r\n       id=\"path5452-5-5-1-7-7\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\"\r\n       inkscape:transform-center-x=\"3.6534509\"\r\n       inkscape:transform-center-y=\"-5.3788766\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#f4f4f4;stroke-width:4.65793133;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 111.38254,565.89244 -0.15492,-16.18101\"\r\n       id=\"path5452-5-5-1-7-4-4\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\"\r\n       inkscape:transform-center-x=\"3.6340509\"\r\n       inkscape:transform-center-y=\"-5.8027516\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#f1f1f1;stroke-width:4.54087734;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 135.53124,558.66024 15.77493,0.0612\"\r\n       id=\"path5452-5-5-1-7-7-1\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\"\r\n       inkscape:transform-center-x=\"3.561639\"\r\n       inkscape:transform-center-y=\"-5.2436726\" />\r\n    <path\r\n       style=\"fill:#bfbfbf;fill-opacity:1;stroke:#ffffff;stroke-width:1.39999998;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 273.79736,565.92624 4.84986,4.15066 7.44379,-12.0346 -3.26109,-1.20718 -4.82074,8.91974 -2.46038,-2.39761 z\"\r\n       id=\"path1157\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccccccc\" />\r\n    <path\r\n       style=\"fill:#ff9d00;fill-opacity:1;stroke:#808080;stroke-width:0.78749156px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 306.19903,566.65065 4.84985,4.15066 7.4438,-12.0346 -3.26109,-1.20718 -4.82075,8.91974 -2.46037,-2.39761 z\"\r\n       id=\"path1157-6\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccccccc\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:4.85740042;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 419.41366,537.85807 12.87326,7.64338 12.79438,-7.33068\"\r\n       id=\"path1585\"\r\n       inkscape:connector-curvature=\"0\"\r\n       inkscape:path-effect=\"#path-effect1587\"\r\n       inkscape:original-d=\"m 419.41366,537.85807 12.87326,7.64338 c 4.40656,-2.37267 3.01422,-8.5404 12.79438,-7.33068\"\r\n       sodipodi:nodetypes=\"ccc\"\r\n       transform=\"matrix(0.82348572,0,0,0.82348572,75.604975,111.95505)\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:4.85740042;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 419.41366,537.85807 12.87326,7.64338 12.79438,-7.33068\"\r\n       id=\"path1585-6\"\r\n       inkscape:connector-curvature=\"0\"\r\n       inkscape:path-effect=\"#path-effect1587-6\"\r\n       inkscape:original-d=\"m 419.41366,537.85807 12.87326,7.64338 c 4.40656,-2.37267 3.01422,-8.5404 12.79438,-7.33068\"\r\n       sodipodi:nodetypes=\"ccc\"\r\n       transform=\"matrix(-0.82326686,0.01898429,-0.01898429,-0.82326686,829.82733,995.45395)\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#ffffff;stroke-width:1.4972775px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 325.7796,560.88703 9.22114,7.89176 14.15308,-22.88169 -6.20039,-2.29524 -9.16581,16.95932 -4.67796,-4.55863 z\"\r\n       id=\"path1157-6-7\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccccccc\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:none\"\r\n       d=\"m 338.27455,603.35315 -4.55847,-12.13972 -4.42325,4.14941 0.29119,-21.42993 14.0532,13.84869 -5.29334,1.40046 4.98485,11.66133 z\"\r\n       id=\"path4192-0\"\r\n       inkscape:path-effect=\"#path-effect4194-5\"\r\n       inkscape:original-d=\"m 338.27455,603.35315 -4.55847,-12.13972 -4.42325,4.14941 0.29119,-21.42993 14.0532,13.84869 -5.29334,1.40046 c 11.73953,18.68506 2.52594,6.89719 4.98485,11.66133 z\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cccccccc\"\r\n       transform=\"rotate(-9.319008,159.52768,371.93318)\" />\r\n    <text\r\n       xml:space=\"preserve\"\r\n       style=\"font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:17.712px;line-height:0%;font-family:'MV Boli';-inkscape-font-specification:'MV Boli';letter-spacing:0px;word-spacing:0px;fill:#ffdc00;fill-opacity:1;stroke:none;stroke-width:1.476\"\r\n       x=\"179.14906\"\r\n       y=\"751.84772\"\r\n       id=\"text3255-0\"\r\n       transform=\"matrix(1.2141217,-0.1513943,0.23126622,0.79480305,0,0)\"><tspan\r\n         sodipodi:role=\"line\"\r\n         id=\"tspan3257-0\"\r\n         x=\"179.14906\"\r\n         y=\"751.84772\"\r\n         style=\"font-size:44.4154px;line-height:1.25;stroke-width:1.476\">!</tspan></text>\r\n    <text\r\n       xml:space=\"preserve\"\r\n       style=\"font-style:normal;font-weight:normal;font-size:32.4516px;line-height:1.25;font-family:sans-serif;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.81129\"\r\n       x=\"131.62856\"\r\n       y=\"599.63672\"\r\n       id=\"text1309\"><tspan\r\n         sodipodi:role=\"line\"\r\n         id=\"tspan1307\"\r\n         x=\"131.62856\"\r\n         y=\"599.63672\"\r\n         style=\"font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:sans-serif;-inkscape-font-specification:'sans-serif Bold';stroke-width:0.81129\">B</tspan></text>\r\n    <text\r\n       id=\"text1309-2\"\r\n       y=\"658.43152\"\r\n       x=\"153.61592\"\r\n       style=\"font-style:normal;font-weight:normal;font-size:41.6588px;line-height:1.25;font-family:sans-serif;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.04147\"\r\n       xml:space=\"preserve\"\r\n       transform=\"scale(1.0962314,0.91221617)\"><tspan\r\n         style=\"font-style:italic;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:serif;-inkscape-font-specification:'serif Bold Italic';stroke-width:1.04147\"\r\n         y=\"658.43152\"\r\n         x=\"153.61592\"\r\n         id=\"tspan1307-4\"\r\n         sodipodi:role=\"line\">i</tspan></text>\r\n    <text\r\n       xml:space=\"preserve\"\r\n       style=\"font-style:normal;font-weight:normal;font-size:38.431px;line-height:1.25;font-family:sans-serif;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.960773\"\r\n       x=\"264.23669\"\r\n       y=\"522.23657\"\r\n       id=\"text1309-0-9\"\r\n       transform=\"scale(0.87011438,1.1492742)\"><tspan\r\n         sodipodi:role=\"line\"\r\n         id=\"tspan1307-3-4\"\r\n         x=\"264.23669\"\r\n         y=\"522.23657\"\r\n         style=\"font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:sans-serif;-inkscape-font-specification:'sans-serif Bold';stroke-width:0.960773\"><tspan\r\n           style=\"font-weight:normal;stroke-width:0.960773\"\r\n           id=\"tspan1365\">s</tspan></tspan></text>\r\n    <text\r\n       xml:space=\"preserve\"\r\n       style=\"font-style:normal;font-weight:normal;font-size:31.7797px;line-height:1.25;font-family:sans-serif;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.794494\"\r\n       x=\"195.07664\"\r\n       y=\"596.5979\"\r\n       id=\"text1309-0-2\"\r\n       transform=\"scale(0.99519471,1.0048285)\"><tspan\r\n         sodipodi:role=\"line\"\r\n         id=\"tspan1307-3-1\"\r\n         x=\"195.07664\"\r\n         y=\"596.5979\"\r\n         style=\"font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:sans-serif;-inkscape-font-specification:'sans-serif Bold';stroke-width:0.794494\">U</tspan></text>\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:3.47724;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 194.05959,600.03363 25.702,0.14808\"\r\n       id=\"path1375\" />\r\n    <path\r\n       id=\"path1375-2\"\r\n       d=\"m 227.04774,587.38832 25.63991,0.14772\"\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:3.46884;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       inkscape:transform-center-x=\"1.1856386\"\r\n       inkscape:transform-center-y=\"-0.33875464\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#484848;stroke-width:1.623;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 262.93706,592.38036 0.0134,5.70131 18.41916,-9.10923 -18.14729,-10.18151 z\"\r\n       id=\"path5370-5-1-2-1-4\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <path\r\n       inkscape:connector-curvature=\"0\"\r\n       id=\"path5370-5-1-2-1-4-0\"\r\n       d=\"m 301.44451,581.20782 -5.70129,0.0197 9.12976,18.40899 10.16128,-18.15862 z\"\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#484848;stroke-width:1.623;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\" />\r\n    <ellipse\r\n       style=\"fill:none;stroke:#242424;stroke-width:2.80047;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:20;stroke-opacity:1\"\r\n       id=\"path1040\"\r\n       ry=\"8.7032747\"\r\n       rx=\"8.4312963\"\r\n       cy=\"583.49023\"\r\n       cx=\"331.71524\" />\r\n    <path\r\n       style=\"fill:none;stroke:#242424;stroke-width:6;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 336.4644,589.47097 10.10632,10.66173\"\r\n       id=\"path1042\"\r\n       sodipodi:nodetypes=\"cc\" />\r\n    <path\r\n       style=\"fill:none;stroke:#242424;stroke-width:2.17621;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 325.36075,583.26941 12.63506,0.34484\"\r\n       id=\"path1044\" />\r\n    <ellipse\r\n       cx=\"364.00839\"\r\n       cy=\"584.36328\"\r\n       rx=\"9.6165609\"\r\n       ry=\"9.9267731\"\r\n       id=\"path1040-0\"\r\n       style=\"fill:none;stroke:#242424;stroke-width:3.19416;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:20;stroke-opacity:1\" />\r\n    <path\r\n       sodipodi:nodetypes=\"cc\"\r\n       id=\"path1042-6\"\r\n       d=\"m 369.73697,590.7899 10.89694,10.89694\"\r\n       style=\"fill:none;stroke:#242424;stroke-width:6;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\" />\r\n    <path\r\n       id=\"path1044-4\"\r\n       d=\"m 357.64269,584.09303 12.63506,0.34484\"\r\n       style=\"fill:none;stroke:#242424;stroke-width:2.17621;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\" />\r\n    <path\r\n       style=\"fill:none;stroke:#242424;stroke-width:2.17621;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 363.94156,590.78154 0.20796,-12.63806\"\r\n       id=\"path1044-4-9\" />\r\n  </g>\r\n</svg>\r\n`.trim();\r\n\r\ntext = btoa(text);\r\nexport let iconSvg = `data:image/svg+xml;base64,` + text;","\"use strict\";\r\n\r\nimport {iconSvg} from './iconsheet.js';\r\n\r\nexport const Icons = {\r\n  FOLDER        : 0, //file folder\r\n  FILE          : 1,\r\n  TINY_X        : 2, //'x' in bottom left corner\r\n  SMALL_PLUS    : 3,\r\n  SMALL_MINUS   : 4,\r\n  UNDO          : 5,\r\n  REDO          : 6,\r\n  HELP          : 7,\r\n  ENUM_UNCHECKED: 8, //overlaid on icon checkboxes when unchecked\r\n  ENUM_CHECKED  : 9, //overlaid on icon checkboxes when checked\r\n  LARGE_CHECK   : 10, //default check mark for non-icon checkboxes\r\n  CURSOR_ARROW  : 11,\r\n  NOTE_EXCL     : 12, //notification exclamation mark\r\n  SCROLL_DOWN   : 13,\r\n  SCROLL_UP     : 14,\r\n  BACKSPACE     : 15,\r\n  LEFT_ARROW    : 16,\r\n  RIGHT_ARROW   : 17,\r\n  UI_EXPAND     : 18, //triangle\r\n  UI_COLLAPSE   : 19, //triangle\r\n  BOLD          : 20,\r\n  ITALIC        : 21,\r\n  UNDERLINE     : 22,\r\n  STRIKETHRU    : 23,\r\n  TREE_EXPAND   : 24,\r\n  TREE_COLLAPSE : 25,\r\n  ZOOM_OUT      : 26,\r\n  ZOOM_IN       : 27\r\n};\r\n\r\nexport function loadDefaultIconSheet() {\r\n  let iconSheet = document.createElement(\"img\");\r\n  iconSheet.src = iconSvg;\r\n\r\n  return iconSheet;\r\n}\r\n\r\n\r\n","import nstructjs from '../path-controller/util/struct.js';\r\n\r\nimport {UIBase} from '../core/ui_base.js';\r\n\r\nexport class FileHeader {\r\n  constructor(version, magic, flags) {\r\n    this.magic = magic;\r\n    this.flags = flags;\r\n    this.version_major = version ? version[0] : 0;\r\n    this.version_minor = version ? version[1] : 0;\r\n    this.version_micro = version ? version[2] : 0;\r\n    this.schema = nstructjs.write_scripts();\r\n  }\r\n}\r\n\r\nFileHeader.STRUCT = `\r\nsimple.FileHeader {\r\n  magic         : static_string[4];\r\n  version_major : short;\r\n  version_minor : short;\r\n  version_micro : short;\r\n  flags         : short;\r\n  schema        : string; \r\n}\r\n`;\r\nnstructjs.register(FileHeader);\r\n\r\nexport class FileFull extends FileHeader {\r\n  constructor(version, magic, flags) {\r\n    super(version, magic, flags);\r\n    this.objects = [];\r\n  }\r\n}\r\n\r\nFileFull.STRUCT = nstructjs.inherit(FileFull, FileHeader) + `\r\n  objects : array(abstract(Object));\r\n  screen  : abstract(Object);\r\n}\r\n`;\r\nnstructjs.register(FileFull);\r\n\r\n\r\nexport class FileArgs {\r\n  constructor(args = {}) {\r\n    this.ext = args.ext || \".data\";\r\n    this.magic = args.magic || \"STRT\";\r\n    this.doScreen = args.doScreen !== undefined ? args.doScreen : true;\r\n    this.resetOnLoad = args.resetOnLoad !== undefined ? args.resetOnLoad : true;\r\n    this.useJSON = args.useJSON !== undefined ? args.useJSON : false;\r\n    this.version = args.version !== undefined ? args.version : 0;\r\n    this.fileFlags = args.fileFlags !== undefined ? args.fileFlags : 0;\r\n    this.fromFileOp = false; /* SimpleSaveOp and SimpleOpenOp set this to true */\r\n  }\r\n}\r\n\r\nexport class EmptyStruct {\r\n\r\n}\r\nEmptyStruct.STRUCT = `\r\nEmptyStruct {\r\n}\r\n`;\r\nnstructjs.register(EmptyStruct);\r\n\r\nexport function saveFile(appstate, args, objects) {\r\n  if (args.useJSON === undefined) {\r\n    args.useJSON = appstate.saveFilesInJSON;\r\n  }\r\n\r\n  args = new FileArgs(args);\r\n\r\n  let version = args.version;\r\n  if (typeof version === \"number\") {\r\n    if (version === Math.floor(version)) {\r\n      version = [version, 0, 0];\r\n    } else {\r\n      let major = ~~version;\r\n      let minor = ~~(Math.fract(version)*10.0);\r\n      let micro = (Math.fract(version) - minor) * 100.0;\r\n\r\n      version = [major, minor, micro];\r\n    }\r\n  }\r\n\r\n  let file = new FileFull(version, args.magic, args.fileFlags);\r\n\r\n  if (args.doScreen) {\r\n    file.screen = appstate.screen;\r\n  } else {\r\n    file.screen = new EmptyStruct();\r\n  }\r\n\r\n  for (let ob of objects) {\r\n    file.objects.push(ob);\r\n  }\r\n\r\n  if (args.useJSON) {\r\n    return nstructjs.writeJSON(file);\r\n  } else {\r\n    let data = [];\r\n    nstructjs.writeObject(data, file);\r\n    return (new Uint8Array(data)).buffer;\r\n  }\r\n}\r\n\r\nexport function loadFile(appstate, args, data) {\r\n  let header;\r\n\r\n  if (args.useJSON === undefined) {\r\n    args.useJSON = appstate.saveFilesInJSON;\r\n  }\r\n\r\n  args = new FileArgs(args);\r\n\r\n  if (!args.useJSON) {\r\n    if (data instanceof Array) {\r\n      data = (new Uint8Array(data)).buffer;\r\n    }\r\n\r\n    if (data instanceof Uint8Array) {\r\n      data = data.buffer;\r\n    }\r\n\r\n    if (data instanceof ArrayBuffer) {\r\n      data = new DataView(data);\r\n    }\r\n\r\n    header = nstructjs.readObject(data, FileHeader);\r\n  } else {\r\n    if (typeof data === \"string\") {\r\n      data = JSON.parse(data);\r\n    }\r\n\r\n    header = nstructjs.readJSON(data, FileHeader);\r\n  }\r\n\r\n  if (header.magic !== args.magic) {\r\n    throw new Error(\"invalid file\");\r\n  }\r\n\r\n  let istruct = new nstructjs.STRUCT();\r\n  istruct.parse_structs(header.schema);\r\n\r\n  let ret;\r\n\r\n  if (!args.useJSON) {\r\n    ret = istruct.readObject(data, FileFull);\r\n  } else {\r\n    ret = istruct.readJSON(data, FileFull);\r\n  }\r\n\r\n  if (args.resetOnLoad) {\r\n    appstate.reset();\r\n  }\r\n\r\n  if (args.doScreen) {\r\n    if (appstate.screen) {\r\n      appstate.screen.unlisten();\r\n      appstate.screen.remove();\r\n    }\r\n\r\n    ret.screen.ctx = appstate.ctx;\r\n\r\n    if (!(ret.screen instanceof appstate.screenClass)) {\r\n      let screen = UIBase.createElement(appstate.screenClass.define().tagname);\r\n      screen.ctx = appstate.ctx;\r\n\r\n      for (let sarea of ret.screen.sareas) {\r\n        screen.appendChild(sarea);\r\n\r\n        sarea.area.afterSTRUCT();\r\n        sarea.area.on_fileload();\r\n      }\r\n\r\n      ret.screen = screen;\r\n    }\r\n\r\n    appstate.screen = ret.screen;\r\n\r\n    document.body.appendChild(appstate.screen);\r\n    appstate.screen.listen();\r\n  }\r\n\r\n  return ret;\r\n}","import {Editor} from './editor.js';\r\nimport {UIBase} from '../core/ui_base.js';\r\nimport {nstructjs} from '../path-controller/controller.js';\r\nimport {AreaFlags} from '../screen/ScreenArea.js';\r\n\r\n/** see ./editor.js:Editor.registerAppMenu */\r\n\r\nexport class MenuBarEditor extends Editor {\r\n  constructor() {\r\n    super();\r\n\r\n    this.updateHeight();\r\n    this.borderLock = 1 | 2 | 4 | 8;\r\n    this.areaDragToolEnabled = false;\r\n\r\n    this._height = 25;\r\n\r\n    this.needsRebuild = false;\r\n  }\r\n\r\n  get height() {\r\n    return this._height;\r\n  }\r\n\r\n  set height(v) {\r\n    this._height = v;\r\n    this.updateHeight();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname : \"simple-menu-editor-x\",\r\n      areaname: \"menu\",\r\n      uiname  : \"Menu Bar\",\r\n      icon    : -1,\r\n      //hide in editor list\r\n      flag    : AreaFlags.HIDDEN | AreaFlags.NO_HEADER_CONTEXT_MENU | AreaFlags.NO_COLLAPSE | AreaFlags.NO_SWITCHER\r\n    }\r\n  }\r\n\r\n  updateHeight(force = false) {\r\n    if (!this.header)\r\n      return;\r\n\r\n    if (window.haveElectron) {\r\n      this.maxSize[1] = this.minSize[1] = 1;\r\n      electron_api.initMenuBar(this);\r\n      return;\r\n    }\r\n\r\n    if (this._height === undefined) {\r\n      let rect = this.header.getClientRects()[0];\r\n\r\n      if (rect) {\r\n        this._height = rect.height;\r\n      }\r\n    }\r\n\r\n    let update = force || this._height !== this.minSize[1];\r\n    this.minSize[1] = this.maxSize[1] = this._height;\r\n\r\n    if (update && this.ctx && this.getScreen()) {\r\n      this.getScreen().solveAreaConstraints();\r\n    }\r\n  }\r\n\r\n  makeMenuBar(container) {\r\n    if (Editor.makeMenuBar) {\r\n      Editor.makeMenuBar(this.ctx, container, this);\r\n    }\r\n  }\r\n\r\n  flagRebuild() {\r\n    this.needsRebuild = true;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.background = this.getDefault(\"AreaHeaderBG\");\r\n\r\n    this.menuRow = this.header.row();\r\n    this.makeMenuBar(this.menuRow);\r\n\r\n    this.doOnce(() => {\r\n      if (window.haveElectron) {\r\n        this.height = 1;\r\n        electron_api.initMenuBar(this);\r\n      }\r\n    });\r\n\r\n    this.updateHeight(true);\r\n    this.flushUpdate();\r\n  }\r\n\r\n  rebuild() {\r\n    this.needsRebuild = false;\r\n\r\n    this.menuRow.clear();\r\n    this.makeMenuBar(this.menuRow);\r\n    this.flushUpdate();\r\n  }\r\n\r\n  update() {\r\n    if (this.needsRebuild) {\r\n      this.rebuild();\r\n    }\r\n  }\r\n}\r\n\r\nMenuBarEditor.STRUCT = nstructjs.inherit(MenuBarEditor, Editor, \"MenuBarEditor\") + `\r\n}\r\n`;\r\n\r\nexport function registerMenuBarEditor() {\r\n  Editor.register(MenuBarEditor);\r\n}\r\n","import * as platform from '../platforms/platform.js';\r\n\r\nimport {ToolOp, UndoFlags} from '../path-controller/toolsys/toolsys.js';\r\nimport {ToolProperty, BoolProperty, StringProperty} from '../path-controller/toolsys/toolprop.js';\r\n\r\nimport {sendNote, error, warning, message} from '../widgets/ui_noteframe.js';\r\n\r\nexport class SimpleAppNewOp extends ToolOp {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : \"New\",\r\n      toolpath: \"app.new\",\r\n      inputs  : {},\r\n      undoflag: UndoFlags.NO_UNDO\r\n    }\r\n  }\r\n\r\n  exec(ctx) {\r\n    _appstate.createNewFile();\r\n  }\r\n}\r\n\r\nexport class SimpleAppSaveOp extends ToolOp {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : \"Save\",\r\n      toolpath: \"app.save\",\r\n      inputs  : {\r\n        forceDialog: new BoolProperty()\r\n      },\r\n      undoflag: UndoFlags.NO_UNDO\r\n    }\r\n  }\r\n\r\n  exec(ctx) {\r\n    let ext = _appstate.fileExt;\r\n    let useJSON = _appstate.startArgs.saveFilesInJSON;\r\n\r\n    _appstate.saveFile({\r\n      doScreen  : true,\r\n      useJSON,\r\n      fromFileOp: true\r\n    }).then(data => {\r\n\r\n      function save() {\r\n        return data;\r\n      }\r\n\r\n      platform.platform.showSaveDialog(\"Save As\", save, {\r\n        multi          : false,\r\n        addToRecentList: true,\r\n        filters        : [{\r\n          name      : \"File\",\r\n          mime      : useJSON ? \"text/json\" : \"application/x-octet-stream\",\r\n          extensions: [\".\" + ext.toLowerCase()]\r\n        }]\r\n      }).then(path => {\r\n        _appstate.currentFileRef = path;\r\n        message(\"File saved\");\r\n      }).catch(err => {\r\n        if (typeof err === \"object\" && err.message) {\r\n          err = err.message;\r\n        }\r\n\r\n        error(\"Failed to save file \" + err);\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\nexport class SimpleAppOpenOp extends ToolOp {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : \"Open\",\r\n      toolpath: \"app.open\",\r\n      inputs  : {\r\n        forceDialog: new BoolProperty()\r\n      },\r\n      undoflag: UndoFlags.NO_UNDO\r\n    }\r\n  }\r\n\r\n  exec(ctx) {\r\n    let ext = _appstate.fileExt;\r\n    let useJSON = _appstate.startArgs.saveFilesInJSON;\r\n    let mime = useJSON ? \"text/json\" : \"application/x-octet-stream\";\r\n\r\n    platform.platform.showOpenDialog(\"Open File\", {\r\n      multi          : false,\r\n      addToRecentList: true,\r\n      filters        : [{\r\n        name      : \"File\",\r\n        mime,\r\n        extensions: [\".\" + ext.toLowerCase()]\r\n      }]\r\n    }).then(paths => {\r\n      for (let path of paths) {\r\n        platform.platform.readFile(path, mime).then(data => {\r\n          console.log(\"got data!\", data);\r\n\r\n          _appstate.loadFile(data, {useJSON, doScreen: true, fromFileOp: true})\r\n            .catch(err => {\r\n              error(\"File error: \" + err.message);\r\n            });\r\n        });\r\n      }\r\n    }).catch(error => {\r\n      ctx.error(error.message);\r\n    })\r\n  }\r\n}\r\n\r\nexport function register() {\r\n  ToolOp.register(SimpleAppSaveOp);\r\n  ToolOp.register(SimpleAppOpenOp);\r\n  ToolOp.register(SimpleAppNewOp);\r\n}\r\n","import nstructjs from '../path-controller/util/struct.js';\r\n\r\nexport const DataModelClasses = [];\r\nimport {ToolStack} from '../path-controller/toolsys/toolsys.js';\r\nimport {Context} from '../path-controller/controller/context.js';\r\nimport {DataAPI} from '../path-controller/controller/controller.js';\r\nimport {Screen} from '../screen/FrameManager.js';\r\nimport {areaclasses} from '../screen/area_wrangler.js';\r\nimport * as util from '../util/util.js';\r\nimport {Editor} from './editor.js';\r\n\r\nimport {Vector2} from '../path-controller/util/vectormath.js';\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nexport class DataModel {\r\n  static defineAPI(api, strct) {\r\n    return strct;\r\n  }\r\n\r\n  static register(cls) {\r\n    if (!cls.hasOwnProperty(\"defineAPI\")) {\r\n      //  throw new Error(cls.name + \"is missing a defineAPI method\");\r\n    }\r\n\r\n    DataModelClasses.push(cls);\r\n\r\n    if (cls.hasOwnProperty(\"STRUCT\")) {\r\n      nstructjs.register(cls);\r\n    }\r\n  }\r\n}\r\n\r\nclass EmptyContextClass extends Context {\r\n  static defineAPI(api, strct) {\r\n  }\r\n}\r\n\r\nimport * as ui_noteframe from '../widgets/ui_noteframe.js';\r\n\r\n/**\r\n * Extend the client-provided context class\r\n * with a few standard methods and properties\r\n *\r\n * */\r\nfunction GetContextClass(ctxClass) {\r\n  let StateSymbol = Symbol(\"AppState ref\");\r\n\r\n  return class ContextDerived extends ctxClass {\r\n    constructor(state) {\r\n      super(...arguments);\r\n\r\n      this[StateSymbol] = state;\r\n    }\r\n\r\n    get screen() {\r\n      return this[StateSymbol].screen;\r\n    }\r\n\r\n    get state() {\r\n      return this[StateSymbol];\r\n    }\r\n\r\n    set state(v) {\r\n      this[StateSymbol] = v;\r\n    }\r\n\r\n    get api() {\r\n      return this[StateSymbol].api;\r\n    }\r\n\r\n    get toolstack() {\r\n      return this[StateSymbol].toolstack;\r\n    }\r\n\r\n    toLocked() {\r\n      //for now, don't support context locking\r\n      return this;\r\n    }\r\n\r\n    message(msg, timeout = 2500) {\r\n      return ui_noteframe.message(this.screen, msg, timeout);\r\n    }\r\n\r\n    error(msg, timeout = 2500) {\r\n      return ui_noteframe.error(this.screen, msg, timeout);\r\n    }\r\n\r\n    warning(msg, timeout = 2500) {\r\n      return ui_noteframe.warning(this.screen, msg, timeout);\r\n    }\r\n\r\n    progressBar(msg, percent, color, timeout = 1000) {\r\n      return ui_noteframe.progbarNote(this.screen, msg, percent, color, timeout);\r\n    }\r\n  }\r\n}\r\n\r\nexport function makeAPI(ctxClass) {\r\n  let api = new DataAPI();\r\n\r\n  for (let cls of DataModelClasses) {\r\n    if (cls.defineAPI) {\r\n      cls.defineAPI(api, api.mapStruct(cls, true));\r\n    }\r\n  }\r\n\r\n  for (let k in areaclasses) {\r\n    areaclasses[k].defineAPI(api, api.mapStruct(areaclasses[k], true));\r\n  }\r\n\r\n  if (ctxClass.defineAPI) {\r\n    ctxClass.defineAPI(api, api.mapStruct(ctxClass, true));\r\n  } else {\r\n    throw new Error(\"Context class should have a defineAPI static method\");\r\n  }\r\n\r\n  api.rootContextStruct = api.mapStruct(ctxClass, api.mapStruct(ctxClass, true));\r\n\r\n  return api;\r\n}\r\n\r\nimport {Icons, loadDefaultIconSheet} from './icons.js';\r\nimport {IconManager, setIconManager, setIconMap, setTheme, UIBase} from '../core/ui_base.js';\r\nimport {FileArgs, loadFile, saveFile} from './file.js';\r\nimport {HotKey, KeyMap} from '../path-controller/util/simple_events.js';\r\nimport {initSplineTemplates} from '../path-controller/curve/curve1d_bspline.js';\r\nimport {MenuBarEditor, registerMenuBarEditor} from './menubar.js';\r\nimport {register} from './app_ops.js';\r\n\r\nexport class StartArgs {\r\n  constructor() {\r\n    this.singlePage = true;\r\n\r\n    this.icons = Icons;\r\n    this.iconsheet = undefined; //will default to loadDefaultIconSheet();\r\n    this.iconSizes = [16, 24, 32, 48];\r\n    this.iconTileSize = 32;\r\n    this.iconsPerRow = 16;\r\n    this.theme = undefined; //see scripts/core/theme.js\r\n\r\n    this.registerSaveOpenOps = true;\r\n\r\n    this.autoLoadSplineTemplates = true;\r\n    this.showPathsInToolTips = true;\r\n    this.enableThemeAutoUpdate = false;\r\n    this.addHelpPickers = false;\r\n    this.useNumSliderTextboxes = true;\r\n    this.numSliderArrowLimit = cconst.numSliderArrowLimit;\r\n    this.simpleNumSliders = cconst.simpleNumSliders;\r\n  }\r\n}\r\n\r\nexport class SimpleScreen extends Screen {\r\n  constructor() {\r\n    super();\r\n\r\n    this.keymap = new KeyMap([\r\n      new HotKey(\"Z\", [\"CTRL\"], () => {\r\n        this.ctx.toolstack.undo(this.ctx);\r\n      }),\r\n      new HotKey(\"Z\", [\"CTRL\", \"SHIFT\"], () => {\r\n        this.ctx.toolstack.redo(this.ctx);\r\n      }),\r\n    ])\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"simple-screen-x\"\r\n    }\r\n  }\r\n\r\n  init() {\r\n    if (this.ctx.state.startArgs.registerSaveOpenOps) {\r\n      this.keymap.add(new HotKey(\"S\", [\"CTRL\"], \"app.save()\"));\r\n      this.keymap.add(new HotKey(\"O\", [\"CTRL\"], \"app.open()\"));\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.style[\"position\"] = UIBase.PositionKey;\r\n    this.style[\"left\"] = this.pos[0] + \"px\";\r\n    this.style[\"top\"] = this.pos[1] + \"px\";\r\n  }\r\n}\r\n\r\nUIBase.register(SimpleScreen);\r\n\r\nexport class AppState {\r\n  /** ctxClass is the context class.  It can be either a simple class\r\n   *  or a subclass of the more complex path.ux Context class.  Note that\r\n   *  using Context will avoid subtle undo stack errors caused by the context\r\n   *  changing after a tool is run (this is why Context has a serialization\r\n   *  mechanism).\r\n   *\r\n   *  Path.ux will actually subclass ctxClass and add a few standard methods\r\n   *  and properties, see GetContextClass.*/\r\n  constructor(ctxClass, screenClass = SimpleScreen) {\r\n    this._ctxClass = ctxClass;\r\n\r\n    ctxClass = GetContextClass(ctxClass);\r\n\r\n    this.startArgs = undefined;\r\n    this.currentFileRef = undefined; //current file path/ref\r\n\r\n    this.ctx = new ctxClass(this);\r\n    this.ctx._state = this;\r\n    this.toolstack = new ToolStack();\r\n    this.api = makeAPI(ctxClass);\r\n    this.screenClass = screenClass;\r\n    this.screen = undefined;\r\n\r\n    this.fileMagic = \"STRT\";\r\n    this.fileVersion = [0, 0, 1];\r\n    this._fileExt = \"data\";\r\n    this._fileExtSet = false;\r\n    this.saveFilesInJSON = false; /* save files in nstructjs-json */\r\n\r\n    this.defaultEditorClass = undefined; //if undefined, the first non-menubar editor will be used\r\n  }\r\n\r\n\r\n  get fileExt() {\r\n    return this._fileExt;\r\n  }\r\n\r\n  set fileExt(ext) {\r\n    this._fileExt = ext;\r\n    this._fileExtSet = true;\r\n  }\r\n\r\n  /** resets the undo stack */\r\n  reset() {\r\n    this.toolstack.reset();\r\n  }\r\n\r\n  /** Create a new file. See this.makeScreen() if you wish\r\n   *  to create a new screen at this time, and this.reset()\r\n   *  if you wish to reset the undo stack*/\r\n  createNewFile() {\r\n    console.warn(\"appstate.createNewFile: implement me, using default hack\");\r\n    let state = new this.constructor(this.ctx._ctxClass);\r\n\r\n    state.api = this.api;\r\n    state.ctx = this.ctx;\r\n    state.startArgs = this.startArgs;\r\n    state.saveFilesInJSON = this.saveFilesInJSON;\r\n\r\n    state.toolstack = this.toolstack;\r\n    state.toolstack.reset();\r\n\r\n    this.screen.unlisten();\r\n    this.screen.remove();\r\n\r\n    for (let k in state) {\r\n      this[k] = state[k];\r\n    }\r\n\r\n    this.makeScreen();\r\n  }\r\n\r\n  saveFileSync(objects, args = {}) {\r\n    args = new FileArgs(Object.assign({\r\n      magic  : this.fileMagic,\r\n      version: this.fileVersion,\r\n      ext    : this.fileExt\r\n    }, args));\r\n\r\n    return saveFile(this, args, objects);\r\n  }\r\n\r\n  /** Serialize the application state. Takes\r\n   *  a list of objects to save (with nstructjs);\r\n   *  Subclasses should override this, like so:\r\n   *\r\n   *  saveFile(args={}) {\r\n   *    let objects = app state;\r\n   *    return super.saveFile(objects, args);\r\n   *  }\r\n   **/\r\n  saveFile(objects, args = {}) {\r\n    args = new FileArgs(Object.assign({\r\n      magic  : this.fileMagic,\r\n      version: this.fileVersion,\r\n      ext    : this.fileExt\r\n    }, args));\r\n\r\n    return new Promise((accept, reject) => {\r\n      accept(this.saveFileSync(objects, args));\r\n    });\r\n  }\r\n\r\n  loadFileSync(data, args = {}) {\r\n    args = new FileArgs(Object.assign({\r\n      magic  : this.fileMagic,\r\n      version: this.fileVersion,\r\n      ext    : this.fileExt\r\n    }, args));\r\n\r\n    let ret = loadFile(this, args, data);\r\n\r\n    if (args.doScreen) {\r\n      try {\r\n        this.ensureMenuBar();\r\n      } catch (error) {\r\n        console.error(error.stack);\r\n        console.error(error.message);\r\n        console.error(\"Failed to add menu bar\");\r\n      }\r\n\r\n      this.screen.completeSetCSS();\r\n      this.screen.completeUpdate();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   *  Loads a new file. The default behavior is a\r\n   *  complete state reset (you can control this\r\n   *  with args.reset_toolstack, args.reset_context\r\n   *  and args.doScreen).\r\n   *\r\n   *  As the base class cannot know just what to do\r\n   *  with the loaded data (the objects parameter\r\n   *  passed to saveFile) it is recommended you\r\n   *  override this function like so:\r\n   *\r\n   *  loadFile(data, args) {\r\n   *    return super.loadFile(data, args).then(fileData) => {\r\n   *      // load fileData.objects into appropriate properties\r\n   *      // this is the same objects array originally passed\r\n   *      // to this.saveFile\r\n   *      this.data = fileData.objects;\r\n   *    });\r\n   *  }\r\n   *\r\n   *  @param {ArrayBuffer|JSON|DataView} data\r\n   *  @param {FileArgs} args\r\n   *  */\r\n  loadFile(data, args = {}) {\r\n    return new Promise((accept, reject) => {\r\n      accept(this.loadFileSync(data, args));\r\n    });\r\n  }\r\n\r\n  ensureMenuBar() {\r\n    let screen = this.screen;\r\n    let ok = false;\r\n\r\n    for (let sarea of screen.sareas) {\r\n      if (sarea.area instanceof MenuBarEditor) {\r\n        ok = true;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (ok) {\r\n      return;\r\n    }\r\n\r\n    if (!Editor.makeMenuBar) {\r\n      /* don't make menu bar if Editor.registerAppMenu hasn't been called */\r\n      return;\r\n    }\r\n\r\n    /* ensure screen size is up to date */\r\n    screen.update();\r\n\r\n    let sarea = UIBase.createElement(\"screenarea-x\");\r\n\r\n    screen.appendChild(sarea);\r\n\r\n    let h = 55;\r\n    let min = new Vector2().addScalar(1e17);\r\n    let max = new Vector2().addScalar(-1e17);\r\n    let tmp = new Vector2();\r\n\r\n    for (let sarea2 of screen.sareas) {\r\n      if (sarea2 === sarea) {\r\n        continue;\r\n      }\r\n\r\n      min.min(sarea2.pos);\r\n      tmp.load(sarea2.pos).add(sarea2.size);\r\n      max.max(tmp);\r\n    }\r\n\r\n    let scale = (max[1] - min[1] - h)/(max[1] - min[1]);\r\n\r\n    for (let sarea2 of screen.sareas) {\r\n      if (sarea2 === sarea) {\r\n        continue;\r\n      }\r\n\r\n      sarea2.pos[1] *= scale;\r\n      sarea2.size[1] *= scale;\r\n      sarea2.pos[1] += h;\r\n    }\r\n\r\n    sarea.pos.zero();\r\n    sarea.size[0] = screen.size[0];\r\n    sarea.size[1] = h;\r\n\r\n    screen.regenScreenMesh();\r\n    screen.snapScreenVerts();\r\n\r\n    sarea.switch_editor(MenuBarEditor);\r\n\r\n    screen.solveAreaConstraints();\r\n\r\n    screen.completeSetCSS();\r\n    screen.completeUpdate();\r\n  }\r\n\r\n  makeScreen() {\r\n    if (this.screen) {\r\n      this.screen.unlisten();\r\n      this.screen.remove();\r\n    }\r\n\r\n    let screen = this.screen = UIBase.createElement(this.screenClass.define().tagname);\r\n    let sarea = UIBase.createElement(\"screenarea-x\");\r\n\r\n    screen.ctx = this.ctx;\r\n    sarea.ctx = this.ctx;\r\n\r\n    document.body.appendChild(screen);\r\n\r\n    let cls = this.defaultEditorClass;\r\n\r\n    if (!cls) {\r\n      for (let k in areaclasses) {\r\n        cls = areaclasses[k];\r\n\r\n        if (cls !== MenuBarEditor) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    sarea.switch_editor(cls);\r\n    screen.appendChild(sarea);\r\n\r\n    screen._init();\r\n    screen.listen();\r\n    screen.update();\r\n    screen.completeSetCSS();\r\n    screen.completeUpdate();\r\n\r\n    if (Editor.makeMenuBar) {\r\n      this.ensureMenuBar();\r\n    }\r\n  }\r\n\r\n  start(args = new StartArgs()) {\r\n    let args2 = new StartArgs();\r\n\r\n    let methodsCheck = [\r\n      \"saveFile\", \"createNewFile\", \"loadFile\"\r\n    ];\r\n\r\n    for (let method of methodsCheck) {\r\n      let m1 = AppState.prototype[method];\r\n      let m2 = this[method];\r\n\r\n      if (m1 === m2) {\r\n        console.warn(`Warning: it is recommended to override .${method} when subclassing simple.AppState`);\r\n      }\r\n    }\r\n\r\n    document.body.style[\"touch-action\"] = \"none\";\r\n\r\n    registerMenuBarEditor();\r\n\r\n    for (let k in args2) {\r\n      if (args[k] === undefined) {\r\n        args[k] = args2[k];\r\n      }\r\n    }\r\n\r\n    if (args.registerSaveOpenOps) {\r\n      register();\r\n    }\r\n\r\n    if (!args.iconsheet) {\r\n      args.iconsheet = loadDefaultIconSheet();\r\n    }\r\n\r\n    this.startArgs = args;\r\n\r\n    cconst.loadConstants(args);\r\n\r\n    if (args.autoLoadSplineTemplates) {\r\n      initSplineTemplates();\r\n    }\r\n\r\n    let sizes = [];\r\n    let images = [];\r\n\r\n    for (let size of args.iconSizes) {\r\n      sizes.push([args.iconTileSize, size]);\r\n      images.push(args.iconsheet);\r\n    }\r\n\r\n    window.iconsheet = args.iconsheet;\r\n\r\n\r\n    let iconManager = new IconManager(images, sizes, args.iconsPerRow);\r\n    setIconManager(iconManager);\r\n    setIconMap(args.icons);\r\n\r\n    if (args.theme) {\r\n      setTheme(args.theme);\r\n    }\r\n\r\n    document.body.style[\"margin\"] = \"0px\";\r\n    document.body.style[\"padding\"] = \"0px\";\r\n\r\n    if (args.singlePage) {\r\n      document.body.style[\"overflow\"] = \"hidden\";\r\n    }\r\n\r\n    this.makeScreen();\r\n\r\n    Object.defineProperty(window, \"C\", {\r\n      get() {\r\n        return this._appstate.ctx;\r\n      }\r\n    });\r\n\r\n    nstructjs.validateStructs();\r\n\r\n    if (this.saveFilesInJSON && !this._fileExtSet) {\r\n      this._fileExt = \"json\";\r\n    }\r\n\r\n    if (this._fileExt.startsWith(\".\")) {\r\n      this._fileExt = this._fileExt.slice(1, this._fileExt.length).trim();\r\n    }\r\n  }\r\n}\r\n","\r\nexport class SimpleContext {\r\n  constructor() {\r\n\r\n  }\r\n\r\n  static getContextClass() {\r\n    let props = {};\r\n\r\n    let rec = (cls) => {\r\n      let prototype = cls.prototype;\r\n\r\n      if (cls.__proto__ !== Object.__proto__) {\r\n        rec(cls);\r\n      }\r\n\r\n      for (let k in cls) {\r\n        let descr = Object.getOwnPropertyDescriptor(prototype, k);\r\n\r\n        if (descr) {\r\n          props[k] = descr;\r\n        }\r\n      }\r\n    }\r\n\r\n    console.log(props);\r\n\r\n    for (let k in props) {\r\n      if (k.search(\"_save\") >= 0 || k.search(\"_load\") >= 0) {\r\n        continue;\r\n      }\r\n\r\n    }\r\n  }\r\n}","import './path-controller/util/polyfill.js';\r\n\r\nexport * from './xmlpage/xmlpage.js';\r\n\r\nexport * from './core/ui_base.js';\r\nexport * from './core/ui.js';\r\nexport * from './widgets/ui_widgets.js';\r\nexport * from './widgets/ui_widgets2.js';\r\nexport * from './core/ui_theme.js';\r\nexport * from './core/units.js';\r\nexport * from './widgets/ui_button.js';\r\nexport * from './widgets/ui_richedit.js';\r\nexport * from './widgets/ui_curvewidget.js';\r\nexport * from './widgets/ui_panel.js';\r\nexport * from './widgets/ui_colorpicker2.js';\r\nexport * from './widgets/ui_tabs.js';\r\nexport * from './widgets/ui_listbox.js';\r\nexport * from './widgets/ui_menu.js';\r\nexport * from './widgets/ui_progress.js';\r\nexport * from './widgets/ui_table.js';\r\nexport * from './widgets/ui_noteframe.js';\r\nexport * from './widgets/ui_numsliders.js';\r\nexport * from './widgets/ui_lasttool.js';\r\nexport * from './widgets/ui_textbox.js';\r\nexport * from './path-controller/util/graphpack.js';\r\n//export * from './docbrowser/docbrowser.js';\r\n\r\nexport * from './path-controller/util/html5_fileapi.js';\r\nexport * from './path-controller/controller.js';\r\n\r\nimport * as controller1 from './path-controller/controller.js';\r\nexport const controller = controller1;\r\n\r\nimport * as ui_noteframe from './widgets/ui_noteframe.js';\r\ncontroller1.setNotifier(ui_noteframe);\r\n\r\nimport * as platform1 from './platforms/platform.js';\r\nexport const platform = platform1;\r\n\r\nimport * as electron_api1 from './platforms/electron/electron_api.js';\r\nexport const electron_api = electron_api1;\r\n\r\nexport * from './platforms/platform.js';\r\n\r\nexport * from './widgets/theme_editor.js';\r\nexport * from './widgets/ui_treeview.js';\r\n\r\nexport * from './screen/FrameManager.js';\r\nexport * from './screen/ScreenArea.js';\r\nexport * from './util/ScreenOverdraw.js';\r\n\r\nimport cconst1 from './config/const.js';\r\nexport const cconst = cconst1;\r\n\r\nimport * as simple1 from './simple/simple.js';\r\nexport const simple = simple1;\r\n","import {PlatformAPI, isMimeText} from '../platform_base.js';\r\nimport {saveFile, loadFile} from '../../path-controller/util/html5_fileapi.js';\r\n\r\nimport {FileDialogArgs, FilePath} from '../platform_base.js';\r\n\r\nimport {mimeMap} from '../platform_base.js';\r\n\r\nexport function getWebFilters(filters=[]) {\r\n  let types = [];\r\n\r\n  for (let item of filters) {\r\n    let mime = item.mime;\r\n    let exts = [];\r\n\r\n    for (let ext of item.extensions) {\r\n      ext = \".\" + ext;\r\n      if (ext.toLowerCase() in mimeMap) {\r\n        mime = mime !== undefined ? mime : mimeMap[ext.toLowerCase()];\r\n      }\r\n\r\n      exts.push(ext);\r\n    }\r\n\r\n    if (!mime) {\r\n      mime = \"application/x-octet-stream\";\r\n    }\r\n\r\n    types.push({\r\n      description: item.name,\r\n      accept     : {\r\n        [mime]: exts\r\n      }\r\n    });\r\n  }\r\n\r\n  return types;\r\n}\r\n\r\nexport class platform extends PlatformAPI {\r\n  //returns a promise\r\n  static showOpenDialog(title, args = new FileDialogArgs()) {\r\n    let types = getWebFilters(args.filters);\r\n\r\n    return new Promise((accept, reject) => {\r\n      try {\r\n        window.showOpenFilePicker({\r\n          multiple: args.multi,\r\n          types\r\n        }).then(arg => {\r\n          let paths = [];\r\n\r\n          for (let file of arg) {\r\n            paths.push(new FilePath(file, file.name));\r\n          }\r\n\r\n          accept(paths);\r\n        });\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n    });\r\n    /*\r\n    let exts = [];\r\n\r\n    for (let list of args.filters) {\r\n      for (let ext of list.extensions) {\r\n        exts.push(ext);\r\n      }\r\n    }\r\n\r\n    return new Promise((accept, reject) => {\r\n      loadFile(args.defaultPath, exts).then((file) => {\r\n        accept([new FilePath(file)]);\r\n      });\r\n    });*/\r\n  }\r\n\r\n  static writeFile(data, handle, mime) {\r\n    handle = handle.data;\r\n\r\n    return handle.createWritable().then((file) => {\r\n      file.write(data);\r\n      file.close();\r\n    });\r\n  }\r\n\r\n  static showSaveDialog(title, savedata_cb, args = new FileDialogArgs()) {\r\n    if (!window.showSaveFilePicker) {\r\n      return this.showSaveDialog_old(...arguments);\r\n    }\r\n\r\n    let types = getWebFilters(args.filters);\r\n\r\n    return new Promise((accept, reject) => {\r\n      let fname;\r\n      let saveHandle;\r\n\r\n      try {\r\n        saveHandle = window.showSaveFilePicker({types});\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n\r\n      let handle;\r\n\r\n      saveHandle.then((handle1) => {\r\n        handle = handle1;\r\n\r\n        fname = handle.name;\r\n        console.log(\"saveHandle\", handle);\r\n        return handle.createWritable();\r\n      }).then((file) => {\r\n        let savedata = savedata_cb();\r\n\r\n        if (savedata instanceof Uint8Array || savedata instanceof DataView) {\r\n          savedata = savedata.buffer;\r\n        }\r\n\r\n        file.write(savedata);\r\n        file.close();\r\n\r\n        let path = new FilePath(handle, fname);\r\n        accept(path);\r\n      });\r\n    });\r\n  }\r\n\r\n  //returns a promise\r\n  static showSaveDialog_old(title, savedata, args = new FileDialogArgs()) {\r\n\r\n    let exts = [];\r\n\r\n    for (let list of args.filters) {\r\n      if (!Array.isArray(list) && list.filters) {\r\n        list = list.filters;\r\n      }\r\n\r\n      for (let ext of list) {\r\n        exts.push(ext);\r\n      }\r\n    }\r\n\r\n    return new Promise((accept, reject) => {\r\n      saveFile(savedata);\r\n\r\n      window.setTimeout(() => {\r\n        accept(\"undefined\");\r\n      });\r\n    });\r\n  }\r\n\r\n  //path is a FilePath instance, for web this is the actual file data\r\n  static readFile(path, mime = \"\") {\r\n    if (mime === \"\") {\r\n      mime = path.filename;\r\n      let i = mime.length-1;\r\n\r\n      while (i > 0 && mime[i] !== \".\") {\r\n        i--;\r\n      }\r\n\r\n      mime = mime.slice(i, mime.length).trim().toLowerCase();\r\n      if (mime in mimeMap) {\r\n        mime = mimeMap[mime];\r\n      }\r\n    }\r\n\r\n    return new Promise((accept, reject) => {\r\n      path.data.getFile().then((file) => {\r\n        console.log(\"file!\", file);\r\n\r\n        let promise;\r\n\r\n        if (isMimeText(mime)) {\r\n          promise = file.text();\r\n        } else {\r\n          promise = file.arrayBuffer();\r\n        }\r\n\r\n        promise.then(data => {\r\n          accept(data);\r\n        });\r\n      });\r\n    });\r\n\r\n    return new Promise((accept, reject) => {\r\n      let data = path.data;\r\n\r\n      if (isMimeText(mime)) {\r\n        let s = '';\r\n        data = new Uint8Array(data);\r\n\r\n        for (let i = 0; i < data.length; i++) {\r\n          s += String.fromCharCode(data[i]);\r\n        }\r\n\r\n        data = s;\r\n      }\r\n\r\n      accept(data);\r\n    });\r\n  }\r\n}\r\n"],"names":["window","global","visitgen","destroyAllCSS","visit","n","__visit","tagName","textContents","style","k","error","childNodes","c","document","head","body","sheet","styleSheets","i","rules","length","removeRule","eventDebugModule","start","debugEventLists","debugEventList","this","_addEventListener","EventTarget","prototype","addEventListener","_removeEventListener","removeEventListener","_dispatchEvent","dispatchEvent","onadd","onrem","ondispatch","add","type","data","push","a","arguments","event","thisvar","line","filename","replace","filepath","location","origin","ownerpath","apply","cb","args","pruneConnected","list","e","Node","isConnected","undefined","_debug_event_listeners","_disable_all_listeners","console","warn","EventSource","visualViewport","width","innerWidth","height","innerHeight","offsetLeft","offsetTop","pageLeft","pageTop","scale","Array","set","array","src","dst","count","RangeError","len","Math","min","Object","defineProperty","enumerable","configurable","Float64Array","Float32Array","Uint8Array","Uint8ClampedArray","Int32Array","Int16Array","Int8Array","reject","func","filter","item","Symbol","iterator","keystr","fract","f","floor","tent","abs","sign","pop_i","idx","Error","remove","suppress_error","indexOf","trace","String","contains","substr","search","Number","Boolean","key","token","constructor","val","lexpos","lineno","lexer","parser","value","toString","tokdef","name","regexpr","example","re","s","startsWith","endsWith","slice","trim","PUTIL_ParseError","msg","super","errfunc","tokens","lexdata","tokints","statestack","states","__main__","statedata","add_state","tok_int","push_state","state","pop_state","input","str","peeked_tokens","log","next","peek","tok","peeknext","at_end","ignore_peek","shift","ts","tlen","results","t","res","exec","index","theres","max_res","def","parse","err_on_unconsumed","ret","estr","buf","ld","l","optional","expect","tk","test_parser","basic_types","reserved_tokens","rt","has","toUpperCase","js","__iter_rt","__get_iter","__ival_rt","done","lex","p_Type","p","toLowerCase","arraytype","itername","iname","p_Array","p_Field","field","get","st","fields","p_Struct","JSON","stringify","struct_parseutil","freeze","__proto__","NStruct","id","StructEnum","T_INT","T_FLOAT","T_DOUBLE","T_STRING","T_STATIC_STRING","T_STRUCT","T_TSTRUCT","T_ARRAY","T_ITER","T_SHORT","T_BYTE","T_BOOL","T_ITERKEYS","T_UINT","T_USHORT","T_STATIC_ARRAY","T_SIGNED_BYTE","ValueTypes","Set","StructTypes","int","uint","ushort","float","double","string","static_string","struct","abstract","iter","short","byte","bool","iterkeys","sbyte","StructTypeMap","gen_tabstr","StructParser","forEach","parser$1","p_Iter","p_IterKeys","size","p_StaticArray","num","maxlength","p_Static_String","p_Abstract","tname","T_DATAREF","p_DataRef","p_ID_or_num","check","struct_parse","struct_parser","struct_typesystem","STRUCT_ENDIAN","setEndian","mode","temp_dataview","DataView","ArrayBuffer","uint8_view","buffer","unpack_context","pack_byte","pack_sbyte","pack_bytes","bytes","pack_int","setInt32","pack_uint","setUint32","pack_ushort","setUint16","pack_float","setFloat32","pack_double","setFloat64","pack_short","setInt16","encode_utf8","arr","charCodeAt","uc","decode_utf8","sum","j","fromCharCode","test_utf8","truncate_utf8","maxlen","last_codepoint","last2","incode","_static_sbuf_ss","pack_static_string","_static_sbuf","pack_string","unpack_bytes","dview","uctx","unpack_byte","getUint8","unpack_sbyte","getInt8","unpack_int","getInt32","unpack_uint","getUint32","unpack_ushort","getUint16","unpack_float","getFloat32","unpack_double","getFloat64","unpack_short","getInt16","_static_arr_us","unpack_string","slen","_static_arr_uss","unpack_static_string","struct_binpack","warninglvl","debug","_static_envcode_null","packer_debug","packer_debug_start","packer_debug_end","packdebug_tablevel","_get_pack_debug","cachering","tot","cur","static","cls","gen_tabstr$1","setWarningMode","isNaN","setDebugMode","tab","funcname","StructFieldTypes","StructFieldTypeMap","packNull","manager","toJSON","obj","fromJSON","instance","unpack_field","define","unpack","fakeFields","fmt_type","format","do_pack","typeid","pack","_ws_env","StructFieldType","StructIntField","register","StructFloatField","StructDoubleField","StructStringField","StructStaticStringField","StructStructField","stt","get_struct","write_struct","readJSON","writeJSON","dest","cls2","get_struct_cls","read_object","field2","StructTStructField","structName","_structName","struct_ids","get_struct_id","struct_cls","StructArrayField","d","type2","env","val2","_env_call","fakeField","process","exit","json","StructIterField","starti","call","StructShortField","StructByteField","StructSignedByteField","StructBoolField","StructIterKeysField","StructUintField","StructUshortField","StructStaticArrayField","structEval","eval","nGlobal","setStructEval","globalThis","globals","self","DEBUG","updateDEBUG","keys","warninglvl$1","truncateDollarSign","setTruncateDollarSign","v","_truncateDollarSign","unmangle","_static_envcode_null$1","packer_debug$1","packer_debug_start$1","packer_debug_end$1","gen_tabstr$2","update_debug_data","setWarningMode$1","setDebugMode$1","_ws_env$1","nbtoa","natob","do_pack$1","thestruct","define_empty_class","create","STRUCT","loadSTRUCT","reader","newSTRUCT","idgen","allowOverriding","structs","compiled_code","null_natives","child","parent","code","fmt_struct","bad","fromSTRUCT","obj2","concat","getOwnPropertySymbols","internal_only","no_helper_js","validateStructs","onerror","getType","throwError","formatStruct","parse_structs","defined_classes","struct2","clsmap","dummy","registerGraph","srcSTRUCT","recStruct","recArray","add_class","st2","unregister","inherit","isRegistered","hasOwnProperty","envcode","fullcode","code2","err","stack","use_helper_js","useHelperJS","t1","tinyeval","write_object","readObject","cls_or_struct_id","writeObject","toJSON$1","json2","isArray","assign","objInstance","this2","was_run","load","flen","unpackInto","makeLoader","fromJSON$1","write_scripts","nManager","include_code","buf2","i2","versionToInt","mul","versionCoerce","major","minor","micro","btoa","Buffer","atob","ver_pat","ver","split","parseInt","test","versionLessThan","b","FileParams","magic","ext","blocktypes","version","Block","type_magic","FileeError","FileHelper","params","fp","unpack_ctx","read","dataview","FileError","scripts","blocks","dviewlen","byteLength","bdata","datalen","bstruct","block","doVersions","old","write","data2","writeBase64","makeBlock","readBase64","base64","struct_filehelper","truncateDollarSign$1","setEndian$1","getEndian","setAllowOverriding","__uctx","class_or_struct_id","impl","phones","iPhone","BlackBerry","HTC","Nexus","Dell","Motorola","Samsung","LG","Sony","Asus","NokiaLumia","Micromax","Palm","Vertu","Pantech","Fly","Wiko","iMobile","SimValley","Wolfgang","Alcatel","Nintendo","Amoi","INQ","OnePlus","GenericPhone","tablets","iPad","NexusTablet","GoogleTablet","SamsungTablet","Kindle","SurfaceTablet","HPTablet","AsusTablet","BlackBerryTablet","HTCtablet","MotorolaTablet","NookTablet","AcerTablet","ToshibaTablet","LGTablet","FujitsuTablet","PrestigioTablet","LenovoTablet","DellTablet","YarvikTablet","MedionTablet","ArnovaTablet","IntensoTablet","IRUTablet","MegafonTablet","EbodaTablet","AllViewTablet","ArchosTablet","AinolTablet","NokiaLumiaTablet","SonyTablet","PhilipsTablet","CubeTablet","CobyTablet","MIDTablet","MSITablet","SMiTTablet","RockChipTablet","FlyTablet","bqTablet","HuaweiTablet","NecTablet","PantechTablet","BronchoTablet","VersusTablet","ZyncTablet","PositivoTablet","NabiTablet","KoboTablet","DanewTablet","TexetTablet","PlaystationTablet","TrekstorTablet","PyleAudioTablet","AdvanTablet","DanyTechTablet","GalapadTablet","MicromaxTablet","KarbonnTablet","AllFineTablet","PROSCANTablet","YONESTablet","ChangJiaTablet","GUTablet","PointOfViewTablet","OvermaxTablet","HCLTablet","DPSTablet","VistureTablet","CrestaTablet","MediatekTablet","ConcordeTablet","GoCleverTablet","ModecomTablet","VoninoTablet","ECSTablet","StorexTablet","VodafoneTablet","EssentielBTablet","RossMoorTablet","iMobileTablet","TolinoTablet","AudioSonicTablet","AMPETablet","SkkTablet","TecnoTablet","JXDTablet","iJoyTablet","FX2Tablet","XoroTablet","ViewsonicTablet","VerizonTablet","OdysTablet","CaptivaTablet","IconbitTablet","TeclastTablet","OndaTablet","JaytechTablet","BlaupunktTablet","DigmaTablet","EvolioTablet","LavaTablet","AocTablet","MpmanTablet","CelkonTablet","WolderTablet","MediacomTablet","MiTablet","NibiruTablet","NexoTablet","LeaderTablet","UbislateTablet","PocketBookTablet","KocasoTablet","HisenseTablet","Hudl","TelstraTablet","GenericTablet","oss","AndroidOS","BlackBerryOS","PalmOS","SymbianOS","WindowsMobileOS","WindowsPhoneOS","iOS","iPadOS","MeeGoOS","MaemoOS","JavaOS","webOS","badaOS","BREWOS","uas","Chrome","Dolfin","Opera","Skyfire","Edge","IE","Firefox","Bolt","TeaShark","Blazer","Safari","WeChat","UCBrowser","baiduboxapp","baidubrowser","DiigoBrowser","Mercury","ObigoBrowser","NetFront","GenericBrowser","PaleMoon","props","Mobile","Build","Version","VendorID","iPod","Coast","Fennec","NokiaBrowser","MQQBrowser","MicroMessenger","SamsungBrowser","Iron","Tizen","Webkit","Gecko","Trident","Presto","Goanna","Android","BREW","Java","Symbian","utils","Bot","MobileBot","DesktopMode","TV","WebKit","Console","Watch","fullPattern","shortPattern","tabletPattern","hasOwnProp","equalIC","containsIC","valueLC","convertPropsToRegExp","object","RegExp","MobileDetect","userAgent","maxPhoneWidth","ua","prepareUserAgent","_cache","FALLBACK_PHONE","FALLBACK_TABLET","FALLBACK_MOBILE","values","verPos","mobileDetectRules","substring","oss0","findMatch","findMatches","result","getVersionStr","propertyName","patterns","match","getVersion","prepareVersionNo","NaN","numbers","join","isMobileFallback","detectMobileBrowsers","isTabletFallback","prepareDetectionCache","cache","mobile","phone","tablet","phoneSized","isPhoneSized","mobileGrade","$isMobile","os","is","detectOS","getDeviceSmallerSide","screen","userAgents","versionStr","pattern","grade","_impl","module","exports","factory","amd","f64tmp","u16tmp","Uint16Array","isDenormal","_isDenormal","colormap","black","red","green","yellow","blue","magenta","cyan","teal","white","reset","grey","gray","orange","pink","brown","lightred","peach","termColorMap","termColor","termPrint","re1a","re1b","re2","endtag","s2","mintk","mini","minslice","mintype","ok","chunk","out","pop","MovingAvg","used","sample","timers","mdetect","mret","pollTimer","interval","time_ms","isMobile","navigator","SmartConsoleContext","random","sqrt","r","g","color","__console","timeInterval","timeIntervalAll","_last","last","_data","_data_length","maxCache","hash","dohash","h","WeakSet","recurse","strhash","getAllKeys","clearCache","_getData","time","_check","SmartConsole","contexts","context","tm","EmptySlot","getClassParent","iterable","searchItem","getOwnPropertyDescriptors","proto","formatNumberUI","isInt","decimals","Infinity","toFixed","performance","now","Date","getMilliseconds","color2css","merge","obja","objb","debug_cacherings","_cacherings","_clear_all_cacherings","kill_all","copy","Reflect","ownKeys","ch","_nonvector_cacherings","_stale_cacherings","sort","gen","isprivate","private","SetIter","items","freelist","equals","setb","clear","map","reduce","initial","delete","ignore_existence","HashIter","_items","_hash_null","hashtable","_keys","key2","IDGenInternalIDGen","IDGen","__cur","_debug","_internalID","isFinite","_cur","max_cur","max","get_callstack","print_stack","fetch_file","path","url","req","XMLHttpRequest","Promise","accept","open","onreadystatechange","status","readyState","response","statusText","send","_int32","x","nstructjs","MersenneRandom","seed","mt","Uint32Array","extract_number","nrandom","fill","twist","y","_mt","smallstr_hashes","hashsizes","FTAKEN","FKEY","FVAL","FTOT","FastHash","cursize","resize","table","probe","valueOf","_i","test_fasthash","ImageReader","load_image","doaccept","createElement","promise","files","FileReader","onload","target","image","Image","canvas","getContext","drawImage","idata","getImageData","readAsDataURL","click","then","digestcache","HashDigest","hashjoin","_test_hash2","tests","fromConstructor","NullItem","MapIter","ownermap","finish","itercur","_list","return","iterstack","validateId","_test_map","m","item2","UndefinedTag","IDMap","iteritem","_test_idmap","HW","HELEM","HTOT","heaplog","MinHeapQueue","iterw","heap","end","witer","w","depth","ceil","pow","swap","n1","n2","testHeapQueue","list1","Queue","initialSize","queue","enqueue","qlen","clearData","dequeue","_testQueue","steps","samples","ArrayPool","pools","Map","pool","DivLogger","elemId","maxLines","elem","lines","update","getElementById","innerHTML","description","k2","PendingTimeoutPromises","TimeoutPromise","callback","timeout","silent","accept2","_accept2","bind","reject2","_reject2","rejected","_promise","_accept","_reject","catch","wrapPromise","finally","setInterval","EulerOrders","XYZ","XZY","YXZ","YZX","ZXY","ZYX","makeCompiledVectormathCode","es6exports","doExports","classes","Vector2","Vector3","Vector4","lens","Quat","modecode","nstructjscode","indent","pad","l2","zero","internal_matrix","Matrix4","sin","cos","asin","exp","acos","atan2","atan","PI","E","DOT_NORM_SNAP_LIMIT","M_SQRT2","FLT_EPSILON","basic_funcs","negate","combine","interp","addFac","sub","div","mulScalar","divScalar","addScalar","subScalar","minScalar","maxScalar","clamp","bounded_acos","fac","pi","make_norm_safe_dot","_dot","dot","getBaseVector","BaseVector","vec","vectorsize","vectorDotDistance","vectorDistance","vectorDistanceSqr","line2","init_swizzle","Function","vectorLength","swapAxes","axis1","axis2","normalize","F64BaseVector","F32BaseVector","myclamp","toCSS","loadXYZW","z","loadXYZ","mulVecQuat","q","t0","t2","multVecMatrix","matrix","$matrix","m41","m11","m21","m31","m42","m12","m22","m32","m43","m13","m23","m33","m44","m14","m24","m34","cross","preNormalizedAngle","v2","th","_v3nd_n1_normalizedDot","_v3nd_n2_normalizedDot","_v3nd4_n1_normalizedDot4","_v3nd4_n2_normalizedDot4","preventExtensions","v1","v3","v4","$_v3nd4_n1_normalizedDot4","$_v3nd4_n2_normalizedDot4","center","$_v3nd4_n1_normalizedDot3","$_v3nd4_n2_normalizedDot3","loadXY","loadJSON","initVector3","normalizedDot","$_v3nd_n1_normalizedDot","$_v3nd_n2_normalizedDot","ignore_w","isPersp","rot2d","A","axis","initVector2","co","w2","vectorLengthSqr","_quat_vs3_temps","util.cachering","makeUnitQuat","isZero","mulQuat","qt","conjugate","dotWithQuat","q2","invert","conjugate_qt","mulscalar","nq2","mulScalarWithFactor","angle","si","last3","toMatrix","q0","q1","q3","qda","qdb","qdc","qaa","qab","qac","qbb","qbc","qcc","matrixToQuat","wmat","mat","temp_mats","r1","r2","r3","tr","axisAngleToQuat","nor","phi","rotationBetweenVecs","quatInterp","quat2","omega","sinom","sc1","sc2","quat","cosom","lookat_cache_vs3","lookat_cache_vs4","makenormalcache","lookat_cache_ms","euler_rotate_mats","preMultTemp","clone","addToHashDigest","m1","m2","loadColumn","have4","copyColumnTo","copyColumn","makeIdentity","getAsArray","getAsFloat32Array","setUniform","ctx","loc","transpose","setUniformArray","setUniformWebGLArray","uniformMatrix4fv","tmp","determinant","_determinant4x4","det","_makeAdjoint","translate","multiply","preTranslate","preMultiply","preScale","euler_rotate_order","order","xmat","ymat","zmat","euler_rotate","dec","rotate","sinA","cosA","sinA2","x2","y2","z2","flat","clearTranslation","set_w_to_one","setTranslation","resetW","makeNormalMatrix","normal","up","mm","mm2","divide","divisor","ortho","left","right","bottom","top","near","far","tx","ty","tz","frustum","B","C","D","orthographic","aspect","zscale","perspective","fovy","zNear","zFar","tan","lookat","pos","zvec","yvec","xvec","makeRotationOnly","l1","l3","alignAxis","inputs","transformMatrix","getValue","mat2","rot","decompose","axes","getAsVecs","axis3","loadFromVecs","_translate","_rotate","_scale","_skew","_perspective","rmat","_determinant2x2","_determinant3x3","a1","a2","a3","b1","b2","b3","c1","c2","c3","d1","d2","d3","a4","b4","c4","d4","__mat","testmat","PropTypes","INT","STRING","BOOL","ENUM","FLAG","FLOAT","VEC2","VEC3","VEC4","MATRIX4","QUAT","PROPLIST","STRSET","CURVE","FLOAT_ARRAY","REPORT","PropSubTypes","COLOR","PropFlags","SELECT","PRIVATE","LABEL","USE_ICONS","USE_CUSTOM_GETSET","SAVE_LAST_VALUE","READ_ONLY","SIMPLE_SLIDER","FORCE_ROLLER_SLIDER","USE_BASE_UNDO","EDIT_AS_BASE_UNIT","NO_UNDO","USE_CUSTOM_PROP_GETTER","ToolPropertyIF","subtype","apiname","uiname","flag","icon","copyTo","_fire","arg1","arg2","on","off","setValue","setStep","step","setRange","setUnit","unit","setUIRange","setIcon","StringPropertyIF","NumPropertyIF","IntPropertyIF","setRadix","radix","FloatPropertyIF","setDecimalPlaces","EnumPropertyIF","valid_values","ui_value_names","iconmap","uin","addIcons","FlagPropertyIF","Vec2PropertyIF","Vec3PropertyIF","Vec4PropertyIF","ListPropertyIF","prop","StringSetPropertyIF","definition","destructive","soft_fail","addUINames","addDescriptions","Curve1DPropertyIF","curve","FLT_EPSILONE","myfloor","normString","myToFixed","Units","Unit","unitDefine","MeterUnit","parseFloat","InchUnit","foot_re","FootUnit","parts","vft","vin","square_foot_re","SquareFootUnit","MileUnit","DegreeUnit","RadianUnit","setBaseUnit","baseUnit","setMetric","isMetric","_getBaseUnit","numre1","numre2","hexre1","hexre2","binre","expre","intre","isnumber","parseValueIntern","base","getUnit","validate","toInternal","fromInternal","parseValue","displayUnit","isNumber","PixelUnit","convert","unita","unitb","buildString","decimalPlaces","_parseValueTest","_buildStringTest","config","doubleClickTime","autoLoadSplineTemplates","doubleClickHoldTime","setConfig","modalstack","singleMouseCBs","Screen","ContextAreaClass","debugDomEvents","cbsymbol","thsymbol","init","et","getkey","options","singletonMouseEvents","ddd","testSingleMouseUpEvent","singleMouseEvent","_mpos","doSingleCbs","touches","pageX","pageY","copyEvent","util.print_stack","capture","isLeftClick","button","DoubleClickHandler","down","dblEvent","start_mpos","_on_mouseup","_on_mousemove","mdown","mpos","devicePixelRatio","mousedown","isMouseDown","cpy","util.time_ms","cconst","ondblclick","abort","buttons","pathDebugEvent","extra","__prevdef","preventDefault","__stopprop","stopPropagation","eventWasTouch","sourceCapabilities","firesTouchEvents","was_touch","TouchEvent","PointerEvent","pointerType","getOwnPropertyNames","original","_setScreenClass","findScreen","rec","_setModalAreaClass","pushPointerModal","pointerId","autoStopPropagation","pushModalLight","handlers","last_mpos","touchmap","touchstart","touchmove","touchend","touchcancel","handleAreaContext","sarea","findScreenArea","area","push_ctx_active","pop_ctx_active","make_default_touchhandler","domEvents","e2","clientX","clientY","screenX","screenY","make_handler","found","handler","settings","passive","make_pointer","pointer","setPointerCapture","popModalLight","lock","modalEvents","unlock","releasePointerCapture","haveModal","_findScreen","_haveModal","keymap_latin_1","Space","Escape","Enter","Return","Up","Down","Left","Right","Num0","Num1","Num2","Num3","Num4","Num5","Num6","Num7","Num8","Num9","Home","End","Delete","Backspace","Insert","PageUp","PageDown","Tab","NumPlus","NumMinus","Shift","Ctrl","Control","Alt","keymap_latin_1_rev","keymap","reverse_keymap","HotKey","modifiers","action","mods","api","execTool","KeyMap","hotkeys","pathid","hk","handle","util.set","shiftKey","altKey","ctrlKey","commandKey","keyCode","EventDispatcher","_cbs","_fireEvent","stop","copyMouseEvent","_orig","exclude","DomEventTypes","on_mousemove","on_mousedown","on_mouseup","on_touchstart","on_touchcancel","on_touchmove","on_touchend","on_mousewheel","on_keydown","on_keyup","on_pointerdown","on_pointermove","on_pointercancel","on_pointerup","getDom","dom","eventtype","modalStack","isModalHead","owner","EventHandler","_modalstate","simple_events.pushPointerModal","pushModal","_is_root","simple_events.pushModalLight","popModal","simple_events.popModalLight","CurveConstructors","CURVE_VERSION","CurveFlags","TangentModes","SMOOTH","BREAK","getCurve","throw_on_error","_udigest","util.HashDigest","CurveTypeData","typeName","hasGUI","calcHashKey","digest","redraw","makeGUI","container","killGUI","evaluate","integrate","s1","quadSteps","ds","derivative","df","derivative2","inverse","best","mid","y1","ymid","onActive","draw_transform","onInactive","destroy","_on_change","draw","evalHermiteTable","genHermiteTable","lastdv1","lastf3","eps","dt","f2","f3","dv1","j2","vectormath.Vector2","SplineTemplates","CONSTANT","LINEAR","SHARP","SQRT","SMOOTHER","SHARPER","SPHERE","REVERSE_LINEAR","GUASSIAN","templates","SplineTemplateIcons","RecalcFlags","BASIS","FULL","ALL","FULL_BASIS","mySafeJSONStringify","mySafeJSONParse","bin_cache","_bin_cache","eval2_rets","bez3","bez4","binomial","bin","Curve1DPoint","rco","sco","startco","eid","tangent","seal","deg","splineCache","BSplineCache","curves","maxCurves","limit","cache_w","curve2","_last_cache_key","updateKnots","regen_basis","regen_hermite","_remove","_splineCache","BSplineCurve","_last_update_key","fastmode","points","interpolating","range","_ps","hermite","recalc","basis_tables","eidgen","util.IDGen","uidata","p2","p1","no_update","_sortPoints","hightlight","basis","_basis","empty","_evaluate","f4","solve_interpolating","_evaluate2","error1","orig","totgs","ps","safe_inv","bas","kn","knn","knn1","ki","start_t","ret1","ret2","f1","totbasis","sumx","sumy","_wrapTouchEvent","isTouch","loadTemplate","templ","drawTransform","transpoints","transforming","draw_trans","bstrip","row","strip","makebutton","iconbutton","iconsheet","customIcon","fullUpdate","Icons","getIconEnum","TINY_X","slider","simpleslider","checked","onchange","panel","xmin","xmax","ymin","ymax","closed","after","start_transform","transform_mpos","do_highlight","highlight","minp","mindis","limitsqr","dx","dy","dis","do_transform","getClientRects","dpi","trans","end_transform","_save_hook","save","lineWidth","beginPath","fillStyle","rect","restore","makeSplineTemplateIcons","moveTo","lineTo","ls","lineCap","strokeStyle","stroke","toDataURL","img","splineTemplatesLoaded","initSplineTemplates","_SplineTemplateIcons","setTimeout","feq","EquationCurve","equation","_last_equation","textbox","label","gui","updateTextBox","text","_haserror","cosh","sinh","cbrt","GuassianCurve","offset","deviation","hslider","oslider","dslider","Ease","linear","none","amount","getPowIn","getPowOut","getPowInOut","quadIn","quadOut","quadInOut","cubicIn","cubicOut","cubicInOut","quartIn","quartOut","quartInOut","quintIn","quintOut","quintInOut","sineIn","sineOut","sineInOut","getBackIn","backIn","getBackOut","backOut","getBackInOut","backInOut","circIn","circOut","circInOut","bounceIn","bounceOut","bounceInOut","getElasticIn","amplitude","period","pi2","elasticIn","getElasticOut","elasticOut","getElasticInOut","elasticInOut","ParamKey","BOOL_FLAG","SimpleCurveBase","defaultval","_saveParams","pdef","pair","BounceCurve","decay","freq","phase","ElasticCurve","_func","_last_hash","EaseCurve","mode_in","mode_out","amp","RandCurve","util.MersenneRandom","_seed","in_mode","Curve1D","uiZoom","generators","VERSION","setGenerator","generatorType","active","_fastmode","gen1","gen2","buf1","active_generator","localeCompare","getGenerator","switchGenerator","sz","overlay_curvefunc","_active","NumberConstraintsBase","IntegerConstraints","util.list","FloatConstrinats","NumberConstraints","first","setPropTypes","types","customPropertyTypes","PropClasses","customPropTypeBase","wordmap","sel","unsel","defaultRadix","defaultDecimalPlaces","OnceTag","ToolProperty","PROP_TYPE_ID","wasSet","icon2","callbacks","lastc","ischar","upper","lower","subst","word","logBase","report","util.termColor","setDescription","setUIName","calcMemSize","strlen","saveLastValue","clearEventCallbacks","once","cb2","uiRange","getStep","stepIsRelative","calcRelativeStep","setRelativeStep","noUnits","setDisplayUnit","setFlag","setIcon2","FloatArrayProperty","StringProperty","multiLine","internalRegister","NumProperty","_NumberPropertyBase","slideSpeed","expRate","ui_range","setSlideSpeed","setExpRate","IntProperty","ReportProperty","BoolProperty","FloatProperty","EnumKeyPair","key_is_int","val_is_int","EnumProperty","string_or_int","descriptions","makeUIName","iconmap2","calcHash","updateDefinition","enumdef_or_prop","enumdef","addIcons2","api_update","_loadMap","_saveMap","_values","_ui_value_names","_iconmap","_iconmap2","_descriptions","data_is_int","_is_data_int","FlagProperty","bitmask","VecPropertyBase","hasUniformSlider","uniformSlider","Vec2Property","Vec3Property","isColor","Vec4Property","QuatProperty","Mat4Property","ListProperty","psize","prop1","prop2","getListItem","setListItem","StringSetProperty","Curve1DProperty","ScreenClass","setScreenClass","getAreaIntName","AreaTypes","TEST_CANVAS_EDITOR","setAreaTypes","areaclasses","theWrangler","AreaWrangler","stacks","lasts","lastArea","locked","_last_screen_id","makeSafeContext","wrangler","Proxy","contextWrangler","stack1","_checkWrangler","_id","findInstance","pushLastRef","ClassIdSymbol","updateLastRef","getLastArea","css2matrix","DOMMatrix","matrix2css","dtvtmps","quad_co_rets2","quad_bilinear","u","quad_uv_2d","u1","u2","v2x","v2y","v3x","v3y","v4x","v4y","C1","C2","ClosestModes","CLOSEST","START","END","ENDPOINTS","advs","AbstractCurve","curvature","ClosestCurveRets","cvrets","cvarrays","util.ArrayPool","cvtmp","closestPoint","poly_normal_tmps","pncent","normal_poly","vs","normal_tri","normal_quad","cent","barycentric_v2_rets","calc_proj_refs","dihedral_v3_sqr","bx","by","bz","cx","cy","cz","dz","tet_area_tmps","tet_volume","calc_projection_axes","no","ax","ay","az","_avtmps","inrect_3d","aabb_isect_line_3d","inside","closest_point_on_line","aabb_isect_cylinder_3d","radius","barycentric_v2","_linedis2","v1x","v1y","v1z","v2z","closest_p_tri_rets","uv","dist","cpt_v1","cpt_v2","cpt_v3","cpt_v4","cpt_v5","cpt_v6","cpt_p","cpt_n","cpt_mat","cpt_mat2","cpt_b","closest_point_on_quad","uvw","closest_point_on_tri","ax1","ax2","op","ax3","dist_to_tri_v3_old","planedis","p3","pp","tmp2","linedis3d","point_in_tri","dist_to_tri_v3","_dt3s_n","dist_to_tri_v3_sqr","nx","ny","nz","feps","bx2","by2","cx2","cy2","x1","z1","s3","mask","lx","ly","lz","tri_area_temps","tri_area","aabb_overlap_area","pos1","size1","pos2","size2","aabb_isect_2d","aabb_isect_3d","aabb_intersect_vs","aabb_intersect_rets","aabb_intersect_2d","test_aabb_intersect_2d","setAttribute","appendChild","position","clearRect","timer","_timer","clearInterval","rate","aabb_intersect_vs3","aabb_intersect_3d","min1","max1","min2","max2","aabb_union","aabb_union_2d","init_prototype","$_mh","$_swapt","COLINEAR","LINECROSS","COLINEAR_ISECT","_cross_vec1","_cross_vec2","SQRT2","FEPS_DATA","F16","F32","F64","FEPS","FLOAT_MIN","FLOAT_MAX","Matrix4UI","_static_grp_points4","_static_grp_points8","get_rect_points","cs","get_rect_lines","$vs_simple_tri_aabb_isect","simple_tri_aabb_isect","isect","MinMax","totaxis","_min","_max","_static_mr_co","_static_mr_cs","minmax_rect","minmax","winding_axis","up_axis","xaxis","yaxis","x3","winding","zero_z","tol","inrect_2d","$smin_aabb_isect_line_2d","$ssize_aabb_isect_line_2d","$sv1_aabb_isect_line_2d","$ps_aabb_isect_line_2d","$l1_aabb_isect_line_2d","$smax_aabb_isect_line_2d","$sv2_aabb_isect_line_2d","$l2_aabb_isect_line_2d","aabb_isect_line_2d","line_line_cross","expand_rect2d","margin","expand_line","colinear","_llc_l1","_llc_l2","_llc_l3","_llc_l4","lli_v1","lli_v2","lli_v3","lli_v4","_zero_cn","_tmps_cn","_rets_cn","corner_normal","vec1","vec2","line_line_isect","test_segment","xa1","xa2","ya1","ya2","xb1","xb2","yb1","yb2","w1","w3","w4","_asi_v1","_asi_v2","_asi_v3","_asi_v4","_asi_v5","_asi_v6","point_in_aabb_2d","_asi2d_v1","_asi2d_v2","_asi2d_v3","_asi2d_v4","_asi2d_v5","_asi2d_v6","aabb_sphere_isect_2d","mvec","dist_to_line_2d","point_in_aabb","asi_rect","aabb_sphere_isect_vs","aabb_sphere_isect","i3","aabb_sphere_dist","convex_quad","$e1_normal_tri","$e3_normal_tri","$e2_normal_tri","isNum","_normal_tri_rets","y3","z3","$n2_normal_quad","_q1","_q2","_q3","normal_quad_old","_len","_li_vi","line_isect","calc_t","vi","dt2l_v1","dt2l_v2","dt2l_v3","dt2l_v4","dt2l_v5","clip","closest_co_out","t_out","dt3l_v1","dt3l_v2","dt3l_v3","dt3l_v4","dt3l_v5","dist_to_line_sqr","px","py","pz","len2","dist_to_line","_cplw_vs4","_cplw_vs3","_cplw_vs2","wclip","znear","clip_line_w","_v1","_v2","zfar","doclip1","doclip","dozclip","_closest_point_on_line_cache","_closest_point_rets","_closest_tmps","_circ_from_line_tan_vs","_circ_from_line_tan_ret","circ_from_line_tan","_circ_from_line_tan2d_vs","_circ_from_line_tan2d_ret","circ_from_line_tan_2d","tanx1","tany1","div2","midx","midy","_gtc_e1","_gtc_e2","_gtc_e3","_gtc_p1","_gtc_p2","_gtc_v1","_gtc_v2","_gtc_p12","_gtc_p22","_get_tri_circ_ret","get_tri_circ","e1","e3","gen_circle","stfeps","verts","make_vert","make_edge","makeCircleMesh","gl","mesh","Mesh","verts1","verts2","make_face_complex","minmax_verts","__iter_v","__ival_v","unproject","ipers","iview","newvec","project","pers","view","_sh_minv","_sh_maxv","_sh_start","_sh_end","static_cent_gbw","get_boundary_winding","divideScalar","totw","round","PlaneOps","reset_axis","orig1","orig2","_isrp_ret","isect_ray_plane_rets","isect_ray_plane","planeorigin","planenormal","rayorigin","raynormal","po","pn","ro","rn","_old_isect_ray_plane","mesh_find_tangent","viewvec","offvec","projmat","selected","vset","eset","__iter_e","edges","__ival_e","other_vert","tanav","evec","co2","Mat4Stack","update_func","set_internal_matrix","identity","loadIdentity","tril_rets","lreport","trilinear_v3","boxverts","a1x","a1y","a1z","b1x","b1y","b1z","c1x","c1y","c1z","d1x","d1y","d1z","a2x","a2y","a2z","b2x","b2y","b2z","c2x","c2y","c2z","d2x","d2y","d2z","tril_co_rets","tril_co_tmps","tril_mat_1","tril_mat_2","wtable","pih_tmps","boxfaces_table","boxfaces_tmp","boxfacenormals_tmp","point_in_hex","boxfacecents","boxfacenormals","boxverts_tmp","trilinear_co","t3","du","dv","dw","bv","trilinear_co2","grad","totg","axis_error","angle_tri_v3_rets","angle_tri_v3_vs","tri_angles","th1","th2","th3","_clipdata","mime","_clipboards","clipboard","blob","Response","getClipboardData","desiredMimes","setClipboardData","ClipboardItem","Blob","colorSchemeType","docManualPath","useNumSliderTextboxes","numSliderArrowLimit","simpleNumSliders","menusCanPopupAbove","menu_close_time","paranoidEvents","screenborders","areaContextPushes","allBordersMovable","doOnce","areaConstraintSolver","datapaths","domEventAddRemove","debugUIUpdatePerf","screenAreaPosSizeAccesses","buttonEvents","addHelpPickers","useAreaTabSwitcher","autoSizeUpdate","showPathsInToolTips","enableThemeAutoUpdate","loadConstants","ctrlconfig.setConfig","cfg","innerText","compatMap","BoxMargin","BoxBG","BoxRadius","background","defaultWidth","defaultHeight","DefaultWidth","DefaultHeight","BoxBorder","BoxLineWidth","BoxSubBG","BoxSub2BG","DefaultPanelBG","InnerPanelBG","Background","numslider_width","numslider_height","ColorSchemeTypes","LIGHT","DARK","parsepx","css","alpha_override","css2color_rets","basic_colors","purple","color2web","tostr","css2color","part","web2color","validate_pat","validateWebColor","validate_rgba","validate_rgb","validateCSSColor","rgba","theme","invertTheme","inverted","bg","CSSFont","iscolor","setColorSchemeType","_digest","_size","font","weight","variant","calcHashUpdate","util.isMobile","mobileTextSizeMultiplier","genCSS","genKey","exportTheme","theme1","addVarDecl","sortkeys","writekey","maxwid","_exportTheme","Task","taskcb","task","AnimManager","tasks","timeOut","dead","onend","AbstractCommand","cbs","end_cbs","animator","WaitCommand","ms","GoToCommand","startValue","SetCommand","Command","Animator","method","on_tick","commands","_done","wait","goto","timeMs","cmd","while","donecb","lexlen","PUTLParseError","peek_i","userdata","DataFlags","USE_FULL_UNDO","DataTypes","DYNAMIC_STRUCT","PROP","ARRAY","propCacheRings","getTempProp","getClass","DataPathError","getVecClass","proptype","isVecProperty","toolprop_abstract.Vec2PropertyIF","toolprop_abstract.Vec3PropertyIF","toolprop_abstract.Vec4PropertyIF","toolprop.Vec2Property","toolprop.Vec3Property","toolprop.Vec4Property","DataPath","noUndo","setProp","readOnly","read_only","customPropCallback","propGetter","customGetSet","_getValue","_setValue","getSet","dataref","datapath","customSet","customGet","simpleSlider","rollerSlider","editAsBaseUnit","uiNameGetter","ui_name_get","speed","relativeStep","fullSaveUndo","icons","icons2","description_map","uiNames","uinames","StructFlags","ListIface","getStruct","getKey","getActive","setActive","getIter","ToolOpIface","toolpath","is_modal","outputs","DataAPIClass","setImplementationClass","registerTool","ToolClasses","setContextClass","_ToolClasses","ToolFlags","UndoFlags","IS_UNDO_ROOT","UNDO_BARRIER","HAS_UNDO_DATA","InheritFlag","slots","defaultUndoHandlers","undoPre","undo","setDefaultUndoHandlers","ToolPropertyCache","pathmap","accessors","userSetMap","dstruct","_buildAccessors","tdef","_getFinalToolDef","partial","pathk","mapStruct","dpath","_getAccessor","tooldef","useDefault","getPropKey","ToolMacro","SavedToolDefaults","ToolOp","events.EventHandler","_overdraw","__memsize","undoflag","getSlots","lastp","slots2","dinputs","doutputs","hasDefault","getDefault","message","drawlines","getInputs","tool","_regWithNstructjs","toolop","canRun","onUndoDestroy","calcUndoMem","loadDefaults","force","toolprop","saveDefaultInputs","genToolString","modalEnd","redo","_was_redo","execPre","execPost","exec_pre","resetTempGeom","modal_ctx","dl","getOverdraw","makeTempLine","node","modalStart","modalRunning","toolCancel","was_cancelled","_on_cancel","outs","ins","_save_inputs","PropKey","_save_outputs","MacroLink","sourcetool_idx","srckey","srcprops","desttool_idx","dstkey","dstprops","source","sourceProps","destProps","sourcePropKey","destPropKey","MacroClasses","_MacroClasses","macroidgen","tools","curtool","has_modal","connects","connectLinks","_macro_class","_getTypeClass","ready","__tooldef","_macroTypeId","connect","srctool","srcoutput","dsttool","dstinput","connectCB","i1","_do_connections","on_modal_end","ToolStack","memLimit","enforceMemLimit","_undo_branch","limitMemory","maxmem","setRestrictedToolContext","toolctx","execOrRedo","compareInputs","Equals","rerun","tctx","toLocked","execCtx","modal_running","rewind","replay","onStep","_stack","_save","buildToolSysAPI","registerWithNStructjs","rootCtxStruct","datastruct","_testToolStackIO","_appstate","toolstack","ToolPaths","initToolPaths_run","buildParser","valid_datatypes","STRLIT","NUMBER","keyword","Parser","parseToolPath","check_tool_exists","initToolPaths","startstr","toolclass","testToolParser","ModelInterface","prefix","getToolDef","getToolPathHotkey","createTool","constructor_argument","pushReportContext","popReportContext","massSetProp","mass_set_path","resolveMassSetPaths","resolvePath","ignoreExistence","rootStruct","subkey","use_range","ival","getDescription","rdef","validPath","getPropName","DataPathSetOp","propType","_undo","dataPath","flagBit","useFlagBit","hadError","massSetPath","destType","value2","hashThis","__ctx","paths","parseutil.PUTLParseError","parseutil.tokdef","parseutil.lexer","pathParser","parseutil.parser","parserStack","tool_classes","tool_idgen","toolkey","ToolID","lt","lastmsg","lcount","reportstack","pushReportName","util.console","popReportName","DataList","getLength","DataStruct","members","inheritFlag","dynamicStruct","default_struct","existing_struct","getter","setter","color3","vec3","toolprop.PropSubTypes","color4","vec4","arrayList","structdef","redraw_viewport","color3List","vectorList","color4List","pstruct","toolprop.BoolProperty","toolprop.FloatProperty","textblock","toolprop.StringProperty","toolprop.ReportProperty","toolprop.IntProperty","curve1d","toolprop.Curve1DProperty","enum","toolprop.EnumProperty","funcs","flags","toolprop.ToolProperty","toolprop.FlagProperty","fromToolProp","_map_struct_idgen","_map_structs","_debug__map_structs","_dummypath","DummyIntProperty","CLS_API_KEY","CLS_API_KEY_CUSTOM","DataAPI","rootContextStruct","getStructs","setRoot","sdef","hasStruct","mergeStructs","inheritStruct","auto_create_parent","_addClass","mapStructCustom","auto_create","suffix","applyFilter","$","inpath","resolvePath_intern","newprop","datactx","lastobj2","lastkey","lastdpath","lastobj","p_key","dynstructobj","act","actkey","fakeprop","val1","bitfield","resolvePathOld2","splitchars","parent1","parent2","arg","retpath","_path","resolvePathold","_stripToolUIName","uiNameOut","getToolPathHotkey_intern","searchKeymap","sareas","getActiveArea","getKeyMaps","parseToolArgs","tpath","invoke","initSimpleController","dpt","getDataPathToolOp","setDataPathToolOp","rgb_to_hsv_rets","rgb_to_hsv","computedH","computedS","computedV","minRGB","maxRGB","hsv_to_rgb_rets","hsv_to_rgb","RgbF_Create","rgb_to_cmyk_rets","cmyk_to_rgb_rets","cmyk_to_rgb","rgb_to_cmyk","M","Y","var_K","K","DefaultTheme","AreaHeaderBG","BasePackFlag","BoxDepressed","BoxHighlight","DefaultText","LabelText","TitleText","oneAxisPadding","padding","disabled","pressed","checkbox","CheckSide","colorfield","circleSize","colorBoxHeight","fieldSize","hueHeight","colorpickerbutton","curvewidget","CanvasBG","CanvasHeight","CanvasWidth","dropbox","dropTextBG","depressed","iconcheck","drawCheck","listbox","ListActive","ListHighlight","menu","MenuBG","MenuBorder","MenuHighlight","MenuSeparator","border","MenuSpacing","MenuText","notification","ProgressBarBG","ProgressBar","numslider","numslider_simple","SlideHeight","TextBoxWidth","labelOnTop","numslider_textbox","TextBoxHeight","HeaderBorderRadius","HeaderRadius","TitleBackground","TitleBorder","richtext","screenborder","scrollbars","color2","contrast","sidebar","tabs","TabActive","TabBarRadius","TabHighlight","TabInactive","TabStrokeStyle1","TabStrokeStyle2","TabText","tooltip","ToolTipText","treeview","itemIndent","rowHeight","vecPopupButton","setIconMap","FOLDER","FILE","SMALL_PLUS","SMALL_MINUS","UNDO","REDO","HELP","UNCHECKED","CHECKED","LARGE_CHECK","CURSOR_ARROW","NOTE_EXCL","SCROLL_DOWN","SCROLL_UP","BACKSPACE","LEFT_ARROW","RIGHT_ARROW","UI_EXPAND","UI_COLLAPSE","BOLD","ITALIC","UNDERLINE","STRIKETHRU","TREE_EXPAND","TREE_COLLAPSE","ZOOM_OUT","ZOOM_IN","ENUM_CHECKED","ENUM_UNCHECKED","UIBase","_setUIBase","uibase","AspectKeys","_ui_base","TextBox","initAspectClass","blacklist","validProperty","descr","getOwnPropertyDescriptor","__aspect_methods","AfterAspect","clearAspectCallbacks","chain","chain2","root","_method","isDead","_method_bound","_checkbind","before","_setTextboxClass","ElementClasses","__cconst","vectormath.Vector4","Area","_setAreaClass","ErrorColors","WARNING","ERROR","OK","__theme","registered_has_happened","tagPrefix","EventCBSymbol","calcElemCBKey","setTagPrefix","getTagPrefix","class_idgen","setTheme","theme2","k3","_last_report","IsMobile","marginPaddingCSSKeys","_IconManager","tilesize","number_of_horizontal_tiles","drawsize","tilex","customIcons","onReady","util.TimeoutPromise","canvasDraw","getDPI","setCSS","fitsize","getCSS","ratio","blobUrl","CustomIcon","baseImage","images","regenIcons","doSheet","toBlob","URL","createObjectURL","iconsheets","IconManager","sizes","horizontal_tile_count","customIconIDMap","mobileSizeMultiplier","isReady","addCustomIcon","maxid","manager2","findSheet","findClosestSheet","sheets","minsheet","goal","getTileSize","getRealSize","iconmanager","_iconmanager","IconSheets","SMALL","LARGE","XLARGE","iconSheetFromPackFlag","PackFlags","CUSTOM_ICON_SHEET","CUSTOM_ICON_SHEET_START","SMALL_ICON","getIconManager","setIconManager","IconSheetsOverride","makeIconDiv","icontest","vectormath.Matrix4","dpistack","UIFlags","internalElementNames","externalElementNames","INHERIT_WIDTH","INHERIT_HEIGHT","VERTICAL","LARGE_ICON","FORCE_PROP_LABELS","PUT_FLAG_CHECKS_IN_COLUMNS","WRAP_CHECKBOXES","STRIP_HORIZ","STRIP_VERT","STRIP","SIMPLE_NUMSLIDERS","HIDE_CHECK_MARKS","NO_NUMSLIDER_TEXTBOX","NO_UPDATE","_mobile_theme_patterns","_idgen","styleScrollBars","selector","inv","_testSetScrollbars","CTX","mergeGlobalCSS","calcThemeKey","_themeUpdateKey","flagThemeUpdate","HTMLElement","_modalstack","_tool_tip_abort_delay","_tooltip_ref","_textBoxEvents","_themeOverride","_checkTheme","_last_theme_update_key","_client_disabled_set","_useNativeToolTips","useNativeToolTips","_useNativeToolTips_set","_has_own_tooltips","_tooltip_timer","pathUndoGen","_lastPathUndoGen","_useDataPathUndo","_active_animations","_screenStyleTag","_screenStyleUpdateHash","shadow","attachShadow","__cbs","_appendChild","parentWidget","_wasAddedToNodeAtSomeTime","visibleToPick","_override_class","tagname","default_overrides","my_default_overrides","class_default_overrides","_last_description","_description_final","_modaldata","packflag","_internalDisabled","__disabledState","_disdata","_ctx","_description","textContent","_getFont","_init_done","do_touch","MouseEvent","_parentWidget","useDataPathUndo","hasAttribute","getAttribute","title","__background","overrideDefault","__updateDisable","internalDisabled","_forEachChildWidget","_reportCtxName","element","customElements","internal","setUndo","hide","sethide","hidden","contents","unhide","findArea","_cb2","connectedCallback","noMarginsOrPadding","regenTabOrder","getScreen","needsTabRecalc","noMargins","noPadding","getTotalRect","doaabb","rs","parseNumber","units.parseValue","formatNumber","units.buildString","setBoxCSS","getSubDefault","genBoxCSS","boxcode","setBG","zoom","getZoom","transform","transform2","flushSetCSS","_init","replaceChild","newnode","swapWith","parentNode","getPos","tmp1","insertBefore","ptmp","traverse","type_or_set","is_set","_clipboardHotkeyInit","_clipboard_over","_last_clipboard_keyevt","_clipboard_keystart","_clipboard_events","_clipboard_keydown","_clipboard_keyend","internal_mode","is_copy","is_paste","pickElement","checkTree","pasteForAllChildren","copyForAllChildren","clipboardCopy","clipboardPaste","tabIndex","havePickClipboard","_ondestroy","ondestroy","trigger_on_destroy","on_remove","removeChild","flushUpdate","checkInit","getWinWidth","getWinHeight","calcZ","marginy","nodeclass","excluded_classes","marginx","mouseEvent","isMouseMove","sx","sy","scrollX","scrollY","elementFromPoint","lastelem","reverse","getBoundingClientRect","clip2","math.aabb_intersect_2d","defaults","on_disabled","on_enabled","changed","pointerElem","_areaWrangler","bindFunc","handlers2","_flash_focus","focus","flash","rect_element","timems","autoFocus","csscolor","_flashtimer","_flashcolor","tick","PositionKey","_enterPopupSafe","_exitPopupSafe","on_resize","newsize","getPathValue","undoBreakPoint","setPathValueUndo","setPathValue","getPathMeta","getPathDescription","_doOnce","_doOnce_reqs","zindex","positionKey","_ensureChildrenCtx","checkThemeUpdate","abortToolTips","delayMs","stop_timer","updateToolTipHandlers","start_timer","reset_timer","start_events","reset_events","stop_events","bind_handler","etype","lists","updateToolTips","_ToolTip","show","subclassChecksTheme","saveData","loadData","localOnly","overrideClass","overrideClassDefault","_doMobileDefault","hasClassDefault","backupkey","checkForMobile","getDefault_intern","getClassDefault","getStyleClass","parentStyle","overrideTheme","getStyle","animate","_extra_handlers","update_trans","background_get","background_set","dx_get","dx_set","dy_get","dy_set","pixkeys","makePixHandler","proxy","receiver","anim","abortAnimations","drawRoundBox2","drawRoundBox","no_clear","_background","quadraticCurveTo","closePath","_getFont_new","do_dpi","getFont","_ensureFont","_mc","get_measure_canvas","measureTextBlock","measureText","HTMLCanvasElement","drawText","fillText","PIDX","PSHADOW","PTOT","saveUIData","ni","is_shadow","path2","_ui_version","loadUIData","_saveUIData","_loadUIData","aspect._setUIBase","events.keymap","toolprop.PropTypes","ui_base.UIBase","ui_base.PackFlags","ui_base.IconSheets","ui_base.parsepx","ButtonEventBase","_auto_depress","_highlight","_pressed","bindEvents","depress","_redraw","onclick","_onpress","onpress","captured","blur","_focus","Button","_last_name","_last_disabled","updateDisabled","OldButton","_last_but_update_key","_name","_namePad","_leftPad","_rightPad","_last_w","_last_h","_last_dpi","_lastw","_lasth","_last_bg","updateName","updateWidth","old_bindEvents","_repos_canvas","updateDefaultSize","_calcUpdateKey","updateDPI","tw","ui_base.measureText","_genLabel","updateBorders","lwid","w_add","h2","_getSubKey","draw_text","ui_base.drawRoundBox","lw","_draw_text","ui_base.drawText","TextBoxBase","modalKeyEvents","_width","_had_error","_change","oninput","isModal","_startModal","_modal","_endModal","realtime","keydown","on_keypress","_updatePathVal","updateDataPath","is_num","is_int","select","_prop_update","units.isNumber","ui_base.ErrorColors","checkForTextBox","draggable","nodes","ui_base._setTextboxClass","IconLabel","_icon","ui_base.iconmanager","ValueButtonBase","_value","Check","_checked","span","mup","mover","mleave","_label","prepend","_updatekey","csize","ui_base.Icons","ui_base.getIconManager","updatekey","IconButton","_customIcon","_draw_pressed","_icon_pressed","drawButtonBG","_extraIcon","extraDom","_last_iconsheet","domImage","_on_press","_on_depress","pstyle","hstyle","loadstyle","addpx","high","unhigh","_getsize","IconCheck","_drawCheck","updateDrawCheck","_updatePressed","noEmboss","Check1","saveFile","exts","loadFile","file","readAsArrayBuffer","_testLoadFile","_testSaveFile","createFile","getpx","debugmenu","Menu","parentMenu","_was_clicked","autoSearchMode","_ignoreFocusEvents","closeOnMouseUp","_submenu","ignoreFirstClick","itemindex","started","activeItem","menustyle","buildStyle","maxx","maxy","_isMenu","onselect","close","menuWrangler","popMenu","onclose","_popup","_select","dir","hasSearchBox","scrollIntoView","selectPrev","selectNext","start_fancy","startFancy","pushMenu","dom2","sbox","dokey","addItemExtra","hotkey","icon_div","ui_base.makeIconDiv","ui_base.getFont","hwid","twid","hotkey_span","addItem","li","_menu","onfocus","_getBorderStyle","pad1","boxShadow","sepcss","itemRadius","seperator","bar","calcSize","SEP","DropBox","lockTimer","_template","_searchMenuMode","_last_datapath","searchMenuMode","template","setDefault","wasError","_last_dbox_key","_build_menu_template","createMenu","_build_menu","_dropbox","valmap","enummap","uimap","desr","uk","callProp","_convertVal","rects","rheight","haveElectron","con","popup","ui_base.drawRoundBox2","setLabelOnly","MenuWrangler","menustack","lastPickElemTime","_closetimer","closereq","closetimer","spawnreq","endMenus","searchKeyDown","previousElementSibling","nextElementSibling","findMenu","menu2","closetime","startTimer","stopTimer","wrangerStarted","startMenuEventWrangling","setWranglerScreen","getWranglerScreen","doItem","id2","cbfunc","startMenu","safetyDelay","_ui","toolprop.PropFlags","Label","_lastText","_font","fontDefaultName","_updateFont","_enabled_font","_last_font","Container","dataPrefix","massSetPrefix","inherit_packflag","styletag","reversed","_prefixstack","_mass_prefixstack","children","changePathPrefix","newprefix","_joinPrefix","pushMassSetPrefix","pushDataPrefix","popDataPrefix","popMassSetPrefix","scrollTop","scrollLeft","scrollTo","useIcons","enabled_or_sheet","enabled","previous","wrap","rest","themeClass","margin1","margin2","horiz","RowFrame","col","bradius","bline","bstyle","bcolor","oneAxisMargin","axisPadding","otherPadding","setMargin","setPadding","setSize","saveVisibility","localStorage","storagePrefix","loadVisibility","opened","redrawCurves","listen","on_destroy","_prepend","_add","insert","NodeList","dynamicMenu","dbox","_container_inherit","toolPanel","path_or_cls","createCb","create_cb","defaultsPath","packflag_or_args","toolob","pathlabel","helppicker","hintPickerTool","colorbutton","_getMassPath","noteframe","vecpopup","textarea","thdis","checkenum","listenum","col1","col2","wrapChars","isrow","rebuild","last_hash","frame","checks","ignorecb","makecb","checkenum_panel","enumDef","getroot","do_redraw","simple","setHeaderToolTip","twocol","parentDepth","colorPicker","themeOverride","colorpicker","viewer","asDialogFooter","ColumnFrame","TwoColumnFrame","_colWidth","colWidth","Note","_noteid","showExclMark","append","setLabel","mark","ntext","clr","ProgBarNote","_percent","barWidth","bar2","percent","NoteFrame","ui.RowFrame","_h","noteframes","progbarNote","note","addNote","getNoteFrames","sendNote","ui_base.color2css","warning","_sendNote","RichEditor","textOnlyMode","controls","makeicon","execCommand","contentEditable","toggleStrikeThru","ta","getSelection","startNode","getRangeAt","anchorNode","anchorOffset","InputEvent","CustomEvent","formatStart","formatLine","formatEnd","rc","RichViewer","hideScrollBars","showScrollBars","textTransform","VectorPopupButton","VectorPanel","sliders","makeParam","_getNumParam","_setNumParam","__range","_range","vp","uslider","uniformValue","vertical","doupdate","meta","loadNumParam","do_rebuild","ToolTip","_start_time","_estimateSize","ui_base.measureTextBlock","bwidth","toolstack_getter","registerToolStackGetter","vectormath.Vector3","simple_toolsys.UndoFlags","simple_toolsys.ToolFlags","ToolBase","simple_toolsys.ToolOp","_finished","cancel","overdraw","modaldata","on_pointerend","AreaResizeTool","side","_side","_borders","RESIZE","getBorders","borders","otherVertex","snapScreenVerts","regenBorders","loadFromVerts","isBorderMovable","oldv1","oldv2","badcount","snapMode","moveBorder","outer","solveAreaConstraints","updateDebugBoxes","_fireResizeCB","SplitTool","canceled","splitArea","_internalRegenAll","RemoveAreaTool","collapseArea","AreaDragTool","dropArea","excludeAreas","cursorbox","boxes","TRANSLATE","_recalcAABB","getBoxRect","sa","doSplit","doSplitDrop","can_rip","floating","areasBorder","expand","removeArea","minmaxArea","editors","editormap","areaname","on_area_inactive","editor","editor2","owning_sarea","switcher","flagUpdate","replaceArea","loadFromPosSize","nsa","makeBoxes","hcolor","box","curbox","setColor","getActiveBox","on_drag","on_dragend","wid","AreaMoveAttachTool","start_mpos2","start_pos","ToolTipViewer","pick","Keymap","ele","tip","SnapLimit","BORDER_ZINDEX_BASE","snap","snap_limit","snapi","ScreenVert","added_id","ScreenHalfEdge","ScreenBorder","_hash","halfedges","_innerstyle","_style","inner","call_menu","bindBorderMenu","movable","FrameManager_ops.AreaResizeTool","usePickElement","on_dblclick","splitTool","removeAreaTool","popupMenu","getOtherSarea","he","_verts","borderLock","AreaFlags","NO_COLLAPSE","valence","sv","a0x","a0y","cursor","alpha","innerbuf","sbuf","_ScreenArea","HIDDEN","FLOATING","INDEPENDENT","NO_SWITCHER","NO_HEADER_CONTEXT_MENU","_contextWrangler","BorderMask","LEFT","BOTTOM","RIGHT","TOP","BorderSides","inactive","areaDragToolEnabled","_area_id","minSize","maxSize","areas","onover","_get_v_suffix","on_fileload","isActiveEditor","buildDataPath","idx1","idx2","areaName","oldsize","on_area_focus","on_area_blur","on_area_active","dontSetLastRef","getBarHeight","header","makeAreaSwitcher","makeAreasEnum","switch_editor","makeHeader","add_note_area","make_draggable","switcherRow","helpRow","callmenu","notef","eventdom","mpre","last_time","do_mousemove","mdown2","areaDragTool","_isDead","afterSTRUCT","ui_base.loadUIData","saved_uidata","_getSavedUIData","ui_base.saveUIData","ScreenArea","_flag","_sarea_id","_pos","wrapVector","bringToFront","snapToScreenSize","freeBorder","makeBorders","getScreenVert","getScreenBorder","existing","switchEditor","moved","checkAreaConstraint","owining_sarea","ui_base._setAreaClass","ThemeEditor","categoryMap","build","doFolder","catkey","help","do_onchange","completeSetCSS","completeUpdate","getpath","cw","setRGBA","panel2","tbox","categories","cat","category","strcmp","sliderDomAttributes","updateSliderFromDom","getbool","attr","getfloat","getint","SliderDefaults","NumberSliderBase","skip","loadConstraints","loadAttr","propkey","domkey","thiskey","NumSlider","_last_label","ma","_last_overarrow","removeAttribute","updateConstraints","swapWithTextbox","onmousedown","overArrow","_on_click","dragStart","setMpos","rwidth","rx","szmargin","_getArrowSize","doRange","fire_onchange","setDataPath","checkConstraints","over","last_background","util.MovingAvg","startvalue","startx","sumdelta","fire","dvalue","dsign","on_mouseout","on_mouseover","restore_value","boxbg","arrowcolor","perc","higharrow","NumSliderSimpleBase","modal","_last_slider_key","_setFromMouse","_getButtonPos","_invertButtonX","makefunc","mousemove","mouseover","mouseout","mouseleave","mouseenter","mouseup","updateSize","setHighlight","isOverButton","sh","arc","setLineDash","boxw","SliderWithTextbox","_lock_textbox","_labelOnTop","_last_label_on_top","_numslider","_last_value","realTimeTextBox","apply_textbox","linkTextBox","in_onchange","updateLabelOnTop","NumSliderSimple","NumSliderWithTextBox","pagecache","domTransferAttrs","domEventAttrs","parseXML","xml","DOMParser","parseFromString","num_re","getIconFlag","isnum","getPackFlag","myParseFloat","customHandlers","Handler","codefuncs","templateVars","attrs","inheritDomAttrs","inheritDomAttrKeys","XMLDocument","nodeName","tree","Text","Comment","elem2","__elem","getAttributeNames","_container","_basic","pathux_ctx","rule","selectorText","styleMap","stylecode","setStyle","_getattr","codeattrs","eventType","sliderMode","doBox","_handlePathPrefix","ignorePathPrefix","cell","_prop","_codelem","$scope","templateScope","mpath","column","iconflags","noIcons","isDropBox","initPage","parentContainer","loadPage","parentContainer_or_args","loadSourceOnly","modifySourceCB","fetch","makeGenEnum","Curve1DWidget","_on_draw","_gen_type","_lastGen","_lastu","updateGenUI","forward_keys","PanelFrame","titleframe","_panel","_closed","headerLabel","__label","_updateClosed","bs","defval","header_radius","boxmargin","paddingleft","paddingright","margintop","marginbottom","marginleft","marginright","_setVisible","_onchange","isClosed","noUpdateClosedContents","_state","display","makeForward","UPW","VPW","sample_rets","inv_sample","colorClipboardCopy","getRGBA","colorClipboardPaste","fieldrand","huefields","getHueField","ImageData","rgb","putImageData","getFieldImage","fieldsize","hsva","width2","height2","fieldsize2","hue","valpow","x2sat","y2val","sat2x","val2y","image2","_update_temp","SimpleBox","HueField","setFromXY","_getPad","hsv","rselector","r_circle","SatValField","_getField","sat","force_update","globalAlpha","ColorField","ui.ColumnFrame","_recalcRGBA","_lastThemeStyle","satvalfield","huefield","setCMYK","setHSVA","getCMYK","_in_update","updateThemeOverride","ColorPicker","colorsPanel","cssText","_no_update_textbox","_setSliders","cmyk","makeCMYKSlider","_setDataPath","colorbox","updateColorBox","ColorPickerButton","_depress","customLabel","labelDom","noLabel","leave","widget","cellsize","totx","toty","verboseDataPath","_last_key","tab_idgen","FAKE_TAB_ID","TabDragEvent","TabItem","tbar","ontabclick","ontabdragstart","ontabdragmove","ontabdragend","helper","extraSize","abssize","abspos","sendEvent","forwardEvent","Event","ModalTabMove","droptarget","dragtab","dragstate","finished","dragcanvas","on_pointerleave","on_pointerenter","on_pointerstart","_on_move","_dragstate","DragEvent","dragevent","disty","dragok","dataTransfer","DataTransfer","dragimg","g2","drag_g","ti","prev","swapTabs","defaultPrevented","TabBar","movableTabs","tabFontScale","_last_style_key","_last_pos","_doelement","mx","my","_domouse","_fireOnSelect","_doclick","ht","acte","_startMove","updatePos","_ensureNoModal","_tool","edom","_makeOnSelectEvt","getTab","name_or_id","taborder","ntabs","ai","bi","addIconTab","addTab","updateCanvas","tsize","_layout","iconsize","have_icons","ry","makeTabWatcher","watcher","haveTabDom","_size_cb","noSwitch","activecolor","ypad","worig","removeTab","updateStyle","_last_p_key","TabContainer","_remakeStyle","_last_horiz","_last_bar_pos","_tab","enableDrag","flexDir","bgcolor","icontab","tab2","defineTabEvent","getTabCount","moveTab","updateBarPos","barpos","updateHoriz","TableRow","td","TableFrame","maketd","_tr","_bg","ListItem","setBackground","unhighlight","shadowRoot","is_active","ListBox","idmap","onkeydown","removeItem","scrollIntoViewIfNeeded","ProgressCircle","animreq","startTime","flagRedraw","onkey","oncancel","requestAnimationFrame","dth","endTimer","LastKey","getLastToolStruct","_last_tool","LastToolPanel","_tool_id","getToolStackHead","buildTool","fakecls","getTool","defineProp","apikey","Constraint","klst","glst","ks","threshold","funcDv","no_dvs","gs","Solver","constraints","gk","randCons","solveStep","cons","ci","ri","solveStepSimple","solve","printError","notifier","PackNodeVertex","_absPos","absPos","PackNode","vel","oldpos","copyGraph","getCenter","loadGraph","graphGetIslands","islands","visit1","island","graphPack","margin_or_args","updateCb","orignodes","decayi","nodemap","disableEdges","edge_c","restlen","loadBoxes","lasterr","besterr","disableArea","area_c","math.aabb_overlap_area","fakeVerts","fv","solveStep1","solver","rlen","rfac","boxPacker","setNotifier","ContextFlags","IS_VIEW","__idgen","ContextID","CachedDef","_ret_tmp","OverlayClasses","ContextOverlay","appstate","last_tool","onRemove","have_new_file","def2","contextDefine","Context","parents","util.getClassParent","excludedKeys","LockedContext","progbar","_props","wrapget","ctx2","loadProperty","contextSystem","overlay","getOwningOverlay","saveProperty","setContext","next_key","_inside_map","_fix","fix","validateOverlays","stack2","hasOverlay","getOverlay","override","overrides","pushOverlay","_val_out","inside_map","ikey","__allKeys","ensureProperty","util.getAllKeys","popOverlay","removeOverlay","Test0","Test1","Test2","Test3","resolveDef","testInheritance","solver1","util","util1","vectormath","vectormath1","math","math1","toolprop_abstract","toolprop_abstract1","html5_fileapi","html5_fileapi1","parseutil","parseutil1","config1","nstructjs1","platform","getPlatformAsync","resolve","electron_api1","web_api","mimeMap","textMimes","isMimeText","getExtension","getMime","PlatformAPI","href","FileDialogArgs","savedata_cb","multi","addToRecentList","filters","FilePath","getElectronVersion","getElectron","require","myRequire","mod","getFilename","_menu_init","mimemap","png","svg","jpg","txt","html","cpp","cc","hh","hpp","mjs","cjs","gif","electron_menu_idgen","ipcRenderer","ElectronMenu","_ipcId","initElectronIpc","closePopup","wrapRemoteCallback","keybase","ipcInit","ElectronMenuItem","patchDropBox","emenu","buildElectronMenu","nativeTheme","remote","shouldUseDarkColors","themeSource","iconcache","makeIconKey","invertColors","getNativeIcon","icongen","nativeImage","GetRequiredICOImageSizes","from","writeFileSync","CTRL","ALT","SHIFT","COMMAND","buildElectronHotkey","buildItem","submenu","accelerator","registerAccelerator","initMenuBar","menuEditor","_roles","roles","edit","app","setApplicationMenu","dialog","eargs","defaultPath","_sanitizeFilters","properties","cancelled","filePaths","filters2","extensions","filedata_cb","filePath","filedata","fs","readFileSync","SVG_URL","CanvasOverdraw","shapes","otherChildren","zindex_base","createElementNS","Overdraw","drawTextBubbles","texts","colors","elems","pat","minsize","grads","startpos","box1","box2","circle","TreeItem","treeParent","treeChildren","treeView","treeDepth","_icon1","_icon2","_labelText","_open","_close","TreeView","strokes","updateOverdraw","_forAllChildren","_makeStrokes","ox","oy","rowh","getx","math.MinMax","od","startDrag","lastx","lasty","hx","hy","DragBox","DELETE","iconenum","_onend","ignore","_FrameManager","dockerdebug","areadocker","testSnapScreenVerts","unlisten","propsbar","AreaDocker","needsRebuild","ignoreChange","getArea","switcherData","tab_onchange","detach","addicon","on_addclick","loadTabData","floatArea","moveAttachTool","addTabMenu","getInternalName","area2","areaId","newarea","parentw","newparentw","newparent","ud","makePopupArea","area_class","addEscapeKeyHandler","ScreenArea.Area","ui_menu.startMenuEventWrangling","_events_started","FrameManager_ops.registerToolStackGetter","ui_base.styleScrollBars","update_stack","screen_idgen","get_screen_cb","_on_keydown","purgeUpdateStack","snapLimit","fullScreen","globalCSS","_do_updateSize","_resize_callbacks","needsBorderRegen","_popup_safe","testAllKeyMaps","_screen_id","_popups","screenverts","_vertmap","_edgemap","_idmap","_aabb","dragging","ScreenArea.ScreenArea","listening","listen_timer","schedule_resize","setPosSize","setPos","sheet2","rule2","desc","writable","entries","sval","insertRule","CSSStyleSheet","replaceSync","tag","newScreenArea","sarea2","_allAreas","owning_node","elem_or_x","closeOnMouseOut","popupDelay","draggablePopup","touchpick","mousepick","bad_time","last_pick_time","do_timeout","calcTabOrder","popupArea","trigger_destroy","checkCSSSize","getBoolAttribute","outerHeight","customWindowSize","_DEBUG","_calcSizeKey","_last_ckey1","ui_menu.setWranglerScreen","startEvents","ui_menu.getWranglerScreen","second_pass","__pass","__destroyed","_test_save","getHotKey","execKeyMap","handled","activeElement","__pos","drawUpdate","redraw_all","move","_update_gen","update_intern","updateScrollStyling","_last_scrollstyle_key","popups","cssTextHash","util.strhash","SCOPE_POP","AREA_CTX_POP","scopestack","areastack","regenScreenMesh","regenBorders_stage2","has_he","border2","walkBorderLine","he2","hasBorder","killScreenVertex","dels","killBorder","del","isBorderOuter","_get_debug_overlay","_debug_overlay","wadd","checkOnly","chg","sidea","sideb","dh","bad2","moveBorderWithoutVerts","halfedge","strict","moveBorderSimple","moveBorderUnused","FrameManager_mesh.SnapLimit","snapArgument","repeat","fitToSize","_set_key","offx","offy","olds","sides","bits","sb","sarea1","_updateAll","_has_evts","onblur","FrameManager_ops.ToolTipViewer","FrameManager_ops.RemoveAreaTool","FrameManager_ops.AreaMoveAttachTool","FrameManager_ops.SplitTool","FrameManager_ops.AreaDragTool","cleanupBorders","mergeBlankAreas","blank","test_struct","screen2","parentElement","ScreenArea.setScreenClass","start_cbs","stop_cbs","keyboardDom","key_event_opts","getScreenFunc","stopEvents","setKeyboardDom","setKeyboardOpts","opts","_onEventsStart","_onEventsStop","sidebar_hash","SideBar","_last_resize_key","closeIcon","_openWidth","needsSetCSS","tabbar","Editor","strct","makeMenuBar","makeSideBar","iconSvg","loadDefaultIconSheet","iconSheet","FileHeader","version_major","version_minor","version_micro","schema","FileFull","objects","FileArgs","doScreen","resetOnLoad","useJSON","fileFlags","fromFileOp","EmptyStruct","saveFilesInJSON","ob","istruct","screenClass","MenuBarEditor","updateHeight","_height","electron_api","flagRebuild","menuRow","registerMenuBarEditor","SimpleAppNewOp","createNewFile","SimpleAppSaveOp","forceDialog","fileExt","startArgs","platform.platform","showSaveDialog","currentFileRef","SimpleAppOpenOp","showOpenDialog","readFile","DataModelClasses","DataModel","EmptyContextClass","GetContextClass","ctxClass","StateSymbol","ui_noteframe.message","ui_noteframe.error","ui_noteframe.warning","progressBar","ui_noteframe.progbarNote","makeAPI","defineAPI","StartArgs","singlePage","iconSizes","iconTileSize","iconsPerRow","registerSaveOpenOps","SimpleScreen","AppState","_ctxClass","fileMagic","fileVersion","_fileExt","_fileExtSet","defaultEditorClass","makeScreen","saveFileSync","loadFileSync","ensureMenuBar","args2","methodsCheck","SimpleContext","controller","controller1","controller1.setNotifier","ui_noteframe","platform1","cconst1","simple1","getWebFilters","showOpenFilePicker","multiple","createWritable","showSaveFilePicker","showSaveDialog_old","fname","saveHandle","handle1","savedata","getFile","arrayBuffer"],"mappings":"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"}