{"version":3,"file":"pathux.min.js","sources":["../scripts/path-controller/util/polyfill.js","../scripts/path-controller/util/nstructjs_es6.js","../scripts/path-controller/util/mobile-detect.cjs","../scripts/path-controller/extern/lz-string/lz-string.js","../scripts/path-controller/util/util.js","../scripts/path-controller/util/vectormath.js","../scripts/path-controller/toolsys/toolprop_abstract.js","../scripts/path-controller/units/units.js","../scripts/path-controller/toolsys/toolprop.js","../scripts/path-controller/config/config.js","../scripts/path-controller/util/simple_events.js","../scripts/core/ui_consts.js","../scripts/screen/area_wrangler.js","../scripts/path-controller/util/math.js","../scripts/config/const.js","../scripts/core/ui_theme.js","../scripts/path-controller/util/events.js","../scripts/path-controller/curve/curve1d_base.js","../scripts/path-controller/controller/controller_base.js","../scripts/path-controller/controller/context.js","../scripts/path-controller/toolsys/toolsys.js","../scripts/path-controller/curve/curve1d_bspline.js","../scripts/path-controller/curve/curve1d.js","../scripts/core/anim.js","../scripts/path-controller/util/parseutil.js","../scripts/path-controller/toolsys/toolpath.js","../scripts/path-controller/controller/controller_abstract.js","../scripts/path-controller/controller/controller_ops.js","../scripts/path-controller/curve/curve1d_basic.js","../scripts/path-controller/curve/ease.js","../scripts/path-controller/curve/curve1d_anim.js","../scripts/path-controller/curve/curve1d_toolprop.js","../scripts/path-controller/dag/eventdag.js","../scripts/path-controller/util/solver.js","../scripts/path-controller/util/html5_fileapi.js","../scripts/path-controller/util/colorutils.js","../scripts/path-controller/util/graphpack.js","../scripts/path-controller/controller/controller.js","../scripts/core/theme.js","../scripts/icon_enum.js","../scripts/core/aspect.js","../scripts/core/ui_base.js","../scripts/widgets/ui_button.js","../scripts/widgets/ui_textbox.js","../scripts/widgets/ui_widgets.js","../scripts/widgets/ui_menu.js","../scripts/core/ui.js","../scripts/widgets/ui_noteframe.js","../scripts/widgets/ui_richedit.js","../scripts/widgets/ui_widgets2.js","../scripts/screen/FrameManager_ops.js","../scripts/screen/FrameManager_mesh.js","../scripts/screen/ScreenArea.js","../scripts/widgets/theme_editor.js","../scripts/widgets/ui_numsliders.js","../scripts/xmlpage/xmlpage.js","../scripts/path-controller/curve/curve1d_utils.js","../scripts/widgets/ui_curvewidget.js","../scripts/widgets/ui_panel.js","../scripts/widgets/ui_colorpicker2.js","../scripts/widgets/ui_tabs.js","../scripts/widgets/ui_table.js","../scripts/widgets/ui_listbox.js","../scripts/widgets/ui_progress.js","../scripts/widgets/ui_lasttool.js","../scripts/platforms/platform_base.js","../scripts/platforms/platform.js","../scripts/platforms/electron/electron_api.js","../scripts/util/ScreenOverdraw.js","../scripts/widgets/ui_treeview.js","../scripts/widgets/dragbox.js","../scripts/screen/AreaDocker.js","../scripts/screen/FrameManager.js","../scripts/widgets/ui_dialog.js","../scripts/simple/editor.js","../scripts/simple/iconsheet.js","../scripts/simple/icons.js","../scripts/simple/file.js","../scripts/simple/menubar.js","../scripts/simple/app_ops.js","../scripts/simple/app.js","../scripts/simple/context_class.js","../scripts/platforms/web/web_api.js","../scripts/pathux.js"],"sourcesContent":["if (typeof window === \"undefined\" && typeof global !== \"undefined\") {\r\n  global.window = global;\r\n} else if (typeof window === \"undefined\" && typeof globalThis !== \"undefined\") {\r\n  globalThis.window = globalThis;\r\n} else if (typeof window === \"undefined\" && typeof self !== \"undefined\") {\r\n  self.window = self;\r\n}\r\n\r\n(function () {\r\n  let visitgen = 0;\r\n\r\n  window.destroyAllCSS = function () {\r\n    visitgen++;\r\n\r\n    let visit = (n) => {\r\n      if (n.__visit === visitgen) {\r\n        return;\r\n      }\r\n\r\n      n.__visit = visitgen;\r\n      if (n.tagName === \"STYLE\") {\r\n        n.textContents = '';\r\n      }\r\n\r\n      if (n.style) {\r\n        for (let k in n.style) {\r\n          try {\r\n            n.style[k] = \"\";\r\n          } catch (error) {\r\n\r\n          }\r\n        }\r\n      }\r\n\r\n      if (!n.childNodes) {\r\n        return;\r\n      }\r\n\r\n      for (let c of n.childNodes) {\r\n        visit(c);\r\n      }\r\n    }\r\n\r\n    visit(document.head);\r\n    visit(document.body);\r\n\r\n    for (let sheet of document.styleSheets) {\r\n      for (let i = 0; i < sheet.rules.length; i++) {\r\n        sheet.removeRule(sheet.rules[0]);\r\n      }\r\n    }\r\n  }\r\n})();\r\n\r\nwindow.eventDebugModule = (function () {\r\n  \"use strict\";\r\n\r\n  return {\r\n    start() {\r\n      window.debugEventLists = {}\r\n      window.debugEventList = [];\r\n\r\n      this._addEventListener = EventTarget.prototype.addEventListener;\r\n      this._removeEventListener = EventTarget.prototype.removeEventListener;\r\n      this._dispatchEvent = EventTarget.prototype.dispatchEvent;\r\n\r\n      EventTarget.prototype.addEventListener = this.onadd;\r\n      EventTarget.prototype.removeEventListener = this.onrem;\r\n      EventTarget.prototype.dispatchEvent = this.ondispatch;\r\n    },\r\n\r\n    add(type, data) {\r\n      if (!(type in debugEventLists)) {\r\n        debugEventLists[type] = [];\r\n      }\r\n\r\n      debugEventLists[type].push(data);\r\n    },\r\n\r\n    ondispatch() {\r\n      let a = arguments;\r\n\r\n      eventDebugModule.add(\"Dispatch\", {\r\n        event    : a[0],\r\n        thisvar  : a[4],\r\n        line     : a[5],\r\n        filename : a[6].replace(/\\\\/g, \"/\"),\r\n        filepath : location.origin + a[6].replace(/\\\\/g, \"/\") + \":\" + a[5],\r\n        ownerpath: a[7]\r\n      });\r\n\r\n      return eventDebugModule._dispatchEvent.apply(this, arguments);\r\n    },\r\n\r\n    onadd() {\r\n      let a = arguments;\r\n\r\n      eventDebugModule.add(\"Add\", {\r\n        type     : a[0],\r\n        cb       : a[1],\r\n        args     : a[2],\r\n        thisvar  : a[4],\r\n        line     : a[5],\r\n        filename : a[6].replace(/\\\\/g, \"/\"),\r\n        filepath : location.origin + a[6].replace(/\\\\/g, \"/\") + \":\" + a[5],\r\n        ownerpath: a[7]\r\n      });\r\n\r\n\r\n      return eventDebugModule._addEventListener.apply(this, arguments);\r\n    },\r\n\r\n    pruneConnected() {\r\n      for (let k in debugEventLists) {\r\n        let list = debugEventLists[k];\r\n\r\n        for (let i = 0; i < list.length; i++) {\r\n          let e = list[i];\r\n\r\n          if (!e.thisvar || !(e.thisvar instanceof Node)) {\r\n            continue;\r\n          }\r\n\r\n          if (!e.thisvar.isConnected) {\r\n            list[i] = list[list.length - 1];\r\n            list[list.length - 1] = undefined;\r\n            list.length--;\r\n            i--;\r\n          }\r\n        }\r\n      }\r\n    },\r\n\r\n\r\n    onrem() {\r\n      let a = arguments;\r\n\r\n      eventDebugModule.add(\"Rem\", {\r\n        type     : a[0],\r\n        cb       : a[1],\r\n        args     : a[2],\r\n        thisvar  : a[4],\r\n        line     : a[5],\r\n        filename : a[6].replace(/\\\\/g, \"/\"),\r\n        filepath : location.origin + a[6].replace(/\\\\/g, \"/\") + \":\" + a[5],\r\n        ownerpath: a[7]\r\n      });\r\n\r\n\r\n      return eventDebugModule._removeEventListener.apply(this, arguments);\r\n    }\r\n  }\r\n})();\r\n\r\nif (typeof _debug_event_listeners !== \"undefined\" && _debug_event_listeners) {\r\n  eventDebugModule.start();\r\n}\r\n\r\n/*\r\nif (navigator.userAgent.toLowerCase().search(\"chrome\") >= 0) {\r\n  console.warn(\"Patching Google Chrome scrollbar bug\");\r\n\r\n  let cb = (e) => {\r\n    if (e.touches.length == 1) {\r\n      let e2 = Object.create(e);\r\n      e2.pageX = e.touches[0].pageX;\r\n      e2.pageY = e.touches[0].pageY;\r\n      e2.x = e2.screenX = e2.pageX;\r\n      e2.y = e2.screenY = e2.pageY;\r\n      e2.button = 0;\r\n      e2.buttons = 1;\r\n\r\n      let type;\r\n      if (e.type === \"touchstart\")\r\n        type = \"mousedown\";\r\n      else \r\n        type = \"mousemove\";\r\n\r\n      console.log(e2);\r\n        //console.log(e.target);\r\n      e2 = new MouseEvent(type, e);\r\n      e.target.dispatchEvent(e2);\r\n    }\r\n  };\r\n\r\n  window.addEventListener(\"touchstart\", (e) => cb(e));\r\n  window.addEventListener(\"touchmove\", (e) => cb(e));\r\n\r\n  document.addEventListener(\"touchstart\", (e) => cb(e));\r\n  document.addEventListener(\"touchmove\", (e) => cb(e));\r\n}\r\n//*/\r\n\r\nif (window._disable_all_listeners) {\r\n  console.warn(\"Disabling all event listeners\");\r\n  EventTarget.prototype.addEventListener = () => {\r\n  };\r\n  EventSource.prototype.addEventListener = () => {\r\n  };\r\n}\r\n\r\nif (typeof visualViewport === \"undefined\") {\r\n  (function () {\r\n    class MyVisualViewport {\r\n      get width() {\r\n        return window.innerWidth;\r\n      }\r\n\r\n      get height() {\r\n        return window.innerHeight;\r\n      }\r\n\r\n      get offsetLeft() {\r\n        return 0;\r\n      }\r\n\r\n      get offsetTop() {\r\n        return 0;\r\n      }\r\n\r\n      get pageLeft() {\r\n        return 0;\r\n      }\r\n\r\n      get pageTop() {\r\n        return 0;\r\n      }\r\n\r\n      get scale() {\r\n        return 1.0;\r\n      }\r\n    }\r\n\r\n    window.visualViewport = new MyVisualViewport();\r\n  })();\r\n}\r\n\r\nif (Array.prototype.set === undefined) {\r\n  /**\r\n   * A version of TypedArray.prototype.set for Array\r\n   * Unliked typed array version the array will be\r\n   * resized if the source array range extends past\r\n   * the array length.\r\n   *\r\n   * array.set(array) array.set(array, src_offset) array.set(array, src_offset, count)\r\n   * array.set(array, src_offset, dest_offset, count\r\n   * @param array\r\n   */\r\n  Array.prototype.set = function set(array) {\r\n    if (arguments.length === 0) {\r\n      //WASM somehow manages to call this\r\n      return;\r\n    }\r\n\r\n    let src, dst, count;\r\n\r\n    if (arguments.length === 0) {\r\n      src = 0;\r\n      dst = 0;\r\n      count = array.length;\r\n    } else if (arguments.length === 1) {\r\n      count = array.length;\r\n      src = arguments[1];\r\n      dst = 0;\r\n    } else if (arguments.length === 2) {\r\n      src = arguments[1];\r\n      count = arguments[2];\r\n    } else if (arguments.length === 3) {\r\n      src = arguments[1];\r\n      dst = arguments[2];\r\n      count = arguments[3];\r\n    }\r\n\r\n    src = src === undefined ? 0 : src;\r\n    dst = dst === undefined ? 0 : dst;\r\n    count = count === undefined ? array.length : count;\r\n\r\n    if (count < 0) {\r\n      throw new RangeError(\"Count must be >= zero\");\r\n    }\r\n\r\n    let len = Math.min(src + count, array.length) - src;\r\n\r\n    if (dst + len > this.length) {\r\n      this.length = dst + len;\r\n    }\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      this[dst + i] = array[src + i];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  Object.defineProperty(Array.prototype, \"set\", {\r\n    enumerable  : false,\r\n    configurable: true,\r\n  });\r\n\r\n  if (Float64Array.prototype.set === undefined) {\r\n    Float64Array.prototype.set = Array.prototype.set;\r\n    Float32Array.prototype.set = Array.prototype.set;\r\n    Uint8Array.prototype.set = Array.prototype.set;\r\n    Uint8ClampedArray.prototype.set = Array.prototype.set;\r\n    Int32Array.prototype.set = Array.prototype.set;\r\n    Int16Array.prototype.set = Array.prototype.set;\r\n    Int8Array.prototype.set = Array.prototype.set;\r\n  }\r\n}\r\n\r\nif (Array.prototype.reject === undefined) {\r\n  Array.prototype.reject = function reject(func) {\r\n    return this.filter((item) => !func(item));\r\n  }\r\n\r\n  Object.defineProperty(Array.prototype, \"reject\", {\r\n    enumerable  : false,\r\n    configurable: true,\r\n  });\r\n}\r\n\r\nif (window.Symbol == undefined) { //eek!\r\n  window.Symbol = {\r\n    iterator: \"$__iterator__$\",\r\n    keystr  : \"$__keystr__$\"\r\n  }\r\n} else if (Symbol.keystr === undefined) {\r\n  Symbol.keystr = Symbol(\"keystr\");\r\n}\r\n\r\n/* use util.list\r\nwindow.list = function list(iter) {\r\n  var ret = [];\r\n\r\n  if (typeof iter == \"string\") {\r\n    iter = new String();\r\n  }\r\n\r\n  if (Symbol.iterator in iter) {\r\n    for (var item of iter) {\r\n      ret.push(item);\r\n    }\r\n  } else {\r\n    iter.forEach(function (item) {\r\n      ret.push(item);\r\n    }, this);\r\n  }\r\n\r\n  return ret;\r\n};*/\r\n\r\n//XXX surely browser vendors have fixed this by now. . .\r\n/*Override array iterator to not allocate too much*/\r\n\r\n/*\r\nfunction ArrayIter(array) {\r\n  this.array = array;\r\n  this.i = 0;\r\n  this.ret = {done : false, value : undefined};\r\n}\r\n\r\nArrayIter.prototype[Symbol.iterator] = function() {\r\n  return this;\r\n}\r\n\r\nArrayIter.prototype.next = function() {\r\n  var ret = this.ret;\r\n  \r\n  if (this.i >= this.array.length) {\r\n    ret.done = true;\r\n    ret.value = undefined;\r\n    return ret;\r\n  }\r\n  \r\n  ret.value = this.array[this.i++];\r\n  return ret;\r\n};//*/\r\n\r\n\r\n//Array.prototype[Symbol.iterator] = function() {\r\n//  return new ArrayIter(this);\r\n//}\r\n\r\nif (Math.fract === undefined) {\r\n  Math.fract = function fract(f) {\r\n    return f - Math.floor(f);\r\n  };\r\n}\r\n\r\nif (Math.tent === undefined) {\r\n  Math.tent = function tent(f) {\r\n    return 1.0 - Math.abs(Math.fract(f) - 0.5)*2.0;\r\n  };\r\n}\r\n\r\nif (Math.sign === undefined) {\r\n  Math.sign = function sign(f) {\r\n    return (f > 0.0)*2.0 - 1.0;\r\n  };\r\n}\r\n\r\nif (Array.prototype.pop_i === undefined) {\r\n  Array.prototype.pop_i = function (idx) {\r\n    if (idx < 0 || idx >= this.length) {\r\n      throw new Error(\"Index out of range\");\r\n    }\r\n\r\n    while (idx < this.length) {\r\n      this[idx] = this[idx + 1];\r\n      idx++;\r\n    }\r\n\r\n    this.length -= 1;\r\n  }\r\n\r\n  Object.defineProperty(Array.prototype, \"pop_i\", {\r\n    enumerable  : false,\r\n    configurable: true,\r\n  });\r\n}\r\n\r\nif (Array.prototype.remove === undefined) {\r\n  Array.prototype.remove = function (item, suppress_error) {\r\n    var i = this.indexOf(item);\r\n\r\n    if (i < 0) {\r\n      if (suppress_error)\r\n        console.trace(\"Warning: item not in array\", item);\r\n      else\r\n        throw new Error(\"Error: item not in array \" + item);\r\n\r\n      return;\r\n    }\r\n\r\n    this.pop_i(i);\r\n  }\r\n\r\n  Object.defineProperty(Array.prototype, \"remove\", {\r\n    enumerable  : false,\r\n    configurable: true,\r\n  });\r\n}\r\n\r\nif (String.prototype.contains === undefined) {\r\n  String.prototype.contains = function (substr) {\r\n    return String.search(substr) >= 0;\r\n  }\r\n}\r\n\r\nString.prototype[Symbol.keystr] = function () {\r\n  return this;\r\n};\r\n\r\nNumber.prototype[Symbol.keystr] = Boolean.prototype[Symbol.keystr] = function () {\r\n  return \"\" + this;\r\n};\r\n\r\nArray.prototype[Symbol.keystr] = function () {\r\n  let key = \"\";\r\n  for (let item of this) {\r\n    key += item[Symbol.keystr]() + \":\";\r\n  }\r\n\r\n  return key;\r\n};\r\n","let colormap = {\r\n  \"black\"   : 30,\r\n  \"red\"     : 31,\r\n  \"green\"   : 32,\r\n  \"yellow\"  : 33,\r\n  \"blue\"    : 34,\r\n  \"magenta\" : 35,\r\n  \"cyan\"    : 36,\r\n  \"white\"   : 37,\r\n  \"reset\"   : 0,\r\n  \"grey\"    : 2,\r\n  \"orange\"  : 202,\r\n  \"pink\"    : 198,\r\n  \"brown\"   : 314,\r\n  \"lightred\": 91,\r\n  \"peach\"   : 210\r\n};\r\n\r\nfunction tab(n, chr = ' ') {\r\n  let t = '';\r\n\r\n  for (let i = 0; i < n; i++) {\r\n    t += chr;\r\n  }\r\n\r\n  return t;\r\n}\r\n\r\nlet termColorMap = {};\r\nfor (let k in colormap) {\r\n  termColorMap[k] = colormap[k];\r\n  termColorMap[colormap[k]] = k;\r\n}\r\n\r\nfunction termColor(s, c) {\r\n  if (typeof s === \"symbol\") {\r\n    s = s.toString();\r\n  } else {\r\n    s = \"\" + s;\r\n  }\r\n\r\n  if (c in colormap)\r\n    c = colormap[c];\r\n\r\n  if (c > 107) {\r\n    let s2 = '\\u001b[38;5;' + c + \"m\";\r\n    return s2 + s + '\\u001b[0m'\r\n  }\r\n\r\n  return '\\u001b[' + c + 'm' + s + '\\u001b[0m'\r\n};\r\n\r\nfunction termPrint() {\r\n  //let console = window.console;\r\n\r\n  let s = '';\r\n  for (let i = 0; i < arguments.length; i++) {\r\n    if (i > 0) {\r\n      s += ' ';\r\n    }\r\n    s += arguments[i];\r\n  }\r\n\r\n  let re1a = /\\u001b\\[[1-9][0-9]?m/;\r\n  let re1b = /\\u001b\\[[1-9][0-9];[0-9][0-9]?;[0-9]+m/;\r\n  let re2 = /\\u001b\\[0m/;\r\n\r\n  let endtag = '\\u001b[0m';\r\n\r\n  function tok(s, type) {\r\n    return {\r\n      type : type,\r\n      value: s\r\n    }\r\n  }\r\n\r\n  let tokdef = [\r\n    [re1a, \"start\"],\r\n    [re1b, \"start\"],\r\n    [re2, \"end\"]\r\n  ];\r\n\r\n  let s2 = s;\r\n\r\n  let i = 0;\r\n  let tokens = [];\r\n\r\n  while (s2.length > 0) {\r\n    let ok = false;\r\n\r\n    let mintk = undefined, mini = undefined;\r\n    let minslice = undefined, mintype = undefined;\r\n\r\n    for (let tk of tokdef) {\r\n      let i = s2.search(tk[0]);\r\n\r\n      if (i >= 0 && (mini === undefined || i < mini)) {\r\n        minslice = s2.slice(i, s2.length).match(tk[0])[0];\r\n        mini = i;\r\n        mintype = tk[1];\r\n        mintk = tk;\r\n        ok = true;\r\n      }\r\n    }\r\n\r\n    if (!ok) {\r\n      break;\r\n    }\r\n\r\n    if (mini > 0) {\r\n      let chunk = s2.slice(0, mini);\r\n      tokens.push(tok(chunk, \"chunk\"));\r\n    }\r\n\r\n    s2 = s2.slice(mini+minslice.length, s2.length);\r\n    let t = tok(minslice, mintype);\r\n\r\n    tokens.push(t);\r\n  }\r\n\r\n  if (s2.length > 0) {\r\n    tokens.push(tok(s2, \"chunk\"));\r\n  }\r\n\r\n  let stack = [];\r\n  let cur;\r\n\r\n  let out = '';\r\n\r\n  for (let t of tokens) {\r\n    if (t.type === \"chunk\") {\r\n      out += t.value;\r\n    } else if (t.type === \"start\") {\r\n      stack.push(cur);\r\n      cur = t.value;\r\n\r\n      out += t.value;\r\n    } else if (t.type === \"end\") {\r\n      cur = stack.pop();\r\n      if (cur) {\r\n        out += cur;\r\n      } else {\r\n        out += endtag;\r\n      }\r\n    }\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\nfunction list(iter) {\r\n  let ret = [];\r\n\r\n  for (let item of iter) {\r\n    ret.push(item);\r\n  }\r\n\r\n  return ret;\r\n}\n\nvar util = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  tab: tab,\n  termColorMap: termColorMap,\n  termColor: termColor,\n  termPrint: termPrint,\n  list: list\n});\n\n\"use strict\";\r\n\r\nfunction print_lines(ld, lineno, col, printColors, token) {\r\n  let buf = '';\r\n  let lines = ld.split(\"\\n\");\r\n  let istart = Math.max(lineno - 5, 0);\r\n  let iend = Math.min(lineno + 3, lines.length);\r\n\r\n  let color = printColors ? (c) => c : termColor;\r\n\r\n  for (let i = istart; i < iend; i++) {\r\n    let l = \"\" + (i + 1);\r\n    while (l.length < 3) {\r\n      l = \" \" + l;\r\n    }\r\n\r\n    l += `: ${lines[i]}\\n`;\r\n\r\n    if (i === lineno && token && token.value.length === 1) {\r\n      l = l.slice(0, col + 5) + color(l[col + 5], \"yellow\") + l.slice(col + 6, l.length);\r\n    }\r\n    buf += l;\r\n    if (i === lineno) {\r\n      let colstr = '     ';\r\n      for (let i = 0; i < col; i++) {\r\n        colstr += ' ';\r\n      }\r\n      colstr += color(\"^\", \"red\");\r\n\r\n      buf += colstr + \"\\n\";\r\n    }\r\n  }\r\n\r\n  buf = \"------------------\\n\" + buf + \"\\n==================\\n\";\r\n  return buf;\r\n}\r\n\r\nclass token {\r\n  constructor(type, val, lexpos, lineno, lexer, parser, col) {\r\n    this.type = type;\r\n    this.value = val;\r\n    this.lexpos = lexpos;\r\n    this.lineno = lineno;\r\n    this.col = col;\r\n    this.lexer = lexer;\r\n    this.parser = parser;\r\n  }\r\n\r\n  toString() {\r\n    if (this.value !== undefined)\r\n      return \"token(type=\" + this.type + \", value='\" + this.value + \"')\";\r\n    else\r\n      return \"token(type=\" + this.type + \")\";\r\n  }\r\n}\r\n\r\nclass tokdef {\r\n  constructor(name, regexpr, func, example) {\r\n    this.name = name;\r\n    this.re = regexpr;\r\n    this.func = func;\r\n    this.example = example;\r\n\r\n    if (example === undefined && regexpr) {\r\n      let s = \"\" + regexpr;\r\n      if (s.startsWith(\"/\") && s.endsWith(\"/\")) {\r\n        s = s.slice(1, s.length - 1);\r\n      }\r\n\r\n      if (s.startsWith(\"\\\\\")) {\r\n        s = s.slice(1, s.length);\r\n      }\r\n      s = s.trim();\r\n\r\n      if (s.length === 1) {\r\n        this.example = s;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nclass PUTIL_ParseError extends Error {\r\n  constructor(msg) {\r\n    super();\r\n  }\r\n}\r\n\r\nclass lexer {\r\n  constructor(tokdef, errfunc) {\r\n    this.tokdef = tokdef;\r\n    this.tokens = new Array();\r\n    this.lexpos = 0;\r\n    this.lexdata = \"\";\r\n    this.colmap = undefined;\r\n    this.lineno = 0;\r\n    this.printTokens = false;\r\n    this.linestart = 0;\r\n    this.errfunc = errfunc;\r\n    this.linemap = undefined;\r\n    this.tokints = {};\r\n    for (let i = 0; i < tokdef.length; i++) {\r\n      this.tokints[tokdef[i].name] = i;\r\n    }\r\n    this.statestack = [[\"__main__\", 0]];\r\n    this.states = {\"__main__\": [tokdef, errfunc]};\r\n    this.statedata = 0;\r\n\r\n    this.logger = function () {\r\n      console.log(...arguments);\r\n    };\r\n  }\r\n\r\n  add_state(name, tokdef, errfunc) {\r\n    if (errfunc === undefined) {\r\n      errfunc = function (lexer) {\r\n        return true;\r\n      };\r\n    }\r\n    this.states[name] = [tokdef, errfunc];\r\n  }\r\n\r\n  tok_int(name) {\r\n  }\r\n\r\n  push_state(state, statedata) {\r\n    this.statestack.push([state, statedata]);\r\n    state = this.states[state];\r\n    this.statedata = statedata;\r\n    this.tokdef = state[0];\r\n    this.errfunc = state[1];\r\n  }\r\n\r\n  pop_state() {\r\n    let item = this.statestack[this.statestack.length - 1];\r\n    let state = this.states[item[0]];\r\n    this.tokdef = state[0];\r\n    this.errfunc = state[1];\r\n    this.statedata = item[1];\r\n  }\r\n\r\n  input(str) {\r\n    let linemap = this.linemap = new Array(str.length);\r\n    let lineno = 0;\r\n    let col = 0;\r\n    let colmap = this.colmap = new Array(str.length);\r\n\r\n    for (let i = 0; i < str.length; i++, col++) {\r\n      let c = str[i];\r\n\r\n      linemap[i] = lineno;\r\n      colmap[i] = col;\r\n\r\n      if (c === \"\\n\") {\r\n        lineno++;\r\n        col = 0;\r\n      }\r\n    }\r\n\r\n    while (this.statestack.length > 1) {\r\n      this.pop_state();\r\n    }\r\n    this.lexdata = str;\r\n    this.lexpos = 0;\r\n    this.lineno = 0;\r\n    this.tokens = new Array();\r\n    this.peeked_tokens = [];\r\n  }\r\n\r\n  error() {\r\n    if (this.errfunc !== undefined && !this.errfunc(this))\r\n      return;\r\n\r\n    let safepos = Math.min(this.lexpos, this.lexdata.length - 1);\r\n    let line = this.linemap[safepos];\r\n    let col = this.colmap[safepos];\r\n\r\n    let s = print_lines(this.lexdata, line, col, true);\r\n\r\n    this.logger(\"  \" + s);\r\n    this.logger(\"Syntax error near line \" + (this.lineno + 1));\r\n\r\n    let next = Math.min(this.lexpos + 8, this.lexdata.length);\r\n\r\n    throw new PUTIL_ParseError(\"Parse error\");\r\n  }\r\n\r\n  peek() {\r\n    let tok = this.next(true);\r\n    if (tok === undefined)\r\n      return undefined;\r\n    this.peeked_tokens.push(tok);\r\n    return tok;\r\n  }\r\n\r\n  peeknext() {\r\n    if (this.peeked_tokens.length > 0) {\r\n      return this.peeked_tokens[0];\r\n    }\r\n\r\n    return this.peek();\r\n  }\r\n\r\n  at_end() {\r\n    return this.lexpos >= this.lexdata.length && this.peeked_tokens.length === 0;\r\n  }\r\n\r\n  //ignore_peek is optional, false\r\n  next(ignore_peek) {\r\n    if (!ignore_peek && this.peeked_tokens.length > 0) {\r\n      let tok = this.peeked_tokens[0];\r\n      this.peeked_tokens.shift();\r\n\r\n      if (!ignore_peek && this.printTokens) {\r\n        this.logger(\"\" + tok);\r\n      }\r\n\r\n      return tok;\r\n    }\r\n\r\n    if (this.lexpos >= this.lexdata.length)\r\n      return undefined;\r\n\r\n    let ts = this.tokdef;\r\n    let tlen = ts.length;\r\n    let lexdata = this.lexdata.slice(this.lexpos, this.lexdata.length);\r\n    let results = [];\r\n\r\n    for (var i = 0; i < tlen; i++) {\r\n      let t = ts[i];\r\n      if (t.re === undefined)\r\n        continue;\r\n      let res = t.re.exec(lexdata);\r\n      if (res !== null && res !== undefined && res.index === 0) {\r\n        results.push([t, res]);\r\n      }\r\n    }\r\n\r\n    let max_res = 0;\r\n    let theres = undefined;\r\n    for (var i = 0; i < results.length; i++) {\r\n      let res = results[i];\r\n      if (res[1][0].length > max_res) {\r\n        theres = res;\r\n        max_res = res[1][0].length;\r\n      }\r\n    }\r\n\r\n    if (theres === undefined) {\r\n      this.error();\r\n      return;\r\n    }\r\n\r\n    let def = theres[0];\r\n    let col = this.colmap[Math.min(this.lexpos, this.lexdata.length - 1)];\r\n\r\n    if (this.lexpos < this.lexdata.length) {\r\n      this.lineno = this.linemap[this.lexpos];\r\n    }\r\n\r\n    let tok = new token(def.name, theres[1][0], this.lexpos, this.lineno, this, undefined, col);\r\n    this.lexpos += tok.value.length;\r\n\r\n    if (def.func) {\r\n      tok = def.func(tok);\r\n      if (tok === undefined) {\r\n        return this.next();\r\n      }\r\n    }\r\n\r\n    if (!ignore_peek && this.printTokens) {\r\n      this.logger(\"\" + tok);\r\n    }\r\n    return tok;\r\n  }\r\n}\r\n\r\nclass parser {\r\n  constructor(lexer, errfunc) {\r\n    this.lexer = lexer;\r\n    this.errfunc = errfunc;\r\n    this.start = undefined;\r\n\r\n    this.logger = function () {\r\n      console.log(...arguments);\r\n    };\r\n  }\r\n\r\n  parse(data, err_on_unconsumed) {\r\n    if (err_on_unconsumed === undefined)\r\n      err_on_unconsumed = true;\r\n\r\n    if (data !== undefined)\r\n      this.lexer.input(data);\r\n\r\n    let ret = this.start(this);\r\n\r\n    if (err_on_unconsumed && !this.lexer.at_end() && this.lexer.next() !== undefined) {\r\n      this.error(undefined, \"parser did not consume entire input\");\r\n    }\r\n    return ret;\r\n  }\r\n\r\n  input(data) {\r\n    this.lexer.input(data);\r\n  }\r\n\r\n  error(token, msg) {\r\n    let estr;\r\n\r\n    if (msg === undefined)\r\n      msg = \"\";\r\n    if (token === undefined)\r\n      estr = \"Parse error at end of input: \" + msg;\r\n    else\r\n      estr = `Parse error at line ${token.lineno + 1}:${token.col + 1}: ${msg}`;\r\n\r\n    let buf = \"\";\r\n    let ld = this.lexer.lexdata;\r\n    let lineno = token ? token.lineno : this.lexer.linemap[this.lexer.linemap.length - 1];\r\n    let col = token ? token.col : 0;\r\n\r\n    ld = ld.replace(/\\r/g, '');\r\n\r\n    this.logger(print_lines(ld, lineno, col, true, token));\r\n    this.logger(estr);\r\n\r\n    if (this.errfunc && !this.errfunc(token)) {\r\n      return;\r\n    }\r\n    throw new PUTIL_ParseError(estr);\r\n  }\r\n\r\n  peek() {\r\n    let tok = this.lexer.peek();\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n    return tok;\r\n  }\r\n\r\n  peeknext() {\r\n    let tok = this.lexer.peeknext();\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n    return tok;\r\n  }\r\n\r\n  next() {\r\n    let tok = this.lexer.next();\r\n\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n    return tok;\r\n  }\r\n\r\n  optional(type) {\r\n    let tok = this.peeknext();\r\n    if (tok === undefined)\r\n      return false;\r\n    if (tok.type === type) {\r\n      this.next();\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  at_end() {\r\n    return this.lexer.at_end();\r\n  }\r\n\r\n  expect(type, msg) {\r\n    let tok = this.next();\r\n\r\n    if (msg === undefined) {\r\n      msg = type;\r\n\r\n      for (let tk of this.lexer.tokdef) {\r\n        if (tk.name === type && tk.example) {\r\n          msg = tk.example;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (tok === undefined || tok.type !== type) {\r\n      this.error(tok, \"Expected \" + msg);\r\n    }\r\n    return tok.value;\r\n  }\r\n}\r\n\r\nfunction test_parser() {\r\n  let basic_types = new Set([\"int\", \"float\", \"double\", \"vec2\", \"vec3\", \"vec4\", \"mat4\", \"string\"]);\r\n  let reserved_tokens = new Set([\"int\", \"float\", \"double\", \"vec2\", \"vec3\", \"vec4\", \"mat4\", \"string\", \"static_string\",\r\n                                 \"array\"]);\r\n\r\n  function tk(name, re, func) {\r\n    return new tokdef(name, re, func);\r\n  }\r\n\r\n  let tokens = [tk(\"ID\", /[a-zA-Z]+[a-zA-Z0-9_]*/, function (t) {\r\n    if (reserved_tokens.has(t.value)) {\r\n      t.type = t.value.toUpperCase();\r\n    }\r\n    return t;\r\n  }), tk(\"OPEN\", /\\{/), tk(\"CLOSE\", /}/), tk(\"COLON\", /:/), tk(\"JSCRIPT\", /\\|/, function (t) {\r\n    let js = \"\";\r\n    let lexer = t.lexer;\r\n    while (lexer.lexpos < lexer.lexdata.length) {\r\n      let c = lexer.lexdata[lexer.lexpos];\r\n      if (c === \"\\n\")\r\n        break;\r\n      js += c;\r\n      lexer.lexpos++;\r\n    }\r\n    if (js.endsWith(\";\")) {\r\n      js = js.slice(0, js.length - 1);\r\n      lexer.lexpos--;\r\n    }\r\n    t.value = js;\r\n    return t;\r\n  }), tk(\"LPARAM\", /\\(/), tk(\"RPARAM\", /\\)/), tk(\"COMMA\", /,/), tk(\"NUM\", /[0-9]/), tk(\"SEMI\", /;/),\r\n                tk(\"NEWLINE\", /\\n/, function (t) {\r\n                  t.lexer.lineno += 1;\r\n                }), tk(\"SPACE\", / |\\t/, function (t) {\r\n    })];\r\n\r\n  for (let rt of reserved_tokens) {\r\n    tokens.push(tk(rt.toUpperCase()));\r\n  }\r\n\r\n  let a = `\r\n  Loop {\r\n    eid : int;\r\n    flag : int;\r\n    index : int;\r\n    type : int;\r\n\r\n    co : vec3;\r\n    no : vec3;\r\n    loop : int | eid(loop);\r\n    edges : array(e, int) | e.eid;\r\n\r\n    loops :, array(Loop);\r\n  }\r\n  `;\r\n\r\n\r\n  function errfunc(lexer) {\r\n    return true;\r\n  }\r\n\r\n  let lex = new lexer(tokens, errfunc);\r\n  console.log(\"Testing lexical scanner...\");\r\n  lex.input(a);\r\n  let token;\r\n  while (token = lex.next()) {\r\n    console.log(token.toString());\r\n  }\r\n  let parse = new parser(lex);\r\n  parse.input(a);\r\n\r\n  function p_Array(p) {\r\n    p.expect(\"ARRAY\");\r\n    p.expect(\"LPARAM\");\r\n    let arraytype = p_Type(p);\r\n    let itername = \"\";\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = arraytype;\r\n      arraytype = p_Type(p);\r\n    }\r\n    p.expect(\"RPARAM\");\r\n    return {type: \"array\", data: {type: arraytype, iname: itername}}\r\n  }\r\n\r\n  function p_Type(p) {\r\n    let tok = p.peek();\r\n    if (tok.type === \"ID\") {\r\n      p.next();\r\n      return {type: \"struct\", data: \"\\\"\" + tok.value + \"\\\"\"}\r\n    } else if (basic_types.has(tok.type.toLowerCase())) {\r\n      p.next();\r\n      return {type: tok.type.toLowerCase()}\r\n    } else if (tok.type === \"ARRAY\") {\r\n      return p_Array(p);\r\n    } else {\r\n      p.error(tok, \"invalid type \" + tok.type);\r\n    }\r\n  }\r\n\r\n  function p_Field(p) {\r\n    let field = {};\r\n    console.log(\"-----\", p.peek().type);\r\n    field.name = p.expect(\"ID\", \"struct field name\");\r\n    p.expect(\"COLON\");\r\n    field.type = p_Type(p);\r\n    field.set = undefined;\r\n    field.get = undefined;\r\n    let tok = p.peek();\r\n    if (tok.type === \"JSCRIPT\") {\r\n      field.get = tok.value;\r\n      p.next();\r\n    }\r\n    tok = p.peek();\r\n    if (tok.type === \"JSCRIPT\") {\r\n      field.set = tok.value;\r\n      p.next();\r\n    }\r\n    p.expect(\"SEMI\");\r\n    return field;\r\n  }\r\n\r\n  function p_Struct(p) {\r\n    let st = {};\r\n    st.name = p.expect(\"ID\", \"struct name\");\r\n    st.fields = [];\r\n    p.expect(\"OPEN\");\r\n    while (1) {\r\n      if (p.at_end()) {\r\n        p.error(undefined);\r\n      } else if (p.optional(\"CLOSE\")) {\r\n        break;\r\n      } else {\r\n        st.fields.push(p_Field(p));\r\n      }\r\n    }\r\n    return st;\r\n  }\r\n\r\n  let ret = p_Struct(parse);\r\n  console.log(JSON.stringify(ret));\r\n}\r\n\r\n//test_parser();\n\nvar struct_parseutil = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  token: token,\n  tokdef: tokdef,\n  PUTIL_ParseError: PUTIL_ParseError,\n  lexer: lexer,\n  parser: parser\n});\n\n\"use strict\";\r\n\r\nclass NStruct {\r\n  constructor(name) {\r\n    this.fields = [];\r\n    this.id = -1;\r\n    this.name = name;\r\n  }\r\n}\r\n\r\n//the discontinuous id's are to make sure\r\n//the version I originally wrote (which had a few application-specific types)\r\n//and this one do not become totally incompatible.\r\nconst StructEnum = {\r\n  INT          : 0,\r\n  FLOAT        : 1,\r\n  DOUBLE       : 2,\r\n  STRING       : 7,\r\n  STATIC_STRING: 8, //fixed-length string\r\n  STRUCT       : 9,\r\n  TSTRUCT      : 10,\r\n  ARRAY        : 11,\r\n  ITER         : 12,\r\n  SHORT        : 13,\r\n  BYTE         : 14,\r\n  BOOL         : 15,\r\n  ITERKEYS     : 16,\r\n  UINT         : 17,\r\n  USHORT       : 18,\r\n  STATIC_ARRAY : 19,\r\n  SIGNED_BYTE  : 20,\r\n  OPTIONAL     : 21,\r\n};\r\n\r\nconst ArrayTypes = new Set([\r\n  StructEnum.STATIC_ARRAY, StructEnum.ARRAY, StructEnum.ITERKEYS, StructEnum.ITER\r\n]);\r\n\r\nconst ValueTypes = new Set([\r\n  StructEnum.INT,\r\n  StructEnum.FLOAT,\r\n  StructEnum.DOUBLE,\r\n  StructEnum.STRING,\r\n  StructEnum.STATIC_STRING,\r\n  StructEnum.SHORT,\r\n  StructEnum.BYTE,\r\n  StructEnum.BOOL,\r\n  StructEnum.UINT,\r\n  StructEnum.USHORT,\r\n  StructEnum.SIGNED_BYTE\r\n]);\r\n\r\nlet StructTypes = {\r\n  \"int\"          : StructEnum.INT,\r\n  \"uint\"         : StructEnum.UINT,\r\n  \"ushort\"       : StructEnum.USHORT,\r\n  \"float\"        : StructEnum.FLOAT,\r\n  \"double\"       : StructEnum.DOUBLE,\r\n  \"string\"       : StructEnum.STRING,\r\n  \"static_string\": StructEnum.STATIC_STRING,\r\n  \"struct\"       : StructEnum.STRUCT,\r\n  \"abstract\"     : StructEnum.TSTRUCT,\r\n  \"array\"        : StructEnum.ARRAY,\r\n  \"iter\"         : StructEnum.ITER,\r\n  \"short\"        : StructEnum.SHORT,\r\n  \"byte\"         : StructEnum.BYTE,\r\n  \"bool\"         : StructEnum.BOOL,\r\n  \"iterkeys\"     : StructEnum.ITERKEYS,\r\n  \"sbyte\"        : StructEnum.SIGNED_BYTE,\r\n  \"optional\"     : StructEnum.OPTIONAL,\r\n};\r\n\r\nlet StructTypeMap = {};\r\n\r\nfor (let k in StructTypes) {\r\n  StructTypeMap[StructTypes[k]] = k;\r\n}\r\n\r\nfunction gen_tabstr$2(t) {\r\n  let s = \"\";\r\n  for (let i = 0; i < t; i++) {\r\n    s += \"  \";\r\n  }\r\n  return s;\r\n}\r\n\r\nfunction stripComments(buf) {\r\n  let s = '';\r\n\r\n  const MAIN = 0, COMMENT = 1, STR = 2;\r\n\r\n  let p, n;\r\n  let strs = new Set([\"'\", '\"', \"`\"]);\r\n  let mode = MAIN;\r\n  let strlit;\r\n  let escape = false;\r\n\r\n  for (let i = 0; i < buf.length; i++) {\r\n    let p = i > 0 ? buf[i - 1] : undefined;\r\n    let c = buf[i];\r\n    let n = i < buf.length - 1 ? buf[i + 1] : undefined;\r\n\r\n    switch (mode) {\r\n      case MAIN:\r\n        if (c === \"/\" && n === \"/\") {\r\n          mode = COMMENT;\r\n          continue;\r\n        }\r\n\r\n        if (strs.has(c)) {\r\n          strlit = c;\r\n          mode = STR;\r\n        }\r\n\r\n        s += c;\r\n\r\n        break;\r\n      case COMMENT:\r\n        if (n === \"\\n\") {\r\n          mode = MAIN;\r\n        }\r\n        break;\r\n      case STR:\r\n        if (c === strlit && !escape) {\r\n          mode = MAIN;\r\n        }\r\n\r\n        s += c;\r\n        break;\r\n    }\r\n\r\n    if (c === \"\\\\\") {\r\n      escape ^= true;\r\n    } else {\r\n      escape = false;\r\n    }\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nfunction StructParser() {\r\n  let basic_types = new Set([\r\n    \"int\", \"float\", \"double\", \"string\", \"short\", \"byte\", \"sbyte\", \"bool\", \"uint\", \"ushort\"\r\n  ]);\r\n\r\n  let reserved_tokens = new Set([\r\n    \"int\", \"float\", \"double\", \"string\", \"static_string\", \"array\",\r\n    \"iter\", \"abstract\", \"short\", \"byte\", \"sbyte\", \"bool\", \"iterkeys\", \"uint\", \"ushort\",\r\n    \"static_array\", \"optional\"\r\n  ]);\r\n\r\n  function tk(name, re, func) {\r\n    return new tokdef(name, re, func);\r\n  }\r\n\r\n  let tokens = [\r\n    tk(\"ID\", /[a-zA-Z_$]+[a-zA-Z0-9_\\.$]*/, function (t) {\r\n\r\n      if (reserved_tokens.has(t.value)) {\r\n        t.type = t.value.toUpperCase();\r\n      }\r\n      return t;\r\n    }, \"identifier\"),\r\n    tk(\"OPEN\", /\\{/),\r\n    tk(\"EQUALS\", /=/),\r\n    tk(\"CLOSE\", /}/),\r\n    tk(\"STRLIT\", /\\\"[^\"]*\\\"/, t => {\r\n      t.value = t.value.slice(1, t.value.length - 1);\r\n      return t;\r\n    }),\r\n    tk(\"STRLIT\", /\\'[^']*\\'/, t => {\r\n      t.value = t.value.slice(1, t.value.length - 1);\r\n      return t;\r\n    }),\r\n    tk(\"COLON\", /:/),\r\n    tk(\"OPT_COLON\", /\\?:/),\r\n    tk(\"SOPEN\", /\\[/),\r\n    tk(\"SCLOSE\", /\\]/),\r\n    tk(\"JSCRIPT\", /\\|/, function (t) {\r\n      let js = \"\";\r\n      let lexer = t.lexer;\r\n      let p;\r\n\r\n      while (lexer.lexpos < lexer.lexdata.length) {\r\n        let c = lexer.lexdata[lexer.lexpos];\r\n        if (c === \"\\n\")\r\n          break;\r\n\r\n        if (c === \"/\" && p === \"/\") {\r\n          js = js.slice(0, js.length - 1);\r\n          lexer.lexpos--;\r\n\r\n          break;\r\n        }\r\n\r\n        js += c;\r\n        lexer.lexpos++;\r\n        p = c;\r\n      }\r\n\r\n      while (js.trim().endsWith(\";\")) {\r\n        js = js.slice(0, js.length - 1);\r\n        lexer.lexpos--;\r\n      }\r\n      t.value = js.trim();\r\n      return t;\r\n    }),\r\n    tk(\"COMMENT\", /\\/\\/.*[\\n\\r]/),\r\n    tk(\"LPARAM\", /\\(/),\r\n    tk(\"RPARAM\", /\\)/),\r\n    tk(\"COMMA\", /,/),\r\n    tk(\"NUM\", /[0-9]+/, undefined, \"number\"),\r\n    tk(\"SEMI\", /;/),\r\n    tk(\"NEWLINE\", /\\n/, function (t) {\r\n      t.lexer.lineno += 1;\r\n    }, \"newline\"),\r\n    tk(\"SPACE\", / |\\t/, function (t) {\r\n    }, \"whitespace\")\r\n  ];\r\n\r\n  reserved_tokens.forEach(function (rt) {\r\n    tokens.push(tk(rt.toUpperCase()));\r\n  });\r\n\r\n  function errfunc(lexer) {\r\n    return true;\r\n  }\r\n\r\n  class Lexer extends lexer {\r\n    input(str) {\r\n      //str = stripComments(str);\r\n      return super.input(str);\r\n    }\r\n  }\r\n\r\n  let lex = new Lexer(tokens, errfunc);\r\n  let parser$1 = new parser(lex);\r\n\r\n  function p_Static_String(p) {\r\n    p.expect(\"STATIC_STRING\");\r\n    p.expect(\"SOPEN\");\r\n    let num = p.expect(\"NUM\");\r\n    p.expect(\"SCLOSE\");\r\n    return {type: StructEnum.STATIC_STRING, data: {maxlength: num}}\r\n  }\r\n\r\n  function p_DataRef(p) {\r\n    p.expect(\"DATAREF\");\r\n    p.expect(\"LPARAM\");\r\n    let tname = p.expect(\"ID\");\r\n    p.expect(\"RPARAM\");\r\n    return {type: StructEnum.DATAREF, data: tname}\r\n  }\r\n\r\n  function p_Array(p) {\r\n    p.expect(\"ARRAY\");\r\n    p.expect(\"LPARAM\");\r\n    let arraytype = p_Type(p);\r\n\r\n    let itername = \"\";\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = arraytype.data.replace(/\"/g, \"\");\r\n      arraytype = p_Type(p);\r\n    }\r\n\r\n    p.expect(\"RPARAM\");\r\n    return {type: StructEnum.ARRAY, data: {type: arraytype, iname: itername}}\r\n  }\r\n\r\n  function p_Iter(p) {\r\n    p.expect(\"ITER\");\r\n    p.expect(\"LPARAM\");\r\n\r\n    let arraytype = p_Type(p);\r\n    let itername = \"\";\r\n\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = arraytype.data.replace(/\"/g, \"\");\r\n      arraytype = p_Type(p);\r\n    }\r\n\r\n    p.expect(\"RPARAM\");\r\n    return {type: StructEnum.ITER, data: {type: arraytype, iname: itername}}\r\n  }\r\n\r\n  function p_StaticArray(p) {\r\n    p.expect(\"STATIC_ARRAY\");\r\n    p.expect(\"SOPEN\");\r\n    let arraytype = p_Type(p);\r\n    let itername = \"\";\r\n\r\n    p.expect(\"COMMA\");\r\n    let size = p.expect(\"NUM\");\r\n\r\n    if (size < 0 || Math.abs(size - Math.floor(size)) > 0.000001) {\r\n      console.log(Math.abs(size - Math.floor(size)));\r\n      p.error(\"Expected an integer\");\r\n    }\r\n\r\n    size = Math.floor(size);\r\n\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = p_Type(p).data;\r\n    }\r\n\r\n    p.expect(\"SCLOSE\");\r\n    return {type: StructEnum.STATIC_ARRAY, data: {type: arraytype, size: size, iname: itername}}\r\n  }\r\n\r\n  function p_IterKeys(p) {\r\n    p.expect(\"ITERKEYS\");\r\n    p.expect(\"LPARAM\");\r\n\r\n    let arraytype = p_Type(p);\r\n    let itername = \"\";\r\n\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = arraytype.data.replace(/\"/g, \"\");\r\n      arraytype = p_Type(p);\r\n    }\r\n\r\n    p.expect(\"RPARAM\");\r\n    return {type: StructEnum.ITERKEYS, data: {type: arraytype, iname: itername}}\r\n  }\r\n\r\n  function p_Abstract(p) {\r\n    p.expect(\"ABSTRACT\");\r\n    p.expect(\"LPARAM\");\r\n    let type = p.expect(\"ID\");\r\n\r\n    let jsonKeyword = \"_structName\";\r\n\r\n    if (p.optional(\"COMMA\")) {\r\n      jsonKeyword = p.expect(\"STRLIT\");\r\n    }\r\n\r\n    p.expect(\"RPARAM\");\r\n\r\n    return {\r\n      type: StructEnum.TSTRUCT,\r\n      data: type,\r\n      jsonKeyword\r\n    }\r\n  }\r\n\r\n  function p_Optional(p) {\r\n    p.expect(\"OPTIONAL\");\r\n    p.expect(\"LPARAM\");\r\n    const type = p_Type(p);\r\n    p.expect(\"RPARAM\");\r\n\r\n    return {\r\n      type: StructEnum.OPTIONAL,\r\n      data: type\r\n    }\r\n  }\r\n\r\n  function p_Type(p) {\r\n    let tok = p.peeknext();\r\n\r\n    if (tok.type === \"ID\") {\r\n      p.next();\r\n      return {type: StructEnum.STRUCT, data: tok.value}\r\n    } else if (basic_types.has(tok.type.toLowerCase())) {\r\n      p.next();\r\n      return {type: StructTypes[tok.type.toLowerCase()]}\r\n    } else if (tok.type === \"ARRAY\") {\r\n      return p_Array(p);\r\n    } else if (tok.type === \"ITER\") {\r\n      return p_Iter(p);\r\n    } else if (tok.type === \"ITERKEYS\") {\r\n      return p_IterKeys(p);\r\n    } else if (tok.type === \"STATIC_ARRAY\") {\r\n      return p_StaticArray(p);\r\n    } else if (tok.type === \"STATIC_STRING\") {\r\n      return p_Static_String(p);\r\n    } else if (tok.type === \"ABSTRACT\") {\r\n      return p_Abstract(p);\r\n    } else if (tok.type === \"DATAREF\") {\r\n      return p_DataRef(p);\r\n    } else if (tok.type === \"OPTIONAL\") {\r\n      return p_Optional(p);\r\n    } else {\r\n      p.error(tok, \"invalid type \" + tok.type);\r\n    }\r\n  }\r\n\r\n  function p_ID_or_num(p) {\r\n    let t = p.peeknext();\r\n\r\n    if (t.type === \"NUM\") {\r\n      p.next();\r\n      return t.value;\r\n    } else {\r\n      return p.expect(\"ID\", \"struct field name\");\r\n    }\r\n  }\r\n\r\n  function p_Field(p) {\r\n    let field = {};\r\n\r\n    field.name = p_ID_or_num(p);\r\n    let is_opt = false;\r\n\r\n    if (p.peeknext().type === \"OPT_COLON\") {\r\n      p.expect(\"OPT_COLON\");\r\n      is_opt = true;\r\n    } else {\r\n      p.expect(\"COLON\");\r\n    }\r\n\r\n    field.type = p_Type(p);\r\n    if (is_opt) {\r\n      field.type = {\r\n        type:  StructEnum.OPTIONAL,\r\n        data: field.type\r\n      };\r\n    }\r\n    field.set = undefined;\r\n    field.get = undefined;\r\n\r\n    let check = 0;\r\n\r\n    let tok = p.peeknext();\r\n\r\n    if (tok && tok.type === \"JSCRIPT\") {\r\n      field.get = tok.value;\r\n      check = 1;\r\n\r\n      p.next();\r\n      tok = p.peeknext();\r\n    }\r\n\r\n    if (tok && tok.type === \"JSCRIPT\") {\r\n      check = 1;\r\n      field.set = tok.value;\r\n\r\n      p.next();\r\n    }\r\n\r\n    p.expect(\"SEMI\");\r\n\r\n    tok = p.peeknext();\r\n\r\n    if (tok && tok.type === \"COMMENT\") {\r\n      field.comment = tok.value;\r\n      p.next();\r\n    } else {\r\n      field.comment = \"\";\r\n    }\r\n\r\n    return field;\r\n  }\r\n\r\n  function p_Struct(p) {\r\n    let name = p.expect(\"ID\", \"struct name\");\r\n\r\n    let st = new NStruct(name);\r\n\r\n    let tok = p.peeknext();\r\n    let id = -1;\r\n\r\n    if (tok.type === \"ID\" && tok.value === \"id\") {\r\n      p.next();\r\n      p.expect(\"EQUALS\");\r\n      st.id = p.expect(\"NUM\");\r\n    }\r\n\r\n    p.expect(\"OPEN\");\r\n    while (1) {\r\n      if (p.at_end()) {\r\n        p.error(undefined);\r\n      } else if (p.optional(\"CLOSE\")) {\r\n        break;\r\n      } else {\r\n        st.fields.push(p_Field(p));\r\n      }\r\n    }\r\n\r\n    return st;\r\n  }\r\n\r\n  parser$1.start = p_Struct;\r\n  return parser$1;\r\n}\r\n\r\nconst struct_parse = StructParser();\n\nvar struct_parser = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  NStruct: NStruct,\n  StructEnum: StructEnum,\n  ArrayTypes: ArrayTypes,\n  ValueTypes: ValueTypes,\n  StructTypes: StructTypes,\n  StructTypeMap: StructTypeMap,\n  stripComments: stripComments,\n  struct_parse: struct_parse\n});\n\n/** dead file */\n\nvar struct_typesystem = /*#__PURE__*/Object.freeze({\n  __proto__: null\n});\n\n\"use strict\";\r\n\r\nvar STRUCT_ENDIAN = true; //little endian\r\n\r\nfunction setBinaryEndian(mode) {\r\n  STRUCT_ENDIAN = !!mode;\r\n}\r\n\r\nlet temp_dataview = new DataView(new ArrayBuffer(16));\r\nlet uint8_view = new Uint8Array(temp_dataview.buffer);\r\n\r\nclass unpack_context {\r\n  constructor() {\r\n    this.i = 0;\r\n  }\r\n}\r\n\r\nfunction pack_byte(array, val) {\r\n  array.push(val);\r\n}\r\n\r\nfunction pack_sbyte(array, val) {\r\n  if (val < 0) {\r\n    val = 256 + val;\r\n  }\r\n\r\n  array.push(val);\r\n}\r\n\r\nfunction pack_bytes(array, bytes) {\r\n  for (let i = 0; i < bytes.length; i++) {\r\n    array.push(bytes[i]);\r\n  }\r\n}\r\n\r\nfunction pack_int(array, val) {\r\n  temp_dataview.setInt32(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n  array.push(uint8_view[2]);\r\n  array.push(uint8_view[3]);\r\n}\r\n\r\nfunction pack_uint(array, val) {\r\n  temp_dataview.setUint32(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n  array.push(uint8_view[2]);\r\n  array.push(uint8_view[3]);\r\n}\r\n\r\nfunction pack_ushort(array, val) {\r\n  temp_dataview.setUint16(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n}\r\n\r\nfunction pack_float(array, val) {\r\n  temp_dataview.setFloat32(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n  array.push(uint8_view[2]);\r\n  array.push(uint8_view[3]);\r\n}\r\n\r\nfunction pack_double(array, val) {\r\n  temp_dataview.setFloat64(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n  array.push(uint8_view[2]);\r\n  array.push(uint8_view[3]);\r\n  array.push(uint8_view[4]);\r\n  array.push(uint8_view[5]);\r\n  array.push(uint8_view[6]);\r\n  array.push(uint8_view[7]);\r\n}\r\n\r\nfunction pack_short(array, val) {\r\n  temp_dataview.setInt16(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n}\r\n\r\nfunction encode_utf8(arr, str) {\r\n  for (let i = 0; i < str.length; i++) {\r\n    let c = str.charCodeAt(i);\r\n\r\n    while (c !== 0) {\r\n      let uc = c & 127;\r\n      c = c >> 7;\r\n\r\n      if (c !== 0)\r\n        uc |= 128;\r\n\r\n      arr.push(uc);\r\n    }\r\n  }\r\n}\r\n\r\nfunction decode_utf8(arr) {\r\n  let str = \"\";\r\n  let i = 0;\r\n\r\n  while (i < arr.length) {\r\n    let c = arr[i];\r\n    let sum = c & 127;\r\n    let j = 0;\r\n    let lasti = i;\r\n\r\n    while (i < arr.length && (c & 128)) {\r\n      j += 7;\r\n      i++;\r\n      c = arr[i];\r\n\r\n      c = (c & 127) << j;\r\n      sum |= c;\r\n    }\r\n\r\n    if (sum === 0) break;\r\n\r\n    str += String.fromCharCode(sum);\r\n    i++;\r\n  }\r\n\r\n  return str;\r\n}\r\n\r\nfunction test_utf8() {\r\n  let s = \"a\" + String.fromCharCode(8800) + \"b\";\r\n  let arr = [];\r\n\r\n  encode_utf8(arr, s);\r\n  let s2 = decode_utf8(arr);\r\n\r\n  if (s !== s2) {\r\n    throw new Error(\"UTF-8 encoding/decoding test failed\");\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction truncate_utf8(arr, maxlen) {\r\n  let len = Math.min(arr.length, maxlen);\r\n\r\n  let last_codepoint = 0;\r\n  let last2 = 0;\r\n\r\n  let incode = false;\r\n  let i = 0;\r\n  let code = 0;\r\n  while (i < len) {\r\n    incode = arr[i] & 128;\r\n\r\n    if (!incode) {\r\n      last2 = last_codepoint + 1;\r\n      last_codepoint = i + 1;\r\n    }\r\n\r\n    i++;\r\n  }\r\n\r\n  if (last_codepoint < maxlen)\r\n    arr.length = last_codepoint;\r\n  else\r\n    arr.length = last2;\r\n\r\n  return arr;\r\n}\r\n\r\nlet _static_sbuf_ss = new Array(2048);\r\n\r\nfunction pack_static_string(data, str, length) {\r\n  if (length === undefined)\r\n    throw new Error(\"'length' paremter is not optional for pack_static_string()\");\r\n\r\n  let arr = length < 2048 ? _static_sbuf_ss : new Array();\r\n  arr.length = 0;\r\n\r\n  encode_utf8(arr, str);\r\n  truncate_utf8(arr, length);\r\n\r\n  for (let i = 0; i < length; i++) {\r\n    if (i >= arr.length) {\r\n      data.push(0);\r\n    } else {\r\n      data.push(arr[i]);\r\n    }\r\n  }\r\n}\r\n\r\nlet _static_sbuf = new Array(32);\r\n\r\n/*strings are packed as 32-bit unicode codepoints*/\r\nfunction pack_string(data, str) {\r\n  _static_sbuf.length = 0;\r\n  encode_utf8(_static_sbuf, str);\r\n\r\n  pack_int(data, _static_sbuf.length);\r\n\r\n  for (let i = 0; i < _static_sbuf.length; i++) {\r\n    data.push(_static_sbuf[i]);\r\n  }\r\n}\r\n\r\nfunction unpack_bytes(dview, uctx, len) {\r\n  let ret = new DataView(dview.buffer.slice(uctx.i, uctx.i + len));\r\n  uctx.i += len;\r\n\r\n  return ret;\r\n}\r\n\r\nfunction unpack_byte(dview, uctx) {\r\n  return dview.getUint8(uctx.i++);\r\n}\r\n\r\nfunction unpack_sbyte(dview, uctx) {\r\n  return dview.getInt8(uctx.i++);\r\n}\r\n\r\nfunction unpack_int(dview, uctx) {\r\n  uctx.i += 4;\r\n  return dview.getInt32(uctx.i - 4, STRUCT_ENDIAN);\r\n}\r\n\r\nfunction unpack_uint(dview, uctx) {\r\n  uctx.i += 4;\r\n  return dview.getUint32(uctx.i - 4, STRUCT_ENDIAN);\r\n}\r\n\r\nfunction unpack_ushort(dview, uctx) {\r\n  uctx.i += 2;\r\n  return dview.getUint16(uctx.i - 2, STRUCT_ENDIAN);\r\n}\r\n\r\nfunction unpack_float(dview, uctx) {\r\n  uctx.i += 4;\r\n  return dview.getFloat32(uctx.i - 4, STRUCT_ENDIAN);\r\n}\r\n\r\nfunction unpack_double(dview, uctx) {\r\n  uctx.i += 8;\r\n  return dview.getFloat64(uctx.i - 8, STRUCT_ENDIAN);\r\n}\r\n\r\nfunction unpack_short(dview, uctx) {\r\n  uctx.i += 2;\r\n  return dview.getInt16(uctx.i - 2, STRUCT_ENDIAN);\r\n}\r\n\r\nlet _static_arr_us = new Array(32);\r\n\r\nfunction unpack_string(data, uctx) {\r\n  let slen = unpack_int(data, uctx);\r\n\r\n  if (!slen) {\r\n    return \"\";\r\n  }\r\n\r\n  let str = \"\";\r\n  let arr = slen < 2048 ? _static_arr_us : new Array(slen);\r\n\r\n  arr.length = slen;\r\n  for (let i = 0; i < slen; i++) {\r\n    arr[i] = unpack_byte(data, uctx);\r\n  }\r\n\r\n  return decode_utf8(arr);\r\n}\r\n\r\nlet _static_arr_uss = new Array(2048);\r\n\r\nfunction unpack_static_string(data, uctx, length) {\r\n  let str = \"\";\r\n\r\n  if (length === undefined)\r\n    throw new Error(\"'length' cannot be undefined in unpack_static_string()\");\r\n\r\n  let arr = length < 2048 ? _static_arr_uss : new Array(length);\r\n  arr.length = 0;\r\n\r\n  let done = false;\r\n  for (let i = 0; i < length; i++) {\r\n    let c = unpack_byte(data, uctx);\r\n\r\n    if (c === 0) {\r\n      done = true;\r\n    }\r\n\r\n    if (!done && c !== 0) {\r\n      arr.push(c);\r\n      //arr.length++;\r\n    }\r\n  }\r\n\r\n  truncate_utf8(arr, length);\r\n  return decode_utf8(arr);\r\n}\n\nvar struct_binpack = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  get STRUCT_ENDIAN () { return STRUCT_ENDIAN; },\n  setBinaryEndian: setBinaryEndian,\n  temp_dataview: temp_dataview,\n  uint8_view: uint8_view,\n  unpack_context: unpack_context,\n  pack_byte: pack_byte,\n  pack_sbyte: pack_sbyte,\n  pack_bytes: pack_bytes,\n  pack_int: pack_int,\n  pack_uint: pack_uint,\n  pack_ushort: pack_ushort,\n  pack_float: pack_float,\n  pack_double: pack_double,\n  pack_short: pack_short,\n  encode_utf8: encode_utf8,\n  decode_utf8: decode_utf8,\n  test_utf8: test_utf8,\n  pack_static_string: pack_static_string,\n  pack_string: pack_string,\n  unpack_bytes: unpack_bytes,\n  unpack_byte: unpack_byte,\n  unpack_sbyte: unpack_sbyte,\n  unpack_int: unpack_int,\n  unpack_uint: unpack_uint,\n  unpack_ushort: unpack_ushort,\n  unpack_float: unpack_float,\n  unpack_double: unpack_double,\n  unpack_short: unpack_short,\n  unpack_string: unpack_string,\n  unpack_static_string: unpack_static_string\n});\n\nlet warninglvl$1 = 2;\r\nlet debug = 0;\r\n\r\nlet _static_envcode_null$1 = \"\";\r\nlet packer_debug$1, packer_debug_start$1, packer_debug_end$1;\r\nlet packdebug_tablevel = 0;\r\n\r\nfunction _get_pack_debug() {\r\n  return {\r\n    packer_debug: packer_debug$1, packer_debug_start: packer_debug_start$1, packer_debug_end: packer_debug_end$1,\r\n    debug, warninglvl: warninglvl$1\r\n  }\r\n}\r\n\r\nclass cachering extends Array {\r\n  constructor(cb, tot) {\r\n    super();\r\n    this.length = tot;\r\n    this.cur = 0;\r\n\r\n    for (let i = 0; i < tot; i++) {\r\n      this[i] = cb();\r\n    }\r\n  }\r\n\r\n  static fromConstructor(cls, tot) {\r\n    return new cachering(() => new cls(), tot);\r\n  }\r\n\r\n  next() {\r\n    let ret = this[this.cur];\r\n\r\n    this.cur = (this.cur + 1)%this.length;\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nfunction gen_tabstr$1(tot) {\r\n  let ret = \"\";\r\n\r\n  for (let i = 0; i < tot; i++) {\r\n    ret += \" \";\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nfunction setWarningMode2(t) {\r\n  if (typeof t !== \"number\" || isNaN(t)) {\r\n    throw new Error(\"Expected a single number (>= 0) argument to setWarningMode\");\r\n  }\r\n\r\n  warninglvl$1 = t;\r\n}\r\n\r\nfunction setDebugMode2(t) {\r\n  debug = t;\r\n\r\n  if (debug) {\r\n    packer_debug$1 = function () {\r\n      let tab = gen_tabstr$1(packdebug_tablevel);\r\n\r\n      if (arguments.length > 0) {\r\n        console.warn(tab, ...arguments);\r\n      } else {\r\n        console.warn(\"Warning: undefined msg\");\r\n      }\r\n    };\r\n    packer_debug_start$1 = function (funcname) {\r\n      packer_debug$1(\"Start \" + funcname);\r\n      packdebug_tablevel++;\r\n    };\r\n\r\n    packer_debug_end$1 = function (funcname) {\r\n      packdebug_tablevel--;\r\n\r\n      if (funcname) {\r\n        packer_debug$1(\"Leave \" + funcname);\r\n      }\r\n    };\r\n  } else {\r\n    packer_debug$1 = function () {\r\n    };\r\n    packer_debug_start$1 = function () {\r\n    };\r\n    packer_debug_end$1 = function () {\r\n    };\r\n  }\r\n}\r\n\r\nsetDebugMode2(debug);\r\n\r\nconst StructFieldTypes = [];\r\nconst StructFieldTypeMap = {};\r\n\r\nfunction packNull(manager, data, field, type) {\r\n  StructFieldTypeMap[type.type].packNull(manager, data, field, type);\r\n}\r\n\r\nfunction toJSON(manager, val, obj, field, type) {\r\n  return StructFieldTypeMap[type.type].toJSON(manager, val, obj, field, type);\r\n}\r\n\r\nfunction fromJSON(manager, val, obj, field, type, instance) {\r\n  return StructFieldTypeMap[type.type].fromJSON(manager, val, obj, field, type, instance);\r\n}\r\n\r\nfunction formatJSON$1(manager, val, obj, field, type, instance, tlvl = 0) {\r\n  return StructFieldTypeMap[type.type].formatJSON(manager, val, obj, field, type, instance, tlvl);\r\n}\r\n\r\nfunction validateJSON$1(manager, val, obj, field, type, instance, _abstractKey) {\r\n  return StructFieldTypeMap[type.type].validateJSON(manager, val, obj, field, type, instance, _abstractKey);\r\n}\r\n\r\n\r\nfunction unpack_field(manager, data, type, uctx) {\r\n  let name;\r\n\r\n  if (debug) {\r\n    name = StructFieldTypeMap[type.type].define().name;\r\n    packer_debug_start$1(\"R \" + name);\r\n  }\r\n\r\n  let ret = StructFieldTypeMap[type.type].unpack(manager, data, type, uctx);\r\n\r\n  if (debug) {\r\n    packer_debug_end$1();\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nlet fakeFields = new cachering(() => {\r\n  return {type: undefined, get: undefined, set: undefined}\r\n}, 256);\r\n\r\nfunction fmt_type(type) {\r\n  return StructFieldTypeMap[type.type].format(type);\r\n}\r\n\r\nfunction do_pack(manager, data, val, obj, field, type) {\r\n  let name;\r\n\r\n  if (debug) {\r\n    name = StructFieldTypeMap[type.type].define().name;\r\n    packer_debug_start$1(\"W \" + name);\r\n  }\r\n\r\n  let typeid = type;\r\n  if (typeof typeid !== \"number\") {\r\n    typeid = typeid.type;\r\n  }\r\n\r\n  let ret = StructFieldTypeMap[typeid].pack(manager, data, val, obj, field, type);\r\n\r\n  if (debug) {\r\n    packer_debug_end$1();\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nlet _ws_env$1 = [[undefined, undefined]];\r\n\r\nclass StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    this.pack(manager, data, 0, 0, field, type);\r\n  }\r\n\r\n  static format(type) {\r\n    return this.define().name;\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    return val;\r\n  }\r\n\r\n  static fromJSON(manager, val, obj, field, type, instance) {\r\n    return val;\r\n  }\r\n\r\n  static formatJSON(manager, val, obj, field, type, instance, tlvl) {\r\n    return JSON.stringify(val);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance, _abstractKey) {\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   return false to override default\r\n   helper js for packing\r\n   */\r\n  static useHelperJS(field) {\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   Define field class info.\r\n\r\n   Example:\r\n   <pre>\r\n   static define() {return {\r\n    type : StructEnum.INT,\r\n    name : \"int\"\r\n  }}\r\n   </pre>\r\n   */\r\n  static define() {\r\n    return {\r\n      type: -1,\r\n      name: \"(error)\"\r\n    }\r\n  }\r\n\r\n  /**\r\n   Register field packer/unpacker class.  Will throw an error if define() method is bad.\r\n   */\r\n  static register(cls) {\r\n    if (StructFieldTypes.indexOf(cls) >= 0) {\r\n      throw new Error(\"class already registered\");\r\n    }\r\n\r\n    if (cls.define === StructFieldType.define) {\r\n      throw new Error(\"you forgot to make a define() static method\");\r\n    }\r\n\r\n    if (cls.define().type === undefined) {\r\n      throw new Error(\"cls.define().type was undefined!\");\r\n    }\r\n\r\n    if (cls.define().type in StructFieldTypeMap) {\r\n      throw new Error(\"type \" + cls.define().type + \" is used by another StructFieldType subclass\");\r\n    }\r\n\r\n    StructFieldTypes.push(cls);\r\n    StructFieldTypeMap[cls.define().type] = cls;\r\n  }\r\n}\r\n\r\nclass StructIntField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_int(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_int(data, uctx);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (typeof val !== \"number\" || val !== Math.floor(val)) {\r\n      return \"\" + val + \" is not an integer\";\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.INT,\r\n      name: \"int\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructIntField);\r\n\r\nclass StructFloatField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_float(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_float(data, uctx);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance, _abstractKey) {\r\n    if (typeof val !== \"number\") {\r\n      return \"Not a float: \" + val;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.FLOAT,\r\n      name: \"float\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructFloatField);\r\n\r\nclass StructDoubleField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_double(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_double(data, uctx);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (typeof val !== \"number\") {\r\n      return \"Not a double: \" + val;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.DOUBLE,\r\n      name: \"double\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructDoubleField);\r\n\r\nclass StructStringField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    val = !val ? \"\" : val;\r\n\r\n    pack_string(data, val);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (typeof val !== \"string\") {\r\n      return \"Not a string: \" + val;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    this.pack(manager, data, \"\", 0, field, type);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_string(data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.STRING,\r\n      name: \"string\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructStringField);\r\n\r\nclass StructStaticStringField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    val = !val ? \"\" : val;\r\n\r\n    pack_static_string(data, val, type.data.maxlength);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (typeof val !== \"string\") {\r\n      return \"Not a string: \" + val;\r\n    }\r\n\r\n\r\n    if (val.length > type.data.maxlength) {\r\n      return \"String is too big; limit is \" + type.data.maxlength + \"; string:\" + val;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static format(type) {\r\n    return `static_string[${type.data.maxlength}]`;\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    this.pack(manager, data, \"\", 0, field, type);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_static_string(data, uctx, type.data.maxlength);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.STATIC_STRING,\r\n      name: \"static_string\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructStaticStringField);\r\n\r\nclass StructStructField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    packer_debug$1(\"struct\", stt.name);\r\n\r\n    manager.write_struct(data, val, stt);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance, _abstractKey) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    if (!val) {\r\n      return \"Expected \" + stt.name + \" object\";\r\n    }\r\n\r\n    return manager.validateJSONIntern(val, stt, _abstractKey);\r\n  }\r\n\r\n  static format(type) {\r\n    return type.data;\r\n  }\r\n\r\n  static fromJSON(manager, val, obj, field, type, instance) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    return manager.readJSON(val, stt, instance);\r\n  }\r\n\r\n  static formatJSON(manager, val, obj, field, type, instance, tlvl) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    return manager.formatJSON_intern(val, stt, field, tlvl);\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    let stt = manager.get_struct(type.data);\r\n    return manager.writeJSON(val, stt);\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, dest) {\r\n    let cls2 = manager.get_struct_cls(type.data);\r\n\r\n    packer_debug$1(\"struct\", cls2 ? cls2.name : \"(error)\");\r\n    return manager.read_object(data, cls2, uctx, dest);\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    packer_debug$1(\"struct\", type);\r\n\r\n    for (let field2 of stt.fields) {\r\n      let type2 = field2.type;\r\n\r\n      packNull(manager, data, field2, type2);\r\n    }\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let cls2 = manager.get_struct_cls(type.data);\r\n    packer_debug$1(\"struct\", cls2 ? cls2.name : \"(error)\");\r\n\r\n    return manager.read_object(data, cls2, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.STRUCT,\r\n      name: \"struct\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructStructField);\r\n\r\nclass StructTStructField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    let cls = manager.get_struct_cls(type.data);\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    const keywords = manager.constructor.keywords;\r\n\r\n    //make sure inheritance is correct\r\n    if (val.constructor.structName !== type.data && (val instanceof cls)) {\r\n      //if (DEBUG.Struct) {\r\n      //    console.log(val.constructor.structName+\" inherits from \"+cls.structName);\r\n      //}\r\n      stt = manager.get_struct(val.constructor.structName);\r\n    } else if (val.constructor.structName === type.data) {\r\n      stt = manager.get_struct(type.data);\r\n    } else {\r\n      console.trace();\r\n      throw new Error(\"Bad struct \" + val.constructor.structName + \" passed to write_struct\");\r\n    }\r\n\r\n    packer_debug$1(\"int \" + stt.id);\r\n\r\n    pack_int(data, stt.id);\r\n    manager.write_struct(data, val, stt);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance, _abstractKey) {\r\n    let key = type.jsonKeyword;\r\n\r\n    if (typeof val !== \"object\") {\r\n      return typeof val + \" is not an object\";\r\n    }\r\n\r\n    let stt = manager.get_struct(val[key]);\r\n    let cls = manager.get_struct_cls(stt.name);\r\n    let parentcls = manager.get_struct_cls(type.data);\r\n\r\n    let ok = false;\r\n\r\n    do {\r\n      if (cls === parentcls) {\r\n        ok = true;\r\n        break;\r\n      }\r\n\r\n      cls = cls.prototype.__proto__.constructor;\r\n    } while (cls && cls !== Object);\r\n\r\n    if (!ok) {\r\n      return stt.name + \" is not a child class off \" + type.data;\r\n    }\r\n\r\n    return manager.validateJSONIntern(val, stt, type.jsonKeyword);\r\n  }\r\n\r\n\r\n  static fromJSON(manager, val, obj, field, type, instance) {\r\n    let key = type.jsonKeyword;\r\n\r\n    let stt = manager.get_struct(val[key]);\r\n\r\n    return manager.readJSON(val, stt, instance);\r\n  }\r\n\r\n  static formatJSON(manager, val, obj, field, type, instance, tlvl) {\r\n    let key = type.jsonKeyword;\r\n\r\n    let stt = manager.get_struct(val[key]);\r\n\r\n    return manager.formatJSON_intern(val, stt, field, tlvl);\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    const keywords = manager.constructor.keywords;\r\n\r\n    let stt = manager.get_struct(val.constructor.structName);\r\n    let ret = manager.writeJSON(val, stt);\r\n\r\n    ret[type.jsonKeyword] = \"\" + stt.name;\r\n\r\n    return ret;\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    pack_int(data, stt.id);\r\n    packNull(manager, data, field, {type: StructEnum.STRUCT, data: type.data});\r\n  }\r\n\r\n  static format(type) {\r\n    return \"abstract(\" + type.data + \")\";\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, dest) {\r\n    let id = unpack_int(data, uctx);\r\n\r\n    packer_debug$1(\"-int \" + id);\r\n    if (!(id in manager.struct_ids)) {\r\n      packer_debug$1(\"tstruct id: \" + id);\r\n      console.trace();\r\n      console.log(id);\r\n      console.log(manager.struct_ids);\r\n      throw new Error(\"Unknown struct type \" + id + \".\");\r\n    }\r\n\r\n    let cls2 = manager.get_struct_id(id);\r\n\r\n    packer_debug$1(\"struct name: \" + cls2.name);\r\n\r\n    cls2 = manager.struct_cls[cls2.name];\r\n\r\n    return manager.read_object(data, cls2, uctx, dest);\r\n    //packer_debug(\"ret\", ret);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let id = unpack_int(data, uctx);\r\n\r\n    packer_debug$1(\"-int \" + id);\r\n    if (!(id in manager.struct_ids)) {\r\n      packer_debug$1(\"tstruct id: \" + id);\r\n      console.trace();\r\n      console.log(id);\r\n      console.log(manager.struct_ids);\r\n      throw new Error(\"Unknown struct type \" + id + \".\");\r\n    }\r\n\r\n    let cls2 = manager.get_struct_id(id);\r\n\r\n    packer_debug$1(\"struct name: \" + cls2.name);\r\n    cls2 = manager.struct_cls[cls2.name];\r\n\r\n    return manager.read_object(data, cls2, uctx);\r\n    //packer_debug(\"ret\", ret);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.TSTRUCT,\r\n      name: \"tstruct\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructTStructField);\r\n\r\n/** out is just a [string], an array of dimen 1 whose sole entry is the output string. */\r\nfunction formatArrayJson(manager, val, obj, field, type, type2, instance, tlvl, array = val) {\r\n  if (array === undefined || array === null || typeof array !== \"object\" || !array[Symbol.iterator]) {\r\n    console.log(obj);\r\n    console.log(array);\r\n    throw new Error(`Expected an array for ${field.name}`);\r\n  }\r\n\r\n  if (ValueTypes.has(type2.type)) {\r\n    return JSON.stringify(array);\r\n  }\r\n\r\n  let s = '[';\r\n  if (manager.formatCtx.addComments && field.comment.trim()) {\r\n    s += \" \" + field.comment.trim();\r\n  }\r\n\r\n  s += \"\\n\";\r\n\r\n  for (let i = 0; i < array.length; i++) {\r\n    let item = array[i];\r\n\r\n    s += tab(tlvl + 1) + formatJSON$1(manager, item, val, field, type2, instance, tlvl + 1) + \",\\n\";\r\n  }\r\n\r\n  s += tab(tlvl) + \"]\";\r\n\r\n  return s;\r\n}\r\n\r\nclass StructArrayField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    if (val === undefined) {\r\n      console.trace();\r\n      console.log(\"Undefined array fed to struct struct packer!\");\r\n      console.log(\"Field: \", field);\r\n      console.log(\"Type: \", type);\r\n      console.log(\"\");\r\n      packer_debug$1(\"int 0\");\r\n      pack_int(data, 0);\r\n      return;\r\n    }\r\n\r\n    packer_debug$1(\"int \" + val.length);\r\n    pack_int(data, val.length);\r\n\r\n    let d = type.data;\r\n\r\n    let itername = d.iname;\r\n    let type2 = d.type;\r\n\r\n    let env = _ws_env$1;\r\n    for (let i = 0; i < val.length; i++) {\r\n      let val2 = val[i];\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n      }\r\n\r\n      //XXX not sure I really need this fakeField stub here. . .\r\n      let fakeField = fakeFields.next();\r\n      fakeField.type = type2;\r\n      do_pack(manager, data, val2, obj, fakeField, type2);\r\n    }\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    pack_int(data, 0);\r\n  }\r\n\r\n  static format(type) {\r\n    if (type.data.iname !== \"\" && type.data.iname !== undefined) {\r\n      return \"array(\" + type.data.iname + \", \" + fmt_type(type.data.type) + \")\";\r\n    } else {\r\n      return \"array(\" + fmt_type(type.data.type) + \")\";\r\n    }\r\n  }\r\n\r\n  static useHelperJS(field) {\r\n    return !field.type.data.iname;\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance, _abstractKey) {\r\n    if (!val) {\r\n      return \"not an array: \" + val;\r\n    }\r\n\r\n    for (let i = 0; i < val.length; i++) {\r\n      let ret = validateJSON$1(manager, val[i], val, field, type.data.type, undefined, _abstractKey);\r\n\r\n      if (typeof ret === \"string\" || !ret) {\r\n        return ret;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static fromJSON(manager, val, obj, field, type, instance) {\r\n    let ret = instance || [];\r\n\r\n    ret.length = 0;\r\n\r\n    for (let i = 0; i < val.length; i++) {\r\n      let val2 = fromJSON(manager, val[i], val, field, type.data.type, undefined);\r\n\r\n      if (val2 === undefined) {\r\n        console.log(val2);\r\n        console.error(\"eeek\");\r\n        process.exit();\r\n      }\r\n\r\n      ret.push(val2);\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  static formatJSON(manager, val, obj, field, type, instance, tlvl) {\r\n    //export function formatArrayJson(manager, val, obj, field, type, type2, instance, tlvl, array=val) {\r\n\r\n    return formatArrayJson(manager, val, obj, field, type, type.data.type, instance, tlvl);\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    val = val || [];\r\n    let json = [];\r\n\r\n    let itername = type.data.iname;\r\n\r\n    for (let i = 0; i < val.length; i++) {\r\n      let val2 = val[i];\r\n      let env = _ws_env$1;\r\n\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n\r\n        //console.log(\"VAL2\", val2, toJSON(manager, val2, val, field, type.data.type));\r\n      }\r\n\r\n      json.push(toJSON(manager, val2, val, field, type.data.type));\r\n    }\r\n\r\n    return json;\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, dest) {\r\n    let len = unpack_int(data, uctx);\r\n    dest.length = 0;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      dest.push(unpack_field(manager, data, type.data.type, uctx));\r\n    }\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let len = unpack_int(data, uctx);\r\n    packer_debug$1(\"-int \" + len);\r\n\r\n    let arr = new Array(len);\r\n    for (let i = 0; i < len; i++) {\r\n      arr[i] = unpack_field(manager, data, type.data.type, uctx);\r\n    }\r\n\r\n    return arr;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.ARRAY,\r\n      name: \"array\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructArrayField);\r\n\r\nclass StructIterField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    //this was originally implemented to use ES6 iterators.\r\n    function forEach(cb, thisvar) {\r\n      if (val && val[Symbol.iterator]) {\r\n        for (let item of val) {\r\n          cb.call(thisvar, item);\r\n        }\r\n      } else if (val && val.forEach) {\r\n        val.forEach(function (item) {\r\n          cb.call(thisvar, item);\r\n        });\r\n      } else {\r\n        console.trace();\r\n        console.log(\"Undefined iterable list fed to struct struct packer!\", val);\r\n        console.log(\"Field: \", field);\r\n        console.log(\"Type: \", type);\r\n        console.log(\"\");\r\n      }\r\n    }\r\n\r\n    /* save space for length */\r\n    let starti = data.length;\r\n    data.length += 4;\r\n\r\n    let d = type.data, itername = d.iname, type2 = d.type;\r\n    let env = _ws_env$1;\r\n\r\n    let i = 0;\r\n    forEach(function (val2) {\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n      }\r\n\r\n      //XXX not sure I really need this fakeField stub here. . .\r\n      let fakeField = fakeFields.next();\r\n      fakeField.type = type2;\r\n      do_pack(manager, data, val2, obj, fakeField, type2);\r\n\r\n      i++;\r\n    }, this);\r\n\r\n    /* write length */\r\n    temp_dataview.setInt32(0, i, STRUCT_ENDIAN);\r\n\r\n    data[starti++] = uint8_view[0];\r\n    data[starti++] = uint8_view[1];\r\n    data[starti++] = uint8_view[2];\r\n    data[starti++] = uint8_view[3];\r\n  }\r\n\r\n  static formatJSON(manager, val, obj, field, type, instance, tlvl) {\r\n    return formatArrayJson(manager, val, obj, field, type, type.data.type, instance, tlvl, list(val));\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    return StructArrayField.validateJSON(...arguments);\r\n  }\r\n\r\n  static fromJSON() {\r\n    return StructArrayField.fromJSON(...arguments);\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    val = val || [];\r\n    let json = [];\r\n\r\n    let itername = type.data.iname;\r\n\r\n    for (let val2 of val) {\r\n      let env = _ws_env$1;\r\n\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n\r\n        //console.log(\"VAL2\", val2, toJSON(manager, val2, val, field, type.data.type));\r\n      }\r\n\r\n      json.push(toJSON(manager, val2, val, field, type.data.type));\r\n    }\r\n\r\n    return json;\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    pack_int(data, 0);\r\n  }\r\n\r\n  static useHelperJS(field) {\r\n    return !field.type.data.iname;\r\n  }\r\n\r\n  static format(type) {\r\n    if (type.data.iname !== \"\" && type.data.iname !== undefined) {\r\n      return \"iter(\" + type.data.iname + \", \" + fmt_type(type.data.type) + \")\";\r\n    } else {\r\n      return \"iter(\" + fmt_type(type.data.type) + \")\";\r\n    }\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, arr) {\r\n    let len = unpack_int(data, uctx);\r\n    packer_debug$1(\"-int \" + len);\r\n\r\n    arr.length = 0;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      arr.push(unpack_field(manager, data, type.data.type, uctx));\r\n    }\r\n\r\n    return arr;\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let len = unpack_int(data, uctx);\r\n    packer_debug$1(\"-int \" + len);\r\n\r\n    let arr = new Array(len);\r\n    for (let i = 0; i < len; i++) {\r\n      arr[i] = unpack_field(manager, data, type.data.type, uctx);\r\n    }\r\n\r\n    return arr;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.ITER,\r\n      name: \"iter\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructIterField);\r\n\r\nclass StructShortField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_short(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_short(data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.SHORT,\r\n      name: \"short\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructShortField);\r\n\r\nclass StructByteField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_byte(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_byte(data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.BYTE,\r\n      name: \"byte\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructByteField);\r\n\r\nclass StructSignedByteField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_sbyte(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_sbyte(data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.SIGNED_BYTE,\r\n      name: \"sbyte\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructSignedByteField);\r\n\r\nclass StructBoolField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_byte(data, !!val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return !!unpack_byte(data, uctx);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (val === 0 || val === 1 || val === true || val === false || val === \"true\" || val === \"false\") {\r\n      return true;\r\n    }\r\n\r\n    return \"\" + val + \" is not a bool\";\r\n  }\r\n\r\n  static fromJSON(manager, val, obj, field, type, instance) {\r\n    if (val === \"false\") {\r\n      val = false;\r\n    }\r\n\r\n    return !!val;\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    return !!val;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.BOOL,\r\n      name: \"bool\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructBoolField);\r\n\r\nclass StructIterKeysField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    //this was originally implemented to use ES6 iterators.\r\n    if ((typeof val !== \"object\" && typeof val !== \"function\") || val === null) {\r\n      console.warn(\"Bad object fed to iterkeys in struct packer!\", val);\r\n      console.log(\"Field: \", field);\r\n      console.log(\"Type: \", type);\r\n      console.log(\"\");\r\n\r\n      pack_int(data, 0);\r\n      return;\r\n    }\r\n\r\n    let len = 0.0;\r\n    for (let k in val) {\r\n      len++;\r\n    }\r\n\r\n    packer_debug$1(\"int \" + len);\r\n    pack_int(data, len);\r\n\r\n    let d = type.data, itername = d.iname, type2 = d.type;\r\n    let env = _ws_env$1;\r\n\r\n    let i = 0;\r\n    for (let val2 in val) {\r\n      if (i >= len) {\r\n        if (warninglvl$1 > 0) {\r\n          console.warn(\"Warning: object keys magically replaced during iteration\", val, i);\r\n        }\r\n        return;\r\n      }\r\n\r\n      if (itername && itername.trim().length > 0 && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n      } else {\r\n        val2 = val[val2]; //fetch value\r\n      }\r\n\r\n      let f2 = {type: type2, get: undefined, set: undefined};\r\n      do_pack(manager, data, val2, obj, f2, type2);\r\n\r\n      i++;\r\n    }\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    return StructArrayField.validateJSON(...arguments);\r\n  }\r\n\r\n  static fromJSON() {\r\n    return StructArrayField.fromJSON(...arguments);\r\n  }\r\n\r\n  static formatJSON(manager, val, obj, field, type, instance, tlvl) {\r\n    return formatArrayJson(manager, val, obj, field, type, type.data.type, instance, tlvl, list(val));\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    val = val || [];\r\n    let json = [];\r\n\r\n    let itername = type.data.iname;\r\n\r\n    for (let k in val) {\r\n      let val2 = val[k];\r\n      let env = _ws_env$1;\r\n\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n\r\n        //console.log(\"VAL2\", val2, toJSON(manager, val2, val, field, type.data.type));\r\n      }\r\n\r\n      json.push(toJSON(manager, val2, val, field, type.data.type));\r\n    }\r\n\r\n    return json;\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    pack_int(data, 0);\r\n  }\r\n\r\n  static useHelperJS(field) {\r\n    return !field.type.data.iname;\r\n  }\r\n\r\n  static format(type) {\r\n    if (type.data.iname !== \"\" && type.data.iname !== undefined) {\r\n      return \"iterkeys(\" + type.data.iname + \", \" + fmt_type(type.data.type) + \")\";\r\n    } else {\r\n      return \"iterkeys(\" + fmt_type(type.data.type) + \")\";\r\n    }\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, arr) {\r\n    let len = unpack_int(data, uctx);\r\n    packer_debug$1(\"-int \" + len);\r\n\r\n    arr.length = 0;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      arr.push(unpack_field(manager, data, type.data.type, uctx));\r\n    }\r\n\r\n    return arr;\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let len = unpack_int(data, uctx);\r\n    packer_debug$1(\"-int \" + len);\r\n\r\n    let arr = new Array(len);\r\n    for (let i = 0; i < len; i++) {\r\n      arr[i] = unpack_field(manager, data, type.data.type, uctx);\r\n    }\r\n\r\n    return arr;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.ITERKEYS,\r\n      name: \"iterkeys\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructIterKeysField);\r\n\r\nclass StructUintField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_uint(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_uint(data, uctx);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (typeof val !== \"number\" || val !== Math.floor(val)) {\r\n      return \"\" + val + \" is not an integer\";\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.UINT,\r\n      name: \"uint\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructUintField);\r\n\r\n\r\nclass StructUshortField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_ushort(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_ushort(data, uctx);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (typeof val !== \"number\" || val !== Math.floor(val)) {\r\n      return \"\" + val + \" is not an integer\";\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.USHORT,\r\n      name: \"ushort\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructUshortField);\r\n\r\n//let writeEmpty = writeEmpty = function writeEmpty(stt) {\r\n//}\r\n\r\nclass StructStaticArrayField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    if (type.data.size === undefined) {\r\n      throw new Error(\"type.data.size was undefined\");\r\n    }\r\n\r\n    let itername = type.data.iname;\r\n\r\n    if (val === undefined || !val.length) {\r\n      this.packNull(manager, data, field, type);\r\n      return;\r\n    }\r\n\r\n    for (let i = 0; i < type.data.size; i++) {\r\n      let i2 = Math.min(i, Math.min(val.length - 1, type.data.size));\r\n      let val2 = val[i2];\r\n\r\n      //*\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        let env = _ws_env$1;\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n      }\r\n\r\n      do_pack(manager, data, val2, val, field, type.data.type);\r\n    }\r\n  }\r\n\r\n  static useHelperJS(field) {\r\n    return !field.type.data.iname;\r\n  }\r\n\r\n  static validateJSON() {\r\n    return StructArrayField.validateJSON(...arguments);\r\n  }\r\n\r\n  static fromJSON() {\r\n    return StructArrayField.fromJSON(...arguments);\r\n  }\r\n\r\n  static formatJSON(manager, val, obj, field, type, instance, tlvl) {\r\n    return formatArrayJson(manager, val, obj, field, type, type.data.type, instance, tlvl, list(val));\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    let size = type.data.size;\r\n    for (let i = 0; i < size; i++) {\r\n      packNull(manager, data, field, type.data.type);\r\n    }\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    return StructArrayField.toJSON(...arguments);\r\n  }\r\n\r\n  static format(type) {\r\n    let type2 = StructFieldTypeMap[type.data.type.type].format(type.data.type);\r\n\r\n    let ret = `static_array[${type2}, ${type.data.size}`;\r\n\r\n    if (type.data.iname) {\r\n      ret += `, ${type.data.iname}`;\r\n    }\r\n    ret += `]`;\r\n\r\n    return ret;\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, ret) {\r\n    packer_debug$1(\"-size: \" + type.data.size);\r\n\r\n    ret.length = 0;\r\n\r\n    for (let i = 0; i < type.data.size; i++) {\r\n      ret.push(unpack_field(manager, data, type.data.type, uctx));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    packer_debug$1(\"-size: \" + type.data.size);\r\n\r\n    let ret = [];\r\n\r\n    for (let i = 0; i < type.data.size; i++) {\r\n      ret.push(unpack_field(manager, data, type.data.type, uctx));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.STATIC_ARRAY,\r\n      name: \"static_array\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructStaticArrayField);\r\n\r\nclass StructOptionalField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_int(data, val !== undefined && val !== null ? 1 : 0);\r\n    if (val !== undefined && val !== null) {\r\n      const fakeField = {...field};\r\n      fakeField.type = type.data;\r\n      do_pack(manager, data, val, obj, fakeField, type.data);\r\n    }\r\n  }\r\n\r\n  static fakeField(field, type) {\r\n    return {...field, type: type.data}\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance, _abstractKey) {\r\n    const fakeField = this.fakeField(field, type); \r\n    return val !== undefined && val !== null ? validateJSON$1(manager, val, obj, fakeField, type.data, undefined, _abstractKey) : true;\r\n  }\r\n\r\n\r\n  static fromJSON(manager, val, obj, field, type, instance) {\r\n    const fakeField = this.fakeField(field, type); \r\n    return val !== undefined && val !== null ? fromJSON(manager, val, obj, fakeField, type.data, undefined) : undefined;\r\n  }\r\n\r\n  static formatJSON(manager, val, obj, field, type, instance, tlvl) {\r\n    if (val !== undefined && val !== null) {\r\n      const fakeField = this.fakeField(field, type);   \r\n      return formatJSON$1(manager, item, val, fakeField, type.data, instance, tlvl + 1) \r\n    }\r\n    return 'null';\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    const fakeField = this.fakeField(field, type);\r\n    return val !== undefined && val !== null ? toJSON(manager, val, obj, fakeField, type.data) : null\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    pack_int(data, 0);\r\n  }\r\n\r\n  static format(type) {\r\n    return \"optional(\" + fmt_type(type.data) + \")\";\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, dest) {\r\n    let exists = unpack_int(data, uctx);\r\n\r\n    packer_debug$1(\"-int \" + id);\r\n    packer_debug$1(\"optional exists: \" + exists);\r\n\r\n    if (!exists) {\r\n      return\r\n    }\r\n\r\n    unpack_field(manager, data, type.data, uctx);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let exists = unpack_int(data, uctx);\r\n  \r\n    if (!exists) {\r\n      return undefined\r\n    }\r\n\r\n    return unpack_field(manager, data, type.data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.OPTIONAL,\r\n      name: \"optional\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructOptionalField);\n\nvar _sintern2 = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  _get_pack_debug: _get_pack_debug,\n  setWarningMode2: setWarningMode2,\n  setDebugMode2: setDebugMode2,\n  StructFieldTypes: StructFieldTypes,\n  StructFieldTypeMap: StructFieldTypeMap,\n  packNull: packNull,\n  toJSON: toJSON,\n  fromJSON: fromJSON,\n  formatJSON: formatJSON$1,\n  validateJSON: validateJSON$1,\n  do_pack: do_pack,\n  StructFieldType: StructFieldType,\n  formatArrayJson: formatArrayJson\n});\n\nvar structEval = eval;\r\n\r\nfunction setStructEval(val) {\r\n  structEval = val;\r\n}\n\nvar _struct_eval = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  get structEval () { return structEval; },\n  setStructEval: setStructEval\n});\n\nconst TokSymbol = Symbol(\"token-info\");\r\n\r\nfunction buildJSONParser() {\r\n  let tk = (name, re, func, example) => new tokdef(name, re, func, example);\r\n\r\n  let parse;\r\n\r\n  let nint = \"[+-]?[0-9]+\";\r\n  let nhex = \"[+-]?0x[0-9a-fA-F]+\";\r\n  let nfloat1 = \"[+-]?[0-9]+\\\\.[0-9]*\";\r\n  let nfloat2 = \"[+-]?[0-9]*\\\\.[0-9]+\";\r\n  let nfloat3 = \"[+-]?[0-9]+\\\\.[0-9]+\";\r\n  let nfloatexp = \"[+-]?[0-9]+\\\\.[0-9]+[eE][+-]?[0-9]+\";\r\n\r\n  let nfloat = `(${nfloat1})|(${nfloat2})|(${nfloatexp})`;\r\n  let num = `(${nint})|(${nfloat})|(${nhex})`;\r\n  let numre = new RegExp(num);\r\n\r\n  let numreTest = new RegExp(`(${num})$`);\r\n\r\n  //nfloat3 has to be its own regexp, the parser\r\n  //always chooses the token handler that parses the most input,\r\n  //and we don't want the partial 0. and .0 handles to split\r\n  //e.g. 3.5 into 3 and 0.5\r\n  nfloat3 = new RegExp(nfloat3);\r\n  nfloatexp = new RegExp(nfloatexp);\r\n\r\n  let tests = [\"1.234234\", \".23432\", \"-234.\", \"1e-17\", \"-0x23423ff\", \"+23423\", \"-4.263256414560601e-14\"];\r\n  for (let test of tests) {\r\n    if (!numreTest.test(test)) {\r\n      console.error(\"Error! Number regexp failed:\", test);\r\n    }\r\n  }\r\n\r\n  let tokens = [\r\n    tk(\"BOOL\", /true|false/),\r\n    tk(\"WS\", /[ \\r\\t\\n]/, t => undefined), //drop token\r\n    tk(\"STRLIT\", /[\"']/, t => {\r\n      let lex = t.lexer;\r\n      let char = t.value;\r\n      let i = lex.lexpos;\r\n      let lexdata = lex.lexdata;\r\n\r\n      let escape = 0;\r\n      t.value = \"\";\r\n      let prev;\r\n\r\n      while (i < lexdata.length) {\r\n        let c = lexdata[i];\r\n\r\n        t.value += c;\r\n\r\n        if (c === \"\\\\\") {\r\n          escape ^= true;\r\n        } else if (!escape && c === char) {\r\n          break;\r\n        } else {\r\n          escape = false;\r\n        }\r\n\r\n        i++;\r\n      }\r\n\r\n      lex.lexpos = i + 1;\r\n\r\n      if (t.value.length > 0) {\r\n        t.value = t.value.slice(0, t.value.length - 1);\r\n      }\r\n\r\n      return t;\r\n    }),\r\n    tk(\"LSBRACKET\", /\\[/),\r\n    tk(\"RSBRACKET\", /]/),\r\n    tk(\"LBRACE\", /{/),\r\n    tk(\"RBRACE\", /}/),\r\n    tk(\"NULL\", /null/),\r\n    tk(\"COMMA\", /,/),\r\n    tk(\"COLON\", /:/),\r\n    tk(\"NUM\", numre, t => (t.value = parseFloat(t.value), t)),\r\n    tk(\"NUM\", nfloat3, t => (t.value = parseFloat(t.value), t)),\r\n    tk(\"NUM\", nfloatexp, t => (t.value = parseFloat(t.value), t)),\r\n  ];\r\n\r\n  function tokinfo(t) {\r\n    return {\r\n      lexpos: t.lexpos,\r\n      lineno: t.lineno,\r\n      col   : t.col,\r\n      fields: {},\r\n    };\r\n  }\r\n\r\n  function p_Array(p) {\r\n    p.expect(\"LSBRACKET\");\r\n    let t = p.peeknext();\r\n    let first = true;\r\n\r\n    let ret = [];\r\n\r\n    ret[TokSymbol] = tokinfo(t);\r\n\r\n    while (t && t.type !== \"RSBRACKET\") {\r\n      if (!first) {\r\n        p.expect(\"COMMA\");\r\n      }\r\n\r\n      ret[TokSymbol].fields[ret.length] = tokinfo(t);\r\n      ret.push(p_Start(p));\r\n\r\n      first = false;\r\n      t = p.peeknext();\r\n    }\r\n    p.expect(\"RSBRACKET\");\r\n\r\n    return ret;\r\n  }\r\n\r\n  function p_Object(p) {\r\n    p.expect(\"LBRACE\");\r\n\r\n    let obj = {};\r\n\r\n    let first = true;\r\n    let t = p.peeknext();\r\n\r\n    obj[TokSymbol] = tokinfo(t);\r\n    while (t && t.type !== \"RBRACE\") {\r\n      if (!first) {\r\n        p.expect(\"COMMA\");\r\n      }\r\n\r\n      let key = p.expect(\"STRLIT\");\r\n      p.expect(\"COLON\");\r\n\r\n      let val = p_Start(p, true);\r\n\r\n      obj[key] = val;\r\n      first = false;\r\n\r\n      t = p.peeknext();\r\n      obj[TokSymbol].fields[key] = tokinfo(t);\r\n    }\r\n\r\n    p.expect(\"RBRACE\");\r\n\r\n    return obj;\r\n  }\r\n\r\n  function p_Start(p, throwError = true) {\r\n    let t = p.peeknext();\r\n    if (t.type === \"LSBRACKET\") {\r\n      return p_Array(p);\r\n    } else if (t.type === \"LBRACE\") {\r\n      return p_Object(p);\r\n    } else if (t.type === \"STRLIT\" || t.type === \"NUM\" || t.type === \"NULL\" || t.type === \"BOOL\") {\r\n      return p.next().value;\r\n    } else {\r\n      p.error(t, \"Unknown token\");\r\n    }\r\n  }\r\n\r\n  function p_Error(token, msg) {\r\n    throw new PUTIL_ParseError(\"Parse Error\");\r\n  }\r\n\r\n  let lex = new lexer(tokens);\r\n  lex.linestart = 0;\r\n  parse = new parser(lex, p_Error);\r\n  parse.start = p_Start;\r\n  //lex.printTokens = true;\r\n\r\n  return parse;\r\n}\r\n\r\nvar jsonParser = buildJSONParser();\r\n\r\n/*\r\nbuildJSONParser().parse(`\r\n{\r\n                \"alteredX\": -110.95731659202336,\r\n                \"alteredY\": -359.9154922611667,\r\n                \"alteredZ\": -4.263256414560601e-14\r\n}\r\n`.trim()) //*/\r\n\r\nfunction printContext(buf, tokinfo, printColors=true) {\r\n  let lines = buf.split(\"\\n\");\r\n\r\n  if (!tokinfo) {\r\n    return '';\r\n  }\r\n\r\n  let lineno = tokinfo.lineno;\r\n  let col = tokinfo.col;\r\n\r\n  let istart = Math.max(lineno-50, 0);\r\n  let iend = Math.min(lineno+2, lines.length-1);\r\n\r\n  let s = '';\r\n\r\n  if (printColors) {\r\n    s += termColor(\"  /* pretty-printed json */\\n\", \"blue\");\r\n  } else {\r\n    s += \"/* pretty-printed json */\\n\";\r\n  }\r\n\r\n  for (let i=istart; i<iend; i++) {\r\n    let l = lines[i];\r\n\r\n    let idx = \"\" + i;\r\n    while (idx.length < 3) {\r\n      idx = \" \" + idx;\r\n    }\r\n\r\n    if (i === lineno && printColors) {\r\n      s += termColor(`${idx}: ${l}\\n`, \"yellow\");\r\n    } else {\r\n      s += `${idx}: ${l}\\n`;\r\n    }\r\n\r\n    if (i === lineno) {\r\n      let l2 = '';\r\n      for (let j=0; j<col+5; j++) {\r\n        l2 += \" \";\r\n      }\r\n\r\n      s += l2 + \"^\\n\";\r\n    }\r\n  }\r\n\r\n  return s;\r\n}\n\nvar nGlobal;\r\n\r\nif (typeof globalThis !== \"undefined\") {\r\n  nGlobal = globalThis;\r\n} else if (typeof window !== \"undefined\") {\r\n  nGlobal = window;\r\n} else if (typeof global !== \"undefined\") {\r\n  nGlobal = global;\r\n} else if (typeof globals !== \"undefined\") {\r\n  nGlobal = globals;\r\n} else if (typeof self !== \"undefined\") {\r\n  nGlobal = self;\r\n}\r\n\r\nconst DEBUG = {};\r\n\r\nfunction updateDEBUG() {\r\n  for (let k in Object.keys(DEBUG)) {\r\n    delete DEBUG[k];\r\n  }\r\n\r\n  if (typeof nGlobal.DEBUG === \"object\") {\r\n    for (let k in nGlobal.DEBUG) {\r\n      DEBUG[k] = nGlobal.DEBUG[k];\r\n    }\r\n  }\r\n}\n\n\"use strict\";\r\n\r\n//needed to avoid a rollup bug in configurable mode\r\nvar sintern2 = _sintern2;\r\nvar struct_eval = _struct_eval;\r\n\r\nlet warninglvl = 2;\r\n\r\nvar truncateDollarSign$1 = true;\r\nvar manager;\r\n\r\nclass JSONError extends Error {};\r\n\r\nfunction printCodeLines(code) {\r\n  let lines = code.split(String.fromCharCode(10));\r\n  let buf = '';\r\n\r\n  for (let i = 0; i < lines.length; i++) {\r\n    let line = \"\" + (i + 1) + \":\";\r\n\r\n    while (line.length < 3) {\r\n      line += \" \";\r\n    }\r\n\r\n    line += \" \" + lines[i];\r\n    buf += line + String.fromCharCode(10);\r\n  }\r\n\r\n  return buf;\r\n}\r\n\r\nfunction printEvalError(code) {\r\n  console.log(\"== CODE ==\");\r\n  console.log(printCodeLines(code));\r\n\r\n  /* Node suppresses the real error line number in error.stack for some reason.\r\n   * Get it by retriggering the error for real.\r\n   */\r\n  eval(code);\r\n}\r\n\r\nfunction setTruncateDollarSign(v) {\r\n  truncateDollarSign$1 = !!v;\r\n}\r\n\r\nfunction _truncateDollarSign(s) {\r\n  let i = s.search(\"$\");\r\n\r\n  if (i > 0) {\r\n    return s.slice(0, i).trim();\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nfunction unmangle(name) {\r\n  if (truncateDollarSign$1) {\r\n    return _truncateDollarSign(name);\r\n  } else {\r\n    return name;\r\n  }\r\n}\r\n\r\nlet _static_envcode_null = \"\";\r\n\r\n//truncate webpack-mangled names\r\n\r\nfunction gen_tabstr(tot) {\r\n  let ret = \"\";\r\n\r\n  for (let i = 0; i < tot; i++) {\r\n    ret += \" \";\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nlet packer_debug, packer_debug_start, packer_debug_end;\r\n\r\nfunction update_debug_data() {\r\n  let ret = _get_pack_debug();\r\n\r\n  packer_debug = ret.packer_debug;\r\n  packer_debug_start = ret.packer_debug_start;\r\n  packer_debug_end = ret.packer_debug_end;\r\n  warninglvl = ret.warninglvl;\r\n}\r\n\r\nupdate_debug_data();\r\n\r\nfunction setWarningMode(t) {\r\n  sintern2.setWarningMode2(t);\r\n\r\n  if (typeof t !== \"number\" || isNaN(t)) {\r\n    throw new Error(\"Expected a single number (>= 0) argument to setWarningMode\");\r\n  }\r\n\r\n  warninglvl = t;\r\n}\r\n\r\nfunction setDebugMode(t) {\r\n  sintern2.setDebugMode2(t);\r\n  update_debug_data();\r\n}\r\n\r\nlet _ws_env = [[undefined, undefined]];\r\n\r\nfunction define_empty_class(scls, name) {\r\n  let cls = function () {\r\n  };\r\n\r\n  cls.prototype = Object.create(Object.prototype);\r\n  cls.constructor = cls.prototype.constructor = cls;\r\n\r\n  let keywords = scls.keywords;\r\n\r\n  cls.STRUCT = name + \" {\\n  }\\n\";\r\n  cls.structName = name;\r\n\r\n  cls.prototype.loadSTRUCT = function (reader) {\r\n    reader(this);\r\n  };\r\n\r\n  cls.newSTRUCT = function () {\r\n    return new this();\r\n  };\r\n\r\n  return cls;\r\n}\r\n\r\nlet haveCodeGen;\r\n\r\n//$KEYWORD_CONFIG_START\r\n\r\nclass STRUCT {\r\n  constructor() {\r\n    this.idgen = 0;\r\n    this.allowOverriding = true;\r\n\r\n    this.structs = {};\r\n    this.struct_cls = {};\r\n    this.struct_ids = {};\r\n\r\n    this.compiled_code = {};\r\n    this.null_natives = {};\r\n\r\n    this.define_null_native(\"Object\", Object);\r\n\r\n    this.jsonUseColors = true;\r\n    this.jsonBuf = '';\r\n    this.formatCtx = {};\r\n  }\r\n\r\n  static inherit(child, parent, structName = child.name) {\r\n    const keywords = this.keywords;\r\n\r\n    if (!parent.STRUCT) {\r\n      return structName + \"{\\n\";\r\n    }\r\n\r\n    let stt = struct_parse.parse(parent.STRUCT);\r\n    let code = structName + \"{\\n\";\r\n    code += STRUCT.fmt_struct(stt, true, false, true);\r\n    return code;\r\n  }\r\n\r\n  /** invoke loadSTRUCT methods on parent objects.  note that\r\n   reader() is only called once.  it is called however.*/\r\n  static Super(obj, reader) {\r\n    if (warninglvl > 0) {\r\n      console.warn(\"deprecated\");\r\n    }\r\n\r\n    reader(obj);\r\n\r\n    function reader2(obj) {\r\n    }\r\n\r\n    let cls = obj.constructor;\r\n    let bad = cls === undefined || cls.prototype === undefined || cls.prototype.__proto__ === undefined;\r\n\r\n    if (bad) {\r\n      return;\r\n    }\r\n\r\n    let parent = cls.prototype.__proto__.constructor;\r\n    bad = bad || parent === undefined;\r\n\r\n    if (!bad && parent.prototype.loadSTRUCT && parent.prototype.loadSTRUCT !== obj.loadSTRUCT) { //parent.prototype.hasOwnProperty(\"loadSTRUCT\")) {\r\n      parent.prototype.loadSTRUCT.call(obj, reader2);\r\n    }\r\n  }\r\n\r\n  /** deprecated.  used with old fromSTRUCT interface. */\r\n  static chain_fromSTRUCT(cls, reader) {\r\n    if (warninglvl > 0) {\r\n      console.warn(\"Using deprecated (and evil) chain_fromSTRUCT method, eek!\");\r\n    }\r\n\r\n    let proto = cls.prototype;\r\n    let parent = cls.prototype.prototype.constructor;\r\n\r\n    let obj = parent.fromSTRUCT(reader);\r\n    let obj2 = new cls();\r\n\r\n    let keys = Object.keys(obj).concat(Object.getOwnPropertySymbols(obj));\r\n    //let keys=Object.keys(proto);\r\n\r\n    for (let i = 0; i < keys.length; i++) {\r\n      let k = keys[i];\r\n\r\n      try {\r\n        obj2[k] = obj[k];\r\n      } catch (error) {\r\n        if (warninglvl > 0) {\r\n          console.warn(\"  failed to set property\", k);\r\n        }\r\n      }\r\n      //let k=keys[i];\r\n      //if (k==\"__proto__\")\r\n      // continue;\r\n      //obj[k] = proto[k];\r\n    }\r\n\r\n    /*\r\n    if (proto.toString !== Object.prototype.toString)\r\n      obj2.toString = proto.toString;\r\n    //*/\r\n\r\n    return obj2;\r\n  }\r\n\r\n  //defined_classes is an array of class constructors\r\n  //with STRUCT scripts, *OR* another STRUCT instance\r\n  //\r\n\r\n  static formatStruct(stt, internal_only, no_helper_js) {\r\n    return this.fmt_struct(stt, internal_only, no_helper_js);\r\n  }\r\n\r\n  static fmt_struct(stt, internal_only, no_helper_js, addComments) {\r\n    if (internal_only === undefined)\r\n      internal_only = false;\r\n    if (no_helper_js === undefined)\r\n      no_helper_js = false;\r\n\r\n    let s = \"\";\r\n    if (!internal_only) {\r\n      s += stt.name;\r\n      if (stt.id !== -1)\r\n        s += \" id=\" + stt.id;\r\n      s += \" {\\n\";\r\n    }\r\n    let tab = \"  \";\r\n\r\n    function fmt_type(type) {\r\n      return StructFieldTypeMap[type.type].format(type);\r\n\r\n      if (type.type === StructEnum.ARRAY || type.type === StructEnum.ITER || type.type === StructEnum.ITERKEYS) {\r\n        if (type.data.iname !== \"\" && type.data.iname !== undefined) {\r\n          return \"array(\" + type.data.iname + \", \" + fmt_type(type.data.type) + \")\";\r\n        } else {\r\n          return \"array(\" + fmt_type(type.data.type) + \")\";\r\n        }\r\n      } else if (type.type === StructEnum.STATIC_STRING) {\r\n        return \"static_string[\" + type.data.maxlength + \"]\";\r\n      } else if (type.type === StructEnum.STRUCT) {\r\n        return type.data;\r\n      } else if (type.type === StructEnum.TSTRUCT) {\r\n        return \"abstract(\" + type.data + \")\";\r\n      } else {\r\n        return StructTypeMap[type.type];\r\n      }\r\n    }\r\n\r\n    let fields = stt.fields;\r\n    for (let i = 0; i < fields.length; i++) {\r\n      let f = fields[i];\r\n      s += tab + f.name + \" : \" + fmt_type(f.type);\r\n      if (!no_helper_js && f.get !== undefined) {\r\n        s += \" | \" + f.get.trim();\r\n      }\r\n      s += \";\";\r\n\r\n      if (addComments && f.comment.trim()) {\r\n        s += f.comment.trim();\r\n      }\r\n\r\n      s += \"\\n\";\r\n    }\r\n    if (!internal_only)\r\n      s += \"}\";\r\n    return s;\r\n  }\r\n\r\n  static setClassKeyword(keyword, nameKeyword = undefined) {\r\n    if (!nameKeyword) {\r\n      nameKeyword = keyword.toLowerCase() + \"Name\";\r\n    }\r\n\r\n    this.keywords = {\r\n      script: keyword,\r\n      name  : nameKeyword,\r\n      load  : \"load\" + keyword,\r\n      new   : \"new\" + keyword,\r\n      after : \"after\" + keyword,\r\n      from  : \"from\" + keyword\r\n    };\r\n  }\r\n\r\n  define_null_native(name, cls) {\r\n    const keywords = this.constructor.keywords;\r\n    let obj = define_empty_class(this.constructor, name);\r\n\r\n    let stt = struct_parse.parse(obj.STRUCT);\r\n\r\n    stt.id = this.idgen++;\r\n\r\n    this.structs[name] = stt;\r\n    this.struct_cls[name] = cls;\r\n    this.struct_ids[stt.id] = stt;\r\n\r\n    this.null_natives[name] = 1;\r\n  }\r\n\r\n  validateStructs(onerror) {\r\n    function getType(type) {\r\n      switch (type.type) {\r\n        case StructEnum.ITERKEYS:\r\n        case StructEnum.ITER:\r\n        case StructEnum.STATIC_ARRAY:\r\n        case StructEnum.ARRAY:\r\n          return getType(type.data.type);\r\n        case StructEnum.TSTRUCT:\r\n          return type;\r\n        case StructEnum.STRUCT:\r\n        default:\r\n          return type;\r\n      }\r\n    }\r\n\r\n    function formatType(type) {\r\n      let ret = {};\r\n\r\n      ret.type = type.type;\r\n\r\n      if (typeof ret.type === \"number\") {\r\n        for (let k in StructEnum) {\r\n          if (StructEnum[k] === ret.type) {\r\n            ret.type = k;\r\n            break;\r\n          }\r\n        }\r\n      } else if (typeof ret.type === \"object\") {\r\n        ret.type = formatType(ret.type);\r\n      }\r\n\r\n      if (typeof type.data === \"object\") {\r\n        ret.data = formatType(type.data);\r\n      } else {\r\n        ret.data = type.data;\r\n      }\r\n\r\n      return ret;\r\n    }\r\n\r\n    function throwError(stt, field, msg) {\r\n      let buf = STRUCT.formatStruct(stt);\r\n\r\n      console.error(buf + \"\\n\\n\" + msg);\r\n\r\n      if (onerror) {\r\n        onerror(msg, stt, field);\r\n      } else {\r\n        throw new Error(msg);\r\n      }\r\n    }\r\n\r\n    for (let k in this.structs) {\r\n      let stt = this.structs[k];\r\n\r\n      for (let field of stt.fields) {\r\n        if (field.name === \"this\") {\r\n          let type = field.type.type;\r\n\r\n          if (ValueTypes.has(type)) {\r\n            throwError(stt, field, \"'this' cannot be used with value types\");\r\n          }\r\n        }\r\n\r\n        let type = getType(field.type);\r\n\r\n        if (type.type !== StructEnum.STRUCT && type.type !== StructEnum.TSTRUCT) {\r\n          continue;\r\n        }\r\n\r\n        if (!(type.data in this.structs)) {\r\n          let msg = stt.name + \":\" + field.name + \": Unknown struct \" + type.data + \".\";\r\n          throwError(stt, field, msg);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  forEach(func, thisvar) {\r\n    for (let k in this.structs) {\r\n      let stt = this.structs[k];\r\n\r\n      if (thisvar !== undefined)\r\n        func.call(thisvar, stt);\r\n      else\r\n        func(stt);\r\n    }\r\n  }\r\n\r\n  //defaults to structjs.manager\r\n  parse_structs(buf, defined_classes) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    if (defined_classes === undefined) {\r\n      defined_classes = manager;\r\n    }\r\n\r\n    if (defined_classes instanceof STRUCT) {\r\n      let struct2 = defined_classes;\r\n      defined_classes = [];\r\n\r\n      for (let k in struct2.struct_cls) {\r\n        defined_classes.push(struct2.struct_cls[k]);\r\n      }\r\n    }\r\n\r\n    if (defined_classes === undefined) {\r\n      defined_classes = [];\r\n\r\n      for (let k in manager.struct_cls) {\r\n        defined_classes.push(manager.struct_cls[k]);\r\n      }\r\n    }\r\n\r\n    let clsmap = {};\r\n\r\n    for (let i = 0; i < defined_classes.length; i++) {\r\n      let cls = defined_classes[i];\r\n\r\n      if (!cls.structName && cls.STRUCT) {\r\n        let stt = struct_parse.parse(cls.STRUCT.trim());\r\n        cls.structName = stt.name;\r\n      } else if (!cls.structName && cls.name !== \"Object\") {\r\n        if (warninglvl > 0)\r\n          console.log(\"Warning, bad class in registered class list\", unmangle(cls.name), cls);\r\n        continue;\r\n      }\r\n\r\n      clsmap[cls.structName] = defined_classes[i];\r\n    }\r\n\r\n    struct_parse.input(buf);\r\n\r\n    while (!struct_parse.at_end()) {\r\n      let stt = struct_parse.parse(undefined, false);\r\n\r\n      if (!(stt.name in clsmap)) {\r\n        if (!(stt.name in this.null_natives))\r\n          if (warninglvl > 0)\r\n            console.log(\"WARNING: struct \" + stt.name + \" is missing from class list.\");\r\n\r\n        let dummy = define_empty_class(this.constructor, stt.name);\r\n\r\n        dummy.STRUCT = STRUCT.fmt_struct(stt);\r\n        dummy.structName = stt.name;\r\n\r\n        dummy.prototype.structName = dummy.name;\r\n\r\n        this.struct_cls[dummy.structName] = dummy;\r\n        this.structs[dummy.structName] = stt;\r\n\r\n        if (stt.id !== -1)\r\n          this.struct_ids[stt.id] = stt;\r\n      } else {\r\n        this.struct_cls[stt.name] = clsmap[stt.name];\r\n        this.structs[stt.name] = stt;\r\n\r\n        if (stt.id !== -1)\r\n          this.struct_ids[stt.id] = stt;\r\n      }\r\n\r\n      let tok = struct_parse.peek();\r\n      while (tok && (tok.value === \"\\n\" || tok.value === \"\\r\" || tok.value === \"\\t\" || tok.value === \" \")) {\r\n        tok = struct_parse.peek();\r\n      }\r\n    }\r\n  }\r\n\r\n  /** adds all structs referenced by cls inside of srcSTRUCT\r\n   *  to this */\r\n  registerGraph(srcSTRUCT, cls) {\r\n    if (!cls.structName) {\r\n      console.warn(\"class was not in srcSTRUCT\");\r\n      return this.register(cls);\r\n    }\r\n\r\n    let recStruct;\r\n\r\n    let recArray = (t) => {\r\n      switch (t.type) {\r\n        case StructEnum.ARRAY:\r\n          return recArray(t.data.type);\r\n        case StructEnum.ITERKEYS:\r\n          return recArray(t.data.type);\r\n        case StructEnum.STATIC_ARRAY:\r\n          return recArray(t.data.type);\r\n        case StructEnum.ITER:\r\n          return recArray(t.data.type);\r\n        case StructEnum.STRUCT:\r\n        case StructEnum.TSTRUCT: {\r\n          let st = srcSTRUCT.structs[t.data];\r\n          let cls = srcSTRUCT.struct_cls[st.name];\r\n\r\n          return recStruct(st, cls);\r\n        }\r\n      }\r\n    };\r\n\r\n    recStruct = (st, cls) => {\r\n      if (!(cls.structName in this.structs)) {\r\n        this.add_class(cls, cls.structName);\r\n      }\r\n\r\n      for (let f of st.fields) {\r\n        if (f.type.type === StructEnum.STRUCT || f.type.type === StructEnum.TSTRUCT) {\r\n          let st2 = srcSTRUCT.structs[f.type.data];\r\n          let cls2 = srcSTRUCT.struct_cls[st2.name];\r\n\r\n          recStruct(st2, cls2);\r\n        } else if (f.type.type === StructEnum.ARRAY) {\r\n          recArray(f.type);\r\n        } else if (f.type.type === StructEnum.ITER) {\r\n          recArray(f.type);\r\n        } else if (f.type.type === StructEnum.ITERKEYS) {\r\n          recArray(f.type);\r\n        } else if (f.type.type === StructEnum.STATIC_ARRAY) {\r\n          recArray(f.type);\r\n        }\r\n      }\r\n    };\r\n\r\n    let st = srcSTRUCT.structs[cls.structName];\r\n    recStruct(st, cls);\r\n  }\r\n\r\n  mergeScripts(child, parent) {\r\n    let stc = struct_parse.parse(child.trim());\r\n    let stp = struct_parse.parse(parent.trim());\r\n\r\n    let fieldset = new Set();\r\n\r\n    for (let f of stc.fields) {\r\n      fieldset.add(f.name);\r\n    }\r\n\r\n    let fields = [];\r\n    for (let f of stp.fields) {\r\n      if (!fieldset.has(f.name)) {\r\n        fields.push(f);\r\n      }\r\n    }\r\n\r\n    stc.fields = fields.concat(stc.fields);\r\n    return STRUCT.fmt_struct(stc, false, false);\r\n  }\r\n\r\n  inlineRegister(cls, structScript) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    let p = cls.__proto__;\r\n    while (p && p !== Object) {\r\n      if (p.hasOwnProperty(keywords.script)) {\r\n        structScript = this.mergeScripts(structScript, p.STRUCT);\r\n        break\r\n      }\r\n      p = p.__proto__;\r\n    }\r\n\r\n    cls.STRUCT = structScript;\r\n    this.register(cls);\r\n    return structScript;\r\n  }\r\n\r\n  register(cls, structName) {\r\n    return this.add_class(cls, structName);\r\n  }\r\n\r\n  unregister(cls) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    if (!cls || !cls.structName || !(cls.structName in this.struct_cls)) {\r\n      console.warn(\"Class not registered with nstructjs\", cls);\r\n      return;\r\n    }\r\n\r\n\r\n    let st = this.structs[cls.structName];\r\n\r\n    delete this.structs[cls.structName];\r\n    delete this.struct_cls[cls.structName];\r\n    delete this.struct_ids[st.id];\r\n  }\r\n\r\n  add_class(cls, structName) {\r\n    //do not register Object\r\n    if (cls === Object) {\r\n      return;\r\n    }\r\n\r\n    const keywords = this.constructor.keywords;\r\n    if (cls.STRUCT) {\r\n      let bad = false;\r\n\r\n      let p = cls;\r\n      while (p) {\r\n        p = p.__proto__;\r\n\r\n        if (p && p.STRUCT && p.STRUCT === cls.STRUCT) {\r\n          bad = true;\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (bad) {\r\n        if (warninglvl > 0) {\r\n          console.warn(\"Generating \" + keywords.script + \" script for derived class \" + unmangle(cls.name));\r\n        }\r\n\r\n        if (!structName) {\r\n          structName = unmangle(cls.name);\r\n        }\r\n\r\n        cls.STRUCT = STRUCT.inherit(cls, p) + \"\\n}\";\r\n      }\r\n    }\r\n\r\n    if (!cls.STRUCT) {\r\n      throw new Error(\"class \" + unmangle(cls.name) + \" has no \" + keywords.script + \" script\");\r\n    }\r\n\r\n    let stt = struct_parse.parse(cls.STRUCT);\r\n\r\n    stt.name = unmangle(stt.name);\r\n\r\n    cls.structName = stt.name;\r\n\r\n    //create default newSTRUCT\r\n    if (cls.newSTRUCT === undefined) {\r\n      cls.newSTRUCT = function () {\r\n        return new this();\r\n      };\r\n    }\r\n\r\n    if (structName !== undefined) {\r\n      stt.name = cls.structName = structName;\r\n    } else if (cls.structName === undefined) {\r\n      cls.structName = stt.name;\r\n    } else {\r\n      stt.name = cls.structName;\r\n    }\r\n\r\n    if (cls.structName in this.structs) {\r\n      if (warninglvl > 0) {\r\n        console.warn(\"Struct \" + unmangle(cls.structName) + \" is already registered\", cls);\r\n      }\r\n\r\n      if (!this.allowOverriding) {\r\n        throw new Error(\"Struct \" + unmangle(cls.structName) + \" is already registered\");\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    if (stt.id === -1)\r\n      stt.id = this.idgen++;\r\n\r\n    this.structs[cls.structName] = stt;\r\n    this.struct_cls[cls.structName] = cls;\r\n    this.struct_ids[stt.id] = stt;\r\n  }\r\n\r\n  isRegistered(cls) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    if (!cls.hasOwnProperty(\"structName\")) {\r\n      return false;\r\n    }\r\n\r\n    return cls === this.struct_cls[cls.structName];\r\n  }\r\n\r\n  get_struct_id(id) {\r\n    return this.struct_ids[id];\r\n  }\r\n\r\n  get_struct(name) {\r\n    if (!(name in this.structs)) {\r\n      console.warn(\"Unknown struct\", name);\r\n      throw new Error(\"Unknown struct \" + name);\r\n    }\r\n    return this.structs[name];\r\n  }\r\n\r\n  get_struct_cls(name) {\r\n    if (!(name in this.struct_cls)) {\r\n      console.trace();\r\n      throw new Error(\"Unknown struct \" + name);\r\n    }\r\n    return this.struct_cls[name];\r\n  }\r\n\r\n  _env_call(code, obj, env) {\r\n    let envcode = _static_envcode_null;\r\n    if (env !== undefined) {\r\n      envcode = \"\";\r\n      for (let i = 0; i < env.length; i++) {\r\n        envcode = \"let \" + env[i][0] + \" = env[\" + i.toString() + \"][1];\\n\" + envcode;\r\n      }\r\n    }\r\n    let fullcode = \"\";\r\n    if (envcode !== _static_envcode_null)\r\n      fullcode = envcode + code;\r\n    else\r\n      fullcode = code;\r\n    let func;\r\n\r\n    //fullcode = fullcode.replace(/\\bthis\\b/, \"obj\");\r\n\r\n    if (!(fullcode in this.compiled_code)) {\r\n      let code2 = \"func = function(obj, env) { \" + envcode + \"return \" + code + \"}\";\r\n      try {\r\n        func = struct_eval.structEval(code2);\r\n      } catch (err) {\r\n        console.warn(err.stack);\r\n\r\n        console.warn(code2);\r\n        console.warn(\" \");\r\n        throw err;\r\n      }\r\n      this.compiled_code[fullcode] = func;\r\n    } else {\r\n      func = this.compiled_code[fullcode];\r\n    }\r\n    try {\r\n      return func.call(obj, obj, env);\r\n    } catch (err) {\r\n      console.warn(err.stack);\r\n\r\n      let code2 = \"func = function(obj, env) { \" + envcode + \"return \" + code + \"}\";\r\n      console.warn(code2);\r\n      console.warn(\" \");\r\n      throw err;\r\n    }\r\n  }\r\n\r\n  write_struct(data, obj, stt) {\r\n    function use_helper_js(field) {\r\n      let type = field.type.type;\r\n      let cls = StructFieldTypeMap[type];\r\n      return cls.useHelperJS(field);\r\n    }\r\n\r\n    let fields = stt.fields;\r\n    let thestruct = this;\r\n    for (let i = 0; i < fields.length; i++) {\r\n      let f = fields[i];\r\n      let t1 = f.type;\r\n      let t2 = t1.type;\r\n\r\n      if (use_helper_js(f)) {\r\n        let val;\r\n        let type = t2;\r\n        if (f.get !== undefined) {\r\n          val = thestruct._env_call(f.get, obj);\r\n        } else {\r\n          val = f.name === \"this\" ? obj : obj[f.name];\r\n        }\r\n\r\n        if (DEBUG.tinyeval) {\r\n          console.log(\"\\n\\n\\n\", f.get, \"Helper JS Ret\", val, \"\\n\\n\\n\");\r\n        }\r\n\r\n        sintern2.do_pack(this, data, val, obj, f, t1);\r\n      } else {\r\n        let val = f.name === \"this\" ? obj : obj[f.name];\r\n        sintern2.do_pack(this, data, val, obj, f, t1);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   @param data : array to write data into,\r\n   @param obj  : structable object\r\n   */\r\n  write_object(data, obj) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    let cls = obj.constructor.structName;\r\n    let stt = this.get_struct(cls);\r\n\r\n    if (data === undefined) {\r\n      data = [];\r\n    }\r\n\r\n    this.write_struct(data, obj, stt);\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   Read an object from binary data\r\n\r\n   @param data : DataView or Uint8Array instance\r\n   @param cls_or_struct_id : Structable class\r\n   @param uctx : internal parameter\r\n   @return {cls_or_struct_id} Instance of cls_or_struct_id\r\n   */\r\n  readObject(data, cls_or_struct_id, uctx) {\r\n    if (data instanceof Uint8Array || data instanceof Uint8ClampedArray) {\r\n      data = new DataView(data.buffer);\r\n    } else if (data instanceof Array) {\r\n      data = new DataView(new Uint8Array(data).buffer);\r\n    }\r\n\r\n    return this.read_object(data, cls_or_struct_id, uctx);\r\n  }\r\n\r\n  /**\r\n   @param data array to write data into,\r\n   @param obj structable object\r\n   */\r\n  writeObject(data, obj) {\r\n    return this.write_object(data, obj);\r\n  }\r\n\r\n  writeJSON(obj, stt = undefined) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    let cls = obj.constructor;\r\n    stt = stt || this.get_struct(cls.structName);\r\n\r\n    function use_helper_js(field) {\r\n      let type = field.type.type;\r\n      let cls = StructFieldTypeMap[type];\r\n      return cls.useHelperJS(field);\r\n    }\r\n\r\n    let toJSON = sintern2.toJSON;\r\n\r\n    let fields = stt.fields;\r\n    let thestruct = this;\r\n    let json = {};\r\n\r\n    for (let i = 0; i < fields.length; i++) {\r\n      let f = fields[i];\r\n      let val;\r\n      let t1 = f.type;\r\n\r\n      let json2;\r\n\r\n      if (use_helper_js(f)) {\r\n        if (f.get !== undefined) {\r\n          val = thestruct._env_call(f.get, obj);\r\n        } else {\r\n          val = f.name === \"this\" ? obj : obj[f.name];\r\n        }\r\n\r\n        if (DEBUG.tinyeval) {\r\n          console.log(\"\\n\\n\\n\", f.get, \"Helper JS Ret\", val, \"\\n\\n\\n\");\r\n        }\r\n\r\n        json2 = toJSON(this, val, obj, f, t1);\r\n      } else {\r\n        val = f.name === \"this\" ? obj : obj[f.name];\r\n        json2 = toJSON(this, val, obj, f, t1);\r\n      }\r\n\r\n      if (f.name !== 'this') {\r\n        json[f.name] = json2;\r\n      } else { //f.name was 'this'?\r\n        let isArray = Array.isArray(json2);\r\n        isArray = isArray || f.type.type === StructTypes.ARRAY;\r\n        isArray = isArray || f.type.type === StructTypes.STATIC_ARRAY;\r\n\r\n        if (isArray) {\r\n          json.length = json2.length;\r\n\r\n          for (let i = 0; i < json2.length; i++) {\r\n            json[i] = json2[i];\r\n          }\r\n        } else {\r\n          Object.assign(json, json2);\r\n        }\r\n      }\r\n    }\r\n\r\n    return json;\r\n  }\r\n\r\n  /**\r\n   @param data : DataView or Uint8Array instance\r\n   @param cls_or_struct_id : Structable class\r\n   @param uctx : internal parameter\r\n   */\r\n  read_object(data, cls_or_struct_id, uctx, objInstance) {\r\n    const keywords = this.constructor.keywords;\r\n    let cls, stt;\r\n\r\n    if (data instanceof Array) {\r\n      data = new DataView(new Uint8Array(data).buffer);\r\n    }\r\n\r\n    if (typeof cls_or_struct_id === \"number\") {\r\n      cls = this.struct_cls[this.struct_ids[cls_or_struct_id].name];\r\n    } else {\r\n      cls = cls_or_struct_id;\r\n    }\r\n\r\n    if (cls === undefined) {\r\n      throw new Error(\"bad cls_or_struct_id \" + cls_or_struct_id);\r\n    }\r\n\r\n    stt = this.structs[cls.structName];\r\n\r\n    if (uctx === undefined) {\r\n      uctx = new unpack_context();\r\n\r\n      packer_debug(\"\\n\\n=Begin reading \" + cls.structName + \"=\");\r\n    }\r\n    let thestruct = this;\r\n\r\n    let this2 = this;\r\n\r\n    function unpack_field(type) {\r\n      return StructFieldTypeMap[type.type].unpack(this2, data, type, uctx);\r\n    }\r\n\r\n    function unpack_into(type, dest) {\r\n      return StructFieldTypeMap[type.type].unpackInto(this2, data, type, uctx, dest);\r\n    }\r\n\r\n    let was_run = false;\r\n\r\n    function makeLoader(stt) {\r\n      return function load(obj) {\r\n        if (was_run) {\r\n          return;\r\n        }\r\n\r\n        was_run = true;\r\n\r\n        let fields = stt.fields;\r\n        let flen = fields.length;\r\n\r\n        for (let i = 0; i < flen; i++) {\r\n          let f = fields[i];\r\n\r\n          if (f.name === 'this') {\r\n            //load data into obj directly\r\n            unpack_into(f.type, obj);\r\n          } else {\r\n            obj[f.name] = unpack_field(f.type);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    let load = makeLoader(stt);\r\n\r\n    if (cls.prototype.loadSTRUCT !== undefined) {\r\n      let obj = objInstance;\r\n\r\n      if (!obj && cls.newSTRUCT !== undefined) {\r\n        obj = cls.newSTRUCT(load);\r\n      } else if (!obj) {\r\n        obj = new cls();\r\n      }\r\n\r\n      obj.loadSTRUCT(load);\r\n\r\n      if (!was_run) {\r\n        console.warn(\"\" + cls.structName + \".prototype.loadSTRUCT() did not execute its loader callback!\");\r\n        load(obj);\r\n      }\r\n\r\n      return obj;\r\n    } else if (cls.fromSTRUCT !== undefined) {\r\n      if (warninglvl > 1) {\r\n        console.warn(\"Warning: class \" + unmangle(cls.name) + \" is using deprecated fromSTRUCT interface; use newSTRUCT/loadSTRUCT instead\");\r\n      }\r\n\r\n      return cls.fromSTRUCT(load);\r\n    } else { //default case, make new instance and then call load() on it\r\n      let obj = objInstance;\r\n\r\n      if (!obj && cls.newSTRUCT !== undefined) {\r\n        obj = cls.newSTRUCT(load);\r\n      } else if (!obj) {\r\n        obj = new cls();\r\n      }\r\n\r\n      load(obj);\r\n\r\n      return obj;\r\n    }\r\n  }\r\n\r\n  validateJSON(json, cls_or_struct_id, useInternalParser = true, useColors = true, consoleLogger = function () {\r\n    console.log(...arguments);\r\n  }, _abstractKey                                        = \"_structName\") {\r\n    if (cls_or_struct_id === undefined) {\r\n      throw new Error(this.constructor.name + \".prototype.validateJSON: Expected at least two arguments\");\r\n    }\r\n\r\n    try {\r\n      json = JSON.stringify(json, undefined, 2);\r\n\r\n      this.jsonBuf = json;\r\n      this.jsonUseColors = useColors;\r\n      this.jsonLogger = consoleLogger;\r\n\r\n      //add token annotations\r\n      jsonParser.logger = this.jsonLogger;\r\n\r\n      if (useInternalParser) {\r\n        json = jsonParser.parse(json);\r\n      } else {\r\n        json = JSON.parse(json);\r\n      }\r\n\r\n      this.validateJSONIntern(json, cls_or_struct_id, _abstractKey);\r\n\r\n    } catch (error) {\r\n      if (!(error instanceof JSONError)) {\r\n        console.error(error.stack);\r\n      }\r\n\r\n      this.jsonLogger(error.message);\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  validateJSONIntern(json, cls_or_struct_id, _abstractKey = \"_structName\") {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    let cls, stt;\r\n\r\n    if (typeof cls_or_struct_id === \"number\") {\r\n      cls = this.struct_cls[this.struct_ids[cls_or_struct_id].name];\r\n    } else if (cls_or_struct_id instanceof NStruct) {\r\n      cls = this.get_struct_cls(cls_or_struct_id.name);\r\n    } else {\r\n      cls = cls_or_struct_id;\r\n    }\r\n\r\n    if (cls === undefined) {\r\n      throw new Error(\"bad cls_or_struct_id \" + cls_or_struct_id);\r\n    }\r\n\r\n    stt = this.structs[cls.structName];\r\n\r\n    if (stt === undefined) {\r\n      throw new Error(\"unknown class \" + cls);\r\n    }\r\n\r\n    let fields = stt.fields;\r\n    let flen = fields.length;\r\n\r\n    let keys = new Set();\r\n    keys.add(_abstractKey);\r\n\r\n    let keyTestJson = json;\r\n\r\n    for (let i = 0; i < flen; i++) {\r\n      let f = fields[i];\r\n\r\n      let val;\r\n\r\n      let tokinfo;\r\n\r\n      if (f.name === 'this') {\r\n        val = json;\r\n        keyTestJson = {\r\n          \"this\": json\r\n        };\r\n\r\n        keys.add(\"this\");\r\n        tokinfo = json[TokSymbol];\r\n      } else {\r\n        val = json[f.name];\r\n        keys.add(f.name);\r\n\r\n        tokinfo = json[TokSymbol] ? json[TokSymbol].fields[f.name] : undefined;\r\n        if (!tokinfo) {\r\n          let f2 = fields[Math.max(i - 1, 0)];\r\n          tokinfo = TokSymbol[TokSymbol] ? json[TokSymbol].fields[f2.name] : undefined;\r\n        }\r\n\r\n        if (!tokinfo) {\r\n          tokinfo = json[TokSymbol];\r\n        }\r\n      }\r\n\r\n      if (val === undefined) {\r\n        //console.warn(\"nstructjs.readJSON: Missing field \" + f.name + \" in struct \" + stt.name);\r\n        //continue;\r\n      }\r\n\r\n      let instance = f.name === 'this' ? val : json;\r\n\r\n      let ret = sintern2.validateJSON(this, val, json, f, f.type, instance, _abstractKey);\r\n\r\n      if (!ret || typeof ret === \"string\") {\r\n        let msg = typeof ret === \"string\" ? \": \" + ret : \"\";\r\n\r\n        if (tokinfo) {\r\n          this.jsonLogger(printContext(this.jsonBuf, tokinfo, this.jsonUseColors));\r\n        }\r\n\r\n        //console.error(cls.STRUCT);\r\n\r\n        if (val === undefined) {\r\n          throw new JSONError(stt.name + \": Missing json field \" + f.name + msg);\r\n        } else {\r\n          throw new JSONError(stt.name + \": Invalid json field \" + f.name + msg);\r\n        }\r\n\r\n        return false;\r\n      }\r\n    }\r\n\r\n    for (let k in keyTestJson) {\r\n      if (typeof json[k] === \"symbol\") {\r\n        //ignore symbols\r\n        continue;\r\n      }\r\n\r\n      if (!keys.has(k)) {\r\n        this.jsonLogger(cls.STRUCT);\r\n        throw new JSONError(stt.name + \": Unknown json field \" + k);\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  readJSON(json, cls_or_struct_id, objInstance = undefined) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    let cls, stt;\r\n\r\n    if (typeof cls_or_struct_id === \"number\") {\r\n      cls = this.struct_cls[this.struct_ids[cls_or_struct_id].name];\r\n    } else if (cls_or_struct_id instanceof NStruct) {\r\n      cls = this.get_struct_cls(cls_or_struct_id.name);\r\n    } else {\r\n      cls = cls_or_struct_id;\r\n    }\r\n\r\n    if (cls === undefined) {\r\n      throw new Error(\"bad cls_or_struct_id \" + cls_or_struct_id);\r\n    }\r\n\r\n    stt = this.structs[cls.structName];\r\n\r\n    packer_debug(\"\\n\\n=Begin reading \" + cls.structName + \"=\");\r\n    let thestruct = this;\r\n    let this2 = this;\r\n    let was_run = false;\r\n    let fromJSON = sintern2.fromJSON;\r\n\r\n    function makeLoader(stt) {\r\n      return function load(obj) {\r\n        if (was_run) {\r\n          return;\r\n        }\r\n\r\n        was_run = true;\r\n\r\n        let fields = stt.fields;\r\n        let flen = fields.length;\r\n\r\n        for (let i = 0; i < flen; i++) {\r\n          let f = fields[i];\r\n\r\n          let val;\r\n\r\n          if (f.name === 'this') {\r\n            val = json;\r\n          } else {\r\n            val = json[f.name];\r\n          }\r\n\r\n          if (val === undefined) {\r\n            if (warninglvl > 1) {\r\n              console.warn(\"nstructjs.readJSON: Missing field \" + f.name + \" in struct \" + stt.name);\r\n            }\r\n            continue;\r\n          }\r\n\r\n          let instance = f.name === 'this' ? obj : objInstance;\r\n\r\n          let ret = fromJSON(this2, val, obj, f, f.type, instance);\r\n\r\n          if (f.name !== 'this') {\r\n            obj[f.name] = ret;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    let load = makeLoader(stt);\r\n\r\n    if (cls.prototype.loadSTRUCT !== undefined) {\r\n      let obj = objInstance;\r\n\r\n      if (!obj && cls.newSTRUCT !== undefined) {\r\n        obj = cls.newSTRUCT(load);\r\n      } else if (!obj) {\r\n        obj = new cls();\r\n      }\r\n\r\n      obj.loadSTRUCT(load);\r\n      return obj;\r\n    } else if (cls.fromSTRUCT !== undefined) {\r\n      if (warninglvl > 1) {\r\n        console.warn(\"Warning: class \" + unmangle(cls.name) + \" is using deprecated fromSTRUCT interface; use newSTRUCT/loadSTRUCT instead\");\r\n      }\r\n      return cls.fromSTRUCT(load);\r\n    } else { //default case, make new instance and then call load() on it\r\n      let obj = objInstance;\r\n\r\n      if (!obj && cls.newSTRUCT !== undefined) {\r\n        obj = cls.newSTRUCT(load);\r\n      } else if (!obj) {\r\n        obj = new cls();\r\n      }\r\n\r\n      load(obj);\r\n\r\n      return obj;\r\n    }\r\n  }\r\n\r\n  formatJSON_intern(json, stt, field, tlvl = 0) {\r\n    const keywords = this.constructor.keywords;\r\n    const addComments = this.formatCtx.addComments;\r\n\r\n    let s = '{';\r\n\r\n    if (addComments && field && field.comment.trim()) {\r\n      s += \" \" + field.comment.trim();\r\n    }\r\n\r\n    s += \"\\n\";\r\n\r\n    for (let f of stt.fields) {\r\n      let value = json[f.name];\r\n\r\n      s += tab(tlvl + 1) + f.name + \": \";\r\n\r\n      s += sintern2.formatJSON(this, value, json, f, f.type, undefined, tlvl + 1);\r\n      s += \",\";\r\n\r\n      let basetype = f.type.type;\r\n\r\n      if (ArrayTypes.has(basetype)) {\r\n        basetype = f.type.data.type.type;\r\n      }\r\n\r\n      const addComment = ValueTypes.has(basetype) && addComments && f.comment.trim();\r\n\r\n      if (addComment) {\r\n        s += \" \" + f.comment.trim();\r\n      }\r\n\r\n      s += \"\\n\";\r\n    }\r\n\r\n    s += tab(tlvl) + \"}\";\r\n    return s;\r\n  }\r\n\r\n  formatJSON(json, cls, addComments = true, validate = true) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    let s = '';\r\n\r\n    if (validate) {\r\n      this.validateJSON(json, cls);\r\n    }\r\n\r\n    let stt = this.structs[cls.structName];\r\n\r\n    this.formatCtx = {\r\n      addComments,\r\n      validate\r\n    };\r\n\r\n    return this.formatJSON_intern(json, stt);\r\n  }\r\n};\r\n//$KEYWORD_CONFIG_END\r\n\r\nif (haveCodeGen) {\r\n  var StructClass;\r\n\r\n  try {\r\n    eval(code);\r\n  } catch (error) {\r\n    printEvalError(code);\r\n  }\r\n\r\n  StructClass.keywords = {\r\n    name  : \"structName\",\r\n    script: \"STRUCT\",\r\n    load  : \"loadSTRUCT\",\r\n    from  : \"fromSTRUCT\",\r\n    new   : \"newSTRUCT\",\r\n  };\r\n\r\n  STRUCT = StructClass;\r\n}\r\n\r\nSTRUCT.setClassKeyword(\"STRUCT\");\r\n\r\nfunction deriveStructManager(keywords = {\r\n  script: \"STRUCT\",\r\n  name  : undefined, //script.toLowerCase + \"Name\"\r\n  load  : undefined, //\"load\" + script\r\n  new   : undefined, //\"new\" + script\r\n  from  : undefined, //\"from\" + script\r\n}) {\r\n\r\n  if (!keywords.name) {\r\n    keywords.name = keywords.script.toLowerCase() + \"Name\";\r\n  }\r\n\r\n  if (!keywords.load) {\r\n    keywords.load = \"load\" + keywords.script;\r\n  }\r\n\r\n  if (!keywords.new) {\r\n    keywords.new = \"new\" + keywords.script;\r\n  }\r\n\r\n  if (!keywords.from) {\r\n    keywords.from = \"from\" + keywords.script;\r\n  }\r\n\r\n  if (!haveCodeGen) {\r\n    class NewSTRUCT extends STRUCT {\r\n\r\n    }\r\n\r\n    NewSTRUCT.keywords = keywords;\r\n    return NewSTRUCT;\r\n  } else {\r\n    var StructClass;\r\n    var _json_parser = jsonParser;\r\n    var _util = util;\r\n\r\n    let code2 = code;\r\n    code2 = code2.replace(/\\[keywords.script\\]/g, \".\" + keywords.script);\r\n    code2 = code2.replace(/\\[keywords.name\\]/g, \".\" + keywords.name);\r\n    code2 = code2.replace(/\\bjsonParser\\b/g, \"_json_parser\");\r\n    code2 = code2.replace(/\\butil\\b/g, \"_util\");\r\n\r\n    //console.log(\"\\n\\n\");\r\n    //console.log(printCodeLines(code2));\r\n    //console.log(\"\\n\\n\");\r\n\r\n    try {\r\n      eval(code2);\r\n    } catch (error) {\r\n      printEvalError(code2);\r\n    }\r\n\r\n    StructClass.keywords = keywords;\r\n    return StructClass;\r\n  }\r\n}\r\n\r\n//main struct script manager\r\nmanager = new STRUCT();\r\n\r\n/**\r\n * Write all defined structs out to a string.\r\n *\r\n * @param nManager STRUCT instance, defaults to nstructjs.manager\r\n * @param include_code include save code snippets\r\n * */\r\nfunction write_scripts(nManager = manager, include_code = false) {\r\n  let buf = \"\";\r\n\r\n  /* prevent code generation bugs in configurable mode */\r\n  let nl = String.fromCharCode(10);\r\n  let tab = String.fromCharCode(9);\r\n\r\n  nManager.forEach(function (stt) {\r\n    buf += STRUCT.fmt_struct(stt, false, !include_code) + nl;\r\n  });\r\n\r\n  let buf2 = buf;\r\n  buf = \"\";\r\n\r\n  for (let i = 0; i < buf2.length; i++) {\r\n    let c = buf2[i];\r\n    if (c === nl) {\r\n      buf += nl;\r\n      let i2 = i;\r\n      while (i < buf2.length && (buf2[i] === \" \" || buf2[i] === tab || buf2[i] === nl)) {\r\n        i++;\r\n      }\r\n      if (i !== i2)\r\n        i--;\r\n    } else {\r\n      buf += c;\r\n    }\r\n  }\r\n\r\n  return buf;\r\n}\n\n\"use strict\";\r\n\r\nlet nbtoa, natob;\r\n\r\nif (typeof btoa === \"undefined\") {\r\n  nbtoa = function btoa(str) {\r\n    let buffer = new Buffer(\"\" + str, 'binary');\r\n    return buffer.toString('base64');\r\n  };\r\n\r\n  natob = function atob(str) {\r\n    return new Buffer(str, 'base64').toString('binary');\r\n  };\r\n} else {\r\n  natob = atob;\r\n  nbtoa = btoa;\r\n}\r\n\r\n/*\r\nfile format:\r\n  magic signature              : 4 bytes\r\n  file version major           : 2 bytes\r\n  file version minor           : 1 bytes\r\n  file version micro           : 1 bytes\r\n  length of struct scripts     : 4 bytes\r\n  struct scripts for this file : ...\r\n  \r\n  block:\r\n    magic signature for block              : 4 bytes\r\n    length of data  (not including header) : 4 bytes\r\n    id of struct type                      : 4 bytes\r\n    \r\n    data                                   : ...\r\n*/\r\n\r\nfunction versionToInt(v) {\r\n  v = versionCoerce(v);\r\n  let mul = 64;\r\n  return ~~(v.major*mul*mul*mul + v.minor*mul*mul + v.micro*mul);\r\n}\r\n\r\nlet ver_pat = /[0-9]+\\.[0-9]+\\.[0-9]+$/;\r\n\r\nfunction versionCoerce(v) {\r\n  if (!v) {\r\n    throw new Error(\"empty version: \" + v);\r\n  }\r\n\r\n  if (typeof v === \"string\") {\r\n    if (!ver_pat.exec(v)) {\r\n      throw new Error(\"invalid version string \" + v);\r\n    }\r\n\r\n    let ver = v.split(\".\");\r\n    return {\r\n      major : parseInt(ver[0]),\r\n      minor : parseInt(ver[1]),\r\n      micro : parseInt(ver[2])\r\n    }\r\n  } else if (Array.isArray(v)) {\r\n    return {\r\n      major : v[0],\r\n      minor : v[1],\r\n      micro : v[2]\r\n    }\r\n  } else if (typeof v === \"object\") {\r\n    let test = (k) => k in v && typeof v[k] === \"number\";\r\n\r\n    if (!test(\"major\") || !test(\"minor\") || !test(\"micro\")) {\r\n      throw new Error(\"invalid version object: \" + v);\r\n    }\r\n\r\n    return v;\r\n  } else {\r\n    throw new Error(\"invalid version \" + v);\r\n  }\r\n}\r\n\r\nfunction versionLessThan(a, b) {\r\n  return versionToInt(a) < versionToInt(b);\r\n}\r\n\r\nclass FileParams {\r\n  constructor() {\r\n    this.magic = \"STRT\";\r\n    this.ext = \".bin\";\r\n    this.blocktypes = [\"DATA\"];\r\n\r\n    this.version = {\r\n      major: 0,\r\n      minor: 0,\r\n      micro: 1\r\n    };\r\n  }\r\n}\r\n\r\n//used to define blocks\r\nclass Block {\r\n  constructor(type_magic, data) {\r\n    this.type = type_magic;\r\n    this.data = data;\r\n  }\r\n}\r\n\r\nclass FileeError extends Error {\r\n}\r\n\r\nclass FileHelper {\r\n  //params can be FileParams instance, or object literal\r\n  //(it will convert to FileParams)\r\n  constructor(params) {\r\n    if (params === undefined) {\r\n      params = new FileParams();\r\n    } else {\r\n      let fp = new FileParams();\r\n\r\n      for (let k in params) {\r\n        fp[k] = params[k];\r\n      }\r\n      params = fp;\r\n    }\r\n\r\n    this.version = params.version;\r\n    this.blocktypes = params.blocktypes;\r\n    this.magic = params.magic;\r\n    this.ext = params.ext;\r\n    this.struct = undefined;\r\n    this.unpack_ctx = undefined;\r\n  }\r\n\r\n  read(dataview) {\r\n    this.unpack_ctx = new unpack_context();\r\n\r\n    let magic = unpack_static_string(dataview, this.unpack_ctx, 4);\r\n\r\n    if (magic !== this.magic) {\r\n      throw new FileError(\"corrupted file\");\r\n    }\r\n\r\n    this.version = {};\r\n    this.version.major = unpack_short(dataview, this.unpack_ctx);\r\n    this.version.minor = unpack_byte(dataview, this.unpack_ctx);\r\n    this.version.micro = unpack_byte(dataview, this.unpack_ctx);\r\n\r\n    let struct = this.struct = new STRUCT();\r\n\r\n    let scripts = unpack_string(dataview, this.unpack_ctx);\r\n    this.struct.parse_structs(scripts, manager);\r\n\r\n    let blocks = [];\r\n    let dviewlen = dataview.buffer.byteLength;\r\n\r\n    while (this.unpack_ctx.i < dviewlen) {\r\n      //console.log(\"reading block. . .\", this.unpack_ctx.i, dviewlen);\r\n\r\n      let type = unpack_static_string(dataview, this.unpack_ctx, 4);\r\n      let datalen = unpack_int(dataview, this.unpack_ctx);\r\n      let bstruct = unpack_int(dataview, this.unpack_ctx);\r\n      let bdata;\r\n\r\n      //console.log(type, datalen, bstruct);\r\n\r\n      if (bstruct === -2) { //string data, e.g. JSON\r\n        bdata = unpack_static_string(dataview, this.unpack_ctx, datalen);\r\n      } else {\r\n        bdata = unpack_bytes(dataview, this.unpack_ctx, datalen);\r\n        bdata = struct.read_object(bdata, bstruct, new unpack_context());\r\n      }\r\n\r\n      let block = new Block();\r\n      block.type = type;\r\n      block.data = bdata;\r\n\r\n      blocks.push(block);\r\n    }\r\n\r\n    this.blocks = blocks;\r\n    return blocks;\r\n  }\r\n\r\n  doVersions(old) {\r\n    let blocks = this.blocks;\r\n\r\n    if (versionLessThan(old, \"0.0.1\")) {\r\n      //do something\r\n    }\r\n  }\r\n\r\n  write(blocks) {\r\n    this.struct = manager;\r\n    this.blocks = blocks;\r\n\r\n    let data = [];\r\n\r\n    pack_static_string(data, this.magic, 4);\r\n    pack_short(data, this.version.major);\r\n    pack_byte(data, this.version.minor & 255);\r\n    pack_byte(data, this.version.micro & 255);\r\n\r\n    let scripts = write_scripts();\r\n    pack_string(data, scripts);\r\n\r\n    let struct = this.struct;\r\n\r\n    for (let block of blocks) {\r\n      if (typeof block.data === \"string\") { //string data, e.g. JSON\r\n        pack_static_string(data, block.type, 4);\r\n        pack_int(data, block.data.length);\r\n        pack_int(data, -2); //flag as string data\r\n        pack_static_string(data, block.data, block.data.length);\r\n        continue;\r\n      }\r\n\r\n      let structName = block.data.constructor.structName;\r\n      if (structName === undefined || !(structName in struct.structs)) {\r\n        throw new Error(\"Non-STRUCTable object \" + block.data);\r\n      }\r\n\r\n      let data2 = [];\r\n      let stt = struct.structs[structName];\r\n\r\n      struct.write_object(data2, block.data);\r\n\r\n      pack_static_string(data, block.type, 4);\r\n      pack_int(data, data2.length);\r\n      pack_int(data, stt.id);\r\n\r\n      pack_bytes(data, data2);\r\n    }\r\n\r\n    return new DataView(new Uint8Array(data).buffer);\r\n  }\r\n\r\n  writeBase64(blocks) {\r\n    let dataview = this.write(blocks);\r\n\r\n    let str = \"\";\r\n    let bytes = new Uint8Array(dataview.buffer);\r\n\r\n    for (let i = 0; i < bytes.length; i++) {\r\n      str += String.fromCharCode(bytes[i]);\r\n    }\r\n\r\n    return nbtoa(str);\r\n  }\r\n\r\n  makeBlock(type, data) {\r\n    return new Block(type, data);\r\n  }\r\n\r\n  readBase64(base64) {\r\n    let data = natob(base64);\r\n    let data2 = new Uint8Array(data.length);\r\n\r\n    for (let i = 0; i < data.length; i++) {\r\n      data2[i] = data.charCodeAt(i);\r\n    }\r\n\r\n    return this.read(new DataView(data2.buffer));\r\n  }\r\n}\n\nvar struct_filehelper = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  versionToInt: versionToInt,\n  versionCoerce: versionCoerce,\n  versionLessThan: versionLessThan,\n  FileParams: FileParams,\n  Block: Block,\n  FileeError: FileeError,\n  FileHelper: FileHelper\n});\n\n/** truncate webpack mangled names. defaults to true\r\n *  so Mesh$1 turns into Mesh */\r\nfunction truncateDollarSign(value = true) {\r\n  setTruncateDollarSign(value);\r\n}\r\n\r\nfunction validateStructs(onerror) {\r\n  return manager.validateStructs(onerror);\r\n}\r\n\r\n/**\r\n true means little endian, false means big endian\r\n */\r\nfunction setEndian(mode) {\r\n  let ret = STRUCT_ENDIAN;\r\n\r\n  setBinaryEndian(mode);\r\n\r\n  return ret;\r\n}\r\n\r\nfunction consoleLogger() {\r\n  console.log(...arguments);\r\n}\r\n\r\n/** Validate json\r\n *\r\n * @param json\r\n * @param cls\r\n * @param useInternalParser If true (the default) an internal parser will be used that generates nicer error messages\r\n * @param printColors\r\n * @param logger\r\n * @returns {*}\r\n */\r\nfunction validateJSON(json, cls, useInternalParser, printColors = true, logger = consoleLogger) {\r\n  return manager.validateJSON(json, cls, useInternalParser, printColors, logger);\r\n}\r\n\r\nfunction getEndian() {\r\n  return STRUCT_ENDIAN;\r\n}\r\n\r\nfunction setAllowOverriding(t) {\r\n  return manager.allowOverriding = !!t;\r\n}\r\n\r\nfunction isRegistered(cls) {\r\n  return manager.isRegistered(cls);\r\n}\r\n\r\n/** Register a class inline.\r\n *\r\n * Note: No need to use nstructjs.inherit,\r\n * inheritance is handled for you.  Unlike\r\n * nstructjs.inherit fields can be properly\r\n * overridden in the child class without\r\n * being written twice.\r\n *\r\n * class Test {\r\n *  test = 0;\r\n *\r\n *  static STRUCT = nstructjs.inlineRegister(this, `\r\n *  namespace.Test {\r\n *    test : int;\r\n *  }\r\n *  `);\r\n * }\r\n **/\r\nfunction inlineRegister(cls, structScript) {\r\n  return manager.inlineRegister(cls, structScript);\r\n}\r\n\r\n/** Register a class with nstructjs **/\r\nfunction register(cls, structName) {\r\n  return manager.register(cls, structName);\r\n}\r\n\r\nfunction unregister(cls) {\r\n  manager.unregister(cls);\r\n}\r\n\r\nfunction inherit(child, parent, structName = child.name) {\r\n\r\n  return STRUCT.inherit(...arguments);\r\n}\r\n\r\n/**\r\n @param data : DataView\r\n */\r\nfunction readObject(data, cls, __uctx = undefined) {\r\n  return manager.readObject(data, cls, __uctx);\r\n}\r\n\r\n/**\r\n @param data : Array instance to write bytes to\r\n */\r\nfunction writeObject(data, obj) {\r\n  return manager.writeObject(data, obj);\r\n}\r\n\r\nfunction writeJSON(obj) {\r\n  return manager.writeJSON(obj);\r\n}\r\n\r\nfunction formatJSON(json, cls, addComments = true, validate = true) {\r\n  return manager.formatJSON(json, cls, addComments, validate);\r\n}\r\n\r\nfunction readJSON(json, class_or_struct_id) {\r\n  return manager.readJSON(json, class_or_struct_id);\r\n}\n\nexport { JSONError, STRUCT, _truncateDollarSign, struct_binpack as binpack, consoleLogger, deriveStructManager, struct_filehelper as filehelper, formatJSON, getEndian, inherit, inlineRegister, isRegistered, manager, struct_parser as parser, struct_parseutil as parseutil, readJSON, readObject, register, setAllowOverriding, setDebugMode, setEndian, setTruncateDollarSign, setWarningMode, truncateDollarSign, struct_typesystem as typesystem, unpack_context, unregister, validateJSON, validateStructs, writeJSON, writeObject, write_scripts };\n","// THIS FILE IS GENERATED - DO NOT EDIT!\r\n/*!mobile-detect v1.4.4 2019-09-21*/\r\n/*global module:false, define:false*/\r\n/*jshint latedef:false*/\r\n/*!@license Copyright 2013, Heinrich Goebl, License: MIT, see https://github.com/hgoebl/mobile-detect.js*/\r\n(function (define, undefined) {\r\ndefine(function () {\r\n    'use strict';\r\n\r\n    var impl = {};\r\n\r\n    impl.mobileDetectRules = {\r\n    \"phones\": {\r\n        \"iPhone\": \"\\\\biPhone\\\\b|\\\\biPod\\\\b\",\r\n        \"BlackBerry\": \"BlackBerry|\\\\bBB10\\\\b|rim[0-9]+|\\\\b(BBA100|BBB100|BBD100|BBE100|BBF100|STH100)\\\\b-[0-9]+\",\r\n        \"HTC\": \"HTC|HTC.*(Sensation|Evo|Vision|Explorer|6800|8100|8900|A7272|S510e|C110e|Legend|Desire|T8282)|APX515CKT|Qtek9090|APA9292KT|HD_mini|Sensation.*Z710e|PG86100|Z715e|Desire.*(A8181|HD)|ADR6200|ADR6400L|ADR6425|001HT|Inspire 4G|Android.*\\\\bEVO\\\\b|T-Mobile G1|Z520m|Android [0-9.]+; Pixel\",\r\n        \"Nexus\": \"Nexus One|Nexus S|Galaxy.*Nexus|Android.*Nexus.*Mobile|Nexus 4|Nexus 5|Nexus 6\",\r\n        \"Dell\": \"Dell[;]? (Streak|Aero|Venue|Venue Pro|Flash|Smoke|Mini 3iX)|XCD28|XCD35|\\\\b001DL\\\\b|\\\\b101DL\\\\b|\\\\bGS01\\\\b\",\r\n        \"Motorola\": \"Motorola|DROIDX|DROID BIONIC|\\\\bDroid\\\\b.*Build|Android.*Xoom|HRI39|MOT-|A1260|A1680|A555|A853|A855|A953|A955|A956|Motorola.*ELECTRIFY|Motorola.*i1|i867|i940|MB200|MB300|MB501|MB502|MB508|MB511|MB520|MB525|MB526|MB611|MB612|MB632|MB810|MB855|MB860|MB861|MB865|MB870|ME501|ME502|ME511|ME525|ME600|ME632|ME722|ME811|ME860|ME863|ME865|MT620|MT710|MT716|MT720|MT810|MT870|MT917|Motorola.*TITANIUM|WX435|WX445|XT300|XT301|XT311|XT316|XT317|XT319|XT320|XT390|XT502|XT530|XT531|XT532|XT535|XT603|XT610|XT611|XT615|XT681|XT701|XT702|XT711|XT720|XT800|XT806|XT860|XT862|XT875|XT882|XT883|XT894|XT901|XT907|XT909|XT910|XT912|XT928|XT926|XT915|XT919|XT925|XT1021|\\\\bMoto E\\\\b|XT1068|XT1092|XT1052\",\r\n        \"Samsung\": \"\\\\bSamsung\\\\b|SM-G950F|SM-G955F|SM-G9250|GT-19300|SGH-I337|BGT-S5230|GT-B2100|GT-B2700|GT-B2710|GT-B3210|GT-B3310|GT-B3410|GT-B3730|GT-B3740|GT-B5510|GT-B5512|GT-B5722|GT-B6520|GT-B7300|GT-B7320|GT-B7330|GT-B7350|GT-B7510|GT-B7722|GT-B7800|GT-C3010|GT-C3011|GT-C3060|GT-C3200|GT-C3212|GT-C3212I|GT-C3262|GT-C3222|GT-C3300|GT-C3300K|GT-C3303|GT-C3303K|GT-C3310|GT-C3322|GT-C3330|GT-C3350|GT-C3500|GT-C3510|GT-C3530|GT-C3630|GT-C3780|GT-C5010|GT-C5212|GT-C6620|GT-C6625|GT-C6712|GT-E1050|GT-E1070|GT-E1075|GT-E1080|GT-E1081|GT-E1085|GT-E1087|GT-E1100|GT-E1107|GT-E1110|GT-E1120|GT-E1125|GT-E1130|GT-E1160|GT-E1170|GT-E1175|GT-E1180|GT-E1182|GT-E1200|GT-E1210|GT-E1225|GT-E1230|GT-E1390|GT-E2100|GT-E2120|GT-E2121|GT-E2152|GT-E2220|GT-E2222|GT-E2230|GT-E2232|GT-E2250|GT-E2370|GT-E2550|GT-E2652|GT-E3210|GT-E3213|GT-I5500|GT-I5503|GT-I5700|GT-I5800|GT-I5801|GT-I6410|GT-I6420|GT-I7110|GT-I7410|GT-I7500|GT-I8000|GT-I8150|GT-I8160|GT-I8190|GT-I8320|GT-I8330|GT-I8350|GT-I8530|GT-I8700|GT-I8703|GT-I8910|GT-I9000|GT-I9001|GT-I9003|GT-I9010|GT-I9020|GT-I9023|GT-I9070|GT-I9082|GT-I9100|GT-I9103|GT-I9220|GT-I9250|GT-I9300|GT-I9305|GT-I9500|GT-I9505|GT-M3510|GT-M5650|GT-M7500|GT-M7600|GT-M7603|GT-M8800|GT-M8910|GT-N7000|GT-S3110|GT-S3310|GT-S3350|GT-S3353|GT-S3370|GT-S3650|GT-S3653|GT-S3770|GT-S3850|GT-S5210|GT-S5220|GT-S5229|GT-S5230|GT-S5233|GT-S5250|GT-S5253|GT-S5260|GT-S5263|GT-S5270|GT-S5300|GT-S5330|GT-S5350|GT-S5360|GT-S5363|GT-S5369|GT-S5380|GT-S5380D|GT-S5560|GT-S5570|GT-S5600|GT-S5603|GT-S5610|GT-S5620|GT-S5660|GT-S5670|GT-S5690|GT-S5750|GT-S5780|GT-S5830|GT-S5839|GT-S6102|GT-S6500|GT-S7070|GT-S7200|GT-S7220|GT-S7230|GT-S7233|GT-S7250|GT-S7500|GT-S7530|GT-S7550|GT-S7562|GT-S7710|GT-S8000|GT-S8003|GT-S8500|GT-S8530|GT-S8600|SCH-A310|SCH-A530|SCH-A570|SCH-A610|SCH-A630|SCH-A650|SCH-A790|SCH-A795|SCH-A850|SCH-A870|SCH-A890|SCH-A930|SCH-A950|SCH-A970|SCH-A990|SCH-I100|SCH-I110|SCH-I400|SCH-I405|SCH-I500|SCH-I510|SCH-I515|SCH-I600|SCH-I730|SCH-I760|SCH-I770|SCH-I830|SCH-I910|SCH-I920|SCH-I959|SCH-LC11|SCH-N150|SCH-N300|SCH-R100|SCH-R300|SCH-R351|SCH-R400|SCH-R410|SCH-T300|SCH-U310|SCH-U320|SCH-U350|SCH-U360|SCH-U365|SCH-U370|SCH-U380|SCH-U410|SCH-U430|SCH-U450|SCH-U460|SCH-U470|SCH-U490|SCH-U540|SCH-U550|SCH-U620|SCH-U640|SCH-U650|SCH-U660|SCH-U700|SCH-U740|SCH-U750|SCH-U810|SCH-U820|SCH-U900|SCH-U940|SCH-U960|SCS-26UC|SGH-A107|SGH-A117|SGH-A127|SGH-A137|SGH-A157|SGH-A167|SGH-A177|SGH-A187|SGH-A197|SGH-A227|SGH-A237|SGH-A257|SGH-A437|SGH-A517|SGH-A597|SGH-A637|SGH-A657|SGH-A667|SGH-A687|SGH-A697|SGH-A707|SGH-A717|SGH-A727|SGH-A737|SGH-A747|SGH-A767|SGH-A777|SGH-A797|SGH-A817|SGH-A827|SGH-A837|SGH-A847|SGH-A867|SGH-A877|SGH-A887|SGH-A897|SGH-A927|SGH-B100|SGH-B130|SGH-B200|SGH-B220|SGH-C100|SGH-C110|SGH-C120|SGH-C130|SGH-C140|SGH-C160|SGH-C170|SGH-C180|SGH-C200|SGH-C207|SGH-C210|SGH-C225|SGH-C230|SGH-C417|SGH-C450|SGH-D307|SGH-D347|SGH-D357|SGH-D407|SGH-D415|SGH-D780|SGH-D807|SGH-D980|SGH-E105|SGH-E200|SGH-E315|SGH-E316|SGH-E317|SGH-E335|SGH-E590|SGH-E635|SGH-E715|SGH-E890|SGH-F300|SGH-F480|SGH-I200|SGH-I300|SGH-I320|SGH-I550|SGH-I577|SGH-I600|SGH-I607|SGH-I617|SGH-I627|SGH-I637|SGH-I677|SGH-I700|SGH-I717|SGH-I727|SGH-i747M|SGH-I777|SGH-I780|SGH-I827|SGH-I847|SGH-I857|SGH-I896|SGH-I897|SGH-I900|SGH-I907|SGH-I917|SGH-I927|SGH-I937|SGH-I997|SGH-J150|SGH-J200|SGH-L170|SGH-L700|SGH-M110|SGH-M150|SGH-M200|SGH-N105|SGH-N500|SGH-N600|SGH-N620|SGH-N625|SGH-N700|SGH-N710|SGH-P107|SGH-P207|SGH-P300|SGH-P310|SGH-P520|SGH-P735|SGH-P777|SGH-Q105|SGH-R210|SGH-R220|SGH-R225|SGH-S105|SGH-S307|SGH-T109|SGH-T119|SGH-T139|SGH-T209|SGH-T219|SGH-T229|SGH-T239|SGH-T249|SGH-T259|SGH-T309|SGH-T319|SGH-T329|SGH-T339|SGH-T349|SGH-T359|SGH-T369|SGH-T379|SGH-T409|SGH-T429|SGH-T439|SGH-T459|SGH-T469|SGH-T479|SGH-T499|SGH-T509|SGH-T519|SGH-T539|SGH-T559|SGH-T589|SGH-T609|SGH-T619|SGH-T629|SGH-T639|SGH-T659|SGH-T669|SGH-T679|SGH-T709|SGH-T719|SGH-T729|SGH-T739|SGH-T746|SGH-T749|SGH-T759|SGH-T769|SGH-T809|SGH-T819|SGH-T839|SGH-T919|SGH-T929|SGH-T939|SGH-T959|SGH-T989|SGH-U100|SGH-U200|SGH-U800|SGH-V205|SGH-V206|SGH-X100|SGH-X105|SGH-X120|SGH-X140|SGH-X426|SGH-X427|SGH-X475|SGH-X495|SGH-X497|SGH-X507|SGH-X600|SGH-X610|SGH-X620|SGH-X630|SGH-X700|SGH-X820|SGH-X890|SGH-Z130|SGH-Z150|SGH-Z170|SGH-ZX10|SGH-ZX20|SHW-M110|SPH-A120|SPH-A400|SPH-A420|SPH-A460|SPH-A500|SPH-A560|SPH-A600|SPH-A620|SPH-A660|SPH-A700|SPH-A740|SPH-A760|SPH-A790|SPH-A800|SPH-A820|SPH-A840|SPH-A880|SPH-A900|SPH-A940|SPH-A960|SPH-D600|SPH-D700|SPH-D710|SPH-D720|SPH-I300|SPH-I325|SPH-I330|SPH-I350|SPH-I500|SPH-I600|SPH-I700|SPH-L700|SPH-M100|SPH-M220|SPH-M240|SPH-M300|SPH-M305|SPH-M320|SPH-M330|SPH-M350|SPH-M360|SPH-M370|SPH-M380|SPH-M510|SPH-M540|SPH-M550|SPH-M560|SPH-M570|SPH-M580|SPH-M610|SPH-M620|SPH-M630|SPH-M800|SPH-M810|SPH-M850|SPH-M900|SPH-M910|SPH-M920|SPH-M930|SPH-N100|SPH-N200|SPH-N240|SPH-N300|SPH-N400|SPH-Z400|SWC-E100|SCH-i909|GT-N7100|GT-N7105|SCH-I535|SM-N900A|SGH-I317|SGH-T999L|GT-S5360B|GT-I8262|GT-S6802|GT-S6312|GT-S6310|GT-S5312|GT-S5310|GT-I9105|GT-I8510|GT-S6790N|SM-G7105|SM-N9005|GT-S5301|GT-I9295|GT-I9195|SM-C101|GT-S7392|GT-S7560|GT-B7610|GT-I5510|GT-S7582|GT-S7530E|GT-I8750|SM-G9006V|SM-G9008V|SM-G9009D|SM-G900A|SM-G900D|SM-G900F|SM-G900H|SM-G900I|SM-G900J|SM-G900K|SM-G900L|SM-G900M|SM-G900P|SM-G900R4|SM-G900S|SM-G900T|SM-G900V|SM-G900W8|SHV-E160K|SCH-P709|SCH-P729|SM-T2558|GT-I9205|SM-G9350|SM-J120F|SM-G920F|SM-G920V|SM-G930F|SM-N910C|SM-A310F|GT-I9190|SM-J500FN|SM-G903F|SM-J330F\",\r\n        \"LG\": \"\\\\bLG\\\\b;|LG[- ]?(C800|C900|E400|E610|E900|E-900|F160|F180K|F180L|F180S|730|855|L160|LS740|LS840|LS970|LU6200|MS690|MS695|MS770|MS840|MS870|MS910|P500|P700|P705|VM696|AS680|AS695|AX840|C729|E970|GS505|272|C395|E739BK|E960|L55C|L75C|LS696|LS860|P769BK|P350|P500|P509|P870|UN272|US730|VS840|VS950|LN272|LN510|LS670|LS855|LW690|MN270|MN510|P509|P769|P930|UN200|UN270|UN510|UN610|US670|US740|US760|UX265|UX840|VN271|VN530|VS660|VS700|VS740|VS750|VS910|VS920|VS930|VX9200|VX11000|AX840A|LW770|P506|P925|P999|E612|D955|D802|MS323|M257)|LM-G710\",\r\n        \"Sony\": \"SonyST|SonyLT|SonyEricsson|SonyEricssonLT15iv|LT18i|E10i|LT28h|LT26w|SonyEricssonMT27i|C5303|C6902|C6903|C6906|C6943|D2533\",\r\n        \"Asus\": \"Asus.*Galaxy|PadFone.*Mobile\",\r\n        \"NokiaLumia\": \"Lumia [0-9]{3,4}\",\r\n        \"Micromax\": \"Micromax.*\\\\b(A210|A92|A88|A72|A111|A110Q|A115|A116|A110|A90S|A26|A51|A35|A54|A25|A27|A89|A68|A65|A57|A90)\\\\b\",\r\n        \"Palm\": \"PalmSource|Palm\",\r\n        \"Vertu\": \"Vertu|Vertu.*Ltd|Vertu.*Ascent|Vertu.*Ayxta|Vertu.*Constellation(F|Quest)?|Vertu.*Monika|Vertu.*Signature\",\r\n        \"Pantech\": \"PANTECH|IM-A850S|IM-A840S|IM-A830L|IM-A830K|IM-A830S|IM-A820L|IM-A810K|IM-A810S|IM-A800S|IM-T100K|IM-A725L|IM-A780L|IM-A775C|IM-A770K|IM-A760S|IM-A750K|IM-A740S|IM-A730S|IM-A720L|IM-A710K|IM-A690L|IM-A690S|IM-A650S|IM-A630K|IM-A600S|VEGA PTL21|PT003|P8010|ADR910L|P6030|P6020|P9070|P4100|P9060|P5000|CDM8992|TXT8045|ADR8995|IS11PT|P2030|P6010|P8000|PT002|IS06|CDM8999|P9050|PT001|TXT8040|P2020|P9020|P2000|P7040|P7000|C790\",\r\n        \"Fly\": \"IQ230|IQ444|IQ450|IQ440|IQ442|IQ441|IQ245|IQ256|IQ236|IQ255|IQ235|IQ245|IQ275|IQ240|IQ285|IQ280|IQ270|IQ260|IQ250\",\r\n        \"Wiko\": \"KITE 4G|HIGHWAY|GETAWAY|STAIRWAY|DARKSIDE|DARKFULL|DARKNIGHT|DARKMOON|SLIDE|WAX 4G|RAINBOW|BLOOM|SUNSET|GOA(?!nna)|LENNY|BARRY|IGGY|OZZY|CINK FIVE|CINK PEAX|CINK PEAX 2|CINK SLIM|CINK SLIM 2|CINK +|CINK KING|CINK PEAX|CINK SLIM|SUBLIM\",\r\n        \"iMobile\": \"i-mobile (IQ|i-STYLE|idea|ZAA|Hitz)\",\r\n        \"SimValley\": \"\\\\b(SP-80|XT-930|SX-340|XT-930|SX-310|SP-360|SP60|SPT-800|SP-120|SPT-800|SP-140|SPX-5|SPX-8|SP-100|SPX-8|SPX-12)\\\\b\",\r\n        \"Wolfgang\": \"AT-B24D|AT-AS50HD|AT-AS40W|AT-AS55HD|AT-AS45q2|AT-B26D|AT-AS50Q\",\r\n        \"Alcatel\": \"Alcatel\",\r\n        \"Nintendo\": \"Nintendo (3DS|Switch)\",\r\n        \"Amoi\": \"Amoi\",\r\n        \"INQ\": \"INQ\",\r\n        \"OnePlus\": \"ONEPLUS\",\r\n        \"GenericPhone\": \"Tapatalk|PDA;|SAGEM|\\\\bmmp\\\\b|pocket|\\\\bpsp\\\\b|symbian|Smartphone|smartfon|treo|up.browser|up.link|vodafone|\\\\bwap\\\\b|nokia|Series40|Series60|S60|SonyEricsson|N900|MAUI.*WAP.*Browser\"\r\n    },\r\n    \"tablets\": {\r\n        \"iPad\": \"iPad|iPad.*Mobile\",\r\n        \"NexusTablet\": \"Android.*Nexus[\\\\s]+(7|9|10)\",\r\n        \"GoogleTablet\": \"Android.*Pixel C\",\r\n        \"SamsungTablet\": \"SAMSUNG.*Tablet|Galaxy.*Tab|SC-01C|GT-P1000|GT-P1003|GT-P1010|GT-P3105|GT-P6210|GT-P6800|GT-P6810|GT-P7100|GT-P7300|GT-P7310|GT-P7500|GT-P7510|SCH-I800|SCH-I815|SCH-I905|SGH-I957|SGH-I987|SGH-T849|SGH-T859|SGH-T869|SPH-P100|GT-P3100|GT-P3108|GT-P3110|GT-P5100|GT-P5110|GT-P6200|GT-P7320|GT-P7511|GT-N8000|GT-P8510|SGH-I497|SPH-P500|SGH-T779|SCH-I705|SCH-I915|GT-N8013|GT-P3113|GT-P5113|GT-P8110|GT-N8010|GT-N8005|GT-N8020|GT-P1013|GT-P6201|GT-P7501|GT-N5100|GT-N5105|GT-N5110|SHV-E140K|SHV-E140L|SHV-E140S|SHV-E150S|SHV-E230K|SHV-E230L|SHV-E230S|SHW-M180K|SHW-M180L|SHW-M180S|SHW-M180W|SHW-M300W|SHW-M305W|SHW-M380K|SHW-M380S|SHW-M380W|SHW-M430W|SHW-M480K|SHW-M480S|SHW-M480W|SHW-M485W|SHW-M486W|SHW-M500W|GT-I9228|SCH-P739|SCH-I925|GT-I9200|GT-P5200|GT-P5210|GT-P5210X|SM-T311|SM-T310|SM-T310X|SM-T210|SM-T210R|SM-T211|SM-P600|SM-P601|SM-P605|SM-P900|SM-P901|SM-T217|SM-T217A|SM-T217S|SM-P6000|SM-T3100|SGH-I467|XE500|SM-T110|GT-P5220|GT-I9200X|GT-N5110X|GT-N5120|SM-P905|SM-T111|SM-T2105|SM-T315|SM-T320|SM-T320X|SM-T321|SM-T520|SM-T525|SM-T530NU|SM-T230NU|SM-T330NU|SM-T900|XE500T1C|SM-P605V|SM-P905V|SM-T337V|SM-T537V|SM-T707V|SM-T807V|SM-P600X|SM-P900X|SM-T210X|SM-T230|SM-T230X|SM-T325|GT-P7503|SM-T531|SM-T330|SM-T530|SM-T705|SM-T705C|SM-T535|SM-T331|SM-T800|SM-T700|SM-T537|SM-T807|SM-P907A|SM-T337A|SM-T537A|SM-T707A|SM-T807A|SM-T237|SM-T807P|SM-P607T|SM-T217T|SM-T337T|SM-T807T|SM-T116NQ|SM-T116BU|SM-P550|SM-T350|SM-T550|SM-T9000|SM-P9000|SM-T705Y|SM-T805|GT-P3113|SM-T710|SM-T810|SM-T815|SM-T360|SM-T533|SM-T113|SM-T335|SM-T715|SM-T560|SM-T670|SM-T677|SM-T377|SM-T567|SM-T357T|SM-T555|SM-T561|SM-T713|SM-T719|SM-T813|SM-T819|SM-T580|SM-T355Y?|SM-T280|SM-T817A|SM-T820|SM-W700|SM-P580|SM-T587|SM-P350|SM-P555M|SM-P355M|SM-T113NU|SM-T815Y|SM-T585|SM-T285|SM-T825|SM-W708|SM-T835|SM-T830|SM-T837V|SM-T720|SM-T510|SM-T387V\",\r\n        \"Kindle\": \"Kindle|Silk.*Accelerated|Android.*\\\\b(KFOT|KFTT|KFJWI|KFJWA|KFOTE|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|WFJWAE|KFSAWA|KFSAWI|KFASWI|KFARWI|KFFOWI|KFGIWI|KFMEWI)\\\\b|Android.*Silk\\/[0-9.]+ like Chrome\\/[0-9.]+ (?!Mobile)\",\r\n        \"SurfaceTablet\": \"Windows NT [0-9.]+; ARM;.*(Tablet|ARMBJS)\",\r\n        \"HPTablet\": \"HP Slate (7|8|10)|HP ElitePad 900|hp-tablet|EliteBook.*Touch|HP 8|Slate 21|HP SlateBook 10\",\r\n        \"AsusTablet\": \"^.*PadFone((?!Mobile).)*$|Transformer|TF101|TF101G|TF300T|TF300TG|TF300TL|TF700T|TF700KL|TF701T|TF810C|ME171|ME301T|ME302C|ME371MG|ME370T|ME372MG|ME172V|ME173X|ME400C|Slider SL101|\\\\bK00F\\\\b|\\\\bK00C\\\\b|\\\\bK00E\\\\b|\\\\bK00L\\\\b|TX201LA|ME176C|ME102A|\\\\bM80TA\\\\b|ME372CL|ME560CG|ME372CG|ME302KL| K010 | K011 | K017 | K01E |ME572C|ME103K|ME170C|ME171C|\\\\bME70C\\\\b|ME581C|ME581CL|ME8510C|ME181C|P01Y|PO1MA|P01Z|\\\\bP027\\\\b|\\\\bP024\\\\b|\\\\bP00C\\\\b\",\r\n        \"BlackBerryTablet\": \"PlayBook|RIM Tablet\",\r\n        \"HTCtablet\": \"HTC_Flyer_P512|HTC Flyer|HTC Jetstream|HTC-P715a|HTC EVO View 4G|PG41200|PG09410\",\r\n        \"MotorolaTablet\": \"xoom|sholest|MZ615|MZ605|MZ505|MZ601|MZ602|MZ603|MZ604|MZ606|MZ607|MZ608|MZ609|MZ615|MZ616|MZ617\",\r\n        \"NookTablet\": \"Android.*Nook|NookColor|nook browser|BNRV200|BNRV200A|BNTV250|BNTV250A|BNTV400|BNTV600|LogicPD Zoom2\",\r\n        \"AcerTablet\": \"Android.*; \\\\b(A100|A101|A110|A200|A210|A211|A500|A501|A510|A511|A700|A701|W500|W500P|W501|W501P|W510|W511|W700|G100|G100W|B1-A71|B1-710|B1-711|A1-810|A1-811|A1-830)\\\\b|W3-810|\\\\bA3-A10\\\\b|\\\\bA3-A11\\\\b|\\\\bA3-A20\\\\b|\\\\bA3-A30\",\r\n        \"ToshibaTablet\": \"Android.*(AT100|AT105|AT200|AT205|AT270|AT275|AT300|AT305|AT1S5|AT500|AT570|AT700|AT830)|TOSHIBA.*FOLIO\",\r\n        \"LGTablet\": \"\\\\bL-06C|LG-V909|LG-V900|LG-V700|LG-V510|LG-V500|LG-V410|LG-V400|LG-VK810\\\\b\",\r\n        \"FujitsuTablet\": \"Android.*\\\\b(F-01D|F-02F|F-05E|F-10D|M532|Q572)\\\\b\",\r\n        \"PrestigioTablet\": \"PMP3170B|PMP3270B|PMP3470B|PMP7170B|PMP3370B|PMP3570C|PMP5870C|PMP3670B|PMP5570C|PMP5770D|PMP3970B|PMP3870C|PMP5580C|PMP5880D|PMP5780D|PMP5588C|PMP7280C|PMP7280C3G|PMP7280|PMP7880D|PMP5597D|PMP5597|PMP7100D|PER3464|PER3274|PER3574|PER3884|PER5274|PER5474|PMP5097CPRO|PMP5097|PMP7380D|PMP5297C|PMP5297C_QUAD|PMP812E|PMP812E3G|PMP812F|PMP810E|PMP880TD|PMT3017|PMT3037|PMT3047|PMT3057|PMT7008|PMT5887|PMT5001|PMT5002\",\r\n        \"LenovoTablet\": \"Lenovo TAB|Idea(Tab|Pad)( A1|A10| K1|)|ThinkPad([ ]+)?Tablet|YT3-850M|YT3-X90L|YT3-X90F|YT3-X90X|Lenovo.*(S2109|S2110|S5000|S6000|K3011|A3000|A3500|A1000|A2107|A2109|A1107|A5500|A7600|B6000|B8000|B8080)(-|)(FL|F|HV|H|)|TB-X103F|TB-X304X|TB-X304F|TB-X304L|TB-X505F|TB-X505L|TB-X505X|TB-X605F|TB-X605L|TB-8703F|TB-8703X|TB-8703N|TB-8704N|TB-8704F|TB-8704X|TB-8704V|TB-7304F|TB-7304I|TB-7304X|Tab2A7-10F|Tab2A7-20F|TB2-X30L|YT3-X50L|YT3-X50F|YT3-X50M|YT-X705F|YT-X703F|YT-X703L|YT-X705L|YT-X705X|TB2-X30F|TB2-X30L|TB2-X30M|A2107A-F|A2107A-H|TB3-730F|TB3-730M|TB3-730X|TB-7504F|TB-7504X\",\r\n        \"DellTablet\": \"Venue 11|Venue 8|Venue 7|Dell Streak 10|Dell Streak 7\",\r\n        \"YarvikTablet\": \"Android.*\\\\b(TAB210|TAB211|TAB224|TAB250|TAB260|TAB264|TAB310|TAB360|TAB364|TAB410|TAB411|TAB420|TAB424|TAB450|TAB460|TAB461|TAB464|TAB465|TAB467|TAB468|TAB07-100|TAB07-101|TAB07-150|TAB07-151|TAB07-152|TAB07-200|TAB07-201-3G|TAB07-210|TAB07-211|TAB07-212|TAB07-214|TAB07-220|TAB07-400|TAB07-485|TAB08-150|TAB08-200|TAB08-201-3G|TAB08-201-30|TAB09-100|TAB09-211|TAB09-410|TAB10-150|TAB10-201|TAB10-211|TAB10-400|TAB10-410|TAB13-201|TAB274EUK|TAB275EUK|TAB374EUK|TAB462EUK|TAB474EUK|TAB9-200)\\\\b\",\r\n        \"MedionTablet\": \"Android.*\\\\bOYO\\\\b|LIFE.*(P9212|P9514|P9516|S9512)|LIFETAB\",\r\n        \"ArnovaTablet\": \"97G4|AN10G2|AN7bG3|AN7fG3|AN8G3|AN8cG3|AN7G3|AN9G3|AN7dG3|AN7dG3ST|AN7dG3ChildPad|AN10bG3|AN10bG3DT|AN9G2\",\r\n        \"IntensoTablet\": \"INM8002KP|INM1010FP|INM805ND|Intenso Tab|TAB1004\",\r\n        \"IRUTablet\": \"M702pro\",\r\n        \"MegafonTablet\": \"MegaFon V9|\\\\bZTE V9\\\\b|Android.*\\\\bMT7A\\\\b\",\r\n        \"EbodaTablet\": \"E-Boda (Supreme|Impresspeed|Izzycomm|Essential)\",\r\n        \"AllViewTablet\": \"Allview.*(Viva|Alldro|City|Speed|All TV|Frenzy|Quasar|Shine|TX1|AX1|AX2)\",\r\n        \"ArchosTablet\": \"\\\\b(101G9|80G9|A101IT)\\\\b|Qilive 97R|Archos5|\\\\bARCHOS (70|79|80|90|97|101|FAMILYPAD|)(b|c|)(G10| Cobalt| TITANIUM(HD|)| Xenon| Neon|XSK| 2| XS 2| PLATINUM| CARBON|GAMEPAD)\\\\b\",\r\n        \"AinolTablet\": \"NOVO7|NOVO8|NOVO10|Novo7Aurora|Novo7Basic|NOVO7PALADIN|novo9-Spark\",\r\n        \"NokiaLumiaTablet\": \"Lumia 2520\",\r\n        \"SonyTablet\": \"Sony.*Tablet|Xperia Tablet|Sony Tablet S|SO-03E|SGPT12|SGPT13|SGPT114|SGPT121|SGPT122|SGPT123|SGPT111|SGPT112|SGPT113|SGPT131|SGPT132|SGPT133|SGPT211|SGPT212|SGPT213|SGP311|SGP312|SGP321|EBRD1101|EBRD1102|EBRD1201|SGP351|SGP341|SGP511|SGP512|SGP521|SGP541|SGP551|SGP621|SGP641|SGP612|SOT31|SGP771|SGP611|SGP612|SGP712\",\r\n        \"PhilipsTablet\": \"\\\\b(PI2010|PI3000|PI3100|PI3105|PI3110|PI3205|PI3210|PI3900|PI4010|PI7000|PI7100)\\\\b\",\r\n        \"CubeTablet\": \"Android.*(K8GT|U9GT|U10GT|U16GT|U17GT|U18GT|U19GT|U20GT|U23GT|U30GT)|CUBE U8GT\",\r\n        \"CobyTablet\": \"MID1042|MID1045|MID1125|MID1126|MID7012|MID7014|MID7015|MID7034|MID7035|MID7036|MID7042|MID7048|MID7127|MID8042|MID8048|MID8127|MID9042|MID9740|MID9742|MID7022|MID7010\",\r\n        \"MIDTablet\": \"M9701|M9000|M9100|M806|M1052|M806|T703|MID701|MID713|MID710|MID727|MID760|MID830|MID728|MID933|MID125|MID810|MID732|MID120|MID930|MID800|MID731|MID900|MID100|MID820|MID735|MID980|MID130|MID833|MID737|MID960|MID135|MID860|MID736|MID140|MID930|MID835|MID733|MID4X10\",\r\n        \"MSITablet\": \"MSI \\\\b(Primo 73K|Primo 73L|Primo 81L|Primo 77|Primo 93|Primo 75|Primo 76|Primo 73|Primo 81|Primo 91|Primo 90|Enjoy 71|Enjoy 7|Enjoy 10)\\\\b\",\r\n        \"SMiTTablet\": \"Android.*(\\\\bMID\\\\b|MID-560|MTV-T1200|MTV-PND531|MTV-P1101|MTV-PND530)\",\r\n        \"RockChipTablet\": \"Android.*(RK2818|RK2808A|RK2918|RK3066)|RK2738|RK2808A\",\r\n        \"FlyTablet\": \"IQ310|Fly Vision\",\r\n        \"bqTablet\": \"Android.*(bq)?.*\\\\b(Elcano|Curie|Edison|Maxwell|Kepler|Pascal|Tesla|Hypatia|Platon|Newton|Livingstone|Cervantes|Avant|Aquaris ([E|M]10|M8))\\\\b|Maxwell.*Lite|Maxwell.*Plus\",\r\n        \"HuaweiTablet\": \"MediaPad|MediaPad 7 Youth|IDEOS S7|S7-201c|S7-202u|S7-101|S7-103|S7-104|S7-105|S7-106|S7-201|S7-Slim|M2-A01L|BAH-L09|BAH-W09|AGS-L09|CMR-AL19\",\r\n        \"NecTablet\": \"\\\\bN-06D|\\\\bN-08D\",\r\n        \"PantechTablet\": \"Pantech.*P4100\",\r\n        \"BronchoTablet\": \"Broncho.*(N701|N708|N802|a710)\",\r\n        \"VersusTablet\": \"TOUCHPAD.*[78910]|\\\\bTOUCHTAB\\\\b\",\r\n        \"ZyncTablet\": \"z1000|Z99 2G|z930|z990|z909|Z919|z900\",\r\n        \"PositivoTablet\": \"TB07STA|TB10STA|TB07FTA|TB10FTA\",\r\n        \"NabiTablet\": \"Android.*\\\\bNabi\",\r\n        \"KoboTablet\": \"Kobo Touch|\\\\bK080\\\\b|\\\\bVox\\\\b Build|\\\\bArc\\\\b Build\",\r\n        \"DanewTablet\": \"DSlide.*\\\\b(700|701R|702|703R|704|802|970|971|972|973|974|1010|1012)\\\\b\",\r\n        \"TexetTablet\": \"NaviPad|TB-772A|TM-7045|TM-7055|TM-9750|TM-7016|TM-7024|TM-7026|TM-7041|TM-7043|TM-7047|TM-8041|TM-9741|TM-9747|TM-9748|TM-9751|TM-7022|TM-7021|TM-7020|TM-7011|TM-7010|TM-7023|TM-7025|TM-7037W|TM-7038W|TM-7027W|TM-9720|TM-9725|TM-9737W|TM-1020|TM-9738W|TM-9740|TM-9743W|TB-807A|TB-771A|TB-727A|TB-725A|TB-719A|TB-823A|TB-805A|TB-723A|TB-715A|TB-707A|TB-705A|TB-709A|TB-711A|TB-890HD|TB-880HD|TB-790HD|TB-780HD|TB-770HD|TB-721HD|TB-710HD|TB-434HD|TB-860HD|TB-840HD|TB-760HD|TB-750HD|TB-740HD|TB-730HD|TB-722HD|TB-720HD|TB-700HD|TB-500HD|TB-470HD|TB-431HD|TB-430HD|TB-506|TB-504|TB-446|TB-436|TB-416|TB-146SE|TB-126SE\",\r\n        \"PlaystationTablet\": \"Playstation.*(Portable|Vita)\",\r\n        \"TrekstorTablet\": \"ST10416-1|VT10416-1|ST70408-1|ST702xx-1|ST702xx-2|ST80208|ST97216|ST70104-2|VT10416-2|ST10216-2A|SurfTab\",\r\n        \"PyleAudioTablet\": \"\\\\b(PTBL10CEU|PTBL10C|PTBL72BC|PTBL72BCEU|PTBL7CEU|PTBL7C|PTBL92BC|PTBL92BCEU|PTBL9CEU|PTBL9CUK|PTBL9C)\\\\b\",\r\n        \"AdvanTablet\": \"Android.* \\\\b(E3A|T3X|T5C|T5B|T3E|T3C|T3B|T1J|T1F|T2A|T1H|T1i|E1C|T1-E|T5-A|T4|E1-B|T2Ci|T1-B|T1-D|O1-A|E1-A|T1-A|T3A|T4i)\\\\b \",\r\n        \"DanyTechTablet\": \"Genius Tab G3|Genius Tab S2|Genius Tab Q3|Genius Tab G4|Genius Tab Q4|Genius Tab G-II|Genius TAB GII|Genius TAB GIII|Genius Tab S1\",\r\n        \"GalapadTablet\": \"Android.*\\\\bG1\\\\b(?!\\\\))\",\r\n        \"MicromaxTablet\": \"Funbook|Micromax.*\\\\b(P250|P560|P360|P362|P600|P300|P350|P500|P275)\\\\b\",\r\n        \"KarbonnTablet\": \"Android.*\\\\b(A39|A37|A34|ST8|ST10|ST7|Smart Tab3|Smart Tab2)\\\\b\",\r\n        \"AllFineTablet\": \"Fine7 Genius|Fine7 Shine|Fine7 Air|Fine8 Style|Fine9 More|Fine10 Joy|Fine11 Wide\",\r\n        \"PROSCANTablet\": \"\\\\b(PEM63|PLT1023G|PLT1041|PLT1044|PLT1044G|PLT1091|PLT4311|PLT4311PL|PLT4315|PLT7030|PLT7033|PLT7033D|PLT7035|PLT7035D|PLT7044K|PLT7045K|PLT7045KB|PLT7071KG|PLT7072|PLT7223G|PLT7225G|PLT7777G|PLT7810K|PLT7849G|PLT7851G|PLT7852G|PLT8015|PLT8031|PLT8034|PLT8036|PLT8080K|PLT8082|PLT8088|PLT8223G|PLT8234G|PLT8235G|PLT8816K|PLT9011|PLT9045K|PLT9233G|PLT9735|PLT9760G|PLT9770G)\\\\b\",\r\n        \"YONESTablet\": \"BQ1078|BC1003|BC1077|RK9702|BC9730|BC9001|IT9001|BC7008|BC7010|BC708|BC728|BC7012|BC7030|BC7027|BC7026\",\r\n        \"ChangJiaTablet\": \"TPC7102|TPC7103|TPC7105|TPC7106|TPC7107|TPC7201|TPC7203|TPC7205|TPC7210|TPC7708|TPC7709|TPC7712|TPC7110|TPC8101|TPC8103|TPC8105|TPC8106|TPC8203|TPC8205|TPC8503|TPC9106|TPC9701|TPC97101|TPC97103|TPC97105|TPC97106|TPC97111|TPC97113|TPC97203|TPC97603|TPC97809|TPC97205|TPC10101|TPC10103|TPC10106|TPC10111|TPC10203|TPC10205|TPC10503\",\r\n        \"GUTablet\": \"TX-A1301|TX-M9002|Q702|kf026\",\r\n        \"PointOfViewTablet\": \"TAB-P506|TAB-navi-7-3G-M|TAB-P517|TAB-P-527|TAB-P701|TAB-P703|TAB-P721|TAB-P731N|TAB-P741|TAB-P825|TAB-P905|TAB-P925|TAB-PR945|TAB-PL1015|TAB-P1025|TAB-PI1045|TAB-P1325|TAB-PROTAB[0-9]+|TAB-PROTAB25|TAB-PROTAB26|TAB-PROTAB27|TAB-PROTAB26XL|TAB-PROTAB2-IPS9|TAB-PROTAB30-IPS9|TAB-PROTAB25XXL|TAB-PROTAB26-IPS10|TAB-PROTAB30-IPS10\",\r\n        \"OvermaxTablet\": \"OV-(SteelCore|NewBase|Basecore|Baseone|Exellen|Quattor|EduTab|Solution|ACTION|BasicTab|TeddyTab|MagicTab|Stream|TB-08|TB-09)|Qualcore 1027\",\r\n        \"HCLTablet\": \"HCL.*Tablet|Connect-3G-2.0|Connect-2G-2.0|ME Tablet U1|ME Tablet U2|ME Tablet G1|ME Tablet X1|ME Tablet Y2|ME Tablet Sync\",\r\n        \"DPSTablet\": \"DPS Dream 9|DPS Dual 7\",\r\n        \"VistureTablet\": \"V97 HD|i75 3G|Visture V4( HD)?|Visture V5( HD)?|Visture V10\",\r\n        \"CrestaTablet\": \"CTP(-)?810|CTP(-)?818|CTP(-)?828|CTP(-)?838|CTP(-)?888|CTP(-)?978|CTP(-)?980|CTP(-)?987|CTP(-)?988|CTP(-)?989\",\r\n        \"MediatekTablet\": \"\\\\bMT8125|MT8389|MT8135|MT8377\\\\b\",\r\n        \"ConcordeTablet\": \"Concorde([ ]+)?Tab|ConCorde ReadMan\",\r\n        \"GoCleverTablet\": \"GOCLEVER TAB|A7GOCLEVER|M1042|M7841|M742|R1042BK|R1041|TAB A975|TAB A7842|TAB A741|TAB A741L|TAB M723G|TAB M721|TAB A1021|TAB I921|TAB R721|TAB I720|TAB T76|TAB R70|TAB R76.2|TAB R106|TAB R83.2|TAB M813G|TAB I721|GCTA722|TAB I70|TAB I71|TAB S73|TAB R73|TAB R74|TAB R93|TAB R75|TAB R76.1|TAB A73|TAB A93|TAB A93.2|TAB T72|TAB R83|TAB R974|TAB R973|TAB A101|TAB A103|TAB A104|TAB A104.2|R105BK|M713G|A972BK|TAB A971|TAB R974.2|TAB R104|TAB R83.3|TAB A1042\",\r\n        \"ModecomTablet\": \"FreeTAB 9000|FreeTAB 7.4|FreeTAB 7004|FreeTAB 7800|FreeTAB 2096|FreeTAB 7.5|FreeTAB 1014|FreeTAB 1001 |FreeTAB 8001|FreeTAB 9706|FreeTAB 9702|FreeTAB 7003|FreeTAB 7002|FreeTAB 1002|FreeTAB 7801|FreeTAB 1331|FreeTAB 1004|FreeTAB 8002|FreeTAB 8014|FreeTAB 9704|FreeTAB 1003\",\r\n        \"VoninoTablet\": \"\\\\b(Argus[ _]?S|Diamond[ _]?79HD|Emerald[ _]?78E|Luna[ _]?70C|Onyx[ _]?S|Onyx[ _]?Z|Orin[ _]?HD|Orin[ _]?S|Otis[ _]?S|SpeedStar[ _]?S|Magnet[ _]?M9|Primus[ _]?94[ _]?3G|Primus[ _]?94HD|Primus[ _]?QS|Android.*\\\\bQ8\\\\b|Sirius[ _]?EVO[ _]?QS|Sirius[ _]?QS|Spirit[ _]?S)\\\\b\",\r\n        \"ECSTablet\": \"V07OT2|TM105A|S10OT1|TR10CS1\",\r\n        \"StorexTablet\": \"eZee[_']?(Tab|Go)[0-9]+|TabLC7|Looney Tunes Tab\",\r\n        \"VodafoneTablet\": \"SmartTab([ ]+)?[0-9]+|SmartTabII10|SmartTabII7|VF-1497|VFD 1400\",\r\n        \"EssentielBTablet\": \"Smart[ ']?TAB[ ]+?[0-9]+|Family[ ']?TAB2\",\r\n        \"RossMoorTablet\": \"RM-790|RM-997|RMD-878G|RMD-974R|RMT-705A|RMT-701|RME-601|RMT-501|RMT-711\",\r\n        \"iMobileTablet\": \"i-mobile i-note\",\r\n        \"TolinoTablet\": \"tolino tab [0-9.]+|tolino shine\",\r\n        \"AudioSonicTablet\": \"\\\\bC-22Q|T7-QC|T-17B|T-17P\\\\b\",\r\n        \"AMPETablet\": \"Android.* A78 \",\r\n        \"SkkTablet\": \"Android.* (SKYPAD|PHOENIX|CYCLOPS)\",\r\n        \"TecnoTablet\": \"TECNO P9|TECNO DP8D\",\r\n        \"JXDTablet\": \"Android.* \\\\b(F3000|A3300|JXD5000|JXD3000|JXD2000|JXD300B|JXD300|S5800|S7800|S602b|S5110b|S7300|S5300|S602|S603|S5100|S5110|S601|S7100a|P3000F|P3000s|P101|P200s|P1000m|P200m|P9100|P1000s|S6600b|S908|P1000|P300|S18|S6600|S9100)\\\\b\",\r\n        \"iJoyTablet\": \"Tablet (Spirit 7|Essentia|Galatea|Fusion|Onix 7|Landa|Titan|Scooby|Deox|Stella|Themis|Argon|Unique 7|Sygnus|Hexen|Finity 7|Cream|Cream X2|Jade|Neon 7|Neron 7|Kandy|Scape|Saphyr 7|Rebel|Biox|Rebel|Rebel 8GB|Myst|Draco 7|Myst|Tab7-004|Myst|Tadeo Jones|Tablet Boing|Arrow|Draco Dual Cam|Aurix|Mint|Amity|Revolution|Finity 9|Neon 9|T9w|Amity 4GB Dual Cam|Stone 4GB|Stone 8GB|Andromeda|Silken|X2|Andromeda II|Halley|Flame|Saphyr 9,7|Touch 8|Planet|Triton|Unique 10|Hexen 10|Memphis 4GB|Memphis 8GB|Onix 10)\",\r\n        \"FX2Tablet\": \"FX2 PAD7|FX2 PAD10\",\r\n        \"XoroTablet\": \"KidsPAD 701|PAD[ ]?712|PAD[ ]?714|PAD[ ]?716|PAD[ ]?717|PAD[ ]?718|PAD[ ]?720|PAD[ ]?721|PAD[ ]?722|PAD[ ]?790|PAD[ ]?792|PAD[ ]?900|PAD[ ]?9715D|PAD[ ]?9716DR|PAD[ ]?9718DR|PAD[ ]?9719QR|PAD[ ]?9720QR|TelePAD1030|Telepad1032|TelePAD730|TelePAD731|TelePAD732|TelePAD735Q|TelePAD830|TelePAD9730|TelePAD795|MegaPAD 1331|MegaPAD 1851|MegaPAD 2151\",\r\n        \"ViewsonicTablet\": \"ViewPad 10pi|ViewPad 10e|ViewPad 10s|ViewPad E72|ViewPad7|ViewPad E100|ViewPad 7e|ViewSonic VB733|VB100a\",\r\n        \"VerizonTablet\": \"QTAQZ3|QTAIR7|QTAQTZ3|QTASUN1|QTASUN2|QTAXIA1\",\r\n        \"OdysTablet\": \"LOOX|XENO10|ODYS[ -](Space|EVO|Xpress|NOON)|\\\\bXELIO\\\\b|Xelio10Pro|XELIO7PHONETAB|XELIO10EXTREME|XELIOPT2|NEO_QUAD10\",\r\n        \"CaptivaTablet\": \"CAPTIVA PAD\",\r\n        \"IconbitTablet\": \"NetTAB|NT-3702|NT-3702S|NT-3702S|NT-3603P|NT-3603P|NT-0704S|NT-0704S|NT-3805C|NT-3805C|NT-0806C|NT-0806C|NT-0909T|NT-0909T|NT-0907S|NT-0907S|NT-0902S|NT-0902S\",\r\n        \"TeclastTablet\": \"T98 4G|\\\\bP80\\\\b|\\\\bX90HD\\\\b|X98 Air|X98 Air 3G|\\\\bX89\\\\b|P80 3G|\\\\bX80h\\\\b|P98 Air|\\\\bX89HD\\\\b|P98 3G|\\\\bP90HD\\\\b|P89 3G|X98 3G|\\\\bP70h\\\\b|P79HD 3G|G18d 3G|\\\\bP79HD\\\\b|\\\\bP89s\\\\b|\\\\bA88\\\\b|\\\\bP10HD\\\\b|\\\\bP19HD\\\\b|G18 3G|\\\\bP78HD\\\\b|\\\\bA78\\\\b|\\\\bP75\\\\b|G17s 3G|G17h 3G|\\\\bP85t\\\\b|\\\\bP90\\\\b|\\\\bP11\\\\b|\\\\bP98t\\\\b|\\\\bP98HD\\\\b|\\\\bG18d\\\\b|\\\\bP85s\\\\b|\\\\bP11HD\\\\b|\\\\bP88s\\\\b|\\\\bA80HD\\\\b|\\\\bA80se\\\\b|\\\\bA10h\\\\b|\\\\bP89\\\\b|\\\\bP78s\\\\b|\\\\bG18\\\\b|\\\\bP85\\\\b|\\\\bA70h\\\\b|\\\\bA70\\\\b|\\\\bG17\\\\b|\\\\bP18\\\\b|\\\\bA80s\\\\b|\\\\bA11s\\\\b|\\\\bP88HD\\\\b|\\\\bA80h\\\\b|\\\\bP76s\\\\b|\\\\bP76h\\\\b|\\\\bP98\\\\b|\\\\bA10HD\\\\b|\\\\bP78\\\\b|\\\\bP88\\\\b|\\\\bA11\\\\b|\\\\bA10t\\\\b|\\\\bP76a\\\\b|\\\\bP76t\\\\b|\\\\bP76e\\\\b|\\\\bP85HD\\\\b|\\\\bP85a\\\\b|\\\\bP86\\\\b|\\\\bP75HD\\\\b|\\\\bP76v\\\\b|\\\\bA12\\\\b|\\\\bP75a\\\\b|\\\\bA15\\\\b|\\\\bP76Ti\\\\b|\\\\bP81HD\\\\b|\\\\bA10\\\\b|\\\\bT760VE\\\\b|\\\\bT720HD\\\\b|\\\\bP76\\\\b|\\\\bP73\\\\b|\\\\bP71\\\\b|\\\\bP72\\\\b|\\\\bT720SE\\\\b|\\\\bC520Ti\\\\b|\\\\bT760\\\\b|\\\\bT720VE\\\\b|T720-3GE|T720-WiFi\",\r\n        \"OndaTablet\": \"\\\\b(V975i|Vi30|VX530|V701|Vi60|V701s|Vi50|V801s|V719|Vx610w|VX610W|V819i|Vi10|VX580W|Vi10|V711s|V813|V811|V820w|V820|Vi20|V711|VI30W|V712|V891w|V972|V819w|V820w|Vi60|V820w|V711|V813s|V801|V819|V975s|V801|V819|V819|V818|V811|V712|V975m|V101w|V961w|V812|V818|V971|V971s|V919|V989|V116w|V102w|V973|Vi40)\\\\b[\\\\s]+|V10 \\\\b4G\\\\b\",\r\n        \"JaytechTablet\": \"TPC-PA762\",\r\n        \"BlaupunktTablet\": \"Endeavour 800NG|Endeavour 1010\",\r\n        \"DigmaTablet\": \"\\\\b(iDx10|iDx9|iDx8|iDx7|iDxD7|iDxD8|iDsQ8|iDsQ7|iDsQ8|iDsD10|iDnD7|3TS804H|iDsQ11|iDj7|iDs10)\\\\b\",\r\n        \"EvolioTablet\": \"ARIA_Mini_wifi|Aria[ _]Mini|Evolio X10|Evolio X7|Evolio X8|\\\\bEvotab\\\\b|\\\\bNeura\\\\b\",\r\n        \"LavaTablet\": \"QPAD E704|\\\\bIvoryS\\\\b|E-TAB IVORY|\\\\bE-TAB\\\\b\",\r\n        \"AocTablet\": \"MW0811|MW0812|MW0922|MTK8382|MW1031|MW0831|MW0821|MW0931|MW0712\",\r\n        \"MpmanTablet\": \"MP11 OCTA|MP10 OCTA|MPQC1114|MPQC1004|MPQC994|MPQC974|MPQC973|MPQC804|MPQC784|MPQC780|\\\\bMPG7\\\\b|MPDCG75|MPDCG71|MPDC1006|MP101DC|MPDC9000|MPDC905|MPDC706HD|MPDC706|MPDC705|MPDC110|MPDC100|MPDC99|MPDC97|MPDC88|MPDC8|MPDC77|MP709|MID701|MID711|MID170|MPDC703|MPQC1010\",\r\n        \"CelkonTablet\": \"CT695|CT888|CT[\\\\s]?910|CT7 Tab|CT9 Tab|CT3 Tab|CT2 Tab|CT1 Tab|C820|C720|\\\\bCT-1\\\\b\",\r\n        \"WolderTablet\": \"miTab \\\\b(DIAMOND|SPACE|BROOKLYN|NEO|FLY|MANHATTAN|FUNK|EVOLUTION|SKY|GOCAR|IRON|GENIUS|POP|MINT|EPSILON|BROADWAY|JUMP|HOP|LEGEND|NEW AGE|LINE|ADVANCE|FEEL|FOLLOW|LIKE|LINK|LIVE|THINK|FREEDOM|CHICAGO|CLEVELAND|BALTIMORE-GH|IOWA|BOSTON|SEATTLE|PHOENIX|DALLAS|IN 101|MasterChef)\\\\b\",\r\n        \"MediacomTablet\": \"M-MPI10C3G|M-SP10EG|M-SP10EGP|M-SP10HXAH|M-SP7HXAH|M-SP10HXBH|M-SP8HXAH|M-SP8MXA\",\r\n        \"MiTablet\": \"\\\\bMI PAD\\\\b|\\\\bHM NOTE 1W\\\\b\",\r\n        \"NibiruTablet\": \"Nibiru M1|Nibiru Jupiter One\",\r\n        \"NexoTablet\": \"NEXO NOVA|NEXO 10|NEXO AVIO|NEXO FREE|NEXO GO|NEXO EVO|NEXO 3G|NEXO SMART|NEXO KIDDO|NEXO MOBI\",\r\n        \"LeaderTablet\": \"TBLT10Q|TBLT10I|TBL-10WDKB|TBL-10WDKBO2013|TBL-W230V2|TBL-W450|TBL-W500|SV572|TBLT7I|TBA-AC7-8G|TBLT79|TBL-8W16|TBL-10W32|TBL-10WKB|TBL-W100\",\r\n        \"UbislateTablet\": \"UbiSlate[\\\\s]?7C\",\r\n        \"PocketBookTablet\": \"Pocketbook\",\r\n        \"KocasoTablet\": \"\\\\b(TB-1207)\\\\b\",\r\n        \"HisenseTablet\": \"\\\\b(F5281|E2371)\\\\b\",\r\n        \"Hudl\": \"Hudl HT7S3|Hudl 2\",\r\n        \"TelstraTablet\": \"T-Hub2\",\r\n        \"GenericTablet\": \"Android.*\\\\b97D\\\\b|Tablet(?!.*PC)|BNTV250A|MID-WCDMA|LogicPD Zoom2|\\\\bA7EB\\\\b|CatNova8|A1_07|CT704|CT1002|\\\\bM721\\\\b|rk30sdk|\\\\bEVOTAB\\\\b|M758A|ET904|ALUMIUM10|Smartfren Tab|Endeavour 1010|Tablet-PC-4|Tagi Tab|\\\\bM6pro\\\\b|CT1020W|arc 10HD|\\\\bTP750\\\\b|\\\\bQTAQZ3\\\\b|WVT101|TM1088|KT107\"\r\n    },\r\n    \"oss\": {\r\n        \"AndroidOS\": \"Android\",\r\n        \"BlackBerryOS\": \"blackberry|\\\\bBB10\\\\b|rim tablet os\",\r\n        \"PalmOS\": \"PalmOS|avantgo|blazer|elaine|hiptop|palm|plucker|xiino\",\r\n        \"SymbianOS\": \"Symbian|SymbOS|Series60|Series40|SYB-[0-9]+|\\\\bS60\\\\b\",\r\n        \"WindowsMobileOS\": \"Windows CE.*(PPC|Smartphone|Mobile|[0-9]{3}x[0-9]{3})|Windows Mobile|Windows Phone [0-9.]+|WCE;\",\r\n        \"WindowsPhoneOS\": \"Windows Phone 10.0|Windows Phone 8.1|Windows Phone 8.0|Windows Phone OS|XBLWP7|ZuneWP7|Windows NT 6.[23]; ARM;\",\r\n        \"iOS\": \"\\\\biPhone.*Mobile|\\\\biPod|\\\\biPad|AppleCoreMedia\",\r\n        \"iPadOS\": \"CPU OS 13\",\r\n        \"MeeGoOS\": \"MeeGo\",\r\n        \"MaemoOS\": \"Maemo\",\r\n        \"JavaOS\": \"J2ME\\/|\\\\bMIDP\\\\b|\\\\bCLDC\\\\b\",\r\n        \"webOS\": \"webOS|hpwOS\",\r\n        \"badaOS\": \"\\\\bBada\\\\b\",\r\n        \"BREWOS\": \"BREW\"\r\n    },\r\n    \"uas\": {\r\n        \"Chrome\": \"\\\\bCrMo\\\\b|CriOS|Android.*Chrome\\/[.0-9]* (Mobile)?\",\r\n        \"Dolfin\": \"\\\\bDolfin\\\\b\",\r\n        \"Opera\": \"Opera.*Mini|Opera.*Mobi|Android.*Opera|Mobile.*OPR\\/[0-9.]+$|Coast\\/[0-9.]+\",\r\n        \"Skyfire\": \"Skyfire\",\r\n        \"Edge\": \"Mobile Safari\\/[.0-9]* Edge\",\r\n        \"IE\": \"IEMobile|MSIEMobile\",\r\n        \"Firefox\": \"fennec|firefox.*maemo|(Mobile|Tablet).*Firefox|Firefox.*Mobile|FxiOS\",\r\n        \"Bolt\": \"bolt\",\r\n        \"TeaShark\": \"teashark\",\r\n        \"Blazer\": \"Blazer\",\r\n        \"Safari\": \"Version.*Mobile.*Safari|Safari.*Mobile|MobileSafari\",\r\n        \"WeChat\": \"\\\\bMicroMessenger\\\\b\",\r\n        \"UCBrowser\": \"UC.*Browser|UCWEB\",\r\n        \"baiduboxapp\": \"baiduboxapp\",\r\n        \"baidubrowser\": \"baidubrowser\",\r\n        \"DiigoBrowser\": \"DiigoBrowser\",\r\n        \"Mercury\": \"\\\\bMercury\\\\b\",\r\n        \"ObigoBrowser\": \"Obigo\",\r\n        \"NetFront\": \"NF-Browser\",\r\n        \"GenericBrowser\": \"NokiaBrowser|OviBrowser|OneBrowser|TwonkyBeamBrowser|SEMC.*Browser|FlyFlow|Minimo|NetFront|Novarra-Vision|MQQBrowser|MicroMessenger\",\r\n        \"PaleMoon\": \"Android.*PaleMoon|Mobile.*PaleMoon\"\r\n    },\r\n    \"props\": {\r\n        \"Mobile\": \"Mobile\\/[VER]\",\r\n        \"Build\": \"Build\\/[VER]\",\r\n        \"Version\": \"Version\\/[VER]\",\r\n        \"VendorID\": \"VendorID\\/[VER]\",\r\n        \"iPad\": \"iPad.*CPU[a-z ]+[VER]\",\r\n        \"iPhone\": \"iPhone.*CPU[a-z ]+[VER]\",\r\n        \"iPod\": \"iPod.*CPU[a-z ]+[VER]\",\r\n        \"Kindle\": \"Kindle\\/[VER]\",\r\n        \"Chrome\": [\r\n            \"Chrome\\/[VER]\",\r\n            \"CriOS\\/[VER]\",\r\n            \"CrMo\\/[VER]\"\r\n        ],\r\n        \"Coast\": [\r\n            \"Coast\\/[VER]\"\r\n        ],\r\n        \"Dolfin\": \"Dolfin\\/[VER]\",\r\n        \"Firefox\": [\r\n            \"Firefox\\/[VER]\",\r\n            \"FxiOS\\/[VER]\"\r\n        ],\r\n        \"Fennec\": \"Fennec\\/[VER]\",\r\n        \"Edge\": \"Edge\\/[VER]\",\r\n        \"IE\": [\r\n            \"IEMobile\\/[VER];\",\r\n            \"IEMobile [VER]\",\r\n            \"MSIE [VER];\",\r\n            \"Trident\\/[0-9.]+;.*rv:[VER]\"\r\n        ],\r\n        \"NetFront\": \"NetFront\\/[VER]\",\r\n        \"NokiaBrowser\": \"NokiaBrowser\\/[VER]\",\r\n        \"Opera\": [\r\n            \" OPR\\/[VER]\",\r\n            \"Opera Mini\\/[VER]\",\r\n            \"Version\\/[VER]\"\r\n        ],\r\n        \"Opera Mini\": \"Opera Mini\\/[VER]\",\r\n        \"Opera Mobi\": \"Version\\/[VER]\",\r\n        \"UCBrowser\": [\r\n            \"UCWEB[VER]\",\r\n            \"UC.*Browser\\/[VER]\"\r\n        ],\r\n        \"MQQBrowser\": \"MQQBrowser\\/[VER]\",\r\n        \"MicroMessenger\": \"MicroMessenger\\/[VER]\",\r\n        \"baiduboxapp\": \"baiduboxapp\\/[VER]\",\r\n        \"baidubrowser\": \"baidubrowser\\/[VER]\",\r\n        \"SamsungBrowser\": \"SamsungBrowser\\/[VER]\",\r\n        \"Iron\": \"Iron\\/[VER]\",\r\n        \"Safari\": [\r\n            \"Version\\/[VER]\",\r\n            \"Safari\\/[VER]\"\r\n        ],\r\n        \"Skyfire\": \"Skyfire\\/[VER]\",\r\n        \"Tizen\": \"Tizen\\/[VER]\",\r\n        \"Webkit\": \"webkit[ \\/][VER]\",\r\n        \"PaleMoon\": \"PaleMoon\\/[VER]\",\r\n        \"Gecko\": \"Gecko\\/[VER]\",\r\n        \"Trident\": \"Trident\\/[VER]\",\r\n        \"Presto\": \"Presto\\/[VER]\",\r\n        \"Goanna\": \"Goanna\\/[VER]\",\r\n        \"iOS\": \" \\\\bi?OS\\\\b [VER][ ;]{1}\",\r\n        \"Android\": \"Android [VER]\",\r\n        \"BlackBerry\": [\r\n            \"BlackBerry[\\\\w]+\\/[VER]\",\r\n            \"BlackBerry.*Version\\/[VER]\",\r\n            \"Version\\/[VER]\"\r\n        ],\r\n        \"BREW\": \"BREW [VER]\",\r\n        \"Java\": \"Java\\/[VER]\",\r\n        \"Windows Phone OS\": [\r\n            \"Windows Phone OS [VER]\",\r\n            \"Windows Phone [VER]\"\r\n        ],\r\n        \"Windows Phone\": \"Windows Phone [VER]\",\r\n        \"Windows CE\": \"Windows CE\\/[VER]\",\r\n        \"Windows NT\": \"Windows NT [VER]\",\r\n        \"Symbian\": [\r\n            \"SymbianOS\\/[VER]\",\r\n            \"Symbian\\/[VER]\"\r\n        ],\r\n        \"webOS\": [\r\n            \"webOS\\/[VER]\",\r\n            \"hpwOS\\/[VER];\"\r\n        ]\r\n    },\r\n    \"utils\": {\r\n        \"Bot\": \"Googlebot|facebookexternalhit|Google-AMPHTML|s~amp-validator|AdsBot-Google|Google Keyword Suggestion|Facebot|YandexBot|YandexMobileBot|bingbot|ia_archiver|AhrefsBot|Ezooms|GSLFbot|WBSearchBot|Twitterbot|TweetmemeBot|Twikle|PaperLiBot|Wotbox|UnwindFetchor|Exabot|MJ12bot|YandexImages|TurnitinBot|Pingdom|contentkingapp\",\r\n        \"MobileBot\": \"Googlebot-Mobile|AdsBot-Google-Mobile|YahooSeeker\\/M1A1-R2D2\",\r\n        \"DesktopMode\": \"WPDesktop\",\r\n        \"TV\": \"SonyDTV|HbbTV\",\r\n        \"WebKit\": \"(webkit)[ \\/]([\\\\w.]+)\",\r\n        \"Console\": \"\\\\b(Nintendo|Nintendo WiiU|Nintendo 3DS|Nintendo Switch|PLAYSTATION|Xbox)\\\\b\",\r\n        \"Watch\": \"SM-V700\"\r\n    }\r\n};\r\n\r\n    // following patterns come from http://detectmobilebrowsers.com/\r\n    impl.detectMobileBrowsers = {\r\n        fullPattern: /(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i,\r\n        shortPattern: /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i,\r\n        tabletPattern: /android|ipad|playbook|silk/i\r\n    };\r\n\r\n    var hasOwnProp = Object.prototype.hasOwnProperty,\r\n        isArray;\r\n\r\n    impl.FALLBACK_PHONE = 'UnknownPhone';\r\n    impl.FALLBACK_TABLET = 'UnknownTablet';\r\n    impl.FALLBACK_MOBILE = 'UnknownMobile';\r\n\r\n    isArray = ('isArray' in Array) ?\r\n        Array.isArray : function (value) { return Object.prototype.toString.call(value) === '[object Array]'; };\r\n\r\n    function equalIC(a, b) {\r\n        return a != null && b != null && a.toLowerCase() === b.toLowerCase();\r\n    }\r\n\r\n    function containsIC(array, value) {\r\n        var valueLC, i, len = array.length;\r\n        if (!len || !value) {\r\n            return false;\r\n        }\r\n        valueLC = value.toLowerCase();\r\n        for (i = 0; i < len; ++i) {\r\n            if (valueLC === array[i].toLowerCase()) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function convertPropsToRegExp(object) {\r\n        for (var key in object) {\r\n            if (hasOwnProp.call(object, key)) {\r\n                object[key] = new RegExp(object[key], 'i');\r\n            }\r\n        }\r\n    }\r\n\r\n    function prepareUserAgent(userAgent) {\r\n        return (userAgent || '').substr(0, 500); // mitigate vulnerable to ReDoS\r\n    }\r\n\r\n    (function init() {\r\n        var key, values, value, i, len, verPos, mobileDetectRules = impl.mobileDetectRules;\r\n        for (key in mobileDetectRules.props) {\r\n            if (hasOwnProp.call(mobileDetectRules.props, key)) {\r\n                values = mobileDetectRules.props[key];\r\n                if (!isArray(values)) {\r\n                    values = [values];\r\n                }\r\n                len = values.length;\r\n                for (i = 0; i < len; ++i) {\r\n                    value = values[i];\r\n                    verPos = value.indexOf('[VER]');\r\n                    if (verPos >= 0) {\r\n                        value = value.substring(0, verPos) + '([\\\\w._\\\\+]+)' + value.substring(verPos + 5);\r\n                    }\r\n                    values[i] = new RegExp(value, 'i');\r\n                }\r\n                mobileDetectRules.props[key] = values;\r\n            }\r\n        }\r\n        convertPropsToRegExp(mobileDetectRules.oss);\r\n        convertPropsToRegExp(mobileDetectRules.phones);\r\n        convertPropsToRegExp(mobileDetectRules.tablets);\r\n        convertPropsToRegExp(mobileDetectRules.uas);\r\n        convertPropsToRegExp(mobileDetectRules.utils);\r\n\r\n        // copy some patterns to oss0 which are tested first (see issue#15)\r\n        mobileDetectRules.oss0 = {\r\n            WindowsPhoneOS: mobileDetectRules.oss.WindowsPhoneOS,\r\n            WindowsMobileOS: mobileDetectRules.oss.WindowsMobileOS\r\n        };\r\n    }());\r\n\r\n    /**\r\n     * Test userAgent string against a set of rules and find the first matched key.\r\n     * @param {Object} rules (key is String, value is RegExp)\r\n     * @param {String} userAgent the navigator.userAgent (or HTTP-Header 'User-Agent').\r\n     * @returns {String|null} the matched key if found, otherwise <tt>null</tt>\r\n     * @private\r\n     */\r\n    impl.findMatch = function(rules, userAgent) {\r\n        for (var key in rules) {\r\n            if (hasOwnProp.call(rules, key)) {\r\n                if (rules[key].test(userAgent)) {\r\n                    return key;\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * Test userAgent string against a set of rules and return an array of matched keys.\r\n     * @param {Object} rules (key is String, value is RegExp)\r\n     * @param {String} userAgent the navigator.userAgent (or HTTP-Header 'User-Agent').\r\n     * @returns {Array} an array of matched keys, may be empty when there is no match, but not <tt>null</tt>\r\n     * @private\r\n     */\r\n    impl.findMatches = function(rules, userAgent) {\r\n        var result = [];\r\n        for (var key in rules) {\r\n            if (hasOwnProp.call(rules, key)) {\r\n                if (rules[key].test(userAgent)) {\r\n                    result.push(key);\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n\r\n    /**\r\n     * Check the version of the given property in the User-Agent.\r\n     *\r\n     * @param {String} propertyName\r\n     * @param {String} userAgent\r\n     * @return {String} version or <tt>null</tt> if version not found\r\n     * @private\r\n     */\r\n    impl.getVersionStr = function (propertyName, userAgent) {\r\n        var props = impl.mobileDetectRules.props, patterns, i, len, match;\r\n        if (hasOwnProp.call(props, propertyName)) {\r\n            patterns = props[propertyName];\r\n            len = patterns.length;\r\n            for (i = 0; i < len; ++i) {\r\n                match = patterns[i].exec(userAgent);\r\n                if (match !== null) {\r\n                    return match[1];\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * Check the version of the given property in the User-Agent.\r\n     * Will return a float number. (eg. 2_0 will return 2.0, 4.3.1 will return 4.31)\r\n     *\r\n     * @param {String} propertyName\r\n     * @param {String} userAgent\r\n     * @return {Number} version or <tt>NaN</tt> if version not found\r\n     * @private\r\n     */\r\n    impl.getVersion = function (propertyName, userAgent) {\r\n        var version = impl.getVersionStr(propertyName, userAgent);\r\n        return version ? impl.prepareVersionNo(version) : NaN;\r\n    };\r\n\r\n    /**\r\n     * Prepare the version number.\r\n     *\r\n     * @param {String} version\r\n     * @return {Number} the version number as a floating number\r\n     * @private\r\n     */\r\n    impl.prepareVersionNo = function (version) {\r\n        var numbers;\r\n\r\n        numbers = version.split(/[a-z._ \\/\\-]/i);\r\n        if (numbers.length === 1) {\r\n            version = numbers[0];\r\n        }\r\n        if (numbers.length > 1) {\r\n            version = numbers[0] + '.';\r\n            numbers.shift();\r\n            version += numbers.join('');\r\n        }\r\n        return Number(version);\r\n    };\r\n\r\n    impl.isMobileFallback = function (userAgent) {\r\n        return impl.detectMobileBrowsers.fullPattern.test(userAgent) ||\r\n            impl.detectMobileBrowsers.shortPattern.test(userAgent.substr(0,4));\r\n    };\r\n\r\n    impl.isTabletFallback = function (userAgent) {\r\n        return impl.detectMobileBrowsers.tabletPattern.test(userAgent);\r\n    };\r\n\r\n    impl.prepareDetectionCache = function (cache, userAgent, maxPhoneWidth) {\r\n        if (cache.mobile !== undefined) {\r\n            return;\r\n        }\r\n        var phone, tablet, phoneSized;\r\n\r\n        // first check for stronger tablet rules, then phone (see issue#5)\r\n        tablet = impl.findMatch(impl.mobileDetectRules.tablets, userAgent);\r\n        if (tablet) {\r\n            cache.mobile = cache.tablet = tablet;\r\n            cache.phone = null;\r\n            return; // unambiguously identified as tablet\r\n        }\r\n\r\n        phone = impl.findMatch(impl.mobileDetectRules.phones, userAgent);\r\n        if (phone) {\r\n            cache.mobile = cache.phone = phone;\r\n            cache.tablet = null;\r\n            return; // unambiguously identified as phone\r\n        }\r\n\r\n        // our rules haven't found a match -> try more general fallback rules\r\n        if (impl.isMobileFallback(userAgent)) {\r\n            phoneSized = MobileDetect.isPhoneSized(maxPhoneWidth);\r\n            if (phoneSized === undefined) {\r\n                cache.mobile = impl.FALLBACK_MOBILE;\r\n                cache.tablet = cache.phone = null;\r\n            } else if (phoneSized) {\r\n                cache.mobile = cache.phone = impl.FALLBACK_PHONE;\r\n                cache.tablet = null;\r\n            } else {\r\n                cache.mobile = cache.tablet = impl.FALLBACK_TABLET;\r\n                cache.phone = null;\r\n            }\r\n        } else if (impl.isTabletFallback(userAgent)) {\r\n            cache.mobile = cache.tablet = impl.FALLBACK_TABLET;\r\n            cache.phone = null;\r\n        } else {\r\n            // not mobile at all!\r\n            cache.mobile = cache.tablet = cache.phone = null;\r\n        }\r\n    };\r\n\r\n    // t is a reference to a MobileDetect instance\r\n    impl.mobileGrade = function (t) {\r\n        // impl note:\r\n        // To keep in sync w/ Mobile_Detect.php easily, the following code is tightly aligned to the PHP version.\r\n        // When changes are made in Mobile_Detect.php, copy this method and replace:\r\n        //     $this-> / t.\r\n        //     self::MOBILE_GRADE_(.) / '$1'\r\n        //     , self::VERSION_TYPE_FLOAT / (nothing)\r\n        //     isIOS() / os('iOS')\r\n        //     [reg] / (nothing)   <-- jsdelivr complaining about unescaped unicode character U+00AE\r\n        var $isMobile = t.mobile() !== null;\r\n\r\n        if (\r\n            // Apple iOS 3.2-5.1 - Tested on the original iPad (4.3 / 5.0), iPad 2 (4.3), iPad 3 (5.1), original iPhone (3.1), iPhone 3 (3.2), 3GS (4.3), 4 (4.3 / 5.0), and 4S (5.1)\r\n            t.os('iOS') && t.version('iPad')>=4.3 ||\r\n            t.os('iOS') && t.version('iPhone')>=3.1 ||\r\n            t.os('iOS') && t.version('iPod')>=3.1 ||\r\n\r\n            // Android 2.1-2.3 - Tested on the HTC Incredible (2.2), original Droid (2.2), HTC Aria (2.1), Google Nexus S (2.3). Functional on 1.5 & 1.6 but performance may be sluggish, tested on Google G1 (1.5)\r\n            // Android 3.1 (Honeycomb)  - Tested on the Samsung Galaxy Tab 10.1 and Motorola XOOM\r\n            // Android 4.0 (ICS)  - Tested on a Galaxy Nexus. Note: transition performance can be poor on upgraded devices\r\n            // Android 4.1 (Jelly Bean)  - Tested on a Galaxy Nexus and Galaxy 7\r\n            ( t.version('Android')>2.1 && t.is('Webkit') ) ||\r\n\r\n            // Windows Phone 7-7.5 - Tested on the HTC Surround (7.0) HTC Trophy (7.5), LG-E900 (7.5), Nokia Lumia 800\r\n            t.version('Windows Phone OS')>=7.0 ||\r\n\r\n            // Blackberry 7 - Tested on BlackBerry Torch 9810\r\n            // Blackberry 6.0 - Tested on the Torch 9800 and Style 9670\r\n            t.is('BlackBerry') && t.version('BlackBerry')>=6.0 ||\r\n            // Blackberry Playbook (1.0-2.0) - Tested on PlayBook\r\n            t.match('Playbook.*Tablet') ||\r\n\r\n            // Palm WebOS (1.4-2.0) - Tested on the Palm Pixi (1.4), Pre (1.4), Pre 2 (2.0)\r\n            ( t.version('webOS')>=1.4 && t.match('Palm|Pre|Pixi') ) ||\r\n            // Palm WebOS 3.0  - Tested on HP TouchPad\r\n            t.match('hp.*TouchPad') ||\r\n\r\n            // Firefox Mobile (12 Beta) - Tested on Android 2.3 device\r\n            ( t.is('Firefox') && t.version('Firefox')>=12 ) ||\r\n\r\n            // Chrome for Android - Tested on Android 4.0, 4.1 device\r\n            ( t.is('Chrome') && t.is('AndroidOS') && t.version('Android')>=4.0 ) ||\r\n\r\n            // Skyfire 4.1 - Tested on Android 2.3 device\r\n            ( t.is('Skyfire') && t.version('Skyfire')>=4.1 && t.is('AndroidOS') && t.version('Android')>=2.3 ) ||\r\n\r\n            // Opera Mobile 11.5-12: Tested on Android 2.3\r\n            ( t.is('Opera') && t.version('Opera Mobi')>11 && t.is('AndroidOS') ) ||\r\n\r\n            // Meego 1.2 - Tested on Nokia 950 and N9\r\n            t.is('MeeGoOS') ||\r\n\r\n            // Tizen (pre-release) - Tested on early hardware\r\n            t.is('Tizen') ||\r\n\r\n            // Samsung Bada 2.0 - Tested on a Samsung Wave 3, Dolphin browser\r\n            // @todo: more tests here!\r\n            t.is('Dolfin') && t.version('Bada')>=2.0 ||\r\n\r\n            // UC Browser - Tested on Android 2.3 device\r\n            ( (t.is('UC Browser') || t.is('Dolfin')) && t.version('Android')>=2.3 ) ||\r\n\r\n            // Kindle 3 and Fire  - Tested on the built-in WebKit browser for each\r\n            ( t.match('Kindle Fire') ||\r\n                t.is('Kindle') && t.version('Kindle')>=3.0 ) ||\r\n\r\n            // Nook Color 1.4.1 - Tested on original Nook Color, not Nook Tablet\r\n            t.is('AndroidOS') && t.is('NookTablet') ||\r\n\r\n            // Chrome Desktop 11-21 - Tested on OS X 10.7 and Windows 7\r\n            t.version('Chrome')>=11 && !$isMobile ||\r\n\r\n            // Safari Desktop 4-5 - Tested on OS X 10.7 and Windows 7\r\n            t.version('Safari')>=5.0 && !$isMobile ||\r\n\r\n            // Firefox Desktop 4-13 - Tested on OS X 10.7 and Windows 7\r\n            t.version('Firefox')>=4.0 && !$isMobile ||\r\n\r\n            // Internet Explorer 7-9 - Tested on Windows XP, Vista and 7\r\n            t.version('MSIE')>=7.0 && !$isMobile ||\r\n\r\n            // Opera Desktop 10-12 - Tested on OS X 10.7 and Windows 7\r\n            // @reference: http://my.opera.com/community/openweb/idopera/\r\n            t.version('Opera')>=10 && !$isMobile\r\n\r\n            ){\r\n            return 'A';\r\n        }\r\n\r\n        if (\r\n            t.os('iOS') && t.version('iPad')<4.3 ||\r\n            t.os('iOS') && t.version('iPhone')<3.1 ||\r\n            t.os('iOS') && t.version('iPod')<3.1 ||\r\n\r\n            // Blackberry 5.0: Tested on the Storm 2 9550, Bold 9770\r\n            t.is('Blackberry') && t.version('BlackBerry')>=5 && t.version('BlackBerry')<6 ||\r\n\r\n            //Opera Mini (5.0-6.5) - Tested on iOS 3.2/4.3 and Android 2.3\r\n            ( t.version('Opera Mini')>=5.0 && t.version('Opera Mini')<=6.5 &&\r\n                (t.version('Android')>=2.3 || t.is('iOS')) ) ||\r\n\r\n            // Nokia Symbian^3 - Tested on Nokia N8 (Symbian^3), C7 (Symbian^3), also works on N97 (Symbian^1)\r\n            t.match('NokiaN8|NokiaC7|N97.*Series60|Symbian/3') ||\r\n\r\n            // @todo: report this (tested on Nokia N71)\r\n            t.version('Opera Mobi')>=11 && t.is('SymbianOS')\r\n            ){\r\n            return 'B';\r\n        }\r\n\r\n        if (\r\n        // Blackberry 4.x - Tested on the Curve 8330\r\n            t.version('BlackBerry')<5.0 ||\r\n            // Windows Mobile - Tested on the HTC Leo (WinMo 5.2)\r\n            t.match('MSIEMobile|Windows CE.*Mobile') || t.version('Windows Mobile')<=5.2\r\n\r\n            ){\r\n            return 'C';\r\n        }\r\n\r\n        //All older smartphone platforms and featurephones - Any device that doesn't support media queries\r\n        //will receive the basic, C grade experience.\r\n        return 'C';\r\n    };\r\n\r\n    impl.detectOS = function (ua) {\r\n        return impl.findMatch(impl.mobileDetectRules.oss0, ua) ||\r\n            impl.findMatch(impl.mobileDetectRules.oss, ua);\r\n    };\r\n\r\n    impl.getDeviceSmallerSide = function () {\r\n        return window.screen.width < window.screen.height ?\r\n            window.screen.width :\r\n            window.screen.height;\r\n    };\r\n\r\n    /**\r\n     * Constructor for MobileDetect object.\r\n     * <br>\r\n     * Such an object will keep a reference to the given user-agent string and cache most of the detect queries.<br>\r\n     * <div style=\"background-color: #d9edf7; border: 1px solid #bce8f1; color: #3a87ad; padding: 14px; border-radius: 2px; margin-top: 20px\">\r\n     *     <strong>Find information how to download and install:</strong>\r\n     *     <a href=\"https://github.com/hgoebl/mobile-detect.js/\">github.com/hgoebl/mobile-detect.js/</a>\r\n     * </div>\r\n     *\r\n     * @example <pre>\r\n     *     var md = new MobileDetect(window.navigator.userAgent);\r\n     *     if (md.mobile()) {\r\n     *         location.href = (md.mobileGrade() === 'A') ? '/mobile/' : '/lynx/';\r\n     *     }\r\n     * </pre>\r\n     *\r\n     * @param {string} userAgent typically taken from window.navigator.userAgent or http_header['User-Agent']\r\n     * @param {number} [maxPhoneWidth=600] <strong>only for browsers</strong> specify a value for the maximum\r\n     *        width of smallest device side (in logical \"CSS\" pixels) until a device detected as mobile will be handled\r\n     *        as phone.\r\n     *        This is only used in cases where the device cannot be classified as phone or tablet.<br>\r\n     *        See <a href=\"http://developer.android.com/guide/practices/screens_support.html\">Declaring Tablet Layouts\r\n     *        for Android</a>.<br>\r\n     *        If you provide a value < 0, then this \"fuzzy\" check is disabled.\r\n     * @constructor\r\n     * @global\r\n     */\r\n    function MobileDetect(userAgent, maxPhoneWidth) {\r\n        this.ua = prepareUserAgent(userAgent);\r\n        this._cache = {};\r\n        //600dp is typical 7\" tablet minimum width\r\n        this.maxPhoneWidth = maxPhoneWidth || 600;\r\n    }\r\n\r\n    MobileDetect.prototype = {\r\n        constructor: MobileDetect,\r\n\r\n        /**\r\n         * Returns the detected phone or tablet type or <tt>null</tt> if it is not a mobile device.\r\n         * <br>\r\n         * For a list of possible return values see {@link MobileDetect#phone} and {@link MobileDetect#tablet}.<br>\r\n         * <br>\r\n         * If the device is not detected by the regular expressions from Mobile-Detect, a test is made against\r\n         * the patterns of <a href=\"http://detectmobilebrowsers.com/\">detectmobilebrowsers.com</a>. If this test\r\n         * is positive, a value of <code>UnknownPhone</code>, <code>UnknownTablet</code> or\r\n         * <code>UnknownMobile</code> is returned.<br>\r\n         * When used in browser, the decision whether phone or tablet is made based on <code>screen.width/height</code>.<br>\r\n         * <br>\r\n         * When used server-side (node.js), there is no way to tell the difference between <code>UnknownTablet</code>\r\n         * and <code>UnknownMobile</code>, so you will get <code>UnknownMobile</code> here.<br>\r\n         * Be aware that since v1.0.0 in this special case you will get <code>UnknownMobile</code> only for:\r\n         * {@link MobileDetect#mobile}, not for {@link MobileDetect#phone} and {@link MobileDetect#tablet}.\r\n         * In versions before v1.0.0 all 3 methods returned <code>UnknownMobile</code> which was tedious to use.\r\n         * <br>\r\n         * In most cases you will use the return value just as a boolean.\r\n         *\r\n         * @returns {String} the key for the phone family or tablet family, e.g. \"Nexus\".\r\n         * @function MobileDetect#mobile\r\n         */\r\n        mobile: function () {\r\n            impl.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth);\r\n            return this._cache.mobile;\r\n        },\r\n\r\n        /**\r\n         * Returns the detected phone type/family string or <tt>null</tt>.\r\n         * <br>\r\n         * The returned tablet (family or producer) is one of following keys:<br>\r\n         * <br><tt>iPhone, BlackBerry, HTC, Nexus, Dell, Motorola, Samsung, LG, Sony, Asus,\r\n         * NokiaLumia, Micromax, Palm, Vertu, Pantech, Fly, Wiko, iMobile, SimValley,\r\n         * Wolfgang, Alcatel, Nintendo, Amoi, INQ, OnePlus, GenericPhone</tt><br>\r\n         * <br>\r\n         * If the device is not detected by the regular expressions from Mobile-Detect, a test is made against\r\n         * the patterns of <a href=\"http://detectmobilebrowsers.com/\">detectmobilebrowsers.com</a>. If this test\r\n         * is positive, a value of <code>UnknownPhone</code> or <code>UnknownMobile</code> is returned.<br>\r\n         * When used in browser, the decision whether phone or tablet is made based on <code>screen.width/height</code>.<br>\r\n         * <br>\r\n         * When used server-side (node.js), there is no way to tell the difference between <code>UnknownTablet</code>\r\n         * and <code>UnknownMobile</code>, so you will get <code>null</code> here, while {@link MobileDetect#mobile}\r\n         * will return <code>UnknownMobile</code>.<br>\r\n         * Be aware that since v1.0.0 in this special case you will get <code>UnknownMobile</code> only for:\r\n         * {@link MobileDetect#mobile}, not for {@link MobileDetect#phone} and {@link MobileDetect#tablet}.\r\n         * In versions before v1.0.0 all 3 methods returned <code>UnknownMobile</code> which was tedious to use.\r\n         * <br>\r\n         * In most cases you will use the return value just as a boolean.\r\n         *\r\n         * @returns {String} the key of the phone family or producer, e.g. \"iPhone\"\r\n         * @function MobileDetect#phone\r\n         */\r\n        phone: function () {\r\n            impl.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth);\r\n            return this._cache.phone;\r\n        },\r\n\r\n        /**\r\n         * Returns the detected tablet type/family string or <tt>null</tt>.\r\n         * <br>\r\n         * The returned tablet (family or producer) is one of following keys:<br>\r\n         * <br><tt>iPad, NexusTablet, GoogleTablet, SamsungTablet, Kindle, SurfaceTablet,\r\n         * HPTablet, AsusTablet, BlackBerryTablet, HTCtablet, MotorolaTablet, NookTablet,\r\n         * AcerTablet, ToshibaTablet, LGTablet, FujitsuTablet, PrestigioTablet,\r\n         * LenovoTablet, DellTablet, YarvikTablet, MedionTablet, ArnovaTablet,\r\n         * IntensoTablet, IRUTablet, MegafonTablet, EbodaTablet, AllViewTablet,\r\n         * ArchosTablet, AinolTablet, NokiaLumiaTablet, SonyTablet, PhilipsTablet,\r\n         * CubeTablet, CobyTablet, MIDTablet, MSITablet, SMiTTablet, RockChipTablet,\r\n         * FlyTablet, bqTablet, HuaweiTablet, NecTablet, PantechTablet, BronchoTablet,\r\n         * VersusTablet, ZyncTablet, PositivoTablet, NabiTablet, KoboTablet, DanewTablet,\r\n         * TexetTablet, PlaystationTablet, TrekstorTablet, PyleAudioTablet, AdvanTablet,\r\n         * DanyTechTablet, GalapadTablet, MicromaxTablet, KarbonnTablet, AllFineTablet,\r\n         * PROSCANTablet, YONESTablet, ChangJiaTablet, GUTablet, PointOfViewTablet,\r\n         * OvermaxTablet, HCLTablet, DPSTablet, VistureTablet, CrestaTablet,\r\n         * MediatekTablet, ConcordeTablet, GoCleverTablet, ModecomTablet, VoninoTablet,\r\n         * ECSTablet, StorexTablet, VodafoneTablet, EssentielBTablet, RossMoorTablet,\r\n         * iMobileTablet, TolinoTablet, AudioSonicTablet, AMPETablet, SkkTablet,\r\n         * TecnoTablet, JXDTablet, iJoyTablet, FX2Tablet, XoroTablet, ViewsonicTablet,\r\n         * VerizonTablet, OdysTablet, CaptivaTablet, IconbitTablet, TeclastTablet,\r\n         * OndaTablet, JaytechTablet, BlaupunktTablet, DigmaTablet, EvolioTablet,\r\n         * LavaTablet, AocTablet, MpmanTablet, CelkonTablet, WolderTablet, MediacomTablet,\r\n         * MiTablet, NibiruTablet, NexoTablet, LeaderTablet, UbislateTablet,\r\n         * PocketBookTablet, KocasoTablet, HisenseTablet, Hudl, TelstraTablet,\r\n         * GenericTablet</tt><br>\r\n         * <br>\r\n         * If the device is not detected by the regular expressions from Mobile-Detect, a test is made against\r\n         * the patterns of <a href=\"http://detectmobilebrowsers.com/\">detectmobilebrowsers.com</a>. If this test\r\n         * is positive, a value of <code>UnknownTablet</code> or <code>UnknownMobile</code> is returned.<br>\r\n         * When used in browser, the decision whether phone or tablet is made based on <code>screen.width/height</code>.<br>\r\n         * <br>\r\n         * When used server-side (node.js), there is no way to tell the difference between <code>UnknownTablet</code>\r\n         * and <code>UnknownMobile</code>, so you will get <code>null</code> here, while {@link MobileDetect#mobile}\r\n         * will return <code>UnknownMobile</code>.<br>\r\n         * Be aware that since v1.0.0 in this special case you will get <code>UnknownMobile</code> only for:\r\n         * {@link MobileDetect#mobile}, not for {@link MobileDetect#phone} and {@link MobileDetect#tablet}.\r\n         * In versions before v1.0.0 all 3 methods returned <code>UnknownMobile</code> which was tedious to use.\r\n         * <br>\r\n         * In most cases you will use the return value just as a boolean.\r\n         *\r\n         * @returns {String} the key of the tablet family or producer, e.g. \"SamsungTablet\"\r\n         * @function MobileDetect#tablet\r\n         */\r\n        tablet: function () {\r\n            impl.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth);\r\n            return this._cache.tablet;\r\n        },\r\n\r\n        /**\r\n         * Returns the (first) detected user-agent string or <tt>null</tt>.\r\n         * <br>\r\n         * The returned user-agent is one of following keys:<br>\r\n         * <br><tt>Chrome, Dolfin, Opera, Skyfire, Edge, IE, Firefox, Bolt, TeaShark, Blazer,\r\n         * Safari, WeChat, UCBrowser, baiduboxapp, baidubrowser, DiigoBrowser, Mercury,\r\n         * ObigoBrowser, NetFront, GenericBrowser, PaleMoon</tt><br>\r\n         * <br>\r\n         * In most cases calling {@link MobileDetect#userAgent} will be sufficient. But there are rare\r\n         * cases where a mobile device pretends to be more than one particular browser. You can get the\r\n         * list of all matches with {@link MobileDetect#userAgents} or check for a particular value by\r\n         * providing one of the defined keys as first argument to {@link MobileDetect#is}.\r\n         *\r\n         * @returns {String} the key for the detected user-agent or <tt>null</tt>\r\n         * @function MobileDetect#userAgent\r\n         */\r\n        userAgent: function () {\r\n            if (this._cache.userAgent === undefined) {\r\n                this._cache.userAgent = impl.findMatch(impl.mobileDetectRules.uas, this.ua);\r\n            }\r\n            return this._cache.userAgent;\r\n        },\r\n\r\n        /**\r\n         * Returns all detected user-agent strings.\r\n         * <br>\r\n         * The array is empty or contains one or more of following keys:<br>\r\n         * <br><tt>Chrome, Dolfin, Opera, Skyfire, Edge, IE, Firefox, Bolt, TeaShark, Blazer,\r\n         * Safari, WeChat, UCBrowser, baiduboxapp, baidubrowser, DiigoBrowser, Mercury,\r\n         * ObigoBrowser, NetFront, GenericBrowser, PaleMoon</tt><br>\r\n         * <br>\r\n         * In most cases calling {@link MobileDetect#userAgent} will be sufficient. But there are rare\r\n         * cases where a mobile device pretends to be more than one particular browser. You can get the\r\n         * list of all matches with {@link MobileDetect#userAgents} or check for a particular value by\r\n         * providing one of the defined keys as first argument to {@link MobileDetect#is}.\r\n         *\r\n         * @returns {Array} the array of detected user-agent keys or <tt>[]</tt>\r\n         * @function MobileDetect#userAgents\r\n         */\r\n        userAgents: function () {\r\n            if (this._cache.userAgents === undefined) {\r\n                this._cache.userAgents = impl.findMatches(impl.mobileDetectRules.uas, this.ua);\r\n            }\r\n            return this._cache.userAgents;\r\n        },\r\n\r\n        /**\r\n         * Returns the detected operating system string or <tt>null</tt>.\r\n         * <br>\r\n         * The operating system is one of following keys:<br>\r\n         * <br><tt>AndroidOS, BlackBerryOS, PalmOS, SymbianOS, WindowsMobileOS, WindowsPhoneOS,\r\n         * iOS, iPadOS, MeeGoOS, MaemoOS, JavaOS, webOS, badaOS, BREWOS</tt><br>\r\n         *\r\n         * @returns {String} the key for the detected operating system.\r\n         * @function MobileDetect#os\r\n         */\r\n        os: function () {\r\n            if (this._cache.os === undefined) {\r\n                this._cache.os = impl.detectOS(this.ua);\r\n            }\r\n            return this._cache.os;\r\n        },\r\n\r\n        /**\r\n         * Get the version (as Number) of the given property in the User-Agent.\r\n         * <br>\r\n         * Will return a float number. (eg. 2_0 will return 2.0, 4.3.1 will return 4.31)\r\n         *\r\n         * @param {String} key a key defining a thing which has a version.<br>\r\n         *        You can use one of following keys:<br>\r\n         * <br><tt>Mobile, Build, Version, VendorID, iPad, iPhone, iPod, Kindle, Chrome, Coast,\r\n         * Dolfin, Firefox, Fennec, Edge, IE, NetFront, NokiaBrowser, Opera, Opera Mini,\r\n         * Opera Mobi, UCBrowser, MQQBrowser, MicroMessenger, baiduboxapp, baidubrowser,\r\n         * SamsungBrowser, Iron, Safari, Skyfire, Tizen, Webkit, PaleMoon, Gecko, Trident,\r\n         * Presto, Goanna, iOS, Android, BlackBerry, BREW, Java, Windows Phone OS, Windows\r\n         * Phone, Windows CE, Windows NT, Symbian, webOS</tt><br>\r\n         *\r\n         * @returns {Number} the version as float or <tt>NaN</tt> if User-Agent doesn't contain this version.\r\n         *          Be careful when comparing this value with '==' operator!\r\n         * @function MobileDetect#version\r\n         */\r\n        version: function (key) {\r\n            return impl.getVersion(key, this.ua);\r\n        },\r\n\r\n        /**\r\n         * Get the version (as String) of the given property in the User-Agent.\r\n         * <br>\r\n         *\r\n         * @param {String} key a key defining a thing which has a version.<br>\r\n         *        You can use one of following keys:<br>\r\n         * <br><tt>Mobile, Build, Version, VendorID, iPad, iPhone, iPod, Kindle, Chrome, Coast,\r\n         * Dolfin, Firefox, Fennec, Edge, IE, NetFront, NokiaBrowser, Opera, Opera Mini,\r\n         * Opera Mobi, UCBrowser, MQQBrowser, MicroMessenger, baiduboxapp, baidubrowser,\r\n         * SamsungBrowser, Iron, Safari, Skyfire, Tizen, Webkit, PaleMoon, Gecko, Trident,\r\n         * Presto, Goanna, iOS, Android, BlackBerry, BREW, Java, Windows Phone OS, Windows\r\n         * Phone, Windows CE, Windows NT, Symbian, webOS</tt><br>\r\n         *\r\n         * @returns {String} the \"raw\" version as String or <tt>null</tt> if User-Agent doesn't contain this version.\r\n         *\r\n         * @function MobileDetect#versionStr\r\n         */\r\n        versionStr: function (key) {\r\n            return impl.getVersionStr(key, this.ua);\r\n        },\r\n\r\n        /**\r\n         * Global test key against userAgent, os, phone, tablet and some other properties of userAgent string.\r\n         *\r\n         * @param {String} key the key (case-insensitive) of a userAgent, an operating system, phone or\r\n         *        tablet family.<br>\r\n         *        For a complete list of possible values, see {@link MobileDetect#userAgent},\r\n         *        {@link MobileDetect#os}, {@link MobileDetect#phone}, {@link MobileDetect#tablet}.<br>\r\n         *        Additionally you have following keys:<br>\r\n         * <br><tt>Bot, MobileBot, DesktopMode, TV, WebKit, Console, Watch</tt><br>\r\n         *\r\n         * @returns {boolean} <tt>true</tt> when the given key is one of the defined keys of userAgent, os, phone,\r\n         *                    tablet or one of the listed additional keys, otherwise <tt>false</tt>\r\n         * @function MobileDetect#is\r\n         */\r\n        is: function (key) {\r\n            return containsIC(this.userAgents(), key) ||\r\n                   equalIC(key, this.os()) ||\r\n                   equalIC(key, this.phone()) ||\r\n                   equalIC(key, this.tablet()) ||\r\n                   containsIC(impl.findMatches(impl.mobileDetectRules.utils, this.ua), key);\r\n        },\r\n\r\n        /**\r\n         * Do a quick test against navigator::userAgent.\r\n         *\r\n         * @param {String|RegExp} pattern the pattern, either as String or RegExp\r\n         *                        (a string will be converted to a case-insensitive RegExp).\r\n         * @returns {boolean} <tt>true</tt> when the pattern matches, otherwise <tt>false</tt>\r\n         * @function MobileDetect#match\r\n         */\r\n        match: function (pattern) {\r\n            if (!(pattern instanceof RegExp)) {\r\n                pattern = new RegExp(pattern, 'i');\r\n            }\r\n            return pattern.test(this.ua);\r\n        },\r\n\r\n        /**\r\n         * Checks whether the mobile device can be considered as phone regarding <code>screen.width</code>.\r\n         * <br>\r\n         * Obviously this method makes sense in browser environments only (not for Node.js)!\r\n         * @param {number} [maxPhoneWidth] the maximum logical pixels (aka. CSS-pixels) to be considered as phone.<br>\r\n         *        The argument is optional and if not present or falsy, the value of the constructor is taken.\r\n         * @returns {boolean|undefined} <code>undefined</code> if screen size wasn't detectable, else <code>true</code>\r\n         *          when screen.width is less or equal to maxPhoneWidth, otherwise <code>false</code>.<br>\r\n         *          Will always return <code>undefined</code> server-side.\r\n         */\r\n        isPhoneSized: function (maxPhoneWidth) {\r\n            return MobileDetect.isPhoneSized(maxPhoneWidth || this.maxPhoneWidth);\r\n        },\r\n\r\n        /**\r\n         * Returns the mobile grade ('A', 'B', 'C').\r\n         *\r\n         * @returns {String} one of the mobile grades ('A', 'B', 'C').\r\n         * @function MobileDetect#mobileGrade\r\n         */\r\n        mobileGrade: function () {\r\n            if (this._cache.grade === undefined) {\r\n                this._cache.grade = impl.mobileGrade(this);\r\n            }\r\n            return this._cache.grade;\r\n        }\r\n    };\r\n\r\n    // environment-dependent\r\n    if (typeof window !== 'undefined' && window.screen) {\r\n        MobileDetect.isPhoneSized = function (maxPhoneWidth) {\r\n            return maxPhoneWidth < 0 ? undefined : impl.getDeviceSmallerSide() <= maxPhoneWidth;\r\n        };\r\n    } else {\r\n        MobileDetect.isPhoneSized = function () {};\r\n    }\r\n\r\n    // should not be replaced by a completely new object - just overwrite existing methods\r\n    MobileDetect._impl = impl;\r\n    \r\n    MobileDetect.version = '1.4.4 2019-09-21';\r\n\r\n    return MobileDetect;\r\n}); // end of call of define()\r\n})((function (undefined) {\r\n    if (typeof module !== 'undefined' && module.exports) {\r\n        return function (factory) { module.exports = factory(); };\r\n    } else if (typeof define === 'function' && define.amd) {\r\n        return define;\r\n    } else if (typeof window !== 'undefined') {\r\n        return function (factory) { window.MobileDetect = factory(); };\r\n    } else {\r\n        // please file a bug if you get this error!\r\n        throw new Error('unknown environment');\r\n    }\r\n})());","// Copyright (c) 2013 Pieroxy <pieroxy@pieroxy.net>\r\n// This work is free. You can redistribute it and/or modify it\r\n// under the terms of the WTFPL, Version 2\r\n// For more information see LICENSE.txt or http://www.wtfpl.net/\r\n//\r\n// For more information, the home page:\r\n// http://pieroxy.net/blog/pages/lz-string/testing.html\r\n//\r\n// LZ-based compression algorithm, version 1.4.4\r\n\r\n// private property\r\nlet f = String.fromCharCode;\r\nlet keyStrBase64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\r\nlet keyStrUriSafe = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$\";\r\nlet baseReverseDic = {};\r\n\r\nfunction getBaseValue(alphabet, character) {\r\n  if (!baseReverseDic[alphabet]) {\r\n    baseReverseDic[alphabet] = {};\r\n    for (let i = 0; i < alphabet.length; i++) {\r\n      baseReverseDic[alphabet][alphabet.charAt(i)] = i;\r\n    }\r\n  }\r\n  return baseReverseDic[alphabet][character];\r\n}\r\n\r\nfunction getInput(input) {\r\n  if (input === null) {\r\n    return '';\r\n  } else if (input === '') {\r\n    return null;\r\n  }\r\n\r\n  if (typeof input === \"string\") {\r\n    return input;\r\n  }\r\n\r\n  if (input instanceof ArrayBuffer) {\r\n    input = new Uint8Array(input);\r\n  }\r\n\r\n  let s = '';\r\n  for (let i = 0; i < input.length; i++) {\r\n    s += String.fromCharCode(input[i]);\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nexport default {\r\n  compressToBase64: function (input) {\r\n    input = getInput(input);\r\n\r\n    if (!input) return \"\";\r\n\r\n    let res = this._compress(input, 6, function (a) {\r\n      return keyStrBase64.charAt(a);\r\n    });\r\n    switch (res.length%4) { // To produce valid Base64\r\n      default: // When could this happen ?\r\n      case 0 :\r\n        return res;\r\n      case 1 :\r\n        return res + \"===\";\r\n      case 2 :\r\n        return res + \"==\";\r\n      case 3 :\r\n        return res + \"=\";\r\n    }\r\n  },\r\n\r\n  decompressFromBase64: function (input) {\r\n    if (input === null) return \"\";\r\n    if (input === \"\") return null;\r\n\r\n    input = getInput(input);\r\n    return this._decompress(input.length, 32, function (index) {\r\n      return getBaseValue(keyStrBase64, input.charAt(index));\r\n    });\r\n  },\r\n\r\n  compressToUTF16: function (input) {\r\n    if (input === null) return \"\";\r\n\r\n    input = getInput(input);\r\n    return this._compress(input, 15, function (a) {\r\n      return f(a + 32);\r\n    }) + \" \";\r\n  },\r\n\r\n  decompressFromUTF16: function (compressed) {\r\n    if (compressed === null) return \"\";\r\n    if (compressed === \"\") return null;\r\n\r\n    compressed = getInput(compressed);\r\n    return this._decompress(compressed.length, 16384, function (index) {\r\n      return compressed.charCodeAt(index) - 32;\r\n    });\r\n  },\r\n\r\n  //compress into uint8array (UCS-2 big endian format)\r\n  compressToUint8Array: function (uncompressed) {\r\n    uncompressed = getInput(uncompressed);\r\n\r\n    let compressed = this.compress(uncompressed);\r\n    let buf = new Uint8Array(compressed.length*2); // 2 bytes per character\r\n\r\n    for (let i = 0, TotalLen = compressed.length; i < TotalLen; i++) {\r\n      let current_value = compressed.charCodeAt(i);\r\n      buf[i*2] = current_value>>>8;\r\n      buf[i*2 + 1] = current_value%256;\r\n    }\r\n    return buf;\r\n  },\r\n\r\n  //decompress from uint8array (UCS-2 big endian format)\r\n  decompressFromUint8Array: function (compressed) {\r\n    if (compressed === null || compressed === undefined) {\r\n      return this.decompress(compressed);\r\n    } else {\r\n      compressed = getInput(compressed);\r\n\r\n      let buf = new Array(compressed.length/2); // 2 bytes per character\r\n      for (let i = 0, TotalLen = buf.length; i < TotalLen; i++) {\r\n        buf[i] = compressed[i*2]*256 + compressed[i*2 + 1];\r\n      }\r\n\r\n      let result = [];\r\n      buf.forEach(function (c) {\r\n        result.push(f(c));\r\n      });\r\n      return this.decompress(result.join(''));\r\n\r\n    }\r\n\r\n  },\r\n\r\n\r\n  //compress into a string that is already URI encoded\r\n  compressToEncodedURIComponent: function (input) {\r\n    if (input === null) return \"\";\r\n    return this._compress(input, 6, function (a) {\r\n      return keyStrUriSafe.charAt(a);\r\n    });\r\n  },\r\n\r\n  //decompress from an output of compressToEncodedURIComponent\r\n  decompressFromEncodedURIComponent: function (input) {\r\n    if (input === null) return \"\";\r\n    if (input === \"\") return null;\r\n    input = input.replace(/ /g, \"+\");\r\n    return this._decompress(input.length, 32, function (index) {\r\n      return getBaseValue(keyStrUriSafe, input.charAt(index));\r\n    });\r\n  },\r\n\r\n  compress : function (uncompressed) {\r\n    return this._compress(uncompressed, 16, function (a) {\r\n      return f(a);\r\n    });\r\n  },\r\n\r\n  _compress: function (uncompressed, bitsPerChar, getCharFromInt) {\r\n    uncompressed = getInput(uncompressed);\r\n\r\n    if (uncompressed === null) return \"\";\r\n    let i, value, context_dictionary = {}, context_dictionaryToCreate = {}, context_c = \"\", context_wc = \"\",\r\n        context_w                                                                                      = \"\", context_enlargeIn = 2, // Compensate for the first entry which should not count\r\n        context_dictSize                                                                               = 3, context_numBits = 2, context_data                                        = [], context_data_val = 0,\r\n        context_data_position                                                                          = 0, ii;\r\n\r\n    for (ii = 0; ii < uncompressed.length; ii += 1) {\r\n      context_c = uncompressed.charAt(ii);\r\n      if (!Object.prototype.hasOwnProperty.call(context_dictionary, context_c)) {\r\n        context_dictionary[context_c] = context_dictSize++;\r\n        context_dictionaryToCreate[context_c] = true;\r\n      }\r\n\r\n      context_wc = context_w + context_c;\r\n      if (Object.prototype.hasOwnProperty.call(context_dictionary, context_wc)) {\r\n        context_w = context_wc;\r\n      } else {\r\n        if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate, context_w)) {\r\n          if (context_w.charCodeAt(0) < 256) {\r\n            for (i = 0; i < context_numBits; i++) {\r\n              context_data_val = (context_data_val<<1);\r\n              if (context_data_position === bitsPerChar - 1) {\r\n                context_data_position = 0;\r\n                context_data.push(getCharFromInt(context_data_val));\r\n                context_data_val = 0;\r\n              } else {\r\n                context_data_position++;\r\n              }\r\n            }\r\n            value = context_w.charCodeAt(0);\r\n            for (i = 0; i < 8; i++) {\r\n              context_data_val = (context_data_val<<1) | (value & 1);\r\n              if (context_data_position === bitsPerChar - 1) {\r\n                context_data_position = 0;\r\n                context_data.push(getCharFromInt(context_data_val));\r\n                context_data_val = 0;\r\n              } else {\r\n                context_data_position++;\r\n              }\r\n              value = value>>1;\r\n            }\r\n          } else {\r\n            value = 1;\r\n            for (i = 0; i < context_numBits; i++) {\r\n              context_data_val = (context_data_val<<1) | value;\r\n              if (context_data_position == bitsPerChar - 1) {\r\n                context_data_position = 0;\r\n                context_data.push(getCharFromInt(context_data_val));\r\n                context_data_val = 0;\r\n              } else {\r\n                context_data_position++;\r\n              }\r\n              value = 0;\r\n            }\r\n            value = context_w.charCodeAt(0);\r\n            for (i = 0; i < 16; i++) {\r\n              context_data_val = (context_data_val<<1) | (value & 1);\r\n              if (context_data_position === bitsPerChar - 1) {\r\n                context_data_position = 0;\r\n                context_data.push(getCharFromInt(context_data_val));\r\n                context_data_val = 0;\r\n              } else {\r\n                context_data_position++;\r\n              }\r\n              value = value>>1;\r\n            }\r\n          }\r\n          context_enlargeIn--;\r\n          if (context_enlargeIn === 0) {\r\n            context_enlargeIn = Math.pow(2, context_numBits);\r\n            context_numBits++;\r\n          }\r\n          delete context_dictionaryToCreate[context_w];\r\n        } else {\r\n          value = context_dictionary[context_w];\r\n          for (i = 0; i < context_numBits; i++) {\r\n            context_data_val = (context_data_val<<1) | (value & 1);\r\n            if (context_data_position === bitsPerChar - 1) {\r\n              context_data_position = 0;\r\n              context_data.push(getCharFromInt(context_data_val));\r\n              context_data_val = 0;\r\n            } else {\r\n              context_data_position++;\r\n            }\r\n            value = value>>1;\r\n          }\r\n\r\n\r\n        }\r\n        context_enlargeIn--;\r\n        if (context_enlargeIn === 0) {\r\n          context_enlargeIn = Math.pow(2, context_numBits);\r\n          context_numBits++;\r\n        }\r\n        // Add wc to the dictionary.\r\n        context_dictionary[context_wc] = context_dictSize++;\r\n        context_w = String(context_c);\r\n      }\r\n    }\r\n\r\n    // Output the code for w.\r\n    if (context_w !== \"\") {\r\n      if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate, context_w)) {\r\n        if (context_w.charCodeAt(0) < 256) {\r\n          for (i = 0; i < context_numBits; i++) {\r\n            context_data_val = (context_data_val<<1);\r\n            if (context_data_position === bitsPerChar - 1) {\r\n              context_data_position = 0;\r\n              context_data.push(getCharFromInt(context_data_val));\r\n              context_data_val = 0;\r\n            } else {\r\n              context_data_position++;\r\n            }\r\n          }\r\n          value = context_w.charCodeAt(0);\r\n          for (i = 0; i < 8; i++) {\r\n            context_data_val = (context_data_val<<1) | (value & 1);\r\n            if (context_data_position === bitsPerChar - 1) {\r\n              context_data_position = 0;\r\n              context_data.push(getCharFromInt(context_data_val));\r\n              context_data_val = 0;\r\n            } else {\r\n              context_data_position++;\r\n            }\r\n            value = value>>1;\r\n          }\r\n        } else {\r\n          value = 1;\r\n          for (i = 0; i < context_numBits; i++) {\r\n            context_data_val = (context_data_val<<1) | value;\r\n            if (context_data_position === bitsPerChar - 1) {\r\n              context_data_position = 0;\r\n              context_data.push(getCharFromInt(context_data_val));\r\n              context_data_val = 0;\r\n            } else {\r\n              context_data_position++;\r\n            }\r\n            value = 0;\r\n          }\r\n          value = context_w.charCodeAt(0);\r\n          for (i = 0; i < 16; i++) {\r\n            context_data_val = (context_data_val<<1) | (value & 1);\r\n            if (context_data_position === bitsPerChar - 1) {\r\n              context_data_position = 0;\r\n              context_data.push(getCharFromInt(context_data_val));\r\n              context_data_val = 0;\r\n            } else {\r\n              context_data_position++;\r\n            }\r\n            value = value>>1;\r\n          }\r\n        }\r\n        context_enlargeIn--;\r\n        if (context_enlargeIn === 0) {\r\n          context_enlargeIn = Math.pow(2, context_numBits);\r\n          context_numBits++;\r\n        }\r\n        delete context_dictionaryToCreate[context_w];\r\n      } else {\r\n        value = context_dictionary[context_w];\r\n        for (i = 0; i < context_numBits; i++) {\r\n          context_data_val = (context_data_val<<1) | (value & 1);\r\n          if (context_data_position === bitsPerChar - 1) {\r\n            context_data_position = 0;\r\n            context_data.push(getCharFromInt(context_data_val));\r\n            context_data_val = 0;\r\n          } else {\r\n            context_data_position++;\r\n          }\r\n          value = value>>1;\r\n        }\r\n\r\n\r\n      }\r\n      context_enlargeIn--;\r\n      if (context_enlargeIn === 0) {\r\n        context_enlargeIn = Math.pow(2, context_numBits);\r\n        context_numBits++;\r\n      }\r\n    }\r\n\r\n    // Mark the end of the stream\r\n    value = 2;\r\n    for (i = 0; i < context_numBits; i++) {\r\n      context_data_val = (context_data_val<<1) | (value & 1);\r\n      if (context_data_position === bitsPerChar - 1) {\r\n        context_data_position = 0;\r\n        context_data.push(getCharFromInt(context_data_val));\r\n        context_data_val = 0;\r\n      } else {\r\n        context_data_position++;\r\n      }\r\n      value = value>>1;\r\n    }\r\n\r\n    // Flush the last char\r\n    while (true) {\r\n      context_data_val = (context_data_val<<1);\r\n      if (context_data_position === bitsPerChar - 1) {\r\n        context_data.push(getCharFromInt(context_data_val));\r\n        break;\r\n      } else context_data_position++;\r\n    }\r\n    return context_data.join('');\r\n  },\r\n\r\n  decompress: function (compressed) {\r\n    if (compressed === null) return \"\";\r\n    if (compressed === \"\") return null;\r\n\r\n    compressed = getInput(compressed);\r\n\r\n    return this._decompress(compressed.length, 32768, function (index) {\r\n      return compressed.charCodeAt(index);\r\n    });\r\n  },\r\n\r\n  _decompress: function (length, resetValue, getNextValue) {\r\n    let dictionary = [], next, enlargeIn = 4, dictSize = 4, numBits = 3, entry = \"\", result = [], i, w,\r\n        bits, resb,\r\n        maxpower, power, c, data                                                            = {val: getNextValue(0), position: resetValue, index: 1};\r\n\r\n    for (i = 0; i < 3; i += 1) {\r\n      dictionary[i] = i;\r\n    }\r\n\r\n    bits = 0;\r\n    maxpower = Math.pow(2, 2);\r\n    power = 1;\r\n    while (power !== maxpower) {\r\n      resb = data.val & data.position;\r\n      data.position >>= 1;\r\n      if (data.position === 0) {\r\n        data.position = resetValue;\r\n        data.val = getNextValue(data.index++);\r\n      }\r\n      bits |= (resb > 0 ? 1 : 0)*power;\r\n      power <<= 1;\r\n    }\r\n\r\n    switch (next = bits) {\r\n      case 0:\r\n        bits = 0;\r\n        maxpower = Math.pow(2, 8);\r\n        power = 1;\r\n        while (power !== maxpower) {\r\n          resb = data.val & data.position;\r\n          data.position >>= 1;\r\n          if (data.position === 0) {\r\n            data.position = resetValue;\r\n            data.val = getNextValue(data.index++);\r\n          }\r\n          bits |= (resb > 0 ? 1 : 0)*power;\r\n          power <<= 1;\r\n        }\r\n        c = f(bits);\r\n        break;\r\n      case 1:\r\n        bits = 0;\r\n        maxpower = Math.pow(2, 16);\r\n        power = 1;\r\n        while (power !== maxpower) {\r\n          resb = data.val & data.position;\r\n          data.position >>= 1;\r\n          if (data.position === 0) {\r\n            data.position = resetValue;\r\n            data.val = getNextValue(data.index++);\r\n          }\r\n          bits |= (resb > 0 ? 1 : 0)*power;\r\n          power <<= 1;\r\n        }\r\n        c = f(bits);\r\n        break;\r\n      case 2:\r\n        return \"\";\r\n    }\r\n    dictionary[3] = c;\r\n    w = c;\r\n    result.push(c);\r\n    while (true) {\r\n      if (data.index > length) {\r\n        return \"\";\r\n      }\r\n\r\n      bits = 0;\r\n      maxpower = Math.pow(2, numBits);\r\n      power = 1;\r\n      while (power !== maxpower) {\r\n        resb = data.val & data.position;\r\n        data.position >>= 1;\r\n        if (data.position === 0) {\r\n          data.position = resetValue;\r\n          data.val = getNextValue(data.index++);\r\n        }\r\n        bits |= (resb > 0 ? 1 : 0)*power;\r\n        power <<= 1;\r\n      }\r\n\r\n      switch (c = bits) {\r\n        case 0:\r\n          bits = 0;\r\n          maxpower = Math.pow(2, 8);\r\n          power = 1;\r\n          while (power !== maxpower) {\r\n            resb = data.val & data.position;\r\n            data.position >>= 1;\r\n            if (data.position === 0) {\r\n              data.position = resetValue;\r\n              data.val = getNextValue(data.index++);\r\n            }\r\n            bits |= (resb > 0 ? 1 : 0)*power;\r\n            power <<= 1;\r\n          }\r\n\r\n          dictionary[dictSize++] = f(bits);\r\n          c = dictSize - 1;\r\n          enlargeIn--;\r\n          break;\r\n        case 1:\r\n          bits = 0;\r\n          maxpower = Math.pow(2, 16);\r\n          power = 1;\r\n          while (power !== maxpower) {\r\n            resb = data.val & data.position;\r\n            data.position >>= 1;\r\n            if (data.position === 0) {\r\n              data.position = resetValue;\r\n              data.val = getNextValue(data.index++);\r\n            }\r\n            bits |= (resb > 0 ? 1 : 0)*power;\r\n            power <<= 1;\r\n          }\r\n          dictionary[dictSize++] = f(bits);\r\n          c = dictSize - 1;\r\n          enlargeIn--;\r\n          break;\r\n        case 2:\r\n          return result.join('');\r\n      }\r\n\r\n      if (enlargeIn === 0) {\r\n        enlargeIn = Math.pow(2, numBits);\r\n        numBits++;\r\n      }\r\n\r\n      if (dictionary[c]) {\r\n        entry = dictionary[c];\r\n      } else {\r\n        if (c === dictSize) {\r\n          entry = w + w.charAt(0);\r\n        } else {\r\n          return null;\r\n        }\r\n      }\r\n      result.push(entry);\r\n\r\n      // Add w+entry[0] to the dictionary.\r\n      dictionary[dictSize++] = w + entry.charAt(0);\r\n      enlargeIn--;\r\n\r\n      w = entry;\r\n\r\n      if (enlargeIn === 0) {\r\n        enlargeIn = Math.pow(2, numBits);\r\n        numBits++;\r\n      }\r\n\r\n    }\r\n  }\r\n};\r\n","import './polyfill.js';\r\nimport './struct.js';\r\nimport './mobile-detect.cjs';\r\nimport nstructjs from './struct.js';\r\n\r\nlet f64tmp = new Float64Array(1);\r\nlet u16tmp = new Uint16Array(f64tmp.buffer);\r\n\r\nexport function isDenormal(f) {\r\n  f64tmp[0] = f;\r\n\r\n  let a = u16tmp[0], b = u16tmp[1], c = u16tmp[2], d = u16tmp[3];\r\n\r\n  //zero? check both positive and negative zero\r\n  if (a === 0 && b === 0 && c === 0 && (d === 0 || d === 32768)) {\r\n    return false;\r\n  }\r\n\r\n  let test = d & ~(1<<15);\r\n  test = test>>4;\r\n\r\n  //window.console.log(u16tmp[0], u16tmp[1], u16tmp[2], u16tmp[3], \"|\", test);\r\n\r\n  return test === 0;\r\n}\r\n\r\nglobalThis._isDenormal = isDenormal;\r\n\r\n\r\nlet colormap = {\r\n  \"black\"   : 30,\r\n  \"red\"     : 31,\r\n  \"green\"   : 32,\r\n  \"yellow\"  : 33,\r\n  \"blue\"    : 34,\r\n  \"magenta\" : 35,\r\n  \"cyan\"    : 36,\r\n  \"teal\"    : 36,\r\n  \"white\"   : 37,\r\n  \"reset\"   : 0,\r\n  \"grey\"    : 2,\r\n  \"gray\"    : 2,\r\n  \"orange\"  : 202,\r\n  \"pink\"    : 198,\r\n  \"brown\"   : 314,\r\n  \"lightred\": 91,\r\n  \"peach\"   : 210\r\n}\r\n\r\nexport let termColorMap = {};\r\nfor (let k in colormap) {\r\n  termColorMap[k] = colormap[k];\r\n  termColorMap[colormap[k]] = k;\r\n}\r\n\r\nexport function termColor(s, c, d = 0) {\r\n  if (typeof s === \"symbol\") {\r\n    s = s.toString();\r\n  } else {\r\n    s = \"\" + s;\r\n  }\r\n\r\n  if (c in colormap)\r\n    c = colormap[c]\r\n\r\n  if (c > 107) {\r\n    let s2 = '\\u001b[38;5;' + c + \"m\"\r\n    return s2 + s + '\\u001b[39m'\r\n  }\r\n\r\n  return '\\u001b[' + c + 'm' + s + '\\u001b[39m';\r\n};\r\n\r\nexport function termPrint() {\r\n  //let console = window.console;\r\n\r\n  let s = '';\r\n  for (let i = 0; i < arguments.length; i++) {\r\n    if (i > 0) {\r\n      s += ' ';\r\n    }\r\n    s += arguments[i];\r\n  }\r\n\r\n  let re1a = /\\u001b\\[[1-9][0-9]?m/;\r\n  let re1b = /\\u001b\\[[1-9][0-9];[0-9][0-9]?;[0-9]+m/\r\n  let re2 = /\\u001b\\[39m/;\r\n\r\n  let endtag = '\\u001b[39m';\r\n\r\n  function tok(s, type) {\r\n    return {\r\n      type : type,\r\n      value: s\r\n    }\r\n  }\r\n\r\n  let tokdef = [\r\n    [re1a, \"start\"],\r\n    [re1b, \"start\"],\r\n    [re2, \"end\"]\r\n  ];\r\n\r\n  let s2 = s;\r\n\r\n  let i = 0;\r\n  let tokens = [];\r\n\r\n  while (s2.length > 0) {\r\n    let ok = false;\r\n\r\n    let mintk = undefined, mini = undefined;\r\n    let minslice = undefined, mintype = undefined;\r\n\r\n    for (let tk of tokdef) {\r\n      let i = s2.search(tk[0]);\r\n\r\n      if (i >= 0 && (mini === undefined || i < mini)) {\r\n        minslice = s2.slice(i, s2.length).match(tk[0])[0];\r\n        mini = i;\r\n        mintype = tk[1];\r\n        mintk = tk;\r\n        ok = true;\r\n      }\r\n    }\r\n\r\n    if (!ok) {\r\n      break;\r\n    }\r\n\r\n    if (mini > 0) {\r\n      let chunk = s2.slice(0, mini);\r\n      tokens.push(tok(chunk, \"chunk\"));\r\n    }\r\n\r\n    s2 = s2.slice(mini + minslice.length, s2.length);\r\n    let t = tok(minslice, mintype);\r\n\r\n    tokens.push(t);\r\n  }\r\n\r\n  if (s2.length > 0) {\r\n    tokens.push(tok(s2, \"chunk\"));\r\n  }\r\n\r\n  let stack = [];\r\n  let cur;\r\n\r\n  let out = '';\r\n\r\n  for (let t of tokens) {\r\n    if (t.type === \"chunk\") {\r\n      out += t.value;\r\n    } else if (t.type === \"start\") {\r\n      stack.push(cur);\r\n      cur = t.value;\r\n\r\n      out += t.value;\r\n    } else if (t.type === \"end\") {\r\n      cur = stack.pop();\r\n      if (cur) {\r\n        out += cur;\r\n      } else {\r\n        out += endtag;\r\n      }\r\n    }\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\nglobalThis.termColor = termColor;\r\n\r\nexport class MovingAvg extends Array {\r\n  constructor(size = 64) {\r\n    super();\r\n\r\n    this.length = size;\r\n    this.cur = 0;\r\n    this.used = 0;\r\n    this.sum = 0;\r\n  }\r\n\r\n  reset() {\r\n    this.cur = this.used = this.sum = 0.0;\r\n\r\n    return this;\r\n  }\r\n\r\n  add(val) {\r\n    if (this.used < this.length) {\r\n      this[this.cur] = val;\r\n      this.used++;\r\n    } else {\r\n      this.sum -= this[this.cur];\r\n      this[this.cur] = val;\r\n    }\r\n\r\n    this.sum += val;\r\n    this.cur = (this.cur + 1)%this.length;\r\n\r\n    return this.sample();\r\n  }\r\n\r\n  sample() {\r\n    return this.used ? this.sum/this.used : 0.0;\r\n  }\r\n}\r\n\r\nexport let timers = {};\r\n\r\nexport function pollTimer(id, interval) {\r\n  if (!(id in timers)) {\r\n    timers[id] = time_ms();\r\n  }\r\n\r\n  if (time_ms() - timers[id] >= interval) {\r\n    timers[id] = time_ms();\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nlet mdetect = undefined;\r\nlet mret = undefined;\r\n\r\nexport function isMobile() {\r\n  if (!window.MobileDetect) {\r\n    return;\r\n  }\r\n\r\n  if (mret === undefined) {\r\n    mdetect = new MobileDetect(navigator.userAgent);\r\n    let ret = mdetect.mobile();\r\n\r\n    if (typeof ret === \"string\") {\r\n      ret = ret.toLowerCase();\r\n    }\r\n\r\n    mret = ret;\r\n  }\r\n\r\n  return mret;\r\n}\r\n\r\nexport class SmartConsoleContext {\r\n  constructor(name, console) {\r\n    this.name = name;\r\n\r\n    let c = [random(), random(), random()];\r\n    let sum = Math.sqrt(c[0]*c[0] + c[1]*c[1] + c[2]*c[2]);\r\n    sum = 255/sum;\r\n\r\n    let r = ~~(c[0]*sum);\r\n    let g = ~~(c[1]*sum);\r\n    let b = ~~(c[2]*sum);\r\n\r\n    this.color = `rgb(${r},${g},${b})`;\r\n    this.__console = console;\r\n\r\n    //minimum time between prints of same message\r\n    this.timeInterval = 375;\r\n\r\n    //minimum time in general\r\n    this.timeIntervalAll = 245;\r\n\r\n    this._last = 0;\r\n    this.last = 0;\r\n    this.last2 = 0;\r\n    this._data = {};\r\n    this._data_length = 0;\r\n    this.maxCache = 256;\r\n  }\r\n\r\n\r\n  hash(args) {\r\n    let sum = 0;\r\n    let mul = (1<<19) - 1, off = (1<<27) - 1;\r\n    let i = 0;\r\n\r\n    function dohash(h) {\r\n      h = (h*mul + off + i*mul*0.25) & mul;\r\n\r\n      i++;\r\n      sum = sum ^ h;\r\n    }\r\n\r\n    let visit = new WeakSet();\r\n\r\n    let recurse = (n) => {\r\n      if (typeof n === \"string\") {\r\n        dohash(strhash(n));\r\n      } else if (typeof n === \"undefined\" || n === null) {\r\n        dohash(0);\r\n      } else if (typeof n === \"object\") {\r\n        if (visit.has(n)) {\r\n          return;\r\n        }\r\n\r\n        visit.add(n);\r\n\r\n        let keys = getAllKeys(n);\r\n\r\n        for (let k of keys) {\r\n          let v;\r\n\r\n          if (typeof k !== \"string\") {\r\n            continue;\r\n          }\r\n\r\n          try {\r\n            v = n[k];\r\n          } catch (error) {\r\n            continue;\r\n          }\r\n\r\n          recurse(v);\r\n        }\r\n      } else if (typeof n === \"function\") {\r\n        dohash(strhash(\"\" + n.name));\r\n      }\r\n    };\r\n\r\n    //let str = \"\";\r\n\r\n    for (let i = 0; i < args.length; i++) {\r\n      recurse(args[i]);\r\n      //str += args[i] + \" \";\r\n    }\r\n\r\n    //window.console.log(\"HASH\", sum, str);\r\n    return sum;\r\n  }\r\n\r\n  clearCache() {\r\n    this._data_length = 0;\r\n    this._data = {};\r\n    return this;\r\n  }\r\n\r\n  _getData(args) {\r\n    let key = this.hash(args);\r\n\r\n    if (!(key in this._data)) {\r\n      if (this._data_length > this.maxCache) {\r\n        this.clearCache();\r\n      }\r\n\r\n      this._data[key] = {\r\n        time : 0,\r\n        count: 0\r\n      };\r\n\r\n      this._data_length++;\r\n    }\r\n\r\n    return this._data[key];\r\n  }\r\n\r\n  _check(args) {\r\n    if (this.timeIntervalAll > 0 && time_ms() - this.last2 < this.timeIntervalAll) {\r\n      return false;\r\n    }\r\n\r\n    this.last2 = time_ms();\r\n\r\n    return true;\r\n    /*\r\n    this.last2 = time_ms();\r\n\r\n    let d = this._getData(args);\r\n    let last = this.last;\r\n\r\n    this.last = d;\r\n\r\n    if (d !== last) {\r\n      d.count = 0;\r\n      d.time = time_ms();\r\n      return true;\r\n    }\r\n\r\n    if (time_ms() - d.time > this.timeInterval) {\r\n      d.time = time_ms();\r\n      return true;\r\n    }\r\n\r\n    return false;*/\r\n  }\r\n\r\n  log() {\r\n    if (this._check(arguments)) {\r\n      window.console.log(\"%c\", \"color:\" + this.color, ...arguments);\r\n    }\r\n  }\r\n\r\n  warn() {\r\n    if (this._check(arguments)) {\r\n      window.console.log(\"%c\" + this.name, \"color : \" + this.color, ...arguments);\r\n    }\r\n  }\r\n\r\n  trace() {\r\n    if (this._check(arguments)) {\r\n      window.console.trace(...arguments);\r\n    }\r\n  }\r\n\r\n  error() {\r\n    if (this._check(arguments)) {\r\n      window.console.error(...arguments);\r\n    }\r\n  }\r\n}\r\n\r\nexport class SmartConsole {\r\n  constructor() {\r\n    this.contexts = {};\r\n  }\r\n\r\n  context(name) {\r\n    if (!(name in this.contexts)) {\r\n      this.contexts[name] = new SmartConsoleContext(name, this);\r\n    }\r\n\r\n    return this.contexts[name];\r\n  }\r\n\r\n  log() {\r\n    let c = this.context(\"default\");\r\n    return c.log(...arguments);\r\n  }\r\n\r\n  warn() {\r\n    let c = this.context(\"default\");\r\n    return c.warn(...arguments);\r\n  }\r\n\r\n  trace() {\r\n    let c = this.context(\"default\");\r\n    return c.trace(...arguments);\r\n  }\r\n\r\n  error() {\r\n    let c = this.context(\"default\");\r\n    return c.error(...arguments);\r\n  }\r\n}\r\n\r\nexport const console = new SmartConsole();\r\n\r\nglobalThis.tm = 0.0;\r\n\r\nlet EmptySlot = {};\r\n\r\nexport function getClassParent(cls) {\r\n  let p = cls.prototype;\r\n\r\n  if (p) p = p.__proto__;\r\n  if (p) p = p.constructor\r\n  ;\r\n  return p;\r\n}\r\n\r\n//make global for debugging purposes in console\r\n//window._getClassParent = getClassParent;\r\n\r\nexport function list(iterable) {\r\n  let ret = [];\r\n\r\n  for (let item of iterable) {\r\n    ret.push(item);\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n\r\n/** Count items in list; if searchItem is not undefined then a count\r\n *  of the number of times searchItem occurs will be returned.*/\r\nexport function count(iterable, searchItem = undefined) {\r\n  let count = 0;\r\n\r\n  if (searchItem !== undefined) {\r\n    for (let item of iterable) {\r\n      if (item === searchItem) {\r\n        count++;\r\n      }\r\n    }\r\n  } else {\r\n    for (let item of iterable) {\r\n      count++;\r\n    }\r\n  }\r\n\r\n  return count;\r\n}\r\n\r\n/*\r\n* returns all object keys, including\r\n* inherited ones\r\n* */\r\nexport function getAllKeys(obj) {\r\n  let keys = new Set();\r\n\r\n  if (typeof obj !== \"object\" && typeof obj !== \"function\") {\r\n    throw new Error(\"must pass an object ot getAllKeys; object was: \" + obj);\r\n  }\r\n\r\n  let p;\r\n\r\n  while (p && p !== Object) {\r\n    for (let k in Object.getOwnPropertyDescriptors(obj)) {\r\n      if (k === \"__proto__\")\r\n        continue;\r\n\r\n      keys.add(k);\r\n    }\r\n\r\n    for (let k of Object.getOwnPropertySymbols(obj)) {\r\n      keys.add(k);\r\n    }\r\n\r\n    p = p.__proto__;\r\n  }\r\n\r\n  let cls = obj.constructor;\r\n  if (!cls)\r\n    return keys;\r\n\r\n  while (cls) {\r\n    let proto = cls.prototype;\r\n    if (!proto) {\r\n      cls = getClassParent(cls);\r\n      continue;\r\n    }\r\n\r\n    for (let k in proto) {\r\n      keys.add(k);\r\n    }\r\n\r\n    for (let k in Object.getOwnPropertyDescriptors(proto)) {\r\n      keys.add(k);\r\n    }\r\n\r\n    cls = getClassParent(cls);\r\n  }\r\n\r\n  return keys;\r\n}\r\n\r\n//globalThis._getAllKeys = getAllKeys;\r\n\r\nexport function btoa(buf) {\r\n  if (buf instanceof ArrayBuffer) {\r\n    buf = new Uint8Array(buf);\r\n  }\r\n\r\n  if (typeof buf === \"string\" || buf instanceof String) {\r\n    return window.btoa(buf);\r\n  }\r\n\r\n  let ret = \"\";\r\n  for (let i = 0; i < buf.length; i++) {\r\n    ret += String.fromCharCode(buf[i]);\r\n  }\r\n\r\n  return btoa(ret);\r\n};\r\n\r\nexport function formatNumberUI(val, isInt = false, decimals = 5) {\r\n  if (val === undefined || val === null) {\r\n    val = \"0\";\r\n  } else if (isNaN(val)) {\r\n    val = \"NaN\";\r\n  } else if (val === -Infinity) {\r\n    val = \"-\" + String.fromCharCode(0x221E);\r\n  } else if (val === Infinity) {\r\n    val = \"+\" + String.fromCharCode(0x221E);\r\n  } else if (!isInt) {\r\n    val = val.toFixed(decimals);\r\n  } else {\r\n    val = \"\" + Math.floor(val);\r\n  }\r\n\r\n  return val;\r\n}\r\n\r\n//window.formatNumberUI = formatNumberUI;\r\n\r\nexport function atob(buf) {\r\n  let data = window.atob(buf);\r\n  let ret = [];\r\n\r\n  for (let i = 0; i < data.length; i++) {\r\n    ret.push(data.charCodeAt(i));\r\n  }\r\n\r\n  return new Uint8Array(ret);\r\n}\r\n\r\nexport function time_ms() {\r\n  if (window.performance)\r\n    return window.performance.now();\r\n  else\r\n    return new Date().getMilliseconds();\r\n}\r\n\r\nexport function color2css(c) {\r\n  let ret = c.length === 3 ? \"rgb(\" : \"rgba(\";\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    if (i > 0)\r\n      ret += \",\";\r\n\r\n    ret += ~~(c[i]*255);\r\n  }\r\n\r\n  if (c.length === 4)\r\n    ret += \",\" + c[3];\r\n  ret += \")\";\r\n\r\n  return ret;\r\n}\r\n\r\nexport function merge(obja, objb) {\r\n  return Object.assign({}, obja, objb);\r\n  /*\r\n  let ret = {};\r\n\r\n  for (let k in obja) {\r\n    ret[k] = obja[k];\r\n  }\r\n\r\n  for (let k in objb) {\r\n    ret[k] = objb[k];\r\n  }\r\n\r\n  return ret;\r\n  //*/\r\n};\r\n\r\nconst debug_cacherings = false;\r\n\r\nif (debug_cacherings) {\r\n  window._cacherings = [];\r\n\r\n  window._clear_all_cacherings = function (kill_all = false) {\r\n    function copy(obj) {\r\n      if (typeof obj.copy === \"function\") {\r\n        return obj.copy();\r\n      } else if (obj.constructor === Object) {\r\n        let ret = {};\r\n\r\n        for (let k of Reflect.ownKeys(obj)) {\r\n          let v;\r\n\r\n          try {\r\n            v = obj[k];\r\n          } catch (error) {\r\n            continue;\r\n          }\r\n\r\n          if (typeof v !== \"object\") {\r\n            ret[k] = v;\r\n          } else {\r\n            ret[k] = copy(v);\r\n          }\r\n        }\r\n\r\n        return ret;\r\n      } else {\r\n        return new obj.constructor();\r\n      }\r\n    }\r\n\r\n    for (let ch of window._cacherings) {\r\n      let obj = ch[0];\r\n      let len = ch.length;\r\n\r\n      ch.length = 0;\r\n      ch.cur = 0;\r\n\r\n      if (kill_all) {\r\n        continue;\r\n      }\r\n\r\n      for (let i = 0; i < len; i++) {\r\n        ch.push(copy(obj));\r\n      }\r\n    }\r\n  }\r\n\r\n  window._nonvector_cacherings = function () {\r\n    for (let ch of window._cacherings) {\r\n      if (ch.length === 0) {\r\n        continue;\r\n      }\r\n\r\n      let name = ch[0].constructor.name;\r\n      let ok = !name.startsWith(\"Vector\") && !name.startsWith(\"Quat\");\r\n      ok = ok && !name.startsWith(\"TriEditor\");\r\n      ok = ok && !name.startsWith(\"QuadEditor\");\r\n      ok = ok && !name.startsWith(\"PointEditor\");\r\n      ok = ok && !name.startsWith(\"LineEditor\");\r\n\r\n      if (ok) {\r\n        console.log(name, ch);\r\n      }\r\n    }\r\n  }\r\n\r\n  window._stale_cacherings = function () {\r\n    let ret = _cacherings.concat([]);\r\n\r\n    ret.sort((a, b) => a.gen - b.gen);\r\n    return ret;\r\n  }\r\n}\r\n\r\nexport class cachering extends Array {\r\n  constructor(func, size, isprivate = false) {\r\n    super()\r\n\r\n    this.private = isprivate;\r\n    this.cur = 0;\r\n\r\n    if (!isprivate && debug_cacherings) {\r\n      this.gen = 0;\r\n      window._cacherings.push(this);\r\n    }\r\n\r\n    for (let i = 0; i < size; i++) {\r\n      this.push(func());\r\n    }\r\n  }\r\n\r\n  static fromConstructor(cls, size, isprivate = false) {\r\n    let func = function () {\r\n      return new cls();\r\n    }\r\n\r\n    return new cachering(func, size, isprivate);\r\n  }\r\n\r\n  next() {\r\n    if (debug_cacherings) {\r\n      this.gen++;\r\n    }\r\n\r\n    let ret = this[this.cur];\r\n    this.cur = (this.cur + 1)%this.length;\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nexport class SetIter {\r\n  constructor(set) {\r\n    this.set = set;\r\n    this.i = 0;\r\n    this.ret = {done: false, value: undefined};\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return this;\r\n  }\r\n\r\n  next() {\r\n    let ret = this.ret;\r\n\r\n    while (this.i < this.set.items.length && this.set.items[this.i] === EmptySlot) {\r\n      this.i++;\r\n    }\r\n\r\n    if (this.i >= this.set.items.length) {\r\n      ret.done = true;\r\n      ret.value = undefined;\r\n\r\n      return ret;\r\n    }\r\n\r\n\r\n    ret.value = this.set.items[this.i++];\r\n    return ret;\r\n  }\r\n}\r\n\r\n/**\r\n Set\r\n\r\n Stores objects in a set; each object is converted to a value via\r\n a [Symbol.keystr] method, and if that value already exists in the set\r\n then the object is not added.\r\n\r\n\r\n * */\r\nexport class set {\r\n  constructor(input) {\r\n    this.items = [];\r\n    this.keys = {};\r\n    this.freelist = [];\r\n\r\n    this.length = 0;\r\n\r\n    if (typeof input === \"string\") {\r\n      input = new String(input);\r\n    }\r\n\r\n    if (input !== undefined) {\r\n      if (Symbol.iterator in input) {\r\n        for (let item of input) {\r\n          this.add(item);\r\n        }\r\n      } else if (\"forEach\" in input) {\r\n        input.forEach(function (item) {\r\n          this.add(item);\r\n        }, this);\r\n      } else if (input instanceof Array) {\r\n        for (let i = 0; i < input.length; i++) {\r\n          this.add(input[i]);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  get size() {\r\n    return this.length;\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return new SetIter(this);\r\n  }\r\n\r\n  equals(setb) {\r\n    for (let item of this) {\r\n      if (!setb.has(item)) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    for (let item of setb) {\r\n      if (!this.has(item)) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  clear() {\r\n    this.items.length = 0;\r\n    this.keys = {};\r\n    this.freelist.length = 0;\r\n    this.length = 0;\r\n\r\n    return this;\r\n  }\r\n\r\n  filter(f, thisvar) {\r\n    let i = 0;\r\n    let ret = new set();\r\n\r\n    for (let item of this) {\r\n      if (f.call(thisvar, item, i++, this)) {\r\n        ret.add(item);\r\n      }\r\n    }\r\n\r\n    return ret;\r\n\r\n  }\r\n\r\n  map(f, thisvar) {\r\n    let ret = new set();\r\n\r\n    let i = 0;\r\n\r\n    for (let item of this) {\r\n      ret.add(f.call(thisvar, item, i++, this));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  reduce(f, initial) {\r\n    if (initial === undefined) {\r\n      for (let item of this) {\r\n        initial = item;\r\n        break;\r\n      }\r\n    }\r\n\r\n    let i = 0;\r\n    for (let item of this) {\r\n      initial = f(initial, item, i++, this);\r\n    }\r\n\r\n    return initial;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new set();\r\n    for (let item of this) {\r\n      ret.add(item);\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  add(item) {\r\n    let key = item[Symbol.keystr]();\r\n\r\n    if (key in this.keys) return;\r\n\r\n    if (this.freelist.length > 0) {\r\n      let i = this.freelist.pop();\r\n\r\n      this.keys[key] = i;\r\n      this.items[i] = item;\r\n    } else {\r\n      let i = this.items.length;\r\n\r\n      this.keys[key] = i;\r\n      this.items.push(item);\r\n    }\r\n\r\n    this.length++;\r\n  }\r\n\r\n  delete(item, ignore_existence = true) {\r\n    this.remove(item, ignore_existence);\r\n  }\r\n\r\n  remove(item, ignore_existence) {\r\n    let key = item[Symbol.keystr]();\r\n\r\n    if (!(key in this.keys)) {\r\n      if (!ignore_existence) {\r\n        console.warn(\"Warning, item\", item, \"is not in set\");\r\n      }\r\n      return;\r\n    }\r\n\r\n    let i = this.keys[key];\r\n    this.freelist.push(i);\r\n    this.items[i] = EmptySlot;\r\n\r\n    delete this.keys[key];\r\n\r\n    this.length--;\r\n  }\r\n\r\n  has(item) {\r\n    return item[Symbol.keystr]() in this.keys;\r\n  }\r\n\r\n  forEach(func, thisvar) {\r\n    for (let i = 0; i < this.items.length; i++) {\r\n      let item = this.items[i];\r\n\r\n      if (item === EmptySlot)\r\n        continue;\r\n\r\n      thisvar !== undefined ? func.call(thisvar, item) : func(item);\r\n    }\r\n  }\r\n}\r\n\r\nexport class HashIter {\r\n  constructor(hash) {\r\n    this.hash = hash;\r\n    this.i = 0;\r\n    this.ret = {done: false, value: undefined};\r\n  }\r\n\r\n  next() {\r\n    let items = this.hash._items;\r\n\r\n    if (this.i >= items.length) {\r\n      this.ret.done = true;\r\n      this.ret.value = undefined;\r\n\r\n      return this.ret;\r\n    }\r\n\r\n    do {\r\n      this.i += 2;\r\n    } while (this.i < items.length && items[i] === _hash_null);\r\n\r\n    return this.ret;\r\n  }\r\n}\r\n\r\nlet _hash_null = {};\r\n\r\nexport class hashtable {\r\n  constructor() {\r\n    this._items = [];\r\n    this._keys = {};\r\n    this.length = 0;\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return new HashIter(this);\r\n  }\r\n\r\n  set(key, val) {\r\n    let key2 = key[Symbol.keystr]();\r\n\r\n    let i;\r\n    if (!(key2 in this._keys)) {\r\n      i = this._items.length;\r\n\r\n      try {\r\n        this._items.push(0);\r\n        this._items.push(0);\r\n      } catch (error) {\r\n        console.log(\":::\", this._items.length, key, key2, val)\r\n        throw error;\r\n      }\r\n\r\n      this._keys[key2] = i;\r\n      this.length++;\r\n    } else {\r\n      i = this._keys[key2];\r\n    }\r\n\r\n    this._items[i] = key;\r\n    this._items[i + 1] = val;\r\n  }\r\n\r\n  remove(key) {\r\n    let key2 = key[Symbol.keystr]();\r\n\r\n    if (!(key2 in this._keys)) {\r\n      console.warn(\"Warning, key not in hashtable:\", key, key2);\r\n      return;\r\n    }\r\n\r\n    let i = this._keys[key2];\r\n\r\n    this._items[i] = _hash_null;\r\n    this._items[i + 1] = _hash_null;\r\n\r\n    delete this._keys[key2];\r\n    this.length--;\r\n  }\r\n\r\n  has(key) {\r\n    let key2 = key[Symbol.keystr]();\r\n\r\n    return key2 in this._keys;\r\n  }\r\n\r\n  get(key) {\r\n    let key2 = key[Symbol.keystr]();\r\n\r\n    if (!(key2 in this._keys)) {\r\n      console.warn(\"Warning, item not in hash\", key, key2);\r\n      return undefined;\r\n    }\r\n\r\n    return this._items[this._keys[key2] + 1];\r\n  }\r\n\r\n  add(key, val) {\r\n    return this.set(key, val);\r\n  }\r\n\r\n  keys() {\r\n    let ret = [];\r\n\r\n    for (let i = 0; i < this._items.length; i += 2) {\r\n      let key = this._items[i];\r\n\r\n      if (key !== _hash_null) {\r\n        ret.push(key);\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  values() {\r\n    let ret = [];\r\n\r\n    for (let i = 0; i < this._items.length; i += 2) {\r\n      let item = this._items[i + 1];\r\n\r\n      if (item !== _hash_null) {\r\n        ret.push(item);\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  forEach(cb, thisvar) {\r\n    if (thisvar === undefined)\r\n      thisvar = self;\r\n\r\n    for (let k in this._keys) {\r\n      let i = this._keys[k];\r\n\r\n      cb.call(thisvar, k, this._items[i]);\r\n    }\r\n  }\r\n}\r\n\r\nlet IDGenInternalIDGen = 0;\r\n\r\nexport class IDGen {\r\n  constructor() {\r\n    this.__cur = 1;\r\n\r\n    this._debug = false;\r\n    this._internalID = IDGenInternalIDGen++;\r\n  }\r\n\r\n  /*\r\n  get _cur() {\r\n    return this.__cur;\r\n  }\r\n\r\n  set _cur(v) {\r\n    if (this._debug && pollTimer(\"_idgen_debug\", 450)) {\r\n      window.console.warn(\"_cur access\", v);\r\n    }\r\n\r\n    this.__cur = v;\r\n  }\r\n\r\n  // */\r\n\r\n  get cur() {\r\n    return this.__cur;\r\n  }\r\n\r\n  set cur(v) {\r\n    if (isNaN(v) || !isFinite(v)) {\r\n      throw new Error(\"NaN error in util.IDGen\");\r\n    }\r\n\r\n    this.__cur = v;\r\n  }\r\n\r\n  get _cur() {\r\n    return this.cur;\r\n  }\r\n\r\n  set _cur(v) {\r\n    window.console.warn(\"Deprecated use of IDGen._cur\");\r\n    this.cur = v;\r\n  }\r\n\r\n  static fromJSON(obj) {\r\n    let ret = new IDGen();\r\n\r\n    ret.cur = obj.cur === undefined ? obj._cur : obj.cur;\r\n\r\n    return ret;\r\n  }\r\n\r\n  next() {\r\n    return this.cur++;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new IDGen();\r\n    ret.cur = this.cur;\r\n\r\n    return ret;\r\n  }\r\n\r\n  max_cur(id) {\r\n    this.cur = Math.max(this.cur, id + 1);\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      cur: this.cur\r\n    };\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n  }\r\n}\r\n\r\nIDGen.STRUCT = `\r\nIDGen {\r\n  cur : int;\r\n}\r\n`;\r\nnstructjs.register(IDGen);\r\n\r\n\r\nfunction get_callstack(err) {\r\n  return (\"\" + err.stack).split(\"\\n\");\r\n}\r\n\r\nexport function print_stack(err) {\r\n  if (!err) {\r\n    window.console.trace();\r\n  } else {\r\n    window.console.log(err.stack);\r\n  }\r\n}\r\n\r\n\r\nglobalThis.get_callstack = get_callstack;\r\nglobalThis.print_stack = print_stack;\r\n\r\nexport function fetch_file(path) {\r\n  let url = location.origin + \"/\" + path\r\n\r\n  let req = new XMLHttpRequest(\r\n  );\r\n\r\n  return new Promise(function (accept, reject) {\r\n    req.open(\"GET\", url)\r\n    req.onreadystatechange = function (e) {\r\n      if (req.status === 200 && req.readyState === 4) {\r\n        accept(req.response);\r\n      } else if (req.status >= 400) {\r\n        reject(req.status, req.statusText);\r\n      }\r\n    }\r\n    req.send();\r\n  });\r\n}\r\n\r\n//from:https://en.wikipedia.org/wiki/Mersenne_Twister\r\nfunction _int32(x) {\r\n  // Get the 31 least significant bits.\r\n  return ~~(((1<<30) - 1) & (~~x))\r\n}\r\n\r\nexport class MersenneRandom {\r\n  constructor(seed) {\r\n    // Initialize the index to 0\r\n    this.index = 624;\r\n    this.mt = new Uint32Array(624);\r\n\r\n    this.seed(seed);\r\n  }\r\n\r\n  random() {\r\n    return this.extract_number()/(1<<30);\r\n  }\r\n\r\n  /** normal-ish distribution */\r\n  nrandom(n = 3) {\r\n    let ret = 0.0;\r\n\r\n    for (let i = 0; i < n; i++) {\r\n      ret += this.random();\r\n    }\r\n\r\n    return ret/n;\r\n  }\r\n\r\n  seed(seed) {\r\n    seed = ~~(seed*8192);\r\n\r\n    // Initialize the index to 0\r\n    this.index = 624;\r\n    this.mt.fill(0, 0, this.mt.length);\r\n\r\n    this.mt[0] = seed;  // Initialize the initial state to the seed\r\n\r\n    for (let i = 1; i < 624; i++) {\r\n      this.mt[i] = _int32(\r\n        1812433253*(this.mt[i - 1] ^ this.mt[i - 1]>>30) + i);\r\n    }\r\n  }\r\n\r\n  extract_number() {\r\n    if (this.index >= 624)\r\n      this.twist();\r\n\r\n    let y = this.mt[this.index];\r\n\r\n    // Right shift by 11 bits\r\n    y = y ^ y>>11;\r\n    // Shift y left by 7 and take the bitwise and of 2636928640\r\n    y = y ^ y<<7 & 2636928640;\r\n    // Shift y left by 15 and take the bitwise and of y and 4022730752\r\n    y = y ^ y<<15 & 4022730752;\r\n    // Right shift by 18 bits\r\n    y = y ^ y>>18;\r\n\r\n    this.index = this.index + 1;\r\n\r\n    return _int32(y);\r\n  }\r\n\r\n  twist() {\r\n    for (let i = 0; i < 624; i++) {\r\n      // Get the most significant bit and add it to the less significant\r\n      // bits of the next number\r\n      let y = _int32((this.mt[i] & 0x80000000) +\r\n        (this.mt[(i + 1)%624] & 0x7fffffff));\r\n      this.mt[i] = this.mt[(i + 397)%624] ^ y>>1;\r\n\r\n      if (y%2 !== 0)\r\n        this.mt[i] = this.mt[i] ^ 0x9908b0df;\r\n    }\r\n\r\n    this.index = 0;\r\n  }\r\n}\r\n\r\nlet _mt = new MersenneRandom(0);\r\n\r\nexport function random() {\r\n  return _mt.extract_number()/(1<<30);\r\n}\r\n\r\nexport function seed(n) {\r\n//  console.trace(\"seed called\");\r\n  _mt.seed(n);\r\n}\r\n\r\nlet smallstr_hashes = {};\r\n\r\n\r\nconst MAXINT = Math.pow(2, 31) - 1;\r\n\r\nexport function strhash(str) {\r\n  if (str.length <= 64) {\r\n    let hash = smallstr_hashes[str];\r\n\r\n    if (hash !== undefined) {\r\n      return hash;\r\n    }\r\n  }\r\n\r\n  let hash = 0;\r\n\r\n  for (let i = 0; i < str.length; i++) {\r\n    let ch = str.charCodeAt(i);\r\n\r\n    hash = hash < 0 ? -hash : hash;\r\n\r\n    hash ^= (ch*1103515245 + 12345) & MAXINT;\r\n  }\r\n\r\n  if (str.length <= 64) {\r\n    smallstr_hashes[str] = hash;\r\n  }\r\n\r\n  return hash;\r\n}\r\n\r\nlet hashsizes = [\r\n  /*2, 5, 11, 19, 37, 67, 127, */223, 383, 653, 1117, 1901, 3251,\r\n                                 5527, 9397, 15991, 27191, 46229, 78593, 133631, 227177, 38619,\r\n                                 656587, 1116209, 1897561, 3225883, 5484019, 9322861, 15848867,\r\n                                 26943089, 45803279, 77865577, 132371489, 225031553\r\n];\r\n\r\nlet FTAKEN = 0, FKEY = 1, FVAL = 2, FTOT = 3;\r\n\r\nexport class FastHash extends Array {\r\n  constructor() {\r\n    super();\r\n\r\n    this.cursize = 0;\r\n    this.size = hashsizes[this.cursize];\r\n    this.used = 0;\r\n\r\n    this.length = this.size*FTOT;\r\n    this.fill(0, 0, this.length);\r\n  }\r\n\r\n  resize(size) {\r\n    let table = this.slice(0, this.length);\r\n\r\n    this.length = size*FTOT;\r\n    this.size = size;\r\n    this.fill(0, 0, this.length);\r\n\r\n    for (let i = 0; i < table.length; i += FTOT) {\r\n      if (!table[i + FTAKEN]) continue;\r\n\r\n      let key = table[i + FKEY], val = table[i + FVAL];\r\n      this.set(key, val);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  get(key) {\r\n    let hash = typeof key === \"string\" ? strhash(key) : key;\r\n    hash = typeof hash === \"object\" ? hash.valueOf() : hash;\r\n\r\n    let probe = 0;\r\n\r\n    let h = (hash + probe)%this.size;\r\n\r\n    let _i = 0;\r\n    while (_i++ < 50000 && this[h*FTOT + FTAKEN]) {\r\n      if (this[h*FTOT + FKEY] === key) {\r\n        return this[h*FTOT + FVAL];\r\n      }\r\n\r\n      probe = (probe + 1)*2;\r\n      h = (hash + probe)%this.size;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  has(key) {\r\n    let hash = typeof key === \"string\" ? strhash(key) : key;\r\n    hash = typeof hash === \"object\" ? hash.valueOf() : hash;\r\n\r\n    let probe = 0;\r\n\r\n    let h = (hash + probe)%this.size;\r\n\r\n    let _i = 0;\r\n    while (_i++ < 50000 && this[h*FTOT + FTAKEN]) {\r\n      if (this[h*FTOT + FKEY] === key) {\r\n        return true;\r\n      }\r\n\r\n      probe = (probe + 1)*2;\r\n      h = (hash + probe)%this.size;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  set(key, val) {\r\n    let hash = typeof key === \"string\" ? strhash(key) : key;\r\n    hash = typeof hash === \"object\" ? hash.valueOf() : hash;\r\n\r\n    if (this.used > this.size/3) {\r\n      this.resize(hashsizes[this.cursize++]);\r\n    }\r\n\r\n    let probe = 0;\r\n\r\n    let h = (hash + probe)%this.size;\r\n\r\n    let _i = 0;\r\n    while (_i++ < 50000 && this[h*FTOT + FTAKEN]) {\r\n      if (this[h*FTOT + FKEY] === key) {\r\n        this[h*FTOT + FVAL] = val;\r\n        return;\r\n      }\r\n\r\n      probe = (probe + 1)*2;\r\n      h = (hash + probe)%this.size;\r\n    }\r\n\r\n    this[h*FTOT + FTAKEN] = 1;\r\n    this[h*FTOT + FKEY] = key;\r\n    this[h*FTOT + FVAL] = val;\r\n\r\n    this.used++;\r\n  }\r\n}\r\n\r\nexport function test_fasthash() {\r\n  let h = new FastHash();\r\n  console.log(\"bleh hash:\", strhash(\"bleh\"));\r\n\r\n  h.set(\"bleh\", 1);\r\n  h.set(\"bleh\", 2);\r\n  h.set(\"bleh\", 3);\r\n\r\n  console.log(h);\r\n\r\n  return h;\r\n};\r\n\r\nexport class ImageReader {\r\n  load_image() {\r\n    let input = document.createElement(\"input\");\r\n    input.type = \"file\";\r\n\r\n    let doaccept;\r\n\r\n    let promise = new Promise((accept, reject) => {\r\n      doaccept = accept;\r\n    });\r\n\r\n    input.addEventListener(\"change\", function (e) {\r\n      let files = this.files;\r\n      console.log(\"got file\", e, files)\r\n\r\n      if (files.length === 0) return;\r\n\r\n      let reader = new FileReader();\r\n      let this2 = this;\r\n\r\n      reader.onload = (e) => {\r\n        let data = e.target.result;\r\n        let image = new Image();\r\n\r\n        image.src = data;\r\n        image.onload = (e) => {\r\n          console.log(\"got image\", image.width, image.height);\r\n\r\n          let canvas = document.createElement(\"canvas\");\r\n          let g = canvas.getContext(\"2d\");\r\n\r\n          canvas.width = image.width;\r\n          canvas.height = image.height;\r\n\r\n          g.drawImage(image, 0, 0);\r\n          let idata = g.getImageData(0, 0, image.width, image.height);\r\n\r\n          doaccept(idata);\r\n        }\r\n      };\r\n\r\n      reader.readAsDataURL(files[0]);\r\n    });\r\n\r\n    input.click();\r\n    return promise;\r\n  }\r\n\r\n  example() {\r\n    this.load_image().then((idata) => {\r\n      console.log(idata);\r\n    });\r\n  }\r\n};\r\n\r\nlet digestcache;\r\n\r\n/** NOT CRYPTOGRAPHIC */\r\nexport class HashDigest {\r\n  constructor() {\r\n    this.i = 0;\r\n    this.hash = 0;\r\n  }\r\n\r\n  static cachedDigest() {\r\n    return digestcache.next().reset();\r\n  }\r\n\r\n  reset() {\r\n    this.i = 0;\r\n    this.hash = 0;\r\n\r\n    return this;\r\n  }\r\n\r\n  get() {\r\n    return this.hash;\r\n  }\r\n\r\n  add(v) {\r\n    if (typeof v === \"string\") {\r\n      v = strhash(v);\r\n    }\r\n\r\n    if (typeof v === \"object\" && Array.isArray(v)) {\r\n      for (let i = 0; i < v.length; i++) {\r\n        this.add(v[i]);\r\n      }\r\n\r\n      return this;\r\n    }\r\n\r\n    if (v >= -5 && v <= 5) {\r\n      v *= 32;\r\n    }\r\n\r\n    //try to deal with subdecimal floating point error\r\n\r\n    let f = Math.fract(v)*(1024*512);\r\n    f = (~~f)/(1024*512);\r\n    v = Math.floor(v) + f;\r\n\r\n    //glibc linear congruel generator\r\n    this.i = ((this.i + (~~v))*1103515245 + 12345) & ((1<<29) - 1);\r\n    //according to wikipedia only the top 16 bits are random\r\n    //this.i = this.i>>16;\r\n\r\n    let v2 = (v*1024*1024) & ((1<<29) - 1)\r\n    v = v | v2;\r\n\r\n    v = ~~v;\r\n\r\n    this.hash ^= v ^ this.i;\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nwindow._test_hash2 = () => {\r\n  let h = new HashDigest();\r\n\r\n  let tests = [\r\n    [0, 0, 0, 0],\r\n    [0, 0, 0],\r\n    [0, 0],\r\n    [0],\r\n    [1],\r\n    [2],\r\n    [3],\r\n    [strhash(\"yay\")],\r\n    [strhash(\"yay\"), strhash(\"yay\")],\r\n    [strhash(\"yay\"), strhash(\"yay\"), strhash(\"yay\")]\r\n  ]\r\n\r\n  for (let test of tests) {\r\n    let h = new HashDigest();\r\n    for (let f of test) {\r\n      h.add(f);\r\n    }\r\n\r\n    window.console.log(h.get());\r\n  }\r\n  for (let i = 0; i < 50; i++) {\r\n    h.add(0);\r\n    //window.console.log(h.i/((1<<30)-1), h.hash);\r\n  }\r\n}\r\n\r\ndigestcache = cachering.fromConstructor(HashDigest, 512);\r\n\r\n//globalThis._HashDigest = HashDigest;\r\n\r\nexport function hashjoin(hash, val) {\r\n  let sum = 0;\r\n  let mul = (1<<19) - 1, off = (1<<27) - 1;\r\n  let i = 0;\r\n\r\n  h = (h*mul + off + i*mul*0.25) & mul;\r\n}\r\n\r\nlet NullItem = {};\r\n\r\nexport class MapIter {\r\n  constructor(ownermap) {\r\n    this.ret = {done: true, value: undefined};\r\n    this.value = new Array(2);\r\n    this.i = 0;\r\n    this.map = ownermap;\r\n    this.done = true;\r\n  }\r\n\r\n  finish() {\r\n    if (!this.done) {\r\n      this.done = true;\r\n      this.map.itercur--;\r\n    }\r\n  }\r\n\r\n  next() {\r\n    let ret = this.ret;\r\n    let i = this.i;\r\n    let map = this.map, list = map._list;\r\n    //window.console.log(this)\r\n\r\n    while (i < list.length && list[i] === NullItem) {\r\n      i += 2;\r\n    }\r\n\r\n    //window.console.log(\"  --\", i, list[i], list[i+1]);\r\n\r\n    if (i >= list.length) {\r\n      ret.done = true;\r\n      ret.value = undefined;\r\n\r\n      this.finish();\r\n      return ret;\r\n    }\r\n\r\n    this.i = i + 2;\r\n\r\n    ret.value = this.value;\r\n    ret.value[0] = list[i];\r\n    ret.value[1] = list[i + 1];\r\n    ret.done = false;\r\n\r\n    return ret;\r\n  }\r\n\r\n  return() {\r\n    this.finish();\r\n\r\n    return this.ret;\r\n  }\r\n\r\n  reset() {\r\n    this.i = 0;\r\n    this.value[0] = undefined;\r\n    this.value[1] = undefined;\r\n    this.done = false;\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nexport class map {\r\n  constructor() {\r\n    this._items = {};\r\n    this._list = [];\r\n\r\n    this.size = 0;\r\n\r\n    this.iterstack = new Array(8);\r\n    this.itercur = 0;\r\n    for (let i = 0; i < this.iterstack.length; i++) {\r\n      this.iterstack[i] = new MapIter(this);\r\n    }\r\n\r\n    this.freelist = [];\r\n  }\r\n\r\n  has(key) {\r\n    return key[Symbol.keystr]() in this._items;\r\n  }\r\n\r\n  set(key, v) {\r\n    let k = key[Symbol.keystr]();\r\n\r\n    let i = this._items[k];\r\n\r\n    if (i === undefined) {\r\n      if (this.freelist.length > 0) {\r\n        i = this.freelist.pop();\r\n      } else {\r\n        i = this._list.length;\r\n        this._list.length += 2;\r\n      }\r\n\r\n      this.size++;\r\n    }\r\n\r\n    this._list[i] = key;\r\n    this._list[i + 1] = v;\r\n\r\n    this._items[k] = i;\r\n  }\r\n\r\n  keys() {\r\n    let this2 = this;\r\n    return (function* () {\r\n      for (let [key, val] of this2) {\r\n        yield key;\r\n      }\r\n    })()\r\n  }\r\n\r\n  values() {\r\n    let this2 = this;\r\n    return (function* () {\r\n      for (let [key, val] of this2) {\r\n        yield val;\r\n      }\r\n    })()\r\n  }\r\n\r\n  get(k) {\r\n    k = k[Symbol.keystr]();\r\n\r\n    let i = this._items[k];\r\n    if (i !== undefined) {\r\n      return this._list[i + 1];\r\n    }\r\n  }\r\n\r\n  delete(k) {\r\n    k = k[Symbol.keystr]();\r\n\r\n    if (!(k in this._items)) {\r\n      return false;\r\n    }\r\n\r\n    let i = this._items[k];\r\n\r\n    this.freelist.push(i);\r\n\r\n    this._list[i] = NullItem;\r\n    this._list[i + 1] = NullItem;\r\n\r\n    delete this._items[k];\r\n    this.size--;\r\n\r\n    return true;\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    let ret = this.iterstack[this.itercur].reset();\r\n    this.itercur++;\r\n\r\n    if (this.itercur === this.iterstack.length) {\r\n      this.iterstack.push(new MapIter(this));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n}\r\n\r\nglobalThis._test_map = function () {\r\n  let m = new map();\r\n\r\n  m.set(\"1\", 2);\r\n  m.set(11, 3);\r\n  m.set(\"5\", 4);\r\n  m.set(\"3\", 5);\r\n  m.set(\"3\", 6);\r\n  m.delete(\"3\");\r\n\r\n  for (let [key, item] of m) {\r\n    for (let [key2, item2] of m) {\r\n      window.console.log(key, item, key2, item2);\r\n    }\r\n    break;\r\n  }\r\n\r\n  console.log(\"itercur\", m.itercur);\r\n\r\n  return m;\r\n}\r\n\r\nfunction validateId(id) {\r\n  let bad = typeof id !== \"number\";\r\n  bad = bad || id !== ~~id;\r\n  bad = bad || isNaN(id);\r\n\r\n  if (bad) {\r\n    throw new Error(\"bad number \" + id);\r\n  }\r\n\r\n  return bad;\r\n}\r\n\r\nlet UndefinedTag = {};\r\n\r\nexport class IDMap extends Array {\r\n  constructor() {\r\n    super();\r\n\r\n    this._keys = new Set();\r\n    this.size = 0;\r\n  }\r\n\r\n  has(id) {\r\n    validateId(id);\r\n\r\n    if (id < 0 || id >= this.length) {\r\n      return false;\r\n    }\r\n\r\n    return this[id] !== undefined;\r\n  }\r\n\r\n  set(id, val) {\r\n    validateId(id);\r\n\r\n    if (id < 0) {\r\n      console.warn(\"got -1 id in IDMap\");\r\n      return;\r\n    }\r\n\r\n    if (id >= this.length) {\r\n      this.length = id + 1;\r\n    }\r\n\r\n    if (val === undefined) {\r\n      val = UndefinedTag;\r\n    }\r\n\r\n    let ret = false;\r\n\r\n    if (this[id] === undefined) {\r\n      this.size++;\r\n      this._keys.add(id);\r\n      ret = true;\r\n    }\r\n\r\n    this[id] = val;\r\n    return ret;\r\n  }\r\n\r\n  /* we allow -1, which always returns undefined*/\r\n  get(id) {\r\n    validateId(id);\r\n\r\n    if (id === -1) {\r\n      return undefined;\r\n    } else if (id < 0) {\r\n      console.warn(\"id was negative\");\r\n      return undefined;\r\n    }\r\n\r\n    let ret = id < this.length ? this[id] : undefined;\r\n    ret = ret === UndefinedTag ? undefined : ret;\r\n\r\n    return ret;\r\n  }\r\n\r\n  delete(id) {\r\n    if (!this.has(id)) {\r\n      return false;\r\n    }\r\n\r\n    this._keys.remove(id);\r\n    this[id] = undefined;\r\n    this.size--;\r\n\r\n    return true;\r\n  }\r\n\r\n  keys() {\r\n    let this2 = this;\r\n    return (function* () {\r\n      for (let id of this2._keys) {\r\n        yield id;\r\n      }\r\n    })();\r\n  }\r\n\r\n  values() {\r\n    let this2 = this;\r\n    return (function* () {\r\n      for (let id of this2._keys) {\r\n        yield this2[id];\r\n      }\r\n    })();\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    let this2 = this;\r\n    let iteritem = [0, 0];\r\n\r\n    return (function* () {\r\n      for (let id of this2._keys) {\r\n        iteritem[0] = id;\r\n        iteritem[1] = this2[id];\r\n\r\n        if (iteritem[1] === UndefinedTag) {\r\n          iteritem[1] = undefined;\r\n        }\r\n\r\n        yield iteritem;\r\n      }\r\n    })();\r\n  }\r\n}\r\n\r\nglobalThis._test_idmap = function () {\r\n  let map = new IDMap();\r\n\r\n  for (let i = 0; i < 5; i++) {\r\n    let id = ~~(Math.random()*55);\r\n\r\n    map.set(id, \"yay\" + i);\r\n  }\r\n\r\n  for (let [key, val] of map) {\r\n    window.console.log(key, val, map.has(key), map.get(key));\r\n  }\r\n\r\n  return map;\r\n}\r\n\r\nlet HW = 0, HELEM = 1, HTOT = 2;\r\n\r\nfunction heaplog() {\r\n  //window.console.log(...arguments);\r\n}\r\n\r\nexport class MinHeapQueue {\r\n  constructor(iter, iterw = iter) {\r\n    this.heap = [];\r\n    this.freelist = [];\r\n    this.length = 0;\r\n    this.end = 0;\r\n\r\n    if (iter) {\r\n      let witer = iterw[Symbol.iterator]();\r\n\r\n      for (let item of iter) {\r\n        let w = witer.next().value;\r\n        this.push(item, w);\r\n      }\r\n    }\r\n  }\r\n\r\n  push(e, w) {\r\n    if (typeof w !== \"number\") {\r\n      throw new Error(\"w must be a number\");\r\n    }\r\n\r\n    if (isNaN(w)) {\r\n      throw new Error(\"NaN\");\r\n    }\r\n\r\n    this.length++;\r\n    let depth = Math.ceil(Math.log(this.length)/Math.log(2.0));\r\n    let tot = Math.pow(2, depth) + 1;\r\n\r\n    heaplog(depth, tot);\r\n\r\n    if (this.heap.length < tot*HTOT) {\r\n      let start = this.heap.length/HTOT;\r\n\r\n      for (let i = start; i < tot; i++) {\r\n        this.freelist.push(i*HTOT);\r\n      }\r\n    }\r\n\r\n    let heap = this.heap;\r\n    heap.length = tot*HTOT;\r\n\r\n    let n = this.freelist.pop();\r\n\r\n    heaplog(\"freelist\", this.freelist);\r\n    this.end = Math.max(this.end, n);\r\n\r\n    heap[n] = w;\r\n    heap[n + 1] = e;\r\n\r\n    while (n > 0) {\r\n      n /= HTOT;\r\n\r\n      let p = (n - 1)>>1;\r\n      n *= HTOT;\r\n      p *= HTOT;\r\n\r\n      if (heap[p] === undefined || heap[p] > w) {\r\n        if (n === this.end) {\r\n          this.end = p;\r\n        }\r\n\r\n        heap[n] = heap[p];\r\n        heap[n + 1] = heap[p + 1];\r\n\r\n        heap[p] = w;\r\n        heap[p + 1] = e;\r\n\r\n        n = p;\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  pop() {\r\n    if (this.length === 0) {\r\n      return undefined;\r\n      //throw new Error(\"heap is empty\");\r\n    }\r\n\r\n    let heap = this.heap;\r\n\r\n    if (this.end === 0) {\r\n      let ret = heap[1];\r\n      this.freelist.push(0);\r\n      heap[0] = undefined;\r\n\r\n      this.length = 0;\r\n\r\n      return ret;\r\n    }\r\n\r\n    let ret = heap[1];\r\n\r\n    let end = this.end;\r\n\r\n    function swap(n1, n2) {\r\n      let t = heap[n1];\r\n      heap[n1] = heap[n2];\r\n      heap[n2] = t;\r\n\r\n      t = heap[n1 + 1];\r\n      heap[n1 + 1] = heap[n2 + 1];\r\n      heap[n2 + 1] = t;\r\n    }\r\n\r\n    heaplog(\"end\", end);\r\n    heaplog(heap.concat([]));\r\n\r\n    heap[0] = heap[end];\r\n    heap[1] = heap[end + 1];\r\n    heap[end] = undefined;\r\n    heap[end + 1] = undefined;\r\n\r\n    let n = 0;\r\n    while (n < heap.length) {\r\n      n /= HTOT;\r\n\r\n      let n1 = n*2 + 1;\r\n      let n2 = n*2 + 2;\r\n\r\n      n1 = ~~(n1*HTOT);\r\n      n2 = ~~(n2*HTOT);\r\n      n = ~~(n*HTOT);\r\n\r\n      heaplog(\"  \", heap[n], heap[n1], heap[n2]);\r\n\r\n      if (heap[n1] !== undefined && heap[n2] !== undefined) {\r\n        if (heap[n1] > heap[n2]) {\r\n          let t = n1;\r\n          n1 = n2;\r\n          n2 = t;\r\n        }\r\n\r\n        if (heap[n] > heap[n1]) {\r\n          swap(n, n1);\r\n          n = n1;\r\n        } else if (heap[n] > heap[n2]) {\r\n          swap(n, n2);\r\n          n = n2;\r\n        } else {\r\n          break;\r\n        }\r\n      } else if (heap[n1] !== undefined) {\r\n        if (heap[n] > heap[n1]) {\r\n          swap(n, n1);\r\n          n = n1;\r\n        } else {\r\n          break;\r\n        }\r\n      } else if (heap[n2] !== undefined) {\r\n        if (heap[n] > heap[n2]) {\r\n          swap(n, n2);\r\n          n = n2;\r\n        } else {\r\n          break;\r\n        }\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n\r\n    this.freelist.push(this.end);\r\n\r\n    heap[this.end] = undefined;\r\n    heap[this.end + 1] = undefined;\r\n\r\n    while (this.end > 0 && heap[this.end] === undefined) {\r\n      this.end -= HTOT;\r\n    }\r\n\r\n    this.length--;\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nglobalThis.testHeapQueue = function (list1 = [1, 8, -3, 11, 33]) {\r\n  let h = new MinHeapQueue(list1);\r\n\r\n  window.console.log(h.heap.concat([]));\r\n\r\n  let list = [];\r\n  let len = h.length;\r\n\r\n  for (let i = 0; i < len; i++) {\r\n    list.push(h.pop());\r\n  }\r\n\r\n  window.console.log(h.heap.concat([]));\r\n\r\n  return list;\r\n}\r\n\r\nexport class Queue {\r\n  constructor(n = 32) {\r\n    n = Math.max(n, 8);\r\n\r\n    this.initialSize = n;\r\n\r\n    this.queue = new Array(n);\r\n    this.a = 0;\r\n    this.b = 0;\r\n    this.length = 0;\r\n  }\r\n\r\n  enqueue(item) {\r\n    let qlen = this.queue.length;\r\n\r\n    let b = this.b;\r\n\r\n    this.queue[b] = item;\r\n    this.b = (this.b + 1)%qlen;\r\n\r\n    if (this.length >= qlen || this.a === this.b) {\r\n      let newsize = qlen<<1;\r\n      let queue = new Array(newsize);\r\n\r\n      for (let i = 0; i < qlen; i++) {\r\n        let i2 = (i + this.a)%qlen;\r\n\r\n        queue[i] = this.queue[i2];\r\n      }\r\n\r\n      this.a = 0;\r\n      this.b = qlen;\r\n      this.queue = queue;\r\n    }\r\n\r\n    this.length++;\r\n  }\r\n\r\n  clear(clearData = true) {\r\n    this.queue.length = this.initialSize;\r\n\r\n    if (clearData) {\r\n      for (let i = 0; i < this.queue.length; i++) {\r\n        this.queue[i] = undefined;\r\n      }\r\n    }\r\n\r\n    this.a = this.b = 0;\r\n    this.length = 0;\r\n\r\n    return this;\r\n  }\r\n\r\n  dequeue() {\r\n    if (this.length === 0) {\r\n      return undefined;\r\n    }\r\n    this.length--;\r\n\r\n    let ret = this.queue[this.a];\r\n\r\n    this.queue[this.a] = undefined;\r\n\r\n    this.a = (this.a + 1)%this.queue.length;\r\n    return ret;\r\n  }\r\n}\r\n\r\nglobalThis._testQueue = function (steps = 15, samples = 15) {\r\n  let queue = new Queue(3);\r\n\r\n  for (let i = 0; i < steps; i++) {\r\n    let list = [];\r\n\r\n    for (let j = 0; j < samples; j++) {\r\n      let item = {f: Math.random()};\r\n      list.push(item);\r\n\r\n      queue.enqueue(item);\r\n    }\r\n\r\n    let j = 0;\r\n\r\n    while (queue.length > 0) {\r\n      let item = queue.dequeue();\r\n\r\n      if (item !== list[j]) {\r\n        console.log(item, list);\r\n        throw new Error(\"got wrong item\", item);\r\n      }\r\n\r\n      j++;\r\n\r\n      if (j > 10000) {\r\n        console.error(\"Infinite loop error\");\r\n        break;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n\r\nexport class ArrayPool {\r\n  constructor() {\r\n    this.pools = new Map();\r\n    this.map = new Array(1024);\r\n  }\r\n\r\n  get(n, clear = false) {\r\n    let pool;\r\n\r\n    if (n < 1024) {\r\n      pool = this.map[n];\r\n    } else {\r\n      pool = this.pools.get(n);\r\n    }\r\n\r\n    if (!pool) {\r\n      let tot;\r\n\r\n      if (n > 512) {\r\n        tot = 32;\r\n      } else if (n > 256) {\r\n        tot = 64;\r\n      } else if (n > 128) {\r\n        tot = 256;\r\n      } else if (n > 64) {\r\n        tot = 512;\r\n      } else {\r\n        tot = 1024;\r\n      }\r\n\r\n      pool = new cachering(() => new Array(n), tot);\r\n      if (n < 1024) {\r\n        this.map[n] = pool;\r\n      }\r\n      this.pools.set(n, pool);\r\n\r\n      return this.get(n, clear);\r\n    }\r\n\r\n    let ret = pool.next();\r\n    if (ret.length !== n) {\r\n      console.warn(\"Array length was set\", n, ret);\r\n      ret.length = n;\r\n    }\r\n\r\n    if (clear) {\r\n      for (let i = 0; i < n; i++) {\r\n        ret[i] = undefined;\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\n/** jsFiddle-friendly */\r\nexport class DivLogger {\r\n  constructor(elemId, maxLines = 16) {\r\n    this.elemId = elemId;\r\n    this.elem = undefined;\r\n    this.lines = new Array();\r\n    this.maxLines = maxLines;\r\n  }\r\n\r\n  push(line) {\r\n    if (this.lines.length > this.maxLines) {\r\n      this.lines.shift();\r\n      this.lines.push(line);\r\n    } else {\r\n      this.lines.push(line);\r\n    }\r\n\r\n    this.update();\r\n  }\r\n\r\n  update() {\r\n    let buf = this.lines.join(`<br>`);\r\n    buf = buf.replace(/[ \\t]/g, \"&nbsp;\");\r\n\r\n    if (!this.elem) {\r\n      this.elem = document.getElementById(this.elemId);\r\n    }\r\n\r\n    this.elem.innerHTML = buf;\r\n  }\r\n\r\n  toString(obj, depth = 0) {\r\n    let s = '';\r\n\r\n    let tab = '';\r\n    for (let i = 0; i < depth; i++) {\r\n      tab += '$TAB';\r\n    }\r\n\r\n    if (typeof obj === \"symbol\") {\r\n      return `[${obj.description}]`;\r\n    }\r\n\r\n    const DEPTH_LIMIT = 1;\r\n    const CHAR_LIMIT = 100;\r\n\r\n    if (typeof obj === \"object\" && Array.isArray(obj)) {\r\n      s = \"[$NL\";\r\n      for (let i = 0; i < obj.length; i++) {\r\n        let v = obj[i];\r\n\r\n        if (depth >= DEPTH_LIMIT) {\r\n          v = typeof v;\r\n        } else {\r\n          v = this.toString(v, depth + 1);\r\n        }\r\n\r\n        s += tab + \"$TAB\";\r\n        s += v + (i !== obj.length - 1 ? \",\" : \"\") + \"$NL\";\r\n      }\r\n\r\n      let keys = Reflect.ownKeys(obj);\r\n      for (let i = 0; i < keys.length; i++) {\r\n        let k = keys[i];\r\n        let n;\r\n\r\n        let k2 = this.toString(k);\r\n\r\n        if (typeof k !== \"symbol\" && !isNaN(n = parseInt(k))) {\r\n          if (n >= 0 && n < obj.length) {\r\n            continue;\r\n          }\r\n        }\r\n\r\n        let v;\r\n        try {\r\n          v = obj[k];\r\n        } catch (error) {\r\n          v = \"(error)\";\r\n        }\r\n\r\n        s += tab + `$TAB${k2} : ${v}`;\r\n\r\n        if (i < keys.length - 1) {\r\n          s += \",\";\r\n        }\r\n\r\n        if (!s.endsWith(\"$NL\") && !s.endsWith(\"\\n\")) {\r\n          s += \"$NL\";\r\n        }\r\n      }\r\n      s += \"$TAB]$NL\";\r\n\r\n      if (s.length < CHAR_LIMIT) {\r\n        s = s.replace(/\\$NL/g, \"\");\r\n        s = s.replace(/(\\$TAB)+/g, \" \");\r\n      } else {\r\n        s = s.replace(/\\$NL/g, \"\\n\");\r\n        s = s.replace(/\\$TAB/g, \"  \");\r\n      }\r\n    } else if (typeof obj === \"object\") {\r\n      s = '{$NL';\r\n\r\n      let keys = Reflect.ownKeys(obj);\r\n      for (let i = 0; i < keys.length; i++) {\r\n        let k = keys[i];\r\n        let k2 = this.toString(k);\r\n\r\n        let v;\r\n        try {\r\n          v = obj[k];\r\n        } catch (error) {\r\n          v = '(error)';\r\n        }\r\n\r\n        if (depth >= DEPTH_LIMIT) {\r\n          v = typeof v;\r\n        } else {\r\n          v = this.toString(v, depth + 1);\r\n        }\r\n\r\n        s += tab + `$TAB${k2} : ${v}`;\r\n\r\n        if (i < keys.length - 1) {\r\n          s += \",\";\r\n        }\r\n\r\n        if (!s.endsWith(\"$NL\") && !s.endsWith(\"\\n\")) {\r\n          s += \"$NL\";\r\n        }\r\n      }\r\n      s += tab + \"}$NL\";\r\n\r\n      if (s.length < CHAR_LIMIT) {\r\n        s = s.replace(/\\$NL/g, \"\");\r\n        s = s.replace(/(\\$TAB)+/g, \" \");\r\n      } else {\r\n        s = s.replace(/\\$NL/g, \"\\n\");\r\n        s = s.replace(/\\$TAB/g, \"  \");\r\n      }\r\n    } else if (typeof obj === \"undefined\") {\r\n      s = 'undefined';\r\n    } else if (typeof obj === \"function\") {\r\n      s = 'function ' + obj.name;\r\n    } else {\r\n      s = \"\" + obj;\r\n    }\r\n\r\n    return s;\r\n  }\r\n}\r\n\r\nexport const PendingTimeoutPromises = new Set();\r\n\r\nexport class TimeoutPromise {\r\n  constructor(callback, timeout = 3000, silent = false) {\r\n    if (!callback) {\r\n      return;\r\n    }\r\n\r\n    this.silent = silent;\r\n    this.timeout = timeout;\r\n\r\n    let accept2 = this._accept2.bind(this);\r\n    let reject2 = this._reject2.bind(this);\r\n\r\n    this.time = time_ms();\r\n\r\n    this.rejected = false;\r\n\r\n    this._promise = new Promise((accept, reject) => {\r\n      this._accept = accept;\r\n      this._reject = reject;\r\n\r\n      callback(accept2, reject2);\r\n    });\r\n\r\n    PendingTimeoutPromises.add(this);\r\n  }\r\n\r\n  _accept2(val) {\r\n    if (this.bad) {\r\n      if (!this.silent) {\r\n        this._reject(new Error(\"Timeout\"));\r\n      }\r\n    } else {\r\n      return this._accept(val);\r\n    }\r\n  }\r\n\r\n  static wrapPromise(promise, timeout = 3000, callback) {\r\n    let p = new TimeoutPromise();\r\n\r\n    p._promise = promise;\r\n\r\n    p._accept = callback;\r\n    p._reject = function (error) {\r\n      throw error;\r\n    }\r\n\r\n    p.then(val => {\r\n      p._accept2(val);\r\n    }).catch(error => {\r\n      p._reject2(error);\r\n    });\r\n\r\n    return p;\r\n  }\r\n\r\n  _reject2(error) {\r\n    this._reject(error);\r\n  }\r\n\r\n  then(callback) {\r\n    let cb = (val) => {\r\n      let ret = callback(val);\r\n\r\n      if (ret instanceof Promise) {\r\n        ret = TimeoutPromise.wrapPromise(ret, this.timeout, callback);\r\n      }\r\n\r\n      return ret;\r\n    }\r\n\r\n    this._promise.then(cb);\r\n    return this;\r\n  }\r\n\r\n  catch(callback) {\r\n    this._promise.catch(callback);\r\n    return this;\r\n  }\r\n\r\n  finally(callback) {\r\n    this._promise.catch(callback);\r\n    return this;\r\n  }\r\n\r\n  get bad() {\r\n    return time_ms() - this.time > this.timeout;\r\n  }\r\n}\r\n\r\nwindow.setInterval(() => {\r\n  let bad = [];\r\n\r\n  for (let promise of PendingTimeoutPromises) {\r\n    if (promise.bad) {\r\n      bad.push(promise);\r\n    }\r\n  }\r\n\r\n  for (let promise of bad) {\r\n    PendingTimeoutPromises.delete(promise);\r\n  }\r\n\r\n  for (let promise of bad) {\r\n    try {\r\n      promise._reject(new Error(\"Timeout\"));\r\n    } catch (error) {\r\n      print_stack(error);\r\n    }\r\n  }\r\n}, 250);\r\n\r\nimport lzstring from '../extern/lz-string/lz-string.js';\r\n\r\nexport function compress(data) {\r\n  return lzstring.compressToUint8Array(data);\r\n}\r\n\r\nexport function decompress(data) {\r\n  if (data instanceof DataView) {\r\n    data = data.buffer;\r\n  }\r\n\r\n  if (data instanceof ArrayBuffer) {\r\n    data = new Uint8Array(data);\r\n  }\r\n\r\n  return lzstring.decompressFromUint8Array(data);\r\n}\r\n\r\n/* Returns 'undefined' as type type.  Breaks the typescript\r\n   type system, is meant only for object pool systems.\r\n */\r\nexport function undefinedForGC() {\r\n  return undefined;\r\n}\r\n","import * as util from './util.js';\r\nimport nstructjs from './struct.js';\r\n\r\nexport const EulerOrders = {\r\n  XYZ: 0,\r\n  XZY: 1,\r\n  YXZ: 2,\r\n  YZX: 3,\r\n  ZXY: 4,\r\n  ZYX: 5\r\n};\r\n\r\n/**\r\n * @param mode one of 'es', 'commonjs', 'rjs'\r\n */\r\nwindow.makeCompiledVectormathCode = function (mode = \"es\") {\r\n  let s = \"\";\r\n  let es6exports = mode === \"es\";\r\n\r\n  function doExports(name) {\r\n    if (es6exports) {\r\n      return \"export\";\r\n    } else {\r\n      return `let ${name} = exports.${name} =`;\r\n    }\r\n  }\r\n\r\n  let classes = [Vector2, Vector3, Vector4, a];\r\n  let lens = {\r\n    Vector2: 2,\r\n    Vector3: 3,\r\n    Vector4: 4,\r\n    Quat   : 4\r\n  };\r\n\r\n  let modecode = \"\";\r\n\r\n  let nstructjscode = `\r\n  let g = typeof window !== \"undefined\" ? window : \"undefined\";\r\n  \r\n  g = g || (typeof global !== \"undefined\" ? global : \"undefined\");\r\n  g = g || (typeof self !== \"undefined\" ? self : \"undefined\");\r\n  g = g || (typeof globals !== \"undefined\" ? globals : \"undefined\");\r\n\r\n  if (typeof nstructjs === \"undefined\") {\r\n    //add nstructjs stub\r\n    g.nstructjs = {\r\n      register : function() {}\r\n    }\r\n  }\r\n  `\r\n\r\n  if (mode !== \"rjs\") {\r\n    if (mode === \"commonjs\") {\r\n      modecode = `if (typeof module !== \"undefined\" && typeof exports === \"undefined\") {\r\n      if (module.exports === undefined) {\r\n        module.exports = {};\r\n      }\r\n      \r\n      g.exports = module.exports;\r\n    } else if (typeof module === \"undefined\") {\r\n      g.exports = g.vectormath = {};\r\n    }\\n`;\r\n    }\r\n\r\n    s += `{\r\n      ${nstructjscode}\r\n    ${modecode}\r\n  }`;\r\n  }\r\n\r\n  s += `\r\nclass cachering extends Array {\r\n  constructor(func, size) {\r\n    super()\r\n\r\n    this.cur = 0;\r\n\r\n    for (let i=0; i<size; i++) {\r\n      this.push(func());\r\n    }\r\n  }\r\n\r\n  static fromConstructor(cls, size) {\r\n    let func = function() {\r\n      return new cls();\r\n    }\r\n\r\n    return new cachering(func, size);\r\n  }\r\n\r\n  next() {\r\n    let ret = this[this.cur];\r\n    this.cur = (this.cur+1)%this.length;\r\n\r\n    return ret;\r\n  }\r\n}\r\n`;\r\n  s += `\r\n\r\nlet M_SQRT2 = Math.sqrt(2.0);\r\nlet FLT_EPSILON = 2.22e-16;  \r\nlet sin=Math.sin, cos=Math.cos, abs=Math.abs, log=Math.log,\r\n    asin=Math.asin, exp=Math.exp, acos=Math.acos, fract=Math.fract,\r\n    sign=Math.sign, tent=Math.tent, atan2=Math.atan2, atan=Math.atan,\r\n    pow=Math.pow, sqrt=Math.sqrt, floor=Math.floor, ceil=Math.ceil,\r\n    min=Math.min, max=Math.max, PI=Math.PI, E=2.718281828459045;\r\n\r\nlet DOT_NORM_SNAP_LIMIT = 0.00000000001;\r\n\r\n${doExports(\"BaseVector\")} class BaseVector extends Array {\r\n  constructor() {\r\n    super();\r\n    \r\n    this.vec = undefined; //for compatibility with old files\r\n  }\r\n\r\n  copy() {\r\n    return new this.constructor(this);\r\n  }\r\n\r\n  load(data) {\r\n    throw new Error(\"Implement me!\");\r\n  }\r\n  \r\n  vectorLength() {\r\n    return sqrt(this.dot(this));\r\n  }\r\n  \r\n  normalize() {\r\n    let l = this.vectorLength();\r\n    if (l > 0.00000001) {\r\n      this.mulScalar(1.0/l);\r\n    }\r\n    \r\n    return this;\r\n  }\r\n}\r\n  \r\n`;\r\n\r\n  function indent(s, pad = \"  \") {\r\n    let l = s.split(\"\\n\");\r\n    let s2 = \"\";\r\n\r\n    for (let l2 of l) {\r\n      s2 += pad + l2 + \"\\n\";\r\n    }\r\n\r\n    return s2;\r\n  }\r\n\r\n  let i = 0;\r\n  for (let cls of classes) {\r\n    s += doExports(cls.name) + \" class \" + cls.name + \" extends BaseVector {\\n\";\r\n\r\n    let keys = Reflect.ownKeys(cls.prototype);\r\n\r\n    for (let k of keys) {\r\n      let v = cls.prototype[k];\r\n\r\n      if (typeof v !== \"function\") {\r\n        continue;\r\n      }\r\n\r\n      if (typeof k === \"symbol\") {\r\n        k = \"  [\" + k.toString() + \"]\";\r\n      }\r\n\r\n      v = (\"\" + v).trim();\r\n      if (v.startsWith(\"function(\") || v.startsWith(\"function (\")) {\r\n        v = k + v.slice(8, v.length).trim();\r\n      } else if (v.startsWith(\"function\")) {\r\n        v = v.slice(8, v.length).trim();\r\n      }\r\n\r\n      if (v.endsWith(\";}\")) {\r\n        v = v.slice(0, v.length - 1) + \"\\n  }\\n\";\r\n      }\r\n\r\n      let zero = \"\";\r\n      let l = lens[cls.name];\r\n\r\n      for (let j = 0; j < l; j++) {\r\n        if (j > 0) {\r\n          zero += \" = \";\r\n        }\r\n        zero += `this[${j}]`;\r\n      }\r\n\r\n      zero += \" = 0.0\";\r\n\r\n      if (k === \"constructor\") {\r\n        s += `  constructor(data) {\r\n    super(${l});\r\n        \r\n    this.vec = undefined; //for compatibility with old files\r\n    \r\n    if (arguments.length > 1) {\r\n      throw new Error(\"unexpected argument\");\r\n    }\r\n\r\n    //this.length = ${l};\r\n    ${zero};\r\n\r\n    if (data !== undefined) {\r\n      this.load(data);\r\n    }\r\n  }\r\n`;\r\n      } else {\r\n        s += indent(v);\r\n      }\r\n\r\n      s += \"\\n\";\r\n      i++;\r\n    }\r\n    s += \"}\\n\\n\"\r\n\r\n    s += `${cls.name}.STRUCT = \\`${cls.STRUCT}\\`;\\n`;\r\n    s += `nstructjs.register(${cls.name});\\n\\n`;\r\n  }\r\n\r\n  s += \"\\n\\n\" + (\"\" + internal_matrix).trim() + \"\\n\";\r\n  s += \"\\n\" + doExports(\"Matrix4\") + Matrix4;\r\n\r\n  s += `\\n  Matrix4.STRUCT = \\`${Matrix4.STRUCT}\\`;\\n`;\r\n  s += \"nstructjs.register(Matrix4)\\n\";\r\n\r\n  s += `\r\n  let _quat_vs3_temps = cachering.fromConstructor(Vector3, 64);\r\n  let _v3nd4_n1_normalizedDot4 = new Vector3();\r\n  let _v3nd4_n2_normalizedDot4 = new Vector3();\r\n  let _v3nd_n1_normalizedDot = new Vector3();\r\n  let _v3nd_n2_normalizedDot = new Vector3();\r\n\r\n  let $_v3nd4_n1_normalizedDot4 = new Vector3();\r\n  let $_v3nd4_n2_normalizedDot4 = new Vector3();\r\n  let $_v3nd_n1_normalizedDot = new Vector3();\r\n  let $_v3nd_n2_normalizedDot = new Vector3();\r\n\r\n  let lookat_cache_vs3 = cachering.fromConstructor(Vector3, 64);\r\n  let lookat_cache_vs4 = cachering.fromConstructor(Vector4, 64);\r\n\r\n  let makenormalcache = cachering.fromConstructor(Vector3, 64);\r\n`;\r\n\r\n  if (mode === \"rjs\") {\r\n    s = `define([], function() {\r\n  \"use strict\";\r\n\r\n  let exports = {};\r\n\r\n  {\r\n    ${nstructjscode}\r\n  }\r\n  ${indent(s)}\r\n\r\n  return exports;\r\n});\r\n`;\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nlet sin                                                          = Math.sin, cos = Math.cos, abs = Math.abs, log = Math.log,\r\n    asin                                                         = Math.asin, exp = Math.exp, acos = Math.acos, fract    = Math.fract,\r\n    sign = Math.sign, tent = Math.tent, atan2 = Math.atan2, atan = Math.atan,\r\n    pow                                                          = Math.pow, sqrt = Math.sqrt, floor                      = Math.floor, ceil   = Math.ceil,\r\n    min                                                          = Math.min, max                                          = Math.max, PI = Math.PI, E = 2.718281828459045;\r\n\r\nlet DOT_NORM_SNAP_LIMIT = 0.00000000001;\r\nlet M_SQRT2 = Math.sqrt(2.0);\r\nlet FLT_EPSILON = 2.22e-16;\r\n\r\nlet basic_funcs = {\r\n  equals: [[\"b\"], \"this[X] === b[X]\", \"&&\"],\r\n  /*dot is made manually so it's safe for acos\r\n  dot     : [[\"b\"], \"this[X]*b[X]\", \"+\"],\r\n   */\r\n  zero     : [[], \"0.0;\"],\r\n  negate   : [[], \"-this[X];\"],\r\n  combine  : [[\"b\", \"u\", \"v\"], \"this[X]*u + this[X]*v;\"],\r\n  interp   : [[\"b\", \"t\"], \"this[X] + (b[X] - this[X])*t;\"],\r\n  add      : [[\"b\"], \"this[X] + b[X];\"],\r\n  addFac   : [[\"b\", \"F\"], \"this[X] + b[X]*F;\"],\r\n  fract    : [[], \"Math.fract(this[X]);\"],\r\n  sub      : [[\"b\"], \"this[X] - b[X];\"],\r\n  mul      : [[\"b\"], \"this[X] * b[X];\"],\r\n  div      : [[\"b\"], \"this[X] / b[X];\"],\r\n  mulScalar: [[\"b\"], \"this[X] * b;\"],\r\n  divScalar: [[\"b\"], \"this[X] / b;\"],\r\n  addScalar: [[\"b\"], \"this[X] + b;\"],\r\n  subScalar: [[\"b\"], \"this[X] - b;\"],\r\n  minScalar: [[\"b\"], \"Math.min(this[X], b);\"],\r\n  maxScalar: [[\"b\"], \"Math.max(this[X], b);\"],\r\n  ceil     : [[], \"Math.ceil(this[X])\"],\r\n  floor    : [[], \"Math.floor(this[X])\"],\r\n  abs      : [[], \"Math.abs(this[X])\"],\r\n  min      : [[\"b\"], \"Math.min(this[X], b[X])\"],\r\n  max      : [[\"b\"], \"Math.max(this[X], b[X])\"],\r\n  clamp    : [[\"MIN\", \"MAX\"], \"min(max(this[X], MAX), MIN)\"],\r\n};\r\n\r\nfunction bounded_acos(fac) {\r\n  if (fac <= -1.0)\r\n    return Math.pi;\r\n  else if (fac >= 1.0)\r\n    return 0.0;\r\n  else\r\n    return Math.acos(fac);\r\n}\r\n\r\nfunction make_norm_safe_dot(cls) {\r\n  let _dot = cls.prototype.dot;\r\n\r\n  cls.prototype._dot = _dot;\r\n  cls.prototype.dot = function (b) {\r\n    let ret = _dot.call(this, b);\r\n\r\n    if (ret >= 1.0 - DOT_NORM_SNAP_LIMIT && ret <= 1.0 + DOT_NORM_SNAP_LIMIT)\r\n      return 1.0;\r\n    if (ret >= -1.0 - DOT_NORM_SNAP_LIMIT && ret <= -1.0 + DOT_NORM_SNAP_LIMIT)\r\n      return -1.0;\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nfunction getBaseVector(parent) {\r\n  return class BaseVector extends parent {\r\n    constructor() {\r\n      super(...arguments);\r\n\r\n      this.vec = undefined; //for compatibility with old nstructjs-saved files\r\n\r\n      //this.xyzw = this.init_swizzle(4);\r\n      //this.xyz = this.init_swizzle(3);\r\n      //this.xy = this.init_swizzle(2);\r\n    }\r\n\r\n    static inherit(cls, vectorsize) {\r\n      make_norm_safe_dot(cls);\r\n\r\n      var f;\r\n\r\n      let vectorDotDistance = \"f = function vectorDotDistance(b) {\\n\";\r\n      for (let i = 0; i < vectorsize; i++) {\r\n        vectorDotDistance += \"  let d\" + i + \" = this[\" + i + \"]-b[\" + i + \"];\\n\\n  \";\r\n      }\r\n\r\n      vectorDotDistance += \"  return \"\r\n      for (let i = 0; i < vectorsize; i++) {\r\n        if (i > 0)\r\n          vectorDotDistance += \" + \";\r\n        vectorDotDistance += \"d\" + i + \"*d\" + i;\r\n      }\r\n      vectorDotDistance += \";\\n\"\r\n      vectorDotDistance += \"};\";\r\n      cls.prototype.vectorDotDistance = eval(vectorDotDistance);\r\n\r\n      f = undefined\r\n      let vectorDistance = \"f = function vectorDistance(b) {\\n\";\r\n      for (let i = 0; i < vectorsize; i++) {\r\n        vectorDistance += `  let d${i} = this[${i}] - (b[${i}]||0);\\n\\n  `;\r\n        //vectorDistance += \"  let d\"+i+\" = this[\"+i+\"]-(b[\"+i+\"]||0);\\n\\n  \";\r\n      }\r\n\r\n      vectorDistance += \"  return Math.sqrt(\"\r\n      for (let i = 0; i < vectorsize; i++) {\r\n        if (i > 0)\r\n          vectorDistance += \" + \";\r\n        vectorDistance += \"d\" + i + \"*d\" + i;\r\n      }\r\n      vectorDistance += \");\\n\"\r\n      vectorDistance += \"};\";\r\n      cls.prototype.vectorDistance = eval(vectorDistance);\r\n\r\n      let vectorDistanceSqr = \"f = function vectorDistanceSqr(b) {\\n\";\r\n      for (let i = 0; i < vectorsize; i++) {\r\n        vectorDistanceSqr += `  let d${i} = this[${i}] - (b[${i}]||0);\\n\\n  `;\r\n        //vectorDistanceSqr += \"  let d\"+i+\" = this[\"+i+\"]-(b[\"+i+\"]||0);\\n\\n  \";\r\n      }\r\n\r\n      vectorDistanceSqr += \"  return (\"\r\n      for (let i = 0; i < vectorsize; i++) {\r\n        if (i > 0)\r\n          vectorDistanceSqr += \" + \";\r\n        vectorDistanceSqr += \"d\" + i + \"*d\" + i;\r\n      }\r\n      vectorDistanceSqr += \");\\n\"\r\n      vectorDistanceSqr += \"};\";\r\n      cls.prototype.vectorDistanceSqr = eval(vectorDistanceSqr);\r\n\r\n\r\n      for (let k in basic_funcs) {\r\n        let func = basic_funcs[k];\r\n        let args = func[0];\r\n        let line = func[1];\r\n        var f;\r\n\r\n        let code = \"f = function \" + k + \"(\"\r\n        for (let i = 0; i < args.length; i++) {\r\n          if (i > 0)\r\n            code += \", \";\r\n\r\n          line = line.replace(args[i], args[i].toLowerCase());\r\n          code += args[i].toLowerCase();\r\n        }\r\n        code += \") {\\n\";\r\n\r\n        if (func.length > 2) {\r\n          //make summation\r\n          code += \"  return \";\r\n\r\n          for (let i = 0; i < vectorsize; i++) {\r\n            if (i > 0)\r\n              code += func[2];\r\n\r\n            code += \"(\" + line.replace(/X/g, \"\" + i) + \")\";\r\n          }\r\n          code += \";\\n\";\r\n        } else {\r\n          for (let i = 0; i < vectorsize; i++) {\r\n            let line2 = line.replace(/X/g, \"\" + i);\r\n            code += \"  this[\" + i + \"] = \" + line2 + \";\\n\";\r\n          }\r\n          code += \"  return this;\\n\"\r\n        }\r\n\r\n        code += \"}\\n\";\r\n\r\n        //console.log(code);\r\n        f = eval(code);\r\n\r\n        cls.prototype[k] = f;\r\n        //console.log(k, f);\r\n      }\r\n    }\r\n\r\n    copy() {\r\n      return new this.constructor(this);\r\n    }\r\n\r\n    load(data) {\r\n      throw new Error(\"Implement me!\");\r\n    }\r\n\r\n    init_swizzle(size) {\r\n      let ret = {};\r\n      let cls = size === 4 ? Vector4 : (size === 3 ? Vector3 : Vector2);\r\n\r\n      for (let k in cls.prototype) {\r\n        let v = cls.prototype[k];\r\n        if (typeof v !== \"function\" && !(v instanceof Function))\r\n          continue;\r\n\r\n        ret[k] = v.bind(this);\r\n      }\r\n\r\n      return ret;\r\n    }\r\n\r\n    vectorLength() {\r\n      return sqrt(this.dot(this));\r\n    }\r\n\r\n    swapAxes(axis1, axis2) {\r\n      let t = this[axis1];\r\n      this[axis1] = this[axis2];\r\n      this[axis2] = t;\r\n\r\n      return this;\r\n    }\r\n\r\n    sinterp(v2, t) {\r\n      let l1 = this.vectorLength();\r\n      let l2 = v2.vectorLength();\r\n\r\n      //XXX this seems horribly incorrect.\r\n      return this.interp(v2, t).normalize().mulScalar(l1 + (l2 - l1)*t);\r\n    }\r\n\r\n    perpSwap(axis1 = 0, axis2 = 1, sign = 1) {\r\n      let tmp = this[axis1];\r\n\r\n      this[axis1] = this[axis2]*sign;\r\n      this[axis2] = -tmp*sign;\r\n\r\n      return this;\r\n    }\r\n\r\n    normalize() {\r\n      /*\r\n      for (let i=0; i<this.length; i++) {\r\n        if (util.isDenormal(this[i])) {\r\n          console.error(\"Denormal error\", i, this[i]);\r\n          this[i] = 0.0;\r\n        }\r\n      }\r\n      //*/\r\n\r\n      let l = this.vectorLength();\r\n\r\n      /*\r\n      if (util.isDenormal(l)) {\r\n        console.error(\"Denormal error\", l);\r\n      }\r\n      //*/\r\n\r\n      if (l > 0.00000001) {\r\n        this.mulScalar(1.0/l);\r\n      }\r\n\r\n      return this;\r\n    }\r\n  }\r\n}\r\n\r\nexport const BaseVector = getBaseVector(Array);\r\nexport const F64BaseVector = getBaseVector(Float64Array);\r\nexport const F32BaseVector = getBaseVector(Float32Array);\r\nexport const I32BaseVector = getBaseVector(Int32Array);\r\nexport const I16BaseVector = getBaseVector(Int16Array);\r\nexport const I8BaseVector = getBaseVector(Int8Array);\r\nexport const UI32BaseVector = getBaseVector(Uint32Array);\r\nexport const UI16BaseVector = getBaseVector(Uint16Array);\r\nexport const UI8BaseVector = getBaseVector(Uint8Array);\r\n\r\n\r\nfunction myclamp(f, a, b) {\r\n  return Math.min(Math.max(f, a), b);\r\n}\r\n\r\nexport function makeVector4(BaseVector, structName = 'vec4', structType = 'float') {\r\n  let temp1, temp2, temp3, temp4;\r\n\r\n  const Vector4 = class Vector4 extends BaseVector {\r\n    static STRUCT = nstructjs.inlineRegister(this, `\r\n    ${structName} {\r\n      0 : ${structType};\r\n      1 : ${structType};\r\n      2 : ${structType};\r\n      3 : ${structType};\r\n    }`);\r\n\r\n    constructor(data) {\r\n      super(4);\r\n\r\n      if (arguments.length > 1) {\r\n        throw new Error(\"unexpected argument\");\r\n      }\r\n\r\n      this[0] = this[1] = this[2] = this[3] = 0.0;\r\n\r\n      if (data !== undefined) {\r\n        this.load(data);\r\n      }\r\n    }\r\n\r\n    toCSS() {\r\n      let r = ~~(this[0]*255);\r\n      let g = ~~(this[1]*255);\r\n      let b = ~~(this[2]*255);\r\n      let a = this[3];\r\n      return `rgba(${r},${g},${b},${a})`\r\n    }\r\n\r\n    loadXYZW(x, y, z, w) {\r\n      this[0] = x;\r\n      this[1] = y;\r\n      this[2] = z;\r\n      this[3] = w;\r\n\r\n      return this;\r\n    }\r\n\r\n    loadXYZ(x, y, z) {\r\n      this[0] = x;\r\n      this[1] = y;\r\n      this[2] = z;\r\n\r\n      return this;\r\n    }\r\n\r\n    static normalizedDot4(v1, v2, v3, v4) {\r\n      temp1.load(v2).sub(v1).normalize()\r\n      temp2.load(v4).sub(v3).normalize();\r\n\r\n      return temp1.dot(temp2);\r\n\r\n    }\r\n\r\n    static normalizedDot3(v1, center, v2) {\r\n      temp1.load(v1).sub(center).normalize();\r\n      temp2.load(v2).sub(center).normalize();\r\n\r\n      return temp1.dot(temp2);\r\n    }\r\n\r\n    load(data) {\r\n      if (data === undefined)\r\n        return this;\r\n\r\n      this[0] = data[0];\r\n      this[1] = data[1];\r\n      this[2] = data[2];\r\n      this[3] = data[3];\r\n\r\n      return this;\r\n    }\r\n\r\n    dot(b) {\r\n      return this[0]*b[0] + this[1]*b[1] + this[2]*b[2] + this[3]*b[3];\r\n    }\r\n\r\n    mulVecQuat(q) {\r\n      let t0 = -q[1]*this[0] - q[2]*this[1] - q[3]*this[2];\r\n      let t1 = q[0]*this[0] + q[2]*this[2] - q[3]*this[1];\r\n      let t2 = q[0]*this[1] + q[3]*this[0] - q[1]*this[2];\r\n\r\n      this[2] = q[0]*this[2] + q[1]*this[1] - q[2]*this[0];\r\n      this[0] = t1;\r\n      this[1] = t2;\r\n\r\n      t1 = t0* -q[1] + this[0]*q[0] - this[1]*q[3] + this[2]*q[2];\r\n      t2 = t0* -q[2] + this[1]*q[0] - this[2]*q[1] + this[0]*q[3];\r\n\r\n      this[2] = t0* -q[3] + this[2]*q[0] - this[0]*q[2] + this[1]*q[1];\r\n      this[0] = t1;\r\n      this[1] = t2;\r\n\r\n      return this;\r\n    }\r\n\r\n    multVecMatrix(matrix) {\r\n      let x = this[0];\r\n      let y = this[1];\r\n      let z = this[2];\r\n      let w = this[3];\r\n\r\n      this[0] = w*matrix.$matrix.m41 + x*matrix.$matrix.m11 + y*matrix.$matrix.m21 + z*matrix.$matrix.m31;\r\n      this[1] = w*matrix.$matrix.m42 + x*matrix.$matrix.m12 + y*matrix.$matrix.m22 + z*matrix.$matrix.m32;\r\n      this[2] = w*matrix.$matrix.m43 + x*matrix.$matrix.m13 + y*matrix.$matrix.m23 + z*matrix.$matrix.m33;\r\n      this[3] = w*matrix.$matrix.m44 + x*matrix.$matrix.m14 + y*matrix.$matrix.m24 + z*matrix.$matrix.m34;\r\n\r\n      return this[3];\r\n    }\r\n\r\n    cross(v) {\r\n      let x = this[1]*v[2] - this[2]*v[1];\r\n      let y = this[2]*v[0] - this[0]*v[2];\r\n      let z = this[0]*v[1] - this[1]*v[0];\r\n\r\n      this[0] = x;\r\n      this[1] = y;\r\n      this[2] = z;\r\n\r\n      return this;\r\n    }\r\n\r\n    preNormalizedAngle(v2) {\r\n      let th = this.dot(v2)*0.99999;\r\n      return Math.acos(th);\r\n    }\r\n\r\n    loadSTRUCT(reader) {\r\n      reader(this);\r\n\r\n      if (typeof this.vec !== \"undefined\") {\r\n        this.load(this.vec);\r\n        this.vec = undefined;\r\n      }\r\n    }\r\n  };\r\n\r\n  temp1 = new Vector4();\r\n  temp2 = new Vector4();\r\n  temp3 = new Vector4();\r\n  temp4 = new Vector4();\r\n\r\n  return Vector4;\r\n}\r\n\r\nexport const Vector4 = makeVector4(BaseVector);\r\n\r\nlet _v3nd_n1_normalizedDot, _v3nd_n2_normalizedDot;\r\nlet _v3nd4_n1_normalizedDot4, _v3nd4_n2_normalizedDot4;\r\n\r\nexport function makeVector3(BaseVector, structName = 'vec3', structType = 'float', customConstructorCode = undefined) {\r\n  var Vector3;\r\n  var bundlehelper = [nstructjs];\r\n\r\n  const constructorCode = customConstructorCode ?? `\r\n    constructor(data) {\r\n      super(3);\r\n\r\n      if (arguments.length > 1) {\r\n        throw new Error(\"unexpected argument\");\r\n      }\r\n\r\n      this[0] = this[1] = this[2] = 0.0;\r\n\r\n      if (data !== undefined) {\r\n        this.load(data);\r\n      }\r\n\r\n      if (this.constructor === Vector3) {\r\n        Object.preventExtensions(this);\r\n      }\r\n    }\r\n  `;\r\n\r\n  const code = `\r\n  let temp1, temp2, temp3, temp4;\r\n  Vector3 = class Vector3 extends BaseVector {\r\n    static STRUCT = bundlehelper[0].inlineRegister(this, \\`\r\n    ${structName} {\r\n      0 : ${structType};\r\n      1 : ${structType};\r\n      2 : ${structType};\r\n    }\\`);\r\n\r\n    ${constructorCode}\r\n\r\n    static normalizedDot4(v1, v2, v3, v4) {\r\n      temp1.load(v2).sub(v1).normalize()\r\n      temp2.load(v4).sub(v3).normalize();\r\n\r\n      return temp1.dot(temp2);\r\n\r\n    }\r\n\r\n    static normalizedDot3(v1, center, v2) {\r\n      temp1.load(v1).sub(center).normalize();\r\n      temp2.load(v2).sub(center).normalize();\r\n\r\n      return temp1.dot(temp2);\r\n    }\r\n\r\n    toCSS() {\r\n      let r = ~~(this[0]*255);\r\n      let g = ~~(this[1]*255);\r\n      let b = ~~(this[2]*255);\r\n      return \\`rgb(\\${r},\\${g},\\${b})\\`\r\n    }\r\n\r\n    loadXYZ(x, y, z) {\r\n      this[0] = x;\r\n      this[1] = y;\r\n      this[2] = z;\r\n\r\n      return this;\r\n    }\r\n\r\n    loadXY(x, y) {\r\n      this[0] = x;\r\n      this[1] = y;\r\n\r\n      return this;\r\n    }\r\n\r\n    toJSON() {\r\n      return [this[0], this[1], this[2]];\r\n    }\r\n\r\n    loadJSON(obj) {\r\n      return this.load(obj);\r\n    }\r\n\r\n    initVector3() {\r\n      this.length = 3;\r\n      this[0] = this[1] = this[2] = 0;\r\n      return this;\r\n    }\r\n\r\n    load(data) {\r\n      if (data === undefined)\r\n        return this;\r\n\r\n      //if (isNaN(data[0]) || isNaN(data[1]) || isNaN(data[2])) {\r\n      //  throw new Error(\"NaN\");\r\n      //}\r\n\r\n      this[0] = data[0];\r\n      this[1] = data[1];\r\n      this[2] = data[2];\r\n\r\n      return this;\r\n    }\r\n\r\n    dot(b) {\r\n      return this[0]*b[0] + this[1]*b[1] + this[2]*b[2];\r\n    }\r\n\r\n    normalizedDot(v) {\r\n      $_v3nd_n1_normalizedDot.load(this);\r\n      $_v3nd_n2_normalizedDot.load(v);\r\n      $_v3nd_n1_normalizedDot.normalize();\r\n      $_v3nd_n2_normalizedDot.normalize();\r\n      return $_v3nd_n1_normalizedDot.dot($_v3nd_n2_normalizedDot);\r\n    }\r\n\r\n    mulVecQuat(q) {\r\n      let t0 = -q[1]*this[0] - q[2]*this[1] - q[3]*this[2];\r\n      let t1 = q[0]*this[0] + q[2]*this[2] - q[3]*this[1];\r\n      let t2 = q[0]*this[1] + q[3]*this[0] - q[1]*this[2];\r\n\r\n      this[2] = q[0]*this[2] + q[1]*this[1] - q[2]*this[0];\r\n      this[0] = t1;\r\n      this[1] = t2;\r\n\r\n      t1 = t0* -q[1] + this[0]*q[0] - this[1]*q[3] + this[2]*q[2];\r\n      t2 = t0* -q[2] + this[1]*q[0] - this[2]*q[1] + this[0]*q[3];\r\n\r\n      this[2] = t0* -q[3] + this[2]*q[0] - this[0]*q[2] + this[1]*q[1];\r\n      this[0] = t1;\r\n      this[1] = t2;\r\n\r\n      return this;\r\n    }\r\n\r\n    multVecMatrix(matrix, ignore_w) {\r\n      if (ignore_w === undefined) {\r\n        ignore_w = false;\r\n      }\r\n      let x = this[0];\r\n      let y = this[1];\r\n      let z = this[2];\r\n      this[0] = matrix.$matrix.m41 + x*matrix.$matrix.m11 + y*matrix.$matrix.m21 + z*matrix.$matrix.m31;\r\n      this[1] = matrix.$matrix.m42 + x*matrix.$matrix.m12 + y*matrix.$matrix.m22 + z*matrix.$matrix.m32;\r\n      this[2] = matrix.$matrix.m43 + x*matrix.$matrix.m13 + y*matrix.$matrix.m23 + z*matrix.$matrix.m33;\r\n      let w = matrix.$matrix.m44 + x*matrix.$matrix.m14 + y*matrix.$matrix.m24 + z*matrix.$matrix.m34;\r\n\r\n      if (!ignore_w && w !== 1 && w !== 0 && matrix.isPersp) {\r\n        this[0] /= w;\r\n        this[1] /= w;\r\n        this[2] /= w;\r\n      }\r\n      return w;\r\n    }\r\n\r\n    cross(v) {\r\n      let x = this[1]*v[2] - this[2]*v[1];\r\n      let y = this[2]*v[0] - this[0]*v[2];\r\n      let z = this[0]*v[1] - this[1]*v[0];\r\n\r\n      this[0] = x;\r\n      this[1] = y;\r\n      this[2] = z;\r\n\r\n      return this;\r\n    }\r\n\r\n    //axis is optional, 0\r\n    rot2d(A, axis = 0) {\r\n      let x = this[0];\r\n      let y = this[1];\r\n\r\n      if (axis === 1) {\r\n        this[0] = x*Math.cos(A) + y*Math.sin(A);\r\n        this[1] = y*Math.cos(A) - x*Math.sin(A);\r\n      } else {\r\n        this[0] = x*Math.cos(A) - y*Math.sin(A);\r\n        this[1] = y*Math.cos(A) + x*Math.sin(A);\r\n      }\r\n\r\n      return this;\r\n    }\r\n\r\n    preNormalizedAngle(v2) {\r\n      let th = this.dot(v2)*0.99999;\r\n      return Math.acos(th);\r\n    }\r\n\r\n    loadSTRUCT(reader) {\r\n      reader(this);\r\n\r\n      if (typeof this.vec !== \"undefined\") {\r\n        this.load(this.vec);\r\n        this.vec = undefined;\r\n      }\r\n    }\r\n  }\r\n\r\n  temp1 = new Vector3();\r\n  temp2 = new Vector3();\r\n  temp3 = new Vector3();\r\n  temp4 = new Vector3();\r\n  `;\r\n\r\n  eval(code);\r\n  return Vector3;\r\n}\r\n\r\nexport const Vector3 = makeVector3(F64BaseVector);\r\n\r\nexport function makeVector2(BaseVector, structName = 'vec2', structType = 'float') {\r\n  let temp1, temp2, temp3, temp4;\r\n\r\n  const Vector2 = class Vector2 extends BaseVector {\r\n    static STRUCT = nstructjs.inlineRegister(this, `\r\n    ${structName} {\r\n      0 : ${structType};\r\n      1 : ${structType};\r\n    }`);\r\n\r\n    constructor(data) {\r\n      super(2);\r\n\r\n      if (arguments.length > 1) {\r\n        throw new Error(\"unexpected argument\");\r\n      }\r\n\r\n      this[0] = this[1] = 0.0;\r\n\r\n      if (data !== undefined) {\r\n        this.load(data);\r\n      }\r\n    }\r\n\r\n    initVector2(co) {\r\n      this.length = 2;\r\n\r\n      if (co !== undefined) {\r\n        this[0] = co[0];\r\n        this[1] = co[1];\r\n      } else {\r\n        this[0] = this[1] = 0.0;\r\n      }\r\n\r\n      return this;\r\n    }\r\n\r\n    static normalizedDot4(v1, v2, v3, v4) {\r\n      temp1.load(v2).sub(v1).normalize()\r\n      temp2.load(v4).sub(v3).normalize();\r\n\r\n      return temp1.dot(temp2);\r\n    }\r\n\r\n    static normalizedDot3(v1, center, v2) {\r\n      temp1.load(v1).sub(center).normalize();\r\n      temp2.load(v2).sub(center).normalize();\r\n\r\n      return temp1.dot(temp2);\r\n    }\r\n\r\n    toJSON() {\r\n      return [this[0], this[1]];\r\n    }\r\n\r\n    loadJSON(obj) {\r\n      return this.load(obj);\r\n    }\r\n\r\n    loadXY(x, y) {\r\n      this[0] = x;\r\n      this[1] = y;\r\n\r\n      return this;\r\n    }\r\n\r\n    load(data) {\r\n      if (data === undefined)\r\n        return this;\r\n\r\n      this[0] = data[0];\r\n      this[1] = data[1];\r\n\r\n      return this;\r\n    }\r\n\r\n    //axis is optional, 0\r\n    rot2d(A, axis) {\r\n      let x = this[0];\r\n      let y = this[1];\r\n\r\n      if (axis === 1) {\r\n        this[0] = x*Math.cos(A) + y*Math.sin(A);\r\n        this[1] = y*Math.cos(A) - x*Math.sin(A);\r\n      } else {\r\n        this[0] = x*Math.cos(A) - y*Math.sin(A);\r\n        this[1] = y*Math.cos(A) + x*Math.sin(A);\r\n      }\r\n\r\n      return this;\r\n    }\r\n\r\n    dot(b) {\r\n      return this[0]*b[0] + this[1]*b[1];\r\n    }\r\n\r\n    multVecMatrix(matrix) {\r\n      let x = this[0];\r\n      let y = this[1];\r\n\r\n      let w = 1.0;\r\n\r\n      this[0] = w*matrix.$matrix.m41 + x*matrix.$matrix.m11 + y*matrix.$matrix.m21;\r\n      this[1] = w*matrix.$matrix.m42 + x*matrix.$matrix.m12 + y*matrix.$matrix.m22;\r\n\r\n      if (matrix.isPersp) {\r\n        let w2 = w*matrix.$matrix.m44 + x*matrix.$matrix.m14 + y*matrix.$matrix.m24;\r\n\r\n        if (w2 !== 0.0) {\r\n          this[0] /= w2;\r\n          this[1] /= w2;\r\n        }\r\n      }\r\n\r\n      return this;\r\n    }\r\n\r\n    mulVecQuat(q) {\r\n      let t0 = -q[1]*this[0] - q[2]*this[1];\r\n      let t1 = q[0]*this[0] - q[3]*this[1];\r\n      let t2 = q[0]*this[1] + q[3]*this[0];\r\n\r\n      let z = q[1]*this[1] - q[2]*this[0];\r\n      this[0] = t1;\r\n      this[1] = t2;\r\n\r\n      t1 = t0* -q[1] + this[0]*q[0] - this[1]*q[3] + z*q[2];\r\n      t2 = t0* -q[2] + this[1]*q[0] - z*q[1] + this[0]*q[3];\r\n\r\n      this[0] = t1;\r\n      this[1] = t2;\r\n\r\n      return this;\r\n    }\r\n\r\n    vectorLengthSqr() {\r\n      return this.dot(this);\r\n    }\r\n\r\n    loadSTRUCT(reader) {\r\n      reader(this);\r\n\r\n      if (typeof this.vec !== undefined) {\r\n        this.load(this.vec);\r\n        this.vec = undefined;\r\n      }\r\n    }\r\n  };\r\n\r\n  temp1 = new Vector2();\r\n  temp2 = new Vector2();\r\n  temp3 = new Vector2();\r\n  temp4 = new Vector2();\r\n\r\n  return Vector2;\r\n}\r\n\r\nexport const Vector2 = makeVector2(BaseVector)\r\n\r\nlet _quat_vs3_temps = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport class Quat extends Vector4 {\r\n  makeUnitQuat() {\r\n    this[0] = 1.0;\r\n    this[1] = this[2] = this[3] = 0.0;\r\n  }\r\n\r\n  isZero() {\r\n    return (this[0] === 0 && this[1] === 0 && this[2] === 0 && this[3] === 0);\r\n  }\r\n\r\n  mulQuat(qt) {\r\n    let a = this[0]*qt[0] - this[1]*qt[1] - this[2]*qt[2] - this[3]*qt[3];\r\n    let b = this[0]*qt[1] + this[1]*qt[0] + this[2]*qt[3] - this[3]*qt[2];\r\n    let c = this[0]*qt[2] + this[2]*qt[0] + this[3]*qt[1] - this[1]*qt[3];\r\n    this[3] = this[0]*qt[3] + this[3]*qt[0] + this[1]*qt[2] - this[2]*qt[1];\r\n    this[0] = a;\r\n    this[1] = b;\r\n    this[2] = c;\r\n  }\r\n\r\n  conjugate() {\r\n    this[1] = -this[1];\r\n    this[2] = -this[2];\r\n    this[3] = -this[3];\r\n  }\r\n\r\n  dotWithQuat(q2) {\r\n    return this[0]*q2[0] + this[1]*q2[1] + this[2]*q2[2] + this[3]*q2[3];\r\n  }\r\n\r\n  invert() {\r\n    let f = this.dot(this);\r\n\r\n    if (f === 0.0)\r\n      return;\r\n\r\n    conjugate_qt(q);\r\n    this.mulscalar(1.0/f);\r\n  }\r\n\r\n  sub(q2) {\r\n    let nq2 = new Quat();\r\n\r\n    nq2[0] = -q2[0];\r\n    nq2[1] = q2[1];\r\n    nq2[2] = q2[2];\r\n    nq2[3] = q2[3];\r\n\r\n    this.mul(nq2);\r\n  }\r\n\r\n  mulScalarWithFactor(fac) {\r\n    let angle = fac*bounded_acos(this[0]);\r\n    let co = Math.cos(angle);\r\n    let si = Math.sin(angle);\r\n\r\n    this[0] = co;\r\n\r\n    let last3 = Vector3([this[1], this[2], this[3]]);\r\n    last3.normalize();\r\n    last3.mulScalar(si);\r\n    this[1] = last3[0];\r\n    this[2] = last3[1];\r\n    this[3] = last3[2];\r\n    return this;\r\n  }\r\n\r\n  toMatrix(m) {\r\n    if (m === undefined) {\r\n      m = new Matrix4();\r\n    }\r\n\r\n    let q0 = M_SQRT2*this[0];\r\n    let q1 = M_SQRT2*this[1];\r\n    let q2 = M_SQRT2*this[2];\r\n    let q3 = M_SQRT2*this[3];\r\n    let qda = q0*q1;\r\n    let qdb = q0*q2;\r\n    let qdc = q0*q3;\r\n    let qaa = q1*q1;\r\n    let qab = q1*q2;\r\n    let qac = q1*q3;\r\n    let qbb = q2*q2;\r\n    let qbc = q2*q3;\r\n    let qcc = q3*q3;\r\n    m.$matrix.m11 = (1.0 - qbb - qcc);\r\n    m.$matrix.m12 = (qdc + qab);\r\n    m.$matrix.m13 = (-qdb + qac);\r\n    m.$matrix.m14 = 0.0;\r\n    m.$matrix.m21 = (-qdc + qab);\r\n    m.$matrix.m22 = (1.0 - qaa - qcc);\r\n    m.$matrix.m23 = (qda + qbc);\r\n    m.$matrix.m24 = 0.0;\r\n    m.$matrix.m31 = (qdb + qac);\r\n    m.$matrix.m32 = (-qda + qbc);\r\n    m.$matrix.m33 = (1.0 - qaa - qbb);\r\n    m.$matrix.m34 = 0.0;\r\n    m.$matrix.m41 = m.$matrix.m42 = m.$matrix.m43 = 0.0;\r\n    m.$matrix.m44 = 1.0;\r\n\r\n    return m;\r\n  }\r\n\r\n  matrixToQuat(wmat) {\r\n    let mat = temp_mats.next();\r\n    mat.load(wmat);\r\n\r\n    mat.$matrix.m41 = mat.$matrix.m42 = mat.$matrix.m43 = 0;\r\n    mat.$matrix.m44 = 1.0;\r\n\r\n    let r1 = new Vector3([mat.$matrix.m11, mat.$matrix.m12, mat.$matrix.m13]);\r\n    let r2 = new Vector3([mat.$matrix.m21, mat.$matrix.m22, mat.$matrix.m23]);\r\n    let r3 = new Vector3([mat.$matrix.m31, mat.$matrix.m32, mat.$matrix.m33]);\r\n\r\n    r1.normalize();\r\n    r2.normalize();\r\n    r3.normalize();\r\n\r\n    mat.$matrix.m11 = r1[0];\r\n    mat.$matrix.m12 = r1[1];\r\n    mat.$matrix.m13 = r1[2];\r\n    mat.$matrix.m21 = r2[0];\r\n    mat.$matrix.m22 = r2[1];\r\n    mat.$matrix.m23 = r2[2];\r\n    mat.$matrix.m31 = r3[0];\r\n    mat.$matrix.m32 = r3[1];\r\n    mat.$matrix.m33 = r3[2];\r\n    let tr = 0.25*(1.0 + mat.$matrix.m11 + mat.$matrix.m22 + mat.$matrix.m33);\r\n    let s = 0;\r\n    if (tr > FLT_EPSILON) {\r\n      s = Math.sqrt(tr);\r\n      this[0] = s;\r\n      s = 1.0/(4.0*s);\r\n      this[1] = ((mat.$matrix.m23 - mat.$matrix.m32)*s);\r\n      this[2] = ((mat.$matrix.m31 - mat.$matrix.m13)*s);\r\n      this[3] = ((mat.$matrix.m12 - mat.$matrix.m21)*s);\r\n    } else {\r\n      if (mat.$matrix.m11 > mat.$matrix.m22 && mat.$matrix.m11 > mat.$matrix.m33) {\r\n        s = 2.0*Math.sqrt(1.0 + mat.$matrix.m11 - mat.$matrix.m22 - mat.$matrix.m33);\r\n        this[1] = (0.25*s);\r\n        s = 1.0/s;\r\n        this[0] = ((mat.$matrix.m32 - mat.$matrix.m23)*s);\r\n        this[2] = ((mat.$matrix.m21 + mat.$matrix.m12)*s);\r\n        this[3] = ((mat.$matrix.m31 + mat.$matrix.m13)*s);\r\n      } else if (mat.$matrix.m22 > mat.$matrix.m33) {\r\n        s = 2.0*Math.sqrt(1.0 + mat.$matrix.m22 - mat.$matrix.m11 - mat.$matrix.m33);\r\n        this[2] = (0.25*s);\r\n        s = 1.0/s;\r\n        this[0] = ((mat.$matrix.m31 - mat.$matrix.m13)*s);\r\n        this[1] = ((mat.$matrix.m21 + mat.$matrix.m12)*s);\r\n        this[3] = ((mat.$matrix.m32 + mat.$matrix.m23)*s);\r\n      } else {\r\n        s = 2.0*Math.sqrt(1.0 + mat.$matrix.m33 - mat.$matrix.m11 - mat.$matrix.m22);\r\n        this[3] = (0.25*s);\r\n        s = 1.0/s;\r\n        this[0] = ((mat.$matrix.m21 - mat.$matrix.m12)*s);\r\n        this[1] = ((mat.$matrix.m31 + mat.$matrix.m13)*s);\r\n        this[2] = ((mat.$matrix.m32 + mat.$matrix.m23)*s);\r\n      }\r\n    }\r\n    this.normalize();\r\n  }\r\n\r\n  normalize() {\r\n    let len = Math.sqrt(this.dot(this));\r\n\r\n    if (len !== 0.0) {\r\n      this.mulScalar(1.0/len);\r\n    } else {\r\n      this[1] = 1.0;\r\n      this[0] = this[2] = this[3] = 0.0;\r\n    }\r\n    return this;\r\n  }\r\n\r\n  axisAngleToQuat(axis, angle) {\r\n    let nor = _quat_vs3_temps.next().load(axis);\r\n    nor.normalize();\r\n\r\n    if (nor.dot(nor) !== 0.0) {\r\n      let phi = angle/2.0;\r\n      let si = Math.sin(phi);\r\n      this[0] = Math.cos(phi);\r\n      this[1] = nor[0]*si;\r\n      this[2] = nor[1]*si;\r\n      this[3] = nor[2]*si;\r\n    } else {\r\n      this.makeUnitQuat();\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  rotationBetweenVecs(v1, v2, fac = 1.0) {\r\n    v1 = new Vector3(v1);\r\n    v2 = new Vector3(v2);\r\n    v1.normalize();\r\n    v2.normalize();\r\n\r\n    if (Math.abs(v1.dot(v2)) > 0.9999) {\r\n      this.makeUnitQuat();\r\n      return this;\r\n    }\r\n\r\n    let axis = new Vector3(v1);\r\n    axis.cross(v2);\r\n\r\n    let angle = v1.preNormalizedAngle(v2)*fac;\r\n\r\n    this.axisAngleToQuat(axis, angle);\r\n\r\n    return this;\r\n  }\r\n\r\n  quatInterp(quat2, t) {\r\n    let quat = new Quat();\r\n    let cosom = this[0]*quat2[0] + this[1]*quat2[1] + this[2]*quat2[2] + this[3]*quat2[3];\r\n    if (cosom < 0.0) {\r\n      cosom = -cosom;\r\n      quat[0] = -this[0];\r\n      quat[1] = -this[1];\r\n      quat[2] = -this[2];\r\n      quat[3] = -this[3];\r\n    } else {\r\n      quat[0] = this[0];\r\n      quat[1] = this[1];\r\n      quat[2] = this[2];\r\n      quat[3] = this[3];\r\n    }\r\n\r\n    let omega, sinom, sc1, sc2;\r\n    if ((1.0 - cosom) > 0.0001) {\r\n      omega = Math.acos(cosom);\r\n      sinom = Math.sin(omega);\r\n      sc1 = Math.sin((1.0 - t)*omega)/sinom;\r\n      sc2 = Math.sin(t*omega)/sinom;\r\n    } else {\r\n      sc1 = 1.0 - t;\r\n      sc2 = t;\r\n    }\r\n    this[0] = sc1*quat[0] + sc2*quat2[0];\r\n    this[1] = sc1*quat[1] + sc2*quat2[1];\r\n    this[2] = sc1*quat[2] + sc2*quat2[2];\r\n    this[3] = sc1*quat[3] + sc2*quat2[3];\r\n\r\n    return this;\r\n  }\r\n};\r\n\r\nQuat.STRUCT = nstructjs.inherit(Quat, Vector4, 'quat') + `\r\n}\r\n`;\r\nnstructjs.register(Quat);\r\n\r\n_v3nd4_n1_normalizedDot4 = new Vector3();\r\n_v3nd4_n2_normalizedDot4 = new Vector3();\r\n_v3nd_n1_normalizedDot = new Vector3();\r\n_v3nd_n2_normalizedDot = new Vector3();\r\n\r\nBaseVector.inherit(Vector4, 4);\r\nF64BaseVector.inherit(Vector3, 3);\r\nBaseVector.inherit(Vector2, 2);\r\n\r\nlet lookat_cache_vs3;\r\nlet lookat_cache_vs4;\r\nlet lookat_cache_ms;\r\nlet euler_rotate_mats;\r\nlet makenormalcache;\r\nlet temp_mats;\r\n\r\nlet preMultTemp;\r\n\r\nlookat_cache_vs3 = util.cachering.fromConstructor(Vector3, 64);\r\nlookat_cache_vs4 = util.cachering.fromConstructor(Vector4, 64);\r\n\r\nmakenormalcache = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nlet $_v3nd_n1_normalizedDot = new Vector3();\r\nlet $_v3nd_n2_normalizedDot = new Vector3();\r\nlet $_v3nd4_n1_normalizedDot4 = new Vector3();\r\nlet $_v3nd4_n2_normalizedDot4 = new Vector3();\r\nlet $_v3nd4_n1_normalizedDot3 = new Vector3();\r\nlet $_v3nd4_n2_normalizedDot3 = new Vector3();\r\n\r\nclass internal_matrix {\r\n  constructor() {\r\n    this.m11 = 1.0;\r\n    this.m12 = 0.0;\r\n    this.m13 = 0.0;\r\n    this.m14 = 0.0;\r\n    this.m21 = 0.0;\r\n    this.m22 = 1.0;\r\n    this.m23 = 0.0;\r\n    this.m24 = 0.0;\r\n    this.m31 = 0.0;\r\n    this.m32 = 0.0;\r\n    this.m33 = 1.0;\r\n    this.m34 = 0.0;\r\n    this.m41 = 0.0;\r\n    this.m42 = 0.0;\r\n    this.m43 = 0.0;\r\n    this.m44 = 1.0;\r\n  }\r\n}\r\n\r\n/** Incredibly old matrix class. */\r\nexport class Matrix4 {\r\n  constructor(m) {\r\n    this.$matrix = new internal_matrix();\r\n    this.isPersp = false;\r\n\r\n    if (typeof m === 'object') {\r\n      if (\"length\" in m && m.length >= 16) {\r\n        this.load(m);\r\n      } else if (m instanceof Matrix4) {\r\n        this.load(m);\r\n      }\r\n    }\r\n  }\r\n\r\n  static fromJSON() {\r\n    let mat = new Matrix4();\r\n    mat.load(json.items);\r\n    mat.isPersp = json.isPersp;\r\n    return mat;\r\n  }\r\n\r\n  copy() {\r\n    return this.clone();\r\n  }\r\n\r\n  clone() {\r\n    return new Matrix4(this);\r\n  }\r\n\r\n  addToHashDigest(hash) {\r\n    let m = this.$matrix;\r\n\r\n    hash.add(m.m11);\r\n    hash.add(m.m12);\r\n    hash.add(m.m13);\r\n    hash.add(m.m14);\r\n\r\n    hash.add(m.m21);\r\n    hash.add(m.m22);\r\n    hash.add(m.m23);\r\n    hash.add(m.m24);\r\n\r\n    hash.add(m.m31);\r\n    hash.add(m.m32);\r\n    hash.add(m.m33);\r\n    hash.add(m.m34);\r\n\r\n    hash.add(m.m41);\r\n    hash.add(m.m42);\r\n    hash.add(m.m43);\r\n    hash.add(m.m44);\r\n\r\n    return this;\r\n  }\r\n\r\n  equals(m) {\r\n    let m1 = this.$matrix;\r\n    let m2 = m.$matrix;\r\n\r\n    let ok = 1;\r\n\r\n    ok = ok && m1.m11 === m2.m11;\r\n    ok = ok && m1.m12 === m2.m12;\r\n    ok = ok && m1.m13 === m2.m13;\r\n    ok = ok && m1.m14 === m2.m14;\r\n\r\n    ok = ok && m1.m21 === m2.m21;\r\n    ok = ok && m1.m22 === m2.m22;\r\n    ok = ok && m1.m23 === m2.m23;\r\n    ok = ok && m1.m24 === m2.m24;\r\n\r\n    ok = ok && m1.m31 === m2.m31;\r\n    ok = ok && m1.m32 === m2.m32;\r\n    ok = ok && m1.m33 === m2.m33;\r\n    ok = ok && m1.m34 === m2.m34;\r\n\r\n    ok = ok && m1.m41 === m2.m41;\r\n    ok = ok && m1.m42 === m2.m42;\r\n    ok = ok && m1.m43 === m2.m43;\r\n    ok = ok && m1.m44 === m2.m44;\r\n\r\n    return ok;\r\n  }\r\n\r\n  loadColumn(i, vec) {\r\n    let m = this.$matrix;\r\n    let have4 = vec.length > 3;\r\n\r\n    switch (i) {\r\n      case 0:\r\n        m.m11 = vec[0];\r\n        m.m21 = vec[1];\r\n        m.m31 = vec[2];\r\n        if (have4) {\r\n          m.m41 = vec[3];\r\n        }\r\n        break;\r\n      case 1:\r\n        m.m12 = vec[0];\r\n        m.m22 = vec[1];\r\n        m.m32 = vec[2];\r\n        if (have4) {\r\n          m.m42 = vec[3];\r\n        }\r\n        break;\r\n      case 2:\r\n        m.m13 = vec[0];\r\n        m.m23 = vec[1];\r\n        m.m33 = vec[2];\r\n        if (have4) {\r\n          m.m43 = vec[3];\r\n        }\r\n        break;\r\n      case 3:\r\n        m.m14 = vec[0];\r\n        m.m24 = vec[1];\r\n        m.m34 = vec[2];\r\n        if (have4) {\r\n          m.m44 = vec[3];\r\n        }\r\n        break;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  copyColumnTo(i, vec) {\r\n    let m = this.$matrix;\r\n    let have4 = vec.length > 3;\r\n\r\n    switch (i) {\r\n      case 0:\r\n        vec[0] = m.m11;\r\n        vec[1] = m.m21;\r\n        vec[2] = m.m31;\r\n        if (have4) {\r\n          vec[3] = m.m41;\r\n        }\r\n        break;\r\n      case 1:\r\n        vec[0] = m.m12;\r\n        vec[1] = m.m22;\r\n        vec[2] = m.m32;\r\n        if (have4) {\r\n          vec[3] = m.m42;\r\n        }\r\n        break;\r\n      case 2:\r\n        vec[0] = m.m13;\r\n        vec[1] = m.m23;\r\n        vec[2] = m.m33;\r\n        if (have4) {\r\n          vec[3] = m.m43;\r\n        }\r\n        break;\r\n      case 3:\r\n        vec[0] = m.m14;\r\n        vec[1] = m.m24;\r\n        vec[2] = m.m34;\r\n        if (have4) {\r\n          vec[3] = m.m44;\r\n        }\r\n        break;\r\n    }\r\n\r\n    return vec;\r\n  }\r\n\r\n  copyColumn(i) {\r\n    return this.copyColumnTo(i, new Vector3());\r\n  }\r\n\r\n  load() {\r\n    if (arguments.length === 1 && typeof arguments[0] === 'object') {\r\n      let matrix;\r\n      if (arguments[0] instanceof Matrix4) {\r\n        matrix = arguments[0].$matrix;\r\n        this.isPersp = arguments[0].isPersp;\r\n        this.$matrix.m11 = matrix.m11;\r\n        this.$matrix.m12 = matrix.m12;\r\n        this.$matrix.m13 = matrix.m13;\r\n        this.$matrix.m14 = matrix.m14;\r\n        this.$matrix.m21 = matrix.m21;\r\n        this.$matrix.m22 = matrix.m22;\r\n        this.$matrix.m23 = matrix.m23;\r\n        this.$matrix.m24 = matrix.m24;\r\n        this.$matrix.m31 = matrix.m31;\r\n        this.$matrix.m32 = matrix.m32;\r\n        this.$matrix.m33 = matrix.m33;\r\n        this.$matrix.m34 = matrix.m34;\r\n        this.$matrix.m41 = matrix.m41;\r\n        this.$matrix.m42 = matrix.m42;\r\n        this.$matrix.m43 = matrix.m43;\r\n        this.$matrix.m44 = matrix.m44;\r\n        return this;\r\n      } else\r\n        matrix = arguments[0];\r\n      if (\"length\" in matrix && matrix.length >= 16) {\r\n        this.$matrix.m11 = matrix[0];\r\n        this.$matrix.m12 = matrix[1];\r\n        this.$matrix.m13 = matrix[2];\r\n        this.$matrix.m14 = matrix[3];\r\n        this.$matrix.m21 = matrix[4];\r\n        this.$matrix.m22 = matrix[5];\r\n        this.$matrix.m23 = matrix[6];\r\n        this.$matrix.m24 = matrix[7];\r\n        this.$matrix.m31 = matrix[8];\r\n        this.$matrix.m32 = matrix[9];\r\n        this.$matrix.m33 = matrix[10];\r\n        this.$matrix.m34 = matrix[11];\r\n        this.$matrix.m41 = matrix[12];\r\n        this.$matrix.m42 = matrix[13];\r\n        this.$matrix.m43 = matrix[14];\r\n        this.$matrix.m44 = matrix[15];\r\n        return this;\r\n      }\r\n    }\r\n\r\n    this.makeIdentity();\r\n\r\n    return this;\r\n  }\r\n\r\n  toJSON() {\r\n    return {isPersp: this.isPersp, items: this.getAsArray()}\r\n  }\r\n\r\n  getAsArray() {\r\n    return [this.$matrix.m11, this.$matrix.m12, this.$matrix.m13, this.$matrix.m14, this.$matrix.m21, this.$matrix.m22,\r\n            this.$matrix.m23, this.$matrix.m24, this.$matrix.m31, this.$matrix.m32, this.$matrix.m33, this.$matrix.m34,\r\n            this.$matrix.m41, this.$matrix.m42, this.$matrix.m43, this.$matrix.m44];\r\n  }\r\n\r\n  getAsFloat32Array() {\r\n    return new Float32Array(this.getAsArray());\r\n  }\r\n\r\n  setUniform(ctx, loc, transpose) {\r\n    if (Matrix4.setUniformArray === undefined) {\r\n      Matrix4.setUniformWebGLArray = new Float32Array(16);\r\n      Matrix4.setUniformArray = new Array(16);\r\n    }\r\n\r\n    Matrix4.setUniformArray[0] = this.$matrix.m11;\r\n    Matrix4.setUniformArray[1] = this.$matrix.m12;\r\n    Matrix4.setUniformArray[2] = this.$matrix.m13;\r\n    Matrix4.setUniformArray[3] = this.$matrix.m14;\r\n    Matrix4.setUniformArray[4] = this.$matrix.m21;\r\n    Matrix4.setUniformArray[5] = this.$matrix.m22;\r\n    Matrix4.setUniformArray[6] = this.$matrix.m23;\r\n    Matrix4.setUniformArray[7] = this.$matrix.m24;\r\n    Matrix4.setUniformArray[8] = this.$matrix.m31;\r\n    Matrix4.setUniformArray[9] = this.$matrix.m32;\r\n    Matrix4.setUniformArray[10] = this.$matrix.m33;\r\n    Matrix4.setUniformArray[11] = this.$matrix.m34;\r\n    Matrix4.setUniformArray[12] = this.$matrix.m41;\r\n    Matrix4.setUniformArray[13] = this.$matrix.m42;\r\n    Matrix4.setUniformArray[14] = this.$matrix.m43;\r\n    Matrix4.setUniformArray[15] = this.$matrix.m44;\r\n\r\n    Matrix4.setUniformWebGLArray.set(Matrix4.setUniformArray);\r\n\r\n    ctx.uniformMatrix4fv(loc, transpose, Matrix4.setUniformWebGLArray);\r\n\r\n    return this;\r\n  }\r\n\r\n  makeIdentity() {\r\n    this.$matrix.m11 = 1;\r\n    this.$matrix.m12 = 0;\r\n    this.$matrix.m13 = 0;\r\n    this.$matrix.m14 = 0;\r\n    this.$matrix.m21 = 0;\r\n    this.$matrix.m22 = 1;\r\n    this.$matrix.m23 = 0;\r\n    this.$matrix.m24 = 0;\r\n    this.$matrix.m31 = 0;\r\n    this.$matrix.m32 = 0;\r\n    this.$matrix.m33 = 1;\r\n    this.$matrix.m34 = 0;\r\n    this.$matrix.m41 = 0;\r\n    this.$matrix.m42 = 0;\r\n    this.$matrix.m43 = 0;\r\n    this.$matrix.m44 = 1;\r\n\r\n    //drop isPersp\r\n    this.isPersp = false;\r\n\r\n    return this;\r\n  }\r\n\r\n  transpose() {\r\n    let tmp = this.$matrix.m12;\r\n    this.$matrix.m12 = this.$matrix.m21;\r\n    this.$matrix.m21 = tmp;\r\n    tmp = this.$matrix.m13;\r\n    this.$matrix.m13 = this.$matrix.m31;\r\n    this.$matrix.m31 = tmp;\r\n    tmp = this.$matrix.m14;\r\n    this.$matrix.m14 = this.$matrix.m41;\r\n    this.$matrix.m41 = tmp;\r\n    tmp = this.$matrix.m23;\r\n    this.$matrix.m23 = this.$matrix.m32;\r\n    this.$matrix.m32 = tmp;\r\n    tmp = this.$matrix.m24;\r\n    this.$matrix.m24 = this.$matrix.m42;\r\n    this.$matrix.m42 = tmp;\r\n    tmp = this.$matrix.m34;\r\n    this.$matrix.m34 = this.$matrix.m43;\r\n    this.$matrix.m43 = tmp;\r\n\r\n    return this;\r\n  }\r\n\r\n  determinant() {\r\n    return this._determinant4x4();\r\n  }\r\n\r\n  invert() {\r\n    let det = this._determinant4x4();\r\n\r\n    if (Math.abs(det) < 1e-08)\r\n      return null;\r\n\r\n    this._makeAdjoint();\r\n\r\n    this.$matrix.m11 /= det;\r\n    this.$matrix.m12 /= det;\r\n    this.$matrix.m13 /= det;\r\n    this.$matrix.m14 /= det;\r\n    this.$matrix.m21 /= det;\r\n    this.$matrix.m22 /= det;\r\n    this.$matrix.m23 /= det;\r\n    this.$matrix.m24 /= det;\r\n    this.$matrix.m31 /= det;\r\n    this.$matrix.m32 /= det;\r\n    this.$matrix.m33 /= det;\r\n    this.$matrix.m34 /= det;\r\n    this.$matrix.m41 /= det;\r\n    this.$matrix.m42 /= det;\r\n    this.$matrix.m43 /= det;\r\n    this.$matrix.m44 /= det;\r\n\r\n    return this;\r\n  }\r\n\r\n  translate(x, y, z) {\r\n    if (typeof x === 'object' && \"length\" in x) {\r\n      let t = x;\r\n\r\n      x = t[0];\r\n      y = t[1];\r\n      z = t[2];\r\n    }\r\n\r\n    x = x === undefined ? 0 : x;\r\n    y = y === undefined ? 0 : y;\r\n    z = z === undefined ? 0 : z;\r\n\r\n    let matrix = temp_mats.next().makeIdentity();\r\n\r\n    matrix.$matrix.m41 = x;\r\n    matrix.$matrix.m42 = y;\r\n    matrix.$matrix.m43 = z;\r\n\r\n    this.multiply(matrix);\r\n    return this;\r\n  }\r\n\r\n  preTranslate(x, y, z) {\r\n    if (typeof x === 'object' && \"length\" in x) {\r\n      let t = x;\r\n\r\n      x = t[0];\r\n      y = t[1];\r\n      z = t[2];\r\n    }\r\n\r\n    x = x === undefined ? 0 : x;\r\n    y = y === undefined ? 0 : y;\r\n    z = z === undefined ? 0 : z;\r\n\r\n    let matrix = temp_mats.next().makeIdentity();\r\n\r\n    matrix.$matrix.m41 = x;\r\n    matrix.$matrix.m42 = y;\r\n    matrix.$matrix.m43 = z;\r\n\r\n    this.preMultiply(matrix);\r\n    return this;\r\n  }\r\n\r\n  scale(x, y, z, w = 1.0) {\r\n    if (typeof x === 'object' && \"length\" in x) {\r\n      let t = x;\r\n      x = t[0];\r\n      y = t[1];\r\n      z = t[2];\r\n    } else {\r\n      if (x === undefined)\r\n        x = 1;\r\n\r\n      if (z === undefined) {\r\n        if (y === undefined) {\r\n          y = x;\r\n          z = x;\r\n        } else {\r\n          z = x;\r\n        }\r\n      } else if (y === undefined) {\r\n        y = x;\r\n      }\r\n    }\r\n\r\n\r\n    let matrix = temp_mats.next().makeIdentity();\r\n    matrix.$matrix.m11 = x;\r\n    matrix.$matrix.m22 = y;\r\n    matrix.$matrix.m33 = z;\r\n    matrix.$matrix.m44 = w;\r\n    this.multiply(matrix);\r\n    return this\r\n  }\r\n\r\n  preScale(x, y, z, w = 1.0) {\r\n    let mat = temp_mats.next().makeIdentity();\r\n    mat.scale(x, y, z, w);\r\n\r\n    this.preMultiply(mat);\r\n    return this\r\n  }\r\n\r\n  /*\r\n  on factor;\r\n  off period;\r\n\r\n  c1 := cx; comment: cos(thx);\r\n  s1 := sx; comment: sin(thx);\r\n\r\n  c2 := cy; comment: cos(thy);\r\n  s2 := sy; comment: sin(thy);\r\n\r\n  c3 := cz; comment: cos(thz);\r\n  s3 := sz; comment: sin(thz);\r\n\r\n  cx := cos(thx);\r\n  sx := sin(thx);\r\n  cy := cos(thy);\r\n  sy := sin(thy);\r\n  cz := cos(thz);\r\n  sz := sin(thz);\r\n\r\n  imat := mat((1, 0, 0, 0),\r\n              (0, 1, 0, 0),\r\n              (0, 0, 1, 0),\r\n              (0, 0, 0, 1));\r\n\r\n  xmat :=mat((1,  0,  0,  0),\r\n             (0, c1, -s1, 0),\r\n             (0, s1,  c1, 0),\r\n             (0,  0,  0,  0));\r\n\r\n  ymat :=mat((c2, 0, s2, 0),\r\n             (0,  1,  0,  0),\r\n             (-s2, 0,  c2, 0),\r\n             (0,  0,  0,  0));\r\n\r\n  zmat :=mat(( c3, -s3, 0, 0),\r\n             (s3, c3, 0, 0),\r\n             ( 0,  0,  1, 0),\r\n             ( 0,  0,  0, 0));\r\n\r\n  mmat := mat((m11, m21, m31, 0),\r\n              (m12, m22, m32, 0),\r\n              (m13, m23, m33, 0),\r\n              (0,   0,   0,   0));\r\n\r\n  fmat := zmat * ymat * xmat;\r\n\r\n  f1 := m11**2 + m12**2 + m13**2 - 1.0;\r\n  f2 := m21**2 + m22**2 + m23**2 - 1.0;\r\n  f3 := m31**2 + m32**2 + m33**2 - 1.0;\r\n\r\n  tmat := fmat * mmat;\r\n  f1 := tmat(1, 1) - 1.0;\r\n  f2 := tmat(2, 2) - 1.0;\r\n  f3 := tmat(3, 3) - 1.0;\r\n\r\n  operator myasin;\r\n\r\n  fthy := asin(mmat(3, 1));\r\n  f1 := mmat(3,1)**2 + mmat(2,1)**2 + mmat(1,1)**2 = 1.0;\r\n\r\n  fmat2 := sub(thy=fthy, fmat);\r\n\r\n  fmat3 := fmat2 * (tp mmat);\r\n  ffz := solve(fmat2(1, 1) - m11, thz);\r\n  ffx := solve(fmat2(3, 3) - m33, thx);\r\n\r\n  fthz := part(ffz, 1, 2);\r\n  fthx := part(ffx, 1, 2);\r\n\r\n  sub(thx=fthx, thy=fthy, thz=fthz, fmat);\r\n\r\n(cos(thy)*cos(thz),         cos(thx)*sin(thz)-cos(thz)*sin(thx)*sin(thy),  -(cos(thx)*cos(thz)*sin(thy)+sin(thx)*sin(thz)), 0),\r\n\r\n(-cos(thy)*sin(thz),        cos(thx)*cos(thz) + sin(thx)*sin(thy)*sin(thz),  cos(thx)*sin(thy)*sin(thz)-cos(thz)*sin(thx), 0),\r\n\r\n(sin(thy),                  cos(thy)*sin(thx),                               cos(thx)*cos(thy),  0),\r\n\r\n    (0,0,0,1))\r\n\r\n  */\r\n\r\n  euler_rotate_order(x, y, z, order = EulerOrders.XYZ) {\r\n    if (y === undefined) {\r\n      y = 0.0;\r\n    }\r\n    if (z === undefined) {\r\n      z = 0.0;\r\n    }\r\n\r\n    x = -x;\r\n    y = -y;\r\n    z = -z;\r\n\r\n    let xmat = euler_rotate_mats.next().makeIdentity();\r\n\r\n    let m = xmat.$matrix;\r\n\r\n    let c = Math.cos(x), s = Math.sin(x);\r\n\r\n    m.m22 = c;\r\n    m.m23 = s;\r\n    m.m32 = -s;\r\n    m.m33 = c;\r\n\r\n    let ymat = euler_rotate_mats.next().makeIdentity();\r\n    c = Math.cos(y);\r\n    s = Math.sin(y);\r\n    m = ymat.$matrix;\r\n\r\n    m.m11 = c;\r\n    m.m13 = -s;\r\n    m.m31 = s;\r\n    m.m33 = c;\r\n\r\n    let zmat = euler_rotate_mats.next().makeIdentity();\r\n    c = Math.cos(z);\r\n    s = Math.sin(z);\r\n    m = zmat.$matrix;\r\n\r\n    m.m11 = c;\r\n    m.m12 = s;\r\n    m.m21 = -s;\r\n    m.m22 = c;\r\n\r\n    let a, b;\r\n\r\n    switch (order) {\r\n      case EulerOrders.XYZ:\r\n        a = xmat;\r\n        b = ymat;\r\n        c = zmat;\r\n        break;\r\n      case EulerOrders.XZY:\r\n        a = xmat;\r\n        b = zmat;\r\n        c = ymat;\r\n        break;\r\n      case EulerOrders.YXZ:\r\n        a = ymat;\r\n        b = xmat;\r\n        c = zmat;\r\n        break;\r\n      case EulerOrders.YZX:\r\n        a = ymat;\r\n        b = zmat;\r\n        c = xmat;\r\n        break;\r\n      case EulerOrders.ZXY:\r\n        a = zmat;\r\n        b = xmat;\r\n        c = ymat;\r\n        break;\r\n      case EulerOrders.ZYX:\r\n        a = zmat;\r\n        b = ymat;\r\n        c = xmat;\r\n        break;\r\n    }\r\n\r\n    b.preMultiply(c);\r\n    b.multiply(a);\r\n\r\n    this.preMultiply(b);\r\n\r\n    return this;\r\n  }\r\n\r\n  euler_rotate(x, y, z) {\r\n    if (y === undefined) {\r\n      y = 0.0;\r\n    }\r\n    if (z === undefined) {\r\n      z = 0.0;\r\n    }\r\n    window.Matrix4 = Matrix4;\r\n\r\n    let xmat = euler_rotate_mats.next().makeIdentity();\r\n    let m = xmat.$matrix;\r\n\r\n    let c = Math.cos(x), s = Math.sin(x);\r\n\r\n    m.m22 = c;\r\n    m.m23 = s;\r\n    m.m32 = -s;\r\n    m.m33 = c;\r\n\r\n    let ymat = euler_rotate_mats.next().makeIdentity();\r\n    c = Math.cos(y);\r\n    s = Math.sin(y);\r\n    m = ymat.$matrix;\r\n\r\n    m.m11 = c;\r\n    m.m13 = -s;\r\n    m.m31 = s;\r\n    m.m33 = c;\r\n\r\n    ymat.multiply(xmat);\r\n\r\n    let zmat = euler_rotate_mats.next().makeIdentity();\r\n    c = Math.cos(z);\r\n    s = Math.sin(z);\r\n    m = zmat.$matrix;\r\n\r\n    m.m11 = c;\r\n    m.m12 = s;\r\n    m.m21 = -s;\r\n    m.m22 = c;\r\n\r\n    zmat.multiply(ymat);\r\n\r\n    //console.log(\"\"+ymat);\r\n    //this.multiply(zmat);\r\n    this.preMultiply(zmat);\r\n\r\n    return this;\r\n  }\r\n\r\n  toString() {\r\n    let s = \"\"\r\n    let m = this.$matrix;\r\n\r\n    function dec(d) {\r\n      let ret = d.toFixed(3);\r\n\r\n      if (ret[0] !== \"-\") //make room for negative signs\r\n        ret = \" \" + ret\r\n      return ret\r\n    }\r\n\r\n    s = dec(m.m11) + \", \" + dec(m.m12) + \", \" + dec(m.m13) + \", \" + dec(m.m14) + \"\\n\";\r\n    s += dec(m.m21) + \", \" + dec(m.m22) + \", \" + dec(m.m23) + \", \" + dec(m.m24) + \"\\n\";\r\n    s += dec(m.m31) + \", \" + dec(m.m32) + \", \" + dec(m.m33) + \", \" + dec(m.m34) + \"\\n\";\r\n    s += dec(m.m41) + \", \" + dec(m.m42) + \", \" + dec(m.m43) + \", \" + dec(m.m44) + \"\\n\";\r\n\r\n    return s\r\n  }\r\n\r\n  rotate(angle, x, y, z) {\r\n    if (typeof x === 'object' && \"length\" in x) {\r\n      let t = x;\r\n      x = t[0];\r\n      y = t[1];\r\n      z = t[2];\r\n    } else {\r\n      if (arguments.length === 1) {\r\n        x = y = 0;\r\n        z = 1;\r\n      } else if (arguments.length === 3) {\r\n        this.rotate(angle, 1, 0, 0);\r\n        this.rotate(x, 0, 1, 0);\r\n        this.rotate(y, 0, 0, 1);\r\n        return;\r\n      }\r\n    }\r\n\r\n    angle /= 2;\r\n    let sinA = Math.sin(angle);\r\n    let cosA = Math.cos(angle);\r\n    let sinA2 = sinA*sinA;\r\n    let len = Math.sqrt(x*x + y*y + z*z);\r\n\r\n    if (len === 0) {\r\n      x = 0;\r\n      y = 0;\r\n      z = 1;\r\n    } else if (len !== 1) {\r\n      x /= len;\r\n      y /= len;\r\n      z /= len;\r\n    }\r\n\r\n    let mat = temp_mats.next().makeIdentity();\r\n\r\n    if (x === 1 && y === 0 && z === 0) {\r\n      mat.$matrix.m11 = 1;\r\n      mat.$matrix.m12 = 0;\r\n      mat.$matrix.m13 = 0;\r\n      mat.$matrix.m21 = 0;\r\n      mat.$matrix.m22 = 1 - 2*sinA2;\r\n      mat.$matrix.m23 = 2*sinA*cosA;\r\n      mat.$matrix.m31 = 0;\r\n      mat.$matrix.m32 = -2*sinA*cosA;\r\n      mat.$matrix.m33 = 1 - 2*sinA2;\r\n      mat.$matrix.m14 = mat.$matrix.m24 = mat.$matrix.m34 = 0;\r\n      mat.$matrix.m41 = mat.$matrix.m42 = mat.$matrix.m43 = 0;\r\n      mat.$matrix.m44 = 1;\r\n    } else if (x === 0 && y === 1 && z === 0) {\r\n      mat.$matrix.m11 = 1 - 2*sinA2;\r\n      mat.$matrix.m12 = 0;\r\n      mat.$matrix.m13 = -2*sinA*cosA;\r\n      mat.$matrix.m21 = 0;\r\n      mat.$matrix.m22 = 1;\r\n      mat.$matrix.m23 = 0;\r\n      mat.$matrix.m31 = 2*sinA*cosA;\r\n      mat.$matrix.m32 = 0;\r\n      mat.$matrix.m33 = 1 - 2*sinA2;\r\n      mat.$matrix.m14 = mat.$matrix.m24 = mat.$matrix.m34 = 0;\r\n      mat.$matrix.m41 = mat.$matrix.m42 = mat.$matrix.m43 = 0;\r\n      mat.$matrix.m44 = 1;\r\n    } else if (x === 0 && y === 0 && z === 1) {\r\n      mat.$matrix.m11 = 1 - 2*sinA2;\r\n      mat.$matrix.m12 = 2*sinA*cosA;\r\n      mat.$matrix.m13 = 0;\r\n      mat.$matrix.m21 = -2*sinA*cosA;\r\n      mat.$matrix.m22 = 1 - 2*sinA2;\r\n      mat.$matrix.m23 = 0;\r\n      mat.$matrix.m31 = 0;\r\n      mat.$matrix.m32 = 0;\r\n      mat.$matrix.m33 = 1;\r\n      mat.$matrix.m14 = mat.$matrix.m24 = mat.$matrix.m34 = 0;\r\n      mat.$matrix.m41 = mat.$matrix.m42 = mat.$matrix.m43 = 0;\r\n      mat.$matrix.m44 = 1;\r\n    } else {\r\n      let x2 = x*x;\r\n      let y2 = y*y;\r\n      let z2 = z*z;\r\n      mat.$matrix.m11 = 1 - 2*(y2 + z2)*sinA2;\r\n      mat.$matrix.m12 = 2*(x*y*sinA2 + z*sinA*cosA);\r\n      mat.$matrix.m13 = 2*(x*z*sinA2 - y*sinA*cosA);\r\n      mat.$matrix.m21 = 2*(y*x*sinA2 - z*sinA*cosA);\r\n      mat.$matrix.m22 = 1 - 2*(z2 + x2)*sinA2;\r\n      mat.$matrix.m23 = 2*(y*z*sinA2 + x*sinA*cosA);\r\n      mat.$matrix.m31 = 2*(z*x*sinA2 + y*sinA*cosA);\r\n      mat.$matrix.m32 = 2*(z*y*sinA2 - x*sinA*cosA);\r\n      mat.$matrix.m33 = 1 - 2*(x2 + y2)*sinA2;\r\n      mat.$matrix.m14 = mat.$matrix.m24 = mat.$matrix.m34 = 0;\r\n      mat.$matrix.m41 = mat.$matrix.m42 = mat.$matrix.m43 = 0;\r\n      mat.$matrix.m44 = 1;\r\n    }\r\n    this.multiply(mat);\r\n\r\n    return this;\r\n  }\r\n\r\n  normalize() {\r\n    let m = this.$matrix;\r\n\r\n    let v1 = new Vector4([m.m11, m.m12, m.m13, m.m14]);\r\n    let v2 = new Vector4([m.m21, m.m22, m.m23, m.m24]);\r\n    let v3 = new Vector4([m.m31, m.m32, m.m33, m.m34]);\r\n    let v4 = new Vector4([m.m41, m.m42, m.m43, m.m44]);\r\n\r\n    v1.normalize();\r\n    v2.normalize();\r\n    v3.normalize();\r\n\r\n    let flat = new Array().concat(v1).concat(v2).concat(v3).concat(v4);\r\n    this.load(flat);\r\n\r\n    return this;\r\n  }\r\n\r\n  clearTranslation(set_w_to_one = false) {\r\n    let m = this.$matrix;\r\n\r\n    m.m41 = m.m42 = m.m43 = 0.0;\r\n\r\n    if (set_w_to_one) {\r\n      m.m44 = 1.0;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  setTranslation(x, y, z, resetW = true) {\r\n    if (typeof x === \"object\") {\r\n      y = x[1];\r\n      z = x[2];\r\n      x = x[0];\r\n    }\r\n\r\n    let m = this.$matrix;\r\n\r\n    m.m41 = x;\r\n    m.m42 = y;\r\n    m.m43 = z;\r\n\r\n    if (resetW) {\r\n      m.m44 = 1.0;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  //this is really like the lookAt method, isn't it.\r\n  makeNormalMatrix(normal, up = undefined) {\r\n    if (normal === undefined) {\r\n      throw new Error(\"normal cannot be undefined\");\r\n    }\r\n\r\n    let n = makenormalcache.next().load(normal).normalize();\r\n\r\n    if (up === undefined) {\r\n      up = makenormalcache.next().zero();\r\n\r\n      if (Math.abs(n[2]) > 0.95) {\r\n        up[1] = 1.0;\r\n      } else {\r\n        up[2] = 1.0;\r\n      }\r\n    }\r\n\r\n    up = makenormalcache.next().load(up);\r\n\r\n    up.normalize();\r\n\r\n    if (up.dot(normal) > 0.99) {\r\n      this.makeIdentity();\r\n      return this;\r\n    } else if (up.dot(normal) < -0.99) {\r\n      this.makeIdentity();\r\n      this.scale(1.0, 1.0, -1.0);\r\n      return this;\r\n    }\r\n\r\n    let x = makenormalcache.next();\r\n    let y = makenormalcache.next();\r\n\r\n    x.load(n).cross(up).normalize();\r\n    y.load(x).cross(n).normalize();\r\n    //y.negate();\r\n\r\n    this.makeIdentity();\r\n    let m = this.$matrix;\r\n\r\n    m.m11 = x[0];\r\n    m.m12 = x[1];\r\n    m.m13 = x[2];\r\n\r\n    m.m21 = y[0];\r\n    m.m22 = y[1];\r\n    m.m23 = y[2];\r\n\r\n    m.m31 = n[0];\r\n    m.m32 = n[1];\r\n    m.m33 = n[2];\r\n    m.m44 = 1.0;\r\n\r\n    return this;\r\n  }\r\n\r\n  preMultiply(mat) {\r\n    preMultTemp.load(mat);\r\n    preMultTemp.multiply(this);\r\n\r\n    this.load(preMultTemp);\r\n\r\n    return this;\r\n  }\r\n\r\n  multiply(mat) {\r\n    let mm = this.$matrix;\r\n    let mm2 = mat.$matrix;\r\n\r\n    let m11 = (mm2.m11*mm.m11 + mm2.m12*mm.m21 + mm2.m13*mm.m31 + mm2.m14*mm.m41);\r\n    let m12 = (mm2.m11*mm.m12 + mm2.m12*mm.m22 + mm2.m13*mm.m32 + mm2.m14*mm.m42);\r\n    let m13 = (mm2.m11*mm.m13 + mm2.m12*mm.m23 + mm2.m13*mm.m33 + mm2.m14*mm.m43);\r\n    let m14 = (mm2.m11*mm.m14 + mm2.m12*mm.m24 + mm2.m13*mm.m34 + mm2.m14*mm.m44);\r\n    let m21 = (mm2.m21*mm.m11 + mm2.m22*mm.m21 + mm2.m23*mm.m31 + mm2.m24*mm.m41);\r\n    let m22 = (mm2.m21*mm.m12 + mm2.m22*mm.m22 + mm2.m23*mm.m32 + mm2.m24*mm.m42);\r\n    let m23 = (mm2.m21*mm.m13 + mm2.m22*mm.m23 + mm2.m23*mm.m33 + mm2.m24*mm.m43);\r\n    let m24 = (mm2.m21*mm.m14 + mm2.m22*mm.m24 + mm2.m23*mm.m34 + mm2.m24*mm.m44);\r\n    let m31 = (mm2.m31*mm.m11 + mm2.m32*mm.m21 + mm2.m33*mm.m31 + mm2.m34*mm.m41);\r\n    let m32 = (mm2.m31*mm.m12 + mm2.m32*mm.m22 + mm2.m33*mm.m32 + mm2.m34*mm.m42);\r\n    let m33 = (mm2.m31*mm.m13 + mm2.m32*mm.m23 + mm2.m33*mm.m33 + mm2.m34*mm.m43);\r\n    let m34 = (mm2.m31*mm.m14 + mm2.m32*mm.m24 + mm2.m33*mm.m34 + mm2.m34*mm.m44);\r\n    let m41 = (mm2.m41*mm.m11 + mm2.m42*mm.m21 + mm2.m43*mm.m31 + mm2.m44*mm.m41);\r\n    let m42 = (mm2.m41*mm.m12 + mm2.m42*mm.m22 + mm2.m43*mm.m32 + mm2.m44*mm.m42);\r\n    let m43 = (mm2.m41*mm.m13 + mm2.m42*mm.m23 + mm2.m43*mm.m33 + mm2.m44*mm.m43);\r\n    let m44 = (mm2.m41*mm.m14 + mm2.m42*mm.m24 + mm2.m43*mm.m34 + mm2.m44*mm.m44);\r\n\r\n    mm.m11 = m11;\r\n    mm.m12 = m12;\r\n    mm.m13 = m13;\r\n    mm.m14 = m14;\r\n    mm.m21 = m21;\r\n    mm.m22 = m22;\r\n    mm.m23 = m23;\r\n    mm.m24 = m24;\r\n    mm.m31 = m31;\r\n    mm.m32 = m32;\r\n    mm.m33 = m33;\r\n    mm.m34 = m34;\r\n    mm.m41 = m41;\r\n    mm.m42 = m42;\r\n    mm.m43 = m43;\r\n    mm.m44 = m44;\r\n\r\n    return this;\r\n  }\r\n\r\n  divide(divisor) {\r\n    this.$matrix.m11 /= divisor;\r\n    this.$matrix.m12 /= divisor;\r\n    this.$matrix.m13 /= divisor;\r\n    this.$matrix.m14 /= divisor;\r\n    this.$matrix.m21 /= divisor;\r\n    this.$matrix.m22 /= divisor;\r\n    this.$matrix.m23 /= divisor;\r\n    this.$matrix.m24 /= divisor;\r\n    this.$matrix.m31 /= divisor;\r\n    this.$matrix.m32 /= divisor;\r\n    this.$matrix.m33 /= divisor;\r\n    this.$matrix.m34 /= divisor;\r\n    this.$matrix.m41 /= divisor;\r\n    this.$matrix.m42 /= divisor;\r\n    this.$matrix.m43 /= divisor;\r\n    this.$matrix.m44 /= divisor;\r\n\r\n    return this;\r\n  }\r\n\r\n  ortho(left, right, bottom, top, near, far) {\r\n    console.warn(\"Matrix4.ortho() is deprecated, use .orthographic() instead\");\r\n\r\n    let tx = (left + right)/(left - right);\r\n    let ty = (top + bottom)/(top - bottom);\r\n    let tz = (far + near)/(far - near);\r\n    let matrix = temp_mats.next().makeIdentity();\r\n\r\n    matrix.$matrix.m11 = 2/(left - right);\r\n    matrix.$matrix.m12 = 0;\r\n    matrix.$matrix.m13 = 0;\r\n    matrix.$matrix.m14 = 0;\r\n    matrix.$matrix.m21 = 0;\r\n    matrix.$matrix.m22 = 2/(top - bottom);\r\n    matrix.$matrix.m23 = 0;\r\n    matrix.$matrix.m24 = 0;\r\n    matrix.$matrix.m31 = 0;\r\n    matrix.$matrix.m32 = 0;\r\n    matrix.$matrix.m33 = -2/(far - near);\r\n    matrix.$matrix.m34 = 0;\r\n    matrix.$matrix.m41 = tx;\r\n    matrix.$matrix.m42 = ty;\r\n    matrix.$matrix.m43 = tz;\r\n    matrix.$matrix.m44 = 1;\r\n\r\n    this.multiply(matrix);\r\n\r\n    return this;\r\n  }\r\n\r\n  frustum(left, right, bottom, top, near, far) {\r\n    let matrix = temp_mats.next().makeIdentity();\r\n\r\n    let A = (right + left)/(right - left);\r\n    let B = (top + bottom)/(top - bottom);\r\n    let C = -(far + near)/(far - near);\r\n    let D = -(2*far*near)/(far - near);\r\n\r\n    matrix.$matrix.m11 = (2*near)/(right - left);\r\n    matrix.$matrix.m12 = 0;\r\n    matrix.$matrix.m13 = 0;\r\n    matrix.$matrix.m14 = 0;\r\n    matrix.$matrix.m21 = 0;\r\n    matrix.$matrix.m22 = 2*near/(top - bottom);\r\n    matrix.$matrix.m23 = 0;\r\n    matrix.$matrix.m24 = 0;\r\n    matrix.$matrix.m31 = A;\r\n    matrix.$matrix.m32 = B;\r\n    matrix.$matrix.m33 = C;\r\n    matrix.$matrix.m34 = -1;\r\n    matrix.$matrix.m41 = 0;\r\n    matrix.$matrix.m42 = 0;\r\n    matrix.$matrix.m43 = D;\r\n    matrix.$matrix.m44 = 0;\r\n\r\n    this.isPersp = true;\r\n    this.multiply(matrix);\r\n\r\n    return this;\r\n  }\r\n\r\n  orthographic(scale, aspect, near, far) {\r\n    let mat = temp_mats.next().makeIdentity();\r\n\r\n    let zscale = far - near;\r\n\r\n    mat.scale(2.0/aspect, 2.0, -1.0/scale/zscale, 1.0/scale);\r\n    mat.translate(0.0, 0.0, 0.5*zscale - near);\r\n\r\n    this.isPersp = true; //we still make use of auto homogenous divide in BaseVector.multVecMatrix\r\n    this.multiply(mat);\r\n\r\n    return mat;\r\n  }\r\n\r\n  perspective(fovy, aspect, zNear, zFar) {\r\n    let top = Math.tan(fovy*Math.PI/360)*zNear;\r\n    let bottom = -top;\r\n    let left = aspect*bottom;\r\n    let right = aspect*top;\r\n\r\n    this.frustum(left, right, bottom, top, zNear, zFar);\r\n\r\n    return this;\r\n  }\r\n\r\n  lookat(pos, target, up) {\r\n    let matrix = lookat_cache_ms.next();\r\n    matrix.makeIdentity();\r\n\r\n    let vec = lookat_cache_vs3.next().load(pos).sub(target);\r\n    let len = vec.vectorLength();\r\n    vec.normalize();\r\n\r\n    let zvec = vec;\r\n    let yvec = lookat_cache_vs3.next().load(up).normalize();\r\n    let xvec = lookat_cache_vs3.next().load(yvec).cross(zvec).normalize();\r\n\r\n    let mm = matrix.$matrix;\r\n\r\n    mm.m11 = xvec[0];\r\n    mm.m12 = yvec[0];\r\n    mm.m13 = zvec[0];\r\n    mm.m14 = 0;\r\n    mm.m21 = xvec[1];\r\n    mm.m22 = yvec[1];\r\n    mm.m23 = zvec[1];\r\n    mm.m24 = 0;\r\n    mm.m31 = xvec[2];\r\n    mm.m32 = yvec[2];\r\n    mm.m33 = zvec[2];\r\n\r\n    //*\r\n    mm.m11 = xvec[0];\r\n    mm.m12 = xvec[1];\r\n    mm.m13 = xvec[2];\r\n    mm.m14 = 0;\r\n    mm.m21 = yvec[0];\r\n    mm.m22 = yvec[1];\r\n    mm.m23 = yvec[2];\r\n    mm.m24 = 0;\r\n    mm.m31 = zvec[0];\r\n    mm.m32 = zvec[1];\r\n    mm.m33 = zvec[2];\r\n    mm.m34 = 0;\r\n    mm.m41 = pos[0];\r\n    mm.m42 = pos[1];\r\n    mm.m43 = pos[2];\r\n    mm.m44 = 1;\r\n    //*/\r\n\r\n    this.multiply(matrix);\r\n\r\n\r\n    return this;\r\n  }\r\n\r\n  makeRotationOnly() {\r\n    let m = this.$matrix;\r\n\r\n    m.m41 = m.m42 = m.m43 = 0.0;\r\n    m.m44 = 1.0;\r\n\r\n    let l1 = Math.sqrt(m.m11*m.m11 + m.m12*m.m12 + m.m13*m.m13);\r\n    let l2 = Math.sqrt(m.m21*m.m21 + m.m22*m.m22 + m.m23*m.m23);\r\n    let l3 = Math.sqrt(m.m31*m.m31 + m.m32*m.m32 + m.m33*m.m33);\r\n\r\n    if (l1) {\r\n      m.m11 /= l1;\r\n      m.m12 /= l1;\r\n      m.m13 /= l1;\r\n    }\r\n\r\n    if (l2) {\r\n      m.m21 /= l2;\r\n      m.m22 /= l2;\r\n      m.m23 /= l2;\r\n    }\r\n\r\n    if (l3) {\r\n      m.m31 /= l3;\r\n      m.m32 /= l3;\r\n      m.m33 /= l3;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  alignAxis(axis, vec) {\r\n    vec = new Vector3(vec);\r\n    vec.normalize();\r\n\r\n    let mat = this.inputs.transformMatrix.getValue();\r\n    let m = mat.$matrix;\r\n\r\n    let mat2 = new Matrix4(mat);\r\n    let loc = new Vector3(), scale = new Vector3(), rot = new Vector3();\r\n\r\n    //we don't use rot\r\n    mat2.decompose(loc, rot, scale);\r\n\r\n    mat2.makeRotationOnly();\r\n    let axes = mat2.getAsVecs();\r\n\r\n    let axis2 = (axis + 1)%3;\r\n    let axis3 = (axis + 2)%3;\r\n\r\n    axes[axis].load(vec)\r\n    axes[axis2].cross(axes[axis]).cross(axes[axis])\r\n    axes[axis3].load(axes[axis]).cross(axes[axis2])\r\n\r\n    axes[0][3] = 1.0;\r\n    axes[1][3] = 1.0;\r\n    axes[2][3] = 1.0;\r\n\r\n    axes[0].normalize();\r\n    axes[1].normalize();\r\n    axes[2].normalize();\r\n\r\n    this.loadFromVecs(axes);\r\n    this.scale(scale[0], scale[1], scale[2]);\r\n\r\n    m.m41 = loc[0];\r\n    m.m42 = loc[1];\r\n    m.m43 = loc[2];\r\n\r\n    return this;\r\n  }\r\n\r\n  decompose(_translate, _rotate, _scale, _skew, _perspective, order = EulerOrders.XYZ) {\r\n    if (this.$matrix.m44 === 0)\r\n      return false;\r\n\r\n    let mat = temp_mats.next().load(this);\r\n    let m = mat.$matrix;\r\n\r\n    let t = _translate, r = _rotate, s = _scale;\r\n    if (t) {\r\n      t[0] = m.m41;\r\n      t[1] = m.m42;\r\n      t[2] = m.m43;\r\n    }\r\n\r\n    let l1 = Math.sqrt(m.m11*m.m11 + m.m12*m.m12 + m.m13*m.m13);\r\n    let l2 = Math.sqrt(m.m21*m.m21 + m.m22*m.m22 + m.m23*m.m23);\r\n    let l3 = Math.sqrt(m.m31*m.m31 + m.m32*m.m32 + m.m33*m.m33);\r\n\r\n    if (l1) {\r\n      m.m11 /= l1;\r\n      m.m12 /= l1;\r\n      m.m13 /= l1;\r\n    }\r\n    if (l2) {\r\n      m.m21 /= l2;\r\n      m.m22 /= l2;\r\n      m.m23 /= l2;\r\n    }\r\n    if (l3) {\r\n      m.m31 /= l3;\r\n      m.m32 /= l3;\r\n      m.m33 /= l3;\r\n    }\r\n\r\n    if (s) {\r\n      s[0] = l1;\r\n      s[1] = l2;\r\n      s[2] = l3;\r\n    }\r\n\r\n    if (r) { //THREE.js code\r\n      let clamp = myclamp;\r\n\r\n      let rmat = temp_mats.next().load(this);\r\n      rmat.normalize();\r\n\r\n      m = rmat.$matrix;\r\n\r\n      // assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n      let m11 = m.m11, m12 = m.m12, m13 = m.m13, m14 = m.m14;\r\n      let m21 = m.m21, m22 = m.m22, m23 = m.m23, m24 = m.m24;\r\n      let m31 = m.m31, m32 = m.m32, m33 = m.m33, m34 = m.m34;\r\n      //let m41 = m.m41, m42 = m.m42, m43 = m.m43, m44 = m.m44;\r\n\r\n      if (order === EulerOrders.XYZ) {\r\n\r\n        r[1] = Math.asin(clamp(m13, -1, 1));\r\n\r\n        if (Math.abs(m13) < 0.9999999) {\r\n\r\n          r[0] = Math.atan2(-m23, m33);\r\n          r[2] = Math.atan2(-m12, m11);\r\n\r\n        } else {\r\n\r\n          r[0] = Math.atan2(m32, m22);\r\n          r[2] = 0;\r\n\r\n        }\r\n\r\n      } else if (order === EulerOrders.YXZ) {\r\n\r\n        r[0] = Math.asin(-clamp(m23, -1, 1));\r\n\r\n        if (Math.abs(m23) < 0.9999999) {\r\n\r\n          r[1] = Math.atan2(m13, m33);\r\n          r[2] = Math.atan2(m21, m22);\r\n\r\n        } else {\r\n\r\n          r[1] = Math.atan2(-m31, m11);\r\n          r[2] = 0;\r\n\r\n        }\r\n\r\n      } else if (order === EulerOrders.ZXY) {\r\n\r\n        r[0] = Math.asin(clamp(m32, -1, 1));\r\n\r\n        if (Math.abs(m32) < 0.9999999) {\r\n\r\n          r[1] = Math.atan2(-m31, m33);\r\n          r[2] = Math.atan2(-m12, m22);\r\n\r\n        } else {\r\n\r\n          r[1] = 0;\r\n          r[2] = Math.atan2(m21, m11);\r\n\r\n        }\r\n\r\n      } else if (order === EulerOrders.ZYX) {\r\n\r\n        r[1] = Math.asin(-clamp(m31, -1, 1));\r\n\r\n        if (Math.abs(m31) < 0.9999999) {\r\n\r\n          r[0] = Math.atan2(m32, m33);\r\n          r[2] = Math.atan2(m21, m11);\r\n\r\n        } else {\r\n\r\n          r[0] = 0;\r\n          r[2] = Math.atan2(-m12, m22);\r\n\r\n        }\r\n\r\n      } else if (order === EulerOrders.YZX) {\r\n\r\n        r[2] = Math.asin(clamp(m21, -1, 1));\r\n\r\n        if (Math.abs(m21) < 0.9999999) {\r\n\r\n          r[0] = Math.atan2(-m23, m22);\r\n          r[1] = Math.atan2(-m31, m11);\r\n\r\n        } else {\r\n\r\n          r[0] = 0;\r\n          r[1] = Math.atan2(m13, m33);\r\n\r\n        }\r\n\r\n      } else if (order === EulerOrders.XZY) {\r\n\r\n        r[2] = Math.asin(-clamp(m12, -1, 1));\r\n\r\n        if (Math.abs(m12) < 0.9999999) {\r\n\r\n          r[0] = Math.atan2(m32, m22);\r\n          r[1] = Math.atan2(m13, m11);\r\n\r\n        } else {\r\n\r\n          r[0] = Math.atan2(-m23, m33);\r\n          r[1] = 0;\r\n\r\n        }\r\n\r\n      } else {\r\n        console.warn('unsupported euler order:', order);\r\n      }\r\n      //r[0] = Math.atan2(m.m23, m.m33);\r\n      //r[1] = Math.atan2(-m.m13, Math.sqrt(m.m23*m.m23 + m.m33*m.m33));\r\n      //r[2] = Math.atan2(m.m12, m.m11);\r\n    }\r\n  }\r\n\r\n  _determinant2x2(a, b, c, d) {\r\n    return a*d - b*c;\r\n  }\r\n\r\n  _determinant3x3(a1, a2, a3, b1, b2, b3, c1, c2, c3) {\r\n    return a1*this._determinant2x2(b2, b3, c2, c3) - b1*this._determinant2x2(a2, a3, c2, c3) + c1*this._determinant2x2(a2, a3, b2, b3);\r\n  }\r\n\r\n  _determinant4x4() {\r\n    let a1 = this.$matrix.m11;\r\n    let b1 = this.$matrix.m12;\r\n    let c1 = this.$matrix.m13;\r\n    let d1 = this.$matrix.m14;\r\n    let a2 = this.$matrix.m21;\r\n    let b2 = this.$matrix.m22;\r\n    let c2 = this.$matrix.m23;\r\n    let d2 = this.$matrix.m24;\r\n    let a3 = this.$matrix.m31;\r\n    let b3 = this.$matrix.m32;\r\n    let c3 = this.$matrix.m33;\r\n    let d3 = this.$matrix.m34;\r\n    let a4 = this.$matrix.m41;\r\n    let b4 = this.$matrix.m42;\r\n    let c4 = this.$matrix.m43;\r\n    let d4 = this.$matrix.m44;\r\n    return a1*this._determinant3x3(b2, b3, b4, c2, c3, c4, d2, d3, d4) - b1*this._determinant3x3(a2, a3, a4, c2, c3, c4, d2, d3, d4) + c1*this._determinant3x3(a2, a3, a4, b2, b3, b4, d2, d3, d4) - d1*this._determinant3x3(a2, a3, a4, b2, b3, b4, c2, c3, c4);\r\n  }\r\n\r\n  _makeAdjoint() {\r\n    let a1 = this.$matrix.m11;\r\n    let b1 = this.$matrix.m12;\r\n    let c1 = this.$matrix.m13;\r\n    let d1 = this.$matrix.m14;\r\n    let a2 = this.$matrix.m21;\r\n    let b2 = this.$matrix.m22;\r\n    let c2 = this.$matrix.m23;\r\n    let d2 = this.$matrix.m24;\r\n    let a3 = this.$matrix.m31;\r\n    let b3 = this.$matrix.m32;\r\n    let c3 = this.$matrix.m33;\r\n    let d3 = this.$matrix.m34;\r\n    let a4 = this.$matrix.m41;\r\n    let b4 = this.$matrix.m42;\r\n    let c4 = this.$matrix.m43;\r\n    let d4 = this.$matrix.m44;\r\n\r\n    this.$matrix.m11 = this._determinant3x3(b2, b3, b4, c2, c3, c4, d2, d3, d4);\r\n    this.$matrix.m21 = -this._determinant3x3(a2, a3, a4, c2, c3, c4, d2, d3, d4);\r\n    this.$matrix.m31 = this._determinant3x3(a2, a3, a4, b2, b3, b4, d2, d3, d4);\r\n    this.$matrix.m41 = -this._determinant3x3(a2, a3, a4, b2, b3, b4, c2, c3, c4);\r\n    this.$matrix.m12 = -this._determinant3x3(b1, b3, b4, c1, c3, c4, d1, d3, d4);\r\n    this.$matrix.m22 = this._determinant3x3(a1, a3, a4, c1, c3, c4, d1, d3, d4);\r\n    this.$matrix.m32 = -this._determinant3x3(a1, a3, a4, b1, b3, b4, d1, d3, d4);\r\n    this.$matrix.m42 = this._determinant3x3(a1, a3, a4, b1, b3, b4, c1, c3, c4);\r\n    this.$matrix.m13 = this._determinant3x3(b1, b2, b4, c1, c2, c4, d1, d2, d4);\r\n    this.$matrix.m23 = -this._determinant3x3(a1, a2, a4, c1, c2, c4, d1, d2, d4);\r\n    this.$matrix.m33 = this._determinant3x3(a1, a2, a4, b1, b2, b4, d1, d2, d4);\r\n    this.$matrix.m43 = -this._determinant3x3(a1, a2, a4, b1, b2, b4, c1, c2, c4);\r\n    this.$matrix.m14 = -this._determinant3x3(b1, b2, b3, c1, c2, c3, d1, d2, d3);\r\n    this.$matrix.m24 = this._determinant3x3(a1, a2, a3, c1, c2, c3, d1, d2, d3);\r\n    this.$matrix.m34 = -this._determinant3x3(a1, a2, a3, b1, b2, b3, d1, d2, d3);\r\n    this.$matrix.m44 = this._determinant3x3(a1, a2, a3, b1, b2, b3, c1, c2, c3);\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    this.load(this.mat);\r\n    this.__mat = this.mat;\r\n    //delete this.mat;\r\n  }\r\n}\r\n\r\nMatrix4.STRUCT = `\r\nmat4 {\r\n  mat      : array(float) | this.getAsArray();\r\n  isPersp  : int          | this.isPersp;\r\n}\r\n`;\r\nnstructjs.register(Matrix4);\r\n\r\npreMultTemp = new Matrix4();\r\n\r\nwindow.testmat = (x = 0, y = 0, z = Math.PI*0.5) => {\r\n  let m1 = new Matrix4();\r\n  m1.euler_rotate(x, y, z);\r\n  //m1.scale(2.0, 0.5, 3.0);\r\n\r\n  let t = [0, 0, 0], r = [0, 0, 0], s = [0, 0, 0]\r\n\r\n  m1.decompose(t, r, s);\r\n\r\n  window.console.log(\"\\n\");\r\n  window.console.log(t);\r\n  window.console.log(r);\r\n  window.console.log(s);\r\n\r\n\r\n  let mat = m1.clone();\r\n  mat.transpose();\r\n  mat.multiply(m1);\r\n\r\n  console.log(mat.toString());\r\n  return r;\r\n}\r\n\r\nlookat_cache_ms = util.cachering.fromConstructor(Matrix4, 64);\r\neuler_rotate_mats = util.cachering.fromConstructor(Matrix4, 64);\r\ntemp_mats = util.cachering.fromConstructor(Matrix4, 64);\r\n","\"use strict\";\r\n\r\n/*\r\nthis file is a skeleton that defines the contract\r\nthat any tool property library must implement to interface with path.ux.\r\n*/\r\n\r\n//maps prop type names to integers\r\nimport * as util from \"../util/util.js\";\r\n\r\nexport let PropTypes = {\r\n  INT        : 1,\r\n  STRING     : 2,\r\n  BOOL       : 4,\r\n  ENUM       : 8,\r\n  FLAG       : 16,\r\n  FLOAT      : 32,\r\n  VEC2       : 64,\r\n  VEC3       : 128,\r\n  VEC4       : 256,\r\n  MATRIX4    : 512,\r\n  QUAT       : 1024,\r\n  PROPLIST   : 4096,\r\n  STRSET     : 8192,\r\n  CURVE      : 8192<<1,\r\n  FLOAT_ARRAY: 8192<<2,\r\n  REPORT     : 8192<<3\r\n  //ITER : 8192<<1\r\n};\r\n\r\nexport const PropSubTypes = {\r\n  COLOR: 1\r\n};\r\n\r\n//flags\r\nexport const PropFlags = {\r\n  SELECT                : 1,\r\n  PRIVATE               : 2,\r\n  LABEL                 : 4,\r\n  USE_ICONS             : 64, /* Implies FORCE_ENUM_CHECKBOXES (for enum/flag properties). */\r\n  USE_CUSTOM_GETSET     : 128, //used by controller.js interface\r\n  SAVE_LAST_VALUE       : 256,\r\n  READ_ONLY             : 512,\r\n  SIMPLE_SLIDER         : 1<<10,\r\n  FORCE_ROLLER_SLIDER   : 1<<11,\r\n  USE_BASE_UNDO         : 1<<12, //internal to simple_controller.js\r\n  EDIT_AS_BASE_UNIT     : 1<<13, //user textbox input should be interpreted in display unit\r\n  NO_UNDO               : 1<<14,\r\n  USE_CUSTOM_PROP_GETTER: 1<<15, //hrm, not sure I need this\r\n  FORCE_ENUM_CHECKBOXES : 1<<16,/* Use a strip of checkboxes, also applies to flag properties. */\r\n  NO_DEFAULT            : 1<<17,\r\n};\r\n\r\nexport class ToolPropertyIF {\r\n  constructor(type, subtype, apiname, uiname, description, flag, icon) {\r\n    this.data = undefined;\r\n\r\n    this.type = type;\r\n    this.subtype = subtype;\r\n\r\n    this.apiname = apiname;\r\n    this.uiname = uiname;\r\n    this.description = description;\r\n    this.flag = flag;\r\n    this.icon = icon;\r\n  }\r\n\r\n  equals(b) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  copyTo(b) {\r\n\r\n  }\r\n\r\n  copy() {\r\n\r\n  }\r\n\r\n  _fire(type, arg1, arg2) {\r\n  }\r\n\r\n  on(type, cb) {\r\n  }\r\n\r\n  off(type, cb) {\r\n  }\r\n\r\n  getValue() {\r\n  }\r\n\r\n  setValue(val) {\r\n  }\r\n\r\n  setStep(step) {\r\n  }\r\n\r\n  setRange(min, max) {\r\n  }\r\n\r\n  setUnit(unit) {\r\n  }\r\n\r\n  //some clients have seperate ui range\r\n  setUIRange(min, max) {\r\n  }\r\n\r\n  setIcon(icon) {\r\n  }\r\n}\r\n\r\nexport class StringPropertyIF extends ToolPropertyIF {\r\n  constructor() {\r\n    super(PropTypes.STRING);\r\n  }\r\n}\r\n\r\nexport class NumPropertyIF extends ToolPropertyIF {\r\n};\r\n\r\nexport class IntPropertyIF extends ToolPropertyIF {\r\n  constructor() {\r\n    super(PropTypes.INT);\r\n  }\r\n\r\n  setRadix(radix) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n}\r\n\r\nexport class FloatPropertyIF extends ToolPropertyIF {\r\n  constructor() {\r\n    super(PropTypes.FLOAT);\r\n  }\r\n\r\n  setDecimalPlaces(n) {\r\n  }\r\n}\r\n\r\nexport class EnumPropertyIF extends ToolPropertyIF {\r\n  constructor(value, valid_values) {\r\n    super(PropTypes.ENUM);\r\n\r\n    this.values = {}\r\n    this.keys = {};\r\n    this.ui_value_names = {};\r\n    this.iconmap = {};\r\n\r\n    if (valid_values === undefined) return this;\r\n\r\n    if (valid_values instanceof Array || valid_values instanceof String) {\r\n      for (var i = 0; i < valid_values.length; i++) {\r\n        this.values[valid_values[i]] = valid_values[i];\r\n        this.keys[valid_values[i]] = valid_values[i];\r\n      }\r\n    } else {\r\n      for (var k in valid_values) {\r\n        this.values[k] = valid_values[k];\r\n        this.keys[valid_values[k]] = k;\r\n      }\r\n    }\r\n\r\n    for (var k in this.values) {\r\n      var uin = k[0].toUpperCase() + k.slice(1, k.length);\r\n\r\n      uin = uin.replace(/\\_/g, \" \");\r\n      this.ui_value_names[k] = uin;\r\n    }\r\n  }\r\n\r\n  addIcons(iconmap) {\r\n    if (this.iconmap === undefined) {\r\n      this.iconmap = {};\r\n    }\r\n    for (var k in iconmap) {\r\n      this.iconmap[k] = iconmap[k];\r\n    }\r\n  }\r\n}\r\n\r\nexport class FlagPropertyIF extends EnumPropertyIF {\r\n  constructor(valid_values) {\r\n    super(PropTypes.FLAG);\r\n  }\r\n}\r\n\r\nexport class Vec2PropertyIF extends ToolPropertyIF {\r\n  constructor(valid_values) {\r\n    super(PropTypes.VEC2);\r\n  }\r\n}\r\n\r\nexport class Vec3PropertyIF extends ToolPropertyIF {\r\n  constructor(valid_values) {\r\n    super(PropTypes.VEC3);\r\n  }\r\n}\r\n\r\nexport class Vec4PropertyIF extends ToolPropertyIF {\r\n  constructor(valid_values) {\r\n    super(PropTypes.VEC4);\r\n  }\r\n}\r\n\r\n/**\r\n * List of other tool props (all of one type)\r\n */\r\nexport class ListPropertyIF extends ToolPropertyIF {\r\n  /*\r\n  * Prop must be a ToolProperty subclass instance\r\n  * */\r\n  constructor(prop) {\r\n    super(PropTypes.PROPLIST);\r\n\r\n    this.prop = prop;\r\n  }\r\n\r\n  get length() {\r\n  }\r\n\r\n  set length(val) {\r\n  }\r\n\r\n  copyTo(b) {\r\n  }\r\n\r\n  copy() {\r\n  }\r\n\r\n  /**\r\n   * clear list\r\n   * */\r\n  clear() {\r\n\r\n  }\r\n\r\n  push(item = this.prop.copy()) {\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n  }\r\n}\r\n\r\n//like FlagsProperty but uses strings\r\nexport class StringSetPropertyIF extends ToolPropertyIF {\r\n  constructor(value = undefined, definition = []) {\r\n    super(PropTypes.STRSET);\r\n  }\r\n\r\n  /*\r\n  * Values can be a string, undefined/null, or a list/set/object-literal of strings.\r\n  * If destructive is true, then existing set will be cleared.\r\n  * */\r\n  setValue(values, destructive = true, soft_fail = true) {\r\n  }\r\n\r\n  getValue() {\r\n  }\r\n\r\n  addIcons(iconmap) {\r\n  }\r\n\r\n\r\n  addUINames(map) {\r\n  }\r\n\r\n  addDescriptions(map) {\r\n  }\r\n\r\n  copyTo(b) {\r\n  }\r\n\r\n  copy() {\r\n  }\r\n}\r\n\r\nexport class Curve1DPropertyIF extends ToolPropertyIF {\r\n  constructor(curve, uiname) {\r\n    super(PropTypes.CURVE);\r\n\r\n    this.data = curve;\r\n  }\r\n\r\n  getValue() {\r\n    return this.curve;\r\n  }\r\n\r\n  setValue(curve) {\r\n    if (curve === undefined) {\r\n      return;\r\n    }\r\n\r\n    let json = JSON.parse(JSON.stringify(curve));\r\n    this.data.load(json);\r\n  }\r\n\r\n  copyTo(b) {\r\n    b.setValue(this.data);\r\n  }\r\n}\r\n\r\n","/**\r\n * Unit system.\r\n *\r\n * Provides an API to convert units,\r\n * e.g. `convert(0.5, \"foot\", \"meter\")`\r\n *\r\n * Path.ux widgets typically have `baseUnit`\r\n * and `displayUnit` properties. `baseUnit`\r\n * is the unit of the real stored value,\r\n * while `displayUnit` is what he user sees\r\n * and edits.\r\n *\r\n * Units:\r\n * # none           No unit\r\n * # meter          Meter       (distance)\r\n * # inch           Inch        (distance)\r\n * # foot           Foot        (distance)\r\n * # square_foot    Square Feet (area)\r\n * # mile           Mile        (distance)\r\n * # degree         Degrees     (angle)\r\n * # radian         Radians     (angle)\r\n * # pixel          Pixel       (distance)\r\n * # percent        Percent\r\n *\r\n */\r\n\r\n/*\r\nall units convert to meters\r\n*/\r\n\r\nconst FLT_EPSILONE = 1.192092895507812e-07;\r\n\r\nfunction myfloor(f) {\r\n  return Math.floor(f + FLT_EPSILONE*2.0);\r\n}\r\n\r\nfunction normString(s) {\r\n  //remove all whitespace\r\n  s = s.replace(/ /g, \"\").replace(/\\t/g, \"\");\r\n  return s.toLowerCase();\r\n}\r\n\r\nfunction myToFixed(f, decimals) {\r\n  if (typeof f !== \"number\") {\r\n    return \"(error)\";\r\n  }\r\n\r\n  f = f.toFixed(decimals);\r\n  while (f.endsWith(\"0\") && f.search(/\\./) >= 0) {\r\n    f = f.slice(0, f.length - 1);\r\n  }\r\n\r\n  if (f.endsWith(\".\")) {\r\n    f = f.slice(0, f.length - 1);\r\n  }\r\n\r\n  if (f.length === 0)\r\n    f = \"0\";\r\n\r\n  return f.trim();\r\n}\r\n\r\nexport const Units = [];\r\n\r\nexport class Unit {\r\n  static getUnit(name) {\r\n    if (name === \"none\" || name === undefined) {\r\n      return undefined;\r\n    }\r\n\r\n    for (let cls of Units) {\r\n      if (cls.unitDefine().name === name) {\r\n        return cls;\r\n      }\r\n    }\r\n\r\n    throw new Error(\"Unknown unit \" + name);\r\n  }\r\n\r\n  static register(cls) {\r\n    Units.push(cls);\r\n  }\r\n\r\n  //subclassed static methods start here\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"\",\r\n      uiname : \"\",\r\n      type   : \"\", //e.g. distance\r\n      icon   : -1,\r\n      pattern: undefined //a re literal to validate strings\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n\r\n  }\r\n\r\n  static validate(string) {\r\n    string = normString(string);\r\n    let def = this.unitDefine();\r\n\r\n    let m = string.match(def.pattern);\r\n    if (!m)\r\n      return false;\r\n\r\n    return m[0] === string;\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n\r\n  }\r\n\r\n  static fromInternal(value) {\r\n\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n\r\n  }\r\n}\r\n\r\nexport class MeterUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"meter\",\r\n      uiname : \"Meter\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d*)?m$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    if (string.endsWith(\"m\")) {\r\n      string = string.slice(0, string.length - 1);\r\n    }\r\n\r\n    return parseFloat(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n    return \"\" + myToFixed(value, decimals) + \" m\";\r\n  }\r\n}\r\n\r\nUnit.register(MeterUnit);\r\n\r\nexport class InchUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"inch\",\r\n      uiname : \"Inch\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d*)?(in|inch)$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = string.toLowerCase();\r\n    let i = string.indexOf(\"i\");\r\n\r\n    if (i >= 0) {\r\n      string = string.slice(0, i);\r\n    }\r\n\r\n    return parseInt(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value*0.0254;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value/0.0254;\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n    return \"\" + myToFixed(value, decimals) + \"in\";\r\n  }\r\n}\r\n\r\nUnit.register(InchUnit);\r\n\r\nlet foot_re = /((-?\\d+(\\.\\d*)?ft)(-?\\d+(\\.\\d*)?(in|inch))?)|(-?\\d+(\\.\\d*)?(in|inch))$/\r\n\r\nexport class FootUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"foot\",\r\n      uiname : \"Foot\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: foot_re\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    let i = string.search(\"ft\");\r\n    let parts = [];\r\n    let vft = 0.0, vin = 0.0;\r\n\r\n    if (i >= 0) {\r\n      parts = string.split(\"ft\");\r\n      let j = parts[1].search(\"in\");\r\n\r\n      if (j >= 0) {\r\n        parts = [parts[0]].concat(parts[1].split(\"in\"));\r\n        vin = parseFloat(parts[1]);\r\n      }\r\n\r\n      vft = parseFloat(parts[0]);\r\n    } else {\r\n      string = string.replace(/in/g, \"\");\r\n      vin = parseFloat(string);\r\n    }\r\n\r\n    return vin/12.0 + vft;\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value*0.3048;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value/0.3048;\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n    let vft = myfloor(value);\r\n    let vin = ((value + FLT_EPSILONE*2)*12)%12;\r\n\r\n    if (vft === 0.0) {\r\n      return myToFixed(vin, decimals) + \" in\";\r\n    }\r\n\r\n    let s = \"\" + vft + \" ft\";\r\n    if (vin !== 0.0) {\r\n      s += \" \" + myToFixed(vin, decimals) + \" in\";\r\n    }\r\n\r\n    return s;\r\n  }\r\n}\r\n\r\nUnit.register(FootUnit);\r\n\r\n\r\nlet square_foot_re = /((-?\\d+(\\.\\d*)?ft(\\u00b2)?)(-?\\d+(\\.\\d*)?(in|inch)(\\u00b2)?)?)|(-?\\d+(\\.\\d*)?(in|inch)(\\u00b2)?)$/\r\n\r\nexport class SquareFootUnit extends FootUnit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"square_foot\",\r\n      uiname : \"Square Feet\",\r\n      type   : \"area\",\r\n      icon   : -1,\r\n      pattern: square_foot_re\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = string.replace(/\\u00b2/g, \"\");\r\n    return super.parse(string);\r\n  }\r\n\r\n\r\n  static buildString(value, decimals = 2) {\r\n    let vft = myfloor(value);\r\n    let vin = ((value + FLT_EPSILONE*2)*12)%12;\r\n\r\n    if (vft === 0.0) {\r\n      return myToFixed(vin, decimals) + \" in\\u00b2\";\r\n    }\r\n\r\n    let s = \"\" + vft + \" ft\\u00b2\";\r\n    if (vin !== 0.0) {\r\n      s += \" \" + myToFixed(vin, decimals) + \" in\\u00b2\";\r\n    }\r\n\r\n    return s;\r\n  }\r\n}\r\n\r\nUnit.register(SquareFootUnit);\r\n\r\n\r\nexport class MileUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"mile\",\r\n      uiname : \"Mile\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d+)?miles$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    string = string.replace(/miles/, \"\");\r\n    return parseFloat(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value*1609.34;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value/1609.34;\r\n  }\r\n\r\n  static buildString(value, decimals = 3) {\r\n    return \"\" + myToFixed(value, decimals) + \" miles\";\r\n  }\r\n}\r\n\r\nUnit.register(MileUnit);\r\n\r\nexport class DegreeUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"degree\",\r\n      uiname : \"Degrees\",\r\n      type   : \"angle\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d+)?(\\u00B0|degree|deg|d|degree|degrees)$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    if (string.search(\"d\") >= 0) {\r\n      string = string.slice(0, string.search(\"d\")).trim();\r\n    } else if (string.search(\"\\u00B0\") >= 0) {\r\n      string = string.slice(0, string.search(\"\\u00B0\")).trim();\r\n    }\r\n\r\n    return parseFloat(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value/180.0*Math.PI;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value*180.0/Math.PI;\r\n  }\r\n\r\n  static buildString(value, decimals = 3) {\r\n    return \"\" + myToFixed(value, decimals) + \" \\u00B0\";\r\n  }\r\n};\r\nUnit.register(DegreeUnit);\r\n\r\nexport class RadianUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"radian\",\r\n      uiname : \"Radians\",\r\n      type   : \"angle\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d+)?(r|rad|radian|radians)$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    if (string.search(\"r\") >= 0) {\r\n      string = string.slice(0, string.search(\"r\")).trim();\r\n    }\r\n\r\n    return parseFloat(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static buildString(value, decimals = 3) {\r\n    return \"\" + myToFixed(value, decimals) + \" r\";\r\n  }\r\n};\r\n\r\nUnit.register(RadianUnit);\r\n\r\nexport function setBaseUnit(unit) {\r\n  Unit.baseUnit = unit;\r\n}\r\n\r\nwindow._getBaseUnit = () => Unit.baseUnit;\r\n\r\nexport function setMetric(val) {\r\n  Unit.isMetric = val;\r\n}\r\n\r\nUnit.isMetric = true;\r\nUnit.baseUnit = \"meter\";\r\n\r\nlet numre1 = /[+\\-]?[0-9]+(\\.[0-9]*)?$/\r\nlet numre2 = /[+\\-]?[0-9]?(\\.[0-9]*)+$/\r\nlet hexre1 = /[+\\-]?[0-9a-fA-F]+h$/\r\nlet hexre2 = /[+\\-]?0x[0-9a-fA-F]+$/\r\nlet binre = /[+\\-]?0b[01]+$/\r\nlet expre = /[+\\-]?[0-9]+(\\.[0-9]*)?[eE]\\-?[0-9]+$/\r\nlet intre = /[+\\-]?[0-9]+$/\r\n\r\nfunction isnumber(s) {\r\n  s = (\"\" + s).trim();\r\n\r\n  function test(re) {\r\n    return s.search(re) === 0;\r\n  }\r\n\r\n  return test(intre) || test(numre1) || test(numre2) || test(hexre1) || test(hexre2) || test(binre) || test(expre);\r\n}\r\n\r\n\r\nexport function parseValueIntern(string, baseUnit = undefined) {\r\n  string = string.trim();\r\n  if (string[0] === \".\") {\r\n    string = \"0\" + string;\r\n  }\r\n\r\n  if (typeof baseUnit === \"string\") {\r\n    let base = Unit.getUnit(baseUnit);\r\n\r\n    if (base === undefined && baseUnit !== \"none\") {\r\n      console.warn(\"Unknown unit \" + baseUnit);\r\n      return NaN;\r\n    }\r\n\r\n    baseUnit = base;\r\n  }\r\n\r\n  //unannotated string?\r\n  if (isnumber(string)) {\r\n    //assume base unit\r\n    let f = parseFloat(string);\r\n\r\n    return f;\r\n  }\r\n\r\n  if (baseUnit === undefined) {\r\n    console.warn(\"No base unit in units.js:parseValueIntern\");\r\n  }\r\n\r\n  for (let unit of Units) {\r\n    let def = unit.unitDefine();\r\n\r\n    if (unit.validate(string)) {\r\n      console.log(unit);\r\n      let value = unit.parse(string);\r\n\r\n      if (baseUnit) {\r\n        value = unit.toInternal(value);\r\n        return baseUnit.fromInternal(value);\r\n      } else {\r\n        return value;\r\n      }\r\n    }\r\n  }\r\n\r\n  return NaN;\r\n}\r\n\r\n/* if displayUnit is undefined, final value will be converted from displayUnit to baseUnit */\r\nexport function parseValue(string, baseUnit = undefined, displayUnit = undefined) {\r\n  displayUnit = Unit.getUnit(displayUnit);\r\n  baseUnit = Unit.getUnit(baseUnit);\r\n\r\n  let f = parseValueIntern(string, displayUnit || baseUnit);\r\n\r\n  if (displayUnit) {\r\n    f = displayUnit.toInternal(f);\r\n  }\r\n\r\n  if (baseUnit) {\r\n    f = baseUnit.fromInternal(f);\r\n  }\r\n\r\n  return f;\r\n}\r\n\r\nexport function isNumber(string) {\r\n  if (isnumber(string)) {\r\n    return true;\r\n  }\r\n\r\n  for (let unit of Units) {\r\n    let def = unit.unitDefine();\r\n\r\n    if (unit.validate(string)) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nexport class PixelUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"pixel\",\r\n      uiname : \"Pixel\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d*)?px$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    if (string.endsWith(\"px\")) {\r\n      string = string.slice(0, string.length - 2).trim();\r\n    }\r\n\r\n    return parseFloat(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n    return \"\" + myToFixed(value, decimals) + \"px\";\r\n  }\r\n}\r\n\r\nUnit.register(PixelUnit);\r\n\r\nexport class PercentUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"percent\",\r\n      uiname : \"Percent\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: /[0-9]+(\\.[0-9]+)?[ \\t]*%/\r\n    }\r\n  }\r\n\r\n  static toInternal(value) {\r\n    return value/100.0;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value*100.0;\r\n  }\r\n\r\n  static parse(string) {\r\n    return parseFloat(string.replace(/%/g, \"\"));\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n    return (value).toFixed(decimals) + \"%\";\r\n  }\r\n}\r\n\r\nUnit.register(PercentUnit);\r\n\r\n\r\nexport function convert(value, unita, unitb) {\r\n  /* Note: getUnit throws on invalid units *except* for\r\n   *       'none' where it returns undefined.\r\n   */\r\n\r\n  if (typeof unita === \"string\") {\r\n    unita = Unit.getUnit(unita);\r\n  }\r\n\r\n  if (typeof unitb === \"string\") {\r\n    unitb = Unit.getUnit(unitb);\r\n  }\r\n\r\n  if (unita && unitb) {\r\n    return unitb.fromInternal(unita.toInternal(value));\r\n  } else if (unitb) {\r\n    return unitb.fromInternal(value); /* unita was 'none' */\r\n  } else if (unita) {\r\n    return unita.toInternal(value);\r\n  } else {\r\n    return value;\r\n  }\r\n}\r\n\r\nwindow.unitConvert = convert;\r\n\r\n/**\r\n *\r\n * @param value Value (note: is not converted to internal unit)\r\n * @param unit: Unit to use, should be a string referencing unit type, see unitDefine().name\r\n * @returns {*}\r\n */\r\nexport function buildString(value, baseUnit = Unit.baseUnit, decimalPlaces = 3, displayUnit = Unit.baseUnit) {\r\n  if (typeof baseUnit === \"string\" && baseUnit !== \"none\") {\r\n    baseUnit = Unit.getUnit(baseUnit);\r\n  }\r\n  if (typeof displayUnit === \"string\" && displayUnit !== \"none\") {\r\n    displayUnit = Unit.getUnit(displayUnit);\r\n  }\r\n\r\n\r\n  if (displayUnit !== baseUnit) {\r\n    value = convert(value, baseUnit, displayUnit);\r\n  }\r\n\r\n  if (displayUnit !== \"none\") {\r\n    return displayUnit.buildString(value, decimalPlaces);\r\n  } else {\r\n    return myToFixed(value, decimalPlaces);\r\n  }\r\n}\r\n\r\nwindow._parseValueTest = parseValue;\r\nwindow._buildStringTest = buildString;\r\n","import * as util from \"../util/util.js\";\r\nimport { Vector2, Vector3, Vector4, Quat, Matrix4 } from \"../util/vectormath.js\";\r\nimport { ToolPropertyIF, PropTypes, PropFlags } from \"./toolprop_abstract.js\";\r\nimport nstructjs from \"../util/struct.js\";\r\n\r\nexport { PropTypes, PropFlags } from \"./toolprop_abstract.js\";\r\n\r\nexport const NumberConstraintsBase = new Set([\r\n  \"range\",\r\n  \"expRate\",\r\n  \"step\",\r\n  \"uiRange\",\r\n  \"baseUnit\",\r\n  \"displayUnit\",\r\n  \"stepIsRelative\",\r\n  \"slideSpeed\",\r\n  \"sliderDisplayExp\",\r\n]);\r\n\r\nexport const IntegerConstraints = new Set([\"radix\"].concat(util.list(NumberConstraintsBase)));\r\n\r\nexport const FloatConstrinats = new Set([\"decimalPlaces\"].concat(util.list(NumberConstraintsBase)));\r\n\r\nexport const NumberConstraints = new Set(util.list(IntegerConstraints).concat(util.list(FloatConstrinats)));\r\n\r\nexport const PropSubTypes = {\r\n  COLOR: 1,\r\n};\r\n\r\nlet first = (iter) => {\r\n  if (iter === undefined) {\r\n    return undefined;\r\n  }\r\n\r\n  if (!(Symbol.iterator in iter)) {\r\n    for (let item in iter) {\r\n      return item;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  for (let item of iter) {\r\n    return item;\r\n  }\r\n};\r\n\r\n//set PropTypes to custom type integers\r\nexport function setPropTypes(types) {\r\n  for (let k in types) {\r\n    PropTypes[k] = types[k];\r\n  }\r\n}\r\n\r\nexport let customPropertyTypes = [];\r\nexport let PropClasses = {};\r\n\r\nlet customPropTypeBase = 17;\r\n\r\nlet wordmap = {\r\n  sel  : \"select\",\r\n  unsel: \"deselect\",\r\n  eid  : \"id\",\r\n  props: \"properties\",\r\n  res  : \"resource\",\r\n};\r\n\r\nexport var defaultRadix = 10;\r\nexport var defaultDecimalPlaces = 4;\r\n\r\nclass OnceTag {\r\n  constructor(cb) {\r\n    this.cb = cb;\r\n  }\r\n}\r\n\r\nexport class ToolProperty extends ToolPropertyIF {\r\n  constructor(type, subtype, apiname, uiname = \"\", description = \"\", flag = 0, icon = -1) {\r\n    super();\r\n\r\n    this.data = undefined;\r\n\r\n    if (type === undefined) {\r\n      type = this.constructor.PROP_TYPE_ID;\r\n    }\r\n\r\n    this.type = type;\r\n    this.subtype = subtype;\r\n\r\n    //is false if this property still has its default value,\r\n    //i.e. it hasn't been set by the user or anyone else\r\n    this.wasSet = false;\r\n\r\n    this.apiname = apiname;\r\n    this.uiname = uiname !== undefined ? uiname : apiname;\r\n    this.description = description;\r\n    this.flag = flag | PropFlags.SAVE_LAST_VALUE;\r\n    this.icon = icon;\r\n    this.icon2 = icon; //another icon, e.g. unchecked state\r\n\r\n    //remember to update NumberConstraintsBase et al when adding new number\r\n    //constraints\r\n\r\n    this.decimalPlaces = defaultDecimalPlaces;\r\n    this.radix = defaultRadix;\r\n    this.step = 0.05;\r\n\r\n    this.callbacks = {};\r\n  }\r\n\r\n  static internalRegister(cls) {\r\n    PropClasses[new cls().type] = cls;\r\n  }\r\n\r\n  static getClass(type) {\r\n    return PropClasses[type];\r\n  }\r\n\r\n  static setDefaultRadix(n) {\r\n    defaultRadix = n;\r\n  }\r\n\r\n  static setDefaultDecimalPlaces(n) {\r\n    defaultDecimalPlaces = n;\r\n  }\r\n\r\n  static makeUIName(name) {\r\n    let parts = [\"\"];\r\n    let lastc = undefined;\r\n\r\n    let ischar = (c) => {\r\n      c = c.charCodeAt(0);\r\n\r\n      let upper = c >= \"A\".charCodeAt(0);\r\n      upper = upper && c <= \"Z\".charCodeAt(0);\r\n\r\n      let lower = c >= \"a\".charCodeAt(0);\r\n      lower = lower && c <= \"z\".charCodeAt(0);\r\n\r\n      return upper || lower;\r\n    };\r\n\r\n    for (let i = 0; i < name.length; i++) {\r\n      let c = name[i];\r\n\r\n      if (c === \"_\" || c === \"-\" || c === \"$\") {\r\n        lastc = c;\r\n        c = \" \";\r\n        parts.push(\"\");\r\n        continue;\r\n      }\r\n\r\n      if (i > 0 && c === c.toUpperCase() && lastc !== lastc.toUpperCase()) {\r\n        if (ischar(c) && ischar(lastc)) {\r\n          parts.push(\"\");\r\n        }\r\n      }\r\n\r\n      parts[parts.length - 1] += c;\r\n      lastc = c;\r\n    }\r\n\r\n    let subst = (word) => {\r\n      if (word in wordmap) {\r\n        return wordmap[word];\r\n      } else {\r\n        return word;\r\n      }\r\n    };\r\n\r\n    parts = parts\r\n      .filter((f) => f.trim().length > 0)\r\n      .map((f) => subst(f))\r\n      .map((f) => f[0].toUpperCase() + f.slice(1, f.length).toLowerCase())\r\n      .join(\" \")\r\n      .trim();\r\n    return parts;\r\n  }\r\n\r\n  static register(cls) {\r\n    cls.PROP_TYPE_ID = 1 << customPropTypeBase;\r\n    PropTypes[cls.name] = cls.PROP_TYPE_ID;\r\n\r\n    customPropTypeBase++;\r\n    customPropertyTypes.push(cls);\r\n\r\n    PropClasses[new cls().type] = cls;\r\n\r\n    return cls.PROP_TYPE_ID;\r\n  }\r\n\r\n  static calcRelativeStep(step, value, logBase = 1.5) {\r\n    value = Math.log(Math.abs(value) + 1.0) / Math.log(logBase);\r\n    value = Math.max(value, step);\r\n\r\n    this.report(util.termColor(\"STEP\", \"red\"), value);\r\n    return value;\r\n  }\r\n\r\n  setDescription(s) {\r\n    this.description = s;\r\n    return this;\r\n  }\r\n\r\n  setUIName(s) {\r\n    this.uiname = s;\r\n    return this;\r\n  }\r\n\r\n  calcMemSize() {\r\n    function strlen(s) {\r\n      //length of string plus an assumed member pointer\r\n      return s !== undefined ? s.length + 8 : 8;\r\n    }\r\n\r\n    let tot = 0;\r\n\r\n    tot += strlen(this.apiname) + strlen(this.uiname);\r\n    tot += strlen(this.description);\r\n\r\n    tot += 11 * 8; //assumed member pointers\r\n    for (let k in this.callbacks) {\r\n      tot += 24;\r\n    }\r\n\r\n    return tot;\r\n  }\r\n\r\n  equals(b) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  private() {\r\n    this.flag |= PropFlags.PRIVATE;\r\n    this.flag &= ~PropFlags.SAVE_LAST_VALUE;\r\n    return this;\r\n  }\r\n\r\n  /** Save property in last value cache.  Now set by default,\r\n   *  to disable use .ignoreLastValue().\r\n   */\r\n  saveLastValue() {\r\n    this.flag |= PropFlags.SAVE_LAST_VALUE;\r\n    return this;\r\n  }\r\n\r\n  ignoreLastValue() {\r\n    this.flag &= ~PropFlags.SAVE_LAST_VALUE;\r\n    return this;\r\n  }\r\n\r\n  report() {\r\n    console.warn(...arguments);\r\n  }\r\n\r\n  _fire(type, arg1, arg2) {\r\n    if (this.callbacks[type] === undefined) {\r\n      return;\r\n    }\r\n\r\n    let stack = this.callbacks[type];\r\n    stack = stack.concat([]); //copy\r\n\r\n    for (let i = 0; i < stack.length; i++) {\r\n      let cb = stack[i];\r\n\r\n      if (cb instanceof OnceTag) {\r\n        let j = i;\r\n\r\n        //remove callback;\r\n        while (j < stack.length - 1) {\r\n          stack[j] = stack[j + 1];\r\n          j++;\r\n        }\r\n\r\n        stack[j] = undefined;\r\n        stack.length--;\r\n\r\n        i--;\r\n\r\n        cb.cb.call(this, arg1, arg2);\r\n      } else {\r\n        cb.call(this, arg1, arg2);\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  clearEventCallbacks() {\r\n    this.callbacks = {};\r\n    return this;\r\n  }\r\n\r\n  once(type, cb) {\r\n    if (this.callbacks[type] === undefined) {\r\n      this.callbacks[type] = [];\r\n    }\r\n\r\n    //check if cb is already in callback list inside a OnceTag\r\n    for (let cb2 of this.callbacks[type]) {\r\n      if (cb2 instanceof OnceTag && cb2.cb === cb) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    cb = new OnceTag(cb);\r\n\r\n    this.callbacks[type].push(cb);\r\n\r\n    return this;\r\n  }\r\n\r\n  on(type, cb) {\r\n    if (this.callbacks[type] === undefined) {\r\n      this.callbacks[type] = [];\r\n    }\r\n\r\n    this.callbacks[type].push(cb);\r\n    return this;\r\n  }\r\n\r\n  off(type, cb) {\r\n    this.callbacks[type].remove(cb);\r\n    return this;\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      type       : this.type,\r\n      subtype    : this.subtype,\r\n      apiname    : this.apiname,\r\n      uiname     : this.uiname,\r\n      description: this.description,\r\n      flag       : this.flag,\r\n      icon       : this.icon,\r\n      data       : this.data,\r\n      range      : this.range,\r\n      uiRange    : this.uiRange,\r\n      step       : this.step,\r\n    };\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    this.type = obj.type;\r\n    this.subtype = obj.subtype;\r\n    this.apiname = obj.apiname;\r\n    this.uiname = obj.uiname;\r\n    this.description = obj.description;\r\n    this.flag = obj.flag;\r\n    this.icon = obj.icon;\r\n    this.data = obj.data;\r\n\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  setValue(val) {\r\n    if (this.constructor === ToolProperty) {\r\n      throw new Error(\"implement me!\");\r\n    }\r\n\r\n    this.wasSet = true;\r\n\r\n    this._fire(\"change\", val);\r\n  }\r\n\r\n  copyTo(b) {\r\n    b.apiname = this.apiname;\r\n\r\n    b.uiname = this.uiname;\r\n    b.description = this.description;\r\n    b.icon = this.icon;\r\n    b.icon2 = this.icon2;\r\n\r\n    b.baseUnit = this.baseUnit;\r\n    b.subtype = this.subtype;\r\n    b.displayUnit = this.displayUnit;\r\n\r\n    b.flag = this.flag;\r\n\r\n    for (let k in this.callbacks) {\r\n      b.callbacks[k] = this.callbacks[k];\r\n    }\r\n  }\r\n\r\n  copy() {\r\n    //default copy method\r\n    let ret = new this.constructor();\r\n\r\n    this.copyTo(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  setStep(step) {\r\n    this.step = step;\r\n    return this;\r\n  }\r\n\r\n  getStep(value = 1.0) {\r\n    if (this.stepIsRelative) {\r\n      return ToolProperty.calcRelativeStep(this.step, value);\r\n    } else {\r\n      return this.step;\r\n    }\r\n  }\r\n\r\n  setRelativeStep(step) {\r\n    this.step = step;\r\n    this.stepIsRelative = true;\r\n  }\r\n\r\n  setRange(min, max) {\r\n    if (min === undefined || max === undefined) {\r\n      throw new Error(\"min and/or max cannot be undefined\");\r\n    }\r\n\r\n    this.range = [min, max];\r\n    return this;\r\n  }\r\n\r\n  noUnits() {\r\n    this.baseUnit = this.displayUnit = \"none\";\r\n    return this;\r\n  }\r\n\r\n  setBaseUnit(unit) {\r\n    this.baseUnit = unit;\r\n    return this;\r\n  }\r\n\r\n  setDisplayUnit(unit) {\r\n    this.displayUnit = unit;\r\n    return this;\r\n  }\r\n\r\n  setUnit(unit) {\r\n    this.baseUnit = this.displayUnit = unit;\r\n    return this;\r\n  }\r\n\r\n  setFlag(f, combine = false) {\r\n    this.flag = combine ? this.flag | f : f;\r\n    return this;\r\n  }\r\n\r\n  setUIRange(min, max) {\r\n    if (min === undefined || max === undefined) {\r\n      throw new Error(\"min and/or max cannot be undefined\");\r\n    }\r\n\r\n    this.uiRange = [min, max];\r\n    return this;\r\n  }\r\n\r\n  setIcon(icon) {\r\n    this.icon = icon;\r\n\r\n    return this;\r\n  }\r\n\r\n  setIcon2(icon) {\r\n    this.icon2 = icon;\r\n\r\n    return this;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    if (this.uiRange[0] === -1e17 && this.uiRange[1] === 1e17) {\r\n      this.uiRange = undefined;\r\n    }\r\n\r\n    if (this.baseUnit === \"undefined\") {\r\n      this.baseUnit = undefined;\r\n    }\r\n\r\n    if (this.displayUnit === \"undefined\") {\r\n      this.displayUnit = undefined;\r\n    }\r\n  }\r\n}\r\n\r\nToolProperty.STRUCT = `\r\nToolProperty { \r\n  apiname        : string | \"\"+this.apiname;\r\n  type           : int;\r\n  flag           : int;\r\n  subtype        : int;\r\n  icon           : int;\r\n  icon2          : int;\r\n  baseUnit       : string | \"\"+this.baseUnit;\r\n  displayUnit    : string | \"\"+this.displayUnit;\r\n  range          : array(float) | this.range ? this.range : [-1e17, 1e17];\r\n  uiRange        : array(float) | this.uiRange ? this.uiRange : [-1e17, 1e17];\r\n  description    : string;\r\n  stepIsRelative : bool;\r\n  step           : float;\r\n  expRate        : float;\r\n  radix          : float;\r\n  decimalPlaces  : int;\r\n  uiname         : string | this.uiname || this.apiname || \"\";\r\n  wasSet         : bool;\r\n}\r\n`;\r\nnstructjs.register(ToolProperty);\r\n\r\nwindow.ToolProperty = ToolProperty;\r\n\r\nexport class FloatArrayProperty extends ToolProperty {\r\n  constructor(value, apiname, uiname, description, flag, icon) {\r\n    super(PropTypes.FLOAT_ARRAY, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.value = [];\r\n\r\n    if (value !== undefined) {\r\n      this.setValue(value);\r\n    }\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return this.value[Symbol.iterator]();\r\n  }\r\n\r\n  setValue(value) {\r\n    super.setValue();\r\n\r\n    if (value === undefined) {\r\n      throw new Error(\"value was undefined in FloatArrayProperty's setValue method\");\r\n    }\r\n\r\n    this.value.length = 0;\r\n\r\n    for (let item of value) {\r\n      if (typeof item !== \"number\" && typeof item !== \"boolean\") {\r\n        console.log(value);\r\n        throw new Error(\"bad item for FloatArrayProperty \" + item);\r\n      }\r\n\r\n      this.value.push(item);\r\n    }\r\n  }\r\n\r\n  push(item) {\r\n    if (typeof item !== \"number\" && typeof item !== \"boolean\") {\r\n      console.log(value);\r\n      throw new Error(\"bad item for FloatArrayProperty \" + item);\r\n    }\r\n\r\n    this.value.push(item);\r\n  }\r\n\r\n  getValue() {\r\n    return this.value;\r\n  }\r\n\r\n  clear() {\r\n    this.value.length = 0;\r\n    return this;\r\n  }\r\n}\r\n\r\nFloatArrayProperty.STRUCT =\r\n  nstructjs.inherit(FloatArrayProperty, ToolProperty) +\r\n  `\r\n  value : array(float);\r\n}`;\r\nnstructjs.register(FloatArrayProperty);\r\n\r\nexport class StringProperty extends ToolProperty {\r\n  constructor(value, apiname, uiname, description, flag, icon) {\r\n    super(PropTypes.STRING, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.multiLine = false;\r\n\r\n    if (value) {\r\n      this.setValue(value);\r\n    } else {\r\n      this.setValue(\"\");\r\n    }\r\n\r\n    this.wasSet = false;\r\n  }\r\n\r\n  calcMemSize() {\r\n    return super.calcMemSize() + (this.data !== undefined ? this.data.length * 4 : 0) + 8;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data === b.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n\r\n    b.data = this.data;\r\n    b.multiLine = this.multiLine;\r\n\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  setValue(val) {\r\n    //fire events\r\n    super.setValue(val);\r\n    this.data = val;\r\n  }\r\n}\r\n\r\nStringProperty.STRUCT =\r\n  nstructjs.inherit(StringProperty, ToolProperty) +\r\n  `\r\n  data : string;\r\n}\r\n`;\r\nnstructjs.register(StringProperty);\r\nToolProperty.internalRegister(StringProperty);\r\n\r\n/*\r\nlet num_res = [\r\n  /([0-9]+)/,\r\n  /((0x)?[0-9a-fA-F]+(h?))/,\r\n  /([0-9]+\\.[0-9]*)/,\r\n  /([0-9]*\\.[0-9]+)/,\r\n  /(\\.[0-9]+)/\r\n];\r\n//num_re = /([0-9]+\\.[0-9]*)|([0-9]*\\.[0-9]+)/\r\n*/\r\n\r\nexport { isNumber } from \"../../core/units.js\";\r\n/*\r\nexport function isNumber(f) {\r\n  if (f === \"NaN\" || (typeof f == \"number\" && isNaN(f))) {\r\n    return false;\r\n  }\r\n\r\n  f = (\"\" + f).trim();\r\n\r\n  let ok = false;\r\n\r\n  for (let re of num_res) {\r\n    let ret = f.match(re)\r\n    if (!ret) {\r\n      ok = false;\r\n      continue;\r\n    }\r\n\r\n    ok = ret[0].length === f.length;\r\n    if (ok) {\r\n      break;\r\n    }\r\n  }\r\n\r\n  return ok;\r\n}*/\r\n\r\n//window.isNumber = isNumber;\r\n\r\nexport class NumProperty extends ToolProperty {\r\n  constructor(type, value, apiname, uiname, description, flag, icon) {\r\n    super(type, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.data = 0;\r\n    this.range = [0, 0];\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data == b.data;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n  }\r\n}\r\nNumProperty.STRUCT =\r\n  nstructjs.inherit(NumProperty, ToolProperty) +\r\n  `\r\n  range : array(float);\r\n  data  : float;\r\n}\r\n`;\r\n\r\nexport class _NumberPropertyBase extends ToolProperty {\r\n  constructor(type, value, apiname, uiname, description, flag, icon) {\r\n    super(type, null, apiname, uiname, description, flag, icon);\r\n\r\n    this.data = 0.0;\r\n\r\n    //remember to update NumberConstraintsBase et al when adding new number\r\n    //constraints\r\n\r\n    /** Display simple sliders with exponent divisions, don't\r\n     * confuse with expRate which affects rollar\r\n     * slider speed.\r\n     */\r\n    this.sliderDisplayExp = 1.0;\r\n\r\n    /** controls roller slider rate */\r\n    this.slideSpeed = 1.0;\r\n\r\n    /** exponential rate, used by roller sliders */\r\n    this.expRate = 1.33;\r\n    this.step = 0.1;\r\n\r\n    this.stepIsRelative = false;\r\n\r\n    this.range = [-1e17, 1e17];\r\n\r\n    /** if undefined this.range will be used */\r\n    this.uiRange = undefined;\r\n\r\n    if (value !== undefined && value !== null) {\r\n      this.setValue(value);\r\n      this.wasSet = false;\r\n    }\r\n  }\r\n\r\n  get ui_range() {\r\n    this.report(\"NumberProperty.ui_range is deprecated\");\r\n    return this.uiRange;\r\n  }\r\n\r\n  set ui_range(val) {\r\n    this.report(\"NumberProperty.ui_range is deprecated\");\r\n    this.uiRange = val;\r\n  }\r\n\r\n  calcMemSize() {\r\n    return super.calcMemSize() + 8 * 8;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data === b.data;\r\n  }\r\n\r\n  toJSON() {\r\n    let json = super.toJSON();\r\n\r\n    json.data = this.data;\r\n    json.expRate = this.expRate;\r\n\r\n    return json;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n\r\n    b.displayUnit = this.displayUnit;\r\n    b.baseUnit = this.baseUnit;\r\n    b.expRate = this.expRate;\r\n    b.step = this.step;\r\n    b.range = this.range ? [this.range[0], this.range[1]] : undefined;\r\n    b.uiRange = this.uiRange ? [this.uiRange[0], this.uiRange[1]] : undefined;\r\n    b.slideSpeed = this.slideSpeed;\r\n    b.sliderDisplayExp = this.sliderDisplayExp;\r\n\r\n    b.data = this.data;\r\n  }\r\n\r\n  setSliderDisplayExp(f) {\r\n    this.sliderDisplayExp = f;\r\n    return this;\r\n  }\r\n\r\n  setSlideSpeed(f) {\r\n    this.slideSpeed = f;\r\n\r\n    return this;\r\n  }\r\n\r\n  /*\r\n   * non-linear exponent for number sliders\r\n   * in roll mode\r\n   * */\r\n  setExpRate(exp) {\r\n    this.expRate = exp;\r\n  }\r\n\r\n  setValue(val) {\r\n    if (val === undefined || val === null) {\r\n      return;\r\n    }\r\n\r\n    if (typeof val !== \"number\") {\r\n      throw new Error(\"Invalid number \" + val);\r\n    }\r\n\r\n    this.data = val;\r\n\r\n    super.setValue(val);\r\n    return this;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    let get = (key) => {\r\n      if (key in obj) {\r\n        this[key] = obj[key];\r\n      }\r\n    };\r\n\r\n    get(\"range\");\r\n    get(\"step\");\r\n    get(\"expRate\");\r\n    get(\"ui_range\");\r\n\r\n    return this;\r\n  }\r\n}\r\n_NumberPropertyBase.STRUCT =\r\n  nstructjs.inherit(_NumberPropertyBase, ToolProperty) +\r\n  `\r\n  range            : array(float);\r\n  expRate          : float;\r\n  data             : float;\r\n  step             : float;\r\n  slideSpeed       : float;\r\n  sliderDisplayExp : float;\r\n}\r\n`;\r\nnstructjs.register(_NumberPropertyBase);\r\n\r\nexport class IntProperty extends _NumberPropertyBase {\r\n  constructor(value, apiname, uiname, description, flag, icon) {\r\n    super(PropTypes.INT, value, apiname, uiname, description, flag, icon);\r\n\r\n    //remember to update NumberConstraintsBase et al when adding new number\r\n    //constraints\r\n\r\n    /* Integer properties don't use default unit. */\r\n    this.baseUnit = this.displayUnit = \"none\";\r\n\r\n    this.radix = 10;\r\n  }\r\n\r\n  setValue(val) {\r\n    super.setValue(Math.floor(val));\r\n    return this;\r\n  }\r\n\r\n  setRadix(radix) {\r\n    this.radix = radix;\r\n  }\r\n\r\n  toJSON() {\r\n    let json = super.toJSON();\r\n\r\n    json.data = this.data;\r\n    json.radix = this.radix;\r\n\r\n    return json;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    this.data = obj.data || this.data;\r\n    this.radix = obj.radix || this.radix;\r\n\r\n    return this;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n  }\r\n}\r\n\r\nIntProperty.STRUCT =\r\n  nstructjs.inherit(IntProperty, _NumberPropertyBase) +\r\n  `\r\n  data : int;\r\n}`;\r\nnstructjs.register(IntProperty);\r\n\r\nToolProperty.internalRegister(IntProperty);\r\n\r\nexport class ReportProperty extends StringProperty {\r\n  constructor(value, apiname, uiname, description, flag, icon) {\r\n    super(value, apiname, uiname, description, flag, icon);\r\n\r\n    this.type = PropTypes.REPORT;\r\n  }\r\n}\r\n\r\nReportProperty.STRUCT =\r\n  nstructjs.inherit(ReportProperty, StringProperty) +\r\n  `\r\n}\r\n`;\r\nnstructjs.register(ReportProperty);\r\nToolProperty.internalRegister(ReportProperty);\r\n\r\nexport class BoolProperty extends ToolProperty {\r\n  constructor(value, apiname, uiname, description, flag, icon) {\r\n    super(PropTypes.BOOL, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.data = !!value;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data == b.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n    b.data = this.data;\r\n\r\n    return this;\r\n  }\r\n\r\n  setValue(val) {\r\n    this.data = !!val;\r\n    super.setValue(val);\r\n\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = super.toJSON();\r\n\r\n    return ret;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nToolProperty.internalRegister(BoolProperty);\r\nBoolProperty.STRUCT =\r\n  nstructjs.inherit(BoolProperty, ToolProperty) +\r\n  `\r\n  data : bool;\r\n}\r\n`;\r\nnstructjs.register(BoolProperty);\r\n\r\nexport class FloatProperty extends _NumberPropertyBase {\r\n  constructor(value, apiname, uiname, description, flag, icon) {\r\n    super(PropTypes.FLOAT, value, apiname, uiname, description, flag, icon);\r\n\r\n    //remember to update NumberConstraintsBase et al when adding new number\r\n    //constraints\r\n\r\n    this.decimalPlaces = 4;\r\n  }\r\n\r\n  setDecimalPlaces(n) {\r\n    this.decimalPlaces = n;\r\n    return this;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n    b.data = this.data;\r\n    return this;\r\n  }\r\n\r\n  setValue(val) {\r\n    this.data = val;\r\n\r\n    //fire events\r\n    super.setValue(val);\r\n\r\n    return this;\r\n  }\r\n\r\n  toJSON() {\r\n    let json = super.toJSON();\r\n\r\n    json.data = this.data;\r\n    json.decimalPlaces = this.decimalPlaces;\r\n\r\n    return json;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    this.data = obj.data || this.data;\r\n    this.decimalPlaces = obj.decimalPlaces || this.decimalPlaces;\r\n\r\n    return this;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n  }\r\n}\r\n\r\nToolProperty.internalRegister(FloatProperty);\r\nFloatProperty.STRUCT =\r\n  nstructjs.inherit(FloatProperty, _NumberPropertyBase) +\r\n  `\r\n  decimalPlaces : int;\r\n  data          : float;\r\n}\r\n`;\r\nnstructjs.register(FloatProperty);\r\n\r\nexport class EnumKeyPair {\r\n  constructor(key, val) {\r\n    this.key = \"\" + key;\r\n    this.val = \"\" + val;\r\n    this.key_is_int = typeof key === \"number\" || typeof key === \"boolean\";\r\n    this.val_is_int = typeof val === \"number\" || typeof val === \"boolean\";\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    if (this.val_is_int) {\r\n      this.val = parseInt(this.val);\r\n    }\r\n\r\n    if (this.key_is_int) {\r\n      this.key = parseInt(this.key);\r\n    }\r\n  }\r\n}\r\n\r\nEnumKeyPair.STRUCT = `\r\nEnumKeyPair {\r\n  key        : string;\r\n  val        : string;\r\n  key_is_int : bool;\r\n  val_is_int : bool; \r\n}\r\n`;\r\nnstructjs.register(EnumKeyPair);\r\n\r\nexport class EnumProperty extends ToolProperty {\r\n  constructor(string_or_int, valid_values, apiname, uiname, description, flag, icon) {\r\n    super(PropTypes.ENUM, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.dynamicMetaCB = undefined;\r\n    this.values = {};\r\n    this.keys = {};\r\n    this.ui_value_names = {};\r\n    this.descriptions = {};\r\n\r\n    if (valid_values === undefined) return this;\r\n\r\n    if (valid_values instanceof Array || valid_values instanceof String) {\r\n      for (var i = 0; i < valid_values.length; i++) {\r\n        this.values[valid_values[i]] = valid_values[i];\r\n        this.keys[valid_values[i]] = valid_values[i];\r\n      }\r\n    } else {\r\n      for (var k in valid_values) {\r\n        this.values[k] = valid_values[k];\r\n        this.keys[valid_values[k]] = k;\r\n      }\r\n    }\r\n\r\n    if (string_or_int === undefined) {\r\n      this.data = first(valid_values);\r\n    } else {\r\n      this.setValue(string_or_int);\r\n    }\r\n\r\n    for (var k in this.values) {\r\n      let uin = k.replace(/[_-]/g, \" \").trim();\r\n      uin = uin.split(\" \");\r\n\r\n      let uiname = ToolProperty.makeUIName(k);\r\n\r\n      this.ui_value_names[k] = uiname;\r\n      this.descriptions[k] = uiname;\r\n    }\r\n\r\n    this.iconmap = {};\r\n    this.iconmap2 = {};\r\n\r\n    this.wasSet = false;\r\n  }\r\n\r\n  /**\r\n   * Provide a callback to update the enum or flags property dynamically\r\n   * Callback should call enumProp.updateDefinition to update the property.\r\n   *\r\n   * @param metaCB: (enumProp: EnumProperty|FlagsProperty) => void\r\n   */\r\n  dynamicMeta(metaCB) {\r\n    this.on(\"meta\", metaCB);\r\n    return this;\r\n  }\r\n\r\n  checkMeta() {\r\n    this._fire(\"meta\", this);\r\n  }\r\n\r\n  calcHash(digest = new util.HashDigest()) {\r\n    this.checkMeta();\r\n    for (let key in this.keys) {\r\n      digest.add(key);\r\n      digest.add(this.keys[key]);\r\n    }\r\n\r\n    return digest.get();\r\n  }\r\n\r\n  updateDefinition(enumdef_or_prop) {\r\n    let descriptions = this.descriptions;\r\n    let ui_value_names = this.ui_value_names;\r\n\r\n    this.values = {};\r\n    this.keys = {};\r\n    this.ui_value_names = {};\r\n    this.descriptions = {};\r\n\r\n    let enumdef;\r\n\r\n    if (enumdef_or_prop instanceof EnumProperty) {\r\n      enumdef = enumdef_or_prop.values;\r\n    } else {\r\n      enumdef = enumdef_or_prop;\r\n    }\r\n\r\n    for (let k in enumdef) {\r\n      let v = enumdef[k];\r\n\r\n      this.values[k] = v;\r\n      this.keys[v] = k;\r\n    }\r\n\r\n    if (enumdef_or_prop instanceof EnumProperty) {\r\n      let prop = enumdef_or_prop;\r\n      this.iconmap = Object.assign({}, prop.iconmap);\r\n      this.iconmap2 = Object.assign({}, prop.iconmap2);\r\n\r\n      this.ui_value_names = Object.assign({}, prop.ui_value_names);\r\n      this.descriptions = Object.assign({}, prop.descriptions);\r\n    } else {\r\n      for (let k in this.values) {\r\n        if (k in ui_value_names) {\r\n          this.ui_value_names[k] = ui_value_names[k];\r\n        } else {\r\n          this.ui_value_names[k] = ToolProperty.makeUIName(k);\r\n        }\r\n\r\n        if (k in descriptions) {\r\n          this.descriptions[k] = descriptions[k];\r\n        } else {\r\n          this.descriptions[k] = ToolProperty.makeUIName(k);\r\n        }\r\n      }\r\n    }\r\n\r\n    this._fire(\"metaChange\", this);\r\n\r\n    return this;\r\n  }\r\n\r\n  calcMemSize() {\r\n    this.checkMeta();\r\n    let tot = super.calcMemSize();\r\n\r\n    for (let k in this.values) {\r\n      tot += (k.length * 4 + 16) * 4;\r\n    }\r\n\r\n    if (this.descriptions) {\r\n      for (let k in this.descriptions) {\r\n        tot += (k.length + this.descriptions[k].length) * 4;\r\n      }\r\n    }\r\n\r\n    return tot + 64;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.getValue() === b.getValue();\r\n  }\r\n\r\n  addUINames(map) {\r\n    for (let k in map) {\r\n      this.ui_value_names[k] = map[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addDescriptions(map) {\r\n    for (let k in map) {\r\n      this.descriptions[k] = map[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addIcons2(iconmap2) {\r\n    if (this.iconmap2 === undefined) {\r\n      this.iconmap2 = {};\r\n    }\r\n\r\n    for (let k in iconmap2) {\r\n      this.iconmap2[k] = iconmap2[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addIcons(iconmap) {\r\n    if (this.iconmap === undefined) {\r\n      this.iconmap = {};\r\n    }\r\n    for (let k in iconmap) {\r\n      this.iconmap[k] = iconmap[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  copyTo(p) {\r\n    super.copyTo(p);\r\n\r\n    p.data = this.data;\r\n\r\n    // copy meta event handlers\r\n    p.callbacks.meta = Array.from(this.callbacks.meta ?? []);\r\n\r\n    p.keys = Object.assign({}, this.keys);\r\n    p.values = Object.assign({}, this.values);\r\n    p.ui_value_names = this.ui_value_names;\r\n    p.update = this.update;\r\n    p.api_update = this.api_update;\r\n\r\n    p.iconmap = this.iconmap;\r\n    p.iconmap2 = this.iconmap2;\r\n    p.descriptions = this.descriptions;\r\n\r\n    return p;\r\n  }\r\n\r\n  copy() {\r\n    var p = new this.constructor(\"dummy\", { \"dummy\": 0 }, this.apiname, this.uiname, this.description, this.flag);\r\n\r\n    this.copyTo(p);\r\n    return p;\r\n  }\r\n\r\n  getValue() {\r\n    if (this.data in this.values) return this.values[this.data];\r\n    else return this.data;\r\n  }\r\n\r\n  setValue(val) {\r\n    this.checkMeta();\r\n    if (!(val in this.values) && val in this.keys) val = this.keys[val];\r\n\r\n    if (!(val in this.values)) {\r\n      this.report(\"Invalid value for enum!\", val, this.values);\r\n      return;\r\n    }\r\n\r\n    this.data = val;\r\n\r\n    //fire events\r\n    super.setValue(val);\r\n    return this;\r\n  }\r\n\r\n  _loadMap(obj) {\r\n    if (!obj) {\r\n      return {};\r\n    }\r\n\r\n    let ret = {};\r\n    for (let k of obj) {\r\n      ret[k.key] = k.val;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  _saveMap(obj) {\r\n    obj = obj === undefined ? {} : obj;\r\n    let ret = [];\r\n\r\n    for (let k in obj) {\r\n      ret.push(new EnumKeyPair(k, obj[k]));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n\r\n    this.keys = this._loadMap(this._keys);\r\n    this.values = this._loadMap(this._values);\r\n    this.ui_value_names = this._loadMap(this._ui_value_names);\r\n    this.iconmap = this._loadMap(this._iconmap);\r\n    this.iconmap2 = this._loadMap(this._iconmap2);\r\n    this.descriptions = this._loadMap(this._descriptions);\r\n\r\n    if (this.data_is_int) {\r\n      this.data = parseInt(this.data);\r\n      delete this.data_is_int;\r\n    } else if (this.data in this.keys) {\r\n      this.data = this.keys[this.data];\r\n    }\r\n  }\r\n\r\n  _is_data_int() {\r\n    return typeof this.data === \"number\";\r\n  }\r\n}\r\n\r\nToolProperty.internalRegister(EnumProperty);\r\nEnumProperty.STRUCT =\r\n  nstructjs.inherit(EnumProperty, ToolProperty) +\r\n  `\r\n  data            : string             | \"\"+this.data;\r\n  data_is_int     : bool               | this._is_data_int();\r\n  _keys           : array(EnumKeyPair) | this._saveMap(this.keys) ;\r\n  _values         : array(EnumKeyPair) | this._saveMap(this.values) ;\r\n  _ui_value_names : array(EnumKeyPair) | this._saveMap(this.ui_value_names) ;\r\n  _iconmap        : array(EnumKeyPair) | this._saveMap(this.iconmap) ;\r\n  _iconmap2       : array(EnumKeyPair) | this._saveMap(this.iconmap2) ;\r\n  _descriptions   : array(EnumKeyPair) | this._saveMap(this.descriptions) ;  \r\n}\r\n`;\r\nnstructjs.register(EnumProperty);\r\n\r\nexport class FlagProperty extends EnumProperty {\r\n  constructor(string_or_int, valid_values, apiname, uiname, description, flag, icon) {\r\n    super(string_or_int, valid_values, apiname, uiname, description, flag, icon);\r\n\r\n    this.type = PropTypes.FLAG;\r\n    this.wasSet = false;\r\n  }\r\n\r\n  setValue(bitmask) {\r\n    this.checkMeta();\r\n    this.data = bitmask;\r\n\r\n    //do not trigger EnumProperty's setValue\r\n    ToolProperty.prototype.setValue.call(this, bitmask);\r\n    return this;\r\n  }\r\n}\r\n\r\nToolProperty.internalRegister(FlagProperty);\r\nFlagProperty.STRUCT =\r\n  nstructjs.inherit(FlagProperty, EnumProperty) +\r\n  `\r\n}\r\n`;\r\nnstructjs.register(FlagProperty);\r\n\r\nexport class VecPropertyBase extends FloatProperty {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(undefined, apiname, uiname, description);\r\n\r\n    this.hasUniformSlider = false;\r\n  }\r\n\r\n  calcMemSize() {\r\n    return super.calcMemSize() + this.data.length * 8;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data.vectorDistance(b.data) < 0.00001;\r\n  }\r\n\r\n  uniformSlider(state = true) {\r\n    this.hasUniformSlider = state;\r\n    return this;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n    b.hasUniformSlider = this.hasUniformSlider;\r\n  }\r\n}\r\n\r\nVecPropertyBase.STRUCT =\r\n  nstructjs.inherit(VecPropertyBase, FloatProperty) +\r\n  `\r\n  hasUniformSlider : bool | this.hasUniformSlider || false;\r\n}\r\n`;\r\n\r\nexport class Vec2Property extends FloatProperty {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(undefined, apiname, uiname, description);\r\n\r\n    this.type = PropTypes.VEC2;\r\n    this.data = new Vector2(data);\r\n  }\r\n\r\n  setValue(v) {\r\n    this.data.load(v);\r\n\r\n    //do not trigger parent classes's setValue\r\n    ToolProperty.prototype.setValue.call(this, v);\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    let data = b.data;\r\n    super.copyTo(b);\r\n\r\n    b.data = data;\r\n    b.data.load(this.data);\r\n  }\r\n}\r\n\r\nVec2Property.STRUCT =\r\n  nstructjs.inherit(Vec2Property, VecPropertyBase) +\r\n  `\r\n  data : vec2;\r\n}\r\n`;\r\nnstructjs.register(Vec2Property);\r\n\r\nToolProperty.internalRegister(Vec2Property);\r\n\r\nexport class Vec3Property extends VecPropertyBase {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(undefined, apiname, uiname, description);\r\n\r\n    this.type = PropTypes.VEC3;\r\n    this.data = new Vector3(data);\r\n  }\r\n\r\n  isColor() {\r\n    this.subtype = PropSubTypes.COLOR;\r\n    return this;\r\n  }\r\n\r\n  setValue(v) {\r\n    this.data.load(v);\r\n\r\n    //do not trigger parent classes's setValue\r\n    ToolProperty.prototype.setValue.call(this, v);\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    let data = b.data;\r\n    super.copyTo(b);\r\n\r\n    b.data = data;\r\n    b.data.load(this.data);\r\n  }\r\n}\r\n\r\nVec3Property.STRUCT =\r\n  nstructjs.inherit(Vec3Property, VecPropertyBase) +\r\n  `\r\n  data : vec3;\r\n}\r\n`;\r\nnstructjs.register(Vec3Property);\r\nToolProperty.internalRegister(Vec3Property);\r\n\r\nexport class Vec4Property extends FloatProperty {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(undefined, apiname, uiname, description);\r\n\r\n    this.type = PropTypes.VEC4;\r\n    this.data = new Vector4(data);\r\n  }\r\n\r\n  setValue(v, w = 1.0) {\r\n    this.data.load(v);\r\n\r\n    //do not trigger parent classes's setValue\r\n    ToolProperty.prototype.setValue.call(this, v);\r\n\r\n    if (v.length < 3) {\r\n      this.data[2] = 0.0;\r\n    }\r\n    if (v.length < 4) {\r\n      this.data[3] = w;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  isColor() {\r\n    this.subtype = PropSubTypes.COLOR;\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    let data = b.data;\r\n    super.copyTo(b);\r\n\r\n    b.data = data;\r\n    b.data.load(this.data);\r\n  }\r\n}\r\n\r\nVec4Property.STRUCT =\r\n  nstructjs.inherit(Vec4Property, VecPropertyBase) +\r\n  `\r\n  data : vec4;\r\n}\r\n`;\r\nnstructjs.register(Vec4Property);\r\nToolProperty.internalRegister(Vec4Property);\r\n\r\nexport class QuatProperty extends ToolProperty {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(PropTypes.QUAT, undefined, apiname, uiname, description);\r\n    this.data = new Quat(data);\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data.vectorDistance(b.data) < 0.00001;\r\n  }\r\n\r\n  setValue(v) {\r\n    this.data.load(v);\r\n    super.setValue(v);\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    let data = b.data;\r\n    super.copyTo(b);\r\n\r\n    b.data = data;\r\n    b.data.load(this.data);\r\n  }\r\n}\r\n\r\nQuatProperty.STRUCT =\r\n  nstructjs.inherit(QuatProperty, VecPropertyBase) +\r\n  `\r\n  data : vec4;\r\n}\r\n`;\r\nnstructjs.register(QuatProperty);\r\n\r\nToolProperty.internalRegister(QuatProperty);\r\n\r\nexport class Mat4Property extends ToolProperty {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(PropTypes.MATRIX4, undefined, apiname, uiname, description);\r\n    this.data = new Matrix4(data);\r\n  }\r\n\r\n  calcMemSize() {\r\n    return super.calcMemSize() + 16 * 8 + 32;\r\n  }\r\n\r\n  equals(b) {\r\n    let m1 = this.data.$matrix;\r\n    let m2 = b.data.$matrix;\r\n\r\n    for (let i = 1; i <= 4; i++) {\r\n      for (let j = 1; j <= 4; j++) {\r\n        let key = `m${i}${j}`;\r\n\r\n        if (Math.abs(m1[key] - m2[key]) > 0.00001) {\r\n          return false;\r\n        }\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  setValue(v) {\r\n    this.data.load(v);\r\n    super.setValue(v);\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    let data = b.data;\r\n    super.copyTo(b);\r\n    b.data = data;\r\n\r\n    b.data.load(this.data);\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n  }\r\n}\r\n\r\nMat4Property.STRUCT =\r\n  nstructjs.inherit(Mat4Property, FloatProperty) +\r\n  `\r\n  data           : mat4;\r\n}\r\n`;\r\nnstructjs.register(Mat4Property);\r\nToolProperty.internalRegister(Mat4Property);\r\n\r\n/**\r\n * List of other tool props (all of one type)\r\n */\r\nexport class ListProperty extends ToolProperty {\r\n  /*\r\n   * Prop must be a ToolProperty subclass instance\r\n   * */\r\n  constructor(prop, list = [], uiname = \"\") {\r\n    super(PropTypes.PROPLIST);\r\n\r\n    this.uiname = uiname;\r\n    this.flag &= ~PropFlags.SAVE_LAST_VALUE;\r\n\r\n    if (typeof prop == \"number\") {\r\n      prop = PropClasses[prop];\r\n\r\n      if (prop !== undefined) {\r\n        prop = new prop();\r\n      }\r\n    } else if (prop !== undefined) {\r\n      if (prop instanceof ToolProperty) {\r\n        prop = prop.copy();\r\n      } else {\r\n        prop = new prop();\r\n      }\r\n    }\r\n\r\n    this.prop = prop;\r\n    this.value = [];\r\n\r\n    if (list) {\r\n      for (let val of list) {\r\n        this.push(val);\r\n      }\r\n    }\r\n\r\n    this.wasSet = false;\r\n  }\r\n\r\n  get length() {\r\n    return this.value.length;\r\n  }\r\n\r\n  set length(val) {\r\n    this.value.length = val;\r\n  }\r\n\r\n  splice(i, deleteCount, ...newItems) {\r\n    const deletedItems = this.value.splice(i, deleteCount, ...newItems);\r\n    this.length = this.value.length;\r\n    return deletedItems;\r\n  }\r\n\r\n  calcMemSize() {\r\n    let tot = super.calcMemSize();\r\n\r\n    let psize = this.prop ? this.prop.calcMemSize() + 8 : 8;\r\n    if (!this.prop && this.value.length > 0) {\r\n      psize = this.value[0].calcMemSize();\r\n    }\r\n\r\n    tot += psize * this.value.length + 8;\r\n    tot += 16;\r\n\r\n    return tot;\r\n  }\r\n\r\n  equals(b) {\r\n    let l1 = this.value ? this.value.length : 0;\r\n    let l2 = b.value ? b.value.length : 0;\r\n\r\n    if (l1 !== l2) {\r\n      return false;\r\n    }\r\n\r\n    for (let i = 0; i < l1; i++) {\r\n      let prop1 = this.value[i];\r\n      let prop2 = b.value[i];\r\n\r\n      let bad = prop1.constructor !== prop2.constructor;\r\n      bad = bad || !prop1.equals(prop2);\r\n\r\n      if (bad) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n\r\n    b.prop = this.prop.copy();\r\n    b.value.length = [];\r\n\r\n    for (let prop of this.value) {\r\n      b.value.push(prop.copy());\r\n    }\r\n\r\n    return b;\r\n  }\r\n\r\n  copy() {\r\n    return this.copyTo(new ListProperty(this.prop.copy()));\r\n  }\r\n\r\n  push(item = undefined) {\r\n    if (item === undefined) {\r\n      item = this.prop.copy();\r\n    }\r\n\r\n    if (!(item instanceof ToolProperty)) {\r\n      let prop = this.prop.copy();\r\n      prop.setValue(item);\r\n      item = prop;\r\n    }\r\n\r\n    this.value.push(item);\r\n    return item;\r\n  }\r\n\r\n  clear() {\r\n    this.value.length = 0;\r\n    return this;\r\n  }\r\n\r\n  getListItem(i) {\r\n    if (i < 0) {\r\n      i += this.length;\r\n    }\r\n    return this.value[i].getValue();\r\n  }\r\n\r\n  setListItem(i, val) {\r\n    if (i < 0) {\r\n      i += this.length;\r\n    }\r\n    this.value[i].setValue(val);\r\n  }\r\n\r\n  setValue(value) {\r\n    this.clear();\r\n\r\n    for (let item of value) {\r\n      let prop = this.push();\r\n\r\n      if (typeof item !== \"object\") {\r\n        prop.setValue(item);\r\n      } else if (item instanceof prop.constructor) {\r\n        item.copyTo(prop);\r\n      } else {\r\n        this.report(item);\r\n        throw new Error(\"invalid value \" + item);\r\n      }\r\n    }\r\n\r\n    super.setValue(value);\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.value;\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    let list = this.value;\r\n\r\n    return (function* () {\r\n      for (let item of list) {\r\n        yield item.getValue();\r\n      }\r\n    })();\r\n  }\r\n}\r\n\r\nListProperty.STRUCT =\r\n  nstructjs.inherit(ListProperty, ToolProperty) +\r\n  `\r\n  prop  : abstract(ToolProperty);\r\n  value : array(abstract(ToolProperty));\r\n}`;\r\nnstructjs.register(ListProperty);\r\n\r\nToolProperty.internalRegister(ListProperty);\r\n\r\n//like FlagsProperty but uses strings\r\nexport class StringSetProperty extends ToolProperty {\r\n  constructor(value = undefined, definition = []) {\r\n    super(PropTypes.STRSET);\r\n\r\n    let values = [];\r\n\r\n    this.value = new util.set();\r\n\r\n    let def = definition;\r\n    if (Array.isArray(def) || def instanceof util.set || def instanceof Set) {\r\n      for (let item of def) {\r\n        values.push(item);\r\n      }\r\n    } else if (typeof def === \"object\") {\r\n      for (let k in def) {\r\n        values.push(k);\r\n      }\r\n    } else if (typeof def === \"string\") {\r\n      values.push(def);\r\n    }\r\n\r\n    this.values = {};\r\n    this.ui_value_names = {};\r\n    this.descriptions = {};\r\n    this.iconmap = {};\r\n    this.iconmap2 = {};\r\n\r\n    for (let v of values) {\r\n      this.values[v] = v;\r\n\r\n      let uiname = ToolProperty.makeUIName(v);\r\n      this.ui_value_names[v] = uiname;\r\n    }\r\n\r\n    if (value !== undefined) {\r\n      this.setValue(value);\r\n    }\r\n\r\n    this.wasSet = false;\r\n  }\r\n\r\n  calcMemSize() {\r\n    let tot = super.calcMemSize();\r\n\r\n    for (let k in this.values) {\r\n      tot += (k.length + 16) * 5;\r\n    }\r\n\r\n    if (this.descriptions) {\r\n      for (let k in this.descriptions) {\r\n        tot += (k.length + this.descriptions[k].length + 8) * 4;\r\n      }\r\n    }\r\n\r\n    return tot + 64;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.value.equals(b.value);\r\n  }\r\n\r\n  /*\r\n   * Values can be a string, undefined/null, or a list/set/object-literal of strings.\r\n   * If destructive is true, then existing set will be cleared.\r\n   * */\r\n  setValue(values, destructive = true, soft_fail = true) {\r\n    let bad = typeof values !== \"string\";\r\n    bad = bad && typeof values !== \"object\";\r\n    bad = bad && values !== undefined && values !== null;\r\n\r\n    if (bad) {\r\n      if (soft_fail) {\r\n        this.report(\"Invalid argument to StringSetProperty.prototype.setValue() \" + values);\r\n        return;\r\n      } else {\r\n        throw new Error(\"Invalid argument to StringSetProperty.prototype.setValue() \" + values);\r\n      }\r\n    }\r\n\r\n    //handle undefined/null\r\n    if (!values) {\r\n      this.value.clear();\r\n    } else if (typeof values === \"string\") {\r\n      if (destructive) this.value.clear();\r\n\r\n      if (!(values in this.values)) {\r\n        if (soft_fail) {\r\n          this.report(`\"${values}\" is not in this StringSetProperty`);\r\n          return;\r\n        } else {\r\n          throw new Error(`\"${values}\" is not in this StringSetProperty`);\r\n        }\r\n      }\r\n\r\n      this.value.add(values);\r\n    } else {\r\n      let data = [];\r\n\r\n      if (Array.isArray(values) || values instanceof util.set || values instanceof Set) {\r\n        for (let item of values) {\r\n          data.push(item);\r\n        }\r\n      } else {\r\n        //object literal?\r\n        for (let k in values) {\r\n          data.push(k);\r\n        }\r\n      }\r\n\r\n      for (let item of data) {\r\n        if (!(item in this.values)) {\r\n          if (soft_fail) {\r\n            this.report(`\"${item}\" is not in this StringSetProperty`);\r\n            continue;\r\n          } else {\r\n            throw new Error(`\"${item}\" is not in this StringSetProperty`);\r\n          }\r\n        }\r\n\r\n        this.value.add(item);\r\n      }\r\n    }\r\n\r\n    super.setValue();\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.value;\r\n  }\r\n\r\n  addIcons2(iconmap2) {\r\n    if (iconmap2 === undefined) return;\r\n\r\n    for (let k in iconmap2) {\r\n      this.iconmap2[k] = iconmap2[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addIcons(iconmap) {\r\n    if (iconmap === undefined) return;\r\n\r\n    for (let k in iconmap) {\r\n      this.iconmap[k] = iconmap[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addUINames(map) {\r\n    for (let k in map) {\r\n      this.ui_value_names[k] = map[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addDescriptions(map) {\r\n    for (let k in map) {\r\n      this.descriptions[k] = map[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n\r\n    for (let val of this.value) {\r\n      b.value.add(val);\r\n    }\r\n\r\n    b.values = {};\r\n    for (let k in this.values) {\r\n      b.values[k] = this.values[k];\r\n    }\r\n\r\n    b.ui_value_names = {};\r\n    for (let k in this.ui_value_names) {\r\n      b.ui_value_names[k] = this.ui_value_names[k];\r\n    }\r\n\r\n    b.iconmap = {};\r\n    b.iconmap2 = {};\r\n\r\n    for (let k in this.iconmap) {\r\n      b.iconmap[k] = this.iconmap[k];\r\n    }\r\n\r\n    for (let k in this.iconmap2) {\r\n      b.iconmap2[k] = this.iconmap2[k];\r\n    }\r\n\r\n    b.descriptions = {};\r\n    for (let k in this.descriptions) {\r\n      b.descriptions[k] = this.descriptions[k];\r\n    }\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    let values = this.values;\r\n    this.values = {};\r\n\r\n    for (let s of values) {\r\n      this.values[s] = s;\r\n    }\r\n\r\n    this.value = new util.set(this.value);\r\n  }\r\n}\r\n\r\nStringSetProperty.STRUCT =\r\n  nstructjs.inherit(StringSetProperty, ToolProperty) +\r\n  `\r\n  value  : iter(string);\r\n  values : iterkeys(string);  \r\n}`;\r\nnstructjs.register(StringSetProperty);\r\n\r\nToolProperty.internalRegister(StringSetProperty);\r\n","export let config = {\r\n    doubleClickTime: 500,\r\n\r\n    //auto load 1d bspline templates, can hurt startup time\r\n    autoLoadSplineTemplates: true,\r\n\r\n    //timeout for press-and-hold (touch) version of double clicking\r\n    doubleClickHoldTime: 750,\r\n    DEBUG: {}\r\n}\r\n\r\nexport function setConfig(obj) {\r\n    for (let k in obj) {\r\n        config[k] = obj[k]\r\n    }\r\n}\r\n\r\nexport default config\r\n","import * as util from \"./util.js\";\r\nimport cconst from '../config/config.js';\r\nimport {Vector2} from './vectormath.js';\r\n\r\nexport let modalstack = [];\r\nlet singleMouseCBs = {};\r\n\r\nfunction debugDomEvents() {\r\n  let cbsymbol = Symbol(\"event-callback\");\r\n  let thsymbol = Symbol(\"debug-info\");\r\n\r\n  let idgen = 0;\r\n\r\n  function init(et) {\r\n    if (!et[thsymbol]) {\r\n      et[thsymbol] = idgen++;\r\n    }\r\n  }\r\n\r\n  function getkey(et, type, options) {\r\n    init(et);\r\n    return \"\" + et[thsymbol] + \":\" + type + \":\" + JSON.stringify(options);\r\n  }\r\n\r\n  let addEventListener = EventTarget.prototype.addEventListener;\r\n  let removeEventListener = EventTarget.prototype.removeEventListener;\r\n\r\n  EventTarget.prototype.addEventListener = function (type, cb, options) {\r\n    init(this);\r\n\r\n    if (!cb[cbsymbol]) {\r\n      cb[cbsymbol] = new Set();\r\n    }\r\n\r\n    let key = getkey(this, type, options);\r\n    cb[cbsymbol].add(key);\r\n\r\n    return addEventListener.call(this, type, cb, options);\r\n  }\r\n\r\n  EventTarget.prototype.removeEventListener = function (type, cb, options) {\r\n    init(this);\r\n\r\n    if (!cb[cbsymbol]) {\r\n      console.error(\"Invalid callback in removeEventListener for\", type, this, cb);\r\n      return;\r\n    }\r\n\r\n    let key = getkey(this, type, options);\r\n\r\n    if (!cb[cbsymbol].has(key)) {\r\n      console.error(\"Callback not in removeEventListener;\", type, this, cb);\r\n      return;\r\n    }\r\n\r\n    cb[cbsymbol].delete(key);\r\n\r\n    return removeEventListener.call(this, type, cb, options);\r\n  }\r\n}\r\n\r\nfunction singletonMouseEvents() {\r\n  if (typeof document === 'undefined') {\r\n    // inside a worker?\r\n    return\r\n  }\r\n  \r\n  let keys = [\"mousedown\", \"mouseup\", \"mousemove\"];\r\n  for (let k of keys) {\r\n    singleMouseCBs[k] = new Set();\r\n  }\r\n\r\n  let ddd = -1.0;\r\n  window.testSingleMouseUpEvent = (type = \"mousedown\") => {\r\n    let id = ddd++;\r\n    singleMouseEvent(() => {\r\n      console.log(\"mouse event\", id);\r\n    }, type)\r\n  };\r\n\r\n  let _mpos = new Vector2();\r\n\r\n  function doSingleCbs(e, type) {\r\n    let list = singleMouseCBs[type];\r\n    singleMouseCBs[type] = new Set();\r\n\r\n    if (e.type !== \"touchend\" && e.type !== \"touchcancel\") {\r\n      _mpos[0] = e.touches && e.touches.length > 0 ? e.touches[0].pageX : e.x;\r\n      _mpos[1] = e.touches && e.touches.length > 0 ? e.touches[0].pageY : e.y;\r\n    }\r\n\r\n    if (e.touches) {\r\n      e = copyEvent(e);\r\n\r\n      e.type = type;\r\n      if (e.touches.length > 0) {\r\n        e.x = e.pageX = e.touches[0].pageX;\r\n        e.y = e.pageY = e.touches[0].pageY;\r\n      } else {\r\n        e.x = _mpos[0];\r\n        e.y = _mpos[1];\r\n      }\r\n    }\r\n\r\n    for (let cb of list) {\r\n      try {\r\n        cb(e);\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        console.warn(\"Error in event callback\");\r\n      }\r\n    }\r\n  }\r\n\r\n  window.addEventListener(\"mouseup\", (e) => {\r\n    doSingleCbs(e, \"mouseup\");\r\n  }, {capture: true});\r\n  window.addEventListener(\"touchcancel\", (e) => {\r\n    doSingleCbs(e, \"mouseup\");\r\n  }, {capture: true});\r\n  document.addEventListener(\"touchend\", (e) => {\r\n    doSingleCbs(e, \"mouseup\");\r\n  }, {capture: true});\r\n\r\n  document.addEventListener(\"mousedown\", (e) => {\r\n    doSingleCbs(e, \"mousedown\");\r\n  }, {capture: true});\r\n  document.addEventListener(\"touchstart\", (e) => {\r\n    doSingleCbs(e, \"mousedown\");\r\n  }, {capture: true});\r\n\r\n  document.addEventListener(\"mousemove\", (e) => {\r\n    doSingleCbs(e, \"mousemove\");\r\n  }, {capture: true});\r\n  document.addEventListener(\"touchmove\", (e) => {\r\n    doSingleCbs(e, \"mousemove\");\r\n  }, {capture: true});\r\n\r\n  return {\r\n    singleMouseEvent(cb, type) {\r\n      if (!(type in singleMouseCBs)) {\r\n        throw new Error(\"not a mouse event\");\r\n      }\r\n\r\n      singleMouseCBs[type].add(cb);\r\n    }\r\n  };\r\n}\r\n\r\nsingletonMouseEvents = singletonMouseEvents();\r\n\r\n/**\r\n * adds a mouse event callback that only gets called once\r\n * */\r\nexport function singleMouseEvent(cb, type) {\r\n  return singletonMouseEvents.singleMouseEvent(cb, type);\r\n}\r\n\r\n\r\n/*tests if either the left mouse button is down,\r\n* or a touch event has happened and e.touches.length == 1*/\r\nexport function isLeftClick(e) {\r\n  if (e.touches !== undefined) {\r\n    return e.touches.length === 1;\r\n  }\r\n\r\n  return e.button === 0;\r\n}\r\n\r\nexport class DoubleClickHandler {\r\n  constructor() {\r\n    this.down = 0;\r\n    this.last = 0;\r\n    this.dblEvent = undefined;\r\n\r\n    this.start_mpos = new Vector2();\r\n\r\n    this._on_mouseup = this._on_mouseup.bind(this);\r\n    this._on_mousemove = this._on_mousemove.bind(this);\r\n  }\r\n\r\n  _on_mouseup(e) {\r\n    //console.log(\"mup\", e);\r\n    this.mdown = false;\r\n  }\r\n\r\n  _on_mousemove(e) {\r\n    let mpos = new Vector2();\r\n    mpos[0] = e.x;\r\n    mpos[1] = e.y;\r\n\r\n    let dist = mpos.vectorDistance(this.start_mpos)*devicePixelRatio;\r\n\r\n    if (dist > 11) {\r\n      //console.log(\"cancel\", dist);\r\n      this.mdown = false;\r\n    }\r\n\r\n    if (this.mdown) {\r\n      singleMouseEvent(this._on_mousemove, \"mousemove\");\r\n    }\r\n\r\n    this.update();\r\n  }\r\n\r\n  mousedown(e) {\r\n    //console.log(\"mdown\", e.x, e.y);\r\n\r\n    if (!this.last) {\r\n      this.last = 0;\r\n    }\r\n    if (!this.down) {\r\n      this.down = 0;\r\n    }\r\n    if (!this.up) {\r\n      this.up = 0;\r\n    }\r\n\r\n    if (isMouseDown(e)) {\r\n      this.mdown = true;\r\n\r\n      let cpy = Object.assign({}, e);\r\n\r\n      this.start_mpos[0] = e.x;\r\n      this.start_mpos[1] = e.y;\r\n\r\n      singleMouseEvent(this._on_mousemove, \"mousemove\");\r\n\r\n      if (e.type.search(\"touch\") >= 0 && e.touches.length > 0) {\r\n        cpy.x = cpy.pageX = e.touches[0].pageX;\r\n        cpy.y = cpy.pageY = e.touches[1].pageY;\r\n      } else {\r\n        cpy.x = cpy.pageX = e.x;\r\n        cpy.y = cpy.pageY = e.y;\r\n      }\r\n\r\n      //stupid real MouseEvent class zeros .x/.y\r\n      //continue using hackish copyEvent for now...\r\n\r\n      this.dblEvent = copyEvent(e);\r\n      this.dblEvent.type = \"dblclick\";\r\n\r\n      this.last = this.down;\r\n      this.down = util.time_ms();\r\n\r\n      if (this.down - this.last < cconst.doubleClickTime) {\r\n        this.mdown = false;\r\n        this.ondblclick(this.dblEvent);\r\n\r\n        this.down = this.last = 0.0;\r\n      } else {\r\n        singleMouseEvent(this._on_mouseup, \"mouseup\");\r\n      }\r\n    } else {\r\n      this.mdown = false;\r\n    }\r\n  }\r\n\r\n  //you may override this\r\n  ondblclick(e) {\r\n\r\n  }\r\n\r\n  update() {\r\n    if (modalstack.length > 0) {\r\n      //cancel double click requests\r\n      this.mdown = false;\r\n    }\r\n\r\n    if (this.mdown && util.time_ms() - this.down > cconst.doubleClickHoldTime) {\r\n      this.mdown = false;\r\n      this.ondblclick(this.dblEvent);\r\n    }\r\n  }\r\n\r\n  abort() {\r\n    this.last = this.down = 0;\r\n  }\r\n}\r\n\r\nexport function isMouseDown(e) {\r\n  let mdown = 0;\r\n\r\n  if (e.touches !== undefined) {\r\n    mdown = e.touches.length > 0;\r\n  } else {\r\n    mdown = e.buttons;\r\n  }\r\n\r\n  mdown = mdown & 1;\r\n\r\n  return mdown;\r\n}\r\n\r\nexport function pathDebugEvent(e, extra) {\r\n  e.__prevdef = e.preventDefault;\r\n  e.__stopprop = e.stopPropagation;\r\n\r\n  e.preventDefault = function () {\r\n    console.warn(\"preventDefault\", extra);\r\n    return this.__prevdef();\r\n  };\r\n\r\n  e.stopPropagation = function () {\r\n    console.warn(\"stopPropagation\", extra);\r\n    return this.__stopprop();\r\n  }\r\n}\r\n\r\n/** Returns true if event came from a touchscreen or pen device */\r\nexport function eventWasTouch(e) {\r\n  let ret = e.sourceCapabilities && e.sourceCapabilities.firesTouchEvents;\r\n  ret = ret || e.was_touch;\r\n  ret = ret || e instanceof TouchEvent;\r\n  ret = ret || e.touches !== undefined;\r\n\r\n  if (e instanceof PointerEvent) {\r\n    ret = ret || (e.pointerType === \"pen\" || e.pointerType === \"touch\");\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nexport function copyEvent(e) {\r\n  let ret = {};\r\n  let keys = [];\r\n\r\n  for (let k in e) {\r\n    keys.push(k);\r\n  }\r\n\r\n  keys = keys.concat(Object.getOwnPropertySymbols(e));\r\n  keys = keys.concat(Object.getOwnPropertyNames(e));\r\n\r\n  for (let k of keys) {\r\n    let v;\r\n\r\n    try {\r\n      v = e[k];\r\n    } catch (error) {\r\n      console.warn(\"read error for event key\", k);\r\n      continue;\r\n    }\r\n\r\n    if (typeof v == \"function\") {\r\n      ret[k] = v.bind(e);\r\n    } else {\r\n      ret[k] = v;\r\n    }\r\n  }\r\n\r\n  ret.original = e;\r\n\r\n  return ret;\r\n}\r\n\r\nlet Screen;\r\n\r\nexport function _setScreenClass(cls) {\r\n  Screen = cls;\r\n}\r\n\r\nfunction findScreen() {\r\n  let rec = (n) => {\r\n    for (let n2 of n.childNodes) {\r\n      if (n2 && typeof n2 === \"object\" && n2 instanceof Screen) {\r\n        return n2;\r\n      }\r\n    }\r\n\r\n    for (let n2 of n.childNodes) {\r\n      let ret = rec(n2);\r\n      if (ret) {\r\n        return ret;\r\n      }\r\n    }\r\n  };\r\n\r\n  return rec(document.body);\r\n}\r\n\r\nwindow._findScreen = findScreen;\r\n\r\nlet ContextAreaClass;\r\n\r\nexport function _setModalAreaClass(cls) {\r\n  ContextAreaClass = cls;\r\n}\r\n\r\nexport function pushPointerModal(obj, elem, pointerId, autoStopPropagation = true) {\r\n  return pushModalLight(obj, autoStopPropagation, elem, pointerId);\r\n}\r\n\r\nexport function pushModalLight(obj, autoStopPropagation = true, elem, pointerId) {\r\n  let keys;\r\n\r\n  if (pointerId === undefined) {\r\n    keys = new Set([\r\n      \"keydown\", \"keyup\", \"mousedown\", \"mouseup\", \"touchstart\", \"touchend\",\r\n      \"touchcancel\", \"mousewheel\", \"mousemove\", \"mouseover\", \"mouseout\", \"mouseenter\",\r\n      \"mouseleave\", \"dragstart\", \"drag\", \"dragend\", \"dragexit\", \"dragleave\", \"dragover\",\r\n      \"dragenter\", \"drop\", \"pointerdown\", \"pointermove\", \"pointerup\", \"pointercancel\",\r\n      \"pointerstart\", \"pointerend\", \"pointerleave\", \"pointerexit\", \"pointerenter\",\r\n      \"pointerover\"\r\n    ]);\r\n  } else {\r\n    keys = new Set([\r\n      \"keydown\", \"keyup\", \"keypress\", \"mousewheel\"\r\n    ]);\r\n  }\r\n\r\n  let ret = {\r\n    keys     : keys,\r\n    handlers : {},\r\n    last_mpos: [0, 0]\r\n  };\r\n\r\n  let touchmap = {\r\n    \"touchstart\" : \"mousedown\",\r\n    \"touchmove\"  : \"mousemove\",\r\n    \"touchend\"   : \"mouseup\",\r\n    \"touchcancel\": \"mouseup\"\r\n  };\r\n\r\n  let mpos = [0, 0];\r\n\r\n  let screen = findScreen();\r\n  if (screen) {\r\n    mpos[0] = screen.mpos[0];\r\n    mpos[1] = screen.mpos[1];\r\n    screen = undefined;\r\n  }\r\n\r\n  function handleAreaContext() {\r\n    let screen = findScreen();\r\n    if (screen) {\r\n      let sarea = screen.findScreenArea(mpos[0], mpos[1]);\r\n      if (sarea && sarea.area) {\r\n        sarea.area.push_ctx_active();\r\n        sarea.area.pop_ctx_active();\r\n      }\r\n    }\r\n  }\r\n\r\n  function make_default_touchhandler(type, state) {\r\n    return function (e) {\r\n      if (cconst.DEBUG.domEvents) {\r\n        pathDebugEvent(e);\r\n      }\r\n\r\n      if (touchmap[type] in ret.handlers) {\r\n        let type2 = touchmap[type];\r\n\r\n        let e2 = copyEvent(e);\r\n\r\n        e2.was_touch = true;\r\n        e2.type = type2;\r\n        e2.button = type == \"touchcancel\" ? 1 : 0;\r\n        e2.touches = e.touches;\r\n\r\n        if (e.touches.length > 0) {\r\n          let t = e.touches[0];\r\n\r\n          mpos[0] = t.pageX;\r\n          mpos[1] = t.pageY;\r\n\r\n          e2.pageX = e2.x = t.pageX;\r\n          e2.pageY = e2.y = t.pageY;\r\n          e2.clientX = t.clientX;\r\n          e2.clientY = t.clientY;\r\n          e2.x = t.clientX;\r\n          e2.y = t.clientY;\r\n\r\n          ret.last_mpos[0] = e2.x;\r\n          ret.last_mpos[1] = e2.y;\r\n        } else {\r\n          e2.x = e2.clientX = e2.pageX = e2.screenX = ret.last_mpos[0];\r\n          e2.y = e2.clientY = e2.pageY = e2.screenY = ret.last_mpos[1];\r\n        }\r\n\r\n        e2.was_touch = true;\r\n\r\n        handleAreaContext();\r\n        //console.log(e2.x, e2.y);\r\n        ret.handlers[type2](e2);\r\n      }\r\n\r\n      if (autoStopPropagation) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n    }\r\n  }\r\n\r\n  function make_handler(type, key) {\r\n    return function (e) {\r\n      if (cconst.DEBUG.domEvents) {\r\n        pathDebugEvent(e);\r\n      }\r\n\r\n      if (typeof key !== \"string\") {\r\n        //console.warn(\"key was undefined\", key, type);\r\n        return;\r\n      }\r\n\r\n      if (key.startsWith(\"mouse\")) {\r\n        mpos[0] = e.pageX;\r\n        mpos[1] = e.pageY;\r\n      } else if (key.startsWith(\"pointer\")) {\r\n        mpos[0] = e.x;\r\n        mpos[1] = e.y;\r\n      }\r\n\r\n      handleAreaContext();\r\n\r\n      if (key !== undefined)\r\n        obj[key](e);\r\n\r\n      if (autoStopPropagation) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n    }\r\n  }\r\n\r\n  let found = {};\r\n\r\n  for (let k of keys) {\r\n    let key;\r\n\r\n    if (obj[k])\r\n      key = k;\r\n    else if (obj[\"on\" + k])\r\n      key = \"on\" + k;\r\n    else if (obj[\"on_\" + k])\r\n      key = \"on_\" + k;\r\n    else if (k in touchmap)\r\n      continue; //default touch event handlers will be done seperately\r\n    else\r\n      key = undefined; //make handler that still blocks events\r\n\r\n    //check we don't override other mouse pointer event handlers\r\n    if (key === undefined && k.search(\"pointer\") === 0) {\r\n      continue;\r\n    }\r\n\r\n    if (key !== undefined) {\r\n      found[k] = 1;\r\n    }\r\n\r\n    let handler = make_handler(k, key);\r\n    ret.handlers[k] = handler;\r\n\r\n    let settings = handler.settings = {passive: false, capture: true};\r\n    window.addEventListener(k, handler, settings);\r\n  }\r\n\r\n  for (let k in touchmap) {\r\n    if (!(k in found)) {\r\n      //console.log(\"making touch handler for\", '\"' + k + '\"', ret.handlers[k]);\r\n\r\n      ret.handlers[k] = make_default_touchhandler(k, ret);\r\n\r\n      let settings = ret.handlers[k].settings = {passive: false, capture: true};\r\n      window.addEventListener(k, ret.handlers[k], settings);\r\n    }\r\n  }\r\n\r\n  if (pointerId !== undefined) {\r\n    ret.pointer = {\r\n      elem, pointerId\r\n    };\r\n\r\n    function make_pointer(k) {\r\n      let k2 = \"on_\" + k;\r\n\r\n      ret.pointer[k] = function (e) {\r\n        if (obj[k2] !== undefined) {\r\n          obj[k2](e);\r\n        }\r\n\r\n        if (autoStopPropagation) {\r\n          e.stopPropagation();\r\n          e.preventDefault();\r\n        }\r\n      }\r\n    }\r\n\r\n    make_pointer(\"pointerdown\");\r\n    make_pointer(\"pointermove\");\r\n    make_pointer(\"pointerup\");\r\n    make_pointer(\"pointerstart\");\r\n    make_pointer(\"pointerend\");\r\n    make_pointer(\"pointerleave\");\r\n    make_pointer(\"pointerenter\");\r\n    make_pointer(\"pointerout\");\r\n    make_pointer(\"pointerover\");\r\n    make_pointer(\"pointerexit\");\r\n    make_pointer(\"pointercancel\");\r\n\r\n    for (let k in ret.pointer) {\r\n      if (k !== \"elem\" && k !== \"pointerId\") {\r\n        elem.addEventListener(k, ret.pointer[k]);\r\n      }\r\n    }\r\n\r\n    try {\r\n      elem.setPointerCapture(pointerId)\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n\r\n      console.log(\"attempting fallback\");\r\n\r\n      for (let k in ret.pointer) {\r\n        if (k !== \"elem\" && k !== \"pointerId\") {\r\n          elem.removeEventListener(k, ret.pointer[k]);\r\n        }\r\n      }\r\n\r\n      delete ret.pointer;\r\n\r\n      modalstack.push(ret);\r\n      popModalLight(ret);\r\n\r\n      for (let k in obj) {\r\n        if (k === \"pointercancel\" || k === \"pointerend\" || k === \"pointerstart\") {\r\n          continue;\r\n        }\r\n\r\n        if (k.startsWith(\"pointer\")) {\r\n          let k2 = k.replace(/pointer/, \"mouse\");\r\n          if (k2 in obj) {\r\n            console.warn(\"warning, existing mouse handler\", k2);\r\n            continue;\r\n          }\r\n\r\n          let v = obj[k];\r\n          obj[k] = undefined;\r\n\r\n          obj[k2] = v;\r\n        }\r\n      }\r\n\r\n      console.log(obj);\r\n\r\n      return pushModalLight(obj, autoStopPropagation);\r\n    }\r\n  }\r\n\r\n  modalstack.push(ret);\r\n  ContextAreaClass.lock();\r\n\r\n  if (cconst.DEBUG.modalEvents) {\r\n    console.warn(\"pushModalLight\", ret.pointer ? \"(pointer events)\" : \"\");\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n/* Trace all calls to EventTarget.prototype.[add/rem]EventListener */\r\nif (0) {\r\n  window._print_evt_debug = false;\r\n\r\n  function evtprint() {\r\n    if (window.window._print_evt_debug) {\r\n      console.warn(...arguments);\r\n    }\r\n  }\r\n\r\n  let addevent = EventTarget.prototype.addEventListener;\r\n  let remevent = EventTarget.prototype.removeEventListener;\r\n\r\n  const funckey = Symbol(\"eventfunc\");\r\n\r\n  EventTarget.prototype.addEventListener = function (name, func, args) {\r\n    //if (name.startsWith(\"key\")) {\r\n    evtprint(\"listener added\", name, func.name, args);\r\n    //}\r\n\r\n    let func2 = function (e) {\r\n      let proxy = new Proxy(e, {\r\n        get(target, p, receiver) {\r\n          if (p === \"preventDefault\") {\r\n            return function () {\r\n              evtprint(\"preventDefault\", name, arguments);\r\n              return e.preventDefault(...arguments);\r\n            }\r\n          } else if (p === \"stopPropagation\") {\r\n            return function () {\r\n              evtprint(\"stopPropagation\", name, arguments);\r\n              return e.preventDefault(...arguments);\r\n            }\r\n          }\r\n\r\n          return e[p];\r\n        }\r\n      });\r\n\r\n      return func.call(this, proxy);\r\n    }\r\n\r\n    func[funckey] = func2;\r\n\r\n    return addevent.call(this, name, func2, args);\r\n  }\r\n\r\n  EventTarget.prototype.removeEventListener = function (name, func, args) {\r\n    //if (name.startsWith(\"key\")) {\r\n    evtprint(\"listener removed\", name, func.name, args);\r\n    //}\r\n\r\n    func = func[funckey];\r\n\r\n    return remevent.call(this, name, func, args);\r\n  }\r\n}\r\n\r\nexport function popModalLight(state) {\r\n  if (state === undefined) {\r\n    console.warn(\"Bad call to popModalLight: state was undefined\");\r\n    return;\r\n  }\r\n\r\n  if (state !== modalstack[modalstack.length - 1]) {\r\n    if (modalstack.indexOf(state) < 0) {\r\n      console.warn(\"Error in popModalLight; modal handler not found\");\r\n      return;\r\n    } else {\r\n      console.warn(\"Error in popModalLight; called in wrong order\");\r\n    }\r\n  }\r\n\r\n  for (let k in state.handlers) {\r\n    //console.log(k);\r\n    window.removeEventListener(k, state.handlers[k], state.handlers[k].settings);\r\n  }\r\n\r\n  state.handlers = {};\r\n  modalstack.remove(state);\r\n  ContextAreaClass.unlock();\r\n\r\n  if (cconst.DEBUG.modalEvents) {\r\n    console.warn(\"popModalLight\", modalstack, state.pointer ? \"(pointer events)\" : \"\");\r\n  }\r\n\r\n  if (state.pointer) {\r\n    let elem = state.pointer.elem;\r\n\r\n    try {\r\n      elem.releasePointerCapture(state.pointer.pointerId);\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n    }\r\n\r\n    for (let k in state.pointer) {\r\n      if (k !== \"elem\" && k !== \"pointerId\") {\r\n        elem.removeEventListener(k, state.pointer[k]);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport function haveModal() {\r\n  return modalstack.length > 0;\r\n}\r\n\r\nwindow._haveModal = haveModal; //for debugging console\r\n\r\nexport var keymap_latin_1 = {\r\n  \"Space\" : 32,\r\n  \"Escape\": 27,\r\n  \"Enter\" : 13,\r\n  \"Return\": 13,\r\n  \"Up\"    : 38,\r\n  \"Down\"  : 40,\r\n  \"Left\"  : 37,\r\n  \"Right\" : 39,\r\n\r\n  \"Num0\"     : 96,\r\n  \"Num1\"     : 97,\r\n  \"Num2\"     : 98,\r\n  \"Num3\"     : 99,\r\n  \"Num4\"     : 100,\r\n  \"Num5\"     : 101,\r\n  \"Num6\"     : 102,\r\n  \"Num7\"     : 103,\r\n  \"Num8\"     : 104,\r\n  \"Num9\"     : 105,\r\n  \"Home\"     : 36,\r\n  \"End\"      : 35,\r\n  \"Delete\"   : 46,\r\n  \"Backspace\": 8,\r\n  \"Insert\"   : 45,\r\n  \"PageUp\"   : 33,\r\n  \"PageDown\" : 34,\r\n  \"Tab\"      : 9,\r\n  \"-\"        : 189,\r\n  \"=\"        : 187,\r\n  \".\"        : 190,\r\n  \"/\"        : 191,\r\n  \",\"        : 188,\r\n  \";\"        : 186,\r\n  \"'\"        : 222,\r\n  \"[\"        : 219,\r\n  \"]\"        : 221,\r\n  \"NumPlus\"  : 107,\r\n  \"NumMinus\" : 109,\r\n  \"Shift\"    : 16,\r\n  \"Ctrl\"     : 17,\r\n  \"Control\"  : 17,\r\n  \"Alt\"      : 18\r\n}\r\n\r\nfor (var i = 0; i < 26; i++) {\r\n  keymap_latin_1[String.fromCharCode(i + 65)] = i + 65\r\n}\r\nfor (var i = 0; i < 10; i++) {\r\n  keymap_latin_1[String.fromCharCode(i + 48)] = i + 48\r\n}\r\n\r\nfor (var k in keymap_latin_1) {\r\n  if (!(k in keymap_latin_1)) {\r\n    keymap_latin_1[keymap_latin_1[k]] = k;\r\n  }\r\n}\r\n\r\nvar keymap_latin_1_rev = {}\r\nfor (var k in keymap_latin_1) {\r\n  keymap_latin_1_rev[keymap_latin_1[k]] = k\r\n}\r\n\r\nexport var keymap = keymap_latin_1;\r\nexport var reverse_keymap = keymap_latin_1_rev;\r\n\r\nexport class HotKey {\r\n  /**action can be a callback or a toolpath string*/\r\n  constructor(key, modifiers, action, uiname) {\r\n    this.action = action;\r\n    this.mods = modifiers;\r\n    this.key = keymap[key];\r\n    this.uiname = uiname;\r\n  }\r\n\r\n  exec(ctx) {\r\n    if (typeof this.action == \"string\") {\r\n      ctx.api.execTool(ctx, this.action);\r\n    } else {\r\n      this.action(ctx);\r\n    }\r\n  }\r\n\r\n  buildString() {\r\n    let s = \"\";\r\n\r\n    for (let i = 0; i < this.mods.length; i++) {\r\n      if (i > 0) {\r\n        s += \" + \";\r\n      }\r\n\r\n      let k = this.mods[i].toLowerCase();\r\n      k = k[0].toUpperCase() + k.slice(1, k.length).toLowerCase();\r\n\r\n      s += k;\r\n    }\r\n\r\n    if (this.mods.length > 0) {\r\n      s += \"+\";\r\n    }\r\n\r\n    s += reverse_keymap[this.key];\r\n\r\n    return s.trim();\r\n  }\r\n}\r\n\r\nexport class KeyMap extends Array {\r\n  /**\r\n   *\r\n   * @param pathid{string} Id of keymap, used when patching hotkeys, when\r\n   *                       that is implemented\r\n   * */\r\n  constructor(hotkeys = [], pathid = \"undefined\") {\r\n    super();\r\n\r\n    this.pathid = pathid;\r\n\r\n    for (let hk of hotkeys) {\r\n      this.add(hk);\r\n    }\r\n  }\r\n\r\n  handle(ctx, e) {\r\n    let mods = new util.set();\r\n    if (e.shiftKey)\r\n      mods.add(\"shift\");\r\n    if (e.altKey)\r\n      mods.add(\"alt\");\r\n    if (e.ctrlKey) {\r\n      mods.add(\"ctrl\");\r\n    }\r\n    if (e.commandKey) {\r\n      mods.add(\"command\");\r\n    }\r\n\r\n    for (let hk of this) {\r\n      let ok = e.keyCode === hk.key;\r\n      if (!ok) continue;\r\n\r\n      let count = 0;\r\n      for (let m of hk.mods) {\r\n        m = m.toLowerCase().trim();\r\n\r\n        if (!mods.has(m)) {\r\n          ok = false;\r\n          break;\r\n        }\r\n\r\n        count++;\r\n      }\r\n\r\n      if (count !== mods.length) {\r\n        ok = false;\r\n      }\r\n\r\n      if (ok) {\r\n        try {\r\n          hk.exec(ctx);\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n          console.log(\"failed to execute a hotkey\", keymap[e.keyCode]);\r\n        }\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  add(hk) {\r\n    this.push(hk);\r\n  }\r\n\r\n  push(hk) {\r\n    super.push(hk);\r\n  }\r\n}\r\n\r\n","export const ClassIdSymbol = Symbol(\"pathux-class-id\");\r\n","//import * as nstructjs from './struct.js';\r\nimport {haveModal, _setModalAreaClass} from '../path-controller/util/simple_events.js';\r\nimport * as util from '../path-controller/util/util.js';\r\n\r\nimport '../path-controller/util/struct.js';\r\n\r\nlet ScreenClass = undefined;\r\n\r\nimport {ClassIdSymbol} from '../core/ui_consts.js';\r\n\r\n\r\nexport function setScreenClass(cls) {\r\n  ScreenClass = cls;\r\n}\r\n\r\nexport function getAreaIntName(name) {\r\n  let hash = 0;\r\n\r\n  for (let i = 0; i < name.length; i++) {\r\n    let c = name.charCodeAt(i);\r\n\r\n    if (i%2 === 0) {\r\n      hash += c<<8;\r\n      hash *= 13;\r\n      hash = hash & ((1<<15) - 1);\r\n    } else {\r\n      hash += c;\r\n    }\r\n  }\r\n\r\n  return hash;\r\n}\r\n\r\n//XXX get rid of me\r\nwindow.getAreaIntName = getAreaIntName;\r\n\r\n//XXX get rid of me\r\nexport var AreaTypes = {\r\n  TEST_CANVAS_EDITOR: 0\r\n};\r\n\r\n  export function setAreaTypes(def) {\r\n  for (let k in AreaTypes) {\r\n    delete AreaTypes[k];\r\n  }\r\n\r\n  for (let k in def) {\r\n    AreaTypes[k] = def[k];\r\n  }\r\n}\r\n\r\nexport let areaclasses = {};\r\n\r\n/*hackish! store ref an active wrangler so simple_event's modal\r\n* system can lock it!*/\r\nlet theWrangler = undefined;\r\n\r\nexport class AreaWrangler {\r\n  constructor() {\r\n    this.stacks = new Map();\r\n    this.lasts = new Map();\r\n    this.lastArea = undefined;\r\n    this.stack = [];\r\n    this.idgen = 0;\r\n    this.locked = 0;\r\n    this._last_screen_id = undefined;\r\n\r\n    theWrangler = this;\r\n  }\r\n\r\n  /*Yeek this is particularly evil, it creates a context\r\n  * that can be used by popups with the original context\r\n  * area stack intact of the elements that spawned them.*/\r\n  makeSafeContext(ctx) {\r\n    let wrangler = this.copy();\r\n    let this2 = this;\r\n\r\n    return new Proxy(ctx, {\r\n      get(target, key, rec) {\r\n        wrangler.copyTo(contextWrangler);\r\n        return target[key];\r\n      }\r\n    });\r\n  }\r\n\r\n  copyTo(ret) {\r\n    for (let [key, stack1] of this.stacks) {\r\n      ret.stack.set(key, util.list(stack1));\r\n    }\r\n\r\n    for (let [key, val] of this.lasts) {\r\n      ret.lasts.set(key, val);\r\n    }\r\n\r\n    ret.stack = util.list(this.stack);\r\n    ret.lastArea = this.lastArea;\r\n  }\r\n\r\n  copy(b) {\r\n    let ret = new AreaWrangler();\r\n    this.copyTo(ret);\r\n    return ret;\r\n  }\r\n\r\n  _checkWrangler(ctx) {\r\n    if (ctx === undefined) {\r\n      return true;\r\n    }\r\n\r\n    if (this._last_screen_id === undefined) {\r\n      this._last_screen_id = ctx.screen._id;\r\n      return true;\r\n    }\r\n\r\n    if (ctx.screen._id !== this._last_screen_id) {\r\n      this.reset();\r\n\r\n      this._last_screen_id = ctx.screen._id;\r\n      console.warn(\"contextWrangler detected a new screen; new file?\");\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  reset() {\r\n    theWrangler = this;\r\n    this.stacks = new Map();\r\n    this.lasts = new Map();\r\n    this.lastArea = undefined;\r\n    this.stack = [];\r\n    this.locked = 0;\r\n    this._last_screen_id = undefined;\r\n\r\n    return this;\r\n  }\r\n\r\n  static findInstance() {\r\n    return theWrangler;\r\n  }\r\n\r\n  static lock() {\r\n    return this.findInstance().lock();\r\n  }\r\n\r\n  static unlock() {\r\n    return this.findInstance().unlock();\r\n  }\r\n\r\n  lock() {\r\n    this.locked++;\r\n    return this;\r\n  }\r\n\r\n  unlock() {\r\n    this.locked = Math.max(this.locked - 1, 0);\r\n    return this;\r\n  }\r\n\r\n  push(type, area, pushLastRef = true) {\r\n    theWrangler = this;\r\n\r\n    if (haveModal() || this.locked) {\r\n      pushLastRef = false;\r\n    }\r\n\r\n    if (pushLastRef || !this.lasts.has(type[ClassIdSymbol])) {\r\n      this.lasts.set(type[ClassIdSymbol], area);\r\n      this.lastArea = area;\r\n    }\r\n\r\n    let stack = this.stacks.get(type[ClassIdSymbol]);\r\n    if (stack === undefined) {\r\n      stack = [];\r\n      this.stacks.set(type[ClassIdSymbol], stack);\r\n    }\r\n\r\n    let last = this.lasts.get(type[ClassIdSymbol]);\r\n\r\n    stack.push(last);\r\n    stack.push(area);\r\n\r\n    this.stack.push(area);\r\n  }\r\n\r\n  updateLastRef(type, area) {\r\n    theWrangler = this;\r\n\r\n    if ((this.locked || haveModal()) && this.lasts.has(type[ClassIdSymbol])) {\r\n      return;\r\n    }\r\n\r\n    this.lasts.set(type[ClassIdSymbol], area);\r\n    this.lastArea = area;\r\n  }\r\n\r\n  pop(type, area) {\r\n    let stack = this.stacks.get(type[ClassIdSymbol]);\r\n\r\n    if (stack === undefined) {\r\n      console.warn(\"pop_ctx_area called in error\");\r\n      //throw new Error(\"pop_ctx_area called in error\");\r\n      return;\r\n    }\r\n\r\n    if (stack.length > 0) {\r\n      stack.pop();\r\n      let last = stack.pop();\r\n\r\n      /* paranoia isConnected check to ensure stale elements don't\r\n       * pollute the lasts stack */\r\n      if (!this.locked && last && last.isConnected) {\r\n        this.lasts.set(type[ClassIdSymbol], last);\r\n      }\r\n    } else {\r\n      console.error(\"pop_ctx_area called in error\");\r\n    }\r\n\r\n    if (this.stack.length > 0) {\r\n      this.stack.pop();\r\n    }\r\n  }\r\n\r\n  getLastArea(type) {\r\n    //if (Math.random() > 0.9995) {\r\n      //console.warn(\"getLastArea!\", type, this.lasts.get(type[ClassIdSymbol]));\r\n    //}\r\n\r\n    if (type === undefined) {\r\n      if (this.stack.length > 0) {\r\n        return this.stack[this.stack.length - 1];\r\n      } else {\r\n        return this.lastArea;\r\n      }\r\n    } else {\r\n      if (this.stacks.has(type[ClassIdSymbol])) {\r\n        let stack = this.stacks.get(type[ClassIdSymbol]);\r\n\r\n        if (stack.length > 0) {\r\n          return stack[stack.length-1];\r\n        }\r\n      }\r\n\r\n      return this.lasts.get(type[ClassIdSymbol]);\r\n    }\r\n  }\r\n}\r\n_setModalAreaClass(AreaWrangler);\r\n\r\nexport let contextWrangler = new AreaWrangler();\r\n","\"use strict\";\r\n\r\n/**\r\n * Assorted geometry utility functions.\r\n *\r\n * This file was originally written in a modified form of ES6 way back in ~2010.\r\n * It was then transpiled to ES5 before being ported later to ES6.\r\n *\r\n * TODO: cleanup this file.\r\n */\r\n\r\nimport * as util from './util.js';\r\nimport * as vectormath from './vectormath.js';\r\n\r\nimport {Vector2, Vector3, Vector4, Matrix4, Quat} from './vectormath.js';\r\n\r\nlet dtvtmps = util.cachering.fromConstructor(Vector3, 32);\r\n\r\n\r\nlet quad_co_rets2 = util.cachering.fromConstructor(Vector2, 512);\r\n\r\nexport function quad_bilinear(v1, v2, v3, v4, u, v) {\r\n  return -((v1 - v2)*u - v1 - (u*v1 - u*v2 + u*v3 - u*v4 - v1 + v4)*v);\r\n}\r\n\r\n/*\r\n\r\n on factor;\r\n off period;\r\n\r\n a1 := v1 + (v2 - v1) * u;\r\n a2 := v4 + (v3 - v4) * u;\r\n bilin := a1 + (a2 - a1) * v;\r\n\r\n v1x := 0;\r\n v1y := 0;\r\n\r\n bx := sub(v1=v1x, v2=v2x, v3=v3x, v4=v4x, bilin);\r\n by := sub(v1=v1y, v2=v2y, v3=v3y, v4=v4y, bilin);\r\n\r\n f1 := bx - x;\r\n f2 := by - y;\r\n\r\n ff := solve({f1, f2}, {u, v});\r\n\r\n */\r\nfunction quad_uv_2d(p, v1, v2, v3, v4) {\r\n  let u, v;\r\n\r\n  let v2x = v2[0] - v1[0];\r\n  let v2y = v2[1] - v1[1];\r\n  let v3x = v3[0] - v1[0];\r\n  let v3y = v3[1] - v1[1];\r\n  let v4x = v4[0] - v1[0];\r\n  let v4y = v4[1] - v1[1];\r\n\r\n  let x = p[0] - v1[0];\r\n  let y = p[1] - v1[1];\r\n  let sqrt = Math.sqrt;\r\n\r\n  let A = 2*(((v4y + y)*x - 2*v4x*y)*\r\n      v3y + (v4x*y - v4y*x)*(v4y + y) - ((v4x - x)*v2y - v3x*y)*(v4y - y))*v2x - 2*(\r\n      (v4x*y - v4y*x)*(v4x + x) - (v4x - x)*v3y*x + ((2*v4y - y)*x - v4x*y)*v3x)*\r\n    v2y + (v4x*y - v4y*x + v3y*x - v3x*y)**2 + (v4x - x)**2*v2y**2 + (v4y - y)**2*\r\n    v2x**2;\r\n\r\n  let B = v4x*y - v4y*x + v3y*x - v3x*y;\r\n\r\n  let C1 = (2*(v3x - v4x)*v2y - 2*(v3y - v4y)*v2x);\r\n  let C2 = (2*(v3x*v4y - v3y*v4x + v2y*v4x) - 2*v2x*v4y);\r\n\r\n  let u1, u2;\r\n\r\n  if (A < 0.0) {\r\n    console.log(\"A was < 0\", A);\r\n    A = -A;\r\n    C1 = C2 = 0.0;\r\n  }\r\n\r\n  if (Math.abs(C1) < 0.00001) { //perfectly 90 degrees?\r\n    let dx = v2x;\r\n    let dy = v2y;\r\n\r\n    console.log(\"C1 bad\");\r\n\r\n    let l = Math.sqrt(dx*dx + dy*dy);\r\n    if (l > 0.000001) {\r\n      dx /= l*l;\r\n      dy /= l*l;\r\n    }\r\n\r\n    u1 = u2 = dx*x + dy*y;\r\n  } else {\r\n    u1 = (-(B + sqrt(A) - (v4y - y)*v2x) - (v4x - x)*v2y)/C1;\r\n    u2 = (-(B - sqrt(A) - (v4y - y)*v2x) - (v4x - x)*v2y)/C1;\r\n  }\r\n\r\n  if (Math.abs(C2) < 0.00001) { //perfectly 90 degrees?\r\n    let dx, dy;\r\n\r\n    dx = v3x - v2x;\r\n    dy = v3y - v2y;\r\n\r\n    console.log(\"C2 bad\");\r\n\r\n    let l = Math.sqrt(dx**2 + dy**2);\r\n    if (l > 0.00001) {\r\n      dx /= l*l;\r\n      dy /= l*l;\r\n    }\r\n\r\n    v1 = v2 = x*dx + y*dy;\r\n  } else {\r\n    v1 = (-(B - sqrt(A) + (v4y + y)*v2x) + (v4x + x)*v2y)/C2;\r\n    v2 = (-(B + sqrt(A) + (v4y + y)*v2x) + (v4x + x)*v2y)/C2;\r\n  }\r\n\r\n  let ret = quad_co_rets2.next();\r\n\r\n  let d1 = (u1 - 0.5)**2 + (v1 - 0.5)**2;\r\n  let d2 = (u2 - 0.5)**2 + (v2 - 0.5)**2;\r\n\r\n  if (d1 < d2) {\r\n    ret[0] = u1;\r\n    ret[1] = v1;\r\n  } else {\r\n    ret[0] = u2;\r\n    ret[1] = v2;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n\r\nexport const ClosestModes = {\r\n  CLOSEST  : 0,\r\n  START    : 1,\r\n  END      : 2,\r\n  ENDPOINTS: 3,\r\n  ALL      : 4\r\n};\r\n\r\nlet advs = util.cachering.fromConstructor(Vector4, 128);\r\n\r\nexport class AbstractCurve {\r\n  evaluate(t) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  derivative(t) {\r\n  }\r\n\r\n  curvature(t) {\r\n\r\n  }\r\n\r\n  normal(t) {\r\n\r\n  }\r\n\r\n  width(t) {\r\n\r\n  }\r\n}\r\n\r\nexport class ClosestCurveRets {\r\n  constructor() {\r\n    this.p = new Vector3();\r\n    this.t = 0;\r\n  }\r\n}\r\n\r\nlet cvrets = util.cachering.fromConstructor(ClosestCurveRets, 2048);\r\nlet cvarrays = new util.ArrayPool();\r\nlet cvtmp = new Array(1024);\r\n\r\nexport function closestPoint(p, curve, mode) {\r\n  let steps = 5;\r\n  let s = 0, ds = 1.0/steps;\r\n\r\n  let ri = 0;\r\n\r\n  for (let i = 0; i < steps; i++, s += ds) {\r\n    let c1 = curve.evaluate(s);\r\n    let c2 = curve.evaluate(s + ds);\r\n\r\n\r\n  }\r\n}\r\n\r\nlet poly_normal_tmps = util.cachering.fromConstructor(Vector3, 64);\r\nlet pncent = new Vector3();\r\n\r\nexport function normal_poly(vs) {\r\n  if (vs.length === 3) {\r\n    return poly_normal_tmps.next().load(normal_tri(vs[0], vs[1], vs[2]));\r\n  } else if (vs.length === 4) {\r\n    return poly_normal_tmps.next().load(normal_quad(vs[0], vs[1], vs[2], vs[3]));\r\n  }\r\n\r\n  if (vs.length === 0) {\r\n    return poly_normal_tmps.next().zero();\r\n  }\r\n\r\n  let cent = pncent.zero();\r\n  let tot = 0;\r\n\r\n  for (let v of vs) {\r\n    cent.add(v);\r\n    tot++;\r\n  }\r\n\r\n  cent.mulScalar(1.0/tot);\r\n  let n = poly_normal_tmps.next().zero();\r\n\r\n  for (let i = 0; i < vs.length; i++) {\r\n    let a = vs[i];\r\n    let b = vs[(i + 1)%vs.length];\r\n    let c = cent;\r\n\r\n    let n2 = normal_tri(a, b, c);\r\n    n.add(n2);\r\n  }\r\n\r\n  n.normalize();\r\n  return n;\r\n}\r\n\r\n/*\r\non factor;\r\noff period;\r\n\r\nf1 := u*v1x + v*v2x + (1.0-u-v)*v3x - px;\r\nf2 := u*v1y + v*v2y + (1.0-u-v)*v3y - py;\r\n\r\nff := solve({f1, f2}, {u, v});\r\n\r\non fort;\r\npart(ff, 1, 1);\r\npart(ff, 1, 2);\r\noff fort;\r\n\r\n*/\r\n\r\nlet barycentric_v2_rets = util.cachering.fromConstructor(Vector2, 2048);\r\nlet calc_proj_refs = new util.cachering(() => [0, 0], 64);\r\n\r\n/*\r\n  a b c d\r\n     b\r\n\r\n  a------c\r\n\r\n     d\r\n\r\n  on factor;\r\n  load_package avector;\r\n\r\n  ax := 0;\r\n  ay := 0;\r\n  az := 0;\r\n\r\n  a := avec(ax, ay, az);\r\n  b := avec(bx, by, bz);\r\n  c := avec(cx, cy, cz);\r\n  d := avec(dx, dy, dz);\r\n\r\n  n1 := d cross c;\r\n  n2 := c cross b;\r\n\r\n  n1 := n1 / (VMOD n1);\r\n  n2 := n2 / (VMOD n2);\r\n\r\n  d := n1 dot n2;\r\n  on fort;\r\n\r\n  d*d;\r\n\r\n  off fort;\r\n\r\n\r\n  */\r\n\r\n/**\r\n\r\n v2\r\n\r\n v1------v3\r\n\r\n v4\r\n\r\n */\r\nexport function dihedral_v3_sqr(v1, v2, v3, v4) {\r\n  let bx = v2[0] - v1[0];\r\n  let by = v2[1] - v1[1];\r\n  let bz = v2[2] - v1[2];\r\n\r\n  let cx = v3[0] - v1[0];\r\n  let cy = v3[1] - v1[1];\r\n  let cz = v3[2] - v1[2];\r\n\r\n  let dx = v4[0] - v1[0];\r\n  let dy = v4[1] - v1[1];\r\n  let dz = v4[2] - v1[2];\r\n\r\n\r\n  return ((bx*cz - bz*cx)*(cx*dz - cz*dx) + (by*cz - bz*cy)*(cy*dz - cz*dy) + (bx*cy - by*cx)*\r\n    (cx*dy - cy*dx))**2/(((bx*cz - bz*cx)**2 + (by*cz - bz*cy)**2\r\n    + (bx*cy - by*cx)**2)*((cx*dz - cz*dx)**2 + (cy*dz - cz*dy)**2 + (cx*dy - cy*dx)**2));\r\n}\r\n\r\nlet tet_area_tmps = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport function tet_volume(a, b, c, d) {\r\n  a = tet_area_tmps.next().load(a);\r\n  b = tet_area_tmps.next().load(b);\r\n  c = tet_area_tmps.next().load(c);\r\n  d = tet_area_tmps.next().load(d);\r\n\r\n  a.sub(d);\r\n  b.sub(d);\r\n  c.sub(d);\r\n\r\n  b.cross(c);\r\n  return a.dot(b)/6.0;\r\n}\r\n\r\nexport function calc_projection_axes(no) {\r\n  let ax = Math.abs(no[0]), ay = Math.abs(no[1]), az = Math.abs(no[2]);\r\n\r\n  let ret = calc_proj_refs.next();\r\n\r\n  if (ax > ay && ax > az) {\r\n    ret[0] = 1;\r\n    ret[1] = 2;\r\n  } else if (ay > az && ay > ax) {\r\n    ret[0] = 0;\r\n    ret[1] = 2;\r\n  } else {\r\n    ret[0] = 0;\r\n    ret[1] = 1;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nlet _avtmps = util.cachering.fromConstructor(Vector3, 128);\r\n\r\nfunction inrect_3d(p, min, max) {\r\n  let ok = p[0] >= min[0] && p[0] <= max[0];\r\n  ok = ok && p[1] >= min[1] && p[1] <= max[1];\r\n  ok = ok && p[2] >= min[2] && p[2] <= max[2];\r\n\r\n  return ok;\r\n}\r\n\r\nexport function aabb_isect_line_3d(v1, v2, min, max) {\r\n  let inside = inrect_3d(v1, min, max);\r\n  inside = inside || inrect_3d(v2, min, max);\r\n\r\n  if (inside) {\r\n    return true;\r\n  }\r\n\r\n  let cent = _avtmps.next().load(min).interp(max, 0.5);\r\n\r\n  let p = closest_point_on_line(cent, v1, v2, true);\r\n  if (!p) {\r\n    return false;\r\n  }\r\n\r\n  p = p[0];\r\n\r\n  return inrect_3d(p, min, max);\r\n}\r\n\r\nexport function aabb_isect_cylinder_3d(v1, v2, radius, min, max) {\r\n  let inside = inrect_3d(v1, min, max);\r\n  inside = inside || inrect_3d(v2, min, max);\r\n\r\n  if (inside) {\r\n    return true;\r\n  }\r\n\r\n  let cent = _avtmps.next().load(min).interp(max, 0.5);\r\n\r\n  let p = closest_point_on_line(cent, v1, v2, true);\r\n  if (!p) {\r\n    return false;\r\n  }\r\n\r\n  p = p[0];\r\n\r\n  let size = _avtmps.next().load(max).sub(min);\r\n\r\n  size.mulScalar(0.5);\r\n  size.addScalar(radius); //*(3**0.5));\r\n\r\n  p.sub(cent).abs();\r\n\r\n  return p[0] <= size[0] && p[1] <= size[1] && p[2] <= size[2];\r\n}\r\n\r\nexport function barycentric_v2(p, v1, v2, v3, axis1 = 0, axis2 = 1, out = undefined) {\r\n  let div = (v2[axis1]*v3[axis2] - v2[axis2]*v3[axis1] + (v2[axis2] - v3[axis2])*v1[axis1] - (v2[axis1] - v3[axis1])*v1[axis2]);\r\n\r\n  if (Math.abs(div) < 0.000001) {\r\n    div = 0.00001;\r\n  }\r\n\r\n  let u = (v2[axis1]*v3[axis2] - v2[axis2]*v3[axis1] + (v2[axis2] - v3[axis2])*p[axis1] - (v2[axis1] - v3[axis1])*p[axis2])/div;\r\n  let v = (-(v1[axis1]*v3[axis2] - v1[axis2]*v3[axis1] + (v1[axis2] - v3[axis2])*p[axis1]) + (v1[axis1] - v3[axis1])*p[axis2])/div;\r\n\r\n  if (!out) {\r\n    out = barycentric_v2_rets.next();\r\n  }\r\n\r\n  out[0] = u;\r\n  out[1] = v;\r\n\r\n  return out;\r\n}\r\n\r\n/*\r\n\r\non factor;\r\n\r\nload_package \"avector\";\r\n\r\npx := 0;\r\npy := 0;\r\npz := 0;\r\n\r\nv1 := avec(v1x, v1y, v1z);\r\nv2 := avec(v2x, v2y, v2z);\r\np := avec(px, py, pz);\r\n\r\nt1 := p - v1;\r\nt2 := v2 - v1;\r\n\r\nl1 := t2 / VMOD t2;\r\n\r\nt := dot(t1, t2);\r\n\r\np2 := v1 + t2*t;\r\n\r\non fort;\r\ndot(p2, p2);\r\noff fort;\r\n\r\n**/\r\n\r\nfunction _linedis2(co, v1, v2) {\r\n  let v1x = v1[0] - co[0];\r\n  let v1y = v1[1] - co[1];\r\n  let v1z = v1[2] - co[2];\r\n\r\n  let v2x = v2[0] - co[0];\r\n  let v2y = v2[1] - co[1];\r\n  let v2z = v2[2] - co[2];\r\n\r\n  let dis = (((v1y - v2y)*v1y + (v1z - v2z)*v1z + (v1x - v2x)*v1x)*(v1y - v2y) - v1y)**2 +\r\n    (((v1y - v2y)*v1y + (v1z - v2z)*v1z + (v1x - v2x)*v1x)*(v1z - v2z) - v1z)**2 +\r\n    (((v1y - v2y)*v1y + (v1z - v2z)*v1z + (v1x - v2x)*v1x)*(v1x - v2x) - v1x)**2;\r\n\r\n  return dis;\r\n}\r\n\r\nlet closest_p_tri_rets = new util.cachering(() => {\r\n  return {\r\n    co  : new Vector3(),\r\n    uv  : new Vector2(),\r\n    dist: 0\r\n  }\r\n}, 512);\r\n\r\nlet cpt_v1 = new Vector3();\r\nlet cpt_v2 = new Vector3();\r\nlet cpt_v3 = new Vector3();\r\nlet cpt_v4 = new Vector3();\r\nlet cpt_v5 = new Vector3();\r\nlet cpt_v6 = new Vector3();\r\nlet cpt_p = new Vector3();\r\nlet cpt_n = new Vector3();\r\nlet cpt_mat = new Matrix4();\r\nlet cpt_mat2 = new Matrix4();\r\nlet cpt_b = new Vector3();\r\n\r\nexport function closest_point_on_quad(p, v1, v2, v3, v4, n, uvw) {\r\n  let a = closest_point_on_tri(p, v1, v2, v3, n, uvw);\r\n  let b = closest_point_on_tri(p, v1, v3, v4, n, uvw);\r\n\r\n  return a.dist <= b.dist ? a : b;\r\n}\r\n\r\nexport function closest_point_on_tri(p, v1, v2, v3, n, uvw) {\r\n  let op = p;\r\n\r\n  if (uvw) {\r\n    uvw[0] = uvw[1] = 0.0;\r\n    if (uvw.length > 2) {\r\n      uvw[2] = 0.0;\r\n    }\r\n  }\r\n\r\n  v1 = cpt_v1.load(v1);\r\n  v2 = cpt_v2.load(v2);\r\n  v3 = cpt_v3.load(v3);\r\n  p = cpt_p.load(p);\r\n\r\n  if (n === undefined) {\r\n    n = cpt_n.load(normal_tri(v1, v2, v3));\r\n  }\r\n\r\n  v1.sub(p);\r\n  v2.sub(p);\r\n  v3.sub(p);\r\n  p.zero();\r\n\r\n\r\n  /*use least squares to solve for barycentric coordinates\r\n    then clip to triangle\r\n\r\n    we do this in 2d, as all solutions are coplanar anyway and that way we\r\n    can have one of the equations be \"u+v+w = 1\".\r\n    should investigate if this is really necassary.\r\n   */\r\n\r\n  let ax1, ax2;\r\n  let ax = Math.abs(n[0]), ay = Math.abs(n[1]), az = Math.abs(n[2]);\r\n  if (ax === 0.0 && ay === 0.0 && az === 0.0) {\r\n    console.log(\"eek1\", n, v1, v2, v3);\r\n    let ret = closest_p_tri_rets.next();\r\n\r\n    ret.dist = 1e17;\r\n    ret.co.zero();\r\n    ret.uv.zero();\r\n\r\n    return ret;\r\n  }\r\n\r\n  let ax3;\r\n  if (ax >= ay && ax >= az) {\r\n    ax1 = 1;\r\n    ax2 = 2;\r\n    ax3 = 0;\r\n  } else if (ay >= ax && ay >= az) {\r\n    ax1 = 0;\r\n    ax2 = 2;\r\n    ax3 = 1;\r\n  } else {\r\n    ax1 = 0;\r\n    ax2 = 1;\r\n    ax3 = 2;\r\n  }\r\n\r\n  let mat = cpt_mat;\r\n  let mat2 = cpt_mat2;\r\n  mat.makeIdentity();\r\n\r\n  let m = mat.$matrix;\r\n\r\n  m.m11 = v1[ax1];\r\n  m.m12 = v2[ax1];\r\n  m.m13 = v3[ax1];\r\n  m.m14 = 0.0;\r\n\r\n  m.m21 = v1[ax2];\r\n  m.m22 = v2[ax2];\r\n  m.m23 = v3[ax2];\r\n  m.m24 = 0.0;\r\n\r\n  /*\r\n  m.m31 = v1[ax3];\r\n  m.m32 = v2[ax3];\r\n  m.m33 = v3[ax3];\r\n  m.m34 = 0.0;\r\n  */\r\n\r\n  m.m31 = 1;\r\n  m.m32 = 1;\r\n  m.m33 = 1;\r\n  m.m34 = 0.0;\r\n\r\n  mat.transpose();\r\n\r\n  let b = cpt_b.zero();\r\n\r\n  b[0] = p[ax1];\r\n  b[1] = p[ax2];\r\n  //b[2] = p[ax3];\r\n  b[2] = 1.0;\r\n  b[3] = 0.0;\r\n\r\n  mat2.load(mat).transpose();\r\n\r\n  mat.preMultiply(mat2);\r\n\r\n  if (mat.invert() === null) {\r\n    console.log(\"eek2\", mat.determinant(), ax1, ax2, n);\r\n    let ret = closest_p_tri_rets.next();\r\n\r\n    ret.dist = 1e17;\r\n    ret.co.zero();\r\n    ret.uv.zero();\r\n\r\n    return ret;\r\n  }\r\n\r\n  mat.multiply(mat2);\r\n\r\n\r\n  b.multVecMatrix(mat);\r\n\r\n  let u = b[0];\r\n  let v = b[1];\r\n  let w = b[2];\r\n\r\n  for (let i = 0; i < 1; i++) {\r\n    u = Math.min(Math.max(u, 0.0), 1.0);\r\n    v = Math.min(Math.max(v, 0.0), 1.0);\r\n    w = Math.min(Math.max(w, 0.0), 1.0);\r\n\r\n    let tot = u + v + w;\r\n\r\n    if (tot !== 0.0) {\r\n      tot = 1.0/tot;\r\n      u *= tot;\r\n      v *= tot;\r\n      w *= tot;\r\n    }\r\n  }\r\n\r\n  if (uvw) {\r\n    uvw[0] = u;\r\n    uvw[1] = v;\r\n    if (uvw.length > 2) {\r\n      uvw[2] = w;\r\n    }\r\n  }\r\n\r\n  let x = v1[0]*u + v2[0]*v + v3[0]*w;\r\n  let y = v1[1]*u + v2[1]*v + v3[1]*w;\r\n  let z = v1[2]*u + v2[2]*v + v3[2]*w;\r\n\r\n  let ret = closest_p_tri_rets.next();\r\n\r\n  ret.co.loadXYZ(x, y, z);\r\n  ret.uv[0] = u;\r\n  ret.uv[1] = v;\r\n\r\n  ret.dist = ret.co.vectorLength();\r\n  ret.co.add(op);\r\n\r\n  return ret;\r\n}\r\n\r\nexport function dist_to_tri_v3_old(co, v1, v2, v3, no = undefined) {\r\n  if (!no) {\r\n    no = dtvtmps.next().load(normal_tri(v1, v2, v3));\r\n  }\r\n\r\n  let p = dtvtmps.next().load(co);\r\n  p.sub(v1);\r\n\r\n  let planedis = -p.dot(no);\r\n\r\n  let [axis, axis2] = calc_projection_axes(no);\r\n\r\n  let p1 = dtvtmps.next();\r\n  let p2 = dtvtmps.next();\r\n  let p3 = dtvtmps.next();\r\n\r\n  p1[0] = v1[axis];\r\n  p1[1] = v1[axis2];\r\n  p1[2] = 0.0;\r\n\r\n  p2[0] = v2[axis];\r\n  p2[1] = v2[axis2];\r\n  p2[2] = 0.0;\r\n\r\n  p3[0] = v3[axis];\r\n  p3[1] = v3[axis2];\r\n  p3[2] = 0.0;\r\n\r\n  let pp = dtvtmps.next();\r\n  pp[0] = co[axis];\r\n  pp[1] = co[axis2];\r\n  pp[2] = 0.0;\r\n\r\n  let dis = 1e17;\r\n\r\n  function linedis2d(a, b, c) {\r\n    let dx1 = a[0] - b[0];\r\n    let dy1 = a[1] - b[1];\r\n    let dx2 = c[0] - b[0];\r\n    let dy2 = c[1] - b[1];\r\n\r\n    let len = dx2*dx2 + dy2*dy2;\r\n    len = len > 0.000001 ? 1.0/len : 0.0;\r\n\r\n    dx2 *= len;\r\n    dy2 *= len;\r\n\r\n    return Math.abs(dx1*dy2 - dx2*dy1);\r\n  }\r\n\r\n  let tmp = dtvtmps.next();\r\n  let tmp2 = dtvtmps.next();\r\n\r\n  function linedis3d(a, b, c) {\r\n    tmp.load(a).sub(b);\r\n    tmp2.load(c).sub(b).normalize();\r\n\r\n    let t = tmp.dot(tmp2);\r\n    t = Math.min(Math.max(t, 0.0), b.vectorDistance(c));\r\n\r\n    tmp2.mulScalar(t).add(b);\r\n\r\n    return tmp2.vectorDistance(a);\r\n  }\r\n\r\n\r\n  /* are we above the triangle? if so use plane distance */\r\n  if (point_in_tri(pp, p1, p2, p3)) {\r\n    return Math.abs(planedis);\r\n  }\r\n\r\n  /* get distance to the closest edge */\r\n  dis = Math.min(dis, linedis3d(co, v1, v2));\r\n  dis = Math.min(dis, linedis3d(co, v2, v3));\r\n  dis = Math.min(dis, linedis3d(co, v3, v1));\r\n\r\n  if (0) {\r\n    let uv = barycentric_v2(pp, p1, p2, p3);\r\n\r\n    let w = 1.0 - uv[0] - uv[1];\r\n    uv[0] = Math.min(Math.max(uv[0], 0.0), 1.0);\r\n    uv[1] = Math.min(Math.max(uv[1], 0.0), 1.0);\r\n    w = Math.min(Math.max(w, 0.0), 1.0);\r\n\r\n    let sum = (uv[0] + uv[1] + w);\r\n    sum = sum !== 0.0 ? 1.0/sum : 0.0;\r\n\r\n    w *= sum;\r\n    uv[0] *= sum;\r\n    uv[1] *= sum;\r\n\r\n    pp.zero();\r\n\r\n    pp.addFac(v1, uv[0]);\r\n    pp.addFac(v2, uv[1]);\r\n    pp.addFac(v3, 1.0 - uv[0] - uv[1]);\r\n\r\n    dis = Math.min(dis, pp.vectorDistance(co));\r\n  }\r\n\r\n  return dis;\r\n}\r\n\r\n\r\nexport function dist_to_tri_v3(p, v1, v2, v3, n) {\r\n  return dist_to_tri_v3_old(p, v1, v2, v3, n);\r\n  //return Math.sqrt(Math.abs(dist_to_tri_v3_sqr(p, v1, v2, v3, n)));\r\n}\r\n\r\n\r\n/* reduce script\r\n\r\non factor;\r\n\r\nax := 0;\r\nay := 0;\r\n\r\ne1x := bx - ax;\r\ne1y := by - ay;\r\ne2x := cx - bx;\r\ne2y := cy - by;\r\ne3x := ax - cx;\r\ne3y := ay - cy;\r\n\r\nl1 := (e1x**2 + e1y**2)**0.5;\r\nl2 := (e2x**2 + e2y**2)**0.5;\r\nl3 := (e3x**2 + e3y**2)**0.5;\r\n\r\nload_package \"avector\";\r\n\r\ne1 := avec(e1x / l1, e1y / l1, 0.0);\r\ne2 := avec(e2x / l2, e2y / l2, 0.0);\r\ne3 := avec(e3x / l3, e3y / l3, 0.0);\r\n\r\nd1 := x1*e1[1] - y1*e1[0];\r\nd2 := x1*e2[1] - y1*e2[0];\r\nd3 := x1*e3[1] - y1*e3[0];\r\n\r\nd1 := d1**2;\r\nd2 := d2**2;\r\nd3 := d3**2;\r\n\r\non fort;\r\nd1;\r\nd2;\r\nd3;\r\noff fort;\r\n\r\n*/\r\n\r\nlet _dt3s_n = new Vector3();\r\n\r\nexport function dist_to_tri_v3_sqr(p, v1, v2, v3, n) {\r\n  if (n === undefined) {\r\n    n = _dt3s_n;\r\n    n.load(normal_tri(v1, v2, v3));\r\n  }\r\n\r\n  // find projection axis;\r\n  let axis1, axis2, axis3;\r\n  let nx = n[0] < 0.0 ? -n[0] : n[0];\r\n  let ny = n[1] < 0.0 ? -n[1] : n[1];\r\n  let nz = n[2] < 0.0 ? -n[2] : n[2];\r\n\r\n  const feps = 0.0000001;\r\n\r\n  if (nx > ny && nx > nz) {\r\n    axis1 = 1;\r\n    axis2 = 2;\r\n    axis3 = 0;\r\n  } else if (ny > nx && ny > nz) {\r\n    axis1 = 0;\r\n    axis2 = 2;\r\n    axis3 = 1;\r\n  } else {\r\n    axis1 = 0;\r\n    axis2 = 1;\r\n    axis3 = 2;\r\n  }\r\n\r\n  //n.load(normal_tri(v1, v2, v3));\r\n\r\n  let planedis = (p[0] - v1[0])*n[0] + (p[1] - v1[1])*n[1] + (p[2] - v1[2])*n[2];\r\n  planedis = planedis < 0.0 ? -planedis : planedis;\r\n\r\n  let ax = v1[axis1], ay = v1[axis2], az = v1[axis3];\r\n\r\n  let bx = v2[axis1] - ax, by = v2[axis2] - ay, bz = v2[axis3] - az;\r\n  let cx = v3[axis1] - ax, cy = v3[axis2] - ay, cz = v3[axis3] - az;\r\n\r\n  let bx2 = bx*bx, by2 = by*by, bz2 = bz*bz, cx2 = cx*cx, cy2 = cy*cy, cz2 = cz*cz;\r\n\r\n  let x1 = p[axis1] - ax;\r\n  let y1 = p[axis2] - ay;\r\n  let z1 = p[axis3] - az;\r\n\r\n  const testf = 0.0;\r\n\r\n  let l1 = Math.sqrt(bx**2 + by**2);\r\n  let l2 = Math.sqrt((cx - bx)**2 + (cy - by)**2);\r\n  let l3 = Math.sqrt(cx**2 + cy**2);\r\n\r\n  let s1 = x1*by - y1*bx < testf;\r\n  let s2 = (x1 - bx)*(cy - by) - (y1 - by)*(cx - bx) < testf;\r\n  let s3 = (x1* -cy + y1*cx) < testf;\r\n\r\n  /*\r\n    (x1-cx)*-cy - (y1-cy)*-cx\r\n   reduces to:\r\n     x1*-cy + y1*cx;\r\n   */\r\n\r\n  //console.log(axis1, axis2, axis3, n);\r\n  //console.log(s1, s2, s3);\r\n  //console.log(bx, by, cx, cy);\r\n\r\n  if (1 && n[axis3] < 0.0) {\r\n    s1 = !s1;\r\n    s2 = !s2;\r\n    s3 = !s3;\r\n    /*\r\n        bx = v3[axis1];\r\n        by = v3[axis2];\r\n        bz = v3[axis3];\r\n\r\n        cx = v2[axis1];\r\n        cy = v2[axis2];\r\n        cz = v2[axis3];\r\n\r\n        bx2 = bx*bx;\r\n        by2 = by*by;\r\n        bz2 = bz*bz;\r\n\r\n        cx2 = cx*cx;\r\n        cy2 = cy*cy;\r\n        cz2 = cz*cz;*/\r\n  }\r\n\r\n  let mask = (s1 & 1) | (s2<<1) | (s3<<2);\r\n  if (mask === 0 || mask === 7) {\r\n    return planedis*planedis;\r\n  }\r\n\r\n  let d1, d2, d3, div;\r\n\r\n\r\n  /*\r\n//\\  3|\r\n//  \\ |\r\n//    b\r\n//    | \\\r\n//  1 |   \\  2\r\n//    |  0  \\\r\n// ___a_______c___\r\n//  5 |   4      \\ 6\r\n*/\r\n\r\n  let dis = 0.0;\r\n  let lx, ly, lz;\r\n\r\n  lx = bx;\r\n  ly = by;\r\n  lz = bz;\r\n\r\n  nx = n[axis1];\r\n  ny = n[axis2];\r\n  nz = n[axis3];\r\n\r\n  switch (mask) {\r\n    case 1:\r\n      div = (bx2 + by2);\r\n\r\n      if (div > feps) {\r\n        d1 = (bx*y1 - by*x1);\r\n        d1 = (d1*d1)/div;\r\n\r\n        lx = -by;\r\n        ly = bx;\r\n        lz = bz;\r\n      } else {\r\n        d1 = x1*x1 + y1*y1;\r\n\r\n        lx = x1;\r\n        ly = y1;\r\n        lz = z1;\r\n      }\r\n\r\n      dis = d1;\r\n      break;\r\n    case 3:\r\n      lx = x1 - bx;\r\n      ly = y1 - by;\r\n      lz = z1 - bz;\r\n\r\n      dis = lx*lx + ly*ly;\r\n      return lx*lx + ly*ly + lz*lz;\r\n    case 2:\r\n      div = (bx - cx)**2 + (by - cy)**2;\r\n\r\n      if (div > feps) {\r\n        d2 = ((bx - cx)*y1 - (by - cy)*x1);\r\n        d2 = d2/div;\r\n\r\n        lx = (by - cy);\r\n        ly = (cx - bx);\r\n        lz = cz - bz;\r\n      } else {\r\n        d2 = (x1 - bx)*(x1 - bx) + (y1 - by)*(y1 - by);\r\n\r\n        lx = x1 - bx;\r\n        ly = y1 - by;\r\n        lz = z1 - bz;\r\n      }\r\n\r\n      dis = d2;\r\n      break;\r\n    case 6:\r\n      lx = x1 - cx;\r\n      ly = y1 - cy;\r\n      lz = z1 - cz;\r\n\r\n      return lx*lx + ly*ly + lz*lz;\r\n    case 4:\r\n      div = (cx2 + cy2);\r\n\r\n      if (div > feps) {\r\n        d3 = (cx*y1 - cy*x1);\r\n        d3 = (d3*d3)/div;\r\n\r\n        lx = cy;\r\n        ly = -cx;\r\n        lz = cz;\r\n      } else {\r\n        d3 = (x1 - cx)*(x1 - cx) + (y1 - cy)*(y1 - cy);\r\n\r\n        lx = x1 - cx;\r\n        ly = y1 - cy;\r\n        lz = z1 - cz;\r\n      }\r\n\r\n      dis = d3;\r\n      break;\r\n    case 5:\r\n      lx = x1;\r\n      ly = y1;\r\n      lz = z1;\r\n\r\n      return lx*lx + ly*ly + lz*lz;\r\n  }\r\n\r\n  //lx = p[axis1] - v1[axis1];\r\n  //ly = p[axis2] - v1[axis2];\r\n  {\r\n    let d = lx*nx + ly*ny + lz*nz;\r\n\r\n    d = -d;\r\n\r\n    lx += nx*d;\r\n    ly += ny*d;\r\n    lz += nz*d;\r\n\r\n    //dis = lx*lx + ly*ly;\r\n\r\n    if (0 && Math.random() > 0.999) {\r\n      console.log(\"d\", d.toFixed(6));\r\n      console.log(lx*nx + ly*ny + lz*nz);\r\n    }\r\n  }\r\n\r\n  let mul = ((lx**2 + ly**2)*nz**2 + (lx*nx + ly*ny)**2)/((lx**2 + ly**2)*nz**2);\r\n  //let mul = ((lx**2+ly**2)*nz**2+(lx*nx+ly*ny)**2)/((ly**2+lz**2+lx**2)*nz**2);\r\n\r\n  //mul = 1.0 / nz;\r\n  //mul *= mul;\r\n\r\n  if (Math.random() > 0.999) {\r\n    console.log(mul.toFixed(4));\r\n  }\r\n\r\n  //mul = 1.0;\r\n\r\n  if (0) {\r\n    let odis = dis;\r\n\r\n    dis = x1**2 + y1**2 + z1**2;\r\n\r\n    if (Math.random() > 0.999) {\r\n      console.log((dis/odis).toFixed(4), mul.toFixed(4));\r\n    }\r\n    mul = 1.0;\r\n  }\r\n\r\n  /*\r\n  on factor;\r\n\r\n  dx := sqrt(dis)*(lx / sqrt(lx**2 + ly**2));\r\n  dy := sqrt(dis)*(ly / sqrt(lx**2 + ly**2));\r\n  f2 := dx*nx + dy*ny + dz*nz;\r\n\r\n  fz := solve(f2, dz);\r\n  fz := part(fz, 1, 2);\r\n\r\n  dis2 := dx*dx + dy*dy + fz*fz;\r\n  fmul := dis2/dis;\r\n\r\n  on fort;\r\n  fmul;\r\n  off fort;\r\n\r\n\r\n  */\r\n\r\n  return dis*mul + planedis*planedis;\r\n}\r\n\r\nlet tri_area_temps = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport function tri_area(v1, v2, v3) {\r\n  let l1 = v1.vectorDistance(v2);\r\n  let l2 = v2.vectorDistance(v3);\r\n  let l3 = v3.vectorDistance(v1);\r\n\r\n  let s = (l1 + l2 + l3)/2.0;\r\n  s = s*(s - l1)*(s - l2)*(s - l3);\r\n  s = Math.max(s, 0); /* Numerical error can dip into negative numbers. */\r\n  return Math.sqrt(s);\r\n}\r\n\r\nexport function aabb_overlap_area(pos1, size1, pos2, size2) {\r\n  let r1 = 0.0, r2 = 0.0;\r\n\r\n  for (let i = 0; i < 2; i++) {\r\n    let a1 = pos1[i], a2 = pos2[i];\r\n    let b1 = pos1[i] + size1[i];\r\n    let b2 = pos2[i] + size2[i];\r\n\r\n    if (b1 >= a2 && b2 >= a1) {\r\n      let r = Math.abs(a2 - b1);\r\n      r = Math.min(r, Math.abs(a1 - b2));\r\n\r\n      if (i) {\r\n        r2 = r;\r\n      } else {\r\n        r1 = r;\r\n      }\r\n    }\r\n  }\r\n\r\n  return r1*r2;\r\n}\r\n\r\n/**\r\n * Returns true if two aabbs intersect\r\n * @param {*} pos1\r\n * @param {*} size1\r\n * @param {*} pos2\r\n * @param {*} size2\r\n */\r\n\r\nexport function aabb_isect_2d(pos1, size1, pos2, size2) {\r\n  let ret = 0;\r\n  for (let i = 0; i < 2; i++) {\r\n    let a = pos1[i];\r\n    let b = pos1[i] + size1[i];\r\n    let c = pos2[i];\r\n    let d = pos2[i] + size2[i];\r\n    if (b >= c && a <= d)\r\n      ret += 1;\r\n  }\r\n  return ret === 2;\r\n};\r\n\r\n\r\nexport function aabb_isect_3d(pos1, size1, pos2, size2) {\r\n  let ret = 0;\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    let a = pos1[i];\r\n    let b = pos1[i] + size1[i];\r\n\r\n    let c = pos2[i];\r\n    let d = pos2[i] + size2[i];\r\n\r\n    if (b >= c && a <= d)\r\n      ret += 1;\r\n  }\r\n  return ret === 3;\r\n}\r\n\r\n\r\nlet aabb_intersect_vs = util.cachering.fromConstructor(Vector2, 32);\r\nlet aabb_intersect_rets = new util.cachering(() => {\r\n  return {\r\n    pos : new Vector2(),\r\n    size: new Vector2()\r\n  }\r\n}, 512);\r\n\r\n/**\r\n * Returns aabb that's the intersection of two aabbs\r\n * @param {*} pos1\r\n * @param {*} size1\r\n * @param {*} pos2\r\n * @param {*} size2\r\n */\r\nexport function aabb_intersect_2d(pos1, size1, pos2, size2) {\r\n  let v1 = aabb_intersect_vs.next().load(pos1);\r\n  let v2 = aabb_intersect_vs.next().load(pos1).add(size1);\r\n  let v3 = aabb_intersect_vs.next().load(pos2);\r\n  let v4 = aabb_intersect_vs.next().load(pos2).add(size2);\r\n\r\n  let min = aabb_intersect_vs.next().zero();\r\n  let max = aabb_intersect_vs.next().zero();\r\n\r\n  let tot = 0;\r\n\r\n  for (let i = 0; i < 2; i++) {\r\n    if (v2[i] >= v3[i] && v1[i] <= v4[i]) {\r\n      tot++;\r\n\r\n      min[i] = Math.max(v3[i], v1[i]);\r\n      max[i] = Math.min(v2[i], v4[i]);\r\n    }\r\n  }\r\n\r\n  if (tot !== 2) {\r\n    return undefined;\r\n  }\r\n\r\n  let ret = aabb_intersect_rets.next();\r\n  ret.pos.load(min);\r\n  ret.size.load(max).sub(min);\r\n\r\n  return ret;\r\n}\r\n\r\nwindow.test_aabb_intersect_2d = function () {\r\n  let canvas = document.getElementById(\"test_canvas\");\r\n\r\n  if (!canvas) {\r\n    canvas = document.createElement(\"canvas\");\r\n    canvas.setAttribute(\"id\", \"test_canvas\");\r\n    canvas.g = canvas.getContext(\"2d\");\r\n\r\n    document.body.appendChild(canvas);\r\n  }\r\n\r\n  canvas.width = ~~(window.innerWidth*devicePixelRatio);\r\n  canvas.height = ~~(window.innerHeight*devicePixelRatio);\r\n  canvas.style.width = (canvas.width/devicePixelRatio) + \"px\";\r\n  canvas.style.height = (canvas.height/devicePixelRatio) + \"px\";\r\n  canvas.style.position = \"absolute\";\r\n  canvas.style[\"z-index\"] = \"1000\";\r\n\r\n  let g = canvas.g;\r\n  g.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n  let sz = 800;\r\n  let a1 = new Vector2([Math.random()*sz, Math.random()*sz]).floor();\r\n  let a2 = new Vector2([Math.random()*sz, Math.random()*sz]).floor();\r\n  let b1 = new Vector2([Math.random()*sz, Math.random()*sz]).floor();\r\n  let b2 = new Vector2([Math.random()*sz, Math.random()*sz]).floor();\r\n\r\n  let p1 = new Vector2();\r\n  let s1 = new Vector2();\r\n  let p2 = new Vector2();\r\n  let s2 = new Vector2();\r\n\r\n  p1.load(a1).min(a2);\r\n  s1.load(a1).max(a2);\r\n  p2.load(b1).min(b2);\r\n  s2.load(b1).max(b2);\r\n\r\n  s1.sub(p1);\r\n  s2.sub(p1);\r\n\r\n  console.log(p1, s1);\r\n  console.log(p2, s2);\r\n\r\n  g.beginPath();\r\n  g.rect(0, 0, canvas.width, canvas.height);\r\n  g.fillStyle = \"white\";\r\n  g.fill();\r\n\r\n  g.beginPath();\r\n  g.rect(p1[0], p1[1], s1[0], s1[1]);\r\n  g.fillStyle = \"rgba(255, 100, 75, 1.0)\";\r\n  g.fill();\r\n\r\n  g.beginPath();\r\n  g.rect(p2[0], p2[1], s2[0], s2[1]);\r\n  g.fillStyle = \"rgba(75, 100, 255, 1.0)\";\r\n  g.fill();\r\n\r\n  let ret = aabb_intersect_2d(p1, s1, p2, s2);\r\n\r\n  if (ret) {\r\n\r\n    g.beginPath();\r\n    g.rect(ret.pos[0], ret.pos[1], ret.size[0], ret.size[1]);\r\n    g.fillStyle = \"rgba(0, 0, 0, 1.0)\";\r\n    g.fill();\r\n  }\r\n\r\n  /*\r\n  window.setTimeout(() => {\r\n    canvas.remove();\r\n  }, 2000);\r\n  //*/\r\n\r\n  return {\r\n    end  : test_aabb_intersect_2d.end,\r\n    timer: test_aabb_intersect_2d.timer\r\n  };\r\n}\r\n\r\ntest_aabb_intersect_2d.stop = function stop() {\r\n  if (test_aabb_intersect_2d._timer) {\r\n    console.log(\"stopping timer\");\r\n\r\n    window.clearInterval(test_aabb_intersect_2d._timer);\r\n    test_aabb_intersect_2d._timer = undefined;\r\n  }\r\n}\r\n\r\ntest_aabb_intersect_2d.end = function end() {\r\n  test_aabb_intersect_2d.stop();\r\n\r\n  let canvas = document.getElementById(\"test_canvas\");\r\n  if (canvas) {\r\n    canvas.remove();\r\n  }\r\n}\r\ntest_aabb_intersect_2d.timer = function timer(rate = 500) {\r\n  if (test_aabb_intersect_2d._timer) {\r\n    window.clearInterval(test_aabb_intersect_2d._timer);\r\n    test_aabb_intersect_2d._timer = undefined;\r\n    console.log(\"stopping timer\");\r\n    return;\r\n  }\r\n\r\n  console.log(\"starting timer\");\r\n\r\n  test_aabb_intersect_2d._timer = window.setInterval(() => {\r\n    test_aabb_intersect_2d();\r\n  }, rate);\r\n};\r\n\r\nlet aabb_intersect_vs3 = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport function aabb_intersect_3d(min1, max1, min2, max2) {\r\n  let tot = 0;\r\n\r\n  for (let i = 0; i < 2; i++) {\r\n    if (max1[i] >= min2[i] && min1[i] <= max2[i]) {\r\n      tot++;\r\n    }\r\n  }\r\n\r\n  if (tot !== 3) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n/**\r\n * AABB union of a and b.\r\n * Result is in a.\r\n *\r\n * @param a List of two vectors\r\n * @param b List of two vectors\r\n * @returns a\r\n */\r\nexport function aabb_union(a, b) {\r\n  for (let i = 0; i < 2; i++) {\r\n    for (let j = 0; j < a[i].length; j++) {\r\n      a[i][j] = i ? Math.max(a[i][j], b[i][j]) : Math.min(a[i][j], b[i][j]);\r\n    }\r\n  }\r\n\r\n  return a;\r\n}\r\n\r\nexport function aabb_union_2d(pos1, size1, pos2, size2) {\r\n  let v1 = aabb_intersect_vs.next();\r\n  let v2 = aabb_intersect_vs.next();\r\n  let min = aabb_intersect_vs.next();\r\n  let max = aabb_intersect_vs.next();\r\n  v1.load(pos1).add(size1);\r\n  v2.load(pos2).add(size2);\r\n\r\n  min.load(v1).min(v2);\r\n  max.load(v1).max(v2);\r\n\r\n  max.sub(min);\r\n  let ret = aabb_intersect_rets.next();\r\n\r\n  ret.pos.load(min);\r\n  ret.pos.load(max);\r\n\r\n  return ret;\r\n}\r\n\r\n//XXX refactor to use es6 classes,\r\n//    or at last the class system in typesystem.js\r\nfunction init_prototype(cls, proto) {\r\n  for (let k in proto) {\r\n    cls.prototype[k] = proto[k];\r\n  }\r\n\r\n  return cls.prototype;\r\n}\r\n\r\nfunction inherit(cls, parent, proto) {\r\n  cls.prototype = Object.create(parent.prototype);\r\n\r\n  for (let k in proto) {\r\n    cls.prototype[k] = proto[k];\r\n  }\r\n\r\n  return cls.prototype;\r\n}\r\n\r\nlet set = util.set;\r\n\r\n//everything below here was compiled from es6 code  \r\n//variables starting with $ are function static local vars,\r\n//like in C.  don't use them outside their owning functions.\r\n//\r\n//except for $_mh and $_swapt.  they were used with a C macro\r\n//preprocessor.\r\nlet $_mh, $_swapt;\r\n\r\n//XXX destroy me\r\nexport const feps = 2.22e-16;\r\n\r\nexport const COLINEAR = 1;\r\nexport const LINECROSS = 2;\r\nexport const COLINEAR_ISECT = 3;\r\n\r\nlet _cross_vec1 = new Vector3();\r\nlet _cross_vec2 = new Vector3();\r\n\r\nexport const SQRT2 = Math.sqrt(2.0);\r\nexport const FEPS_DATA = {\r\n  F16: 1.11e-16,\r\n  F32: 5.96e-08,\r\n  F64: 4.88e-04\r\n};\r\n\r\n/*use 32 bit epsilon by default, since we're often working from\r\n  32-bit float data.  note that javascript uses 64-bit doubles \r\n  internally.*/\r\nexport const FEPS = FEPS_DATA.F32;\r\nexport const FLOAT_MIN = -1e+21;\r\nexport const FLOAT_MAX = 1e+22;\r\nexport const Matrix4UI = Matrix4;\r\n\r\n/*\r\nThis must be truly ancient code, possibly from\r\nallshape days.\r\n\r\nif (FLOAT_MIN != FLOAT_MIN || FLOAT_MAX != FLOAT_MAX) {\r\n  FLOAT_MIN = 1e-05;\r\n  FLOAT_MAX = 1000000.0;\r\n  console.log(\"Floating-point 16-bit system detected!\");\r\n}\r\n*/\r\n\r\nlet _static_grp_points4 = new Array(4);\r\nlet _static_grp_points8 = new Array(8);\r\n\r\nexport function get_rect_points(p, size) {\r\n  let cs;\r\n  if (p.length === 2) {\r\n    cs = _static_grp_points4;\r\n    cs[0] = p;\r\n    cs[1] = [p[0] + size[0], p[1]];\r\n    cs[2] = [p[0] + size[0], p[1] + size[1]];\r\n    cs[3] = [p[0], p[1] + size[1]];\r\n  } else if (p.length === 3) {\r\n    cs = _static_grp_points8;\r\n    cs[0] = p;\r\n    cs[1] = [p[0] + size[0], p[1], p[2]];\r\n    cs[2] = [p[0] + size[0], p[1] + size[1], p[2]];\r\n    cs[3] = [p[0], p[1] + size[0], p[2]];\r\n    cs[4] = [p[0], p[1], p[2] + size[2]];\r\n    cs[5] = [p[0] + size[0], p[1], p[2] + size[2]];\r\n    cs[6] = [p[0] + size[0], p[1] + size[1], p[2] + size[2]];\r\n    cs[7] = [p[0], p[1] + size[0], p[2] + size[2]];\r\n  } else {\r\n    throw \"get_rect_points has no implementation for \" + p.length + \"-dimensional data\";\r\n  }\r\n  return cs;\r\n};\r\n\r\nexport function get_rect_lines(p, size) {\r\n  let ps = get_rect_points(p, size);\r\n  if (p.length === 2) {\r\n    return [[ps[0], ps[1]], [ps[1], ps[2]], [ps[2], ps[3]], [ps[3], ps[0]]];\r\n  } else if (p.length === 3) {\r\n    let l1 = [[ps[0], ps[1]], [ps[1], ps[2]], [ps[2], ps[3]], [ps[3], ps[0]]];\r\n    let l2 = [[ps[4], ps[5]], [ps[5], ps[6]], [ps[6], ps[7]], [ps[7], ps[4]]];\r\n    l1.concat(l2);\r\n    l1.push([ps[0], ps[4]]);\r\n    l1.push([ps[1], ps[5]]);\r\n    l1.push([ps[2], ps[6]]);\r\n    l1.push([ps[3], ps[7]]);\r\n    return l1;\r\n  } else {\r\n    throw \"get_rect_points has no implementation for \" + p.length + \"-dimensional data\";\r\n  }\r\n};\r\n\r\nlet $vs_simple_tri_aabb_isect = [0, 0, 0];\r\n\r\nexport function simple_tri_aabb_isect(v1, v2, v3, min, max) {\r\n  $vs_simple_tri_aabb_isect[0] = v1;\r\n  $vs_simple_tri_aabb_isect[1] = v2;\r\n  $vs_simple_tri_aabb_isect[2] = v3;\r\n  for (let i = 0; i < 3; i++) {\r\n    let isect = true;\r\n    for (let j = 0; j < 3; j++) {\r\n      if ($vs_simple_tri_aabb_isect[j][i] < min[i] || $vs_simple_tri_aabb_isect[j][i] >= max[i])\r\n        isect = false;\r\n    }\r\n    if (isect)\r\n      return true;\r\n  }\r\n  return false;\r\n};\r\n\r\nexport class MinMax {\r\n  constructor(totaxis) {\r\n    if (totaxis === undefined) {\r\n      totaxis = 1;\r\n    }\r\n    this.totaxis = totaxis;\r\n    if (totaxis !== 1) {\r\n      let cls;\r\n\r\n      switch (totaxis) {\r\n        case 2:\r\n          cls = Vector2;\r\n          break;\r\n        case 3:\r\n          cls = Vector3;\r\n          break;\r\n        case 4:\r\n          cls = Vector4;\r\n          break;\r\n        default:\r\n          cls = Array;\r\n          break;\r\n      }\r\n\r\n      this._min = new cls(totaxis);\r\n      this._max = new cls(totaxis);\r\n      this.min = new cls(totaxis);\r\n      this.max = new cls(totaxis);\r\n    } else {\r\n      this.min = this.max = 0;\r\n      this._min = FLOAT_MAX;\r\n      this._max = FLOAT_MIN;\r\n    }\r\n    this.reset();\r\n    this._static_mr_co = new Array(this.totaxis);\r\n    this._static_mr_cs = new Array(this.totaxis*this.totaxis);\r\n  }\r\n\r\n  static fromSTRUCT(reader) {\r\n    let ret = new MinMax();\r\n    reader(ret);\r\n    return ret;\r\n  }\r\n\r\n  load(mm) {\r\n    if (this.totaxis === 1) {\r\n      this.min = mm.min;\r\n      this.max = mm.max;\r\n      this._min = mm.min;\r\n      this._max = mm.max;\r\n    } else {\r\n      this.min = new Vector3(mm.min);\r\n      this.max = new Vector3(mm.max);\r\n      this._min = new Vector3(mm._min);\r\n      this._max = new Vector3(mm._max);\r\n    }\r\n  }\r\n\r\n  reset() {\r\n    let totaxis = this.totaxis;\r\n    if (totaxis === 1) {\r\n      this.min = this.max = 0;\r\n      this._min = FLOAT_MAX;\r\n      this._max = FLOAT_MIN;\r\n    } else {\r\n      for (let i = 0; i < totaxis; i++) {\r\n        this._min[i] = FLOAT_MAX;\r\n        this._max[i] = FLOAT_MIN;\r\n        this.min[i] = 0;\r\n        this.max[i] = 0;\r\n      }\r\n    }\r\n  }\r\n\r\n  minmax_rect(p, size) {\r\n    let totaxis = this.totaxis;\r\n    let cs = this._static_mr_cs;\r\n    if (totaxis === 2) {\r\n      cs[0] = p;\r\n      cs[1] = [p[0] + size[0], p[1]];\r\n      cs[2] = [p[0] + size[0], p[1] + size[1]];\r\n      cs[3] = [p[0], p[1] + size[1]];\r\n    } else if (totaxis = 3) {\r\n      cs[0] = p;\r\n      cs[1] = [p[0] + size[0], p[1], p[2]];\r\n      cs[2] = [p[0] + size[0], p[1] + size[1], p[2]];\r\n      cs[3] = [p[0], p[1] + size[0], p[2]];\r\n      cs[4] = [p[0], p[1], p[2] + size[2]];\r\n      cs[5] = [p[0] + size[0], p[1], p[2] + size[2]];\r\n      cs[6] = [p[0] + size[0], p[1] + size[1], p[2] + size[2]];\r\n      cs[7] = [p[0], p[1] + size[0], p[2] + size[2]];\r\n    } else {\r\n      throw \"Minmax.minmax_rect has no implementation for \" + totaxis + \"-dimensional data\";\r\n    }\r\n    for (let i = 0; i < cs.length; i++) {\r\n      this.minmax(cs[i]);\r\n    }\r\n  }\r\n\r\n  minmax(p) {\r\n    let totaxis = this.totaxis;\r\n\r\n    if (totaxis === 1) {\r\n      this._min = this.min = Math.min(this._min, p);\r\n      this._max = this.max = Math.max(this._max, p);\r\n    } else if (totaxis === 2) {\r\n      this._min[0] = this.min[0] = Math.min(this._min[0], p[0]);\r\n      this._min[1] = this.min[1] = Math.min(this._min[1], p[1]);\r\n      this._max[0] = this.max[0] = Math.max(this._max[0], p[0]);\r\n      this._max[1] = this.max[1] = Math.max(this._max[1], p[1]);\r\n    } else if (totaxis === 3) {\r\n      this._min[0] = this.min[0] = Math.min(this._min[0], p[0]);\r\n      this._min[1] = this.min[1] = Math.min(this._min[1], p[1]);\r\n      this._min[2] = this.min[2] = Math.min(this._min[2], p[2]);\r\n      this._max[0] = this.max[0] = Math.max(this._max[0], p[0]);\r\n      this._max[1] = this.max[1] = Math.max(this._max[1], p[1]);\r\n      this._max[2] = this.max[2] = Math.max(this._max[2], p[2]);\r\n    } else {\r\n      for (let i = 0; i < totaxis; i++) {\r\n        this._min[i] = this.min[i] = Math.min(this._min[i], p[i]);\r\n        this._max[i] = this.max[i] = Math.max(this._max[i], p[i]);\r\n      }\r\n    }\r\n  }\r\n};\r\nMinMax.STRUCT = \"\\n  math.MinMax {\\n    min     : vec3;\\n    max     : vec3;\\n    _min    : vec3;\\n    _max    : vec3;\\n    totaxis : int;\\n  }\\n\";\r\n\r\nexport function winding_axis(a, b, c, up_axis) {\r\n  let xaxis = (up_axis + 1)%3;\r\n  let yaxis = (up_axis + 2)%3;\r\n\r\n  let x1 = a[xaxis], y1 = a[yaxis];\r\n  let x2 = b[xaxis], y2 = b[yaxis];\r\n  let x3 = c[xaxis], y3 = c[yaxis];\r\n\r\n  let dx1 = x1 - x2, dy1 = y1 - y2;\r\n  let dx2 = x3 - x2, dy2 = y3 - y2;\r\n\r\n  let f = dx1*dy2 - dy1*dx2;\r\n  return f >= 0.0;\r\n}\r\n\r\n/** returns false if clockwise */\r\nexport function winding(a, b, c, zero_z = false, tol = 0.0) {\r\n  let dx1 = b[0] - a[0];\r\n  let dy1 = b[1] - a[1];\r\n  let dx2 = c[0] - a[0];\r\n  let dy2 = c[1] - a[1];\r\n\r\n  return dx1*dy2 - dy1*dx2 > tol;\r\n}\r\n\r\nexport function inrect_2d(p, pos, size) {\r\n  if (p === undefined || pos === undefined || size === undefined) {\r\n    console.trace();\r\n    console.log(\"Bad paramters to inrect_2d()\");\r\n    console.log(\"p: \", p, \", pos: \", pos, \", size: \", size);\r\n    return false;\r\n  }\r\n  return p[0] >= pos[0] && p[0] <= pos[0] + size[0] && p[1] >= pos[1] && p[1] <= pos[1] + size[1];\r\n}\r\n\r\nlet $ps_aabb_isect_line_2d = [new Vector2(), new Vector2(), new Vector2(), new Vector2()];\r\n\r\nexport function aabb_isect_line_2d(v1, v2, min, max) {\r\n  if (point_in_aabb_2d(v1, min, max) || point_in_aabb(v2, min, max)) {\r\n    return true;\r\n  }\r\n\r\n  let lines = $ps_aabb_isect_line_2d;\r\n  lines[0][0] = min[0];\r\n  lines[0][1] = min[1];\r\n\r\n  lines[1][0] = min[0];\r\n  lines[1][1] = max[1];\r\n\r\n  lines[2][0] = max[0];\r\n  lines[2][1] = max[1];\r\n\r\n  lines[3][0] = max[0];\r\n  lines[3][1] = min[1];\r\n\r\n  for (let i = 0; i < 4; i++) {\r\n    if (line_line_cross(v1, v2, lines[i], lines[(i + 1)%4])) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n\r\nexport function expand_rect2d(pos, size, margin) {\r\n  pos[0] -= Math.floor(margin[0]);\r\n  pos[1] -= Math.floor(margin[1]);\r\n  size[0] += Math.floor(margin[0]*2.0);\r\n  size[1] += Math.floor(margin[1]*2.0);\r\n};\r\n\r\nexport function expand_line(l, margin) {\r\n  let c = new Vector3();\r\n  c.add(l[0]);\r\n  c.add(l[1]);\r\n  c.mulScalar(0.5);\r\n  l[0].sub(c);\r\n  l[1].sub(c);\r\n  let l1 = l[0].vectorLength();\r\n  let l2 = l[1].vectorLength();\r\n  l[0].normalize();\r\n  l[1].normalize();\r\n  l[0].mulScalar(margin + l1);\r\n  l[1].mulScalar(margin + l2);\r\n  l[0].add(c);\r\n  l[1].add(c);\r\n  return l;\r\n}\r\n\r\nexport function colinear(a, b, c, limit = 2.2e-16, distLimit = 0.00001**2) {\r\n  let t1 = _cross_vec1;\r\n  let t2 = _cross_vec2;\r\n\r\n  let axes = a.length;\r\n\r\n  for (let i = 0; i < axes; i++) {\r\n    t1[i] = b[i] - a[i];\r\n    t2[i] = c[i] - a[i];\r\n  }\r\n\r\n  for (let i = axes; i < 3; i++) {\r\n    t1[i] = t2[i] = 0.0;\r\n  }\r\n\r\n  if (t1.dot(t1) <= distLimit || t2.dot(t2) <= distLimit) {\r\n    return true;\r\n  }\r\n\r\n  t1.normalize();\r\n  t2.normalize();\r\n\r\n  t1.cross(t2);\r\n  return t1.dot(t1) <= limit;\r\n}\r\n\r\nexport function colinear2d(a, b, c, limit = 0.00001, precise = false) {\r\n  let dx1 = a[0] - b[0];\r\n  let dy1 = a[1] - b[1];\r\n  let dx2 = c[0] - b[0];\r\n  let dy2 = c[1] - b[1];\r\n\r\n  let det = Math.abs(dx1*dy2 - dy1*dx2);\r\n  if (precise) {\r\n    let len = (dx1**2 + dy1**2)**0.5 + (dx2**2 + dy2**2)**0.5;\r\n    if (len <= 0.00001) {\r\n      return true;\r\n    }\r\n\r\n    det /= len;\r\n  }\r\n\r\n  return det <= limit;\r\n}\r\n\r\nlet _llc_l1 = [new Vector3(), new Vector3()];\r\nlet _llc_l2 = [new Vector3(), new Vector3()];\r\nlet _llc_l3 = [new Vector3(), new Vector3()];\r\nlet _llc_l4 = [new Vector3(), new Vector3()];\r\n\r\nlet lli_v1 = new Vector3(), lli_v2 = new Vector3(), lli_v3 = new Vector3(), lli_v4 = new Vector3();\r\n\r\nlet _zero_cn = new Vector3();\r\nlet _tmps_cn = util.cachering.fromConstructor(Vector3, 64);\r\nlet _rets_cn = util.cachering.fromConstructor(Vector3, 64);\r\n\r\n//vec1, vec2 should both be normalized\r\nexport function corner_normal(vec1, vec2, width) {\r\n  let ret = _rets_cn.next().zero();\r\n\r\n  let vec = _tmps_cn.next().zero();\r\n  vec.load(vec1).add(vec2).normalize();\r\n\r\n  /*\r\n  ret.load(vec).mulScalar(width);\r\n  return ret;\r\n  */\r\n\r\n  //handle colinear case\r\n  if (Math.abs(vec1.normalizedDot(vec2)) > 0.9999) {\r\n    if (vec1.dot(vec2) > 0.0001) {\r\n      ret.load(vec1).add(vec2).normalize();\r\n    } else {\r\n      ret.load(vec1).normalize();\r\n    }\r\n\r\n    ret.mulScalar(width);\r\n\r\n    return ret;\r\n  } else { //XXX\r\n    //ret.load(vec).mulScalar(width);\r\n    //return ret;\r\n  }\r\n\r\n  vec1 = _tmps_cn.next().load(vec1).mulScalar(width);\r\n  vec2 = _tmps_cn.next().load(vec2).mulScalar(width);\r\n\r\n  let p1 = _tmps_cn.next().load(vec1);\r\n  let p2 = _tmps_cn.next().load(vec2);\r\n\r\n  vec1.addFac(vec1, 0.01);\r\n  vec2.addFac(vec2, 0.01);\r\n\r\n  let sc = 1.0;\r\n\r\n  p1[0] += vec1[1]*sc;\r\n  p1[1] += -vec1[0]*sc;\r\n\r\n  p2[0] += -vec2[1]*sc;\r\n  p2[1] += vec2[0]*sc;\r\n\r\n  let p = line_line_isect(vec1, p1, vec2, p2, false);\r\n\r\n  if (p === undefined || p === COLINEAR_ISECT || p.dot(p) < 0.000001) {\r\n    ret.load(vec1).add(vec2).normalize().mulScalar(width);\r\n  } else {\r\n    ret.load(p);\r\n\r\n    if (vec.dot(vec) > 0 && vec.dot(ret) < 0) {\r\n      ret.load(vec).mulScalar(width);\r\n    }\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n//test_segment is optional, true\r\nexport function line_line_isect(v1, v2, v3, v4, test_segment = true) {\r\n  if (test_segment && !line_line_cross(v1, v2, v3, v4)) {\r\n    return undefined;\r\n  }\r\n\r\n  /*\r\n  on factor;\r\n  off period;\r\n  \r\n  xa := xa1 + (xa2 - xa1)*t1;\r\n  xb := xb1 + (xb2 - xb1)*t2;\r\n  ya := ya1 + (ya2 - ya1)*t1;\r\n  yb := yb1 + (yb2 - yb1)*t2;\r\n  \r\n  f1 := xa - xb;\r\n  f2 := ya - yb;\r\n  \r\n  f := solve({f1, f2}, {t1, t2});\r\n  ft1 := part(f, 1, 1, 2);\r\n  ft2 := part(f, 1, 2, 2);\r\n  \r\n  */\r\n\r\n  let xa1 = v1[0], xa2 = v2[0], ya1 = v1[1], ya2 = v2[1];\r\n  let xb1 = v3[0], xb2 = v4[0], yb1 = v3[1], yb2 = v4[1];\r\n\r\n  let div = ((xa1 - xa2)*(yb1 - yb2) - (xb1 - xb2)*(ya1 - ya2));\r\n  if (Math.abs(div) < 0.00000001) { //parallel but intersecting lines.\r\n    return COLINEAR_ISECT;\r\n  } else { //intersection exists\r\n    let t1 = (-((ya1 - yb2)*xb1 - (yb1 - yb2)*xa1 - (ya1 - yb1)*xb2))/div;\r\n\r\n    return lli_v1.load(v1).interp(v2, t1);\r\n  }\r\n}\r\n\r\nexport function line_line_cross(a, b, c, d) {\r\n  /*\r\n  let limit=feps*1000;\r\n  if (Math.abs(l1[0].vectorDistance(l2[0])+l1[1].vectorDistance(l2[0])-l1[0].vectorDistance(l1[1]))<limit) {\r\n      return true;\r\n  }\r\n  if (Math.abs(l1[0].vectorDistance(l2[1])+l1[1].vectorDistance(l2[1])-l1[0].vectorDistance(l1[1]))<limit) {\r\n      return true;\r\n  }\r\n  if (Math.abs(l2[0].vectorDistance(l1[0])+l2[1].vectorDistance(l1[0])-l2[0].vectorDistance(l2[1]))<limit) {\r\n      return true;\r\n  }\r\n  if (Math.abs(l2[0].vectorDistance(l1[1])+l2[1].vectorDistance(l1[1])-l2[0].vectorDistance(l2[1]))<limit) {\r\n      return true;\r\n  }\r\n  //*/\r\n\r\n  let w1 = winding(a, b, c);\r\n  let w2 = winding(c, a, d);\r\n  let w3 = winding(a, b, d);\r\n  let w4 = winding(c, b, d);\r\n  return (w1 === w2) && (w3 === w4) && (w1 !== w3);\r\n};\r\n\r\nlet _asi_v1 = new Vector3();\r\nlet _asi_v2 = new Vector3();\r\nlet _asi_v3 = new Vector3();\r\nlet _asi_v4 = new Vector3();\r\nlet _asi_v5 = new Vector3();\r\nlet _asi_v6 = new Vector3();\r\n\r\nexport function point_in_aabb_2d(p, min, max) {\r\n  return p[0] >= min[0] && p[0] <= max[0] && p[1] >= min[1] && p[1] <= max[1];\r\n}\r\n\r\nlet _asi2d_v1 = new Vector2();\r\nlet _asi2d_v2 = new Vector2();\r\nlet _asi2d_v3 = new Vector2();\r\nlet _asi2d_v4 = new Vector2();\r\nlet _asi2d_v5 = new Vector2();\r\nlet _asi2d_v6 = new Vector2();\r\n\r\nexport function aabb_sphere_isect_2d(p, r, min, max) {\r\n  let v1 = _asi2d_v1, v2 = _asi2d_v2, v3 = _asi2d_v3, mvec = _asi2d_v4;\r\n  let v4 = _asi2d_v5;\r\n\r\n  p = _asi2d_v6.load(p);\r\n  v1.load(p);\r\n  v2.load(p);\r\n\r\n  min = _asi_v5.load(min);\r\n  max = _asi_v6.load(max);\r\n\r\n  mvec.load(max).sub(min).normalize().mulScalar(r + 0.0001);\r\n\r\n  v1.sub(mvec);\r\n  v2.add(mvec);\r\n  v3.load(p);\r\n\r\n  let ret = point_in_aabb_2d(v1, min, max) || point_in_aabb_2d(v2, min, max)\r\n    || point_in_aabb_2d(v3, min, max);\r\n\r\n  if (ret)\r\n    return ret;\r\n\r\n  /*\r\n  v1.load(min).add(max).mulScalar(0.5);\r\n  ret = ret || v1.vectorDistance(p) < r;\r\n  \r\n  v1.load(min);\r\n  ret = ret || v1.vectorDistance(p) < r;\r\n  \r\n  v1.load(max);\r\n  ret = ret || v1.vectorDistance(p) < r;\r\n  \r\n  v1[0] = min[0], v1[1] = max[1];\r\n  ret = ret || v1.vectorDistance(p) < r;\r\n  \r\n  v1[0] = max[0], v1[1] = min[1];\r\n  ret = ret || v1.vectorDistance(p) < r;\r\n  */\r\n  //*\r\n  v1.load(min);\r\n  v2[0] = min[0];\r\n  v2[1] = max[1];\r\n  ret = ret || dist_to_line_2d(p, v1, v2) < r;\r\n\r\n  v1.load(max);\r\n  v2[0] = max[0];\r\n  v2[1] = max[1];\r\n  ret = ret || dist_to_line_2d(p, v1, v2) < r;\r\n\r\n  v1.load(max);\r\n  v2[0] = max[0];\r\n  v2[1] = min[1];\r\n  ret = ret || dist_to_line_2d(p, v1, v2) < r;\r\n\r\n  v1.load(max);\r\n  v2[0] = min[0];\r\n  v2[1] = min[1];\r\n  ret = ret || dist_to_line_2d(p, v1, v2) < r;\r\n  //*/\r\n  return ret;\r\n};\r\n\r\nexport function point_in_aabb(p, min, max) {\r\n  return p[0] >= min[0] && p[0] <= max[0] && p[1] >= min[1] && p[1] <= max[1]\r\n    && p[2] >= min[2] && p[2] <= max[2];\r\n}\r\n\r\nlet asi_rect = new Array(8);\r\nfor (let i = 0; i < 8; i++) {\r\n  asi_rect[i] = new Vector3();\r\n}\r\n\r\nlet aabb_sphere_isect_vs = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport function aabb_sphere_isect(p, r, min, max) {\r\n  {\r\n    let p1 = aabb_sphere_isect_vs.next().load(p);\r\n    let min1 = aabb_sphere_isect_vs.next().load(min);\r\n    let max1 = aabb_sphere_isect_vs.next().load(max);\r\n    if (p.length === 2) {\r\n      p1[2] = 0.0;\r\n    }\r\n    if (min1.length === 2) {\r\n      min1[2] = 0.0;\r\n    }\r\n    if (max.length === 2) {\r\n      max1[2] = 0.0;\r\n    }\r\n\r\n    p = p1;\r\n    min = min1;\r\n    max = max1;\r\n  }\r\n\r\n  let cent = aabb_sphere_isect_vs.next().load(min).interp(max, 0.5);\r\n  p.sub(cent);\r\n  min.sub(cent);\r\n  max.sub(cent);\r\n\r\n  r *= r;\r\n\r\n  let isect = point_in_aabb(p, min, max);\r\n\r\n  if (isect) {\r\n    return true;\r\n  }\r\n\r\n  let rect = asi_rect;\r\n\r\n  rect[0].loadXYZ(min[0], min[1], min[2]);\r\n  rect[1].loadXYZ(min[0], max[1], min[2]);\r\n  rect[2].loadXYZ(max[0], max[1], min[2]);\r\n  rect[3].loadXYZ(max[0], min[1], min[2]);\r\n\r\n  rect[4].loadXYZ(min[0], min[1], max[2]);\r\n  rect[5].loadXYZ(min[0], max[1], max[2]);\r\n  rect[6].loadXYZ(max[0], max[1], max[2]);\r\n  rect[7].loadXYZ(max[0], min[1], max[2]);\r\n\r\n  for (let i = 0; i < 8; i++) {\r\n    if (p.vectorDistanceSqr(rect[i]) < r) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  let p2 = aabb_sphere_isect_vs.next().load(p);\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    p2.load(p);\r\n\r\n    let i2 = (i + 1)%3;\r\n    let i3 = (i + 2)%3;\r\n\r\n    p2[i] = p2[i] < 0.0 ? min[i] : max[i];\r\n\r\n    p2[i2] = Math.min(Math.max(p2[i2], min[i2]), max[i2]);\r\n    p2[i3] = Math.min(Math.max(p2[i3], min[i3]), max[i3]);\r\n\r\n    let isect = p2.vectorDistanceSqr(p) <= r;\r\n\r\n    if (isect) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n};\r\n\r\nexport function aabb_sphere_dist(p, min, max) {\r\n  {\r\n    let p1 = aabb_sphere_isect_vs.next().load(p);\r\n    let min1 = aabb_sphere_isect_vs.next().load(min);\r\n    let max1 = aabb_sphere_isect_vs.next().load(max);\r\n    if (p.length === 2) {\r\n      p1[2] = 0.0;\r\n    }\r\n    if (min1.length === 2) {\r\n      min1[2] = 0.0;\r\n    }\r\n    if (max.length === 2) {\r\n      max1[2] = 0.0;\r\n    }\r\n\r\n    p = p1;\r\n    min = min1;\r\n    max = max1;\r\n  }\r\n\r\n  let cent = aabb_sphere_isect_vs.next().load(min).interp(max, 0.5);\r\n  p.sub(cent);\r\n  min.sub(cent);\r\n  max.sub(cent);\r\n\r\n  let isect = point_in_aabb(p, min, max);\r\n\r\n  if (isect) {\r\n    return 0.0;\r\n  }\r\n\r\n  let rect = asi_rect;\r\n\r\n  rect[0].loadXYZ(min[0], min[1], min[2]);\r\n  rect[1].loadXYZ(min[0], max[1], min[2]);\r\n  rect[2].loadXYZ(max[0], max[1], min[2]);\r\n  rect[3].loadXYZ(max[0], min[1], min[2]);\r\n\r\n  rect[4].loadXYZ(min[0], min[1], max[2]);\r\n  rect[5].loadXYZ(min[0], max[1], max[2]);\r\n  rect[6].loadXYZ(max[0], max[1], max[2]);\r\n  rect[7].loadXYZ(max[0], min[1], max[2]);\r\n\r\n  let mindis;\r\n\r\n  for (let i = 0; i < 8; i++) {\r\n    let dis = p.vectorDistanceSqr(rect[i]);\r\n\r\n    if (mindis === undefined || dis < mindis) {\r\n      mindis = dis;\r\n    }\r\n  }\r\n\r\n  let p2 = aabb_sphere_isect_vs.next().load(p);\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    p2.load(p);\r\n\r\n    let i2 = (i + 1)%3;\r\n    let i3 = (i + 2)%3;\r\n\r\n    p2[i] = p2[i] < 0.0 ? min[i] : max[i];\r\n\r\n    p2[i2] = Math.min(Math.max(p2[i2], min[i2]), max[i2]);\r\n    p2[i3] = Math.min(Math.max(p2[i3], min[i3]), max[i3]);\r\n\r\n    let dis = p2.vectorDistanceSqr(p);\r\n    if (mindis === undefined || dis < mindis) {\r\n      mindis = dis;\r\n    }\r\n  }\r\n\r\n  return mindis === undefined ? 1e17 : mindis;\r\n};\r\n\r\nexport function point_in_tri(p, v1, v2, v3) {\r\n  let w1 = winding(p, v1, v2);\r\n  let w2 = winding(p, v2, v3);\r\n  let w3 = winding(p, v3, v1);\r\n  return w1 === w2 && w2 === w3;\r\n};\r\n\r\nexport function convex_quad(v1, v2, v3, v4) {\r\n  return line_line_cross([v1, v3], [v2, v4]);\r\n};\r\n\r\nlet $e1_normal_tri = new Vector3();\r\nlet $e3_normal_tri = new Vector3();\r\nlet $e2_normal_tri = new Vector3();\r\n\r\nexport function isNum(f) {\r\n  let ok = typeof f === \"number\";\r\n\r\n  ok = ok && !isNaN(f) && isFinite(f);\r\n\r\n  return ok;\r\n}\r\n\r\nconst _normal_tri_rets = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport function normal_tri(v1, v2, v3) {\r\n  let x1 = v2[0] - v1[0];\r\n  let y1 = v2[1] - v1[1];\r\n  let z1 = v2[2] - v1[2];\r\n  let x2 = v3[0] - v1[0];\r\n  let y2 = v3[1] - v1[1];\r\n  let z2 = v3[2] - v1[2];\r\n\r\n  if (!isNum(x1 + y1 + z1 + z2 + y2 + z2)) {\r\n    throw new Error(\"NaN in normal_tri\");\r\n  }\r\n\r\n  let x3, y3, z3;\r\n\r\n  x1 = v2[0] - v1[0];\r\n  y1 = v2[1] - v1[1];\r\n  z1 = v2[2] - v1[2];\r\n  x2 = v3[0] - v1[0];\r\n  y2 = v3[1] - v1[1];\r\n  z2 = v3[2] - v1[2];\r\n  x3 = y1*z2 - z1*y2;\r\n  y3 = z1*x2 - x1*z2;\r\n  z3 = x1*y2 - y1*x2;\r\n\r\n  let len = Math.sqrt((x3*x3 + y3*y3 + z3*z3));\r\n\r\n  if (len > 1e-05)\r\n    len = 1.0/len;\r\n\r\n  x3 *= len;\r\n  y3 *= len;\r\n  z3 *= len;\r\n\r\n  let n = _normal_tri_rets.next();\r\n\r\n  if (!isNum(x3 + y3 + z3)) {\r\n    throw new Error(\"NaN!\");\r\n  }\r\n\r\n  n[0] = x3;\r\n  n[1] = y3;\r\n  n[2] = z3;\r\n\r\n  return n;\r\n};\r\n\r\nlet $n2_normal_quad = new Vector3();\r\n\r\nlet _q1 = new Vector3(), _q2 = new Vector3(), _q3 = new Vector3();\r\n\r\nexport function normal_quad(v1, v2, v3, v4) {\r\n  _q1.load(normal_tri(v1, v2, v3));\r\n  _q2.load(normal_tri(v2, v3, v4));\r\n\r\n  _q1.add(_q2).normalize();\r\n  return _q1;\r\n}\r\n\r\nexport function normal_quad_old(v1, v2, v3, v4) {\r\n  let n = normal_tri(v1, v2, v3);\r\n  $n2_normal_quad[0] = n[0];\r\n  $n2_normal_quad[1] = n[1];\r\n  $n2_normal_quad[2] = n[2];\r\n  n = normal_tri(v1, v3, v4);\r\n  $n2_normal_quad[0] = $n2_normal_quad[0] + n[0];\r\n  $n2_normal_quad[1] = $n2_normal_quad[1] + n[1];\r\n  $n2_normal_quad[2] = $n2_normal_quad[2] + n[2];\r\n  let _len = Math.sqrt(($n2_normal_quad[0]*$n2_normal_quad[0] + $n2_normal_quad[1]*$n2_normal_quad[1] + $n2_normal_quad[2]*$n2_normal_quad[2]));\r\n  if (_len > 1e-05)\r\n    _len = 1.0/_len;\r\n  $n2_normal_quad[0] *= _len;\r\n  $n2_normal_quad[1] *= _len;\r\n  $n2_normal_quad[2] *= _len;\r\n  return $n2_normal_quad;\r\n};\r\n\r\nlet _li_vi = new Vector3();\r\n\r\n//calc_t is optional, false\r\nexport function line_isect(v1, v2, v3, v4, calc_t) {\r\n  if (calc_t === undefined) {\r\n    calc_t = false;\r\n  }\r\n  let div = (v2[0] - v1[0])*(v4[1] - v3[1]) - (v2[1] - v1[1])*(v4[0] - v3[0]);\r\n  if (div === 0.0)\r\n    return [new Vector3(), COLINEAR, 0.0];\r\n  let vi = _li_vi;\r\n  vi[0] = 0;\r\n  vi[1] = 0;\r\n  vi[2] = 0;\r\n  vi[0] = ((v3[0] - v4[0])*(v1[0]*v2[1] - v1[1]*v2[0]) - (v1[0] - v2[0])*(v3[0]*v4[1] - v3[1]*v4[0]))/div;\r\n  vi[1] = ((v3[1] - v4[1])*(v1[0]*v2[1] - v1[1]*v2[0]) - (v1[1] - v2[1])*(v3[0]*v4[1] - v3[1]*v4[0]))/div;\r\n  if (calc_t || v1.length === 3) {\r\n    let n1 = new Vector2(v2).sub(v1);\r\n    let n2 = new Vector2(vi).sub(v1);\r\n    let t = n2.vectorLength()/n1.vectorLength();\r\n    n1.normalize();\r\n    n2.normalize();\r\n    if (n1.dot(n2) < 0.0) {\r\n      t = -t;\r\n    }\r\n    if (v1.length === 3) {\r\n      vi[2] = v1[2] + (v2[2] - v1[2])*t;\r\n    }\r\n    return [vi, LINECROSS, t];\r\n  }\r\n  return [vi, LINECROSS];\r\n};\r\n\r\nlet dt2l_v1 = new Vector2();\r\nlet dt2l_v2 = new Vector2();\r\nlet dt2l_v3 = new Vector2();\r\nlet dt2l_v4 = new Vector2();\r\nlet dt2l_v5 = new Vector2();\r\n\r\nexport function dist_to_line_2d(p, v1, v2, clip = true, closest_co_out = undefined, t_out = undefined) {\r\n  v1 = dt2l_v4.load(v1);\r\n  v2 = dt2l_v5.load(v2);\r\n\r\n  let n = dt2l_v1;\r\n  let vec = dt2l_v3;\r\n\r\n  n.load(v2).sub(v1).normalize();\r\n  vec.load(p).sub(v1);\r\n\r\n  let t = vec.dot(n);\r\n  if (clip) {\r\n    t = Math.min(Math.max(t, 0.0), v1.vectorDistance(v2));\r\n  }\r\n\r\n  n.mulScalar(t).add(v1);\r\n\r\n  if (closest_co_out) {\r\n    closest_co_out[0] = n[0];\r\n    closest_co_out[1] = n[1];\r\n  }\r\n\r\n  if (t_out !== undefined) {\r\n    t_out = t;\r\n  }\r\n\r\n  return n.vectorDistance(p);\r\n}\r\n\r\nlet dt3l_v1 = new Vector3();\r\nlet dt3l_v2 = new Vector3();\r\nlet dt3l_v3 = new Vector3();\r\nlet dt3l_v4 = new Vector3();\r\nlet dt3l_v5 = new Vector3();\r\n\r\nexport function dist_to_line_sqr(p, v1, v2, clip = true) {\r\n  let px = p[0] - v1[0];\r\n  let py = p[1] - v1[1];\r\n  let pz = p.length < 3 ? 0.0 : p[2] - v1[2];\r\n\r\n  pz = pz === undefined ? 0.0 : pz;\r\n\r\n  let v2x = v2[0] - v1[0];\r\n  let v2y = v2[1] - v1[1];\r\n  let v2z = v2.length < 3 ? 0.0 : v2[2] - v1[2];\r\n\r\n  let len = v2x*v2x + v2y*v2y + v2z*v2z;\r\n\r\n  if (len === 0.0) {\r\n    return Math.sqrt(px*px + py*py + pz*pz);\r\n  }\r\n\r\n  let len2 = 1.0/len;\r\n  v2x *= len2;\r\n  v2y *= len2;\r\n  v2z *= len2;\r\n\r\n  let t = px*v2x + py*v2y + pz*v2z;\r\n  if (clip) {\r\n    t = Math.min(Math.max(t, 0.0), len);\r\n  }\r\n\r\n  v2x *= t;\r\n  v2y *= t;\r\n  v2z *= t;\r\n\r\n  return (v2x - px)*(v2x - px) + (v2y - py)*(v2y - py) + (v2z - pz)*(v2z - pz);\r\n}\r\n\r\nexport function dist_to_line(p, v1, v2, clip = true) {\r\n  return Math.sqrt(dist_to_line_sqr(p, v1, v2, clip));\r\n}\r\n\r\n//p cam be 2d, 3d, or 4d point, v1/v2 however must be full homogenous coordinates\r\nlet _cplw_vs4 = util.cachering.fromConstructor(Vector4, 64);\r\nlet _cplw_vs3 = util.cachering.fromConstructor(Vector3, 64);\r\nlet _cplw_vs2 = util.cachering.fromConstructor(Vector2, 64);\r\n\r\nfunction wclip(x1, x2, w1, w2, near) {\r\n  let r1 = near*w1 - x1;\r\n  let r2 = (w1 - w2)*near - (x1 - x2);\r\n\r\n  if (r2 === 0.0) return 0.0;\r\n\r\n  return r1/r2;\r\n}\r\n\r\nfunction clip(a, b, znear) {\r\n  if (a - b === 0.0) return 0.0;\r\n\r\n  return (a - znear)/(a - b);\r\n}\r\n\r\n/*clips v1 and v2 to lie within homogenous projection range\r\n  v1 and v2 are assumed to be projected, pre-division Vector4's\r\n  returns a positive number (how much the line was scaled) if either _v1 or _v2 are\r\n  in front of the near clipping plane otherwise, returns 0\r\n */\r\nexport function clip_line_w(_v1, _v2, znear, zfar) {\r\n  let v1 = _cplw_vs4.next().load(_v1);\r\n  let v2 = _cplw_vs4.next().load(_v2);\r\n\r\n  //are we fully behind the view plane?\r\n  if ((v1[2] < 1.0 && v2[2] < 1.0))\r\n    return false;\r\n\r\n  function doclip1(v1, v2, axis) {\r\n    if (v1[axis]/v1[3] < -1) {\r\n      let t = wclip(v1[axis], v2[axis], v1[3], v2[3], -1);\r\n      v1.interp(v2, t);\r\n    } else if (v1[axis]/v1[3] > 1) {\r\n      let t = wclip(v1[axis], v2[axis], v1[3], v2[3], 1);\r\n      v1.interp(v2, t);\r\n    }\r\n  }\r\n\r\n  function doclip(v1, v2, axis) {\r\n    doclip1(v1, v2, axis);\r\n    doclip1(v2, v1, axis);\r\n  }\r\n\r\n  function dozclip(v1, v2) {\r\n    if (v1[2] < 1) {\r\n      let t = clip(v1[2], v2[2], 1);\r\n      v1.interp(v2, t);\r\n    } else if (v2[2] < 1) {\r\n      let t = clip(v2[2], v1[2], 1);\r\n      v2.interp(v1, t);\r\n    }\r\n  }\r\n\r\n  dozclip(v1, v2, 1);\r\n  doclip(v1, v2, 0);\r\n  doclip(v1, v2, 1);\r\n\r\n  for (let i = 0; i < 4; i++) {\r\n    _v1[i] = v1[i];\r\n    _v2[i] = v2[i];\r\n  }\r\n\r\n  return !(v1[0]/v1[3] === v2[0]/v2[3] || v1[1]/v2[3] === v2[1]/v2[3]);\r\n};\r\n\r\n//clip is optional, true.  clip point to lie within line segment v1->v2\r\nlet _closest_point_on_line_cache = util.cachering.fromConstructor(Vector3, 64);\r\nlet _closest_point_rets = new util.cachering(function () {\r\n  return [0, 0];\r\n}, 64);\r\n\r\nlet _closest_tmps = [new Vector3(), new Vector3(), new Vector3()];\r\n\r\nexport function closest_point_on_line(p, v1, v2, clip = true) {\r\n  let l1 = _closest_tmps[0], l2 = _closest_tmps[1];\r\n  let len;\r\n\r\n\r\n  l1.load(v2).sub(v1);\r\n\r\n  if (clip) {\r\n    len = l1.vectorLength();\r\n  }\r\n\r\n  l1.normalize();\r\n  l2.load(p).sub(v1);\r\n\r\n  let t = l2.dot(l1);\r\n  if (clip) {\r\n    //t = t*(t<0.0) + t*(t>1.0) + (t>1.0);\r\n    t = t < 0.0 ? 0.0 : t;\r\n    t = t > len ? len : t;\r\n  }\r\n\r\n  let co = _closest_point_on_line_cache.next();\r\n  co.load(l1).mulScalar(t).add(v1);\r\n  let ret = _closest_point_rets.next();\r\n\r\n  ret[0] = co;\r\n  ret[1] = t;\r\n\r\n  return ret;\r\n}\r\n\r\n/*given input line (a,d) and tangent t,\r\n  returns a circle that goes through both\r\n  a and d, whose normalized tangent at a is the same\r\n  as normalized t.\r\n  \r\n  note that t need not be normalized, this function\r\n  does that itself*/\r\nlet _circ_from_line_tan_vs = util.cachering.fromConstructor(Vector3, 32);\r\nlet _circ_from_line_tan_ret = new util.cachering(function () {\r\n  return [new Vector3(), 0];\r\n}, 64);\r\n\r\nexport function circ_from_line_tan(a, b, t) {\r\n  let p1 = _circ_from_line_tan_vs.next();\r\n  let t2 = _circ_from_line_tan_vs.next();\r\n  let n1 = _circ_from_line_tan_vs.next();\r\n\r\n  p1.load(a).sub(b);\r\n  t2.load(t).normalize();\r\n  n1.load(p1).normalize().cross(t2).cross(t2).normalize();\r\n\r\n  let ax = p1[0], ay = p1[1], az = p1[2], nx = n1[0], ny = n1[1], nz = n1[2];\r\n  let r = -(ax*ax + ay*ay + az*az);\r\n  let div = (2*(ax*nx + ay*ny + az*nz));\r\n\r\n  if (Math.abs(div) > 0.000001) {\r\n    r /= div;\r\n  } else {\r\n    r = 1000000.0;\r\n  }\r\n\r\n  let ret = _circ_from_line_tan_ret.next();\r\n  ret[0].load(n1).mulScalar(r).add(a)\r\n  ret[1] = r;\r\n\r\n  return ret;\r\n}\r\n\r\n/*given input line (a,d) and tangent t,\r\n  returns a circle that goes through both\r\n  a and d, whose normalized tangent at a is the same\r\n  as normalized t.\r\n\r\n  note that t need not be normalized, this function\r\n  does that itself*/\r\nlet _circ_from_line_tan2d_vs = util.cachering.fromConstructor(Vector3, 32);\r\nlet _circ_from_line_tan2d_ret = new util.cachering(function () {\r\n  return [new Vector2(), 0];\r\n}, 64);\r\n\r\nexport function circ_from_line_tan_2d(a, b, t) {\r\n  a = _circ_from_line_tan2d_vs.next().load(a);\r\n  b = _circ_from_line_tan2d_vs.next().load(b);\r\n  t = _circ_from_line_tan2d_vs.next().load(t);\r\n\r\n  a[2] = b[2] = t[2] = 0.0;\r\n\r\n  let p1 = _circ_from_line_tan2d_vs.next();\r\n  let t2 = _circ_from_line_tan2d_vs.next();\r\n  let n1 = _circ_from_line_tan2d_vs.next();\r\n\r\n  p1.load(a).sub(b);\r\n  t2.load(t).normalize();\r\n  n1.load(p1).normalize().cross(t2).cross(t2).normalize();\r\n\r\n  if (1) {\r\n    let cx, cy, r;\r\n    let x1 = a[0], y1 = a[1];\r\n    let x2 = b[0], y2 = b[1];\r\n    let tanx1 = t[0], tany1 = t[1];\r\n\r\n    let div = (4.0*((x1 - x2)*tany1 - (y1 - y2)*tanx1)**2);\r\n    let div2 = (2.0*(x1 - x2)*tany1 - 2.0*(y1 - y2)*tanx1);\r\n\r\n    if (Math.abs(div) < 0.0001 || Math.abs(div2) < 0.0001) {\r\n      let ret = _circ_from_line_tan2d_ret.next();\r\n\r\n      ret[0].load(a).interp(b, 0.5);\r\n      let dx = a[1] - b[1];\r\n      let dy = b[0] - a[0];\r\n\r\n      r = 1000000.0;\r\n\r\n      ret[0][0] += dx*r;\r\n      ret[0][1] += dy*r;\r\n      ret[1] = r;\r\n\r\n      return ret;\r\n    }\r\n    cx = (((x1 + x2)*(x1 - x2) - (y1 - y2)**2)*tany1 - 2.0*(y1 - y2)*tanx1*x1\r\n    )/div2;\r\n\r\n    cy = (-((y1 + y2)*(y1 - y2) - x2**2 - (x1 - 2.0*x2)*x1)*tanx1 + 2.0*(x1 -\r\n      x2)*tany1*y1)/div2;\r\n\r\n    r = (((y1 - y2)**2 + x2**2 + (x1 - 2.0*x2)*x1)**2*(tanx1**2 + tany1**2)\r\n    )/div;\r\n\r\n    let midx = a[0]*0.5 + b[0]*0.5;\r\n    let midy = a[1]*0.5 + b[1]*0.5;\r\n\r\n    //mirror\r\n    cx = 2.0*midx - cx;\r\n    cy = 2.0*midy - cy;\r\n\r\n    let ret = _circ_from_line_tan2d_ret.next();\r\n    ret[0].loadXY(cx, cy);\r\n    ret[1] = Math.sqrt(r);\r\n\r\n    return ret;\r\n  } else {\r\n    let ax = p1[0], ay = p1[1], az = p1[2], nx = n1[0], ny = n1[1], nz = n1[2];\r\n    let r = -(ax*ax + ay*ay + az*az);\r\n    let div = (2*(ax*nx + ay*ny + az*nz));\r\n\r\n    if (Math.abs(div) > 0.000001) {\r\n      r /= div;\r\n    } else {\r\n      r = 1000000.0;\r\n    }\r\n\r\n    let ret = _circ_from_line_tan2d_ret.next();\r\n    ret[0].load(n1).mulScalar(r).add(a)\r\n    ret[1] = r;\r\n\r\n    return ret;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nlet _gtc_e1 = new Vector3();\r\nlet _gtc_e2 = new Vector3();\r\nlet _gtc_e3 = new Vector3();\r\nlet _gtc_p1 = new Vector3();\r\nlet _gtc_p2 = new Vector3();\r\nlet _gtc_v1 = new Vector3();\r\nlet _gtc_v2 = new Vector3();\r\nlet _gtc_p12 = new Vector3();\r\nlet _gtc_p22 = new Vector3();\r\nlet _get_tri_circ_ret = new util.cachering(function () {\r\n  return [0, 0]\r\n});\r\n\r\nexport function get_tri_circ(a, b, c) {\r\n  let v1 = _gtc_v1;\r\n  let v2 = _gtc_v2;\r\n  let e1 = _gtc_e1;\r\n  let e2 = _gtc_e2;\r\n  let e3 = _gtc_e3;\r\n  let p1 = _gtc_p1;\r\n  let p2 = _gtc_p2;\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    e1[i] = b[i] - a[i];\r\n    e2[i] = c[i] - b[i];\r\n    e3[i] = a[i] - c[i];\r\n  }\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    p1[i] = (a[i] + b[i])*0.5;\r\n    p2[i] = (c[i] + b[i])*0.5;\r\n  }\r\n\r\n  e1.normalize();\r\n\r\n  v1[0] = -e1[1];\r\n  v1[1] = e1[0];\r\n  v1[2] = e1[2];\r\n\r\n  v2[0] = -e2[1];\r\n  v2[1] = e2[0];\r\n  v2[2] = e2[2];\r\n\r\n  v1.normalize();\r\n  v2.normalize();\r\n\r\n  let cent;\r\n  let type;\r\n  for (let i = 0; i < 3; i++) {\r\n    _gtc_p12[i] = p1[i] + v1[i];\r\n    _gtc_p22[i] = p2[i] + v2[i];\r\n  }\r\n\r\n  let isect = line_isect(p1, _gtc_p12, p2, _gtc_p22);\r\n  cent = isect[0];\r\n  type = isect[1];\r\n\r\n  e1.load(a);\r\n  e2.load(b);\r\n  e3.load(c);\r\n\r\n  let r = e1.sub(cent).vectorLength();\r\n  if (r < feps)\r\n    r = e2.sub(cent).vectorLength();\r\n  if (r < feps)\r\n    r = e3.sub(cent).vectorLength();\r\n\r\n  let ret = _get_tri_circ_ret.next();\r\n  ret[0] = cent;\r\n  ret[1] = r;\r\n\r\n  return ret;\r\n};\r\n\r\nexport function gen_circle(m, origin, r, stfeps) {\r\n  let pi = Math.PI;\r\n  let f = -pi/2;\r\n  let df = (pi*2)/stfeps;\r\n  let verts = new Array();\r\n  for (let i = 0; i < stfeps; i++) {\r\n    let x = origin[0] + r*Math.sin(f);\r\n    let y = origin[1] + r*Math.cos(f);\r\n    let v = m.make_vert(new Vector3([x, y, origin[2]]));\r\n    verts.push(v);\r\n    f += df;\r\n  }\r\n  for (let i = 0; i < verts.length; i++) {\r\n    let v1 = verts[i];\r\n    let v2 = verts[(i + 1)%verts.length];\r\n    m.make_edge(v1, v2);\r\n  }\r\n  return verts;\r\n};\r\n\r\nlet cos = Math.cos;\r\nlet sin = Math.sin;\r\n\r\n//axis is optional, 0\r\nexport function rot2d(v1, A, axis) {\r\n  let x = v1[0];\r\n  let y = v1[1];\r\n\r\n  if (axis === 1) {\r\n    v1[0] = x*cos(A) + y*sin(A);\r\n    v1[2] = y*cos(A) - x*sin(A);\r\n  } else {\r\n    v1[0] = x*cos(A) - y*sin(A);\r\n    v1[1] = y*cos(A) + x*sin(A);\r\n  }\r\n}\r\n\r\nexport function makeCircleMesh(gl, radius, stfeps) {\r\n  let mesh = new Mesh();\r\n  let verts1 = gen_circle(mesh, new Vector3(), radius, stfeps);\r\n  let verts2 = gen_circle(mesh, new Vector3(), radius/1.75, stfeps);\r\n  mesh.make_face_complex([verts1, verts2]);\r\n  return mesh;\r\n};\r\n\r\nexport function minmax_verts(verts) {\r\n  let min = new Vector3([1000000000000.0, 1000000000000.0, 1000000000000.0]);\r\n  let max = new Vector3([-1000000000000.0, -1000000000000.0, -1000000000000.0]);\r\n  let __iter_v = __get_iter(verts);\r\n  let v;\r\n  while (1) {\r\n    let __ival_v = __iter_v.next();\r\n    if (__ival_v.done) {\r\n      break;\r\n    }\r\n    v = __ival_v.value;\r\n    for (let i = 0; i < 3; i++) {\r\n      min[i] = Math.min(min[i], v.co[i]);\r\n      max[i] = Math.max(max[i], v.co[i]);\r\n    }\r\n  }\r\n  return [min, max];\r\n};\r\n\r\nexport function unproject(vec, ipers, iview) {\r\n  let newvec = new Vector3(vec);\r\n  newvec.multVecMatrix(ipers);\r\n  newvec.multVecMatrix(iview);\r\n  return newvec;\r\n};\r\n\r\nexport function project(vec, pers, view) {\r\n  let newvec = new Vector3(vec);\r\n  newvec.multVecMatrix(pers);\r\n  newvec.multVecMatrix(view);\r\n  return newvec;\r\n};\r\n\r\nlet _sh_minv = new Vector3();\r\nlet _sh_maxv = new Vector3();\r\nlet _sh_start = [];\r\nlet _sh_end = [];\r\n\r\nlet static_cent_gbw = new Vector3();\r\n\r\nexport function get_boundary_winding(points) {\r\n  let cent = static_cent_gbw.zero();\r\n  if (points.length === 0)\r\n    return false;\r\n  for (let i = 0; i < points.length; i++) {\r\n    cent.add(points[i]);\r\n  }\r\n  cent.divideScalar(points.length);\r\n  let w = 0, totw = 0;\r\n  for (let i = 0; i < points.length; i++) {\r\n    let v1 = points[i];\r\n    let v2 = points[(i + 1)%points.length];\r\n    if (!colinear(v1, v2, cent)) {\r\n      w += winding(v1, v2, cent);\r\n      totw += 1;\r\n    }\r\n  }\r\n  if (totw > 0)\r\n    w /= totw;\r\n  return Math.round(w) === 1;\r\n};\r\n\r\nexport class PlaneOps {\r\n  constructor(normal) {\r\n    let no = normal;\r\n    this.axis = [0, 0, 0];\r\n    this.reset_axis(normal);\r\n  }\r\n\r\n  reset_axis(no) {\r\n    let ax, ay, az;\r\n    let nx = Math.abs(no[0]), ny = Math.abs(no[1]), nz = Math.abs(no[2]);\r\n    if (nz > nx && nz > ny) {\r\n      ax = 0;\r\n      ay = 1;\r\n      az = 2;\r\n    } else if (nx > ny && nx > nz) {\r\n      ax = 2;\r\n      ay = 1;\r\n      az = 0;\r\n    } else {\r\n      ax = 0;\r\n      ay = 2;\r\n      az = 1;\r\n    }\r\n    this.axis = [ax, ay, az];\r\n  }\r\n\r\n  convex_quad(v1, v2, v3, v4) {\r\n    let ax = this.axis;\r\n    v1 = new Vector3([v1[ax[0]], v1[ax[1]], v1[ax[2]]]);\r\n    v2 = new Vector3([v2[ax[0]], v2[ax[1]], v2[ax[2]]]);\r\n    v3 = new Vector3([v3[ax[0]], v3[ax[1]], v3[ax[2]]]);\r\n    v4 = new Vector3([v4[ax[0]], v4[ax[1]], v4[ax[2]]]);\r\n    return convex_quad(v1, v2, v3, v4);\r\n  }\r\n\r\n  line_isect(v1, v2, v3, v4) {\r\n    let ax = this.axis;\r\n    let orig1 = v1, orig2 = v2;\r\n    v1 = new Vector3([v1[ax[0]], v1[ax[1]], v1[ax[2]]]);\r\n    v2 = new Vector3([v2[ax[0]], v2[ax[1]], v2[ax[2]]]);\r\n    v3 = new Vector3([v3[ax[0]], v3[ax[1]], v3[ax[2]]]);\r\n    v4 = new Vector3([v4[ax[0]], v4[ax[1]], v4[ax[2]]]);\r\n    let ret = line_isect(v1, v2, v3, v4, true);\r\n    let vi = ret[0];\r\n    if (ret[1] === LINECROSS) {\r\n      ret[0].load(orig2).sub(orig1).mulScalar(ret[2]).add(orig1);\r\n    }\r\n    return ret;\r\n  }\r\n\r\n  line_line_cross(l1, l2) {\r\n    let ax = this.axis;\r\n    let v1 = l1[0], v2 = l1[1], v3 = l2[0], v4 = l2[1];\r\n    v1 = new Vector3([v1[ax[0]], v1[ax[1]], 0.0]);\r\n    v2 = new Vector3([v2[ax[0]], v2[ax[1]], 0.0]);\r\n    v3 = new Vector3([v3[ax[0]], v3[ax[1]], 0.0]);\r\n    v4 = new Vector3([v4[ax[0]], v4[ax[1]], 0.0]);\r\n    return line_line_cross([v1, v2], [v3, v4]);\r\n  }\r\n\r\n  winding(v1, v2, v3) {\r\n    let ax = this.axis;\r\n    if (v1 === undefined)\r\n      console.trace();\r\n    v1 = new Vector3([v1[ax[0]], v1[ax[1]], 0.0]);\r\n    v2 = new Vector3([v2[ax[0]], v2[ax[1]], 0.0]);\r\n    v3 = new Vector3([v3[ax[0]], v3[ax[1]], 0.0]);\r\n    return winding(v1, v2, v3);\r\n  }\r\n\r\n  colinear(v1, v2, v3) {\r\n    let ax = this.axis;\r\n    v1 = new Vector3([v1[ax[0]], v1[ax[1]], 0.0]);\r\n    v2 = new Vector3([v2[ax[0]], v2[ax[1]], 0.0]);\r\n    v3 = new Vector3([v3[ax[0]], v3[ax[1]], 0.0]);\r\n    return colinear(v1, v2, v3);\r\n  }\r\n\r\n  get_boundary_winding(points) {\r\n    let ax = this.axis;\r\n    let cent = new Vector3();\r\n    if (points.length === 0)\r\n      return false;\r\n    for (let i = 0; i < points.length; i++) {\r\n      cent.add(points[i]);\r\n    }\r\n    cent.divideScalar(points.length);\r\n    let w = 0, totw = 0;\r\n    for (let i = 0; i < points.length; i++) {\r\n      let v1 = points[i];\r\n      let v2 = points[(i + 1)%points.length];\r\n      if (!this.colinear(v1, v2, cent)) {\r\n        w += this.winding(v1, v2, cent);\r\n        totw += 1;\r\n      }\r\n    }\r\n    if (totw > 0)\r\n      w /= totw;\r\n    return Math.round(w) === 1;\r\n  }\r\n}\r\n\r\n/*\r\non factor;\r\n\r\npx := rox + rnx*t;\r\npy := roy + rny*t;\r\npz := roz + rnz*t;\r\n\r\nf1 := (px-pox)*pnx + (py-poy)*pny + (pz-poz)*pnz;\r\nff := solve(f1, t);\r\non fort;\r\npart(ff, 1, 2);\r\noff fort;\r\n\r\n* */\r\nlet _isrp_ret = new Vector3();\r\nlet isect_ray_plane_rets = util.cachering.fromConstructor(Vector3, 256);\r\n\r\nexport function isect_ray_plane(planeorigin, planenormal, rayorigin, raynormal) {\r\n  let po = planeorigin, pn = planenormal, ro = rayorigin, rn = raynormal;\r\n\r\n  let div = (pn[1]*rn[1] + pn[2]*rn[2] + pn[0]*rn[0]);\r\n\r\n  if (Math.abs(div) < 0.000001) {\r\n    return undefined;\r\n  }\r\n\r\n  let t = ((po[1] - ro[1])*pn[1] + (po[2] - ro[2])*pn[2] + (po[0] - ro[0])*pn[0])/div;\r\n  _isrp_ret.load(ro).addFac(rn, t);\r\n\r\n  return isect_ray_plane_rets.next().load(_isrp_ret);\r\n}\r\n\r\nexport function _old_isect_ray_plane(planeorigin, planenormal, rayorigin, raynormal) {\r\n  let p = planeorigin, n = planenormal;\r\n  let r = rayorigin, v = raynormal;\r\n\r\n  let d = p.vectorLength();\r\n  let t = -(r.dot(n) - p.dot(n))/v.dot(n);\r\n  _isrp_ret.load(v);\r\n  _isrp_ret.mulScalar(t);\r\n  _isrp_ret.add(r);\r\n  return _isrp_ret;\r\n};\r\n\r\nexport class Mat4Stack {\r\n  constructor() {\r\n    this.stack = [];\r\n    this.matrix = new Matrix4();\r\n    this.matrix.makeIdentity();\r\n    this.update_func = undefined;\r\n  }\r\n\r\n  set_internal_matrix(mat, update_func) {\r\n    this.update_func = update_func;\r\n    this.matrix = mat;\r\n  }\r\n\r\n  reset(mat) {\r\n    this.matrix.load(mat);\r\n    this.stack = [];\r\n    if (this.update_func !== undefined)\r\n      this.update_func();\r\n  }\r\n\r\n  load(mat) {\r\n    this.matrix.load(mat);\r\n    if (this.update_func !== undefined)\r\n      this.update_func();\r\n  }\r\n\r\n  multiply(mat) {\r\n    this.matrix.multiply(mat);\r\n    if (this.update_func !== undefined)\r\n      this.update_func();\r\n  }\r\n\r\n  identity() {\r\n    this.matrix.loadIdentity();\r\n    if (this.update_func !== undefined)\r\n      this.update_func();\r\n  }\r\n\r\n  push(mat2) {\r\n    this.stack.push(new Matrix4(this.matrix));\r\n    if (mat2 !== undefined) {\r\n      this.matrix.load(mat2);\r\n      if (this.update_func !== undefined)\r\n        this.update_func();\r\n    }\r\n  }\r\n\r\n  pop() {\r\n    let mat = this.stack.pop(this.stack.length - 1);\r\n    this.matrix.load(mat);\r\n    if (this.update_func !== undefined)\r\n      this.update_func();\r\n    return mat;\r\n  }\r\n}\r\n\r\n\r\n/*\r\n\r\non factor;\r\noff period;\r\n\r\nload_package \"avector\";\r\n\r\n\r\na1 := avec(a1x, a1y, a1z);\r\nb1 := avec(b1x, b1y, b1z);\r\nc1 := avec(c1x, c1y, c1z);\r\nd1 := avec(d1x, d1y, d1z);\r\n\r\na1x := 0;\r\na1y := 0;\r\na1z := 0;\r\n\r\na2 := avec(a2x, a2y, a2z);\r\nb2 := avec(b2x, b2y, b2z);\r\nc2 := avec(c2x, c2y, c2z);\r\nd2 := avec(d2x, d2y, d2z);\r\n\r\np1 := a1 + (b1 - a1) * v;\r\np2 := d1 + (c1 - d1) * v;\r\np3 := p1 + (p2 - p1) * u;\r\n\r\np4 := a2 + (b2 - a2) * v;\r\np5 := d2 + (c2 - d2) * v;\r\np6 := p4 + (p5 - p4) * u;\r\n\r\np7 := p3 + (p6 - p3) * w;\r\n\r\nf1 := p7[0] - goalx;\r\nf2 := p7[1] - goaly;\r\nf3 := p7[2] - goalz;\r\n\r\ncomment: solve({f1, f2, f3}, {u, v, w});\r\n\r\non fort;\r\np7;\r\noff fort;\r\n\r\nsub(u=0, v=1, w=0, p7[0]);\r\n\r\n*/\r\n\r\nconst tril_rets = util.cachering.fromConstructor(Vector3, 128);\r\n\r\nfunction lreport() {\r\n  //console.log(...arguments);\r\n}\r\n\r\nexport function trilinear_v3(uvw, boxverts) {\r\n  let [u, v, w] = uvw;\r\n\r\n  const a1x = boxverts[0][0], a1y = boxverts[0][1], a1z = boxverts[0][2];\r\n\r\n  const b1x = boxverts[1][0] - a1x, b1y = boxverts[1][1] - a1y, b1z = boxverts[1][2] - a1z;\r\n  const c1x = boxverts[2][0] - a1x, c1y = boxverts[2][1] - a1y, c1z = boxverts[2][2] - a1z;\r\n  const d1x = boxverts[3][0] - a1x, d1y = boxverts[3][1] - a1y, d1z = boxverts[3][2] - a1z;\r\n\r\n  const a2x = boxverts[4][0] - a1x, a2y = boxverts[4][1] - a1y, a2z = boxverts[4][2] - a1z;\r\n  const b2x = boxverts[5][0] - a1x, b2y = boxverts[5][1] - a1y, b2z = boxverts[5][2] - a1z;\r\n  const c2x = boxverts[6][0] - a1x, c2y = boxverts[6][1] - a1y, c2z = boxverts[6][2] - a1z;\r\n  const d2x = boxverts[7][0] - a1x, d2y = boxverts[7][1] - a1y, d2z = boxverts[7][2] - a1z;\r\n\r\n  const x = (((a2x - b2x)*v - a2x + (c2x - d2x)*v + d2x)*u - ((a2x - b2x)*v - a2x) - (\r\n      ((c1x - d1x)*v + d1x - b1x*v)*u + b1x*v))*w + ((c1x - d1x)*v + d1x - b1x*v)*u +\r\n    b1x*v;\r\n  const y = (((a2y - b2y)*v - a2y + (c2y - d2y)*v + d2y)*u - ((a2y - b2y)*v - a2y) - (\r\n      ((c1y - d1y)*v + d1y - b1y*v)*u + b1y*v))*w + ((c1y - d1y)*v + d1y - b1y*v)*u +\r\n    b1y*v;\r\n  const z = (((a2z - b2z)*v - a2z + (c2z - d2z)*v + d2z)*u - ((a2z - b2z)*v - a2z) - (\r\n      ((c1z - d1z)*v + d1z - b1z*v)*u + b1z*v))*w + ((c1z - d1z)*v + d1z - b1z*v)*u +\r\n    b1z*v;\r\n\r\n  let p = tril_rets.next();\r\n\r\n  p[0] = x + a1x;\r\n  p[1] = y + a1y;\r\n  p[2] = z + a1z;\r\n\r\n  return p;\r\n}\r\n\r\nlet tril_co_rets = util.cachering.fromConstructor(Vector3, 128);\r\nlet tril_co_tmps = util.cachering.fromConstructor(Vector3, 16);\r\nlet tril_mat_1 = new Matrix4();\r\nlet tril_mat_2 = new Matrix4();\r\n\r\nlet wtable = [\r\n  [\r\n    [0.5, 0.5, 0], //u triplet\r\n    [0.5, 0.5, 0], //v triplet\r\n    [0.5, 0.5, 0]  //w triplet\r\n  ],\r\n  [\r\n    [0.5, 0.5, 0],\r\n    [0.0, 0.5, 0.5],\r\n    [0.5, 0.5, 0]\r\n  ],\r\n  [\r\n    [0.0, 0.5, 0.5],\r\n    [0.0, 0.5, 0.5],\r\n    [0.5, 0.5, 0]\r\n  ],\r\n  [\r\n    [0.0, 0.5, 0.5],\r\n    [0.5, 0.5, 0],\r\n    [0.5, 0.5, 0]\r\n  ],\r\n];\r\n\r\nfor (let i = 0; i < 4; i++) {\r\n  let w = wtable[i];\r\n  w = [w[0], w[1], [0.0, 0.5, 0.5]];\r\n  wtable.push(w);\r\n}\r\n\r\nconst pih_tmps = util.cachering.fromConstructor(Vector3, 16);\r\nconst boxfaces_table = [\r\n  [0, 1, 2, 3],\r\n  [7, 6, 5, 4],\r\n  [0, 4, 5, 1],\r\n  [1, 5, 6, 2],\r\n  [2, 6, 7, 3],\r\n  [3, 7, 4, 0]\r\n];\r\n\r\nlet boxfaces_tmp = new Array(6);\r\nfor (let i = 0; i < 6; i++) {\r\n  boxfaces_tmp[i] = new Vector3();\r\n}\r\n\r\nlet boxfacenormals_tmp = new Array(6);\r\nfor (let i = 0; i < 6; i++) {\r\n  boxfacenormals_tmp[i] = new Vector3();\r\n}\r\n\r\nexport function point_in_hex(p, boxverts, boxfacecents = undefined, boxfacenormals = undefined) {\r\n  if (!boxfacecents) {\r\n    boxfacecents = boxfaces_tmp;\r\n\r\n    for (let i = 0; i < 6; i++) {\r\n      let [v1, v2, v3, v4] = boxfaces_table[i];\r\n      v1 = boxverts[v1];\r\n      v2 = boxverts[v2];\r\n      v3 = boxverts[v3];\r\n      v4 = boxverts[v4];\r\n\r\n      boxfacecents[i].load(v1).add(v2).add(v3).add(v4).mulScalar(0.25);\r\n    }\r\n  }\r\n\r\n  if (!boxfacenormals) {\r\n    boxfacenormals = boxfacenormals_tmp;\r\n    for (let i = 0; i < 6; i++) {\r\n      let [v1, v2, v3, v4] = boxfaces_table[i];\r\n      v1 = boxverts[v1];\r\n      v2 = boxverts[v2];\r\n      v3 = boxverts[v3];\r\n      v4 = boxverts[v4];\r\n\r\n      let n = normal_quad(v1, v2, v3, v4);\r\n      boxfacenormals[i].load(n).negate();\r\n    }\r\n  }\r\n\r\n  let t1 = pih_tmps.next();\r\n  let t2 = pih_tmps.next();\r\n\r\n  let cent = pih_tmps.next().zero();\r\n  for (let i = 0; i < 6; i++) {\r\n    cent.add(boxfacecents[i]);\r\n  }\r\n  cent.mulScalar(1.0/6.0);\r\n\r\n  let ret = true;\r\n\r\n  for (let i = 0; i < 6; i++) {\r\n    t1.load(p).sub(boxfacecents[i]);\r\n    t2.load(cent).sub(boxfacecents[i]);\r\n    let n = boxfacenormals[i];\r\n\r\n    if (1) {\r\n      t1.normalize();\r\n      t2.normalize();\r\n\r\n      //console.log(i, \"DOT\", n.dot(t1).toFixed(5), n, t1);\r\n    }\r\n\r\n    if (t1.dot(t2) < 0) {\r\n      //console.log(\"\\n\");\r\n      ret = false;\r\n      return false;\r\n    }\r\n  }\r\n\r\n  //console.log(\"\\n\");\r\n  return ret;\r\n  //return true;\r\n}\r\n\r\nconst boxverts_tmp = new Array(8);\r\nfor (let i = 0; i < 8; i++) {\r\n  boxverts_tmp[i] = new Vector3();\r\n}\r\n\r\nexport function trilinear_co(p, boxverts) {\r\n  let uvw = tril_co_rets.next();\r\n\r\n  uvw.zero();\r\n\r\n  let u = tril_co_tmps.next();\r\n  let v = tril_co_tmps.next();\r\n  let w = tril_co_tmps.next();\r\n\r\n  u.loadXYZ(0.0, 0.5, 1.0);\r\n  v.loadXYZ(0.0, 0.5, 1.0);\r\n  w.loadXYZ(0.0, 0.5, 1.0);\r\n\r\n  let uvw2 = tril_co_tmps.next();\r\n\r\n  for (let step = 0; step < 4; step++) {\r\n    uvw.loadXYZ(u[1], v[1], w[1]);\r\n\r\n    let mini = undefined;\r\n    let mindis = trilinear_v3(uvw, boxverts).vectorDistanceSqr(p);\r\n\r\n    for (let i = 0; i < 8; i++) {\r\n      let [t1, t2, t3] = wtable[i];\r\n\r\n      let u2 = t1[0]*u[0] + t1[1]*u[1] + t1[2]*u[2];\r\n      let v2 = t2[0]*v[0] + t2[1]*v[1] + t2[2]*v[2];\r\n      let w2 = t3[0]*w[0] + t3[1]*w[1] + t3[2]*w[2];\r\n\r\n      let du = Math.abs(u2 - u[1]);\r\n      let dv = Math.abs(v2 - v[1]);\r\n      let dw = Math.abs(w2 - w[1]);\r\n\r\n      uvw.loadXYZ(u2, v2, w2);\r\n      let dis = trilinear_v3(uvw, boxverts).vectorDistanceSqr(p);\r\n\r\n      if (mindis === undefined || dis < mindis) {\r\n        //mindis = dis;\r\n        //mini = i;\r\n      }\r\n\r\n      if (1) {\r\n        let bv = boxverts_tmp;\r\n\r\n        /*\r\n        let dd = 1.0 - 0.001;\r\n\r\n        du *= dd;\r\n        dv *= dd;\r\n        dw *= dd;\r\n        //*/\r\n\r\n        bv[0].loadXYZ(u2 - du, v2 - dv, w2 - dw);\r\n        bv[1].loadXYZ(u2 - du, v2 + dv, w2 - dw);\r\n        bv[2].loadXYZ(u2 + du, v2 + dv, w2 - dw);\r\n        bv[3].loadXYZ(u2 + du, v2 - dv, w2 - dw);\r\n\r\n        bv[4].loadXYZ(u2 - du, v2 - dv, w2 + dw);\r\n        bv[5].loadXYZ(u2 - du, v2 + dv, w2 + dw);\r\n        bv[6].loadXYZ(u2 + du, v2 + dv, w2 + dw);\r\n        bv[7].loadXYZ(u2 + du, v2 - dv, w2 + dw);\r\n\r\n        for (let j = 0; j < 8; j++) {\r\n          bv[j].load(trilinear_v3(bv[j], boxverts));\r\n        }\r\n\r\n        if (point_in_hex(p, bv)) {\r\n          mini = i;\r\n          mindis = dis;\r\n          //console.log(\"DIS\", (dis**0.5).toFixed(3));\r\n          break;\r\n        }\r\n\r\n        //console.log(\"\\n\");\r\n      }\r\n    }\r\n\r\n    if (mini === undefined) {\r\n      lreport(\"mindis:\", (mindis**0.5).toFixed(3));\r\n      break;\r\n    }\r\n\r\n    let [t1, t2, t3] = wtable[mini];\r\n\r\n    let u2 = t1[0]*u[0] + t1[1]*u[1] + t1[2]*u[2];\r\n    let v2 = t2[0]*v[0] + t2[1]*v[1] + t2[2]*v[2];\r\n    let w2 = t3[0]*w[0] + t3[1]*w[1] + t3[2]*w[2];\r\n\r\n    let du = Math.abs(u2 - u[1]);\r\n    let dv = Math.abs(v2 - v[1]);\r\n    let dw = Math.abs(w2 - w[1]);\r\n\r\n    u[0] = u2 - du;\r\n    v[0] = v2 - dv;\r\n    w[0] = w2 - dw;\r\n\r\n    u[1] = u2;\r\n    v[1] = v2;\r\n    w[1] = w2;\r\n\r\n    u[2] = u2 + du;\r\n    v[2] = v2 + dv;\r\n    w[2] = w2 + dw;\r\n\r\n    lreport(\"mindis:\", (mindis**0.5).toFixed(3), u2, v2, w2);\r\n  }\r\n\r\n  uvw.loadXYZ(u[1], v[1], w[1]);\r\n\r\n  //console.log(\"uvw\", uvw);\r\n\r\n  //return uvw;\r\n\r\n  return trilinear_co2(p, boxverts, uvw);\r\n}\r\n\r\n//newton-raphson\r\nexport function trilinear_co2(p, boxverts, uvw) {\r\n  //let uvw = tril_co_rets.next();\r\n  let grad = tril_co_tmps.next();\r\n\r\n  //uvw[0] = uvw[1] = uvw[2] = 0.5;\r\n\r\n  let df = 0.00001;\r\n\r\n  let mat = tril_mat_1;\r\n  let m = mat.$matrix;\r\n  let mat2 = tril_mat_2;\r\n\r\n  let r1 = tril_co_tmps.next();\r\n\r\n  for (let step = 0; step < 55; step++) {\r\n    //let r1 = trilinear_v3(uvw, boxverts).vectorDistance(p);\r\n    let totg = 0;\r\n\r\n    for (let i = 0; i < 3; i++) {\r\n      let axis_error = 0.0;\r\n\r\n      if (uvw[i] < 0) {\r\n        axis_error = -uvw[i];\r\n      } else if (uvw[i] > 1.0) {\r\n        axis_error = uvw[i] - 1.0;\r\n      }\r\n      //r1[i] = trilinear_v3(uvw, boxverts)[i] - p[i];\r\n      r1[i] = trilinear_v3(uvw, boxverts).vectorDistance(p) + 10.0*axis_error;\r\n\r\n      let orig = uvw[i];\r\n\r\n      uvw[i] += df;\r\n      //let r2 = trilinear_v3(uvw, boxverts)[i] - p[i];\r\n\r\n      if (uvw[i] < 0) {\r\n        axis_error = -uvw[i];\r\n      } else if (uvw[i] > 1.0) {\r\n        axis_error = uvw[i] - 1.0;\r\n      } else {\r\n        axis_error = 0.0;\r\n      }\r\n      let r2 = trilinear_v3(uvw, boxverts).vectorDistance(p) + 10.0*axis_error;\r\n      uvw[i] = orig;\r\n\r\n      grad[i] = (r2 - r1[i])/df;\r\n      totg += grad[i]**2;\r\n    }\r\n\r\n    if (totg === 0.0) {\r\n      break;\r\n    }\r\n\r\n    let err = trilinear_v3(uvw, boxverts).vectorDistance(p);\r\n\r\n    if (1) {\r\n      //grad.normalize();\r\n      uvw.addFac(grad, -err/totg*0.85);\r\n    } else {\r\n      mat.makeIdentity();\r\n      m.m11 = grad[0];\r\n      m.m12 = grad[1];\r\n      m.m13 = grad[2];\r\n      m.m22 = m.m33 = m.m44 = 0.0;\r\n\r\n      mat.transpose();\r\n      mat2.load(mat).transpose();\r\n\r\n      //right-indepdenent pseudo inverse\r\n      //mat.multiply(mat2).invert();\r\n      //mat.preMultiply(mat2);\r\n\r\n      //left-independent\r\n      mat.preMultiply(mat2).invert();\r\n      mat.multiply(mat2);\r\n\r\n      grad.load(r1);\r\n      grad.multVecMatrix(mat);\r\n      uvw.addFac(grad, -1.0);\r\n    }\r\n\r\n    lreport(\"error:\", err.toFixed(3), uvw);\r\n\r\n    if (r1.dot(r1)**0.5 < 0.0001) {\r\n      break;\r\n    }\r\n  }\r\n\r\n  lreport(\"\\n\");\r\n\r\n  return uvw;\r\n}\r\n\r\nlet angle_tri_v3_rets = util.cachering.fromConstructor(Vector3, 32);\r\nlet angle_tri_v3_vs = util.cachering.fromConstructor(Vector3, 32);\r\n\r\nexport function tri_angles(v1, v2, v3) {\r\n  let t1 = angle_tri_v3_vs.next().load(v1).sub(v2);\r\n  let t2 = angle_tri_v3_vs.next().load(v3).sub(v2);\r\n  let t3 = angle_tri_v3_vs.next().load(v2).sub(v3);\r\n\r\n  t1.normalize();\r\n  t2.normalize();\r\n  t3.normalize();\r\n\r\n  let th1 = Math.acos(t1.dot(t2)*0.99999);\r\n  t2.negate();\r\n\r\n  let th2 = Math.acos(t2.dot(t3)*0.99999);\r\n  let th3 = Math.PI - (th1 + th2);\r\n\r\n  let ret = angle_tri_v3_rets.next();\r\n\r\n  ret[0] = th1;\r\n  ret[1] = th2;\r\n  ret[2] = th3;\r\n\r\n  return ret;\r\n}\r\n\r\nlet angle_v2_temps = util.cachering.fromConstructor(Vector2, 32);\r\nlet angle_v3_temps = util.cachering.fromConstructor(Vector3, 32);\r\n\r\nexport function angle_between_vecs(v1, vcent, v2) {\r\n  let t1, t2;\r\n\r\n  if (v1.length === 2) {\r\n    t1 = angle_v2_temps.next();\r\n    t2 = angle_v2_temps.next();\r\n  } else {\r\n    t1 = angle_v3_temps.next();\r\n    t2 = angle_v3_temps.next();\r\n  }\r\n\r\n  t1.load(v1).sub(vcent).normalize();\r\n  t2.load(v2).sub(vcent).normalize();\r\n\r\n  let d = t1.dot(t2);\r\n\r\n  /* Handle numerical error. */\r\n  if (d < -1.0) {\r\n    return Math.PI;\r\n  } else if (d > 1.0) {\r\n    return 0.0;\r\n  } else {\r\n    return Math.acos(d);\r\n  }\r\n}\r\n","let _clipdata = {\r\n  name: \"nothing\",\r\n  mime: \"nothing\",\r\n  data: undefined\r\n};\r\n\r\nlet _clipboards = {};\r\n\r\nimport * as ctrlconfig from '../path-controller/config/config.js';\r\n\r\nif (typeof document !== 'undefined') {\r\n  /* spawn clipboard reader */\r\n  window.setInterval(() => {\r\n    if (!document.hasFocus()) {\r\n      return\r\n    }\r\n\r\n    let cb = navigator.clipboard;\r\n    if (!cb || !cb.read) {\r\n      return;\r\n    }\r\n\r\n    cb.read().then((data) => {\r\n      for (let item of data) {\r\n        for (let i = 0; i < item.types.length; i++) {\r\n          let type = item.types[i];\r\n\r\n          if (!(type in _clipboards)) {\r\n            _clipboards[type] = {\r\n              name: type,\r\n              mime: type,\r\n              data: undefined\r\n            };\r\n          }\r\n          ;\r\n\r\n          item.getType(type).then((blob) => new Response(blob).text()).then((text) => {\r\n            _clipboards[type].data = text;\r\n          });\r\n        }\r\n      }\r\n    }).catch(function () {\r\n    });\r\n  }, 200);\r\n}\r\n\r\nlet exports = {\r\n  /** Client code can override this using `.loadConstants`, this is\r\n   *  a simple implementation that just handles color data.\r\n   *\r\n   * `desiredMimes` is either a string, or an array of strings\r\n   */\r\n  getClipboardData(desiredMimes = \"text/plain\") {\r\n    if (typeof desiredMimes === \"string\") {\r\n      desiredMimes = [desiredMimes];\r\n    }\r\n\r\n    for (let m of desiredMimes) {\r\n      let cb = _clipboards[m];\r\n\r\n      if (cb && cb.data) {\r\n        return cb;\r\n      }\r\n    }\r\n  },\r\n\r\n\r\n  /** Client code can override this. This is a simple implementation\r\n   *  that just handles color data\r\n   */\r\n  setClipboardData(name, mime, data) {\r\n    _clipboards[mime] = {\r\n      name: name,\r\n      mime: mime,\r\n      data: data\r\n    };\r\n\r\n    let clipboard = navigator.clipboard;\r\n    if (!clipboard) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      clipboard.write([new ClipboardItem({\r\n        [mime]: new Blob([data], {type: mime})\r\n      })]).catch((error) => {\r\n        //try pushing through text/plain\r\n        if (mime.startsWith(\"text\") && mime !== \"text/plain\") {\r\n          this.setClipboardData(name, \"text/plain\", data);\r\n        } else {\r\n          console.error(error);\r\n        }\r\n      });\r\n    } catch (error) {\r\n      console.log(error.stack);\r\n      console.log(\"failed to write to system clipboard\");\r\n    }\r\n  },\r\n  colorSchemeType: \"light\",\r\n  docManualPath  : \"../simple_docsys/doc_build/\",\r\n  docEditorPath  : \"../simple_docsys.js\",\r\n\r\n  /* Add textboxes to rollar sliders,\r\n     note that  users can also double click them to\r\n     enter text as well\r\n   */\r\n  useNumSliderTextboxes: true,\r\n\r\n  numSliderArrowLimit: 15, /* Threshold to check if numslider arrow was clicked. */\r\n  simpleNumSliders   : false,\r\n\r\n  menusCanPopupAbove: false,\r\n  menu_close_time   : 500,\r\n  doubleClickTime   : 500,\r\n\r\n  /* Timeout for press-and-hold (touch) version of double clicking. */\r\n  doubleClickHoldTime: 750,\r\n  DEBUG              : {\r\n    paranoidEvents      : false,\r\n    screenborders       : false,\r\n    areaContextPushes   : false,\r\n    allBordersMovable   : false,\r\n    doOnce              : false,\r\n    modalEvents         : false,\r\n    areaConstraintSolver: false,\r\n    datapaths           : false,\r\n    lastToolPanel       : false,\r\n\r\n    domEvents        : false,\r\n    domEventAddRemove: false,\r\n\r\n    debugUIUpdatePerf: false, /* Turns async FrameManager.update_intern loop into sync. */\r\n\r\n    screenAreaPosSizeAccesses: false,\r\n    buttonEvents             : false,\r\n\r\n    /*\r\n    customWindowSize: {\r\n      width: 2048, height: 2048\r\n    },\r\n    //*/\r\n  },\r\n\r\n  /* Auto load 1d bspline templates, can hurt startup time. */\r\n  autoLoadSplineTemplates: true,\r\n\r\n  addHelpPickers: true,\r\n\r\n  useAreaTabSwitcher : false,\r\n  autoSizeUpdate     : true,\r\n  showPathsInToolTips: true,\r\n\r\n  enableThemeAutoUpdate: true,\r\n  useNativeToolTips    : true,\r\n  noElectronMenus      : false,\r\n\r\n  loadConstants: function (args) {\r\n    for (let k in args) {\r\n      if (k === \"loadConstants\")\r\n        continue;\r\n\r\n      this[k] = args[k];\r\n    }\r\n\r\n    ctrlconfig.setConfig(this);\r\n  }\r\n};\r\n\r\nexport default exports;\r\nwindow.DEBUG = exports.DEBUG;\r\n\r\nif (typeof document !== 'undefined') {\r\n  let cfg = document.getElementById(\"pathux-config\");\r\n  if (cfg) {\r\n    exports.loadConstants(JSON.parse(cfg.innerText));\r\n  }\r\n}\r\nif (typeof window?.PATHUX_CONFIG !== 'undefined') {\r\n  exports.loadConstants(window.PATHUX_CONFIG)\r\n}\r\n","/*\r\nTHEME REFACTOR:\r\n\r\n* Use CSS as much as possible\r\n* Create a compatibility layer\r\n\r\n*/\r\nimport * as util from \"../path-controller/util/util.js\";\r\nimport {Vector3, Vector4} from '../path-controller/util/vectormath.js';\r\nimport nstructjs from \"../path-controller/util/struct.js\";\r\nimport cconst from '../config/const.js';\r\n\r\nexport let compatMap = {\r\n  BoxMargin       : \"padding\",\r\n  BoxBG           : \"background\",\r\n  BoxRadius       : \"border-radius\",\r\n  background      : \"background-color\",\r\n  defaultWidth    : \"width\",\r\n  defaultHeight   : \"height\",\r\n  DefaultWidth    : \"width\",\r\n  DefaultHeight   : \"height\",\r\n  BoxBorder       : \"border-color\",\r\n  BoxLineWidth    : \"border-width\",\r\n  BoxSubBG        : \"background-color\",\r\n  BoxSub2BG       : \"background-color\",\r\n  DefaultPanelBG  : \"background-color\",\r\n  InnerPanelBG    : \"background-color\",\r\n  Background      : \"background-color\",\r\n  numslider_width : \"width\",\r\n  numslider_height: \"height\",\r\n};\r\n\r\nexport let ColorSchemeTypes = {\r\n  LIGHT: \"light\",\r\n  DARK : \"dark\"\r\n};\r\n\r\nexport function parsepx(css) {\r\n  return parseFloat(css.trim().replace(\"px\", \"\"))\r\n}\r\n\r\nexport function color2css(c, alpha_override) {\r\n  let r = ~~(c[0]*255);\r\n  let g = ~~(c[1]*255);\r\n  let b = ~~(c[2]*255);\r\n  let a = c.length < 4 ? 1.0 : c[3];\r\n\r\n  a = alpha_override !== undefined ? alpha_override : a;\r\n\r\n  if (c.length === 3 && alpha_override === undefined) {\r\n    return `rgb(${r},${g},${b})`;\r\n  } else {\r\n    return `rgba(${r},${g},${b}, ${a})`;\r\n  }\r\n}\r\n\r\nwindow.color2css = color2css;\r\n\r\nlet css2color_rets = util.cachering.fromConstructor(Vector4, 64);\r\nlet basic_colors = {\r\n  'white' : [1, 1, 1],\r\n  'grey'  : [0.5, 0.5, 0.5],\r\n  'gray'  : [0.5, 0.5, 0.5],\r\n  'black' : [0, 0, 0],\r\n  'red'   : [1, 0, 0],\r\n  'yellow': [1, 1, 0],\r\n  'green' : [0, 1, 0],\r\n  'teal'  : [0, 1, 1],\r\n  'cyan'  : [0, 1, 1],\r\n  'blue'  : [0, 0, 1],\r\n  'orange': [1, 0.5, 0.25],\r\n  'brown' : [0.5, 0.4, 0.3],\r\n  'purple': [1, 0, 1],\r\n  'pink'  : [1, 0.5, 0.5]\r\n};\r\n\r\nexport function color2web(color) {\r\n  function tostr(n) {\r\n    n = ~~(n*255);\r\n    let s = n.toString(16);\r\n\r\n    if (s.length > 2) {\r\n      s = s.slice(0, 2);\r\n    }\r\n\r\n    while (s.length < 2) {\r\n      s = \"0\" + s;\r\n    }\r\n\r\n    return s;\r\n  }\r\n\r\n  if (color.length === 3 || color[3] === 1.0) {\r\n    let r = tostr(color[0]);\r\n    let g = tostr(color[1]);\r\n    let b = tostr(color[2]);\r\n\r\n    return \"#\" + r + g + b;\r\n  } else {\r\n    let r = tostr(color[0]);\r\n    let g = tostr(color[1]);\r\n    let b = tostr(color[2]);\r\n    let a = tostr(color[3]);\r\n\r\n    return \"#\" + r + g + b + a;\r\n  }\r\n}\r\n\r\nwindow.color2web = color2web;\r\n\r\nexport function css2color(color) {\r\n  if (!color) {\r\n    return new Vector4([0, 0, 0, 1]);\r\n  }\r\n\r\n  color = (\"\" + color).trim();\r\n\r\n  let ret = css2color_rets.next();\r\n\r\n  if (color[0] === \"#\") {\r\n    color = color.slice(1, color.length);\r\n    let parts = [];\r\n\r\n    for (let i = 0; i < color.length>>1; i++) {\r\n      let part = \"0x\" + color.slice(i*2, i*2 + 2);\r\n      parts.push(parseInt(part));\r\n    }\r\n\r\n    ret.zero();\r\n    let i;\r\n    for (i = 0; i < Math.min(parts.length, ret.length); i++) {\r\n      ret[i] = parts[i]/255.0;\r\n    }\r\n\r\n    if (i < 4) {\r\n      ret[3] = 1.0;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  if (color in basic_colors) {\r\n    ret.load(basic_colors[color]);\r\n    ret[3] = 1.0;\r\n    return ret;\r\n  }\r\n\r\n  const hasAlpha = color.startsWith(\"rgba(\");\r\n  color = color.replace(\"rgba\", \"\").replace(\"rgb\", \"\").replace(/[\\(\\)]/g, \"\").trim().split(\",\")\r\n\r\n  for (let i = 0; i < color.length; i++) {\r\n    ret[i] = parseFloat(color[i]);\r\n    if (i < 3) {\r\n      ret[i] /= 255;\r\n    }\r\n  }\r\n\r\n  if (ret.length === 3) {\r\n    ret.push(1.0);\r\n  }\r\n\r\n  if (!hasAlpha) {\r\n    ret[3] = 1.0;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nwindow.css2color = css2color\r\n\r\nexport function web2color(str) {\r\n  if (typeof str === \"string\" && str.trim()[0] !== \"#\") {\r\n    str = \"#\" + str.trim();\r\n  }\r\n\r\n  return css2color(str);\r\n}\r\n\r\nwindow.web2color = web2color;\r\n\r\nlet validate_pat = /\\#?[0-9a-fA-F]{6}([0-9a-fA-F]{2})?$/;\r\n\r\nexport function validateWebColor(str) {\r\n  if (typeof str !== \"string\" && !(str instanceof String))\r\n    return false;\r\n\r\n  return str.trim().search(validate_pat) === 0;\r\n}\r\n\r\nlet num = \"(([0-9]+\\.[0-9]+)|[0-9a-f]+)\";\r\n\r\nlet validate_rgba = new RegExp(`rgba\\\\(${num},${num},${num},${num}\\\\)$`);\r\nlet validate_rgb = new RegExp(`rgb\\\\(${num},${num},${num}\\\\)$`);\r\n\r\nexport function validateCSSColor(color) {\r\n  if (color.toLowerCase() in basic_colors) {\r\n    return true;\r\n  }\r\n\r\n  let rgba = color.toLowerCase().replace(/[ \\t]/g, \"\");\r\n  rgba = rgba.trim();\r\n\r\n  if (validate_rgba.test(rgba) || validate_rgb.exec(rgba)) {\r\n    return true;\r\n  }\r\n\r\n  return validateWebColor(color);\r\n}\r\n\r\nwindow.validateCSSColor = validateCSSColor;\r\n\r\nexport let theme = {};\r\n\r\nexport function invertTheme() {\r\n  cconst.colorSchemeType = cconst.colorSchemeType === ColorSchemeTypes.LIGHT ? ColorSchemeTypes.DARK\r\n                                                                             : ColorSchemeTypes.LIGHT;\r\n\r\n  function inverted(color) {\r\n    if (Array.isArray(color)) {\r\n      for (let i = 0; i < 3; i++) {\r\n        color[i] = 1.0 - color[i];\r\n      }\r\n\r\n      return color;\r\n    }\r\n\r\n    color = css2color(color);\r\n    return color2css(inverted(color));\r\n  }\r\n\r\n  let bg = document.body.style[\"background-color\"];\r\n  //if (!bg) {\r\n  bg = cconst.colorSchemeType === ColorSchemeTypes.LIGHT ? \"rgb(200,200,200)\" : \"rgb(55, 55, 55)\";\r\n  //} else {\r\n  //  bg = inverted(bg);\r\n  //}\r\n\r\n  document.body.style[\"background-color\"] = bg;\r\n\r\n  for (let style in theme) {\r\n    style = theme[style];\r\n\r\n    for (let k in style) {\r\n      let v = style[k];\r\n\r\n      if (v instanceof CSSFont) {\r\n        v.color = inverted(v.color);\r\n      } else if (typeof v === \"string\") {\r\n        v = v.trim().toLowerCase();\r\n\r\n        let iscolor = v.search(\"rgb\") >= 0;\r\n        iscolor = iscolor || v in basic_colors;\r\n        iscolor = iscolor || validateWebColor(v);\r\n\r\n        if (iscolor) {\r\n          style[k] = inverted(v);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nwindow.invertTheme = invertTheme;\r\n\r\nexport function setColorSchemeType(mode) {\r\n  if (!!mode !== cconst.colorSchemeType) {\r\n    invertTheme();\r\n    cconst.colorSchemeType = mode;\r\n  }\r\n\r\n}\r\n\r\nwindow.validateWebColor = validateWebColor;\r\n\r\nlet _digest = new util.HashDigest();\r\n\r\nexport class CSSFont {\r\n  constructor(args = {}) {\r\n    this._size = args.size ? args.size : 12;\r\n    this.font = args.font;\r\n    this.style = args.style !== undefined ? args.style : \"normal\";\r\n    this.weight = args.weight !== undefined ? args.weight : \"normal\";\r\n    this.variant = args.variant !== undefined ? args.variant : \"normal\";\r\n    this.color = args.color;\r\n  }\r\n\r\n  calcHashUpdate(digest = _digest.reset()) {\r\n    digest.add(this._size || 0);\r\n    digest.add(this.font);\r\n    digest.add(this.style);\r\n    digest.add(this.weight);\r\n    digest.add(this.variant);\r\n    digest.add(this.color);\r\n\r\n    return digest.get();\r\n  }\r\n\r\n  set size(val) {\r\n    this._size = val;\r\n  }\r\n\r\n  get size() {\r\n    if (util.isMobile()) {\r\n      let mul = theme.base.mobileTextSizeMultiplier/visualViewport.scale;\r\n      if (mul) {\r\n        return this._size*mul;\r\n        ;\r\n      }\r\n    }\r\n\r\n    return this._size;\r\n  }\r\n\r\n  copyTo(b) {\r\n    b._size = this._size;\r\n    b.font = this.font;\r\n    b.style = this.style;\r\n    b.color = this.color;\r\n    b.variant = this.variant;\r\n    b.weight = this.weight;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new CSSFont();\r\n    this.copyTo(ret);\r\n    return ret;\r\n  }\r\n\r\n  genCSS(size = this.size) {\r\n    return `${this.style} ${this.variant} ${this.weight} ${size}px ${this.font}`;\r\n  }\r\n\r\n  //deprecated, use genKey()\r\n  hash() {\r\n    return this.genKey();\r\n  }\r\n\r\n  genKey() {\r\n    let color = this.color;\r\n\r\n    if (typeof this.color === \"object\" || typeof this.color === \"function\") {\r\n      color = JSON.stringify(color);\r\n    }\r\n\r\n    return this.genCSS() + \":\" + this.size + \":\" + color;\r\n  }\r\n}\r\n\r\nCSSFont.STRUCT = `\r\nCSSFont {\r\n  size     : float | obj._size;\r\n  font     : string | obj.font || \"\";\r\n  style    : string | obj.font || \"\";\r\n  color    : string | \"\"+obj.color;\r\n  variant  : string | obj.variant || \"\";\r\n  weight   : string | \"\"+obj.weight;\r\n}\r\n`;\r\nnstructjs.register(CSSFont);\r\n\r\nexport function exportTheme(theme1 = theme, addVarDecl = true) {\r\n  let sortkeys = (obj) => {\r\n    let keys = [];\r\n    for (let k in obj) {\r\n      keys.push(k);\r\n    }\r\n    keys.sort();\r\n\r\n    return keys;\r\n  }\r\n\r\n  let s = addVarDecl ? \"var theme = {\\n\" : \"{\\n\";\r\n\r\n  function writekey(v, indent = \"\") {\r\n    if (typeof v === \"string\") {\r\n      if (v.search(\"\\n\") >= 0) {\r\n        v = \"`\" + v + \"`\";\r\n      } else {\r\n        v = \"'\" + v + \"'\";\r\n      }\r\n\r\n      return v;\r\n    } else if (typeof v === \"object\") {\r\n      if (v instanceof CSSFont) {\r\n        return `new CSSFont({\r\n${indent}  font    : ${writekey(v.font)},\r\n${indent}  weight  : ${writekey(v.weight)},\r\n${indent}  variant : ${writekey(v.variant)},\r\n${indent}  style   : ${writekey(v.style)},\r\n${indent}  size    : ${writekey(v._size)},\r\n${indent}  color   : ${writekey(v.color)}\r\n${indent}})`;\r\n      } else {\r\n        let s = \"{\\n\";\r\n\r\n        for (let k of sortkeys(v)) {\r\n          let v2 = v[k];\r\n\r\n          if (k.search(\" \") >= 0 || k.search(\"-\") >= 0) {\r\n            k = \"'\" + k + \"'\";\r\n          }\r\n\r\n          s += indent + \"  \" + k + \" : \" + writekey(v2, indent + \"  \") + \",\\n\";\r\n        }\r\n\r\n        s += indent + \"}\";\r\n        return s;\r\n      }\r\n    } else {\r\n      return \"\" + v;\r\n    }\r\n\r\n    return \"error\";\r\n  }\r\n\r\n  for (let k of sortkeys(theme1)) {\r\n    let k2 = k;\r\n\r\n    if (k.search(/[- \\t.]/) >= 0) {\r\n      k2 = \"'\" + k + \"'\";\r\n    }\r\n    s += \"  \" + k2 + \": \";\r\n\r\n    let v = theme1[k];\r\n    if (typeof v !== \"object\" || v instanceof CSSFont) {\r\n      s += writekey(v, \"  \") + \",\\n\";\r\n    } else {\r\n      s += \" {\\n\"\r\n      let s2 = \"\";\r\n\r\n      let maxwid = 0;\r\n\r\n      for (let k2 of sortkeys(v)) {\r\n        if (k2.search(\"-\") >= 0 || k2.search(\" \") >= 0) {\r\n          k2 = \"'\" + k2 + \"'\";\r\n        }\r\n\r\n        maxwid = Math.max(maxwid, k2.length);\r\n      }\r\n\r\n      for (let k2 of sortkeys(v)) {\r\n        let v2 = v[k2];\r\n\r\n        if (k2.search(\"-\") >= 0 || k2.search(\" \") >= 0) {\r\n          k2 = \"'\" + k2 + \"'\";\r\n        }\r\n\r\n        let pad = \"\";\r\n\r\n        for (let i = 0; i < maxwid - k2.length; i++) {\r\n          pad += \" \";\r\n        }\r\n\r\n        s2 += \"    \" + k2 + pad + \": \" + writekey(v2, \"    \") + \",\\n\";\r\n      }\r\n\r\n      s += s2;\r\n      s += \"  },\\n\\n\"\r\n    }\r\n  }\r\n  s += \"};\\n\";\r\n\r\n  return s;\r\n}\r\n\r\nwindow._exportTheme = exportTheme;\r\n\r\nexport function copyTheme(theme) {\r\n  if (theme instanceof CSSFont) {\r\n    return theme.copy();\r\n  }\r\n\r\n  let ret = {};\r\n  for (let k in theme) {\r\n    let v = theme[k];\r\n\r\n    if (typeof v === \"function\") {\r\n      continue;\r\n    }\r\n\r\n    if (typeof v === \"object\") {\r\n      ret[k] = copyTheme(v);\r\n    } else {\r\n      ret[k] = v;\r\n    }\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n","\"use strict\";\r\n\r\nimport * as util from './util.js';\r\nimport * as simple_events from './simple_events.js';\r\n\r\nexport {keymap, reverse_keymap, keymap_latin_1} from './simple_events.js';\r\n\r\nexport class EventDispatcher {\r\n  constructor() {\r\n    this._cbs = {};\r\n  }\r\n\r\n  _fireEvent(type, data) {\r\n    let stop = false;\r\n\r\n    data = {\r\n      stopPropagation() {\r\n        stop = true;\r\n      },\r\n\r\n      data : data\r\n    };\r\n\r\n    if (type in this._cbs) {\r\n      for (let cb of this._cbs[type]) {\r\n        cb(data);\r\n        if (stop) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  on(type, cb) {\r\n    if (!(type in this._cbs)) {\r\n      this._cbs[type] = [];\r\n    }\r\n\r\n    this._cbs[type].push(cb);\r\n    return this;\r\n  }\r\n\r\n  off(type, cb) {\r\n    if (!(type in this._cbs)) {\r\n      console.warn(\"event handler not in list\", type, cb);\r\n      return this;\r\n    }\r\n\r\n    let stack = this._cbs[type];\r\n    if (stack.indexOf(cb) < 0) {\r\n      console.warn(\"event handler not in list\", type, cb);\r\n      return this;\r\n    }\r\n\r\n    stack.remove(cb);\r\n    return this;\r\n  }\r\n}\r\nexport function copyMouseEvent(e) {\r\n  let ret = {};\r\n  \r\n  function bind(func, obj) {\r\n    return function() {\r\n      return this._orig.apply(func, arguments);\r\n    }\r\n  }\r\n  \r\n  let exclude = new Set([\r\n    //\"prototype\",\r\n    //\"constructor\",\r\n    \"__proto__\"\r\n  ]);\r\n  \r\n  ret._orig = e;\r\n  \r\n  for (let k in e) {\r\n    let v = e[k];\r\n    \r\n    if (exclude.has(k)) {\r\n      continue;\r\n    }\r\n    \r\n    if (typeof v == \"function\") {\r\n      v = bind(v);\r\n    }\r\n    \r\n    ret[k] = v;\r\n  }\r\n\r\n  ret.ctrlKey = e.ctrlKey;\r\n  ret.shiftKey = e.shiftKey;\r\n  ret.altKey = e.altKey;\r\n\r\n  for (let i=0; i<2; i++) {\r\n    let key = i ? \"targetTouches\" : \"touches\";\r\n\r\n    if (e[key]) {\r\n      ret[key] = [];\r\n\r\n      for (let t of e[key]) {\r\n        let t2 = {};\r\n        ret[key].push(t2);\r\n\r\n        for (let k in t) {\r\n          t2[k] = t[k];\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nexport const DomEventTypes = {\r\n  on_mousemove   : 'mousemove',\r\n  on_mousedown   : 'mousedown',\r\n  on_mouseup     : 'mouseup',\r\n  on_touchstart  : 'touchstart',\r\n  on_touchcancel : 'touchcanel',\r\n  on_touchmove   : 'touchmove',\r\n  on_touchend    : 'touchend',\r\n  on_mousewheel  : 'mousewheel',\r\n  on_keydown     : 'keydown',\r\n  on_keyup       : 'keyup',\r\n  on_pointerdown : 'pointerdown',\r\n  on_pointermove : 'pointermove',\r\n  on_pointercancel : 'pointercancel',\r\n  on_pointerup   : 'pointerup',\r\n\r\n  //on_keypress    : 'keypress'\r\n};\r\n\r\nfunction getDom(dom, eventtype) {\r\n  if (eventtype.startsWith(\"key\"))\r\n    return window;\r\n  return dom;\r\n}\r\n\r\nexport let modalStack = [];\r\nexport function isModalHead(owner) {\r\n  return modalStack.length === 0 ||\r\n         modalStack[modalStack.length-1] === owner;\r\n}\r\n\r\nexport class EventHandler {\r\n  constructor() {\r\n    this._modalstate = undefined;\r\n  }\r\n  pushPointerModal(dom, pointerId) {\r\n    if (this._modalstate) {\r\n      console.warn(\"pushPointerModal called twiced!\");\r\n      return;\r\n    }\r\n    \r\n    this._modalstate = simple_events.pushPointerModal(this, dom, pointerId);\r\n  }\r\n  pushModal(dom, _is_root) {\r\n    if (this._modalstate) {\r\n      console.warn(\"pushModal called twiced!\");\r\n      return;\r\n    }\r\n    \r\n    this._modalstate = simple_events.pushModalLight(this);\r\n  }\r\n  \r\n  popModal() {\r\n    if (this._modalstate !== undefined) {\r\n      let modalstate = this._modalstate;\r\n\r\n      //window.setTimeout(() => {\r\n        simple_events.popModalLight(modalstate);\r\n      //});\r\n\r\n      this._modalstate = undefined;\r\n    }\r\n  }\r\n}\r\n\r\nexport function pushModal(dom, handlers) {\r\n  console.warn(\"Deprecated call to pathux.events.pushModal; use api in simple_events.js instead\");\r\n  let h = new EventHandler();\r\n  \r\n  for (let k in handlers) {\r\n    h[k] = handlers[k];\r\n  }\r\n  \r\n  handlers.popModal = () => {\r\n    return h.popModal(dom);\r\n  }\r\n  \r\n  h.pushModal(dom, false);\r\n  \r\n  return h;\r\n}\r\n","import nstructjs from \"../util/struct.js\";\r\nimport * as util from '../util/util.js';\r\n\r\nexport const CurveConstructors = [];\r\nexport const CURVE_VERSION = 1.1;\r\n\r\nexport const CurveFlags = {\r\n  SELECT   : 1,\r\n  TRANSFORM: 2,\r\n};\r\n\r\n\r\nexport const TangentModes = {\r\n  SMOOTH: 1,\r\n  BREAK : 2\r\n};\r\n\r\nexport function getCurve(type, throw_on_error = true) {\r\n  for (let cls of CurveConstructors) {\r\n    if (cls.name === type)\r\n      return cls;\r\n    if (cls.define().name === type)\r\n      return cls;\r\n  }\r\n\r\n  if (throw_on_error) {\r\n    throw new Error(\"Unknown curve type \" + type)\r\n  } else {\r\n    console.warn(\"Unknown curve type\", type);\r\n    return getCurve(\"ease\");\r\n  }\r\n}\r\n\r\nlet _udigest = new util.HashDigest();\r\n\r\nexport class CurveTypeData {\r\n  constructor() {\r\n    this.type = this.constructor.define().typeName;\r\n    this.parent = undefined;\r\n  }\r\n\r\n  get hasGUI() {\r\n    throw new Error(\"get hasGUI(): implement me!\");\r\n  }\r\n\r\n  static register(cls) {\r\n    if (cls.define === CurveTypeData.define) {\r\n      throw new Error(\"missing define() static method\");\r\n    }\r\n\r\n    let def = cls.define();\r\n\r\n    if (!def.name) {\r\n      throw new Error(cls.name + \".define() result is missing 'name' field\");\r\n    }\r\n\r\n    if (!def.typeName) {\r\n      throw new Error(cls.name + \".define() is missing .typeName, which should equal class name; needed for minificaiton\");\r\n    }\r\n\r\n    CurveConstructors.push(cls);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      uiname  : \"Some Curve\",\r\n      name    : \"somecurve\",\r\n      typeName: \"CurveTypeData\"\r\n    }\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    let d = digest;\r\n\r\n    d.add(this.type);\r\n\r\n    return d.get();\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      type: this.type\r\n    }\r\n  }\r\n\r\n  equals(b) {\r\n    return this.type === b.type;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    this.type = obj.type;\r\n\r\n    return this;\r\n  }\r\n\r\n  redraw() {\r\n    if (this.parent)\r\n      this.parent.redraw();\r\n  }\r\n\r\n  makeGUI(container) {\r\n\r\n  }\r\n\r\n  killGUI(container) {\r\n    container.clear();\r\n  }\r\n\r\n  evaluate(s) {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  integrate(s1, quadSteps = 64) {\r\n    let ret = 0.0, ds = s1/quadSteps;\r\n\r\n    for (let i = 0, s = 0; i < quadSteps; i++, s += ds) {\r\n      ret += this.evaluate(s)*ds;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  derivative(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.evaluate(s) - this.evaluate(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.evaluate(s + df) - this.evaluate(s))/df;\r\n    } else {\r\n      return (this.evaluate(s + df) - this.evaluate(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  derivative2(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.derivative(s) - this.derivative(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.derivative(s + df) - this.derivative(s))/df;\r\n    } else {\r\n      return (this.derivative(s + df) - this.derivative(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  inverse(y) {\r\n    let steps = 9;\r\n    let ds = 1.0/steps, s = 0.0;\r\n    let best = undefined;\r\n    let ret = undefined;\r\n\r\n    for (let i = 0; i < steps; i++, s += ds) {\r\n      let s1 = s, s2 = s + ds;\r\n\r\n      let mid;\r\n\r\n      for (let j = 0; j < 11; j++) {\r\n        let y1 = this.evaluate(s1);\r\n        let y2 = this.evaluate(s2);\r\n        mid = (s1 + s2)*0.5;\r\n\r\n        if (Math.abs(y1 - y) < Math.abs(y2 - y)) {\r\n          s2 = mid;\r\n        } else {\r\n          s1 = mid;\r\n        }\r\n      }\r\n\r\n      let ymid = this.evaluate(mid);\r\n\r\n      if (best === undefined || Math.abs(y - ymid) < best) {\r\n        best = Math.abs(y - ymid);\r\n        ret = mid;\r\n      }\r\n    }\r\n\r\n    return ret === undefined ? 0.0 : ret;\r\n  }\r\n\r\n  onActive(parent, draw_transform) {\r\n  }\r\n\r\n  onInactive(parent, draw_transform) {\r\n  }\r\n\r\n  reset() {\r\n\r\n  }\r\n\r\n  destroy() {\r\n  }\r\n\r\n  update() {\r\n    if (this.parent)\r\n      this.parent._on_change();\r\n  }\r\n\r\n  draw(canvas, g, draw_transform) {\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n  }\r\n}\r\n\r\nCurveTypeData.STRUCT = `\r\nCurveTypeData {\r\n  type : string;\r\n}\r\n`;\r\nnstructjs.register(CurveTypeData);\r\n\r\n\r\nconst unitRange = [0, 1];\r\n\r\nexport function evalHermiteTable(table, t, range = unitRange) {\r\n  t = (t - range[0])/(range[1] - range[0]);\r\n\r\n  let s = t*(table.length/4);\r\n  let i = Math.floor(s);\r\n\r\n  s -= i;\r\n  i *= 4;\r\n\r\n  let a = table[i] + (table[i + 1] - table[i])*s;\r\n  let b = table[i + 2] + (table[i + 3] - table[i + 2])*s;\r\n\r\n  return a + (b - a)*s;\r\n  //return table[i] + (table[i + 3] - table[i])*s;\r\n}\r\n\r\nexport function genHermiteTable(evaluate, steps, range = [0, 1]) {\r\n  //console.log(\"building spline approx\");\r\n\r\n  let table = new Array(steps);\r\n\r\n  let [min, max] = range;\r\n\r\n  let eps = 0.0001;\r\n  let dt = ((max - min) - eps*4.001)/(steps - 1);\r\n  let t = min + eps*4;\r\n  let lastdv1, lastf3;\r\n\r\n  for (let j = 0; j < steps; j++, t += dt) {\r\n    //let f1 = evaluate(t - eps*2);\r\n    let f2 = evaluate(t - eps);\r\n    let f3 = evaluate(t);\r\n    let f4 = evaluate(t + eps);\r\n    //let f5 = evaluate(t + eps*2);\r\n\r\n    let dv1 = (f4 - f2)/(eps*2);\r\n    dv1 /= steps;\r\n\r\n    if (j > 0) {\r\n      let j2 = j - 1;\r\n\r\n      table[j2*4] = lastf3;\r\n      table[j2*4 + 1] = lastf3 + lastdv1/3.0;\r\n      table[j2*4 + 2] = f3 - dv1/3.0;\r\n      table[j2*4 + 3] = f3;\r\n    }\r\n\r\n    lastdv1 = dv1;\r\n    lastf3 = f3;\r\n  }\r\n\r\n  return table;\r\n}\r\n","import {PropFlags, PropTypes} from '../toolsys/toolprop_abstract.js';\r\nimport {Quat, Vector2, Vector3, Vector4} from '../util/vectormath.js';\r\nimport * as toolprop_abstract from '../toolsys/toolprop_abstract.js';\r\nimport * as toolprop from '../toolsys/toolprop.js';\r\nimport {print_stack, cachering} from '../util/util.js';\r\nimport {ToolProperty} from '../toolsys/toolprop.js';\r\n\r\nexport const DataFlags = {\r\n  READ_ONLY              : 1,\r\n  USE_CUSTOM_GETSET      : 2,\r\n  USE_FULL_UNDO          : 4, //DataPathSetOp in controller_ops.js saves/loads entire file for undo/redo\r\n  USE_CUSTOM_PROP_GETTER : 8,\r\n  USE_EVAL_MASS_SET_PATHS: 16,\r\n};\r\n\r\n\r\nexport const DataTypes = {\r\n  STRUCT        : 0,\r\n  DYNAMIC_STRUCT: 1,\r\n  PROP          : 2,\r\n  ARRAY         : 3\r\n};\r\n\r\nlet propCacheRings = {};\r\n\r\nexport function getTempProp(type) {\r\n  if (!(type in propCacheRings)) {\r\n    propCacheRings[type] = cachering.fromConstructor(ToolProperty.getClass(type), 32);\r\n  }\r\n\r\n  return propCacheRings[type].next();\r\n}\r\n\r\nexport class DataPathError extends Error {\r\n};\r\n\r\n\r\nexport function getVecClass(proptype) {\r\n  switch (proptype) {\r\n    case PropTypes.VEC2:\r\n      return Vector2;\r\n    case PropTypes.VEC3:\r\n      return Vector3;\r\n    case PropTypes.VEC4:\r\n      return Vector4;\r\n    case PropTypes.QUAT:\r\n      return Quat;\r\n    default:\r\n      throw new Error(\"bad prop type \" + proptype);\r\n  }\r\n}\r\n\r\nexport function isVecProperty(prop) {\r\n  if (!prop || typeof prop !== \"object\" || prop === null)\r\n    return false;\r\n\r\n  let ok = false;\r\n\r\n  ok = ok || prop instanceof toolprop_abstract.Vec2PropertyIF;\r\n  ok = ok || prop instanceof toolprop_abstract.Vec3PropertyIF;\r\n  ok = ok || prop instanceof toolprop_abstract.Vec4PropertyIF;\r\n  ok = ok || prop instanceof toolprop.Vec2Property;\r\n  ok = ok || prop instanceof toolprop.Vec3Property;\r\n  ok = ok || prop instanceof toolprop.Vec4Property;\r\n\r\n  ok = ok || prop.type === PropTypes.VEC2;\r\n  ok = ok || prop.type === PropTypes.VEC3;\r\n  ok = ok || prop.type === PropTypes.VEC4;\r\n  ok = ok || prop.type === PropTypes.QUAT;\r\n\r\n  return ok;\r\n}\r\n\r\nexport class DataPath {\r\n  constructor(path, apiname, prop, type = DataTypes.PROP) {\r\n    this.type = type;\r\n    this.data = prop;\r\n    this.apiname = apiname;\r\n    this.path = path;\r\n    this.flag = 0;\r\n    this.struct = undefined;\r\n\r\n    if (type === DataTypes.PROP && this.data && (\"\" + this.data.uiname).trim().length === 0) {\r\n      this.data.uiname = ToolProperty.makeUIName(apiname);\r\n    }\r\n  }\r\n\r\n   /**\r\n   * Provide a callback to update an enum or flags property dynamically\r\n   * Callback should call enumProp.updateDefinition to update the property.\r\n   *\r\n   * @param metaCB: (enumProp: EnumProperty|FlagsProperty) => void\r\n   */\r\n   dynamicMeta(metaCB) {\r\n     this.data.dynamicMeta(metaCB)\r\n     return this\r\n   }\r\n\r\n  evalMassSetFilter() {\r\n    this.flag |= DataFlags.USE_EVAL_MASS_SET_PATHS;\r\n    return this;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new DataPath();\r\n\r\n    ret.flag = this.flag;\r\n    ret.type = this.type;\r\n    ret.data = this.data;\r\n    ret.apiname = this.apiname;\r\n    ret.path = this.path;\r\n    ret.struct = this.struct;\r\n\r\n    return ret;\r\n  }\r\n\r\n  /** this property should not be treated as something\r\n   *  that should be kept track off in the undo stack*/\r\n  noUndo() {\r\n    this.data.flag |= PropFlags.NO_UNDO;\r\n    return this;\r\n  }\r\n\r\n  setProp(prop) {\r\n    this.data = prop;\r\n  }\r\n\r\n  readOnly() {\r\n    this.flag |= DataFlags.READ_ONLY;\r\n\r\n    if (this.type === DataTypes.PROP) {\r\n      this.data.flag |= PropFlags.READ_ONLY;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  read_only() {\r\n    console.warn(\"DataPath.read_only is deprecated; use readOnly\");\r\n    return this.readOnly();\r\n  }\r\n\r\n  /** used to override tool property settings,\r\n   *  e.g. ranges, units, etc; returns a\r\n   *  base class instance of ToolProperty.\r\n   *\r\n   *  The this context points to the original ToolProperty and contains\r\n   *  a few useful references:\r\n   *\r\n   *  this.dataref - an object instance of this struct type\r\n   *  this.ctx - a context\r\n   *\r\n   *  callback takes one argument, a new (freshly copied of original)\r\n   *  tool property to modify\r\n   *\r\n   * */\r\n  customPropCallback(callback) {\r\n    this.flag |= DataFlags.USE_CUSTOM_PROP_GETTER;\r\n    this.data.flag |= PropFlags.USE_CUSTOM_PROP_GETTER;\r\n    this.propGetter = callback;\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * For the callbacks 'this' points to an internal ToolProperty;\r\n   * Referencing object lives in 'this.dataref'; calling context in 'this.ctx';\r\n   * and the datapath is 'this.datapath'\r\n   **/\r\n  customGetSet(get, set) {\r\n    this.flag |= DataFlags.USE_CUSTOM_GETSET;\r\n\r\n    if (this.type !== DataTypes.DYNAMIC_STRUCT && this.type !== DataTypes.STRUCT) {\r\n      this.data.flag |= PropFlags.USE_CUSTOM_GETSET;\r\n      this.data._getValue = this.data.getValue;\r\n      this.data._setValue = this.data.setValue;\r\n\r\n      if (get)\r\n        this.data.getValue = get;\r\n\r\n      if (set)\r\n        this.data.setValue = set;\r\n    } else {\r\n      this.getSet = {\r\n        get, set\r\n      };\r\n\r\n      this.getSet.dataref = undefined;\r\n      this.getSet.datapath = undefined;\r\n      this.getSet.ctx = undefined;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  customSet(set) {\r\n    this.customGetSet(undefined, set);\r\n    return this;\r\n  }\r\n\r\n  customGet(get) {\r\n    this.customGetSet(get, undefined);\r\n    return this;\r\n  }\r\n\r\n  /**db will be executed with underlying data object\r\n   that contains this path in 'this.dataref'\r\n\r\n   main event is 'change'\r\n   */\r\n  on(type, cb) {\r\n    if (this.type == DataTypes.PROP) {\r\n      this.data.on(type, cb);\r\n    } else {\r\n      throw new Error(\"invalid call to DataPath.on\");\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  off(type, cb) {\r\n    if (this.type === DataTypes.PROP) {\r\n      this.data.off(type, cb);\r\n    }\r\n  }\r\n\r\n  simpleSlider() {\r\n    this.data.flag |= PropFlags.SIMPLE_SLIDER;\r\n    this.data.flag &= ~PropFlags.FORCE_ROLLER_SLIDER;\r\n    return this;\r\n  }\r\n\r\n  rollerSlider() {\r\n    this.data.flag &= ~PropFlags.SIMPLE_SLIDER;\r\n    this.data.flag |= PropFlags.FORCE_ROLLER_SLIDER;\r\n\r\n    return this;\r\n  }\r\n\r\n  checkStrip(state = true) {\r\n    if (state) {\r\n      this.data.flag |= PropFlags.FORCE_ENUM_CHECKBOXES;\r\n    } else {\r\n      this.data.flag &= ~PropFlags.FORCE_ENUM_CHECKBOXES;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  noUnits() {\r\n    this.baseUnit(\"none\");\r\n    this.displayUnit(\"none\");\r\n    return this;\r\n  }\r\n\r\n  baseUnit(unit) {\r\n    this.data.setBaseUnit(unit);\r\n    return this;\r\n  }\r\n\r\n  displayUnit(unit) {\r\n    this.data.setDisplayUnit(unit);\r\n    return this;\r\n  }\r\n\r\n  unit(unit) {\r\n    return this.baseUnit(unit).displayUnit(unit);\r\n  }\r\n\r\n  editAsBaseUnit() {\r\n    this.data.flag |= PropFlags.EDIT_AS_BASE_UNIT;\r\n    return this;\r\n  }\r\n\r\n  range(min, max) {\r\n    this.data.setRange(min, max);\r\n    return this;\r\n  }\r\n\r\n  uiRange(min, max) {\r\n    this.data.setUIRange(min, max);\r\n    return this;\r\n  }\r\n\r\n  decimalPlaces(n) {\r\n    this.data.setDecimalPlaces(n);\r\n    return this;\r\n  }\r\n\r\n  sliderDisplayExp(f) {\r\n    this.data.setSliderDisplayExp(f);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * like other callbacks (until I refactor it),\r\n   * func will be called with a mysterious object that stores\r\n   * the following properties:\r\n   *\r\n   * this.dataref  : owning object reference\r\n   * this.datactx  : ctx\r\n   * this.datapath : datapath\r\n   * */\r\n  uiNameGetter(func) {\r\n    this.ui_name_get = func;\r\n    return this;\r\n  }\r\n\r\n  expRate(exp) {\r\n    this.data.setExpRate(exp);\r\n    return this;\r\n  }\r\n\r\n  slideSpeed(speed) {\r\n    this.data.setSlideSpeed(speed);\r\n    return this;\r\n  }\r\n\r\n  /**adds a slider for moving vector component sliders simultaneously*/\r\n  uniformSlider(state = true) {\r\n    this.data.uniformSlider(state);\r\n\r\n    return this;\r\n  }\r\n\r\n  radix(r) {\r\n    this.data.setRadix(r);\r\n    return this;\r\n  }\r\n\r\n  relativeStep(s) {\r\n    this.data.setRelativeStep(s);\r\n    return this;\r\n  }\r\n\r\n  step(s) {\r\n    this.data.setStep(s);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Tell DataPathSetOp to save/load entire app state for undo/redo\r\n   *\r\n   * */\r\n  fullSaveUndo() {\r\n    this.flag |= DataFlags.USE_FULL_UNDO;\r\n    this.data.flag |= PropFlags.USE_BASE_UNDO;\r\n\r\n    return this;\r\n  }\r\n\r\n  icon(i) {\r\n    this.data.setIcon(i);\r\n    return this;\r\n  }\r\n\r\n  icon2(i) {\r\n    this.data.setIcon2(i);\r\n    return this;\r\n  }\r\n\r\n  icons(icons) { //for enum/flag properties\r\n    this.data.addIcons(icons);\r\n    return this;\r\n  }\r\n\r\n  /** secondary icons (e.g. disabled states) */\r\n  icons2(icons) {\r\n    this.data.addIcons2(icons);\r\n    return this;\r\n  }\r\n\r\n  descriptions(description_map) { //for enum/flag properties\r\n    this.data.addDescriptions(description_map);\r\n    return this;\r\n  }\r\n\r\n  uiNames(uinames) {\r\n    this.data.addUINames(uinames);\r\n    return this;\r\n  }\r\n\r\n  description(d) {\r\n    this.data.description = d;\r\n    return this;\r\n  }\r\n}\r\n\r\nexport const StructFlags = {\r\n  NO_UNDO: 1 //struct and its child structs can't participate in undo\r\n             //via the DataPathToolOp\r\n};\r\n\r\nexport class ListIface {\r\n  getStruct(api, list, key) {\r\n\r\n  }\r\n\r\n  get(api, list, key) {\r\n\r\n  }\r\n\r\n  getKey(api, list, obj) {\r\n\r\n  }\r\n\r\n  getActive(api, list) {\r\n\r\n  }\r\n\r\n  setActive(api, list, val) {\r\n\r\n  }\r\n\r\n  set(api, list, key, val) {\r\n    list[key] = val;\r\n  }\r\n\r\n  getIter() {\r\n\r\n  }\r\n\r\n  filter(api, list, filter) {\r\n\r\n  }\r\n}\r\n\r\nexport class ToolOpIface {\r\n  constructor() {\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"!untitled tool\",\r\n      icon       : -1,\r\n      toolpath   : \"logical_module.tool\", //logical_module need not match up to real module name\r\n      description: undefined,\r\n      is_modal   : false,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n};\r\n\r\n\r\nlet DataAPIClass = undefined;\r\n\r\nexport function setImplementationClass(cls) {\r\n  DataAPIClass = cls;\r\n}\r\n\r\nexport function registerTool(cls) {\r\n  if (DataAPIClass === undefined) {\r\n    throw new Error(\"data api not initialized properly; call setImplementationClass\");\r\n  }\r\n\r\n  return DataAPIClass.registerTool(cls);\r\n}\r\n","/**\r\n see doc_src/context.md\r\n */\r\n\r\nimport * as util from '../util/util.js';\r\n\r\nimport cconst from '../config/config.js';\r\n\r\nlet notifier = undefined;\r\n\r\nexport function setNotifier(cls) {\r\n  notifier = cls;\r\n}\r\n\r\nexport const ContextFlags = {\r\n  IS_VIEW : 1\r\n};\r\n\r\nclass InheritFlag {\r\n  constructor(data) {\r\n    this.data = data;\r\n  }\r\n}\r\n\r\nlet __idgen = 1;\r\n\r\nif (Symbol.ContextID === undefined) {\r\n  Symbol.ContextID = Symbol(\"ContextID\");\r\n}\r\n\r\nif (Symbol.CachedDef === undefined) {\r\n  Symbol.CachedDef = Symbol(\"CachedDef\");\r\n}\r\n\r\nconst _ret_tmp = [undefined];\r\n\r\nexport const OverlayClasses = [];\r\n\r\nexport function makeDerivedOverlay(parent) {\r\n  return class ContextOverlay extends parent {\r\n    constructor(appstate) {\r\n      super(appstate);\r\n\r\n      this.ctx = undefined; //owning context\r\n      this._state = appstate;\r\n    }\r\n\r\n    get state() {\r\n      return this._state;\r\n    }\r\n\r\n    set state(state) {\r\n      this._state = state;\r\n    }\r\n\r\n    onRemove(have_new_file = false) {\r\n    }\r\n\r\n    copy() {\r\n      return new this.constructor(this._state);\r\n    }\r\n\r\n    validate() {\r\n      throw new Error(\"Implement me!\");\r\n    }\r\n\r\n\r\n    //base classes override this\r\n    static contextDefine() {\r\n      throw new Error(\"implement me!\");\r\n      return {\r\n        name: \"\",\r\n        flag: 0\r\n      }\r\n    }\r\n\r\n    //don't override this\r\n    static resolveDef() {\r\n      if (this.hasOwnProperty(Symbol.CachedDef)) {\r\n        return this[Symbol.CachedDef];\r\n      }\r\n\r\n      let def2 = Symbol.CachedDef = {};\r\n\r\n      let def = this.contextDefine();\r\n\r\n      if (def === undefined) {\r\n        def = {};\r\n      }\r\n\r\n      for (let k in def) {\r\n        def2[k] = def[k];\r\n      }\r\n\r\n      if (!(\"flag\" in def)) {\r\n        def2.flag = Context.inherit(0);\r\n      }\r\n\r\n      let parents = [];\r\n      let p = util.getClassParent(this);\r\n\r\n      while (p && p !== ContextOverlay) {\r\n        parents.push(p);\r\n        p = util.getClassParent(p);\r\n      }\r\n\r\n      if (def2.flag instanceof InheritFlag) {\r\n        let flag = def2.flag.data;\r\n        for (let p of parents) {\r\n          let def = p.contextDefine();\r\n\r\n          if (!def.flag) {\r\n            continue;\r\n          } else if (def.flag instanceof InheritFlag) {\r\n            flag |= def.flag.data;\r\n          } else {\r\n            flag |= def.flag;\r\n            //don't go past non-inheritable parents\r\n            break;\r\n          }\r\n        }\r\n\r\n        def2.flag = flag;\r\n      }\r\n\r\n      return def2;\r\n    }\r\n  };\r\n}\r\n\r\nexport const ContextOverlay = makeDerivedOverlay(Object);\r\n\r\nexport const excludedKeys = new Set([\"onRemove\", \"reset\", \"toString\", \"_fix\",\r\n                                     \"valueOf\", \"copy\", \"next\", \"save\", \"load\", \"clear\", \"hasOwnProperty\",\r\n                                     \"toLocaleString\", \"constructor\", \"propertyIsEnumerable\", \"isPrototypeOf\",\r\n                                     \"state\", \"saveProperty\", \"loadProperty\", \"getOwningOverlay\", \"_props\"]);\r\n\r\nexport class LockedContext {\r\n  constructor(ctx, noWarnings) {\r\n    this.props = {};\r\n\r\n    this.state = ctx.state;\r\n    this.api = ctx.api;\r\n    this.toolstack = ctx.toolstack;\r\n\r\n    this.noWarnings = noWarnings;\r\n\r\n    this.load(ctx);\r\n  }\r\n\r\n  toLocked() {\r\n    //just return itself\r\n    return this;\r\n  }\r\n\r\n  error() {\r\n    return this.ctx.error(...arguments);\r\n  }\r\n  warning() {\r\n    return this.ctx.warning(...arguments);\r\n  }\r\n  message() {\r\n    return this.ctx.message(...arguments);\r\n  }\r\n  progbar() {\r\n    return this.ctx.progbar(...arguments);\r\n  }\r\n\r\n  load(ctx) {\r\n    //let keys = util.getAllKeys(ctx);\r\n    let keys = ctx._props;\r\n\r\n    function wrapget(name) {\r\n      return function(ctx2, data) {\r\n        return ctx.loadProperty(ctx2, name, data);\r\n      }\r\n    }\r\n\r\n    for (let k of keys) {\r\n      let v;\r\n      if (k === \"state\" || k === \"toolstack\" || k === \"api\") {\r\n        continue;\r\n      }\r\n\r\n      if (typeof k === \"string\" && (k.endsWith(\"_save\") || k.endsWith(\"_load\"))) {\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        v = ctx[k];\r\n      } catch (error) {\r\n        if (cconst.DEBUG.contextSystem) {\r\n          console.warn(\"failed to look up property in context: \", k);\r\n        }\r\n        continue;\r\n      }\r\n\r\n      let data, getter;\r\n      let overlay = ctx.getOwningOverlay(k);\r\n\r\n      if (overlay === undefined) {\r\n        //property must no longer be used?\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        if (typeof k === \"string\" && (overlay[k + \"_save\"] && overlay[k + \"_load\"])) {\r\n          data = overlay[k + \"_save\"]();\r\n          getter = overlay[k + \"_load\"];\r\n        } else {\r\n          data = ctx.saveProperty(k);\r\n          getter = wrapget(k);\r\n        }\r\n      } catch (error) {\r\n        //util.print_stack(error);\r\n        console.warn(\"Failed to save context property\", k);\r\n        continue;\r\n      }\r\n\r\n      this.props[k] = {\r\n        data : data,\r\n        get  : getter\r\n      };\r\n    }\r\n\r\n    let defineProp = (name) => {\r\n      Object.defineProperty(this, name, {\r\n        get : function() {\r\n          let def = this.props[name];\r\n          return def.get(this.ctx, def.data)\r\n        }\r\n      })\r\n    };\r\n\r\n    for (let k in this.props) {\r\n      defineProp(k);\r\n    }\r\n\r\n    this.ctx = ctx;\r\n  }\r\n\r\n  setContext(ctx) {\r\n    this.ctx = ctx;\r\n\r\n    this.state = ctx.state;\r\n    this.api = ctx.api;\r\n    this.toolstack = ctx.toolstack;\r\n  }\r\n}\r\n\r\nlet next_key = {};\r\nlet idgen = 1;\r\n\r\nexport class Context {\r\n  constructor(appstate) {\r\n    this.state = appstate;\r\n\r\n    this._props = new Set();\r\n    this._stack = [];\r\n    this._inside_map = {};\r\n  }\r\n\r\n  static isContextSubclass(cls) {\r\n    while (cls) {\r\n      if (cls === Context) {\r\n        return true;\r\n      }\r\n\r\n      cls = cls.__proto__;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  /** chrome's debug console corrupts this._inside_map,\r\n   this method fixes it*/\r\n  _fix() {\r\n    this._inside_map = {};\r\n  }\r\n\r\n  fix() {\r\n    this._fix();\r\n  }\r\n\r\n  error(message, timeout=1500) {\r\n    let state = this.state;\r\n\r\n    console.warn(message);\r\n\r\n    if (state && state.screen) {\r\n      return notifier.error(state.screen, message, timeout);\r\n    }\r\n  }\r\n\r\n  warning(message, timeout=1500) {\r\n    let state = this.state;\r\n\r\n    console.warn(message);\r\n\r\n    if (state && state.screen) {\r\n      return notifier.warning(state.screen, message, timeout);\r\n    }\r\n  }\r\n\r\n  message(msg, timeout=1500) {\r\n    let state = this.state;\r\n\r\n    console.warn(msg);\r\n\r\n    if (state && state.screen) {\r\n      return notifier.message(state.screen, msg, timeout);\r\n    }\r\n  }\r\n\r\n  progbar(msg, perc=0.0, timeout=1500, id=msg) {\r\n    let state = this.state;\r\n\r\n    if (state && state.screen) {\r\n      //progbarNote(screen, msg, percent, color, timeout) {\r\n      return notifier.progbarNote(state.screen, msg, perc, \"green\", timeout, id);\r\n    }\r\n  }\r\n\r\n  validateOverlays() {\r\n    let stack = this._stack;\r\n    let stack2 = [];\r\n\r\n    for (let i=0; i<stack.length; i++) {\r\n      if (stack[i].validate()) {\r\n        stack2.push(stack[i]);\r\n      }\r\n    }\r\n\r\n    this._stack = stack2;\r\n  }\r\n\r\n  hasOverlay(cls) {\r\n    return this.getOverlay(cls) !== undefined;\r\n  }\r\n\r\n  getOverlay(cls) {\r\n    for (let overlay of this._stack) {\r\n      if (overlay.constructor === cls) {\r\n        return overlay;\r\n      }\r\n    }\r\n  }\r\n\r\n  clear(have_new_file=false) {\r\n    for (let overlay of this._stack) {\r\n      overlay.onRemove(have_new_file);\r\n    }\r\n\r\n    this._stack = [];\r\n  }\r\n\r\n  //this is implemented by child classes\r\n  //it should load the same default overlays as in constructor\r\n  reset(have_new_file=false) {\r\n    this.clear(have_new_file);\r\n  }\r\n\r\n  //returns a new context with overriden properties\r\n  //unlike pushOverlay, overrides can be a simple object\r\n  override(overrides) {\r\n    if (overrides.copy === undefined) {\r\n      overrides.copy = function() {\r\n        return Object.assign({}, this);\r\n      }\r\n    }\r\n\r\n    let ctx = this.copy();\r\n    ctx.pushOverlay(overrides);\r\n    return ctx;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new this.constructor(this.state);\r\n\r\n    for (let item of this._stack) {\r\n      ret.pushOverlay(item.copy());\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   Used by overlay property getters.  If returned,\r\n   the next overlay in the struct will have its getter used.\r\n\r\n   Example:\r\n\r\n   class overlay {\r\n      get scene() {\r\n        if (some_reason) {\r\n          return Context.super();\r\n        }\r\n\r\n        return something_else;\r\n      }\r\n    }\r\n   */\r\n  static super() {\r\n    return next_key;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * saves a property into some kind of non-object-reference form\r\n   *\r\n   * */\r\n  saveProperty(key) {\r\n    //console.warn(\"Missing saveProperty implementation in Context; passing through values...\", key)\r\n    return this[key];\r\n  }\r\n\r\n  /**\r\n   *\r\n   * lookup property based on saved data\r\n   *\r\n   * */\r\n  loadProperty(ctx, key, data) {\r\n    //console.warn(\"Missing loadProperty implementation in Context; passing through values...\", key)\r\n    return data;\r\n  }\r\n\r\n  getOwningOverlay(name, _val_out) {\r\n    let inside_map = this._inside_map;\r\n    let stack = this._stack;\r\n\r\n    if (cconst.DEBUG.contextSystem) {\r\n      console.log(name, inside_map);\r\n    }\r\n\r\n    for (let i=stack.length-1; i >= 0; i--) {\r\n      let overlay = stack[i];\r\n      let ret = next_key;\r\n\r\n      if (overlay[Symbol.ContextID] === undefined) {\r\n        throw new Error(\"context corruption\");\r\n      }\r\n\r\n      let ikey = overlay[Symbol.ContextID];\r\n\r\n      if (cconst.DEBUG.contextSystem) {\r\n        console.log(ikey, overlay);\r\n      }\r\n\r\n      //prevent infinite recursion\r\n      if (inside_map[ikey]) {\r\n        continue;\r\n      }\r\n\r\n      if (overlay.__allKeys.has(name)) {\r\n        if (cconst.DEBUG.contextSystem) {\r\n          console.log(\"getting value\");\r\n        }\r\n\r\n        //Chrome's console messes this up\r\n\r\n        inside_map[ikey] = 1;\r\n\r\n        try {\r\n          ret = overlay[name];\r\n        } catch (error) {\r\n\r\n          inside_map[ikey] = 0;\r\n          throw error;\r\n        }\r\n\r\n        inside_map[ikey] = 0;\r\n      }\r\n\r\n      if (ret !== next_key) {\r\n        if (_val_out !== undefined) {\r\n          _val_out[0] = ret;\r\n        }\r\n        return overlay;\r\n      }\r\n    }\r\n\r\n    if (_val_out !== undefined) {\r\n      _val_out[0] = undefined;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  ensureProperty(name) {\r\n    if (this.hasOwnProperty(name)) {\r\n      return;\r\n    }\r\n\r\n    this._props.add(name);\r\n\r\n    Object.defineProperty(this, name, {\r\n      get : function() {\r\n        let ret = _ret_tmp;\r\n        _ret_tmp[0] = undefined;\r\n\r\n        this.getOwningOverlay(name, ret);\r\n        return ret[0];\r\n      }, set : function() {\r\n        throw new Error(\"Cannot set ctx properties\")\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Returns a new context that doesn't\r\n   * contain any direct object references\r\n   * except for .state .datalib and .api, but\r\n   * instead uses those three to look up references\r\n   * on property access.\r\n   * */\r\n  toLocked() {\r\n    return new LockedContext(this);\r\n  }\r\n\r\n  pushOverlay(overlay) {\r\n    if (!overlay.hasOwnProperty(Symbol.ContextID)) {\r\n      overlay[Symbol.ContextID] = idgen++;\r\n    }\r\n\r\n    let keys = new Set();\r\n    for (let key of util.getAllKeys(overlay)) {\r\n      if (!excludedKeys.has(key) && !(typeof key === \"string\" && key[0] === \"_\")) {\r\n        keys.add(key);\r\n      }\r\n    }\r\n\r\n    overlay.ctx = this;\r\n\r\n    if (overlay.__allKeys === undefined) {\r\n      overlay.__allKeys = keys;\r\n    }\r\n\r\n    for (let k of keys) {\r\n      let bad = typeof k === \"symbol\" || excludedKeys.has(k);\r\n      bad = bad || (typeof k === \"string\" && k[0] === \"_\");\r\n      bad = bad || (typeof k === \"string\" && k.endsWith(\"_save\"));\r\n      bad = bad || (typeof k === \"string\" && k.endsWith(\"_load\"));\r\n\r\n      if (bad) {\r\n        continue;\r\n      }\r\n\r\n      this.ensureProperty(k);\r\n    }\r\n\r\n    if (this._stack.indexOf(overlay) >= 0) {\r\n      console.warn(\"Overlay already added once\");\r\n      if (this._stack[this._stack.length-1] === overlay) {\r\n        console.warn(\"  Definitely an error, overlay is already at top of stack\");\r\n        return;\r\n      }\r\n    }\r\n\r\n    this._stack.push(overlay);\r\n  }\r\n\r\n  popOverlay(overlay) {\r\n    if (overlay !== this._stack[this._stack.length-1]) {\r\n      console.warn(\"Context.popOverlay called in error\", overlay);\r\n      return;\r\n    }\r\n\r\n    overlay.onRemove();\r\n    this._stack.pop();\r\n  }\r\n\r\n  removeOverlay(overlay) {\r\n    if (this._stack.indexOf(overlay) < 0) {\r\n      console.warn(\"Context.removeOverlay called in error\", overlay);\r\n      return;\r\n    }\r\n\r\n    overlay.onRemove();\r\n    this._stack.remove(overlay);\r\n  }\r\n\r\n  static inherit(data) {\r\n    return new InheritFlag(data);\r\n  }\r\n\r\n  static register(cls) {\r\n    if (cls[Symbol.ContextID]) {\r\n      console.warn(\"Tried to register same class twice:\", cls);\r\n      return;\r\n    }\r\n\r\n    cls[Symbol.ContextID] = __idgen++;\r\n    OverlayClasses.push(cls);\r\n  }\r\n}\r\n\r\nexport function test() {\r\n  function testInheritance() {\r\n    class Test0 extends ContextOverlay {\r\n      static contextDefine() {\r\n        return {\r\n          flag: 1\r\n        }\r\n      }\r\n    }\r\n\r\n    class Test1 extends Test0 {\r\n      static contextDefine() {\r\n        return {\r\n          flag: 2\r\n        }\r\n      }\r\n    }\r\n\r\n    class Test2 extends Test1 {\r\n      static contextDefine() {\r\n        return {\r\n          flag: Context.inherit(4)\r\n        }\r\n      }\r\n    }\r\n\r\n    class Test3 extends Test2 {\r\n      static contextDefine() {\r\n        return {\r\n          flag: Context.inherit(8)\r\n        }\r\n      }\r\n    }\r\n\r\n    class Test4 extends Test3 {\r\n      static contextDefine() {\r\n        return {\r\n          flag: Context.inherit(16)\r\n        }\r\n      }\r\n    }\r\n\r\n    return Test4.resolveDef().flag === 30;\r\n  }\r\n\r\n  return testInheritance();\r\n}\r\n\r\nif (!test()) {\r\n  throw new Error(\"Context test failed\");\r\n}\r\n","\"use strict\";\r\nimport nstructjs from '../util/struct.js';\r\n\r\n/**\r\n\r\n ToolOps are base operators for modifying application state.\r\n They operate on Contexts and can use the datapath API.\r\n They make up the undo stack.\r\n\r\n ToolOp subclasses handle undo with their undoPre (run before tool execution)\r\n and undo methods.  You can set default handlers (most commonly this is just\r\n saving/reloading the app state) with setDefaultUndoHandlers.\r\n\r\n ToolOps have inputs and outputs (which are ToolProperties) and can also\r\n be modal.\r\n\r\n ## Rules\r\n\r\n Tools are never, EVER allowed to store direct pointers to the application state,\r\n with one exception: tools in modal mode may store such pointers, but they must\r\n delete them when existing modal mode by overriding modalEnd.\r\n\r\n This is to prevent very evil and difficult to debug bugs in the undo stack\r\n and nasty memory leaks.\r\n\r\n ## Example\r\n\r\n <pre>\r\n\r\n const ExampleEnum = {\r\n  ITEM1 : 0,\r\n  ITEM2 : 1\r\n}\r\n\r\n class MyTool extends ToolOp {\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Tool Name\",\r\n      toolpath   : \"my.tool\",\r\n      inputs     : {\r\n          input1 : new IntProperty(),\r\n          input2 : new EnumProperty(0, ExampleEnum)\r\n      },\r\n      outputs    : {\r\n          someoutput : new IntProperty\r\n      }\r\n    }\r\n  }\r\n\r\n  undoPre(ctx) {\r\n    //run before tool starts\r\n  }\r\n\r\n  undo(ctx) {\r\n    //undo handler\r\n  }\r\n\r\n  execPre(ctx) {\r\n    //run right before exec\r\n  }\r\n  exec(ctx) {\r\n    //main execution method\r\n  }\r\n  execPost(ctx) {\r\n    //run right after exec\r\n  }\r\n}\r\n ToolOp.register(MyTool);\r\n\r\n </pre>\r\n */\r\n\r\nimport * as events from '../util/events.js';\r\nimport {keymap} from '../util/simple_events.js';\r\nimport {PropFlags, PropTypes} from './toolprop.js';\r\nimport {DataPath} from '../controller/controller_base.js';\r\nimport * as util from '../util/util.js';\r\nimport {Context} from '../controller/context.js';\r\n\r\nexport let ToolClasses = [];\r\nwindow._ToolClasses = ToolClasses;\r\n\r\nexport function setContextClass(cls) {\r\n  console.warn(\"setContextClass is deprecated\");\r\n}\r\n\r\nexport const ToolFlags = {\r\n  PRIVATE: 1\r\n\r\n};\r\n\r\n\r\nexport const UndoFlags = {\r\n  NO_UNDO      : 2,\r\n  IS_UNDO_ROOT : 4,\r\n  UNDO_BARRIER : 8,\r\n  HAS_UNDO_DATA: 16\r\n};\r\n\r\nclass InheritFlag {\r\n  constructor(slots = {}) {\r\n    this.slots = slots;\r\n  }\r\n}\r\n\r\nlet modalstack = [];\r\n\r\nlet defaultUndoHandlers = {\r\n  undoPre(ctx) {\r\n    throw new Error(\"implement me\");\r\n  },\r\n  undo(ctx) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n}\r\n\r\nexport function setDefaultUndoHandlers(undoPre, undo) {\r\n  if (!undoPre || !undo) {\r\n    throw new Error(\"invalid parameters to setDefaultUndoHandlers\");\r\n  }\r\n\r\n  defaultUndoHandlers.undoPre = undoPre;\r\n  defaultUndoHandlers.undo = undo;\r\n}\r\n\r\nexport class ToolPropertyCache {\r\n  constructor() {\r\n    this.map = new Map();\r\n    this.pathmap = new Map();\r\n    this.accessors = {};\r\n\r\n    this.userSetMap = new Set();\r\n\r\n    this.api = undefined;\r\n    this.dstruct = undefined;\r\n  }\r\n\r\n  static getPropKey(cls, key, prop) {\r\n    return prop.apiname && prop.apiname.length > 0 ? prop.apiname : key;\r\n  }\r\n\r\n  _buildAccessors(cls, key, prop, dstruct, api) {\r\n    let tdef = cls._getFinalToolDef();\r\n\r\n    this.api = api;\r\n    this.dstruct = dstruct;\r\n\r\n    if (!tdef.toolpath) {\r\n      console.warn(\"Bad tool property\", cls, \"it's tooldef was missing a toolpath field\");\r\n      return;\r\n    }\r\n\r\n    let path = tdef.toolpath.trim().split(\".\").filter(f => f.trim().length > 0);\r\n    let obj = this.accessors;\r\n\r\n    let st = dstruct;\r\n    let partial = \"\";\r\n\r\n    for (let i = 0; i < path.length; i++) {\r\n      let k = path[i];\r\n      let pathk = k;\r\n\r\n      if (i === 0) {\r\n        pathk = \"accessors.\" + k;\r\n      }\r\n\r\n      if (i > 0) {\r\n        partial += \".\";\r\n      }\r\n      partial += k;\r\n\r\n      if (!(k in obj)) {\r\n        obj[k] = {};\r\n      }\r\n\r\n      let st2 = api.mapStruct(obj[k], true, k);\r\n      if (!(k in st.pathmap)) {\r\n        st.struct(pathk, k, k, st2);\r\n      }\r\n      st = st2;\r\n\r\n      this.pathmap.set(partial, obj[k]);\r\n\r\n      obj = obj[k];\r\n    }\r\n\r\n    let name = prop.apiname !== undefined && prop.apiname.length > 0 ? prop.apiname : key;\r\n    let prop2 = prop.copy()\r\n\r\n    let dpath = new DataPath(name, name, prop2);\r\n    let uiname = prop.uiname;\r\n\r\n    if (!uiname || uiname.trim().length === 0) {\r\n      uiname = prop.apiname;\r\n    }\r\n    if (!uiname || uiname.trim().length === 0) {\r\n      uiname = key;\r\n    }\r\n\r\n    uiname = ToolProperty.makeUIName(uiname);\r\n\r\n    prop2.uiname = uiname;\r\n    prop2.description = prop2.description || prop2.uiname;\r\n\r\n    st.add(dpath);\r\n\r\n    obj[name] = prop2.getValue();\r\n  }\r\n\r\n  _getAccessor(cls) {\r\n    let toolpath = cls.tooldef().toolpath.trim();\r\n    return this.pathmap.get(toolpath);\r\n  }\r\n\r\n  useDefault(cls, key, prop) {\r\n    key = this.userSetMap.has(cls.tooldef().trim() + \".\" + this.constructor.getPropKey(key));\r\n    key = key.trim();\r\n\r\n    return key;\r\n  }\r\n\r\n  has(cls, key, prop) {\r\n    if (prop.flag & PropFlags.NO_DEFAULT) {\r\n      return false;\r\n    }\r\n\r\n    let obj = this._getAccessor(cls);\r\n\r\n    key = this.constructor.getPropKey(cls, key, prop);\r\n    return obj && key in obj;\r\n  }\r\n\r\n  get(cls, key, prop) {\r\n    if (cls === ToolMacro) {\r\n      return;\r\n    }\r\n\r\n    let obj = this._getAccessor(cls);\r\n    key = this.constructor.getPropKey(cls, key, prop);\r\n\r\n    if (obj) {\r\n      return obj[key];\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  set(cls, key, prop) {\r\n    if (cls === ToolMacro) {\r\n      return;\r\n    }\r\n\r\n    let toolpath = cls.tooldef().toolpath.trim();\r\n    let obj = this._getAccessor(cls);\r\n\r\n    if (!obj) {\r\n      console.warn(\"Warning, toolop \" + cls.name + \" was not in the default map; unregistered?\");\r\n      this._buildAccessors(cls, key, prop, this.dstruct, this.api);\r\n\r\n      obj = this.pathmap.get(toolpath);\r\n    }\r\n\r\n    if (!obj) {\r\n      console.error(\"Malformed toolpath in toolop definition: \" + toolpath);\r\n      return;\r\n    }\r\n\r\n    key = this.constructor.getPropKey(cls, key, prop);\r\n\r\n    //copy prop first in case we're a non-primitive-value type, e.g. vector properties\r\n    obj[key] = prop.copy().getValue();\r\n\r\n    let path = toolpath + \".\" + key;\r\n    this.userSetMap.add(path);\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nexport const SavedToolDefaults = new ToolPropertyCache();\r\n\r\nexport class ToolOp extends events.EventHandler {\r\n  /**\r\n   Main ToolOp constructor.  It reads the inputs/outputs properteis from\r\n   this.constructor.tooldef() and copies them to build this.inputs and this.outputs.\r\n   If inputs or outputs are wrapped in ToolOp.inherit(), it will walk up the class\r\n   chain to fetch parent class properties.\r\n\r\n\r\n   Default input values are loaded from SavedToolDefaults.  If initialized (buildToolSysAPI\r\n   has been called) SavedToolDefaults will have a copy of all the default\r\n   property values of all registered ToolOps.\r\n   **/\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this._pointerId = undefined;\r\n    this._overdraw = undefined;\r\n    this.__memsize = undefined;\r\n\r\n    var def = this.constructor.tooldef();\r\n\r\n    if (def.undoflag !== undefined) {\r\n      this.undoflag = def.undoflag;\r\n    }\r\n\r\n    if (def.flag !== undefined) {\r\n      this.flag = def.flag;\r\n    }\r\n\r\n    this._accept = this._reject = undefined;\r\n    this._promise = undefined;\r\n\r\n    for (var k in def) {\r\n      this[k] = def[k];\r\n    }\r\n\r\n    let getSlots = (slots, key) => {\r\n      if (slots === undefined)\r\n        return {};\r\n\r\n      if (!(slots instanceof InheritFlag)) {\r\n        return slots;\r\n      }\r\n\r\n      slots = {};\r\n      let p = this.constructor;\r\n      let lastp = undefined;\r\n\r\n      while (p !== undefined && p !== Object && p !== ToolOp && p !== lastp) {\r\n        if (p.tooldef) {\r\n          let def = p.tooldef();\r\n\r\n          if (def[key] !== undefined) {\r\n            let slots2 = def[key];\r\n            let stop = !(slots2 instanceof InheritFlag);\r\n\r\n            if (slots2 instanceof InheritFlag) {\r\n              slots2 = slots2.slots;\r\n            }\r\n\r\n            for (let k in slots2) {\r\n              if (!(k in slots)) {\r\n                slots[k] = slots2[k];\r\n              }\r\n            }\r\n\r\n            if (stop) {\r\n              break;\r\n            }\r\n          }\r\n        }\r\n\r\n        lastp = p;\r\n        p = p.prototype.__proto__.constructor;\r\n      }\r\n\r\n      return slots;\r\n    };\r\n\r\n    let dinputs = getSlots(def.inputs, \"inputs\");\r\n    let doutputs = getSlots(def.outputs, \"outputs\");\r\n\r\n    this.inputs = {};\r\n    this.outputs = {};\r\n\r\n    if (dinputs) {\r\n      for (let k in dinputs) {\r\n        let prop = dinputs[k].copy();\r\n        prop.apiname = prop.apiname && prop.apiname.length > 0 ? prop.apiname : k;\r\n\r\n        if (!this.hasDefault(prop, k)) {\r\n          this.inputs[k] = prop;\r\n          continue;\r\n        }\r\n\r\n        try {\r\n          prop.setValue(this.getDefault(prop, k));\r\n        } catch (error) {\r\n          console.log(error.stack);\r\n          console.log(error.message);\r\n        }\r\n\r\n        prop.wasSet = false;\r\n        this.inputs[k] = prop;\r\n      }\r\n    }\r\n\r\n    if (doutputs) {\r\n      for (let k in doutputs) {\r\n        let prop = doutputs[k].copy();\r\n        prop.apiname = prop.apiname && prop.apiname.length > 0 ? prop.apiname : k;\r\n\r\n        this.outputs[k] = prop;\r\n      }\r\n    }\r\n\r\n    this.drawlines = [];\r\n  }\r\n\r\n  /**\r\n   ToolOp definition.\r\n\r\n   An example:\r\n   <pre>\r\n   static tooldef() {\r\n    return {\r\n      uiname   : \"Tool Name\",\r\n      toolpath : \"logical_module.tool\", //logical_module need not match up to a real module\r\n      icon     : -1, //tool's icon, or -1 if there is none\r\n      description : \"tooltip\",\r\n      is_modal : false, //tool is interactive and takes control of events\r\n      hotkey   : undefined,\r\n      undoflag : 0, //see UndoFlags\r\n      flag     : 0,\r\n      inputs   : ToolOp.inherit({\r\n        f32val : new Float32Property(1.0),\r\n        path   : new StringProperty(\"./path\");\r\n      }),\r\n      outputs  : {}\r\n      }\r\n    }\r\n   </pre>\r\n   */\r\n  static tooldef() {\r\n    if (this === ToolOp) {\r\n      throw new Error(\"Tools must implemented static tooldef() methods!\");\r\n    }\r\n\r\n    return {};\r\n  }\r\n\r\n  /** Returns a map of input property values,\r\n   *  e.g. `let {prop1, prop2} = this.getValues()` */\r\n  getInputs() {\r\n    let ret = {};\r\n\r\n    for (let k in this.inputs) {\r\n      ret[k] = this.inputs[k].getValue();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  static Equals(a, b) {\r\n    if (!a || !b) return false;\r\n    if (a.constructor !== b.constructor) return false;\r\n\r\n    let bad = false;\r\n\r\n    for (let k in a.inputs) {\r\n      bad = bad || !(k in b.inputs);\r\n      bad = bad || a.inputs[k].constructor !== b.inputs[k];\r\n      bad = bad || !a.inputs[k].equals(b.inputs[k]);\r\n\r\n      if (bad) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return !bad;\r\n  }\r\n\r\n  static inherit(slots = {}) {\r\n    return new InheritFlag(slots);\r\n  }\r\n\r\n  /**\r\n\r\n   Creates a new instance of this toolop from args and a context.\r\n   This is often use to fill properties with default arguments\r\n   stored somewhere in the context.\r\n\r\n   */\r\n  static invoke(ctx, args) {\r\n    let tool = new this();\r\n\r\n    for (let k in args) {\r\n      if (!(k in tool.inputs)) {\r\n        console.warn(\"Unknown tool argument \" + k);\r\n        continue;\r\n      }\r\n\r\n      let prop = tool.inputs[k];\r\n      let val = args[k];\r\n\r\n      if ((typeof val === \"string\") && prop.type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n        if (val in prop.values) {\r\n          val = prop.values[val];\r\n        } else {\r\n          console.warn(\"Possible invalid enum/flag:\", val);\r\n          continue;\r\n        }\r\n      }\r\n\r\n      tool.inputs[k].setValue(val);\r\n    }\r\n\r\n    return tool;\r\n  }\r\n\r\n  static register(cls) {\r\n    if (ToolClasses.indexOf(cls) >= 0) {\r\n      console.warn(\"Tried to register same ToolOp class twice:\", cls.name, cls);\r\n      return;\r\n    }\r\n\r\n    ToolClasses.push(cls);\r\n  }\r\n\r\n  static _regWithNstructjs(cls, structName = cls.name) {\r\n    if (nstructjs.isRegistered(cls)) {\r\n      return;\r\n    }\r\n\r\n    let parent = cls.prototype.__proto__.constructor;\r\n\r\n    if (!cls.hasOwnProperty(\"STRUCT\")) {\r\n      if (parent !== ToolOp && parent !== ToolMacro && parent !== Object) {\r\n        this._regWithNstructjs(parent);\r\n      }\r\n\r\n      cls.STRUCT = nstructjs.inherit(cls, parent) + '}\\n';\r\n    }\r\n\r\n    nstructjs.register(cls);\r\n  }\r\n\r\n  static isRegistered(cls) {\r\n    return ToolClasses.indexOf(cls) >= 0;\r\n  }\r\n\r\n  static unregister(cls) {\r\n    if (ToolClasses.indexOf(cls) >= 0) {\r\n      ToolClasses.remove(cls);\r\n    }\r\n  }\r\n\r\n  static _getFinalToolDef() {\r\n    let def = this.tooldef();\r\n\r\n    let getSlots = (slots, key) => {\r\n      if (slots === undefined)\r\n        return {};\r\n\r\n      if (!(slots instanceof InheritFlag)) {\r\n        return slots;\r\n      }\r\n\r\n      slots = {};\r\n      let p = this\r\n\r\n      while (p !== undefined && p !== Object && p !== ToolOp) {\r\n        if (p.tooldef) {\r\n          let def = p.tooldef();\r\n\r\n          if (def[key] !== undefined) {\r\n            let slots2 = def[key];\r\n            let stop = !(slots2 instanceof InheritFlag);\r\n\r\n            if (slots2 instanceof InheritFlag) {\r\n              slots2 = slots2.slots;\r\n            }\r\n\r\n            for (let k in slots2) {\r\n              if (!(k in slots)) {\r\n                slots[k] = slots2[k];\r\n              }\r\n            }\r\n\r\n            if (stop) {\r\n              break;\r\n            }\r\n          }\r\n\r\n        }\r\n        p = p.prototype.__proto__.constructor;\r\n      }\r\n\r\n      return slots;\r\n    };\r\n\r\n    let dinputs = getSlots(def.inputs, \"inputs\");\r\n    let doutputs = getSlots(def.outputs, \"outputs\");\r\n\r\n    def.inputs = dinputs;\r\n    def.outputs = doutputs;\r\n\r\n    return def;\r\n  }\r\n\r\n  static onTick() {\r\n    for (let toolop of modalstack) {\r\n      toolop.on_tick();\r\n    }\r\n  }\r\n\r\n  static searchBoxOk(ctx) {\r\n    let flag = this.tooldef().flag;\r\n    let ret = !(flag && (flag & ToolFlags.PRIVATE));\r\n    ret = ret && this.canRun(ctx);\r\n\r\n    return ret;\r\n  }\r\n\r\n  //toolop is an optional instance of this class, may be undefined\r\n  static canRun(ctx, toolop = undefined) {\r\n    return true;\r\n  }\r\n\r\n  /** Called when the undo system needs to destroy\r\n   *  this toolop to save memory*/\r\n  onUndoDestroy() {\r\n\r\n  }\r\n\r\n  /** Used by undo system to limit memory */\r\n  calcMemSize(ctx) {\r\n    if (this.__memsize !== undefined) {\r\n      return this.__memsize;\r\n    }\r\n\r\n    let tot = 0;\r\n\r\n    for (let step = 0; step < 2; step++) {\r\n      let props = step ? this.outputs : this.inputs;\r\n\r\n      for (let k in props) {\r\n        let prop = props[k];\r\n\r\n        let size = prop.calcMemSize();\r\n\r\n        if (isNaN(size) || !isFinite(size)) {\r\n          console.warn(\"Got NaN when calculating mem size for property\", prop);\r\n          continue;\r\n        }\r\n\r\n        tot += size;\r\n      }\r\n    }\r\n\r\n    let size = this.calcUndoMem(ctx);\r\n\r\n    if (isNaN(size) || !isFinite(size)) {\r\n      console.warn(\"Got NaN in calcMemSize\", this);\r\n    } else {\r\n      tot += size;\r\n    }\r\n\r\n    this.__memsize = tot;\r\n\r\n    return tot;\r\n  }\r\n\r\n  loadDefaults(force = true) {\r\n    for (let k in this.inputs) {\r\n      let prop = this.inputs[k];\r\n\r\n      if (!force && prop.wasSet) {\r\n        continue;\r\n      }\r\n\r\n      if (this.hasDefault(prop, k)) {\r\n        prop.setValue(this.getDefault(prop, k));\r\n        prop.wasSet = false;\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  hasDefault(toolprop, key = toolprop.apiname) {\r\n    return SavedToolDefaults.has(this.constructor, key, toolprop);\r\n  }\r\n\r\n  getDefault(toolprop, key = toolprop.apiname) {\r\n    let cls = this.constructor;\r\n\r\n    if (SavedToolDefaults.has(cls, key, toolprop)) {\r\n      return SavedToolDefaults.get(cls, key, toolprop);\r\n    } else {\r\n      return toolprop.getValue();\r\n    }\r\n  }\r\n\r\n  saveDefaultInputs() {\r\n    for (let k in this.inputs) {\r\n      let prop = this.inputs[k];\r\n\r\n      if (prop.flag & PropFlags.SAVE_LAST_VALUE) {\r\n        SavedToolDefaults.set(this.constructor, k, prop);\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  genToolString() {\r\n    let def = this.constructor.tooldef();\r\n    let path = def.toolpath + \"(\";\r\n\r\n    for (let k in this.inputs) {\r\n      let prop = this.inputs[k];\r\n\r\n      path += k + \"=\";\r\n      if (prop.type === PropTypes.STRING)\r\n        path += \"'\";\r\n\r\n      if (prop.type === PropTypes.FLOAT) {\r\n        path += prop.getValue().toFixed(3);\r\n      } else {\r\n        path += prop.getValue();\r\n      }\r\n\r\n      if (prop.type === PropTypes.STRING)\r\n        path += \"'\";\r\n      path += \" \";\r\n    }\r\n    path += \")\";\r\n    return path;\r\n  }\r\n\r\n  on_tick() {\r\n\r\n  }\r\n\r\n  /**default on_keydown implementation for modal tools,\r\n   no need to call super() to execute this if you don't want to*/\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case keymap[\"Enter\"]:\r\n      case keymap[\"Space\"]:\r\n        this.modalEnd(false);\r\n        break;\r\n      case keymap[\"Escape\"]:\r\n        this.modalEnd(true);\r\n        break;\r\n    }\r\n  }\r\n\r\n  //called after undoPre\r\n  calcUndoMem(ctx) {\r\n    console.warn(\"ToolOp.prototype.calcUndoMem: implement me!\");\r\n    return 0;\r\n  }\r\n\r\n  undoPre(ctx) {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  undo(ctx) {\r\n    throw new Error(\"implement me!\");\r\n    //_appstate.loadUndoFile(this._undo);\r\n  }\r\n\r\n  redo(ctx) {\r\n    this._was_redo = true; //also set by toolstack.redo\r\n\r\n    this.undoPre(ctx);\r\n    this.execPre(ctx);\r\n    this.exec(ctx);\r\n    this.execPost(ctx);\r\n  }\r\n\r\n  //for compatibility with fairmotion\r\n  exec_pre(ctx) {\r\n    this.execPre(ctx);\r\n  }\r\n\r\n  execPre(ctx) {\r\n  }\r\n\r\n  exec(ctx) {\r\n  }\r\n\r\n  execPost(ctx) {\r\n\r\n  }\r\n\r\n  /**for use in modal mode only*/\r\n  resetTempGeom() {\r\n    var ctx = this.modal_ctx;\r\n\r\n    for (var dl of this.drawlines) {\r\n      dl.remove();\r\n    }\r\n\r\n    this.drawlines.length = 0;\r\n  }\r\n\r\n  error(msg) {\r\n    console.warn(msg);\r\n  }\r\n\r\n  getOverdraw() {\r\n    if (this._overdraw === undefined) {\r\n      this._overdraw = document.createElement(\"overdraw-x\");\r\n      this._overdraw.start(this.modal_ctx.screen);\r\n    }\r\n\r\n    return this._overdraw;\r\n  }\r\n\r\n  /**for use in modal mode only*/\r\n  makeTempLine(v1, v2, style) {\r\n    let line = this.getOverdraw().line(v1, v2, style);\r\n    this.drawlines.push(line);\r\n    return line;\r\n  }\r\n\r\n  pushModal(node) {\r\n    throw new Error(\"cannot call this; use modalStart\")\r\n  }\r\n\r\n  popModal() {\r\n    throw new Error(\"cannot call this; use modalEnd\");\r\n  }\r\n\r\n  /**returns promise to be executed on modalEnd*/\r\n  modalStart(ctx) {\r\n    if (this.modalRunning) {\r\n      console.warn(\"Warning, tool is already in modal mode consuming events\");\r\n      return this._promise;\r\n    }\r\n\r\n    this.modal_ctx = ctx;\r\n    this.modalRunning = true\r\n\r\n    this._promise = new Promise((accept, reject) => {\r\n      this._accept = accept;\r\n      this._reject = reject;\r\n\r\n      modalstack.push(this);\r\n\r\n      if (this._pointerId !== undefined) {\r\n        super.pushPointerModal(ctx.screen, this._pointerId);\r\n      } else {\r\n        super.pushModal(ctx.screen);\r\n      }\r\n    });\r\n\r\n    return this._promise;\r\n  }\r\n\r\n  /*eek, I've not been using this.\r\n    guess it's a non-enforced contract, I've been naming\r\n    cancel methods 'cancel' all this time.\r\n\r\n    XXX fix\r\n  */\r\n  toolCancel() {\r\n  }\r\n\r\n  modalEnd(was_cancelled) {\r\n    if (this._modalstate) {\r\n      modalstack.pop();\r\n    }\r\n\r\n    if (this._overdraw !== undefined) {\r\n      this._overdraw.end();\r\n      this._overdraw = undefined;\r\n    }\r\n\r\n    if (was_cancelled && this._on_cancel !== undefined) {\r\n      if (this._accept) {\r\n        this._accept(this.modal_ctx, true);\r\n      }\r\n\r\n      this._on_cancel(this);\r\n      this._on_cancel = undefined;\r\n    }\r\n\r\n    this.resetTempGeom();\r\n\r\n    var ctx = this.modal_ctx;\r\n\r\n    this.modal_ctx = undefined;\r\n    this.modalRunning = false;\r\n    this.is_modal = false;\r\n\r\n    super.popModal();\r\n\r\n    this._promise = undefined;\r\n\r\n    if (this._accept) {\r\n      this._accept(ctx, false);//Context, was_cancelled\r\n      this._accept = this._reject = undefined;\r\n    }\r\n\r\n    this.saveDefaultInputs();\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    let outs = this.outputs;\r\n    let ins = this.inputs;\r\n\r\n    this.inputs = {};\r\n    this.outputs = {};\r\n\r\n    for (let pair of ins) {\r\n      this.inputs[pair.key] = pair.val;\r\n    }\r\n\r\n    for (let pair of outs) {\r\n      this.outputs[pair.key] = pair.val;\r\n    }\r\n  }\r\n\r\n  _save_inputs() {\r\n    let ret = [];\r\n    for (let k in this.inputs) {\r\n      ret.push(new PropKey(k, this.inputs[k]));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  _save_outputs() {\r\n    let ret = [];\r\n    for (let k in this.outputs) {\r\n      ret.push(new PropKey(k, this.outputs[k]));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nToolOp.STRUCT = `\r\ntoolsys.ToolOp {\r\n  inputs  : array(toolsys.PropKey) | this._save_inputs();\r\n  outputs : array(toolsys.PropKey) | this._save_outputs();\r\n}\r\n`;\r\nnstructjs.register(ToolOp);\r\n\r\nclass PropKey {\r\n  constructor(key, val) {\r\n    this.key = key;\r\n    this.val = val;\r\n  }\r\n}\r\n\r\nPropKey.STRUCT = `\r\ntoolsys.PropKey {\r\n  key : string;\r\n  val : abstract(ToolProperty);\r\n}\r\n`;\r\nnstructjs.register(PropKey);\r\n\r\nexport class MacroLink {\r\n  constructor(sourcetool_idx, srckey, srcprops = \"outputs\", desttool_idx, dstkey, dstprops = \"inputs\") {\r\n    this.source = sourcetool_idx;\r\n    this.dest = desttool_idx;\r\n\r\n    this.sourceProps = srcprops;\r\n    this.destProps = dstprops;\r\n\r\n    this.sourcePropKey = srckey;\r\n    this.destPropKey = dstkey;\r\n  }\r\n}\r\n\r\nMacroLink.STRUCT = `\r\ntoolsys.MacroLink {\r\n  source         : int;\r\n  dest           : int;\r\n  sourcePropKey  : string;\r\n  destPropKey    : string;\r\n  sourceProps    : string;\r\n  destProps      : string; \r\n}\r\n`;\r\nnstructjs.register(MacroLink);\r\n\r\nexport const MacroClasses = {};\r\nwindow._MacroClasses = MacroClasses;\r\n\r\nlet macroidgen = 0;\r\n\r\n\r\nexport class ToolMacro extends ToolOp {\r\n  constructor() {\r\n    super();\r\n\r\n    this.tools = [];\r\n    this.curtool = 0;\r\n    this.has_modal = false;\r\n    this.connects = [];\r\n    this.connectLinks = [];\r\n\r\n    this._macro_class = undefined;\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname: \"Tool Macro\"\r\n    }\r\n  }\r\n\r\n  //toolop is an optional instance of this class, may be undefined\r\n  static canRun(ctx, toolop = undefined) {\r\n    return true;\r\n  }\r\n\r\n  _getTypeClass() {\r\n    if (this._macro_class && this._macro_class.ready) {\r\n      return this._macro_class;\r\n    }\r\n\r\n    if (!this._macro_class) {\r\n      this._macro_class = class MacroTypeClass extends ToolOp {\r\n        static tooldef() {\r\n          return this.__tooldef;\r\n        }\r\n      }\r\n\r\n      this._macro_class.__tooldef = {\r\n        toolpath: this.constructor.tooldef().toolpath || ''\r\n      };\r\n      this._macro_class.ready = false;\r\n    }\r\n\r\n    if (!this.tools || this.tools.length === 0) {\r\n      /* We've been invoked by ToolOp constructor,\r\n      *  for now just return an empty class  */\r\n      return this._macro_class;\r\n    }\r\n\r\n    let key = \"\";\r\n    for (let tool of this.tools) {\r\n      key = tool.constructor.name + \":\";\r\n    }\r\n\r\n    /* Handle child classes of ToolMacro */\r\n    if (this.constructor !== ToolMacro) {\r\n      key += \":\" + this.constructor.tooldef().toolpath;\r\n    }\r\n\r\n    for (let k in this.inputs) {\r\n      key += k + \":\";\r\n    }\r\n\r\n    if (key in MacroClasses) {\r\n      this._macro_class = MacroClasses[key];\r\n      return this._macro_class;\r\n    }\r\n\r\n    let name = \"Macro(\"\r\n    let i = 0;\r\n    let is_modal;\r\n\r\n    for (let tool of this.tools) {\r\n      let def = tool.constructor.tooldef();\r\n\r\n      if (i > 0) {\r\n        name += \", \";\r\n      } else {\r\n        is_modal = def.is_modal;\r\n      }\r\n\r\n      if (def.uiname) {\r\n        name += def.uiname;\r\n      } else if (def.toolpath) {\r\n        name += def.toolpath;\r\n      } else {\r\n        name += tool.constructor.name;\r\n      }\r\n\r\n      i++;\r\n    }\r\n\r\n    let inputs = {};\r\n\r\n    for (let k in this.inputs) {\r\n      inputs[k] = this.inputs[k].copy().clearEventCallbacks();\r\n      inputs[k].wasSet = false;\r\n    }\r\n\r\n    let tdef = {\r\n      uiname  : name,\r\n      toolpath: key,\r\n      inputs,\r\n      outputs : {},\r\n      is_modal\r\n    };\r\n\r\n    let cls = this._macro_class;\r\n    cls.__tooldef = tdef;\r\n    cls._macroTypeId = macroidgen++;\r\n    cls.ready = true;\r\n\r\n    /*\r\n    let cls = {\r\n      name : key,\r\n      tooldef() {\r\n        return tdef\r\n      },\r\n      _getFinalToolDef() {\r\n        return this.tooldef();\r\n      }\r\n    };//*/\r\n\r\n    MacroClasses[key] = cls;\r\n\r\n    return cls;\r\n  }\r\n\r\n  saveDefaultInputs() {\r\n    for (let k in this.inputs) {\r\n      let prop = this.inputs[k];\r\n\r\n      if (prop.flag & PropFlags.SAVE_LAST_VALUE) {\r\n        SavedToolDefaults.set(this._getTypeClass(), k, prop);\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  hasDefault(toolprop, key = toolprop.apiname) {\r\n    return SavedToolDefaults.has(this._getTypeClass(), key, toolprop);\r\n  }\r\n\r\n  getDefault(toolprop, key = toolprop.apiname) {\r\n    let cls = this._getTypeClass();\r\n\r\n    if (SavedToolDefaults.has(cls, key, toolprop)) {\r\n      return SavedToolDefaults.get(cls, key, toolprop);\r\n    } else {\r\n      return toolprop.getValue();\r\n    }\r\n  }\r\n\r\n  connect(srctool, srcoutput, dsttool, dstinput, srcprops = \"outputs\", dstprops = \"inputs\") {\r\n    if (typeof dsttool === \"function\") {\r\n      return this.connectCB(...arguments);\r\n    }\r\n\r\n    let i1 = this.tools.indexOf(srctool);\r\n    let i2 = this.tools.indexOf(dsttool);\r\n\r\n    if (i1 < 0 || i2 < 0) {\r\n      throw new Error(\"tool not in macro\");\r\n    }\r\n\r\n    //remove linked properties from this.inputs\r\n    if (srcprops === \"inputs\") {\r\n      let tool = this.tools[i1];\r\n\r\n      let prop = tool.inputs[srcoutput];\r\n      if (prop === this.inputs[srcoutput]) {\r\n        delete this.inputs[srcoutput];\r\n      }\r\n    }\r\n\r\n    if (dstprops === \"inputs\") {\r\n      let tool = this.tools[i2];\r\n      let prop = tool.inputs[dstinput];\r\n\r\n      if (this.inputs[dstinput] === prop) {\r\n        delete this.inputs[dstinput];\r\n      }\r\n    }\r\n\r\n    this.connectLinks.push(new MacroLink(i1, srcoutput, srcprops, i2, dstinput, dstprops));\r\n    return this;\r\n  }\r\n\r\n  connectCB(srctool, dsttool, callback, thisvar) {\r\n    this.connects.push({\r\n      srctool : srctool,\r\n      dsttool : dsttool,\r\n      callback: callback,\r\n      thisvar : thisvar\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  add(tool) {\r\n    if (tool.is_modal) {\r\n      this.is_modal = true;\r\n    }\r\n\r\n    for (let k in tool.inputs) {\r\n      let prop = tool.inputs[k];\r\n\r\n      if (!(prop.flag & PropFlags.PRIVATE)) {\r\n        this.inputs[k] = prop;\r\n      }\r\n    }\r\n\r\n    this.tools.push(tool);\r\n\r\n    return this;\r\n  }\r\n\r\n  _do_connections(tool) {\r\n    let i = this.tools.indexOf(tool);\r\n\r\n    for (let c of this.connectLinks) {\r\n      if (c.source === i) {\r\n        let tool2 = this.tools[c.dest];\r\n\r\n        tool2[c.destProps][c.destPropKey].setValue(tool[c.sourceProps][c.sourcePropKey].getValue());\r\n      }\r\n    }\r\n\r\n    for (var c of this.connects) {\r\n      if (c.srctool === tool) {\r\n        c.callback.call(c.thisvar, c.srctool, c.dsttool);\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n  canRun(ctx) {\r\n    if (this.tools.length == 0)\r\n      return false;\r\n\r\n    //poll first tool only in list\r\n    return this.tools[0].constructor.canRun(ctx);\r\n  }//*/\r\n\r\n  modalStart(ctx) {\r\n    //macros obviously can't call loadDefaults in the constructor\r\n    //like normal tool ops can.\r\n    this.loadDefaults(false);\r\n\r\n    this._promise = new Promise((function (accept, reject) {\r\n      this._accept = accept;\r\n      this._reject = reject;\r\n    }).bind(this));\r\n\r\n    this.curtool = 0;\r\n\r\n    let i;\r\n\r\n    for (i = 0; i < this.tools.length; i++) {\r\n      if (this.tools[i].is_modal)\r\n        break;\r\n\r\n      this.tools[i].undoPre(ctx);\r\n      this.tools[i].execPre(ctx);\r\n      this.tools[i].exec(ctx);\r\n      this.tools[i].execPost(ctx);\r\n      this._do_connections(this.tools[i]);\r\n    }\r\n\r\n    var on_modal_end = (function on_modal_end() {\r\n      this._do_connections(this.tools[this.curtool]);\r\n      this.curtool++;\r\n\r\n      while (this.curtool < this.tools.length &&\r\n      !this.tools[this.curtool].is_modal) {\r\n        this.tools[this.curtool].undoPre(ctx);\r\n        this.tools[this.curtool].execPre(ctx);\r\n        this.tools[this.curtool].exec(ctx);\r\n        this.tools[this.curtool].execPost(ctx);\r\n        this._do_connections(this.tools[this.curtool]);\r\n\r\n        this.curtool++;\r\n      }\r\n\r\n      if (this.curtool < this.tools.length) {\r\n        this.tools[this.curtool].undoPre(ctx);\r\n        this.tools[this.curtool].modalStart(ctx).then(on_modal_end);\r\n      } else {\r\n        this._accept(this, false);\r\n      }\r\n    }).bind(this);\r\n\r\n    if (i < this.tools.length) {\r\n      this.curtool = i;\r\n      this.tools[this.curtool].undoPre(ctx);\r\n      this.tools[this.curtool].modalStart(ctx).then(on_modal_end);\r\n    }\r\n\r\n    return this._promise;\r\n  }\r\n\r\n  loadDefaults(force = true) {\r\n    return super.loadDefaults(force);\r\n  }\r\n\r\n  exec(ctx) {\r\n    //macros obviously can't call loadDefaults in the constructor\r\n    //like normal tool ops can.\r\n    //note that this will detect if the user changes property values\r\n\r\n    this.loadDefaults(false);\r\n\r\n    for (var i = 0; i < this.tools.length; i++) {\r\n      this.tools[i].undoPre(ctx);\r\n      this.tools[i].execPre(ctx);\r\n      this.tools[i].exec(ctx);\r\n      this.tools[i].execPost(ctx);\r\n      this._do_connections(this.tools[i]);\r\n    }\r\n  }\r\n\r\n  calcUndoMem(ctx) {\r\n    let tot = 0;\r\n\r\n    for (let tool of this.tools) {\r\n      tot += tool.calcUndoMem(ctx);\r\n    }\r\n\r\n    return tot;\r\n  }\r\n\r\n  calcMemSize(ctx) {\r\n    let tot = 0;\r\n\r\n    for (let tool of this.tools) {\r\n      tot += tool.calcMemSize(ctx);\r\n    }\r\n\r\n    return tot;\r\n  }\r\n\r\n  undoPre() {\r\n    return; //undoPre is handled in exec() or modalStart()\r\n  }\r\n\r\n  undo(ctx) {\r\n    for (var i = this.tools.length - 1; i >= 0; i--) {\r\n      this.tools[i].undo(ctx);\r\n    }\r\n  }\r\n}\r\n\r\nToolMacro.STRUCT = nstructjs.inherit(ToolMacro, ToolOp, \"toolsys.ToolMacro\") + `\r\n  tools        : array(abstract(toolsys.ToolOp));\r\n  connectLinks : array(toolsys.MacroLink);\r\n}\r\n`;\r\nnstructjs.register(ToolMacro);\r\n\r\nexport class ToolStack extends Array {\r\n  constructor(ctx) {\r\n    super();\r\n\r\n    this.memLimit = 512*1024*1024;\r\n    this.enforceMemLimit = false;\r\n\r\n    this.cur = -1;\r\n    this.ctx = ctx;\r\n\r\n    this.modalRunning = 0;\r\n\r\n    this._undo_branch = undefined; //used to save undo branch in case of tool cancel\r\n  }\r\n\r\n  get head() {\r\n    return this[this.cur];\r\n  }\r\n\r\n  limitMemory(maxmem = this.memLimit, ctx = this.ctx) {\r\n    if (maxmem === undefined) {\r\n      throw new Error(\"maxmem cannot be undefined\");\r\n    }\r\n\r\n    let size = this.calcMemSize();\r\n\r\n    let start = 0;\r\n\r\n    while (start < this.cur - 2 && size > maxmem) {\r\n      size -= this[start].calcMemSize(ctx);\r\n      start++;\r\n    }\r\n\r\n    if (start === 0) {\r\n      return size;\r\n    }\r\n\r\n    for (let i = 0; i < start; i++) {\r\n      this[i].onUndoDestroy();\r\n    }\r\n\r\n    this.cur -= start;\r\n\r\n    for (let i = 0; i < this.length - start; i++) {\r\n      this[i] = this[i + start];\r\n    }\r\n    this.length -= start;\r\n\r\n    return this.calcMemSize(ctx);\r\n  }\r\n\r\n  calcMemSize(ctx = this.ctx) {\r\n    let tot = 0;\r\n\r\n    for (let tool of this) {\r\n      try {\r\n        tot += tool.calcMemSize();\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        console.error(\"Failed to execute a calcMemSize method\");\r\n      }\r\n    }\r\n\r\n    return tot;\r\n  }\r\n\r\n  setRestrictedToolContext(ctx) {\r\n    this.toolctx = ctx;\r\n  }\r\n\r\n  reset(ctx) {\r\n    if (ctx !== undefined) {\r\n      this.ctx = ctx;\r\n    }\r\n\r\n    this.modalRunning = 0;\r\n    this.cur = -1;\r\n    this.length = 0;\r\n  }\r\n\r\n  /**\r\n   * runs .undo,.redo if toolstack head is same as tool\r\n   *\r\n   * otherwise, .execTool(ctx, tool) is called.\r\n   *\r\n   * @param compareInputs : check if toolstack head has identical input values, defaults to false\r\n   * */\r\n  execOrRedo(ctx, tool, compareInputs = false) {\r\n    let head = this.head;\r\n\r\n    let ok = compareInputs ? ToolOp.Equals(head, tool) : head && head.constructor === tool.constructor;\r\n\r\n    tool.__memsize = undefined; //reset cache memsize\r\n\r\n    if (ok) {\r\n      //console.warn(\"Same tool detected\");\r\n\r\n      this.undo();\r\n\r\n      //can inputs differ? in that case, execute new tool\r\n      if (!compareInputs) {\r\n        this.execTool(ctx, tool);\r\n      } else {\r\n        this.rerun();\r\n      }\r\n\r\n      return false;\r\n    } else {\r\n      this.execTool(ctx, tool);\r\n      return true;\r\n    }\r\n  }\r\n\r\n  execTool(ctx, toolop) {\r\n    if (this.enforceMemLimit) {\r\n      this.limitMemory(this.memLimit, ctx);\r\n    }\r\n\r\n    if (!toolop.constructor.canRun(ctx, toolop)) {\r\n      console.log(\"toolop.constructor.canRun returned false\");\r\n      return;\r\n    }\r\n\r\n    let tctx = ctx.toLocked();\r\n\r\n    let undoflag = toolop.constructor.tooldef().undoflag;\r\n    if (toolop.undoflag !== undefined) {\r\n      undoflag = toolop.undoflag;\r\n    }\r\n    undoflag = undoflag === undefined ? 0 : undoflag;\r\n\r\n    //if (!(undoflag & UndoFlags.IS_UNDO_ROOT) && !(undoflag & UndoFlags.NO_UNDO)) {\r\n    //tctx = new SavedContext(ctx, ctx.datalib);\r\n    //}\r\n\r\n    toolop.execCtx = tctx;\r\n\r\n    if (!(undoflag & UndoFlags.NO_UNDO)) {\r\n      this.cur++;\r\n\r\n      //save branch for if tool cancel\r\n      this._undo_branch = this.slice(this.cur + 1, this.length);\r\n\r\n      //truncate\r\n      this.length = this.cur + 1;\r\n\r\n      this[this.cur] = toolop;\r\n      toolop.undoPre(tctx);\r\n    }\r\n\r\n    if (toolop.is_modal) {\r\n      ctx = toolop.modal_ctx = ctx;\r\n\r\n      this.modal_running = true;\r\n\r\n      toolop._on_cancel = (function (toolop) {\r\n        if (!(toolop.undoflag & UndoFlags.NO_UNDO)) {\r\n          this[this.cur].undo(ctx);\r\n          this.pop_i(this.cur);\r\n          this.cur--;\r\n        }\r\n      }).bind(this);\r\n\r\n      //will handle calling .exec itself\r\n      toolop.modalStart(ctx);\r\n    } else {\r\n      toolop.execPre(tctx);\r\n      toolop.exec(tctx);\r\n      toolop.execPost(tctx);\r\n      toolop.saveDefaultInputs();\r\n    }\r\n  }\r\n\r\n  toolCancel(ctx, tool) {\r\n    if (tool._was_redo) { //also set by toolstack.redo\r\n      //ignore tool cancel requests on redo\r\n      return;\r\n    }\r\n\r\n    if (tool !== this[this.cur]) {\r\n      console.warn(\"toolCancel called in error\", this, tool);\r\n      return;\r\n    }\r\n\r\n    this.undo();\r\n    this.length = this.cur + 1;\r\n\r\n    if (this._undo_branch !== undefined) {\r\n      for (let item of this._undo_branch) {\r\n        this.push(item);\r\n      }\r\n    }\r\n  }\r\n\r\n  undo() {\r\n    if (this.enforceMemLimit) {\r\n      this.limitMemory(this.memLimit);\r\n    }\r\n\r\n    if (this.cur >= 0 && !(this[this.cur].undoflag & UndoFlags.IS_UNDO_ROOT)) {\r\n      let tool = this[this.cur];\r\n\r\n      tool.undo(tool.execCtx);\r\n\r\n      this.cur--;\r\n    }\r\n  }\r\n\r\n  //reruns a tool if it's at the head of the stack\r\n  rerun(tool) {\r\n    if (this.enforceMemLimit) {\r\n      this.limitMemory(this.memLimit);\r\n    }\r\n\r\n    if (tool === this[this.cur]) {\r\n      tool._was_redo = false;\r\n\r\n      if (!tool.execCtx) {\r\n        tool.execCtx = this.ctx;\r\n      }\r\n\r\n      tool.undo(tool.execCtx);\r\n\r\n      tool._was_redo = true; //also set by toolstack.redo\r\n\r\n      tool.undoPre(tool.execCtx);\r\n      tool.execPre(tool.execCtx);\r\n      tool.exec(tool.execCtx);\r\n      tool.execPost(tool.execCtx);\r\n    } else {\r\n      console.warn(\"Tool wasn't at head of stack\", tool);\r\n    }\r\n  }\r\n\r\n  redo() {\r\n    if (this.enforceMemLimit) {\r\n      this.limitMemory(this.memLimit);\r\n    }\r\n\r\n    if (this.cur >= -1 && this.cur + 1 < this.length) {\r\n      //console.log(\"redo!\", this.cur, this.length);\r\n\r\n      this.cur++;\r\n      let tool = this[this.cur];\r\n\r\n\r\n      if (!tool.execCtx) {\r\n        tool.execCtx = this.ctx;\r\n      }\r\n\r\n      tool._was_redo = true;\r\n      tool.redo(tool.execCtx);\r\n\r\n      tool.saveDefaultInputs();\r\n    }\r\n  }\r\n\r\n  save() {\r\n    let data = [];\r\n    nstructjs.writeObject(data, this);\r\n    return data;\r\n  }\r\n\r\n  rewind() {\r\n    while (this.cur >= 0) {\r\n      let last = this.cur;\r\n      this.undo();\r\n\r\n      //prevent infinite loops\r\n      if (last === this.cur) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**cb is a function(ctx), if it returns the value false then playback stops\r\n   promise will still be fulfilled.\r\n\r\n   onstep is a callback, if it returns a promise that promise will be\r\n   waited on, otherwise execution is queue with window.setTimeout().\r\n   */\r\n  replay(cb, onStep) {\r\n    let cur = this.cur;\r\n\r\n    this.rewind();\r\n\r\n    let last = this.cur;\r\n\r\n    let start = util.time_ms();\r\n\r\n    return new Promise((accept, reject) => {\r\n      let next = () => {\r\n        last = this.cur;\r\n\r\n        if (cb && cb(ctx) === false) {\r\n          accept();\r\n          return;\r\n        }\r\n\r\n        if (this.cur < this.length) {\r\n          this.cur++;\r\n          this.rerun();\r\n        }\r\n\r\n        if (last === this.cur) {\r\n          console.warn(\"time:\", (util.time_ms() - start)/1000.0);\r\n          accept(this);\r\n        } else {\r\n          if (onStep) {\r\n            let ret = onStep();\r\n\r\n            if (ret && ret instanceof Promise) {\r\n              ret.then(() => {\r\n                next();\r\n              });\r\n            } else {\r\n              window.setTimeout(() => {\r\n                next();\r\n              })\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      next();\r\n    });\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    for (let item of this._stack) {\r\n      this.push(item);\r\n    }\r\n\r\n    delete this._stack;\r\n  }\r\n\r\n  //note that this makes sure tool classes are registered with nstructjs\r\n  //during save\r\n  _save() {\r\n    for (let tool of this) {\r\n      let cls = tool.constructor;\r\n\r\n      if (!nstructjs.isRegistered(cls)) {\r\n        cls._regWithNstructjs(cls);\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nToolStack.STRUCT = `\r\ntoolsys.ToolStack {\r\n  cur    : int;\r\n  _stack : array(abstract(toolsys.ToolOp)) | this._save();\r\n}\r\n`;\r\nnstructjs.register(ToolStack);\r\n\r\nwindow._testToolStackIO = function () {\r\n  let data = [];\r\n  let cls = _appstate.toolstack.constructor;\r\n\r\n  nstructjs.writeObject(data, _appstate.toolstack);\r\n  data = new DataView(new Uint8Array(data).buffer);\r\n\r\n  let toolstack = nstructjs.readObject(data, cls);\r\n\r\n  _appstate.toolstack.rewind();\r\n\r\n  toolstack.cur = -1;\r\n  toolstack.ctx = _appstate.toolstack.ctx;\r\n  _appstate.toolstack = toolstack;\r\n\r\n  return toolstack;\r\n}\r\n\r\nexport function buildToolOpAPI(api, cls) {\r\n  let st = api.mapStruct(cls, true);\r\n  let def = cls._getFinalToolDef();\r\n\r\n  if (window.DEBUG && window.DEBUG.datapaths) {\r\n    console.log(\"Building api for \", def.toolpath);\r\n  }\r\n\r\n  function makeProp(k) {\r\n    let prop = def.inputs[k];\r\n\r\n    if (prop.flag & (PropFlags.PRIVATE | PropFlags.READ_ONLY)) {\r\n      return;\r\n    }\r\n\r\n    prop.uiname = prop.uiname || ToolProperty.makeUIName(k);\r\n\r\n    let dpath = new DataPath(k, k, prop);\r\n    st.add(dpath);\r\n\r\n    dpath.customGetSet(function () {\r\n      return this.dataref.inputs[k].getValue()\r\n    }, function (val) {\r\n      this.dataref.inputs[k].setValue(val);\r\n    });\r\n  }\r\n\r\n  for (let k in def.inputs) {\r\n    makeProp(k);\r\n  }\r\n\r\n  return st;\r\n}\r\n\r\n/**\r\n * Call this to build the tool property cache data binding API.\r\n *\r\n * If rootCtxClass is not undefined and insertToolDefaultsIntoContext is true\r\n * then \".toolDefaults\" will be automatically added to rootCtxClass's prototype\r\n * if necessary.\r\n */\r\nexport function buildToolSysAPI(api, registerWithNStructjs    = true,\r\n                                rootCtxStruct                 = undefined,\r\n                                rootCtxClass                  = undefined,\r\n                                insertToolDefaultsIntoContext = true) {\r\n  let datastruct = api.mapStruct(ToolPropertyCache, true);\r\n\r\n  for (let cls of ToolClasses) {\r\n    let def = cls._getFinalToolDef();\r\n\r\n    buildToolOpAPI(api, cls);\r\n\r\n    for (let k in def.inputs) {\r\n      let prop = def.inputs[k];\r\n\r\n      if (!(prop.flag & (PropFlags.PRIVATE | PropFlags.READ_ONLY))) {\r\n        SavedToolDefaults._buildAccessors(cls, k, prop, datastruct, api);\r\n      }\r\n    }\r\n  }\r\n\r\n  if (rootCtxStruct) {\r\n    rootCtxStruct.struct(\"toolDefaults\", \"toolDefaults\", \"Tool Defaults\", api.mapStruct(ToolPropertyCache));\r\n    rootCtxStruct.dynamicStruct(\"last_tool\", \"last_tool\", \"Last Tool\");\r\n  }\r\n\r\n  if (rootCtxClass && insertToolDefaultsIntoContext) {\r\n    let inst = new rootCtxClass({});\r\n\r\n    function haveprop(k) {\r\n      return Reflect.ownKeys(inst).indexOf(k) >= 0\r\n        || Reflect.ownKeys(rootCtxClass.prototype).indexOf(k) >= 0;\r\n    }\r\n\r\n    if (!haveprop(\"last_tool\")) {\r\n      Object.defineProperty(rootCtxClass.prototype, \"last_tool\", {\r\n        get() {\r\n          return this.toolstack.head;\r\n        }\r\n      });\r\n\r\n      if (Context.isContextSubclass(rootCtxClass)) {\r\n        rootCtxClass.prototype.last_tool_save = () => ({});\r\n        rootCtxClass.prototype.last_tool_load = () => undefined;\r\n      }\r\n    }\r\n\r\n    if (!haveprop(\"toolDefaults\")) {\r\n      Object.defineProperty(rootCtxClass.prototype, \"toolDefaults\", {\r\n        get() {\r\n          return SavedToolDefaults;\r\n        }\r\n      });\r\n\r\n      if (Context.isContextSubclass(rootCtxClass)) {\r\n        rootCtxClass.prototype.toolDefaults_save = () => ({});\r\n        rootCtxClass.prototype.toolDefaults_load = () => undefined;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (!registerWithNStructjs) {\r\n    return;\r\n  }\r\n\r\n  //register tools with nstructjs\r\n  for (let cls of ToolClasses) {\r\n    try {\r\n      if (!nstructjs.isRegistered(cls)) {\r\n        ToolOp._regWithNstructjs(cls);\r\n      }\r\n    } catch (error) {\r\n      console.log(error.stack);\r\n      console.error(\"Failed to register a tool with nstructjs\");\r\n    }\r\n  }\r\n}\r\n","\"use strict\";\r\n\r\n/**\r\n *\r\n * A not-so-simple 1d bspline curve class.\r\n *\r\n * It's actually a 2d bspline curve class that\r\n * uses a root finding algorithm to find the value\r\n * along the x dimension.\r\n *\r\n * To make things worse, due to the rule that widgets\r\n * cannot store direct references into the data model\r\n * there is a lot of weird event handling code that's\r\n * used by curve widgets to sync their internal curve copy\r\n * and the model.\r\n **/\r\nimport nstructjs from \"../util/struct.js\";\r\nimport config from \"../config/config.js\";\r\nimport { ToolOp } from \"../toolsys/toolsys.js\";\r\n\r\nimport * as util from \"../util/util.js\";\r\n//import * as ui_base from './ui_base.js';\r\nimport * as vectormath from \"../util/vectormath.js\";\r\n//import {EventDispatcher} from \"../util/events.js\";\r\n\r\nlet Vector2 = vectormath.Vector2;\r\n\r\nexport const SplineTemplates = {\r\n  CONSTANT      : 0,\r\n  LINEAR        : 1,\r\n  SHARP         : 2,\r\n  SQRT          : 3,\r\n  SMOOTH        : 4,\r\n  SMOOTHER      : 5,\r\n  SHARPER       : 6,\r\n  SPHERE        : 7,\r\n  REVERSE_LINEAR: 8,\r\n  GUASSIAN      : 9,\r\n};\r\n\r\nconst templates = {\r\n  [SplineTemplates.CONSTANT]: [\r\n    [1, 1],\r\n    [1, 1],\r\n  ],\r\n  [SplineTemplates.LINEAR]: [\r\n    [0, 0],\r\n    [1, 1],\r\n  ],\r\n  [SplineTemplates.SHARP]: [\r\n    [0, 0],\r\n    [0.9999, 0.0001],\r\n    [1, 1],\r\n  ],\r\n  [SplineTemplates.SQRT]: [\r\n    [0, 0],\r\n    [0.05, 0.25],\r\n    [0.15, 0.45],\r\n    [0.33, 0.65],\r\n    [1, 1],\r\n  ],\r\n  [SplineTemplates.SMOOTH]        : [\"DEG\", 3, [0, 0], [1.0 / 3.0, 0], [2.0 / 3.0, 1.0], [1, 1]],\r\n  [SplineTemplates.SMOOTHER]      : [\"DEG\", 6, [0, 0], [1.0 / 2.25, 0], [2.0 / 3.0, 1.0], [1, 1]],\r\n  [SplineTemplates.SHARPER]: [\r\n    [0, 0],\r\n    [0.3, 0.03],\r\n    [0.7, 0.065],\r\n    [0.9, 0.16],\r\n    [1, 1],\r\n  ],\r\n  [SplineTemplates.SPHERE]: [\r\n    [0, 0],\r\n    [0.01953, 0.23438],\r\n    [0.08203, 0.43359],\r\n    [0.18359, 0.625],\r\n    [0.35938, 0.81641],\r\n    [0.625, 0.97656],\r\n    [1, 1],\r\n  ],\r\n  [SplineTemplates.REVERSE_LINEAR]: [\r\n    [0, 1],\r\n    [1, 0],\r\n  ],\r\n  [SplineTemplates.GUASSIAN]: [\"DEG\", 5, [0, 0], [0.17969, 0.007], [0.48958, 0.01172], [0.77995, 0.99609], [1, 1]],\r\n};\r\n\r\n//is initialized below\r\nexport const SplineTemplateIcons = {};\r\n\r\nlet RecalcFlags = {\r\n  BASIS: 1,\r\n  FULL : 2,\r\n  ALL  : 3,\r\n\r\n  //private flag\r\n  FULL_BASIS: 4,\r\n};\r\n\r\nexport function mySafeJSONStringify(obj) {\r\n  return JSON.stringify(obj.toJSON(), function (key) {\r\n    let v = this[key];\r\n\r\n    if (typeof v === \"number\") {\r\n      if (v !== Math.floor(v)) {\r\n        v = parseFloat(v.toFixed(5));\r\n      } else {\r\n        v = v;\r\n      }\r\n    }\r\n\r\n    return v;\r\n  });\r\n}\r\n\r\nexport function mySafeJSONParse(buf) {\r\n  return JSON.parse(buf, (key, val) => {});\r\n}\r\n\r\nwindow.mySafeJSONStringify = mySafeJSONStringify;\r\n\r\nlet bin_cache = {};\r\nwindow._bin_cache = bin_cache;\r\n\r\nlet eval2_rets = util.cachering.fromConstructor(Vector2, 32);\r\n\r\n/*\r\n  I hate these stupid curve widgets.  This horrible one here works by\r\n  root-finding the x axis on a two dimensional b-spline (which works\r\n  surprisingly well).\r\n*/\r\n\r\nfunction bez3(a, b, c, t) {\r\n  let r1 = a + (b - a) * t;\r\n  let r2 = b + (c - b) * t;\r\n\r\n  return r1 + (r2 - r1) * t;\r\n}\r\n\r\nfunction bez4(a, b, c, d, t) {\r\n  let r1 = bez3(a, b, c, t);\r\n  let r2 = bez3(b, c, d, t);\r\n\r\n  return r1 + (r2 - r1) * t;\r\n}\r\n\r\nexport function binomial(n, i) {\r\n  if (i > n) {\r\n    throw new Error(\"Bad call to binomial(n, i), i was > than n\");\r\n  }\r\n\r\n  if (i === 0 || i === n) {\r\n    return 1;\r\n  }\r\n\r\n  let key = \"\" + n + \",\" + i;\r\n\r\n  if (key in bin_cache) return bin_cache[key];\r\n\r\n  let ret = binomial(n - 1, i - 1) + bin(n - 1, i);\r\n  bin_cache[key] = ret;\r\n\r\n  return ret;\r\n}\r\n\r\nwindow.bin = binomial;\r\n\r\nimport { CurveFlags, TangentModes, CurveTypeData } from \"./curve1d_base.js\";\r\nimport {\r\n  BoolProperty,\r\n  EnumProperty,\r\n  FloatProperty,\r\n  IntProperty,\r\n  StringProperty,\r\n  Vec2Property,\r\n} from \"../toolsys/toolprop.js\";\r\n\r\nexport class Curve1dBSplineOpBase extends ToolOp {\r\n  static tooldef() {\r\n    return {\r\n      inputs: {\r\n        dataPath: new StringProperty(),\r\n      },\r\n      outputs: {},\r\n    };\r\n  }\r\n\r\n  _undo = undefined;\r\n\r\n  undoPre(ctx) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n    if (curve1d) {\r\n      this._undo = curve1d.copy();\r\n    } else {\r\n      this._undo = undefined;\r\n    }\r\n  }\r\n\r\n  undo(ctx) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n    if (curve1d) {\r\n      curve1d.load(this._undo);\r\n      curve1d._fireEvent(\"update\", curve1d);\r\n    }\r\n  }\r\n\r\n  getCurve1d(ctx) {\r\n    let { dataPath } = this.getInputs();\r\n\r\n    let curve1d;\r\n    try {\r\n      curve1d = ctx.api.getValue(ctx, dataPath);\r\n    } catch (error) {\r\n      console.error(error.stack);\r\n      console.error(error.message);\r\n      console.error(\"Failed to lookup curve1d property at path \", dataPath);\r\n      return;\r\n    }\r\n\r\n    return curve1d;\r\n  }\r\n\r\n  execPost(ctx) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n    if (curve1d) {\r\n      curve1d._fireEvent(\"update\", curve1d);\r\n    }\r\n  }\r\n}\r\n\r\nexport class Curve1dBSplineResetOp extends Curve1dBSplineOpBase {\r\n  static tooldef() {\r\n    return {\r\n      toolpath: \"curve1d.reset_bspline\",\r\n      inputs  : ToolOp.inherit({}),\r\n      outputs : {},\r\n    };\r\n  }\r\n\r\n  exec(ctx) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n    if (curve1d) {\r\n      curve1d.generators.active.reset();\r\n    }\r\n  }\r\n}\r\n\r\nToolOp.register(Curve1dBSplineResetOp);\r\n\r\nexport class Curve1dBSplineLoadTemplOp extends Curve1dBSplineOpBase {\r\n  static tooldef() {\r\n    return {\r\n      toolpath: \"curve1d.bspline_load_template\",\r\n      inputs: ToolOp.inherit({\r\n        template: new EnumProperty(SplineTemplates.SMOOTH, SplineTemplates),\r\n      }),\r\n      outputs : {},\r\n    };\r\n  }\r\n\r\n  exec(ctx) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n    let { template } = this.getInputs();\r\n\r\n    if (curve1d) {\r\n      curve1d.generators.active.loadTemplate(template);\r\n    }\r\n  }\r\n}\r\n\r\nToolOp.register(Curve1dBSplineLoadTemplOp);\r\n\r\nexport class Curve1dBSplineDeleteOp extends Curve1dBSplineOpBase {\r\n  static tooldef() {\r\n    return {\r\n      toolpath: \"curve1d.bspline_delete_point\",\r\n      inputs  : ToolOp.inherit({}),\r\n      outputs : {},\r\n    };\r\n  }\r\n\r\n  exec(ctx) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n\r\n    if (curve1d) {\r\n      curve1d.generators.active.deletePoint();\r\n    }\r\n  }\r\n}\r\n\r\nToolOp.register(Curve1dBSplineDeleteOp);\r\n\r\nexport class Curve1dBSplineSelectOp extends Curve1dBSplineOpBase {\r\n  static tooldef() {\r\n    return {\r\n      toolpath: \"curve1d.bspline_select_point\",\r\n      inputs: ToolOp.inherit({\r\n        point : new IntProperty(-1),\r\n        state : new BoolProperty(true),\r\n        unique: new BoolProperty(true),\r\n      }),\r\n      outputs : {},\r\n    };\r\n  }\r\n\r\n  exec(ctx) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n\r\n    if (curve1d) {\r\n      let bspline = curve1d.generators.active;\r\n      let { point, state, unique } = this.getInputs();\r\n\r\n      for (let p of bspline.points) {\r\n        if (p.eid === point) {\r\n          if (state) {\r\n            p.flag |= CurveFlags.SELECT;\r\n          } else {\r\n            p.flag &= ~CurveFlags.SELECT;\r\n          }\r\n        } else if (unique) {\r\n          p.flag &= ~CurveFlags.SELECT;\r\n        }\r\n      }\r\n\r\n      curve1d._fireEvent(\"select\", bspline);\r\n    }\r\n  }\r\n}\r\n\r\nToolOp.register(Curve1dBSplineSelectOp);\r\n\r\nexport class Curve1dBSplineAddOp extends Curve1dBSplineOpBase {\r\n  static tooldef() {\r\n    return {\r\n      toolpath: \"curve1d.bspline_add_point\",\r\n      inputs: ToolOp.inherit({\r\n        x: new FloatProperty(),\r\n        y: new FloatProperty(),\r\n      }),\r\n      outputs : {},\r\n    };\r\n  }\r\n\r\n  exec(ctx) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n\r\n    if (curve1d) {\r\n      let { x, y } = this.getInputs();\r\n      curve1d.generators.active.addFromMouse(x, y);\r\n    }\r\n  }\r\n}\r\n\r\nToolOp.register(Curve1dBSplineAddOp);\r\n\r\nexport class BSplineTransformOp extends ToolOp {\r\n  constructor() {\r\n    super();\r\n\r\n    this.first = true;\r\n    this.start_mpos = new Vector2();\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      toolpath: \"curve1d.transform_bspline\",\r\n      inputs: {\r\n        dataPath: new StringProperty(),\r\n        off     : new Vec2Property(),\r\n        dpi     : new FloatProperty(1.0),\r\n      },\r\n      is_modal: true,\r\n      outputs : {},\r\n    };\r\n  }\r\n\r\n  _undo = undefined;\r\n\r\n  storePoints(ctx) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n\r\n    if (curve1d) {\r\n      let bspline = curve1d.generators.active;\r\n      return Array.from(bspline.points).map((p) => p.copy());\r\n    }\r\n\r\n    return [];\r\n  }\r\n\r\n  loadPoints(ctx, ps) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n\r\n    if (curve1d) {\r\n      let bspline = curve1d.generators.active;\r\n\r\n      for (let p1 of bspline.points) {\r\n        for (let p2 of ps) {\r\n          if (p2.eid === p1.eid) {\r\n            p1.co.load(p2.co);\r\n            p1.rco.load(p2.rco);\r\n            p1.sco.load(p2.sco);\r\n          }\r\n        }\r\n      }\r\n\r\n      bspline.parent._fireEvent(\"transform\", bspline);\r\n\r\n      bspline.recalc = RecalcFlags.ALL;\r\n      bspline.updateKnots();\r\n      bspline.update();\r\n      bspline.redraw();\r\n    }\r\n  }\r\n\r\n  undoPre(ctx) {\r\n    this._undo = this.storePoints(ctx);\r\n  }\r\n\r\n  undo(ctx) {\r\n    this.loadPoints(ctx, this._undo);\r\n  }\r\n\r\n  getCurve1d(ctx) {\r\n    let { dataPath } = this.getInputs();\r\n\r\n    let curve1d;\r\n    try {\r\n      curve1d = ctx.api.getValue(ctx, dataPath);\r\n    } catch (error) {\r\n      console.error(error.stack);\r\n      console.error(error.message);\r\n      console.error(\"Failed to lookup curve1d property at path \", dataPath);\r\n      return;\r\n    }\r\n\r\n    return curve1d;\r\n  }\r\n\r\n  finish(cancel = false) {\r\n    let ctx = this.modal_ctx;\r\n    this.modalEnd(cancel);\r\n\r\n    let curve1d = this.getCurve1d(ctx);\r\n    if (curve1d) {\r\n      curve1d.generators.active.fastmode = false;\r\n    }\r\n\r\n    if (cancel) {\r\n      this.undo(ctx);\r\n    }\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    this.finish();\r\n  }\r\n\r\n  modalStart(ctx) {\r\n    super.modalStart(ctx);\r\n\r\n    let curve1d = this.getCurve1d(ctx);\r\n    if (!curve1d) {\r\n      console.log(\"Failed to get curve1d!\");\r\n      return;\r\n    }\r\n\r\n    let bspline = curve1d.generators.active;\r\n    for (let p of bspline.points) {\r\n      p.startco.load(p.co);\r\n    }\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let mpos = new Vector2().loadXY(e.x, e.y);\r\n    if (this.first) {\r\n      this.start_mpos.load(mpos);\r\n      this.first = false;\r\n      return;\r\n    }\r\n\r\n    let curve1d = this.getCurve1d(this.modal_ctx);\r\n    if (curve1d) {\r\n      curve1d.generators.active.fastmode = true;\r\n    }\r\n\r\n    const { dpi } = this.getInputs();\r\n    let off = new Vector2(mpos).sub(this.start_mpos).mulScalar(dpi);\r\n    off[1] = -off[1];\r\n\r\n    this.inputs.off.setValue(off);\r\n\r\n    const bspline = curve1d.generators.active;\r\n    for (let p of bspline.points) {\r\n      p.co.load(p.startco);\r\n    }\r\n\r\n    this.exec(this.modal_ctx);\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    this.finish();\r\n  }\r\n\r\n  exec(ctx) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n    if (!curve1d) {\r\n      return;\r\n    }\r\n\r\n    let bspline = curve1d.generators.active;\r\n    let { off } = this.getInputs();\r\n\r\n    const xRange = curve1d.xRange,\r\n      yRange = curve1d.yRange;\r\n\r\n    for (let p of bspline.points) {\r\n      if (p.flag & CurveFlags.SELECT) {\r\n        p.co.add(off);\r\n        p.co[0] = Math.min(Math.max(p.co[0], xRange[0]), xRange[1]);\r\n        p.co[1] = Math.min(Math.max(p.co[1], yRange[0]), yRange[1]);\r\n      }\r\n    }\r\n\r\n    bspline.parent._fireEvent(\"transform\", bspline);\r\n\r\n    bspline.recalc = RecalcFlags.ALL;\r\n    bspline.updateKnots();\r\n    bspline.update();\r\n    bspline.redraw();\r\n  }\r\n}\r\n\r\nToolOp.register(BSplineTransformOp);\r\n\r\nexport class Curve1DPoint {\r\n  constructor(co) {\r\n    this.co = new Vector2(co);\r\n    this.rco = new Vector2(co);\r\n    this.sco = new Vector2(co);\r\n\r\n    //for transform\r\n    this.startco = new Vector2();\r\n    this.eid = -1;\r\n    this.flag = 0;\r\n\r\n    this.tangent = TangentModes.SMOOTH;\r\n\r\n    Object.seal(this);\r\n  }\r\n\r\n  get 0() {\r\n    throw new Error(\"Curve1DPoint get 0\");\r\n  }\r\n\r\n  get 1() {\r\n    throw new Error(\"Curve1DPoint get 1\");\r\n  }\r\n\r\n  /* Needed for file compatibility. */\r\n  set 0(v) {\r\n    this.co[0] = v;\r\n  }\r\n\r\n  set 1(v) {\r\n    this.co[1] = v;\r\n  }\r\n\r\n  load(b) {\r\n    this.eid = b.eid;\r\n    this.flag = b.flag;\r\n    this.tangent = b.tangent;\r\n\r\n    this.co.load(b.co);\r\n    this.rco.load(b.rco);\r\n    this.sco.load(b.sco);\r\n    this.startco.load(b.startco);\r\n\r\n    return this;\r\n  }\r\n\r\n  set deg(v) {\r\n    console.warn(\"old file data detected\");\r\n  }\r\n\r\n  static fromJSON(obj) {\r\n    let ret = new Curve1DPoint(obj);\r\n\r\n    if (\"0\" in obj) {\r\n      ret.co[0] = obj[0];\r\n      ret.co[1] = obj[1];\r\n    } else {\r\n      ret.co.load(obj.co);\r\n    }\r\n\r\n    ret.startco.load(obj.startco);\r\n    ret.eid = obj.eid;\r\n    ret.flag = obj.flag;\r\n    ret.tangent = obj.tangent;\r\n\r\n    ret.rco.load(obj.rco);\r\n\r\n    return ret;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new Curve1DPoint(this.co);\r\n\r\n    ret.tangent = this.tangent;\r\n    ret.flag = this.flag;\r\n    ret.eid = this.eid;\r\n\r\n    ret.startco.load(this.startco);\r\n    ret.rco.load(this.rco);\r\n    ret.sco.load(this.sco);\r\n\r\n    return ret;\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      co     : this.co,\r\n      eid    : this.eid,\r\n      flag   : this.flag,\r\n      tangent: this.tangent,\r\n\r\n      rco    : this.rco,\r\n      startco: this.startco,\r\n    };\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    this.sco.load(this.co);\r\n    this.rco.load(this.co);\r\n\r\n    splineCache.update(this);\r\n  }\r\n}\r\nCurve1DPoint.STRUCT = `\r\nCurve1DPoint {\r\n  co      : vec2;\r\n  rco     : vec2;\r\n  sco     : vec2;\r\n  startco : vec2;\r\n  eid     : int;\r\n  flag    : int;\r\n  tangent : int;\r\n}\r\n`;\r\nnstructjs.register(Curve1DPoint);\r\n\r\nlet _udigest = new util.HashDigest();\r\n\r\nclass BSplineCache {\r\n  constructor() {\r\n    this.curves = [];\r\n    this.map = new Map();\r\n    this.maxCurves = 32;\r\n    this.gen = 0;\r\n  }\r\n\r\n  limit() {\r\n    if (this.curves.length <= this.maxCurves) {\r\n      return;\r\n    }\r\n\r\n    this.curves.sort((a, b) => b.cache_w - a.cache_w);\r\n    while (this.curves.length > this.maxCurves) {\r\n      let curve = this.curves.pop();\r\n      this.map.delete(curve.calcHashKey());\r\n    }\r\n  }\r\n\r\n  has(curve) {\r\n    let curve2 = this.map.get(curve.calcHashKey());\r\n    return curve2 && curve2.equals(curve);\r\n  }\r\n\r\n  get(curve) {\r\n    let key = curve.calcHashKey();\r\n    curve._last_cache_key = key;\r\n\r\n    let curve2 = this.map.get(key);\r\n    if (curve2 && curve2.equals(curve)) {\r\n      curve2.cache_w = this.gen++;\r\n      return curve2;\r\n    }\r\n\r\n    curve2 = curve.copy();\r\n    curve2._last_cache_key = key;\r\n\r\n    curve2.updateKnots();\r\n    curve2.regen_basis();\r\n    curve2.regen_hermite();\r\n\r\n    this.map.set(curve2);\r\n    this.curves.push(curve2);\r\n\r\n    curve2.cache_w = this.gen++;\r\n\r\n    this.limit();\r\n\r\n    return curve2;\r\n  }\r\n\r\n  _remove(key) {\r\n    let curve = this.map.get(key);\r\n    this.map.delete(key);\r\n    this.curves.remove(curve);\r\n  }\r\n\r\n  update(curve) {\r\n    let key = curve._last_cache_key;\r\n\r\n    if (this.map.has(key)) {\r\n      this._remove(curve);\r\n      this.get(curve);\r\n    }\r\n  }\r\n}\r\n\r\nlet splineCache = new BSplineCache();\r\nwindow._splineCache = splineCache;\r\n\r\nlet _idgen = 1;\r\n\r\nclass BSplineCurve extends CurveTypeData {\r\n  constructor() {\r\n    super();\r\n\r\n    this._bid = _idgen++;\r\n\r\n    this._degOffset = 0;\r\n    this.cache_w = 0;\r\n    this._last_cache_key = 0;\r\n\r\n    this.fastmode = false;\r\n    this.points = [];\r\n    this.length = 0;\r\n    this.interpolating = false;\r\n\r\n    this._ps = [];\r\n    this.hermite = [];\r\n    this.fastmode = false;\r\n\r\n    this.deg = 6;\r\n    this.recalc = RecalcFlags.ALL;\r\n    this.basis_tables = [];\r\n    this.eidgen = new util.IDGen();\r\n\r\n    this.add(0, 0);\r\n    this.add(1, 1);\r\n\r\n    this.mpos = new Vector2();\r\n\r\n    this.on_mousedown = this.on_mousedown.bind(this);\r\n    this.on_mousemove = this.on_mousemove.bind(this);\r\n    this.on_mouseup = this.on_mouseup.bind(this);\r\n    this.on_keydown = this.on_keydown.bind(this);\r\n    this.on_touchstart = this.on_touchstart.bind(this);\r\n    this.on_touchmove = this.on_touchmove.bind(this);\r\n    this.on_touchend = this.on_touchend.bind(this);\r\n    this.on_touchcancel = this.on_touchcancel.bind(this);\r\n  }\r\n\r\n  get hasGUI() {\r\n    return this.uidata !== undefined;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      uiname  : \"B-Spline\",\r\n      name    : \"bspline\",\r\n      typeName: \"BSplineCurve\",\r\n    };\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    let d = digest;\r\n\r\n    super.calcHashKey(d);\r\n\r\n    d.add(this.deg);\r\n    d.add(this.interpolating);\r\n    d.add(this.points.length);\r\n\r\n    for (let p of this.points) {\r\n      let x = ~~(p.co[0] * 1024);\r\n      let y = ~~(p.co[1] * 1024);\r\n\r\n      d.add(x);\r\n      d.add(y);\r\n      d.add(p.tangent); //is an enum\r\n    }\r\n\r\n    return d.get();\r\n  }\r\n\r\n  copyTo(b) {\r\n    b.deg = this.deg;\r\n    b.interpolating = this.interpolating;\r\n    b.fastmode = this.fastmode;\r\n\r\n    for (let p of this.points) {\r\n      let p2 = p.copy();\r\n\r\n      b.points.push(p2);\r\n    }\r\n\r\n    return b;\r\n  }\r\n\r\n  copy() {\r\n    let curve = new BSplineCurve();\r\n    this.copyTo(curve);\r\n    return curve;\r\n  }\r\n\r\n  equals(b) {\r\n    if (b.type !== this.type) {\r\n      return false;\r\n    }\r\n\r\n    let bad = this.points.length !== b.points.length;\r\n\r\n    bad = bad || this.deg !== b.deg;\r\n    bad = bad || this.interpolating !== b.interpolating;\r\n\r\n    if (bad) {\r\n      return false;\r\n    }\r\n\r\n    for (let i = 0; i < this.points.length; i++) {\r\n      let p1 = this.points[i];\r\n      let p2 = b.points[i];\r\n\r\n      if (p1.co.vectorDistance(p2.co) > 0.00001) {\r\n        return false;\r\n      }\r\n\r\n      if (p1.tangent !== p2.tangent) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  remove(p) {\r\n    let ret = this.points.remove(p);\r\n    this.length = this.points.length;\r\n\r\n    return ret;\r\n  }\r\n\r\n  add(x, y, no_update = false) {\r\n    let p = new Curve1DPoint();\r\n    this.recalc = RecalcFlags.ALL;\r\n\r\n    p.eid = this.eidgen.next();\r\n\r\n    p.co.loadXY(x, y);\r\n    p.sco.load(p.co);\r\n    p.rco.load(p.co);\r\n\r\n    this.points.push(p);\r\n    if (!no_update) {\r\n      this.update();\r\n    }\r\n\r\n    this.length = this.points.length;\r\n\r\n    return p;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  _sortPoints() {\r\n    if (!this.interpolating) {\r\n      for (let i = 0; i < this.points.length; i++) {\r\n        this.points[i].rco.load(this.points[i].co);\r\n      }\r\n    }\r\n\r\n    this.points.sort(function (a, b) {\r\n      return a.co[0] - b.co[0];\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  updateKnots(recalc = true, points = this.points) {\r\n    if (recalc) {\r\n      this.recalc = RecalcFlags.ALL;\r\n    }\r\n\r\n    this._sortPoints();\r\n\r\n    this._ps = [];\r\n    if (points.length < 2) {\r\n      return;\r\n    }\r\n    let a = points[0].co[0],\r\n      b = points[points.length - 1].co[0];\r\n\r\n    let degExtra = this.deg;\r\n    this._degOffset = -this.deg;\r\n\r\n    for (let i = 0; i < points.length - 1; i++) {\r\n      this._ps.push(points[i]);\r\n    }\r\n\r\n    if (degExtra) {\r\n      let last = points.length - 1;\r\n      for (let i = 0; i < degExtra; i++) {\r\n        let p = points[last].copy();\r\n        this._ps.push(p);\r\n      }\r\n    }\r\n\r\n    if (!this.interpolating) {\r\n      for (let i = 0; i < this._ps.length; i++) {\r\n        this._ps[i].rco.load(this._ps[i].co);\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < points.length; i++) {\r\n      let p = points[i];\r\n      let x = p.co[0],\r\n        y = p.co[1]; //this.evaluate(x);\r\n\r\n      p.sco[0] = x;\r\n      p.sco[1] = y;\r\n    }\r\n  }\r\n\r\n  toJSON() {\r\n    this._sortPoints();\r\n\r\n    let ret = super.toJSON();\r\n\r\n    ret = Object.assign(ret, {\r\n      points       : this.points.map((p) => p.toJSON()),\r\n      deg          : this.deg,\r\n      interpolating: this.interpolating,\r\n      eidgen       : this.eidgen.toJSON(),\r\n    });\r\n\r\n    return ret;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    this.interpolating = obj.interpolating;\r\n    this.deg = obj.deg;\r\n\r\n    this.length = 0;\r\n    this.points = [];\r\n    this._ps = [];\r\n\r\n    if (obj.range) {\r\n      /* Will be version patched later. */\r\n      this.range = [new Vector2(obj.range[0]), new Vector2(obj.range[1])];\r\n    }\r\n\r\n    this.hightlight = undefined;\r\n    this.eidgen = util.IDGen.fromJSON(obj.eidgen);\r\n    this.recalc = RecalcFlags.ALL;\r\n    this.mpos = [0, 0];\r\n\r\n    for (let i = 0; i < obj.points.length; i++) {\r\n      this.points.push(Curve1DPoint.fromJSON(obj.points[i]));\r\n    }\r\n\r\n    this.updateKnots();\r\n    this.redraw();\r\n\r\n    return this;\r\n  }\r\n\r\n  basis(t, i) {\r\n    if (this.recalc & RecalcFlags.FULL_BASIS) {\r\n      return this._basis(t, i);\r\n    }\r\n\r\n    if (this.recalc & RecalcFlags.BASIS) {\r\n      this.regen_basis();\r\n      this.recalc &= ~RecalcFlags.BASIS;\r\n    }\r\n\r\n    i = Math.min(Math.max(i, 0), this._ps.length - 1);\r\n    t = Math.min(Math.max(t, 0.0), 1.0) * 0.999999999;\r\n\r\n    let table = this.basis_tables[i];\r\n\r\n    let s = t * (table.length / 4) * 0.99999;\r\n\r\n    let j = ~~s;\r\n    s -= j;\r\n\r\n    j *= 4;\r\n\r\n    //return table[j] + (table[j + 3] - table[j])*s; //linear\r\n    return bez4(table[j], table[j + 1], table[j + 2], table[j + 3], s); //cubic\r\n  }\r\n\r\n  reset(empty = false) {\r\n    this.length = 0;\r\n    this.points = [];\r\n    this._ps = [];\r\n\r\n    if (!empty) {\r\n      this.add(0, 0, true);\r\n      this.add(1, 1, true);\r\n    }\r\n\r\n    this.recalc = 1;\r\n    this.updateKnots();\r\n    this.update();\r\n    this.redraw();\r\n\r\n    return this;\r\n  }\r\n\r\n  regen_hermite(steps) {\r\n    if (splineCache.has(this)) {\r\n      console.log(\"loading spline approx from cached bspline data\");\r\n\r\n      this.hermite = splineCache.get(this).hermite;\r\n      return;\r\n    }\r\n\r\n    if (steps === undefined) {\r\n      steps = this.fastmode ? 120 : 340;\r\n    }\r\n\r\n    if (this.interpolating) {\r\n      steps *= 2;\r\n    }\r\n\r\n    this.hermite = new Array(steps);\r\n    let table = this.hermite;\r\n\r\n    let eps = 0.00001;\r\n    let dt = (1.0 - eps * 4.001) / (steps - 1);\r\n    let t = eps * 4;\r\n    let lastdv1, lastf3;\r\n\r\n    for (let j = 0; j < steps; j++, t += dt) {\r\n      let f1 = this._evaluate(t - eps * 2);\r\n      let f2 = this._evaluate(t - eps);\r\n      let f3 = this._evaluate(t);\r\n      let f4 = this._evaluate(t + eps);\r\n      let f5 = this._evaluate(t + eps * 2);\r\n\r\n      let dv1 = (f4 - f2) / (eps * 2);\r\n      dv1 /= steps;\r\n\r\n      if (j > 0) {\r\n        let j2 = j - 1;\r\n\r\n        table[j2 * 4] = lastf3;\r\n        table[j2 * 4 + 1] = lastf3 + lastdv1 / 3.0;\r\n        table[j2 * 4 + 2] = f3 - dv1 / 3.0;\r\n        table[j2 * 4 + 3] = f3;\r\n      }\r\n\r\n      lastdv1 = dv1;\r\n      lastf3 = f3;\r\n    }\r\n  }\r\n\r\n  solve_interpolating() {\r\n    //this.recalc |= RecalcFlags.FULL_BASIS;\r\n\r\n    for (let p of this._ps) {\r\n      p.rco.load(p.co);\r\n    }\r\n\r\n    let points = this.points.concat(this.points);\r\n\r\n    this._evaluate2(0.5);\r\n\r\n    let error1 = (p) => {\r\n      //return p.vectorDistance(this._evaluate2(p.co[0]));\r\n      return this._evaluate(p.co[0]) - p.co[1];\r\n    };\r\n\r\n    let error = (p) => {\r\n      return error1(p);\r\n\r\n      /*\r\n      let err = 0.0;\r\n      for (let p of this.points) {\r\n        //err += error1(p)**2;\r\n        err += Math.abs(error1(p));\r\n      }\r\n\r\n      //return Math.sqrt(err);\r\n      return err;\r\n      //*/\r\n    };\r\n\r\n    let err = 0.0;\r\n    let g = new Vector2();\r\n\r\n    for (let step = 0; step < 25; step++) {\r\n      err = 0.0;\r\n\r\n      for (let p of this._ps) {\r\n        let r1 = error(p);\r\n        const df = 0.000001;\r\n\r\n        err += Math.abs(r1);\r\n\r\n        if (p === this._ps[this._ps.length - 1]) {\r\n          continue;\r\n        }\r\n\r\n        g.zero();\r\n\r\n        for (let i = 0; i < 2; i++) {\r\n          let orig = p.rco[i];\r\n          p.rco[i] += df;\r\n          let r2 = error(p);\r\n          p.rco[i] = orig;\r\n\r\n          g[i] = (r2 - r1) / df;\r\n        }\r\n\r\n        let totgs = g.dot(g);\r\n\r\n        if (totgs < 0.00000001) {\r\n          continue;\r\n        }\r\n\r\n        r1 /= totgs;\r\n        let k = 0.5;\r\n\r\n        p.rco[0] += -r1 * g[0] * k;\r\n        p.rco[1] += -r1 * g[1] * k;\r\n      }\r\n\r\n      let th = this.fastmode ? 0.001 : 0.00005;\r\n      if (err < th) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    //this.recalc &= ~RecalcFlags.FULL_BASIS;\r\n  }\r\n\r\n  regen_basis() {\r\n    if (splineCache.has(this)) {\r\n      console.log(\"loading from cached bspline data\");\r\n\r\n      this.basis_tables = splineCache.get(this).basis_tables;\r\n      return;\r\n    }\r\n\r\n    //let steps = this.fastmode && !this.interpolating ? 64 : 128;\r\n    let steps = this.fastmode ? 64 : 128;\r\n\r\n    if (this.interpolating) {\r\n      steps *= 2;\r\n    }\r\n\r\n    this.basis_tables = new Array(this._ps.length);\r\n\r\n    for (let i = 0; i < this._ps.length; i++) {\r\n      let table = (this.basis_tables[i] = new Array((steps - 1) * 4));\r\n\r\n      let eps = 0.00001;\r\n      let dt = (1.0 - eps * 8) / (steps - 1);\r\n      let t = eps * 4;\r\n      let lastdv1 = 0.0,\r\n        lastf3 = 0.0;\r\n\r\n      for (let j = 0; j < steps; j++, t += dt) {\r\n        let f3 = this._basis(t, i);\r\n        let dv1;\r\n\r\n        if (0) {\r\n          //let f1 = this._basis(t - eps*2, i);\r\n          let f2 = this._basis(t - eps, i);\r\n          let f4 = this._basis(t + eps, i);\r\n          //let f5 = this._basis(t + eps*2, i);\r\n\r\n          dv1 = (f4 - f2) / (eps * 2);\r\n        } else {\r\n          dv1 = this._dbasis(t, i);\r\n        }\r\n\r\n        if (isNaN(dv1)) {\r\n          console.log(\"NaN!\");\r\n          debugger;\r\n          dv1 = this._dbasis(t, i);\r\n        }\r\n        //dv1 = 0.0;\r\n\r\n        //dv1 = 0.0;\r\n        dv1 /= steps;\r\n\r\n        if (j > 0) {\r\n          let j2 = j - 1;\r\n\r\n          table[j2 * 4] = lastf3;\r\n          table[j2 * 4 + 1] = lastf3 + lastdv1 / 3.0;\r\n          table[j2 * 4 + 2] = f3 - dv1 / 3.0;\r\n          table[j2 * 4 + 3] = f3;\r\n        }\r\n\r\n        lastdv1 = dv1;\r\n        lastf3 = f3;\r\n      }\r\n    }\r\n  }\r\n\r\n  _dbasis(t, i) {\r\n    let len = this._ps.length;\r\n    let ps = this._ps;\r\n\r\n    function safe_inv(n) {\r\n      return n === 0 ? 0 : 1.0 / n;\r\n    }\r\n\r\n    /*\r\n    on factor;\r\n\r\n    operator bas;\r\n\r\n    a := (s - ki) / (knn - ki);\r\n    b := (knn1 - s) / (knn1 - kn);\r\n\r\n    f := a*bas(s, j, n-1) + b*bas(s, j+1, n-1);\r\n    df(f, s);\r\n    */\r\n\r\n    function bas(s, i, n) {\r\n      let kn = Math.min(Math.max(i + 1, 0), len - 1);\r\n      let knn = Math.min(Math.max(i + n, 0), len - 1);\r\n      let knn1 = Math.min(Math.max(i + n + 1, 0), len - 1);\r\n      let ki = Math.min(Math.max(i, 0), len - 1);\r\n\r\n      if (n === 0) {\r\n        return s >= ps[ki].rco[0] && s < ps[kn].rco[0] ? 1 : 0;\r\n      } else {\r\n        let a = (s - ps[ki].rco[0]) * safe_inv(ps[knn].rco[0] - ps[ki].rco[0] + 0.0001);\r\n        let b = (ps[knn1].rco[0] - s) * safe_inv(ps[knn1].rco[0] - ps[kn].rco[0] + 0.0001);\r\n\r\n        return a * bas(s, i, n - 1) + b * bas(s, i + 1, n - 1);\r\n      }\r\n    }\r\n\r\n    function dbas(s, j, n) {\r\n      let kn = Math.min(Math.max(j + 1, 0), len - 1);\r\n      let knn = Math.min(Math.max(j + n, 0), len - 1);\r\n      let knn1 = Math.min(Math.max(j + n + 1, 0), len - 1);\r\n      let ki = Math.min(Math.max(j, 0), len - 1);\r\n\r\n      kn = ps[kn].rco[0];\r\n      knn = ps[knn].rco[0];\r\n      knn1 = ps[knn1].rco[0];\r\n      ki = ps[ki].rco[0];\r\n\r\n      if (n === 0) {\r\n        return 0;\r\n        //return s >= ki && s < kn ? 1 : 0;\r\n      } else {\r\n        let div = (ki - knn) * (kn - knn1);\r\n\r\n        if (div === 0.0) {\r\n          return 0.0;\r\n        }\r\n\r\n        return (\r\n          (((ki - s) * dbas(s, j, n - 1) - bas(s, j, n - 1)) * (kn - knn1) -\r\n            ((knn1 - s) * dbas(s, j + 1, n - 1) - bas(s, j + 1, n - 1)) * (ki - knn)) /\r\n          div\r\n        );\r\n      }\r\n    }\r\n\r\n    let deg = this.deg;\r\n    return dbas(t, i + this._degOffset, deg);\r\n  }\r\n\r\n  _basis(t, i) {\r\n    let len = this._ps.length;\r\n    let ps = this._ps;\r\n\r\n    function safe_inv(n) {\r\n      return n === 0 ? 0 : 1.0 / n;\r\n    }\r\n\r\n    function bas(s, i, n) {\r\n      let kp = Math.min(Math.max(i - 1, 0), len - 1);\r\n      let kn = Math.min(Math.max(i + 1, 0), len - 1);\r\n      let knn = Math.min(Math.max(i + n, 0), len - 1);\r\n      let knn1 = Math.min(Math.max(i + n + 1, 0), len - 1);\r\n      let ki = Math.min(Math.max(i, 0), len - 1);\r\n\r\n      if (n === 0) {\r\n        return s >= ps[ki].rco[0] && s < ps[kn].rco[0] ? 1 : 0;\r\n      } else {\r\n        let a = (s - ps[ki].rco[0]) * safe_inv(ps[knn].rco[0] - ps[ki].rco[0] + 0.0001);\r\n        let b = (ps[knn1].rco[0] - s) * safe_inv(ps[knn1].rco[0] - ps[kn].rco[0] + 0.0001);\r\n\r\n        return a * bas(s, i, n - 1) + b * bas(s, i + 1, n - 1);\r\n      }\r\n    }\r\n\r\n    let p = this._ps[i].rco,\r\n      nk,\r\n      pk;\r\n    let deg = this.deg;\r\n\r\n    let b = bas(t, i + this._degOffset, deg);\r\n\r\n    return b;\r\n  }\r\n\r\n  evaluate(t) {\r\n    if (this.points.length === 0) {\r\n      return 0.0;\r\n    }\r\n\r\n    let a = this.points[0].rco,\r\n      b = this.points[this.points.length - 1].rco;\r\n\r\n    if (t < a[0]) return a[1];\r\n    if (t > b[0]) return b[1];\r\n\r\n    if (this.points.length === 2) {\r\n      t = (t - a[0]) / (b[0] - a[0]);\r\n      return a[1] + (b[1] - a[1]) * t;\r\n    }\r\n\r\n    if (this.recalc) {\r\n      this.regen_basis();\r\n\r\n      if (this.interpolating) {\r\n        this.solve_interpolating();\r\n      }\r\n\r\n      this.regen_hermite();\r\n      this.recalc = 0;\r\n    }\r\n\r\n    t *= 0.999999;\r\n\r\n    let table = this.hermite;\r\n    let s = t * (table.length / 4);\r\n\r\n    let i = Math.floor(s);\r\n    s -= i;\r\n\r\n    i *= 4;\r\n\r\n    return table[i] + (table[i + 3] - table[i]) * s;\r\n  }\r\n\r\n  /* Root find t on the x axis of the curve.  This\r\n   * is more intuitive for the user.\r\n   */\r\n  _evaluate(t) {\r\n    let start_t = t;\r\n\r\n    if (this.points.length === 0) {\r\n      return 0;\r\n    }\r\n\r\n    let xmin = this.points[0].rco[0];\r\n    let xmax = this.points[this.points.length - 1].rco[0];\r\n\r\n    let steps = this.fastmode ? 16 : 32;\r\n    let s = xmin,\r\n      ds = (xmax - xmin) / (steps - 1);\r\n\r\n    let miny;\r\n    let mins;\r\n    let mindx;\r\n\r\n    for (let i = 0; i < steps; i++, s += ds) {\r\n      let p = this._evaluate2(s);\r\n\r\n      let dx = Math.abs(p[0] - start_t);\r\n      if (mindx === undefined || dx < mindx) {\r\n        mindx = dx;\r\n        miny = p[1];\r\n        mins = s;\r\n      }\r\n    }\r\n\r\n    let start = mins - ds,\r\n      end = mins + ds;\r\n    s = mins;\r\n\r\n    for (let i = 0; i < 16; i++) {\r\n      let p = this._evaluate2(s);\r\n\r\n      if (p[0] > start_t) {\r\n        end = s;\r\n      } else {\r\n        start = s;\r\n      }\r\n\r\n      s = (start + end) * 0.5;\r\n      miny = p[1];\r\n    }\r\n\r\n    if (miny === undefined) {\r\n      miny = 0;\r\n    }\r\n    return miny;\r\n\r\n    /* newton-raphson\r\n    //t = mins;\r\n    t = s;\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let df = 0.0001;\r\n      let ret1 = this._evaluate2(t < 0.5 ? t : t - df);\r\n      let ret2 = this._evaluate2(t < 0.5 ? t + df : t);\r\n\r\n      let f1 = Math.abs(ret1[0] - start_t);\r\n      let f2 = Math.abs(ret2[0] - start_t);\r\n      let g = (f2 - f1)/df;\r\n\r\n      if (f1 === f2) break;\r\n\r\n      //if (f1 < 0.0005) break;\r\n\r\n      if (f1 === 0.0 || g === 0.0)\r\n        return this._evaluate2(t)[1];\r\n\r\n      let fac = -(f1/g)*0.5;\r\n      if (fac === 0.0) {\r\n        fac = 0.01;\r\n      } else if (Math.abs(fac) > 0.1) {\r\n        fac = 0.1*Math.sign(fac);\r\n      }\r\n\r\n      t += fac;\r\n      let eps = 0.00001;\r\n      t = Math.min(Math.max(t, eps), 1.0 - eps);\r\n    }\r\n\r\n    return this._evaluate2(t)[1];\r\n    */\r\n  }\r\n\r\n  _evaluate2(t) {\r\n    let ret = eval2_rets.next();\r\n\r\n    t *= 0.9999999;\r\n\r\n    let sumx = 0;\r\n    let sumy = 0;\r\n\r\n    let totbasis = 0;\r\n\r\n    for (let i = 0; i < this._ps.length; i++) {\r\n      let p = this._ps[i].rco;\r\n      let b = this.basis(t, i);\r\n\r\n      sumx += b * p[0];\r\n      sumy += b * p[1];\r\n\r\n      totbasis += b;\r\n    }\r\n\r\n    if (totbasis !== 0.0) {\r\n      sumx /= totbasis;\r\n      sumy /= totbasis;\r\n    }\r\n\r\n    ret[0] = sumx;\r\n    ret[1] = sumy;\r\n\r\n    return ret;\r\n  }\r\n\r\n  _wrapTouchEvent(e) {\r\n    return {\r\n      x              : e.touches.length ? e.touches[0].pageX : this.mpos[0],\r\n      y              : e.touches.length ? e.touches[0].pageY : this.mpos[1],\r\n      button         : 0,\r\n      shiftKey       : e.shiftKey,\r\n      altKey         : e.altKey,\r\n      ctrlKey        : e.ctrlKey,\r\n      isTouch        : true,\r\n      commandKey     : e.commandKey,\r\n      stopPropagation: () => e.stopPropagation(),\r\n      preventDefault : () => e.preventDefault(),\r\n    };\r\n  }\r\n\r\n  on_touchstart(e) {\r\n    this.mpos[0] = e.touches[0].pageX;\r\n    this.mpos[1] = e.touches[0].pageY;\r\n\r\n    let e2 = this._wrapTouchEvent(e);\r\n\r\n    this.on_mousemove(e2);\r\n    this.on_mousedown(e2);\r\n  }\r\n\r\n  loadTemplate(templ) {\r\n    if (templ === undefined || !templates[templ]) {\r\n      console.warn(\"Unknown bspline template\", templ);\r\n      return;\r\n    }\r\n\r\n    templ = templates[templ];\r\n\r\n    this.reset(true);\r\n    this.deg = 3.0;\r\n\r\n    for (let i = 0; i < templ.length; i++) {\r\n      let p = templ[i];\r\n\r\n      if (p === \"DEG\") {\r\n        this.deg = templ[i + 1];\r\n        i++;\r\n        continue;\r\n      }\r\n\r\n      this.add(p[0], p[1], true);\r\n    }\r\n\r\n    this.recalc = 1;\r\n    this.updateKnots();\r\n    this.update();\r\n    this.redraw();\r\n\r\n    if (this.parent) {\r\n      this.parent._fireEvent(\"update\", this.parent);\r\n    }\r\n  }\r\n\r\n  on_touchmove(e) {\r\n    this.mpos[0] = e.touches[0].pageX;\r\n    this.mpos[1] = e.touches[0].pageY;\r\n\r\n    let e2 = this._wrapTouchEvent(e);\r\n    this.on_mousemove(e2);\r\n  }\r\n\r\n  on_touchend(e) {\r\n    this.on_mouseup(this._wrapTouchEvent(e));\r\n  }\r\n\r\n  on_touchcancel(e) {\r\n    this.on_touchend(e);\r\n  }\r\n\r\n  deletePoint() {\r\n    for (let i = 0; i < this.points.length; i++) {\r\n      let p = this.points[i];\r\n\r\n      if (p.flag & CurveFlags.SELECT) {\r\n        this.points.remove(p);\r\n        i--;\r\n      }\r\n    }\r\n\r\n    this.updateKnots();\r\n    this.update();\r\n    this.regen_basis();\r\n    this.recalc = RecalcFlags.ALL;\r\n    this.redraw();\r\n  }\r\n\r\n  makeGUI(container, canvas, drawTransform, datapath, onSourceUpdate) {\r\n    console.warn(this._bid, \"makeGUI\", this.uidata, this.uidata ? this.uidata.start_mpos : undefined);\r\n\r\n    let start_mpos;\r\n    if (this.uidata) {\r\n      start_mpos = this.uidata.start_mpos;\r\n    }\r\n\r\n    this.uidata = {\r\n      start_mpos : new Vector2(start_mpos),\r\n      transpoints: [],\r\n\r\n      dom         : container,\r\n      canvas      : canvas,\r\n      g           : canvas.g,\r\n      transforming: false,\r\n      draw_trans  : drawTransform,\r\n      datapath,\r\n    };\r\n\r\n    console.warn(\"Building gui\");\r\n\r\n    canvas.addEventListener(\"touchstart\", this.on_touchstart);\r\n    canvas.addEventListener(\"touchmove\", this.on_touchmove);\r\n    canvas.addEventListener(\"touchend\", this.on_touchend);\r\n    canvas.addEventListener(\"touchcancel\", this.on_touchcancel);\r\n\r\n    canvas.addEventListener(\"mousedown\", this.on_mousedown);\r\n    canvas.addEventListener(\"mousemove\", this.on_mousemove);\r\n    canvas.addEventListener(\"mouseup\", this.on_mouseup);\r\n    canvas.addEventListener(\"keydown\", this.on_keydown);\r\n\r\n    let bstrip = container.row().strip();\r\n\r\n    let makebutton = (strip, k) => {\r\n      let uiname = k[0] + k.slice(1, k.length).toLowerCase();\r\n      uiname = uiname.replace(/_/g, \" \");\r\n\r\n      let icon = strip.iconbutton(-1, uiname, () => {\r\n        if (datapath) {\r\n          row.ctx.api.execTool(row.ctx, \"curve1d.bspline_load_template\", {\r\n            dataPath: datapath,\r\n            template: SplineTemplates[k],\r\n          });\r\n          onSourceUpdate();\r\n        } else {\r\n          this.loadTemplate(SplineTemplates[k]);\r\n        }\r\n      });\r\n\r\n      icon.iconsheet = 0;\r\n      icon.customIcon = SplineTemplateIcons[k];\r\n    };\r\n\r\n    for (let k in SplineTemplates) {\r\n      makebutton(bstrip, k);\r\n    }\r\n\r\n    let row = container.row();\r\n\r\n    let fullUpdate = () => {\r\n      this.updateKnots();\r\n      this.update();\r\n      this.regen_basis();\r\n      this.recalc = RecalcFlags.ALL;\r\n      this.redraw();\r\n    };\r\n\r\n    let Icons = row.constructor.getIconEnum();\r\n\r\n    let icon = Icons.LARGE_X !== undefined ? Icons.LARGE_X : Icons.TINY_X;\r\n    if (Icons.LARGE_X === undefined) {\r\n      console.log(Icons);\r\n      console.error(\"Curve widget expects Icons.LARGE_X icon for delete button.\");\r\n    }\r\n\r\n    row.iconbutton(icon, \"Delete Point\", () => {\r\n      if (datapath) {\r\n        row.ctx.api.execTool(row.ctx, \"curve1d.bspline_delete_point\", {\r\n          dataPath: datapath,\r\n        });\r\n      } else {\r\n        this.deletePoint();\r\n      }\r\n\r\n      onSourceUpdate();\r\n      fullUpdate();\r\n    });\r\n\r\n    row.button(\"Reset\", () => {\r\n      if (datapath) {\r\n        row.ctx.api.execTool(row.ctx, \"curve1d.reset_bspline\", {\r\n          dataPath: datapath,\r\n        });\r\n        onSourceUpdate();\r\n      } else {\r\n        this.reset();\r\n      }\r\n    });\r\n\r\n    let slider = row.simpleslider(undefined, {\r\n      name    : \"Degree\",\r\n      min     : 1,\r\n      max     : 7,\r\n      isInt   : true,\r\n      callback: (slider) => {\r\n        this.deg = Math.floor(slider.value);\r\n        fullUpdate();\r\n      },\r\n    });\r\n    slider.setValue(this.deg);\r\n\r\n    let last_deg = this.deg;\r\n    slider.update.after(() => {\r\n      if (last_deg !== this.deg) {\r\n        console.log(\"degree update\", this.deg);\r\n        last_deg = this.deg;\r\n        slider.setValue(this.deg);\r\n      }\r\n    });\r\n\r\n    /*\r\n    let slider = row.simpleslider(undefined, \"Degree\", this.deg, 1, 6, 1, true, true, (slider) => {\r\n      this.deg = Math.floor(slider.value);\r\n      console.log(slider.value);\r\n\r\n      fullUpdate();\r\n    });*/\r\n\r\n    slider.baseUnit = \"none\";\r\n    slider.displayUnit = \"none\";\r\n\r\n    row = container.row();\r\n    let check = row.check(undefined, \"Interpolating\");\r\n    check.checked = this.interpolating;\r\n\r\n    check.onchange = () => {\r\n      this.interpolating = check.value;\r\n      fullUpdate();\r\n    };\r\n\r\n    return this;\r\n  }\r\n\r\n  killGUI(container, canvas) {\r\n    if (this.uidata !== undefined) {\r\n      let ud = this.uidata;\r\n      this.uidata = undefined;\r\n\r\n      canvas.removeEventListener(\"touchstart\", this.on_touchstart);\r\n      canvas.removeEventListener(\"touchmove\", this.on_touchmove);\r\n      canvas.removeEventListener(\"touchend\", this.on_touchend);\r\n      canvas.removeEventListener(\"touchcancel\", this.on_touchcancel);\r\n\r\n      canvas.removeEventListener(\"mousedown\", this.on_mousedown);\r\n      canvas.removeEventListener(\"mousemove\", this.on_mousemove);\r\n      canvas.removeEventListener(\"mouseup\", this.on_mouseup);\r\n      canvas.removeEventListener(\"keydown\", this.on_keydown);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  start_transform(useSelected = true) {\r\n    let dpi = 1.0 / this.uidata.draw_trans[0];\r\n\r\n    /* Manually set p.startco to avoid trashing it\r\n     * if we're proxying another Curve1D.*/\r\n    for (let p of this.points) {\r\n      p.startco.load(p.co);\r\n    }\r\n\r\n    let transform_op = new BSplineTransformOp();\r\n    transform_op.inputs.dataPath.setValue(this.uidata.datapath);\r\n    transform_op.inputs.dpi.setValue(dpi);\r\n\r\n    this.uidata.dom.ctx.api.execTool(this.uidata.dom.ctx, transform_op);\r\n  }\r\n\r\n  on_mousedown(e) {\r\n    this.uidata.start_mpos.load(this.transform_mpos(e.x, e.y));\r\n    this.fastmode = true;\r\n\r\n    let mpos = this.transform_mpos(e.x, e.y);\r\n    let x = mpos[0],\r\n      y = mpos[1];\r\n    this.do_highlight(x, y);\r\n\r\n    if (this.points.highlight !== undefined) {\r\n      if (!e.shiftKey) {\r\n        for (let i = 0; i < this.points.length; i++) {\r\n          this.points[i].flag &= ~CurveFlags.SELECT;\r\n        }\r\n\r\n        this.points.highlight.flag |= CurveFlags.SELECT;\r\n      } else {\r\n        this.points.highlight.flag ^= CurveFlags.SELECT;\r\n      }\r\n\r\n      if (this.uidata.datapath) {\r\n        let state = e.shiftKey ? !(this.points.highlight.flag & CurveFlags.SELECT) : true;\r\n\r\n        this.uidata.dom.ctx.api.execTool(this.uidata.dom.ctx, \"curve1d.bspline_select_point\", {\r\n          dataPath: this.uidata.datapath,\r\n          state,\r\n          unique: !e.shiftKey,\r\n          point : this.points.highlight.eid,\r\n        });\r\n      }\r\n      this.start_transform();\r\n\r\n      this.updateKnots();\r\n      this.update();\r\n      this.redraw();\r\n    } else {\r\n      let uidata = this.uidata;\r\n\r\n      if (this.uidata.datapath) {\r\n        /*\r\n         * Note: this may not update this particular curve instance,\r\n         * that instance however should update this one via the \"update\"\r\n         * event.\r\n         **/\r\n        let start_mpos = this.uidata.start_mpos;\r\n        this.uidata.dom.ctx.api.execTool(this.uidata.dom.ctx, \"curve1d.bspline_add_point\", {\r\n          dataPath: this.uidata.datapath,\r\n          x       : start_mpos[0],\r\n          y       : start_mpos[1],\r\n        });\r\n      } else {\r\n        this.addFromMouse(this.uidata.start_mpos[0], this.uidata.start_mpos[1]);\r\n        this.parent._fire(\"update\", this.parent);\r\n      }\r\n\r\n      this.updateKnots();\r\n      this.update();\r\n      this.redraw();\r\n\r\n      /* Event system may have regenerated this.uidata (from killGUI,\r\n       * called from the update event handler),\r\n       * restore the one we started with.\r\n       */\r\n\r\n      this.uidata = uidata;\r\n      this.start_transform();\r\n    }\r\n  }\r\n\r\n  load(b) {\r\n    if (this === b) {\r\n      return;\r\n    }\r\n\r\n    this.recalc = RecalcFlags.ALL;\r\n\r\n    this.length = b.points.length;\r\n    this.points.length = 0;\r\n    this.eidgen = b.eidgen.copy();\r\n\r\n    this.deg = b.deg;\r\n    this.interpolating = b.interpolating;\r\n\r\n    for (let p of b.points) {\r\n      let p2 = new Curve1DPoint();\r\n      p2.load(p);\r\n\r\n      if (p === b.points.highlight) {\r\n        this.points.highlight = p2;\r\n      }\r\n\r\n      this.points.push(p2);\r\n    }\r\n\r\n    this.updateKnots();\r\n    this.update();\r\n    this.redraw();\r\n\r\n    return this;\r\n  }\r\n\r\n  addFromMouse(x, y) {\r\n    let p = this.add(x, y);\r\n    p.startco.load(p.co);\r\n    this.points.highlight = p;\r\n\r\n    for (let p2 of this.points) {\r\n      p2.flag &= ~CurveFlags.SELECT;\r\n    }\r\n    p.flag |= CurveFlags.SELECT;\r\n\r\n    this.updateKnots();\r\n    this.update();\r\n    this.redraw();\r\n\r\n    this.points.highlight.flag |= CurveFlags.SELECT;\r\n  }\r\n\r\n  do_highlight(x, y) {\r\n    let trans = this.uidata.draw_trans;\r\n    let mindis = 1e17,\r\n      minp = undefined;\r\n    let limit = 19 / trans[0],\r\n      limitsqr = limit * limit;\r\n\r\n    for (let i = 0; i < this.points.length; i++) {\r\n      let p = this.points[i];\r\n      let dx = x - p.sco[0],\r\n        dy = y - p.sco[1],\r\n        dis = dx * dx + dy * dy;\r\n\r\n      if (dis < mindis && dis < limitsqr) {\r\n        mindis = dis;\r\n        minp = p;\r\n      }\r\n    }\r\n\r\n    if (this.points.highlight !== minp) {\r\n      this.points.highlight = minp;\r\n      this.redraw();\r\n    }\r\n  }\r\n\r\n  do_transform(x, y) {\r\n    let off = new Vector2([x, y]).sub(this.uidata.start_mpos);\r\n\r\n    let xRange = this.parent.xRange;\r\n    let yRange = this.parent.yRange;\r\n\r\n    for (let i = 0; i < this.uidata.transpoints.length; i++) {\r\n      let p = this.uidata.transpoints[i];\r\n      p.co.load(p.startco).add(off);\r\n\r\n      p.co[0] = Math.min(Math.max(p.co[0], xRange[0]), xRange[1]);\r\n      p.co[1] = Math.min(Math.max(p.co[1], yRange[0]), yRange[1]);\r\n    }\r\n\r\n    this.updateKnots();\r\n    this.update();\r\n    this.redraw();\r\n  }\r\n\r\n  transform_mpos(x, y) {\r\n    let r = this.uidata.canvas.getClientRects()[0];\r\n    let dpi = devicePixelRatio; //evil module cycle: UIBase.getDPI();\r\n\r\n    x -= parseInt(r.left);\r\n    y -= parseInt(r.top);\r\n\r\n    x *= dpi;\r\n    y *= dpi;\r\n\r\n    let trans = this.uidata.draw_trans;\r\n\r\n    x = x / trans[0] - trans[1][0];\r\n    y = -y / trans[0] - trans[1][1];\r\n\r\n    return [x, y];\r\n  }\r\n\r\n  on_mousemove(e) {\r\n    if (e.isTouch && this.uidata.transforming) {\r\n      e.preventDefault();\r\n    }\r\n\r\n    let mpos = this.transform_mpos(e.x, e.y);\r\n    let x = mpos[0],\r\n      y = mpos[1];\r\n\r\n    if (this.uidata.transforming) {\r\n      this.do_transform(x, y);\r\n      this.evaluate(0.5);\r\n      //this.update();\r\n      //this.doSave();\r\n    } else {\r\n      this.do_highlight(x, y);\r\n    }\r\n  }\r\n\r\n  end_transform() {\r\n    this.uidata.transforming = false;\r\n    this.fastmode = false;\r\n    this.updateKnots();\r\n    this.update();\r\n\r\n    splineCache.update(this);\r\n  }\r\n\r\n  on_mouseup(e) {\r\n    this.end_transform();\r\n  }\r\n\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case 88: //xkeey\r\n      case 46: //delete\r\n        if (this.points.highlight !== undefined) {\r\n          this.points.remove(this.points.highlight);\r\n          this.recalc = RecalcFlags.ALL;\r\n\r\n          this.points.highlight = undefined;\r\n          this.updateKnots();\r\n          this.update();\r\n\r\n          if (this._save_hook !== undefined) {\r\n            this._save_hook();\r\n          }\r\n        }\r\n        break;\r\n    }\r\n  }\r\n\r\n  draw(canvas, g, draw_trans) {\r\n    g.save();\r\n\r\n    if (this.uidata === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.uidata.canvas = canvas;\r\n    this.uidata.g = g;\r\n    this.uidata.draw_trans = draw_trans;\r\n\r\n    let sz = draw_trans[0],\r\n      pan = draw_trans[1];\r\n    g.lineWidth *= 1.5;\r\n    let strokeStyle = g.strokeStyle;\r\n\r\n    for (let ssi = 0; ssi < 1; ssi++) {\r\n      break; //uncomment to draw basis functions\r\n\r\n      let steps = 512;\r\n      for (let si = 0; si < this.points.length; si++) {\r\n        g.beginPath();\r\n\r\n        let f = 0;\r\n        let df = 1.0 / (steps - 1);\r\n        for (let i = 0; i < steps; i++, f += df) {\r\n          let totbasis = 0;\r\n\r\n          for (let j = 0; j < this.points.length; j++) {\r\n            totbasis += this.basis(f, j);\r\n          }\r\n\r\n          let val = this.basis(f, si);\r\n\r\n          if (ssi) val /= totbasis === 0 ? 1 : totbasis;\r\n\r\n          (i === 0 ? g.moveTo : g.lineTo).call(g, f, ssi ? val : val * 0.5);\r\n        }\r\n\r\n        let color,\r\n          alpha = this.points[si] === this.points.highlight ? 1.0 : 0.7;\r\n\r\n        if (ssi) {\r\n          color = \"rgba(205, 125, 5,\" + alpha + \")\";\r\n        } else {\r\n          color = \"rgba(25, 145, 45,\" + alpha + \")\";\r\n        }\r\n        g.strokeStyle = color;\r\n        g.stroke();\r\n      }\r\n    }\r\n\r\n    g.strokeStyle = strokeStyle;\r\n    g.lineWidth /= 3.0;\r\n\r\n    let w = 0.03;\r\n\r\n    for (let p of this.points) {\r\n      g.beginPath();\r\n\r\n      if (p === this.points.highlight) {\r\n        g.fillStyle = \"green\";\r\n      } else if (p.flag & CurveFlags.SELECT) {\r\n        g.fillStyle = \"red\";\r\n      } else {\r\n        g.fillStyle = \"orange\";\r\n      }\r\n\r\n      g.rect(p.sco[0] - w / 2, p.sco[1] - w / 2, w, w);\r\n\r\n      g.fill();\r\n    }\r\n\r\n    g.restore();\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n\r\n    if (this.highlightPoint >= 0) {\r\n      for (let p of this.points) {\r\n        if (p.eid === this.highlightPoint) {\r\n          this.points.highlight = p;\r\n        }\r\n      }\r\n\r\n      delete this.highlightPoint;\r\n    }\r\n\r\n    this.updateKnots();\r\n    this.recalc = RecalcFlags.ALL;\r\n  }\r\n}\r\n\r\nBSplineCurve.STRUCT =\r\n  nstructjs.inherit(BSplineCurve, CurveTypeData) +\r\n  `\r\n  points         : array(Curve1DPoint);\r\n  highlightPoint : int | this.points.highlight ? this.points.highlight.eid : -1;\r\n  deg            : int;\r\n  eidgen         : IDGen;\r\n  interpolating  : bool;\r\n}\r\n`;\r\nnstructjs.register(BSplineCurve);\r\nCurveTypeData.register(BSplineCurve);\r\n\r\nfunction makeSplineTemplateIcons(size = 64) {\r\n  if (typeof document === \"undefined\") {\r\n    /* inside a web worker? */\r\n    return;\r\n  }\r\n  let dpi = devicePixelRatio;\r\n  size = ~~(size * dpi);\r\n\r\n  for (let k in SplineTemplates) {\r\n    let curve = new BSplineCurve();\r\n    curve.loadTemplate(SplineTemplates[k]);\r\n\r\n    curve.fastmode = true;\r\n\r\n    let canvas = document.createElement(\"canvas\");\r\n    canvas.width = canvas.height = size;\r\n\r\n    let g = canvas.getContext(\"2d\");\r\n    let steps = 64;\r\n\r\n    curve.update();\r\n\r\n    let scale = 0.5;\r\n\r\n    g.translate(-0.5, -0.5);\r\n    g.scale(size * scale, size * scale);\r\n    g.translate(0.5, 0.5);\r\n\r\n    //margin\r\n    let m = 0.0;\r\n\r\n    let tent = (f) => 1.0 - Math.abs(Math.fract(f) - 0.5) * 2.0;\r\n\r\n    for (let i = 0; i < steps; i++) {\r\n      let s = i / (steps - 1);\r\n      let f = 1.0 - curve.evaluate(tent(s));\r\n\r\n      s = s * (1.0 - m * 2.0) + m;\r\n      f = f * (1.0 - m * 2.0) + m;\r\n\r\n      //s += 0.5;\r\n      //f += 0.5;\r\n\r\n      if (i === 0) {\r\n        g.moveTo(s, f);\r\n      } else {\r\n        g.lineTo(s, f);\r\n      }\r\n    }\r\n\r\n    const ls = 7.0;\r\n\r\n    g.lineCap = \"round\";\r\n    g.strokeStyle = \"black\";\r\n    g.lineWidth = (ls * 3 * dpi) / (size * scale);\r\n    g.stroke();\r\n\r\n    g.strokeStyle = \"white\";\r\n    g.lineWidth = (ls * dpi) / (size * scale);\r\n    g.stroke();\r\n\r\n    let url = canvas.toDataURL();\r\n    let img = document.createElement(\"img\");\r\n    img.src = url;\r\n\r\n    SplineTemplateIcons[k] = img;\r\n    SplineTemplateIcons[SplineTemplates[k]] = img;\r\n  }\r\n}\r\n\r\nlet splineTemplatesLoaded = false;\r\n\r\nexport function initSplineTemplates() {\r\n  if (splineTemplatesLoaded) {\r\n    return;\r\n  }\r\n\r\n  splineTemplatesLoaded = true;\r\n\r\n  for (let k in SplineTemplates) {\r\n    let curve = new BSplineCurve();\r\n    curve.loadTemplate(SplineTemplates[k]);\r\n    splineCache.get(curve);\r\n  }\r\n\r\n  makeSplineTemplateIcons();\r\n  window._SplineTemplateIcons = SplineTemplateIcons;\r\n  console.log(\"Loaded 1d spline templates\");\r\n}\r\n\r\n//delay to ensure config is fully loaded\r\nwindow.setTimeout(() => {\r\n  if (config.autoLoadSplineTemplates) {\r\n    initSplineTemplates();\r\n  }\r\n}, 0);\r\n","\"use strict\";\r\n\r\n/*FIXME: not sure this works anymore*/\r\nimport nstructjs from \"../util/struct.js\";\r\n\r\nimport * as util from '../util/util.js';\r\n//import * as ui_base from './ui_base.js';\r\nimport {Vector2, Vector3, Vector4, Matrix4} from '../util/vectormath.js';\r\nimport {EventDispatcher} from \"../util/events.js\";\r\n\r\nexport {getCurve} from './curve1d_base.js';\r\nexport {SplineTemplates, SplineTemplateIcons} from './curve1d_bspline.js';\r\n\r\nexport function mySafeJSONStringify(obj) {\r\n  return JSON.stringify(obj.toJSON(), function (key) {\r\n    let v = this[key];\r\n\r\n    if (typeof v === \"number\") {\r\n      if (v !== Math.floor(v)) {\r\n        v = parseFloat(v.toFixed(5));\r\n      } else {\r\n        v = v;\r\n      }\r\n    }\r\n\r\n    return v;\r\n  });\r\n}\r\n\r\nexport function mySafeJSONParse(buf) {\r\n  return JSON.parse(buf, (key, val) => {\r\n\r\n  });\r\n};\r\n\r\nwindow.mySafeJSONStringify = mySafeJSONStringify;\r\n\r\nexport {CurveConstructors, CURVE_VERSION, CurveTypeData} from './curve1d_base.js';\r\nimport {CurveConstructors, CURVE_VERSION, CurveTypeData} from './curve1d_base.js';\r\n\r\nlet _udigest = new util.HashDigest();\r\n\r\nexport class Curve1D {\r\n  constructor() {\r\n    this._eventCBs = [];\r\n\r\n    this.uiZoom = 1.0;\r\n    this.xRange = new Vector2().loadXY(0.0, 1.0);\r\n    this.yRange = new Vector2().loadXY(0.0, 1.0);\r\n    this.clipToRange = false;\r\n\r\n    this.generators = [];\r\n    this.VERSION = CURVE_VERSION;\r\n\r\n    for (let gen of CurveConstructors) {\r\n      gen = new gen();\r\n\r\n      gen.parent = this;\r\n      this.generators.push(gen);\r\n    }\r\n\r\n    //this.generators.active = this.generators[0];\r\n    this.setGenerator(\"bspline\");\r\n  }\r\n\r\n  get generatorType() {\r\n    return this.generators.active ? this.generators.active.type : undefined;\r\n  }\r\n\r\n  get fastmode() {\r\n    return this._fastmode;\r\n  }\r\n\r\n  set fastmode(val) {\r\n    this._fastmode = val;\r\n\r\n    for (let gen of this.generators) {\r\n      gen.fastmode = val;\r\n    }\r\n  }\r\n\r\n  /** cb_is_dead is a callback that returns true if it\r\n   *  should be removed from the callback list. */\r\n  on(type, cb, owner, cb_is_dead) {\r\n    if (cb_is_dead === undefined) {\r\n      cb_is_dead = () => false;\r\n    }\r\n\r\n    this._eventCBs.push({type, cb, owner, dead: cb_is_dead, once: false});\r\n  }\r\n\r\n  off(type, cb) {\r\n    this._eventCBs = this._eventCBs.filter(cb => cb.cb !== cb);\r\n  }\r\n\r\n  once(type, cb, owner, cb_is_dead) {\r\n    this.on(type, cb, owner, cb_is_dead);\r\n    this._eventCBs[this._eventCBs.length - 1].once = true;\r\n  }\r\n\r\n  subscribed(type, owner) {\r\n    for (let cb of this._eventCBs) {\r\n      if ((!type || cb.type === type) && cb.owner === owner) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  _pruneEventCallbacks() {\r\n    this._eventCBs = this._eventCBs.filter(cb => !cb.dead());\r\n  }\r\n\r\n  _fireEvent(evt, data) {\r\n    this._pruneEventCallbacks();\r\n\r\n    for (let i = 0; i < this._eventCBs.length; i++) {\r\n      let cb = this._eventCBs[i];\r\n\r\n      if (cb.type !== evt) {\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        cb.cb(data);\r\n      } catch (error) {\r\n        console.error(error.stack);\r\n        console.error(error.message);\r\n      }\r\n\r\n      if (cb.once) {\r\n        this._eventCBs.remove(cb);\r\n        i--;\r\n      }\r\n    }\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    let d = digest;\r\n\r\n    for (let g of this.generators) {\r\n      g.calcHashKey(d);\r\n    }\r\n\r\n    return d.get();\r\n  }\r\n\r\n  equals(b) {\r\n    let gen1 = this.generators.active;\r\n    let gen2 = b.generators.active;\r\n\r\n    if (!gen1 || !gen2 || gen1.constructor !== gen2.constructor) {\r\n      return false;\r\n    }\r\n\r\n    return gen1.equals(gen2);\r\n  }\r\n\r\n  load(b) {\r\n    if (b === undefined || b === this) {\r\n      return this;\r\n    }\r\n    /*\r\n    if (b === undefined) {\r\n      return;\r\n    }\r\n\r\n    let buf1 = mySafeJSONStringify(b);\r\n    let buf2 = mySafeJSONStringify(this);\r\n\r\n    if (buf1 === buf2) {\r\n      return;\r\n    }\r\n\r\n    this.loadJSON(JSON.parse(buf1));\r\n    this._on_change();\r\n    this.redraw();\r\n\r\n    return this;*/\r\n\r\n    let json = nstructjs.writeJSON(b, Curve1D);\r\n    let cpy = nstructjs.readJSON(json, Curve1D);\r\n\r\n    let activeCls = cpy.generators.active.constructor;\r\n    let oldGens = this.generators;\r\n\r\n    this.generators = cpy.generators;\r\n\r\n    for (let gen of cpy.generators) {\r\n      /* See if generator provides a .load() method. */\r\n      for (let gen2 of oldGens) {\r\n        if (gen2.constructor === gen.constructor && gen2.load !== undefined) {\r\n          cpy.generators[cpy.generators.indexOf(gen)] = gen2;\r\n\r\n          if (gen2.constructor === activeCls) {\r\n            this.generators.active = gen2;\r\n          }\r\n\r\n          gen2.parent = this;\r\n          gen2.load(gen);\r\n          gen = gen2;\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (gen.constructor === activeCls) {\r\n        this.generators.active = gen;\r\n      }\r\n      gen.parent = this;\r\n    }\r\n\r\n    for (let k in json) {\r\n      if (k === \"generators\") {\r\n        continue;\r\n      }\r\n      if (k.startsWith(\"_\")) {\r\n        continue;\r\n      }\r\n\r\n      let v = cpy[k];\r\n      if (typeof v === \"number\" || typeof v === \"boolean\" || typeof v === \"string\") {\r\n        this[k] = v;\r\n      } else if (v instanceof Vector2 || v instanceof Vector3 || v instanceof Vector4 || v instanceof Matrix4) {\r\n        this[k].load(v);\r\n      }\r\n    }\r\n\r\n    this._on_change();\r\n    this.redraw();\r\n\r\n    return this;\r\n  }\r\n\r\n  copy() {\r\n    let json = nstructjs.writeJSON(this, Curve1D);\r\n    return nstructjs.readJSON(json, Curve1D);\r\n  }\r\n\r\n  _on_change() {\r\n\r\n  }\r\n\r\n  redraw() {\r\n    this._fireEvent(\"draw\", this);\r\n  }\r\n\r\n  setGenerator(type) {\r\n    for (let gen of this.generators) {\r\n      if (gen.constructor.define().name === type\r\n        || gen.type === type\r\n        || gen.constructor.define().typeName === type\r\n        || gen.constructor === type) {\r\n        if (this.generators.active) {\r\n          this.generators.active.onInactive();\r\n        }\r\n\r\n        this.generators.active = gen;\r\n        gen.onActive();\r\n\r\n        return;\r\n      }\r\n    }\r\n\r\n    throw new Error(\"unknown curve type \" + type);\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = {\r\n      generators      : [],\r\n      uiZoom          : this.uiZoom,\r\n      VERSION         : this.VERSION,\r\n      active_generator: this.generatorType,\r\n      xRange          : this.xRange,\r\n      yRange          : this.yRange,\r\n      clipToRange     : this.clipToRange,\r\n    };\r\n\r\n    for (let gen of this.generators) {\r\n      ret.generators.push(gen.toJSON());\r\n    }\r\n\r\n    ret.generators.sort((a, b) => a.type.localeCompare(b.type));\r\n\r\n    return ret;\r\n  }\r\n\r\n  getGenerator(type, throw_on_error = true) {\r\n    for (let gen of this.generators) {\r\n      if (gen.type === type) {\r\n        return gen;\r\n      }\r\n    }\r\n\r\n    //was a new generator registerd?\r\n    for (let cls of CurveConstructors) {\r\n      if (cls.define().typeName === type) {\r\n        let gen = new cls();\r\n        gen.type = type;\r\n        gen.parent = this;\r\n        this.generators.push(gen);\r\n        return gen;\r\n      }\r\n    }\r\n\r\n    if (throw_on_error) {\r\n      throw new Error(\"Unknown generator \" + type + \".\");\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  switchGenerator(type) {\r\n    let gen = this.getGenerator(type);\r\n\r\n    if (gen !== this.generators.active) {\r\n      let old = this.generators.active;\r\n\r\n      this.generators.active = gen;\r\n\r\n      old.onInactive(this);\r\n      gen.onActive(this);\r\n    }\r\n\r\n    return gen;\r\n  }\r\n\r\n  destroy() {\r\n    return this;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    this.VERSION = obj.VERSION;\r\n\r\n    this.uiZoom = parseFloat(obj.uiZoom) || this.uiZoom;\r\n    if (obj.xRange) {\r\n      this.xRange = new Vector2(obj.xRange);\r\n    }\r\n    if (obj.yRange) {\r\n      this.yRange = new Vector2(obj.yRange);\r\n    }\r\n    this.clipToRange = Boolean(obj.clipToRange);\r\n\r\n    //this.generators = [];\r\n    for (let gen of obj.generators) {\r\n      let gen2 = this.getGenerator(gen.type, false);\r\n\r\n      if (!gen2 || !(gen2 instanceof CurveTypeData)) {\r\n        //old curve class?\r\n        console.warn(\"Bad curve generator class:\", gen2);\r\n        if (gen2) {\r\n          this.generators.remove(gen2);\r\n        }\r\n        continue;\r\n      }\r\n\r\n      gen2.parent = undefined;\r\n      gen2.reset();\r\n      gen2.loadJSON(gen);\r\n      gen2.parent = this;\r\n\r\n      if (gen.type === obj.active_generator) {\r\n        this.generators.active = gen2;\r\n      }\r\n\r\n      //this.generators.push(gen2);\r\n    }\r\n\r\n    if (this.VERSION < 1.1) {\r\n      this.#patchRange();\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  evaluate(s) {\r\n    if (this.clipToRange) {\r\n      s = Math.min(Math.max(s, this.xRange[0]), this.xRange[1]);\r\n    }\r\n\r\n    let f;\r\n\r\n    try {\r\n      f = this.generators.active.evaluate(s);\r\n    } catch (error) {\r\n      f = 0.0;\r\n      console.warn(error.stack);\r\n      console.warn(error.message);\r\n    }\r\n\r\n    if (this.clipToRange) {\r\n      f = Math.min(Math.max(f, this.yRange[0]), this.yRange[1]);\r\n    }\r\n\r\n    return f;\r\n  }\r\n\r\n  integrate(s, quadSteps) {\r\n    return this.generators.active.integrate(s, quadSteps);\r\n  }\r\n\r\n  derivative(s) {\r\n    return this.generators.active.derivative(s);\r\n  }\r\n\r\n  derivative2(s) {\r\n    return this.generators.active.derivative2(s);\r\n  }\r\n\r\n  inverse(s) {\r\n    return this.generators.active.inverse(s);\r\n  }\r\n\r\n  reset() {\r\n    this.generators.active.reset();\r\n  }\r\n\r\n  update() {\r\n    return this.generators.active.update();\r\n  }\r\n\r\n  draw(canvas, g, draw_transform) {\r\n    let w = canvas.width, h = canvas.height;\r\n\r\n    g.save();\r\n\r\n    let sz = draw_transform[0], pan = draw_transform[1];\r\n\r\n    g.beginPath();\r\n    g.moveTo(-1, 0);\r\n    g.lineTo(1, 0);\r\n    g.strokeStyle = \"red\";\r\n    g.stroke();\r\n\r\n    g.beginPath();\r\n    g.moveTo(0, -1);\r\n    g.lineTo(0, 1);\r\n    g.strokeStyle = \"green\";\r\n    g.stroke();\r\n\r\n    //g.rect(0, 0, 1, 1);\r\n    //g.fillStyle = \"rgb(50, 50, 50)\";\r\n    //g.fill();\r\n\r\n    let f = this.xRange[0], steps = 64;\r\n    let df = (this.xRange[1] - this.xRange[0])/(steps - 1);\r\n    w = 6.0/sz;\r\n\r\n    let curve = this.generators.active;\r\n\r\n    g.beginPath();\r\n    for (let i = 0; i < steps; i++, f += df) {\r\n      let val = this.evaluate(f);\r\n\r\n      (i === 0 ? g.moveTo : g.lineTo).call(g, f, val, w, w);\r\n    }\r\n\r\n    g.strokeStyle = \"grey\";\r\n    g.stroke();\r\n\r\n    if (this.overlay_curvefunc !== undefined) {\r\n      g.beginPath();\r\n      f = this.xRange[0];\r\n\r\n      for (let i = 0; i < steps; i++, f += df) {\r\n        let val = this.overlay_curvefunc(f);\r\n\r\n        (i === 0 ? g.moveTo : g.lineTo).call(g, f, val, w, w);\r\n      }\r\n\r\n      g.strokeStyle = \"green\";\r\n      g.stroke();\r\n    }\r\n\r\n    this.generators.active.draw(canvas, g, draw_transform);\r\n\r\n    g.restore();\r\n    return this;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    this.generators = [];\r\n    reader(this);\r\n\r\n    if (this.VERSION <= 0.75) {\r\n      this.generators = [];\r\n\r\n      for (let cls of CurveConstructors) {\r\n        this.generators.push(new cls());\r\n      }\r\n\r\n      this.generators.active = this.getGenerator(\"BSplineCurve\");\r\n    }\r\n\r\n    for (let gen of this.generators.concat([])) {\r\n      if (!(gen instanceof CurveTypeData)) {\r\n        console.warn(\"Bad generator data found:\", gen);\r\n        this.generators.remove(gen);\r\n        continue;\r\n      }\r\n\r\n      if (gen.type === this._active) {\r\n        this.generators.active = gen;\r\n      }\r\n    }\r\n\r\n    for (let gen of this.generators) {\r\n      gen.parent = this;\r\n    }\r\n\r\n    if (this.VERSION < 1.1) {\r\n      this.#patchRange();\r\n    }\r\n\r\n    delete this._active;\r\n    this.VERSION = CURVE_VERSION;\r\n  }\r\n\r\n  #patchRange() {\r\n    let range = this.getGenerator(\"BSplineCurve\").range;\r\n    if (range) {\r\n      this.xRange.load(range[0]);\r\n      this.yRange.load(range[1]);\r\n    }\r\n  }\r\n}\r\n\r\n/* Remember to update toJSON() loadJSON api. */\r\nCurve1D.STRUCT = `\r\nCurve1D {\r\n  generators  : array(abstract(CurveTypeData));\r\n  _active     : string | obj.generators.active.type;\r\n  VERSION     : float;\r\n  uiZoom      : float;\r\n  xRange      : vec2;\r\n  yRange      : vec2;\r\n  clipToRange : bool;\r\n}\r\n`;\r\nnstructjs.register(Curve1D);\r\n\r\n","import {Vector2, Matrix4, Quat, Vector3, Vector4} from '../path-controller/util/vectormath.js';\r\nimport * as math from '../path-controller/util/math.js'\r\nimport {color2css, css2color, parsepx} from './ui_theme.js';\r\nimport {Curve1D, getCurve} from \"../path-controller/curve/curve1d.js\";\r\nimport * as util from '../path-controller/util/util.js';\r\n\r\nclass Task {\r\n  constructor(taskcb) {\r\n    this.task = taskcb;\r\n    this.start = util.time_ms();\r\n    this.done = false;\r\n  }\r\n}\r\n\r\nexport class AnimManager {\r\n  constructor() {\r\n    this.tasks = [];\r\n    this.timer = undefined;\r\n\r\n    //all animation tasks that last longer then 10 seconds are terminated\r\n    this.timeOut = 10*1000.0;\r\n  }\r\n\r\n  stop() {\r\n    if (this.timer !== undefined) {\r\n      window.clearInterval(this.timer);\r\n      this.timer = undefined;\r\n    }\r\n  }\r\n\r\n  add(task) {\r\n    this.tasks.push(new Task(task));\r\n  }\r\n\r\n  remove(task) {\r\n    for (let t of this.tasks) {\r\n      if (t.task === task) {\r\n        t.dead = true;\r\n        this.tasks.remove(t);\r\n        return;\r\n      }\r\n    }\r\n  }\r\n\r\n  start() {\r\n    this.timer = window.setInterval(() => {\r\n      for (let t of this.tasks) {\r\n        try {\r\n          t.task();\r\n        } catch (error) {\r\n          t.done = true;\r\n          util.print_stack(error);\r\n        }\r\n\r\n        if (util.time_ms() - t.start > this.timeOut) {\r\n          t.dead = true;\r\n        }\r\n      }\r\n\r\n      for (let i=0; i<this.tasks.length; i++) {\r\n        if (this.tasks[i].done) {\r\n          let t = this.tasks[i];\r\n          this.tasks.remove(t);\r\n          i--;\r\n\r\n          try {\r\n            if (t.task.onend) {\r\n              t.task.onend();\r\n            }\r\n          } catch (error) {\r\n            util.print_stack(error);\r\n          }\r\n        }\r\n      }\r\n    }, 1000/40.0);\r\n  }\r\n}\r\n\r\n\r\nexport const manager = new AnimManager();\r\nmanager.start();\r\n\r\nexport class AbstractCommand {\r\n  constructor() {\r\n    this.cbs = [];\r\n    this.end_cbs = [];\r\n  }\r\n\r\n  start(animator, done) {\r\n\r\n  }\r\n\r\n  exec(animator, done) {\r\n\r\n  }\r\n}\r\n\r\nexport class WaitCommand extends AbstractCommand {\r\n  constructor(ms) {\r\n    super();\r\n    this.ms = ms;\r\n  }\r\n\r\n  start(animator, done) {\r\n    this.time = animator.time;\r\n  }\r\n\r\n  exec(animator, done) {\r\n    if (animator.time - this.time > this.ms) {\r\n      done();\r\n    }\r\n  }\r\n}\r\n\r\nexport class GoToCommand extends AbstractCommand {\r\n  constructor(obj, key, value, time, curve=\"ease\") {\r\n    super();\r\n\r\n    this.object = obj;\r\n    this.key = key;\r\n    this.value = value;\r\n    this.ms = time;\r\n\r\n    if (typeof curve === \"string\") {\r\n      this.curve = new (getCurve(curve))();\r\n    } else {\r\n      this.curve = curve;\r\n    }\r\n  }\r\n\r\n  start(animator, done) {\r\n    this.time = animator.time;\r\n\r\n    let value = this.object[this.key];\r\n\r\n    if (Array.isArray(value)) {\r\n      this.startValue = util.list(value);\r\n    } else {\r\n      this.startValue = value;\r\n    }\r\n  }\r\n\r\n  exec(animator, done) {\r\n    let t = animator.time - this.time;\r\n    let ms = this.ms;\r\n\r\n    if (t > ms) {\r\n      done();\r\n      t = ms;\r\n    }\r\n\r\n    t /= ms;\r\n\r\n    t = this.curve.evaluate(t);\r\n\r\n    if (Array.isArray(this.startValue)) {\r\n      let value = this.object[this.key];\r\n\r\n      for (let i=0; i<this.startValue.length; i++) {\r\n        if (value[i] === undefined || this.value[i] === undefined) {\r\n          continue;\r\n        }\r\n\r\n        value[i] = this.startValue[i] + (this.value[i] - this.startValue[i]) * t;\r\n      }\r\n    } else {\r\n      this.object[this.key] = this.startValue + (this.value - this.startValue) * t;\r\n\r\n    }\r\n  }\r\n}\r\n\r\nexport class SetCommand extends AbstractCommand {\r\n  constructor(obj, key, val) {\r\n    super();\r\n\r\n    this.object = obj;\r\n    this.key = key;\r\n    this.value = val;\r\n  }\r\n\r\n  start(animator, done) {\r\n    this.object[key] = val;\r\n    done();\r\n  }\r\n}\r\n\r\nexport class Command {\r\n  constructor(type, args) {\r\n    this.args = args;\r\n    this.cbs = [];\r\n  }\r\n}\r\n\r\nexport class Animator {\r\n  constructor(owner, method = \"update\") {\r\n    this.on_tick = this.on_tick.bind(this);\r\n    this.on_tick.onend = () => {\r\n      if (this.onend) {\r\n        this.onend();\r\n      }\r\n    }\r\n\r\n    this.commands = [];\r\n    this.owner = owner;\r\n    this._done = false;\r\n    this.method = method;\r\n    this.onend = null;\r\n    this.first = true;\r\n\r\n    this.time = 0.0;\r\n    this.last = util.time_ms();\r\n\r\n    this.bind(owner);\r\n  }\r\n\r\n  bind(owner) {\r\n    this._done = false;\r\n    this.owner = owner;\r\n    //this.owner[this.method].after(this.on_tick);\r\n    manager.add(this.on_tick);\r\n  }\r\n\r\n  wait(ms) {\r\n    this.commands.push(new WaitCommand(ms));\r\n    return this;\r\n  }\r\n\r\n  goto(key, val, timeMs, curve = \"ease\") {\r\n    let cmd = new GoToCommand(this.owner, key, val, timeMs, curve);\r\n    this.commands.push(cmd);\r\n    return this;\r\n  }\r\n\r\n  set(key, val, time) {\r\n    let cmd = new SetCommand(this.owner, key, val);\r\n    this.commands.push(cmd);\r\n    return this;\r\n  }\r\n\r\n  /** Call this while the current command is still being executed. */\r\n  while(cb) {\r\n    this.commands[this.commands.length - 1].cbs.push(cb);\r\n    return this;\r\n  }\r\n\r\n  then(cb) {\r\n    this.commands[this.commands.length-1].end_cbs.push(cb);\r\n    return this;\r\n  }\r\n\r\n  end() {\r\n    if (this._done) {\r\n      return;\r\n    }\r\n\r\n    this._done = true;\r\n    manager.remove(this.on_tick);\r\n    //this.owner.update.remove(this.on_tick);\r\n\r\n    if (this.onend) {\r\n      this.onend();\r\n    }\r\n  }\r\n\r\n  on_tick() {\r\n    if (this._done) {\r\n      throw new Error(\"animation wasn't properly cleaned up\");\r\n    }\r\n\r\n    let dt = util.time_ms() - this.last;\r\n    this.time += dt;\r\n    this.last = util.time_ms();\r\n\r\n    if (this.commands.length === 0) {\r\n      this.end();\r\n      return\r\n    }\r\n\r\n    let cmd = this.commands[0];\r\n    let done = false;\r\n\r\n    function donecb() {\r\n      done = true;\r\n    }\r\n\r\n    if (this.first) {\r\n      this.first = false;\r\n      //console.log(cmd, cmd.start)\r\n      cmd.start(this, donecb);\r\n    }\r\n\r\n    try {\r\n      cmd.exec(this, donecb);\r\n    } catch (error) {\r\n      done = true;\r\n      util.print_stack(error);\r\n    }\r\n\r\n    for (let cb of this.commands[0].cbs) {\r\n      try {\r\n        cb();\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n      }\r\n    }\r\n\r\n    if (done) {\r\n      for (let cb of this.commands[0].end_cbs) {\r\n        try {\r\n          cb();\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n        }\r\n      }\r\n      while (this.commands.length > 0) {\r\n        this.commands.shift();\r\n\r\n        done = false;\r\n\r\n        if (this.commands.length > 0) {\r\n          this.commands[0].start(this, donecb);\r\n        }\r\n\r\n        if (!done) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","export class token {\r\n  constructor(type, val, lexpos, lexlen, lineno, lexer, parser) {\r\n    this.type = type;\r\n    this.value = val;\r\n    this.lexpos = lexpos;\r\n    this.lexlen = lexlen;\r\n    this.lineno = lineno;\r\n    this.lexer = lexer;\r\n    this.parser = parser;\r\n  }\r\n\r\n  setValue(val) {\r\n    this.value = val;\r\n    return this;\r\n  }\r\n\r\n  toString() {\r\n    if (this.value !== undefined)\r\n      return \"token(type=\" + this.type + \", value='\" + this.value + \"')\"\r\n    else\r\n      return \"token(type=\" + this.type + \")\"\r\n  }\r\n}\r\n\r\n//func is optional. it takes a function\r\n//with one parameter, token, and either\r\n//a) returns the token, or b) returns\r\n//undefined, in which case the token\r\n//should be ignored by the lexer\r\nexport class tokdef {\r\n  constructor(name, regexpr, func) {\r\n    this.name = name;\r\n    this.re = regexpr\r\n    this.func = func\r\n  }\r\n}\r\n\r\nexport class PUTLParseError extends Error {\r\n}\r\n\r\n//errfunc is optional.  it requires\r\n//a function that takes one param, lexer,\r\n//and returns true if the lexer\r\n//should propegate an error when an error\r\n//has happened\r\nexport class lexer {\r\n  constructor(tokdef, errfunc) {\r\n    this.tokdef = tokdef;\r\n    this.tokens = new Array();\r\n    this.lexpos = 0;\r\n    this.lexdata = \"\";\r\n    this.lineno = 0;\r\n    this.errfunc = errfunc;\r\n    this.tokints = {}\r\n    this.print_tokens = false;\r\n    this.print_debug = false;\r\n\r\n    for (let i = 0; i < tokdef.length; i++) {\r\n      this.tokints[tokdef[i].name] = i;\r\n    }\r\n\r\n    this.statestack = [[\"__main__\", 0]];\r\n    this.states = {\"__main__\": [tokdef, errfunc]};\r\n    this.statedata = 0; //public variable\r\n  }\r\n\r\n  copy() {\r\n    let ret = new lexer(this.tokdef, this.errfunc);\r\n\r\n    for (let k in this.states) {\r\n      let state = this.states[k];\r\n\r\n      state = [state[0], state[1]];\r\n      ret.states[k] = state;\r\n    }\r\n\r\n    ret.statedata = this.statedata;\r\n\r\n    return ret;\r\n  }\r\n\r\n//errfunc is optional, defines state-specific error function\r\n  add_state(name, tokdef, errfunc) {\r\n    if (errfunc === undefined) {\r\n      errfunc = function (lexer) {\r\n        return true;\r\n      };\r\n    }\r\n\r\n    this.states[name] = [tokdef, errfunc];\r\n  }\r\n\r\n  tok_int(name) {\r\n\r\n  }\r\n\r\n  //statedata is optional.\r\n  //it stores state-specific data in lexer.statedata.\r\n  push_state(state, statedata) {\r\n    this.statestack.push([state, statedata])\r\n\r\n    state = this.states[state];\r\n    this.statedata = statedata;\r\n\r\n    this.tokdef = state[0];\r\n    this.errfunc = state[1];\r\n  }\r\n\r\n  pop_state() {\r\n    let item = this.statestack[this.statestack.length - 1];\r\n    let state = this.states[item[0]];\r\n\r\n    this.tokdef = state[0];\r\n    this.errfunc = state[1];\r\n    this.statedata = item[1];\r\n  }\r\n\r\n  input(str) {\r\n    //go back to main state\r\n    while (this.statestack.length > 1) {\r\n      this.pop_state();\r\n    }\r\n\r\n    this.lexdata = str;\r\n    this.lexpos = 0;\r\n    this.lineno = 0;\r\n    this.tokens = new Array();\r\n\r\n    this.peeked_tokens = [];\r\n  }\r\n\r\n  error() {\r\n    if (this.errfunc !== undefined && !this.errfunc(this))\r\n      return;\r\n\r\n    console.log(\"Syntax error near line \" + this.lineno);\r\n    let next = Math.min(this.lexpos + 8, this.lexdata.length);\r\n    console.log(\"  \" + this.lexdata.slice(this.lexpos, next));\r\n\r\n    throw new PUTLParseError(\"Parse error\");\r\n  }\r\n\r\n  peek() {\r\n    let tok = this.next(true);\r\n\r\n    if (tok === undefined)\r\n      return undefined;\r\n\r\n    this.peeked_tokens.push(tok);\r\n    return tok;\r\n  }\r\n\r\n\r\n  peek_i(i) {\r\n    while (this.peeked_tokens.length <= i) {\r\n      let t = this.peek();\r\n      if (t === undefined)\r\n        return undefined;\r\n    }\r\n\r\n    return this.peeked_tokens[i];\r\n  }\r\n\r\n  at_end() {\r\n    return this.lexpos >= this.lexdata.length && this.peeked_tokens.length === 0;\r\n  }\r\n\r\n  next(ignore_peek) {\r\n    if (ignore_peek !== true && this.peeked_tokens.length > 0) {\r\n      let tok = this.peeked_tokens[0];\r\n\r\n      if (this.print_debug) {\r\n        console.log(\"PEEK_SHIFTING\", \"\" + tok);\r\n      }\r\n\r\n      this.peeked_tokens.shift();\r\n\r\n      if (this.print_tokens) {\r\n        console.log(tok.toString());\r\n      }\r\n\r\n      return tok;\r\n    }\r\n\r\n    if (this.lexpos >= this.lexdata.length)\r\n      return undefined;\r\n\r\n    let ts = this.tokdef;\r\n    let tlen = ts.length;\r\n\r\n    let lexdata = this.lexdata.slice(this.lexpos, this.lexdata.length);\r\n\r\n    let results = []\r\n\r\n    for (let i = 0; i < tlen; i++) {\r\n      let t = ts[i];\r\n\r\n      if (t.re === undefined)\r\n        continue;\r\n\r\n      let res = t.re.exec(lexdata);\r\n\r\n      if (res !== null && res !== undefined && res.index === 0) {\r\n        results.push([t, res]);\r\n      }\r\n    }\r\n\r\n    let max_res = 0;\r\n    let theres = undefined;\r\n    for (let i = 0; i < results.length; i++) {\r\n      let res = results[i];\r\n\r\n      if (res[1][0].length > max_res) {\r\n        theres = res;\r\n        max_res = res[1][0].length;\r\n      }\r\n    }\r\n\r\n    if (theres === undefined) {\r\n      this.error();\r\n      return;\r\n    }\r\n\r\n    let def = theres[0];\r\n\r\n    let lexlen = max_res;\r\n    let tok = new token(def.name, theres[1][0], this.lexpos, lexlen, this.lineno, this, undefined);\r\n    this.lexpos += max_res;\r\n\r\n    if (def.func) {\r\n      tok = def.func(tok)\r\n\r\n      if (tok === undefined) {\r\n        return this.next(ignore_peek);\r\n      }\r\n    }\r\n\r\n    if (this.print_tokens) {\r\n      console.log(tok.toString());\r\n    }\r\n\r\n    if (!ignore_peek && this.print_debug) {\r\n      console.log(\"CONSUME\", tok.toString(), \"\\n\" + getTraceBack());\r\n    }\r\n\r\n    return tok;\r\n  }\r\n}\r\n\r\nexport function getTraceBack(limit, start) {\r\n  try {\r\n    throw new Error();\r\n  } catch (error) {\r\n    let stack = error.stack.split(\"\\n\");\r\n    stack = stack.slice(1, stack.length);\r\n\r\n    if (start === undefined) {\r\n      start = 0;\r\n    }\r\n\r\n    for (let i = 0; i < stack.length; i++) {\r\n      let l = stack[i];\r\n\r\n      let j = l.length - 1;\r\n      while (j > 0 && l[j] !== \"/\") {\r\n        j--;\r\n      }\r\n\r\n      let k = j;\r\n      while (k >= 0 && l[k] !== \"(\") {\r\n        k--;\r\n      }\r\n\r\n      let func = l.slice(0, k).trim();\r\n      let file = l.slice(j + 1, l.length - 1);\r\n\r\n      l = `  ${func} (${file})`;\r\n\r\n      if (l.search(/parseutil\\.js/) >= 0) {\r\n        start = Math.max(start, i);\r\n      }\r\n      stack[i] = l;\r\n    }\r\n\r\n    if (limit !== undefined) {\r\n      stack.length = Math.min(stack.length, limit);\r\n    }\r\n\r\n    if (start !== undefined) {\r\n      stack = stack.slice(start, stack.length);\r\n    }\r\n\r\n    stack = stack.join(\"\\n\");\r\n    return stack;\r\n  }\r\n}\r\n\r\nexport class parser {\r\n  constructor(lexer, errfunc) {\r\n    this.lexer = lexer;\r\n    this.errfunc = errfunc;\r\n    this.start = undefined;\r\n    this.userdata = undefined;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new parser(this.lexer.copy(), this.errfunc);\r\n    ret.start = this.start;\r\n\r\n    return ret;\r\n  }\r\n\r\n\r\n  parse(data, err_on_unconsumed) {\r\n    if (err_on_unconsumed === undefined)\r\n      err_on_unconsumed = true;\r\n\r\n    if (data !== undefined)\r\n      this.lexer.input(data);\r\n\r\n    let ret = this.start(this);\r\n\r\n    if (err_on_unconsumed && !this.lexer.at_end() && this.lexer.next() !== undefined) {\r\n      //console.log(this.lexer.lexdata.slice(this.lexer.lexpos-1, this.lexer.lexdata.length));\r\n      this.error(undefined, \"parser did not consume entire input\");\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  input(data) {\r\n    this.lexer.input(data);\r\n  }\r\n\r\n  error(tok, msg) {\r\n    if (msg === undefined)\r\n      msg = \"\"\r\n\r\n    let estr;\r\n\r\n    if (tok === undefined)\r\n      estr = \"Parse error at end of input: \" + msg\r\n    else\r\n      estr = \"Parse error at line \" + (tok.lineno + 1) + \": \" + msg;\r\n\r\n    let buf = \"1| \"\r\n    let ld = this.lexer.lexdata;\r\n    let l = 1;\r\n    for (let i = 0; i < ld.length; i++) {\r\n      let c = ld[i];\r\n      if (c === '\\n') {\r\n        l++;\r\n        buf += \"\\n\" + l + \"| \"\r\n      } else {\r\n        buf += c;\r\n      }\r\n    }\r\n\r\n    console.log(\"------------------\")\r\n    console.log(buf);\r\n    console.log(\"==================\")\r\n    console.log(estr);\r\n\r\n    if (this.errfunc && !this.errfunc(tok)) {\r\n      return;\r\n    }\r\n\r\n    throw new PUTLParseError(estr);\r\n  }\r\n\r\n  peek() {\r\n    let tok = this.lexer.peek();\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n\r\n    return tok;\r\n  }\r\n\r\n  peek_i(i) {\r\n    let tok = this.lexer.peek_i(i);\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n\r\n    return tok;\r\n  }\r\n\r\n  peeknext() {\r\n    return this.peek_i(0);\r\n  }\r\n\r\n  next() {\r\n    let tok = this.lexer.next();\r\n\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n\r\n    return tok;\r\n  }\r\n\r\n  optional(type) {\r\n    let tok = this.peek_i(0);\r\n\r\n    if (tok && tok.type === type) {\r\n      this.next();\r\n\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  at_end() {\r\n    return this.lexer.at_end();\r\n  }\r\n\r\n  expect(type, msg) {\r\n    let tok = this.next();\r\n\r\n    if (msg === undefined)\r\n      msg = type\r\n\r\n    if (tok === undefined || tok.type != type) {\r\n      this.error(tok, \"Expected \" + msg + \", not \" + tok.type);\r\n    }\r\n\r\n    return tok.value;\r\n  }\r\n}\r\n\r\nfunction test_parser() {\r\n  let basic_types = new set([\r\n    \"int\",\r\n    \"float\",\r\n    \"double\",\r\n    \"vec2\",\r\n    \"vec3\",\r\n    \"vec4\",\r\n    \"mat4\",\r\n    \"string\"]);\r\n\r\n  let reserved_tokens = new set([\r\n    \"int\",\r\n    \"float\",\r\n    \"double\",\r\n    \"vec2\",\r\n    \"vec3\",\r\n    \"vec4\",\r\n    \"mat4\",\r\n    \"string\",\r\n    \"static_string\",\r\n    \"array\"]);\r\n\r\n  function tk(name, re, func) {\r\n    return new tokdef(name, re, func);\r\n  }\r\n\r\n  let tokens = [\r\n    tk(\"ID\", /[a-zA-Z]+[a-zA-Z0-9_]*/, function (t) {\r\n      if (reserved_tokens.has(t.value)) {\r\n        t.type = t.value.toUpperCase();\r\n      }\r\n\r\n      return t;\r\n    }),\r\n    tk(\"OPEN\", /\\{/),\r\n    tk(\"CLOSE\", /}/),\r\n    tk(\"COLON\", /:/),\r\n    tk(\"JSCRIPT\", /\\|/, function (t) {\r\n      let js = \"\"\r\n      let lexer = t.lexer;\r\n      while (lexer.lexpos < lexer.lexdata.length) {\r\n        let c = lexer.lexdata[lexer.lexpos];\r\n        if (c === \"\\n\")\r\n          break;\r\n\r\n        js += c;\r\n        lexer.lexpos++;\r\n      }\r\n\r\n      if (js.endsWith(\";\")) {\r\n        js = js.slice(0, js.length - 1);\r\n        lexer.lexpos--;\r\n      }\r\n\r\n      t.value = js;\r\n      return t;\r\n    }),\r\n\r\n    tk(\"LPARAM\", /\\(/),\r\n    tk(\"RPARAM\", /\\)/),\r\n    tk(\"COMMA\", /,/),\r\n    tk(\"NUM\", /[0-9]/),\r\n    tk(\"SEMI\", /;/),\r\n    tk(\"NEWLINE\", /\\n/, function (t) {\r\n      t.lexer.lineno += 1;\r\n    }),\r\n    tk(\"SPACE\", / |\\t/, function (t) {\r\n      //throw out non-newline whitespace tokens\r\n    })\r\n  ];\r\n\r\n  for (let rt in reserved_tokens) {\r\n    tokens.push(tk(rt.toUpperCase()));\r\n  }\r\n\r\n  /*let a =\r\n  Loop {\r\n    eid : int;\r\n    flag : int;\r\n    index : int;\r\n    type : int;\r\n\r\n    co : vec3;\r\n    no : vec3;\r\n    loop : int | eid(loop);\r\n    edges : array(e, int) | e.eid;\r\n\r\n    loops : array(Loop);\r\n  }\r\n  `;\r\n  */\r\n\r\n  function errfunc(lexer) {\r\n    return true; //throw error\r\n  }\r\n\r\n  let lex = new lexer(tokens, errfunc)\r\n  console.log(\"Testing lexical scanner...\")\r\n\r\n  lex.input(a);\r\n\r\n  let tok;\r\n  while (tok = lex.next()) {\r\n    console.log(tok.toString())\r\n  }\r\n\r\n  let parser = new parser(lex);\r\n  parser.input(a);\r\n\r\n  function p_Array(p) {\r\n    p.expect(\"ARRAY\");\r\n    p.expect(\"LPARAM\");\r\n\r\n    let arraytype = p_Type(p);\r\n    let itername = \"\";\r\n\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = arraytype;\r\n      arraytype = p_Type(p);\r\n    }\r\n\r\n\r\n    p.expect(\"RPARAM\");\r\n\r\n    return {type: \"array\", data: {type: arraytype, iname: itername}};\r\n  }\r\n\r\n  function p_Type(p) {\r\n    let tok = p.peek()\r\n\r\n    if (tok.type === \"ID\") {\r\n      p.next();\r\n      return {type: \"struct\", data: \"\\\"\" + tok.value + \"\\\"\"};\r\n    } else if (basic_types.has(tok.type.toLowerCase())) {\r\n      p.next();\r\n      return {type: tok.type.toLowerCase()};\r\n    } else if (tok.type === \"ARRAY\") {\r\n      return p_Array(p);\r\n    } else {\r\n      p.error(tok, \"invalid type \" + tok.type); //(tok.value === \"\" ? tok.type : tok.value));\r\n    }\r\n  }\r\n\r\n  function p_Field(p) {\r\n    let field = {}\r\n\r\n    console.log(\"-----\", p.peek().type);\r\n\r\n    field.name = p.expect(\"ID\", \"struct field name\");\r\n    p.expect(\"COLON\");\r\n\r\n    field.type = p_Type(p);\r\n    field.set = undefined;\r\n    field.get = undefined;\r\n\r\n    let tok = p.peek();\r\n    if (tok.type === \"JSCRIPT\") {\r\n      field.get = tok.value;\r\n      p.next()\r\n    }\r\n\r\n    tok = p.peek();\r\n    if (tok.type === \"JSCRIPT\") {\r\n      field.set = tok.value;\r\n      p.next();\r\n    }\r\n\r\n    p.expect(\"SEMI\");\r\n\r\n    return field;\r\n  }\r\n\r\n  function p_Struct(p) {\r\n    let st = {}\r\n    st.name = p.expect(\"ID\", \"struct name\")\r\n    st.fields = [];\r\n\r\n    p.expect(\"OPEN\");\r\n\r\n    while (1) {\r\n      if (p.at_end()) {\r\n        p.error(undefined);\r\n      } else if (p.optional(\"CLOSE\")) {\r\n        break;\r\n      } else {\r\n        st.fields.push(p_Field(p));\r\n      }\r\n    }\r\n\r\n    return st;\r\n  }\r\n\r\n  let ret = p_Struct(parser);\r\n\r\n  console.log(JSON.stringify(ret));\r\n}\r\n","import {ToolClasses, ToolOp, ToolFlags, UndoFlags, ToolMacro} from './toolsys.js';\r\nimport {tokdef, lexer, parser, PUTLParseError} from '../util/parseutil.js';\r\nimport {DataPathError} from '../controller/controller_base.js';\r\nimport {cachering} from '../util/util.js';\r\n\r\nexport let ToolPaths = {};\r\n\r\nvar initToolPaths_run = false;\r\n\r\nexport function buildParser() {\r\n  let t = (name, re, func) => new tokdef(name, re, func);\r\n\r\n  let tokens = [\r\n    t('ID', /[a-zA-Z_$]+[a-zA-Z0-9_$]*/, (t) => {\r\n      if (t.value == \"true\" || t.value == \"false\") {\r\n        t.type = \"BOOL\";\r\n        t.value = t.value == \"true\";\r\n      }\r\n\r\n      return t;\r\n    }),\r\n    t('LPAREN', /\\(/),\r\n    t('RPAREN', /\\)/),\r\n    t('LSBRACKET', /\\[/),\r\n    t('RSBRACKET', /\\]/),\r\n    t('DOT', /\\./),\r\n    t('COMMA', /\\,/),\r\n    t('EQUALS', /\\=/),\r\n    t('STRLIT', /\"[^\"]*\"/, (t) => {\r\n      t.value = t.value.slice(1, t.value.length-1);\r\n      return t;\r\n    }),\r\n    t('STRLIT', /'[^']*'/, (t) => {\r\n      t.value = t.value.slice(1, t.value.length-1);\r\n      return t;\r\n    }),\r\n    t('NUMBER', /-?[0-9]+/, (t) => {\r\n      t.value = parseInt(t.value);\r\n      return t;\r\n    }),\r\n    t('NUMBER', /-?[0-9]+\\.[0-9]*/, (t) => {\r\n      t.value = parseFloat(t.value);\r\n      return t;\r\n    }),\r\n    t('WS', /[ \\n\\r\\t]/, (t) => undefined) //ignore whitespace\r\n  ];\r\n\r\n  let lexerror = (t) => {\r\n    console.warn(\"Parse error\");\r\n    return true;\r\n  };\r\n\r\n  let valid_datatypes = {\r\n    \"STRLIT\" : 1, \"NUMBER\" : 1, \"BOOL\" : 1\r\n  };\r\n\r\n  function p_Start(p) {\r\n    let args = {};\r\n\r\n    while (!p.at_end()) {\r\n      let keyword = p.expect(\"ID\");\r\n\r\n      p.expect(\"EQUALS\");\r\n\r\n      let t = p.next();\r\n      if (!(t.type in valid_datatypes)) {\r\n        throw new PUTLParseError(\"parse error: unexpected \" + t.type);\r\n      }\r\n\r\n      args[keyword] = t.value;\r\n    }\r\n\r\n    return args;\r\n  }\r\n\r\n  let lex = new lexer(tokens, lexerror)\r\n  let p = new parser(lex);\r\n  p.start = p_Start;\r\n\r\n  return p;\r\n}\r\n\r\nexport let Parser = buildParser();\r\n/*\r\nlet parse_rets = new cachering(() => return {\r\n  toolclass : undefined,\r\n  args : {}\r\n}, 64);\r\n//*/\r\n\r\nexport function parseToolPath(str, check_tool_exists=true) {\r\n  if (!initToolPaths_run) {\r\n    initToolPaths_run = true;\r\n    initToolPaths();\r\n  }\r\n\r\n  let startstr = str;\r\n\r\n  let i1 = str.search(/\\(/);\r\n  let i2 = str.search(/\\)/);\r\n  let args = \"\";\r\n\r\n  if (i1 >= 0 && i2 >= 0) {\r\n    args = str.slice(i1+1, i2).trim();\r\n    str = str.slice(0, i1).trim();\r\n  }\r\n\r\n  if (!(str in ToolPaths) && check_tool_exists) {\r\n    throw new DataPathError(\"unknown tool \" + str);\r\n  }\r\n\r\n  let ret;\r\n\r\n  try {\r\n    ret = Parser.parse(args);\r\n  } catch (error) {\r\n    console.log(error);\r\n    throw new DataPathError(`\"${startstr}\"\\n  ${error.message}`);\r\n  }\r\n\r\n  return {\r\n    toolclass : ToolPaths[str],\r\n    args      : ret\r\n  };\r\n}\r\n\r\nexport function testToolParser() {\r\n  let ret = parseToolPath(\"view3d.sometool(selectmode=1 str='str' bool=true)\", false);\r\n\r\n  return ret;\r\n}\r\n\r\nwindow.parseToolPath = parseToolPath;\r\n//window._ToolPaths = ToolPaths;\r\n\r\n//tool path parser for simple_toolsys.js\r\nexport function initToolPaths() {\r\n  for (let cls of ToolClasses) {\r\n    if (!cls.hasOwnProperty(\"tooldef\")) { //ignore abstract classes\r\n      continue;\r\n    }\r\n\r\n    let def = cls.tooldef();\r\n    let path = def.toolpath;\r\n\r\n    ToolPaths[path] = cls;\r\n  }\r\n}","import {ToolOp} from '../toolsys/toolsys.js';\r\nimport {print_stack} from '../util/util.js';\r\nimport {PropFlags, PropTypes} from '../toolsys/toolprop_abstract.js';\r\nimport {ToolProperty} from '../toolsys/toolprop.js';\r\nimport {DataPathError, isVecProperty, ListIface} from './controller_base.js';\r\n\r\nexport class ModelInterface {\r\n  constructor() {\r\n    this.prefix = \"\";\r\n  }\r\n\r\n  getToolDef(path) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  getToolPathHotkey(ctx, path) {\r\n    return undefined;\r\n  }\r\n\r\n  get list() {\r\n    throw new Error(\"implement me\");\r\n    return ListIface;\r\n  }\r\n\r\n  createTool(path, inputs = {}, constructor_argument = undefined) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  //returns tool class, or undefined if one cannot be found for path\r\n  parseToolPath(path) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  /**\r\n   * runs .undo,.redo if toolstack head is same as tool\r\n   *\r\n   * otherwise, .execTool(ctx, tool) is called.\r\n   *\r\n   * @param compareInputs : check if toolstack head has identical input values, defaults to false\r\n   * */\r\n  execOrRedo(ctx, toolop, compareInputs = false) {\r\n    return ctx.toolstack.execOrRedo(ctx, toolop, compareInputs);\r\n  }\r\n\r\n  execTool(ctx, path, inputs = {}, constructor_argument = undefined, event = undefined) {\r\n    return new Promise((accept, reject) => {\r\n      let tool = path;\r\n\r\n      try {\r\n        if (typeof tool == \"string\" || !(tool instanceof ToolOp)) {\r\n          tool = this.createTool(ctx, path, inputs, constructor_argument);\r\n        }\r\n      } catch (error) {\r\n        print_stack(error);\r\n        reject(error);\r\n        return;\r\n      }\r\n\r\n      //give client a chance to change tool instance directly\r\n      accept(tool);\r\n\r\n      //execute\r\n      try {\r\n        ctx.toolstack.execTool(ctx, tool, event);\r\n      } catch (error) { //for some reason chrome is suppressing errors\r\n        print_stack(error);\r\n        throw error;\r\n      }\r\n    });\r\n  }\r\n\r\n  //used by simple_controller.js for tagging error messages\r\n  pushReportContext(name) {\r\n\r\n  }\r\n\r\n  //used by simple_controller.js for tagging error messages\r\n  popReportContext() {\r\n\r\n  }\r\n\r\n  static toolRegistered(tool) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  static registerTool(tool) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  //not yet supported by path.ux's controller implementation\r\n  massSetProp(ctx, mass_set_path, value) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  /** takes a mass_set_path and returns an array of individual paths */\r\n  resolveMassSetPaths(ctx, mass_set_path) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  /**\r\n   * @example\r\n   *\r\n   * return {\r\n   *   obj      : [object owning property key]\r\n   *   parent   : [parent of obj]\r\n   *   key      : [property key]\r\n   *   subkey   : used by flag properties, represents a key within the property\r\n   *   value    : [value of property]\r\n   *   prop     : [optional toolprop.ToolProperty representing the property definition]\r\n   *   struct   : [optional datastruct representing the type, if value is an object]\r\n   *   mass_set : mass setter string, if controller implementation supports it\r\n   * }\r\n   */\r\n  resolvePath(ctx, path, ignoreExistence, rootStruct) {\r\n  }\r\n\r\n  setValue(ctx, path, val, rootStruct) {\r\n    let res = this.resolvePath(ctx, path, undefined, rootStruct);\r\n    let prop = res.prop;\r\n\r\n    if (prop !== undefined && (prop.flag & PropFlags.READ_ONLY)) {\r\n      throw new DataPathError(\"Tried to set read only property\");\r\n    }\r\n\r\n    if (prop !== undefined && (prop.flag & PropFlags.USE_CUSTOM_GETSET)) {\r\n      prop.dataref = res.obj;\r\n      prop.ctx = ctx;\r\n      prop.datapath = path;\r\n\r\n      if (res.subkey !== undefined) {\r\n        let val2 = prop.getValue();\r\n        if (typeof val2 === \"object\") {\r\n          val2 = val2.copy();\r\n        }\r\n\r\n        if (prop.type === PropTypes.FLAG) {\r\n          if (val) {\r\n            val2 |= prop.values[res.subkey];\r\n          } else {\r\n            val2 &= ~prop.values[res.subkey];\r\n          }\r\n\r\n          val = val2;\r\n        } else if (prop.type === PropTypes.ENUM) {\r\n          val = prop.values[res.subkey];\r\n        } else {\r\n          val2[res.subkey] = val;\r\n          val = val2;\r\n        }\r\n      }\r\n\r\n      prop.setValue(val);\r\n      return;\r\n    }\r\n\r\n    if (prop !== undefined) {\r\n      if (prop.type === PropTypes.CURVE && !val) {\r\n        throw new DataPathError(\"can't set curve data to nothing\");\r\n      }\r\n\r\n      let use_range = (prop.type & (PropTypes.INT | PropTypes.FLOAT));\r\n\r\n      use_range = use_range || (res.subkey && (prop.type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4)));\r\n      use_range = use_range && prop.range;\r\n      use_range = use_range && !(prop.range[0] === 0.0 && prop.range[1] === 0.0);\r\n      use_range = use_range && typeof val === \"number\";\r\n\r\n      if (use_range) {\r\n        val = Math.min(Math.max(val, prop.range[0]), prop.range[1]);\r\n      }\r\n    }\r\n\r\n    let old = res.obj[res.key];\r\n\r\n    if (res.subkey !== undefined && res.prop !== undefined && res.prop.type === PropTypes.ENUM) {\r\n      let ival = res.prop.values[res.subkey];\r\n\r\n      if (val) {\r\n        res.obj[res.key] = ival;\r\n      }\r\n    } else if (res.prop !== undefined && res.prop.type === PropTypes.FLAG) {\r\n      if (res.subkey !== undefined) {\r\n        let ival = res.prop.values[res.subkey];\r\n\r\n        if (val) {\r\n          res.obj[res.key] |= ival;\r\n        } else {\r\n          res.obj[res.key] &= ~ival;\r\n        }\r\n      } else if (typeof val === \"number\" || typeof val === \"boolean\") {\r\n        val = typeof val === \"boolean\" ? (val & 1) : val;\r\n\r\n        res.obj[res.key] = val;\r\n      } else {\r\n        throw new DataPathError(\"Expected a number for a bitmask property\");\r\n      }\r\n    } else if (res.subkey !== undefined && isVecProperty(res.prop)) {\r\n      if (res.key !== \"\") {\r\n        res.obj[res.key][res.subkey] = val;\r\n      } else {\r\n        res.obj[res.subkey] = val;\r\n      }\r\n    } else if (res.key === \"\" && isVecProperty(res.prop)) {\r\n      for (let i = 0; i < res.obj.length; i++) {\r\n        res.obj[i] = val[i];\r\n      }\r\n    } else if (!(prop !== undefined && prop instanceof ListIface)) {\r\n      res.obj[res.key] = val;\r\n    }\r\n\r\n    if (prop !== undefined && prop instanceof ListIface) {\r\n      prop.set(this, res.obj, res.key, val);\r\n    } else if (prop !== undefined) {\r\n      prop.dataref = res.obj;\r\n      prop.datapath = path;\r\n      prop.ctx = ctx;\r\n\r\n      prop._fire(\"change\", res.obj[res.key], old);\r\n    }\r\n  }\r\n\r\n  getDescription(ctx, path) {\r\n    let rdef = this.resolvePath(ctx, path);\r\n    if (rdef === undefined) {\r\n      throw new DataPathError(\"invalid path \" + path);\r\n    }\r\n\r\n    if (!rdef.prop || !(rdef.prop instanceof ToolProperty)) {\r\n      return \"\";\r\n    }\r\n\r\n    let type = rdef.prop.type;\r\n    let prop = rdef.prop;\r\n\r\n    if (rdef.subkey !== undefined) {\r\n      let subkey = rdef.subkey;\r\n\r\n      if (type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4)) {\r\n        if (prop.descriptions && subkey in prop.descriptions) {\r\n          return prop.descriptions[subkey];\r\n        }\r\n      } else if (type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n        if (!(subkey in prop.values) && subkey in prop.keys) {\r\n          subkey = prop.keys[subkey]\r\n        }\r\n        ;\r\n\r\n        if (prop.descriptions && subkey in prop.descriptions) {\r\n          return prop.descriptions[subkey];\r\n        }\r\n      } else if (type === PropTypes.PROPLIST) {\r\n        let val = tdef.value;\r\n        if (typeof val === \"object\" && val instanceof ToolProperty) {\r\n          return val.description;\r\n        }\r\n      }\r\n    }\r\n\r\n    return rdef.prop.description ? rdef.prop.description : rdef.prop.uiname;\r\n  }\r\n\r\n  validPath(ctx, path, rootStruct) {\r\n    try {\r\n      this.getValue(ctx, path, rootStruct);\r\n      return true;\r\n    } catch (error) {\r\n      if (!(error instanceof DataPathError)) {\r\n        throw error;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  getPropName(ctx, path) {\r\n    let i = path.length - 1;\r\n    while (i >= 0 && path[i] !== \".\") {\r\n      i--;\r\n    }\r\n\r\n    path = path.slice(i + 1, path.length).trim();\r\n\r\n    if (path.endsWith(\"]\")) {\r\n      i = path.length - 1;\r\n      while (i >= 0 && path[i] !== \"[\") {\r\n        i--;\r\n      }\r\n\r\n      path = path.slice(0, i).trim();\r\n\r\n      return this.getPropName(ctx, path);\r\n    }\r\n\r\n    return path;\r\n  }\r\n\r\n  getValue(ctx, path, rootStruct = undefined) {\r\n    if (typeof ctx == \"string\") {\r\n      throw new Error(\"You forgot to pass context to getValue\");\r\n    }\r\n\r\n    let ret = this.resolvePath(ctx, path, undefined, rootStruct);\r\n\r\n    if (ret === undefined) {\r\n      throw new DataPathError(\"invalid path \" + path);\r\n    }\r\n\r\n    let exec = ret.prop !== undefined && (ret.prop.flag & PropFlags.USE_CUSTOM_GETSET);\r\n\r\n    //resolvePath handles the case of vector properties with custom callbacks for us\r\n    //(and possibly all the other cases too, need to check)\r\n    exec = exec && !(ret.prop !== undefined && (ret.prop.type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4 | PropTypes.QUAT)));\r\n\r\n    if (exec) {\r\n      ret.prop.dataref = ret.obj;\r\n      ret.prop.datapath = path;\r\n      ret.prop.ctx = ctx;\r\n\r\n      let val = ret.prop.getValue();\r\n\r\n      if (typeof val === \"string\" && (ret.prop.type & (PropTypes.FLAG | PropTypes.ENUM))) {\r\n        val = ret.prop.values[val];\r\n      }\r\n\r\n      if (ret.subkey && ret.prop.type === PropTypes.ENUM) {\r\n        val = val === ret.prop.values[ret.subkey];\r\n      } else if (ret.subkey && ret.prop.type === PropTypes.FLAG) {\r\n        val = val & ret.prop.values[ret.subkey];\r\n      }\r\n\r\n      return val;\r\n\r\n    }\r\n\r\n    return ret.value;\r\n  }\r\n}\r\n","import {ToolOp, ToolFlags} from \"../toolsys/toolsys.js\";\r\nimport {\r\n  PropTypes, PropFlags, BoolProperty, IntProperty, FloatProperty, FlagProperty,\r\n  EnumProperty, StringProperty, Vec3Property, Vec2Property, Vec4Property,\r\n  QuatProperty, Mat4Property\r\n} from \"../toolsys/toolprop.js\";\r\n\r\nimport * as util from '../util/util.js';\r\nimport {isVecProperty, getVecClass} from \"./controller_base.js\";\r\n\r\nexport class DataPathSetOp extends ToolOp {\r\n  constructor() {\r\n    super();\r\n\r\n    this.propType = -1;\r\n    this._undo = undefined;\r\n  }\r\n\r\n  setValue(ctx, val, object) {\r\n    let prop = this.inputs.prop;\r\n    let path = this.inputs.dataPath.getValue();\r\n\r\n    if (prop.type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n      let rdef = ctx.api.resolvePath(ctx, path);\r\n      if (rdef.subkey !== undefined) {\r\n        let subkey = rdef.subkey;\r\n        if (typeof subkey === \"string\") {\r\n          subkey = rdef.prop.values[subkey];\r\n        }\r\n\r\n        this.inputs.flagBit.setValue(subkey);\r\n        this.inputs.useFlagBit.setValue(true);\r\n      }\r\n\r\n      //if (rdef.subkey !== undefined) {\r\n      //  val = rdef.value;\r\n      //val = !!val;\r\n      //}\r\n    }\r\n\r\n    prop.dataref = object;\r\n    prop.ctx = ctx;\r\n    prop.datapath = path;\r\n\r\n    try {\r\n      prop.setValue(val);\r\n      this.hadError = false;\r\n    } catch (error) {\r\n      console.error(\"Error setting datapath\", path);\r\n      this.hadError = true;\r\n    }\r\n  }\r\n\r\n  static create(ctx, datapath, value, id, massSetPath) {\r\n    let rdef = ctx.api.resolvePath(ctx, datapath);\r\n\r\n    if (rdef === undefined || rdef.prop === undefined) {\r\n      console.warn(\"DataPathSetOp failed\", rdef, rdef.prop);\r\n      return;\r\n    }\r\n\r\n    let prop = rdef.prop;\r\n    let tool = new DataPathSetOp();\r\n\r\n    tool.propType = prop.type;\r\n    tool.inputs.destType.setValue(prop.type);\r\n\r\n    if (prop && (prop.flag & PropFlags.USE_BASE_UNDO)) {\r\n      tool.inputs.fullSaveUndo.setValue(true);\r\n    }\r\n\r\n    let mask = PropTypes.FLAG | PropTypes.ENUM;\r\n    mask |= PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4 | PropTypes.QUAT;\r\n\r\n    if (rdef.subkey !== undefined && (prop.type & mask)) {\r\n      if (prop.type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n        let i = datapath.length - 1;\r\n\r\n        //chope off enum selector\r\n        while (i >= 0 && datapath[i] !== '[' && datapath[i] !== '=') {\r\n          i--;\r\n        }\r\n\r\n        if (i >= 0) {\r\n          if (!value && prop.type === PropTypes.ENUM) {\r\n            /* This is a no-op. */\r\n            return undefined;\r\n          }\r\n\r\n          datapath = datapath.slice(0, i).trim();\r\n        }\r\n\r\n        tool.inputs.prop = new IntProperty();\r\n      } else {\r\n        tool.inputs.prop = new FloatProperty();\r\n      }\r\n\r\n      let subkey = rdef.subkey;\r\n      if (typeof subkey !== \"number\") {\r\n        subkey = rdef.prop.values[subkey];\r\n      }\r\n\r\n      if (prop.type === PropTypes.FLAG) {\r\n        tool.inputs.flagBit.setValue(subkey);\r\n        tool.inputs.useFlagBit.setValue(true);\r\n      }\r\n\r\n      if (prop.type === PropTypes.ENUM) {\r\n        value = subkey;\r\n      } else if (prop.type === PropTypes.FLAG) {\r\n        let value2 = ctx.api.getValue(ctx, datapath);\r\n\r\n        if (typeof value2 !== \"number\") {\r\n          value2 = typeof value2 === \"boolean\" ? (value & 1) : 0;\r\n        }\r\n\r\n        if (value) {\r\n          value2 |= subkey;\r\n        } else {\r\n          value2 &= ~subkey;\r\n        }\r\n\r\n        value = value2;\r\n      }\r\n      //value = rdef.obj[rdef.key];\r\n      //console.log(\"rdef.value\", value);\r\n    } else {\r\n      tool.inputs.prop = prop.copy();\r\n    }\r\n\r\n    tool.inputs.dataPath.setValue(datapath);\r\n\r\n    if (massSetPath) {\r\n      tool.inputs.massSetPath.setValue(massSetPath);\r\n    } else {\r\n      tool.inputs.massSetPath.setValue(\"\");\r\n    }\r\n\r\n    tool.id = id;\r\n\r\n    tool.setValue(ctx, value, rdef.obj);\r\n\r\n    return tool;\r\n  }\r\n\r\n  hash(massSetPath, dataPath, prop, id) {\r\n    massSetPath = massSetPath === undefined ? \"\" : massSetPath;\r\n    massSetPath = massSetPath === null ? \"\" : massSetPath;\r\n\r\n    let ret = \"\" + massSetPath + \":\" + dataPath + \":\" + prop + \":\" + id;\r\n\r\n    return ret;\r\n  }\r\n\r\n  hashThis() {\r\n    return this.hash(this.inputs.massSetPath.getValue(),\r\n      this.inputs.dataPath.getValue(),\r\n      this.propType,\r\n      this.id);\r\n  }\r\n\r\n  undoPre(ctx) {\r\n    if (this.inputs.fullSaveUndo.getValue()) {\r\n      return super.undoPre(ctx);\r\n    }\r\n\r\n    if (this.__ctx)\r\n      ctx = this.__ctx;\r\n\r\n    this._undo = {};\r\n\r\n    let paths = new Set();\r\n\r\n    if (this.inputs.massSetPath.getValue().trim()) {\r\n      let massSetPath = this.inputs.massSetPath.getValue().trim();\r\n\r\n      paths = new Set(ctx.api.resolveMassSetPaths(ctx, massSetPath));\r\n\r\n    }\r\n\r\n    paths.add(this.inputs.dataPath.getValue());\r\n\r\n    for (let path of paths) {\r\n      let val = ctx.api.getValue(ctx, path);\r\n\r\n      if (typeof val === \"object\") {\r\n        val = val.copy();\r\n      }\r\n\r\n      this._undo[path] = val;\r\n    }\r\n\r\n    /*\r\n    for (let path of paths) {\r\n      let rdef = ctx.api.resolvePath(ctx, path);\r\n\r\n      if (rdef === undefined) {\r\n        console.warn(\"Failed to lookup path in DataPathSetOp.undoPre\", path);\r\n        continue;\r\n      }\r\n\r\n      let prop = rdef.prop;\r\n      let value = rdef.value;\r\n\r\n      if (prop.type & (PropTypes.ENUM|PropTypes.FLAG)) {\r\n        this._undo[path] = rdef.obj[rdef.key];\r\n      } else if (isVecProperty(prop)) {\r\n        if (rdef.subkey) {\r\n          this._undo[path] = rdef.value;\r\n        } else {\r\n          let cls = getVecClass(prop.type);\r\n          this._undo[path] = new cls(rdef.value);\r\n        }\r\n      } else {\r\n        let prop2 = prop.copy();\r\n\r\n        prop2.dataref = rdef.obj;\r\n        prop2.datapath = path;\r\n        prop2.ctx = ctx;\r\n\r\n        prop2.setValue(value);\r\n\r\n        this._undo[path] = prop2.getValue();\r\n      }\r\n    }*/\r\n  }\r\n\r\n  undo(ctx) {\r\n    if (this.__ctx)\r\n      ctx = this.__ctx;\r\n\r\n    if (this.inputs.fullSaveUndo.getValue()) {\r\n      return super.undo(ctx);\r\n    }\r\n\r\n    for (let path in this._undo) {\r\n      let rdef = ctx.api.resolvePath(ctx, path);\r\n\r\n      if (rdef.prop !== undefined && (rdef.prop.type & (PropTypes.ENUM | PropTypes.FLAG))) {\r\n        let old = rdef.obj[rdef.key];\r\n\r\n        if (rdef.subkey) {\r\n          let key = rdef.subkey;\r\n\r\n          if (typeof key !== \"number\") {\r\n            key = rdef.prop.values[key];\r\n          }\r\n\r\n          if (rdef.prop.type === PropTypes.FLAG) {\r\n            if (this._undo[path]) {\r\n              rdef.obj[rdef.key] |= key;\r\n            } else {\r\n              rdef.obj[rdef.key] &= ~key;\r\n            }\r\n          } else {\r\n            rdef.obj[rdef.key] = key;\r\n          }\r\n        } else {\r\n          rdef.obj[rdef.key] = this._undo[path];\r\n        }\r\n\r\n        rdef.prop.dataref = rdef.obj;\r\n        rdef.prop.datapath = path;\r\n        rdef.prop.ctx = ctx;\r\n\r\n        rdef.prop._fire(\"change\", rdef.obj[rdef.key], old);\r\n      } else {\r\n        try {\r\n          ctx.api.setValue(ctx, path, this._undo[path]);\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n          console.warn(\"Failed to set property in undo for DataPathSetOp\");\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  exec(ctx) {\r\n    //use saved ctx we got from modal start\r\n    if (this.__ctx) {\r\n      ctx = this.__ctx;\r\n    }\r\n\r\n    let path = this.inputs.dataPath.getValue();\r\n    let massSetPath = this.inputs.massSetPath.getValue().trim();\r\n\r\n    try {\r\n      ctx.api.setValue(ctx, path, this.inputs.prop.getValue());\r\n      this.hadError = false;\r\n    } catch (error) {\r\n      console.log(error.stack);\r\n      console.log(error.message);\r\n      console.log(\"error setting \" + path);\r\n\r\n      this.hadError = true;\r\n    }\r\n\r\n    if (massSetPath) {\r\n      let value = this.inputs.prop.getValue();\r\n      let useFlagBit = this.inputs.useFlagBit.getValue();\r\n\r\n      if (useFlagBit && this.inputs.destType.getValue() === PropTypes.FLAG) {\r\n        let bit = this.inputs.flagBit.getValue();\r\n\r\n        value = !!(value & bit);\r\n      }\r\n      try {\r\n        ctx.api.massSetProp(ctx, massSetPath, value);\r\n      } catch (error) {\r\n        console.log(error.stack);\r\n        console.log(error.message);\r\n        console.log(\"error setting \" + path);\r\n\r\n        this.hadError = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  modalStart(ctx) {\r\n    this.__ctx = ctx.toLocked();\r\n\r\n    //save full, modal ctx\r\n    super.modalStart(this.__ctx);\r\n\r\n    this.exec(this.__ctx);\r\n    this.modalEnd(false);\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname  : \"Property Set\",\r\n      toolpath: \"app.prop_set\",\r\n      icon    : -1,\r\n      flag    : ToolFlags.PRIVATE,\r\n      is_modal: true,\r\n      inputs  : {\r\n        dataPath    : new StringProperty(),\r\n        massSetPath : new StringProperty(),\r\n        fullSaveUndo: new BoolProperty(false),\r\n        flagBit     : new IntProperty(),\r\n        useFlagBit  : new BoolProperty(),\r\n        destType    : new EnumProperty(PropTypes.INT, PropTypes),\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nToolOp.register(DataPathSetOp);\r\n","import nstructjs from \"../util/struct.js\";\r\nimport {CurveFlags, TangentModes, CurveTypeData} from './curve1d_base.js';\r\nimport {Vector2, Vector3, Vector4, Quat, Matrix4} from '../util/vectormath.js';\r\nimport * as util from '../util/util.js';\r\n\r\nlet _udigest = new util.HashDigest();\r\n\r\nfunction feq(a, b) {\r\n  return Math.abs(a - b) < 0.00001;\r\n}\r\n\r\nclass EquationCurve extends CurveTypeData {\r\n  constructor(type) {\r\n    super();\r\n\r\n    this.equation = \"x\";\r\n    this._last_equation = \"\";\r\n    this._last_xrange = new Vector2();\r\n    this._func = undefined;\r\n  }\r\n\r\n  get hasGUI() {\r\n    return this.uidata !== undefined;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      uiname  : \"Equation\",\r\n      name    : \"equation\",\r\n      typeName: \"EquationCurve\"\r\n    }\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    let d = digest;\r\n\r\n    super.calcHashKey(d);\r\n\r\n    d.add(this.equation);\r\n    d.add(this.parent.xRange[0]);\r\n    d.add(this.parent.xRange[1]);\r\n\r\n    return d.get();\r\n  }\r\n\r\n  equals(b) {\r\n    return super.equals(b) && this.equation === b.equation;\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = super.toJSON();\r\n\r\n    return Object.assign(ret, {\r\n      equation: this.equation\r\n    });\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    if (obj.equation !== undefined) {\r\n      this.equation = obj.equation;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  makeGUI(container, canvas, drawTransform) {\r\n    this.uidata = {\r\n      canvas    : canvas,\r\n      g         : canvas.g,\r\n      draw_trans: drawTransform,\r\n    };\r\n\r\n    let row = container.row();\r\n\r\n    let text = this.uidata.textbox = row.textbox(undefined, \"\" + this.equation);\r\n    text.onchange = (val) => {\r\n      console.log(val);\r\n      this.equation = val;\r\n      this.update();\r\n      this.redraw();\r\n    }\r\n\r\n    container.label(\"Equation\");\r\n\r\n  }\r\n\r\n  killGUI(dom, gui, canvas, g, draw_transform) {\r\n    if (this.uidata !== undefined) {\r\n      this.uidata.textbox.remove();\r\n    }\r\n\r\n    this.uidata = undefined;\r\n  }\r\n\r\n  updateTextBox() {\r\n    if (this.uidata && this.uidata.textbox) {\r\n      this.uidata.textbox.text = this.equation;\r\n    }\r\n  }\r\n\r\n  evaluate(s) {\r\n    let update = this.hermite || this._last_equation !== this.equation;\r\n    update = update || this._last_xrange.vectorDistance(this.parent.xRange) > 0.0;\r\n    update = update || !this._func;\r\n\r\n    if (update) {\r\n      this._last_xrange.load(this.parent.xRange);\r\n      this._last_equation = this.equation;\r\n\r\n      this.updateTextBox();\r\n      this.#makeFunc();\r\n\r\n      this._evaluate(0.0);\r\n\r\n      if (this._haserror) {\r\n        console.warn(\"ERROR!\");\r\n        return 0.0;\r\n      }\r\n    }\r\n\r\n    return this._func(s);\r\n  }\r\n\r\n  #makeFunc() {\r\n    this._func = undefined;\r\n\r\n    var sin = Math.sin, cos = Math.cos, pi = Math.PI, PI = Math.PI,\r\n        e                                                = Math.E, E                                    = Math.E, tan                      = Math.tan, abs = Math.abs,\r\n        floor                                            = Math.floor, ceil = Math.ceil, acos = Math.acos,\r\n        asin                                             = Math.asin, atan = Math.atan, cosh         = Math.cos,\r\n        sinh                                             = Math.sinh, log                            = Math.log, pow = Math.pow,\r\n        exp                                              = Math.exp, sqrt = Math.sqrt, cbrt           = Math.cbrt,\r\n        min                                              = Math.min, max = Math.max;\r\n\r\n    var func;\r\n    let code = `\r\n    func = function(x) {\r\n      return ${this.equation};\r\n    }\r\n    `;\r\n    try {\r\n      eval(code);\r\n\r\n      this._haserror = false;\r\n    } catch (error) {\r\n      this._haserror = true;\r\n      console.warn(\"Compile error!\", error.message);\r\n    }\r\n\r\n    this._func = func;\r\n  }\r\n\r\n  _evaluate(s) {\r\n    try {\r\n      let f = this._func(s);\r\n      this._haserror = false;\r\n\r\n      if (isNaN(f)) {\r\n        return 0.0;\r\n      }\r\n    } catch (error) {\r\n      this._haserror = true;\r\n      console.warn(\"ERROR!\");\r\n      return 0.0;\r\n    }\r\n  }\r\n\r\n  derivative(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.evaluate(s) - this.evaluate(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.evaluate(s + df) - this.evaluate(s))/df;\r\n    } else {\r\n      return (this.evaluate(s + df) - this.evaluate(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  derivative2(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.derivative(s) - this.derivative(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.derivative(s + df) - this.derivative(s))/df;\r\n    } else {\r\n      return (this.derivative(s + df) - this.derivative(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  inverse(y) {\r\n    let steps = 9;\r\n    let ds = 1.0/steps, s = 0.0;\r\n    let best = undefined;\r\n    let ret = undefined;\r\n\r\n    for (let i = 0; i < steps; i++, s += ds) {\r\n      let s1 = s, s2 = s + ds;\r\n\r\n      let mid;\r\n\r\n      for (let j = 0; j < 11; j++) {\r\n        let y1 = this.evaluate(s1);\r\n        let y2 = this.evaluate(s2);\r\n        mid = (s1 + s2)*0.5;\r\n\r\n        if (Math.abs(y1 - y) < Math.abs(y2 - y)) {\r\n          s2 = mid;\r\n        } else {\r\n          s1 = mid;\r\n        }\r\n      }\r\n\r\n      let ymid = this.evaluate(mid);\r\n\r\n      if (best === undefined || Math.abs(y - ymid) < best) {\r\n        best = Math.abs(y - ymid);\r\n        ret = mid;\r\n      }\r\n    }\r\n\r\n    return ret === undefined ? 0.0 : ret;\r\n  }\r\n\r\n  onActive(parent, draw_transform) {\r\n  }\r\n\r\n  onInactive(parent, draw_transform) {\r\n  }\r\n\r\n  reset() {\r\n    this.equation = \"x\";\r\n  }\r\n\r\n  destroy() {\r\n  }\r\n\r\n  draw(canvas, g, draw_transform) {\r\n    g.save();\r\n    if (this._haserror) {\r\n\r\n      g.fillStyle = g.strokeStyle = \"rgba(255, 50, 0, 0.25)\";\r\n      g.beginPath();\r\n      g.rect(0, 0, 1, 1);\r\n      g.fill();\r\n\r\n      g.beginPath();\r\n      g.moveTo(0, 0);\r\n      g.lineTo(1, 1);\r\n      g.moveTo(0, 1);\r\n      g.lineTo(1, 0);\r\n\r\n      g.lineWidth *= 3;\r\n      g.stroke();\r\n\r\n      g.restore();\r\n      return;\r\n    }\r\n\r\n    g.restore();\r\n  }\r\n}\r\n\r\nEquationCurve.STRUCT = nstructjs.inherit(EquationCurve, CurveTypeData) + `\r\n  equation : string;\r\n}\r\n`;\r\nnstructjs.register(EquationCurve);\r\nCurveTypeData.register(EquationCurve);\r\n\r\n\r\nclass GuassianCurve extends CurveTypeData {\r\n  constructor(type) {\r\n    super();\r\n\r\n    this.height = 1.0;\r\n    this.offset = 1.0;\r\n    this.deviation = 0.3; //standard deviation\r\n  }\r\n\r\n  get hasGUI() {\r\n    return this.uidata !== undefined;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      uiname  : \"Guassian\",\r\n      name    : \"guassian\",\r\n      typeName: \"GuassianCurve\"\r\n    }\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    super.calcHashKey(digest);\r\n\r\n    let d = digest;\r\n\r\n    d.add(this.height);\r\n    d.add(this.offset);\r\n    d.add(this.deviation);\r\n\r\n    return d.get();\r\n  }\r\n\r\n  equals(b) {\r\n    let r = super.equals(b);\r\n\r\n    r = r && feq(this.height, b.height);\r\n    r = r && feq(this.offset, b.offset);\r\n    r = r && feq(this.deviation, b.deviation);\r\n\r\n    return r;\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = super.toJSON();\r\n\r\n    return Object.assign(ret, {\r\n      height   : this.height,\r\n      offset   : this.offset,\r\n      deviation: this.deviation\r\n    });\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    this.height = obj.height !== undefined ? obj.height : 1.0;\r\n    this.offset = obj.offset;\r\n    this.deviation = obj.deviation;\r\n\r\n    return this;\r\n  }\r\n\r\n  makeGUI(container, canvas, drawTransform) {\r\n    this.uidata = {\r\n      canvas    : canvas,\r\n      g         : canvas.g,\r\n      draw_trans: drawTransform,\r\n    };\r\n\r\n    this.uidata.hslider = container.slider(undefined, \"Height\", this.height, -10, 10, 0.0001);\r\n    this.uidata.hslider.onchange = () => {\r\n      this.height = this.uidata.hslider.value;\r\n      this.redraw();\r\n      this.update();\r\n    }\r\n    this.uidata.oslider = container.slider(undefined, \"Offset\", this.offset, -10, 10, 0.0001);\r\n    this.uidata.oslider.onchange = () => {\r\n      this.offset = this.uidata.oslider.value;\r\n      this.redraw();\r\n      this.update();\r\n    }\r\n    this.uidata.dslider = container.slider(undefined, \"STD Deviation\", this.deviation, -10, 10, 0.0001);\r\n    this.uidata.dslider.onchange = () => {\r\n      this.deviation = this.uidata.dslider.value;\r\n      this.redraw();\r\n      this.update();\r\n    }\r\n\r\n    /*\r\n    this.uidata.oslider = gui.slider(undefined, \"Offset\", this.offset,\r\n      -2.5, 2.5, 0.0001, false, false, (val) => {this.offset = val, this.update(), this.redraw();});\r\n    this.uidata.dslider = gui.slider(undefined, \"STD Deviation\", this.deviation,\r\n      0.0001, 1.25, 0.0001, false, false, (val) => {this.deviation = val, this.update(), this.redraw();});\r\n    //*/\r\n  }\r\n\r\n  killGUI(dom, gui, canvas, g, draw_transform) {\r\n    if (this.uidata !== undefined) {\r\n      this.uidata.hslider.remove();\r\n      this.uidata.oslider.remove();\r\n      this.uidata.dslider.remove();\r\n    }\r\n\r\n    this.uidata = undefined;\r\n  }\r\n\r\n  evaluate(s) {\r\n    let r = this.height*Math.exp(-((s - this.offset)*(s - this.offset))/(2*this.deviation*this.deviation));\r\n    return r;\r\n  }\r\n\r\n  derivative(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.evaluate(s) - this.evaluate(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.evaluate(s + df) - this.evaluate(s))/df;\r\n    } else {\r\n      return (this.evaluate(s + df) - this.evaluate(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  derivative2(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.derivative(s) - this.derivative(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.derivative(s + df) - this.derivative(s))/df;\r\n    } else {\r\n      return (this.derivative(s + df) - this.derivative(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  inverse(y) {\r\n    let steps = 9;\r\n    let ds = 1.0/steps, s = 0.0;\r\n    let best = undefined;\r\n    let ret = undefined;\r\n\r\n    for (let i = 0; i < steps; i++, s += ds) {\r\n      let s1 = s, s2 = s + ds;\r\n\r\n      let mid;\r\n\r\n      for (let j = 0; j < 11; j++) {\r\n        let y1 = this.evaluate(s1);\r\n        let y2 = this.evaluate(s2);\r\n        mid = (s1 + s2)*0.5;\r\n\r\n        if (Math.abs(y1 - y) < Math.abs(y2 - y)) {\r\n          s2 = mid;\r\n        } else {\r\n          s1 = mid;\r\n        }\r\n      }\r\n\r\n      let ymid = this.evaluate(mid);\r\n\r\n      if (best === undefined || Math.abs(y - ymid) < best) {\r\n        best = Math.abs(y - ymid);\r\n        ret = mid;\r\n      }\r\n    }\r\n\r\n    return ret === undefined ? 0.0 : ret;\r\n  }\r\n}\r\n\r\nGuassianCurve.STRUCT = nstructjs.inherit(GuassianCurve, CurveTypeData) + `\r\n  height    : float;\r\n  offset    : float;\r\n  deviation : float;\r\n}\r\n`;\r\nnstructjs.register(GuassianCurve);\r\nCurveTypeData.register(GuassianCurve);\r\n","/*\r\n* Ease\r\n* Visit http://createjs.com/ for documentation, updates and examples.\r\n*\r\n* Copyright (c) 2010 gskinner.com, inc.\r\n*\r\n* Permission is hereby granted, free of charge, to any person\r\n* obtaining a copy of this software and associated documentation\r\n* files (the \"Software\"), to deal in the Software without\r\n* restriction, including without limitation the rights to use,\r\n* copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n* copies of the Software, and to permit persons to whom the\r\n* Software is furnished to do so, subject to the following\r\n* conditions:\r\n*\r\n* The above copyright notice and this permission notice shall be\r\n* included in all copies or substantial portions of the Software.\r\n*\r\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\r\n* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\r\n* OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\r\n* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\r\n* HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\r\n* WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\r\n* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\r\n* OTHER DEALINGS IN THE SOFTWARE.\r\n*/\r\n\r\n/**\r\n* @module TweenJS\r\n*/\r\n\r\n\r\n/**\r\n * The Ease class provides a collection of easing functions for use with TweenJS. It does not use the standard 4 param\r\n * easing signature. Instead it uses a single param which indicates the current linear ratio (0 to 1) of the tween.\r\n *\r\n * Most methods on Ease can be passed directly as easing functions:\r\n *\r\n *      createjs.Tween.get(target).to({x:100}, 500, createjs.Ease.linear);\r\n *\r\n * However, methods beginning with \"get\" will return an easing function based on parameter values:\r\n *\r\n *      createjs.Tween.get(target).to({y:200}, 500, createjs.Ease.getPowIn(2.2));\r\n *\r\n * Please see the <a href=\"http://www.createjs.com/Demos/TweenJS/Tween_SparkTable\">spark table demo</a> for an\r\n * overview of the different ease types on <a href=\"http://tweenjs.com\">TweenJS.com</a>.\r\n *\r\n * <em>Equations derived from work by Robert Penner.</em>\r\n * @class Ease\r\n * @static\r\n **/\r\n\r\n\r\nfunction Ease() {\r\n  throw \"Ease cannot be instantiated.\";\r\n}\r\n\r\nexport default Ease;\r\n\r\n// static methods and properties\r\n/**\r\n * @method linear\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.linear = function(t) { return t; };\r\n\r\n/**\r\n * Identical to linear.\r\n * @method none\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.none = Ease.linear;\r\n\r\n/**\r\n * Mimics the simple -100 to 100 easing in Adobe Flash/Animate.\r\n * @method get\r\n * @param {Number} amount A value from -1 (ease in) to 1 (ease out) indicating the strength and direction of the ease.\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.get = function(amount) {\r\n  if (amount < -1) { amount = -1; }\r\n  else if (amount > 1) { amount = 1; }\r\n  return function(t) {\r\n    if (amount==0) { return t; }\r\n    if (amount<0) { return t*(t*-amount+1+amount); }\r\n    return t*((2-t)*amount+(1-amount));\r\n  };\r\n};\r\n\r\n/**\r\n * Configurable exponential ease.\r\n * @method getPowIn\r\n * @param {Number} pow The exponent to use (ex. 3 would return a cubic ease).\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getPowIn = function(pow) {\r\n  return function(t) {\r\n    return Math.pow(t,pow);\r\n  };\r\n};\r\n\r\n/**\r\n * Configurable exponential ease.\r\n * @method getPowOut\r\n * @param {Number} pow The exponent to use (ex. 3 would return a cubic ease).\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getPowOut = function(pow) {\r\n  return function(t) {\r\n    return 1-Math.pow(1-t,pow);\r\n  };\r\n};\r\n\r\n/**\r\n * Configurable exponential ease.\r\n * @method getPowInOut\r\n * @param {Number} pow The exponent to use (ex. 3 would return a cubic ease).\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getPowInOut = function(pow) {\r\n  return function(t) {\r\n    if ((t*=2)<1) return 0.5*Math.pow(t,pow);\r\n    return 1-0.5*Math.abs(Math.pow(2-t,pow));\r\n  };\r\n};\r\n\r\n/**\r\n * @method quadIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quadIn = Ease.getPowIn(2);\r\n/**\r\n * @method quadOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quadOut = Ease.getPowOut(2);\r\n/**\r\n * @method quadInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quadInOut = Ease.getPowInOut(2);\r\n\r\n/**\r\n * @method cubicIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.cubicIn = Ease.getPowIn(3);\r\n/**\r\n * @method cubicOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.cubicOut = Ease.getPowOut(3);\r\n/**\r\n * @method cubicInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.cubicInOut = Ease.getPowInOut(3);\r\n\r\n/**\r\n * @method quartIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quartIn = Ease.getPowIn(4);\r\n/**\r\n * @method quartOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quartOut = Ease.getPowOut(4);\r\n/**\r\n * @method quartInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quartInOut = Ease.getPowInOut(4);\r\n\r\n/**\r\n * @method quintIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quintIn = Ease.getPowIn(5);\r\n/**\r\n * @method quintOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quintOut = Ease.getPowOut(5);\r\n/**\r\n * @method quintInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quintInOut = Ease.getPowInOut(5);\r\n\r\n/**\r\n * @method sineIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.sineIn = function(t) {\r\n  return 1-Math.cos(t*Math.PI/2);\r\n};\r\n\r\n/**\r\n * @method sineOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.sineOut = function(t) {\r\n  return Math.sin(t*Math.PI/2);\r\n};\r\n\r\n/**\r\n * @method sineInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.sineInOut = function(t) {\r\n  return -0.5*(Math.cos(Math.PI*t) - 1);\r\n};\r\n\r\n/**\r\n * Configurable \"back in\" ease.\r\n * @method getBackIn\r\n * @param {Number} amount The strength of the ease.\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getBackIn = function(amount) {\r\n  return function(t) {\r\n    return t*t*((amount+1)*t-amount);\r\n  };\r\n};\r\n/**\r\n * @method backIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.backIn = Ease.getBackIn(1.7);\r\n\r\n/**\r\n * Configurable \"back out\" ease.\r\n * @method getBackOut\r\n * @param {Number} amount The strength of the ease.\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getBackOut = function(amount) {\r\n  return function(t) {\r\n    return (--t*t*((amount+1)*t + amount) + 1);\r\n  };\r\n};\r\n/**\r\n * @method backOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.backOut = Ease.getBackOut(1.7);\r\n\r\n/**\r\n * Configurable \"back in out\" ease.\r\n * @method getBackInOut\r\n * @param {Number} amount The strength of the ease.\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getBackInOut = function(amount) {\r\n  amount*=1.525;\r\n  return function(t) {\r\n    if ((t*=2)<1) return 0.5*(t*t*((amount+1)*t-amount));\r\n    return 0.5*((t-=2)*t*((amount+1)*t+amount)+2);\r\n  };\r\n};\r\n/**\r\n * @method backInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.backInOut = Ease.getBackInOut(1.7);\r\n\r\n/**\r\n * @method circIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.circIn = function(t) {\r\n  return -(Math.sqrt(1-t*t)- 1);\r\n};\r\n\r\n/**\r\n * @method circOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.circOut = function(t) {\r\n  return Math.sqrt(1-(--t)*t);\r\n};\r\n\r\n/**\r\n * @method circInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.circInOut = function(t) {\r\n  if ((t*=2) < 1) return -0.5*(Math.sqrt(1-t*t)-1);\r\n  return 0.5*(Math.sqrt(1-(t-=2)*t)+1);\r\n};\r\n\r\n/**\r\n * @method bounceIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.bounceIn = function(t) {\r\n  return 1-Ease.bounceOut(1-t);\r\n};\r\n\r\n/**\r\n * @method bounceOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.bounceOut = function(t) {\r\n  if (t < 1/2.75) {\r\n    return (7.5625*t*t);\r\n  } else if (t < 2/2.75) {\r\n    return (7.5625*(t-=1.5/2.75)*t+0.75);\r\n  } else if (t < 2.5/2.75) {\r\n    return (7.5625*(t-=2.25/2.75)*t+0.9375);\r\n  } else {\r\n    return (7.5625*(t-=2.625/2.75)*t +0.984375);\r\n  }\r\n};\r\n\r\n/**\r\n * @method bounceInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.bounceInOut = function(t) {\r\n  if (t<0.5) return Ease.bounceIn (t*2) * .5;\r\n  return Ease.bounceOut(t*2-1)*0.5+0.5;\r\n};\r\n\r\n/**\r\n * Configurable elastic ease.\r\n * @method getElasticIn\r\n * @param {Number} amplitude\r\n * @param {Number} period\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getElasticIn = function(amplitude,period) {\r\n  var pi2 = Math.PI*2;\r\n  return function(t) {\r\n    if (t==0 || t==1) return t;\r\n    var s = period/pi2*Math.asin(1/amplitude);\r\n    return -(amplitude*Math.pow(2,10*(t-=1))*Math.sin((t-s)*pi2/period));\r\n  };\r\n};\r\n/**\r\n * @method elasticIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.elasticIn = Ease.getElasticIn(1,0.3);\r\n\r\n/**\r\n * Configurable elastic ease.\r\n * @method getElasticOut\r\n * @param {Number} amplitude\r\n * @param {Number} period\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getElasticOut = function(amplitude,period) {\r\n  var pi2 = Math.PI*2;\r\n  return function(t) {\r\n    if (t==0 || t==1) return t;\r\n    var s = period/pi2 * Math.asin(1/amplitude);\r\n    return (amplitude*Math.pow(2,-10*t)*Math.sin((t-s)*pi2/period )+1);\r\n  };\r\n};\r\n/**\r\n * @method elasticOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.elasticOut = Ease.getElasticOut(1,0.3);\r\n\r\n/**\r\n * Configurable elastic ease.\r\n * @method getElasticInOut\r\n * @param {Number} amplitude\r\n * @param {Number} period\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getElasticInOut = function(amplitude,period) {\r\n  var pi2 = Math.PI*2;\r\n  return function(t) {\r\n    var s = period/pi2 * Math.asin(1/amplitude);\r\n    if ((t*=2)<1) return -0.5*(amplitude*Math.pow(2,10*(t-=1))*Math.sin( (t-s)*pi2/period ));\r\n    return amplitude*Math.pow(2,-10*(t-=1))*Math.sin((t-s)*pi2/period)*0.5+1;\r\n  };\r\n};\r\n/**\r\n * @method elasticInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.elasticInOut = Ease.getElasticInOut(1,0.3*1.5);\r\n","import nstructjs from \"../util/struct.js\";\r\nimport {CurveConstructors, CurveTypeData} from \"./curve1d_base.js\";\r\nimport Ease from './ease.js';\r\nimport * as util from '../util/util.js';\r\n\r\nfunction bez3(a, b, c, t) {\r\n  var r1 = a + (b - a)*t;\r\n  var r2 = b + (c - b)*t;\r\n\r\n  return r1 + (r2 - r1)*t;\r\n}\r\n\r\nfunction bez4(a, b, c, d, t) {\r\n  var r1 = bez3(a, b, c, t);\r\n  var r2 = bez3(b, c, d, t);\r\n\r\n  return r1 + (r2 - r1)*t;\r\n}\r\n\r\nexport class ParamKey {\r\n  constructor(key, val) {\r\n    this.key = key;\r\n    this.val = val;\r\n  }\r\n}\r\n\r\nParamKey.STRUCT = `\r\nParamKey {\r\n  key : string;\r\n  val : float;\r\n}\r\n`\r\nnstructjs.register(ParamKey);\r\nlet BOOL_FLAG = 1e17;\r\n\r\nlet _udigest = new util.HashDigest();\r\n\r\nexport class SimpleCurveBase extends CurveTypeData {\r\n  constructor() {\r\n    super();\r\n\r\n    this.type = this.constructor.name;\r\n\r\n    let def = this.constructor.define();\r\n    let params = def.params;\r\n\r\n    this.params = {};\r\n    for (let k in params) {\r\n      this.params[k] = params[k][1];\r\n    }\r\n  }\r\n\r\n  get hasGUI() {\r\n    return true;\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    let d = digest;\r\n    super.calcHashKey(d);\r\n\r\n    for (let k in this.params) {\r\n      digest.add(k);\r\n      digest.add(this.params[k]);\r\n    }\r\n\r\n    return d.get();\r\n  }\r\n\r\n  equals(b) {\r\n    if (this.type !== b.type) {\r\n      return false;\r\n    }\r\n\r\n    for (let k in this.params) {\r\n      if (Math.abs(this.params[k] - b.params[k]) > 0.000001) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  redraw() {\r\n    if (this.parent)\r\n      this.parent.redraw();\r\n  }\r\n\r\n  makeGUI(container) {\r\n    let def = this.constructor.define();\r\n    let params = def.params;\r\n\r\n    for (let k in params) {\r\n      let p = params[k];\r\n\r\n      if (p[2] === BOOL_FLAG) {\r\n        let check = container.check(undefined, p[0]);\r\n        check.checked = !!this.params[k];\r\n        check.key = k;\r\n\r\n        let this2 = this;\r\n        check.onchange = function () {\r\n          this2.params[this.key] = this.checked ? 1 : 0;\r\n          this2.update();\r\n          this2.redraw();\r\n        }\r\n      } else {\r\n        let slider = container.slider(undefined, {\r\n          name      : p[0],\r\n          defaultval: this.params[k],\r\n          min       : p[2],\r\n          max       : p[3]\r\n        })\r\n        slider.baseUnit = slider.displayUnit = \"none\";\r\n\r\n        slider.key = k;\r\n\r\n        let this2 = this;\r\n        slider.onchange = function () {\r\n          this2.params[this.key] = this.value;\r\n          this2.update();\r\n          this2.redraw();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  killGUI(container) {\r\n    container.clear();\r\n  }\r\n\r\n  evaluate(s) {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  reset() {\r\n\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  draw(canvas, g, draw_transform) {\r\n    let steps = 128;\r\n    let s = 0, ds = 1.0/(steps - 1);\r\n\r\n    g.beginPath();\r\n    for (let i = 0; i < steps; i++, s += ds) {\r\n      let co = this.evaluate(s);\r\n\r\n      if (i) {\r\n        g.lineTo(co[0], co[1]);\r\n      } else {\r\n        g.moveTo(co[0], co[1]);\r\n      }\r\n    }\r\n\r\n    g.stroke();\r\n  }\r\n\r\n  _saveParams() {\r\n    let ret = [];\r\n    for (let k in this.params) {\r\n      ret.push(new ParamKey(k, this.params[k]));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  toJSON() {\r\n    return Object.assign(super.toJSON(), {\r\n      params: this.params\r\n    });\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    for (let k in obj.params) {\r\n      this.params[k] = obj.params[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n\r\n    let ps = this.params;\r\n    this.params = {};\r\n\r\n    let pdef = this.constructor.define().params;\r\n    if (!pdef) {\r\n      console.warn(\"Missing define function for curve\", this.constructor.name)\r\n      return;\r\n    }\r\n\r\n    for (let pair of ps) {\r\n      if (pair.key in pdef) {\r\n        this.params[pair.key] = pair.val;\r\n      }\r\n    }\r\n\r\n    for (let k in pdef) {\r\n      if (!(k in this.params)) {\r\n        this.params[k] = pdef[k][1];\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nSimpleCurveBase.STRUCT = nstructjs.inherit(SimpleCurveBase, CurveTypeData) + `\r\n  params : array(ParamKey) | obj._saveParams();\r\n}\r\n`;\r\nnstructjs.register(SimpleCurveBase);\r\n\r\nexport class BounceCurve extends SimpleCurveBase {\r\n  static define() {\r\n    return {\r\n      params  : {\r\n        decay : [\"Decay\", 1.0, 0.1, 5.0],\r\n        scale : [\"Scale\", 1.0, 0.01, 10.0],\r\n        freq  : [\"Freq\", 1.0, 0.01, 50.0],\r\n        phase : [\"Phase\", 0.0, -Math.PI*2.0, Math.PI*2.0],\r\n        offset: [\"Offset\", 0.0, -2.0, 2.0]\r\n      },\r\n      name    : \"bounce\",\r\n      uiname  : \"Bounce\",\r\n      typeName: \"BounceCurve\"\r\n\r\n    }\r\n  }\r\n\r\n  _evaluate(t) {\r\n    let params = this.params;\r\n    let decay = params.decay + 1.0;\r\n    let scale = params.scale;\r\n    let freq = params.freq;\r\n    let phase = params.phase;\r\n    let offset = params.offset;\r\n\r\n    t *= freq;\r\n    let t2 = Math.abs(Math.cos(phase + t*Math.PI*2.0))*scale;\r\n    ;//+ (1.0-scale);\r\n\r\n    t2 *= Math.exp(decay*t)/Math.exp(decay);\r\n\r\n    return t2;\r\n  }\r\n\r\n  evaluate(t) {\r\n    let s = this._evaluate(0.0);\r\n    let e = this._evaluate(1.0);\r\n\r\n    return (this._evaluate(t) - s)/(e - s) + this.params.offset;\r\n  }\r\n}\r\n\r\nCurveTypeData.register(BounceCurve);\r\nBounceCurve.STRUCT = nstructjs.inherit(BounceCurve, SimpleCurveBase) + `\r\n}`;\r\nnstructjs.register(BounceCurve);\r\n\r\n\r\nexport class ElasticCurve extends SimpleCurveBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._func = undefined;\r\n    this._last_hash = undefined;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      params  : {\r\n        mode     : [\"Out Mode\", false, BOOL_FLAG, BOOL_FLAG],\r\n        amplitude: [\"Amplitude\", 1.0, 0.01, 10.0],\r\n        period   : [\"Period\", 1.0, 0.01, 5.0]\r\n      },\r\n      name    : \"elastic\",\r\n      uiname  : \"Elastic\",\r\n      typeName: \"ElasticCurve\",\r\n    }\r\n  }\r\n\r\n  evaluate(t) {\r\n    let hash = ~~(this.params.mode*127 + this.params.amplitude*256 + this.params.period*512);\r\n\r\n    if (hash !== this._last_hash || !this._func) {\r\n      this._last_hash = hash;\r\n\r\n      if (this.params.mode) {\r\n        this._func = Ease.getElasticOut(this.params.amplitude, this.params.period);\r\n      } else {\r\n        this._func = Ease.getElasticIn(this.params.amplitude, this.params.period);\r\n      }\r\n    }\r\n    return this._func(t);\r\n  }\r\n}\r\n\r\nCurveTypeData.register(ElasticCurve);\r\nElasticCurve.STRUCT = nstructjs.inherit(ElasticCurve, SimpleCurveBase) + `\r\n}`;\r\nnstructjs.register(ElasticCurve);\r\n\r\n\r\nexport class EaseCurve extends SimpleCurveBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      params  : {\r\n        mode_in  : [\"in\", true, BOOL_FLAG, BOOL_FLAG],\r\n        mode_out : [\"out\", true, BOOL_FLAG, BOOL_FLAG],\r\n        amplitude: [\"Amplitude\", 1.0, 0.01, 4.0]\r\n      },\r\n      name    : \"ease\",\r\n      uiname  : \"Ease\",\r\n      typeName: \"EaseCurve\"\r\n    }\r\n  }\r\n\r\n  evaluate(t) {\r\n    let amp = this.params.amplitude;\r\n    let a1 = this.params.mode_in ? 1.0 - amp : 1.0/3.0;\r\n    let a2 = this.params.mode_out ? amp : 2.0/3.0;\r\n\r\n    return bez4(0.0, a1, a2, 1.0, t);\r\n  }\r\n}\r\n\r\nCurveTypeData.register(EaseCurve);\r\nEaseCurve.STRUCT = nstructjs.inherit(EaseCurve, SimpleCurveBase) + `\r\n}`;\r\nnstructjs.register(EaseCurve);\r\n\r\n\r\nexport class RandCurve extends SimpleCurveBase {\r\n  constructor() {\r\n    super();\r\n    this.random = new util.MersenneRandom();\r\n    this.seed = 0;\r\n  }\r\n\r\n  get seed() {\r\n    return this._seed;\r\n  }\r\n\r\n  set seed(v) {\r\n    this.random.seed(v);\r\n    this._seed = v;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      params  : {\r\n        amplitude: [\"Amplitude\", 1.0, 0.01, 4.0],\r\n        decay    : [\"Decay\", 1.0, 0.0, 5.0],\r\n        in_mode  : [\"In\", true, BOOL_FLAG, BOOL_FLAG]\r\n      },\r\n      name    : \"random\",\r\n      uiname  : \"Random\",\r\n      typeName: \"RandCurve\"\r\n    }\r\n  }\r\n\r\n  evaluate(t) {\r\n    let r = this.random.random();\r\n    let decay = this.params.decay + 1.0;\r\n    let amp = this.params.amplitude;\r\n    let in_mode = this.params.in_mode;\r\n\r\n    if (in_mode) {\r\n      t = 1.0 - t;\r\n    }\r\n    //r *= t;\r\n\r\n    let d;\r\n\r\n    //r *= 0.5;\r\n\r\n    if (in_mode) {\r\n      d = Math.exp(t*decay)/Math.exp(decay);\r\n    } else {\r\n      d = Math.exp(t*decay)/Math.exp(decay);\r\n    }\r\n\r\n    t = t + (r - t)*d;\r\n\r\n    if (in_mode) {\r\n      t = 1.0 - t;\r\n    }\r\n\r\n    return t;\r\n  }\r\n}\r\n\r\nCurveTypeData.register(RandCurve);\r\nRandCurve.STRUCT = nstructjs.inherit(RandCurve, SimpleCurveBase) + `\r\n}`;\r\nnstructjs.register(RandCurve);\r\n\r\n\r\n","import {Curve1D} from './curve1d.js';\r\nimport {ToolProperty, PropTypes, PropFlags} from '../toolsys/toolprop.js';\r\nimport * as nstructjs from '../util/nstructjs_es6.js';\r\n\r\nimport './curve1d_all.js';\r\n\r\nexport class Curve1DProperty extends ToolProperty {\r\n  constructor(curve, apiname, uiname, description, flag, icon) {\r\n    super(PropTypes.CURVE, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.data = new Curve1D();\r\n\r\n    if (curve !== undefined) {\r\n      this.setValue(curve);\r\n    }\r\n\r\n    this.wasSet = false;\r\n  }\r\n\r\n  calcMemSize() {\r\n    //bleh, just return a largish block size\r\n    return 1024;\r\n  }\r\n\r\n  equals(b) {\r\n\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  evaluate(t) {\r\n    return this.data.evaluate(t);\r\n  }\r\n\r\n  setValue(curve) {\r\n    if (curve === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.data.load(curve);\r\n    super.setValue(curve);\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n\r\n    b.setValue(this.data);\r\n  }\r\n}\r\n\r\nCurve1DProperty.STRUCT = nstructjs.inherit(Curve1DProperty, ToolProperty) + `\r\n  data : Curve1D;\r\n}\r\n`;\r\n\r\nnstructjs.register(Curve1DProperty);\r\nToolProperty.internalRegister(Curve1DProperty);\r\n\r\n","import * as util from '../util/util.js'\r\n\r\nexport const SocketFlags = {\r\n  UPDATE: 1\r\n};\r\nexport const NodeFlags = {\r\n  UPDATE   : 1,\r\n  SORT_TAG1: 2,\r\n  SORT_TAG2: 4,\r\n};\r\nexport const RecalcFlags = {\r\n  RUN   : 1,\r\n  RESORT: 2\r\n};\r\nexport const SocketTypes = {\r\n  INPUT : \"inputs\",\r\n  OUTPUT: \"outputs\"\r\n};\r\n\r\nlet graphIdGen = 1;\r\n\r\nexport class EventSocket {\r\n  static socketDef = {\r\n    typeName: \"\",\r\n    uiName  : \"\",\r\n    flag    : 0,\r\n  }\r\n\r\n  name = \"\"\r\n  id = graphIdGen++;\r\n  flag = 0;\r\n\r\n  edges = [];\r\n  node = undefined;\r\n\r\n  type = undefined;\r\n\r\n  constructor(node) {\r\n    this.node = node;\r\n  }\r\n\r\n  get value() {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  set value(v) {\r\n    this.flagUpdate();\r\n  }\r\n\r\n  get isUpdated() {\r\n    return this.flag & SocketFlags.UPDATE;\r\n  }\r\n\r\n  copyFrom(b) {\r\n    this.name = b.name;\r\n    this.flag = b.flag;\r\n\r\n    return this;\r\n  }\r\n\r\n  copy() {\r\n    return (new this.constructor()).copyFrom(this);\r\n  }\r\n\r\n  flagUpdate() {\r\n    this.flag |= SocketFlags.UPDATE;\r\n\r\n    if (!this.node) {\r\n      return;\r\n    }\r\n\r\n    if (this.type === SocketTypes.INPUT) {\r\n      this.node.flagUpdate();\r\n    } else {\r\n      for (let sockb of this.edges) {\r\n        sockb.flag |= SocketFlags.UPDATE;\r\n        sockb.node.flagUpdate();\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  flagResort() {\r\n    if (this.node) {\r\n      this.node.flagResort();\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  connect(sockb) {\r\n    this.edges.push(sockb);\r\n    sockb.edges.push(this);\r\n    return this;\r\n  }\r\n\r\n  hasNode(node) {\r\n    for (let sockb of this.edges) {\r\n      if (sockb.node === node || sockb.node.owner === node) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  has(sockb) {\r\n    return this.edges.indexOf(sockb) >= 0;\r\n  }\r\n\r\n  disconnect(sockb = undefined) {\r\n    this.flagResort();\r\n\r\n    if (sockb === undefined) {\r\n      /* Disconnect all. */\r\n      for (let sock of this.edges) {\r\n        sock.flagUpdate();\r\n        sock.edges.remove(this);\r\n      }\r\n\r\n      this.edges.length = 0;\r\n      return this;\r\n    }\r\n\r\n    sockb.flagUpdate();\r\n    this.edges.remove(sockb);\r\n    return this;\r\n  }\r\n}\r\n\r\nconst NodeClasses = [];\r\n\r\n//Interface\r\nexport class NodeCapable {\r\n  graphNode = undefined;\r\n\r\n  static graphNodeDef = {\r\n    typeName: \"\",\r\n    uiName  : \"\",\r\n    flag    : 0,\r\n\r\n    /* Sockets inherit. */\r\n    inputs : {},\r\n    outputs: {}\r\n  };\r\n\r\n  graphExec() {\r\n  }\r\n}\r\n\r\nexport class EventNode {\r\n  owner = undefined;\r\n  inputs = {};\r\n  outputs = {};\r\n  allsockets = [];\r\n  graph = undefined;\r\n  sortIndex = -1;\r\n  id = graphIdGen++;\r\n  flag = 0;\r\n\r\n  static register(cls, def) {\r\n    cls.graphNodeDef = def;\r\n    if (!def.typeName) {\r\n      throw new Error(\"Missing graphNodeDef.typeName\")\r\n    }\r\n\r\n    NodeClasses.push(cls);\r\n\r\n    return def;\r\n  }\r\n\r\n  addSocket(type, key, sock) {\r\n    this[type][key] = sock;\r\n    sock.name = key;\r\n    sock.node = this;\r\n    sock.type = type;\r\n\r\n    return this;\r\n  }\r\n\r\n  static isNodeCapable(cls) {\r\n    return cls.graphNodeDef !== undefined;\r\n  }\r\n\r\n  constructor(owner) {\r\n    this.owner = owner;\r\n\r\n    let cls = owner.constructor;\r\n\r\n    let getSockets = (key) => {\r\n      let socks = {};\r\n\r\n      let p = cls;\r\n      while (p) {\r\n        if (p.graphNodeDef) {\r\n          let socksDef = p.graphNodeDef[key] || {};\r\n\r\n          for (let k in socksDef) {\r\n            if (!(k in socks)) {\r\n              socks[k] = socksDef[k].copy();\r\n              socks[k].name = k;\r\n              socks[k].node = this;\r\n              socks[k].type = key;\r\n\r\n              this.allsockets.push(socks[k]);\r\n            }\r\n          }\r\n        }\r\n        p = p.__proto__;\r\n      }\r\n\r\n      return socks;\r\n    }\r\n\r\n    this.inputs = getSockets(\"inputs\");\r\n    this.outputs = getSockets(\"outputs\");\r\n  }\r\n\r\n  static init(owner) {\r\n    owner.graphNode = new EventNode(owner);\r\n    return owner.graphNode;\r\n  }\r\n\r\n  flagUpdate() {\r\n    this.flag |= NodeFlags.UPDATE;\r\n\r\n    if (this.graph) {\r\n      this.graph.flagUpdate(this);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  flagResort() {\r\n    if (this.graph) {\r\n      this.graph.flagResort(this);\r\n    }\r\n    return this;\r\n  }\r\n}\r\n\r\nexport class EventGraph {\r\n  nodes = [];\r\n  flag = 0;\r\n  nodeIdMap = new Map()\r\n  sockIdMap = new Map()\r\n  sortlist = [];\r\n  queueReq = undefined;\r\n  #skipQueueExec = 0;\r\n\r\n  constructor() {\r\n  }\r\n\r\n  add(node) {\r\n    node = this.eventNode(node);\r\n\r\n    node.graph = this;\r\n    this.nodeIdMap.set(node.id, node);\r\n\r\n    this.nodes.push(node);\r\n    this.flagResort(node);\r\n    this.flagUpdate(node);\r\n  }\r\n\r\n  has(node) {\r\n    node = this.eventNode(node);\r\n    return this.nodeIdMap.has(node.id);\r\n  }\r\n\r\n  eventNode(node) {\r\n    if (!(node instanceof EventNode)) {\r\n      node = node.graphNode;\r\n    }\r\n\r\n    if (node === undefined) {\r\n      console.warn(\"Not an event node:\", arguments[0]);\r\n      throw new Error(\"Not an event node\");\r\n    }\r\n\r\n    return node;\r\n  }\r\n\r\n  remove(node) {\r\n    node = this.eventNode(node);\r\n\r\n    if (node === undefined) {\r\n      throw new Error(\"EventGraph.prototype.remove(): node was undefined\");\r\n    }\r\n\r\n    if (!this.nodeIdMap.get(node.id)) {\r\n      throw new Error(\"Node is not in event graph\");\r\n    }\r\n\r\n    this.nodeIdMap.delete(node.id);\r\n\r\n    for (let sock of Array.from(node.eventNode.allsockets)) {\r\n      this.sockIdMap.delete(sock.id);\r\n\r\n      try {\r\n        sock.disconnect();\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        console.error(\"Failed to disconnect a socket\");\r\n      }\r\n    }\r\n\r\n    node.graph = undefined;\r\n    this.nodes.remove(node);\r\n    this.flagResort();\r\n  }\r\n\r\n  flagResort(node) {\r\n    if (node) {\r\n      node = this.eventNode(node);\r\n    }\r\n\r\n    this.flag |= RecalcFlags.RESORT | RecalcFlags.RUN;\r\n\r\n    return this;\r\n  }\r\n\r\n  flagUpdate(node) {\r\n    node = this.eventNode(node);\r\n\r\n    this.flag |= RecalcFlags.RUN;\r\n\r\n    if (!this.#skipQueueExec) {\r\n      this.queueExec();\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  sort() {\r\n    console.warn(\"Sorting Graph\");\r\n\r\n    this.flag &= ~RecalcFlags.RESORT;\r\n\r\n    for (let n of this.nodes) {\r\n      n.flag &= ~(NodeFlags.SORT_TAG1 | NodeFlags.SORT_TAG2);\r\n    }\r\n\r\n    let sortlist = this.sortlist;\r\n    this.sortlist.length = 0;\r\n\r\n    let dosort = (n) => {\r\n      if (n.flag & NodeFlags.SORT_TAG2) {\r\n        console.error(\"Cycle in event dag!\", n);\r\n        return;\r\n      }\r\n\r\n      n.flag |= NodeFlags.SORT_TAG2;\r\n\r\n      for (let [k, socka] of Object.entries(n.inputs)) {\r\n        for (let sockb of socka.edges) {\r\n          let n2 = sockb.node;\r\n          if (!(n2.flag & NodeFlags.SORT_TAG1)) {\r\n            dosort(n2);\r\n          }\r\n        }\r\n      }\r\n\r\n      n.flag &= ~NodeFlags.SORT_TAG2;\r\n      n.flag |= NodeFlags.SORT_TAG1;\r\n      n.sortIndex = sortlist.length;\r\n      sortlist.push(n);\r\n\r\n      for (let [k, socka] of Object.entries(n.outputs)) {\r\n        for (let sockb of socka.edges) {\r\n          let n2 = sockb.node;\r\n\r\n          if (!(n2.flag & NodeFlags.SORT_TAG1)) {\r\n            dosort(n2);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    for (let n of this.nodes) {\r\n      if (!(n.flag & NodeFlags.SORT_TAG1)) {\r\n        dosort(n);\r\n      }\r\n    }\r\n  }\r\n\r\n  queueExec() {\r\n    console.warn(\"queueExec\", this.queueReq);\r\n\r\n    this.flag |= RecalcFlags.RUN;\r\n\r\n    if (this.queueReq !== undefined) {\r\n      return;\r\n    }\r\n\r\n    this.queueReq = true;\r\n    this.queueReq = window.setTimeout(() => {\r\n      this.queueReq = undefined;\r\n      this.exec();\r\n    }, 0);\r\n  }\r\n\r\n  exec() {\r\n    this.flag &= ~RecalcFlags.RUN;\r\n\r\n    if (this.flag & RecalcFlags.RESORT) {\r\n      this.sort();\r\n    }\r\n\r\n    console.warn(\"Executing Graph\");\r\n\r\n    this.#skipQueueExec++;\r\n\r\n    let sortlist = this.sortlist;\r\n    for (let n of sortlist) {\r\n      if (!(n.flag & NodeFlags.UPDATE)) {\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        n.owner.graphExec();\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        console.error(\"Error during event graph execution\");\r\n      }\r\n\r\n      n.flag &= ~NodeFlags.UPDATE;\r\n\r\n      for (let k in n.inputs) {\r\n        let sock = n.inputs[k];\r\n        sock.flag &= ~SocketFlags.UPDATE;\r\n      }\r\n\r\n      for (let k in n.outputs) {\r\n        let sock = n.outputs[k];\r\n\r\n        if (sock.flag & SocketFlags.UPDATE) {\r\n          for (let sockb of sock.edges) {\r\n            sockb.flag |= SocketFlags.UPDATE;\r\n            sockb.node.flag |= SocketFlags.UPDATE;\r\n          }\r\n\r\n          sock.flag &= ~SocketFlags.UPDATE;\r\n        }\r\n      }\r\n    }\r\n\r\n    this.#skipQueueExec--;\r\n  }\r\n}\r\n\r\nexport const theEventGraph = new EventGraph();\r\n\r\nconst strBoolMap = {\r\n  \"true\" : \"false\",\r\n  \"false\": \"true\",\r\n  \"on\"   : \"off\",\r\n  \"off\"  : \"on\",\r\n  \"yes\"  : \"no\",\r\n  \"no\"   : \"yes\",\r\n}\r\n\r\nexport class DependSocket extends EventSocket {\r\n  static socketDef = {\r\n    typeName: \"depend\",\r\n    uiName  : \"depend\",\r\n    flag    : 0,\r\n  }\r\n\r\n  #value = undefined;\r\n\r\n  get value() {\r\n    return this.#value;\r\n  }\r\n\r\n  set value(v) {\r\n    this.#value = v;\r\n  }\r\n\r\n  copyFrom(b) {\r\n    super.copyFrom(b);\r\n\r\n    this.#value = b.#value;\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nexport const PropSocketModes = {\r\n  REPLACE: 0,\r\n  MIN    : 1,\r\n  MAX    : 2,\r\n}\r\n\r\nexport class PropertySocket extends EventSocket {\r\n  static socketDef = {\r\n    typeName: \"property_socket\",\r\n    uiName  : \"Property Socket\",\r\n    flag    : 0,\r\n  }\r\n\r\n  mixMode = PropSocketModes.REPLACE;\r\n\r\n  #binding = {\r\n    obj: null,\r\n    key: \"\",\r\n  }\r\n\r\n  #callbacks = []; //(newval, oldval) => val\r\n  #invert = false; //Invert bool or number properties\r\n\r\n  oldValue = undefined;\r\n\r\n  mode(mixmode) {\r\n    this.mixMode = mixmode;\r\n    return this;\r\n  }\r\n\r\n  copyFrom(b) {\r\n    super.copyFrom(b);\r\n\r\n    this.#invert = b.#invert;\r\n    this.#callbacks = Array.from(b.#callbacks);\r\n    this.#binding = b.#binding;\r\n\r\n    return this;\r\n  }\r\n\r\n  invert(state = true) {\r\n    this.#invert = state;\r\n    return this;\r\n  }\r\n\r\n  callback(cb) {\r\n    this.#callbacks.push(cb);\r\n    return this;\r\n  }\r\n\r\n  get value() {\r\n    let bind = this.#binding;\r\n    return bind.obj ? bind.obj[bind.key] : undefined;\r\n  }\r\n\r\n  set value(v) {\r\n    let old = this.value;\r\n    if (this.#callbacks.length > 0) {\r\n      for (let cb of this.#callbacks) {\r\n        v = cb(v, old);\r\n      }\r\n    }\r\n\r\n    if (this.#invert && (typeof v === \"number\" || typeof v === \"boolean\" || typeof v === \"undefined\")) {\r\n      v = !v;\r\n    } else if (this.#invert && typeof v === \"string\") {\r\n      let s = v.toLowerCase().trim();\r\n      if (s in strBoolMap) {\r\n        v = strBoolMap[s];\r\n      }\r\n    }\r\n\r\n    let bind = this.#binding;\r\n    if (bind.obj) {\r\n      bind.obj[bind.key] = v;\r\n    } else {\r\n      console.warn(\"Attempt to set unbound property socket\", this);\r\n    }\r\n  }\r\n\r\n  bind(obj, key) {\r\n    this.#binding.obj = obj;\r\n    this.#binding.key = key;\r\n\r\n    return this;\r\n  }\r\n}\r\n","import {Vector2} from \"./vectormath.js\";\r\nimport * as math from './math.js';\r\nimport * as util from './util.js';\r\n\r\nexport class Constraint {\r\n  constructor(name, func, klst, params, k = 1.0) {\r\n    this.glst = [];\r\n    this.klst = klst;\r\n    this.wlst = [];\r\n    this.k = k;\r\n    this.params = params;\r\n    this.name = name;\r\n\r\n    for (let ks of klst) {\r\n      this.glst.push(new Float64Array(ks.length));\r\n      const ws = new Float64Array(ks.length);\r\n\r\n      for (let i = 0; i < ws.length; i++) {\r\n        ws[i] = 1.0;\r\n      }\r\n\r\n      this.wlst.push(ws);\r\n    }\r\n\r\n    this.df = 0.0005;\r\n    this.threshold = 0.0001;\r\n    if (func !== undefined) { /* Happens with subclass-style constraints. */\r\n      this.func = func;\r\n    }\r\n    if (!this.funcDv) {\r\n      this.funcDv = null;\r\n    }\r\n  }\r\n\r\n  postSolve() {\r\n  }\r\n\r\n  evaluate(no_dvs = false) {\r\n    let r1 = this.func(this.params);\r\n\r\n    if (this.funcDv) {\r\n      this.funcDv(this.params, this.glst);\r\n      return r1;\r\n    }\r\n\r\n    if (Math.abs(r1) < this.threshold)\r\n      return 0.0;\r\n\r\n    let df = this.df;\r\n\r\n    if (no_dvs)\r\n      return r1;\r\n\r\n    for (let i = 0; i < this.klst.length; i++) {\r\n      let gs = this.glst[i];\r\n      let ks = this.klst[i];\r\n\r\n      for (let j = 0; j < ks.length; j++) {\r\n        let orig = ks[j];\r\n        ks[j] += df;\r\n        let r2 = this.func(this.params);\r\n        ks[j] = orig;\r\n\r\n        gs[j] = (r2 - r1)/df;\r\n      }\r\n    }\r\n\r\n    return r1;\r\n  }\r\n}\r\n\r\nexport class Solver {\r\n  constructor() {\r\n    this.constraints = [];\r\n    this.gk = 0.99;\r\n    this.simple = false;\r\n    this.randCons = false;\r\n\r\n    /** stop when average constraint error falls below this */\r\n    this.threshold = 0.01;\r\n  }\r\n\r\n  remove(con) {\r\n    this.constraints.remove(con);\r\n  }\r\n\r\n  add(con) {\r\n    this.constraints.push(con);\r\n  }\r\n\r\n  solveStep(gk = this.gk) {\r\n    let err = 0.0;\r\n\r\n    let cons = this.constraints;\r\n    for (let ci = 0; ci < cons.length; ci++) {\r\n      let ri = ci;\r\n      if (this.randCons) {\r\n        ri = ~~(Math.random()*this.constraints.length*0.99999);\r\n      }\r\n\r\n      let con = cons[ri];\r\n\r\n      let r1 = con.evaluate();\r\n\r\n      if (r1 === 0.0)\r\n        continue;\r\n\r\n      err += Math.abs(r1);\r\n      let totgs = 0.0;\r\n\r\n      for (let i = 0; i < con.klst.length; i++) {\r\n        let ks = con.klst[i], gs = con.glst[i];\r\n        for (let j = 0; j < ks.length; j++) {\r\n          totgs += gs[j]*gs[j];\r\n        }\r\n      }\r\n\r\n      if (totgs === 0.0) {\r\n        continue;\r\n      }\r\n\r\n      r1 /= totgs;\r\n\r\n      for (let i = 0; i < con.klst.length; i++) {\r\n        let ks = con.klst[i], gs = con.glst[i], ws = con.wlst[i];\r\n        for (let j = 0; j < ks.length; j++) {\r\n          ks[j] += -r1*gs[j]*con.k*gk*ws[j];\r\n        }\r\n\r\n        con.postSolve();\r\n      }\r\n    }\r\n\r\n    return err;\r\n  }\r\n\r\n  solveStepSimple(gk = this.gk) {\r\n    let err = 0.0;\r\n\r\n    let cons = this.constraints;\r\n    for (let ci = 0; ci < cons.length; ci++) {\r\n      let ri = ci;\r\n      if (this.randCons) {\r\n        ri = ~~(Math.random()*this.constraints.length*0.99999);\r\n      }\r\n\r\n      let con = cons[ri];\r\n\r\n      let r1 = con.evaluate();\r\n\r\n      if (r1 === 0.0)\r\n        continue;\r\n\r\n      err += Math.abs(r1);\r\n      let totgs = 0.0;\r\n\r\n      for (let i = 0; i < con.klst.length; i++) {\r\n        let ks = con.klst[i], gs = con.glst[i];\r\n        for (let j = 0; j < ks.length; j++) {\r\n          totgs += gs[j]*gs[j];\r\n        }\r\n      }\r\n\r\n      if (totgs === 0.0) {\r\n        continue;\r\n      }\r\n\r\n      totgs = 0.0001/Math.sqrt(totgs);\r\n\r\n      for (let i = 0; i < con.klst.length; i++) {\r\n        let ks = con.klst[i], gs = con.glst[i], ws = con.wlst[j];\r\n        for (let j = 0; j < ks.length; j++) {\r\n          ks[j] += -totgs*gs[j]*con.k*gk*ws[j];\r\n        }\r\n      }\r\n\r\n      con.postSolve();\r\n    }\r\n\r\n    return err;\r\n  }\r\n\r\n  solve(steps, gk = this.gk, printError = false) {\r\n    let err = 0.0;\r\n\r\n    for (let i = 0; i < steps; i++) {\r\n      if (this.simple) {\r\n        err = this.solveStepSimple(gk);\r\n      } else {\r\n        err = this.solveStep(gk);\r\n      }\r\n\r\n\r\n      if (printError) {\r\n        console.warn(\"average error:\", (err/this.constraints.length).toFixed(4));\r\n      }\r\n      if (err < this.threshold/this.constraints.length) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return err;\r\n  }\r\n}\r\n","export function saveFile(data, filename=\"unnamed\", exts=[], mime=\"application/x-octet-stream\") {\r\n  let blob = new Blob([data], {type : mime});\r\n  let url = URL.createObjectURL(blob);\r\n\r\n  let a = document.createElement(\"a\");\r\n  a.setAttribute(\"href\", url);\r\n  a.setAttribute(\"download\", filename);\r\n\r\n  a.click();\r\n}\r\n\r\n//returns a promise\r\nexport function loadFile(filename=\"unnamed\", exts=[]) {\r\n  let input = document.createElement(\"input\");\r\n  input.type = \"file\";\r\n\r\n  exts = exts.join(\",\");\r\n\r\n  input.setAttribute(\"accept\", exts)\r\n  return new Promise((accept, reject) => {\r\n    input.onchange = function(e) {\r\n      if (this.files === undefined || this.files.length !== 1) {\r\n        reject(\"file load error\");\r\n        return;\r\n      }\r\n\r\n      let file = this.files[0];\r\n      let reader = new FileReader();\r\n\r\n      reader.onload = function(e2) {\r\n        accept(e2.target.result);\r\n      };\r\n\r\n      reader.readAsArrayBuffer(file);\r\n    }\r\n    input.click();\r\n  });\r\n}\r\n\r\nwindow._testLoadFile = function(exts=[\"*.*\"]) {\r\n  loadFile(undefined, exts).then((data) => {\r\n    console.log(\"got file data:\", data);\r\n  });\r\n};\r\n\r\nwindow._testSaveFile = function() {\r\n  let buf = _appstate.createFile();\r\n  //console.log(buf);\r\n  saveFile(buf, \"unnamed.w3d\", [\".w3d\"]);\r\n}","import * as util from '../util/util.js';\r\nimport * as vectormath from '../util/vectormath.js';\r\nimport {Vector3, Vector4} from '../util/vectormath.js';\r\n\r\nlet rgb_to_hsv_rets = new util.cachering(() => [0, 0, 0], 64);\r\n\r\nexport function rgb_to_hsv(r, g, b) {\r\n  let computedH = 0;\r\n  let computedS = 0;\r\n  let computedV = 0;\r\n\r\n  if (r == null || g == null || b == null ||\r\n    isNaN(r) || isNaN(g) || isNaN(b)) {\r\n    throw new Error(`Please enter numeric RGB values! r: ${r} g: ${g} b: ${b}`);\r\n  }\r\n  /*\r\n  if (r<0 || g<0 || b<0 || r>1.0 || g>1.0 || b>1.0) {\r\n   throw new Error('RGB values must be in the range 0 to 1.0');\r\n   return;\r\n  }//*/\r\n\r\n  let minRGB = Math.min(r, Math.min(g, b));\r\n  let maxRGB = Math.max(r, Math.max(g, b));\r\n\r\n  // Black-gray-white\r\n  if (minRGB === maxRGB) {\r\n    computedV = minRGB;\r\n\r\n    let ret = rgb_to_hsv_rets.next();\r\n    ret[0] = 0, ret[1] = 0, ret[2] = computedV;\r\n    return ret;\r\n  }\r\n\r\n  // Colors other than black-gray-white:\r\n  let d = (r === minRGB) ? g - b : ((b === minRGB) ? r - g : b - r);\r\n  let h = (r === minRGB) ? 3 : ((b === minRGB) ? 1 : 5);\r\n\r\n  computedH = (60*(h - d/(maxRGB - minRGB)))/360.0;\r\n  computedS = (maxRGB - minRGB)/maxRGB;\r\n  computedV = maxRGB;\r\n\r\n  let ret = rgb_to_hsv_rets.next();\r\n  ret[0] = computedH, ret[1] = computedS, ret[2] = computedV;\r\n  return ret;\r\n}\r\n\r\nlet hsv_to_rgb_rets = new util.cachering(() => [0, 0, 0], 64);\r\n\r\nexport function hsv_to_rgb(h, s, v) {\r\n  let c = 0, m = 0, x = 0;\r\n  let ret = hsv_to_rgb_rets.next();\r\n\r\n  ret[0] = ret[1] = ret[2] = 0.0;\r\n  h *= 360.0;\r\n\r\n  c = v*s;\r\n  x = c*(1.0 - Math.abs(((h/60.0)%2) - 1.0));\r\n  m = v - c;\r\n  let color;\r\n\r\n  function RgbF_Create(r, g, b) {\r\n    ret[0] = r;\r\n    ret[1] = g;\r\n    ret[2] = b;\r\n\r\n    return ret;\r\n  }\r\n\r\n  if (h >= 0.0 && h < 60.0) {\r\n    color = RgbF_Create(c + m, x + m, m);\r\n  } else if (h >= 60.0 && h < 120.0) {\r\n    color = RgbF_Create(x + m, c + m, m);\r\n  } else if (h >= 120.0 && h < 180.0) {\r\n    color = RgbF_Create(m, c + m, x + m);\r\n  } else if (h >= 180.0 && h < 240.0) {\r\n    color = RgbF_Create(m, x + m, c + m);\r\n  } else if (h >= 240.0 && h < 300.0) {\r\n    color = RgbF_Create(x + m, m, c + m);\r\n  } else if (h >= 300.0) {\r\n    color = RgbF_Create(c + m, m, x + m);\r\n  } else {\r\n    color = RgbF_Create(m, m, m);\r\n  }\r\n\r\n  return color;\r\n}\r\n\r\nlet rgb_to_cmyk_rets = util.cachering.fromConstructor(Vector4, 512);\r\nlet cmyk_to_rgb_rets = util.cachering.fromConstructor(Vector3, 512);\r\n\r\nexport function cmyk_to_rgb(c, m, y, k) {\r\n  let ret = cmyk_to_rgb_rets.next();\r\n\r\n  if (k === 1.0) {\r\n    ret.zero();\r\n    return ret;\r\n  }\r\n\r\n  c = c - c*k + k;\r\n  m = m - m*k + k;\r\n  y = y - y*k + k;\r\n\r\n  ret[0] = 1.0 - c;\r\n  ret[1] = 1.0 - m;\r\n  ret[2] = 1.0 - y;\r\n\r\n  return ret;\r\n}\r\n\r\nexport function rgb_to_cmyk(r, g, b) {\r\n  //CMYK and CMY values from 0 to 1\r\n  let ret = rgb_to_cmyk_rets.next();\r\n\r\n  let C = 1.0 - r;\r\n  let M = 1.0 - g;\r\n  let Y = 1.0 - b;\r\n\r\n  let var_K = 1\r\n\r\n  if (C < var_K) var_K = C\r\n  if (M < var_K) var_K = M\r\n  if (Y < var_K) var_K = Y\r\n  if (var_K === 1) { //Black\r\n    C = 0\r\n    M = 0\r\n    Y = 0\r\n  } else {\r\n    C = (C - var_K)/(1 - var_K)\r\n    M = (M - var_K)/(1 - var_K)\r\n    Y = (Y - var_K)/(1 - var_K)\r\n  }\r\n\r\n  let K = var_K\r\n\r\n  ret[0] = C;\r\n  ret[1] = M;\r\n  ret[2] = Y;\r\n  ret[3] = K;\r\n\r\n  return ret;\r\n}\r\n\r\n","\"use strict\";\r\n\r\nimport {Vector2} from \"./vectormath.js\";\r\nimport * as math from './math.js';\r\nimport * as util from './util.js';\r\n\r\nimport {Constraint, Solver} from './solver.js';\r\n\r\nlet idgen = 0;\r\n\r\nexport class PackNodeVertex extends Vector2 {\r\n  constructor(node, co) {\r\n    super(co);\r\n\r\n    this.node = node;\r\n    this._id = idgen++;\r\n    this.edges = [];\r\n    this._absPos = new Vector2();\r\n  }\r\n\r\n  get absPos() {\r\n    this._absPos.load(this).add(this.node.pos);\r\n    return this._absPos;\r\n  }\r\n\r\n  [Symbol.keystr]() {\r\n    return this._id;\r\n  }\r\n}\r\n\r\nexport class PackNode {\r\n  constructor() {\r\n    this.pos = new Vector2();\r\n    this.vel = new Vector2();\r\n    this.oldpos = new Vector2();\r\n    this._id = idgen++;\r\n    this.size = new Vector2();\r\n    this.verts = [];\r\n  }\r\n\r\n  [Symbol.keystr]() {\r\n    return this._id;\r\n  }\r\n}\r\n\r\nfunction copyGraph(nodes) {\r\n  let ret = [];\r\n  let idmap = {};\r\n\r\n  for (let n of nodes) {\r\n    let n2 = new PackNode();\r\n    n2._id = n._id;\r\n    n2.pos.load(n.pos);\r\n    n2.vel.load(n.vel);\r\n    n2.size.load(n.size);\r\n\r\n    n2.verts = [];\r\n    idmap[n2._id] = n2;\r\n\r\n    for (let v of n.verts) {\r\n      let v2 = new PackNodeVertex(n2, v);\r\n      v2._id = v._id;\r\n      idmap[v2._id] = v2;\r\n\r\n      n2.verts.push(v2);\r\n    }\r\n\r\n    ret.push(n2);\r\n  }\r\n\r\n  for (let n of nodes) {\r\n    for (let v of n.verts) {\r\n      let v2 = idmap[v._id];\r\n\r\n      for (let v3 of v.edges) {\r\n        v2.edges.push(idmap[v3._id]);\r\n      }\r\n    }\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nfunction getCenter(nodes) {\r\n  let cent = new Vector2();\r\n\r\n  for (let n of nodes) {\r\n    cent.add(n.pos);\r\n  }\r\n\r\n  if (nodes.length === 0)\r\n    return cent;\r\n\r\n  cent.mulScalar(1.0 / nodes.length);\r\n\r\n  return cent;\r\n}\r\n\r\nfunction loadGraph(nodes, copy) {\r\n  let idmap = {};\r\n\r\n  for (let i=0; i<nodes.length; i++) {\r\n    nodes[i].pos.load(copy[i].pos);\r\n    nodes[i].oldpos.load(copy[i].oldpos);\r\n    nodes[i].vel.load(copy[i].vel);\r\n  }\r\n}\r\n\r\nexport function graphGetIslands(nodes) {\r\n  let islands = [];\r\n  let visit1 = new util.set();\r\n\r\n  let rec = (n, island) => {\r\n    island.push(n);\r\n    visit1.add(n);\r\n\r\n    for (let v of n.verts) {\r\n      for (let e of v.edges) {\r\n        let n2 = e.node;\r\n        if (n2 !== n && !visit1.has(n2)) {\r\n          rec(n2, island);\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  for (let n of nodes) {\r\n    if (visit1.has(n)) {\r\n      continue;\r\n    }\r\n\r\n    let island = [];\r\n    islands.push(island);\r\n    rec(n, island);\r\n  }\r\n\r\n  return islands;\r\n}\r\n\r\nexport function graphPack(nodes, margin_or_args=15, steps=10, updateCb=undefined) {\r\n  let margin = margin_or_args;\r\n  let speed = 1.0;\r\n\r\n  if (typeof margin === \"object\") {\r\n    let args = margin;\r\n\r\n    margin = args.margin ?? 15;\r\n    steps = args.steps ?? 10;\r\n    updateCb = args.updateCb;\r\n    speed = args.speed ?? 1.0;\r\n  }\r\n\r\n  let orignodes = nodes;\r\n  nodes = copyGraph(nodes);\r\n\r\n  let decay = 1.0;\r\n  let decayi = 0;\r\n\r\n\r\n  let min = new Vector2().addScalar(1e17);\r\n  let max = new Vector2().addScalar(-1e17);\r\n\r\n  let tmp = new Vector2();\r\n  for (let n of nodes) {\r\n    min.min(n.pos);\r\n    tmp.load(n.pos).add(n.size);\r\n    max.max(tmp);\r\n  }\r\n\r\n  let size = new Vector2(max).sub(min);\r\n\r\n  for (let n of nodes) {\r\n    n.pos[0] += (Math.random()-0.5)*5.0/size[0]*speed;\r\n    n.pos[1] += (Math.random()-0.5)*5.0/size[1]*speed;\r\n  }\r\n\r\n  let nodemap = {};\r\n  for (let n of nodes) {\r\n    n.vel.zero();\r\n    nodemap[n._id] = n;\r\n    for (let v of n.verts) {\r\n      nodemap[v._id] = v;\r\n    }\r\n  }\r\n\r\n  let visit = new util.set();\r\n  let verts = new util.set();\r\n  let isect = [];\r\n\r\n  let disableEdges = false;\r\n\r\n  function edge_c(params) {\r\n    let [v1, v2, restlen] = params;\r\n\r\n    if (disableEdges) return 0;\r\n\r\n    return Math.abs(v1.absPos.vectorDistance(v2.absPos) - restlen);\r\n  }\r\n\r\n  let p1 = new Vector2();\r\n  let p2 = new Vector2();\r\n  let s1 = new Vector2();\r\n  let s2 = new Vector2();\r\n\r\n  function loadBoxes(n1, n2, margin1=margin) {\r\n    p1.load(n1.pos);\r\n    p2.load(n2.pos);\r\n    s1.load(n1.size);\r\n    s2.load(n2.size);\r\n\r\n    p1.subScalar(margin1);\r\n    p2.subScalar(margin1);\r\n    s1.addScalar(margin1*2.0);\r\n    s2.addScalar(margin1*2.0);\r\n  }\r\n\r\n  let disableArea = false;\r\n\r\n  function area_c(params) {\r\n    let [n1, n2] = params;\r\n\r\n    if (disableArea)\r\n      return 0.0;\r\n\r\n    loadBoxes(n1, n2);\r\n\r\n    let a1 = n1.size[0]*n1.size[1];\r\n    let a2 = n2.size[0]*n2.size[1];\r\n\r\n    return math.aabb_overlap_area(p1, s1, p2, s2);\r\n    return (math.aabb_overlap_area(p1, s1, p2, s2) / (a1+a2));\r\n  }\r\n\r\n  let lasterr, besterr, best;\r\n  let err;\r\n\r\n  let islands = graphGetIslands(nodes);\r\n  let fakeVerts = [];\r\n  for (let island of islands) {\r\n    let n = island[0];\r\n    let fv = new PackNodeVertex(n);\r\n    fakeVerts.push(fv);\r\n  }\r\n\r\n  let solveStep1 = (gk=1.0) => {\r\n    let solver = new Solver();\r\n\r\n    isect.length = 0;\r\n    visit = new util.set();\r\n\r\n    if (fakeVerts.length > 1) {\r\n      for (let i=1; i<fakeVerts.length; i++) {\r\n        let v1 = fakeVerts[0];\r\n        let v2 = fakeVerts[i];\r\n\r\n        let rlen = 1.0;\r\n\r\n        let con = new Constraint(\"edge_c\", edge_c, [v1.node.pos, v2.node.pos], [v1, v2, rlen]);\r\n        con.k = 0.25;\r\n        solver.add(con);\r\n      }\r\n    }\r\n\r\n    for (let n1 of nodes) {\r\n      for (let v of n1.verts) {\r\n        verts.add(v);\r\n        for (let v2 of v.edges) {\r\n          //hueristic to avoid adding same constraint twice\r\n          if (v2._id < v._id) continue;\r\n\r\n          let rlen = n1.size.vectorLength()*0.0;\r\n\r\n          let con = new Constraint(\"edge_c\", edge_c, [v.node.pos, v2.node.pos], [v, v2, rlen]);\r\n          con.k = 1.0;\r\n          solver.add(con);\r\n        }\r\n      }\r\n\r\n      for (let n2 of nodes) {\r\n        if (n1 === n2) continue;\r\n        let key = Math.min(n1._id, n2._id) + \":\" + Math.max(n1._id, n2._id);\r\n        if (visit.has(key)) continue;\r\n\r\n        loadBoxes(n1, n2);\r\n        let area = math.aabb_overlap_area(p1, s1, p2, s2);\r\n\r\n        if (area > 0.01) {\r\n          let size = decay*(n1.size.vectorLength() + n2.size.vectorLength())*speed;\r\n          //*\r\n          n1.pos[0] += (Math.random() - 0.5)*size;\r\n          n1.pos[1] += (Math.random() - 0.5)*size;\r\n          n2.pos[0] += (Math.random() - 0.5)*size;\r\n          n2.pos[1] += (Math.random() - 0.5)*size;\r\n          //*/\r\n\r\n          isect.push([n1, n2]);\r\n          visit.add(key);\r\n        }\r\n      }\r\n\r\n      for (let [n1, n2] of isect) {\r\n        let con = new Constraint(\"area_c\", area_c, [n1.pos, n2.pos], [n1, n2]);\r\n        solver.add(con);\r\n        con.k = 1.0;\r\n      }\r\n    }\r\n\r\n    return solver;\r\n  };\r\n\r\n  let i = 1;\r\n  let solveStep = (gk=0.5) => {\r\n    let solver = solveStep1();\r\n\r\n    if (i % 40 === 0.0) {\r\n      let c1 = getCenter(nodes);\r\n\r\n      let rfac = 1000.0;\r\n\r\n      if (best) loadGraph(nodes, best);\r\n\r\n      for (let n of nodes) {\r\n        n.pos[0] += (Math.random() - 0.5) * rfac * speed;\r\n        n.pos[1] += (Math.random() - 0.5) * rfac * speed;\r\n        n.vel.zero();\r\n      }\r\n\r\n      let c2 = getCenter(nodes);\r\n      c1.sub(c2);\r\n\r\n      for (let n of nodes) {\r\n        n.pos.add(c1);\r\n      }\r\n    }\r\n\r\n    let err = 1e17;\r\n\r\n    for (let n of nodes) {\r\n      n.oldpos.load(n.pos);\r\n      n.pos.addFac(n.vel, 0.5);\r\n    }\r\n\r\n    disableEdges = false;\r\n    disableArea = true;\r\n    solver.solve(1, gk);\r\n\r\n    //solve so boxes don't overlap\r\n    disableEdges = true;\r\n    disableArea = false;\r\n\r\n    for (let j=0; j<10; j++) {\r\n      solver = solveStep1();\r\n      err = solver.solve(10, gk*speed);\r\n    }\r\n\r\n    for (let n of nodes) {\r\n      n.vel.load(n.pos).sub(n.oldpos);\r\n    }\r\n\r\n    //get error from edge constraints\r\n\r\n    disableEdges = false;\r\n    disableArea = true;\r\n\r\n    err = 0.0;\r\n    for (let con of solver.constraints) {\r\n      err += con.evaluate(true);\r\n    }\r\n\r\n    disableEdges = false;\r\n    disableArea = false;\r\n\r\n    /*\r\n    loadGraph(orignodes, nodes);\r\n    if (updateCb) {\r\n      updateCb();\r\n    }//*/\r\n\r\n    lasterr = err;\r\n\r\n    let add = Math.random()*besterr*Math.exp(-i*0.1);\r\n\r\n    if (besterr === undefined || err < besterr+add) {\r\n      best = copyGraph(nodes);\r\n      besterr = err;\r\n    }\r\n\r\n    i++;\r\n\r\n    return err;\r\n  };\r\n\r\n\r\n  for (let j=0; j<steps; j++) {\r\n    solveStep();\r\n\r\n    decayi++;\r\n    decay = Math.exp(-decayi*0.1);\r\n  }\r\n\r\n  min.zero().addScalar(1e17);\r\n  max.zero().addScalar(-1e17);\r\n\r\n  for (let node of (best ? best : nodes)) {\r\n    min.min(node.pos);\r\n    p2.load(node.pos).add(node.size);\r\n    max.max(p2);\r\n  }\r\n\r\n  for (let node of (best ? best : nodes)) {\r\n    node.pos.sub(min);\r\n  }\r\n\r\n  loadGraph(orignodes, best ? best : nodes);\r\n\r\n  if (updateCb) {\r\n    if (nodes._timer !== undefined) {\r\n      window.clearInterval(nodes._timer);\r\n    }\r\n\r\n    nodes._timer = window.setInterval(() => {\r\n      let time = util.time_ms();\r\n\r\n      while (util.time_ms() - time < 50) {\r\n        let err = solveStep();\r\n      }\r\n\r\n      if (cconst.DEBUG.boxPacker) {\r\n        console.log(\"err\", (besterr / nodes.length).toFixed(2), (lasterr / nodes.length).toFixed(2), \"isects\", isect.length);\r\n      }\r\n\r\n      if (best) loadGraph(orignodes, best);\r\n\r\n      if (updateCb() === false) {\r\n        clearInterval(nodes._timer);\r\n        return;\r\n      }\r\n    }, 100);\r\n\r\n    let timer = nodes._timer;\r\n\r\n    return {\r\n      stop : () => {\r\n        if (best) loadGraph(nodes, best);\r\n\r\n        window.clearInterval(timer);\r\n        nodes._timer = undefined;\r\n      }\r\n    }\r\n  }\r\n}\r\n","/**\r\n\r\n This is the main datapath controller module, inspired by Blender's RNA system.\r\n\r\n Datapaths are special bindings for objects; they store types (e.g. float, int, enumeration, string),\r\n as well as lots of UI-specific metadata (like human-readable names, tooltips, icons, numeric ranges, etc).\r\n\r\n Controller bindings are intended to present a more unified and coherent model of the\r\n application model than may actually exists.  This is inspired by Blender's RNA system, which\r\n hides almost all of Blender's core data structure complexity (Blender is written in C) from\r\n users who e.g. write python scripts, extend the UI, use advanced animation features, or anything else\r\n that uses RNA paths.\r\n\r\n ## Contexts\r\n\r\n The datapath system works in tandem with the context module.  Contexts are client-provided classes\r\n that the datapath API and ToolOps use to communicate with the application state.\r\n\r\n ## Example\r\n\r\n <pre>\r\n\r\n function initMyDataAPI() {\r\n let api = new DataAPI();\r\n\r\n //map MyContextClass to a struct, true tells mapStruct to auto-create\r\n //the struct if it doesn't already exist.\r\n //\r\n //MyContextClass should have a member \"propCache\" pointing at SavedToolDefaults.\r\n let st = api.mapStruct(MyContextClass, true);\r\n\r\n //set fields of struct, e.g. st.int, st.float, st.enum, st.struct, etc\r\n\r\n //build toolsys api\r\n buildToolSysAPI(api);\r\n\r\n //create bindings for default tool operator settings\r\n cstruct.struct(\"propCache\", \"toolDefaults\", \"Tool Defaults\", api.mapStruct(ToolPropertyCache));\r\n\r\n return api;\r\n }\r\n </pre>\r\n */\r\nimport * as toolprop from '../toolsys/toolprop.js';\r\nimport * as parseutil from '../util/parseutil.js';\r\nimport {print_stack} from '../util/util.js';\r\nimport {ToolOp, UndoFlags, ToolFlags} from \"../toolsys/toolsys.js\";\r\nimport {Vec2Property, Vec3Property, Vec4Property, PropTypes, PropFlags} from '../toolsys/toolprop.js';\r\nimport * as toolprop_abstract from '../toolsys/toolprop_abstract.js';\r\nimport * as util from '../util/util.js';\r\n\r\nimport {DataPath, DataFlags, DataTypes, DataPathError, StructFlags, getTempProp} from './controller_base.js';\r\n\r\nexport * from './controller_base.js';\r\n\r\nlet PUTLParseError = parseutil.PUTLParseError;\r\n\r\nlet tk = (name, re, func) => new parseutil.tokdef(name, re, func);\r\nlet tokens = [\r\n  tk(\"ID\", /[a-zA-Z_$]+[a-zA-Z_$0-9]*/),\r\n  tk(\"NUM\", /-?[0-9]+/, (t) => {\r\n    t.value = parseInt(t.value);\r\n    return t;\r\n  }),\r\n  tk('NUMBER', /-?[0-9]+\\.[0-9]*/, (t) => {\r\n    t.value = parseFloat(t.value);\r\n    return t;\r\n  }),\r\n  tk(\"STRLIT\", /'.*?'/, (t) => {\r\n    t.value = t.value.slice(1, t.value.length - 1);\r\n    return t;\r\n  }),\r\n  tk(\"STRLIT\", /\".*?\"/, (t) => {\r\n    t.value = t.value.slice(1, t.value.length - 1);\r\n    return t;\r\n  }),\r\n  tk(\"DOT\", /\\./),\r\n  tk(\"EQUALS\", /(\\=)|(\\=\\=)/),\r\n  tk(\"LSBRACKET\", /\\[/),\r\n  tk(\"RSBRACKET\", /\\]/),\r\n  tk(\"AND\", /\\&/),\r\n  tk(\"WS\", /[ \\t\\n\\r]+/, (t) => undefined), //drop token\r\n];\r\n\r\nlet lexer = new parseutil.lexer(tokens, (t) => {\r\n  console.warn(\"Parse error\", t);\r\n  throw new DataPathError();\r\n});\r\n\r\nexport let pathParser = new parseutil.parser(lexer);\r\n\r\nlet parserStack = new Array(32);\r\nfor (let i = 0; i < parserStack.length; i++) {\r\n  parserStack[i] = pathParser.copy();\r\n}\r\nparserStack.cur = 0;\r\n\r\nimport {\r\n  setImplementationClass, isVecProperty, ListIface\r\n} from './controller_base.js';\r\nimport {initToolPaths, parseToolPath} from '../toolsys/toolpath.js';\r\nimport {ModelInterface} from './controller_abstract.js';\r\n\r\nexport {DataPathError, DataFlags} from './controller_base.js';\r\n\r\nimport {ToolClasses} from '../toolsys/toolsys.js';\r\nimport {ToolProperty, IntProperty} from \"../toolsys/toolprop.js\";\r\n\r\nlet tool_classes = ToolClasses;\r\n\r\nlet tool_idgen = 1;\r\nSymbol.ToolID = Symbol(\"toolid\");\r\n\r\nfunction toolkey(cls) {\r\n  if (!(Symbol.ToolID in cls)) {\r\n    cls[Symbol.ToolID] = tool_idgen++;\r\n  }\r\n\r\n  return cls[Symbol.ToolID];\r\n}\r\n\r\nlet lt = util.time_ms();\r\nlet lastmsg = undefined;\r\nlet lcount = 0;\r\n\r\nlet reportstack = [\"api\"];\r\n\r\nexport function pushReportName(name) {\r\n  if (reportstack.length > 1024) {\r\n    console.trace(\"eerk, reportstack overflowed\");\r\n    reportstack.length = 0;\r\n    reportstack.push(\"api\");\r\n  }\r\n\r\n  reportstack.push(name);\r\n}\r\n\r\nfunction report(msg) {\r\n  let name = reportstack.length === 0 ? \"api\" : reportstack[reportstack.length - 1];\r\n\r\n  util.console.context(name).warn(msg);\r\n}\r\n\r\nexport function popReportName() {\r\n  reportstack.pop();\r\n}\r\n\r\n\r\nexport class DataList extends ListIface {\r\n  constructor(callbacks) {\r\n    super();\r\n\r\n    if (callbacks === undefined) {\r\n      throw new DataPathError(\"missing callbacks argument to DataList\");\r\n    }\r\n\r\n    this.cb = {};\r\n\r\n    if (typeof callbacks === \"object\" && !Array.isArray(callbacks)) {\r\n      for (let k in callbacks) {\r\n        this.cb[k] = callbacks[k];\r\n      }\r\n    } else {\r\n      for (let cb of callbacks) {\r\n        this.cb[cb.name] = cb;\r\n      }\r\n    }\r\n\r\n    let check = (key) => {\r\n      if (!(key in this.cbs)) {\r\n        throw new DataPathError(`Missing ${key} callback in DataList`);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   Generic list API.\r\n\r\n   * Callbacks is an array of name functions, like so:\r\n   - function getStruct(api, list, key) //return DataStruct type of object in key, key is optional if omitted return base type of all objects?\r\n   - function get(api, list, key)\r\n   - function set(api, list, key, val) //this one has default behavior: list[key] = val\r\n   - function getLength(api, list)\r\n   - function getActive(api, list)\r\n   - function setActive(api, list, key)\r\n   - function getIter(api, list)\r\n   - function getKey(api, list, object) returns object's key in this list, either a string or a number\r\n   * */\r\n\r\n  copy() {\r\n    let ret = new DataList([this.cb.get]);\r\n\r\n    for (let k in this.cb) {\r\n      ret.cb[k] = this.cb[k];\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  get(api, list, key) {\r\n    return this.cb.get(api, list, key);\r\n  }\r\n\r\n  getLength(api, list) {\r\n    this._check(\"getLength\");\r\n    return this.cb.getLength(api, list);\r\n  }\r\n\r\n  _check(cb) {\r\n    if (!(cb in this.cb)) {\r\n      throw new DataPathError(cb + \" not supported by this list\");\r\n    }\r\n  }\r\n\r\n  set(api, list, key, val) {\r\n    if (this.cb.set === undefined) {\r\n      list[key] = val;\r\n    } else {\r\n      this.cb.set(api, list, key, val);\r\n    }\r\n  }\r\n\r\n  getIter(api, list) {\r\n    this._check(\"getIter\");\r\n    return this.cb.getIter(api, list);\r\n  }\r\n\r\n  filter(api, list, bitmask) {\r\n    this._check(\"filter\");\r\n    return this.cb.filter(api, list, bitmask);\r\n  }\r\n\r\n  getActive(api, list) {\r\n    this._check(\"getActive\");\r\n    return this.cb.getActive(api, list);\r\n  }\r\n\r\n  setActive(api, list, key) {\r\n    this._check(\"setActive\");\r\n    this.cb.setActive(api, list, key);\r\n  }\r\n\r\n  getKey(api, list, obj) {\r\n    this._check(\"getKey\");\r\n    return this.cb.getKey(api, list, obj);\r\n  }\r\n\r\n  getStruct(api, list, key) {\r\n    if (this.cb.getStruct !== undefined) {\r\n      return this.cb.getStruct(api, list, key);\r\n    }\r\n\r\n    let obj = this.get(api, list, key);\r\n\r\n    if (obj === undefined)\r\n      return undefined;\r\n\r\n    return api.getStruct(obj.constructor);\r\n  }\r\n}\r\n\r\nexport class DataStruct {\r\n  constructor(members = [], name = \"unnamed\") {\r\n    this.members = [];\r\n    this.name = name;\r\n    this.pathmap = {};\r\n    this.flag = 0;\r\n    this.dpath = undefined; //owning DataPath\r\n\r\n    this.inheritFlag = 0;\r\n\r\n    for (let m of members) {\r\n      this.add(m);\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this.pathmap = {};\r\n    this.members = [];\r\n\r\n    return this;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new DataStruct();\r\n\r\n    ret.name = this.name;\r\n    ret.flag = this.flag;\r\n    ret.inheritFlag = this.inheritFlag;\r\n\r\n    for (let m of this.members) {\r\n      let m2 = m.copy();\r\n\r\n      //don't copy struct or list references, just\r\n      //direct properties\r\n\r\n      if (m2.type === DataTypes.PROP) {\r\n        m2.data = m2.data.copy();\r\n      }\r\n\r\n      ret.add(m2);\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   * Like .struct, but the type of struct is looked up\r\n   * for objects at runtime.  Note that to work correctly each object\r\n   * must create its own struct definition via api.mapStruct\r\n   *\r\n   * @param path\r\n   * @param apiname\r\n   * @param uiname\r\n   * @param default_struct : default struct if one can't be looked up\r\n   * @returns {*}\r\n   */\r\n  dynamicStruct(path, apiname, uiname, default_struct = undefined) {\r\n    let ret = default_struct ? default_struct : new DataStruct();\r\n\r\n    let dpath = new DataPath(path, apiname, ret, DataTypes.DYNAMIC_STRUCT);\r\n    ret.inheritFlag |= this.inheritFlag;\r\n\r\n    ret.dpath = dpath;\r\n\r\n    this.add(dpath);\r\n    return ret;\r\n  }\r\n\r\n  struct(path, apiname, uiname, existing_struct = undefined) {\r\n    let ret = existing_struct ? existing_struct : new DataStruct();\r\n\r\n    let dpath = new DataPath(path, apiname, ret, DataTypes.STRUCT);\r\n    ret.inheritFlag |= this.inheritFlag;\r\n\r\n    ret.dpath = dpath;\r\n\r\n    this.add(dpath);\r\n    return ret;\r\n  }\r\n\r\n  customGet(getter) {\r\n    this.dpath.customGet(getter);\r\n\r\n    return this;\r\n  }\r\n\r\n  customGetSet(getter, setter) {\r\n    this.dpath.customGetSet(getter, setter);\r\n\r\n    return this;\r\n  }\r\n\r\n  color3(path, apiname, uiname, description) {\r\n    let ret = this.vec3(path, apiname, uiname, description);\r\n\r\n    ret.data.subtype = toolprop.PropSubTypes.COLOR;\r\n    ret.range(0, 1);\r\n    ret.simpleSlider();\r\n\r\n    ret.noUnits();\r\n\r\n    return ret;\r\n  }\r\n\r\n  color4(path, apiname, uiname, description = uiname) {\r\n    let ret = this.vec4(path, apiname, uiname, description);\r\n\r\n    ret.data.subtype = toolprop.PropSubTypes.COLOR;\r\n    ret.range(0, 1);\r\n    ret.simpleSlider();\r\n\r\n    ret.noUnits();\r\n\r\n    return ret;\r\n  }\r\n\r\n  arrayList(path, apiname, structdef, uiname, description) {\r\n    let ret = this.list(path, apiname, [\r\n      function getIter(api, list) {\r\n        return list[Symbol.iterator]();\r\n      },\r\n      function getLength(api, list) {\r\n        return list.length;\r\n      },\r\n      function get(api, list, key) {\r\n        return list[key];\r\n      },\r\n      function set(api, list, key, val) {\r\n        if (typeof key === \"string\") {\r\n          key = parseInt(key);\r\n        }\r\n\r\n        if (key < 0 || key >= list.length) {\r\n          throw new DataPathError(\"Invalid index \" + key);\r\n        }\r\n\r\n        list[key] = val;\r\n      },\r\n      function getKey(api, list, obj) {\r\n        return list.indexOf(obj);\r\n      },\r\n      function getStruct(api, list, key) {\r\n        return structdef;\r\n      }]);\r\n\r\n    return ret;\r\n  }\r\n\r\n  color3List(path, apiname, uiname, description) {\r\n    return this.vectorList(3, path, apiname, uiname, description, toolprop.PropSubTypes.COLOR);\r\n  }\r\n\r\n  color4List(path, apiname, uiname, description) {\r\n    return this.vectorList(4, path, apiname, uiname, description, toolprop.PropSubTypes.COLOR);\r\n  }\r\n\r\n  vectorList(size, path, apiname, uiname, description, subtype) {\r\n    let type;\r\n\r\n    switch (size) {\r\n      case 2:\r\n        type = toolprop.Vec2Property;\r\n        break;\r\n      case 3:\r\n        type = toolprop.Vec3Property;\r\n      case 4:\r\n        type = toolprop.Vec4Property;\r\n    }\r\n\r\n    if (type === undefined) {\r\n      throw new DataPathError(\"Invalid size for vectorList; expected 2 3 or 4\");\r\n    }\r\n\r\n    let prop = new type(undefined, apiname, uiname, description);\r\n\r\n    let pstruct = new DataStruct(undefined, \"Vector\");\r\n    pstruct.vec3(\"\", \"co\", \"Coords\", \"Coordinates\");\r\n\r\n    let ret = this.list(path, apiname, [\r\n      function getIter(api, list) {\r\n        return list[Symbol.iterator]();\r\n      },\r\n      function getLength(api, list) {\r\n        return list.length;\r\n      },\r\n      function get(api, list, key) {\r\n        return list[key];\r\n      },\r\n      function set(api, list, key, val) {\r\n        if (typeof key == \"string\") {\r\n          key = parseInt(key);\r\n        }\r\n\r\n        if (key < 0 || key >= list.length) {\r\n          throw new DataPathError(\"Invalid index \" + key);\r\n        }\r\n\r\n        list[key] = val;\r\n      },\r\n      function getKey(api, list, obj) {\r\n        return list.indexOf(obj);\r\n      },\r\n      function getStruct(api, list, key) {\r\n        return pstruct;\r\n      }]);\r\n\r\n    return ret;\r\n  }\r\n\r\n  bool(path, apiname, uiname, description) {\r\n    let prop = new toolprop.BoolProperty(undefined, apiname, uiname, description);\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  vec2(path, apiname, uiname, description) {\r\n    let prop = new toolprop.Vec2Property(undefined, apiname, uiname, description);\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  vec3(path, apiname, uiname, description) {\r\n    let prop = new toolprop.Vec3Property(undefined, apiname, uiname, description);\r\n    //prop.uiname = uiname;\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  vec4(path, apiname, uiname, description) {\r\n    let prop = new toolprop.Vec4Property(undefined, apiname, uiname, description);\r\n    //prop.uiname = uiname;\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  float(path, apiname, uiname, description) {\r\n    let prop = new toolprop.FloatProperty(0, apiname, uiname, description);\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  textblock(path, apiname, uiname, description) {\r\n    let prop = new toolprop.StringProperty(undefined, apiname, uiname, description);\r\n    prop.multiLine = true;\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  report(path, apiname, uiname, description) {\r\n    let prop = new toolprop.ReportProperty(undefined, apiname, uiname, description);\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  string(path, apiname, uiname, description) {\r\n    let prop = new toolprop.StringProperty(undefined, apiname, uiname, description);\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  int(path, apiname, uiname, description, prop = undefined) {\r\n    if (!prop) {\r\n      prop = new toolprop.IntProperty(0, apiname, uiname, description);\r\n    }\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  curve1d(path, apiname, uiname, description) {\r\n    let prop = new Curve1DProperty(undefined);\r\n\r\n    prop.apiname = apiname;\r\n    prop.uiname = uiname;\r\n    prop.description = description;\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  enum(path, apiname, enumdef, uiname, description) {\r\n    let prop;\r\n\r\n    if (enumdef instanceof toolprop.EnumProperty) {\r\n      prop = enumdef;\r\n    } else {\r\n      prop = new toolprop.EnumProperty(undefined, enumdef, apiname, uiname, description);\r\n    }\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  list(path, apiname, funcs) {\r\n    let array = new DataList(funcs);\r\n\r\n    let dpath = new DataPath(path, apiname, array);\r\n    dpath.type = DataTypes.ARRAY;\r\n\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  flags(path, apiname, enumdef, uiname, description) {\r\n    let prop;\r\n\r\n    if (enumdef === undefined || !(enumdef instanceof toolprop.ToolProperty)) {\r\n      prop = new toolprop.FlagProperty(undefined, enumdef, apiname, uiname, description);\r\n    } else {\r\n      prop = enumdef;\r\n    }\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  remove(m) {\r\n    if (typeof m === \"string\") {\r\n      m = this.pathmap[m];\r\n    }\r\n\r\n    if (!(m.apiname in this.pathmap)) {\r\n      throw new Error(\"Member not in struct \" + m.apiname);\r\n    }\r\n\r\n    delete this.pathmap[m.apiname];\r\n    this.members.remove(m);\r\n  }\r\n\r\n  fromToolProp(path, prop, apiname = prop.apiname.length > 0 ? prop.apiname : path) {\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  add(m) {\r\n    if (m.apiname in this.pathmap) {\r\n      if (window.DEBUG.datapaths) {\r\n        console.warn(\"Overriding existing member '\" + m.apiname + \"' in datapath struct\", this.name);\r\n      }\r\n\r\n      this.remove(this.pathmap[m.apiname]);\r\n    }\r\n\r\n    m.flag |= this.inheritFlag;\r\n\r\n    this.members.push(m);\r\n    m.parent = this;\r\n\r\n    this.pathmap[m.apiname] = m;\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nlet _map_struct_idgen = 1;\r\nlet _map_structs = {};\r\n\r\nwindow._debug__map_structs = _map_structs; //global for debugging purposes only\r\n\r\nlet _dummypath = new DataPath();\r\n\r\nlet DummyIntProperty = new IntProperty();\r\nconst CLS_API_KEY = Symbol(\"dp_map_id\");\r\nconst CLS_API_KEY_CUSTOM = Symbol(\"dp_map_custom\");\r\n\r\nexport class DataAPI extends ModelInterface {\r\n  constructor() {\r\n    super();\r\n\r\n    this.rootContextStruct = undefined;\r\n    this.structs = [];\r\n  }\r\n\r\n  get list() {\r\n    return undefined;\r\n  }\r\n\r\n  static toolRegistered(cls) {\r\n    return ToolOp.isRegistered(cls);\r\n    //let key = toolkey(cls);\r\n    //return key in tool_classes;\r\n  }\r\n\r\n  static registerTool(cls) {\r\n    console.warn(\"Outdated function simple_controller.DataAPI.registerTool called\");\r\n\r\n    return ToolOp.register(cls);\r\n\r\n    //let key = toolkey(cls);\r\n    //\r\n    //if (!(key in tool_classes)) {\r\n    //  tool_classes[key] = cls;\r\n    //}\r\n  }\r\n\r\n  getStructs() {\r\n    return this.structs;\r\n  }\r\n\r\n  setRoot(sdef) {\r\n    this.rootContextStruct = sdef;\r\n  }\r\n\r\n  hasStruct(cls) {\r\n    return cls.hasOwnProperty(CLS_API_KEY);\r\n  }\r\n\r\n  getStruct(cls) {\r\n    return this.mapStruct(cls, false);\r\n  }\r\n\r\n  mergeStructs(dest, src) {\r\n    for (let m of src.members) {\r\n      dest.add(m.copy());\r\n    }\r\n  }\r\n\r\n  inheritStruct(cls, parent, auto_create_parent = false) {\r\n    let st = this.mapStruct(parent, auto_create_parent);\r\n\r\n    if (st === undefined) {\r\n      throw new Error(\"parent has no struct definition\");\r\n    }\r\n\r\n    st = st.copy();\r\n    st.name = cls.name;\r\n\r\n    this._addClass(cls, st);\r\n    return st;\r\n  }\r\n\r\n  /**\r\n   * Look up struct definition for a class.\r\n   *\r\n   * @param cls: the class\r\n   * @param auto_create: If true, automatically create definition if not already existing.\r\n   * @returns {IterableIterator<*>}\r\n   */\r\n\r\n  _addClass(cls, dstruct) {\r\n    let key = _map_struct_idgen++;\r\n    cls[CLS_API_KEY] = key;\r\n\r\n    this.structs.push(dstruct);\r\n\r\n    _map_structs[key] = dstruct;\r\n  }\r\n\r\n  /* Associate cls with a DataStruct\r\n   * via callback, which will be called\r\n   * with an instance of cls as its argument*/\r\n  mapStructCustom(cls, callback) {\r\n    this.mapStruct(cls, true);\r\n    cls[CLS_API_KEY_CUSTOM] = callback;\r\n  }\r\n\r\n  mapStruct(cls, auto_create = true, name = cls.name) {\r\n    let key;\r\n\r\n    if (!cls.hasOwnProperty(CLS_API_KEY)) {\r\n      key = undefined;\r\n    } else {\r\n      key = cls[CLS_API_KEY];\r\n    }\r\n\r\n    if (key === undefined && auto_create) {\r\n      let dstruct = new DataStruct(undefined, name);\r\n      this._addClass(cls, dstruct);\r\n      return dstruct;\r\n    } else if (key === undefined) {\r\n      throw new Error(\"class does not have a struct definition: \" + name);\r\n    }\r\n\r\n    return _map_structs[key];\r\n  }\r\n\r\n  //used for tagging error messages\r\n  pushReportContext(name) {\r\n    pushReportName(name);\r\n  }\r\n\r\n  //used for tagging error messages\r\n  popReportContext() {\r\n    popReportName();\r\n  }\r\n\r\n  /*\r\n  massSetProp operate on lists.  The idea is to\r\n  write a filter str inside a data path, e.g.\r\n\r\n  ctx.api.massSetProp(ctx, \"obj.list[{$.select}].value\", 1);\r\n\r\n\r\n  * */\r\n  massSetProp(ctx, massSetPath, value) {\r\n    for (let path of this.resolveMassSetPaths(ctx, massSetPath)) {\r\n      this.setValue(ctx, path, value);\r\n    }\r\n  }\r\n\r\n  resolveMassSetPaths(ctx, massSetPath) {\r\n    if (massSetPath.startsWith(\"/\")) {\r\n      massSetPath = massSetPath.slice(1, massSetPath.length);\r\n    }\r\n\r\n    let start = massSetPath.search(\"{\");\r\n    let end = massSetPath.search(\"}\");\r\n\r\n    if (start < 0 || end < 0) {\r\n      throw new DataPathError(\"Invalid mass set datapath: \" + massSetPath);\r\n      return;\r\n    }\r\n\r\n    let prefix = massSetPath.slice(0, start - 1);\r\n    let filter = massSetPath.slice(start + 1, end);\r\n    let suffix = massSetPath.slice(end + 2, massSetPath.length);\r\n\r\n    let rdef = this.resolvePath(ctx, prefix);\r\n\r\n    if (!(rdef.prop instanceof DataList)) {\r\n      throw new DataPathError(\"massSetPath expected a path resolving to a DataList: \" + massSetPath);\r\n    }\r\n\r\n    let paths = [];\r\n\r\n    let list = rdef.prop;\r\n    let api = ctx.api;\r\n\r\n    function applyFilter(obj) {\r\n      const forceEval = rdef.dpath.flag & DataFlags.USE_EVAL_MASS_SET_PATHS;\r\n\r\n      if (obj === undefined) {\r\n        return undefined;\r\n      } else if (!forceEval && (typeof obj === \"object\" || typeof obj === \"function\")) {\r\n        let st = api.mapStruct(obj.constructor, false);\r\n\r\n        let path = filter;\r\n        if (path.startsWith(\"$\")) {\r\n          path = path.slice(1, filter.length).trim();\r\n        }\r\n        if (path.startsWith(\".\")) {\r\n          path = path.slice(1, filter.length).trim();\r\n        }\r\n\r\n        try {\r\n          return api.getValue(obj, path, st);\r\n        } catch (error) {\r\n          if (!(error instanceof DataPathError)) {\r\n            util.print_stack(error);\r\n            console.error(\"Error in datapath callback\");\r\n          }\r\n\r\n          return false;\r\n        }\r\n      } else {\r\n        let $ = obj;\r\n        return eval(filter);\r\n      }\r\n    }\r\n\r\n    for (let obj of list.getIter(this, rdef.value)) {\r\n      if (!applyFilter(obj)) {\r\n        continue;\r\n      }\r\n\r\n      let key = \"\" + list.getKey(this, rdef.value, obj);\r\n      let path = `${prefix}[${key}]${suffix}`;\r\n\r\n      /* validate the final path */\r\n      try {\r\n        this.getValue(ctx, path);\r\n      } catch (error) {\r\n        if (!(error instanceof DataPathError)) {\r\n          util.print_stack(error);\r\n          console.error(path + \": Error in datapath API\");\r\n        }\r\n\r\n        continue;\r\n      }\r\n\r\n      paths.push(path);\r\n    }\r\n\r\n    return paths;\r\n  }\r\n\r\n  resolvePath(ctx, inpath, ignoreExistence = false, dstruct = undefined) {\r\n    let parser = parserStack[parserStack.cur++];\r\n    let ret = undefined;\r\n\r\n    if (inpath[0] === \"/\") {\r\n      inpath = inpath.slice(1, inpath.length).trim();\r\n    }\r\n\r\n    try {\r\n      ret = this.resolvePath_intern(ctx, inpath, ignoreExistence, parser, dstruct)\r\n    } catch (error) {\r\n      //throw new DataPathError(\"bad path \" + path);\r\n      if (!(error instanceof DataPathError)) {\r\n        util.print_stack(error);\r\n        report(\"error while evaluating path \" + inpath);\r\n      }\r\n\r\n      if (window.DEBUG && window.DEBUG.datapaths) {\r\n        util.print_stack(error);\r\n      }\r\n\r\n      ret = undefined;\r\n    }\r\n\r\n    parserStack.cur--;\r\n\r\n    if (ret !== undefined && ret.prop && ret.dpath && (ret.dpath.flag & DataFlags.USE_CUSTOM_PROP_GETTER)) {\r\n      ret.prop = this.getPropOverride(ctx, inpath, ret.dpath, ret.obj);\r\n    }\r\n\r\n    if (ret !== undefined && ret.prop && ret.dpath && ret.dpath.ui_name_get) {\r\n      let dummy = {\r\n        datactx : ctx,\r\n        datapath: inpath,\r\n        dataref : ret.obj\r\n      };\r\n\r\n      let name = ret.dpath.ui_name_get.call(dummy);\r\n\r\n      ret.prop.uiname = \"\" + name;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  getPropOverride(ctx, path, dpath, obj, prop = dpath.data) {\r\n    prop.ctx = ctx;\r\n    prop.datapath = path;\r\n    prop.dataref = obj;\r\n\r\n    let newprop = getTempProp(prop.type);\r\n    prop.copyTo(newprop);\r\n\r\n    dpath.propGetter.call(prop, newprop);\r\n    prop.ctx = prop.datapath = prop.dataref = undefined;\r\n\r\n    return newprop;\r\n  }\r\n\r\n  /**\r\n   get meta information for a datapath.\r\n\r\n   @param ignoreExistence: don't try to get actual data associated with path,\r\n    just want meta information\r\n   */\r\n  resolvePath_intern(ctx, inpath, ignoreExistence = false, p = pathParser, dstruct = undefined) {\r\n    inpath = inpath.replace(\"==\", \"=\");\r\n\r\n    p.input(inpath);\r\n\r\n    dstruct = dstruct || this.rootContextStruct;\r\n\r\n    let obj = ctx;\r\n    let lastobj = ctx;\r\n    let subkey;\r\n    let lastobj2 = undefined;\r\n    let lastkey = undefined;\r\n    let prop = undefined;\r\n    let lastdpath = undefined;\r\n\r\n    function p_key() {\r\n      let t = p.peeknext();\r\n      if (t.type === \"NUM\" || t.type === \"STRLIT\") {\r\n        p.next();\r\n        return t.value;\r\n      } else {\r\n        throw new PUTLParseError(\"Expected list key\");\r\n      }\r\n    }\r\n\r\n    let _i = 0;\r\n    while (!p.at_end()) {\r\n      let key = p.expect(\"ID\");\r\n      let dpath = dstruct.pathmap[key];\r\n\r\n      lastdpath = dpath;\r\n\r\n      if (dpath === undefined) {\r\n        if (key === \"length\" && prop !== undefined && prop instanceof DataList) {\r\n          prop.getLength(this, obj);\r\n          key = \"length\";\r\n\r\n          prop = DummyIntProperty;\r\n\r\n          prop.name = \"length\";\r\n          prop.flag = PropFlags.READ_ONLY;\r\n\r\n          dpath = _dummypath;\r\n          dpath.type = DataTypes.PROP;\r\n          dpath.data = prop;\r\n          dpath.struct = dpath.parent = dstruct;\r\n          dpath.flag = DataFlags.READ_ONLY;\r\n          dpath.path = \"length\";\r\n\r\n          /*\r\n          parent: lastobj2,\r\n            obj: lastobj,\r\n            value: obj,\r\n            key: lastkey,\r\n            //*/\r\n        } else if (key === \"active\" && prop !== undefined && prop instanceof DataList) {\r\n          let act = prop.getActive(this, obj);\r\n\r\n          if (act === undefined && !ignoreExistence) {\r\n            throw new DataPathError(\"no active elem ent for list\");\r\n          }\r\n\r\n          let actkey = obj !== undefined && act !== undefined ? prop.getKey(this, obj, act) : undefined;\r\n\r\n          dstruct = prop.getStruct(this, obj, actkey);\r\n          if (dstruct === undefined) {\r\n            throw new DataPathError(\"couldn't get data type for \" + inpath + \"'s element '\" + key + \"'\");\r\n          }\r\n\r\n          _dummypath.parent = dpath;\r\n          dpath = _dummypath;\r\n\r\n          lastobj = obj;\r\n          obj = act;\r\n\r\n          dpath.type = DataTypes.STRUCT;\r\n          dpath.data = dstruct;\r\n          dpath.path = key;\r\n\r\n          p.optional(\"DOT\");\r\n\r\n          continue;\r\n        } else {\r\n          throw new DataPathError(inpath + \": unknown property \" + key);\r\n        }\r\n      }\r\n\r\n      let dynstructobj = undefined;\r\n\r\n      if (dpath.type === DataTypes.STRUCT) {\r\n        dstruct = dpath.data;\r\n      } else if (dpath.type === DataTypes.DYNAMIC_STRUCT) {\r\n        let ok = false;\r\n\r\n        if (obj !== undefined) {\r\n          let obj2;\r\n\r\n          if (dpath.flag & DataFlags.USE_CUSTOM_GETSET) {\r\n            let fakeprop = dpath.getSet;\r\n            fakeprop.ctx = ctx;\r\n            fakeprop.dataref = obj;\r\n            fakeprop.datapath = inpath;\r\n\r\n            obj2 = fakeprop.get();\r\n\r\n            fakeprop.ctx = fakeprop.datapath = fakeprop.dataref = undefined;\r\n          } else {\r\n            obj2 = obj[dpath.path];\r\n          }\r\n\r\n          dynstructobj = obj2;\r\n\r\n          if (obj2 !== undefined) {\r\n            if (CLS_API_KEY_CUSTOM in obj2.constructor) {\r\n              dstruct = obj2.constructor[CLS_API_KEY_CUSTOM](obj2);\r\n            } else {\r\n              dstruct = this.mapStruct(obj2.constructor, false);\r\n            }\r\n          } else {\r\n            dstruct = dpath.data;\r\n          }\r\n\r\n          if (dstruct === undefined) {\r\n            dstruct = dpath.data;\r\n          }\r\n\r\n          ok = dstruct !== undefined;\r\n        }\r\n\r\n        if (!ok) {\r\n          throw new DataPathError(\"dynamic struct error for path: \" + inpath);\r\n        }\r\n      } else {\r\n        prop = dpath.data;\r\n      }\r\n\r\n      if (prop && (dpath.flag & DataFlags.USE_CUSTOM_PROP_GETTER)) {\r\n        prop = this.getPropOverride(ctx, inpath, dpath, obj);\r\n      }\r\n\r\n      if (dpath.path.search(/\\./) >= 0) {\r\n        let keys = dpath.path.split(/\\./);\r\n\r\n        for (let key of keys) {\r\n          lastobj2 = lastobj;\r\n          lastobj = obj;\r\n          lastkey = key;\r\n\r\n          if (obj === undefined && !ignoreExistence) {\r\n            throw new DataPathError(\"no data for \" + inpath);\r\n          } else if (obj !== undefined) {\r\n            obj = obj[key.trim()];\r\n          }\r\n        }\r\n      } else {\r\n        lastobj2 = lastobj;\r\n        lastobj = obj;\r\n\r\n        lastkey = dpath.path;\r\n\r\n        if (dpath.flag & DataFlags.USE_CUSTOM_GETSET) {\r\n          let fakeprop = dpath.getSet;\r\n\r\n          if (!fakeprop && dpath.type === DataTypes.PROP) {\r\n            let prop = dpath.data;\r\n\r\n            prop.ctx = ctx;\r\n            prop.dataref = obj;\r\n            prop.datapath = inpath;\r\n\r\n            try {\r\n              obj = prop.getValue();\r\n            } catch (error) {\r\n              util.print_stack(error);\r\n              obj = undefined;\r\n            }\r\n\r\n            if (typeof obj === \"string\" && (prop.type & (PropTypes.ENUM | PropTypes.FLAG))) {\r\n              obj = prop.values[obj];\r\n            }\r\n\r\n            prop.ctx = prop.dataref = prop.datapath = undefined;\r\n          } else {\r\n            fakeprop.ctx = ctx;\r\n            fakeprop.dataref = obj;\r\n            fakeprop.datapath = inpath;\r\n\r\n            obj = fakeprop.get();\r\n            fakeprop.ctx = fakeprop.datapath = fakeprop.dataref = undefined;\r\n          }\r\n        } else if (obj === undefined && !ignoreExistence) {\r\n          throw new DataPathError(\"no data for \" + inpath);\r\n        } else if (dpath.type === DataTypes.DYNAMIC_STRUCT) {\r\n          obj = dynstructobj;\r\n        } else if (obj !== undefined && dpath.path !== \"\") {\r\n          obj = obj[dpath.path];\r\n        }\r\n      }\r\n\r\n      let t = p.peeknext();\r\n      if (t === undefined) {\r\n        break;\r\n      }\r\n\r\n      if (t.type === \"DOT\") {\r\n        p.next();\r\n      } else if (t.type === \"EQUALS\" && prop !== undefined && (prop.type & (PropTypes.ENUM | PropTypes.FLAG))) {\r\n        p.expect(\"EQUALS\");\r\n\r\n        let t2 = p.peeknext();\r\n        let type = t2 && t2.type === \"ID\" ? \"ID\" : \"NUM\";\r\n\r\n        let val = p.expect(type);\r\n\r\n        let val1 = val;\r\n\r\n        if (typeof val == \"string\") {\r\n          val = prop.values[val];\r\n        }\r\n\r\n        if (val === undefined) {\r\n          throw new DataPathError(\"unknown value \" + val1);\r\n        }\r\n\r\n        if (val in prop.keys) {\r\n          subkey = prop.keys[val];\r\n        }\r\n\r\n        key = dpath.path;\r\n        obj = !!(lastobj[key] == val);\r\n      } else if (t.type === \"AND\" && prop !== undefined && (prop.type & (PropTypes.ENUM | PropTypes.FLAG))) {\r\n        p.expect(\"AND\");\r\n\r\n        let t2 = p.peeknext();\r\n        let type = t2 && t2.type === \"ID\" ? \"ID\" : \"NUM\";\r\n\r\n        let val = p.expect(type);\r\n\r\n        let val1 = val;\r\n\r\n        if (typeof val == \"string\") {\r\n          val = prop.values[val];\r\n        }\r\n\r\n        if (val === undefined) {\r\n          throw new DataPathError(\"unknown value \" + val1);\r\n        }\r\n\r\n        if (val in prop.keys) {\r\n          subkey = prop.keys[val];\r\n        }\r\n\r\n        key = dpath.path;\r\n        obj = !!(lastobj[key] & val);\r\n      } else if (t.type === \"LSBRACKET\" && prop !== undefined && (prop.type & (PropTypes.ENUM | PropTypes.FLAG))) {\r\n        p.expect(\"LSBRACKET\");\r\n\r\n        let t2 = p.peeknext();\r\n        let type = t2 && t2.type === \"ID\" ? \"ID\" : \"NUM\";\r\n\r\n        let val = p.expect(type);\r\n\r\n        let val1 = val;\r\n\r\n        if (typeof val == \"string\") {\r\n          val = prop.values[val];\r\n        }\r\n\r\n        if (val === undefined) {\r\n          console.warn(inpath, prop.values, val1, prop);\r\n          throw new DataPathError(\"unknown value \" + val1);\r\n        }\r\n\r\n        if (val in prop.keys) {\r\n          subkey = prop.keys[val];\r\n        }\r\n\r\n        let bitfield;\r\n        key = dpath.path;\r\n\r\n        if (!(prop.flag & PropFlags.USE_CUSTOM_GETSET)) {\r\n          bitfield = lastobj ? lastobj[key] : 0;\r\n        } else {\r\n          prop.dataref = lastobj;\r\n          prop.datapath = inpath;\r\n          prop.ctx = ctx;\r\n\r\n          try {\r\n            bitfield = prop.getValue();\r\n          } catch (error) {\r\n            util.print_stack(error);\r\n\r\n            bitfield = NaN;\r\n          }\r\n        }\r\n\r\n        if (lastobj === undefined && !ignoreExistence) {\r\n          throw new DataPathError(\"no data for path \" + inpath);\r\n        } else if (lastobj !== undefined) {\r\n          if (prop.type === PropTypes.ENUM) {\r\n            obj = !!(bitfield === val);\r\n          } else {\r\n            obj = !!(bitfield & val);\r\n          }\r\n        }\r\n\r\n        p.expect(\"RSBRACKET\");\r\n      } else if (t.type === \"LSBRACKET\" && prop !== undefined && isVecProperty(prop)) {\r\n        p.expect(\"LSBRACKET\");\r\n        let num = p.expect(\"NUM\");\r\n        p.expect(\"RSBRACKET\");\r\n\r\n        subkey = num;\r\n\r\n        if (prop !== undefined && !(prop.type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4 | PropTypes.QUAT))) {\r\n          lastobj = obj;\r\n        }\r\n\r\n        obj = obj[num];\r\n      } else if (t.type === \"LSBRACKET\") {\r\n        p.expect(\"LSBRACKET\")\r\n\r\n        if (lastobj && lastkey && typeof lastkey === \"string\" && lastkey.length > 0) {\r\n          lastobj = lastobj[lastkey];\r\n        }\r\n\r\n        lastkey = p_key();\r\n        p.expect(\"RSBRACKET\");\r\n\r\n        if (!(prop instanceof DataList)) {\r\n          throw new DataPathError(\"bad property, not a list\");\r\n        }\r\n\r\n        obj = prop.get(this, lastobj, lastkey);\r\n        dstruct = prop.getStruct(this, lastobj, lastkey);\r\n\r\n        if (!dstruct) {\r\n          throw new DataPathError(inpath + \": list has no entry \" + lastkey);\r\n        }\r\n\r\n        if (p.peeknext() !== undefined && p.peeknext().type === \"DOT\") {\r\n          p.next();\r\n        }\r\n      }\r\n\r\n      if (_i++ > 1000) {\r\n        console.warn(\"infinite loop in resolvePath parser\");\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (prop && prop.type & (PropTypes.ENUM|PropFlags.FLAG)) {\r\n      prop.checkMeta()\r\n    }\r\n    \r\n    return {\r\n      dpath  : lastdpath,\r\n      parent : lastobj2,\r\n      obj    : lastobj,\r\n      value  : obj,\r\n      key    : lastkey,\r\n      dstruct: dstruct,\r\n      prop   : prop,\r\n      subkey : subkey\r\n    };\r\n  }\r\n\r\n  _parsePathOverrides(path) {\r\n    let parts = ['', undefined, undefined];\r\n\r\n    const TOOLPATH = 0, NAME = 1, HOTKEY = 2;\r\n    let part = TOOLPATH;\r\n\r\n    for (let i = 0; i < path.length; i++) {\r\n      let c = path[i];\r\n      let n = i < path.length - 1 ? path[i + 1] : \"\";\r\n\r\n      if (c === \"|\") {\r\n        part = NAME;\r\n        parts[NAME] = \"\";\r\n        continue;\r\n      } else if (c === \":\" && n === \":\") {\r\n        part = HOTKEY;\r\n        parts[HOTKEY] = \"\";\r\n        i++;\r\n        continue;\r\n      }\r\n\r\n      parts[part] += c;\r\n    }\r\n\r\n    return {\r\n      path  : parts[TOOLPATH].trim(),\r\n      uiname: parts[NAME] ? parts[NAME].trim() : undefined,\r\n      hotkey: parts[HOTKEY] ? parts[HOTKEY].trim() : undefined,\r\n    };\r\n  }\r\n\r\n  /** Get tooldef for path, applying any modifications, e.g.:\r\n   *  \"app.some_tool()|Label::CustomHotkeyString\"\r\n   * */\r\n  getToolDef(toolpath) {\r\n    let {path, uiname, hotkey} = this._parsePathOverrides(toolpath);\r\n\r\n    let cls = this.parseToolPath(path);\r\n    if (cls === undefined) {\r\n      throw new DataPathError(\"unknown path \\\"\" + path + \"\\\"\");\r\n    }\r\n\r\n    let def = cls.tooldef();\r\n    if (uiname) {\r\n      def.uiname = uiname;\r\n    }\r\n    if (hotkey) {\r\n      def.hotkey = hotkey;\r\n    }\r\n\r\n    return def;\r\n  }\r\n\r\n  getToolPathHotkey(ctx, toolpath) {\r\n    let {path, uiname, hotkey} = this._parsePathOverrides(toolpath);\r\n\r\n    if (hotkey) {\r\n      return hotkey;\r\n    }\r\n\r\n    try {\r\n      return this.#getToolPathHotkey_intern(ctx, path);\r\n    } catch (error) {\r\n      print_stack(error);\r\n      util.console.context(\"api\").log(\"failed to fetch tool path: \" + path);\r\n\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  #getToolPathHotkey_intern(ctx, path) {\r\n    let screen = ctx.screen;\r\n    let this2 = this;\r\n\r\n    function searchKeymap(keymap) {\r\n      if (keymap === undefined) {\r\n        return undefined;\r\n      }\r\n\r\n      let ret;\r\n\r\n      function search(cb) {\r\n        if (ret) {\r\n          return;\r\n        }\r\n\r\n        for (let hk of keymap) {\r\n          if (typeof hk.action === \"string\" && cb(hk.action)) {\r\n            ret = hk.buildString();\r\n          }\r\n        }\r\n      }\r\n\r\n      search((tool) => tool.trim() === path.trim());\r\n      search((tool) => this2._parsePathOverrides(tool).path === path.trim());\r\n\r\n      return ret;\r\n    }\r\n\r\n    if (screen.sareas.length === 0) {\r\n      return searchKeymap(screen.keymap);\r\n    }\r\n\r\n    //client might have its own area subclass with\r\n    //getActiveArea defined (that's encouraged),\r\n    //which is why we don't just call Area.getActiveArea\r\n    let areacls = screen.sareas[0].area.constructor;\r\n    let area = areacls.getActiveArea();\r\n\r\n    if (area) {\r\n      for (let keymap of area.getKeyMaps()) {\r\n        let ret = searchKeymap(keymap);\r\n\r\n        if (ret !== undefined) {\r\n          return ret;\r\n        }\r\n      }\r\n    }\r\n\r\n    //search all other areas\r\n    for (let sarea of screen.sareas) {\r\n      if (!sarea.area) continue;\r\n\r\n      for (let keymap of sarea.area.getKeyMaps()) {\r\n        let ret = searchKeymap(keymap);\r\n\r\n        if (ret) {\r\n          return ret;\r\n        }\r\n      }\r\n    }\r\n\r\n    return this.keymap ? searchKeymap(this.keymap) : false;\r\n  }\r\n\r\n  parseToolPath(path) {\r\n    try {\r\n      return parseToolPath(path).toolclass;\r\n    } catch (error) {\r\n      if (error instanceof DataPathError) {\r\n        console.warn(\"warning, bad tool path \" + path);\r\n        return undefined;\r\n      } else {\r\n        throw error;\r\n      }\r\n    }\r\n  }\r\n\r\n  parseToolArgs(path) {\r\n    return parseToolPath(path).args;\r\n  }\r\n\r\n  createTool(ctx, path, inputs = {}) {\r\n    let cls;\r\n    let args;\r\n\r\n    if (typeof path == \"string\" || path instanceof String) {\r\n      //parseToolPath will raise DataPathError if path is malformed\r\n      let tpath = parseToolPath(path);\r\n\r\n      cls = tpath.toolclass;\r\n      args = tpath.args;\r\n    } else {\r\n      cls = path;\r\n      args = {};\r\n    }\r\n\r\n    if (!cls) {\r\n      debugger;\r\n      console.error(\"Unknown tool \" + path);\r\n    }\r\n\r\n    args = {...args}\r\n\r\n    // feed inputs to invoke\r\n    const tooldef = cls._getFinalToolDef()\r\n    if (inputs !== undefined) {\r\n      for (let k in inputs) {\r\n        if (!(k in tooldef.inputs)) {\r\n          console.warn(cls.tooldef().uiname + \": Unknown tool property \\\"\" + k + \"\\\"\");\r\n          continue;\r\n        }\r\n\r\n        if (!(k in args)) {\r\n          args[k] = inputs[k]\r\n        }\r\n      }\r\n    }\r\n\r\n    let tool = cls.invoke(ctx, args);\r\n\r\n    if (inputs !== undefined) {\r\n      for (let k in inputs) {\r\n        if (!(k in tool.inputs)) {\r\n          console.warn(cls.tooldef().uiname + \": Unknown tool property \\\"\" + k + \"\\\"\");\r\n          continue;\r\n        }\r\n\r\n        tool.inputs[k].setValue(inputs[k]);\r\n      }\r\n    }\r\n\r\n    return tool;\r\n  }\r\n}\r\n\r\nexport function initSimpleController() {\r\n  initToolPaths();\r\n}\r\n\r\nimport {DataPathSetOp} from \"./controller_ops.js\";\r\nimport {Curve1DProperty} from '../curve/curve1d_toolprop.js';\r\nimport { EnumProperty, FlagProperty } from '../controller.js';\r\n\r\nlet dpt = DataPathSetOp;\r\n\r\nexport function getDataPathToolOp() {\r\n  return dpt;\r\n}\r\n\r\nexport function setDataPathToolOp(cls) {\r\n  ToolOp.unregister(DataPathSetOp);\r\n\r\n  if (!ToolOp.isRegistered(cls)) {\r\n    ToolOp.register(cls);\r\n  }\r\n\r\n  dpt = cls;\r\n}\r\n\r\nsetImplementationClass(DataAPI);\r\n","import {CSSFont} from './ui_theme.js';\r\n\r\nexport const DefaultTheme = {\r\n  base: {\r\n    AreaHeaderBG        : 'rgba(200, 200, 200, 0.95)',\r\n    BasePackFlag        : 0,\r\n    BoxDepressed        : 'rgba(130,130,130, 1)',\r\n    BoxHighlight        : 'rgba(151,208,239, 1)',\r\n    \"flex-grow\"         : \"unset\",\r\n    mobileSizeMultiplier: 1.0,\r\n    DefaultText         : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 14,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n    LabelText           : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 14,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n    TitleText           : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 12,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n    'background-color'  : 'rgba(207,207,207, 0.5)',\r\n    'border-color'      : 'rgba(34,34,34, 1)',\r\n    'border-radius'     : 12.010619764585666,\r\n    'focus-border-width': 2,\r\n    oneAxisPadding      : 2,\r\n    padding             : 1,\r\n  },\r\n\r\n  button: {\r\n    DefaultText        : new CSSFont({\r\n      font   : 'poppins',\r\n      weight : 'bold',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 12,\r\n      color  : 'rgba(35,35,35, 1)'\r\n    }),\r\n    'background-color' : 'rgba(238,238,238, 0.8672412740773168)',\r\n    'border-color'     : 'rgba(255,255,255, 1)',\r\n    'border-radius'    : 4,\r\n    'border-style'     : 'solid',\r\n    'border-width'     : 2,\r\n    disabled           : {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgb(109,109,109)'\r\n      }),\r\n      'background-color': 'rgb(19,19,19)',\r\n      'border-color'    : '#f58f8f',\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 1,\r\n    },\r\n    height             : 25,\r\n    highlight          : {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgba(255,255,255, 1)'\r\n      }),\r\n      'background-color': 'rgba(138,222,255, 1)',\r\n      'border-color'    : 'rgba(255,255,255, 1)',\r\n      'border-radius'   : 4,\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 2,\r\n    },\r\n    'highlight-pressed': {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgba(35,35,35, 1)'\r\n      }),\r\n      'background-color': 'rgba(113,113,113, 1)',\r\n      'border-color'    : '#DADCE0',\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 1,\r\n    },\r\n    margin             : 4,\r\n    'margin-left'      : 4,\r\n    'margin-right'     : 4,\r\n    padding            : 1,\r\n    pressed            : {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgba(35,35,35, 1)'\r\n      }),\r\n      'background-color': 'rgba(113,113,113, 1)',\r\n      'border-color'    : '#DADCE0',\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 1,\r\n    },\r\n    width              : 25,\r\n  },\r\n\r\n  checkbox: {\r\n    CheckSide         : 'left',\r\n    height            : 32,\r\n    width             : 32,\r\n    \"background-color\": \"rgb(168,168,168)\",\r\n  },\r\n\r\n  colorfield: {\r\n    circleSize    : 11,\r\n    colorBoxHeight: 24,\r\n    fieldSize     : 400,\r\n    height        : 256,\r\n    hueHeight     : 32,\r\n    width         : 256,\r\n  },\r\n\r\n  colorpickerbutton: {\r\n    height: 32,\r\n    width : 95,\r\n  },\r\n\r\n  curvewidget: {\r\n    CanvasBG    : 'rgb(44,44,44)',\r\n    CanvasHeight: 256,\r\n    CanvasWidth : 256,\r\n  },\r\n\r\n  dropbox: {\r\n    dropTextBG: 'rgba(233,233,233, 1)',\r\n    height    : 25,\r\n    width     : 32,\r\n  },\r\n\r\n  iconbutton: {\r\n    highlight: {\r\n      'background-color': 'rgba(133,182,255,0.8)',\r\n      'border-color'    : 'black',\r\n      'border-radius'   : 5,\r\n      'border-width'    : 1,\r\n      height            : 32,\r\n      'margin-bottom'   : 1,\r\n      'margin-left'     : 2,\r\n      'margin-right'    : 2,\r\n      'margin-top'      : 1,\r\n      padding           : 2,\r\n      width             : 32,\r\n    },\r\n    depressed: {\r\n      'background-color': 'rgba(42,61,77,0.8)',\r\n      'border-color'    : 'black',\r\n      'border-radius'   : 5,\r\n      'border-width'    : 1,\r\n      height            : 32,\r\n      'margin-bottom'   : 1,\r\n      'margin-left'     : 2,\r\n      'margin-right'    : 2,\r\n      'margin-top'      : 1,\r\n      padding           : 2,\r\n      width             : 32,\r\n    },\r\n\r\n    'background-color': 'rgba(15,15,15, 0)',\r\n    'border-color'    : 'black',\r\n    'border-radius'   : 5,\r\n    'border-width'    : 1,\r\n    height            : 32,\r\n    'margin-bottom'   : 1,\r\n    'margin-left'     : 2,\r\n    'margin-right'    : 2,\r\n    'margin-top'      : 1,\r\n    padding           : 2,\r\n    width             : 32,\r\n  },\r\n\r\n  iconcheck: {\r\n    highlight         : {\r\n      'background-color': 'rgba(133,182,255,0.8)',\r\n      'border-color'    : 'black',\r\n      'border-radius'   : 5,\r\n      'border-width'    : 1,\r\n      height            : 32,\r\n      'margin-bottom'   : 1,\r\n      'margin-left'     : 2,\r\n      'margin-right'    : 2,\r\n      'margin-top'      : 1,\r\n      padding           : 2,\r\n      width             : 32,\r\n    },\r\n    depressed         : {\r\n      'background-color': 'rgba(42,61,77,0.8)',\r\n      'border-color'    : 'black',\r\n      'border-radius'   : 5,\r\n      'border-width'    : 1,\r\n      height            : 32,\r\n      'margin-bottom'   : 1,\r\n      'margin-left'     : 2,\r\n      'margin-right'    : 2,\r\n      'margin-top'      : 1,\r\n      padding           : 2,\r\n      width             : 32,\r\n    },\r\n    'background-color': 'rgba(15,15,15, 0)',\r\n    'border-color'    : 'rgba(237,209,209, 1)',\r\n    'border-radius'   : 5,\r\n    'border-width'    : 0,\r\n    drawCheck         : true,\r\n    height            : 32,\r\n    'margin-bottom'   : 1,\r\n    'margin-left'     : 2,\r\n    'margin-right'    : 2,\r\n    'margin-top'      : 1,\r\n    padding           : 2,\r\n    width             : 32,\r\n  },\r\n\r\n  label: {\r\n    LabelText: new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 14,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n  },\r\n\r\n  listbox: {\r\n    ListActive   : 'rgba(200, 205, 215, 1.0)',\r\n    ListHighlight: 'rgba(155, 220, 255, 0.5)',\r\n    height       : 200,\r\n    width        : 110,\r\n  },\r\n\r\n  menu: {\r\n    MenuBG          : 'rgba(250, 250, 250, 1.0)',\r\n    \"item-radius\"   : 0,\r\n    MenuBorder      : '1px solid grey',\r\n    MenuHighlight   : 'rgba(155, 220, 255, 1.0)',\r\n    MenuSeparator   : {\r\n      width             : \"100%\",\r\n      height            : 2,\r\n      padding           : 0,\r\n      margin            : 0,\r\n      border            : \"none\",\r\n      \"background-color\": \"grey\"\r\n    },\r\n    'box-shadow'    : '5px 5px 25px rgba(0,0,0,0.75)',\r\n    MenuSpacing     : 5,\r\n    MenuText        : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 12,\r\n      color  : 'rgba(25, 25, 25, 1.0)'\r\n    }),\r\n    \"padding-top\"   : 0,\r\n    \"padding-left\"  : 0,\r\n    \"padding-right\" : 0,\r\n    \"padding-bottom\": 0,\r\n    'border-color'  : 'grey',\r\n    'border-radius' : 5,\r\n    'border-style'  : 'solid',\r\n    'border-width'  : 1,\r\n  },\r\n\r\n  notification: {\r\n    DefaultText       : new CSSFont({\r\n      font   : 'poppins',\r\n      weight : 'bold',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 12,\r\n      color  : 'rgb(55,55,55)'\r\n    }),\r\n    \"background-color\": \"rgba(72,72,72,0)\",\r\n    \"border-radius\"   : 5,\r\n    \"border-color\"    : \"grey\",\r\n    \"border-width\"    : 1,\r\n    \"border-style\"    : \"solid\",\r\n    ProgressBarBG     : \"rgb(74,148,183)\",\r\n    ProgressBar       : \"rgb(250,132,58)\",\r\n  },\r\n\r\n  numslider: {\r\n    'arrow-color'     : '50%',\r\n    'background-color': 'rgba(219,219,219, 1)',\r\n    'border-color'    : 'rgba(255,255,255, 1)',\r\n    'border-radius'   : 1,\r\n    height            : 22,\r\n    highlight         : {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgb(0,0,0)'\r\n      }),\r\n      'background-color': 'rgba(151,208,239, 1)',\r\n      'border-color'    : 'rgba(255,255,255, 1)',\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 1,\r\n    },\r\n    pressed           : {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgba(0,0,0, 1)'\r\n      }),\r\n      'arrow-color'     : 'rgb(28,28,28)',\r\n      'background-color': 'rgba(178,178,178, 1)',\r\n      'border-color'    : 'rgba(255,255,255, 1)',\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 1,\r\n    },\r\n    width             : 115,\r\n    /*\r\n    'highlight-pressed'            : {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgb(245,245,245)'\r\n      }),\r\n      'background-color': 'rgb(126,126,126)',\r\n      'border-color'    : '#DADCE0',\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 1,\r\n    },*/\r\n  },\r\n\r\n  numslider_simple: {\r\n    SlideHeight       : 10,\r\n    TextBoxWidth      : 45,\r\n    'background-color': 'rgba(219,219,219, 1)',\r\n    height            : 18,\r\n    labelOnTop        : true,\r\n    addLabel          : true,\r\n    width             : 135,\r\n  },\r\n\r\n  numslider_textbox: {\r\n    TextBoxHeight     : 25,\r\n    TextBoxWidth      : 50,\r\n    'background-color': 'rgba(219,219,219, 1)',\r\n    height            : 25,\r\n    labelOnTop        : true,\r\n    addLabel          : false,\r\n    width             : 120,\r\n  },\r\n\r\n  panel: {\r\n    HeaderBorderRadius    : 5.329650280441558,\r\n    HeaderRadius          : 4,\r\n    TitleBackground       : 'rgba(177,219,255, 1)',\r\n    TitleBorder           : 'rgba(104,104,104, 1)',\r\n    TitleText             : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 14,\r\n      color  : 'rgba(0,0,0, 1)'\r\n    }),\r\n    'background-color'    : 'rgba(184,184,184, 0.7594818376068376)',\r\n    'border-color'        : 'rgba(0,0,0, 0.5598061397157866)',\r\n    'border-radius'       : 4,\r\n    'border-style'        : 'groove',\r\n    'border-width'        : 1.141,\r\n    'margin-bottom'       : 0,\r\n    'margin-bottom-closed': 0,\r\n    'margin-left'         : 5.6584810220495445,\r\n    'margin-right'        : 0,\r\n    'margin-top'          : 0,\r\n    'margin-top-closed'   : 0,\r\n    'padding-bottom'      : 0,\r\n    'padding-left'        : 0,\r\n    'padding-right'       : 0,\r\n    'padding-top'         : 0,\r\n  },\r\n\r\n  richtext: {\r\n    DefaultText       : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 16,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n    'background-color': 'rgb(245, 245, 245)',\r\n  },\r\n\r\n  screenborder: {\r\n    'border-inner'   : 'grey',\r\n    'border-outer'   : 'rgba(228,228,228, 1)',\r\n    'border-width'   : 2,\r\n    'mouse-threshold': 8,\r\n  },\r\n\r\n  scrollbars: {\r\n    border  : undefined,\r\n    color   : undefined,\r\n    color2  : undefined,\r\n    contrast: undefined,\r\n    width   : undefined,\r\n  },\r\n\r\n  sidebar: {\r\n    'background-color': 'rgba(55, 55, 55, 0.5)',\r\n  },\r\n\r\n  strip: {\r\n    'background-color': 'rgba(75,75,75, 0.33213141025641024)',\r\n    'border-color'    : 'rgba(0,0,0, 0.31325409987877156)',\r\n    'border-radius'   : 8.76503417507447,\r\n    'border-style'    : 'solid',\r\n    'border-width'    : 1,\r\n    margin            : 2,\r\n    oneAxisPadding    : 2,\r\n    padding           : 1,\r\n    \"flex-grow\"       : \"unset\",\r\n  },\r\n\r\n  tabs: {\r\n    \"focus-on-tab-click\": \"false\",\r\n    \"movable-tabs\"      : \"true\",\r\n    TabPadding_mobile   : 20, //padding perpindicular to the label text\r\n    TabPadding          : 0,\r\n    TabActive           : 'rgba(212,212,212, 1)',\r\n    TabBarRadius        : 6,\r\n    TabHighlight        : 'rgba(50, 50, 50, 0.2)',\r\n    TabInactive         : 'rgba(183,183,183, 1)',\r\n    TabStrokeStyle1     : 'rgba(0,0,0, 1)',\r\n    TabStrokeStyle2     : 'rgba(0,0,0, 1)',\r\n    TabText             : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'bold',\r\n      style  : 'normal',\r\n      size   : 15,\r\n      color  : 'rgba(0,0,0, 1)'\r\n    }),\r\n    'background-color'  : 'rgba(222,222,222, 1)',\r\n  },\r\n\r\n  textbox: {\r\n    DefaultText       : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 14,\r\n      color  : 'rgba(3,3,3, 1)'\r\n    }),\r\n    'border-color'    : \"rgba(0,0,0,0)\",\r\n    'border-width'    : 1,\r\n    \"border-radius\"   : 4,\r\n    \"border-style\"    : \"solid\",\r\n    'background-color': 'rgba(245,245,245, 1)',\r\n  },\r\n\r\n  tooltip: {\r\n    ToolTipText       : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'bold',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 12,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n    'background-color': 'rgba(255,255,255, 1)',\r\n    'border-color'    : 'rgba(139,139,139, 1)',\r\n    'border-radius'   : 3,\r\n    'border-style'    : 'solid',\r\n    'border-width'    : 1,\r\n    padding           : 5,\r\n  },\r\n\r\n  treeview: {\r\n    itemIndent: 10,\r\n    rowHeight : 18,\r\n  },\r\n\r\n  vecPopupButton: {\r\n    height : 18,\r\n    padding: 3,\r\n    width  : 100,\r\n  },\r\n\r\n};\r\n","\"use strict\";\r\n\r\n/*\r\nIcons are defined in spritesheets that live in\r\nthe iconsheet16/32 dom nodes.  Icons are numbered start from\r\nthe upper left sprite tile.\r\n\r\nThis function sets the mapping between icon numbers and names.\r\n\r\nThe following icons should be in the icon sheet and in this map:\r\n\r\nRESIZE      :\r\nSMALL_PLUS  :\r\nTRANSLATE   : for moving things\r\nUI_EXPAND   : panel open icon\r\nUI_COLLAPSE : panel close icon\r\nNOTE_EXCL   : exclamation mark for notifications\r\nHELP        : help symbol\r\n*/\r\nexport function setIconMap(icons) {\r\n  for (let k in icons) {\r\n    Icons[k] = icons[k];\r\n  }\r\n}\r\n\r\nlet a = 0;\r\nexport let Icons = {\r\n  FOLDER: a++,\r\n  FILE  : a++,\r\n  TINY_X: a++,\r\n\r\n  SMALL_PLUS : a++,\r\n  SMALL_MINUS: a++,\r\n  UNDO       : a++,\r\n\r\n  REDO: a++,\r\n  HELP: a++,\r\n\r\n  UNCHECKED   : a++,\r\n  CHECKED     : a++,\r\n  LARGE_CHECK : a++,\r\n  CURSOR_ARROW: a++,\r\n  NOTE_EXCL   : a++,\r\n  SCROLL_DOWN : a++,\r\n  SCROLL_UP   : a++,\r\n  BACKSPACE   : a++,\r\n  LEFT_ARROW  : a++,\r\n  RIGHT_ARROW : a++,\r\n  UI_EXPAND   : a++, //triangle\r\n  UI_COLLAPSE : a++, //triangle\r\n\r\n\r\n  BOLD         : a++,\r\n  ITALIC       : a++,\r\n  UNDERLINE    : a++,\r\n  STRIKETHRU   : a++,\r\n  TREE_EXPAND  : a++,\r\n  TREE_COLLAPSE: a++,\r\n  ZOOM_OUT     : a++,\r\n  ZOOM_IN      : a++,\r\n  LARGE_X      : a++, /* Used for curve widget delete button. */\r\n};\r\n/* used for icon checkboxes with overlayed check marks */\r\nIcons.ENUM_CHECKED = Icons.CHECKED;\r\nIcons.ENUM_UNCHECKED = Icons.UNCHECKED;\r\n\r\n\r\n","let exclude = new Set([\r\n  \"toString\", \"constructor\", \"prototype\", \"__proto__\", \"toLocaleString\",\r\n  \"hasOwnProperty\", \"shadow\"\r\n]);\r\n\r\nlet UIBase = undefined;\r\n\r\n//deal with circular module refrence\r\nexport function _setUIBase(uibase) {\r\n  UIBase = uibase;\r\n}\r\n\r\nlet AspectKeys = Symbol(\"aspect-keys\");\r\n\r\nexport function initAspectClass(object, blacklist = new Set()) {\r\n  let cls = object.constructor;\r\n\r\n  if (!cls[AspectKeys]) {\r\n    cls[AspectKeys] = [];\r\n    let keys = [];\r\n\r\n    let p = object.__proto__;\r\n    while (p) {\r\n      keys = keys.concat(Reflect.ownKeys(p));\r\n      p = p.__proto__;\r\n    }\r\n    keys = new Set(keys);\r\n\r\n    function validProperty(obj, key) {\r\n      let descr = Object.getOwnPropertyDescriptor(obj, key);\r\n\r\n      if (descr && (descr.get || descr.set)) {\r\n        return false;\r\n      }\r\n\r\n      let p = obj.constructor;\r\n      do {\r\n        if (p.prototype) {\r\n          let descr = Object.getOwnPropertyDescriptor(p.prototype, key);\r\n\r\n          if (descr && (descr.set || descr.get)) {\r\n            return false;\r\n          }\r\n        }\r\n\r\n        p = p.__proto__;\r\n      } while (p && p !== p.__proto__);\r\n\r\n      return true;\r\n    }\r\n\r\n    for (let k of keys) {\r\n      let v;\r\n\r\n      if (typeof k === \"string\" && k.startsWith(\"_\")) {\r\n        continue;\r\n      }\r\n\r\n      if (k === \"constructor\") {\r\n        continue;\r\n      }\r\n\r\n      if (blacklist.has(k) || exclude.has(k)) {\r\n        continue;\r\n      }\r\n\r\n      if (!validProperty(object, k)) {\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        v = object[k];\r\n      } catch (error) {\r\n        continue;\r\n      }\r\n\r\n      if (typeof v !== \"function\") {\r\n        continue;\r\n      }\r\n\r\n      cls[AspectKeys].push(k);\r\n    }\r\n  }\r\n\r\n  object.__aspect_methods = new Set();\r\n\r\n  for (let k of cls[AspectKeys]) {\r\n    AfterAspect.bind(object, k);\r\n  }\r\n}\r\n\r\nexport function clearAspectCallbacks(obj) {\r\n  for (let key of obj.__aspect_methods) {\r\n    obj[key].clear();\r\n  }\r\n}\r\n\r\n/**\r\n *\r\n * example:\r\n *\r\n * someobject.update.after(() => {\r\n *   do_something();\r\n *   return someobject.update.value;\r\n * }\r\n *\r\n * */\r\nexport class AfterAspect {\r\n  constructor(owner, key) {\r\n    this.owner = owner;\r\n    this.key = key;\r\n\r\n    this.chain = [[owner[key], false]];\r\n    this.chain2 = [[owner[key], false]];\r\n\r\n    this.root = [[owner[key], false]];\r\n\r\n    let this2 = this;\r\n\r\n    let method = this._method = function () {\r\n      let chain = this2.chain;\r\n      let chain2 = this2.chain2;\r\n\r\n      chain2.length = chain.length;\r\n\r\n      for (let i = 0; i < chain.length; i++) {\r\n        chain2[i] = chain[i];\r\n      }\r\n\r\n      for (let i = 0; i < chain2.length; i++) {\r\n        let [cb, node, once] = chain2[i];\r\n\r\n        if (node) {\r\n          let isDead = !node.isConnected;\r\n\r\n          if (node instanceof UIBase) {\r\n            isDead = isDead || node.isDead();\r\n          }\r\n\r\n          if (isDead) {\r\n            console.warn(\"pruning dead AfterAspect callback\", node);\r\n            chain.remove(chain2[i]);\r\n            continue;\r\n          }\r\n        }\r\n\r\n\r\n        if (once && chain.indexOf(chain2[i]) >= 0) {\r\n          chain.remove(chain2[i]);\r\n        }\r\n\r\n        if (cb && cb.apply) {\r\n          method.value = cb.apply(this, arguments);\r\n          //method.value = Reflect.apply(cb, this, arguments);\r\n          //cb.apply(this, args);\r\n        }\r\n      }\r\n\r\n      let ret = method.value;\r\n      method.value = undefined;\r\n\r\n      return ret;\r\n    };\r\n\r\n    this._method_bound = false;\r\n\r\n    method.after = this.after.bind(this);\r\n    method.once = this.once.bind(this);\r\n    method.remove = this.remove.bind(this);\r\n\r\n    owner[key].after = this.after.bind(this);\r\n    owner[key].once = this.once.bind(this);\r\n    owner[key].remove = this.remove.bind(this);\r\n  }\r\n\r\n  static bind(owner, key) {\r\n    owner.__aspect_methods.add(key);\r\n\r\n    return new AfterAspect(owner, key);\r\n  }\r\n\r\n  remove(cb) {\r\n    for (let item of this.chain) {\r\n      if (item[0] === cb) {\r\n        this.chain.remove(item);\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  once(cb, node) {\r\n    return this.after(cb, node, true);\r\n  }\r\n\r\n  _checkbind() {\r\n    if (!this._method_bound) {\r\n      this.owner[this.key] = this._method;\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this._checkbind();\r\n    this.chain = [[this.root[0][0], this.root[0][1]]];\r\n    this.chain2 = [[this.root[0][0], this.root[0][1]]];\r\n\r\n    return this;\r\n  }\r\n\r\n  before(cb, node, once) {\r\n    this._checkbind();\r\n\r\n    if (cb === undefined) {\r\n      console.warn(\"invalid call to .after(); cb was undefined\");\r\n      return this.owner;\r\n    }\r\n    this.chain = [[cb, node, once]].concat(this.chain);\r\n    return this.owner;\r\n  }\r\n\r\n  after(cb, node, once) {\r\n    this._checkbind();\r\n\r\n    if (cb === undefined) {\r\n      console.warn(\"invalid call to .after(); cb was undefined\");\r\n      return this.owner;\r\n    }\r\n    this.chain.push([cb, node, once]);\r\n    return this.owner;\r\n  }\r\n}\r\n","import {contextWrangler} from '../screen/area_wrangler.js';\r\n\r\nlet _ui_base = undefined;\r\n\r\n//avoid circular module references\r\nlet TextBox = undefined;\r\n\r\nexport function _setTextboxClass(cls) {\r\n  TextBox = cls;\r\n}\r\n\r\n//import * as ui_save from './ui_save.js';\r\n\r\n/*\r\nif (window.document && document.body) {\r\n  console.log(\"ensuring body.style.margin/padding are zero\");\r\n  document.body.style[\"margin\"] = \"0px\";\r\n  document.body.style[\"padding\"] = \"0px\";\r\n}\r\n */\r\n\r\nimport {Animator} from \"./anim.js\";\r\nimport './units.js';\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as math from '../path-controller/util/math.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport {\r\n  pushModalLight, popModalLight, copyEvent, pathDebugEvent,\r\n  haveModal, keymap, reverse_keymap, pushPointerModal\r\n} from '../path-controller/util/simple_events.js';\r\nimport {getDataPathToolOp} from '../path-controller/controller/controller.js';\r\nimport * as units from './units.js';\r\nimport {rgb_to_hsv, hsv_to_rgb} from \"../util/colorutils.js\";\r\n\r\nexport * from './ui_theme.js';\r\n\r\nimport {CSSFont, theme, parsepx, compatMap} from \"./ui_theme.js\";\r\n\r\nimport {DefaultTheme} from './theme.js';\r\n\r\n//global list of elements to, hopefully, prevent minification tree shaking\r\n//of live elements\r\nexport let ElementClasses = [];\r\n\r\nexport {theme} from \"./ui_theme.js\";\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nwindow.__cconst = cconst;\r\n\r\nlet Vector4 = vectormath.Vector4;\r\n\r\nexport {Icons} from '../icon_enum.js';\r\nimport {Icons} from '../icon_enum.js';\r\n\r\nexport {setIconMap} from '../icon_enum.js';\r\nimport {setIconMap} from '../icon_enum.js';\r\n\r\nimport {AfterAspect, initAspectClass} from \"./aspect.js\";\r\nimport * as aspect from './aspect.js';\r\n\r\nconst EnumProperty = toolprop.EnumProperty;\r\n\r\nlet Area;\r\nexport let _setAreaClass = (cls) => {\r\n  Area = cls;\r\n}\r\n\r\nexport const ErrorColors = {\r\n  WARNING: \"yellow\",\r\n  ERROR  : \"red\",\r\n  OK     : \"green\"\r\n};\r\n\r\nwindow.__theme = theme;\r\n\r\nlet registered_has_happened = false;\r\nlet tagPrefix = \"\";\r\nconst EventCBSymbol = Symbol(\"wrapped event callback\");\r\n\r\nfunction calcElemCBKey(elem, type, options) {\r\n  return elem._id + \":\" + type + \":\" + JSON.stringify(options || {});\r\n}\r\n\r\n/**\r\n * Sets tag prefix for pathux html elements.\r\n * Must be called prior to loading other modules.\r\n * Since this is tricky, you can alternatively\r\n * add a script tag with the prefix with the id \"pathux-tag-prefix\",\r\n * e.g.<pre> <script type=\"text/plain\" id=\"pathux-tag-prefix\">prefix</script> </pre>\r\n * */\r\nexport function setTagPrefix(prefix) {\r\n  if (registered_has_happened) {\r\n    throw new Error(\"have to call ui_base.setTagPrefix before loading any other path.ux modules\");\r\n  }\r\n\r\n  tagPrefix = \"\" + prefix;\r\n}\r\n\r\nexport function getTagPrefix(prefix) {\r\n  return tagPrefix;\r\n}\r\n\r\nif (typeof document !== 'undefined') {\r\n  let prefix = document.getElementById(\"pathux-tag-prefix\");\r\n  if (prefix) {\r\n    console.log(\"Found pathux-tag-prefix element\");\r\n    prefix = prefix.innerText.trim();\r\n    setTagPrefix(prefix);\r\n  }\r\n}\r\n\r\nimport {ClassIdSymbol} from './ui_consts.js';\r\n\r\nexport {ClassIdSymbol};\r\n\r\nlet class_idgen = 1;\r\n\r\nexport function setTheme(theme2) {\r\n  //merge theme\r\n  for (let k in theme2) {\r\n    let v = theme2[k];\r\n\r\n    if (typeof v !== \"object\") {\r\n      theme[k] = v;\r\n      continue;\r\n    }\r\n\r\n    let v0 = theme[k];\r\n\r\n    if (!(k in theme)) {\r\n      theme[k] = {};\r\n    }\r\n\r\n    for (let k2 in v) {\r\n      //if (v0 && !(k2 in v0)) {\r\n      //  continue;\r\n      //}\r\n\r\n      if (k2 in compatMap) {\r\n        let k3 = compatMap[k2];\r\n\r\n        if (v[k3] === undefined) {\r\n          v[k3] = v[k2];\r\n        }\r\n\r\n        delete v[k2];\r\n        k2 = k3;\r\n      }\r\n\r\n      theme[k][k2] = v[k2];\r\n    }\r\n  }\r\n}\r\n\r\nsetTheme(DefaultTheme);\r\n\r\nlet _last_report = util.time_ms();\r\n\r\nexport function report() {\r\n  if (util.time_ms() - _last_report > 350) {\r\n    console.warn(...arguments);\r\n    _last_report = util.time_ms();\r\n  }\r\n}\r\n\r\n//this function is deprecated\r\nexport function getDefault(key, elem) {\r\n  console.warn(\"Deprecated call to ui_base.js:getDefault\");\r\n\r\n  if (key in theme.base) {\r\n    return theme.base[key];\r\n  } else {\r\n    throw new Error(\"Unknown default \" + key);\r\n  }\r\n}\r\n\r\n//XXX implement me!\r\nexport function IsMobile() {\r\n  console.warn(\"ui_base.IsMobile is deprecated; use util.isMobile instead\")\r\n  return util.isMobile();\r\n};\r\n\r\nlet keys = [\"margin\", \"padding\", \"margin-block-start\", \"margin-block-end\"];\r\nkeys = keys.concat([\"padding-block-start\", \"padding-block-end\"]);\r\n\r\nkeys = keys.concat([\"margin-left\", \"margin-top\", \"margin-bottom\", \"margin-right\"]);\r\nkeys = keys.concat([\"padding-left\", \"padding-top\", \"padding-bottom\", \"padding-right\"]);\r\nexport const marginPaddingCSSKeys = keys;\r\n\r\n\r\nclass _IconManager {\r\n  constructor(image, tilesize, number_of_horizontal_tiles, drawsize) {\r\n    this.tilex = number_of_horizontal_tiles;\r\n    this.tilesize = tilesize;\r\n    this.drawsize = drawsize;\r\n\r\n    this.customIcons = new Map();\r\n\r\n    this.image = image;\r\n    this.promise = undefined;\r\n    this._accept = undefined;\r\n    this._reject = undefined;\r\n  }\r\n\r\n  get ready() {\r\n    return this.image && this.image.width;\r\n  }\r\n\r\n  onReady() {\r\n    if (this.ready) {\r\n      return new Promise((accept, reject) => {\r\n        accept(this);\r\n      });\r\n    }\r\n\r\n    if (this.promise) {\r\n      return this.promise;\r\n    }\r\n\r\n    let onload = this.image.onload;\r\n    this.image.onload = (e) => {\r\n      if (onload) {\r\n        onload.call(this.image, e);\r\n      }\r\n\r\n      if (!this._accept) {\r\n        return;\r\n      }\r\n\r\n      let accept = this._accept;\r\n      this._accept = this._reject = this.promise = undefined;\r\n\r\n      if (this.image.width) {\r\n        accept(this);\r\n      }\r\n    }\r\n\r\n    this.promise = new util.TimeoutPromise((accept, reject) => {\r\n      this._accept = accept;\r\n      this._reject = reject;\r\n    }, 15000, true); /* silently rejects on timeout */\r\n\r\n    this.promise.catch(error => {\r\n      util.print_stack(error);\r\n      this.promise = this._accept = this._reject = undefined;\r\n    });\r\n\r\n    return this.promise;\r\n  }\r\n\r\n  canvasDraw(elem, canvas, g, icon, x = 0, y = 0) {\r\n    let customIcon = this.customIcons.get(icon);\r\n\r\n    if (customIcon) {\r\n      g.drawImage(customIcon.canvas, x, y);\r\n      return;\r\n    }\r\n\r\n    let tx = icon%this.tilex;\r\n    let ty = ~~(icon/this.tilex);\r\n\r\n    let dpi = elem.getDPI();\r\n    let ts = this.tilesize;\r\n    let ds = this.drawsize;\r\n\r\n    if (!this.image) {\r\n      //console.warn(\"Failed to render an iconsheet\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      g.drawImage(this.image, tx*ts, ty*ts, ts, ts, x, y, ds*dpi, ds*dpi);\r\n    } catch (error) {\r\n      console.log(this.image);\r\n      console.error(error.stack);\r\n      console.error(error.message);\r\n      console.error(\"failed to draw an icon\");\r\n    }\r\n  }\r\n\r\n  setCSS(icon, dom, fitsize = undefined) {\r\n    if (!fitsize) {\r\n      fitsize = this.drawsize;\r\n    }\r\n\r\n    if (typeof fitsize === \"object\") {\r\n      fitsize = Math.max(fitsize[0], fitsize[1]);\r\n    }\r\n\r\n    dom.style[\"background\"] = this.getCSS(icon, fitsize);\r\n    if (this.customIcons.has(icon)) {\r\n      dom.style[\"background-size\"] = (fitsize) + \"px\";\r\n    } else {\r\n      dom.style[\"background-size\"] = (fitsize*this.tilex) + \"px\";\r\n    }\r\n\r\n    dom.style[\"background-clip\"] = \"content-box\";\r\n\r\n    if (!dom.style[\"width\"]) {\r\n      dom.style[\"width\"] = this.drawsize + \"px\";\r\n    }\r\n    if (!dom.style[\"height\"]) {\r\n      dom.style[\"height\"] = this.drawsize + \"px\";\r\n    }\r\n  }\r\n\r\n  //icon is an integer\r\n  getCSS(icon, fitsize = this.drawsize) {\r\n    if (icon === -1) { //-1 means no icon\r\n      return '';\r\n    }\r\n\r\n    if (typeof fitsize === \"object\") {\r\n      fitsize = Math.max(fitsize[0], fitsize[1]);\r\n    }\r\n\r\n    let ratio = fitsize/this.tilesize;\r\n\r\n    let customIcon = this.customIcons.get(icon);\r\n    if (customIcon !== undefined) {\r\n      //ratio = fitsize / this.drawsize;\r\n      //let d = this.drawsize*0.25;\r\n      let d = 0.0;\r\n\r\n      let css = `url(\"${customIcon.blobUrl}\")`;\r\n\r\n      return css;\r\n    }\r\n\r\n    let x = (-(icon%this.tilex)*this.tilesize)*ratio;\r\n    let y = (-(~~(icon/this.tilex))*this.tilesize)*ratio;\r\n\r\n    //x = ~~x;\r\n    //y = ~~y;\r\n\r\n    //console.log(this.tilesize, this.drawsize, x, y);\r\n    //let ts = this.tilesize;\r\n    //return `image('${this.image.src}#xywh=${x},${y},${ts},${ts}')`;\r\n    return `url(\"${this.image.src}\") ${x}px ${y}px`;\r\n  }\r\n}\r\n\r\nexport class CustomIcon {\r\n  constructor(manager, key, id, baseImage) {\r\n    this.key = key;\r\n    this.baseImage = baseImage;\r\n    this.images = []\r\n    this.id = id;\r\n    this.manager = manager;\r\n  }\r\n\r\n  regenIcons() {\r\n    let manager = this.manager;\r\n\r\n    let doSheet = (sheet) => {\r\n      let size = sheet.drawsize;\r\n      let canvas = document.createElement(\"canvas\");\r\n      let g = canvas.getContext(\"2d\");\r\n\r\n      canvas.width = canvas.height = size;\r\n      g.drawImage(this.baseImage, 0, 0, size, size);\r\n\r\n      canvas.toBlob((blob) => {\r\n        let blobUrl = URL.createObjectURL(blob);\r\n\r\n        sheet.customIcons.set(this.id, {\r\n          blobUrl,\r\n          canvas\r\n        });\r\n      })\r\n    }\r\n\r\n    for (let sheet of manager.iconsheets) {\r\n      doSheet(sheet);\r\n    }\r\n  }\r\n}\r\n\r\nexport class IconManager {\r\n  /**\r\n   images is a list of dom ids of img tags\r\n\r\n   sizes is a list of tile sizes, one per image.\r\n   you can control the final *draw* size by passing an array\r\n   of [tilesize, drawsize] instead of just a number.\r\n   */\r\n  constructor(images, sizes, horizontal_tile_count) {\r\n    this.iconsheets = [];\r\n    this.tilex = horizontal_tile_count;\r\n\r\n    this.customIcons = new Map();\r\n    this.customIconIDMap = new Map();\r\n\r\n    for (let i = 0; i < images.length; i++) {\r\n      let size, drawsize;\r\n\r\n      if (typeof sizes[i] == \"object\") {\r\n        size = sizes[i][0], drawsize = sizes[i][1];\r\n      } else {\r\n        size = drawsize = sizes[i];\r\n      }\r\n\r\n      if (util.isMobile()) {\r\n        drawsize = ~~(drawsize*theme.base.mobileSizeMultiplier);\r\n      }\r\n\r\n      this.iconsheets.push(new _IconManager(images[i], size, horizontal_tile_count, drawsize));\r\n    }\r\n  }\r\n\r\n  isReady(sheet = 0) {\r\n    return this.iconsheets[sheet].ready;\r\n  }\r\n\r\n  addCustomIcon(key, image) {\r\n    let icon = this.customIcons.get(key);\r\n\r\n    if (!icon) {\r\n      let maxid = 0;\r\n\r\n      for (let k in Icons) {\r\n        maxid = Math.max(maxid, Icons[k] + 1);\r\n      }\r\n      for (let icon of this.customIcons.values()) {\r\n        maxid = Math.max(maxid, icon.id + 1);\r\n      }\r\n\r\n      maxid = Math.max(maxid, 1000); //just to be on the safe side\r\n\r\n      let id = maxid;\r\n      icon = new CustomIcon(this, key, id, image);\r\n\r\n      this.customIcons.set(key, icon);\r\n      this.customIconIDMap.set(id, icon);\r\n    }\r\n\r\n    icon.baseImage = image;\r\n    icon.regenIcons();\r\n\r\n    return icon.id;\r\n  }\r\n\r\n  load(manager2) {\r\n    this.iconsheets = manager2.iconsheets;\r\n    this.tilex = manager2.tilex;\r\n\r\n    return this;\r\n  }\r\n\r\n  reset(horizontal_tile_count) {\r\n    this.iconsheets.length = 0;\r\n    this.tilex = horizontal_tile_count;\r\n  }\r\n\r\n  add(image, size, drawsize = size) {\r\n    this.iconsheets.push(new _IconManager(image, size, this.tilex, drawsize));\r\n    return this;\r\n  }\r\n\r\n  canvasDraw(elem, canvas, g, icon, x = 0, y = 0, sheet = 0) {\r\n    let base = this.iconsheets[sheet];\r\n\r\n    sheet = this.findSheet(sheet);\r\n    let ds = sheet.drawsize;\r\n\r\n    sheet.drawsize = base.drawsize;\r\n    sheet.canvasDraw(elem, canvas, g, icon, x, y);\r\n    sheet.drawsize = ds;\r\n  }\r\n\r\n  findClosestSheet(size) {\r\n    let sheets = this.iconsheets.concat([]);\r\n\r\n    sheets.sort((a, b) => a.drawsize - b.drawsize);\r\n    let sheet;\r\n\r\n    for (let i = 0; i < sheets.length; i++) {\r\n      if (sheets[i].drawsize <= size) {\r\n        sheet = sheets[i];\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (!sheet)\r\n      sheet = sheets[sheets.length - 1];\r\n\r\n    return this.iconsheets.indexOf(sheet);\r\n  }\r\n\r\n  findSheet(sheet) {\r\n    if (sheet === undefined) {\r\n      console.warn(\"sheet was undefined\");\r\n      sheet = 0;\r\n    }\r\n\r\n    let base = this.iconsheets[sheet];\r\n\r\n    /**sigh**/\r\n    let dpi = UIBase.getDPI();\r\n    let minsheet = undefined;\r\n    let goal = dpi*base.drawsize;\r\n\r\n    for (let sheet of this.iconsheets) {\r\n      minsheet = sheet;\r\n\r\n      if (sheet.drawsize >= goal) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return minsheet === undefined ? base : minsheet;\r\n  }\r\n\r\n  getTileSize(sheet = 0) {\r\n    return this.iconsheets[sheet].drawsize;\r\n    return this.findSheet(sheet).drawsize;\r\n  }\r\n\r\n  getRealSize(sheet = 0) {\r\n    return this.iconsheets[sheet].tilesize;\r\n    return this.findSheet(sheet).tilesize;\r\n    //return this.iconsheets[sheet].tilesize;\r\n  }\r\n\r\n  //icon is an integer\r\n  getCSS(icon, sheet = 0) {\r\n    //return this.iconsheets[sheet].getCSS(icon);\r\n    //return this.findSheet(sheet).getCSS(icon);\r\n\r\n    let base = this.iconsheets[sheet];\r\n    sheet = this.findSheet(sheet);\r\n    let ds = sheet.drawsize;\r\n\r\n    sheet.drawsize = base.drawsize;\r\n    let ret = sheet.getCSS(icon);\r\n    sheet.drawsize = ds;\r\n\r\n    return ret;\r\n  }\r\n\r\n  setCSS(icon, dom, sheet = 0, fitsize = undefined) {\r\n    //return this.iconsheets[sheet].setCSS(icon, dom);\r\n\r\n    let base = this.iconsheets[sheet];\r\n    sheet = this.findSheet(sheet);\r\n    let ds = sheet.drawsize;\r\n\r\n    sheet.drawsize = base.drawsize;\r\n    let ret = sheet.setCSS(icon, dom, fitsize);\r\n    sheet.drawsize = ds;\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nlet iconmanager\r\n\r\nif (typeof document !== 'undefined') {\r\n  iconmanager = new IconManager([\r\n    document.getElementById(\"iconsheet16\"),\r\n    document.getElementById(\"iconsheet32\"),\r\n    document.getElementById(\"iconsheet48\")\r\n  ], [16, 32, 64], 16);\r\n} else {\r\n  iconmanager = new IconManager([])\r\n}\r\n\r\nexport {iconmanager}\r\nwindow._iconmanager = iconmanager; //debug global\r\n\r\n//if client code overrides iconsheets, they must follow logical convention\r\n//that the first one is \"small\" and the second is \"large\"\r\nexport let IconSheets = {\r\n  SMALL : 0,\r\n  LARGE : 1,\r\n  XLARGE: 2\r\n};\r\n\r\nexport function iconSheetFromPackFlag(flag) {\r\n  if (flag & PackFlags.CUSTOM_ICON_SHEET) {\r\n    //console.log(\"Custom Icon Sheet:\", flag>>PackFlags.CUSTOM_ICON_SHEET_START);\r\n    return flag>>PackFlags.CUSTOM_ICON_SHEET_START;\r\n  }\r\n\r\n  if ((flag & PackFlags.SMALL_ICON) && !(PackFlags.LARGE_ICON)) {\r\n    return 0//IconSheets.SMALL; //0\r\n  } else {\r\n    return 1//IconSheets.LARGE; //1\r\n  }\r\n}\r\n\r\nexport function getIconManager() {\r\n  return iconmanager;\r\n}\r\n\r\nexport function setIconManager(manager, IconSheetsOverride) {\r\n  iconmanager.load(manager);\r\n\r\n  if (IconSheetsOverride !== undefined) {\r\n    for (let k in IconSheetsOverride) {\r\n      IconSheets[k] = IconSheetsOverride[k];\r\n    }\r\n  }\r\n}\r\n\r\nexport function makeIconDiv(icon, sheet = 0) {\r\n  let size = iconmanager.getRealSize(sheet);\r\n\r\n  let drawsize = iconmanager.getTileSize(sheet);\r\n\r\n  let icontest = document.createElement(\"div\");\r\n\r\n  icontest.style[\"width\"] = icontest.style[\"min-width\"] = drawsize + \"px\";\r\n  icontest.style[\"height\"] = icontest.style[\"min-height\"] = drawsize + \"px\";\r\n\r\n  //icontest.style[\"background-color\"] = \"orange\";\r\n\r\n  icontest.style[\"margin\"] = \"0px\";\r\n  icontest.style[\"padding\"] = \"0px\";\r\n\r\n  iconmanager.setCSS(icon, icontest, sheet);\r\n\r\n  return icontest;\r\n}\r\n\r\nlet Vector2 = vectormath.Vector2;\r\nlet Matrix4 = vectormath.Matrix4;\r\n\r\nexport let dpistack = [];\r\n\r\nexport const UIFlags = {};\r\n\r\nconst internalElementNames = {};\r\nconst externalElementNames = {};\r\n\r\nexport const PackFlags = {\r\n  INHERIT_WIDTH : 1,\r\n  INHERIT_HEIGHT: 2,\r\n  VERTICAL      : 4,\r\n  USE_ICONS     : 8,\r\n  SMALL_ICON    : 16,\r\n  LARGE_ICON    : 32,\r\n\r\n  FORCE_PROP_LABELS         : 64, //force propeties (Container.prototype.prop()) to always have labels\r\n  PUT_FLAG_CHECKS_IN_COLUMNS: 128, //group flag property checkmarks in columns (doesn't apply to icons)\r\n\r\n  WRAP_CHECKBOXES: 256,\r\n\r\n  //internal flags\r\n  STRIP_HORIZ            : 512,\r\n  STRIP_VERT             : 1024,\r\n  STRIP                  : 512 | 1024,\r\n  SIMPLE_NUMSLIDERS      : 2048,\r\n  FORCE_ROLLER_SLIDER    : 4096,\r\n  HIDE_CHECK_MARKS       : (1<<13),\r\n  NO_NUMSLIDER_TEXTBOX   : (1<<14),\r\n  CUSTOM_ICON_SHEET      : 1<<15,\r\n  CUSTOM_ICON_SHEET_START: 20, //custom icon sheet bits are shifted to here\r\n  NO_UPDATE              : 1<<16,\r\n  LABEL_ON_RIGHT         : 1<<17,\r\n};\r\n\r\nlet first = (iter) => {\r\n  if (iter === undefined) {\r\n    return undefined;\r\n  }\r\n\r\n  if (!(Symbol.iterator in iter)) {\r\n    for (let item in iter) {\r\n      return item;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  for (let item of iter) {\r\n    return item;\r\n  }\r\n}\r\n\r\nimport {DataPathError} from '../path-controller/controller/controller.js';\r\nimport {TimeoutPromise} from '../path-controller/util/util.js';\r\nimport {IntProperty, NumberConstraints, PropFlags} from '../path-controller/toolsys/toolprop.js';\r\nimport {\r\n  DependSocket, EventNode, PropertySocket, PropSocketModes, SocketTypes, theEventGraph\r\n} from '../path-controller/dag/eventdag.js';\r\nimport {isNum} from '../path-controller/util/math.js';\r\n\r\nlet _mobile_theme_patterns = [\r\n  /.*width.*/,\r\n  /.*height.*/,\r\n  /.*size.*/,\r\n  /.*margin.*/,\r\n  /.*pad/,\r\n  /.*radius.*/\r\n];\r\n\r\n\r\nlet _idgen = 0;\r\n\r\nwindow._testSetScrollbars = function (color = \"grey\", contrast = 0.5, width = 15, border = \"solid\") {\r\n  let buf = styleScrollBars(color, undefined, contrast, width, border, \"*\");\r\n  CTX.screen.mergeGlobalCSS(buf);\r\n\r\n  //document.body.style[\"overflow\"] = \"scroll\";\r\n\r\n  /*\r\n  if (!window._tsttag) {\r\n    window._tsttag = document.createElement(\"style\");\r\n    document.body.prepend(_tsttag);\r\n  }\r\n\r\n  _tsttag.textContent = buf;\r\n  //*/\r\n\r\n  return buf;\r\n};\r\n\r\nexport function styleScrollBars(color = \"grey\", color2 = undefined, contrast = 0.5, width = 15,\r\n                                border                                                    = \"1px groove black\", selector = \"*\") {\r\n\r\n  if (!color2) {\r\n    let c = css2color(color);\r\n    let a = c.length > 3 ? c[3] : 1.0;\r\n\r\n    c = rgb_to_hsv(c[0], c[1], c[2]);\r\n    let inv = c.slice(0, c.length);\r\n\r\n    inv[2] = 1.0 - inv[2];\r\n    inv[2] += (c[2] - inv[2])*(1.0 - contrast);\r\n\r\n    inv = hsv_to_rgb(inv[0], inv[1], inv[2]);\r\n\r\n    inv.length = 4;\r\n    inv[3] = a;\r\n\r\n    inv = color2css(inv);\r\n    color2 = inv;\r\n  }\r\n\r\n  let buf = `\r\n\r\n${selector} {\r\n  scrollbar-width : ${width <= 16 ? 'thin' : 'auto'};\r\n  scrollbar-color : ${color2} ${color};\r\n}\r\n\r\n${selector}::-webkit-scrollbar {\r\n  width : ${width}px;\r\n  background-color : ${color};\r\n}\r\n\r\n${selector}::-webkit-scrollbar-track {\r\n  background-color : ${color};\r\n  border : ${border};\r\n}\r\n\r\n${selector}::-webkit-scrollbar-thumb {\r\n  background-color : ${color2};\r\n  border : ${border};\r\n}\r\n    `;\r\n\r\n  //console.log(buf);\r\n  return buf;\r\n}\r\n\r\nwindow.styleScrollBars = styleScrollBars;\r\n\r\nlet _digest = new util.HashDigest();\r\n\r\nexport function calcThemeKey(digest = _digest.reset()) {\r\n  for (let k in theme) {\r\n    let obj = theme[k];\r\n\r\n    if (typeof obj !== \"object\") {\r\n      continue;\r\n    }\r\n\r\n    for (let k2 in obj) {\r\n      let v2 = obj[k2];\r\n\r\n      if (typeof v2 === \"number\" || typeof v2 === \"boolean\" || typeof v2 === \"string\") {\r\n        digest.add(v2);\r\n      } else if (typeof v2 === \"object\" && v2 instanceof CSSFont) {\r\n        v2.calcHashUpdate(digest);\r\n      }\r\n    }\r\n  }\r\n\r\n  return digest.get();\r\n}\r\n\r\nexport var _themeUpdateKey = calcThemeKey();\r\n\r\nexport function flagThemeUpdate() {\r\n  _themeUpdateKey = calcThemeKey();\r\n}\r\n\r\nwindow._flagThemeUpdate = flagThemeUpdate;\r\n\r\nlet setTimeoutQueue = new Set();\r\nlet haveTimeout = false;\r\n\r\nfunction timeout_cb() {\r\n  if (setTimeoutQueue.size === 0) {\r\n    haveTimeout = false;\r\n    return;\r\n  }\r\n\r\n  for (let item of new Set(setTimeoutQueue)) {\r\n    let {cb, timeout, time} = item;\r\n    if (util.time_ms() - time < timeout) {\r\n      continue;\r\n    }\r\n\r\n    setTimeoutQueue.delete(item);\r\n\r\n    try {\r\n      cb();\r\n    } catch (error) {\r\n      console.error(error.stack);\r\n    }\r\n  }\r\n\r\n  window.setTimeout(timeout_cb, 0);\r\n}\r\n\r\nexport function internalSetTimeout(cb, timeout) {\r\n  if (timeout > 100) { //call directly\r\n    window.setTimeout(cb, timeout);\r\n    return;\r\n  }\r\n\r\n  setTimeoutQueue.add({\r\n    cb, timeout, time: util.time_ms()\r\n  });\r\n\r\n  if (!haveTimeout) {\r\n    haveTimeout = true;\r\n    window.setTimeout(timeout_cb, 0);\r\n  }\r\n}\r\n\r\nwindow.setTimeoutQueue = setTimeoutQueue;\r\n\r\nif (typeof HTMLElement === 'undefined') {\r\n  // inside a worker?\r\n  window.HTMLElement = class HTMLElement {}\r\n  window.customElements = {\r\n    define: () => {}\r\n  }\r\n  window.devicePixelRatio = 1.0\r\n  window.PointerEvent = class PointerEvent {}\r\n}\r\n\r\nexport class UIBase extends HTMLElement {\r\n  #reflagGraph = false;\r\n\r\n  static graphNodeDef = EventNode.register(this, {\r\n    typeName: this.name,\r\n    uiName  : this.name,\r\n    inputs  : {\r\n      depend: new DependSocket()\r\n    },\r\n    outputs : {\r\n      depend: new DependSocket()\r\n    }\r\n  })\r\n\r\n  graphExec() {\r\n    let node = this.graphNode;\r\n\r\n    if (node.inputs.depend.isUpdated) {\r\n      node.outputs.depend.flagUpdate();\r\n    }\r\n\r\n    for (let k in node.inputs) {\r\n      let sock = node.inputs[k];\r\n\r\n      if (!(sock instanceof PropertySocket)) {\r\n        continue;\r\n      }\r\n\r\n      let val = sock.value;\r\n      let first = true;\r\n\r\n      for (let sockb of sock.edges) {\r\n        if (first) {\r\n          val = sockb.value;\r\n          first = false;\r\n        } else {\r\n          switch (sock.mixMode) {\r\n            case PropSocketModes.REPLACE:\r\n              val = sockb.value;\r\n              break;\r\n            case PropSocketModes.MIN:\r\n              val = Math.min(val, sockb.value);\r\n              break;\r\n            case PropSocketModes.MAX:\r\n              val = Math.max(val, sockb.value);\r\n              break;\r\n          }\r\n        }\r\n      }\r\n\r\n      sock.value = val;\r\n    }\r\n\r\n    function isNumArray(a) {\r\n      if (!Array.isArray(a)) {\r\n        return false;\r\n      }\r\n\r\n      for (let i = 0; i < a.length; i++) {\r\n        if (a[i] !== undefined && typeof a[i] !== \"number\" && typeof a[i] !== \"boolean\") {\r\n          return false;\r\n        }\r\n      }\r\n\r\n      return true;\r\n    }\r\n\r\n    for (let k in node.outputs) {\r\n      let sock = node.outputs[k];\r\n\r\n      if (!(sock instanceof PropertySocket)) {\r\n        continue;\r\n      }\r\n\r\n      let v = sock.value;\r\n      let changed;\r\n      if (typeof v === \"boolean\" || typeof v === \"string\" || typeof v === \"number\") {\r\n        changed = v !== sock.oldValue;\r\n        sock.oldValue = v;\r\n      } else if (typeof v === \"object\") {\r\n        if (isNumArray(v)) {\r\n          if (!sock.oldValue) {\r\n            sock.oldValue = Array.from(v);\r\n          } else {\r\n            if (sock.oldValue.length !== v.length) {\r\n              changed = true;\r\n            } else {\r\n              for (let i = 0; i < sock.oldValue.length; i++) {\r\n                changed = sock.oldValue[i] !== v[i];\r\n              }\r\n            }\r\n\r\n            if (sock.oldValue.length !== v.length) {\r\n              sock.oldValue.length = v.length;\r\n            }\r\n            for (let i = 0; i < v.length; i++) {\r\n              sock.oldValue[i] = v.value[i];\r\n            }\r\n          }\r\n        } else {\r\n          if (sock.oldValue === undefined) {\r\n            sock.oldValue = JSON.stringify(v);\r\n          } else {\r\n            let json = JSON.stringify(v);\r\n            changed = json !== sock.oldValue;\r\n            sock.oldValue = json;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (changed) {\r\n        console.log(\"Propagating prop update\");\r\n        sock.flagUpdate();\r\n      }\r\n    }\r\n  }\r\n\r\n  ensureGraph() {\r\n    console.log(\"Ensure Graph\", this, this.graphNode, this.graphNode.id);\r\n    if (!theEventGraph.has(this)) {\r\n      theEventGraph.add(this);\r\n    }\r\n  }\r\n\r\n  flagPropSocketUpdate(path) {\r\n    let sock = this.getPropertySocket(path, SocketTypes.OUTPUT);\r\n    if (sock) {\r\n      console.warn(`Flag socket \"${path}\" for update`);\r\n      sock.flagUpdate();\r\n    }\r\n    return this;\r\n  }\r\n\r\n  getPropertySocket(prop, socktype) {\r\n    let node = this.graphNode;\r\n    let sockets = socktype === SocketTypes.INPUT ? node.inputs : node.outputs;\r\n\r\n    if (sockets[prop]) {\r\n      return sockets[prop];\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  ensurePropertySocket(prop, socktype) {\r\n    this.ensureGraph();\r\n\r\n    let node = this.graphNode;\r\n    let sockets = socktype === SocketTypes.INPUT ? node.inputs : node.outputs;\r\n\r\n    if (sockets[prop]) {\r\n      return sockets[prop];\r\n    }\r\n\r\n    let sock = new PropertySocket();\r\n    sock.bind(this, prop);\r\n    node.addSocket(socktype, prop, sock);\r\n\r\n    if (prop === \"value\") {\r\n      sock.callback((v) => {\r\n        if (this.getValue) {\r\n          return this.getValue();\r\n        }\r\n\r\n        return this.value;\r\n      });\r\n    }\r\n\r\n    return sock;\r\n  }\r\n\r\n  /*\r\n    widget.dependsOn(\"hidden\", checkbox, \"value\")\r\n   */\r\n  dependsOn(dstProp, source, srcProp, srcCallback = undefined, dstCallback = undefined) {\r\n    let sockdst = this.ensurePropertySocket(dstProp, SocketTypes.INPUT);\r\n    let socksrc = source.ensurePropertySocket(srcProp, SocketTypes.OUTPUT);\r\n\r\n    if (srcCallback) {\r\n      socksrc.callback(srcCallback);\r\n    }\r\n\r\n    sockdst.connect(socksrc);\r\n\r\n    return sockdst;\r\n  }\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    EventNode.init(this);\r\n\r\n    this._modalstack = [];\r\n\r\n    this._tool_tip_abort_delay = undefined;\r\n    this._tooltip_ref = undefined;\r\n\r\n    this._textBoxEvents = false;\r\n\r\n    this._themeOverride = undefined;\r\n\r\n    this._checkTheme = true;\r\n    this._last_theme_update_key = _themeUpdateKey;\r\n\r\n    this._client_disabled_set = undefined;\r\n    //this._parent_disabled_set = 0;\r\n\r\n    this._useNativeToolTips = cconst.useNativeToolTips;\r\n    this._useNativeToolTips_set = false;\r\n    this._has_own_tooltips = undefined;\r\n    this._tooltip_timer = util.time_ms();\r\n\r\n    this.pathUndoGen = 0;\r\n    this._lastPathUndoGen = 0;\r\n    this._useDataPathUndo = undefined;\r\n\r\n    this._active_animations = [];\r\n\r\n    //ref to Link element referencing Screen style node\r\n    //Screen.update_intern sets the contents of this\r\n    this._screenStyleTag = document.createElement(\"style\");\r\n    this._screenStyleUpdateHash = 0;\r\n\r\n    initAspectClass(this, new Set([\"appendChild\", \"animate\", \"shadow\", \"removeNode\", \"prepend\", \"add\", \"init\"]));\r\n\r\n    this.shadow = this.attachShadow({mode: 'open'});\r\n\r\n    if (cconst.DEBUG.paranoidEvents) {\r\n      this.__cbs = [];\r\n    }\r\n\r\n    this.shadow.appendChild(this._screenStyleTag);\r\n    this.shadow._appendChild = this.shadow.appendChild;\r\n\r\n    ///*\r\n    let appendChild = this.shadow.appendChild;\r\n    this.shadow.appendChild = (child) => {\r\n      if (child && typeof child === \"object\" && child instanceof UIBase) {\r\n        child.parentWidget = this;\r\n      }\r\n\r\n      return this.shadow._appendChild(child, ...arguments);\r\n    };\r\n    //*/\r\n\r\n    this._wasAddedToNodeAtSomeTime = false;\r\n\r\n    this.visibleToPick = true;\r\n\r\n    this._override_class = undefined;\r\n    this.parentWidget = undefined;\r\n\r\n    /*\r\n    this.shadow._appendChild = this.shadow.appendChild;\r\n    this.shadow.appendChild = (child) => {\r\n      if (child instanceof UIBase) {\r\n        child.ctx = this.ctx;\r\n        child.parentWidget = this;\r\n\r\n        if (child._useDataPathUndo === undefined) {\r\n          child.useDataPathUndo = this.useDataPathUndo;\r\n        }\r\n      }\r\n\r\n      return this.shadow._appendChild(child);\r\n    };\r\n    //*/\r\n\r\n    let tagname = this.constructor.define().tagname;\r\n    this._id = tagname.replace(/\\-/g, \"_\") + (_idgen++);\r\n\r\n    this.default_overrides = {}; //inherited by child widgets\r\n    this.my_default_overrides = {}; //not inherited to child widgets\r\n    this.class_default_overrides = {};\r\n\r\n    this._last_description = undefined;\r\n    this._description_final = undefined;\r\n\r\n    //getting css to flow down properly can be a pain, so\r\n    //some packing settings are set as bitflags here,\r\n    //see PackFlags\r\n\r\n    /*\r\n    setInterval(() => {\r\n      this.update();\r\n    }, 200);\r\n    //*/\r\n\r\n    this._modaldata = undefined;\r\n    this.packflag = this.getDefault(\"BasePackFlag\");\r\n    this._internalDisabled = false;\r\n    this.__disabledState = false;\r\n    this._disdata = undefined;\r\n    this._ctx = undefined;\r\n\r\n    this._description = undefined;\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n    .DefaultText {\r\n      font: ` + _getFont(this) + `;\r\n    }\r\n    `;\r\n    this.shadow.appendChild(style);\r\n    this._init_done = false;\r\n\r\n    /* Deprecated touch -> mouse event conversion,\r\n       use pointer events instead. */\r\n    let do_touch = (e, type, button) => {\r\n      if (haveModal()) {\r\n        return;\r\n      }\r\n\r\n      button = button === undefined ? 0 : button;\r\n      let e2 = copyEvent(e);\r\n\r\n      if (e.touches.length === 0) {\r\n        //hrm, what to do, what to do. . .\r\n      } else {\r\n        let t = e.touches[0];\r\n\r\n        e2.pageX = t.pageX;\r\n        e2.pageY = t.pageY;\r\n        e2.screenX = t.screenX;\r\n        e2.screenY = t.screenY;\r\n        e2.clientX = t.clientX;\r\n        e2.clientY = t.clientY;\r\n        e2.x = t.x;\r\n        e2.y = t.y;\r\n      }\r\n\r\n      e2.button = button;\r\n\r\n      e2 = new MouseEvent(type, e2);\r\n\r\n      e2.was_touch = true;\r\n      e2.stopPropagation = e.stopPropagation.bind(e);\r\n      e2.preventDefault = e.preventDefault.bind(e);\r\n      e2.touches = e.touches;\r\n\r\n      this.dispatchEvent(e2);\r\n    };\r\n\r\n    this.addEventListener(\"touchstart\", (e) => {\r\n      do_touch(e, \"mousedown\", 0);\r\n    }, {passive: false});\r\n    this.addEventListener(\"touchmove\", (e) => {\r\n      do_touch(e, \"mousemove\");\r\n    }, {passive: false});\r\n    this.addEventListener(\"touchcancel\", (e) => {\r\n      do_touch(e, \"mouseup\", 2);\r\n    }, {passive: false});\r\n    this.addEventListener(\"touchend\", (e) => {\r\n      do_touch(e, \"mouseup\", 0);\r\n    }, {passive: false});\r\n\r\n    if (this.constructor.define().havePickClipboard) {\r\n      this._clipboardHotkeyInit();\r\n    }\r\n  }\r\n\r\n  /*\r\n  set default_overrides(v) {\r\n    console.error(\"default_overrides was set\", v);\r\n    this._default_overrides = v;\r\n  }\r\n\r\n  get default_overrides() {\r\n    return this._default_overrides;\r\n  }//*/\r\n\r\n  get useNativeToolTips() {\r\n    return this._useNativeToolTips;\r\n  }\r\n\r\n  set useNativeToolTips(val) {\r\n    this._useNativeToolTips = val;\r\n    this._useNativeToolTips_set = true;\r\n  }\r\n\r\n  get parentWidget() {\r\n    return this._parentWidget;\r\n  }\r\n\r\n  set parentWidget(val) {\r\n    if (val) {\r\n      this._wasAddedToNodeAtSomeTime = true;\r\n    }\r\n\r\n    this._parentWidget = val;\r\n  }\r\n\r\n  get useDataPathUndo() {\r\n    let p = this;\r\n\r\n    while (p) {\r\n      if (p._useDataPathUndo !== undefined) {\r\n        return p._useDataPathUndo;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    /* Default to true. */\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   causes calls to setPathValue to go through\r\n   toolpath app.datapath_set(path=\"\" newValueJSON=\"\")\r\n\r\n   every child will inherit\r\n   */\r\n  set useDataPathUndo(val) {\r\n    this._useDataPathUndo = val;\r\n  }\r\n\r\n  get description() {\r\n\r\n    return this._description;\r\n  }\r\n\r\n  set description(val) {\r\n    if (val === null) {\r\n      this._description = undefined;\r\n      return;\r\n    }\r\n\r\n    this._description = val;\r\n\r\n    if (val === undefined || val === null) {\r\n      return;\r\n    }\r\n\r\n    if (cconst.showPathsInToolTips && this.hasAttribute(\"datapath\")) {\r\n      let s = \"\" + this._description;\r\n\r\n      let path = this.getAttribute(\"datapath\");\r\n      s += \"\\n    path: \" + path;\r\n\r\n      if (this.hasAttribute(\"mass_set_path\")) {\r\n        let m = this.getAttribute(\"mass_set_path\");\r\n        s += \"\\n    massSetPath: \" + m;\r\n      }\r\n\r\n      this._description_final = s;\r\n    } else {\r\n      this._description_final = this._description;\r\n    }\r\n\r\n    if (cconst.useNativeToolTips) {\r\n      this.title = \"\" + this._description_final;\r\n    }\r\n  }\r\n\r\n  get background() {\r\n    return this.__background;\r\n  }\r\n\r\n  set background(bg) {\r\n    this.__background = bg;\r\n\r\n    this.overrideDefault(\"background-color\", bg, true);\r\n    this.style[\"background-color\"] = bg;\r\n  }\r\n\r\n  get disabled() {\r\n    //hrm, I could just propegate checks upward. . .\r\n\r\n    if (this.parentWidget && this.parentWidget.disabled) {\r\n      return true;\r\n    }\r\n\r\n    return !!this._client_disabled_set || !!this._internalDisabled;// || !!this._parent_disabled_set;\r\n  }\r\n\r\n  set disabled(v) {\r\n    this._client_disabled_set = v;\r\n    this.__updateDisable(this.disabled);\r\n  }\r\n\r\n  get internalDisabled() {\r\n    return this._internalDisabled;\r\n  }\r\n\r\n  set internalDisabled(val) {\r\n    this._internalDisabled = !!val;\r\n\r\n    this.__updateDisable(this.disabled);\r\n  }\r\n\r\n  get ctx() {\r\n    return this._ctx;\r\n  }\r\n\r\n  set ctx(c) {\r\n    this._ctx = c;\r\n\r\n    this._forEachChildWidget((n) => {\r\n      n.ctx = c;\r\n    });\r\n  }\r\n\r\n  get _reportCtxName() {\r\n    return \"\" + this._id;\r\n  }\r\n\r\n  get modalRunning() {\r\n    return this._modaldata !== undefined;\r\n  }\r\n\r\n  static getIconEnum() {\r\n    return Icons;\r\n  }\r\n\r\n  static setDefault(element) {\r\n    return element;\r\n  }\r\n\r\n  /**DEPRECATED\r\n\r\n   scaling ratio (e.g. for high-resolution displays)\r\n   */\r\n  static getDPI() {\r\n    //if (dpistack.length > 0) {\r\n    //  return dpistack[this.dpistack.length-1];\r\n    //} else {\r\n    //if (util.isMobile()) {\r\n    return window.devicePixelRatio; // * visualViewport.scale;\r\n    //}\r\n\r\n    return window.devicePixelRatio;\r\n    //}\r\n  }\r\n\r\n  static prefix(name) {\r\n    return tagPrefix + name;\r\n  }\r\n\r\n  static internalRegister(cls) {\r\n    cls[ClassIdSymbol] = class_idgen++;\r\n\r\n    registered_has_happened = true;\r\n\r\n    internalElementNames[cls.define().tagname] = this.prefix(cls.define().tagname);\r\n    customElements.define(this.prefix(cls.define().tagname), cls);\r\n  }\r\n\r\n  static getInternalName(name) {\r\n    return internalElementNames[name];\r\n  }\r\n\r\n  static createElement(name, internal = false) {\r\n    if (!internal && name in externalElementNames) {\r\n      return document.createElement(name);\r\n    } else if (name in internalElementNames) {\r\n      return document.createElement(internalElementNames[name]);\r\n    } else {\r\n      return document.createElement(name)\r\n    }\r\n  }\r\n\r\n  static register(cls) {\r\n    registered_has_happened = true;\r\n\r\n    cls[ClassIdSymbol] = class_idgen++;\r\n\r\n    ElementClasses.push(cls);\r\n\r\n    externalElementNames[cls.define().tagname] = cls.define().tagname;\r\n    customElements.define(cls.define().tagname, cls);\r\n  }\r\n\r\n  /**\r\n   * Defines core attributes of the class\r\n   *\r\n   * @example\r\n   *\r\n   * static define() {return {\r\n   *   tagname             : \"custom-element-x\",\r\n   *   style               : \"[style class in theme]\"\r\n   *   subclassChecksTheme : boolean //set to true to disable base class invokation of checkTheme()\r\n   *   havePickClipboard   : boolean //whether element supports mouse hover copy/paste\r\n   *   pasteForAllChildren : boolean //mouse hover paste happens even over child widgets\r\n   *   copyForAllChildren  : boolean //mouse hover copy happens even over child widgets\r\n   * }}\r\n   */\r\n  static define() {\r\n    throw new Error(\"Missing define() for ux element\");\r\n  }\r\n\r\n  setUndo(val) {\r\n    this.useDataPathUndo = val;\r\n    return this;\r\n  }\r\n\r\n  set hidden(state) {\r\n    state = !!state;\r\n    super.hidden = state;\r\n\r\n    for (let n of this.shadow.childNodes) {\r\n      n.hidden = state;\r\n    }\r\n\r\n    this._forEachChildWidget((n) => {\r\n      n.hide(state);\r\n    })\r\n  }\r\n\r\n  get hidden() {\r\n    return super.hidden;\r\n  }\r\n\r\n  hide(sethide = true) {\r\n    this.hidden = sethide;\r\n    return this;\r\n  }\r\n\r\n  getElementById(id) {\r\n    let ret;\r\n\r\n    let rec = (n) => {\r\n      if (ret) {\r\n        return;\r\n      }\r\n\r\n      if (n.getAttribute(\"id\") === id || n.id === id) {\r\n        ret = n;\r\n      }\r\n\r\n      if (n instanceof UIBase && n.constructor.define().tagname === \"panelframe-x\") {\r\n        rec(n.contents);\r\n      } else if (n instanceof UIBase && n.constructor.define().tagname === \"tabcontainer-x\") {\r\n        for (let k in n.tabs) {\r\n          let tab = n.tabs[k];\r\n\r\n          if (tab) {\r\n            rec(tab);\r\n          }\r\n        }\r\n      }\r\n\r\n      for (let n2 of n.childNodes) {\r\n        if (n2 instanceof HTMLElement) {\r\n          rec(n2);\r\n\r\n          if (ret) {\r\n            break;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (n.shadow) {\r\n        for (let n2 of n.shadow.childNodes) {\r\n          if (n2 instanceof HTMLElement) {\r\n            rec(n2);\r\n\r\n            if (ret) {\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    rec(this);\r\n\r\n    return ret;\r\n  }\r\n\r\n  unhide() {\r\n    this.hide(false);\r\n  }\r\n\r\n  findArea() {\r\n    let p = this;\r\n\r\n    while (p) {\r\n      if (p instanceof Area) {\r\n        return p;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    return p;\r\n  }\r\n\r\n  addEventListener(type, cb, options) {\r\n    if (cconst.DEBUG.domEventAddRemove) {\r\n      console.log(\"addEventListener\", type, this._id, options);\r\n    }\r\n\r\n    let cb2 = (e) => {\r\n      if (cconst.DEBUG.paranoidEvents) {\r\n        if (this.isDead()) {\r\n          this.removeEventListener(type, cb, options);\r\n          return;\r\n        }\r\n      }\r\n\r\n      if (cconst.DEBUG.domEvents) {\r\n        pathDebugEvent(e);\r\n      }\r\n\r\n      let area = this.findArea();\r\n\r\n      if (area) {\r\n        area.push_ctx_active();\r\n        try {\r\n          let ret = cb(e);\r\n          area.pop_ctx_active();\r\n          return ret;\r\n        } catch (error) {\r\n          area.pop_ctx_active();\r\n          throw error;\r\n        }\r\n      } else {\r\n        if (cconst.DEBUG.areaContextPushes) {\r\n          console.warn(\"Element is not part of an area?\", element);\r\n        }\r\n\r\n        return cb(e);\r\n      }\r\n    };\r\n\r\n    if (!cb[EventCBSymbol]) {\r\n      cb[EventCBSymbol] = new Map();\r\n    }\r\n\r\n    let key = calcElemCBKey(this, type, options);\r\n    cb[EventCBSymbol].set(key, cb2);\r\n\r\n    if (cconst.DEBUG.paranoidEvents) {\r\n      this.__cbs.push([type, cb2, options]);\r\n    }\r\n\r\n    return super.addEventListener(type, cb2, options);\r\n  }\r\n\r\n  removeEventListener(type, cb, options) {\r\n    if (cconst.DEBUG.paranoidEvents) {\r\n      for (let item of this.__cbs) {\r\n        if (item[0] == type && item[1] === cb._cb2 && (\"\" + item[2]) === (\"\" + options)) {\r\n          this.__cbs.remove(item);\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (cconst.DEBUG.domEventAddRemove) {\r\n      console.log(\"removeEventListener\", type, this._id, options);\r\n    }\r\n\r\n    let key = calcElemCBKey(this, type, options);\r\n\r\n    if (!cb[EventCBSymbol] || !cb[EventCBSymbol].has(key)) {\r\n      return super.removeEventListener(type, cb, options);\r\n    } else {\r\n      let cb2 = cb[EventCBSymbol].get(key);\r\n\r\n      let ret = super.removeEventListener(type, cb2, options);\r\n\r\n      cb[EventCBSymbol].delete(key);\r\n      return ret;\r\n    }\r\n  }\r\n\r\n  connectedCallback() {\r\n\r\n  }\r\n\r\n  noMarginsOrPadding() {\r\n    let keys = [\"margin\", \"padding\", \"margin-block-start\", \"margin-block-end\"];\r\n    keys = keys.concat([\"padding-block-start\", \"padding-block-end\"]);\r\n\r\n    keys = keys.concat([\"margin-left\", \"margin-top\", \"margin-bottom\", \"margin-right\"]);\r\n    keys = keys.concat([\"padding-left\", \"padding-top\", \"padding-bottom\", \"padding-right\"]);\r\n\r\n    for (let k of keys) {\r\n      this.style[k] = \"0px\";\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * find owning screen and tell it to update\r\n   * the global tab order\r\n   * */\r\n  regenTabOrder() {\r\n    let screen = this.getScreen();\r\n    if (screen !== undefined) {\r\n      screen.needsTabRecalc = true;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  noMargins() {\r\n    this.style[\"margin\"] = this.style[\"margin-left\"] = this.style[\"margin-right\"] = \"0px\";\r\n    this.style[\"margin-top\"] = this.style[\"margin-bottom\"] = \"0px\";\r\n    return this;\r\n  }\r\n\r\n  noPadding() {\r\n    this.style[\"padding\"] = this.style[\"padding-left\"] = this.style[\"padding-right\"] = \"0px\";\r\n    this.style[\"padding-top\"] = this.style[\"padding-bottom\"] = \"0px\";\r\n    return this;\r\n  }\r\n\r\n  getTotalRect() {\r\n    let found = false;\r\n\r\n    let min = new Vector2([1e17, 1e17]);\r\n    let max = new Vector2([-1e17, -1e17]);\r\n\r\n    let doaabb = (n) => {\r\n      let rs = n.getClientRects();\r\n\r\n      for (let r of rs) {\r\n        min[0] = Math.min(min[0], r.x);\r\n        min[1] = Math.min(min[1], r.y);\r\n        max[0] = Math.max(max[0], r.x + r.width);\r\n        max[1] = Math.max(max[1], r.y + r.height);\r\n\r\n        found = true;\r\n      }\r\n    };\r\n\r\n    doaabb(this);\r\n\r\n    this._forEachChildWidget((n) => {\r\n      doaabb(n);\r\n    });\r\n\r\n    if (found) {\r\n      return {\r\n        width : max[0] - min[0],\r\n        height: max[1] - min[1],\r\n        x     : min[0],\r\n        y     : min[1],\r\n        left  : min[0],\r\n        top   : min[1],\r\n        right : max[0],\r\n        bottom: max[1]\r\n      };\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  parseNumber(value, args = {}) {\r\n    value = (\"\" + value).trim().toLowerCase();\r\n\r\n    let baseUnit = args.baseUnit || this.baseUnit;\r\n    let isInt = args.isInt || this.isInt;\r\n\r\n    let sign = 1.0;\r\n\r\n    if (value.startsWith(\"-\")) {\r\n      value = value.slice(1, value.length).trim();\r\n      sign = -1;\r\n    }\r\n\r\n    let hexre = /-?[0-9a-f]+h$/;\r\n\r\n    if (value.startsWith(\"0b\")) {\r\n      value = value.slice(2, value.length).trim();\r\n      value = parseInt(value, 2);\r\n    } else if (value.startsWith(\"0x\")) {\r\n      value = value.slice(2, value.length).trim();\r\n      value = parseInt(value, 16);\r\n    } else if (value.search(hexre) === 0) {\r\n      value = value.slice(0, value.length - 1).trim();\r\n      value = parseInt(value, 16);\r\n    } else {\r\n      value = units.parseValue(value, baseUnit);\r\n    }\r\n\r\n    if (isInt) {\r\n      value = ~~value;\r\n    }\r\n\r\n    return value*sign;\r\n  }\r\n\r\n  formatNumber(value, args = {}) {\r\n    let baseUnit = args.baseUnit || this.baseUnit;\r\n    let displayUnit = args.displayUnit || this.displayUnit;\r\n    let isInt = args.isInt || this.isInt;\r\n    let radix = args.radix || this.radix || 10;\r\n    let decimalPlaces = args.decimalPlaces || this.decimalPlaces;\r\n\r\n    //console.log(this.baseUnit, this.displayUnit);\r\n\r\n    if (isInt && radix !== 10) {\r\n      let ret = Math.floor(value).toString(radix);\r\n\r\n      if (radix === 2)\r\n        return \"0b\" + ret;\r\n      else if (radix === 16)\r\n        return ret + \"h\";\r\n    }\r\n\r\n    return units.buildString(value, baseUnit, decimalPlaces, displayUnit);\r\n  }\r\n\r\n  setBoxCSS(subkey) {\r\n    let boxcode = '';\r\n\r\n    //debugger;\r\n\r\n    let keys = [\"left\", \"right\", \"top\", \"bottom\"];\r\n\r\n    let sub;\r\n    if (subkey) {\r\n      sub = this.getAttribute(subkey) || {};\r\n    }\r\n\r\n    let def = (key) => {\r\n      if (sub) {\r\n        return this.getSubDefault(subkey, key);\r\n      }\r\n\r\n      return this.getDefault(key);\r\n    }\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let key = i ? \"padding\" : \"margin\";\r\n\r\n      this.style[key] = \"unset\";\r\n\r\n      let val = def(key);\r\n      if (val !== undefined) { //handle default first\r\n        for (let j = 0; j < 4; j++) {\r\n          this.style[key + \"-\" + keys[j]] = val + \"px\";\r\n        }\r\n      }\r\n\r\n      for (let j = 0; j < 4; j++) { //now do box sides\r\n        let key2 = `${key}-${keys[j]}`;\r\n        let val2 = def(key2);\r\n\r\n        if (val2 !== undefined) {\r\n          this.style[key2] = val2 + \"px\";\r\n        }\r\n      }\r\n\r\n    }\r\n\r\n    this.style[\"border-radius\"] = def(\"border-radius\") + \"px\";\r\n    this.style[\"border\"] = `${def(\"border-width\")}px ${def(\"border-style\")} ${def(\"border-color\")}`;\r\n  }\r\n\r\n  genBoxCSS(subkey) {\r\n    let boxcode = '';\r\n\r\n    let keys = [\"left\", \"right\", \"top\", \"bottom\"];\r\n\r\n    let sub;\r\n    if (subkey) {\r\n      sub = this.getAttribute(subkey) || {};\r\n    }\r\n\r\n    let def = (key) => {\r\n      if (sub) {\r\n        return this.getSubDefault(subkey, key);\r\n      }\r\n\r\n      return this.getDefault(key);\r\n    }\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let key = i ? \"padding\" : \"margin\";\r\n\r\n      let val = def(key);\r\n      if (val !== undefined) {\r\n        boxcode += `${key}: ${val} px;\\n`;\r\n      }\r\n\r\n      for (let j = 0; j < 4; j++) {\r\n        let key2 = `${key}-${keys[j]}`;\r\n        let val2 = def(key2);\r\n\r\n        if (val2 !== undefined) {\r\n          boxcode += `${key2}: ${val}px;\\n`;\r\n        }\r\n      }\r\n    }\r\n\r\n    boxcode += `border-radius: ${def(\"border-radius\")}px;\\n`;\r\n    boxcode += `border: ${def(\"border-width\")}px ${def(\"border-style\")} ${def(\"border-color\")};\\n`;\r\n\r\n    return boxcode;\r\n  }\r\n\r\n  setCSS(setBG = true) {\r\n    if (setBG) {\r\n      let bg = this.getDefault(\"background-color\");\r\n      if (bg) {\r\n        this.style[\"background-color\"] = bg;\r\n      }\r\n    }\r\n\r\n    let zoom = this.getZoom();\r\n    if (zoom === 1.0) {\r\n      return;\r\n    }\r\n\r\n    let transform = \"\" + this.style[\"transform\"];\r\n\r\n    //try to preserve user set transform by selectively deleting scale\r\n    //kind of hackish. . .\r\n\r\n    //normalize whitespace\r\n    transform = transform.replace(/[ \\t\\n\\r]+/g, ' ');\r\n    transform = transform.replace(/, /g, ',');\r\n\r\n    //cut out scale\r\n    let transform2 = transform.replace(/scale\\([^)]+\\)/, '').trim();\r\n    this.style[\"transform\"] = transform2 + ` scale(${zoom},${zoom})`;\r\n  }\r\n\r\n  flushSetCSS() {\r\n    //check init\r\n    this._init();\r\n\r\n    this.setCSS();\r\n\r\n    this._forEachChildWidget((c) => {\r\n      if (!(c.packflag & PackFlags.NO_UPDATE)) {\r\n        c.flushSetCSS();\r\n      }\r\n    });\r\n  }\r\n\r\n  /* Why is the DOM API argument order swapped here?*/\r\n  replaceChild(newnode, node) {\r\n    for (let i = 0; i < this.childNodes.length; i++) {\r\n      if (this.childNodes[i] === node) {\r\n        super.replaceChild(newnode, node);\r\n        return true;\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < this.shadow.childNodes.length; i++) {\r\n      if (this.shadow.childNodes[i] === node) {\r\n        this.shadow.replaceChild(newnode, node);\r\n        return true;\r\n      }\r\n    }\r\n\r\n    console.error(\"Unknown child node\", node);\r\n    return false;\r\n  }\r\n\r\n  swapWith(b) {\r\n    let p1 = this.parentNode;\r\n    let p2 = b.parentNode;\r\n\r\n    if (this.parentWidget && (p1 === this.parentWidget.shadow) || p1 === null) {\r\n      p1 = this.parentWidget;\r\n    }\r\n\r\n    if (b.parentWidget && (p2 === b.parentWidget.shadow) || p2 === null) {\r\n      p2 = b.parentWidget;\r\n    }\r\n\r\n    if (!p1 || !p2) {\r\n      console.error(\"Invalid call to UIBase.prototype.swapWith\", this, b, p1, p2);\r\n      return false;\r\n    }\r\n\r\n    let getPos = (n, p) => {\r\n      let i = Array.prototype.indexOf.call(p.childNodes, n);\r\n\r\n      if (i < 0 && p.shadow) {\r\n        p = p.shadow;\r\n        i = Array.prototype.indexOf.call(p.childNodes, n);\r\n      }\r\n\r\n      return [i, p];\r\n    }\r\n\r\n    let [i1, n1] = getPos(this, p1);\r\n    let [i2, n2] = getPos(b, p2);\r\n\r\n    console.log(\"i1, i2, n1, n2\", i1, i2, n1, n2);\r\n\r\n    let tmp1 = document.createElement(\"div\");\r\n    let tmp2 = document.createElement(\"div\");\r\n\r\n    n1.insertBefore(tmp1, this);\r\n    n2.insertBefore(tmp2, b);\r\n\r\n    //HTMLElement.prototype.remove.call(this);\r\n    //HTMLElement.prototype.remove.call(b);\r\n\r\n    n1.replaceChild(b, tmp1);\r\n    n2.replaceChild(this, tmp2);\r\n\r\n    let ptmp = this.parentWidget;\r\n    this.parentWidget = b.parentWidget;\r\n    b.parentWidget = ptmp;\r\n\r\n    tmp1.remove();\r\n    tmp2.remove();\r\n\r\n    return true;\r\n  }\r\n\r\n  traverse(type_or_set) {\r\n    let this2 = this;\r\n\r\n    let classes = type_or_set;\r\n\r\n    let is_set = type_or_set instanceof Set;\r\n    is_set = is_set || type_or_set instanceof util.set;\r\n    is_set = is_set || Array.isArray(type_or_set);\r\n\r\n    if (!is_set) {\r\n      classes = [type_or_set];\r\n    }\r\n\r\n    let visit = new Set();\r\n\r\n    return (function* () {\r\n      let stack = [this2];\r\n\r\n      while (stack.length > 0) {\r\n        let n = stack.pop();\r\n\r\n        visit.add(n);\r\n\r\n        if (!n || !n.childNodes) {\r\n          continue;\r\n        }\r\n\r\n        for (let cls of classes) {\r\n          if (n instanceof cls) {\r\n            yield n;\r\n          }\r\n        }\r\n\r\n        for (let c of n.childNodes) {\r\n          if (!visit.has(c)) {\r\n            stack.push(c);\r\n          }\r\n        }\r\n\r\n        if (n.shadow) {\r\n          for (let c of n.shadow.childNodes) {\r\n            if (!visit.has(c)) {\r\n              stack.push(c);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    })();\r\n  }\r\n\r\n  appendChild(child) {\r\n    if (child instanceof UIBase) {\r\n      child.ctx = this.ctx;\r\n      child.parentWidget = this;\r\n\r\n      child.useDataPathUndo = this.useDataPathUndo;\r\n    }\r\n\r\n    return super.appendChild(child);\r\n  }\r\n\r\n  _clipboardHotkeyInit() {\r\n    this._clipboard_over = false;\r\n    this._last_clipboard_keyevt = undefined;\r\n\r\n    this._clipboard_keystart = () => {\r\n      if (this._clipboard_events) {\r\n        return;\r\n      }\r\n\r\n      this._clipboard_events = true;\r\n      window.addEventListener(\"keydown\", this._clipboard_keydown, {capture: true, passive: false});\r\n    }\r\n\r\n    this._clipboard_keyend = () => {\r\n      if (!this._clipboard_events) {\r\n        return;\r\n      }\r\n\r\n      this._clipboard_events = false;\r\n      window.removeEventListener(\"keydown\", this._clipboard_keydown, {capture: true, passive: false});\r\n    }\r\n\r\n    this._clipboard_keydown = (e, internal_mode) => {\r\n      if (!this.isConnected || !cconst.getClipboardData) {\r\n        this._clipboard_keyend();\r\n        return;\r\n      }\r\n\r\n      if (e === this._last_clipboard_keyevt || !this._clipboard_over) {\r\n        return;\r\n      }\r\n\r\n      /* the user's mouse cursor might not be over the element\r\n      *  if they've tabbed to it */\r\n\r\n      let is_copy = e.keyCode === keymap[\"C\"] && (e.ctrlKey || e.commandKey) && !e.shiftKey && !e.altKey;\r\n      let is_paste = e.keyCode === keymap[\"V\"] && (e.ctrlKey || e.commandKey) && !e.shiftKey && !e.altKey;\r\n\r\n      if (!is_copy && !is_paste) {\r\n        //early out, remember that pickElement is highly expensive to run\r\n        return;\r\n      }\r\n\r\n      //pasteForAllChildren\r\n      if (!internal_mode) {\r\n        let screen = this.ctx.screen;\r\n        let elem = screen.pickElement(screen.mpos[0], screen.mpos[1]);\r\n\r\n        let checkTree = is_paste && this.constructor.define().pasteForAllChildren;\r\n        checkTree = checkTree || (is_copy && this.constructor.define().copyForAllChildren);\r\n\r\n        while (checkTree && !(elem instanceof TextBox) && elem !== this && elem.parentWidget) {\r\n          console.log(\"  \" + elem._id);\r\n\r\n          elem = elem.parentWidget;\r\n        }\r\n\r\n        console.warn(\"COLOR\", this._id, elem._id);\r\n\r\n        if (elem !== this) {\r\n          //remove global keyhandler\r\n          this._clipboard_keyend();\r\n          return;\r\n        }\r\n      } else {\r\n        console.warn(\"COLOR\", this._id);\r\n      }\r\n\r\n      this._last_clipboard_keyevt = e;\r\n\r\n      if (is_copy) {\r\n        this.clipboardCopy();\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n\r\n      if (is_paste) {\r\n        this.clipboardPaste();\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n    }\r\n\r\n    let start = (e) => {\r\n      this._clipboard_over = true;\r\n      this._clipboard_keystart();\r\n    }\r\n\r\n    let stop = (e) => {\r\n      this._clipboard_over = false;\r\n      this._clipboard_keyend();\r\n    }\r\n\r\n    this.doOnce(() => {\r\n      this.tabIndex = 0; //enable self key events when element has focus\r\n    });\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      return this._clipboard_keydown(e, true);\r\n    });\r\n\r\n    this.addEventListener(\"pointerover\", start, {capture: true, passive: true});\r\n    this.addEventListener(\"pointerout\", stop, {capture: true, passive: true});\r\n    this.addEventListener(\"focus\", stop, {capture: true, passive: true});\r\n  }\r\n\r\n  /** set havePickClipboard to true in define() to\r\n   *  enable mouseover pick clipboarding */\r\n  clipboardCopy() {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  clipboardPaste() {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  //delayed init\r\n  init() {\r\n    this._init_done = true;\r\n\r\n    if (!this.hasAttribute(\"id\") && this._id) {\r\n      this.setAttribute(\"id\", this._id);\r\n    }\r\n  }\r\n\r\n  _ondestroy() {\r\n    if (this.tabIndex >= 0) {\r\n      this.regenTabOrder();\r\n    }\r\n\r\n    if (cconst.DEBUG.paranoidEvents) {\r\n      for (let item of this.__cbs) {\r\n        this.removeEventListener(item[0], item[1], item[2]);\r\n      }\r\n\r\n      this.__cbs = [];\r\n    }\r\n\r\n\r\n    if (this.ondestroy !== undefined) {\r\n      this.ondestroy();\r\n    }\r\n  }\r\n\r\n  remove(trigger_on_destroy = true) {\r\n    if (this.tabIndex >= 0) {\r\n      this.regenTabOrder();\r\n    }\r\n\r\n    super.remove();\r\n\r\n    if (trigger_on_destroy) {\r\n      this._ondestroy();\r\n    }\r\n\r\n    if (this.on_remove) {\r\n      this.on_remove();\r\n    }\r\n\r\n    this.parentWidget = undefined;\r\n  }\r\n\r\n  /*\r\n  *\r\n  * called when elements are removed.\r\n  * you should assume the element will be reused later;\r\n  * on_destroy is the callback for when elements are permanently destroyed\r\n  * */\r\n  on_remove() {\r\n\r\n  }\r\n\r\n  removeChild(child, trigger_on_destroy = true) {\r\n    super.removeChild(child);\r\n\r\n    if (trigger_on_destroy) {\r\n      child._ondestroy();\r\n    }\r\n  }\r\n\r\n  flushUpdate(force = false) {\r\n    //check init\r\n    this._init();\r\n\r\n    this.update();\r\n\r\n    this._forEachChildWidget((c) => {\r\n      if (force || !(c.packflag & PackFlags.NO_UPDATE)) {\r\n        if (!c.ctx) {\r\n          c.ctx = this.ctx;\r\n        }\r\n\r\n        c.flushUpdate(force);\r\n      }\r\n    });\r\n  }\r\n\r\n  //used by container nodes\r\n  /**\r\n   * Iterates over all child widgets,\r\n   * including ones that might be inside\r\n   * of normal DOM nodes.\r\n   *\r\n   * This is done by recursing into the dom\r\n   * tree and stopping at any node that's\r\n   * descended from ui_base.UIBase\r\n   **/\r\n  _forEachChildWidget(cb, thisvar) {\r\n    let rec = (n) => {\r\n      if (n instanceof UIBase) {\r\n        if (thisvar !== undefined) {\r\n          cb.call(thisvar, n);\r\n        } else {\r\n          cb(n);\r\n        }\r\n      } else {\r\n        for (let n2 of n.childNodes) {\r\n          rec(n2);\r\n        }\r\n\r\n        if (n.shadow !== undefined) {\r\n          for (let n2 of n.shadow.childNodes) {\r\n            rec(n2);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    for (let n of this.childNodes) {\r\n      rec(n);\r\n    }\r\n\r\n    if (this.shadow) {\r\n      for (let n of this.shadow.childNodes) {\r\n        rec(n);\r\n      }\r\n    }\r\n  }\r\n\r\n  checkInit() {\r\n    return this._init();\r\n  }\r\n\r\n  _init() {\r\n    if (this._init_done) {\r\n      return false;\r\n    }\r\n\r\n    this._init_done = true;\r\n    this.init();\r\n\r\n    return true;\r\n  }\r\n\r\n  getWinWidth() {\r\n    return window.innerWidth;\r\n  }\r\n\r\n  getWinHeight() {\r\n    return window.innerHeight;\r\n  }\r\n\r\n  calcZ() {\r\n    let p = this;\r\n    let n = this;\r\n\r\n    while (n) {\r\n      if (n.style && n.style[\"z-index\"]) {\r\n        let z = parseFloat(n.style[\"z-index\"]);\r\n        return z;\r\n      }\r\n\r\n      n = n.parentNode;\r\n\r\n      if (!n) {\r\n        n = p = p.parentWidget;\r\n      }\r\n    }\r\n\r\n    return 0;\r\n  }\r\n\r\n  pickElement(x, y, args = {}, marginy = 0, nodeclass = UIBase, excluded_classes = undefined) {\r\n    let clip;\r\n    let mouseEvent;\r\n    let isMouseMove, isMouseDown;\r\n\r\n    if (typeof args === \"object\") {\r\n      nodeclass = args.nodeclass || UIBase;\r\n      excluded_classes = args.excluded_classes;\r\n      clip = args.clip;\r\n      mouseEvent = args.mouseEvent;\r\n    } else {\r\n      args = {\r\n        nodeclass       : nodeclass || UIBase,\r\n        excluded_classes: excluded_classes,\r\n        clip            : clip\r\n      }\r\n    }\r\n\r\n    if (mouseEvent) {\r\n      isMouseMove = mouseEvent.type === \"mousemove\" || mouseEvent.type === \"touchmove\" || mouseEvent.type === \"pointermove\";\r\n      isMouseDown = mouseEvent.buttons || (mouseEvent.touches && mouseEvent.touches.length > 0);\r\n    }\r\n\r\n    x -= window.scrollX;\r\n    y -= window.scrollY;\r\n\r\n    let elem = document.elementFromPoint(x, y);\r\n\r\n    if (!elem) {\r\n      return;\r\n    }\r\n\r\n    let path = [elem];\r\n    let lastelem = elem;\r\n    let i = 0;\r\n\r\n    while (elem && elem.shadow) {\r\n      if (i++ > 1000) {\r\n        console.error(\"Infinite loop error\");\r\n        break;\r\n      }\r\n\r\n      elem = elem.shadow.elementFromPoint(x, y);\r\n\r\n      if (elem === lastelem) {\r\n        break;\r\n      }\r\n\r\n      if (elem) {\r\n        path.push(elem);\r\n      }\r\n\r\n      lastelem = elem;\r\n    }\r\n\r\n    path.reverse();\r\n\r\n    //console.warn(path);\r\n\r\n    for (let i = 0; i < path.length; i++) {\r\n      let node = path[i];\r\n      let ok = node instanceof nodeclass;\r\n\r\n      if (excluded_classes) {\r\n        for (let cls of excluded_classes) {\r\n          ok = ok && !(node instanceof cls);\r\n        }\r\n      }\r\n\r\n      if (clip) {\r\n        let rect = node.getBoundingClientRect();\r\n        let clip2 = math.aabb_intersect_2d(clip.pos, clip.size, [rect.x, rect.y], [rect.width, rect.height]);\r\n\r\n        ok = ok && clip2;\r\n      }\r\n\r\n      if (ok) {\r\n        window.elem = node;\r\n        //console.log(node._id);\r\n        return node;\r\n      }\r\n    }\r\n  }\r\n\r\n  __updateDisable(val) {\r\n    if (!!val === !!this.__disabledState) {\r\n      return;\r\n    }\r\n\r\n    this.__disabledState = !!val;\r\n\r\n    if (val && !this._disdata) {\r\n      let style = this.getDefault(\"disabled\") || this.getDefault(\"internalDisabled\") || {\r\n        \"background-color\": this.getDefault(\"DisabledBG\")\r\n      };\r\n\r\n      this._disdata = {\r\n        style   : {},\r\n        defaults: {}\r\n      };\r\n\r\n      for (let k in style) {\r\n        //save old style information\r\n        this._disdata.style[k] = this.style[k];\r\n        this._disdata.defaults[k] = this.default_overrides[k];\r\n\r\n        let v = style[k];\r\n\r\n        if (typeof v === \"object\" && v instanceof CSSFont) {\r\n          this.style[k] = style[k].genCSS();\r\n        } else if (typeof v === \"object\") {\r\n          continue;\r\n        } else {\r\n          this.style[k] = style[k];\r\n        }\r\n        this.default_overrides[k] = style[k];\r\n      }\r\n\r\n      this.__disabledState = !!val;\r\n      this.on_disabled();\r\n    } else if (!val && this._disdata) {\r\n\r\n      //load old style information\r\n      for (let k in this._disdata.style) {\r\n        this.style[k] = this._disdata.style[k];\r\n      }\r\n\r\n      for (let k in this._disdata.defaults) {\r\n        let v = this._disdata.defaults[k];\r\n\r\n        if (v === undefined) {\r\n          delete this.default_overrides[k];\r\n        } else {\r\n          this.default_overrides[k] = v;\r\n        }\r\n      }\r\n\r\n      //this.background = this.style[\"background-color\"];\r\n      this._disdata = undefined;\r\n\r\n      this.__disabledState = !!val;\r\n      this.on_enabled();\r\n    }\r\n\r\n    this.__disabledState = !!val;\r\n\r\n    let visit = (n) => {\r\n      if (n instanceof UIBase) {\r\n        let changed = !!n.__disabledState;\r\n\r\n        /*\r\n        if (val) {\r\n          n._parent_disabled_set = Math.max(n._parent_disabled_set + 1, 0);\r\n        } else {\r\n          n._parent_disabled_set = Math.max(n._parent_disabled_set - 1, 0);\r\n        }//*/\r\n\r\n        n.__updateDisable(n.disabled);\r\n\r\n        changed = changed !== !!n.__disabledState;\r\n        if (changed) {\r\n          n.update();\r\n          n.setCSS();\r\n        }\r\n      }\r\n    };\r\n\r\n    this._forEachChildWidget(visit);\r\n  }\r\n\r\n  on_disabled() {\r\n\r\n  }\r\n\r\n  on_enabled() {\r\n\r\n  }\r\n\r\n  pushModal(handlers = this, autoStopPropagation = true, pointerId = undefined, pointerElem = this) {\r\n    if (this._modaldata !== undefined) {\r\n      console.warn(\"UIBase.prototype.pushModal called when already in modal mode\");\r\n      this.popModal();\r\n    }\r\n\r\n    let _areaWrangler = contextWrangler.copy();\r\n\r\n    contextWrangler.copy(this.ctx);\r\n\r\n    function bindFunc(func) {\r\n      return function () {\r\n        _areaWrangler.copyTo(contextWrangler);\r\n\r\n        return func.apply(handlers, arguments);\r\n      }\r\n    }\r\n\r\n    let handlers2 = {};\r\n    for (let k in handlers) {\r\n      let func = handlers[k];\r\n\r\n      if (typeof func !== \"function\") {\r\n        continue;\r\n      }\r\n\r\n      handlers2[k] = bindFunc(func);\r\n    }\r\n    //this._modalstack.push(this.ctx);\r\n    //this.ctx = this.ctx.toLocked();\r\n\r\n    if (pointerId !== undefined && pointerElem) {\r\n      this._modaldata = pushPointerModal(handlers2, autoStopPropagation);\r\n    } else {\r\n      this._modaldata = pushModalLight(handlers2, autoStopPropagation);\r\n    }\r\n\r\n    return this._modaldata;\r\n  }\r\n\r\n  popModal() {\r\n    if (this._modaldata === undefined) {\r\n      console.warn(\"Invalid call to UIBase.prototype.popModal\");\r\n      return;\r\n    }\r\n\r\n    //this.ctx = this._modalstack.pop();\r\n    popModalLight(this._modaldata);\r\n    this._modaldata = undefined;\r\n  }\r\n\r\n  /** child classes can override this to prevent focus on flash*/\r\n  _flash_focus() {\r\n    this.focus();\r\n  }\r\n\r\n  flash(color, rect_element = this, timems = 355, autoFocus = true) {\r\n    if (typeof color != \"object\") {\r\n      color = css2color(color);\r\n    }\r\n    color = new Vector4(color);\r\n    let csscolor = color2css(color);\r\n\r\n    if (this._flashtimer !== undefined && this._flashcolor !== csscolor) {\r\n      window.setTimeout(() => {\r\n        this.flash(color, rect_element, timems, autoFocus);\r\n      }, 100);\r\n\r\n      return;\r\n    } else if (this._flashtimer !== undefined) {\r\n      return;\r\n    }\r\n\r\n    //let rect = rect_element.getClientRects()[0];\r\n    let rect = rect_element.getBoundingClientRect();\r\n\r\n    if (rect === undefined) {\r\n      return;\r\n    }\r\n\r\n    //okay, dom apparently calls onchange() on .remove, so we have\r\n    //to put the timer code first to avoid loops\r\n    let timer;\r\n    let tick = 0;\r\n    let max = ~~(timems/20);\r\n\r\n    let x = rect.x, y = rect.y;\r\n\r\n    let cb = (e) => {\r\n      if (timer === undefined) {\r\n        return\r\n      }\r\n\r\n      let a = 1.0 - tick/max;\r\n      div.style[\"background-color\"] = color2css(color, a*a*0.5);\r\n\r\n      if (tick > max) {\r\n        window.clearInterval(timer);\r\n\r\n        this._flashtimer = undefined;\r\n        this._flashcolor = undefined;\r\n        timer = undefined;\r\n\r\n        div.remove();\r\n\r\n        if (autoFocus) {\r\n          this._flash_focus();\r\n        }\r\n      }\r\n\r\n      tick++;\r\n    };\r\n\r\n    window.setTimeout(cb, 5);\r\n    this._flashtimer = timer = window.setInterval(cb, 20);\r\n\r\n    let div = document.createElement(\"div\");\r\n\r\n    div.style[\"pointer-events\"] = \"none\";\r\n    div.tabIndex = undefined;\r\n    div.style[\"z-index\"] = \"900\";\r\n    div.style[\"display\"] = \"float\";\r\n    div.style[\"position\"] = UIBase.PositionKey;\r\n    div.style[\"margin\"] = \"0px\";\r\n    div.style[\"left\"] = x + \"px\";\r\n    div.style[\"top\"] = y + \"px\";\r\n\r\n    div.style[\"background-color\"] = color2css(color, 0.5);\r\n    div.style[\"width\"] = rect.width + \"px\";\r\n    div.style[\"height\"] = rect.height + \"px\";\r\n    div.setAttribute(\"class\", \"UIBaseFlash\");\r\n\r\n    let screen = this.getScreen();\r\n    if (screen !== undefined) {\r\n      screen._enterPopupSafe();\r\n    }\r\n\r\n    document.body.appendChild(div);\r\n    if (autoFocus) {\r\n      this._flash_focus();\r\n    }\r\n\r\n    this._flashcolor = csscolor;\r\n\r\n    if (screen !== undefined) {\r\n      screen._exitPopupSafe();\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n  }\r\n\r\n  on_resize(newsize) {\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = {};\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      ret.datapath = this.getAttribute(\"datapath\");\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    if (!this._init_done) {\r\n      this._init();\r\n    }\r\n  }\r\n\r\n  getPathValue(ctx, path) {\r\n    try {\r\n      return ctx.api.getValue(ctx, path);\r\n    } catch (error) {\r\n      //report(\"data path error in ui for\" + path);\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  undoBreakPoint() {\r\n    this.pathUndoGen++;\r\n  }\r\n\r\n  setPathValueUndo(ctx, path, val) {\r\n    this.pathSocketUpdate(ctx, path);\r\n\r\n    let mass_set_path = this.getAttribute(\"mass_set_path\");\r\n    let rdef = ctx.api.resolvePath(ctx, path);\r\n    let prop = rdef.prop;\r\n\r\n    if (ctx.api.getValue(ctx, path) === val) {\r\n      return;\r\n    }\r\n\r\n    let toolstack = this.ctx.toolstack;\r\n    let head = toolstack.head;\r\n\r\n    let bad = head === undefined || !(head instanceof getDataPathToolOp());\r\n    bad = bad || head.hashThis() !== head.hash(mass_set_path, path, prop.type, this._id);\r\n    bad = bad || this.pathUndoGen !== this._lastPathUndoGen;\r\n\r\n    //if (head !== undefined && head instanceof getDataPathToolOp()) {\r\n    //console.log(\"===>\", bad, head.hashThis());\r\n    //console.log(\"    ->\", head.hash(mass_set_path, path, prop.type, this._id));\r\n    //}\r\n\r\n    if (!bad) {\r\n      toolstack.undo();\r\n      head.setValue(ctx, val, rdef.obj);\r\n      toolstack.redo();\r\n    } else {\r\n      this._lastPathUndoGen = this.pathUndoGen;\r\n\r\n      let toolop = getDataPathToolOp().create(ctx, path, val, this._id, mass_set_path);\r\n\r\n      /* getDataPathToolOp.create can return false in case of no-op paths. */\r\n      if (!toolop) {\r\n        return;\r\n      }\r\n\r\n      ctx.toolstack.execTool(this.ctx, toolop);\r\n      head = toolstack.head;\r\n    }\r\n\r\n    if (!head || head.hadError === true) {\r\n      throw new Error(\"toolpath error\");\r\n    }\r\n  }\r\n\r\n  loadNumConstraints(prop = undefined, dom = this, onModifiedCallback = undefined) {\r\n    let modified = false;\r\n\r\n    if (!prop) {\r\n      let path;\r\n\r\n      if (dom.hasAttribute(\"datapath\")) {\r\n        path = dom.getAttribute(\"datapath\");\r\n      }\r\n\r\n      if (path === undefined && this.hasAttribute(\"datapath\")) {\r\n        path = this.getAttribute(\"datapath\");\r\n      }\r\n\r\n      if (typeof path === \"string\") {\r\n        prop = this.getPathMeta(this.ctx, path);\r\n      }\r\n    }\r\n\r\n    let loadAttr = (propkey, domkey = key, thiskey = key) => {\r\n      let old = this[thiskey];\r\n\r\n      if (dom.hasAttribute(domkey)) {\r\n        this[thiskey] = parseFloat(dom.getAttribute(domkey));\r\n      } else if (prop) {\r\n        this[thiskey] = prop[propkey];\r\n      }\r\n\r\n      if (this[thiskey] !== old) {\r\n        modified = true;\r\n      }\r\n    }\r\n\r\n    for (let key of NumberConstraints) {\r\n      let thiskey = key, domkey = key;\r\n\r\n      if (key === \"range\") { //handled later\r\n        continue;\r\n      }\r\n\r\n      loadAttr(key, domkey, thiskey);\r\n    }\r\n\r\n    let oldmin = this.range[0];\r\n    let oldmax = this.range[1];\r\n\r\n    let range = prop ? prop.range : undefined;\r\n    if (range && !dom.hasAttribute(\"min\")) {\r\n      this.range[0] = range[0];\r\n    } else if (dom.hasAttribute(\"min\")) {\r\n      this.range[0] = parseFloat(dom.getAttribute(\"min\"));\r\n    }\r\n\r\n    if (range && !dom.hasAttribute(\"max\")) {\r\n      this.range[1] = range[1];\r\n    } else if (dom.hasAttribute(\"max\")) {\r\n      this.range[1] = parseFloat(dom.getAttribute(\"max\"));\r\n    }\r\n\r\n    if (this.range[0] !== oldmin || this.range[1] !== oldmax) {\r\n      modified = true;\r\n    }\r\n\r\n    let oldint = this.isInt;\r\n\r\n    if (dom.getAttribute(\"integer\")) {\r\n      let val = dom.getAttribute(\"integer\");\r\n      val = (\"\" + val).toLowerCase();\r\n\r\n      //handles anonymouse <numslider-x integer> case\r\n      this.isInt = val === \"null\" || val === \"true\" || val === \"yes\" || val === \"1\";\r\n    } else if (prop && prop instanceof IntProperty) {\r\n      this.isInt = true;\r\n    }\r\n\r\n    if (!this.isInt !== !oldint) {\r\n      modified = true;\r\n    }\r\n\r\n    let oldedit = this.editAsBaseUnit;\r\n\r\n    if (this.editAsBaseUnit === undefined) {\r\n      if (prop && (prop.flag & PropFlags.EDIT_AS_BASE_UNIT)) {\r\n        this.editAsBaseUnit = true;\r\n      } else {\r\n        this.editAsBaseUnit = false;\r\n      }\r\n    }\r\n\r\n    if (!this.editAsBaseUnit !== !oldedit) {\r\n      modified = true;\r\n    }\r\n\r\n    if (modified) {\r\n      this.setCSS();\r\n\r\n      if (onModifiedCallback) {\r\n        onModifiedCallback.call(this);\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n    adds a method call to the event queue,\r\n    but only if that method (for this instance, as differentiated\r\n    by ._id) isn't there already.\r\n\r\n    also, method won't be ran until this.ctx exists\r\n  */\r\n\r\n  pushReportContext(key) {\r\n    if (this.ctx.api.pushReportContext) {\r\n      this.ctx.api.pushReportContext(key);\r\n    }\r\n  }\r\n\r\n  popReportContext() {\r\n    if (this.ctx.api.popReportContext)\r\n      this.ctx.api.popReportContext();\r\n  }\r\n\r\n  pathSocketUpdate(ctx, path) {\r\n    this.flagPropSocketUpdate(\"value\");\r\n    return this;\r\n  }\r\n\r\n  setPathValue(ctx, path, val) {\r\n    this.pathSocketUpdate(ctx, path);\r\n\r\n    if (this.useDataPathUndo) {\r\n      this.pushReportContext(this._reportCtxName);\r\n\r\n      try {\r\n        this.setPathValueUndo(ctx, path, val);\r\n      } catch (error) {\r\n        this.popReportContext();\r\n\r\n        if (!(error instanceof DataPathError)) {\r\n          throw error;\r\n        } else {\r\n          return;\r\n        }\r\n      }\r\n\r\n      this.popReportContext();\r\n      return;\r\n    }\r\n\r\n    this.pushReportContext(this._reportCtxName);\r\n\r\n    try {\r\n      if (this.hasAttribute(\"mass_set_path\")) {\r\n        ctx.api.massSetProp(ctx, this.getAttribute(\"mass_set_path\"), val);\r\n        ctx.api.setValue(ctx, path, val);\r\n      } else {\r\n        ctx.api.setValue(ctx, path, val);\r\n      }\r\n    } catch (error) {\r\n      this.popReportContext();\r\n\r\n      if (!(error instanceof DataPathError)) {\r\n        throw error;\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    this.popReportContext();\r\n  }\r\n\r\n  getPathMeta(ctx, path) {\r\n    this.pushReportContext(this._reportCtxName);\r\n    let ret = ctx.api.resolvePath(ctx, path);\r\n    this.popReportContext();\r\n\r\n    return ret !== undefined ? ret.prop : undefined;\r\n  }\r\n\r\n  getPathDescription(ctx, path) {\r\n    let ret;\r\n    this.pushReportContext(this._reportCtxName);\r\n\r\n    try {\r\n      ret = ctx.api.getDescription(ctx, path);\r\n    } catch (error) {\r\n      this.popReportContext();\r\n\r\n      if (error instanceof DataPathError) {\r\n        //console.warn(\"Invalid data path '\" + path + \"'\");\r\n        return undefined;\r\n      } else {\r\n        throw error;\r\n      }\r\n    }\r\n\r\n    this.popReportContext();\r\n    return ret;\r\n  }\r\n\r\n  getScreen() {\r\n    if (this.ctx !== undefined)\r\n      return this.ctx.screen;\r\n  }\r\n\r\n  isDead() {\r\n    return !this.isConnected;\r\n    let p = this, lastp = this;\r\n\r\n    function find(c, n) {\r\n      for (let n2 of c) {\r\n        if (n2 === n) {\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n\r\n    while (p) {\r\n      lastp = p;\r\n\r\n      let parent = p.parentWidget;\r\n      if (!parent) {\r\n        parent = p.parentElement ? p.parentElement : p.parentNode;\r\n      }\r\n\r\n      if (parent && p && !find(parent.childNodes, p)) {\r\n        if (parent.shadow !== undefined && !find(parent.shadow.childNodes)) {\r\n          return true;\r\n        }\r\n      }\r\n      p = parent;\r\n\r\n      if (p === document.body) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  doOnce(func, timeout = undefined) {\r\n    if (func._doOnce === undefined) {\r\n      func._doOnce_reqs = new Set();\r\n\r\n      func._doOnce = function (thisvar, trace) {\r\n        if (func._doOnce_reqs.has(thisvar._id)) {\r\n          return;\r\n        }\r\n\r\n        func._doOnce_reqs.add(thisvar._id);\r\n\r\n        function f() {\r\n          if (thisvar.isDead()) {\r\n            func._doOnce_reqs.delete(thisvar._id);\r\n\r\n            if (func === thisvar._init || !cconst.DEBUG.doOnce) {\r\n              return;\r\n            }\r\n\r\n            console.warn(\"Ignoring doOnce call for dead element\", thisvar._id, func, trace);\r\n            return;\r\n          }\r\n\r\n          if (!thisvar.ctx) {\r\n            if (cconst.DEBUG.doOnce) {\r\n              console.warn(\"doOnce call is waiting for context...\", thisvar._id, func);\r\n            }\r\n\r\n            internalSetTimeout(f, 0);\r\n            return;\r\n          }\r\n\r\n          func._doOnce_reqs.delete(thisvar._id);\r\n          func.call(thisvar);\r\n        };\r\n\r\n        internalSetTimeout(f, timeout);\r\n      }\r\n    }\r\n\r\n    let trace = new Error().stack;\r\n    func._doOnce(this, trace);\r\n  }\r\n\r\n  float(x = 0, y = 0, zindex = undefined, positionKey = UIBase.PositionKey) {\r\n    this.style.position = positionKey;\r\n\r\n    this.style.left = x + \"px\";\r\n    this.style.top = y + \"px\";\r\n\r\n    if (zindex !== undefined) {\r\n      this.style[\"z-index\"] = zindex\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  _ensureChildrenCtx() {\r\n    let ctx = this.ctx;\r\n    if (ctx === undefined) {\r\n      return;\r\n    }\r\n\r\n    this._forEachChildWidget((n) => {\r\n      n.parentWidget = this;\r\n\r\n      if (n.ctx === undefined) {\r\n        n.ctx = ctx;\r\n      }\r\n\r\n      n._ensureChildrenCtx(ctx);\r\n    });\r\n  }\r\n\r\n  checkThemeUpdate() {\r\n    if (!cconst.enableThemeAutoUpdate) {\r\n      return false;\r\n    }\r\n\r\n    if (_themeUpdateKey !== this._last_theme_update_key) {\r\n      this._last_theme_update_key = _themeUpdateKey;\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  abortToolTips(delayMs = 500) {\r\n    if (this._has_own_tooltips) {\r\n      this._has_own_tooltips.stop_timer();\r\n    }\r\n\r\n    if (this._tooltip_ref) {\r\n      this._tooltip_ref.remove();\r\n      this._tooltip_ref = undefined;\r\n    }\r\n\r\n    this._tool_tip_abort_delay = util.time_ms() + delayMs;\r\n\r\n    return this;\r\n  }\r\n\r\n  updateToolTipHandlers() {\r\n    if (!this._useNativeToolTips_set && !cconst.useNativeToolTips !== !this._useNativeToolTips) {\r\n      this._useNativeToolTips = cconst.useNativeToolTips;\r\n    }\r\n\r\n    if (!!this.useNativeToolTips === !this._has_own_tooltips) {\r\n      return;\r\n    }\r\n\r\n    if (!this.useNativeToolTips) {\r\n      let state = this._has_own_tooltips = {\r\n        start_timer : (e) => {\r\n          this._tooltip_timer = util.time_ms();\r\n          //console.warn(this._id, \"tooltip timer start\", e.type);\r\n        },\r\n        stop_timer  : (e) => {\r\n          //console.warn(this._id, \"tooltip timer end\", util.time_ms()-this._tooltip_timer, e.type);\r\n          this._tooltip_timer = undefined;\r\n        },\r\n        reset_timer : (e) => {\r\n          //console.warn(this._id, \"tooltip timer reset\", util.time_ms()-this._tooltip_timer, e.type);\r\n          if (this._tooltip_timer !== undefined) {\r\n            this._tooltip_timer = util.time_ms();\r\n          }\r\n        },\r\n        start_events: [\r\n          \"mouseover\"\r\n        ],\r\n        reset_events: [\r\n          \"mousemove\", \"mousedown\", \"mouseup\",\r\n          \"touchstart\", \"touchend\", \"keydown\", \"focus\"\r\n        ],\r\n        stop_events : [\r\n          \"mouseleave\", \"blur\", \"mouseout\"\r\n        ],\r\n        handlers    : {}\r\n      }\r\n\r\n      let bind_handler = (type, etype) => {\r\n        let handler = (e) => {\r\n          if (this._tool_tip_abort_delay !== undefined && util.time_ms() < this._tool_tip_abort_delay) {\r\n            this._tooltip_timer = undefined;\r\n            return;\r\n          }\r\n\r\n          state[type](e);\r\n        };\r\n\r\n        if (etype in state.handlers) {\r\n          console.error(type, \"is in handlers already\");\r\n          return;\r\n        }\r\n\r\n        state.handlers[etype] = handler;\r\n        return handler;\r\n      }\r\n\r\n      let i = 0;\r\n      let lists = [state.start_events, state.stop_events, state.reset_events];\r\n\r\n      for (let type of [\"start_timer\", \"stop_timer\", \"reset_timer\"]) {\r\n        for (let etype of lists[i]) {\r\n          this.addEventListener(etype, bind_handler(type, etype), {passive: true});\r\n        }\r\n\r\n        i++;\r\n      }\r\n    } else {\r\n      console.warn(this.id, \"removing tooltip handlers\");\r\n      let state = this._has_own_tooltips;\r\n\r\n      for (let k in this.state.handlers) {\r\n        let handler = this.state.handlers[k];\r\n        this.removeEventListener(k, handler);\r\n      }\r\n\r\n      this._has_own_tooltips = undefined;\r\n      this._tooltip_timer = undefined;\r\n    }\r\n  }\r\n\r\n  updateToolTips() {\r\n    if (this._description_final === undefined || this._description_final === null ||\r\n      this._description_final.trim().length === 0) {\r\n      return;\r\n    }\r\n\r\n    if (!this.ctx || !this.ctx.screen) {\r\n      return;\r\n    }\r\n\r\n    this.updateToolTipHandlers();\r\n\r\n    if (this.useNativeToolTips || this._tooltip_timer === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this._tool_tip_abort_delay !== undefined && util.time_ms() < this._tool_tip_abort_delay) {\r\n      return;\r\n    }\r\n\r\n    this._tool_tip_abort_delay = undefined;\r\n\r\n    let screen = this.ctx.screen;\r\n\r\n    const timelimit = 500;\r\n    let ok = util.time_ms() - this._tooltip_timer > timelimit;\r\n\r\n    let x = screen.mpos[0], y = screen.mpos[1];\r\n\r\n    let r = this.getClientRects();\r\n    r = r ? r[0] : r;\r\n\r\n    if (!r) {\r\n      ok = false;\r\n    } else {\r\n      ok = ok && x >= r.x && x < r.x + r.width;\r\n      ok = ok && y >= r.y && y < r.y + r.height;\r\n    }\r\n\r\n\r\n    //console.log(r);\r\n    if (r) {\r\n      //console.warn(this._id, \"possible tooltip\", x, y, r.x-3, r.y-3, r.width, r.height);\r\n    }\r\n\r\n    ok = ok && !haveModal();\r\n    ok = ok && screen.pickElement(x, y) === this;\r\n    ok = ok && this._description_final;\r\n\r\n    if (ok) {\r\n      //console.warn(\"Showing tooltop\", this.id);\r\n      this._tooltip_ref = _ToolTip.show(this._description_final, this.ctx.screen, x, y);\r\n    } else {\r\n      if (this._tooltip_ref) {\r\n        this._tooltip_ref.remove();\r\n      }\r\n\r\n      this._tooltip_ref = undefined;\r\n    }\r\n\r\n    //console.warn(this._id, \"tooltip timer end\");\r\n    if (util.time_ms() - this._tooltip_timer > timelimit) {\r\n      this._tooltip_timer = undefined;\r\n    }\r\n  }\r\n\r\n  updateEventGraph() {\r\n    if (!this.isConnected) {\r\n      this.#reflagGraph = true;\r\n    } else if (this.#reflagGraph) {\r\n      this.#reflagGraph = false;\r\n\r\n      for (let [k, sock] of Object.entries(this.graphNode.inputs)) {\r\n        sock.flagUpdate();\r\n      }\r\n    }\r\n  }\r\n\r\n  //called regularly\r\n  update() {\r\n    this.updateToolTips();\r\n    this.updateEventGraph();\r\n\r\n    if (this.ctx && this._description === undefined && this.getAttribute(\"datapath\")) {\r\n      let d = this.getPathDescription(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n      this.description = d;\r\n    }\r\n\r\n    if (!this._init_done) {\r\n      this._init();\r\n    }\r\n\r\n    if (this._init_done && !this.constructor.define().subclassChecksTheme) {\r\n      if (this.checkThemeUpdate()) {\r\n        console.log(\"theme update!\");\r\n\r\n        this.setCSS();\r\n      }\r\n    }\r\n  }\r\n\r\n  onadd() {\r\n    //if (this.parentWidget !== undefined) {\r\n    //  this._useDataPathUndo = this.parentWidget._useDataPathUndo;\r\n    //}\r\n\r\n    if (!this._init_done) {\r\n      this.doOnce(this._init);\r\n    }\r\n\r\n    if (this.tabIndex >= 0) {\r\n      this.regenTabOrder();\r\n    }\r\n  }\r\n\r\n  getZoom() {\r\n    if (this.parentWidget !== undefined) {\r\n      return this.parentWidget.getZoom();\r\n    }\r\n\r\n    return 1.0;\r\n  }\r\n\r\n  /**try to use this method\r\n\r\n   scaling ratio (e.g. for high-resolution displays)\r\n   for zoom ratio use getZoom()\r\n   */\r\n  getDPI() {\r\n    if (this.parentWidget !== undefined) {\r\n      return this.parentWidget.getDPI();\r\n    }\r\n\r\n    return UIBase.getDPI();\r\n  }\r\n\r\n  /**\r\n   * for saving ui state.\r\n   * see saveUIData() export\r\n   *\r\n   * should fail gracefully.\r\n   */\r\n  saveData() {\r\n    return {};\r\n  }\r\n\r\n  /**\r\n   * for saving ui state.\r\n   * see saveUIData() export\r\n   *\r\n   * should fail gracefully.\r\n   *\r\n   * also, it doesn't rebuild the object graph,\r\n   * it patches it; for true serialization use\r\n   * the toJSON/loadJSON or STRUCT interfaces.\r\n   */\r\n  loadData(obj) {\r\n    return this;\r\n  }\r\n\r\n  overrideDefault(key, val, localOnly = false) {\r\n    this.my_default_overrides[key] = val;\r\n\r\n    if (!localOnly) {\r\n      this.default_overrides[key] = val;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  overrideClass(style) {\r\n    this._override_class = style;\r\n  }\r\n\r\n  overrideClassDefault(style, key, val) {\r\n    if (!(style in this.class_default_overrides)) {\r\n      this.class_default_overrides[style] = {};\r\n    }\r\n\r\n    this.class_default_overrides[style][key] = val;\r\n  }\r\n\r\n  _doMobileDefault(key, val, obj) {\r\n    if (!util.isMobile())\r\n      return val;\r\n\r\n    const mobilekey = key + \"_mobile\";\r\n    if (obj && mobilekey in obj) {\r\n      return obj[mobilekey];\r\n    }\r\n\r\n    key = key.toLowerCase();\r\n    let ok = false;\r\n\r\n    for (let re of _mobile_theme_patterns) {\r\n      if (key.search(re) >= 0) {\r\n        ok = true;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (ok && theme.base.mobileSizeMultiplier) {\r\n      val *= theme.base.mobileSizeMultiplier;\r\n    }\r\n\r\n    return val;\r\n  }\r\n\r\n  hasDefault(key) {\r\n    let p = this;\r\n\r\n    while (p) {\r\n      if (key in p.default_overrides) {\r\n        return true;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    return this.hasClassDefault(key);\r\n  }\r\n\r\n  hasSubDefault(key, subkey) {\r\n    return this._hasSubDefault(...arguments, theme)\r\n      || this._themeOverride && this._hasSubDefault(...arguments, this._themeOverride);\r\n  }\r\n\r\n  _hasSubDefault(key, subkey) {\r\n    let style = this.getStyleClass();\r\n\r\n    let obj = this.getDefault(key);\r\n\r\n    if (!obj || typeof obj !== \"object\") {\r\n      return false;\r\n    }\r\n\r\n    return subkey in obj;\r\n  }\r\n\r\n  hasClassSubDefault(key, subkey, inherit = true) {\r\n    return this._hasClassSubDefault(key, subkey, inherit, undefined, theme) ||\r\n      this._themeOverride && this._hasClassSubDefault(key, subkey, inherit, undefined, this._themeOverride);\r\n  }\r\n\r\n  _hasClassSubDefault(key, subkey, inherit = true, style = this.getStyleClass(), themeDef) {\r\n    let th = themeDef;\r\n    th = th[style];\r\n\r\n    if (inherit) {\r\n      if (this._hasClassSubDefault(key, subkey, false, themeDef)) {\r\n        return true;\r\n      }\r\n\r\n      let ret = false;\r\n      let def = this.constructor.define();\r\n\r\n      if (def.parentStyle) {\r\n        ret |= this._hasClassSubDefault(key, subkey, false, def.parentStyle, themeDef);\r\n      }\r\n      ret |= this._hasClassSubDefault(key, subkey, false, \"base\", themeDef);\r\n      return ret;\r\n    }\r\n\r\n    if (!th) {\r\n      return false;\r\n    }\r\n\r\n    let obj = th[key];\r\n    if (!obj || typeof obj !== \"object\") {\r\n      return false;\r\n    }\r\n\r\n    return subkey in obj;\r\n  }\r\n\r\n  /** get a sub style from a theme style class.\r\n   *  note that if key is falsy then it just forwards to this.getDefault directly*/\r\n  getSubDefault(key, subkey, backupkey = subkey, defaultval = undefined, inherit = true) {\r\n    /* Check if client code manually overrode a theme key for this instance. */\r\n    if (subkey && subkey in this.my_default_overrides) {\r\n      //return this.getDefault(subkey, undefined, defaultval);\r\n    }\r\n\r\n    if (!key) {\r\n      return this.getDefault(subkey, undefined, defaultval, inherit);\r\n    }\r\n\r\n    let style = this.getDefault(key, undefined, undefined, inherit);\r\n\r\n    if (!style || typeof style !== \"object\" || !(subkey in style)) {\r\n      if (defaultval !== undefined) {\r\n        return defaultval;\r\n      } else if (backupkey) {\r\n        return this.getDefault(backupkey, undefined, undefined, inherit);\r\n      }\r\n    } else {\r\n      return style[subkey];\r\n    }\r\n  }\r\n\r\n  getDefault(key, checkForMobile = true, defaultval = undefined, inherit = true) {\r\n    let ret = this.getDefault_intern(key, checkForMobile, defaultval, inherit);\r\n\r\n    //convert pixel units straight to numbers\r\n    if (typeof ret === \"string\" && ret.trim().toLowerCase().endsWith(\"px\")) {\r\n      let s = ret.trim().toLowerCase();\r\n      s = s.slice(0, s.length - 2).trim();\r\n\r\n      let f = parseFloat(s);\r\n      if (!isNaN(f) && isFinite(f)) {\r\n        return f;\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  getDefault_intern(key, checkForMobile = true, defaultval = undefined, inherit = true) {\r\n    if (this.my_default_overrides[key] !== undefined) {\r\n      let v = this.my_default_overrides[key];\r\n      return checkForMobile ? this._doMobileDefault(key, v, this.my_default_overrides) : v;\r\n    }\r\n\r\n    let p = this;\r\n    while (p) {\r\n      if (p.default_overrides[key] !== undefined) {\r\n        let v = p.default_overrides[key];\r\n        checkForMobile ? this._doMobileDefault(key, v, p.default_overrides) : v;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    return this.getClassDefault(key, checkForMobile, defaultval, inherit);\r\n  }\r\n\r\n  getStyleClass() {\r\n    if (this._override_class !== undefined) {\r\n      return this._override_class;\r\n    }\r\n\r\n    let p = this.constructor, lastp = undefined;\r\n\r\n    while (p && p !== lastp && p !== UIBase && p !== Object) {\r\n      let def = p.define();\r\n\r\n      if (def.style) {\r\n        return def.style;\r\n      }\r\n\r\n      if (!p.prototype || !p.prototype.__proto__)\r\n        break;\r\n\r\n      p = p.prototype.__proto__.constructor;\r\n    }\r\n\r\n    return \"base\";\r\n  }\r\n\r\n  hasClassDefault(key) {\r\n    let style = this.getStyleClass();\r\n\r\n    let p = this;\r\n    while (p) {\r\n      let def = p.class_default_overrides[style];\r\n\r\n      if (def && (key in def)) {\r\n        return true;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    let th = this._themeOverride;\r\n\r\n    if (th && style in th && key in th[style]) {\r\n      return true;\r\n    }\r\n\r\n    if (style in theme && key in theme[style]) {\r\n      return true;\r\n    }\r\n\r\n    return key in theme.base;\r\n  }\r\n\r\n  getClassDefault(key, checkForMobile = true, defaultval = undefined, inherit = true) {\r\n    let style = this.getStyleClass();\r\n\r\n    if (style === \"none\") {\r\n      return undefined;\r\n    }\r\n\r\n    let themeobj;\r\n    let val;\r\n    let p = this;\r\n\r\n    while (p) {\r\n      let def = p.class_default_overrides[style];\r\n\r\n      if (def && (key in def)) {\r\n        themeobj = def;\r\n        val = def[key];\r\n        break;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    if (val === undefined && style in theme && !(key in theme[style]) && !(key in theme.base)) {\r\n      if (window.DEBUG.theme) {\r\n        report(\"Missing theme key \", key, \"for\", style);\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let th = !i ? this._themeOverride : theme;\r\n\r\n      if (!th) {\r\n        continue;\r\n      }\r\n\r\n      if (val === undefined && style in th && key in th[style]) {\r\n        themeobj = th[style];\r\n        val = th[style][key];\r\n      } else if (defaultval !== undefined) {\r\n        themeobj = undefined;\r\n        val = defaultval;\r\n      } else if (val === undefined && inherit) {\r\n        let def = this.constructor.define();\r\n\r\n        if (def.parentStyle && key in th[def.parentStyle]) {\r\n          val = th[def.parentStyle][key];\r\n          themeobj = th[def.parentStyle];\r\n        } else {\r\n          val = th.base[key];\r\n          themeobj = th.base;\r\n        }\r\n      }\r\n    }\r\n\r\n    return checkForMobile ? this._doMobileDefault(key, val, themeobj) : val;\r\n  }\r\n\r\n  overrideTheme(theme) {\r\n    this._themeOverride = theme;\r\n\r\n    this._forEachChildWidget((child) => {\r\n      child.overrideTheme(theme);\r\n    });\r\n\r\n    if (this.ctx) {\r\n      this.flushSetCSS();\r\n      this.flushUpdate();\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  getStyle() {\r\n    console.warn(\"deprecated call to UIBase.getStyle\");\r\n    return this.getStyleClass();\r\n  }\r\n\r\n  /** returns a new Animator instance\r\n   *\r\n   * example:\r\n   *\r\n   * container.animate().goto(\"style.width\", 500, 100, \"ease\");\r\n   * */\r\n  animate(_extra_handlers = {}, domAnimateOptions=undefined) {\r\n    /* User is providing DOM animation data. */\r\n    if (Array.isArray(_extra_handlers)) {\r\n      return super.animate(_extra_handlers, domAnimateOptions)\r\n    }\r\n\r\n    let transform = new DOMMatrix(this.style[\"transform\"]);\r\n\r\n    let update_trans = () => {\r\n      let t = transform;\r\n      let css = \"matrix(\" + t.a + \",\" + t.b + \",\" + t.c + \",\" + t.d + \",\" + t.e + \",\" + t.f + \")\";\r\n      this.style[\"transform\"] = css;\r\n    }\r\n\r\n    let handlers = {\r\n      background_get() {\r\n        return css2color(this.background);\r\n      },\r\n\r\n      background_set(c) {\r\n        if (typeof c !== \"string\") {\r\n          c = color2css(c);\r\n        }\r\n        this.background = c;\r\n      },\r\n\r\n      dx_get() {\r\n        return transform.m41;\r\n      },\r\n      dx_set(x) {\r\n        transform.m41 = x;\r\n        update_trans();\r\n      },\r\n\r\n      dy_get() {\r\n        return transform.m42;\r\n      },\r\n      dy_set(x) {\r\n        transform.m42 = x;\r\n        update_trans();\r\n      }\r\n    }\r\n\r\n    let pixkeys = [\"width\", \"height\", \"left\", \"top\", \"right\", \"bottom\", \"border-radius\",\r\n                   \"border-width\", \"margin\", \"padding\", \"margin-left\", \"margin-right\",\r\n                   \"margin-top\", \"margin-bottom\", \"padding-left\", \"padding-right\", \"padding-bottom\",\r\n                   \"padding-top\"];\r\n    handlers = Object.assign(handlers, _extra_handlers);\r\n\r\n    let makePixHandler = (k, k2) => {\r\n      handlers[k2 + \"_get\"] = () => {\r\n        let s = this.style[k];\r\n\r\n        if (s.endsWith(\"px\")) {\r\n          return parsepx(s);\r\n        } else {\r\n          return 0.0;\r\n        }\r\n      }\r\n\r\n      handlers[k2 + \"_set\"] = (val) => {\r\n        this.style[k] = val + \"px\";\r\n      }\r\n    }\r\n\r\n    for (let k of pixkeys) {\r\n      if (!(k in handlers)) {\r\n        makePixHandler(k, `style.${k}`);\r\n        makePixHandler(k, `style[\"${k}\"]`);\r\n        makePixHandler(k, `style['${k}']`);\r\n      }\r\n    }\r\n\r\n    let handler = {\r\n      get: (target, key, receiver) => {\r\n        console.log(key, handlers[key + \"_get\"], handlers);\r\n\r\n        if ((key + \"_get\") in handlers) {\r\n          return handlers[key + \"_get\"].call(target);\r\n        } else {\r\n          return target[key];\r\n        }\r\n      },\r\n      set: (target, key, val, receiver) => {\r\n        console.log(key);\r\n\r\n        if ((key + \"_set\") in handlers) {\r\n          handlers[key + \"_set\"].call(target, val);\r\n        } else {\r\n          target[key] = val;\r\n        }\r\n\r\n        return true;\r\n      }\r\n    }\r\n\r\n    let proxy = new Proxy(this, handler);\r\n    let anim = new Animator(proxy);\r\n\r\n    anim.onend = () => {\r\n      this._active_animations.remove(anim);\r\n    }\r\n\r\n    this._active_animations.push(anim);\r\n    return anim;\r\n  }\r\n\r\n  abortAnimations() {\r\n    for (let anim of util.list(this._active_animations)) {\r\n      anim.end();\r\n    }\r\n\r\n    this._active_animations = [];\r\n  }\r\n}\r\n\r\nexport function drawRoundBox2(elem, options = {}) {\r\n  drawRoundBox(elem, options.canvas, options.g, options.width, options.height, options.r, options.op, options.color, options.margin, options.no_clear);\r\n}\r\n\r\n/**okay, I need to refactor this function,\r\n it needs to take x, y as well as width, height,\r\n and be usable for more use cases.*/\r\nexport function drawRoundBox(elem, canvas, g, width, height, r      = undefined,\r\n                             op = \"fill\", color = undefined, margin = undefined,\r\n                             no_clear                               = false) {\r\n  width = width === undefined ? canvas.width : width;\r\n  height = height === undefined ? canvas.height : height;\r\n  g.save();\r\n\r\n  let dpi = elem.getDPI();\r\n\r\n  r = r === undefined ? elem.getDefault(\"border-radius\") : r;\r\n\r\n  if (margin === undefined) {\r\n    margin = 1;\r\n  }\r\n\r\n  r *= dpi;\r\n  let r1 = r, r2 = r;\r\n\r\n  if (r > (height - margin*2)*0.5) {\r\n    r1 = (height - margin*2)*0.5;\r\n  }\r\n\r\n  if (r > (width - margin*2)*0.5) {\r\n    r2 = (width - margin*2)*0.5;\r\n  }\r\n\r\n  let bg = color;\r\n\r\n  if (bg === undefined && canvas._background !== undefined) {\r\n    bg = canvas._background;\r\n  } else if (bg === undefined) {\r\n    bg = elem.getDefault(\"background-color\");\r\n  }\r\n\r\n  if (op === \"fill\" && !no_clear) {\r\n    g.clearRect(0, 0, width, height);\r\n  }\r\n\r\n  g.fillStyle = bg;\r\n  //hackish!\r\n  g.strokeStyle = color === undefined ? elem.getDefault(\"border-color\") : color;\r\n\r\n  let w = width, h = height;\r\n\r\n  let th = Math.PI/4;\r\n  let th2 = Math.PI*0.75;\r\n\r\n  g.beginPath();\r\n\r\n  g.moveTo(margin, margin + r1);\r\n  g.lineTo(margin, h - r1 - margin);\r\n\r\n  g.quadraticCurveTo(margin, h - margin, margin + r2, h - margin);\r\n  g.lineTo(w - margin - r2, h - margin);\r\n\r\n  g.quadraticCurveTo(w - margin, h - margin, w - margin, h - margin - r1);\r\n  g.lineTo(w - margin, margin + r1);\r\n\r\n  g.quadraticCurveTo(w - margin, margin, w - margin - r2, margin);\r\n  g.lineTo(margin + r2, margin);\r\n\r\n  g.quadraticCurveTo(margin, margin, margin, margin + r1);\r\n  g.closePath();\r\n\r\n  if (op === \"clip\") {\r\n    g.clip();\r\n  } else if (op === \"fill\") {\r\n    g.fill();\r\n  } else {\r\n    g.stroke();\r\n  }\r\n\r\n  g.restore();\r\n};\r\n\r\nexport function _getFont_new(elem, size, font = \"DefaultText\", do_dpi = true) {\r\n\r\n  font = elem.getDefault(font);\r\n\r\n  return font.genCSS(size);\r\n}\r\n\r\nexport function getFont(elem, size, font = \"DefaultText\", do_dpi = true) {\r\n  return _getFont_new(elem, size, font = \"DefaultText\", do_dpi = true);\r\n}\r\n\r\n//size is optional, defaults to font's default size\r\nexport function _getFont(elem, size, font = \"DefaultText\", do_dpi = true) {\r\n  let dpi = elem.getDPI();\r\n\r\n  let font2 = elem.getDefault(font);\r\n  if (font2 !== undefined) {\r\n    //console.warn(\"New style font detected\", font2, font2.genCSS(size));\r\n    return _getFont_new(elem, size, font, do_dpi);\r\n  }\r\n\r\n  throw new Error(\"unknown font \" + font);\r\n}\r\n\r\nexport function _ensureFont(elem, canvas, g, size) {\r\n  if (canvas.font) {\r\n    g.font = canvas.font;\r\n  } else {\r\n    let font = elem.getDefault(\"DefaultText\");\r\n    g.font = font.genCSS(size);\r\n  }\r\n}\r\n\r\nlet _mc;\r\n\r\nfunction get_measure_canvas() {\r\n  if (_mc !== undefined) {\r\n    return _mc;\r\n  }\r\n\r\n  _mc = document.createElement(\"canvas\");\r\n  _mc.width = 256;\r\n  _mc.height = 256;\r\n  _mc.g = _mc.getContext(\"2d\");\r\n\r\n  return _mc;\r\n}\r\n\r\nexport function measureTextBlock(elem, text, canvas                    = undefined,\r\n                                 g = undefined, size = undefined, font = undefined) {\r\n  let lines = text.split(\"\\n\");\r\n\r\n  let ret = {\r\n    width : 0,\r\n    height: 0\r\n  };\r\n\r\n  if (size === undefined) {\r\n    if (font !== undefined && typeof font === \"object\") {\r\n      size = font.size;\r\n    }\r\n\r\n    if (size === undefined) {\r\n      size = elem.getDefault(\"DefaultText\").size;\r\n    }\r\n  }\r\n\r\n  for (let line of lines) {\r\n    let m = measureText(elem, line, canvas, g, size, font);\r\n\r\n    ret.width = Math.max(ret.width, m.width);\r\n    let h = m.height !== undefined ? m.height : size*1.25;\r\n\r\n    ret.height += h;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nexport function measureText(elem, text, canvas                    = undefined,\r\n                            g = undefined, size = undefined, font = undefined) {\r\n  if (typeof canvas === \"object\" && canvas !== null && !(canvas instanceof HTMLCanvasElement) && canvas.tagName !== \"CANVAS\") {\r\n    let args = canvas;\r\n\r\n    canvas = args.canvas;\r\n    g = args.g;\r\n    size = args.size;\r\n    font = args.font;\r\n\r\n  }\r\n\r\n  if (g === undefined) {\r\n    canvas = get_measure_canvas();\r\n    g = canvas.g;\r\n  }\r\n\r\n  if (font !== undefined) {\r\n    if (typeof font === \"object\" && font instanceof CSSFont) {\r\n      font = font.genCSS(size);\r\n    }\r\n\r\n    g.font = font;\r\n  } else {\r\n    _ensureFont(elem, canvas, g, size);\r\n  }\r\n\r\n  let ret = g.measureText(text);\r\n\r\n  if (size !== undefined) {\r\n    //clear custom font for next time\r\n    g.font = undefined;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n//export function drawText(elem, x, y, text, canvas, g, color=undefined, size=undefined, font=undefined) {\r\nexport function drawText(elem, x, y, text, args = {}) {\r\n  let canvas = args.canvas, g = args.g, color = args.color, font = args.font;\r\n  let size = args.size;\r\n\r\n  if (size === undefined) {\r\n    if (font !== undefined && font instanceof CSSFont) {\r\n      size = font.size;\r\n    } else {\r\n      size = elem.getDefault(\"DefaultText\").size;\r\n    }\r\n  }\r\n\r\n  size *= UIBase.getDPI();\r\n\r\n\r\n  if (color === undefined) {\r\n    if (font && font.color) {\r\n      color = font.color;\r\n    } else {\r\n      color = elem.getDefault(\"DefaultText\").color;\r\n    }\r\n  }\r\n\r\n  if (font === undefined) {\r\n    _ensureFont(elem, canvas, g, size);\r\n  } else if (typeof font === \"object\" && font instanceof CSSFont) {\r\n    g.font = font = font.genCSS(size);\r\n  } else if (font) {\r\n    g.font = font;\r\n  }\r\n\r\n  if (typeof color === \"object\") {\r\n    color = color2css(color);\r\n  }\r\n\r\n\r\n  g.fillStyle = color;\r\n  g.fillText(text, x + 0.5, y + 0.5);\r\n\r\n  if (size !== undefined) {\r\n    //clear custom font for next time\r\n    g.font = undefined;\r\n  }\r\n}\r\n\r\nlet PIDX = 0, PSHADOW = 1, PTOT = 2;\r\n\r\n/**\r\n\r\n Saves UI layout data, like panel layouts, active tabs, etc.\r\n Uses the UIBase.prototype.[save/load]Data interface.\r\n\r\n Note that this is error-tolerant.\r\n */\r\nexport function saveUIData(node, key) {\r\n  if (key === undefined) {\r\n    throw new Error(\"ui_base.saveUIData(): key cannot be undefined\");\r\n  }\r\n\r\n  let paths = [];\r\n\r\n  let rec = (n, path, ni, is_shadow) => {\r\n    path = path.slice(0, path.length); //copy path\r\n\r\n    let pi = path.length;\r\n    for (let i = 0; i < PTOT; i++) {\r\n      path.push(undefined);\r\n    }\r\n\r\n    path[pi] = ni;\r\n    path[pi + 1] = is_shadow ? 1 : 0;\r\n\r\n    if (n instanceof UIBase) {\r\n      let path2 = path.slice(0, path.length);\r\n      let data = n.saveData();\r\n\r\n      let bad = !data;\r\n      bad = bad || (typeof data === \"object\" && Object.keys(data).length === 0);\r\n\r\n      if (!bad) {\r\n        path2.push(data);\r\n\r\n        if (path2[pi + 2]) {\r\n          paths.push(path2);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < n.childNodes.length; i++) {\r\n      let n2 = n.childNodes[i];\r\n\r\n      rec(n2, path, i, false);\r\n    }\r\n\r\n    let shadow = n.shadow;\r\n\r\n    if (!shadow)\r\n      return;\r\n\r\n    for (let i = 0; i < shadow.childNodes.length; i++) {\r\n      let n2 = shadow.childNodes[i];\r\n\r\n      rec(n2, path, i, true);\r\n    }\r\n  }\r\n\r\n  rec(node, [], 0, false);\r\n\r\n  return JSON.stringify({\r\n    key        : key,\r\n    paths      : paths,\r\n    _ui_version: 1\r\n  });\r\n}\r\n\r\nwindow._saveUIData = saveUIData;\r\n\r\nexport function loadUIData(node, buf) {\r\n  if (buf === undefined || buf === null) {\r\n    return;\r\n  }\r\n\r\n  let obj = JSON.parse(buf);\r\n  let key = buf.key;\r\n\r\n  for (let path of obj.paths) {\r\n    let n = node;\r\n\r\n    let data = path[path.length - 1];\r\n    path = path.slice(2, path.length - 1); //in case some api doesn't want me calling .pop()\r\n\r\n    for (let pi = 0; pi < path.length; pi += PTOT) {\r\n      let ni = path[pi], shadow = path[pi + 1];\r\n\r\n      let list;\r\n\r\n      if (shadow) {\r\n        list = n.shadow;\r\n\r\n        if (list) {\r\n          list = list.childNodes;\r\n        }\r\n      } else {\r\n        list = n.childNodes;\r\n      }\r\n\r\n      if (list === undefined || list[ni] === undefined) {\r\n        //console.log(\"failed to load a ui data block\", path);\r\n        n = undefined;\r\n        break;\r\n      }\r\n\r\n      n = list[ni];\r\n    }\r\n\r\n    if (n !== undefined && n instanceof UIBase) {\r\n      n._init(); //ensure init's been called, _init will check if it has\r\n      n.loadData(data);\r\n\r\n      //console.log(n, path, data);\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.PositionKey = \"fixed\";\r\n\r\nwindow._loadUIData = loadUIData;\r\n\r\n//avoid explicit circular references\r\naspect._setUIBase(UIBase);\r\n//ui_save.setUIBase(UIBase);\r\n","\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as simple_toolsys from '../path-controller/toolsys/toolsys.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport {DataPathError} from '../path-controller/controller/controller.js';\r\nimport {Vector3, Vector4, Quat, Matrix4} from '../path-controller/util/vectormath.js';\r\nimport cconst from '../config/const.js';\r\nimport {_themeUpdateKey, CSSFont} from \"../core/ui_base.js\";\r\n\r\nlet keymap = events.keymap;\r\n\r\nlet EnumProperty = toolprop.EnumProperty,\r\n    PropTypes    = toolprop.PropTypes;\r\n\r\nlet UIBase     = ui_base.UIBase,\r\n    PackFlags  = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nlet parsepx = ui_base.parsepx;\r\n\r\ncconst.DEBUG.buttonEvents = true;\r\n\r\nexport class ButtonEventBase extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._auto_depress = true;\r\n    this._highlight = false;\r\n    this._pressed = false;\r\n  }\r\n\r\n  bindEvents() {\r\n    let press_gen = 0;\r\n    let depress;\r\n\r\n    let press = (e) => {\r\n      e.stopPropagation();\r\n\r\n      if (!this.modalRunning) {\r\n        let this2 = this;\r\n\r\n        this.pushModal({\r\n          on_pointerdown(e) {\r\n            this.end(e);\r\n          },\r\n\r\n          on_pointerup(e) {\r\n            this.end(e);\r\n          },\r\n\r\n          on_pointercancel(e) {\r\n            console.warn(\"Pointer cancel in button\");\r\n            this2.popModal();\r\n          },\r\n\r\n          on_keydown(e) {\r\n            switch (e.keyCode) {\r\n              case keymap[\"Enter\"]:\r\n              case keymap[\"Escape\"]:\r\n              case keymap[\"Space\"]:\r\n                this.end();\r\n                break;\r\n            }\r\n          },\r\n\r\n          end(e) {\r\n            if (!this2.modalRunning) {\r\n              return;\r\n            }\r\n\r\n            this2.popModal();\r\n            depress(e);\r\n          }\r\n        }, undefined, e.pointerId);\r\n      }\r\n\r\n      if (cconst.DEBUG.buttonEvents) {\r\n        console.log(\"button press\", this._pressed, this.disabled, e.button);\r\n      }\r\n\r\n      if (this.disabled) return;\r\n\r\n      this._pressed = true;\r\n\r\n      if (this._onpress) {\r\n        this._onpress(this);\r\n      }\r\n\r\n      this._redraw();\r\n\r\n      e.preventDefault();\r\n    };\r\n\r\n    depress = (e) => {\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(\"button depress\", e.button, e.was_touch);\r\n\r\n      if (this._auto_depress) {\r\n        this._pressed = false;\r\n\r\n        if (this.disabled) return;\r\n\r\n        this._redraw();\r\n      }\r\n\r\n      if (e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        if (util.isMobile() || e.type === \"pointerup\" && e.button) {\r\n          return;\r\n        }\r\n      }\r\n\r\n      this._redraw();\r\n\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(\"button click callback:\", this.onclick, this._onpress, this.onpress);\r\n\r\n      if (this.onclick && e && e.pointerType !== \"mouse\") {\r\n        this.onclick(this);\r\n      }\r\n\r\n      this.undoBreakPoint();\r\n    }\r\n\r\n    this.addEventListener(\"click\", () => {\r\n      this._pressed = false;\r\n      this._highlight = false;\r\n      this._redraw();\r\n    });\r\n\r\n    this.addEventListener(\"pointerdown\", press, {captured: true, passive: false});\r\n    this.addEventListener(\"pointerup\", depress, {captured: true, passive: false});\r\n    this.addEventListener(\"pointerover\", (e) => {\r\n      if (this.disabled)\r\n        return;\r\n\r\n      this._highlight = true;\r\n      this._redraw();\r\n    })\r\n\r\n    this.addEventListener(\"pointerout\", (e) => {\r\n      if (this.disabled)\r\n        return;\r\n\r\n      this._highlight = false;\r\n      this._redraw();\r\n    })\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      if (this.disabled) return;\r\n\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(e.keyCode);\r\n\r\n      switch (e.keyCode) {\r\n        case 27: //escape\r\n          this.blur();\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          break;\r\n        case 32: //spacebar\r\n        case 13: //enter\r\n          this.click();\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          break;\r\n      }\r\n    });\r\n\r\n    this.addEventListener(\"focusin\", () => {\r\n      if (this.disabled) return;\r\n\r\n      this._focus = 1;\r\n      this._redraw();\r\n      this.focus();\r\n    });\r\n\r\n    this.addEventListener(\"blur\", () => {\r\n      if (this.disabled) return;\r\n\r\n      this._focus = 0;\r\n      this._redraw();\r\n    });\r\n  }\r\n\r\n  _redraw() {\r\n\r\n  }\r\n}\r\n\r\nexport class Button extends ButtonEventBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.label = document.createElement(\"span\");\r\n    this.label.innerText = \"button\";\r\n    this.shadow.appendChild(this.label);\r\n\r\n    this.label.style[\"pointer-events\"] = \"none\";\r\n\r\n    this._pressed = false;\r\n    this._highlight = false;\r\n    this._pressedTime = 0;\r\n    this._pressedTimeout = 100;\r\n\r\n    this._auto_depress = true;\r\n\r\n    this._last_name = undefined;\r\n    this._last_disabled = undefined;\r\n  }\r\n\r\n  get name() {\r\n    return \"\" + this.getAttribute(\"name\");\r\n  }\r\n\r\n  set name(val) {\r\n    this.setAttribute(\"name\", val);\r\n  }\r\n\r\n  get _pressed() {\r\n    return this.__pressed;\r\n  }\r\n\r\n  set _pressed(v) {\r\n    let changed = !v !== !this._pressed;\r\n\r\n    if (v) {\r\n      this._pressedTime = util.time_ms();\r\n    } else if (changed && util.time_ms() - this._pressedTime < this._pressedTimeout) {\r\n      window.setTimeout(() => {\r\n        this.setCSS();\r\n      }, this._pressedTimeout - (util.time_ms() - this._pressedTime) + 1);\r\n    }\r\n\r\n    this.__pressed = v;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"button-x\",\r\n      style  : \"button\"\r\n    };\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this.tabIndex = 0;\r\n\r\n    this.bindEvents();\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  on_enabled() {\r\n    this.setCSS();\r\n  }\r\n\r\n  on_disabled() {\r\n    this.setCSS();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    if (this.hasDefault(\"pressedTimeout\")) {\r\n      this._pressedTimeout = this.getDefault(\"pressedTimeout\");\r\n    }\r\n\r\n    let subkey = undefined;\r\n\r\n    let pressed = this._pressed;\r\n    if (!pressed && util.time_ms() - this._pressedTime < this._pressedTimeout) {\r\n      pressed = true;\r\n    }\r\n\r\n    if (this.disabled) {\r\n      subkey = \"disabled\";\r\n    } else if (pressed && this._highlight) {\r\n      subkey = \"highlight-pressed\";\r\n    } else if (pressed) {\r\n      subkey = \"pressed\";\r\n    } else if (this._highlight) {\r\n      subkey = \"highlight\";\r\n    }\r\n\r\n    let h = this.getDefault(\"height\");\r\n\r\n    this.setBoxCSS(subkey);\r\n\r\n    this.label.style[\"padding\"] = this.label.style[\"margin\"] = \"0px\";\r\n    this.style[\"background-color\"] = this.getSubDefault(subkey, \"background-color\");\r\n\r\n    let font = this.getSubDefault(subkey, \"DefaultText\");\r\n    this.label.style[\"font\"] = font.genCSS();\r\n    this.label.style[\"color\"] = font.color;\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"align-items\"] = \"center\";\r\n    this.style[\"width\"] = \"max-content\";\r\n    this.style[\"height\"] = h + \"px\";\r\n\r\n    this.style[\"user-select\"] = \"none\";\r\n    this.label.style[\"user-select\"] = \"none\";\r\n  }\r\n\r\n  click() {\r\n    if (this._onpress) {\r\n      let rect = this.getClientRects();\r\n      let x = rect.x + rect.width*0.5;\r\n      let y = rect.y + rect.height*0.5;\r\n\r\n      let e = {\r\n        x                : x, y: y, stopPropagation: () => {\r\n        }, preventDefault: () => {\r\n        }\r\n      };\r\n\r\n      this._onpress(e);\r\n    }\r\n\r\n    super.click();\r\n  }\r\n\r\n  _redraw() {\r\n    this.setCSS();\r\n  }\r\n\r\n  updateDisabled() {\r\n    if (this._last_disabled !== this.disabled) {\r\n      this._last_disabled = this.disabled;\r\n\r\n      //setTimeout(() => {\r\n\r\n      this._redraw();\r\n\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(\"disabled update!\", this.disabled, this.style[\"background-color\"]);\r\n      //}, 100);\r\n    }\r\n  }\r\n\r\n  update() {\r\n    if (this._last_name !== this.name) {\r\n      this.label.innerHTML = this.name;\r\n      this._last_name = this.name;\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.register(Button);\r\n\r\n//use .setAttribute(\"linear\") to disable nonlinear sliding\r\nexport class OldButton extends ButtonEventBase {\r\n  constructor() {\r\n    super();\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    this._last_but_update_key = \"\";\r\n\r\n    this._name = \"\";\r\n    this._namePad = undefined;\r\n    this._leftPad = 5; //extra pad before text\r\n    this._rightPad = 5; //extra pad after text\r\n\r\n    this._last_w = 0;\r\n    this._last_h = 0;\r\n\r\n    this._last_dpi = dpi;\r\n\r\n    this._lastw = undefined;\r\n    this._lasth = undefined;\r\n\r\n    this.dom = document.createElement(\"canvas\");\r\n    this.g = this.dom.getContext(\"2d\");\r\n\r\n    this.dom.setAttribute(\"class\", \"canvas1\");\r\n    this.dom.tabIndex = 0;\r\n\r\n    this._last_bg = undefined;\r\n\r\n    this._last_disabled = false;\r\n    this._auto_depress = true;\r\n\r\n    this.shadow.appendChild(this.dom);\r\n  }\r\n\r\n  get r() {\r\n    return this.getDefault(\"border-radius\");\r\n  }\r\n\r\n  set r(val) {\r\n    this.overrideDefault(\"border-radius\", val);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"old-button-x\",\r\n      style  : \"button\"\r\n    };\r\n  }\r\n\r\n  click() {\r\n    if (this._onpress) {\r\n      let rect = this.getClientRects();\r\n      let x = rect.x + rect.width*0.5;\r\n      let y = rect.y + rect.height*0.5;\r\n\r\n      let e = {\r\n        x                : x, y: y, stopPropagation: () => {\r\n        }, preventDefault: () => {\r\n        }\r\n      };\r\n\r\n      this._onpress(e);\r\n    }\r\n\r\n    super.click();\r\n  }\r\n\r\n  init() {\r\n    let dpi = this.getDPI();\r\n\r\n    //set default dimensions\r\n    let width = ~~(this.getDefault(\"width\")*dpi);\r\n    let height = ~~(this.getDefault(\"height\")*dpi);\r\n\r\n    this.dom.width = width;\r\n    this.dom.height = height;\r\n\r\n    this.dom.style[\"width\"] = (width/dpi) + \"px\";\r\n    this.dom.style[\"height\"] = (height/dpi) + \"px\";\r\n    this.dom.style[\"padding\"] = this.dom.style[\"margin\"] = \"0px\";\r\n\r\n    this._name = undefined;\r\n    this.updateName();\r\n\r\n    this.bindEvents();\r\n    this._redraw();\r\n  }\r\n\r\n  setAttribute(key, val) {\r\n    super.setAttribute(key, val);\r\n\r\n    if (key === \"name\") {\r\n      this.updateName();\r\n      this.updateWidth();\r\n    }\r\n  }\r\n\r\n  old_bindEvents() {\r\n    let press_gen = 0;\r\n\r\n    let press = (e) => {\r\n      e.stopPropagation();\r\n\r\n      if (cconst.DEBUG.buttonEvents) {\r\n        console.log(\"button press\", this._pressed, this.disabled, e.button);\r\n      }\r\n\r\n      if (this.disabled) return;\r\n\r\n      this._pressed = true;\r\n\r\n      if (util.isMobile() && this.onclick && e.button === 0) {\r\n        this.onclick();\r\n      }\r\n\r\n      if (this._onpress) {\r\n        this._onpress(this);\r\n      }\r\n\r\n      this._redraw();\r\n\r\n      e.preventDefault();\r\n    };\r\n\r\n    let depress = (e) => {\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(\"button depress\", e.button, e.was_touch);\r\n\r\n      if (this._auto_depress) {\r\n        this._pressed = false;\r\n\r\n        if (this.disabled) return;\r\n\r\n        this._redraw();\r\n      }\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n\r\n      if (util.isMobile() || e.type === \"pointerup\" && e.button) {\r\n        return;\r\n      }\r\n\r\n      this._redraw();\r\n\r\n      if (cconst.DEBUG.buttonEvents) {\r\n        console.log(\"button click callback:\", this.onclick, this._onpress, this.onpress);\r\n      }\r\n\r\n      if (this.onclick && e.pointerType !== \"mouse\") {\r\n        this.onclick(this);\r\n      }\r\n\r\n      this.undoBreakPoint();\r\n    }\r\n\r\n    this.addEventListener(\"mousedown\", press, {captured: true, passive: false});\r\n    this.addEventListener(\"mouseup\", depress, {captured: true, passive: false});\r\n    this.addEventListener(\"mouseover\", (e) => {\r\n      if (this.disabled)\r\n        return;\r\n\r\n      this._highlight = true;\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    })\r\n\r\n    this.addEventListener(\"mouseout\", (e) => {\r\n      if (this.disabled)\r\n        return;\r\n\r\n      this._highlight = false;\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    })\r\n  }\r\n\r\n  updateDisabled() {\r\n    if (this._last_disabled !== this.disabled) {\r\n      this._last_disabled = this.disabled;\r\n\r\n      //setTimeout(() => {\r\n      this.dom._background = this.getDefault(\"background-color\");\r\n\r\n      this._repos_canvas();\r\n      this._redraw();\r\n\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(\"disabled update!\", this.disabled, this.style[\"background-color\"]);\r\n      //}, 100);\r\n    }\r\n  }\r\n\r\n  updateDefaultSize() {\r\n    const dpi = UIBase.getDPI();\r\n    let height = ~~(this.getDefault(\"height\")) + this.getDefault(\"padding\");\r\n    let size = this.getDefault(\"DefaultText\").size*1.33;\r\n\r\n    if (height === undefined || size === undefined || isNaN(height) || isNaN(size)) {\r\n      return;\r\n    }\r\n\r\n    height = ~~(Math.max(height, size)*dpi);\r\n    let cssHeight = (height/dpi) + \"px\";\r\n\r\n    if (cssHeight !== this.style[\"height\"]) {\r\n      this.style[\"height\"] = cssHeight;\r\n      this.dom.style[\"height\"] = cssHeight;\r\n      this.dom.height = height;\r\n\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _calcUpdateKey() {\r\n    return _themeUpdateKey;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.style[\"user-select\"] = \"none\";\r\n    this.dom.style[\"user-select\"] = \"none\";\r\n\r\n    this.updateDefaultSize();\r\n    this.updateWidth();\r\n    this.updateDPI();\r\n    this.updateName();\r\n    this.updateDisabled();\r\n\r\n    if (this.background !== this._last_bg) {\r\n      this._last_bg = this.background;\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n\r\n    let key = this._calcUpdateKey();\r\n    if (key !== this._last_but_update_key) {\r\n      this._last_but_update_key = key;\r\n\r\n      this.setCSS();\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.updateBorders();\r\n\r\n    let name = this._name;\r\n    if (name === undefined) {\r\n      return;\r\n    }\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let pad = this.getDefault(\"padding\");\r\n    let ts = this.getDefault(\"DefaultText\").size;\r\n\r\n    let tw = ui_base.measureText(this, this._genLabel(), {\r\n      size: ts,\r\n      font: this.getDefault(\"DefaultText\")\r\n    }).width + 2.0*pad + this._leftPad + this._rightPad;\r\n\r\n    if (this._namePad !== undefined) {\r\n      tw += this._namePad;\r\n    }\r\n\r\n    let w = this.getDefault(\"width\");\r\n\r\n    w = Math.max(w, tw);\r\n    w = ~~w;\r\n    this.dom.style[\"width\"] = w + \"px\";\r\n    this.updateBorders();\r\n  }\r\n\r\n  updateBorders(dom=this.dom) {\r\n    let lwid = this.getDefault(\"border-width\");\r\n\r\n    if (lwid) {\r\n      dom.style[\"border-color\"] = this.getDefault(\"border-color\");\r\n      dom.style[\"border-width\"] = lwid + \"px\";\r\n      dom.style[\"border-style\"] = \"solid\";\r\n      dom.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n    } else {\r\n      dom.style[\"border-color\"] = \"none\";\r\n      dom.style[\"border-width\"] = \"0px\";\r\n      dom.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n    }\r\n\r\n  }\r\n\r\n  updateName() {\r\n    if (!this.hasAttribute(\"name\")) {\r\n      return;\r\n    }\r\n\r\n    let name = this.getAttribute(\"name\");\r\n\r\n    if (name !== this._name) {\r\n      this._name = name;\r\n\r\n      this.setCSS();\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  updateWidth(w_add = 0) {\r\n  }\r\n\r\n  _repos_canvas() {\r\n    let dpi = this.getDPI();\r\n\r\n    let w = parsepx(this.dom.style[\"width\"]);\r\n    let h = parsepx(this.dom.style[\"height\"]);\r\n\r\n    let w2 = ~~(w*dpi);\r\n    let h2 = ~~(h*dpi);\r\n\r\n    w = w2/dpi;\r\n    h = h2/dpi;\r\n\r\n    this.dom.width = w2;\r\n    this.dom.style[\"width\"] = w + \"px\";\r\n\r\n    this.dom.height = h2;\r\n    this.dom.style[\"height\"] = h + \"px\";\r\n  }\r\n\r\n  updateDPI() {\r\n    let dpi = this.getDPI();\r\n\r\n    if (this._last_dpi !== dpi) {\r\n      //console.log(\"update dpi\", dpi);\r\n\r\n      this._last_dpi = dpi;\r\n\r\n      this.g.font = undefined; //reset font\r\n\r\n      this.setCSS();\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n\r\n    if (this.style[\"background-color\"]) {\r\n      this.dom._background = this.style[\"background-color\"];\r\n      this.style[\"background-color\"] = \"\";\r\n    }\r\n\r\n    //console.log(\">\", this.dom.style[\"background-color\"], \"-----\");\r\n    //console.log(\"width:\", this.clientWidth)\r\n  }\r\n\r\n  _genLabel() {\r\n    return \"\" + this._name;\r\n  }\r\n\r\n  _getSubKey() {\r\n    if (this._pressed) {\r\n      return 'depressed';\r\n    } else if (this._highlight) {\r\n      return 'highlight';\r\n    } else {\r\n      return undefined; //make getSubDefault forward to getDefault\r\n    }\r\n  }\r\n\r\n  _redraw(draw_text = true) {\r\n    //console.log(\"button draw\");\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let subkey = this._getSubKey();\r\n\r\n    if (this._pressed && this._highlight) {\r\n      this.dom._background = this.getSubDefault(subkey, \"highlight-pressed\", \"BoxHighlight\");\r\n    } else if (this._pressed) {\r\n      this.dom._background = this.getSubDefault(subkey, \"pressed\", \"BoxDepressed\");\r\n    } else if (this._highlight) {\r\n      this.dom._background = this.getSubDefault(subkey, \"highlight\", \"BoxHighlight\");\r\n    } else {\r\n      this.dom._background = this.getSubDefault(subkey, \"background-color\", \"background-color\");\r\n    }\r\n\r\n    ui_base.drawRoundBox(this, this.dom, this.g);\r\n\r\n    //drawn with CSS now\r\n    /*\r\n    let lwid = this.getDefault(\"border-width\");\r\n    if (lwid) {\r\n      this.g.lineWidth = lwid*dpi;\r\n      ui_base.drawRoundBox(this, this.dom, this.g, undefined, undefined, undefined, \"stroke\");\r\n    }\r\n     */\r\n\r\n    this.updateBorders();\r\n\r\n    if (this._focus) {\r\n      let w = this.dom.width, h = this.dom.height;\r\n      let p = 1/dpi;\r\n\r\n      //XXX remove this.g.translate lines after refactoring drawRoundBox, see comment in ui_base.js\r\n      this.g.translate(p, p);\r\n      let lw = this.g.lineWidth;\r\n\r\n\r\n      this.g.lineWidth = this.getDefault(\"focus-border-width\", undefined, 1.0)*dpi;\r\n\r\n      ui_base.drawRoundBox(this, this.dom, this.g, w - p*2, h - p*2, this.r, \"stroke\", this.getDefault(\"BoxHighlight\"));\r\n\r\n      this.g.lineWidth = lw;\r\n      this.g.translate(-p, -p);\r\n    }\r\n\r\n    if (draw_text) {\r\n      this._draw_text();\r\n    }\r\n  }\r\n\r\n  _draw_text() {\r\n    let dpi = this.getDPI();\r\n\r\n    let subkey = this._getSubKey();\r\n\r\n    //if (util.isMobile()) {\r\n    //dpi = dpi; //visualViewport.scale;\r\n    //}\r\n\r\n    let font = this.getSubDefault(subkey, \"DefaultText\");\r\n\r\n    let pad = this.getDefault(\"padding\")*dpi;\r\n    let ts = font.size*dpi;\r\n\r\n    let text = this._genLabel();\r\n\r\n    //console.log(text, \"text\", this._name);\r\n\r\n    let w = this.dom.width, h = this.dom.height;\r\n\r\n    let tw = ui_base.measureText(this, text, undefined, undefined, ts, font).width;\r\n\r\n    let cx = pad*0.5 + this._leftPad*dpi;\r\n    let cy = ts + (h - ts)/3.0;\r\n\r\n    let g = this.g;\r\n\r\n    ui_base.drawText(this, ~~cx, ~~cy, text, {\r\n      canvas: this.dom,\r\n      g     : this.g,\r\n      size  : ts/dpi,\r\n      font  : font\r\n    });\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(OldButton);\r\n","\"use strict\";\r\n\r\nimport * as units from '../core/units.js';\r\nimport * as util from '../path-controller/util/util.js';\r\nimport {Vector2, Vector3, Vector4, Matrix4, Quat} from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nfunction myToFixed(s, n) {\r\n  s = s.toFixed(n);\r\n\r\n  while (s.endsWith('0')) {\r\n    s = s.slice(0, s.length - 1);\r\n  }\r\n  if (s.endsWith(\"\\.\")) {\r\n    s = s.slice(0, s.length - 1);\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nlet keymap = events.keymap;\r\n\r\nlet EnumProperty = toolprop.EnumProperty,\r\n    PropTypes    = toolprop.PropTypes;\r\n\r\nlet UIBase     = ui_base.UIBase,\r\n    PackFlags  = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nlet parsepx = ui_base.parsepx;\r\n\r\nimport {Button} from './ui_button.js';\r\nimport {_setTextboxClass} from '../core/ui_base.js';\r\n\r\nexport class TextBoxBase extends UIBase {\r\n  static define() {\r\n    return {\r\n      modalKeyEvents: true\r\n    }\r\n  }\r\n}\r\n\r\nexport class TextBox extends TextBoxBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._editing = false;\r\n\r\n    this._width = this.getDefault(\"width\") + \"px\";\r\n    this._textBoxEvents = true;\r\n\r\n    let margin = Math.ceil(3*this.getDPI());\r\n\r\n    this._had_error = false;\r\n\r\n    this.decimalPlaces = undefined; //will inherit from property defaults\r\n\r\n    this.baseUnit = undefined; //will automatically use defaults\r\n    this.displayUnit = undefined; //will automatically use defaults\r\n\r\n    this.dom = document.createElement(\"input\");\r\n\r\n    this.dom.tabIndex = 0;\r\n    this.dom.setAttribute(\"tabindex\", 0);\r\n    this.dom.setAttribute(\"tab-index\", 0);\r\n    this.dom.style[\"margin\"] = margin + \"px\";\r\n\r\n    this.dom.setAttribute(\"type\", \"textbox\");\r\n    this.dom.onchange = (e) => {\r\n      this._change(this.dom.value);\r\n    }\r\n\r\n    this.radix = 16;\r\n\r\n    this.dom.oninput = (e) => {\r\n      this._change(this.dom.value);\r\n    }\r\n\r\n    this.shadow.appendChild(this.dom);\r\n\r\n    this.dom.addEventListener(\"focus\", (e) => {\r\n      console.log(\"Textbox focus\", this.isModal);\r\n\r\n      this._focus = 1;\r\n\r\n      if (this.isModal) {\r\n        this._startModal();\r\n        this.setCSS();\r\n      }\r\n    });\r\n\r\n    this.dom.addEventListener(\"blur\", (e) => {\r\n      console.log(\"Textbox blur\");\r\n\r\n      this._focus = 0;\r\n\r\n      if (this._modal) {\r\n        this._endModal(true);\r\n        this.setCSS();\r\n      }\r\n    });\r\n\r\n  }\r\n\r\n  get startSelected() {\r\n    let b = (\"\" + this.getAttribute(\"start-selected\")).toLowerCase();\r\n\r\n    return b === \"yes\" || b === \"true\" || b === \"on\" || b === \"1\";\r\n  }\r\n\r\n  set startSelected(v) {\r\n    this.setAttribute(\"start-selected\", v ? \"true\" : \"false\");\r\n  }\r\n\r\n  /** realtime dom attribute getter, defaults to true in absence of attribute*/\r\n  get realtime() {\r\n    let ret = this.getAttribute(\"realtime\");\r\n\r\n    if (!ret) {\r\n      return true;\r\n    }\r\n\r\n    ret = ret.toLowerCase().trim();\r\n\r\n    return ret === 'yes' || ret === 'true' || ret === 'on';\r\n  }\r\n\r\n  set realtime(val) {\r\n    this.setAttribute('realtime', val ? 'true' : 'false');\r\n  }\r\n\r\n  get isModal() {\r\n    let ret = this.getAttribute(\"modal\");\r\n\r\n    if (!ret) {\r\n      return false;\r\n    }\r\n\r\n    ret = ret.toLowerCase().trim();\r\n\r\n    return ret === 'yes' || ret === 'true' || ret === 'on';\r\n  }\r\n\r\n  set isModal(val) {\r\n    this.setAttribute('modal', val ? 'true' : 'false');\r\n  }\r\n\r\n  _startModal() {\r\n    if (this.startSelected) {\r\n      this.select();\r\n    }\r\n\r\n    console.warn(\"textbox modal\");\r\n\r\n    if (this._modal) {\r\n      this._endModal(true);\r\n    }\r\n\r\n    this._editing = true;\r\n\r\n    let ignore = 0;\r\n\r\n    let finish = (ok) => {\r\n      this._endModal(ok);\r\n    }\r\n\r\n    let keydown = (e) => {\r\n      e.stopPropagation();\r\n\r\n      switch (e.keyCode) {\r\n        case keymap.Enter:\r\n          finish(true);\r\n          break;\r\n        case keymap.Escape:\r\n          finish(false);\r\n          break;\r\n      }\r\n\r\n      return;\r\n      if (ignore) return;\r\n\r\n      let e2 = new KeyboardEvent(e.type, e);\r\n\r\n      ignore = 1;\r\n      this.dom.dispatchEvent(e2);\r\n      ignore = 0;\r\n    };\r\n\r\n    this._modal = true;\r\n    this.pushModal({\r\n      on_mousemove: (e) => {\r\n        e.stopPropagation();\r\n      },\r\n\r\n      on_keydown : keydown,\r\n      on_keypress: keydown,\r\n      on_keyup   : keydown,\r\n\r\n      on_mousedown: (e) => {\r\n        e.stopPropagation();\r\n        console.log(\"mouse down\", e, e.x, e.y);\r\n      }\r\n    }, false)\r\n  }\r\n\r\n  _flash_focus() {\r\n    //don't focus on flash\r\n  }\r\n\r\n  get editing() {\r\n    return this._editing;\r\n  }\r\n\r\n  _endModal(ok) {\r\n    console.log(\"textbox end modal\");\r\n\r\n    this._editing = false;\r\n\r\n    this._modal = false;\r\n    this.popModal();\r\n\r\n    this.blur();\r\n\r\n    if (this.onend) {\r\n      this.onend(ok);\r\n    } else {\r\n      this._updatePathVal(this.dom.value);\r\n    }\r\n\r\n    this.blur();\r\n  }\r\n\r\n  get tabIndex() {\r\n    return this.dom.tabIndex;\r\n  }\r\n\r\n  set tabIndex(val) {\r\n    this.dom.tabIndex = val;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    //set isModal default\r\n    if (!this.hasAttribute('modal')) {\r\n      this.isModal = true;\r\n    }\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"width\"] = this._width;\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  set width(val) {\r\n    if (typeof val === \"number\") {\r\n      val += \"px\";\r\n    }\r\n\r\n    this._width = val;\r\n    this.style[\"width\"] = val;\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.overrideDefault(\"background-color\", this.getDefault(\"background-color\"));\r\n\r\n    this.background = this.getDefault(\"background-color\");\r\n    this.dom.style[\"margin\"] = this.dom.style[\"padding\"] = \"0px\";\r\n\r\n    if (this.getDefault(\"background-color\")) {\r\n      this.dom.style[\"background-color\"] = this.getDefault(\"background-color\");\r\n    }\r\n\r\n    this.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n    this.dom.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n\r\n    let bwid = this.getDefault(\"border-width\");\r\n    let bcolor = this.getDefault(\"border-color\");\r\n    let bstyle = this.getDefault(\"border-style\");\r\n    let border = `${bwid}px ${bstyle} ${bcolor}`\r\n\r\n    this.style[\"border\"] = border;\r\n    this.style[\"border-color\"] = bcolor;\r\n\r\n    if (this._focus) {\r\n      this.dom.style[\"border\"] = `2px dashed ${this.getDefault('focus-border-color')}`;\r\n    } else {\r\n      this.dom.style[\"border\"] = border;\r\n      this.dom.style[\"border-color\"] = bcolor;\r\n    }\r\n\r\n    if (this.style[\"font\"]) {\r\n      this.dom.style[\"font\"] = this.style[\"font\"];\r\n    } else {\r\n      this.dom.style[\"font\"] = this.getDefault(\"DefaultText\").genCSS();\r\n      this.dom.style[\"color\"] = this.getDefault(\"DefaultText\").color;\r\n    }\r\n\r\n    this.dom.style[\"width\"] = \"100%\";\r\n    this.dom.style[\"height\"] = \"100%\";\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.ctx || !this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n    if (this._focus || this._flashtimer !== undefined || (this._had_error && this._focus)) {\r\n      return;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n    if (val === undefined || val === null) {\r\n      this.internalDisabled = true;\r\n      return;\r\n    } else {\r\n      this.internalDisabled = false;\r\n    }\r\n\r\n\r\n    let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    let text = this.text;\r\n\r\n    if (!prop) {\r\n      console.error(\"datapath error \" + this.getAttribute(\"datapath\"), val);\r\n      return;\r\n    }\r\n\r\n    let is_num = prop.type & (PropTypes.FLOAT | PropTypes.INT);\r\n    if (typeof val === \"number\" && (prop.type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4 | PropTypes.QUAT))) {\r\n      is_num = true;\r\n    }\r\n\r\n    if (is_num) {\r\n      let is_int = prop.type === PropTypes.INT;\r\n\r\n      this.radix = prop.radix;\r\n\r\n      let decimalPlaces = this.decimalPlaces !== undefined ? this.decimalPlaces : prop.decimalPlaces;\r\n      if (this.hasAttribute(\"decimalPlaces\")) {\r\n        decimalPlaces = parseInt(this.getAttribute(\"decimalPlaces\"));\r\n      }\r\n\r\n      let baseUnit = this.baseUnit ?? prop.baseUnit;\r\n      if (this.hasAttribute(\"baseUnit\")) {\r\n        baseUnit = this.getAttribute(\"baseUnit\");\r\n      }\r\n\r\n      let displayUnit = this.displayUnit ?? prop.displayUnit;\r\n      if (this.hasAttribute(\"displayUnit\")) {\r\n        displayUnit = this.getAttribute(\"displayUnit\");\r\n      }\r\n\r\n      if (is_int && this.radix === 2) {\r\n        text = val.toString(this.radix);\r\n        text = \"0b\" + text;\r\n      } else if (is_int && this.radix === 16) {\r\n        text += \"h\";\r\n      } else {\r\n        text = units.buildString(val, baseUnit, decimalPlaces, displayUnit);\r\n      }\r\n    } else if (prop !== undefined && prop.type === PropTypes.STRING) {\r\n      text = val;\r\n    }\r\n\r\n    if (this.text !== text) {\r\n      this.text = text;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    if (this.dom.style[\"width\"] !== this.style[\"width\"]) {\r\n      this.dom.style[\"width\"] = this.style[\"width\"];\r\n    }\r\n    if (this.dom.style[\"height\"] !== this.style[\"height\"]) {\r\n      this.dom.style[\"height\"] = this.style[\"height\"];\r\n    }\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  select() {\r\n    this.dom.select();\r\n    //return this.dom.select.apply(this, arguments);\r\n  }\r\n\r\n  focus() {\r\n    return this.dom.focus();\r\n  }\r\n\r\n  blur() {\r\n    return this.dom.blur();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname       : \"textbox-x\",\r\n      style         : \"textbox\",\r\n      modalKeyEvents: true\r\n    };\r\n  }\r\n\r\n  get text() {\r\n    return this.dom.value;\r\n  }\r\n\r\n  set text(value) {\r\n    this.dom.value = value;\r\n  }\r\n\r\n  _prop_update(prop, text) {\r\n    let is_num = prop.type & (PropTypes.FLOAT | PropTypes.INT);\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (typeof val === \"number\" && (prop.type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4 | PropTypes.QUAT))) {\r\n      is_num = true;\r\n    }\r\n\r\n    if (is_num) {\r\n      let is_int = prop.type === PropTypes.INT;\r\n\r\n      this.radix = prop.radix;\r\n\r\n      let decimalPlaces = this.decimalPlaces !== undefined ? this.decimalPlaces : prop.decimalPlaces;\r\n      if (this.hasAttribute(\"decimalPlaces\")) {\r\n        decimalPlaces = parseInt(this.getAttribute(\"decimalPlaces\"));\r\n      }\r\n\r\n      let baseUnit = this.baseUnit ?? prop.baseUnit;\r\n      if (this.hasAttribute(\"baseUnit\")) {\r\n        baseUnit = this.getAttribute(\"baseUnit\");\r\n      }\r\n\r\n      let displayUnit = this.displayUnit ?? prop.displayUnit;\r\n      if (this.hasAttribute(\"displayUnit\")) {\r\n        displayUnit = this.getAttribute(\"displayUnit\");\r\n      }\r\n\r\n      if (!units.isNumber(text.trim())) {\r\n        this.flash(ui_base.ErrorColors.ERROR, this.dom, undefined, false);\r\n        this.focus();\r\n        this.dom.focus();\r\n        this._had_error = true;\r\n      } else {\r\n        let val = units.parseValue(text, baseUnit, displayUnit);\r\n\r\n        if (this._had_error) {\r\n          this.flash(ui_base.ErrorColors.OK, this.dom, undefined, false);\r\n        }\r\n\r\n        this._had_error = false;\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), val);\r\n      }\r\n    } else if (prop.type === PropTypes.STRING) {\r\n      try {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this.text);\r\n\r\n        if (this._had_error) {\r\n          this.flash(ui_base.ErrorColors.OK, this.dom, undefined, false);\r\n          this.dom.focus();\r\n        }\r\n\r\n        this._had_error = false;\r\n      } catch (error) {\r\n        console.log(error.stack);\r\n        console.log(error.message);\r\n        console.warn(\"textbox error!\");\r\n        //this._had_error = true;\r\n\r\n        this.flash(ui_base.ErrorColors.ERROR, this.dom, undefined, false);\r\n        this.dom.focus();\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  _updatePathVal(text) {\r\n    if (this.hasAttribute(\"datapath\") && this.ctx !== undefined) {\r\n      let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n      console.log(prop);\r\n\r\n      if (prop) {\r\n        this._prop_update(prop, text);\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  _change(text) {\r\n    if (this.realtime) {\r\n      this._updatePathVal(text);\r\n    }\r\n\r\n    if (this.onchange) {\r\n      this.onchange(text);\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(TextBox);\r\n\r\n/**\r\n\r\n Returns false if it's safe to call preventDefault.\r\n\r\n Returns true if the element at position x,y is\r\n either a textbox or is draggable.\r\n */\r\nexport function checkForTextBox(screen, x, y) {\r\n  let p = screen.pickElement(x, y);\r\n  //console.log(p, x, y);\r\n\r\n  while (p) {\r\n    //don't prevent draggable elements from dragging\r\n    if (p.draggable) {\r\n      return true;\r\n    }\r\n\r\n    if (p instanceof UIBase) {\r\n      //check immediate children of p\r\n      for (let i = 0; i < 2; i++) {\r\n        let nodes = i ? p.childNodes : p.shadow.childNodes;\r\n\r\n        for (let child of nodes) {\r\n          if (child.draggable) {\r\n            return true;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    let ok = p instanceof TextBoxBase;\r\n    ok = ok || p.constructor.define && p.constructor.define().modalKeyEvents;\r\n\r\n    if (ok) {\r\n      return true;\r\n    }\r\n\r\n    p = p.parentWidget ? p.parentWidget : p.parentNode;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nui_base._setTextboxClass(TextBox);\r\n","\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as toolsys from '../path-controller/toolsys/toolsys.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport {DataPathError} from '../path-controller/controller/controller.js';\r\nimport {Vector3, Vector4, Quat, Matrix4} from '../path-controller/util/vectormath.js';\r\nimport {isNumber, PropFlags} from \"../path-controller/toolsys/toolprop.js\";\r\nimport * as units from '../core/units.js';\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nfunction myToFixed(s, n) {\r\n  s = s.toFixed(n);\r\n\r\n  while (s.endsWith('0')) {\r\n    s = s.slice(0, s.length - 1);\r\n  }\r\n  if (s.endsWith(\"\\.\")) {\r\n    s = s.slice(0, s.length - 1);\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nlet keymap = events.keymap;\r\n\r\nlet EnumProperty = toolprop.EnumProperty,\r\n    PropTypes    = toolprop.PropTypes;\r\n\r\nlet UIBase     = ui_base.UIBase,\r\n    PackFlags  = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nlet parsepx = ui_base.parsepx;\r\n\r\nimport {Button, OldButton} from './ui_button.js';\r\nimport {eventWasTouch, popModalLight, pushModalLight} from '../path-controller/util/simple_events.js';\r\n\r\nexport {Button} from './ui_button.js';\r\n\r\nexport class IconLabel extends UIBase {\r\n  constructor() {\r\n    super();\r\n    this._icon = -1;\r\n    this.iconsheet = 1;\r\n  }\r\n\r\n  get icon() {\r\n    return this._icon;\r\n  }\r\n\r\n  set icon(id) {\r\n    this._icon = id;\r\n    this.setCSS();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"icon-label-x\"\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"margin\"] = this.style[\"padding\"] = \"0px\";\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  setCSS() {\r\n    let size = ui_base.iconmanager.getTileSize(this.iconsheet);\r\n\r\n\r\n    ui_base.iconmanager.setCSS(this.icon, this);\r\n\r\n    this.style[\"width\"] = size + \"px\";\r\n    this.style[\"height\"] = size + \"px\";\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(IconLabel);\r\n\r\nexport class ValueButtonBase extends OldButton {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(val) {\r\n    this._value = val;\r\n\r\n    if (this.ctx && this.hasAttribute(\"datapath\")) {\r\n      this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this._value);\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) return;\r\n    if (this.ctx === undefined) return;\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (val === undefined) {\r\n      let redraw = !this.disabled;\r\n\r\n      this.internalDisabled = true;\r\n\r\n      if (redraw) this._redraw();\r\n\r\n      return;\r\n    } else {\r\n      let redraw = this.disabled;\r\n\r\n      this.internalDisabled = false;\r\n      if (redraw) this._redraw();\r\n    }\r\n\r\n    if (val !== this._value) {\r\n      this._value = val;\r\n      this.updateWidth();\r\n      this._repos_canvas();\r\n      this._redraw();\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    this.updateDataPath();\r\n\r\n    super.update();\r\n  }\r\n}\r\n\r\nexport class Check extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._checked = false;\r\n    this._highlight = false;\r\n    this._focus = false;\r\n\r\n    let shadow = this.shadow;\r\n\r\n    //let form = document.createElement(\"form\");\r\n\r\n    let span = document.createElement(\"span\");\r\n    span.setAttribute(\"class\", \"checkx\");\r\n\r\n    span.style[\"display\"] = \"flex\";\r\n    span.style[\"flex-direction\"] = \"row\";\r\n    span.style[\"margin\"] = span.style[\"padding\"] = \"0px\";\r\n    //span.style[\"background\"] = ui_base.iconmanager.getCSS(1);\r\n\r\n    let sheet = 0;\r\n    let size = ui_base.iconmanager.getTileSize(0);\r\n\r\n    let check = this.canvas = document.createElement(\"canvas\");\r\n    this.g = check.getContext(\"2d\");\r\n\r\n    check.setAttribute(\"id\", check._id);\r\n    check.setAttribute(\"name\", check._id);\r\n\r\n    let mdown = (e) => {\r\n      this._highlight = false;\r\n      this.checked = !this.checked;\r\n    };\r\n\r\n    let mup = (e) => {\r\n      this._highlight = false;\r\n      this.blur();\r\n      this._redraw();\r\n    };\r\n\r\n    let mover = (e) => {\r\n      this._highlight = true;\r\n      this._redraw();\r\n    };\r\n\r\n    let mleave = (e) => {\r\n      this._highlight = false;\r\n      this._redraw();\r\n    };\r\n\r\n    span.addEventListener(\"pointerover\", mover, {passive: true});\r\n    span.addEventListener(\"mousein\", mover, {passive: true});\r\n    span.addEventListener(\"mouseleave\", mleave, {passive: true});\r\n    span.addEventListener(\"pointerout\", mleave, {passive: true});\r\n\r\n    this.addEventListener(\"blur\", (e) => {\r\n      this._highlight = this._focus = false;\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"focusin\", (e) => {\r\n      this._focus = true;\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"focus\", (e) => {\r\n      this._focus = true;\r\n      this._redraw();\r\n    });\r\n\r\n\r\n    span.addEventListener(\"pointerdown\", mdown, {passive: true});\r\n    span.addEventListener(\"pointerup\", mup, {passive: true});\r\n    span.addEventListener(\"pointercancel\", mup, {passive: true});\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Escape\"]:\r\n          this._highlight = undefined;\r\n          this._redraw();\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n\r\n          this.blur();\r\n          break;\r\n        case keymap[\"Enter\"]:\r\n        case keymap[\"Space\"]:\r\n          this.checked = !this.checked;\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          break;\r\n      }\r\n    });\r\n    this.checkbox = check;\r\n\r\n    span.appendChild(check);\r\n\r\n    let label = this._label = document.createElement(\"label\");\r\n    label.setAttribute(\"class\", \"checkx\");\r\n    span.setAttribute(\"class\", \"checkx\");\r\n    label.style[\"align-self\"] = \"center\";\r\n\r\n    let side = this.getDefault(\"CheckSide\");\r\n    if (side === \"right\") {\r\n      span.prepend(label);\r\n    } else {\r\n      span.appendChild(label);\r\n    }\r\n\r\n    shadow.appendChild(span);\r\n  }\r\n\r\n  get internalDisabled() {\r\n    return super.internalDisabled;\r\n  }\r\n\r\n  set internalDisabled(val) {\r\n    if (!!this.internalDisabled === !!val) {\r\n      return;\r\n    }\r\n\r\n    super.internalDisabled = val;\r\n    this._redraw();\r\n  }\r\n\r\n  get value() {\r\n    return this.checked;\r\n  }\r\n\r\n  set value(v) {\r\n    this.checked = v;\r\n  }\r\n\r\n  get checked() {\r\n    return this._checked;\r\n  }\r\n\r\n  set checked(v) {\r\n    v = !!v;\r\n\r\n    if (this._checked !== v) {\r\n      this._checked = v;\r\n\r\n      this.setCSS();\r\n\r\n      //this.dom.checked = v;\r\n      this._redraw();\r\n\r\n      if (this.onclick) {\r\n        this.onclick(v);\r\n      }\r\n      if (this.onchange) {\r\n        this.onchange(v);\r\n      }\r\n\r\n      if (this.hasAttribute(\"datapath\")) {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this._checked);\r\n      }\r\n    }\r\n  }\r\n\r\n  get label() {\r\n    return this._label.textContent;\r\n  }\r\n\r\n  set label(l) {\r\n    this._label.textContent = l;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname    : \"check-x\",\r\n      style      : \"checkbox\",\r\n      parentStyle: \"button\"\r\n    };\r\n  }\r\n\r\n  init() {\r\n    this.tabIndex = 1;\r\n    this.setAttribute(\"class\", \"checkx\");\r\n\r\n\r\n    let style = document.createElement(\"style\");\r\n    //let style = this.cssStyleTag();\r\n\r\n    let color = this.getDefault(\"focus-border-color\");\r\n\r\n    style.textContent = `\r\n      .checkx:focus {\r\n        outline : none;\r\n      }\r\n    `;\r\n\r\n    //document.body.prepend(style);\r\n    this.prepend(style);\r\n  }\r\n\r\n  setCSS() {\r\n    this._label.style[\"font\"] = this.getDefault(\"DefaultText\").genCSS();\r\n    this._label.style[\"color\"] = this.getDefault(\"DefaultText\").color;\r\n\r\n    this._label.style['font'] = 'normal 14px poppins'; // TODO - Jordan - add to settings\r\n\r\n    super.setCSS();\r\n\r\n    //force clear background\r\n    this.style[\"background-color\"] = \"rgba(0,0,0,0)\";\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.getAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    let redraw = false;\r\n\r\n    if (val === undefined) {\r\n      this.internalDisabled = true;\r\n      return;\r\n    } else {\r\n      redraw = this.internalDisabled;\r\n\r\n      this.internalDisabled = false;\r\n    }\r\n\r\n    val = !!val;\r\n\r\n    redraw = redraw || !!this._checked !== !!val;\r\n\r\n    if (redraw) {\r\n      this._checked = val;\r\n      this._repos_canvas();\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _repos_canvas() {\r\n  }\r\n\r\n  _redraw() {\r\n    if (this.canvas === undefined) {\r\n      //flag update\r\n      this._updatekey = \"\";\r\n      return;\r\n    }\r\n\r\n    let canvas = this.canvas, g = this.g;\r\n    let dpi = UIBase.getDPI();\r\n    let tilesize = ui_base.iconmanager.getTileSize(0);\r\n    let pad = this.getDefault(\"padding\");\r\n\r\n    let csize = tilesize + pad*2;\r\n\r\n    canvas.style[\"margin\"] = \"2px\";\r\n    canvas.style[\"width\"] = csize + \"px\";\r\n    canvas.style[\"height\"] = csize + \"px\";\r\n\r\n    csize = ~~(csize*dpi + 0.5);\r\n    tilesize = ~~(tilesize*dpi + 0.5);\r\n\r\n    canvas.width = csize;\r\n    canvas.height = csize;\r\n\r\n    g.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    g.beginPath();\r\n    g.rect(0, 0, canvas.width, canvas.height);\r\n    g.fill();\r\n\r\n    let color;\r\n\r\n    if (!this._checked && this._highlight) {\r\n      color = this.getDefault(\"BoxHighlight\");\r\n    }\r\n\r\n    ui_base.drawRoundBox(this, canvas, g, undefined, undefined, undefined, undefined, color);\r\n    if (this._checked) {\r\n      //canvasDraw(elem, canvas, g, icon, x=0, y=0, sheet=0) {\r\n      let x = (csize - tilesize)*0.5, y = (csize - tilesize)*0.5;\r\n      ui_base.iconmanager.canvasDraw(this, canvas, g, ui_base.Icons.LARGE_CHECK, x, y);\r\n    }\r\n\r\n    if (this._focus) {\r\n      color = this.getDefault(\"focus-border-color\");\r\n      g.lineWidth *= dpi;\r\n      ui_base.drawRoundBox(this, canvas, g, undefined, undefined, undefined, \"stroke\", color);\r\n    }\r\n  }\r\n\r\n  updateDPI() {\r\n    let dpi = UIBase.getDPI();\r\n\r\n    if (dpi !== this._last_dpi) {\r\n      this._last_dpi = dpi;\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateDPI();\r\n\r\n    let ready = ui_base.getIconManager().isReady(0);\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n\r\n    let updatekey = this.getDefault(\"DefaultText\").hash();\r\n    updatekey += this._checked + \":\" + this._label.textContent;\r\n    updatekey += \":\" + ready;\r\n\r\n    if (updatekey !== this._updatekey) {\r\n      this._repos_canvas();\r\n      this.setCSS();\r\n\r\n      this._updatekey = updatekey;\r\n      this._redraw();\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(Check);\r\n\r\nexport class IconButton extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._customIcon = undefined;\r\n\r\n    this._pressed = false;\r\n    this._highlight = false;\r\n    this._draw_pressed = true;\r\n\r\n    this._icon = -1;\r\n    this._icon_pressed = undefined;\r\n    this.iconsheet = 0;\r\n    this.drawButtonBG = true;\r\n\r\n    this._extraIcon = undefined; //draw another icon on top\r\n\r\n    this.extraDom = undefined;\r\n\r\n    //have to put icon in subdiv\r\n    this.dom = document.createElement(\"div\");\r\n    this.shadow.appendChild(this.dom);\r\n\r\n    this._last_iconsheet = undefined;\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Enter\"]:\r\n        case keymap[\"Space\"]:\r\n          this.click();\r\n          break;\r\n      }\r\n    });\r\n  }\r\n\r\n  click() {\r\n    if (this._onpress) {\r\n      let rect = this.getClientRects();\r\n      let x = rect.x + rect.width*0.5;\r\n      let y = rect.y + rect.height*0.5;\r\n\r\n      let e = {x : x, y : y, stopPropagation : () => {}, preventDefault : () => {}};\r\n\r\n      this._onpress(e);\r\n    }\r\n\r\n    super.click();\r\n  }\r\n\r\n  get customIcon() {\r\n    return this._customIcon;\r\n  }\r\n\r\n  set customIcon(domImage) {\r\n    this._customIcon = domImage;\r\n    this.setCSS();\r\n  }\r\n\r\n  get icon() {\r\n    return this._icon;\r\n  }\r\n\r\n  set icon(val) {\r\n    this._icon = val;\r\n    this.setCSS();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"iconbutton-x\",\r\n      style  : \"iconbutton\"\r\n    };\r\n  }\r\n\r\n  _on_press() {\r\n    this._pressed = true;\r\n    this.setCSS();\r\n  }\r\n\r\n  _on_depress() {\r\n    this._pressed = false;\r\n    this.setCSS();\r\n  }\r\n\r\n  updateDefaultSize() {\r\n\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    let def;\r\n    let pstyle = this.getDefault(\"depressed\");\r\n    let hstyle = this.getDefault(\"highlight\");\r\n\r\n    this.noMarginsOrPadding();\r\n\r\n    if (this._pressed && this._draw_pressed) {\r\n      def = k => this.getSubDefault(\"depressed\", k);\r\n    } else if (this._highlight) {\r\n      def = k => this.getSubDefault(\"highlight\", k);\r\n    } else {\r\n      def = k => this.getDefault(k);\r\n    }\r\n\r\n    let loadstyle = (key, addpx) => {\r\n      let val = def(key);\r\n      if (addpx) {\r\n        val = (\"\" + val).trim();\r\n\r\n        if (!val.toLowerCase().endsWith(\"px\")) {\r\n          val += \"px\";\r\n        }\r\n      }\r\n\r\n      this.style[key] = val;\r\n    }\r\n\r\n    let keys = [\"margin\", \"padding\", \"margin-left\", \"margin-right\", \"margin-top\", \"margin-botton\",\r\n                \"padding-left\", \"padding-bottom\", \"padding-top\", \"padding-right\",\r\n                \"border-radius\"]\r\n\r\n    for (let k of keys) {\r\n      loadstyle(k, true);\r\n    }\r\n    loadstyle(\"background-color\", false);\r\n    loadstyle(\"color\", false);\r\n\r\n    let border = `${def(\"border-width\", true)} ${def(\"border-style\", false)} ${def(\"border-color\", false)}`\r\n    this.style[\"border\"] = border;\r\n\r\n    let w = this.getDefault(\"width\");\r\n\r\n    let size = ui_base.iconmanager.getTileSize(this.iconsheet);\r\n    w = size;\r\n\r\n    this.style[\"width\"] = w + \"px\";\r\n    this.style[\"height\"] = w + \"px\";\r\n\r\n    this.dom.style[\"width\"] = w + \"px\";\r\n    this.dom.style[\"height\"] = w + \"px\";\r\n    this.dom.style[\"margin\"] = this.dom.style[\"padding\"] = \"0px\";\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"align-items\"] = \"center\";\r\n\r\n    if (this._customIcon) {\r\n      this.dom.style[\"background-image\"] = `url(\"${this._customIcon.src}\")`\r\n      this.dom.style[\"background-size\"] = \"contain\";\r\n      this.dom.style[\"background-repeat\"] = \"no-repeat\";\r\n    } else {\r\n      let icon = this.icon;\r\n\r\n      if (this._pressed && this._icon_pressed !== undefined) {\r\n        icon = this._icon_pressed;\r\n      }\r\n\r\n      ui_base.iconmanager.setCSS(icon, this.dom, this.iconsheet);\r\n    }\r\n\r\n    if (this._extraIcon !== undefined) {\r\n      let dom;\r\n\r\n      if (!this.extraDom) {\r\n        this.extraDom = dom = document.createElement(\"div\");\r\n\r\n        this.shadow.appendChild(dom);\r\n      } else {\r\n        dom = this.extraDom;\r\n      }\r\n\r\n      dom.style[\"position\"] = \"absolute\";\r\n      dom.style[\"margin\"] = dom.style[\"padding\"] = \"0px\";\r\n      dom.style[\"pointer-events\"] = \"none\";\r\n      dom.style[\"width\"] = size + \"px\";\r\n      dom.style[\"height\"] = size + \"px\";\r\n\r\n      ui_base.iconmanager.setCSS(this._extraIcon, dom, this.iconsheet);\r\n    } else if (this.extraDom) {\r\n      this.extraDom.remove();\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    let press = (e) => {\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n\r\n      if (this.modalRunning) {\r\n        this.popModal();\r\n      }\r\n\r\n      if (!eventWasTouch(e) && e.button !== 0) {\r\n        return;\r\n      }\r\n\r\n      if (1) { //!eventWasTouch(e)) {\r\n        let this2 = this;\r\n\r\n        this.pushModal({\r\n          on_mouseup(e) {\r\n            //touch events aren't fireing onclick automatically the way mouse ones are\r\n\r\n            if (this2.onclick && eventWasTouch(e)) {\r\n              this2.onclick();\r\n            }\r\n            this.end();\r\n          },\r\n          on_touchcancel(e) {\r\n            this.on_mouseup(e);\r\n            this.end();\r\n          },\r\n          on_touchend(e) {\r\n            this.on_mouseup(e);\r\n            this.end();\r\n          },\r\n          on_keydown(e) {\r\n            this.end();\r\n          },\r\n          end() {\r\n            if (this2.modalRunning) {\r\n              this2.popModal();\r\n              this2._on_depress(e)\r\n              this2.setCSS();\r\n            }\r\n          }\r\n        });\r\n      }\r\n\r\n      this._on_press(e);\r\n    }\r\n\r\n    let depress = (e) => {\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n\r\n      this._on_depress();\r\n      this.setCSS();\r\n    }\r\n\r\n    let high = (e) => {\r\n      this._highlight = true;\r\n      this.setCSS();\r\n    }\r\n\r\n    let unhigh = (e) => {\r\n      this._highlight = false;\r\n      this.setCSS();\r\n    }\r\n\r\n    this.tabIndex = 0;\r\n\r\n    this.addEventListener(\"mouseover\", high);\r\n    this.addEventListener(\"mouseexit\", unhigh);\r\n    this.addEventListener(\"mouseleave\", unhigh);\r\n    this.addEventListener(\"focus\", high);\r\n    this.addEventListener(\"blur\", unhigh);\r\n\r\n    this.addEventListener(\"mousedown\", press, {capture: true});\r\n    this.addEventListener(\"mouseup\", depress, {capture: true});\r\n    //this.addEventListener(\"touchstart\", press, {capture: true});\r\n    //this.addEventListener(\"touchcancel\", depress, {capture: true});\r\n    //this.addEventListener(\"touchend\", depress, {capture: true});\r\n    this.setCSS();\r\n\r\n    this.dom.style[\"pointer-events\"] = \"none\";\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    if (this.iconsheet !== this._last_iconsheet) {\r\n      this.setCSS();\r\n      this._last_iconsheet = this.iconsheet;\r\n    }\r\n  }\r\n\r\n  _getsize() {\r\n    let margin = this.getDefault(\"padding\");\r\n\r\n    return ui_base.iconmanager.getTileSize(this.iconsheet) + margin*2;\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(IconButton);\r\n\r\n\r\nexport class IconCheck extends IconButton {\r\n  constructor() {\r\n    super();\r\n\r\n    this._checked = undefined;\r\n    this._drawCheck = undefined;\r\n  }\r\n\r\n  get drawCheck() {\r\n    let ret = this._drawCheck;\r\n\r\n    ret = ret === undefined ? this.getDefault(\"drawCheck\") : ret;\r\n    ret = ret === undefined ? true : ret;\r\n\r\n    return ret;\r\n  }\r\n\r\n  set drawCheck(val) {\r\n    val = !!val;\r\n\r\n    if (val && (this.packflag & PackFlags.HIDE_CHECK_MARKS)) {\r\n      this.packflag &= ~PackFlags.HIDE_CHECK_MARKS;\r\n    }\r\n\r\n    let old = !!this.drawCheck;\r\n    this._drawCheck = val;\r\n\r\n    if (val !== old) {\r\n      this.updateDrawCheck();\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  click() {\r\n    super.click();\r\n    this.checked ^= true;\r\n  }\r\n\r\n  get icon() {\r\n    return this._icon;\r\n  }\r\n\r\n  set icon(val) {\r\n    this._icon = val;\r\n    this.setCSS();\r\n  }\r\n\r\n  get checked() {\r\n    return this._checked;\r\n  }\r\n\r\n  set checked(val) {\r\n    if (!!val !== !!this._checked) {\r\n      this._checked = val\r\n      this._updatePressed(!!val);\r\n      this.setCSS();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(val);\r\n      }\r\n    }\r\n  }\r\n\r\n  get noEmboss() {\r\n    let ret = this.getAttribute(\"no-emboss\");\r\n\r\n    if (!ret) {\r\n      return false;\r\n    }\r\n\r\n    ret = ret.toLowerCase().trim();\r\n\r\n    return ret === 'true' || ret === 'yes' || ret === 'on';\r\n  }\r\n\r\n  set noEmboss(val) {\r\n    this.setAttribute('no-emboss', val ? 'true' : 'false');\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname    : \"iconcheck-x\",\r\n      style      : \"iconcheck\",\r\n      parentStyle: \"iconbutton\"\r\n    };\r\n  }\r\n\r\n  _updatePressed(val) {\r\n    //don't set _pressed if we have a custom icon for press state\r\n    if (this._icon_pressed) {\r\n      this._draw_pressed = false;\r\n    }\r\n\r\n    this._pressed = val;\r\n    this.setCSS();\r\n  }\r\n\r\n  _on_depress() {\r\n    return;\r\n  }\r\n\r\n  _on_press() {\r\n    this.checked ^= true;\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), !!this.checked);\r\n    }\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  updateDefaultSize() {\r\n\r\n  }\r\n\r\n  _calcUpdateKey() {\r\n    return super._calcUpdateKey() + \":\" + this._icon;\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\") || !this.ctx) {\r\n      return;\r\n    }\r\n\r\n    if (this._icon < 0) {\r\n      let rdef;\r\n      try {\r\n        rdef = this.ctx.api.resolvePath(this.ctx, this.getAttribute(\"datapath\"));\r\n      } catch (error) {\r\n        if (error instanceof DataPathError) {\r\n          return;\r\n        } else {\r\n          throw error;\r\n        }\r\n      }\r\n\r\n      if (rdef !== undefined && rdef.prop) {\r\n        let icon, icon2, title;\r\n\r\n        if (rdef.prop.flag & PropFlags.NO_UNDO) {\r\n          this.setUndo(false);\r\n        } else {\r\n          this.setUndo(true);\r\n        }\r\n\r\n        //console.log(\"SUBKEY\", rdef.subkey, rdef.prop.iconmap);\r\n\r\n        if (rdef.subkey && (rdef.prop.type === PropTypes.FLAG || rdef.prop.type === PropTypes.ENUM)) {\r\n          icon = rdef.prop.iconmap[rdef.subkey];\r\n          icon2 = rdef.prop.iconmap2[rdef.subkey];\r\n          title = rdef.prop.descriptions[rdef.subkey];\r\n\r\n          if (!title && rdef.subkey.length > 0) {\r\n            title = rdef.subkey;\r\n            title = title[0].toUpperCase() + title.slice(1, title.length).toLowerCase();\r\n          }\r\n        } else {\r\n          icon2 = rdef.prop.icon2;\r\n          icon = rdef.prop.icon;\r\n          title = rdef.prop.description;\r\n        }\r\n\r\n        if (icon2 !== undefined && icon2 !== -1) {\r\n          this._icon_pressed = icon;\r\n          icon = icon2;\r\n        }\r\n\r\n        if (icon !== undefined && icon !== this.icon)\r\n          this.icon = icon;\r\n        if (title)\r\n          this.description = title;\r\n      }\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (val === undefined) {\r\n      this.internalDisabled = true;\r\n      return;\r\n    } else {\r\n      this.internalDisabled = false;\r\n    }\r\n\r\n    val = !!val;\r\n\r\n    if (val !== !!this._checked) {\r\n      this._checked = val;\r\n      this._updatePressed(!!val);\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  updateDrawCheck() {\r\n    if (this.drawCheck) {\r\n      this._extraIcon = this._checked ? ui_base.Icons.ENUM_CHECKED : ui_base.Icons.ENUM_UNCHECKED;\r\n    } else {\r\n      this._extraIcon = undefined;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    if (this.packflag & PackFlags.HIDE_CHECK_MARKS) {\r\n      this.drawCheck = false;\r\n    }\r\n\r\n    this.updateDrawCheck();\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n\r\n    super.update();\r\n  }\r\n\r\n  _getsize() {\r\n    let margin = this.getDefault(\"padding\");\r\n    return ui_base.iconmanager.getTileSize(this.iconsheet) + margin*2;\r\n  }\r\n\r\n  setCSS() {\r\n    this.updateDrawCheck();\r\n    super.setCSS();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(IconCheck);\r\n\r\nexport class Check1 extends Button {\r\n  constructor() {\r\n    super();\r\n\r\n    this._namePad = 40;\r\n    this._value = undefined;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname    : \"check1-x\",\r\n      parentStyle: \"button\"\r\n    };\r\n  }\r\n\r\n  _redraw() {\r\n    //console.log(\"button draw\");\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let box = 40;\r\n    ui_base.drawRoundBox(this, this.dom, this.g, box);\r\n\r\n    let ts = this.getDefault(\"DefaultText\").size;\r\n\r\n    let text = this._genLabel();\r\n\r\n    //console.log(text, \"text\", this._name);\r\n\r\n    let tw = ui_base.measureText(this, text, this.dom, this.g).width;\r\n    let cx = this.dom.width/2 - tw/2;\r\n    let cy = this.dom.height/2;\r\n\r\n    ui_base.drawText(this, box, cy + ts/2, text, {\r\n      canvas: this.dom, g: this.g\r\n    });\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(Check1);\r\n\r\nexport {checkForTextBox} from './ui_textbox.js';\r\n","\"use strict\";\r\n\r\nimport * as util from \"../path-controller/util/util.js\";\r\nimport cconst from \"../config/const.js\";\r\nimport * as ui_base from \"../core/ui_base.js\";\r\nimport * as toolprop from \"../path-controller/toolsys/toolprop.js\";\r\nimport { OldButton } from \"./ui_button.js\";\r\nimport { DomEventTypes } from \"../path-controller/util/events.js\";\r\n\r\nimport { HotKey, keymap } from \"../path-controller/util/simple_events.js\";\r\nimport { parseToolPath } from \"../path-controller/controller.js\";\r\n\r\nlet EnumProperty = toolprop.EnumProperty,\r\n  PropTypes = toolprop.PropTypes;\r\n\r\nlet UIBase = ui_base.UIBase,\r\n  PackFlags = ui_base.PackFlags,\r\n  IconSheets = ui_base.IconSheets;\r\n\r\nfunction getpx(css) {\r\n  return parseFloat(css.trim().replace(\"px\", \"\"));\r\n}\r\n\r\nfunction debugmenu() {\r\n  if (window.DEBUG && window.DEBUG.menu) {\r\n    console.warn(\"%cmenu:\", \"color:blue\", ...arguments);\r\n  }\r\n}\r\n\r\nexport class Menu extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.parentMenu = undefined;\r\n\r\n    this._was_clicked = false;\r\n\r\n    this.items = [];\r\n    this.autoSearchMode = true;\r\n\r\n    this._ignoreFocusEvents = false;\r\n    this.closeOnMouseUp = true;\r\n\r\n    this._submenu = undefined;\r\n\r\n    this.ignoreFirstClick = false;\r\n\r\n    this.itemindex = 0;\r\n    this.closed = false;\r\n    this.started = false;\r\n    this.activeItem = undefined;\r\n\r\n    this.overrideDefault(\"DefaultText\", this.getDefault(\"MenuText\"));\r\n\r\n    //we have to make a container for any submenus to\r\n    this.container = document.createElement(\"span\");\r\n    this.container.style[\"display\"] = \"flex\";\r\n    this.container.style[\"color\"] = this.getDefault(\"MenuText\").color;\r\n\r\n    //this.container.style[\"background-color\"] = \"red\";\r\n    this.container.setAttribute(\"class\", \"menucon\");\r\n\r\n    this.dom = document.createElement(\"ul\");\r\n    this.dom.setAttribute(\"class\", \"menu\");\r\n    /*\r\n              place-items: start start;\r\n              flex-wrap : nowrap;\r\n              align-content : start;\r\n              place-content : start;\r\n              justify-content : start;\r\n\r\n              align-items : start;\r\n              place-items : start;\r\n              justify-items : start;\r\n    */\r\n\r\n    let style = (this.menustyle = document.createElement(\"style\"));\r\n    this.buildStyle();\r\n\r\n    this.dom.setAttribute(\"tabindex\", -1);\r\n\r\n    //the menu wrangler handles key events\r\n\r\n    this.shadow.appendChild(style);\r\n    this.shadow.appendChild(this.container);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"menu-x\",\r\n      style  : \"menu\",\r\n    };\r\n  }\r\n\r\n  float(x, y, zindex = undefined) {\r\n    let dpi = this.getDPI();\r\n    let rect = this.dom.getClientRects();\r\n    let maxx = this.getWinWidth() - 10;\r\n    let maxy = this.getWinHeight() - 10;\r\n\r\n    if (rect.length > 0) {\r\n      rect = rect[0];\r\n      if (y + rect.height > maxy) {\r\n        y = maxy - rect.height - 1;\r\n      }\r\n\r\n      if (x + rect.width > maxx) {\r\n        x = maxx - rect.width - 1;\r\n      }\r\n    }\r\n\r\n    super.float(x, y, 50);\r\n  }\r\n\r\n  click() {\r\n    if (this._was_clicked) {\r\n      return;\r\n    }\r\n\r\n    if (this.ignoreFirstClick) {\r\n      this.ignoreFirstClick = Math.max(this.ignoreFirstClick - 1, 0);\r\n      return;\r\n    }\r\n\r\n    if (!this.activeItem || this.activeItem._isMenu) {\r\n      return;\r\n    }\r\n\r\n    this._was_clicked = true;\r\n\r\n    if (this.onselect) {\r\n      try {\r\n        this.onselect(this.activeItem._id);\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        console.log(\"Error in menu callback\");\r\n      }\r\n    }\r\n\r\n    this.close();\r\n  }\r\n\r\n  _ondestroy() {\r\n    if (this.started) {\r\n      menuWrangler.popMenu(this);\r\n\r\n      if (this.onclose) {\r\n        this.onclose();\r\n      }\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this.setCSS();\r\n  }\r\n\r\n  close() {\r\n    if (this.closed) {\r\n      return;\r\n    }\r\n\r\n    this.closed = true;\r\n\r\n    if (this.started) {\r\n      menuWrangler.popMenu(this);\r\n    }\r\n\r\n    this.started = false;\r\n\r\n    if (this._popup) {\r\n      this._popup.end();\r\n      this._popup = undefined;\r\n    }\r\n\r\n    this.remove();\r\n    this.dom.remove();\r\n\r\n    if (this.onclose) {\r\n      this.onclose(this);\r\n    }\r\n  }\r\n\r\n  _select(dir, focus = true) {\r\n    if (this.activeItem === undefined) {\r\n      for (let item of this.items) {\r\n        if (!item.hidden) {\r\n          this.setActive(item, focus);\r\n          break;\r\n        }\r\n      }\r\n    } else {\r\n      let i = this.items.indexOf(this.activeItem);\r\n      let item = this.activeItem;\r\n\r\n      do {\r\n        i = (i + dir + this.items.length) % this.items.length;\r\n        item = this.items[i];\r\n\r\n        if (!item.hidden) {\r\n          break;\r\n        }\r\n      } while (item !== this.activeItem);\r\n\r\n      this.setActive(item, focus);\r\n    }\r\n\r\n    if (this.hasSearchBox) {\r\n      this.activeItem.scrollIntoView();\r\n    }\r\n  }\r\n\r\n  selectPrev(focus = true) {\r\n    return this._select(-1, focus);\r\n  }\r\n\r\n  selectNext(focus = true) {\r\n    return this._select(1, focus);\r\n  }\r\n\r\n  start_fancy(prepend, setActive = true) {\r\n    return this.startFancy(prepend, setActive);\r\n  }\r\n\r\n  setActive(item, focus = true) {\r\n    if (this.activeItem === item) {\r\n      return;\r\n    }\r\n\r\n    if (this.activeItem) {\r\n      this.activeItem.style[\"background-color\"] = this.getDefault(\"MenuBG\");\r\n\r\n      if (focus) {\r\n        this.activeItem.blur();\r\n      }\r\n    }\r\n\r\n    if (item) {\r\n      item.style[\"background-color\"] = this.getDefault(\"MenuHighlight\");\r\n\r\n      if (focus) {\r\n        item.focus();\r\n      }\r\n    }\r\n\r\n    this.activeItem = item;\r\n  }\r\n\r\n  startFancy(prepend, setActive = true) {\r\n    this.hasSearchBox = true;\r\n    this.started = true;\r\n    menuWrangler.pushMenu(this);\r\n\r\n    let dom2 = document.createElement(\"div\");\r\n    //let dom2 = document.createElement(\"div\");\r\n\r\n    this.dom.setAttribute(\"class\", \"menu\");\r\n    dom2.setAttribute(\"class\", \"menu\");\r\n\r\n    let sbox = (this.textbox = UIBase.createElement(\"textbox-x\"));\r\n    this.textbox.parentWidget = this;\r\n\r\n    dom2.appendChild(sbox);\r\n    dom2.appendChild(this.dom);\r\n\r\n    dom2.style[\"height\"] = \"300px\";\r\n    this.dom.style[\"height\"] = \"300px\";\r\n    this.dom.style[\"overflow\"] = \"scroll\";\r\n\r\n    if (prepend) {\r\n      this.container.prepend(dom2);\r\n    } else {\r\n      this.container.appendChild(dom2);\r\n    }\r\n\r\n    dom2.parentWidget = this.container;\r\n\r\n    sbox.focus();\r\n    sbox.onchange = () => {\r\n      let t = sbox.text.trim().toLowerCase();\r\n\r\n      for (let item of this.items) {\r\n        item.hidden = true;\r\n        item.remove();\r\n      }\r\n\r\n      for (let item of this.items) {\r\n        let ok = t == \"\";\r\n        ok = ok || item.innerHTML.toLowerCase().search(t) >= 0;\r\n\r\n        if (ok) {\r\n          item.hidden = false;\r\n          this.dom.appendChild(item);\r\n        } else if (item === this.activeItem) {\r\n          this.selectNext(false);\r\n        }\r\n        //item.hidden = !ok;\r\n      }\r\n    };\r\n\r\n    sbox.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case 27: //escape key\r\n          this.close();\r\n          break;\r\n        case 13: //enter key\r\n          this.click(this.activeItem);\r\n          this.close();\r\n          break;\r\n      }\r\n    });\r\n  }\r\n\r\n  start(prepend = false, setActive = true) {\r\n    this.closed = false;\r\n\r\n    this.started = true;\r\n    this.focus();\r\n\r\n    menuWrangler.pushMenu(this);\r\n\r\n    let dokey = (key) => {\r\n      let val = this.getDefault(key);\r\n      if (typeof val === \"number\") {\r\n        val = \"\" + val + \"px\";\r\n      }\r\n\r\n      if (val !== undefined) {\r\n        this.dom.style[key] = val;\r\n      }\r\n    };\r\n\r\n    dokey(\"padding\");\r\n    dokey(\"padding-top\");\r\n    dokey(\"padding-left\");\r\n    dokey(\"padding-right\");\r\n    dokey(\"padding-bottom\");\r\n\r\n    if (this.items.length > 15 && this.autoSearchMode) {\r\n      return this.start_fancy(prepend, setActive);\r\n    }\r\n\r\n    if (prepend) {\r\n      this.container.prepend(this.dom);\r\n    } else {\r\n      this.container.appendChild(this.dom);\r\n    }\r\n\r\n    if (!setActive) return;\r\n\r\n    this.setCSS();\r\n    this.flushUpdate();\r\n\r\n    window.setTimeout(() => {\r\n      this.flushUpdate();\r\n\r\n      //select first child\r\n      //TODO: cache last child entry\r\n\r\n      if (this.activeItem === undefined) {\r\n        this.activeItem = this.dom.childNodes[0];\r\n      }\r\n\r\n      if (this.activeItem === undefined) {\r\n        return;\r\n      }\r\n\r\n      this.activeItem.focus();\r\n    }, 0);\r\n  }\r\n\r\n  addItemExtra(text, id = undefined, hotkey, icon = -1, add = true, tooltip = undefined) {\r\n    let dom = document.createElement(\"span\");\r\n\r\n    dom.style[\"display\"] = \"inline-flex\";\r\n\r\n    dom.hotkey = hotkey;\r\n    dom.icon = icon;\r\n\r\n    let icon_div;\r\n\r\n    if (1) {\r\n      //icon >= 0) {\r\n      icon_div = ui_base.makeIconDiv(icon, IconSheets.SMALL);\r\n    } else {\r\n      let tilesize = ui_base.iconmanager.getTileSize(IconSheets.SMALL);\r\n\r\n      //tilesize *= window.devicePixelRatio;\r\n\r\n      icon_div = document.createElement(\"span\");\r\n      icon_div.style[\"padding\"] = icon_div.style[\"margin\"] = \"0px\";\r\n      icon_div.style[\"width\"] = tilesize + \"px\";\r\n      icon_div.style[\"height\"] = tilesize + \"px\";\r\n    }\r\n\r\n    icon_div.style[\"display\"] = \"inline-flex\";\r\n    icon_div.style[\"margin-right\"] = \"1px\";\r\n    icon_div.style[\"align\"] = \"left\";\r\n\r\n    let span = document.createElement(\"span\");\r\n\r\n    //stupid css doesn't get width right. . .\r\n    span.style[\"font\"] = ui_base.getFont(this, undefined, \"MenuText\");\r\n\r\n    let dpi = this.getDPI();\r\n    let tsize = this.getDefault(\"MenuText\").size;\r\n    //XXX proportional font fail\r\n\r\n    //XXX stupid!\r\n    let canvas = document.createElement(\"canvas\");\r\n    let g = canvas.getContext(\"2d\");\r\n\r\n    g.font = span.style[\"font\"];\r\n\r\n    let rect = span.getClientRects();\r\n\r\n    let twid = Math.ceil(g.measureText(text).width);\r\n    let hwid;\r\n    if (hotkey) {\r\n      dom.hotkey = hotkey;\r\n      g.font = ui_base.getFont(this, undefined, \"HotkeyText\");\r\n      hwid = Math.ceil(g.measureText(hotkey).width / UIBase.getDPI());\r\n      twid += hwid + 8;\r\n    }\r\n\r\n    //let twid = Math.ceil(text.trim().length * tsize / dpi);\r\n\r\n    span.innerText = text;\r\n\r\n    span.style[\"word-wrap\"] = \"none\";\r\n    span.style[\"white-space\"] = \"pre\";\r\n    span.style[\"overflow\"] = \"hidden\";\r\n    span.style[\"text-overflow\"] = \"clip\";\r\n\r\n    span.style[\"width\"] = ~~twid + \"px\";\r\n    span.style[\"padding\"] = \"0px\";\r\n    span.style[\"margin\"] = \"0px\";\r\n\r\n    dom.style[\"width\"] = \"100%\";\r\n\r\n    dom.appendChild(icon_div);\r\n    dom.appendChild(span);\r\n\r\n    if (hotkey) {\r\n      let hotkey_span = document.createElement(\"span\");\r\n      hotkey_span.innerText = hotkey;\r\n      hotkey_span.style[\"display\"] = \"inline-flex\";\r\n\r\n      hotkey_span.style[\"margin\"] = \"0px\";\r\n      hotkey_span.style[\"margin-left\"] = \"auto\";\r\n      hotkey_span.style[\"margin-right\"] = \"0px\";\r\n      hotkey_span.style[\"padding\"] = \"0px\";\r\n\r\n      hotkey_span.style[\"font\"] = ui_base.getFont(this, undefined, \"HotkeyText\");\r\n      hotkey_span.style[\"color\"] = this.getDefault(\"HotkeyTextColor\");\r\n\r\n      //hotkey_span.style[\"width\"] = ~~((hwid + 7)) + \"px\";\r\n      hotkey_span.style[\"width\"] = \"max-content\";\r\n\r\n      //hotkey_span.style[\"background-color\"] = \"rgba(0,0,0,0)\";\r\n\r\n      hotkey_span.style[\"text-align\"] = \"right\";\r\n      hotkey_span.style[\"justify-content\"] = \"right\";\r\n      hotkey_span[\"flex-wrap\"] = \"nowrap\";\r\n      hotkey_span[\"text-wrap\"] = \"nowrap\";\r\n\r\n      //hotkey_span.style[\"border\"] = \"1px solid red\";\r\n\r\n      //hotkey_span.style[\"display\"] = \"inline\";\r\n      //hotkey_span.style[\"float\"] = \"right\";\r\n\r\n      dom.appendChild(hotkey_span);\r\n    }\r\n\r\n    let ret = this.addItem(dom, id, add);\r\n\r\n    ret.hotkey = hotkey;\r\n    ret.icon = icon;\r\n    ret.label = text ? text : ret.innerText;\r\n\r\n    if (tooltip) {\r\n      ret.title = tooltip;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  //item can be menu or text\r\n  addItem(item, id, add = true, tooltip = undefined) {\r\n    id = id === undefined ? item : id;\r\n    let text = item;\r\n\r\n    if (typeof item === \"string\" || item instanceof String) {\r\n      let dom = document.createElement(\"dom\");\r\n      dom.style[\"text-align\"] = \"left\";\r\n\r\n      dom.textContent = item;\r\n      item = dom;\r\n      //return this.addItemExtra(item, id);\r\n    } else {\r\n      text = item.textContent;\r\n    }\r\n\r\n    let li = document.createElement(\"li\");\r\n\r\n    li.setAttribute(\"tabindex\", this.itemindex++);\r\n    li.setAttribute(\"class\", \"menuitem\");\r\n\r\n    if (tooltip !== undefined) {\r\n      li.title = tooltip;\r\n    }\r\n\r\n    if (item instanceof Menu) {\r\n      //let dom = this.addItemExtra(\"\"+item.title, id, \"\", -1, false);\r\n      let dom = document.createElement(\"span\");\r\n      dom.innerHTML = \"\" + item.title;\r\n      dom._id = dom.id = id;\r\n      dom.setAttribute(\"class\", \"menu\");\r\n\r\n      //dom = document.createElement(\"div\");\r\n      //dom.innerText = \"\"+item.title;\r\n\r\n      //dom.style[\"display\"] = \"inline-block\";\r\n      li.style[\"width\"] = \"100%\";\r\n      li.appendChild(dom);\r\n\r\n      li._isMenu = true;\r\n      li._menu = item;\r\n      item.parentMenu = this;\r\n\r\n      item.hidden = false;\r\n      item.container = this.container;\r\n    } else {\r\n      li._isMenu = false;\r\n      li.appendChild(item);\r\n    }\r\n\r\n    li._id = id;\r\n\r\n    this.items.push(li);\r\n\r\n    li.label = text ? text : li.innerText.trim();\r\n\r\n    if (add) {\r\n      li.addEventListener(\"blur\", (e) => {\r\n        if (this._ignoreFocusEvents) {\r\n          return;\r\n        }\r\n\r\n        if (this.activeItem && !this.activeItem._isMenu) {\r\n          this.setActive(undefined, false);\r\n        }\r\n      });\r\n\r\n      let onfocus = (e) => {\r\n        if (this._ignoreFocusEvents) {\r\n          return;\r\n        }\r\n\r\n        let active = this.activeItem;\r\n\r\n        if (this._submenu) {\r\n          this._submenu.close();\r\n          this._submenu = undefined;\r\n        }\r\n\r\n        if (li._isMenu) {\r\n          li._menu.onselect = (item) => {\r\n            this.onselect(item);\r\n            li._menu.close();\r\n            this.close();\r\n          };\r\n\r\n          li._menu.start(false, false);\r\n          this._submenu = li._menu;\r\n        }\r\n\r\n        this.setActive(li, false);\r\n      };\r\n\r\n      let onclick = (e) => {\r\n        onfocus(e);\r\n\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n\r\n        if (this.activeItem !== undefined && this.activeItem._isMenu) {\r\n          //ignore\r\n          return;\r\n        }\r\n\r\n        this.click();\r\n      };\r\n\r\n      li.addEventListener(\"contextmenu\", (e) => e.preventDefault());\r\n      this.addEventListener(\"contextmenu\", (e) => e.preventDefault());\r\n\r\n      li.addEventListener(\"pointerup\", onclick, { capture: true });\r\n      li.addEventListener(\"click\", onclick, { capture: true });\r\n      li.addEventListener(\"pointerdown\", onclick, { capture: true });\r\n\r\n      li.addEventListener(\"focus\", (e) => {\r\n        onfocus(e);\r\n        onfocus(e);\r\n      });\r\n\r\n      li.addEventListener(\"pointermove\", (e) => {\r\n        onfocus(e);\r\n        li.focus();\r\n      });\r\n      li.addEventListener(\"mouseover\", (e) => {\r\n        onfocus(e);\r\n        li.focus();\r\n      });\r\n      li.addEventListener(\"mouseenter\", (e) => {\r\n        onfocus(e);\r\n        li.focus();\r\n      });\r\n\r\n      li.addEventListener(\"pointerover\", (e) => {\r\n        onfocus(e);\r\n        li.focus();\r\n      });\r\n\r\n      this.dom.appendChild(li);\r\n    }\r\n\r\n    return li;\r\n  }\r\n\r\n  _getBorderStyle() {\r\n    let r = this.getDefault(\"border-width\");\r\n    let s = this.getDefault(\"border-style\");\r\n    let c = this.getDefault(\"border-color\");\r\n\r\n    return `${r}px ${s} ${c}`;\r\n  }\r\n\r\n  buildStyle() {\r\n    let pad1 = util.isMobile() ? 2 : 0;\r\n    pad1 += this.getDefault(\"MenuSpacing\");\r\n\r\n    let boxShadow = \"\";\r\n    if (this.hasDefault(\"box-shadow\")) {\r\n      boxShadow = \"box-shadow: \" + this.getDefault(\"box-shadow\") + \";\";\r\n    }\r\n\r\n    let sepcss = this.getDefault(\"MenuSeparator\");\r\n    if (typeof sepcss === \"object\") {\r\n      let s = \"\";\r\n\r\n      for (let k in sepcss) {\r\n        let v = sepcss[k];\r\n\r\n        if (typeof v === \"number\") {\r\n          v = v.toFixed(4) + \"px\";\r\n        }\r\n\r\n        s += `    ${k}: ${v};\\n`;\r\n      }\r\n\r\n      sepcss = s;\r\n    }\r\n\r\n    let itemRadius = 0;\r\n\r\n    if (this.hasDefault(\"item-radius\")) {\r\n      itemRadius = this.getDefault(\"item-radius\");\r\n    } else {\r\n      itemRadius = this.getDefault(\"border-radius\");\r\n    }\r\n\r\n    this.menustyle.textContent = `\r\n        .menucon {\r\n          position:fixed;\r\n          float:left;\r\n          \r\n          border-radius : ${this.getDefault(\"border-radius\")}px;\r\n\r\n          display: block;\r\n          -moz-user-focus: normal;\r\n          ${boxShadow}\r\n        }\r\n        \r\n        ul.menu {\r\n          display        : flex;\r\n          flex-direction : column;\r\n          flex-wrap      : nowrap;\r\n          width          : max-content;\r\n          \r\n          margin : 0px;\r\n          padding : 0px;\r\n          border : ${this._getBorderStyle()};\r\n          border-radius : ${this.getDefault(\"border-radius\")}px;\r\n          -moz-user-focus: normal;\r\n          background-color: ${this.getDefault(\"MenuBG\")};\r\n          color : ${this.getDefault(\"MenuText\").color};\r\n        }\r\n        \r\n        .menuitem {\r\n          display : flex;\r\n          flex-wrap : nowrap;\r\n          flex-direction : row;          \r\n          \r\n          list-style-type:none;\r\n          -moz-user-focus: normal;\r\n          \r\n          margin : 0;\r\n          padding : 0px;\r\n          padding-right: 16px;\r\n          padding-left: 16px;\r\n          padding-top : ${pad1}px;\r\n          padding-bottom : ${pad1}px;\r\n          \r\n          border-radius : ${itemRadius}px;\r\n          \r\n          color : ${this.getDefault(\"MenuText\").color};\r\n          font : ${this.getDefault(\"MenuText\").genCSS()};\r\n          background-color: ${this.getDefault(\"MenuBG\")};\r\n        }\r\n        \r\n        .menuseparator {\r\n          ${sepcss}\r\n        }\r\n        \r\n        .menuitem:focus {\r\n          display : flex;\r\n          text-align: left;\r\n          \r\n          border : none;\r\n          outline : none;\r\n          border-radius : ${itemRadius}px;\r\n          \r\n          background-color: ${this.getDefault(\"MenuHighlight\")};\r\n          color : ${this.getDefault(\"MenuText\").color};\r\n          -moz-user-focus: normal;\r\n        }\r\n      `;\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.buildStyle();\r\n\r\n    this.container.style[\"color\"] = this.getDefault(\"MenuText\").color;\r\n    this.style[\"color\"] = this.getDefault(\"MenuText\").color;\r\n  }\r\n\r\n  seperator() {\r\n    let bar = document.createElement(\"div\");\r\n    bar.setAttribute(\"class\", \"menuseparator\");\r\n\r\n    this.dom.appendChild(bar);\r\n\r\n    return this;\r\n  }\r\n\r\n  menu(title) {\r\n    let ret = UIBase.createElement(\"menu-x\");\r\n\r\n    ret.setAttribute(\"name\", title);\r\n    this.addItem(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  calcSize() {}\r\n}\r\n\r\nMenu.SEP = Symbol(\"menu seperator\");\r\nUIBase.internalRegister(Menu);\r\n\r\nexport class DropBox extends OldButton {\r\n  constructor() {\r\n    super();\r\n\r\n    this.lockTimer = 0;\r\n\r\n    this._template = undefined;\r\n\r\n    this._searchMenuMode = false;\r\n    this.altKey = undefined;\r\n\r\n    this._value = 0;\r\n\r\n    this._last_datapath = undefined;\r\n\r\n    this.r = 5;\r\n    this._menu = undefined;\r\n    this._auto_depress = false;\r\n    //this.prop = new ui_base.EnumProperty(undefined, {}, \"\", \"\", 0);\r\n\r\n    this._onpress = this._onpress.bind(this);\r\n  }\r\n\r\n  get searchMenuMode() {\r\n    return this._searchMenuMode;\r\n  }\r\n\r\n  set searchMenuMode(v) {\r\n    this._searchMenuMode = v;\r\n  }\r\n\r\n  get template() {\r\n    return this._template;\r\n  }\r\n\r\n  set template(v) {\r\n    this._template = v;\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(v) {\r\n    this.setValue(v);\r\n  }\r\n\r\n  get menu() {\r\n    return this._menu;\r\n  }\r\n\r\n  set menu(val) {\r\n    this._menu = val;\r\n\r\n    if (val !== undefined) {\r\n      this._name = val.title;\r\n      this.updateName();\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"dropbox-x\",\r\n      style  : \"dropbox\",\r\n    };\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.setAttribute(\"menu-button\", \"true\");\r\n\r\n    this.updateWidth();\r\n  }\r\n\r\n  setCSS() {\r\n    //do not call parent classes's setCSS here\r\n\r\n    this.style[\"user-select\"] = \"none\";\r\n    this.dom.style[\"user-select\"] = \"none\";\r\n\r\n    let keys;\r\n    if (this.getAttribute(\"simple\")) {\r\n      keys = [\"margin-left\", \"margin-right\", \"padding-left\", \"padding-right\"];\r\n    } else {\r\n      keys = [\r\n        \"margin\",\r\n        \"margin-left\",\r\n        \"margin-right\",\r\n        \"margin-top\",\r\n        \"margin-bottom\",\r\n        \"padding\",\r\n        \"padding-left\",\r\n        \"padding-right\",\r\n        \"padding-top\",\r\n        \"padding-bottom\",\r\n      ];\r\n    }\r\n\r\n    let setDefault = (key) => {\r\n      if (this.hasDefault(key)) {\r\n        this.style[key] = this.getDefault(key, undefined, 0) + \"px\";\r\n      }\r\n    };\r\n\r\n    for (let k of keys) {\r\n      setDefault(k);\r\n    }\r\n  }\r\n\r\n  _genLabel() {\r\n    let s = super._genLabel();\r\n    let ret = \"\";\r\n\r\n    if (s.length === 0) {\r\n      s = \"(error)\";\r\n    }\r\n\r\n    this.altKey = s[0].toUpperCase().charCodeAt(0);\r\n\r\n    for (let i = 0; i < s.length; i++) {\r\n      if (s[i] === \"&\" && i < s.length - 1 && s[i + 1] !== \"&\") {\r\n        this.altKey = s[i + 1].toUpperCase().charCodeAt(0);\r\n      } else if (s[i] === \"&\" && i < s.length - 1 && s[i + 1] === \"&\") {\r\n        continue;\r\n      } else {\r\n        ret += s[i];\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  updateWidth() {\r\n    //let ret = super.updateWidth(10);\r\n    let dpi = this.getDPI();\r\n\r\n    let ts = this.getDefault(\"DefaultText\").size;\r\n    let tw = this.g.measureText(this._genLabel()).width / dpi;\r\n    //let tw = ui_base.measureText(this, this._genLabel(), undefined, undefined, ts).width + 8;\r\n    tw = ~~tw;\r\n\r\n    tw += 15;\r\n\r\n    if (!this.getAttribute(\"simple\")) {\r\n      tw += 35;\r\n    }\r\n\r\n    if (tw !== this._last_w) {\r\n      this._last_w = tw;\r\n      this.dom.style[\"width\"] = tw + \"px\";\r\n      this.style[\"width\"] = tw + \"px\";\r\n      this.width = tw;\r\n\r\n      this.overrideDefault(\"width\", tw);\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n\r\n    return 0;\r\n  }\r\n\r\n  updateBorders() {\r\n    //Do not apply border stlying to the child canvas\r\n    super.updateBorders(this);\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.ctx || !this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let wasError = false;\r\n    let prop, val;\r\n\r\n    try {\r\n      this.pushReportContext(this._reportCtxName);\r\n      prop = this.ctx.api.resolvePath(this.ctx, this.getAttribute(\"datapath\")).prop;\r\n      val = this.ctx.api.getValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n      prop = prop && prop.prop ? prop.prop : prop;\r\n\r\n      this.popReportContext();\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n      wasError = true;\r\n    }\r\n\r\n    if (wasError) {\r\n      this.disabled = true;\r\n      this.setCSS();\r\n      this._redraw();\r\n\r\n      return;\r\n    } else {\r\n      this.disabled = false;\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n\r\n    if (!prop) {\r\n      return;\r\n    }\r\n\r\n    if (this.prop === undefined) {\r\n      this.prop = prop;\r\n    }\r\n\r\n    prop = this.prop;\r\n\r\n    let name = this.getAttribute(\"name\");\r\n\r\n    if (prop.type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n      name = prop.ui_value_names[prop.keys[val]];\r\n    } else {\r\n      name = \"\" + val;\r\n    }\r\n\r\n    if (name !== this.getAttribute(\"name\")) {\r\n      this.setAttribute(\"name\", name);\r\n      this.updateName();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    let path = this.getAttribute(\"datapath\");\r\n\r\n    if (path && path !== this._last_datapath) {\r\n      this._last_datapath = path;\r\n      this.prop = undefined;\r\n\r\n      this.updateDataPath();\r\n    }\r\n\r\n    super.update();\r\n\r\n    let key = this.getDefault(\"dropTextBG\");\r\n    if (key !== this._last_dbox_key) {\r\n      this._last_dbox_key = key;\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n  }\r\n\r\n  _build_menu_template() {\r\n    if (this._menu !== undefined && this._menu.parentNode !== undefined) {\r\n      this._menu.remove();\r\n    }\r\n\r\n    //let name = \"\" + this.getAttribute(\"name\");\r\n    let template = this._template;\r\n\r\n    if (typeof template === \"function\") {\r\n      template = template();\r\n    }\r\n\r\n    this._menu = createMenu(this.ctx, \"\", template);\r\n    return this._menu;\r\n  }\r\n\r\n  _build_menu() {\r\n    if (this._template) {\r\n      this._build_menu_template();\r\n      return;\r\n    }\r\n\r\n    let prop = this.prop;\r\n\r\n    if (this.prop === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this._menu !== undefined && this._menu.parentNode !== undefined) {\r\n      this._menu.remove();\r\n    }\r\n\r\n    let menu = (this._menu = UIBase.createElement(\"menu-x\"));\r\n\r\n    //let name = \"\" + this.getAttribute(\"name\");\r\n    menu.setAttribute(\"name\", \"\");\r\n    menu._dropbox = this;\r\n\r\n    let valmap = {};\r\n    let enummap = prop.values;\r\n    let iconmap = prop.iconmap;\r\n    let uimap = prop.ui_value_names;\r\n    let desr = prop.descriptions || {};\r\n\r\n    for (let k in enummap) {\r\n      let uk = k;\r\n\r\n      valmap[enummap[k]] = k;\r\n\r\n      if (uimap !== undefined && k in uimap) {\r\n        uk = uimap[k];\r\n      }\r\n\r\n      let tooltip = desr[k];\r\n\r\n      //menu.addItem(k, enummap[k], \":\");\r\n      if (iconmap && iconmap[k]) {\r\n        menu.addItemExtra(uk, enummap[k], undefined, iconmap[k], undefined, tooltip);\r\n      } else {\r\n        menu.addItem(uk, enummap[k], undefined, tooltip);\r\n      }\r\n    }\r\n\r\n    menu.onselect = (id) => {\r\n      this._pressed = false;\r\n\r\n      this._pressed = false;\r\n      this._redraw();\r\n\r\n      this._menu = undefined;\r\n\r\n      //check if datapath system will be calling .prop.setValue instead of us\r\n      let callProp = true;\r\n      if (this.hasAttribute(\"datapath\")) {\r\n        let rdef = this.ctx.api.resolvePath(this.ctx, this.getAttribute(\"datapath\"));\r\n        let prop = rdef.dpath.data;\r\n\r\n        callProp = !rdef || !rdef.dpath || !(rdef.dpath.data instanceof ToolProperty);\r\n      }\r\n\r\n      this._value = this._convertVal(id);\r\n\r\n      if (callProp) {\r\n        this.prop.setValue(id);\r\n      }\r\n\r\n      this.setAttribute(\"name\", this.prop.ui_value_names[valmap[id]]);\r\n      if (this.onselect) {\r\n        this.onselect(id);\r\n      }\r\n\r\n      if (this.hasAttribute(\"datapath\") && this.ctx) {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), id);\r\n      }\r\n    };\r\n  }\r\n\r\n  _onpress(e) {\r\n    this.abortToolTips(1000);\r\n\r\n    if (this._menu !== undefined) {\r\n      this.lockTimer = util.time_ms();\r\n\r\n      this._pressed = false;\r\n      this._redraw();\r\n\r\n      let menu = this._menu;\r\n      this._menu = undefined;\r\n      menu.close();\r\n      return;\r\n    }\r\n\r\n    if (util.time_ms() - this.lockTimer < 200) {\r\n      return;\r\n    }\r\n\r\n    this._build_menu();\r\n\r\n    if (this._menu === undefined) {\r\n      return;\r\n    }\r\n\r\n    this._menu.autoSearchMode = false;\r\n\r\n    this._menu._dropbox = this;\r\n    this.dom._background = this.getDefault(\"BoxDepressed\");\r\n    this._background = this.getDefault(\"BoxDepressed\");\r\n    this._redraw();\r\n    this._pressed = true;\r\n    this.setCSS();\r\n\r\n    let onclose = this._menu.onclose;\r\n    this._menu.onclose = () => {\r\n      this.lockTimer = util.time_ms();\r\n\r\n      this._pressed = false;\r\n      this._redraw();\r\n\r\n      let menu = this._menu;\r\n      if (menu) {\r\n        this._menu = undefined;\r\n        menu._dropbox = undefined;\r\n      }\r\n\r\n      if (onclose) {\r\n        onclose.call(menu);\r\n      }\r\n    };\r\n\r\n    let menu = this._menu;\r\n    let screen = this.getScreen();\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let x = e.x,\r\n      y = e.y;\r\n    let rects = this.dom.getBoundingClientRect(); //getClientRects();\r\n\r\n    let rheight = rects.height;\r\n    x = rects.x - window.scrollX;\r\n    y = rects.y + rheight - window.scrollY; // + rects[0].height; // visualViewport.scale;\r\n\r\n    if (!window.haveElectron) {\r\n      //y -= 8;\r\n    }\r\n\r\n    /* need to figure out a better way to pop up a menu\r\n     *  above a given y position */\r\n    if (cconst.menusCanPopupAbove && y > screen.size[1] * 0.5 && !this.searchMenuMode) {\r\n      let con = screen.popup(this, 500, 400, false, 0);\r\n\r\n      con.style[\"z-index\"] = \"-10000\";\r\n      con.style[\"position\"] = UIBase.PositionKey;\r\n      document.body.appendChild(con);\r\n\r\n      con.style[\"visibility\"] = \"hidden\";\r\n\r\n      con.add(menu);\r\n      menu.start();\r\n\r\n      let time = util.time_ms();\r\n\r\n      let timer = window.setInterval(() => {\r\n        if (util.time_ms() - time > 1500) {\r\n          window.clearInterval(timer);\r\n          return;\r\n        }\r\n\r\n        let r = menu.dom.getBoundingClientRect();\r\n\r\n        if (!r || r.height < 55) {\r\n          return;\r\n        }\r\n\r\n        window.clearInterval(timer);\r\n\r\n        y -= r.height + rheight;\r\n\r\n        menu.dom.remove();\r\n        con.remove();\r\n\r\n        let popup = (this._popup = menu._popup = screen.popup(this, x, y, false, 0));\r\n        popup.noMarginsOrPadding();\r\n\r\n        //popup.shadow.appendChild(menu.dom);\r\n        popup.add(menu);\r\n        menu.start();\r\n\r\n        popup.style[\"left\"] = x + \"px\";\r\n        popup.style[\"top\"] = y + \"px\";\r\n        //menu.setCSS();\r\n      }, 1);\r\n\r\n      return;\r\n    }\r\n\r\n    /*\r\n    let w = document.createElement(\"div\");\r\n    w.style[\"width\"] = w.style[\"height\"] = \"15px\";\r\n    w.style[\"background-color\"] = \"red\";\r\n    w.style[\"z-index\"] = \"5000\";\r\n    w.style[\"position\"] = UIBase.PositionKey;\r\n    w.style[\"pointer-events\"] = \"none\";\r\n    w.style[\"left\"] = x + \"px\";\r\n    w.style[\"top\"] = y + \"px\";\r\n\r\n    document.body.appendChild(w);\r\n    //*/\r\n\r\n    let con = (this._popup = menu._popup = screen.popup(this, x, y, false, 0));\r\n    con.noMarginsOrPadding();\r\n\r\n    con.add(menu);\r\n    if (this.searchMenuMode) {\r\n      menu.startFancy();\r\n    } else {\r\n      menu.start();\r\n    }\r\n  }\r\n\r\n  _redraw() {\r\n    if (this.getAttribute(\"simple\")) {\r\n      let color;\r\n\r\n      this.g.clearRect(0, 0, this.dom.width, this.dom.height);\r\n\r\n      if (this._highlight) {\r\n        ui_base.drawRoundBox2(this, { canvas: this.dom, g: this.g, color: this.getDefault(\"BoxHighlight\") });\r\n      }\r\n\r\n      if (this._focus) {\r\n        ui_base.drawRoundBox2(this, {\r\n          canvas: this.dom,\r\n          g: this.g,\r\n          color: this.getDefault(\"BoxHighlight\"),\r\n          op: \"stroke\",\r\n          no_clear: true,\r\n        });\r\n        ui_base.drawRoundBox(this, this.dom, this.g, undefined, undefined, 2, \"stroke\");\r\n      }\r\n\r\n      this._draw_text();\r\n      return;\r\n    }\r\n\r\n    super._redraw(false);\r\n\r\n    let g = this.g;\r\n    let w = this.dom.width,\r\n      h = this.dom.height;\r\n    let dpi = this.getDPI();\r\n\r\n    let p = 10 * dpi;\r\n    let p2 = dpi;\r\n\r\n    //*\r\n    let bg = this.getDefault(\"dropTextBG\");\r\n    if (bg !== undefined) {\r\n      g.fillStyle = bg;\r\n\r\n      g.beginPath();\r\n      g.rect(p2, p2, this.dom.width - p2 - h, this.dom.height - p2 * 2);\r\n      g.fill();\r\n    }\r\n    //*/\r\n\r\n    g.fillStyle = \"rgba(50, 50, 50, 0.2)\";\r\n    g.strokeStyle = \"rgba(50, 50, 50, 0.8)\";\r\n    g.beginPath();\r\n    /*\r\n    g.moveTo(w-p, p);\r\n    g.lineTo(w-(p+h*0.25), h-p);\r\n    g.lineTo(w-(p+h*0.5), p);\r\n    g.closePath();\r\n    //*/\r\n\r\n    let sz = 0.3;\r\n    g.moveTo(w - h * 0.5 - p, p);\r\n    g.lineTo(w - p, p);\r\n    g.moveTo(w - h * 0.5 - p, p + (sz * h) / 3);\r\n    g.lineTo(w - p, p + (sz * h) / 3);\r\n    g.moveTo(w - h * 0.5 - p, p + (sz * h * 2) / 3);\r\n    g.lineTo(w - p, p + (sz * h * 2) / 3);\r\n\r\n    g.lineWidth = 1;\r\n    g.stroke();\r\n\r\n    this._draw_text();\r\n  }\r\n\r\n  _convertVal(val) {\r\n    if (typeof val === \"string\" && this.prop) {\r\n      if (val in this.prop.values) {\r\n        return this.prop.values[val];\r\n      } else if (val in this.prop.keys) {\r\n        return this.prop.keys[val];\r\n      } else {\r\n        return undefined;\r\n      }\r\n    }\r\n\r\n    return val;\r\n  }\r\n\r\n  setValue(val, setLabelOnly = false) {\r\n    if (val === undefined || val === this._value) {\r\n      return;\r\n    }\r\n\r\n    val = this._convertVal(val);\r\n\r\n    if (val === undefined) {\r\n      console.warn(\"Bad val\", arguments[0]);\r\n      return;\r\n    }\r\n\r\n    this._value = val;\r\n\r\n    if (this.prop !== undefined && !setLabelOnly) {\r\n      this.prop.setValue(val);\r\n      let val2 = val;\r\n\r\n      if (val2 in this.prop.keys) val2 = this.prop.keys[val2];\r\n      val2 = this.prop.ui_value_names[val2];\r\n\r\n      this.setAttribute(\"name\", \"\" + val2);\r\n      this._name = \"\" + val2;\r\n    } else {\r\n      this.setAttribute(\"name\", \"\" + val);\r\n      this._name = \"\" + val;\r\n    }\r\n\r\n    if (this.onchange && !setLabelOnly) {\r\n      this.onchange(val);\r\n    }\r\n\r\n    this.setCSS();\r\n    this.updateDataPath();\r\n    this._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(DropBox);\r\n\r\nexport class MenuWrangler {\r\n  constructor() {\r\n    this.screen = undefined;\r\n    this.menustack = [];\r\n\r\n    this.lastPickElemTime = util.time_ms();\r\n\r\n    this._closetimer = 0;\r\n    this.closeOnMouseUp = undefined;\r\n    this.closereq = undefined;\r\n\r\n    this.timer = undefined;\r\n  }\r\n\r\n  get closetimer() {\r\n    return this._closetimer;\r\n  }\r\n\r\n  set closetimer(v) {\r\n    debugmenu(\"set closertime\", v);\r\n    this._closetimer = v;\r\n  }\r\n\r\n  get menu() {\r\n    return this.menustack.length > 0 ? this.menustack[this.menustack.length - 1] : undefined;\r\n  }\r\n\r\n  pushMenu(menu) {\r\n    debugmenu(\"pushMenu\");\r\n\r\n    this.spawnreq = undefined;\r\n\r\n    if (this.menustack.length === 0 && menu.closeOnMouseUp) {\r\n      this.closeOnMouseUp = true;\r\n    }\r\n\r\n    this.menustack.push(menu);\r\n  }\r\n\r\n  popMenu(menu) {\r\n    debugmenu(\"popMenu\");\r\n\r\n    return this.menustack.pop();\r\n  }\r\n\r\n  endMenus() {\r\n    debugmenu(\"endMenus\");\r\n\r\n    for (let menu of this.menustack) {\r\n      menu.close();\r\n    }\r\n\r\n    this.menustack = [];\r\n  }\r\n\r\n  searchKeyDown(e) {\r\n    let menu = this.menu;\r\n\r\n    e.stopPropagation();\r\n    menu._ignoreFocusEvents = true;\r\n    menu.textbox.focus();\r\n    menu._ignoreFocusEvents = false;\r\n\r\n    //if (e.shiftKey || e.altKey || e.ctrlKey || e.commandKey) {\r\n    //  return;\r\n    //}\r\n\r\n    switch (e.keyCode) {\r\n      case keymap[\"Enter\"]: //return key\r\n        menu.click(menu.activeItem);\r\n        break;\r\n      case keymap[\"Escape\"]: //escape key\r\n        menu.close();\r\n        break;\r\n      case keymap[\"Up\"]:\r\n        menu.selectPrev(false);\r\n        break;\r\n      case keymap[\"Down\"]:\r\n        menu.selectNext(false);\r\n        break;\r\n    }\r\n  }\r\n\r\n  on_keydown(e) {\r\n    window.menu = this.menu;\r\n\r\n    if (this.menu === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this.menu.hasSearchBox) {\r\n      return this.searchKeyDown(e);\r\n    }\r\n\r\n    let menu = this.menu;\r\n\r\n    switch (e.keyCode) {\r\n      case keymap[\"Left\"]: //left\r\n      case keymap[\"Right\"]: //right\r\n        if (menu._dropbox) {\r\n          let dropbox = menu._dropbox;\r\n\r\n          if (e.keyCode === keymap[\"Left\"]) {\r\n            dropbox = dropbox.previousElementSibling;\r\n          } else {\r\n            dropbox = dropbox.nextElementSibling;\r\n          }\r\n\r\n          if (dropbox !== undefined && dropbox instanceof DropBox) {\r\n            this.endMenus();\r\n            dropbox._onpress(e);\r\n          }\r\n        }\r\n        break;\r\n      case keymap[\"Up\"]: //up\r\n        menu.selectPrev();\r\n        break;\r\n      case keymap[\"Down\"]: //down\r\n        menu.selectNext();\r\n        break;\r\n      /*\r\n      let item = menu.activeItem;\r\n      if (!item) {\r\n        item = menu.items[0];\r\n      }\r\n\r\n      if (!item) {\r\n        return;\r\n      }\r\n\r\n      let item2;\r\n      let i = menu.items.indexOf(item);\r\n\r\n      if (e.keyCode == 38) {\r\n        i = (i - 1 + menu.items.length) % menu.items.length;\r\n      } else {\r\n        i = (i + 1) % menu.items.length;\r\n      }\r\n\r\n      item2 = menu.items[i];\r\n\r\n      if (item2) {\r\n        menu.setActive(item2);\r\n      }\r\n      break;//*/\r\n      case 13: //return key\r\n      case 32: //space key\r\n        menu.click(menu.activeItem);\r\n        break;\r\n      case 27: //escape key\r\n        menu.close();\r\n        break;\r\n    }\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    if (this.menu === undefined || this.screen === undefined) {\r\n      this.closetimer = util.time_ms();\r\n      return;\r\n    }\r\n\r\n    let screen = this.screen;\r\n    let x = e.pageX,\r\n      y = e.pageY;\r\n\r\n    let element = screen.pickElement(x, y);\r\n\r\n    if (element !== undefined && (element instanceof DropBox || util.isMobile())) {\r\n      this.endMenus();\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    if (this.menu === undefined || this.screen === undefined) {\r\n      this.closetimer = util.time_ms();\r\n      return;\r\n    }\r\n\r\n    let screen = this.screen;\r\n    let x = e.pageX,\r\n      y = e.pageY;\r\n\r\n    let element = screen.pickElement(x, y, undefined, undefined, DropBox);\r\n    if (element !== undefined) {\r\n      this.closeOnMouseUp = false;\r\n    } else {\r\n      element = screen.pickElement(x, y, undefined, undefined, Menu);\r\n\r\n      //closeOnMouseUp\r\n      if (element && this.closeOnMouseUp) {\r\n        element.click();\r\n      }\r\n    }\r\n  }\r\n\r\n  findMenu(x, y) {\r\n    let screen = this.screen;\r\n\r\n    let element = screen.pickElement(x, y);\r\n\r\n    if (element === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (element instanceof Menu) {\r\n      return element;\r\n    }\r\n\r\n    let w = element;\r\n\r\n    while (w) {\r\n      if (w instanceof Menu) {\r\n        //w === this.menu) {\r\n        return w;\r\n        break;\r\n      }\r\n\r\n      w = w.parentWidget;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    if (this.menu && this.menu.hasSearchBox) {\r\n      this.closetimer = util.time_ms();\r\n      this.closereq = undefined;\r\n      return;\r\n    }\r\n\r\n    if (this.menu === undefined || this.screen === undefined) {\r\n      this.closetimer = util.time_ms();\r\n      this.closereq = undefined;\r\n      return;\r\n    }\r\n\r\n    let screen = this.screen;\r\n    let x = e.pageX,\r\n      y = e.pageY;\r\n\r\n    let element;\r\n    let menu = this.menu;\r\n\r\n    if (menu) {\r\n      let r = menu.getBoundingClientRect();\r\n      let pad = 15;\r\n\r\n      if (r && x >= r.x - pad && y >= r.y - pad && x <= r.x + r.width + pad * 2 && y <= r.y + r.height + pad * 2) {\r\n        element = menu;\r\n      }\r\n    }\r\n\r\n    if (!element && util.time_ms() - this.lastPickElemTime > 250) {\r\n      element = screen.pickElement(x, y);\r\n      this.lastPickElemTime = util.time_ms();\r\n    }\r\n\r\n    if (element === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (element instanceof Menu) {\r\n      this.closetimer = util.time_ms();\r\n      this.closereq = undefined;\r\n      return;\r\n    }\r\n\r\n    let destroy = element.hasAttribute(\"menu-button\") && element.hasAttribute(\"simple\");\r\n    destroy = destroy && element.menu !== this.menu;\r\n\r\n    if (destroy) {\r\n      /* check that dropbox doesn't contain our parent menu either */\r\n\r\n      let menu2 = this.menu;\r\n      while (menu2 !== element.menu) {\r\n        menu2 = menu2.parentMenu;\r\n        destroy = destroy && (menu2 === undefined || menu2 !== element.menu);\r\n      }\r\n    }\r\n\r\n    if (destroy) {\r\n      //destroy entire menu stack\r\n      this.endMenus();\r\n\r\n      this.closetimer = util.time_ms();\r\n      this.closereq = undefined;\r\n\r\n      //start new menu\r\n      element._onpress(e);\r\n      return;\r\n    }\r\n\r\n    let ok = false;\r\n\r\n    let w = element;\r\n    while (w) {\r\n      if (w instanceof Menu) {\r\n        //w === this.menu) {\r\n        ok = true;\r\n        break;\r\n      }\r\n\r\n      if (w.hasAttribute(\"menu-button\") && w.menu === this.menu) {\r\n        ok = true;\r\n        break;\r\n      }\r\n\r\n      w = w.parentWidget;\r\n    }\r\n\r\n    if (!ok) {\r\n      this.closereq = this.menu;\r\n    } else {\r\n      this.closetimer = util.time_ms();\r\n      this.closereq = undefined;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    let closetime = cconst.menu_close_time;\r\n    closetime = closetime === undefined ? 50 : closetime;\r\n\r\n    let close = this.closereq && this.closereq === this.menu;\r\n    close = close && util.time_ms() - this.closetimer > closetime;\r\n\r\n    if (close) {\r\n      this.closereq = undefined;\r\n      this.endMenus();\r\n    }\r\n  }\r\n\r\n  startTimer() {\r\n    if (this.timer) {\r\n      this.stopTimer();\r\n    }\r\n\r\n    this.timer = setInterval(() => {\r\n      debugmenu(\"start menu wrangler interval\");\r\n\r\n      this.update();\r\n    }, 150);\r\n  }\r\n\r\n  stopTimer() {\r\n    if (this.timer) {\r\n      debugmenu(\"stop menu wrangler interval\");\r\n\r\n      clearInterval(this.timer);\r\n      this.timer = undefined;\r\n    }\r\n  }\r\n}\r\n\r\nexport let menuWrangler = (window._menuWrangler = new MenuWrangler());\r\nlet wrangerStarted = false;\r\n\r\nexport function startMenuEventWrangling(screen) {\r\n  if (typeof document === \"undefined\") {\r\n    // inside a worker?\r\n    return;\r\n  }\r\n  menuWrangler.screen = screen;\r\n\r\n  if (wrangerStarted) {\r\n    return;\r\n  }\r\n\r\n  wrangerStarted = true;\r\n\r\n  for (let k in DomEventTypes) {\r\n    if (menuWrangler[k] === undefined) {\r\n      continue;\r\n    }\r\n\r\n    let dom = k.search(\"key\") >= 0 ? window : document.body;\r\n    dom = window;\r\n    dom.addEventListener(DomEventTypes[k], menuWrangler[k].bind(menuWrangler), { passive: false, capture: true });\r\n  }\r\n\r\n  menuWrangler.screen = screen;\r\n  menuWrangler.startTimer();\r\n}\r\n\r\nwindow._startMenuEventWrangling = startMenuEventWrangling;\r\n\r\nexport function setWranglerScreen(screen) {\r\n  startMenuEventWrangling(screen);\r\n}\r\n\r\nexport function getWranglerScreen() {\r\n  return menuWrangler.screen;\r\n}\r\n\r\nexport function createMenu(ctx, title, templ) {\r\n  let menu = UIBase.createElement(\"menu-x\");\r\n  menu.ctx = ctx;\r\n  menu.setAttribute(\"name\", title);\r\n\r\n  let SEP = menu.constructor.SEP;\r\n  let id = 0;\r\n  let cbs = {};\r\n\r\n  let doItem = (item) => {\r\n    if (item !== undefined && item instanceof Menu) {\r\n      menu.addItem(item);\r\n    } else if (typeof item == \"string\") {\r\n      let def, hotkey;\r\n\r\n      try {\r\n        def = ctx.api.getToolDef(item);\r\n      } catch (error) {\r\n        menu.addItem(\"(tool path error)\", id++);\r\n        return;\r\n      }\r\n\r\n      //3Extra(text, id=undefined, hotkey, icon=-1, add=true) {\r\n      if (!def.hotkey) {\r\n        try {\r\n          hotkey = ctx.api.getToolPathHotkey(ctx, item);\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n          console.warn(\"error getting hotkey for tool \" + item);\r\n          hotkey = undefined;\r\n        }\r\n      } else {\r\n        hotkey = def.hotkey;\r\n      }\r\n\r\n      menu.addItemExtra(def.uiname, id, hotkey, def.icon);\r\n\r\n      cbs[id] = (function (toolpath) {\r\n        return function () {\r\n          ctx.api.execTool(ctx, toolpath);\r\n        };\r\n      })(item);\r\n\r\n      id++;\r\n    } else if (item === SEP) {\r\n      menu.seperator();\r\n    } else if (typeof item === \"function\" || item instanceof Function) {\r\n      doItem(item());\r\n    } else if (item instanceof Array) {\r\n      //old array-based api for custom entries\r\n      let hotkey = item.length > 2 ? item[2] : undefined;\r\n      let icon = item.length > 3 ? item[3] : undefined;\r\n      let tooltip = item.length > 4 ? item[4] : undefined;\r\n      let id2 = item.length > 5 ? item[5] : id++;\r\n\r\n      if (hotkey !== undefined && hotkey instanceof HotKey) {\r\n        hotkey = hotkey.buildString();\r\n      }\r\n\r\n      menu.addItemExtra(item[0], id2, hotkey, icon, undefined, tooltip);\r\n\r\n      cbs[id2] = (function (cbfunc, arg) {\r\n        return function () {\r\n          cbfunc(arg);\r\n        };\r\n      })(item[1], id2);\r\n    } else if (typeof item === \"object\") {\r\n      //new object-based api for custom entries\r\n      let { name, callback, hotkey, icon, tooltip } = item;\r\n\r\n      let id2 = item.id !== undefined ? item.id : id++;\r\n      if (hotkey !== undefined && hotkey instanceof HotKey) {\r\n        hotkey = hotkey.buildString();\r\n      }\r\n\r\n      menu.addItemExtra(name, id2, hotkey, icon, undefined, tooltip);\r\n\r\n      cbs[id2] = (function (cbfunc, arg) {\r\n        return function () {\r\n          cbfunc(arg);\r\n        };\r\n      })(callback, id2);\r\n    }\r\n  };\r\n\r\n  for (let item of templ) {\r\n    doItem(item);\r\n  }\r\n\r\n  menu.onselect = (id) => {\r\n    cbs[id]();\r\n  };\r\n\r\n  return menu;\r\n}\r\n\r\nexport function startMenu(menu, x, y, searchMenuMode = false, safetyDelay = 55) {\r\n  menuWrangler.endMenus();\r\n\r\n  let screen = menu.ctx.screen;\r\n  let con = (menu._popup = screen.popup(undefined, x, y, false, safetyDelay));\r\n  con.noMarginsOrPadding();\r\n\r\n  con.add(menu);\r\n  if (searchMenuMode) {\r\n    menu.startFancy();\r\n  } else {\r\n    menu.start();\r\n  }\r\n\r\n  menu.flushUpdate();\r\n  menu.flushSetCSS();\r\n\r\n  menu._popup.flushUpdate();\r\n  menu._popup.flushSetCSS();\r\n}\r\n","//bind module to global var to get at it in console.\r\n//\r\n//note that require has an api for handling circular \r\n//module refs, in such cases do not use these vars.\r\n\r\nvar _ui = undefined;\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as units from '../core/units.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from './ui_base.js';\r\nimport * as ui_widgets from '../widgets/ui_widgets.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport '../path-controller/util/html5_fileapi.js';\r\nimport {HotKey} from '../path-controller/util/simple_events.js';\r\nimport {CSSFont} from './ui_theme.js';\r\nimport {theme, iconSheetFromPackFlag} from './ui_base.js';\r\n\r\nimport {createMenu, startMenu} from \"../widgets/ui_menu.js\";\r\n\r\nlet PropFlags = toolprop.PropFlags;\r\nlet PropSubTypes = toolprop.PropSubTypes;\r\n\r\nlet EnumProperty = toolprop.EnumProperty;\r\n\r\nlet Vector2   = vectormath.Vector2,\r\n    UIBase    = ui_base.UIBase,\r\n    PackFlags = ui_base.PackFlags,\r\n    PropTypes = toolprop.PropTypes;\r\n\r\nimport {DataPathError} from '../path-controller/controller/controller_base.js';\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nexport class Label extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._label = \"\";\r\n\r\n    this._lastText = \"\";\r\n\r\n    this.dom = document.createElement(\"div\");\r\n    this.dom.setAttribute(\"class\", \"_labelx\");\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n      div._labelx::selection {\r\n        color: none;\r\n        background: none;\r\n         -webkit-user-select:none;\r\n         user-select:none;\r\n      }\r\n    `;\r\n\r\n    this.shadow.appendChild(style);\r\n    this.shadow.appendChild(this.dom);\r\n\r\n    this.font = \"LabelText\";\r\n  }\r\n\r\n  get font() {\r\n    return this._font;\r\n  }\r\n\r\n  /**Set a font defined in ui_base.defaults\r\n   e.g. DefaultText*/\r\n  set font(fontDefaultName) {\r\n    if (typeof fontDefaultName === \"string\") {\r\n      this._font = this.getDefault(fontDefaultName);\r\n      if (!this._font) {\r\n        console.warn(\"Invalid font\", fontDefaultName);\r\n      }\r\n    } else if (typeof fontDefaultName === \"object\" && fontDefaultName instanceof CSSFont) {\r\n      this._font = fontDefaultName;\r\n    } else {\r\n      console.warn(\"Invalid font\", fontDefaultName);\r\n    }\r\n\r\n    this._updateFont();\r\n  }\r\n\r\n  get text() {\r\n    return this._label;\r\n    //return this.dom.innerText;\r\n  }\r\n\r\n  set text(text) {\r\n    this._label = text;\r\n\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      this.dom.innerText = text;\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"label-x\",\r\n      style  : \"label\"\r\n    };\r\n  }\r\n\r\n  init() {\r\n    this.dom.style[\"width\"] = \"max-content\";\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS(false);\r\n    this.setBoxCSS();\r\n  }\r\n\r\n  on_disabled() {\r\n    super.on_disabled();\r\n    this._enabled_font = this.font;\r\n    this.font = \"DefaultText\";\r\n    this._updateFont();\r\n  }\r\n\r\n  on_enabled() {\r\n    super.on_enabled();\r\n    this.font = this._enabled_font;\r\n    this._updateFont();\r\n  }\r\n\r\n  _updateFont() {\r\n    let font = this._font;\r\n    if (!font) return;\r\n\r\n    this.dom.style[\"font\"] = font.genCSS();\r\n    this.dom.style[\"color\"] = font.color;\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (this.ctx === undefined) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n    let prop = this.getPathMeta(this.ctx, path);\r\n    let val = this.getPathValue(this.ctx, path);\r\n\r\n    if (val === undefined) {\r\n      return;\r\n    }\r\n\r\n    //console.log(path);\r\n    if (prop.type & (PropTypes.INT | PropTypes.FLOAT)) {\r\n      val = units.buildString(val, prop.baseUnit, prop.decimalPlaces, prop.displayUnit);\r\n    }\r\n\r\n    val = \"\" + this._label + \" \" + val;\r\n\r\n    if (val !== this._lastText) {\r\n      this._lastText = val;\r\n      this.dom.innerText = val;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    let key = \"\";\r\n\r\n    if (this._font !== undefined && this._font instanceof CSSFont) {\r\n      key += this._font.genKey();\r\n    }\r\n\r\n    if (key !== this._last_font) {\r\n      this._last_font = key;\r\n      this._updateFont();\r\n    }\r\n\r\n    this.dom.style[\"pointer-events\"] = this.style[\"pointer-events\"];\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n  }\r\n}\r\n\r\nui_base.UIBase.internalRegister(Label);\r\n\r\nexport class Container extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.dataPrefix = '';\r\n    this.massSetPrefix = '';\r\n\r\n    this.inherit_packflag = 0;\r\n\r\n    let style = this.styletag = document.createElement(\"style\")\r\n    style.textContent = `\r\n    `;\r\n\r\n    this.shadow.appendChild(style);\r\n    this.reversed = false;\r\n\r\n    this._prefixstack = [];\r\n    this._mass_prefixstack = [];\r\n  }\r\n\r\n  noUndo() {\r\n    this.setUndo(false);\r\n    return this;\r\n  }\r\n\r\n  set background(bg) {\r\n    this.__background = bg;\r\n\r\n    this.styletag.textContent = `div.containerx {\r\n        background-color : ${bg};\r\n      }\r\n    `;\r\n    this.style[\"background-color\"] = bg;\r\n  }\r\n\r\n  get children() {\r\n    let list = [];\r\n\r\n    this._forEachChildWidget((n) => {\r\n      list.push(n);\r\n    });\r\n\r\n    return list\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"container-x\"\r\n    };\r\n  }\r\n\r\n  /** recursively change path prefix for all children*/\r\n  changePathPrefix(newprefix) {\r\n    let prefix = this.dataPrefix.trim();\r\n    this.dataPrefix = newprefix;\r\n\r\n    if (prefix.length > 0) {\r\n      prefix += \".\";\r\n    }\r\n\r\n    let rec = (n, con) => {\r\n      if (n instanceof Container && n !== this) {\r\n        if (n.dataPrefix.startsWith(prefix)) {\r\n          n.dataPrefix = n.dataPath.slice(prefix.length, n.dataPrefix.length);\r\n          n.dataPrefix = con._joinPrefix(n.dataPrefix);\r\n          con = n;\r\n        }\r\n      }\r\n\r\n      if (n.hasAttribute(\"datapath\")) {\r\n        let path = n.getAttribute(\"datapath\");\r\n\r\n        if (path.startsWith(prefix)) {\r\n          path = path.slice(prefix.length, path.length);\r\n          path = con._joinPrefix(path);\r\n          n.setAttribute(\"datapath\", path);\r\n\r\n          //update helper tooltips\r\n          n.description = n.description;\r\n        }\r\n      }\r\n\r\n      n._forEachChildWidget((n2) => {\r\n        rec(n2, con);\r\n      });\r\n    }\r\n\r\n    rec(this, this);\r\n  }\r\n\r\n  reverse() {\r\n    this.reversed ^= true;\r\n    return this;\r\n  }\r\n\r\n  pushMassSetPrefix(val) {\r\n    this._mass_prefixstack.push(this.massSetPrefix);\r\n    this.massSetPrefix = val;\r\n    return this;\r\n  }\r\n\r\n  pushDataPrefix(val) {\r\n    this._prefixstack.push(this.dataPrefix);\r\n    this.dataPrefix = val;\r\n    return this;\r\n  }\r\n\r\n  popDataPrefix() {\r\n    this.dataPrefix = this._prefixstack.pop();\r\n    return this;\r\n  }\r\n\r\n  popMassSetPrefix() {\r\n    this.massSetPrefix = this._mass_prefixstack.pop();\r\n    return this;\r\n  }\r\n\r\n  saveData() {\r\n    if (this.scrollTop || this.scrollLeft) {\r\n      return {\r\n        scrollTop : this.scrollTop,\r\n        scrollLeft: this.scrollLeft\r\n      }\r\n    } else {\r\n      return {};\r\n    }\r\n  }\r\n\r\n  loadData(obj) {\r\n    if (!obj) return;\r\n\r\n    let x = obj.scrollLeft || 0;\r\n    let y = obj.scrollTop || 0;\r\n\r\n    this.doOnce(() => {\r\n      this.scrollTo(x, y);\r\n    }, 12);\r\n  }\r\n\r\n  init() {\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-direction\"] = this.reversed ? \"column-reverse\" : \"column\";\r\n    this.style[\"flex-wrap\"] = \"nowrap\";\r\n    this.style[\"flex-grow\"] = \"\" + this.getDefault(\"flex-grow\", undefined, \"1\");\r\n\r\n    this.setCSS();\r\n\r\n    super.init();\r\n\r\n    this.setAttribute(\"class\", \"containerx\");\r\n  }\r\n\r\n  /** Returns previous icon flags */\r\n  useIcons(enabled_or_sheet = true) {\r\n    let enabled = !!enabled_or_sheet;\r\n\r\n    let mask = PackFlags.USE_ICONS | PackFlags.SMALL_ICON | PackFlags.LARGE_ICON;\r\n    mask = mask | PackFlags.CUSTOM_ICON_SHEET;\r\n    mask = mask | (255<<PackFlags.CUSTOM_ICON_SHEET_START);\r\n\r\n    let previous = this.packflag & mask;\r\n\r\n    if (!enabled) {\r\n      this.packflag &= ~PackFlags.USE_ICONS;\r\n      this.inherit_packflag &= ~PackFlags.USE_ICONS;\r\n\r\n      return previous;\r\n    }\r\n\r\n    let sheet = enabled_or_sheet;\r\n\r\n    if (sheet === true) {\r\n      sheet = PackFlags.SMALL_ICON;\r\n    } else if (sheet === 1) {\r\n      sheet = PackFlags.LARGE_ICON;\r\n    } else {\r\n      sheet = PackFlags.CUSTOM_ICON_SHEET | (sheet<<(PackFlags.CUSTOM_ICON_SHEET_START));\r\n    }\r\n\r\n    //clear any existing sizing flags\r\n    this.packflag &= ~(PackFlags.SMALL_ICON | PackFlags.LARGE_ICON | PackFlags.CUSTOM_ICON_SHEET);\r\n    this.packflag &= ~(255<<PackFlags.CUSTOM_ICON_SHEET_START);\r\n\r\n    this.packflag |= PackFlags.USE_ICONS | sheet;\r\n    this.inherit_packflag |= PackFlags.USE_ICONS | sheet;\r\n\r\n    return previous;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param mode: flexbox wrap mode, can be wrap, nowrap, or wrap-reverse\r\n   * @returns {Container}\r\n   */\r\n  wrap(mode = \"wrap\") {\r\n    this.style[\"flex-wrap\"] = mode;\r\n    return this;\r\n  }\r\n\r\n  noMarginsOrPadding() {\r\n    super.noMarginsOrPadding();\r\n\r\n    let keys = [\"margin\", \"padding\", \"margin-block-start\", \"margin-block-end\"];\r\n    keys = keys.concat([\"padding-block-start\", \"padding-block-end\"]);\r\n\r\n    for (let k of keys) {\r\n      this.style[k] = \"0px\";\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  setCSS() {\r\n    let rest = '';\r\n\r\n    let add = (style) => {\r\n      if (!this.hasDefault(style)) {\r\n        return;\r\n      }\r\n\r\n      let val = this.getDefault(style);\r\n\r\n      if (val !== undefined) {\r\n        rest += `  ${style} = ${val};\\n`;\r\n        this.style[style] = val;\r\n      }\r\n    }\r\n\r\n    add(\"border-radius\");\r\n    add(\"border-width\");\r\n    add(\"border-top\");\r\n    add(\"border-bottom\");\r\n    add(\"border-left\");\r\n    add(\"border-right\");\r\n\r\n    this.styletag.textContent = `div.containerx {\r\n        background-color : ${this.getDefault(\"background-color\")};\r\n        ${rest}\r\n      }\r\n      `;\r\n  }\r\n\r\n  overrideDefault(key, val) {\r\n    super.overrideDefault(key, val);\r\n    this.setCSS();\r\n\r\n    return this;\r\n  }\r\n\r\n  /*\r\n  * shorthand for:\r\n  *\r\n  * .row().noMarginsOrPadding().oneAxisPadding()\r\n  * */\r\n  strip(themeClass_or_obj = \"strip\", margin1 = this.getDefault(\"oneAxisPadding\"), margin2 = 1, horiz = undefined) {\r\n    let themeClass = themeClass_or_obj;\r\n\r\n    if (typeof themeClass_or_obj === \"object\") {\r\n      let obj = themeClass_or_obj;\r\n\r\n      themeClass = obj.themeClass ?? \"strip\";\r\n      margin1 = obj.margin1 ?? margin1;\r\n      margin2 = obj.margin2 ?? 1;\r\n      horiz = obj.horiz;\r\n    }\r\n\r\n    if (horiz === undefined) {\r\n      horiz = this instanceof RowFrame;\r\n      horiz = horiz || this.style[\"flex-direction\"] === \"row\";\r\n    }\r\n\r\n    let flag = horiz ? PackFlags.STRIP_HORIZ : PackFlags.STRIP_VERT;\r\n\r\n    let strip = (horiz ? this.row() : this.col());\r\n\r\n    if (typeof margin1 !== \"number\") {\r\n      throw new Error(\"margin1 was not a number\");\r\n    }\r\n    if (typeof margin2 !== \"number\") {\r\n      throw new Error(\"margin2 was not a number\");\r\n    }\r\n\r\n    strip.packflag |= flag;\r\n    strip.dataPrefix = this.dataPrefix;\r\n    strip.massSetPrefix = this.massSetPrefix;\r\n\r\n    if (themeClass in theme) {\r\n      strip.overrideClass(themeClass);\r\n      strip.background = strip.getDefault(\"background-color\");\r\n      strip.setCSS();\r\n      strip.overrideClass(themeClass);\r\n\r\n      let lastkey;\r\n\r\n      strip.update.after(function () {\r\n        let bradius = strip.getDefault(\"border-radius\");\r\n        let bline = strip.getDefault(\"border-width\");\r\n        let bstyle = strip.getDefault(\"border-style\") || 'solid';\r\n        let padding = strip.getDefault(\"padding\");\r\n        let bcolor = strip.getDefault(\"border-color\") || \"rgba(0,0,0,0)\";\r\n        let margin = strip.getDefault(\"margin\") || 0;\r\n\r\n        bline = bline === undefined ? 0 : bline;\r\n        bradius = bradius === undefined ? 0 : bradius;\r\n        padding = padding === undefined ? 5 : padding;\r\n\r\n        let bg = strip.getDefault(\"background-color\");\r\n\r\n        let key = \"\" + bradius + \":\" + bline + \":\" + bg + \":\" + padding + \":\";\r\n        key += bstyle + \":\" + padding + \":\" + bcolor + \":\" + margin;\r\n\r\n        if (key !== lastkey) {\r\n          lastkey = key;\r\n\r\n          strip.oneAxisPadding(margin1 + padding, margin2 + padding);\r\n          strip.setCSS();\r\n\r\n          strip.background = bg;\r\n\r\n          strip.style[\"margin\"] = \"\" + margin + \"px\";\r\n          strip.style[\"border\"] = `${bline}px ${bstyle} ${bcolor}`;\r\n          strip.style[\"border-radius\"] = \"\" + bradius + \"px\";\r\n        }\r\n      })\r\n    } else {\r\n      console.warn(this.constructor.name + \".strip(): unknown theme class \" + themeClass);\r\n    }\r\n\r\n    /*\r\n    let prev = strip.previousElementSibling;\r\n    if (prev !== undefined && (prev.packflag & flag)) {\r\n      if (horiz) {\r\n        prev.style[\"padding-right\"] = \"0px\";\r\n      } else {\r\n        prev.style[\"padding-top\"] = \"0px\";\r\n      }\r\n    }//*/\r\n\r\n    return strip;\r\n  }\r\n\r\n  /**\r\n   * tries to set margin along one axis only in smart manner\r\n   * */\r\n  oneAxisMargin(m = this.getDefault(\"oneAxisMargin\"), m2 = 0) {\r\n    this.style[\"margin-top\"] = this.style[\"margin-bottom\"] = \"\" + m + \"px\";\r\n    this.style[\"margin-left\"] = this.style[\"margin-right\"] = \"\" + m2 + \"px\";\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * tries to set padding along one axis only in smart manner\r\n   * */\r\n  oneAxisPadding(axisPadding = this.getDefault(\"oneAxisPadding\"), otherPadding = 0) {\r\n    this.style[\"padding-top\"] = this.style[\"padding-bottom\"] = \"\" + axisPadding + \"px\";\r\n    this.style[\"padding-left\"] = this.style[\"padding-right\"] = \"\" + otherPadding + \"px\";\r\n\r\n    return this;\r\n  }\r\n\r\n  setMargin(m) {\r\n    this.style[\"margin\"] = m + \"px\";\r\n\r\n    return this;\r\n  }\r\n\r\n  setPadding(m) {\r\n    this.style[\"padding\"] = m + \"px\";\r\n\r\n    return this;\r\n  }\r\n\r\n  setSize(width, height) {\r\n    if (width !== undefined) {\r\n      if (typeof width == \"number\")\r\n        this.style[\"width\"] = this.div.style[\"width\"] = ~~width + \"px\";\r\n      else\r\n        this.style[\"width\"] = this.div.style[\"width\"] = width;\r\n    }\r\n\r\n    if (height !== undefined) {\r\n      if (typeof height == \"number\")\r\n        this.style[\"height\"] = this.div.style[\"height\"] = ~~height + \"px\";\r\n      else\r\n        this.style[\"height\"] = this.div.style[\"height\"] = height;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  save() {\r\n  }\r\n\r\n  load() {\r\n  }\r\n\r\n  saveVisibility() {\r\n    localStorage[this.storagePrefix + \"_settings\"] = JSON.stringify(this);\r\n    return this;\r\n  }\r\n\r\n  loadVisibility() {\r\n    let key = this.storagePrefix + \"_settings\";\r\n    let ok = true;\r\n\r\n    if (key in localStorage) {\r\n      console.log(\"loading UI visibility state. . .\");\r\n\r\n      try {\r\n        this.loadJSON(JSON.parse(localStorage[key]));\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        ok = false;\r\n      }\r\n    }\r\n\r\n    return ok;\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = {\r\n      opened: !this.closed\r\n    };\r\n\r\n    return Object.assign(super.toJSON(), ret);\r\n  }\r\n\r\n  _ondestroy() {\r\n    this._forEachChildWidget((n) => {\r\n      n._ondestroy();\r\n    });\r\n\r\n    super._ondestroy();\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    //console.error(\"ui.js:Container.loadJSON: implement me!\");\r\n\r\n    return this;\r\n  }\r\n\r\n  redrawCurves() {\r\n    throw new Error(\"Implement me (properly!)\");\r\n\r\n    if (this.closed)\r\n      return;\r\n\r\n    for (let cw of this.curve_widgets) {\r\n      cw.draw();\r\n    }\r\n  }\r\n\r\n  listen() {\r\n    window.setInterval(() => {\r\n      this.update();\r\n    }, 150);\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  appendChild(child) {\r\n    if (child instanceof ui_base.UIBase) {\r\n      child.ctx = this.ctx;\r\n      child.parentWidget = this;\r\n      this.shadow.appendChild(child);\r\n\r\n      if (child.onadd) {\r\n        child.onadd();\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    return super.appendChild(child);\r\n  }\r\n\r\n  clear(trigger_on_destroy = true) {\r\n    for (let child of this.children) {\r\n      if (child instanceof ui_base.UIBase) {\r\n        child.remove(trigger_on_destroy);\r\n      }\r\n    }\r\n  }\r\n\r\n  removeChild(child, trigger_on_destroy = true) {\r\n    let ret = super.removeChild(child);\r\n\r\n    if (child.on_remove) {\r\n      child.on_remove();\r\n    }\r\n\r\n    if (trigger_on_destroy && child.on_destroy) {\r\n      child.on_destroy();\r\n    }\r\n\r\n    child.parentWidget = undefined;\r\n\r\n    return ret;\r\n  }\r\n\r\n  prepend(child) {\r\n    if (child instanceof UIBase) {\r\n      this._prepend(child);\r\n    } else {\r\n      super.prepend(child);\r\n    }\r\n  }\r\n\r\n  //*\r\n  _prepend(child) {\r\n    return this._add(child, true);\r\n  }//*/\r\n\r\n  add(child) {\r\n    return this._add(child);\r\n  }\r\n\r\n  insert(i, ch) {\r\n    ch.parentWidget = this;\r\n    ch.ctx = this;\r\n\r\n    if (i >= this.shadow.childNodes.length) {\r\n      this.add(ch);\r\n    } else {\r\n      this.shadow.insertBefore(ch, util.list(this.children)[i]);\r\n    }\r\n\r\n    if (ch.onadd) {\r\n      ch.onadd();\r\n    }\r\n  }\r\n\r\n  _add(child, prepend = false) {\r\n    //paranoia check for if we accidentally got a DOM NodeList\r\n    if (child instanceof NodeList) {\r\n      throw new Error(\"eek!\");\r\n    }\r\n\r\n    child.ctx = this.ctx;\r\n    child.parentWidget = this;\r\n    child._useDataPathUndo = this._useDataPathUndo;\r\n\r\n    if (!child._themeOverride && this._themeOverride) {\r\n      child.overrideTheme(this._themeOverride);\r\n    }\r\n\r\n    if (prepend) {\r\n      this.shadow.prepend(child);\r\n    } else {\r\n      this.shadow.appendChild(child);\r\n    }\r\n\r\n    /*\r\n    if (child._ctx) {\r\n      child._init();\r\n    }//*/\r\n\r\n    if (child.onadd)\r\n      child.onadd();\r\n\r\n    return child;\r\n  }\r\n\r\n  //TODO: make sure this works on Electron?\r\n  dynamicMenu(title, list, packflag = 0) {\r\n    //actually, .menu works for now\r\n    return this.menu(title, list, packflag);\r\n  }\r\n\r\n  /**example usage:\r\n\r\n   .menu([\r\n   \"some_tool_path.tool()|CustomLabel\",\r\n   ui_widgets.Menu.SEP,\r\n   \"some_tool_path.another_tool()\",\r\n   \"some_tool_path.another_tool()|CustomLabel::Custom Hotkey String\",\r\n   [\"Name\", () => {console.log(\"do something\")}]\r\n   ])\r\n\r\n   **/\r\n  menu(title, list, packflag = 0) {\r\n    let dbox = UIBase.createElement(\"dropbox-x\");\r\n\r\n    dbox._name = title;\r\n    dbox.setAttribute(\"simple\", true);\r\n    dbox.setAttribute(\"name\", title);\r\n\r\n    if (list instanceof HTMLElement && list.constructor.name === \"Menu\") {\r\n      dbox._build_menu = function () {\r\n        if (this._menu !== undefined && this._menu.parentNode !== undefined) {\r\n          this._menu.remove();\r\n        }\r\n\r\n        this._menu = createMenu(this.ctx, title, list);\r\n        return this._menu;\r\n      }\r\n    } else if (list) {\r\n      dbox.template = list;\r\n    }\r\n\r\n    this._container_inherit(dbox, packflag);\r\n\r\n    this._add(dbox);\r\n    return dbox;\r\n  }\r\n\r\n  toolPanel(path_or_cls, args = {}) {\r\n    let tdef;\r\n    let cls;\r\n\r\n    if (typeof path_or_cls === \"string\") {\r\n      cls = this.ctx.api.parseToolPath(path_or_cls);\r\n    } else {\r\n      cls = path_or_cls;\r\n    }\r\n\r\n    tdef = cls._getFinalToolDef();\r\n\r\n    let packflag = args.packflag || 0;\r\n    let label = args.label || tdef.uiname;\r\n    let createCb = args.createCb || args.create_cb;\r\n    let container = args.container || this.panel(label);\r\n    let defaultsPath = args.defaultsPath || \"toolDefaults\";\r\n\r\n    if (defaultsPath.length > 0 && !defaultsPath.endsWith(\".\")) {\r\n      defaultsPath += \".\";\r\n    }\r\n\r\n    let path = defaultsPath + tdef.toolpath;\r\n\r\n    container.useIcons(false);\r\n\r\n    let inputs = tdef.inputs || {};\r\n    for (let k in inputs) {\r\n      let prop = inputs[k];\r\n\r\n      if (prop.flag & PropFlags.PRIVATE) {\r\n        continue;\r\n      }\r\n\r\n      let apiname = prop.apiname || k;\r\n      let path2 = path + \".\" + apiname;\r\n\r\n      container.prop(path2);\r\n    }\r\n\r\n    container.tool(path_or_cls, packflag, createCb, label);\r\n\r\n    return container;\r\n  }\r\n\r\n  tool(path_or_cls, packflag_or_args = {}, createCb = undefined, label = undefined) {\r\n    let cls;\r\n    let packflag;\r\n\r\n    if (typeof packflag_or_args === \"object\") {\r\n      let args = packflag_or_args;\r\n\r\n      packflag = args.packflag;\r\n      createCb = args.createCb;\r\n      label = args.label;\r\n    } else {\r\n      packflag = packflag_or_args || 0;\r\n    }\r\n\r\n    if (typeof path_or_cls == \"string\") {\r\n      if (path_or_cls.search(/\\|/) >= 0) {\r\n        path_or_cls = path_or_cls.split(\"|\");\r\n\r\n        if (label === undefined && path_or_cls.length > 1) {\r\n          label = path_or_cls[1].trim();\r\n        }\r\n\r\n        path_or_cls = path_or_cls[0].trim();\r\n      }\r\n\r\n      if (this.ctx === undefined) {\r\n        console.warn(\"this.ctx was undefined in tool()\");\r\n        return;\r\n      }\r\n\r\n      cls = this.ctx.api.parseToolPath(path_or_cls);\r\n\r\n      if (cls === undefined) {\r\n        console.warn(\"Unknown tool for toolpath \\\"\" + path_or_cls + \"\\\"\");\r\n        return;\r\n      }\r\n    } else {\r\n      cls = path_or_cls;\r\n    }\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n    let hotkey;\r\n\r\n    if (createCb === undefined) {\r\n      createCb = (cls) => {\r\n        return this.ctx.api.createTool(this.ctx, path_or_cls);\r\n      }\r\n    }\r\n\r\n    let cb = () => {\r\n      console.log(\"tool run\");\r\n\r\n      let toolob = createCb(cls);\r\n      this.ctx.api.execTool(this.ctx, toolob);\r\n    }\r\n\r\n    let def = typeof path_or_cls === \"string\" ? this.ctx.api.getToolDef(path_or_cls) : cls.tooldef();\r\n    let tooltip = def.description === undefined ? def.uiname : def.description;\r\n\r\n    //is there a hotkey hardcoded in the class?\r\n    if (def.hotkey !== undefined) {\r\n      tooltip += \"\\n\\t\" + def.hotkey;\r\n      hotkey = def.hotkey;\r\n    } else { //if not, use getToolPathHotkey api\r\n      let path = path_or_cls;\r\n\r\n      if (typeof path != \"string\") {\r\n        path = def.toolpath;\r\n      }\r\n\r\n      let hotkey = this.ctx.api.getToolPathHotkey(this.ctx, path);\r\n      if (hotkey) {\r\n        tooltip += \"\\n\\tHotkey: \" + hotkey;\r\n      }\r\n    }\r\n\r\n    let ret;\r\n\r\n    if (def.icon !== undefined && (packflag & PackFlags.USE_ICONS)) {\r\n      label = label === undefined ? tooltip : label;\r\n\r\n      ret = this.iconbutton(def.icon, label, cb);\r\n\r\n      ret.iconsheet = iconSheetFromPackFlag(packflag);\r\n      ret.packflag |= packflag;\r\n      ret.description = tooltip;\r\n    } else {\r\n      label = label === undefined ? def.uiname : label;\r\n\r\n      ret = this.button(label, cb);\r\n      ret.description = tooltip;\r\n      ret.packflag |= packflag;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  //supports number types\r\n  textbox(inpath, text, cb = undefined, packflag = 0) {\r\n    let path;\r\n\r\n    if (inpath) {\r\n      path = this._joinPrefix(inpath);\r\n    }\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let ret = UIBase.createElement(\"textbox-x\");\r\n\r\n    if (path !== undefined) {\r\n      ret.setAttribute(\"datapath\", path);\r\n    }\r\n\r\n    ret.ctx = this.ctx;\r\n    ret.parentWidget = this;\r\n    ret._init();\r\n    this._add(ret);\r\n\r\n    ret.setCSS();\r\n    ret.update();\r\n\r\n    ret.packflag |= packflag;\r\n    ret.onchange = cb;\r\n    ret.text = text;\r\n\r\n    return ret;\r\n  }\r\n\r\n  pathlabel(inpath, label = undefined, packflag = 0) {\r\n    let path;\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    if (inpath) {\r\n      path = this._joinPrefix(inpath);\r\n    }\r\n\r\n    let ret = UIBase.createElement(\"label-x\");\r\n\r\n    if (label === undefined && inpath) {\r\n      let rdef = this.ctx.api.resolvePath(this.ctx, path);\r\n      if (rdef) {\r\n        label = rdef.prop.uiname ?? rdef.dpath.apiname;\r\n      } else {\r\n        label = \"(error)\";\r\n      }\r\n    }\r\n\r\n    ret.text = label;\r\n    ret.packflag = packflag;\r\n    ret.setAttribute(\"datapath\", path);\r\n\r\n    this._add(ret);\r\n    ret.setCSS();\r\n\r\n    return ret;\r\n  }\r\n\r\n  label(text) {\r\n    let ret = UIBase.createElement(\"label-x\");\r\n    ret.text = text;\r\n\r\n    this._add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * makes a button for a help picker tool\r\n   * to view tooltips on mobile devices\r\n   * */\r\n  helppicker() {\r\n    let ret = this.iconbutton(ui_base.Icons.HELP, \"Help Picker\", () => {\r\n      this.getScreen().hintPickerTool();\r\n    })\r\n\r\n    if (util.isMobile()) {\r\n      //ret.iconsheet = 2;\r\n      //XXX look up in mobile theme properly\r\n    }\r\n\r\n    if (ret.ctx) {\r\n      ret._init();\r\n      ret.setCSS();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  iconbutton(icon, description, cb, thisvar, packflag = 0) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let ret = UIBase.createElement(\"iconbutton-x\")\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    ret.setAttribute(\"icon\", icon);\r\n    ret.description = description;\r\n    ret.icon = icon;\r\n\r\n    ret.iconsheet = iconSheetFromPackFlag(packflag);\r\n\r\n    ret.onclick = cb;\r\n\r\n    this._add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  button(label, cb, thisvar, id, packflag = 0) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let ret = UIBase.createElement(\"button-x\")\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    ret.setAttribute(\"name\", label);\r\n    ret.setAttribute(\"buttonid\", id); //XXX no longer used?\r\n    ret.onclick = cb;\r\n\r\n    this._add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  _joinPrefix(path, prefix = this.dataPrefix.trim()) {\r\n    if (path === undefined) {\r\n      return undefined;\r\n    }\r\n\r\n    path = path.trim();\r\n    if (path[0] === \"/\") {\r\n      return path;\r\n    }\r\n\r\n    if (prefix.length > 0 && path.length > 0 && !prefix.endsWith(\".\") && !path.startsWith(\".\")) {\r\n      path = \".\" + path;\r\n    }\r\n\r\n    return prefix + path;\r\n  }\r\n\r\n  colorbutton(inpath, packflag, mass_set_path = undefined) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    let ret = UIBase.createElement(\"color-picker-button-x\");\r\n\r\n    if (inpath !== undefined) {\r\n      inpath = this._joinPrefix(inpath);\r\n      ret.setAttribute(\"datapath\", inpath);\r\n    }\r\n\r\n    if (mass_set_path !== undefined) {\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n    }\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  noteframe(packflag = 0) {\r\n    let ret = UIBase.createElement(\"noteframe-x\");\r\n\r\n    ret.packflag |= (this.inherit_packflag & ~PackFlags.NO_UPDATE) | packflag;\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  curve1d(inpath, packflag = 0, mass_set_path = undefined) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    let ret = UIBase.createElement(\"curve-widget-x\");\r\n\r\n    ret.ctx = this.ctx;\r\n    ret.packflag |= packflag;\r\n\r\n    if (inpath) {\r\n      inpath = this._joinPrefix(inpath);\r\n      ret.setAttribute(\"datapath\", inpath);\r\n    }\r\n\r\n    if (mass_set_path)\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n\r\n    this.add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  vecpopup(inpath, packflag = 0, mass_set_path = undefined) {\r\n    let button = UIBase.createElement(\"vector-popup-button-x\");\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n    let name = \"vector\";\r\n\r\n    if (inpath) {\r\n      inpath = this._joinPrefix(inpath);\r\n\r\n      button.setAttribute(\"datapath\", inpath);\r\n      if (mass_set_path) {\r\n        button.setAttribute(\"mass_set_path\", mass_set_path);\r\n      }\r\n\r\n      let rdef = this.ctx.api.resolvePath(this.ctx, inpath);\r\n      if (rdef && rdef.prop) {\r\n        name = rdef.prop.uiname || rdef.prop.name;\r\n      }\r\n    }\r\n\r\n    button.setAttribute(\"name\", name);\r\n    button.packflag |= packflag;\r\n\r\n    this.add(button);\r\n    return button;\r\n  }\r\n\r\n  _getMassPath(ctx, inpath, mass_set_path) {\r\n    if (mass_set_path === undefined && this.massSetPrefix.length > 0) {\r\n      mass_set_path = ctx.api.getPropName(ctx, inpath);\r\n    }\r\n\r\n    if (mass_set_path === undefined) {\r\n      return undefined;\r\n    }\r\n\r\n    return this._joinPrefix(mass_set_path, this.massSetPrefix);\r\n  }\r\n\r\n  prop(inpath, packflag = 0, mass_set_path = undefined) {\r\n    if (!this.ctx) {\r\n      console.warn(this.id + \".ctx was undefined\");\r\n      let p = this.parentWidget;\r\n\r\n      while (p) {\r\n        if (p.ctx) {\r\n          console.warn(\"Fetched this.ctx from parent\");\r\n          this.ctx = p.ctx;\r\n          break;\r\n        }\r\n\r\n        p = p.parentWidget;\r\n      }\r\n\r\n      if (!this.ctx) {\r\n        throw new Error(\"ui.Container.prototype.prop(): this.ctx was undefined\");\r\n      }\r\n    }\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let rdef = this.ctx.api.resolvePath(this.ctx, this._joinPrefix(inpath), true);\r\n\r\n    if (rdef === undefined || rdef.prop === undefined) {\r\n      console.warn(\"Unknown property at path\", this._joinPrefix(inpath), this.ctx.api.resolvePath(this.ctx, this._joinPrefix(inpath), true));\r\n      return;\r\n    }\r\n    //slider(path, name, defaultval, min, max, step, is_int, do_redraw, callback, packflag=0) {\r\n    let prop = rdef.prop;\r\n\r\n    let useDataPathUndo = this.useDataPathUndo && !(prop.flag & PropFlags.NO_UNDO);\r\n\r\n    //console.log(prop, PropTypes, PropSubTypes);\r\n\r\n    function makeUIName(name) {\r\n      if (typeof name === \"number\" && isNaN(name)) {\r\n        console.warn(\"Subkey error in data api\", inpath);\r\n        return \"\" + name;\r\n      }\r\n\r\n      name = \"\" + name;\r\n      name = name[0].toUpperCase() + name.slice(1, name.length).toLowerCase();\r\n      name = name.replace(/_/g, \" \");\r\n      return name;\r\n    }\r\n\r\n    if (prop.type === PropTypes.REPORT) {\r\n      return this.pathlabel(inpath, prop.uiname);\r\n    } else if (prop.type === PropTypes.STRING) {\r\n      let ret;\r\n\r\n      if (prop.flag & PropFlags.READ_ONLY) {\r\n        ret = this.pathlabel(inpath, prop.uiname);\r\n      } else if (prop.multiLine) {\r\n        ret = this.textarea(inpath, rdef.value, packflag, mass_set_path);\r\n        ret.useDataPathUndo = useDataPathUndo;\r\n      } else {\r\n        let strip = this.strip();\r\n\r\n        let uiname = prop.uiname !== undefined ? prop.uiname : ToolProperty.makeUIName(prop.apiname);\r\n\r\n        strip.label(prop.uiname);\r\n\r\n        ret = strip.textbox(inpath);\r\n        ret.useDataPathUndo = useDataPathUndo;\r\n\r\n        if (mass_set_path) {\r\n          ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n        }\r\n      }\r\n\r\n      ret.packflag |= packflag;\r\n      return ret;\r\n    } else if (prop.type === PropTypes.CURVE) {\r\n      let ret = this.curve1d(inpath, packflag, mass_set_path);\r\n      ret.useDataPathUndo = useDataPathUndo;\r\n      return ret;\r\n    } else if (prop.type === PropTypes.INT || prop.type === PropTypes.FLOAT) {\r\n      let ret;\r\n      if (packflag & PackFlags.SIMPLE_NUMSLIDERS) {\r\n        ret = this.simpleslider(inpath, {packflag: packflag});\r\n      } else {\r\n        ret = this.slider(inpath, {packflag: packflag});\r\n      }\r\n\r\n      ret.useDataPathUndo = useDataPathUndo;\r\n      ret.packflag |= packflag;\r\n\r\n      if (mass_set_path) {\r\n        ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n      }\r\n\r\n      return ret;\r\n    } else if (prop.type === PropTypes.BOOL) {\r\n      let ret = this.check(inpath, prop.uiname, packflag, mass_set_path);\r\n      ret.useDataPathUndo = useDataPathUndo;\r\n      return ret;\r\n    } else if (prop.type === PropTypes.ENUM) {\r\n      if (rdef.subkey !== undefined) {\r\n        let subkey = rdef.subkey;\r\n        let name = rdef.prop.ui_value_names[rdef.subkey];\r\n\r\n        if (name === undefined) {\r\n          name = makeUIName(rdef.subkey);\r\n        }\r\n\r\n        let check = this.check(inpath, name, packflag, mass_set_path);\r\n        let tooltip = rdef.prop.descriptions[subkey];\r\n\r\n        check.useDataPathUndo = useDataPathUndo;\r\n\r\n        check.description = tooltip === undefined ? rdef.prop.ui_value_names[subkey] : tooltip;\r\n        check.icon = rdef.prop.iconmap[rdef.subkey];\r\n\r\n        return check;\r\n      }\r\n\r\n      if (!(packflag & PackFlags.USE_ICONS) && !(prop.flag & (PropFlags.USE_ICONS | PropFlags.FORCE_ENUM_CHECKBOXES))) {\r\n        return this.listenum(inpath, {packflag, mass_set_path}).setUndo(useDataPathUndo);\r\n      } else {\r\n        if (prop.flag & PropFlags.USE_ICONS) {\r\n          packflag |= PackFlags.USE_ICONS;\r\n        } else if (prop.flag & PropFlags.FORCE_ENUM_CHECKBOXES) {\r\n          packflag &= ~PackFlags.USE_ICONS;\r\n        }\r\n\r\n        if (packflag & PackFlags.FORCE_PROP_LABELS) {\r\n          let strip = this.strip();\r\n          strip.label(prop.uiname);\r\n\r\n          return strip.checkenum(inpath, undefined, packflag).setUndo(useDataPathUndo);\r\n        } else {\r\n          return this.checkenum(inpath, undefined, packflag).setUndo(useDataPathUndo);\r\n        }\r\n      }\r\n    } else if (prop.type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4)) {\r\n      if (rdef.subkey !== undefined) {\r\n        let ret;\r\n\r\n        if (packflag & PackFlags.SIMPLE_NUMSLIDERS)\r\n          ret = this.simpleslider(inpath, {packflag: packflag});\r\n        else\r\n          ret = this.slider(inpath, {packflag: packflag});\r\n\r\n        ret.packflag |= packflag;\r\n        return ret.setUndo(useDataPathUndo);\r\n      } else if (prop.subtype === PropSubTypes.COLOR) {\r\n        return this.colorbutton(inpath, packflag, mass_set_path).setUndo(useDataPathUndo);\r\n        //return this.colorPicker(inpath, packflag, mass_set_path);\r\n      } else {\r\n        let ret = UIBase.createElement(\"vector-panel-x\");\r\n\r\n        mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n        ret.packflag |= packflag | (this.inherit_packflag & ~PackFlags.NO_UPDATE);\r\n        ret.inherit_packflag |= packflag | (this.inherit_packflag & ~PackFlags.NO_UPDATE);\r\n\r\n        if (inpath) {\r\n          ret.setAttribute(\"datapath\", this._joinPrefix(inpath));\r\n        }\r\n\r\n        if (mass_set_path) {\r\n          ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n        }\r\n\r\n        this.add(ret);\r\n\r\n        return ret.setUndo(useDataPathUndo);\r\n      }\r\n    } else if (prop.type === PropTypes.FLAG) {\r\n      if (rdef.subkey !== undefined) {\r\n        let tooltip = rdef.prop.descriptions[rdef.subkey];\r\n        let name = rdef.prop.ui_value_names[rdef.subkey];\r\n\r\n        if (typeof rdef.subkey === \"number\") {\r\n          name = rdef.prop.keys[rdef.subkey];\r\n          if (name && name in rdef.prop.ui_value_names) {\r\n            name = rdef.prop.ui_value_names[name];\r\n          } else {\r\n            name = makeUIName(name ? name : \"(error)\");\r\n          }\r\n        }\r\n\r\n        if (name === undefined) {\r\n          name = \"(error)\";\r\n        }\r\n\r\n        let ret = this.check(inpath, name, packflag, mass_set_path);\r\n\r\n        ret.icon = rdef.prop.iconmap[rdef.subkey];\r\n\r\n        if (tooltip) {\r\n          ret.description = tooltip;\r\n        }\r\n\r\n        return ret.setUndo(useDataPathUndo);\r\n      } else {\r\n        let con = this;\r\n\r\n        if (packflag & PackFlags.FORCE_PROP_LABELS) {\r\n          con = this.strip();\r\n          con.label(prop.uiname);\r\n        }\r\n\r\n        if (packflag & PackFlags.PUT_FLAG_CHECKS_IN_COLUMNS) {\r\n          let i = 0;\r\n          let row = con.row();\r\n          let col1 = row.col();\r\n          let col2 = row.col();\r\n\r\n          for (let k in prop.values) {\r\n            let name = prop.ui_value_names[k];\r\n            let tooltip = prop.descriptions[k];\r\n\r\n            if (name === undefined) {\r\n              name = makeUIName(k);\r\n            }\r\n\r\n            let con2 = i & 1 ? col1 : col2;\r\n            let check = con2.check(`${inpath}[${k}]`, name, packflag, mass_set_path);\r\n\r\n            if (tooltip) {\r\n              check.description = tooltip;\r\n            }\r\n\r\n            check.setUndo(useDataPathUndo);\r\n\r\n            i++;\r\n          }\r\n\r\n          return row;\r\n        }\r\n\r\n        if (packflag & PackFlags.WRAP_CHECKBOXES) {\r\n          let isrow = this.style[\"flex-direction\"] === \"row\";\r\n          isrow = isrow || this.style[\"flex-direction\"] === \"row-reverse\";\r\n\r\n          let wrapChars;\r\n\r\n          let strip, con;\r\n\r\n          if (isrow) {\r\n            wrapChars = this.getDefault(\"checkRowWrapLimit\", undefined, 24);\r\n            strip = this.col().strip();\r\n            strip.packflag |= packflag;\r\n            strip.inherit_packflag |= packflag;\r\n\r\n            con = strip.row();\r\n          } else {\r\n            wrapChars = this.getDefault(\"checkColWrapLimit\", undefined, 5);\r\n            strip = this.row().strip();\r\n            strip.packflag |= packflag;\r\n            strip.inherit_packflag |= packflag;\r\n\r\n            con = strip.col();\r\n          }\r\n\r\n          let x = 0;\r\n          let y = 0;\r\n\r\n          for (let k in prop.values) {\r\n            let name = prop.ui_value_names[k];\r\n            let tooltip = prop.descriptions[k];\r\n\r\n            if (name === undefined) {\r\n              name = makeUIName(k);\r\n            }\r\n\r\n            let check = con.check(`${inpath}[${k}]`, name, packflag, mass_set_path);\r\n\r\n            if (tooltip) {\r\n              check.description = tooltip;\r\n            }\r\n\r\n            x += name.length;\r\n            y += 1;\r\n\r\n            if (isrow && x > wrapChars) {\r\n              x = 0;\r\n              con = strip.row();\r\n            } else if (!isrow && y > wrapChars) {\r\n              y = 0;\r\n              con = strip.col();\r\n            }\r\n          }\r\n\r\n          return strip;\r\n        }\r\n\r\n        if (con === this) {\r\n          con = this.strip();\r\n        }\r\n\r\n        let rebuild = () => {\r\n          con.clear();\r\n\r\n          for (let k in prop.values) {\r\n            let name = prop.ui_value_names[k];\r\n            let tooltip = prop.descriptions[k];\r\n\r\n            if (name === undefined) {\r\n              name = makeUIName(k);\r\n            }\r\n\r\n            let check = con.check(`${inpath}[${k}]`, name, packflag, mass_set_path);\r\n            check.useDataPathUndo = useDataPathUndo;\r\n\r\n            if (tooltip) {\r\n              check.description = tooltip;\r\n            }\r\n\r\n            check.setUndo(useDataPathUndo);\r\n          }\r\n        }\r\n\r\n        rebuild();\r\n        let last_hash = prop.calcHash();\r\n\r\n        con.update.after(() => {\r\n          let hash = prop.calcHash();\r\n\r\n          if (last_hash !== hash) {\r\n            last_hash = hash;\r\n            console.error(\"Property definition update\");\r\n            rebuild();\r\n          }\r\n        });\r\n\r\n        return con;\r\n      }\r\n    }\r\n  }\r\n\r\n  iconcheck(inpath, icon, name, mass_set_path) {\r\n    let ret = UIBase.createElement(\"iconcheck-x\");\r\n    ret.icon = icon;\r\n    ret.description = name;\r\n\r\n    if (inpath) {\r\n      ret.setAttribute(\"datapath\", inpath);\r\n    }\r\n\r\n    if (mass_set_path) {\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n    }\r\n\r\n    this.add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  check(inpath, name, packflag = 0, mass_set_path = undefined) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let path = inpath !== undefined ? this._joinPrefix(inpath) : undefined;\r\n\r\n    //let prop = this.ctx.getProp(path);\r\n    let ret;\r\n    if (packflag & PackFlags.USE_ICONS) {\r\n      ret = UIBase.createElement(\"iconcheck-x\");\r\n\r\n      ret.iconsheet = iconSheetFromPackFlag(packflag);\r\n    } else {\r\n      ret = UIBase.createElement(\"check-x\");\r\n    }\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    ret.packflag |= packflag;\r\n    ret.label = name;\r\n    ret.noMarginsOrPadding();\r\n\r\n    if (inpath) {\r\n      ret.setAttribute(\"datapath\", path);\r\n    }\r\n\r\n    if (mass_set_path) {\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n    }\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  /*\r\n  *\r\n  * new (optional) form: checkenum(inpath, args)\r\n  * */\r\n  checkenum(inpath, name, packflag, enummap, defaultval, callback, iconmap, mass_set_path) {\r\n    if (typeof name === \"object\" && name !== null) {\r\n      let args = name;\r\n\r\n      name = args.name;\r\n      packflag = args.packflag;\r\n      enummap = args.enummap;\r\n      defaultval = args.defaultval;\r\n      callback = args.callback;\r\n      iconmap = args.iconmap;\r\n      mass_set_path = args.mass_set_path;\r\n    }\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    packflag = packflag === undefined ? 0 : packflag;\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let path = this._joinPrefix(inpath);\r\n\r\n    let has_path = path !== undefined;\r\n    let prop;\r\n    let frame;\r\n\r\n    if (path !== undefined) {\r\n      prop = this.ctx.api.resolvePath(this.ctx, path, true);\r\n\r\n      if (prop !== undefined)\r\n        prop = prop.prop;\r\n    }\r\n\r\n    if (path !== undefined) {\r\n      if (prop === undefined) {\r\n        console.warn(\"Bad path in checkenum\", path);\r\n        return;\r\n      }\r\n\r\n      frame = this.strip();\r\n      frame.oneAxisPadding();\r\n\r\n      if (packflag & PackFlags.USE_ICONS) {\r\n        for (let key in prop.values) {\r\n          let check = frame.check(inpath + \"[\" + key + \"]\", \"\", packflag);\r\n\r\n          check.packflag |= PackFlags.HIDE_CHECK_MARKS;\r\n\r\n          check.icon = prop.iconmap[key];\r\n          check.drawCheck = false;\r\n\r\n          check.style[\"padding\"] = \"0px\";\r\n          check.style[\"margin\"] = \"0px\";\r\n\r\n          check.dom.style[\"padding\"] = \"0px\";\r\n          check.dom.style[\"margin\"] = \"0px\";\r\n\r\n          check.description = prop.descriptions[key];\r\n          //console.log(check.description, key, prop.keys[key], prop.descriptions, prop.keys);\r\n        }\r\n      } else {\r\n        if (name === undefined) {\r\n          name = prop.uiname;\r\n        }\r\n\r\n        frame.label(name).font = \"TitleText\";\r\n\r\n        let checks = {};\r\n\r\n        let ignorecb = false;\r\n\r\n        function makecb(key) {\r\n          return () => {\r\n            if (ignorecb) return;\r\n\r\n            ignorecb = true;\r\n            for (let k in checks) {\r\n              if (k !== key) {\r\n                checks[k].checked = false;\r\n              }\r\n            }\r\n            ignorecb = false;\r\n\r\n            if (callback) {\r\n              callback(key);\r\n            }\r\n          }\r\n        }\r\n\r\n        for (let key in prop.values) {\r\n          let check = frame.check(`${inpath}[${key}]`, prop.ui_value_names[key]);\r\n          checks[key] = check;\r\n\r\n          if (mass_set_path) {\r\n            check.setAttribute(\"mass_set_path\", mass_set_path);\r\n          }\r\n\r\n\r\n          check.description = prop.descriptions[prop.keys[key]];\r\n          if (!check.description) {\r\n            check.description = \"\" + prop.ui_value_names[key];\r\n          }\r\n          check.onchange = makecb(key);\r\n        }\r\n      }\r\n    }\r\n\r\n    return frame;\r\n  }\r\n\r\n  checkenum_panel(inpath, name, packflag = 0, callback = undefined, mass_set_path = undefined, prop = undefined) {\r\n    packflag = packflag === undefined ? 0 : packflag;\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let path = this._joinPrefix(inpath);\r\n    let frame;\r\n\r\n    let has_path = path !== undefined;\r\n\r\n    if (path !== undefined && prop === undefined) {\r\n      prop = this.ctx.api.resolvePath(this.ctx, path, true);\r\n\r\n      if (prop !== undefined)\r\n        prop = prop.prop;\r\n    }\r\n\r\n    if (!name && prop) {\r\n      name = prop.uiname;\r\n    }\r\n\r\n    if (path !== undefined) {\r\n      if (prop === undefined) {\r\n        console.warn(\"Bad path in checkenum\", path);\r\n        return;\r\n      }\r\n\r\n      frame = this.panel(name, name, packflag);\r\n\r\n      frame.oneAxisPadding();\r\n      frame.setCSS.after(frame.background = this.getDefault(\"BoxSub2BG\"));\r\n\r\n      if (packflag & PackFlags.USE_ICONS) {\r\n        for (let key in prop.values) {\r\n          let check = frame.check(inpath + \" == \" + prop.values[key], \"\", packflag);\r\n\r\n          check.icon = prop.iconmap[key];\r\n          check.drawCheck = false;\r\n\r\n          check.style[\"padding\"] = \"0px\";\r\n          check.style[\"margin\"] = \"0px\";\r\n\r\n          check.dom.style[\"padding\"] = \"0px\";\r\n          check.dom.style[\"margin\"] = \"0px\";\r\n\r\n          check.description = prop.descriptions[key];\r\n          //console.log(check.description, key, prop.keys[key], prop.descriptions, prop.keys);\r\n        }\r\n      } else {\r\n        if (name === undefined) {\r\n          name = prop.uiname;\r\n        }\r\n\r\n        frame.label(name).font = \"TitleText\";\r\n\r\n        let checks = {};\r\n\r\n        let ignorecb = false;\r\n\r\n        function makecb(key) {\r\n          return () => {\r\n            if (ignorecb) return;\r\n\r\n            ignorecb = true;\r\n            for (let k in checks) {\r\n              if (k !== key) {\r\n                checks[k].checked = false;\r\n              }\r\n            }\r\n            ignorecb = false;\r\n\r\n            if (callback) {\r\n              callback(key);\r\n            }\r\n          }\r\n        }\r\n\r\n        for (let key in prop.values) {\r\n          let check = frame.check(inpath + \" = \" + prop.values[key], prop.ui_value_names[key]);\r\n          checks[key] = check;\r\n\r\n          if (mass_set_path) {\r\n            check.setAttribute(\"mass_set_path\", mass_set_path);\r\n          }\r\n\r\n\r\n          check.description = prop.descriptions[prop.keys[key]];\r\n          if (!check.description) {\r\n            check.description = \"\" + prop.ui_value_names[key];\r\n          }\r\n          check.onchange = makecb(key);\r\n          //console.log(\"PATH\", path);\r\n        }\r\n      }\r\n    }\r\n\r\n    return frame;\r\n  }\r\n\r\n  /*\r\n    enummap is an object that maps\r\n    ui names to keys, e.g.:\r\n\r\n    ui.listenum(\"color\", \"Color\", {\r\n      RED   : 0,\r\n      GREEN : 1,\r\n      BLUE  : 2\r\n    });\r\n\r\n    path can be undefined, in which case, use callback,\r\n    which gets the current enum as an argument\r\n\r\n    defaultval cannot be undefined\r\n  */\r\n  listenum(inpath, name, enumDef, defaultval, callback, iconmap, packflag = 0) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n    let mass_set_path;\r\n\r\n    if (name && typeof name === \"object\") {\r\n      let args = name;\r\n\r\n      name = args.name;\r\n      enumDef = args.enumDef;\r\n      defaultval = args.defaultval;\r\n      callback = args.callback;\r\n      iconmap = args.iconmap;\r\n      packflag = args.packflag || 0;\r\n      mass_set_path = args.mass_set_path;\r\n    }\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    let path;\r\n    let label = name;\r\n\r\n    if (inpath !== undefined) {\r\n      path = this._joinPrefix(inpath);\r\n    }\r\n\r\n    let ret = UIBase.createElement(\"dropbox-x\")\r\n\r\n    if (enumDef !== undefined) {\r\n      if (enumDef instanceof toolprop.EnumProperty) {\r\n        ret.prop = enumDef;\r\n        label ||= enumDef.uiname || toolprop.ToolProperty.makeUIName(enumDef.apiname);\r\n      } else {\r\n        ret.prop = new toolprop.EnumProperty(defaultval, enumDef, path, name);\r\n      }\r\n\r\n      if (iconmap !== undefined) {\r\n        ret.prop.addIcons(iconmap)\r\n      }\r\n    } else {\r\n      let res = this.ctx.api.resolvePath(this.ctx, path, true);\r\n\r\n      if (res !== undefined) {\r\n        ret.prop = res.prop;\r\n\r\n        name ||= res.prop.uiname;\r\n        label ||= name;\r\n      }\r\n    }\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n    if (path !== undefined) {\r\n      ret.setAttribute(\"datapath\", path);\r\n    }\r\n    if (mass_set_path !== undefined) {\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n    }\r\n\r\n    ret.setAttribute(\"name\", name);\r\n\r\n    if (defaultval) {\r\n      ret.setValue(defaultval);\r\n    }\r\n\r\n    ret.onchange = callback;\r\n    ret.onselect = callback;\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    if (label && packflag & PackFlags.FORCE_PROP_LABELS) {\r\n      const container = this.row();\r\n      let l;\r\n\r\n      if (packflag & PackFlags.LABEL_ON_RIGHT) {\r\n        container._add(ret);\r\n        l = container.label(label);\r\n\r\n        if (!l.style[\"margin-left\"] || l.style[\"margin-left\"] === \"unset\") {\r\n          l.style[\"margin-left\"] = \"5px\";\r\n        }\r\n      } else {\r\n        l = container.label(label);\r\n        container._add(ret);\r\n      }\r\n    } else {\r\n      this._add(ret);\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  getroot() {\r\n    let p = this;\r\n\r\n    while (p.parent !== undefined) {\r\n      p = p.parent;\r\n    }\r\n\r\n    return p;\r\n  }\r\n\r\n  simpleslider(inpath, name, defaultval, min, max, step, is_int, do_redraw, callback, packflag = 0) {\r\n    if (arguments.length === 2 || typeof name === \"object\") {\r\n      let args = Object.assign({}, name);\r\n\r\n      args.packflag = (args.packflag || 0) | PackFlags.SIMPLE_NUMSLIDERS;\r\n      return this.slider(inpath, args);\r\n      //new-style api call\r\n    } else {\r\n      return this.slider(inpath, name, defaultval, min, max, step, is_int, do_redraw, callback, packflag | PackFlags.SIMPLE_NUMSLIDERS);\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * usage: .slider(inpath, {\r\n   *  name : bleh,\r\n   *  defaultval : number,\r\n   *  etc...\r\n   * });\r\n   * */\r\n  slider(inpath, name, defaultval, min, max, step, is_int, do_redraw, callback, packflag = 0) {\r\n    if (arguments.length === 2 || typeof name === \"object\") {\r\n      //new-style api call\r\n\r\n      let args = name;\r\n\r\n      name = args.name;\r\n      defaultval = args.defaultval;\r\n      min = args.min;\r\n      max = args.max;\r\n      step = args.step;\r\n      is_int = args.is_int || args.isInt;\r\n      do_redraw = args.do_redraw;\r\n      callback = args.callback;\r\n      packflag = args.packflag || 0;\r\n    }\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n    let ret;\r\n\r\n    if (inpath) {\r\n      inpath = this._joinPrefix(inpath);\r\n\r\n      let rdef = this.ctx.api.resolvePath(this.ctx, inpath, true);\r\n      if (rdef && rdef.prop && (rdef.prop.flag & PropFlags.SIMPLE_SLIDER)) {\r\n        packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n      }\r\n      if (rdef && rdef.prop && (rdef.prop.flag & PropFlags.FORCE_ROLLER_SLIDER)) {\r\n        packflag |= PackFlags.FORCE_ROLLER_SLIDER;\r\n      }\r\n    }\r\n\r\n    let simple = (packflag & PackFlags.SIMPLE_NUMSLIDERS) || cconst.simpleNumSliders;\r\n    simple = simple && !(packflag & PackFlags.FORCE_ROLLER_SLIDER);\r\n\r\n    let extraTextBox = cconst.useNumSliderTextboxes && !(packflag & PackFlags.NO_NUMSLIDER_TEXTBOX);\r\n\r\n    if (extraTextBox) {\r\n      if (simple) {\r\n        ret = UIBase.createElement(\"numslider-simple-x\");\r\n      } else {\r\n        ret = UIBase.createElement(\"numslider-textbox-x\");\r\n      }\r\n    } else {\r\n      if (simple) {\r\n        ret = UIBase.createElement(\"numslider-simple-x\");\r\n      } else {\r\n        ret = UIBase.createElement(\"numslider-x\");\r\n      }\r\n    }\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    let decimals;\r\n\r\n    if (inpath) {\r\n      ret.setAttribute(\"datapath\", inpath);\r\n    }\r\n\r\n    if (name) {\r\n      ret.setAttribute(\"name\", name);\r\n    }\r\n\r\n    if (min !== undefined) {\r\n      ret.setAttribute(\"min\", min);\r\n    }\r\n    if (max !== undefined) {\r\n      ret.setAttribute(\"max\", max);\r\n    }\r\n\r\n    if (defaultval !== undefined) {\r\n      ret.setValue(defaultval);\r\n    }\r\n\r\n    if (is_int) {\r\n      ret.setAttribute(\"integer\", is_int);\r\n    }\r\n\r\n    if (decimals !== undefined) {\r\n      ret.decimalPlaces = decimals;\r\n    }\r\n\r\n    if (callback) {\r\n      ret.onchange = callback;\r\n    }\r\n\r\n    this._add(ret);\r\n\r\n    if (this.ctx) {\r\n      ret.setCSS();\r\n      ret.update();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  _container_inherit(elem, packflag = 0) {\r\n    //don't inherit NO_UPDATE\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    elem.packflag |= packflag;\r\n    elem.inherit_packflag |= packflag;\r\n    elem.dataPrefix = this.dataPrefix;\r\n    elem.massSetPrefix = this.massSetPrefix;\r\n  }\r\n\r\n  treeview() {\r\n    let ret = UIBase.createElement(\"tree-view-x\");\r\n    ret.ctx = this.ctx;\r\n    this.add(ret);\r\n\r\n    this._container_inherit(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  panel(name, id, packflag = 0, tooltip = undefined) {\r\n    id = id === undefined ? name : id;\r\n\r\n    let ret = UIBase.createElement(\"panelframe-x\");\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    if (tooltip) {\r\n      ret.setHeaderToolTip(tooltip);\r\n    }\r\n\r\n    ret.setAttribute(\"label\", name);\r\n    ret.setAttribute(\"id\", id);\r\n\r\n    this._add(ret);\r\n\r\n\r\n    if (this.ctx) {//check init was called\r\n      ret.ctx = this.ctx;\r\n      ret._init();\r\n      //ret.headerLabel = name;\r\n\r\n      ret.contents.ctx = ret.ctx;\r\n    }\r\n\r\n    ret.contents.dataPrefix = this.dataPrefix;\r\n    ret.contents.massSetPrefix = this.massSetPrefix;\r\n\r\n    return ret;\r\n  }\r\n\r\n  row(packflag = 0) {\r\n    let ret = UIBase.createElement(\"rowframe-x\");\r\n\r\n    this._container_inherit(ret, packflag);\r\n    this._add(ret);\r\n\r\n    ret.ctx = this.ctx;\r\n\r\n    return ret;\r\n  }\r\n\r\n  listbox(packflag = 0) {\r\n    let ret = UIBase.createElement(\"listbox-x\");\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  table(packflag = 0) {\r\n    let ret = UIBase.createElement(\"tableframe-x\");\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  twocol(parentDepth = 1, packflag = 0) {\r\n    let ret = UIBase.createElement(\"two-column-x\");\r\n\r\n    ret.parentDepth = parentDepth;\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  col(packflag = 0) {\r\n    let ret = UIBase.createElement(\"colframe-x\");\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  colorPicker(inpath, packflag_or_args = 0, mass_set_path = undefined, themeOverride = undefined) {\r\n    let packflag;\r\n\r\n    if (typeof packflag_or_args === \"object\") {\r\n      let args = packflag_or_args;\r\n\r\n      packflag = args.packflag !== undefined ? args.packflag : 0;\r\n      mass_set_path = args.massSetPath;\r\n      themeOverride = args.themeOverride;\r\n    }\r\n\r\n    let path;\r\n\r\n    if (inpath) {\r\n      path = this._joinPrefix(inpath);\r\n    }\r\n\r\n    let ret = UIBase.createElement(\"colorpicker-x\");\r\n\r\n    if (themeOverride) {\r\n      ret.overrideClass(themeOverride);\r\n    }\r\n\r\n    packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    ret.ctx = this.ctx;\r\n    ret.parentWidget = this;\r\n    ret._init();\r\n    ret.packflag |= packflag;\r\n    ret.inherit_packflag |= packflag;\r\n    ret.constructor.setDefault(ret);\r\n\r\n    if (path !== undefined) {\r\n      ret.setAttribute(\"datapath\", path);\r\n    }\r\n\r\n    console.warn(\"mass_set_path\", mass_set_path);\r\n    if (mass_set_path) {\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n    }\r\n\r\n    //XXX\r\n    window.colorpicker = ret;\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  textarea(datapath = undefined, value = \"\", packflag = 0, mass_set_path = undefined) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, datapath, mass_set_path);\r\n\r\n    let ret = UIBase.createElement(\"rich-text-editor-x\");\r\n    ret.ctx = this.ctx;\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    if (value !== undefined) {\r\n      ret.value = value;\r\n    }\r\n\r\n    if (datapath)\r\n      ret.setAttribute(\"datapath\", datapath)\r\n    if (mass_set_path)\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path)\r\n\r\n    this.add(ret);\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   * html5 viewer\r\n   * */\r\n  viewer(datapath = undefined, value = \"\", packflag = 0, mass_set_path = undefined) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, datapath, mass_set_path);\r\n\r\n    let ret = UIBase.createElement(\"html-viewer-x\");\r\n    ret.ctx = this.ctx;\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    if (value !== undefined) {\r\n      ret.value = value;\r\n    }\r\n\r\n    if (datapath)\r\n      ret.setAttribute(\"datapath\", datapath)\r\n    if (mass_set_path)\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path)\r\n\r\n    this.add(ret);\r\n    return ret;\r\n  }\r\n\r\n  //\r\n  tabs(position = \"top\", packflag = 0) {\r\n\r\n    let ret = UIBase.createElement(\"tabcontainer-x\");\r\n\r\n    ret.constructor.setDefault(ret);\r\n    ret.setAttribute(\"bar_pos\", position);\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  asDialogFooter() {\r\n    this.style['margin-top'] = '15px';\r\n    this.style['justify-content'] = 'flex-end';\r\n\r\n    return this;\r\n  }\r\n\r\n};\r\n\r\nui_base.UIBase.internalRegister(Container, \"div\");\r\n\r\n\r\nexport class RowFrame extends Container {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: 'rowframe-x'\r\n    };\r\n  }\r\n\r\n  //try to set styling as early as possible\r\n  connectedCallback() {\r\n    super.connectedCallback();\r\n\r\n    this.style['display'] = 'flex';\r\n    this.style['flex-direction'] = this.reversed ? 'row-reverse' : 'row';\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style['display'] = 'flex';\r\n    this.style['flex-direction'] = this.reversed ? 'row-reverse' : 'row';\r\n\r\n    if (!this.style['align-items'] || this.style['align-items'] == '') {\r\n      this.style['align-items'] = 'center';\r\n    }\r\n\r\n    if (this.getDefault(\"slider-style\") === \"simple\") {\r\n      this.packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n      this.inherit_packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n    }\r\n  }\r\n\r\n  oneAxisMargin(m = this.getDefault('oneAxisMargin'), m2 = 0) {\r\n    this.style['margin-left'] = this.style['margin-right'] = m + 'px';\r\n    this.style['margin-top'] = this.style['margin-bottom'] = '' + m2 + 'px';\r\n\r\n    return this;\r\n  }\r\n\r\n  oneAxisPadding(m = this.getDefault('oneAxisPadding'), m2 = 0) {\r\n    this.style['padding-left'] = this.style['padding-right'] = '' + m + 'px';\r\n    this.style['padding-top'] = this.style['padding-bottom'] = '' + m2 + 'px';\r\n\r\n    return this;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(RowFrame);\r\n\r\nexport class ColumnFrame extends Container {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"colframe-x\"\r\n    };\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-direction\"] = \"column\";\r\n    this.style[\"justify-content\"] = \"right\";\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  oneAxisMargin(m = this.getDefault('oneAxisMargin'), m2 = 0) {\r\n    this.style['margin-top'] = this.style['margin-bottom'] = '' + m + 'px';\r\n    this.style['margin-left'] = this.style['margin-right'] = m2 + 'px';\r\n\r\n    return this;\r\n  }\r\n\r\n  oneAxisPadding(m = this.getDefault('oneAxisPadding'), m2 = 0) {\r\n    this.style['padding-top'] = this.style['padding-bottom'] = '' + m + 'px';\r\n    this.style['padding-left'] = this.style['padding-right'] = '' + m2 + 'px';\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ColumnFrame);\r\n\r\n\r\nexport class TwoColumnFrame extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this._colWidth = 256;\r\n    this.parentDepth = 1;\r\n  }\r\n\r\n  get colWidth() {\r\n    if (this.hasAttribute(\"colWidth\")) {\r\n      return parsepx(this.getAttribute(\"colWidth\"));\r\n    }\r\n\r\n    return this._colWidth;\r\n  }\r\n\r\n  set colWidth(v) {\r\n    if (this.hasAttribute(\"colWidth\")) {\r\n      this.setAttribute(\"colWidth\", \"\" + v);\r\n    } else {\r\n      this._colWidth = v;\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"two-column-x\"\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-direction\"] = \"column\";\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    let p = this;\r\n\r\n    for (let i = 0; i < this.parentDepth; i++) {\r\n      p = p.parentWidget ? p.parentWidget : p;\r\n    }\r\n\r\n    if (!p) {\r\n      return;\r\n    }\r\n\r\n    let r = p.getBoundingClientRect();\r\n\r\n    if (!r) {\r\n      return;\r\n    }\r\n\r\n    let style = r.width > this.colWidth*2.0 ? 'row' : 'column';\r\n\r\n    if (this.style[\"flex-direction\"] !== style) {\r\n      this.style[\"flex-direction\"] = style;\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(TwoColumnFrame);\r\n","import * as util from '../path-controller/util/util.js';\r\nimport * as ui from '../core/ui.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport {Icons, css2color, color2css} from '../core/ui_base.js';\r\n\r\nlet UIBase = ui_base.UIBase;\r\n\r\nexport class Note extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    let style = document.createElement(\"style\");\r\n\r\n    this._noteid = undefined;\r\n    this.height = 20;\r\n\r\n    this.showExclMark = true;\r\n\r\n    style.textContent = `\r\n    .notex {\r\n      display : flex;\r\n      flex-direction : row;\r\n      flex-wrap : nowrap;\r\n      height : {this.height}px;\r\n      padding : 0px;\r\n      margin : 0px;\r\n    }\r\n    `;\r\n\r\n    this.dom = document.createElement(\"div\");\r\n    this.dom.setAttribute(\"class\", \"notex\");\r\n    this.color = \"red\";\r\n\r\n    this.shadow.appendChild(style);\r\n    this.shadow.append(this.dom);\r\n    this.setLabel(\"\");\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"note-x\",\r\n      style  : 'notification',\r\n    }\r\n  }\r\n\r\n  setLabel(s) {\r\n    let color = this.color;\r\n    if (this.showExclMark && this.mark === undefined) {\r\n      this.mark = document.createElement(\"div\");\r\n      this.mark.style[\"display\"] = \"flex\";\r\n      this.mark.style[\"flex-direction\"] = \"row\";\r\n      this.mark.style[\"flex-wrap\"] = \"nowrap\";\r\n\r\n      //this.mark.style[\"width\"]\r\n      let sheet = 0;\r\n\r\n      let size = ui_base.iconmanager.getTileSize(sheet);\r\n\r\n      this.mark.style[\"width\"] = \"\" + size + \"px\";\r\n      this.mark.style[\"height\"] = \"\" + size + \"px\";\r\n\r\n      this.dom.appendChild(this.mark);\r\n\r\n      this.ntext = document.createElement(\"div\");\r\n      this.ntext.style[\"display\"] = \"inline-flex\";\r\n      this.ntext.style[\"flex-wrap\"] = \"nowrap\";\r\n\r\n      this.dom.appendChild(this.ntext);\r\n\r\n      ui_base.iconmanager.setCSS(Icons.NOTE_EXCL, this.mark, sheet);\r\n\r\n      //this.mark.style[\"margin\"] = this.ntext.style[\"margin\"] = \"0px\"\r\n      //this.mark.style[\"padding\"] = this.ntext.style[\"padding\"] = \"0px\"\r\n      //this.mark.style[\"background-color\"] = color;\r\n    } else if (!this.showExclMark && this.mark) {\r\n      this.mark.remove();\r\n      this.mark = undefined;\r\n    }\r\n\r\n    let ntext = this.ntext;\r\n    //mark.innerText = \"!\";\r\n    ntext.innerText = \" \" + s;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.setAttribute(\"class\", \"notex\");\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-wrap\"] = \"nowrap\";\r\n    this.style[\"flex-direction\"] = \"row\";\r\n    this.style[\"border-radius\"] = \"7px\";\r\n    this.style[\"padding\"] = \"2px\";\r\n\r\n    this.style[\"color\"] = this.getDefault(\"DefaultText\").color;\r\n    let clr = css2color(this.color);\r\n    clr = color2css([clr[0], clr[1], clr[2], 0.25]);\r\n\r\n    this.style[\"background-color\"] = clr;\r\n    this.setCSS();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS(false);\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(Note);\r\n\r\nexport class ProgBarNote extends Note {\r\n  constructor() {\r\n    super();\r\n\r\n    this._percent = 0.0;\r\n    this.barWidth = 100;\r\n\r\n    let bar = this.bar = document.createElement(\"div\");\r\n    bar.style[\"display\"] = \"flex\";\r\n    bar.style[\"flex-direction\"] = \"row\";\r\n    bar.style[\"width\"] = this.barWidth + \"px\";\r\n    bar.style[\"height\"] = this.height + \"px\";\r\n    bar.style[\"background-color\"] = this.getDefault(\"ProgressBarBG\");\r\n    bar.style[\"border-radius\"] = \"12px\";\r\n    bar.style[\"align-items\"] = \"center\";\r\n    bar.style[\"padding\"] = bar.style[\"margin\"] = \"0px\";\r\n\r\n    let bar2 = this.bar2 = document.createElement(\"div\");\r\n    let w = 50.0;\r\n\r\n    bar2.style[\"display\"] = \"flex\";\r\n    bar2.style[\"flex-direction\"] = \"row\";\r\n    bar2.style[\"height\"] = this.height + \"px\";\r\n    bar2.style[\"background-color\"] = this.getDefault(\"ProgressBar\");\r\n    bar2.style[\"border-radius\"] = \"12px\";\r\n    bar2.style[\"align-items\"] = \"center\";\r\n    bar2.style[\"padding\"] = bar2.style[\"margin\"] = \"0px\";\r\n\r\n    this.bar.appendChild(bar2);\r\n    this.dom.appendChild(this.bar);\r\n  }\r\n\r\n  get percent() {\r\n    return this._percent;\r\n  }\r\n\r\n  set percent(val) {\r\n    this._percent = val;\r\n    this.setCSS();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"note-progress-x\",\r\n      style  : 'notification',\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    let w = ~~(this.percent*this.barWidth + 0.5);\r\n\r\n    this.bar2.style[\"width\"] = w + \"px\";\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ProgBarNote);\r\n\r\nexport class NoteFrame extends ui.RowFrame {\r\n  constructor() {\r\n    super();\r\n    this._h = 20;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"noteframe-x\",\r\n      style  : 'noteframe',\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.noMarginsOrPadding();\r\n\r\n    noteframes.push(this);\r\n    this.background = this.getDefault(\"background-color\");\r\n    this.style['flex-grow'] = 'unset';\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.style[\"width\"] = \"min-contents\";\r\n    this.style[\"height\"] = this._h + \"px\";\r\n  }\r\n\r\n  _ondestroy() {\r\n    if (noteframes.indexOf(this) >= 0) {\r\n      noteframes.remove(this)\r\n    }\r\n\r\n    super._ondestroy();\r\n  }\r\n\r\n  progbarNote(msg, percent, color = \"rgba(255,0,0,0.2)\", timeout = 700, id = msg) {\r\n    let note;\r\n\r\n    for (let child of this.children) {\r\n      if (child._noteid === id) {\r\n        note = child;\r\n        break;\r\n      }\r\n    }\r\n\r\n    let f = (100.0*Math.min(percent, 1.0)).toFixed(1);\r\n\r\n    if (note === undefined) {\r\n      note = this.addNote(msg, color, -1, \"note-progress-x\");\r\n      note._noteid = id;\r\n    }\r\n\r\n    //note.setLabel(msg + \" \" + f + \"%\");\r\n    note.percent = percent;\r\n\r\n    if (percent >= 1.0) {\r\n      //note.setLabel(msg + \" \" + f + \"%\");\r\n\r\n      window.setTimeout(() => {\r\n        note.remove();\r\n      }, timeout);\r\n    }\r\n\r\n    return note;\r\n  }\r\n\r\n  addNote(msg, color = \"rgba(255,0,0,0.2)\", timeout = 1200, tagname = \"note-x\", showExclMark=true) {\r\n    //let note = UIBase.createElement(\"note-x\");\r\n\r\n    //note.ctx = this.ctx;\r\n    //note.background = \"red\";\r\n    //note.dom.innerText = msg;\r\n\r\n    //this._add(note);\r\n\r\n    let note = UIBase.createElement(tagname);\r\n\r\n    note.color = color;\r\n    note.setLabel(msg);\r\n\r\n    note.style[\"text-align\"] = \"center\";\r\n\r\n    note.style[\"font\"] = ui_base.getFont(note, \"DefaultText\");\r\n    note.style[\"color\"] = this.getDefault(\"DefaultText\").color;\r\n    note.showExclMark = showExclMark;\r\n\r\n    this.add(note);\r\n\r\n    this.noMarginsOrPadding();\r\n    note.noMarginsOrPadding();\r\n\r\n    //this.dom.style[\"position\"] = UIBase.PositionKey;\r\n    //this.style[\"position\"] = UIBase.PositionKey;\r\n    //note.style[\"position\"] = UIBase.PositionKey;\r\n\r\n    note.style[\"height\"] = this._h + \"px\";\r\n    note.height = this._h;\r\n\r\n    if (timeout !== -1) {\r\n      window.setTimeout(() => {\r\n        //console.log(\"remove!\");\r\n        note.remove();\r\n      }, timeout);\r\n    }\r\n\r\n    //this.appendChild(note);\r\n    return note;\r\n\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(NoteFrame);\r\n\r\nexport function getNoteFrames(screen) {\r\n  let ret = [];\r\n\r\n  let rec = (n) => {\r\n\r\n    if (n instanceof NoteFrame) {\r\n      ret.push(n);\r\n    }\r\n\r\n    if (n.childNodes !== undefined) {\r\n      for (let node of n.childNodes) {\r\n        rec(node);\r\n      }\r\n    }\r\n\r\n    if (n instanceof ui_base.UIBase && n.shadow !== undefined && n.shadow.childNodes) {\r\n      for (let node of n.shadow.childNodes) {\r\n        rec(node);\r\n      }\r\n    }\r\n  }\r\n\r\n  rec(screen);\r\n  return ret;\r\n}\r\n\r\nexport let noteframes = [];\r\n\r\nexport function sendNote(screen, msg, color, timeout = 3000, showExclMark=true) {\r\n  noteframes = getNoteFrames(screen);\r\n\r\n  for (let frame of noteframes) {\r\n    try {\r\n      frame.addNote(msg, color, timeout, undefined, showExclMark);\r\n    } catch (error) {\r\n      print_stack(error);\r\n      console.log(error.stack, error.message);\r\n      console.log(\"bad notification frame\");\r\n    }\r\n  }\r\n}\r\n\r\nwindow._sendNote = sendNote;\r\n\r\nexport function error(screen, msg, timeout) {\r\n  return sendNote(screen, msg, ui_base.color2css([1.0, 0.0, 0.0, 1.0]), timeout);\r\n}\r\n\r\nexport function warning(screen, msg, timeout) {\r\n  return sendNote(screen, msg, ui_base.color2css([0.78, 0.78, 0.2, 1.0]), timeout);\r\n}\r\n\r\nexport function message(screen, msg, timeout) {\r\n  return sendNote(screen, msg, ui_base.color2css([0.2, 0.9, 0.1, 1.0]), timeout, false);\r\n}\r\n\r\n\r\nexport function progbarNote(screen, msg, percent, color, timeout) {\r\n  noteframes = getNoteFrames(screen);\r\n\r\n  for (let frame of noteframes) {\r\n    try {\r\n      frame.progbarNote(msg, percent, color, timeout);\r\n    } catch (error) {\r\n      print_stack(error);\r\n      console.log(error.stack, error.message);\r\n      console.log(\"bad notification frame\");\r\n    }\r\n  }\r\n}\r\n","import * as ui_base from '../core/ui_base.js'\r\nimport * as util from '../path-controller/util/util.js';\r\nimport {ColumnFrame, RowFrame, Container} from \"../core/ui.js\";\r\nlet UIBase = ui_base.UIBase, Icons = ui_base.Icons;\r\nimport {TextBoxBase} from './ui_textbox.js';\r\nimport {keymap} from \"../path-controller/util/simple_events.js\";\r\n\r\nexport class RichEditor extends TextBoxBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._internalDisabled = false;\r\n    this._value = \"\";\r\n\r\n    this.textOnlyMode = false;\r\n\r\n    this.styletag = document.createElement(\"style\");\r\n    this.styletag.textContent = `\r\n      div.rich-text-editor-x {\r\n        width        :   100%;\r\n        height       :   100%;\r\n        min-height   :   150px;\r\n        overflow     :   scroll;\r\n        padding      :   5px;\r\n        white-space  :   pre-wrap;\r\n      }\r\n      \r\n      rich-text-editor-x {\r\n        display        : flex;\r\n        flex-direction : column;\r\n      }\r\n    `;\r\n\r\n    this.shadow.appendChild(this.styletag);\r\n\r\n    let controls = this.controls = UIBase.createElement(\"rowframe-x\");\r\n\r\n\r\n    let makeicon = (icon, description, cb) => {\r\n      icon = controls.iconbutton(icon, description, cb);\r\n      icon.iconsheet = 1; //use second smallest icon size\r\n      icon.overrideDefault(\"padding\", 3);\r\n\r\n      return icon;\r\n    };\r\n\r\n    makeicon(Icons.BOLD, \"Bold\", () => {\r\n      document.execCommand(\"bold\");\r\n    });\r\n    makeicon(Icons.ITALIC, \"Italic\", () => {\r\n      document.execCommand(\"italic\");\r\n    });\r\n    makeicon(Icons.UNDERLINE, \"Underline\", () => {\r\n      document.execCommand(\"underline\");\r\n    });\r\n    makeicon(Icons.STRIKETHRU, \"Strikethrough\", () => {\r\n      document.execCommand(\"strikeThrough\");\r\n    });\r\n\r\n    controls.background = this.getDefault(\"background-color\");\r\n\r\n    this.shadow.appendChild(controls);\r\n\r\n    this.textarea = document.createElement(\"div\");\r\n    this.textarea.contentEditable = true;\r\n    this.textarea.setAttribute(\"class\", \"rich-text-editor-x\");\r\n\r\n    this.textarea.style[\"font\"] = this.getDefault(\"DefaultText\").genCSS();\r\n    this.textarea.style[\"background-color\"] = this.getDefault(\"background-color\");\r\n    this.textarea.setAttribute(\"white-space\", \"pre-wrap\");\r\n\r\n    this.textarea.addEventListener(\"keydown\", (e) => {\r\n      if (e.keyCode === keymap[\"S\"] && e.shiftKey && (e.ctrlKey || e.commandKey)) {\r\n        this.toggleStrikeThru();\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n    });\r\n\r\n    this.textarea.addEventListener(\"focus\", (e) => {\r\n      this._focus = 1;\r\n      this.setCSS();\r\n    });\r\n    this.textarea.addEventListener(\"blur\", (e) => {\r\n      this._focus = 0;\r\n      this.setCSS();\r\n    });\r\n\r\n    document.execCommand(\"styleWithCSS\", true);\r\n\r\n    window.ta = this;\r\n\r\n    this.textarea.addEventListener(\"selectionchange\", (e) => {\r\n      console.log(\"sel1\");\r\n    });\r\n\r\n    document.addEventListener(\"selectionchange\", (e, b) => {\r\n      console.log(\"sel2\", document.getSelection().startNode, b);\r\n    });\r\n\r\n    this.textarea.addEventListener(\"input\", (e) => {\r\n      if (this.internalDisabled) {\r\n        return;\r\n      }\r\n\r\n      console.log(\"text input\", e);\r\n\r\n      let text;\r\n\r\n      if (this.textOnlyMode) {\r\n        text = this.textarea.innerText;\r\n      } else {\r\n        text = this.textarea.innerHTML;\r\n      }\r\n\r\n      if (this.textOnlyMode && text === this._value) {\r\n        //formatting changed?\r\n        console.log(\"detected formatting change\");\r\n        return;\r\n      }\r\n\r\n      //console.log(\"text changed\", ...arguments);\r\n      let sel = document.getSelection();\r\n      let range = sel.getRangeAt(0);\r\n      //console.log(range.startOffset, range.endOffset, range.startContainer);\r\n\r\n      let node = sel.anchorNode;\r\n      let off = sel.anchorOffset;\r\n\r\n      this._value = text;\r\n\r\n      //sel.collapse(node, off);\r\n\r\n      if (this.hasAttribute(\"datapath\")) {\r\n        let path = this.getAttribute(\"datapath\");\r\n        this.setPathValue(this.ctx, path, this.value);\r\n      }\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this._value);\r\n      }\r\n      if (this.oninput) {\r\n        this.oninput(this._value);\r\n      }\r\n\r\n      this.dispatchEvent(new InputEvent(this));\r\n      this.dispatchEvent(new CustomEvent('change'));\r\n    });\r\n\r\n    this.shadow.appendChild(this.textarea);\r\n  }\r\n\r\n  /**\r\n   * Only available in textOnlyMode.  Called when starting text formatting\r\n  */\r\n  formatStart() {\r\n  }\r\n\r\n  /**\r\n  * Only available in textOnlyMode.  Formats html-formated line.\r\n   *\r\n   * @param line : line to format\r\n   * @parem text : whole text\r\n  * */\r\n  formatLine(line, text) {\r\n    return line;\r\n  }\r\n\r\n  toggleStrikeThru() {\r\n    console.log(\"strike thru!\");\r\n    document.execCommand(\"strikeThrough\");\r\n  }\r\n  /**\r\n   * Only available in textOnlyMode.  Called when starting text formatting\r\n   */\r\n  formatEnd() {\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    window.rc = this;\r\n\r\n    document.execCommand(\"defaultParagraphSeparator\", false, \"div\");\r\n\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  get internalDisabled() {\r\n    return this._internalDisabled;\r\n  }\r\n\r\n  set internalDisabled(val) {\r\n    let changed = !!this._internalDisabled !== !!val;\r\n\r\n    if (changed || 1) {\r\n      this._internalDisabled = !!val;\r\n      super.internalDisabled = val;\r\n\r\n      this.textarea.internalDisabled = val;\r\n      this.textarea.contentEditable = !val;\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  set value(val) {\r\n    this._value = val;\r\n\r\n    if (this.textOnlyMode) {\r\n      let val2 = \"\";\r\n      for (let l of val.split(\"\\n\")) {\r\n        val2 += l + \"<br>\";\r\n      }\r\n      val = val2;\r\n    }\r\n\r\n    this.textarea.innerHTML = val;\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.controls.background = this.getDefault(\"background-color\");\r\n\r\n    if (this._focus) {\r\n      this.textarea.style[\"border\"] = `2px dashed ${this.getDefault('focus-border-color')}`;\r\n    } else {\r\n      this.textarea.style[\"border\"] = \"none\";\r\n    }\r\n\r\n    if (this.style[\"font\"]) {\r\n      this.textarea.style[\"font\"] = this.style[\"font\"];\r\n    } else {\r\n      this.textarea.style[\"font\"] = this.getDefault(\"DefaultText\").genCSS();\r\n    }\r\n\r\n    if (this.style[\"color\"]) {\r\n      this.textarea.style[\"color\"] = this.style[\"color\"];\r\n    }  else {\r\n      this.textarea.style[\"color\"] = this.getDefault(\"DefaultText\").color;\r\n    }\r\n\r\n\r\n    if (this.disabled) {\r\n      this.textarea.style[\"background-color\"] = this.getDefault(\"DisabledBG\");\r\n    } else {\r\n      this.textarea.style[\"background-color\"] = this.getDefault(\"background-color\");\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n    let prop = this.getPathMeta(this.ctx, path);\r\n\r\n    if (prop === undefined) {\r\n      console.warn(\"invalid datapath \" + path);\r\n\r\n      this.internalDisabled = true;\r\n      return;\r\n    }\r\n\r\n    this.internalDisabled = false;\r\n    let value = this.getPathValue(this.ctx, path);\r\n\r\n    if (value !== this._value) {\r\n      console.log(\"text change\");\r\n      this.value = value;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateDataPath();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"rich-text-editor-x\",\r\n    style   : \"richtext\",\r\n    modalKeyEvents : true\r\n  }}\r\n}\r\nUIBase.internalRegister(RichEditor);\r\n\r\nexport class RichViewer extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.contents = document.createElement(\"div\");\r\n    this.contents.style[\"padding\"] = \"10px\";\r\n    this.contents.style[\"margin\"] = \"10px\";\r\n    this.contents.style[\"overflow\"] = \"scroll\";\r\n\r\n    this.shadow.appendChild(this.contents);\r\n    this._value = \"\";\r\n  }\r\n\r\n  hideScrollBars() {\r\n    this.contents.style[\"overflow\"] = \"hidden\"\r\n  }\r\n\r\n  showScrollBars() {\r\n    this.contents.style[\"overflow\"] = \"scroll\"\r\n  }\r\n\r\n  //transforms text into final html form\r\n  //note that client code is allowed to override this directly\r\n  textTransform(text) {\r\n    return text;\r\n  }\r\n  set value(val) {\r\n    this._value = val;\r\n\r\n    this.contents.innerHTML = this.textTransform(val);\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n    let prop = this.getPathMeta(this.ctx, path);\r\n\r\n    if (prop === undefined) {\r\n      console.warn(\"invalid datapath \" + path);\r\n\r\n      this.internalDisabled = true;\r\n      return;\r\n    }\r\n\r\n    this.internalDisabled = false;\r\n    let value = this.getPathValue(this.ctx, path);\r\n\r\n    if (value !== this.value) {\r\n      this.value = value;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateDataPath();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"html-viewer-x\",\r\n    style   : \"html_viewer\"\r\n  }}\r\n}\r\nUIBase.internalRegister(RichViewer);\r\n","\"use strict\";\r\nimport './ui_richedit.js';\r\n\r\nimport * as util from '../util/util.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport {Vector2, Vector3, Vector4, Quat, Matrix4} from '../path-controller/util/vectormath.js';\r\nimport {RowFrame, ColumnFrame} from \"../core/ui.js\";\r\nimport {isNumber, PropFlags} from \"../path-controller/toolsys/toolprop.js\";\r\n\r\nimport './ui_widgets.js';\r\n\r\nlet keymap = events.keymap;\r\n\r\nimport {EnumProperty, PropTypes} from '../path-controller/toolsys/toolprop.js';\r\nimport {UIBase, PackFlags, IconSheets, parsepx} from '../core/ui_base.js';\r\n\r\nimport * as units from '../core/units.js';\r\nimport {ToolProperty} from '../path-controller/toolsys/toolprop.js';\r\nimport {Button} from \"./ui_button.js\";\r\n\r\nexport class VectorPopupButton extends Button {\r\n  constructor() {\r\n    super();\r\n\r\n    this.value = new Vector4();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"vector-popup-button-x\",\r\n    style : \"vecPopupButton\"\r\n  }}\r\n\r\n  _onpress(e) {\r\n    if (e.button && e.button !== 0) {\r\n      return;\r\n    }\r\n\r\n    let panel = UIBase.createElement(\"vector-panel-x\");\r\n    let screen = this.ctx.screen;\r\n\r\n    let popup = screen.popup(this, this);\r\n\r\n    popup.add(panel);\r\n    popup.button(\"ok\", () => {\r\n      popup.end();\r\n    })\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      panel.setAttribute(\"datapath\", this.getAttribute(\"datapath\"));\r\n    }\r\n    if (this.hasAttribute(\"mass_set_path\")) {\r\n      panel.setAttribute(\"mass_set_path\", this.getAttribute(\"mass_set_path\"));\r\n    }\r\n\r\n    popup.flushUpdate();\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let value = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (!value) {\r\n      this.internalDisabled = true;\r\n      return;\r\n    }\r\n\r\n    if (this.internalDisabled) {\r\n      this.internalDisabled = false;\r\n    }\r\n\r\n    if (this.value.length !== value.length) {\r\n      switch (value.length) {\r\n        case 2:\r\n          this.value = new Vector2();\r\n          break;\r\n        case 3:\r\n          this.value = new Vector3();\r\n          break;\r\n        case 4:\r\n          this.value = new Vector4();\r\n          break;\r\n      }\r\n    }\r\n\r\n    if (this.value.vectorDistance(value) > 0.0001) {\r\n      this.value.load(value);\r\n      console.log(\"updated vector popup button value\");\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n    this.updateDataPath();\r\n  }\r\n\r\n}\r\nUIBase.internalRegister(VectorPopupButton);\r\n\r\nexport class VectorPanel extends ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this.range = [-1e17, 1e17];\r\n\r\n    this.name = \"\";\r\n\r\n    this.axes = \"XYZW\";\r\n    this.value = new Vector3();\r\n    this.sliders = [];\r\n    this.hasUniformSlider = false;\r\n\r\n    this.packflag |= PackFlags.FORCE_ROLLER_SLIDER;\r\n\r\n    let makeParam = (key) => {\r\n      Object.defineProperty(this, key, {\r\n        get : function() {\r\n          return this._getNumParam(key);\r\n        },\r\n\r\n        set : function(val) {\r\n          this._setNumParam(key, val);\r\n        }\r\n      });\r\n    };\r\n\r\n    this.__range = [-1e17, 1e17];\r\n    this._range = new Array(2);\r\n\r\n    Object.defineProperty(this._range, 0, {\r\n      get : () => this.__range[0],\r\n      set : (val) => this.__range[0] = val\r\n    });\r\n    Object.defineProperty(this._range, 1, {\r\n      get : () => this.__range[1],\r\n      set : (val) => this.__range[1] = val\r\n    });\r\n\r\n    makeParam(\"isInt\");\r\n    makeParam(\"radix\");\r\n    makeParam(\"decimalPlaces\");\r\n    makeParam(\"baseUnit\");\r\n    makeParam(\"displayUnit\");\r\n    makeParam(\"step\");\r\n    makeParam(\"slideSpeed\");\r\n    makeParam(\"expRate\");\r\n    makeParam(\"stepIsRelative\");\r\n\r\n    window.vp = this;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this.rebuild();\r\n    this.setCSS();\r\n\r\n    this.background = this.getDefault(\"InnerPanelBG\");\r\n  }\r\n\r\n  _getNumParam(key) {\r\n    return this[\"_\"+key];\r\n  }\r\n\r\n  _setNumParam(key, val) {\r\n    if (key === \"range\") {\r\n      this.__range[0] = val[0];\r\n      this.__range[1] = val[1];\r\n\r\n      return;\r\n    }\r\n\r\n    this[\"_\"+key] = val;\r\n\r\n    for (let slider of this.sliders) {\r\n      slider[key] = val;\r\n    }\r\n  }\r\n\r\n  rebuild() {\r\n    this.clear();\r\n\r\n    if (this.name) {\r\n      this.label(this.name);\r\n    }\r\n\r\n    let frame, row;\r\n\r\n    if (this.hasUniformSlider) {\r\n      row = this.row();\r\n      frame = row.col();\r\n    } else {\r\n      frame = this;\r\n    }\r\n\r\n    this.sliders = [];\r\n\r\n    for (let i=0; i<this.value.length; i++) {\r\n      let slider = frame.slider(undefined, {\r\n        name       : this.axes[i],\r\n        defaultval : this.value[i],\r\n        min        : this.range[0],\r\n        max        : this.range[1],\r\n        step       : this.step || 0.001,\r\n        is_int     : this.isInt,\r\n        packflag   : this.packflag\r\n      });\r\n\r\n      slider.addLabel = false;\r\n      slider.labelOnTop = false;\r\n\r\n      //let slider = frame.slider(undefined, this.axes[i], this.value[i], this.range[0], this.range[1], 0.001, this.isInt);\r\n      slider.axis = i;\r\n      let this2 = this;\r\n\r\n      slider.baseUnit = this.baseUnit;\r\n      slider.slideSpeed = this.slideSpeed;\r\n      slider.decimalPlaces = this.decimalPlaces;\r\n      slider.displayUnit = this.displayUnit;\r\n      slider.isInt = this.isInt;\r\n      slider.range = this.__range;\r\n      slider.radix = this.radix;\r\n      slider.step = this.step;\r\n      slider.expRate = this.expRate;\r\n      slider.stepIsRelative= this.stepIsRelative;\r\n\r\n      if (this.stepIsRelative) {\r\n        slider.step = ToolProperty.calcRelativeStep(this.step, this.value[i]);\r\n      }\r\n\r\n      slider.onchange = function(e) {\r\n        this2.value[this.axis] = this.value;\r\n\r\n        if (this2.hasAttribute(\"datapath\")) {\r\n          this2.setPathValue(this2.ctx, this2.getAttribute(\"datapath\"), this2.value);\r\n        }\r\n\r\n        if (this2.uslider) {\r\n          this2.uslider.setValue(this2.uniformValue, false);\r\n        }\r\n\r\n        if (this2.onchange) {\r\n          this2.onchange(this2.value);\r\n        }\r\n      }\r\n\r\n      this.sliders.push(slider);\r\n    }\r\n\r\n    if (this.hasUniformSlider) {\r\n      let uslider = this.uslider = UIBase.createElement(\"numslider-x\");\r\n      row._prepend(uslider);\r\n\r\n      uslider.range = this.range;\r\n      uslider.baseUnit = this.baseUnit;\r\n      uslider.slideSpeed = this.slideSpeed;\r\n      uslider.decimalPlaces = this.decimalPlaces;\r\n      uslider.displayUnit = this.displayUnit;\r\n      uslider.expRate = this.expRate;\r\n      uslider.step = this.step;\r\n      uslider.expRate = this.expRate;\r\n      uslider.isInt = this.isInt;\r\n      uslider.radix = this.radix;\r\n      uslider.decimalPlaces = this.decimalPlaces;\r\n      uslider.stepIsRelative= this.stepIsRelative;\r\n\r\n      uslider.vertical = true;\r\n      uslider.setValue(this.uniformValue, false);\r\n\r\n      this.sliders.push(uslider);\r\n\r\n      uslider.onchange = () => {\r\n        this.uniformValue = uslider.value;\r\n      }\r\n    } else {\r\n      this.uslider = undefined;\r\n    }\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  get uniformValue() {\r\n    let sum = 0.0;\r\n\r\n    for (let i=0; i<this.value.length; i++) {\r\n      sum += isNaN(this.value[i]) ? 0.0 : this.value[i];\r\n    }\r\n\r\n    return sum / this.value.length;\r\n  }\r\n\r\n  set uniformValue(val) {\r\n    let old = this.uniformValue;\r\n    let doupdate = false;\r\n\r\n    if (old === 0.0 || val === 0.0) {\r\n      doupdate = this.value.dot(this.value) !== 0.0\r\n\r\n      this.value.zero();\r\n    } else {\r\n      let ratio = val / old;\r\n      for (let i = 0; i < this.value.length; i++) {\r\n        this.value[i] *= ratio;\r\n      }\r\n\r\n      doupdate = true;\r\n    }\r\n\r\n    if (doupdate) {\r\n      if (this.hasAttribute(\"datapath\")) {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this.value);\r\n      }\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.value);\r\n      }\r\n\r\n      for (let i=0; i<this.value.length; i++) {\r\n        this.sliders[i].setValue(this.value[i], false);\r\n        this.sliders[i]._redraw();\r\n      }\r\n\r\n      if (this.uslider) {\r\n        this.uslider.setValue(val, false);\r\n        this.uslider._redraw();\r\n      }\r\n    }\r\n  }\r\n\r\n  setValue(value) {\r\n    if (!value) {\r\n      return;\r\n    }\r\n\r\n    if (value.length !== this.value.length) {\r\n      switch (value.length) {\r\n        case 2:\r\n          this.value = new Vector2(value);\r\n          break;\r\n        case 3:\r\n          this.value = new Vector3(value);\r\n          break;\r\n        case 4:\r\n          this.value = new Vector4(value);\r\n          break;\r\n        default:\r\n          throw new Error(\"invalid vector size \" + value.length);\r\n      }\r\n\r\n      this.rebuild();\r\n    } else {\r\n      this.value.load(value);\r\n    }\r\n\r\n    if (this.onchange) {\r\n      this.onchange(this.value);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n\r\n    let val = this.getPathValue(this.ctx, path);\r\n    if (val === undefined) {\r\n      this.internalDisabled = true;\r\n      return;\r\n    }\r\n\r\n\r\n    let meta = this.getPathMeta(this.ctx, path);\r\n    let name = meta.uiname !== undefined ? meta.uiname : meta.name;\r\n    if (this.hasAttribute(\"name\")) {\r\n      name = this.getAttribute(\"name\");\r\n    }\r\n\r\n    if (name && name !== this.name) {\r\n      this.name = name;\r\n      this.rebuild();\r\n      return;\r\n    }\r\n\r\n    let loadNumParam = (k, do_rebuild=false) => {\r\n      if (meta && meta[k] !== undefined && this[k] === undefined) {\r\n        this[k] = meta[k];\r\n\r\n        if (this[k] !== meta[k] && do_rebuild) {\r\n          this.doOnce(this.rebuild);\r\n        }\r\n      }\r\n    }\r\n\r\n\r\n    loadNumParam(\"decimalPlaces\");\r\n    loadNumParam(\"baseUnit\");\r\n    loadNumParam(\"slideSpeed\");\r\n    loadNumParam(\"displayUnit\");\r\n    loadNumParam(\"decimalPlaces\");\r\n    loadNumParam(\"isInt\");\r\n    loadNumParam(\"radix\");\r\n    loadNumParam(\"step\");\r\n    loadNumParam(\"expRate\");\r\n    loadNumParam(\"stepIsRelative\");\r\n\r\n    if (meta && meta.hasUniformSlider !== undefined && meta.hasUniformSlider !== this.hasUniformSlider) {\r\n      this.hasUniformSlider = meta.hasUniformSlider;\r\n      this.doOnce(this.rebuild);\r\n    }\r\n\r\n    if (meta && meta.range) {\r\n      let update = this.range[0] !== meta.range[0];\r\n      update= update || this.range[1] !== meta.range[1];\r\n\r\n      this.range[0] = meta.range[0];\r\n      this.range[1] = meta.range[1];\r\n\r\n      if (update) {\r\n        this.doOnce(this.rebuild);\r\n      }\r\n    }\r\n\r\n    this.internalDisabled = false;\r\n\r\n    let length = val.length;\r\n\r\n    if (meta && (meta.flag & PropFlags.USE_CUSTOM_GETSET)) {\r\n      let rdef = this.ctx.api.resolvePath(this.ctx, path);\r\n\r\n      meta.ctx = this.ctx;\r\n      meta.dataref = rdef.obj;\r\n      meta.datapath = path;\r\n\r\n      length = meta.getValue().length;\r\n\r\n      meta.dataref = undefined;\r\n    }\r\n\r\n    if (this.value.length !== length) {\r\n      switch (length) {\r\n        case 2:\r\n          val = new Vector2(val);\r\n          break;\r\n        case 3:\r\n          val = new Vector3(val);\r\n          break;\r\n        case 4:\r\n          val = new Vector4(val);\r\n          break;\r\n        default:\r\n          val = meta.getValue().copy().load(val);\r\n          break;\r\n      }\r\n\r\n      this.value = val;\r\n      this.rebuild();\r\n\r\n      for (let i=0; i<this.value.length; i++) {\r\n        this.sliders[i].setValue(val[i], false);\r\n        this.sliders[i]._redraw();\r\n      }\r\n    } else {\r\n      if (this.value.vectorDistance(val) > 0) {\r\n        this.value.load(val);\r\n\r\n        if (this.uslider) {\r\n          this.uslider.setValue(this.uniformValue, false);\r\n        }\r\n\r\n        for (let i=0; i<this.value.length; i++) {\r\n          this.sliders[i].setValue(val[i], false);\r\n          this.sliders[i]._redraw();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateDataPath();\r\n\r\n    if (this.stepIsRelative) {\r\n      for (let slider of this.sliders) {\r\n        slider.step = ToolProperty.calcRelativeStep(this.step, slider.value);\r\n      }\r\n    }\r\n\r\n    if (this.uslider) {\r\n      this.uslider.step = this.step;\r\n      if (this.stepIsRelative) {\r\n        this.uslider.step = ToolProperty.calcRelativeStep(this.step, this.uniformValue);\r\n      }\r\n\r\n    }\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"vector-panel-x\"\r\n  }}\r\n}\r\nUIBase.internalRegister(VectorPanel);\r\n\r\n\r\nexport class ToolTip extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.visibleToPick = false;\r\n    this.div = document.createElement(\"div\");\r\n\r\n    this.shadow.appendChild(this.div);\r\n    this._start_time = undefined;\r\n    this.timeout = undefined;\r\n  }\r\n\r\n  static show(message, screen, x, y) {\r\n    let ret = UIBase.createElement(this.define().tagname);\r\n\r\n    ret._start_time = util.time_ms();\r\n    ret.timeout = ret.getDefault(\"timeout\");\r\n\r\n    ret.text = message;\r\n    let size = ret._estimateSize();\r\n\r\n    let pad = 5;\r\n    size = [size[0] + pad, size[1] + pad];\r\n\r\n    console.log(size);\r\n    x = Math.min(Math.max(x, 0), screen.size[0] - size[0]);\r\n    y = Math.min(Math.max(y, 0), screen.size[1] - size[1]);\r\n\r\n    let dpi = UIBase.getDPI();\r\n\r\n    x += 10/dpi;\r\n    y += 15/dpi;\r\n\r\n    ret._popup = screen.popup(ret, x, y);\r\n    ret._popup.background = \"rgba(0,0,0,0)\";\r\n    ret._popup.style[\"border\"] = \"none\";\r\n    ret.div.style[\"padding\"] = \"15px\";\r\n\r\n    ret._popup.add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  end() {\r\n    this._popup.end();\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this.setCSS();\r\n  }\r\n\r\n  set text(val) {\r\n    this.div.innerHTML = val.replace(/[\\n]/g, \"<br>\\n\");\r\n  }\r\n\r\n  get text() {\r\n    return this.div.innerHTML;\r\n  }\r\n\r\n  _estimateSize() {\r\n    let text = this.div.textContent;\r\n    let block = ui_base.measureTextBlock(this, text, undefined, undefined, undefined, this.getDefault(\"ToolTipText\"));\r\n\r\n    return [block.width+50, block.height+30];\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    if (util.time_ms() - this._start_time > this.timeout) {\r\n      this.end();\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    let color = this.getDefault(\"background-color\");\r\n    let bcolor = this.getDefault(\"border-color\");\r\n\r\n    this.background = color;\r\n\r\n    let radius = this.getDefault(\"border-radius\", undefined, 5);\r\n    let bstyle = this.getDefault(\"border-style\", undefined, \"solid\");\r\n    let bwidth = this.getDefault(\"border-width\", undefined, 1);\r\n    let padding = this.getDefault(\"padding\", undefined, 15);\r\n\r\n    this.noMarginsOrPadding();\r\n\r\n    this.div.style[\"padding\"] = padding + \"px\";\r\n\r\n    this.div.style[\"background-color\"] = \"rgba(0,0,0,0)\";\r\n    this.div.style[\"border\"] = `${bwidth}px ${bstyle} ${bcolor}`;\r\n    this.div.style[\"border-radius\"] = radius + \"px\";\r\n    this.style[\"border-radius\"] = radius + \"px\";\r\n\r\n    let font = this.getDefault(\"ToolTipText\");\r\n    this.div.style[\"color\"] = font.color;\r\n    this.div.style[\"font\"] = font.genCSS();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"tool-tip-x\",\r\n    style   : \"tooltip\"\r\n  }}\r\n};\r\nUIBase.internalRegister(ToolTip);\r\n\r\nwindow._ToolTip = ToolTip;\r\n","\"use strict\";\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as simple_toolsys from '../path-controller/toolsys/toolsys.js';\r\nimport {ToolTip} from \"../widgets/ui_widgets2.js\";\r\n\r\n/*\r\nwhy am I using a toolstack here at all?  time to remove!\r\n*/\r\n\r\nlet toolstack_getter = function () {\r\n  throw new Error(\"must pass a toolstack getter to registerToolStackGetter\")\r\n}\r\n\r\nexport function registerToolStackGetter(func) {\r\n  toolstack_getter = func;\r\n}\r\n\r\nlet Vector2   = vectormath.Vector2,\r\n    Vector3   = vectormath.Vector3,\r\n    UndoFlags = simple_toolsys.UndoFlags,\r\n    ToolFlags = simple_toolsys.ToolFlags;\r\n\r\nimport {pushModalLight, popModalLight, keymap, pushPointerModal} from \"../util/simple_events.js\";\r\n\r\n//import {keymap} from './events';\r\n\r\nexport class ToolBase extends simple_toolsys.ToolOp {\r\n  constructor(screen) {\r\n    super();\r\n    this.screen = screen;\r\n    //super();\r\n\r\n    this._finished = false;\r\n  }\r\n\r\n  start(elem, pointerId) {\r\n    //toolstack_getter().execTool(this);\r\n    this.modalStart(undefined, elem, pointerId);\r\n  }\r\n\r\n  cancel() {\r\n    this.finish();\r\n  }\r\n\r\n  finish() {\r\n    this._finished = true;\r\n    this.popModal(this.screen);\r\n  }\r\n\r\n  popModal() {\r\n    this.overdraw.end();\r\n    popModalLight(this.modaldata);\r\n    this.modaldata = undefined;\r\n  }\r\n\r\n  modalStart(ctx, elem, pointerId) {\r\n    this.ctx = ctx;\r\n\r\n    if (this.modaldata !== undefined) {\r\n      console.log(\"Error, modaldata was not undefined\");\r\n      popModalLight(this.modaldata);\r\n    }\r\n\r\n    this.overdraw = ui_base.UIBase.createElement(\"overdraw-x\");\r\n    this.overdraw.start(this.screen);\r\n\r\n    let handlers = {};\r\n    let keys = Object.getOwnPropertyNames(this);\r\n    for (let k in this.__proto__) {\r\n      keys.push(k);\r\n    }\r\n    for (let k of Object.getOwnPropertyNames(this.__proto__)) {\r\n      keys.push(k);\r\n    }\r\n\r\n    for (let k in this) {\r\n      keys.push(k);\r\n    }\r\n\r\n    for (let k of keys) {\r\n      if (k.startsWith(\"on\")) {\r\n        handlers[k] = this[k].bind(this);\r\n      }\r\n    }\r\n\r\n    //window.setTimeout(() => {\r\n    if (pointerId !== undefined) {\r\n      handlers.on_pointerdown = handlers.on_pointerdown ?? handlers.on_mousedown;\r\n      handlers.on_pointermove = handlers.on_pointermove ?? handlers.on_mousemove;\r\n      handlers.on_pointerup = handlers.on_pointerup ?? handlers.on_mouseup;\r\n      handlers.on_pointercancel = handlers.on_pointercancel ?? handlers.on_pointerup ?? handlers.on_mouseup;\r\n\r\n      this.modaldata = pushPointerModal(handlers, elem, pointerId);\r\n    } else {\r\n      this.modaldata = pushModalLight(handlers);\r\n    }\r\n    //console.log(\"HANDLERS\", this.modaldata.handlers);\r\n\r\n    //}, 100);\r\n\r\n    //window.addEventListener(\"touchmove\", (e) => {\r\n    //  console.log(\"touchmove\");\r\n    //}, {passive : false});\r\n  }\r\n\r\n  on_pointermove(e) {\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    this.finish();\r\n  }\r\n\r\n  on_keydown(e) {\r\n    console.log(\"s\", e.keyCode);\r\n\r\n    switch (e.keyCode) {\r\n      case keymap.Escape: //esc\r\n        this.cancel();\r\n        break;\r\n      case keymap.Space: //space\r\n      case keymap.Enter: //return\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\nexport class AreaResizeTool extends ToolBase {\r\n  constructor(screen, border, mpos) {\r\n    if (screen === undefined) screen = _appstate.screen; //XXX hackish!\r\n\r\n    super(screen);\r\n\r\n    this.start_mpos = new Vector2(mpos);\r\n\r\n    this.sarea = border.sareas[0];\r\n    if (!this.sarea || border.dead) {\r\n      console.log(border.dead, border);\r\n      throw new Error(\"border corruption\");\r\n    }\r\n\r\n    this.screen = screen;\r\n\r\n    this.side = this.sarea._side(border);\r\n  }\r\n\r\n  get border() {\r\n    return this.sarea._borders[this.side];\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Resize Area\",\r\n      toolpath   : \"screen.area.resize\",\r\n      icon       : ui_base.Icons.RESIZE,\r\n      description: \"change size of area\",\r\n      is_modal   : true,\r\n      undoflag   : UndoFlags.NO_UNDO,\r\n      flag       : 0,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n\r\n  getBorders() {\r\n    let horiz = this.border.horiz;\r\n\r\n    let ret = [];\r\n    let visit = new Set();\r\n\r\n    let rec = (v) => {\r\n      if (visit.has(v._id)) {\r\n        return;\r\n      }\r\n\r\n      visit.add(v._id);\r\n\r\n      for (let border of v.borders) {\r\n        if (border.horiz == horiz && !visit.has(border._id)) {\r\n          visit.add(border._id);\r\n          ret.push(border);\r\n\r\n          rec(border.otherVertex(v));\r\n        }\r\n      }\r\n    }\r\n\r\n    rec(this.border.v1);\r\n    rec(this.border.v2);\r\n\r\n    return ret;\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    this.finish();\r\n  }\r\n\r\n  finish() {\r\n    super.finish();\r\n\r\n    this.screen.snapScreenVerts();\r\n    this.screen.regenBorders();\r\n    this.screen.snapScreenVerts();\r\n    this.screen.loadFromVerts();\r\n  }\r\n\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case keymap[\"Escape\"]:\r\n      case keymap[\"Enter\"]:\r\n      case keymap[\"Space\"]:\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let mpos = new Vector2([e.x, e.y]);\r\n\r\n    mpos.sub(this.start_mpos);\r\n\r\n    let axis = this.border.horiz ? 1 : 0;\r\n\r\n    //console.log(this.border.horiz);\r\n\r\n    this.overdraw.clear();\r\n\r\n    let visit = new Set();\r\n    let borders = this.getBorders();\r\n\r\n    let color = cconst.DEBUG.screenborders ? \"rgba(1.0, 0.5, 0.0, 0.1)\" : \"rgba(1.0, 0.5, 0.0, 1.0)\";\r\n\r\n    let bad = false;\r\n\r\n    for (let border of borders) {\r\n      bad = bad || !this.screen.isBorderMovable(border);\r\n\r\n      border.oldv1 = new Vector2(border.v1);\r\n      border.oldv2 = new Vector2(border.v2);\r\n    }\r\n\r\n    if (bad) {\r\n      console.log(\"border is not movable\");\r\n      return;\r\n    }\r\n\r\n    let check = () => {\r\n      let count = 0;\r\n\r\n      for (let sarea of this.screen.sareas) {\r\n        if (sarea.size[0] < 15 || sarea.size[1] < 15) {\r\n          count++;\r\n        }\r\n      }\r\n\r\n      return count;\r\n    };\r\n\r\n    let badcount = check();\r\n\r\n\r\n    let snapMode = true;\r\n\r\n    let df = mpos[axis];\r\n    let border = this.border;\r\n\r\n    this.screen.moveBorder(border, df, false);\r\n\r\n    for (let border of borders) {\r\n      //if false, stead of forcing areas to fit within screen bounds\r\n      //in snapScreenVerts the screen bounds will be modified instead.\r\n\r\n      if (border.outer) {\r\n        snapMode = false;\r\n      }\r\n\r\n      this.overdraw.line(border.v1, border.v2, color);\r\n    }\r\n\r\n    this.start_mpos[0] = e.x;\r\n    this.start_mpos[1] = e.y;\r\n    this.screen.loadFromVerts();\r\n    this.screen.setCSS();\r\n\r\n    if (check() != badcount) {\r\n      console.log(\"bad\");\r\n\r\n      for (let border of borders) {\r\n        border.v1.load(border.oldv1);\r\n        border.v2.load(border.oldv2);\r\n      }\r\n    }\r\n\r\n\r\n    this.screen.snapScreenVerts(snapMode);\r\n    this.screen.loadFromVerts();\r\n    this.screen.solveAreaConstraints(snapMode);\r\n    this.screen.setCSS();\r\n    this.screen.updateDebugBoxes();\r\n    this.screen._fireResizeCB();\r\n  }\r\n}\r\n\r\n//controller.registerTool(AreaResizeTool);\r\n\r\nexport class SplitTool extends ToolBase {\r\n  constructor(screen) {\r\n    if (screen === undefined) screen = _appstate.screen; //XXX hackish!\r\n\r\n    super(screen);\r\n\r\n    this.done = false;\r\n    this.screen = screen;\r\n    this.ctx = screen.ctx;\r\n    this.sarea = undefined;\r\n    this.t = undefined;\r\n\r\n    this.started = false;\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Split Area\",\r\n      toolpath   : \"screen.area.split\",\r\n      icon       : ui_base.Icons.SMALL_PLUS,\r\n      description: \"split an area in two\",\r\n      is_modal   : true,\r\n      undoflag   : UndoFlags.NO_UNDO,\r\n      flag       : 0,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n\r\n  modalStart(ctx) {\r\n    if (this.started) {\r\n      console.trace(\"double call to modalStart()\");\r\n      return;\r\n    }\r\n\r\n    this.overdraw = ui_base.UIBase.createElement(\"overdraw-x\");\r\n    this.overdraw.start(this.screen);\r\n\r\n    super.modalStart(ctx);\r\n  }\r\n\r\n  cancel() {\r\n    return this.finish(true);\r\n  }\r\n\r\n  finish(canceled = false) {\r\n    if (this.done) {\r\n      return;\r\n    }\r\n\r\n    this.done = true;\r\n    this.overdraw.end();\r\n\r\n    this.popModal(this.screen);\r\n\r\n    if (canceled || !this.sarea) {\r\n      return;\r\n    }\r\n\r\n    let sarea = this.sarea, screen = this.screen;\r\n    let t = this.t;\r\n\r\n    screen.splitArea(sarea, t, this.horiz);\r\n    screen._internalRegenAll();\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let x = e.x, y = e.y;\r\n\r\n    let screen = this.screen;\r\n\r\n    let sarea = screen.findScreenArea(x, y);\r\n\r\n    this.overdraw.clear();\r\n\r\n    if (sarea !== undefined) {\r\n      //x -= sarea.pos[0];\r\n      //y -= sarea.pos[1];\r\n      x = (x - sarea.pos[0])/(sarea.size[0]);\r\n      y = (y - sarea.pos[1])/(sarea.size[1]);\r\n\r\n      let dx = 1.0 - Math.abs(x - 0.5);\r\n      let dy = 1.0 - Math.abs(y - 0.5);\r\n\r\n      this.sarea = sarea;\r\n      let horiz = this.horiz = dx < dy;\r\n\r\n      if (horiz) {\r\n        this.t = y;\r\n        this.overdraw.line([sarea.pos[0], e.y], [sarea.pos[0] + sarea.size[0], e.y]);\r\n      } else {\r\n        this.t = x;\r\n        this.overdraw.line([e.x, sarea.pos[1]], [e.x, sarea.pos[1] + sarea.size[1]]);\r\n      }\r\n    }\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    this.finish();\r\n\r\n    if (e.button) {\r\n      this.stopPropagation();\r\n      this.preventDefault();\r\n    }\r\n  }\r\n\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case keymap.Escape: //esc\r\n        this.cancel();\r\n        break;\r\n      case keymap.Space: //space\r\n      case keymap.Enter: //return\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\n\r\nexport class RemoveAreaTool extends ToolBase {\r\n  constructor(screen, border) {\r\n    if (screen === undefined) screen = _appstate.screen; //XXX hackish!\r\n\r\n    super(screen);\r\n\r\n    this.border = border;\r\n\r\n    this.done = false;\r\n    this.screen = screen;\r\n    this.ctx = screen.ctx;\r\n    this.sarea = undefined;\r\n    this.t = undefined;\r\n\r\n    this.started = false;\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Remove Area\",\r\n      toolpath   : \"screen.area.pick_remove\",\r\n      icon       : ui_base.Icons.SMALL_PLUS,\r\n      description: \"Collapse a window\",\r\n      is_modal   : true,\r\n      undoflag   : UndoFlags.NO_UNDO,\r\n      flag       : 0,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n\r\n  modalStart(ctx) {\r\n    if (this.started) {\r\n      console.trace(\"double call to modalStart()\");\r\n      return;\r\n    }\r\n\r\n    this.overdraw = ui_base.UIBase.createElement(\"overdraw-x\");\r\n    this.overdraw.start(this.screen);\r\n\r\n    super.modalStart(ctx);\r\n  }\r\n\r\n  cancel() {\r\n    return this.finish(true);\r\n  }\r\n\r\n  finish(canceled = false) {\r\n    if (this.done) {\r\n      return;\r\n    }\r\n\r\n    this.done = true;\r\n    this.overdraw.end();\r\n\r\n    this.popModal(this.screen);\r\n\r\n    if (canceled || !this.sarea) {\r\n      return;\r\n    }\r\n\r\n    let sarea = this.sarea, screen = this.screen;\r\n    let t = this.t;\r\n\r\n    if (sarea) {\r\n      screen.collapseArea(sarea, this.border);\r\n      screen._internalRegenAll();\r\n    }\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let x = e.x, y = e.y;\r\n\r\n    let screen = this.screen;\r\n\r\n    let sarea = screen.findScreenArea(x, y);\r\n\r\n    this.overdraw.clear();\r\n\r\n    if (sarea !== undefined) {\r\n      this.sarea = sarea;\r\n      this.overdraw.rect(sarea.pos, sarea.size, \"rgba(0,0,0,0.1)\");\r\n    }\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    this.finish();\r\n\r\n    if (e.button) {\r\n      this.stopPropagation();\r\n      this.preventDefault();\r\n    }\r\n  }\r\n\r\n  on_keydown(e) {\r\n    console.log(\"s\", e.keyCode);\r\n\r\n    switch (e.keyCode) {\r\n      case keymap.Escape: //esc\r\n        this.cancel();\r\n        break;\r\n      case keymap.Space: //space\r\n      case keymap.Enter: //return\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\n//controller.registerTool(SplitTool);\r\n\r\n\r\nexport class AreaDragTool extends ToolBase {\r\n  constructor(screen, sarea, mpos) {\r\n    if (screen === undefined) screen = _appstate.screen; //XXX hackish!\r\n\r\n    super(screen);\r\n\r\n    this.dropArea = false;\r\n    this.excludeAreas = new Set();\r\n    this.cursorbox = undefined;\r\n    this.boxes = [];\r\n    this.boxes.active = undefined;\r\n\r\n    this.sarea = sarea;\r\n    this.start_mpos = new Vector2(mpos);\r\n    this.screen = screen;\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Drag Area\",\r\n      toolpath   : \"screen.area.drag\",\r\n      icon       : ui_base.Icons.TRANSLATE,\r\n      description: \"move or duplicate area\",\r\n      is_modal   : true,\r\n      undoflag   : UndoFlags.NO_UNDO,\r\n      flag       : 0,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n\r\n  finish() {\r\n    super.finish();\r\n\r\n    this.screen.regenBorders();\r\n    this.screen.solveAreaConstraints();\r\n    this.screen.snapScreenVerts();\r\n    this.screen._recalcAABB();\r\n  }\r\n\r\n  getBoxRect(b) {\r\n    let sa = b.sarea;\r\n    let pos, size;\r\n\r\n    if (b.horiz == -1) {\r\n      //replacement mode\r\n      pos = sa.pos;\r\n      size = sa.size;\r\n    } else if (b.horiz) {\r\n      if (b.side == 'b') {\r\n        pos = [sa.pos[0], sa.pos[1] + sa.size[1]*b.t]\r\n        size = [sa.size[0], sa.size[1]*(1.0 - b.t)]\r\n      } else {\r\n        pos = [sa.pos[0], sa.pos[1]];\r\n        size = [sa.size[0], sa.size[1]*b.t]\r\n      }\r\n    } else {\r\n      if (b.side == 'r') {\r\n        pos = [sa.pos[0] + sa.size[0]*b.t, sa.pos[1]]\r\n        size = [sa.size[0]*(1.0 - b.t), sa.size[1]]\r\n      } else {\r\n        pos = [sa.pos[0], sa.pos[1]];\r\n        size = [sa.size[0]*b.t, sa.size[1]]\r\n      }\r\n    }\r\n\r\n    let color = \"rgba(100, 100, 100, 0.2)\";\r\n\r\n    let ret = this.overdraw.rect(pos, size, color);\r\n    ret.style[\"pointer-events\"] = \"none\";\r\n\r\n    return ret;\r\n  }\r\n\r\n  doSplit(b) {\r\n    if (this.sarea) {\r\n      return this.doSplitDrop(b);\r\n    }\r\n\r\n    let src = this.sarea, dst = b.sarea;\r\n    let screen = this.screen;\r\n\r\n    let t = b.t;\r\n\r\n    screen.splitArea(dst, t, b.horiz);\r\n\r\n    screen._internalRegenAll();\r\n  }\r\n\r\n  doSplitDrop(b) {\r\n    //first check if there was no change\r\n    if (b.horiz === -1 && b.sarea === this.sarea) {\r\n      return;\r\n    }\r\n\r\n    let can_rip = false;\r\n    let sa = this.sarea;\r\n    let screen = this.screen;\r\n\r\n    //rip conditions\r\n    can_rip = sa.size[0] === screen.size[0] || sa.size[1] === screen.size[1];\r\n    can_rip = can_rip || this.sarea.floating;\r\n    can_rip = can_rip && b.sarea !== sa;\r\n    can_rip = can_rip && (b.horiz === -1 || !screen.areasBorder(sa, b.sarea));\r\n\r\n    let expand = b.horiz === -1 && b.sarea !== sa && screen.areasBorder(b.sarea, sa);\r\n\r\n    can_rip = can_rip || expand;\r\n\r\n    console.log(\"can_rip:\", can_rip, expand);\r\n\r\n    if (can_rip) {\r\n      screen.removeArea(sa);\r\n      screen.snapScreenVerts();\r\n    }\r\n\r\n    if (b.horiz === -1) {\r\n      //replacement\r\n      let src = this.sarea, dst = b.sarea;\r\n\r\n      if (can_rip && src !== dst) {\r\n        let mm;\r\n\r\n        //handle case of one area \"consuming\" another\r\n        if (expand) {\r\n          mm = screen.minmaxArea(src);\r\n          screen.minmaxArea(dst, mm);\r\n        }\r\n\r\n        console.log(\"replacing. . .\", expand);\r\n\r\n        if (src.floating) {\r\n          let old = dst.editors;\r\n\r\n          dst.editors = [];\r\n          dst.editormap = {};\r\n\r\n          if (dst.area && !(dst.area.constructor.define().areaname in src.editormap)) {\r\n            dst.area.push_ctx_active();\r\n            dst.area.on_area_inactive();\r\n            dst.area.remove();\r\n            dst.area.pop_ctx_active();\r\n          }\r\n\r\n          for (let editor of old) {\r\n            let def = editor.constructor.define();\r\n\r\n            let bad = false;\r\n            //bad = !(def.areaname in src.editormap);\r\n\r\n            for (let editor2 of src.editors) {\r\n              if (editor.constructor === editor2.constructor) {\r\n                bad = true;\r\n                break;\r\n              }\r\n            }\r\n\r\n            if (!bad) {\r\n              dst.editors.push(editor);\r\n              dst.editormap[def.areaname] = editor;\r\n            }\r\n          }\r\n\r\n          for (let editor of src.editors) {\r\n            let def = editor.constructor.define();\r\n\r\n            dst.editormap[def.areaname] = editor;\r\n            dst.editors.push(editor);\r\n\r\n            if (editor.owning_sarea) {\r\n              editor.owning_sarea = dst;\r\n            }\r\n\r\n            if (editor.parentWidget) {\r\n              editor.parentWidget = dst;\r\n            }\r\n          }\r\n\r\n          if (cconst.useAreaTabSwitcher) {\r\n            for (let editor of dst.editors) {\r\n              if (editor.switcher) {\r\n                editor.switcher.flagUpdate();\r\n              }\r\n            }\r\n          }\r\n\r\n          dst.area = src.area;\r\n          dst.shadow.appendChild(src.area);\r\n\r\n          src.area = undefined;\r\n          src.editors = [];\r\n          src.editormap = {};\r\n\r\n          dst.on_resize(dst.size, dst.size);\r\n\r\n          dst.flushSetCSS();\r\n          dst.flushUpdate();\r\n\r\n          screen.removeArea(src);\r\n          screen.snapScreenVerts();\r\n\r\n          return;\r\n        } else {\r\n          screen.replaceArea(dst, src);\r\n        }\r\n\r\n        if (expand) {\r\n          console.log(\"\\nEXPANDING:\", src.size[0], src.size[1]);\r\n\r\n          src.pos[0] = mm.min[0];\r\n          src.pos[1] = mm.min[1];\r\n\r\n          src.size[0] = mm.max[0] - mm.min[0];\r\n          src.size[1] = mm.max[1] - mm.min[1];\r\n\r\n          src.loadFromPosSize();\r\n\r\n          screen._internalRegenAll();\r\n        }\r\n      } else {\r\n        //console.log(\"copying. . .\");\r\n        screen.replaceArea(dst, src.copy());\r\n        screen._internalRegenAll();\r\n      }\r\n    } else {\r\n      let src = this.sarea, dst = b.sarea;\r\n\r\n      let t = b.t;\r\n\r\n      let nsa = screen.splitArea(dst, t, b.horiz);\r\n\r\n      if (b.side === 'l' || b.side === 't') {\r\n        nsa = dst;\r\n      }\r\n\r\n      if (can_rip) {\r\n        //console.log(\"replacing\");\r\n        screen.replaceArea(nsa, src);\r\n      } else {\r\n        //console.log(\"copying\");\r\n        screen.replaceArea(nsa, src.copy());\r\n      }\r\n\r\n      screen._internalRegenAll();\r\n    }\r\n  }\r\n\r\n  makeBoxes(sa) {\r\n    let sz = util.isMobile() ? 100 : 40;\r\n    let cx = sa.pos[0] + sa.size[0]*0.5;\r\n    let cy = sa.pos[1] + sa.size[1]*0.5;\r\n\r\n    let color = this.color = \"rgba(200, 200, 200, 0.55)\";\r\n    let hcolor = this.hcolor = \"rgba(230, 230, 230, 0.75)\";\r\n    let idgen = 0;\r\n    let boxes = this.boxes;\r\n\r\n    let box = (x, y, sz, horiz, t, side) => {\r\n      //console.log(x, y, sz);\r\n\r\n      let b = this.overdraw.rect([x - sz[0]*0.5, y - sz[1]*0.5], sz, color);\r\n      b.style[\"border-radius\"] = \"14px\";\r\n\r\n      boxes.push(b);\r\n\r\n      b.sarea = sa;\r\n\r\n      let style = document.createElement(\"style\")\r\n      let cls = `mybox_${idgen++}`;\r\n\r\n      b.horiz = horiz;\r\n      b.t = t;\r\n      b.side = side;\r\n      b.setAttribute(\"class\", cls);\r\n      b.setAttribute(\"is_box\", true);\r\n\r\n      b.addEventListener(\"pointermove\", this.on_pointermove.bind(this));\r\n\r\n      let onclick = b.onclick = (e) => {\r\n        let type = e.type.toLowerCase();\r\n\r\n        if ((e.type === \"pointerdown\" || e.type === \"pointerup\") && e.button !== 0) {\r\n          return; //another handler will cancel\r\n        }\r\n\r\n        console.log(\"split click\");\r\n\r\n        if (!this._finished) {\r\n          this.finish();\r\n          this.doSplit(b);\r\n\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n        }\r\n      }\r\n\r\n      b.addEventListener(\"click\", onclick);\r\n      b.addEventListener(\"pointerdown\", onclick);\r\n      b.addEventListener(\"pointerup\", onclick);\r\n\r\n      b.addEventListener(\"pointerenter\", (e) => {\r\n        if (this.curbox !== undefined) {\r\n          if (this.curbox.rect) {\r\n            this.curbox.rect.remove()\r\n            this.curbox.rect = undefined;\r\n          }\r\n        }\r\n\r\n        if (b.rect !== undefined) {\r\n          b.rect.remove();\r\n          b.rect = undefined;\r\n        }\r\n\r\n        b.rect = this.getBoxRect(b);\r\n        this.curbox = b;\r\n\r\n        b.setColor(hcolor);\r\n        //b.style[\"background-color\"] = hcolor;\r\n      })\r\n\r\n      b.addEventListener(\"pointerleave\", (e) => {\r\n        if (b.rect) {\r\n          b.rect.remove();\r\n          b.rect = undefined;\r\n        }\r\n\r\n        if (this.curbox === b) {\r\n          this.curbox = undefined;\r\n        }\r\n\r\n        b.setColor(color);\r\n        //b.style[\"background-color\"] = color;\r\n      })\r\n\r\n      style.textContent = `\r\n        .${cls}:hover {\r\n          background-color : orange;\r\n          fill:orange;stroke-width:2\r\n        }\r\n      `\r\n      //console.log(style.textContent);\r\n      b.appendChild(style);\r\n      b.setAttribute(\"class\", cls);\r\n\r\n      return b;\r\n    }\r\n\r\n    let pad = 5;\r\n\r\n    if (this.sarea) {\r\n      box(cx, cy, [sz, sz], -1, -1, -1);\r\n    }\r\n\r\n    box(cx - sz*0.75 - pad, cy, [sz*0.5, sz], false, 0.5, 'l');\r\n    box(cx - sz*1.2 - pad, cy, [sz*0.25, sz], false, 0.3, 'l');\r\n\r\n    box(cx + sz*0.75 + pad, cy, [sz*0.5, sz], false, 0.5, 'r');\r\n    box(cx + sz*1.2 + pad, cy, [sz*0.25, sz], false, 0.7, 'r');\r\n\r\n    box(cx, cy - sz*0.75 - pad, [sz, sz*0.5], true, 0.5, 't');\r\n    box(cx, cy - sz*1.2 - pad, [sz, sz*0.25], true, 0.3, 't');\r\n\r\n    box(cx, cy + sz*0.75 + pad, [sz, sz*0.5], true, 0.5, 'b');\r\n    box(cx, cy + sz*1.2 + pad, [sz, sz*0.25], true, 0.7, 'b');\r\n  }\r\n\r\n  getActiveBox(x, y) {\r\n    for (let n of this.boxes) {\r\n      if (n.hasAttribute && n.hasAttribute(\"is_box\")) {\r\n        let rect = n.getClientRects()[0];\r\n\r\n        //console.log(rect.x, rect.y);\r\n        if (x >= rect.x && y >= rect.y && x < rect.x + rect.width && y < rect.y + rect.height) {\r\n          //console.log(\"found rect\");\r\n          return n;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  on_drag(e) {\r\n    this.on_pointermove(e);\r\n  }\r\n\r\n  on_dragend(e) {\r\n    this.on_pointerup(e);\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let wid = 55;\r\n    let color = \"rgb(200, 200, 200, 0.7)\";\r\n\r\n    //console.trace(\"pointer move!\", e.x, e.y, this.sarea);\r\n\r\n    /*\r\n     manually feed events to boxes so as to work right\r\n     with touch events; note that pushModalLight routes\r\n     touch to pointer events (if no touch handlers are present).\r\n     */\r\n    let n = this.getActiveBox(e.x, e.y);\r\n\r\n    if (n !== undefined) {\r\n      n.setColor(this.hcolor); //\"rgba(250, 250, 250, 0.75)\");\r\n    }\r\n    //console.log(\"pointer move\", n);\r\n\r\n    if (this.boxes.active !== undefined && this.boxes.active !== n) {\r\n      this.boxes.active.setColor(this.color);\r\n      this.boxes.active.dispatchEvent(new PointerEvent(\"pointerleave\", e));\r\n    }\r\n\r\n    if (n !== undefined) {\r\n      n.dispatchEvent(new PointerEvent(\"pointerenter\", e));\r\n    }\r\n\r\n    this.boxes.active = n;\r\n    /*\r\n    let rec = (n) => {\r\n      if (n.hasAttribute && n.hasAttribute(\"is_box\")) {\r\n        let rect = n.getClientRects()[0];\r\n\r\n        console.log(rect.x, rect.y);\r\n        if (x >= rect.x && x >= rect.y && x < rect.x+rect.width && y < rect.y+rect.height) {\r\n          console.log(\"found rect\");\r\n          n.dispatchEvent(\"pointerenter\", new PointerEvent(\"pointerenter\", e));\r\n        }\r\n      }\r\n      if (n === undefined || n.childNodes === undefined) {\r\n        return;\r\n      }\r\n\r\n      for (let n2 of n.childNodes) {\r\n        rec(n2);\r\n      }\r\n      if (n.shadow) {\r\n        for (let n2 of n.shadow.childNodes) {\r\n          rec(n2);\r\n        }\r\n      }\r\n    };\r\n\r\n    rec(this.overdraw);\r\n    //*/\r\n    if (this.sarea === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this.cursorbox === undefined) {\r\n      wid = 25;\r\n      this.cursorbox = this.overdraw.rect([e.x - wid*0.5, e.y - wid*0.5], [wid, wid], color);\r\n      this.cursorbox.style[\"pointer-events\"] = \"none\";\r\n    } else {\r\n      this.cursorbox.style[\"x\"] = (e.x - wid*0.5) + \"px\";\r\n      this.cursorbox.style[\"y\"] = (e.y - wid*0.5) + \"px\";\r\n    }\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    console.log(\"e.button\", e.button, e, e.x, e.y, this.getActiveBox(e.x, e.y));\r\n\r\n    if (e.button) {\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n    } else {\r\n      let box = this.getActiveBox(e.x, e.y);\r\n\r\n      if (box !== undefined) {\r\n        box.onclick(e);\r\n      }\r\n    }\r\n\r\n    this.finish();\r\n  }\r\n\r\n  modalStart(ctx) {\r\n    super.modalStart(...arguments);\r\n\r\n    let screen = this.screen;\r\n\r\n    this.overdraw.clear();\r\n\r\n    if (this.sarea && !this.excludeAreas.has(this.sarea)) {\r\n      let sa = this.sarea;\r\n      let box = this.overdraw.rect(sa.pos, sa.size, \"rgba(100, 100, 100, 0.5)\");\r\n\r\n      box.style[\"pointer-events\"] = \"none\";\r\n    }\r\n\r\n    for (let sa of screen.sareas) {\r\n      if (this.excludeAreas.has(sa)) {\r\n        continue;\r\n      }\r\n\r\n      this.makeBoxes(sa);\r\n    }\r\n  }\r\n\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case keymap[\"Escape\"]:\r\n      case keymap[\"Enter\"]:\r\n      case keymap[\"Space\"]:\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\n\r\nexport class AreaMoveAttachTool extends AreaDragTool {\r\n  constructor(screen, sarea, mpos) {\r\n    super(screen, sarea, mpos);\r\n\r\n    this.excludeAreas = new Set([sarea]);\r\n\r\n    this.dropArea = true;\r\n    this.first = true;\r\n    this.sarea = sarea;\r\n    this.mpos = new Vector2(mpos);\r\n    this.start_mpos2 = new Vector2(mpos);\r\n    this.start_pos = new Vector2(sarea.pos);\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let dx = e.x - this.start_mpos2[0];\r\n    let dy = e.y - this.start_mpos2[1];\r\n\r\n    let sarea = this.sarea;\r\n\r\n    if (this.first) {\r\n      this.start_mpos2 = new Vector2([e.x, e.y]);\r\n      this.first = false;\r\n      return;\r\n    }\r\n\r\n\r\n    sarea.pos[0] = this.start_pos[0] + dx;\r\n    sarea.pos[1] = this.start_pos[1] + dy;\r\n\r\n    sarea.loadFromPosSize();\r\n\r\n    this.mpos.loadXY(e.x, e.y);\r\n    super.on_pointermove(e);\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    super.on_pointerup(e);\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    super.on_pointerdown(e);\r\n  }\r\n\r\n  on_keydown(e) {\r\n    super.on_keydown(e);\r\n  }\r\n}\r\n\r\n//controller.registerTool(AreaDragTool);\r\n\r\nexport class ToolTipViewer extends ToolBase {\r\n  constructor(screen) {\r\n    super(screen);\r\n\r\n    this.tooltip = undefined;\r\n    this.element = undefined;\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Help Tool\",\r\n      toolpath   : \"screen.help_picker\",\r\n      icon       : ui_base.Icons.HELP,\r\n      description: \"view tooltips\",\r\n      is_modal   : true,\r\n      undoflag   : UndoFlags.NO_UNDO,\r\n      flag       : 0,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    this.pick(e);\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    this.pick(e);\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    this.finish();\r\n  }\r\n\r\n  finish() {\r\n    super.finish();\r\n  }\r\n\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case keymap.Escape:\r\n      case keymap.Enter:\r\n      case Keymap.Space:\r\n        if (this.tooltip) {\r\n          this.tooltip.end();\r\n        }\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n\r\n  pick(e) {\r\n    let x = e.x, y = e.y;\r\n\r\n    let ele = this.screen.pickElement(x, y);\r\n    console.log(ele ? ele.tagName : ele);\r\n\r\n    if (ele !== undefined && ele !== this.element && ele.title) {\r\n      if (this.tooltip) {\r\n        this.tooltip.end();\r\n      }\r\n\r\n      this.element = ele;\r\n      let tip = ele.title;\r\n\r\n      this.tooltip = ToolTip.show(tip, this.screen, x, y);\r\n    }\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n  }\r\n}\r\n\r\n","import nstructjs from '../path-controller/util/struct.js';\r\nimport * as ui_base from \"../core/ui_base.js\";\r\nimport * as FrameManager_ops from \"./FrameManager_ops.js\";\r\nimport cconst from \"../config/const.js\";\r\nimport {UIBase} from '../core/ui_base.js';\r\n\r\nimport {Vector2} from '../path-controller/util/vectormath.js';\r\nimport {createMenu, Menu} from '../widgets/ui_menu.js';\r\nimport {popModalLight, pushModalLight} from '../path-controller/util/simple_events.js';\r\n\r\nexport const AreaFlags = {\r\n  HIDDEN                : 1,\r\n  FLOATING              : 2,\r\n  INDEPENDENT           : 4, //area is indpendent of the screen mesh\r\n  NO_SWITCHER           : 8,\r\n  NO_HEADER_CONTEXT_MENU: 16,\r\n  NO_COLLAPSE           : 32,\r\n};\r\n\r\nexport let SnapLimit = 1;\r\n\r\nexport const BORDER_ZINDEX_BASE = 25\r\n\r\nexport function snap(c, snap_limit = SnapLimit) {\r\n  if (Array.isArray(c)) {\r\n    for (let i = 0; i < c.length; i++) {\r\n      c[i] = Math.floor(c[i]/snap_limit)*snap_limit;\r\n    }\r\n  } else {\r\n    c = Math.floor(c/snap_limit)*snap_limit;\r\n  }\r\n\r\n  return c;\r\n}\r\n\r\nexport function snapi(c, snap_limit = SnapLimit) {\r\n  //return snap(c, snap_limit);\r\n\r\n  if (Array.isArray(c)) {\r\n    for (let i = 0; i < c.length; i++) {\r\n      c[i] = Math.ceil(c[i]/snap_limit)*snap_limit;\r\n    }\r\n  } else {\r\n    c = Math.ceil(c/snap_limit)*snap_limit;\r\n  }\r\n\r\n  return c;\r\n}\r\n\r\nexport class ScreenVert extends Vector2 {\r\n  constructor(pos, id, added_id) {\r\n    super(pos);\r\n\r\n    this.added_id = added_id;\r\n    this.sareas = [];\r\n    this.borders = [];\r\n\r\n    this._id = id;\r\n  }\r\n\r\n  static hash(pos, added_id, limit) {\r\n    let x = snap(pos[0], limit);\r\n    let y = snap(pos[1], limit);\r\n\r\n    return \"\" + x + \":\" + y + \": + added_id\";\r\n  }\r\n\r\n  valueOf() {\r\n    return ScreenVert.hash(this, this.added_id);\r\n  }\r\n\r\n  [Symbol.keystr]() {\r\n    return ScreenVert.hash(this, this.added_id);\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n  }\r\n}\r\n\r\nScreenVert.STRUCT = `\r\npathux.ScreenVert {\r\n  0 : float;\r\n  1 : float;\r\n}\r\n`;\r\nnstructjs.register(ScreenVert);\r\n\r\nexport class ScreenHalfEdge {\r\n  constructor(border, sarea) {\r\n    this.sarea = sarea;\r\n    this.border = border;\r\n    this.side = sarea._side(border);\r\n  }\r\n\r\n  get v1() {\r\n    return this.border.v1;\r\n  }\r\n\r\n  get v2() {\r\n    return this.border.v2;\r\n  }\r\n\r\n  [Symbol.keystr]() {\r\n    return this.sarea._id + \":\" + this.border._id;\r\n  }\r\n\r\n}\r\n\r\nexport class ScreenBorder extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.visibleToPick = false;\r\n\r\n    this.screen = undefined;\r\n    this.v1 = undefined;\r\n    this.v2 = undefined;\r\n    this._id = undefined;\r\n\r\n    this._hash = undefined;\r\n\r\n    this.outer = undefined;\r\n\r\n    this.halfedges = []; //all bordering borders, including ones with nonshared verts\r\n    this.sareas = [];\r\n\r\n    this._innerstyle = document.createElement(\"style\");\r\n    this._style = undefined;\r\n\r\n    this.shadow.appendChild(this._innerstyle);\r\n\r\n    this.inner = document.createElement(\"div\");\r\n    //this.inner.innerText = \"sdfsdfsdf\";\r\n    this.shadow.appendChild(this.inner);\r\n\r\n    let call_menu = ScreenBorder.bindBorderMenu(this);\r\n\r\n    this.addEventListener(\"pointerdown\", (e) => {\r\n      let ok = this.movable;\r\n\r\n      if (e.button === 2) {\r\n        call_menu(e);\r\n        return;\r\n      }\r\n\r\n      if (!ok) {\r\n        console.log(\"border is not movable\");\r\n        return;\r\n      }\r\n\r\n      let tool = new FrameManager_ops.AreaResizeTool(this.screen, this, [e.x, e.y]);\r\n\r\n      tool.start();\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }, {capture: true});\r\n  }\r\n\r\n  static bindBorderMenu(elem, usePickElement = false) {\r\n    let on_dblclick = (e) => {\r\n      if (usePickElement && elem.pickElement(e.x, e.y) !== elem) {\r\n        return;\r\n      }\r\n\r\n      let menu = [\r\n        [\"Split Area\", () => {\r\n          elem.ctx.screen.splitTool();\r\n        }],\r\n        Menu.SEP,\r\n        [\"Collapse Area\", () => {\r\n          console.log(\"Collapse Area!\");\r\n          elem.ctx.screen.removeAreaTool(elem instanceof ScreenBorder ? elem : undefined);\r\n        }],\r\n      ];\r\n\r\n      menu = createMenu(elem.ctx, \"\", menu);\r\n      //if (e.button === 2) {\r\n      menu.ignoreFirstClick = 2;\r\n      //}\r\n\r\n      elem.ctx.screen.popupMenu(menu, e.x - 15, e.y - 15);\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n\r\n    elem.addEventListener(\"contextmenu\", (e) => e.preventDefault());\r\n    elem.addEventListener(\"dblclick\", on_dblclick, {capture: true});\r\n\r\n    return on_dblclick;\r\n  }\r\n\r\n  getOtherSarea(sarea) {\r\n    console.log(this.halfedges, this.halfedges.length);\r\n\r\n    for (let he of this.halfedges) {\r\n      console.log(he);\r\n\r\n      let ok = he.sarea !== sarea;\r\n      ok = ok && he.sarea._verts.indexOf(this.v1) >= 0;\r\n      ok = ok && he.sarea._verts.indexOf(this.v2) >= 0;\r\n\r\n      if (ok) {\r\n        return he.sarea;\r\n      }\r\n    }\r\n  }\r\n\r\n  get locked() {\r\n    for (let sarea of this.sareas) {\r\n      let mask = 1<<sarea._borders.indexOf(this);\r\n      let lock = sarea.borderLock & mask;\r\n\r\n      if (lock || (sarea.flag & AreaFlags.NO_COLLAPSE)) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  get dead() {\r\n    return !this.parentNode;\r\n  }\r\n\r\n  get side() {\r\n    throw new Error(\"side accedd\");\r\n  }\r\n\r\n  set side(val) {\r\n    throw new Error(\"side accedd\");\r\n  }\r\n\r\n  get valence() {\r\n    let ret = 0; //this.sareas.length;\r\n    let horiz = this.horiz;\r\n\r\n    let visit = {};\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let sv = i ? this.v2 : this.v1;\r\n      //console.log(sv);\r\n\r\n      for (let sa of sv.borders) {\r\n        if (sa.horiz != this.horiz)\r\n          continue;\r\n        if (sa._id in visit)\r\n          continue;\r\n\r\n        visit[sa._id] = 1;\r\n\r\n        let a0x = Math.min(this.v1[0], this.v2[0]);\r\n        let a0y = Math.min(this.v1[1], this.v2[1]);\r\n        let a1x = Math.max(this.v1[0], this.v2[0]);\r\n        let a1y = Math.max(this.v1[1], this.v2[1]);\r\n\r\n        let b0x = Math.min(sa.v1[0], sa.v2[0]);\r\n        let b0y = Math.min(sa.v1[1], sa.v2[1]);\r\n        let b1x = Math.min(sa.v1[0], sa.v2[0]);\r\n        let b1y = Math.min(sa.v1[1], sa.v2[1]);\r\n\r\n        let ok;\r\n\r\n        let eps = 0.001;\r\n        if (horiz) {\r\n          ok = (a0y <= b1y + eps && a1y >= a0y - eps);\r\n        } else {\r\n          ok = (a0x <= b1x + eps && a1x >= a0x - eps);\r\n        }\r\n\r\n        if (ok) {\r\n          //console.log(\"found\");\r\n          ret += sa.sareas.length;\r\n        }\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  get horiz() {\r\n    let dx = this.v2[0] - this.v1[0];\r\n    let dy = this.v2[1] - this.v1[1];\r\n\r\n    return Math.abs(dx) > Math.abs(dy);\r\n  }\r\n\r\n  static hash(v1, v2) {\r\n    return Math.min(v1._id, v2._id) + \":\" + Math.max(v1._id, v2._id);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"screenborder-x\",\r\n      style  : \"screenborder\"\r\n    };\r\n  }\r\n\r\n  otherVertex(v) {\r\n    if (v === this.v1)\r\n      return this.v2;\r\n    else\r\n      return this.v1;\r\n  }\r\n\r\n  setCSS() {\r\n    this.style[\"pointer-events\"] = this.movable ? \"auto\" : \"none\";\r\n\r\n    if (this._style === undefined) {\r\n      this._style = document.createElement(\"style\");\r\n      this.appendChild(this._style);\r\n    }\r\n\r\n    let dpi = UIBase.getDPI();\r\n\r\n    let pad = this.getDefault(\"mouse-threshold\")/dpi;\r\n    let wid = this.getDefault(\"border-width\");\r\n\r\n    let v1 = this.v1, v2 = this.v2;\r\n    let vec = new Vector2(v2).sub(v1);\r\n\r\n    let x = Math.min(v1[0], v2[0]), y = Math.min(v1[1], v2[1]);\r\n    let w, h;\r\n    let cursor, bstyle;\r\n\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"display\"] = this.horiz ? \"row\" : \"column\";\r\n    this.style[\"justify-content\"] = \"center\";\r\n    this.style[\"align-items\"] = \"center\";\r\n\r\n    if (!this.horiz) {\r\n      this.style[\"padding-left\"] = this.style[\"padding-right\"] = pad + \"px\";\r\n      x -= wid*0.5 + pad;\r\n\r\n      w = wid*2;\r\n      h = Math.abs(vec[1]);\r\n\r\n      cursor = 'e-resize';\r\n      bstyle = \"border-left-style : solid;\\n    border-right-style : solid;\\n\";\r\n      bstyle = \"border-top-style : none;\\n    border-bottom-style : none;\\n\";\r\n    } else {\r\n      this.style[\"padding-top\"] = this.style[\"padding-bottom\"] = pad + \"px\";\r\n      y -= wid*0.5 + pad;\r\n\r\n      w = Math.abs(vec[0]);\r\n      h = wid;\r\n\r\n      cursor = 'n-resize';\r\n      bstyle = \"border-top-style : solid;\\n    border-bottom-style : solid;\\n\";\r\n    }\r\n\r\n\r\n    let color = this.getDefault(\"border-outer\");\r\n    let debug = cconst.DEBUG.screenborders;\r\n\r\n    if (debug) {\r\n      wid = 4;\r\n      let alpha = 1.0;\r\n      let c = this.sareas.length*75;\r\n\r\n      let r = 0, g = 0, b = 0;\r\n\r\n      if (this.movable) {\r\n        b = 255;\r\n      }\r\n      if (this.halfedges.length > 1) {\r\n        g = 255;\r\n      }\r\n      if (this.outer) {\r\n        r = 255;\r\n      }\r\n      color = `rgba(${r}, ${g}, ${b}, ${alpha})`;\r\n    }\r\n\r\n\r\n    let innerbuf = `\r\n        .screenborder_inner_${this._id} {\r\n          ${bstyle}\r\n          ${this.horiz ? 'height' : 'width'} : ${wid}px;\r\n          ${!this.horiz ? 'height' : 'width'} : 100%;\r\n          margin : 0px;\r\n          padding : 0px;\r\n          \r\n          background-color : ${this.getDefault(\"border-inner\")};\r\n          border-color : ${color};\r\n          border-width : ${wid*0.5}px;\r\n          border-style : ${debug && this.outer ? \"dashed\" : \"solid\"};\r\n          pointer-events : none;\r\n        }`;\r\n\r\n    let sbuf = `\r\n        .screenborder_${this._id} {\r\n        }\r\n    `;\r\n\r\n    let ok = this.movable;\r\n    if (!this.outer) {\r\n      for (let sarea of this.sareas) {\r\n        ok = ok || sarea.floating;\r\n      }\r\n    }\r\n\r\n    if (ok) {\r\n      sbuf += `\r\n        .screenborder_${this._id}:hover {\r\n          cursor : ${cursor};\r\n        }\r\n      `;\r\n    }\r\n\r\n    this._style.textContent = sbuf;\r\n    this._innerstyle.textContent = innerbuf;\r\n\r\n    this.setAttribute(\"class\", \"screenborder_\" + this._id);\r\n    this.inner.setAttribute(\"class\", \"screenborder_inner_\" + this._id);\r\n\r\n    this.style[\"position\"] = UIBase.PositionKey;\r\n    this.style[\"left\"] = x + \"px\";\r\n    this.style[\"top\"] = y + \"px\";\r\n    this.style[\"width\"] = w + \"px\";\r\n    this.style[\"height\"] = h + \"px\";\r\n    this.style[\"z-index\"] = \"\" + BORDER_ZINDEX_BASE;\r\n  }\r\n\r\n  valueOf() {\r\n    return ScreenBorder.hash(this.v1, this.v2);\r\n  }\r\n\r\n  [Symbol.keystr]() {\r\n    return ScreenBorder.hash(this.v1, this.v2);\r\n  }\r\n}\r\n\r\nui_base.UIBase.internalRegister(ScreenBorder);\r\n","let _ScreenArea = undefined;\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as ui from '../core/ui.js';\r\nimport * as ui_noteframe from '../widgets/ui_noteframe.js';\r\nimport {haveModal} from '../path-controller/util/simple_events.js';\r\nimport cconst from '../config/const.js';\r\n\r\nimport nstructjs from '../path-controller/util/struct.js';\r\n\r\nlet UIBase = ui_base.UIBase;\r\n\r\nimport {EnumProperty} from \"../path-controller/toolsys/toolprop.js\";\r\n\r\nlet Vector2 = vectormath.Vector2;\r\nlet Screen = undefined;\r\n\r\nimport {AreaFlags, BORDER_ZINDEX_BASE, ScreenBorder, snap, snapi} from './FrameManager_mesh.js';\r\n\r\nexport {AreaFlags};\r\n\r\nexport * from './area_wrangler.js';\r\nimport {getAreaIntName, setAreaTypes, contextWrangler, AreaWrangler, areaclasses} from './area_wrangler.js';\r\n\r\nexport {contextWrangler};\r\n\r\nwindow._contextWrangler = contextWrangler;\r\n\r\nexport const BorderMask = {\r\n  LEFT  : 1,\r\n  BOTTOM: 2,\r\n  RIGHT : 4,\r\n  TOP   : 8,\r\n  ALL   : 1 | 2 | 4 | 8\r\n};\r\n\r\nexport const BorderSides = {\r\n  LEFT  : 0,\r\n  BOTTOM: 1,\r\n  RIGHT : 2,\r\n  TOP   : 3\r\n};\r\n\r\n/**\r\n * Base class for all editors\r\n **/\r\nexport class Area extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    /**\r\n     * -----b4----\r\n     *\r\n     * b1       b3\r\n     *\r\n     * -----b2----\r\n     *\r\n     * */\r\n\r\n    let def = this.constructor.define();\r\n\r\n    //set bits in mask to keep\r\n    //borders from moving\r\n    this.borderLock = def.borderLock || 0;\r\n    this.flag = def.flag || 0;\r\n\r\n    this.inactive = true;\r\n    this.areaDragToolEnabled = true;\r\n\r\n    this.owning_sarea = undefined;\r\n    this._area_id = contextWrangler.idgen++;\r\n\r\n    this.pos = undefined; //set by screenarea parent\r\n    this.size = undefined; //set by screenarea parent\r\n    this.minSize = [5, 5];\r\n    this.maxSize = [undefined, undefined];\r\n\r\n    let appendChild = this.shadow.appendChild;\r\n    this.shadow.appendChild = (child) => {\r\n      appendChild.call(this.shadow, child);\r\n      if (child instanceof UIBase) {\r\n        child.parentWidget = this;\r\n      }\r\n    }\r\n\r\n    let prepend = this.shadow.prepend;\r\n    this.shadow.prepend = (child) => {\r\n      prepend.call(this.shadow, child);\r\n\r\n      if (child instanceof UIBase) {\r\n        child.parentWidget = this;\r\n      }\r\n    };\r\n  }\r\n\r\n  get floating() {\r\n    return ~~(this.flag & AreaFlags.FLOATING);\r\n  }\r\n\r\n  set floating(val) {\r\n    if (val) {\r\n      this.flag |= AreaFlags.FLOATING;\r\n    } else {\r\n      this.flag &= ~AreaFlags.FLOATING;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get active area as defined by push_ctx_active and pop_ctx_active.\r\n   *\r\n   * Type should be an Area subclass, if undefined the last accessed area\r\n   * will be returned.\r\n   * */\r\n  static getActiveArea(type) {\r\n    return contextWrangler.getLastArea(type);\r\n  }\r\n\r\n  static unregister(cls) {\r\n    let def = cls.define();\r\n\r\n    if (!def.areaname) {\r\n      throw new Error(\"Missing areaname key in define()\");\r\n    }\r\n\r\n    if (def.areaname in areaclasses) {\r\n      delete areaclasses[def.areaname];\r\n    }\r\n  }\r\n\r\n  /*\r\n  addEventListener(type, cb, options) {\r\n    let cb2 = (e) => {\r\n      let x, y;\r\n      let screen = this.getScreen();\r\n\r\n      if (!screen) {\r\n        console.warn(\"no screen!\");\r\n        return cb(elem);\r\n      }\r\n\r\n      if (type.startsWith(\"mouse\")) {\r\n        x = e.x; y = e.y;\r\n      } else if (type.startsWith(\"touch\") && e.touches && e.touches.length > 0) {\r\n        x = e.touches[0].pageX; y = e.touches[0].pageY;\r\n      } else if (type.startsWith(\"pointer\")) {\r\n        x = e.x; y = e.y;\r\n      } else {\r\n        if (screen) {\r\n          x = screen.mpos[0];\r\n          y = screen.mpos[1];\r\n        } else {\r\n          x = y = -100;\r\n        }\r\n      }\r\n\r\n      let elem = screen.pickElement(x, y);\r\n      console.log(elem ? elem.tagName : undefined);\r\n\r\n      if (elem === this || elem === this.owning_sarea) {\r\n        return cb(elem);\r\n      }\r\n    };\r\n\r\n    cb.__cb2 = cb2;\r\n    return super.addEventListener(type, cb2, options);\r\n  }\r\n\r\n  removeEventListener(type, cb, options) {\r\n    super.removeEventListener(type, cb.__cb2, options);\r\n  }\r\n  //*/\r\n\r\n  static register(cls) {\r\n    let def = cls.define();\r\n\r\n    if (!def.areaname) {\r\n      throw new Error(\"Missing areaname key in define()\");\r\n    }\r\n\r\n    areaclasses[def.areaname] = cls;\r\n\r\n    ui_base.UIBase.internalRegister(cls);\r\n  }\r\n\r\n  static makeAreasEnum() {\r\n    let areas = {};\r\n    let icons = {};\r\n    let i = 0;\r\n\r\n    for (let k in areaclasses) {\r\n      let cls = areaclasses[k];\r\n      let def = cls.define();\r\n\r\n      if (def.flag & AreaFlags.HIDDEN)\r\n        continue;\r\n\r\n      let uiname = def.uiname;\r\n\r\n      if (uiname === undefined) {\r\n        uiname = k.replace(\"_\", \" \").toLowerCase();\r\n        uiname = uiname[0].toUpperCase() + uiname.slice(1, uiname.length);\r\n      }\r\n\r\n      areas[uiname] = k;\r\n      icons[uiname] = def.icon !== undefined ? def.icon : -1;\r\n    }\r\n\r\n    let prop = new EnumProperty(undefined, areas);\r\n    prop.addIcons(icons);\r\n\r\n    return prop;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname : \"pathux-editor-x\", // tag name, e.g. editor-x\r\n      areaname: undefined, //api name for area type\r\n      flag    : 0, //see AreaFlags\r\n      uiname  : undefined,\r\n      icon    : undefined //icon representing area in MakeHeader's area switching menu. Integer.\r\n    };\r\n  }\r\n\r\n  static newSTRUCT() {\r\n    return UIBase.createElement(this.define().tagname);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"overflow\"] = \"hidden\";\r\n    this.noMarginsOrPadding();\r\n\r\n    let onover = (e) => {\r\n      //console.log(this._area_id, this.ctx.workspace._area_id);\r\n\r\n      //try to trigger correct entry in context area stacks\r\n      this.push_ctx_active();\r\n      this.pop_ctx_active();\r\n    };\r\n\r\n    //*\r\n    super.addEventListener(\"mouseover\", onover, {passive: true});\r\n    super.addEventListener(\"mousemove\", onover, {passive: true});\r\n    super.addEventListener(\"mousein\", onover, {passive: true});\r\n    super.addEventListener(\"mouseenter\", onover, {passive: true});\r\n    super.addEventListener(\"touchstart\", onover, {passive: true});\r\n    super.addEventListener(\"focusin\", onover, {passive: true});\r\n    super.addEventListener(\"focus\", onover, {passive: true});\r\n    //*/\r\n  }\r\n\r\n  _get_v_suffix() {\r\n    if (this.flag & AreaFlags.INDEPENDENT) {\r\n      return this._id;\r\n    } else {\r\n      return \"\";\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Return a list of keymaps used by this editor\r\n   * @returns {Array<KeyMap>}\r\n   */\r\n  getKeyMaps() {\r\n    return this.keymap !== undefined ? [this.keymap] : [];\r\n  }\r\n\r\n  on_fileload(isActiveEditor) {\r\n    contextWrangler.reset();\r\n  }\r\n\r\n  buildDataPath() {\r\n    let p = this;\r\n\r\n    let sarea = this.owning_sarea;\r\n\r\n    if (sarea === undefined || sarea.screen === undefined) {\r\n      console.warn(\"Area.buildDataPath(): Failed to build data path\");\r\n      return \"\";\r\n    }\r\n\r\n    let screen = sarea.screen;\r\n\r\n    let idx1 = screen.sareas.indexOf(sarea);\r\n    let idx2 = sarea.editors.indexOf(this);\r\n\r\n    if (idx1 < 0 || idx2 < 0) {\r\n      throw new Error(\"malformed area data\");\r\n    }\r\n\r\n    let ret = `screen.sareas[${idx1}].editors[${idx2}]`;\r\n    return ret;\r\n  }\r\n\r\n  saveData() {\r\n    return {\r\n      _area_id: this._area_id,\r\n      areaName: this.areaName\r\n    };\r\n  }\r\n\r\n  loadData(obj) {\r\n    let id = obj._area_id;\r\n\r\n    if (id !== undefined && id !== null) {\r\n      this._area_id = id;\r\n    }\r\n  }\r\n\r\n  draw() {\r\n  }\r\n\r\n  copy() {\r\n    console.warn(\"You might want to implement this, Area.prototype.copy based method called\");\r\n    let ret = UIBase.createElement(this.constructor.define().tagname);\r\n    return ret;\r\n  }\r\n\r\n  on_resize(size, oldsize) {\r\n    super.on_resize(size, oldsize);\r\n  }\r\n\r\n  on_area_focus() {\r\n\r\n  }\r\n\r\n  on_area_blur() {\r\n\r\n  }\r\n\r\n  /** called when editors are swapped with another editor type*/\r\n  on_area_active() {\r\n  }\r\n\r\n  /** called when editors are swapped with another editor type*/\r\n  on_area_inactive() {\r\n  }\r\n\r\n  /*\r\n  * This is needed so UI controls can know what their parent area is.\r\n  * For example, a slider with data path \"view2d.zoomfac\" needs to know where\r\n  * to find view2d.\r\n  *\r\n  * Typically this works by adding a field to a ContextOverlay:\r\n  *\r\n  * class ContextOverlay {\r\n  *   get view3d() {\r\n  *     return Area.getActiveArea(View3D);\r\n  *   }\r\n  * }\r\n  *\r\n  * Make sure to wrap event callbacks in push_ctx_active and pop_ctx_active.\r\n  * */\r\n  push_ctx_active(dontSetLastRef = false) {\r\n    contextWrangler.updateLastRef(this.constructor, this);\r\n    contextWrangler.push(this.constructor, this, !dontSetLastRef);\r\n  }\r\n\r\n  /**\r\n   * see push_ctx_active\r\n   * */\r\n  pop_ctx_active(dontSetLastRef = false) {\r\n    contextWrangler.pop(this.constructor, this, !dontSetLastRef);\r\n  }\r\n\r\n  getScreen() {\r\n    //XXX\r\n    //return _appstate.screen;\r\n    throw new Error(\"replace me in Area.prototype\");\r\n  }\r\n\r\n  toJSON() {\r\n    return Object.assign(super.toJSON(), {\r\n      areaname: this.constructor.define().areaname,\r\n      _area_id: this._area_id\r\n    });\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n    this._area_id = obj._area_id;\r\n\r\n    return this;\r\n  }\r\n\r\n  getBarHeight() {\r\n    return this.header.getClientRects()[0].height;\r\n  }\r\n\r\n  makeAreaSwitcher(container) {\r\n    if (cconst.useAreaTabSwitcher) {\r\n      let ret = UIBase.createElement(\"area-docker-x\");\r\n      container.add(ret);\r\n      return ret;\r\n    }\r\n\r\n    let prop = Area.makeAreasEnum();\r\n\r\n    let dropbox = container.listenum(undefined, {\r\n      name    : this.constructor.define().uiname,\r\n      enumDef : prop,\r\n      callback: (id) => {\r\n        let cls = areaclasses[id];\r\n        this.owning_sarea.switch_editor(cls);\r\n      }\r\n    });\r\n\r\n    dropbox.update.after(() => {\r\n      let name = this.constructor.define().uiname;\r\n      let val = prop.values[name];\r\n\r\n      if (dropbox.value !== val && val in prop.keys) {\r\n        val = prop.keys[val];\r\n      }\r\n\r\n      if (dropbox.value !== val) {\r\n        dropbox.setValue(prop.values[name], true);\r\n      }\r\n    });\r\n\r\n    return dropbox;\r\n  }\r\n\r\n  makeHeader(container, add_note_area = true, make_draggable = true) {\r\n    let switcherRow;\r\n    let row;\r\n    let helpRow;\r\n\r\n    if (this.header) {\r\n      this.header.remove()\r\n      this.header = undefined\r\n    }\r\n\r\n    if (!(this.flag & AreaFlags.NO_SWITCHER) && cconst.useAreaTabSwitcher) {\r\n      let col = this.header = container.col();\r\n\r\n      switcherRow = helpRow = col.row();\r\n      row = col.row();\r\n    } else {\r\n      row = helpRow = switcherRow = this.header = container.row();\r\n    }\r\n\r\n    if (!(this.flag & AreaFlags.NO_HEADER_CONTEXT_MENU)) {\r\n      let callmenu = ScreenBorder.bindBorderMenu(this.header, true);\r\n\r\n      this.addEventListener(\"mousedown\", e => {\r\n        if (e.button !== 2 || this.header.pickElement(e.x, e.y) !== this.header) {\r\n          return;\r\n        }\r\n\r\n        callmenu(e);\r\n      });\r\n    }\r\n\r\n    this.header.remove();\r\n    container._prepend(this.header);\r\n\r\n    row.setCSS.after(() => row.background = this.getDefault(\"AreaHeaderBG\"));\r\n\r\n    let rh = ~~(16*this.getDPI());\r\n\r\n    //container.setSize(undefined, rh);\r\n    //row.setSize(undefined, rh);\r\n    //row.setSize(undefined, rh);\r\n\r\n    container.noMarginsOrPadding();\r\n    row.noMarginsOrPadding();\r\n\r\n    row.style[\"width\"] = \"100%\";\r\n    row.style[\"margin\"] = \"0px\";\r\n    row.style[\"padding\"] = \"0px\";\r\n\r\n    if (!(this.flag & AreaFlags.NO_SWITCHER)) {\r\n      if (this.switcher) {\r\n        //add back same switcher\r\n        switcherRow.add(this.switcher);\r\n      } else {\r\n        this.switcher = this.makeAreaSwitcher(cconst.useAreaTabSwitcher ? switcherRow : row);\r\n      }\r\n    }\r\n\r\n    if (util.isMobile() || cconst.addHelpPickers) {\r\n      if (this.helppicker) {\r\n        this.helppicker.remove();\r\n      }\r\n\r\n      this.helppicker = helpRow.helppicker();\r\n      this.helppicker.iconsheet = 0;\r\n    }\r\n\r\n    if (add_note_area) {\r\n      let notef = UIBase.createElement(\"noteframe-x\");\r\n      notef.ctx = this.ctx;\r\n      row._add(notef);\r\n    }\r\n\r\n    /* don't do normal dragging for tab switchers */\r\n    if (cconst.useAreaTabSwitcher) {\r\n      return row;\r\n    }\r\n\r\n    let eventdom = this.header;\r\n\r\n    let mdown = false;\r\n    let mpos = new Vector2();\r\n\r\n    let mpre = (e, pageX, pageY) => {\r\n      if (haveModal()) {\r\n        return;\r\n      }\r\n\r\n      pageX = pageX === undefined ? e.x : pageX;\r\n      pageY = pageY === undefined ? e.y : pageY;\r\n\r\n      let node = this.getScreen().pickElement(pageX, pageY);\r\n\r\n      /*\r\n      while (node) {\r\n        if (node === row) {\r\n          break;\r\n        }\r\n        node = node.parentWidget;\r\n      }//*/\r\n\r\n      //console.log(node === row, node ? node._id : undefined, row._id)\r\n\r\n      if (node !== row) {\r\n        return false;\r\n      }\r\n\r\n      return true;\r\n    }\r\n\r\n    eventdom.addEventListener(\"pointerout\", (e) => {\r\n      //console.log(\"pointerout\", e);\r\n      mdown = false;\r\n    });\r\n    eventdom.addEventListener(\"pointerleave\", (e) => {\r\n      mdown = false;\r\n      //console.log(\"pointerleave\", e);\r\n    });\r\n\r\n    eventdom.addEventListener(\"pointerdown\", (e) => {\r\n      //console.log(\"pointerdown\", e, mpre(e));\r\n\r\n      if (!mpre(e)) return;\r\n\r\n      mpos[0] = e.pageX;\r\n      mpos[1] = e.pageY;\r\n      mdown = true;\r\n    });\r\n\r\n    let last_time = util.time_ms();\r\n\r\n    let do_mousemove = (e, pageX, pageY) => {\r\n      if (haveModal() || !make_draggable) {\r\n        return;\r\n      }\r\n\r\n      let mdown2 = e.buttons !== 0 || (e.touches && e.touches.length > 0);\r\n      mdown2 = mdown2 && mdown;\r\n\r\n      //console.log(\"area drag?\", e, mdown2, e.pageX, e.pageY, mpre(e, pageX, pageY), e.was_touch);\r\n\r\n      //calls to pickElement in mpre are expensive\r\n      if (util.time_ms() - last_time < 250) {\r\n        return;\r\n      }\r\n\r\n      last_time = util.time_ms;\r\n\r\n      if (!mdown2 || !mpre(e, pageX, pageY)) return;\r\n\r\n\r\n      if (e.type === \"mousemove\" && e.was_touch) {\r\n        //okay how are patched events getting here?\r\n        //avoid double call. . .\r\n        return;\r\n      }\r\n\r\n      //console.log(mdown);\r\n      let dx = pageX - mpos[0];\r\n      let dy = pageY - mpos[1];\r\n\r\n      let dis = dx*dx + dy*dy;\r\n      let limit = 7;\r\n\r\n      if (dis > limit*limit) {\r\n        let sarea = this.owning_sarea;\r\n        if (sarea === undefined) {\r\n          console.warn(\"Error: missing sarea ref\");\r\n          return;\r\n        }\r\n\r\n        let screen = sarea.screen;\r\n        if (screen === undefined) {\r\n          console.log(\"Error: missing screen ref\");\r\n          return;\r\n        }\r\n\r\n        if (!this.areaDragToolEnabled) {\r\n          return;\r\n        }\r\n        mdown = false;\r\n        console.log(\"area drag tool!\", e.type, e);\r\n        screen.areaDragTool(this.owning_sarea);\r\n      }\r\n    };\r\n\r\n    //not working on mobile\r\n    //row.setAttribute(\"draggable\", true);\r\n    //row.draggable = true;\r\n    /*\r\n    eventdom.addEventListener(\"dragstart\", (e) => {\r\n      return;\r\n      console.log(\"drag start!\", e);\r\n      e.dataTransfer.setData(\"text/json\", \"SplitAreaDrag\");\r\n\r\n      let canvas = document.createElement(\"canvas\");\r\n      let g = canvas.g;\r\n\r\n      canvas.width = 32;\r\n      canvas.height = 32;\r\n\r\n      e.dataTransfer.setDragImage(canvas, 0, 0);\r\n\r\n      mdown = false;\r\n      console.log(\"area drag tool!\");\r\n      this.getScreen().areaDragTool(this.owning_sarea);\r\n    });\r\n\r\n    eventdom.addEventListener(\"drag\", (e) => {\r\n      console.log(\"drag!\", e);\r\n    });*/\r\n\r\n    eventdom.addEventListener(\"pointermove\", (e) => {\r\n      return do_mousemove(e, e.pageX, e.pageY);\r\n    }, false);\r\n    eventdom.addEventListener(\"pointerup\", (e) => {\r\n      console.log(\"pointerup\", e);\r\n      mdown = false;\r\n    }, false);\r\n    eventdom.addEventListener(\"pointercancel\", (e) => {\r\n      console.log(\"pointercancel\", e);\r\n      mdown = false;\r\n    }, false);\r\n\r\n    return row;\r\n  }\r\n\r\n  setCSS() {\r\n    if (this.size !== undefined) {\r\n      this.style[\"position\"] = UIBase.PositionKey;\r\n      //this.style[\"left\"] = this.pos[0] + \"px\";\r\n      //this.style[\"top\"] = this.pos[1] + \"px\";\r\n      this.style[\"width\"] = this.size[0] + \"px\";\r\n      this.style[\"height\"] = this.size[1] + \"px\";\r\n    }\r\n  }\r\n\r\n  update() {\r\n    //don't update non-active editors\r\n    if (this.owning_sarea === undefined || this !== this.owning_sarea.area) {\r\n      return;\r\n    }\r\n\r\n    super.update();\r\n\r\n    //see FrameManager.js, we use a single update\r\n    //function for everything now\r\n    //this._forEachChildWidget((n) => {\r\n    //  n.update();\r\n    //});\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n  }\r\n\r\n  _isDead() {\r\n    if (this.dead) {\r\n      return true;\r\n    }\r\n\r\n    let screen = this.getScreen();\r\n\r\n    if (screen === undefined)\r\n      return true;\r\n\r\n    if (screen.parentNode === undefined)\r\n      return true;\r\n  }\r\n\r\n  //called by owning ScreenArea on file load\r\n  afterSTRUCT() {\r\n    let f = () => {\r\n      if (this._isDead()) {\r\n        return;\r\n      }\r\n      if (!this.ctx) {\r\n        this.doOnce(f);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        ui_base.loadUIData(this, this.saved_uidata);\r\n        this.saved_uidata = undefined;\r\n      } catch (error) {\r\n        console.log(\"failed to load ui data\");\r\n        util.print_stack(error);\r\n      }\r\n    };\r\n\r\n    this.doOnce(f);\r\n  }\r\n\r\n  _getSavedUIData() {\r\n    return ui_base.saveUIData(this, \"area\");\r\n  }\r\n}\r\n\r\nArea.STRUCT = `\r\npathux.Area { \r\n  flag : int;\r\n  saved_uidata : string | obj._getSavedUIData();\r\n}\r\n`\r\n\r\nnstructjs.register(Area, \"pathux.Area\");\r\nui_base.UIBase.internalRegister(Area);\r\n\r\nexport class ScreenArea extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._flag = undefined;\r\n\r\n    this.flag = 0; /** holds AreaFlags.FLOATING and AreaFlags.INDEPENDENT */\r\n\r\n    this._borders = [];\r\n    this._verts = [];\r\n    this.dead = false;\r\n\r\n    this._sarea_id = contextWrangler.idgen++;\r\n\r\n    this._pos = new Vector2();\r\n    this._size = new Vector2([512, 512]);\r\n\r\n    if (cconst.DEBUG.screenAreaPosSizeAccesses) {\r\n      let wrapVector = (name, axis) => {\r\n        Object.defineProperty(this[name], axis, {\r\n          get: function () {\r\n            return this[\"_\" + axis];\r\n          },\r\n\r\n          set: function (val) {\r\n            console.warn(`ScreenArea.${name}[${axis}] set:`, val);\r\n            this[\"_\" + axis] = val;\r\n          }\r\n        });\r\n      };\r\n\r\n      wrapVector(\"size\", 0);\r\n      wrapVector(\"size\", 1);\r\n      wrapVector(\"pos\", 0);\r\n      wrapVector(\"pos\", 1);\r\n    }\r\n\r\n    this.area = undefined;\r\n    this.editors = [];\r\n    this.editormap = {};\r\n\r\n    this.addEventListener(\"mouseover\", (e) => {\r\n      if (haveModal()) {\r\n        return;\r\n      }\r\n\r\n      //console.log(\"screen area mouseover\");\r\n      let screen = this.getScreen();\r\n      if (screen.sareas.active !== this && screen.sareas.active && screen.sareas.active.area) {\r\n        screen.sareas.active.area.on_area_blur();\r\n      }\r\n\r\n      if (this.area && screen.sareas.active !== this) {\r\n        this.area.on_area_focus();\r\n      }\r\n\r\n      screen.sareas.active = this;\r\n    });\r\n\r\n    //this.addEventListener(\"mouseleave\", (e) => {\r\n    //console.log(\"screen area mouseleave\");\r\n    //});\r\n  }\r\n\r\n  /*\r\n  saveData() {\r\n    return {\r\n      _sarea_id : this._sarea_id,\r\n      pos       : this.pos,\r\n      size      : this.size,\r\n    };\r\n  }\r\n  loadData(obj) {\r\n    super.loadData(obj);\r\n\r\n    let id = obj._sarea_id;\r\n    \r\n    let type = obj.areatype;\r\n    \r\n    if (id !== undefined && id !== null) {\r\n      this._sarea_id = id;\r\n    }\r\n    \r\n    for (let area of this.editors) {\r\n      if (area.areaType == type) {\r\n        console.log(\"             found saved area type\");\r\n        \r\n        this.switch_editor(area.constructor);\r\n      }\r\n    }\r\n    \r\n    this.pos.load(obj.pos);\r\n    this.size.load(obj.size);\r\n  }//*/\r\n\r\n  get floating() {\r\n    return this.flag & AreaFlags.FLOATING;\r\n  }\r\n\r\n  set floating(val) {\r\n    if (val) {\r\n      this.flag |= AreaFlags.FLOATING;\r\n    } else {\r\n      this.flag &= ~AreaFlags.FLOATING;\r\n    }\r\n  }\r\n\r\n  get flag() {\r\n    let flag = this._flag & (AreaFlags.FLOATING | AreaFlags.INDEPENDENT);\r\n\r\n    if (this.area) {\r\n      flag |= this.area.flag;\r\n    }\r\n\r\n    return flag;\r\n  }\r\n\r\n  set flag(v) {\r\n    this._flag &= ~(AreaFlags.FLOATING | AreaFlags.INDEPENDENT);\r\n    this._flag |= v & (AreaFlags.FLOATING | AreaFlags.INDEPENDENT);\r\n\r\n    if (this.area) {\r\n      this.area.flag |= v & ~(AreaFlags.FLOATING | AreaFlags.INDEPENDENT);\r\n    }\r\n  }\r\n\r\n  get borderLock() {\r\n    return this.area !== undefined ? this.area.borderLock : 0;\r\n  }\r\n\r\n  get minSize() {\r\n    return this.area !== undefined ? this.area.minSize : this.size;\r\n  }\r\n\r\n  get maxSize() {\r\n    return this.area !== undefined ? this.area.maxSize : this.size;\r\n  }\r\n\r\n  get pos() {\r\n    return this._pos;\r\n  }\r\n\r\n  set pos(val) {\r\n    if (cconst.DEBUG.screenAreaPosSizeAccesses) {\r\n      console.log(\"ScreenArea set pos\", val);\r\n    }\r\n    this._pos.load(val);\r\n  }\r\n\r\n  get size() {\r\n    return this._size;\r\n  }\r\n\r\n  set size(val) {\r\n    if (cconst.DEBUG.screenAreaPosSizeAccesses) {\r\n      console.log(\"ScreenArea set size\", val);\r\n    }\r\n    this._size.load(val);\r\n  }\r\n\r\n  static newSTRUCT() {\r\n    return UIBase.createElement(\"screenarea-x\");\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"screenarea-x\"\r\n    };\r\n  }\r\n\r\n  _get_v_suffix() {\r\n    return this.area ? this.area._get_v_suffix() : \"\";\r\n  }\r\n\r\n  bringToFront() {\r\n    let screen = this.getScreen();\r\n\r\n    HTMLElement.prototype.remove.call(this);\r\n    screen.sareas.remove(this);\r\n\r\n    screen.appendChild(this);\r\n\r\n    let zindex = BORDER_ZINDEX_BASE + 1;\r\n\r\n    if (screen.style[\"z-index\"]) {\r\n      zindex = parseInt(screen.style[\"z-index\"]) + 1;\r\n    }\r\n\r\n    for (let sarea of screen.sareas) {\r\n      let zindex = sarea.style[\"z-index\"];\r\n      if (sarea.style[\"z-index\"]) {\r\n        zindex = Math.max(zindex, parseInt(sarea.style[\"z-index\"]) + 1);\r\n      }\r\n    }\r\n\r\n    this.style[\"z-index\"] = zindex;\r\n  }\r\n\r\n  _side(border) {\r\n    let ret = this._borders.indexOf(border);\r\n    if (ret < 0) {\r\n      throw new Error(\"border not in screen area\");\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.noMarginsOrPadding();\r\n  }\r\n\r\n  draw() {\r\n    if (this.area && this.area.draw) {\r\n      this.area.push_ctx_active();\r\n      this.area.draw();\r\n      this.area.pop_ctx_active();\r\n    }\r\n  }\r\n\r\n  _isDead() {\r\n    if (this.dead) {\r\n      return true;\r\n    }\r\n\r\n    let screen = this.getScreen();\r\n\r\n    if (screen === undefined)\r\n      return true;\r\n\r\n    if (screen.parentNode === undefined)\r\n      return true;\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = {\r\n      editors  : this.editors,\r\n      _sarea_id: this._sarea_id,\r\n      area     : this.area.constructor.define().areaname,\r\n      pos      : this.pos,\r\n      size     : this.size\r\n    };\r\n\r\n    return Object.assign(super.toJSON(), ret);\r\n  }\r\n\r\n  on_keydown(e) {\r\n    if (this.area.on_keydown) {\r\n      this.area.push_ctx_active();\r\n      this.area.on_keydown(e);\r\n      this.area.pop_ctx_active();\r\n    }\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    if (obj === undefined) {\r\n      console.warn(\"undefined in loadJSON\");\r\n      return;\r\n    }\r\n\r\n    super.loadJSON(obj);\r\n\r\n    this.pos.load(obj.pos);\r\n    this.size.load(obj.size);\r\n\r\n    for (let editor of obj.editors) {\r\n      let areaname = editor.areaname;\r\n\r\n      //console.log(editor);\r\n\r\n      let tagname = areaclasses[areaname].define().tagname;\r\n      let area = UIBase.createElement(tagname);\r\n\r\n      area.owning_sarea = this;\r\n      this.editormap[areaname] = area;\r\n      this.editors.push(this.editormap[areaname]);\r\n\r\n      area.pos = new Vector2(obj.pos);\r\n      area.size = new Vector2(obj.size);\r\n      area.ctx = this.ctx;\r\n\r\n      area.inactive = true;\r\n      area.loadJSON(editor);\r\n      area.owning_sarea = undefined;\r\n\r\n      if (areaname === obj.area) {\r\n        this.area = area;\r\n      }\r\n    }\r\n\r\n    if (this.area !== undefined) {\r\n      this.area.ctx = this.ctx;\r\n      this.area.style[\"width\"] = \"100%\";\r\n      this.area.style[\"height\"] = \"100%\";\r\n      this.area.owning_sarea = this;\r\n      this.area.parentWidget = this;\r\n\r\n      this.area.pos = this.pos;\r\n      this.area.size = this.size;\r\n\r\n      this.area.inactive = false;\r\n      this.shadow.appendChild(this.area);\r\n      this.area.on_area_active();\r\n      this.area.onadd();\r\n    }\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  _ondestroy() {\r\n    super._ondestroy();\r\n\r\n    this.dead = true;\r\n\r\n    for (let editor of this.editors) {\r\n      if (editor === this.area) continue;\r\n\r\n      editor._ondestroy();\r\n    }\r\n  }\r\n\r\n  getScreen() {\r\n    if (this.screen !== undefined) {\r\n      return this.screen;\r\n    }\r\n\r\n    //try to walk up graph, if possible\r\n    let p = this.parentNode;\r\n    let _i = 0;\r\n\r\n    while (p && !(p instanceof Screen) && p !== p.parentNode) {\r\n      p = this.parentNode;\r\n\r\n      if (_i++ > 1000) {\r\n        console.warn(\"infinite loop detected in ScreenArea.prototype.getScreen()\");\r\n        return undefined;\r\n      }\r\n    }\r\n\r\n    return p && p instanceof Screen ? p : undefined;\r\n  }\r\n\r\n  copy(screen) {\r\n    let ret = UIBase.createElement(\"screenarea-x\");\r\n\r\n    ret.screen = screen;\r\n    ret.ctx = this.ctx;\r\n\r\n    ret.pos[0] = this.pos[0];\r\n    ret.pos[1] = this.pos[1];\r\n\r\n    ret.size[0] = this.size[0];\r\n    ret.size[1] = this.size[1];\r\n\r\n    for (let area of this.editors) {\r\n      let cpy = area.copy();\r\n\r\n      cpy.ctx = this.ctx;\r\n\r\n      cpy.parentWidget = ret;\r\n      ret.editors.push(cpy);\r\n      ret.editormap[cpy.constructor.define().areaname] = cpy;\r\n\r\n      if (area === this.area) {\r\n        ret.area = cpy;\r\n      }\r\n    }\r\n\r\n    //console.trace(\"RET.AREA\", this.area, ret.area);\r\n\r\n    ret.ctx = this.ctx;\r\n\r\n    if (ret.area !== undefined) {\r\n      ret.area.ctx = this.ctx;\r\n\r\n      ret.area.pos = ret.pos;\r\n      ret.area.size = ret.size;\r\n      ret.area.owning_sarea = ret;\r\n      ret.area.parentWidget = ret;\r\n\r\n      ret.shadow.appendChild(ret.area);\r\n      //ret.area.onadd();\r\n\r\n      if (ret.area._init_done) {\r\n        ret.area.push_ctx_active();\r\n        ret.area.on_area_active();\r\n        ret.area.pop_ctx_active();\r\n      } else {\r\n        ret.doOnce(() => {\r\n          if (this.dead) {\r\n            return;\r\n          }\r\n          ret._init();\r\n          ret.area._init();\r\n          ret.area.push_ctx_active();\r\n          ret.area.on_area_active();\r\n          ret.area.pop_ctx_active();\r\n        });\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  snapToScreenSize() {\r\n    let screen = this.getScreen();\r\n    let co = new Vector2();\r\n    let changed = 0;\r\n\r\n    for (let v of this._verts) {\r\n      co.load(v);\r\n\r\n      v[0] = Math.min(Math.max(v[0], 0), screen.size[0]);\r\n      v[1] = Math.min(Math.max(v[1], 0), screen.size[1]);\r\n\r\n      if (co.vectorDistance(v) > 0.1) {\r\n        changed = 1;\r\n      }\r\n    }\r\n\r\n    if (changed) {\r\n      this.loadFromVerts();\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Sets screen verts from pos/size\r\n   * */\r\n  loadFromPosSize() {\r\n    if (this.floating && this._verts.length > 0) {\r\n      let p = this.pos, s = this.size;\r\n\r\n      this._verts[0].loadXY(p[0], p[1]);\r\n      this._verts[1].loadXY(p[0], p[1] + s[1]);\r\n      this._verts[2].loadXY(p[0] + s[0], p[1] + s[1]);\r\n      this._verts[3].loadXY(p[0] + s[0], p[1]);\r\n\r\n      for (let border of this._borders) {\r\n        border.setCSS();\r\n      }\r\n\r\n      this.setCSS();\r\n      return;\r\n    }\r\n\r\n    let screen = this.getScreen();\r\n    if (!screen) return;\r\n\r\n    for (let b of this._borders) {\r\n      screen.freeBorder(b);\r\n    }\r\n\r\n    this.makeBorders(screen);\r\n    this.setCSS();\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Sets pos/size from screen verts\r\n   * */\r\n  loadFromVerts() {\r\n    if (this._verts.length == 0) {\r\n      return;\r\n    }\r\n\r\n    let min = new Vector2([1e17, 1e17]);\r\n    let max = new Vector2([-1e17, -1e17]);\r\n\r\n    for (let v of this._verts) {\r\n      min.min(v);\r\n      max.max(v);\r\n    }\r\n\r\n    this.pos[0] = min[0];\r\n    this.pos[1] = min[1];\r\n\r\n    this.size[0] = max[0] - min[0];\r\n    this.size[1] = max[1] - min[1];\r\n\r\n    this.setCSS();\r\n    return this;\r\n  }\r\n\r\n  on_resize(size, oldsize) {\r\n    super.on_resize(size, oldsize);\r\n\r\n    if (this.area !== undefined) {\r\n      this.area.on_resize(size, oldsize);\r\n    }\r\n  }\r\n\r\n  makeBorders(screen) {\r\n    this._borders.length = 0;\r\n    this._verts.length = 0;\r\n\r\n    let p = this.pos, s = this.size;\r\n\r\n    //s = snapi(new Vector2(s));\r\n\r\n    let vs = [\r\n      new Vector2([p[0], p[1]]),\r\n      new Vector2([p[0], p[1] + s[1]]),\r\n      new Vector2([p[0] + s[0], p[1] + s[1]]),\r\n      new Vector2([p[0] + s[0], p[1]])\r\n    ];\r\n\r\n    let floating = this.floating;\r\n\r\n    for (let i = 0; i < vs.length; i++) {\r\n      vs[i] = snap(vs[i]);\r\n      vs[i] = screen.getScreenVert(vs[i], i, floating);\r\n      this._verts.push(vs[i]);\r\n    }\r\n\r\n    for (let i = 0; i < vs.length; i++) {\r\n      let v1 = vs[i], v2 = vs[(i + 1)%vs.length];\r\n\r\n      let b = screen.getScreenBorder(this, v1, v2, i);\r\n\r\n\r\n      for (let j = 0; j < 2; j++) {\r\n        let v = j ? b.v2 : b.v1;\r\n\r\n        if (v.sareas.indexOf(this) < 0) {\r\n          v.sareas.push(this);\r\n        }\r\n      }\r\n\r\n      if (b.sareas.indexOf(this) < 0) {\r\n        b.sareas.push(this);\r\n      }\r\n\r\n      this._borders.push(b);\r\n\r\n      b.movable = screen.isBorderMovable(b);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  setCSS() {\r\n    this.style[\"position\"] = UIBase.PositionKey;\r\n\r\n    this.style[\"left\"] = this.pos[0] + \"px\";\r\n    this.style[\"top\"] = this.pos[1] + \"px\";\r\n\r\n    this.style[\"width\"] = this.size[0] + \"px\";\r\n    this.style[\"height\"] = this.size[1] + \"px\";\r\n\r\n    this.style[\"overflow\"] = \"hidden\";\r\n    this.style[\"contain\"] = \"layout\"; //ensure we have a new positioning stack\r\n\r\n    if (this.area !== undefined) {\r\n      this.area.setCSS();\r\n    }\r\n  }\r\n\r\n  appendChild(child) {\r\n    if (child instanceof Area) {\r\n      let def = child.constructor.define();\r\n      let existing = this.editormap[def.areaname];\r\n\r\n      if (existing && existing !== child) {\r\n        console.warn(\"Warning, replacing an exising editor instance\", child, existing);\r\n\r\n        if (this.area === existing) {\r\n          this.area = child;\r\n        }\r\n\r\n        existing.remove();\r\n        this.editors.remove(existing, true);\r\n        this.editormap[def.areaname] = child;\r\n      }\r\n\r\n      child.ctx = this.ctx;\r\n      child.pos = this.pos;\r\n      child.size = this.size;\r\n\r\n      if (this.editors.indexOf(child) < 0) {\r\n        this.editors.push(child);\r\n      }\r\n\r\n      child.owning_sarea = undefined;\r\n      if (this.area === undefined) {\r\n        this.area = child;\r\n      }\r\n    }\r\n\r\n    super.appendChild(child);\r\n\r\n    if (child instanceof ui_base.UIBase) {\r\n      child.parentWidget = this;\r\n      child.onadd();\r\n    }\r\n  }\r\n\r\n  switch_editor(cls) {\r\n    return this.switchEditor(cls);\r\n  }\r\n\r\n  switchEditor(cls) {\r\n    let def = cls.define();\r\n    let name = def.areaname;\r\n\r\n    //areaclasses[name]\r\n    if (!(name in this.editormap)) {\r\n      this.editormap[name] = UIBase.createElement(def.tagname);\r\n      this.editormap[name].ctx = this.ctx;\r\n      this.editormap[name].parentWidget = this;\r\n      this.editormap[name].owning_sarea = this;\r\n      this.editormap[name].inactive = false;\r\n\r\n      this.editors.push(this.editormap[name]);\r\n    }\r\n\r\n    //var finish = () => {\r\n    if (this.area) {\r\n      //break direct pos/size references for old active area\r\n      this.area.pos = new Vector2(this.area.pos);\r\n      this.area.size = new Vector2(this.area.size);\r\n\r\n      this.area.owning_sarea = undefined;\r\n      this.area.inactive = true;\r\n      this.area.push_ctx_active();\r\n      this.area._init(); //check that init was called\r\n      this.area.on_area_inactive();\r\n      this.area.pop_ctx_active();\r\n\r\n      this.area.remove();\r\n    } else {\r\n      this.area = undefined;\r\n    }\r\n\r\n    this.area = this.editormap[name];\r\n\r\n    this.area.inactive = false;\r\n    this.area.parentWidget = this;\r\n\r\n    //. . .and set references to pos/size\r\n    this.area.pos = this.pos;\r\n    this.area.size = this.size;\r\n    this.area.owning_sarea = this;\r\n    this.area.ctx = this.ctx;\r\n\r\n    this.area.packflag |= this.packflag;\r\n\r\n    this.shadow.appendChild(this.area);\r\n\r\n    this.area.style[\"width\"] = \"100%\";\r\n    this.area.style[\"height\"] = \"100%\";\r\n\r\n    //propegate new size\r\n    this.area.push_ctx_active();\r\n    this.area._init(); //check that init was called\r\n    this.area.on_resize(this.size, this.size);\r\n    this.area.pop_ctx_active();\r\n\r\n    this.area.push_ctx_active();\r\n    this.area.on_area_active();\r\n    this.area.pop_ctx_active();\r\n\r\n    this.regenTabOrder();\r\n    //}\r\n  }\r\n\r\n  _checkWrangler() {\r\n    if (this.ctx)\r\n      contextWrangler._checkWrangler(this.ctx);\r\n  }\r\n\r\n  update() {\r\n    this._checkWrangler();\r\n\r\n    super.update();\r\n\r\n    //flag client controller implementation that\r\n    //this area is active for its type\r\n    if (this.area !== undefined) {\r\n      this.area.owning_sarea = this;\r\n      this.area.parentWidget = this;\r\n      this.area.size = this.size;\r\n      this.area.pos = this.pos;\r\n\r\n      let screen = this.getScreen();\r\n      let oldsize = [this.size[0], this.size[1]];\r\n\r\n      let moved = screen ? screen.checkAreaConstraint(this, true) : 0;\r\n      //*\r\n      if (moved) {\r\n        if (cconst.DEBUG.areaConstraintSolver) {\r\n          console.log(\"screen constraint solve\", moved, this.area.minSize, this.area.maxSize, this.area.tagName, this.size);\r\n        }\r\n\r\n        screen.solveAreaConstraints();\r\n        screen.regenBorders();\r\n        this.on_resize(oldsize);\r\n      }//*/\r\n\r\n      this.area.push_ctx_active(true);\r\n    }\r\n\r\n    this._forEachChildWidget((n) => {\r\n      n.update();\r\n    });\r\n\r\n    if (this.area !== undefined) {\r\n      this.area.pop_ctx_active(true);\r\n    }\r\n  }\r\n\r\n  removeChild(ch) {\r\n    if (ch instanceof Area) {\r\n      ch.owining_sarea = undefined;\r\n      ch.pos = undefined;\r\n      ch.size = undefined;\r\n\r\n      if (this.area === ch && this.editors.length > 1) {\r\n        let i = (this.editors.indexOf(ch) + 1)%this.editors.length;\r\n        this.switchEditor(this.editors[i].constructor);\r\n      } else if (this.area === ch) {\r\n        this.editors = [];\r\n        this.editormap = {};\r\n        this.area = undefined;\r\n\r\n        ch.remove();\r\n        return;\r\n      }\r\n\r\n      let areaname = ch.constructor.define().areaname;\r\n\r\n      this.editors.remove(ch);\r\n      delete this.editormap[areaname];\r\n\r\n      ch.parentWidget = undefined;\r\n    } else {\r\n      return super.removeChild(ch);\r\n    }\r\n  }\r\n\r\n  afterSTRUCT() {\r\n    for (let area of this.editors) {\r\n      area.pos = this.pos;\r\n      area.size = this.size;\r\n      area.owning_sarea = this;\r\n\r\n      area.push_ctx_active();\r\n      area._ctx = this.ctx;\r\n      area.afterSTRUCT();\r\n      area.pop_ctx_active();\r\n    }\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    this.pos = new Vector2(this.pos);\r\n    this.size = new Vector2(this.size);\r\n\r\n    //find active editor\r\n\r\n    let editors = [];\r\n\r\n    for (let area of this.editors) {\r\n      if (!area.constructor || !area.constructor.define || area.constructor === Area) {\r\n        //failed to load this area\r\n        continue;\r\n      }\r\n\r\n      /*\r\n      if (area.constructor === undefined || area.constructor.define === undefined) {\r\n        console.warn(\"Missing class for area\", area, \"maybe buggy loadSTRUCT()?\");\r\n        continue;\r\n      }\r\n      //*/\r\n\r\n      let areaname = area.constructor.define().areaname;\r\n\r\n      area.inactive = true;\r\n      area.owning_sarea = undefined;\r\n      this.editormap[areaname] = area;\r\n\r\n      if (areaname === this.area) {\r\n        this.area = area;\r\n      }\r\n\r\n      /*\r\n      * originally inactive areas weren't supposed to have\r\n      * a reference to their owning ScreenAreas.\r\n      *\r\n      * Unfortunately this will cause isDead() to return true,\r\n      * which might lead to nasty problems.\r\n      * */\r\n      area.parentWidget = this;\r\n\r\n      editors.push(area);\r\n    }\r\n    this.editors = editors;\r\n\r\n    if (typeof this.area !== \"object\") {\r\n      let area = this.editors[0];\r\n\r\n      console.warn(\"Failed to find active area!\", this.area);\r\n\r\n      if (typeof area !== \"object\") {\r\n        for (let k in areaclasses) {\r\n          area = areaclasses[k].define().tagname;\r\n          area = UIBase.createElement(area);\r\n          let areaname = area.constructor.define().areaname;\r\n\r\n          this.editors.push(area);\r\n          this.editormap[areaname] = area;\r\n\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (area) {\r\n        this.area = area;\r\n      }\r\n    }\r\n\r\n    if (this.area !== undefined) {\r\n      this.area.style[\"width\"] = \"100%\";\r\n      this.area.style[\"height\"] = \"100%\";\r\n      this.area.owning_sarea = this;\r\n      this.area.parentWidget = this;\r\n\r\n      this.area.pos = this.pos;\r\n      this.area.size = this.size;\r\n\r\n      this.area.inactive = false;\r\n      this.shadow.appendChild(this.area);\r\n\r\n      let f = () => {\r\n        if (this._isDead()) {\r\n          return;\r\n        }\r\n\r\n        if (!this.ctx && this.parentNode) {\r\n          console.log(\"waiting to start. . .\");\r\n          this.doOnce(f);\r\n          return;\r\n        }\r\n\r\n        this.area.ctx = this.ctx;\r\n        this.area._init(); //ensure init has been called already\r\n        this.area.on_area_active();\r\n        this.area.onadd();\r\n      };\r\n\r\n      this.doOnce(f);\r\n    }\r\n\r\n  }\r\n}\r\n\r\nScreenArea.STRUCT = `\r\npathux.ScreenArea { \r\n  pos      : vec2;\r\n  size     : vec2;\r\n  type     : string;\r\n  hidden   : bool;\r\n  editors  : array(abstract(pathux.Area));\r\n  area     : string | this.area ? this.area.constructor.define().areaname : \"\";\r\n}\r\n`;\r\n\r\nnstructjs.register(ScreenArea, \"pathux.ScreenArea\");\r\nui_base.UIBase.internalRegister(ScreenArea);\r\n\r\nui_base._setAreaClass(Area);\r\n\r\nexport function setScreenClass(cls) {\r\n  Screen = cls;\r\n}\r\n","import {Area} from '../screen/ScreenArea.js';\r\nimport * as nstructjs from '../path-controller/util/struct.js';\r\nimport {UIBase, theme, flagThemeUpdate, saveUIData, loadUIData} from '../core/ui_base.js';\r\nimport {Container} from '../core/ui.js';\r\nimport {validateCSSColor, color2css, css2color, CSSFont} from '../core/ui_theme.js';\r\n\r\nexport class ThemeEditor extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.categoryMap = {};\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"theme-editor-x\",\r\n      style  : \"theme-editor\"\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.build();\r\n  }\r\n\r\n  doFolder(catkey, obj, container = this, panel = undefined, path=undefined) {\r\n    let key = catkey.key;\r\n\r\n    if (!path) {\r\n      path = [key];\r\n    }\r\n\r\n    if (!panel) {\r\n      panel = container.panel(key, undefined, undefined, catkey.help);\r\n      panel.style[\"margin-left\"] = \"15px\";\r\n    }\r\n\r\n    let row2 = panel.row();\r\n    let textbox = row2.textbox(undefined, \"\");\r\n\r\n    let callback = (id) => {\r\n      console.log(\"ID\", id, obj, catkey);\r\n      console.log(textbox, textbox.text, textbox.value);\r\n\r\n      let propkey = (textbox.text || \"\").trim();\r\n\r\n      if (!propkey) {\r\n        console.error(\"Cannot have empty theme property name\");\r\n        return;\r\n      }\r\n\r\n      if (id === \"FLOAT\") {\r\n        obj[propkey] = 0.0;\r\n      } else if (id === \"SUBFOLDER\") {\r\n        obj[propkey] = {test : 0};\r\n      } else if (id === \"COLOR\") {\r\n        obj[propkey] = \"grey\";\r\n      } else if (id === \"FONT\") {\r\n        obj[propkey] = new CSSFont();\r\n      } else if (id === \"STRING\") {\r\n        obj[propkey] = \"\";\r\n      }\r\n\r\n      let uidata = saveUIData(panel, \"theme-panel\");\r\n\r\n      panel.clear();\r\n      this.doFolder(catkey, obj, container, panel, path);\r\n\r\n      loadUIData(panel, uidata);\r\n      panel.flushUpdate();\r\n      panel.flushSetCSS();\r\n\r\n      //doFolder(catkey, obj, container = this, panel=undefined) {\r\n      //this.build();\r\n      if (this.onchange) {\r\n        this.onchange(key, propkey, obj);\r\n      }\r\n    }\r\n\r\n    let menu = row2.menu(\"+\", [\r\n      {name: \"Float\", callback: () => callback(\"FLOAT\")},\r\n      {name: \"Color\", callback: () => callback(\"COLOR\")},\r\n      {name: \"Subfolder\", callback: () => callback(\"SUBFOLDER\")},\r\n      {name: \"Font\", callback: () => callback(\"FONT\")},\r\n      {name: \"String\", callback: () => callback(\"STRING\")},\r\n    ]);\r\n\r\n    let row = panel.row();\r\n    let col1 = row.col();\r\n    let col2 = row.col();\r\n\r\n    let do_onchange = (key, k, obj) => {\r\n      flagThemeUpdate();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(key, k, obj);\r\n      }\r\n\r\n      this.ctx.screen.completeSetCSS();\r\n      this.ctx.screen.completeUpdate();\r\n    };\r\n\r\n    let getpath = (path) => {\r\n      let obj = theme;\r\n\r\n      for (let i = 0; i < path.length; i++) {\r\n        obj = obj[path[i]];\r\n      }\r\n\r\n      return obj;\r\n    }\r\n\r\n    let ok = false;\r\n    let _i = 0;\r\n\r\n    let dokey = (k, v, path) => {\r\n      let col = _i%2 === 0 ? col1 : col2;\r\n\r\n      if (k.toLowerCase().search(\"flag\") >= 0) {\r\n        return; //don't do flags\r\n      }\r\n\r\n      if (typeof v === \"string\") {\r\n        let v2 = v.toLowerCase().trim();\r\n\r\n        let iscolor = validateCSSColor(v2);\r\n\r\n        if (iscolor) {\r\n          let cw = col.colorbutton();\r\n          ok = true;\r\n          _i++;\r\n\r\n          let color = css2color(v2);\r\n          if (color.length < 3) {\r\n            color = [color[0], color[1], color[2], 1.0];\r\n          }\r\n\r\n          try {\r\n            cw.setRGBA(color);\r\n          } catch (error) {\r\n            console.warn(\"Failed to set color \" + k, v2);\r\n          }\r\n\r\n          cw.onchange = () => {\r\n            console.log(\"setting '\" + k + \"' to \" + color2css(cw.rgba), key);\r\n            getpath(path)[k] = color2css(cw.rgba);\r\n\r\n            do_onchange(key, k);\r\n          }\r\n          cw.label = k;\r\n        } else {\r\n          col.label(k);\r\n\r\n          let box = col.textbox();\r\n          box.onchange = () => {\r\n            getpath(path)[k] = box.text;\r\n            do_onchange(key, k);\r\n          }\r\n          box.text = v;\r\n        }\r\n      } else if (typeof v === \"number\") {\r\n        let slider = col.slider(undefined, k, v, 0, 256, 0.01, false);\r\n\r\n        slider.baseUnit = slider.displayUnit = \"none\";\r\n\r\n        ok = true;\r\n        _i++;\r\n\r\n        slider.onchange = () => {\r\n          getpath(path)[k] = slider.value;\r\n\r\n          do_onchange(key, k);\r\n        }\r\n      } else if (typeof v === \"boolean\") {\r\n        let check = col.check(undefined, k);\r\n\r\n        check.value = getpath(path)[k];\r\n\r\n        check.onchange = () => {\r\n          getpath(path)[k] = !!check.value;\r\n          do_onchange(key, k);\r\n        }\r\n      } else if (typeof v === \"object\" && v instanceof CSSFont) {\r\n        let panel2 = col.panel(k);\r\n        ok = true;\r\n        _i++;\r\n\r\n        let textbox = (key) => {\r\n          panel2.label(key);\r\n          let tbox = panel2.textbox(undefined, v[key]);\r\n\r\n          tbox.width = tbox.getDefault(\"width\");\r\n\r\n          tbox.onchange = function () {\r\n            v[key] = this.text;\r\n            do_onchange(key, k);\r\n          }\r\n        }\r\n\r\n        textbox(\"font\");\r\n        textbox(\"variant\");\r\n        textbox(\"weight\");\r\n        textbox(\"style\");\r\n\r\n        let cw = panel2.colorbutton();\r\n        cw.label = \"color\";\r\n        cw.setRGBA(css2color(v.color));\r\n        cw.onchange = () => {\r\n          v.color = color2css(cw.rgba);\r\n          do_onchange(key, k);\r\n        }\r\n\r\n        let slider = panel2.slider(undefined, \"size\", v.size);\r\n        slider.onchange = () => {\r\n          v.size = slider.value;\r\n          do_onchange(key, k);\r\n        }\r\n        slider.setAttribute(\"min\", 1);\r\n        slider.setAttribute(\"max\", 100);\r\n\r\n        slider.baseUnit = slider.displayUnit = \"none\";\r\n\r\n        panel2.closed = true;\r\n      } else if (typeof v === \"object\") {\r\n        /*\r\n          let old = {\r\n            panel, row, col1, col2\r\n          };\r\n\r\n          let path2 = path.slice(0, path.length);\r\n          path2.push(k);\r\n\r\n          panel = panel.panel(k);\r\n          row = panel.row();\r\n          col1 = row.col();\r\n          col2 = row.col();\r\n          for (let k2 in v) {\r\n            let v2 = v[k2];\r\n\r\n            dokey(k2, v2, path2);\r\n          }\r\n\r\n          panel = old.panel;\r\n          row = old.row;\r\n          col1 = old.col1;\r\n          col2 = old.col2;\r\n        */\r\n\r\n        let catkey2 = Object.assign({}, catkey);\r\n        catkey2.key = k;\r\n\r\n        let path2 = path.concat(k);\r\n\r\n        this.doFolder(catkey2, v, panel, undefined, path2);\r\n      }\r\n    };\r\n\r\n    for (let k in obj) {\r\n      let v = obj[k];\r\n\r\n      dokey(k, v, path);\r\n    }\r\n\r\n    if (!ok) {\r\n      panel.remove();\r\n    } else {\r\n      panel.closed = true;\r\n    }\r\n\r\n  }\r\n\r\n  build() {\r\n    let uidata = saveUIData(this, \"theme\");\r\n\r\n    this.clear();\r\n\r\n    let categories = {};\r\n\r\n    for (let k of Object.keys(theme)) {\r\n      let catkey;\r\n\r\n      if (k in this.categoryMap) {\r\n        let cat = this.categoryMap[k];\r\n\r\n        if (typeof cat === \"string\") {\r\n          cat = {\r\n            category: cat,\r\n            help    : \"\",\r\n            key     : k\r\n          }\r\n        }\r\n\r\n        catkey = cat;\r\n      } else {\r\n        catkey = {category: k, help: '', key: k};\r\n      }\r\n\r\n      if (!catkey.key) {\r\n        catkey.key = k;\r\n      }\r\n\r\n      if (!(catkey.category in categories)) {\r\n        categories[catkey.category] = [];\r\n      }\r\n\r\n      categories[catkey.category].push(catkey);\r\n    }\r\n\r\n    function strcmp(a, b) {\r\n      a = a.trim().toLowerCase();\r\n      b = b.trim().toLowerCase();\r\n      return a < b ? -1 : (a === b ? 0 : 1);\r\n    }\r\n\r\n    let keys = Object.keys(categories);\r\n    keys.sort(strcmp);\r\n\r\n    for (let k of keys) {\r\n      let list = categories[k];\r\n      list.sort((a, b) => strcmp(a.key, b.key));\r\n\r\n      let panel = this;\r\n\r\n      if (list.length > 1) {\r\n        panel = this.panel(k);\r\n      }\r\n\r\n      for (let cat of list) {\r\n        let k2 = cat.key;\r\n        let v = theme[k2];\r\n\r\n        if (typeof v === \"object\") {\r\n          this.doFolder(cat, v, panel);\r\n        }\r\n      }\r\n\r\n      if (list.length > 1) {\r\n        panel.closed = true;\r\n      }\r\n    }\r\n\r\n    loadUIData(this, uidata);\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      this.flushSetCSS();\r\n      this.flushUpdate();\r\n    }\r\n\r\n    if (this.ctx && this.ctx.screen) {\r\n      /* Fix panel spacing bug. */\r\n      window.setTimeout(() => {\r\n        this.ctx.screen.completeSetCSS();\r\n      }, 100);\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ThemeEditor);\r\n","import {UIBase, drawText} from \"../core/ui_base.js\";\r\nimport {ValueButtonBase} from \"./ui_widgets.js\";\r\nimport cconst from '../config/const.js';\r\nimport * as ui_base from \"../core/ui_base.js\";\r\nimport * as units from \"../core/units.js\";\r\nimport {Vector2} from \"../path-controller/util/vectormath.js\";\r\nimport {ColumnFrame} from \"../core/ui.js\";\r\nimport * as util from \"../path-controller/util/util.js\";\r\nimport {\r\n  PropTypes, isNumber, PropSubTypes, PropFlags, NumberConstraints, IntProperty\r\n} from \"../path-controller/toolsys/toolprop.js\";\r\nimport {eventWasTouch} from \"../path-controller/util/simple_events.js\";\r\nimport {KeyMap, keymap} from \"../path-controller/util/simple_events.js\";\r\nimport {color2css, css2color} from \"../core/ui_theme.js\";\r\nimport {ThemeEditor} from \"./theme_editor.js\";\r\nimport {Unit} from '../core/units.js';\r\n\r\nexport const sliderDomAttributes = new Set([\r\n  \"min\", \"max\", \"integer\", \"displayUnit\", \"baseUnit\", \"labelOnTop\",\r\n  \"radix\", \"step\", \"expRate\", \"stepIsRelative\", \"decimalPlaces\",\r\n  \"slideSpeed\", \"sliderDisplayExp\"\r\n]);\r\n\r\nfunction updateSliderFromDom(dom, slider = dom) {\r\n  slider.loadNumConstraints(undefined, dom);\r\n}\r\n\r\nexport const SliderDefaults = {\r\n  stepIsRelative  : false,\r\n  expRate         : 1.0 + 1.0/3.0,\r\n  radix           : 10,\r\n  decimalPlaces   : 4,\r\n  baseUnit        : \"none\",\r\n  displayUnit     : \"none\",\r\n  slideSpeed      : 1.0,\r\n  step            : 0.1,\r\n  sliderDisplayExp: 1.0\r\n}\r\n\r\nexport function NumberSliderBase(cls = UIBase, skip = new Set(), defaults = SliderDefaults) {\r\n  skip = new Set(skip);\r\n\r\n  return class NumberSliderBase extends cls {\r\n    constructor() {\r\n      super();\r\n\r\n      for (let key of NumberConstraints) {\r\n        if (skip.has(key)) {\r\n          continue;\r\n        }\r\n\r\n        if (key in defaults) {\r\n          this[key] = defaults[key];\r\n        } else {\r\n          this[key] = undefined;\r\n        }\r\n      }\r\n    }\r\n\r\n    loadNumConstraints(prop, dom) {\r\n      return super.loadNumConstraints(prop, dom, this._redraw);\r\n    }\r\n  }\r\n}\r\n\r\n//use .setAttribute(\"linear\") to disable nonlinear sliding\r\nexport class NumSlider extends NumberSliderBase(ValueButtonBase) {\r\n  constructor() {\r\n    super();\r\n\r\n    this._highlight = undefined;\r\n    this._last_label = undefined;\r\n\r\n    this.mdown = false;\r\n    this.ma = undefined;\r\n\r\n    this.mpos = new Vector2();\r\n    this.start_mpos = new Vector2();\r\n\r\n    this._last_overarrow = false;\r\n\r\n    this._name = \"\";\r\n    this._value = 0.0;\r\n    this.expRate = SliderDefaults.expRate;\r\n\r\n    this.vertical = false;\r\n    this._last_disabled = false;\r\n\r\n    this.range = [-1e17, 1e17];\r\n    this.isInt = false;\r\n    this.editAsBaseUnit = undefined;\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(val) {\r\n    this.setValue(val);\r\n  }\r\n\r\n  /** Current name label.  If set to null label will\r\n   * be pulled from the datapath api.*/\r\n  get name() {\r\n    return this.getAttribute(\"name\") || this._name;\r\n  }\r\n\r\n  /** Current name label.  If set to null label will\r\n   * be pulled from the datapath api.*/\r\n  set name(name) {\r\n    if (name === undefined || name === null) {\r\n      this.removeAttribute(\"name\");\r\n    } else {\r\n      this.setAttribute(\"name\", name);\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname          : \"numslider-x\",\r\n      style            : \"numslider\",\r\n      parentStyle      : \"button\",\r\n      havePickClipboard: true,\r\n    };\r\n  }\r\n\r\n\r\n  updateWidth(force = false) {\r\n    let dpi = UIBase.getDPI();\r\n    let wid = ~~(this.getDefault(\"width\")*dpi);\r\n\r\n    if (force || wid !== this._last_width) {\r\n      this._last_width = wid;\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (!prop) {\r\n      return;\r\n    }\r\n\r\n    let name;\r\n\r\n    if (this.hasAttribute(\"name\")) {\r\n      name = this.getAttribute(\"name\");\r\n    } else {\r\n      name = \"\" + prop.uiname;\r\n    }\r\n\r\n    //lazily load constraints, since there's so much\r\n    //accessing of DOM attributes\r\n    let updateConstraints = false;\r\n\r\n    if (name !== this._name) {\r\n      this._name = name;\r\n      this.setCSS();\r\n      updateConstraints = true;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (val !== this._value) {\r\n      updateConstraints = true;\r\n      /* Note that super.updateDataPath will update .value for us*/\r\n    }\r\n\r\n    if (updateConstraints) {\r\n      this.loadNumConstraints(prop);\r\n    }\r\n\r\n    super.updateDataPath();\r\n  }\r\n\r\n  update() {\r\n    if (!!this._last_disabled !== !!this.disabled) {\r\n      this._last_disabled = !!this.disabled;\r\n      this._redraw();\r\n      this.setCSS();\r\n    }\r\n\r\n    this.updateWidth();\r\n    super.update(); //calls this.updateDataPath\r\n\r\n    updateSliderFromDom(this);\r\n  }\r\n\r\n  clipboardCopy() {\r\n    console.log(\"Copy\", \"\" + this.value);\r\n    cconst.setClipboardData(\"value\", \"text/plain\", \"\" + this.value);\r\n  }\r\n\r\n  clipboardPaste() {\r\n    let data = cconst.getClipboardData(\"text/plain\");\r\n    console.log(\"Paste\", data);\r\n\r\n    if (typeof data == \"object\") {\r\n      data = data.data;\r\n    }\r\n\r\n    let displayUnit = this.editAsBaseUnit ? undefined : this.displayUnit;\r\n    let val = units.parseValue(data, this.baseUnit, displayUnit);\r\n\r\n    if (typeof val === \"number\" && !isNaN(val)) {\r\n      this.setValue(val);\r\n    }\r\n  }\r\n\r\n  swapWithTextbox() {\r\n    let tbox = UIBase.createElement(\"textbox-x\");\r\n\r\n    if (this.modalRunning) {\r\n      this.popModal();\r\n    }\r\n\r\n    this.mdown = false;\r\n    this._pressed = false;\r\n\r\n    tbox.ctx = this.ctx;\r\n    tbox._init();\r\n\r\n    tbox.decimalPlaces = this.decimalPlaces;\r\n    tbox.isInt = this.isInt;\r\n    tbox.editAsBaseUnit = this.editAsBaseUnit;\r\n\r\n    if (this.isInt && this.radix != 10) {\r\n      let text = this.value.toString(this.radix);\r\n      if (this.radix === 2)\r\n        text = \"0b\" + text;\r\n      else if (this.radix === 16)\r\n        text += \"h\";\r\n\r\n      tbox.text = text;\r\n    } else {\r\n      tbox.text = units.buildString(this.value, this.baseUnit, this.decimalPlaces, this.displayUnit);\r\n    }\r\n\r\n    this.parentNode.insertBefore(tbox, this);\r\n    //this.remove();\r\n    this.hidden = true;\r\n    //this.dom.hidden = true;\r\n\r\n    let finish = (ok) => {\r\n      tbox.remove();\r\n      this.hidden = false;\r\n\r\n      if (ok) {\r\n        let val = tbox.text.trim();\r\n\r\n        if (this.isInt && this.radix !== 10) {\r\n          val = parseInt(val);\r\n        } else {\r\n          let displayUnit = this.editAsBaseUnit ? undefined : this.displayUnit;\r\n\r\n          val = units.parseValue(val, this.baseUnit, displayUnit);\r\n        }\r\n\r\n        if (isNaN(val)) {\r\n          console.log(\"Text input error\", val, tbox.text.trim(), this.isInt);\r\n          this.flash(ui_base.ErrorColors.ERROR);\r\n        } else {\r\n          this.setValue(val);\r\n\r\n          if (this.onchange) {\r\n            this.onchange(this);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    tbox.onend = finish;\r\n    tbox.focus();\r\n    tbox.select();\r\n\r\n    //this.shadow.appendChild(tbox);\r\n    return;\r\n  }\r\n\r\n  bindEvents() {\r\n    let dir = this.range && this.range[0] > this.range[1] ? -1 : 1;\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Left\"]:\r\n        case keymap[\"Down\"]:\r\n          this.setValue(this.value - dir*5*this.step);\r\n          break;\r\n        case keymap[\"Up\"]:\r\n        case keymap[\"Right\"]:\r\n          this.setValue(this.value + dir*5*this.step);\r\n          break;\r\n      }\r\n    });\r\n\r\n    let onmousedown = (e) => {\r\n      e.preventDefault();\r\n\r\n      if (this.disabled) {\r\n        this.mdown = false;\r\n        this._pressed = false;\r\n        e.stopPropagation();\r\n\r\n        return;\r\n      }\r\n\r\n      if (e.button) {\r\n        return;\r\n      }\r\n\r\n      this.mdown = true;\r\n      this._pressed = true;\r\n      this._redraw();\r\n\r\n      if (this.overArrow(e.x, e.y)) {\r\n        this._on_click(e);\r\n      } else {\r\n        this.dragStart(e);\r\n        e.stopPropagation();\r\n      }\r\n    }\r\n\r\n    this._on_click = (e) => {\r\n      this.setMpos(e);\r\n\r\n      if (this.disabled) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        return;\r\n      }\r\n\r\n      let step;\r\n\r\n      if (step = this.overArrow(e.x, e.y)) {\r\n        if (e.shiftKey) {\r\n          step *= 0.1;\r\n        }\r\n\r\n        this.setValue(this.value + step);\r\n      }\r\n    }\r\n\r\n    this.addEventListener(\"pointermove\", (e) => {\r\n      this.setMpos(e);\r\n\r\n      if (this.mdown && !this._modaldata && this.mpos.vectorDistance(this.start_mpos) > 13) {\r\n        this.dragStart(e);\r\n      }\r\n    });\r\n\r\n    this.addEventListener(\"dblclick\", (e) => {\r\n      this.setMpos(e);\r\n\r\n      this.mdown = false;\r\n      this._pressed = false;\r\n\r\n      if (this.disabled || this.overArrow(e.x, e.y)) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        return;\r\n      }\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n\r\n      this.swapWithTextbox();\r\n    });\r\n\r\n    this.addEventListener(\"pointerdown\", (e) => {\r\n      this.setMpos(e);\r\n\r\n      if (this.disabled) return;\r\n      onmousedown(e);\r\n    }, {capture: true});\r\n\r\n    this.addEventListener(\"pointerup\", (e) => {\r\n      this.mdown = false;\r\n      this._pressed = false;\r\n      this._redraw();\r\n    })\r\n    /*\r\n    this.addEventListener(\"touchstart\", (e) => {\r\n      if (this.disabled) return;\r\n\r\n      e.x = e.touches[0].screenX;\r\n      e.y = e.touches[0].screenY;\r\n\r\n      this.dragStart(e);\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }, {passive : false});\r\n    //*/\r\n\r\n    //this.addEventListener(\"pointerup\", (e) => {\r\n    //  return onmouseup(e);\r\n    //});\r\n\r\n    this.addEventListener(\"pointerover\", (e) => {\r\n      this.setMpos(e);\r\n      if (this.disabled) return;\r\n\r\n      if (!this._highlight) {\r\n        this._highlight = true;\r\n        this._repos_canvas();\r\n        this._redraw();\r\n      }\r\n    })\r\n\r\n    this.addEventListener(\"blur\", (e) => {\r\n      this._highlight = false;\r\n      this.mdown = false;\r\n    });\r\n\r\n    this.addEventListener(\"pointerout\", (e) => {\r\n      this.setMpos(e);\r\n      if (this.disabled) return;\r\n\r\n      this._highlight = false;\r\n\r\n      this.dom._background = this.getDefault(\"background-color\");\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    })\r\n  }\r\n\r\n  overArrow(x, y) {\r\n    let r = this.getBoundingClientRect();\r\n    let rwidth, rx;\r\n\r\n    if (this.vertical) {\r\n      rwidth = r.height;\r\n      rx = r.y;\r\n      x = y;\r\n    } else {\r\n      rwidth = r.width;\r\n      rx = r.x;\r\n    }\r\n\r\n    x -= rx;\r\n    let sz = this._getArrowSize();\r\n\r\n    let szmargin = sz + cconst.numSliderArrowLimit;\r\n\r\n    let step = this.step || 0.01;\r\n\r\n    if (this.isInt) {\r\n      step = Math.max(step, 1);\r\n    }\r\n\r\n    if (isNaN(step)) {\r\n      console.error(\"NaN step size\", \"step:\", this.step, \"numslider:\", this._id);\r\n      this.flash(\"red\");\r\n      step = this.isInt ? 1 : 0.1;\r\n    }\r\n\r\n    if (x < szmargin) {\r\n      return -step;\r\n    } else if (x > rwidth - szmargin) {\r\n      return step;\r\n    }\r\n\r\n    return 0;\r\n  }\r\n\r\n  doRange() {\r\n    console.warn(\"Deprecated: NumSlider.prototype.doRange, use loadNumConstraints instead!\");\r\n    this.loadNumConstraints();\r\n  }\r\n\r\n  setValue(value, fire_onchange = true, setDataPath = true, checkConstraints = true) {\r\n    value = Math.min(Math.max(value, this.range[0]), this.range[1]);\r\n\r\n    this._value = value;\r\n\r\n    if (this.hasAttribute(\"integer\")) {\r\n      this.isInt = true;\r\n    }\r\n\r\n    if (this.isInt) {\r\n      this._value = Math.floor(this._value);\r\n    }\r\n\r\n    if (checkConstraints) {\r\n      this.loadNumConstraints();\r\n    }\r\n\r\n    if (setDataPath && this.ctx && this.hasAttribute(\"datapath\")) {\r\n      this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this._value);\r\n    }\r\n\r\n    if (fire_onchange && this.onchange) {\r\n      this.onchange(this.value);\r\n    }\r\n\r\n    this._redraw();\r\n  }\r\n\r\n  setMpos(e) {\r\n    this.mpos[0] = e.x;\r\n    this.mpos[1] = e.y;\r\n\r\n    if (!this.mdown) {\r\n      this.start_mpos[0] = e.x;\r\n      this.start_mpos[1] = e.y;\r\n    }\r\n\r\n    let over = this.overArrow(e.x, e.y);\r\n\r\n    if (over !== this._last_overarrow) {\r\n      this._last_overarrow = over;\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  dragStart(e) {\r\n    this.mdown = false;\r\n    this._pressed = true;\r\n\r\n    if (this.disabled) return;\r\n\r\n    if (this.modalRunning) {\r\n      console.log(\"modal already running for numslider\", this);\r\n      return;\r\n    }\r\n\r\n    this.last_time = util.time_ms();\r\n\r\n    let last_background = this.dom._background;\r\n    let cancel;\r\n\r\n    this.ma = new util.MovingAvg(eventWasTouch(e) ? 8 : 2);\r\n\r\n    let startvalue = this.value;\r\n    let value = startvalue;\r\n\r\n    let startx = this.vertical ? e.y : e.x, starty = this.vertical ? e.x : e.y;\r\n    let sumdelta = 0;\r\n\r\n    this.dom._background = this.getDefault(\"BoxDepressed\");\r\n    let fire = () => {\r\n      if (this.onchange) {\r\n        this.onchange(this);\r\n      }\r\n    }\r\n\r\n    let handlers = {\r\n      on_keydown: (e) => {\r\n        switch (e.keyCode) {\r\n          case 27: //escape key\r\n            cancel(true);\r\n          case 13: //enter key\r\n            cancel(false);\r\n            break;\r\n        }\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      },\r\n\r\n      on_pointermove: (e) => {\r\n        if (this.disabled) return;\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        let x = this.ma.add(this.vertical ? e.y : e.x);\r\n        let dx = x - startx;\r\n        startx = x;\r\n\r\n        if (util.time_ms() - this.last_time < 35) {\r\n          return;\r\n        }\r\n        this.last_time = util.time_ms();\r\n\r\n        if (e.shiftKey) {\r\n          dx *= 0.1;\r\n        }\r\n\r\n        dx *= this.vertical ? -1 : 1;\r\n\r\n        sumdelta += Math.abs(dx);\r\n\r\n        value += dx*this.step*0.1*this.slideSpeed;\r\n\r\n        let dvalue = value - startvalue;\r\n        let dsign = Math.sign(dvalue);\r\n\r\n        let expRate = this.expRate;\r\n\r\n        //if (eventWasTouch(e)) {\r\n        //  expRate = (1 + expRate)*0.5;\r\n        //}\r\n\r\n        if (!this.hasAttribute(\"linear\")) {\r\n          dvalue = Math.pow(Math.abs(dvalue), expRate)*dsign;\r\n        }\r\n\r\n        this.value = startvalue + dvalue;\r\n\r\n        /*\r\n        if (e.shiftKey) {\r\n          dx *= 0.1;\r\n          this.value = startvalue2 + dx*0.1*this.step*this.slideSpeed;\r\n          startvalue3 = this.value;\r\n        } else {\r\n          startvalue2 = this.value;\r\n          this.value = startvalue3 + dx*0.1*this.step*this.slideSpeed;\r\n        }*/\r\n\r\n        this.updateWidth();\r\n        this._redraw();\r\n        fire();\r\n      },\r\n\r\n      on_pointerup: (e) => {\r\n        this.setMpos(e);\r\n\r\n        this.undoBreakPoint();\r\n        cancel(false);\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      },\r\n\r\n      on_pointerout: (e) => {\r\n        last_background = this.getDefault(\"background-color\");\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      },\r\n\r\n      on_pointerover: (e) => {\r\n        last_background = this.getDefault(\"BoxHighlight\");\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      },\r\n\r\n      on_pointerdown: (e) => {\r\n        this.popModal();\r\n      },\r\n    };\r\n\r\n    //events.pushModal(this.getScreen(), handlers);\r\n    this.pushModal(handlers);\r\n\r\n    cancel = (restore_value) => {\r\n      this._pressed = false;\r\n\r\n      if (restore_value) {\r\n        this.value = startvalue;\r\n        this.updateWidth();\r\n        fire();\r\n      }\r\n\r\n      this.dom._background = last_background; //ui_base.getDefault(\"background-color\");\r\n      this._redraw();\r\n\r\n      this.popModal();\r\n    }\r\n  }\r\n\r\n  get _pressed() {\r\n    return this.__pressed;\r\n  }\r\n\r\n  set _pressed(v) {\r\n    /* Try to improve usability on pen/touch displays\r\n     * by forcing pressed state to last at least 100ms.\r\n     */\r\n    if (!v) {\r\n      window.setTimeout(() => {\r\n        let redraw = this.__pressed;\r\n\r\n        this.__pressed = false;\r\n        if (redraw) {\r\n          this._redraw();\r\n        }\r\n      }, 100);\r\n    } else {\r\n      this.__pressed = v;\r\n    }\r\n  }\r\n\r\n  setCSS(unused_setBG, fromRedraw) {\r\n    /* Do not call parent class implementation. */\r\n\r\n    let dpi = this.getDPI();\r\n    let ts = this.getDefault(\"DefaultText\").size*UIBase.getDPI();\r\n    let label = this._genLabel();\r\n\r\n    let tw = ui_base.measureText(this, label, {\r\n      size: ts,\r\n      font: this.getDefault(\"DefaultText\")\r\n    }).width/dpi;\r\n\r\n    /* Enforce a minimum size based on final text. */\r\n    tw = Math.max(tw + this._getArrowSize()*1, this.getDefault(\"width\"));\r\n\r\n    tw += ts;\r\n    tw = ~~tw;\r\n\r\n    let w, h;\r\n\r\n    if (this.vertical) {\r\n      w = this.getDefault(\"height\");\r\n      h = tw;\r\n    } else {\r\n      h = this.getDefault(\"height\");\r\n      w = tw;\r\n    }\r\n\r\n    w = ~~(w*dpi);\r\n    h = ~~(h*dpi);\r\n\r\n    this.style[\"width\"] = this.dom.style[\"width\"] = (w/dpi) + \"px\";\r\n    this.style[\"height\"] = this.dom.style[\"height\"] = (h/dpi) + \"px\";\r\n    this.dom.width = w;\r\n    this.dom.height = h;\r\n\r\n    if (!fromRedraw) {\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _repos_canvas() {\r\n    //super._repos_canvas();\r\n  }\r\n\r\n  updateDefaultSize() {\r\n    /* Do nothing, don't invoke parent class method. */\r\n  }\r\n\r\n  updateName(force) {\r\n    if (!this.hasAttribute(\"name\")) {\r\n      return;\r\n    }\r\n\r\n    let name = this.getAttribute(\"name\");\r\n\r\n    if (force || name !== this._name) {\r\n      this._name = name;\r\n      this.setCSS();\r\n    }\r\n\r\n    let label = this._genLabel();\r\n    if (label !== this._last_label) {\r\n      this._last_label = label;\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  _genLabel() {\r\n    let val = this.value;\r\n    let text;\r\n\r\n    if (val === undefined) {\r\n      text = \"error\";\r\n    } else {\r\n      val = val === undefined ? 0.0 : val;\r\n\r\n      if (this.isInt) {\r\n        val = Math.floor(val);\r\n      }\r\n\r\n      val = units.buildString(val, this.baseUnit, this.decimalPlaces, this.displayUnit);\r\n\r\n      text = val;\r\n      if (this._name) {\r\n        text = this._name + \": \" + text;\r\n      } else if (this.hasAttribute(\"name\")) {\r\n        text = \"\" + this.getAttribute(\"name\") + \": \" + text;\r\n      }\r\n    }\r\n\r\n    return text;\r\n  }\r\n\r\n  _redraw(fromCSS) {\r\n    if (!fromCSS) {\r\n      this.setCSS(undefined, true);\r\n    }\r\n\r\n    let g = this.g;\r\n    let canvas = this.dom;\r\n\r\n    let dpi = this.getDPI();\r\n    let disabled = this.disabled;\r\n\r\n    /* Fallback on BoxHighlight for backwards compatibility with\r\n     * old themes. */\r\n\r\n    let over = !this._modaldata && this.overArrow(this.mpos[0], this.mpos[1]);\r\n\r\n    let subkey = undefined;\r\n    let pressed = this._pressed && !over;\r\n\r\n    if (this._highlight && pressed) {\r\n      subkey = \"highlight-pressed\";\r\n    } else if (this._highlight) {\r\n      subkey = \"highlight\";\r\n    } else if (pressed) {\r\n      subkey = \"pressed\";\r\n    }\r\n\r\n    let getDefault = (key, backupval = undefined, subkey2 = subkey) => {\r\n      /* Have highlight-pressed fall back to pressed. */\r\n      if (subkey2 === \"highlight-pressed\" && !this.hasClassSubDefault(subkey2, key, false)) {\r\n        return this.getSubDefault(\"pressed\", key, undefined, backupval);\r\n      }\r\n\r\n      if (!subkey2) {\r\n        return this.getDefault(key, undefined, backupval);\r\n      } else {\r\n        return this.getSubDefault(subkey2, key, undefined, backupval);\r\n      }\r\n    }\r\n\r\n    let r = getDefault(\"border-radius\");\r\n    if (this.isInt) {\r\n      r *= 0.25;\r\n    }\r\n\r\n    let boxbg = getDefault(\"background-color\");\r\n\r\n    ui_base.drawRoundBox(this, this.dom, this.g, undefined, undefined,\r\n      r, \"fill\", disabled ? getDefault(\"DisabledBG\") : boxbg);\r\n    ui_base.drawRoundBox(this, this.dom, this.g, undefined, undefined,\r\n      r, \"stroke\", disabled ? getDefault(\"DisabledBG\") : getDefault(\"border-color\"));\r\n\r\n    let ts = getDefault(\"DefaultText\").size;\r\n    let text = this._genLabel();\r\n\r\n    let cx = ts + this._getArrowSize();\r\n    let cy = this.dom.height/2;\r\n\r\n    this.dom.font = undefined;\r\n\r\n    g.save();\r\n\r\n    let th = Math.PI*0.5;\r\n\r\n    if (this.vertical) {\r\n      g.rotate(th);\r\n\r\n      ui_base.drawText(this, cx, -ts*0.5, text, {\r\n        canvas: this.dom,\r\n        g     : this.g,\r\n        size  : ts,\r\n        font  : getDefault(\"DefaultText\"),\r\n      });\r\n      g.restore();\r\n    } else {\r\n      ui_base.drawText(this, cx, cy + ts/2, text, {\r\n        canvas: this.dom,\r\n        g     : this.g,\r\n        size  : ts,\r\n        font  : getDefault(\"DefaultText\"),\r\n      });\r\n    }\r\n\r\n    let parseArrowColor = (arrowcolor) => {\r\n      arrowcolor = arrowcolor.trim();\r\n      if (arrowcolor.endsWith(\"%\")) {\r\n        arrowcolor = arrowcolor.slice(0, arrowcolor.length - 1).trim();\r\n\r\n        let perc = parseFloat(arrowcolor)/100.0;\r\n        let c = css2color(this.getDefault(\"background-color\"));\r\n\r\n        let f = (c[0] + c[1] + c[2])*perc;\r\n\r\n        f = ~~(f*255);\r\n        arrowcolor = `rgba(${f},${f},${f},0.95)`;\r\n\r\n      }\r\n      return arrowcolor;\r\n    }\r\n\r\n    let arrowcolor_base;\r\n    let arrowcolor;\r\n\r\n    arrowcolor_base = this.getDefault(\"arrow-color\");\r\n    arrowcolor_base = parseArrowColor(arrowcolor_base);\r\n\r\n    if (this._pressed && this._highlight) {\r\n      arrowcolor = this.getSubDefault(\"highlight-pressed\", \"arrow-color\", null, undefined, false);\r\n\r\n      if (!arrowcolor) {\r\n        arrowcolor = this.getSubDefault(\"pressed\", \"arrow-color\");\r\n      }\r\n\r\n      if (!arrowcolor) {\r\n        arrowcolor = \"33%\";\r\n      }\r\n    } else if (this._pressed) {\r\n      arrowcolor = this.getSubDefault(\"pressed\", \"arrow-color\", \"arrow-color\", \"33%\");\r\n    } else if (this._highlight) {\r\n      if (!this.hasClassSubDefault(\"highlight\", \"arrow-color\", false)) {\r\n        if (this.hasClassSubDefault(\"highlight\", \"background-color\", false)) {\r\n          arrowcolor = this.getSubDefault(\"highlight\", \"background-color\");\r\n        } else {\r\n          arrowcolor = this.getDefault(\"BoxHighlight\");\r\n        }\r\n\r\n        arrowcolor = css2color(arrowcolor);\r\n        let base = this.getSubDefault(\"pressed\", \"arrow-color\", undefined, \"33%\");\r\n        base = css2color(base);\r\n\r\n        arrowcolor.interp(base, 0.25);\r\n        arrowcolor = color2css(arrowcolor);\r\n      } else {\r\n        arrowcolor = this.getSubDefault(\"highlight\", \"arrow-color\");\r\n      }\r\n    } else {\r\n      arrowcolor = getDefault(\"arrow-color\", \"33%\");\r\n    }\r\n\r\n    if (this._pressed) {\r\n//      arrowcolor = this.getSubDefault(\"pressed\", \"arrow-color\");\r\n    }\r\n\r\n    arrowcolor = parseArrowColor(arrowcolor);\r\n\r\n\r\n    let d = 7, w = canvas.width, h = canvas.height;\r\n    let sz = this._getArrowSize();\r\n\r\n    if (this.vertical) {\r\n      g.beginPath();\r\n      g.moveTo(w*0.5, d);\r\n      g.lineTo(w*0.5 + sz*0.5, d + sz);\r\n      g.lineTo(w*0.5 - sz*0.5, d + sz);\r\n\r\n      g.fillStyle = over < 0 ? arrowcolor : arrowcolor_base;\r\n      g.fill();\r\n\r\n      g.beginPath();\r\n      g.moveTo(w*0.5, h - d);\r\n      g.lineTo(w*0.5 + sz*0.5, h - sz - d);\r\n      g.lineTo(w*0.5 - sz*0.5, h - sz - d);\r\n\r\n      g.fillStyle = over > 0 ? arrowcolor : arrowcolor_base;\r\n      g.fill();\r\n    } else {\r\n      g.beginPath();\r\n      g.moveTo(d, h*0.5);\r\n      g.lineTo(d + sz, h*0.5 + sz*0.5);\r\n      g.lineTo(d + sz, h*0.5 - sz*0.5);\r\n\r\n      g.fillStyle = over < 0 ? arrowcolor : arrowcolor_base;\r\n      g.fill();\r\n\r\n      g.beginPath();\r\n      g.moveTo(w - d, h*0.5);\r\n      g.lineTo(w - sz - d, h*0.5 + sz*0.5);\r\n      g.lineTo(w - sz - d, h*0.5 - sz*0.5);\r\n\r\n      g.fillStyle = over > 0 ? arrowcolor : arrowcolor_base;\r\n      g.fill();\r\n    }\r\n\r\n    g.fill();\r\n  }\r\n\r\n  _getArrowSize() {\r\n    return UIBase.getDPI()*10;\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(NumSlider);\r\n\r\n\r\nexport class NumSliderSimpleBase extends NumberSliderBase(UIBase) {\r\n  constructor() {\r\n    super();\r\n\r\n    this.baseUnit = undefined;\r\n    this.displayUnit = undefined;\r\n    this.editAsBaseUnit = undefined;\r\n    this.sliderDisplayExp = undefined;\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.g = this.canvas.getContext(\"2d\");\r\n\r\n    this.canvas.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.highlight = false;\r\n    this.isInt = false;\r\n\r\n    this.shadow.appendChild(this.canvas);\r\n    this.range = [0, 1];\r\n\r\n    /** if not undefined defines subrange of visible slider */\r\n    this.uiRange = undefined;\r\n\r\n    this.step = 0.1;\r\n    this._value = 0.5;\r\n    this.ma = undefined;\r\n    this._focus = false;\r\n\r\n    this.modal = undefined;\r\n\r\n    this._last_slider_key = '';\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(val) {\r\n    this.setValue(val);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname    : \"numslider-simple-base-x\",\r\n      style      : \"numslider_simple\",\r\n      parentStyle: \"button\"\r\n    }\r\n  }\r\n\r\n  setValue(val, fire_onchange = true, setDataPath = true) {\r\n    val = Math.min(Math.max(val, this.range[0]), this.range[1]);\r\n\r\n    if (this.isInt) {\r\n      val = Math.floor(val);\r\n    }\r\n\r\n    if (this._value !== val) {\r\n      this._value = val;\r\n      this._redraw();\r\n\r\n      if (this.onchange && fire_onchange) {\r\n        this.onchange(val);\r\n      }\r\n\r\n      if (setDataPath && this.getAttribute(\"datapath\")) {\r\n        let path = this.getAttribute(\"datapath\");\r\n        this.setPathValue(this.ctx, path, this._value);\r\n      }\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n\r\n    if (!path || path === \"null\" || path === \"undefined\") {\r\n      return;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, path);\r\n\r\n    if (this.isInt) {\r\n      val = Math.floor(val);\r\n    }\r\n\r\n    if (val !== this._value) {\r\n      let prop = this.getPathMeta(this.ctx, path);\r\n      if (!prop) {\r\n        return;\r\n      }\r\n\r\n      this.loadNumConstraints(prop);\r\n      this.setValue(val, true, false);\r\n    }\r\n  }\r\n\r\n  _setFromMouse(e) {\r\n    let rect = this.getClientRects()[0];\r\n    if (rect === undefined) {\r\n      return;\r\n    }\r\n\r\n    let x = e.x - rect.left;\r\n    let dpi = UIBase.getDPI();\r\n    let co = this._getButtonPos();\r\n\r\n    let val = this._invertButtonX(x*dpi);\r\n    this.value = val;\r\n  }\r\n\r\n  _startModal(e) {\r\n    if (this.disabled) {\r\n      return;\r\n    }\r\n\r\n    if (e !== undefined) {\r\n      this._setFromMouse(e);\r\n    }\r\n    let dom = window;\r\n    let evtargs = {capture: false};\r\n\r\n    if (this.modal) {\r\n      console.warn(\"Double call to _startModal!\");\r\n      return;\r\n    }\r\n\r\n    this.ma = new util.MovingAvg(eventWasTouch(e) ? 4 : 2);\r\n    let handlers;\r\n\r\n    let end = () => {\r\n      if (handlers === undefined) {\r\n        return;\r\n      }\r\n\r\n      this.popModal();\r\n      handlers = undefined;\r\n    };\r\n\r\n    handlers = {\r\n      pointermove: (e) => {\r\n        let x = e.x, y = e.y;\r\n\r\n        x = this.ma.add(x);\r\n\r\n        let e2 = new MouseEvent(e, {\r\n          x, y\r\n        });\r\n        this._setFromMouse(e);\r\n      },\r\n\r\n      pointerover : (e) => {\r\n      },\r\n      pointerout  : (e) => {\r\n      },\r\n      pointerleave: (e) => {\r\n      },\r\n      pointerenter: (e) => {\r\n      },\r\n      blur        : (e) => {\r\n      },\r\n      focus       : (e) => {\r\n      },\r\n\r\n      pointerup: (e) => {\r\n        this.undoBreakPoint();\r\n        end();\r\n      },\r\n\r\n      keydown: (e) => {\r\n        switch (e.keyCode) {\r\n          case keymap[\"Enter\"]:\r\n          case keymap[\"Space\"]:\r\n          case keymap[\"Escape\"]:\r\n            end();\r\n        }\r\n      }\r\n    };\r\n\r\n    function makefunc(f) {\r\n      return (e) => {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n\r\n        return f(e);\r\n      }\r\n    }\r\n\r\n    for (let k in handlers) {\r\n      handlers[k] = makefunc(handlers[k]);\r\n    }\r\n\r\n    this.pushModal(handlers);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    if (!this.hasAttribute(\"tab-index\")) {\r\n      this.setAttribute(\"tab-index\", 0);\r\n    }\r\n\r\n    this.updateSize();\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      let dt = this.range[1] > this.range[0] ? 1 : -1;\r\n\r\n      switch (e.keyCode) {\r\n        case keymap[\"Left\"]:\r\n        case keymap[\"Right\"]:\r\n          let fac = this.step;\r\n\r\n          if (e.shiftKey) {\r\n            fac *= 0.1;\r\n          }\r\n\r\n          if (this.isInt) {\r\n            fac = Math.max(fac, 1);\r\n          }\r\n\r\n          this.value += e.keyCode === keymap[\"Left\"] ? -dt*fac : dt*fac;\r\n\r\n          break;\r\n      }\r\n    });\r\n\r\n    this.addEventListener(\"focusin\", () => {\r\n      if (this.disabled) return;\r\n\r\n      this._focus = 1;\r\n      this._redraw();\r\n      this.focus();\r\n    });\r\n\r\n    this.addEventListener(\"pointerdown\", (e) => {\r\n      if (this.disabled) {\r\n        return;\r\n      }\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n      this._startModal(e);\r\n    });\r\n\r\n    this.addEventListener(\"pointerin\", (e) => {\r\n      this.setHighlight(e);\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"pointerout\", (e) => {\r\n      this.highlight = false;\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"pointerover\", (e) => {\r\n      this.setHighlight(e);\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"pointermove\", (e) => {\r\n      this.setHighlight(e);\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"pointerleave\", (e) => {\r\n      this.highlight = false;\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"blur\", (e) => {\r\n      this._focus = 0;\r\n      this.highlight = false;\r\n      this._redraw();\r\n    });\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  setHighlight(e) {\r\n    this.highlight = this.isOverButton(e) ? 2 : 1;\r\n  }\r\n\r\n  _redraw() {\r\n    let g = this.g, canvas = this.canvas;\r\n    let w = canvas.width, h = canvas.height;\r\n    let dpi = UIBase.getDPI();\r\n\r\n    let color = this.getDefault(\"background-color\");\r\n    let sh = ~~(this.getDefault(\"SlideHeight\")*dpi + 0.5);\r\n\r\n    g.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    g.fillStyle = color;\r\n\r\n    let y = (h - sh)*0.5;\r\n\r\n    let r = this.getDefault(\"border-radius\");\r\n\r\n    g.translate(0, y);\r\n    ui_base.drawRoundBox(this, this.canvas, g, w, sh, r, \"fill\", color, undefined, true);\r\n\r\n    let bcolor = this.getDefault('border-color');\r\n    ui_base.drawRoundBox(this, this.canvas, g, w, sh, r, \"stroke\", bcolor, undefined, true);\r\n    g.translate(0, -y);\r\n\r\n    if (this.sliderDisplayExp && this.sliderDisplayExp !== 1.0) {\r\n      g.strokeStyle = this.getDefault(\"SliderDivColor\")\r\n        || this.getDefault(\"border-color\")\r\n        || \"grey\";\r\n\r\n      let steps = 8;\r\n      let t = 0.0, dt = 1.0/(steps - 1);\r\n\r\n      g.beginPath();\r\n      for (let i = 0; i < steps; i++, t += dt) {\r\n        let t2 = Math.pow(t, this.sliderDisplayExp);\r\n\r\n        let x = t2*w;\r\n        g.moveTo(x, y);\r\n        g.lineTo(x, h - y);\r\n      }\r\n      g.stroke();\r\n    }\r\n\r\n    if (this.highlight === 1) {\r\n      color = this.getDefault(\"BoxHighlight\");\r\n    } else {\r\n      color = this.getDefault(\"border-color\");\r\n    }\r\n\r\n    //g.strokeStyle = color;\r\n    //g.stroke();\r\n\r\n    let co = this._getButtonPos();\r\n\r\n    g.beginPath();\r\n\r\n    if (this.highlight === 2) {\r\n      color = this.getDefault(\"BoxHighlight\");\r\n    } else {\r\n      color = this.getDefault(\"border-color\");\r\n    }\r\n\r\n    g.arc(co[0], co[1], Math.abs(co[2]), -Math.PI, Math.PI);\r\n    g.fill();\r\n\r\n    g.strokeStyle = color;\r\n    g.stroke();\r\n\r\n    g.beginPath();\r\n    g.setLineDash([4, 4]);\r\n\r\n    if (this._focus) {\r\n      g.strokeStyle = this.getDefault(\"BoxHighlight\");\r\n      g.arc(co[0], co[1], co[2] - 4, -Math.PI, Math.PI);\r\n      g.stroke();\r\n    }\r\n\r\n    g.setLineDash([]);\r\n  }\r\n\r\n  isOverButton(e) {\r\n    let x = e.x, y = e.y;\r\n    let rect = this.getClientRects()[0];\r\n\r\n    if (!rect) {\r\n      return false;\r\n    }\r\n\r\n    x -= rect.left;\r\n    y -= rect.top;\r\n\r\n    let co = this._getButtonPos();\r\n\r\n    let dpi = UIBase.getDPI();\r\n    let dv = new Vector2([co[0]/dpi - x, co[1]/dpi - y]);\r\n    let dis = dv.vectorLength();\r\n\r\n    return dis < co[2]/dpi;\r\n  }\r\n\r\n  _invertButtonX(x) {\r\n    let w = this.canvas.width;\r\n    let dpi = UIBase.getDPI();\r\n    let sh = ~~(this.getDefault(\"SlideHeight\")*dpi + 0.5);\r\n    let boxw = this.canvas.height - 4;\r\n    let w2 = w - boxw;\r\n\r\n    let range = this.uiRange || this.range;\r\n\r\n    x = (x - boxw*0.5)/w2;\r\n    if (this.sliderDisplayExp) {\r\n      x = Math.max(x, 0.0);\r\n      x = Math.pow(x, 1.0/this.sliderDisplayExp);\r\n    }\r\n    x = x*(range[1] - range[0]) + range[0];\r\n\r\n    return x;\r\n  }\r\n\r\n  _getButtonPos() {\r\n    let w = this.canvas.width;\r\n    let dpi = UIBase.getDPI();\r\n    let sh = ~~(this.getDefault(\"SlideHeight\")*dpi + 0.5);\r\n    let x = this._value;\r\n\r\n    let range = this.uiRange || this.range;\r\n\r\n    x = (x - range[0])/(range[1] - range[0]);\r\n\r\n    if (this.sliderDisplayExp) {\r\n      x = Math.pow(x, this.sliderDisplayExp);\r\n    }\r\n\r\n    let boxw = this.canvas.height - 4;\r\n    let w2 = w - boxw;\r\n\r\n    x = x*w2 + boxw*0.5;\r\n\r\n    return [x, boxw*0.5, boxw*0.5];\r\n  }\r\n\r\n  setCSS() {\r\n    //UIBase.setCSS does annoying things with background-color\r\n    //super.setCSS();\r\n\r\n    const dpi = UIBase.getDPI();\r\n    this.style[\"min-width\"] = this.getDefault(\"width\") + \"px\";\r\n    this.style[\"width\"] = this.getDefault(\"width\") + \"px\";\r\n\r\n    this.canvas.style[\"width\"] = \"\" + (this.canvas.width/dpi) + \"px\";\r\n    this.canvas.style[\"height\"] = \"\" + (this.canvas.height/dpi) + \"px`\";\r\n\r\n    this.canvas.height = this.getDefault(\"height\")*UIBase.getDPI();\r\n\r\n    this._redraw();\r\n  }\r\n\r\n  updateSize() {\r\n    if (this.canvas === undefined) {\r\n      return;\r\n    }\r\n\r\n    let rect = this.getClientRects()[0];\r\n\r\n    if (rect === undefined) {\r\n      return;\r\n    }\r\n\r\n    let dpi = UIBase.getDPI();\r\n    let canvas = this.canvas;\r\n    let w = ~~(rect.width*dpi), h = ~~(rect.height*dpi);\r\n\r\n    if (w !== canvas.width || h !== canvas.height) {\r\n      this.canvas.width = w;\r\n      this.canvas.height = h;\r\n\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _ondestroy() {\r\n    if (this.modalRunning) {\r\n      this.popModal();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    /*\r\n    if (this.checkThemeUpdate()) {\r\n      this._redraw();\r\n    }\r\n    */\r\n\r\n    let key = \"\" + this.getDefault(\"width\") + \":\" + this.getDefault(\"height\") + \":\" + this.getDefault(\"SlideHeight\");\r\n\r\n    if (key !== this._last_slider_key) {\r\n      this._last_slider_key = key;\r\n\r\n      this.flushUpdate();\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n\r\n    if (this.getAttribute(\"tab-index\") !== this.tabIndex) {\r\n      this.tabIndex = this.getAttribute(\"tab-index\");\r\n    }\r\n\r\n    this.updateSize();\r\n    this.updateDataPath();\r\n    updateSliderFromDom(this);\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(NumSliderSimpleBase);\r\n\r\nexport class SliderWithTextbox extends ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this._value = 0;\r\n    this._name = undefined;\r\n    this._lock_textbox = false;\r\n    this._labelOnTop = undefined;\r\n\r\n    this._last_label_on_top = undefined;\r\n\r\n    this.container = this;\r\n\r\n    this.textbox = UIBase.createElement(\"textbox-x\");\r\n    this.textbox.width = 55;\r\n    this._numslider = undefined;\r\n\r\n    this.textbox.overrideDefault(\"width\", this.getDefault(\"TextBoxWidth\"));\r\n    this.textbox.setAttribute(\"class\", \"numslider_simple_textbox\");\r\n    this.textbox.startSelected = true;\r\n\r\n    this._last_value = undefined;\r\n  }\r\n\r\n  get addLabel() {\r\n    if (this.hasAttribute(\"add-label\")) {\r\n      let val = (\"\" + this.getAttribute(\"add-label\")).toLowerCase();\r\n      return val === \"true\" || val === \"yes\";\r\n    }\r\n\r\n    return this.getDefault(\"addLabel\");\r\n  }\r\n\r\n  set addLabel(v) {\r\n    this.setAttribute(\"add-label\", v ? \"true\" : \"false\");\r\n\r\n    if (this.addLabel && !this.l) {\r\n      this.doOnce(this.rebuild);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * whether to put label on top or to the left of sliders\r\n   *\r\n   * If undefined value will be either this.getAtttribute(\"labelOnTop\"),\r\n   * if \"labelOnTop\" attribute exists, or it will be this.getDefault(\"labelOnTop\")\r\n   * (theme default)\r\n   **/\r\n  get labelOnTop() {\r\n    let ret = this._labelOnTop;\r\n\r\n    if (ret === undefined && this.hasAttribute(\"labelOnTop\")) {\r\n      let val = this.getAttribute(\"labelOnTop\");\r\n      if (typeof val === \"string\") {\r\n        val = val.toLowerCase();\r\n        ret = val === \"true\" || val === \"yes\";\r\n      } else {\r\n        ret = !!val;\r\n      }\r\n    }\r\n\r\n    if (ret === undefined) {\r\n      ret = this.getDefault(\"labelOnTop\");\r\n    }\r\n\r\n    return !!ret;\r\n  }\r\n\r\n  set labelOnTop(v) {\r\n    this._labelOnTop = v;\r\n  }\r\n\r\n  get numslider() {\r\n    return this._numslider;\r\n  }\r\n\r\n  //child classes set this in their constructors\r\n  set numslider(v) {\r\n    this._numslider = v;\r\n    this.textbox.range = this._numslider.range;\r\n  }\r\n\r\n  get editAsBaseUnit() {\r\n    return this.numslider.editAsBaseUnit;\r\n  }\r\n\r\n  set editAsBaseUnit(v) {\r\n    this.numslider.editAsBaseUnit = v;\r\n  }\r\n\r\n  get range() {\r\n    return this.numslider.range;\r\n  }\r\n\r\n  set range(v) {\r\n    this.numslider.range = v;\r\n  }\r\n\r\n  get step() {\r\n    return this.numslider.step;\r\n  }\r\n\r\n  set step(v) {\r\n    this.numslider.step = v;\r\n  }\r\n\r\n  get expRate() {\r\n    return this.numslider.expRate;\r\n  }\r\n\r\n  set expRate(v) {\r\n    this.numslider.expRate = v;\r\n  }\r\n\r\n  get decimalPlaces() {\r\n    return this.numslider.decimalPlaces;\r\n  }\r\n\r\n  set decimalPlaces(v) {\r\n    this.numslider.decimalPlaces = v;\r\n  }\r\n\r\n  get isInt() {\r\n    return this.numslider.isInt;\r\n  }\r\n\r\n  set isInt(v) {\r\n    this.numslider.isInt = v;\r\n  }\r\n\r\n  get slideSpeed() {\r\n    return this.numslider.slideSpeed;\r\n  }\r\n\r\n  set slideSpeed(v) {\r\n    this.numslider.slideSpeed = v;\r\n  }\r\n\r\n  get sliderDisplayExp() {\r\n    return this.numslider.sliderDisplayExp;\r\n  }\r\n\r\n  set sliderDisplayExp(v) {\r\n    this.numslider.sliderDisplayExp = v;\r\n  }\r\n\r\n  get radix() {\r\n    return this.numslider.radix;\r\n  }\r\n\r\n  set radix(v) {\r\n    this.numslider.radix = v;\r\n  }\r\n\r\n  get stepIsRelative() {\r\n    return this.numslider.stepIsRelative;\r\n  }\r\n\r\n  set stepIsRelative(v) {\r\n    this.numslider.stepIsRelative = v;\r\n  }\r\n\r\n  get displayUnit() {\r\n    return this.numslider.displayUnit;\r\n  }\r\n\r\n  set displayUnit(val) {\r\n    let update = val !== this.displayUnit;\r\n\r\n    this.numslider.displayUnit = this.textbox.displayUnit = val;\r\n\r\n    if (update) {\r\n      //this.numslider._redraw();\r\n      this.updateTextBox();\r\n    }\r\n  }\r\n\r\n  get baseUnit() {\r\n    return this.textbox.baseUnit;\r\n  }\r\n\r\n  set baseUnit(val) {\r\n    let update = val !== this.baseUnit;\r\n\r\n    this.numslider.baseUnit = this.textbox.baseUnit = val;\r\n\r\n    if (update) {\r\n      //this.slider._redraw();\r\n      this.updateTextBox();\r\n    }\r\n  }\r\n\r\n  get realTimeTextBox() {\r\n    let ret = this.getAttribute(\"realtime\");\r\n\r\n    if (!ret) {\r\n      return false;\r\n    }\r\n\r\n    ret = ret.toLowerCase().trim();\r\n\r\n    return ret === 'true' || ret === 'on' || ret === 'yes';\r\n  }\r\n\r\n  set realTimeTextBox(val) {\r\n    this.setAttribute(\"realtime\", val ? \"true\" : \"false\");\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(val) {\r\n    this.setValue(val);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.rebuild();\r\n    window.setTimeout(() => this.updateTextBox(), 500);\r\n  }\r\n\r\n  rebuild() {\r\n    this._last_label_on_top = this.labelOnTop;\r\n\r\n    this.container.clear();\r\n\r\n    if (!this.labelOnTop) {\r\n      this.container = this.row();\r\n    } else {\r\n      this.container = this;\r\n    }\r\n\r\n    if (this.hasAttribute(\"name\")) {\r\n      this._name = this.getAttribute(\"name\");\r\n    } else {\r\n      this._name = \"slider\";\r\n    }\r\n\r\n\r\n    if (this.addLabel) {\r\n      this.l = this.container.label(this._name);\r\n      this.l.overrideClass(\"numslider_textbox\");\r\n      this.l.font = \"TitleText\";\r\n      this.l.style[\"display\"] = \"float\";\r\n      this.l.style[\"position\"] = \"relative\";\r\n    }\r\n\r\n    let strip = this.container.row();\r\n    //strip.style['justify-content'] = 'space-between';\r\n    strip.add(this.numslider);\r\n\r\n    let path = this.hasAttribute(\"datapath\") ? this.getAttribute(\"datapath\") : undefined;\r\n\r\n    let textbox = this.textbox;\r\n    this.textbox.overrideDefault(\"width\", this.getDefault(\"TextBoxWidth\"));\r\n\r\n    let apply_textbox = () => {\r\n      let text = textbox.text;\r\n\r\n      if (!units.isNumber(text)) {\r\n        textbox.flash(\"red\");\r\n        return;\r\n      } else {\r\n        textbox.flash(\"green\");\r\n\r\n        let displayUnit = this.editAsBaseUnit ? undefined : this.displayUnit;\r\n\r\n        let f = units.parseValue(text, this.baseUnit, displayUnit);\r\n\r\n        if (isNaN(f)) {\r\n          this.flash(\"red\");\r\n          return;\r\n        }\r\n\r\n        if (this.isInt) {\r\n          f = Math.floor(f);\r\n        }\r\n\r\n        this._lock_textbox = 1;\r\n        this.setValue(f);\r\n        this._lock_textbox = 0;\r\n\r\n      }\r\n    };\r\n\r\n    if (this.realTimeTextBox) {\r\n      textbox.onchange = apply_textbox;\r\n    }\r\n\r\n    textbox.onend = apply_textbox;\r\n\r\n    textbox.ctx = this.ctx;\r\n    textbox.packflag |= this.inherit_packflag;\r\n    textbox.overrideDefault(\"width\", this.getDefault(\"TextBoxWidth\"));\r\n\r\n    textbox.style[\"height\"] = (this.getDefault(\"height\") - 2) + \"px\";\r\n    textbox._init();\r\n\r\n    strip.add(textbox);\r\n\r\n    textbox.setCSS();\r\n    this.linkTextBox();\r\n\r\n    let in_onchange = 0;\r\n\r\n    this.numslider.onchange = (val) => {\r\n      this._value = this.numslider.value;\r\n      this.updateTextBox();\r\n\r\n      if (in_onchange) {\r\n        return;\r\n      }\r\n\r\n      if (this.onchange !== undefined) {\r\n        in_onchange++;\r\n        try {\r\n          if (this.onchange) {\r\n            this.onchange(this);\r\n          }\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n        }\r\n      }\r\n\r\n      in_onchange--;\r\n    }\r\n  }\r\n\r\n  updateTextBox() {\r\n    if (!this._init_done) {\r\n      return;\r\n    }\r\n\r\n    if (this._lock_textbox > 0 || this.textbox.editing)\r\n      return;\r\n\r\n    this.textbox.text = this.formatNumber(this._value);\r\n    this.textbox.update();\r\n\r\n    updateSliderFromDom(this, this.numslider);\r\n  }\r\n\r\n  linkTextBox() {\r\n    this.updateTextBox();\r\n\r\n    let onchange = this.numslider.onchange;\r\n    this.numslider.onchange = (e) => {\r\n      this._value = e.value;\r\n      this.updateTextBox();\r\n\r\n      onchange(e);\r\n    }\r\n  }\r\n\r\n  setValue(val, fire_onchange = true) {\r\n    this._value = val;\r\n    this.numslider.setValue(val, fire_onchange);\r\n    this.updateTextBox();\r\n  }\r\n\r\n  updateName() {\r\n    let name = this.getAttribute(\"name\");\r\n\r\n    if (!name && this.hasAttribute(\"datapath\")) {\r\n      let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n      if (prop) {\r\n        name = prop.uiname;\r\n      }\r\n    }\r\n\r\n    if (!name) {\r\n      name = \"[error]\";\r\n    }\r\n\r\n    if (name !== this._name) {\r\n      this._name = name;\r\n      if (this.l) {\r\n        this.l.text = name;\r\n      }\r\n    }\r\n  }\r\n\r\n  updateLabelOnTop() {\r\n    if (this.labelOnTop !== this._last_label_on_top) {\r\n      this._last_label_on_top = this.labelOnTop;\r\n      this.rebuild();\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.ctx || !this.getAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"))\r\n\r\n    if (!prop) {\r\n      return;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n    if (val !== this._last_value) {\r\n      this._last_value = this._value = val;\r\n      this.updateTextBox();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    this.updateLabelOnTop();\r\n    super.update();\r\n\r\n    this.updateDataPath();\r\n    let redraw = false;\r\n\r\n    updateSliderFromDom(this, this.numslider);\r\n    updateSliderFromDom(this, this.textbox);\r\n\r\n    if (redraw) {\r\n      this.setCSS();\r\n      this.numslider.setCSS();\r\n      this.numslider._redraw();\r\n    }\r\n\r\n    this.updateName();\r\n\r\n    this.numslider.description = this.description;\r\n    this.textbox.description = this.title; //get full, transformed toolip\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.numslider.setAttribute(\"datapath\", this.getAttribute(\"datapath\"));\r\n      this.textbox.setAttribute(\"datapath\", this.getAttribute(\"datapath\"));\r\n    }\r\n\r\n    if (this.hasAttribute(\"mass_set_path\")) {\r\n      this.numslider.setAttribute(\"mass_set_path\", this.getAttribute(\"mass_set_path\"))\r\n      this.textbox.setAttribute(\"mass_set_path\", this.getAttribute(\"mass_set_path\"));\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n    this.textbox.setCSS();\r\n    //textbox.style[\"margin\"] = \"5px\";\r\n\r\n  }\r\n}\r\n\r\nexport class NumSliderSimple extends SliderWithTextbox {\r\n  constructor() {\r\n    super();\r\n\r\n    this.numslider = UIBase.createElement(\"numslider-simple-base-x\");\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"numslider-simple-x\",\r\n      style  : \"numslider_simple\"\r\n    }\r\n  }\r\n\r\n  _redraw() {\r\n    this.numslider._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(NumSliderSimple);\r\n\r\nexport class NumSliderWithTextBox extends SliderWithTextbox {\r\n  constructor() {\r\n    super();\r\n\r\n    this.numslider = UIBase.createElement(\"numslider-x\");\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"numslider-textbox-x\",\r\n      style  : \"numslider_textbox\"\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    if (this.hasAttribute(\"name\")) {\r\n      let name = this.getAttribute(\"name\");\r\n\r\n      if (name !== this.numslider.name) {\r\n        this.numslider.setAttribute(\"name\", name);\r\n        this.numslider._redraw();\r\n      }\r\n    }\r\n  }\r\n\r\n  _redraw() {\r\n    this.numslider._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(NumSliderWithTextBox);\r\n\r\n","//stores xml sources\r\nimport {isNumber} from '../path-controller/toolsys/toolprop.js';\r\n\r\nlet pagecache = new Map()\r\nimport {PackFlags, UIBase} from '../core/ui_base.js';\r\nimport {sliderDomAttributes} from '../widgets/ui_numsliders.js';\r\nimport * as util from '../util/util.js';\r\nimport {Menu} from '../widgets/ui_menu.js';\r\nimport {Icons} from '../core/ui_base.js';\r\nimport {Container} from '../core/ui.js';\r\n\r\nexport var domTransferAttrs = new Set([\"id\", \"title\", \"tab-index\"]);\r\nexport var domEventAttrs = new Set([\"click\", \"mousedown\", \"mouseup\", \"mousemove\", \"keydown\", \"keypress\"]);\r\n\r\nexport function parseXML(xml) {\r\n  let parser = new DOMParser()\r\n  xml = `<root>${xml}</root>`;\r\n  return parser.parseFromString(xml.trim(), \"application/xml\");\r\n}\r\n\r\nlet num_re = /[0-9]+$/;\r\n\r\nfunction getIconFlag(elem) {\r\n  if (!elem.hasAttribute(\"useIcons\")) {\r\n    return 0;\r\n  }\r\n\r\n  let attr = elem.getAttribute(\"useIcons\");\r\n\r\n  if (typeof attr === \"string\") {\r\n    attr = attr.toLowerCase().trim();\r\n  }\r\n\r\n  if (attr === \"false\" || attr === \"no\") {\r\n    return 0;\r\n  }\r\n\r\n  if (attr === \"true\" || attr === \"yes\") {\r\n    return PackFlags.USE_ICONS;\r\n  } else if (attr === \"small\") {\r\n    return PackFlags.SMALL_ICON | PackFlags.USE_ICONS;\r\n  } else if (attr === \"large\") {\r\n    return PackFlags.LARGE_ICON | PackFlags.USE_ICONS;\r\n  } else {\r\n    let isnum = typeof attr === \"number\";\r\n    let sheet = attr;\r\n\r\n    if (typeof sheet === \"string\" && sheet.search(num_re) === 0) {\r\n      sheet = parseInt(sheet);\r\n      isnum = true;\r\n    }\r\n\r\n    if (!isnum) {\r\n      return PackFlags.USE_ICONS;\r\n    }\r\n\r\n    let flag = PackFlags.USE_ICONS | PackFlags.CUSTOM_ICON_SHEET;\r\n    flag |= ((sheet - 1)<<PackFlags.CUSTOM_ICON_SHEET_START);\r\n\r\n    return flag;\r\n  }\r\n\r\n  return 0;\r\n}\r\n\r\nfunction getPackFlag(elem) {\r\n  let packflag = getIconFlag(elem);\r\n\r\n  if (elem.hasAttribute(\"drawChecks\")) {\r\n    if (!getbool(elem, \"drawChecks\")) {\r\n      packflag |= PackFlags.HIDE_CHECK_MARKS;\r\n    } else {\r\n      packflag &= ~PackFlags.HIDE_CHECK_MARKS;\r\n    }\r\n  }\r\n\r\n  if (getbool(elem, \"simpleSlider\")) {\r\n    packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n  }\r\n  if (getbool(elem, \"rollarSlider\")) {\r\n    packflag |= PackFlags.FORCE_ROLLER_SLIDER;\r\n  }\r\n\r\n  return packflag;\r\n}\r\n\r\nfunction myParseFloat(s) {\r\n  s = '' + s;\r\n  s = s.trim().toLowerCase();\r\n\r\n  if (s.endsWith(\"px\")) {\r\n    s = s.slice(0, s.length - 2);\r\n  }\r\n\r\n  return parseFloat(s);\r\n}\r\n\r\nfunction getbool(elem, attr) {\r\n  let ret = elem.getAttribute(attr);\r\n  if (!ret) {\r\n    return false;\r\n  }\r\n\r\n  ret = ret.toLowerCase();\r\n  return ret === \"1\" || ret === \"true\" || ret === \"yes\";\r\n}\r\n\r\nfunction getfloat(elem, attr, defaultval) {\r\n  if (!elem.hasAttribute(attr)) {\r\n    return defaultval;\r\n  }\r\n\r\n  return myParseFloat(elem.getAttribute(attr));\r\n}\r\n\r\n/*\r\n**\r\n*\r\n* a customHandler can be a callback, or the string \"default\", e.g.\r\n*\r\n* xmlpage.customHandlers[\"homegig-element-x\"] = \"default\".\r\n*\r\n* The default case simply suppresses the warning that would otherwise\r\n* be printed to the console.\r\n* */\r\nexport const customHandlers = {};\r\n\r\nclass Handler {\r\n  constructor(ctx, container) {\r\n    this.container = container;\r\n    this.stack = [];\r\n    this.ctx = ctx;\r\n    this.codefuncs = {};\r\n\r\n    this.templateVars = {};\r\n\r\n    let attrs = util.list(sliderDomAttributes);\r\n\r\n    //note that useIcons, showLabel and sliderMode are PackFlag bits and are inherited through that system\r\n\r\n    this.inheritDomAttrs = {};\r\n    this.inheritDomAttrKeys = new Set(attrs);\r\n  }\r\n\r\n  push() {\r\n    this.stack.push(this.container);\r\n    this.stack.push(new Set(this.inheritDomAttrKeys));\r\n    this.stack.push(Object.assign({}, this.inheritDomAttrs));\r\n  }\r\n\r\n  pop() {\r\n    this.inheritDomAttrs = this.stack.pop();\r\n    this.inheritDomAttrKeys = this.stack.pop();\r\n    this.container = this.stack.pop();\r\n  }\r\n\r\n  handle(elem) {\r\n    if (elem.constructor === XMLDocument || elem.nodeName === 'root') {\r\n      for (let child of elem.childNodes) {\r\n        this.handle(child);\r\n      }\r\n\r\n      window.tree = elem\r\n      return;\r\n    } else if (elem.constructor === Text || elem.constructor === Comment) {\r\n      return;\r\n    }\r\n\r\n    let tagname = \"\" + elem.tagName;\r\n\r\n    if (tagname in customHandlers) {\r\n      customHandlers[tagname](this, elem);\r\n    } else if (this[tagname]) {\r\n      this[tagname](elem);\r\n    } else {\r\n      let elem2 = UIBase.createElement(tagname.toLowerCase());\r\n\r\n      window.__elem = elem;\r\n      //transfer DOM attributes\r\n      for (let k of elem.getAttributeNames()) {\r\n        elem2.setAttribute(k, elem.getAttribute(k));\r\n      }\r\n\r\n      if (elem2 instanceof UIBase) {\r\n        if (!elem2.hasAttribute(\"datapath\") && elem2.hasAttribute(\"path\")) {\r\n          elem2.setAttribute(\"datapath\", elem2.getAttribute(\"path\"));\r\n        }\r\n\r\n        if (elem2.hasAttribute(\"datapath\")) {\r\n          let path = elem2.getAttribute(\"datapath\");\r\n          path = this.container._joinPrefix(path);\r\n          elem2.setAttribute(\"datapath\", path);\r\n        }\r\n\r\n        if (elem2.hasAttribute(\"massSetPath\") || this.container.massSetPrefix) {\r\n          let massSetPath = \"\";\r\n\r\n          if (elem2.hasAttribute(\"massSetPath\")) {\r\n            massSetPath = elem2.getAttribute(\"massSetPath\");\r\n          }\r\n\r\n          let path = elem2.getAttribute(\"datapath\");\r\n\r\n          path = this.container._getMassPath(this.container.ctx, path, massSetPath);\r\n          elem2.setAttribute(\"massSetPath\", path);\r\n          elem2.setAttribute(\"mass_set_path\", path);\r\n        }\r\n\r\n        this.container.add(elem2);\r\n        this._style(elem, elem2);\r\n\r\n        if (elem2 instanceof Container) {\r\n          this.push();\r\n\r\n          this.container = elem2;\r\n          this._container(elem, elem2, true);\r\n          this.visit(elem);\r\n\r\n          this.pop();\r\n\r\n          return;\r\n        }\r\n      } else {\r\n        console.warn(\"Unknown element \" + elem.tagName + \" (\" + elem.constructor.name + \")\");\r\n        let elem2 = document.createElement(elem.tagName.toLowerCase());\r\n\r\n        for (let attr of elem.getAttributeNames()) {\r\n          elem2.setAttribute(attr, elem.getAttribute(attr));\r\n        }\r\n\r\n        this._basic(elem, elem2);\r\n\r\n        this.container.shadow.appendChild(elem2);\r\n\r\n        if (!(elem2 instanceof UIBase)) {\r\n          elem2.pathux_ctx = this.container.ctx;\r\n        } else {\r\n          elem2.ctx = this.container.ctx;\r\n        }\r\n      }\r\n\r\n      this.visit(elem);\r\n    }\r\n  }\r\n\r\n  _style(elem, elem2) {\r\n    let style = {};\r\n\r\n    //try to handle class attribute, at least somewhat\r\n\r\n    if (elem.hasAttribute(\"class\")) {\r\n      elem2.setAttribute(\"class\", elem.getAttribute(\"class\"));\r\n\r\n      let cls = elem2.getAttribute(\"class\").trim();\r\n      let keys = [\r\n        cls,\r\n        (elem2.tagName.toLowerCase() + \".\" + cls).trim(),\r\n        \"#\" + elem.getAttribute(\"id\").trim()\r\n      ];\r\n\r\n      for (let sheet of document.styleSheets) {\r\n        for (let rule of sheet.rules) {\r\n          for (let k of keys) {\r\n            if (rule.selectorText.trim() === k) {\r\n              for (let k2 of rule.styleMap.keys()) {\r\n                let val = rule.style[k2]\r\n\r\n                style[k2] = val;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (elem.hasAttribute(\"style\")) {\r\n      let stylecode = elem.getAttribute(\"style\");\r\n\r\n      stylecode = stylecode.split(\";\");\r\n\r\n      for (let row of stylecode) {\r\n        row = row.trim();\r\n\r\n        let i = row.search(/\\:/);\r\n        if (i >= 0) {\r\n          let key = row.slice(0, i).trim();\r\n          let val = row.slice(i + 1, row.length).trim();\r\n\r\n          style[key] = val;\r\n        }\r\n      }\r\n    }\r\n\r\n    let keys = Object.keys(style);\r\n    if (keys.length === 0) {\r\n      return;\r\n    }\r\n\r\n    function setStyle() {\r\n      for (let k of keys) {\r\n        elem2.style[k] = style[k];\r\n      }\r\n    }\r\n\r\n    if (elem2 instanceof UIBase) {\r\n      elem2.setCSS.after(() => {\r\n        setStyle();\r\n      });\r\n    }\r\n\r\n    setStyle();\r\n  }\r\n\r\n  visit(node) {\r\n    for (let child of node.childNodes) {\r\n      this.handle(child)\r\n    }\r\n  }\r\n\r\n  _getattr(elem, k) {\r\n    let val = elem.getAttribute(k);\r\n\r\n    if (!val) {\r\n      return val;\r\n    }\r\n\r\n    if (val.startsWith(\"##\")) {\r\n      val = val.slice(2, val.length).trim();\r\n\r\n      if (!(val in this.templateVars)) {\r\n        console.error(`unknown template variable '${val}'`);\r\n        val = '';\r\n      } else {\r\n        val = this.templateVars[val];\r\n      }\r\n    }\r\n\r\n    return val;\r\n  }\r\n\r\n  _basic(elem, elem2) {\r\n    this._style(elem, elem2);\r\n\r\n    for (let k of elem.getAttributeNames()) {\r\n      if (k.startsWith(\"custom\")) {\r\n        elem2.setAttribute(k, this._getattr(elem, k));\r\n      }\r\n    }\r\n\r\n    let codeattrs = [];\r\n\r\n    for (let k of elem.getAttributeNames()) {\r\n      let val = \"\"+elem.getAttribute(k);\r\n\r\n      if (val.startsWith('ng[')) {\r\n        val = val.slice(3, val.endsWith(\"]\") ? val.length-1 : val.length);\r\n\r\n        codeattrs.push([k, \"ng\", val]);\r\n      }\r\n    }\r\n\r\n    for (let k of domEventAttrs) {\r\n      let k2 = 'on' + k;\r\n\r\n      if (elem.hasAttribute(k2)) {\r\n        codeattrs.push([k, \"dom\", elem.getAttribute(k2)]);\r\n      }\r\n    }\r\n\r\n    for (let [k, eventType, id] of codeattrs) {\r\n      if (!(id in this.codefuncs)) {\r\n        console.error(\"Unknown code fragment \" + id);\r\n        continue;\r\n      }\r\n\r\n      if (eventType === \"dom\") {\r\n        //click events usually don't go through normal\r\n        //dom event system\r\n        if (k === 'click') {\r\n          let onclick = elem2.onclick;\r\n          let func = this.codefuncs[id];\r\n\r\n          elem2.onclick = function () {\r\n            if (onclick) {\r\n              onclick.apply(this, arguments);\r\n            }\r\n\r\n            return func.apply(this, arguments);\r\n          }\r\n        } else {\r\n          elem2.addEventListener(k, this.codefuncs[id]);\r\n        }\r\n      } else if (eventType === \"ng\") {\r\n        elem2.addEventListener(k, this.codefuncs[id]);\r\n      }\r\n    }\r\n\r\n\r\n    for (let k of domTransferAttrs) {\r\n      if (elem.hasAttribute(k)) {\r\n        elem2.setAttribute(k, elem.getAttribute(k));\r\n      }\r\n    }\r\n\r\n    for (let k in this.inheritDomAttrs) {\r\n      if (!elem.hasAttribute(k)) {\r\n        elem.setAttribute(k, this.inheritDomAttrs[k]);\r\n      }\r\n    }\r\n\r\n    for (let k of sliderDomAttributes) {\r\n      if (elem.hasAttribute(k)) {\r\n        elem2.setAttribute(k, elem.getAttribute(k));\r\n      }\r\n    }\r\n\r\n    if (!(elem2 instanceof UIBase)) {\r\n      return;\r\n    }\r\n\r\n    if (elem.hasAttribute(\"theme-class\")) {\r\n      elem2.overrideClass(elem.getAttribute(\"theme-class\"));\r\n\r\n      if (elem2._init_done) {\r\n        elem2.setCSS();\r\n        elem2.flushUpdate();\r\n      }\r\n    }\r\n\r\n    if (elem.hasAttribute(\"useIcons\") && typeof elem2.useIcons === \"function\") {\r\n      let val = elem.getAttribute(\"useIcons\").trim().toLowerCase();\r\n\r\n      if (val === \"small\" || val === \"true\" || val === \"yes\") {\r\n        val = true;\r\n      } else if (val === \"large\") {\r\n        val = 1;\r\n      } else if (val === \"false\" || val === \"no\") {\r\n        val = false;\r\n      } else {\r\n        val = parseInt(val) - 1;\r\n      }\r\n\r\n      elem2.useIcons(val);\r\n    }\r\n\r\n    if (elem.hasAttribute(\"sliderTextBox\")) {\r\n      let textbox = getbool(elem, \"sliderTextBox\");\r\n\r\n      if (textbox) {\r\n        elem2.packflag &= ~PackFlags.NO_NUMSLIDER_TEXTBOX;\r\n        elem2.inherit_packflag &= ~PackFlags.NO_NUMSLIDER_TEXTBOX;\r\n      } else {\r\n        elem2.packflag |= PackFlags.NO_NUMSLIDER_TEXTBOX;\r\n        elem2.inherit_packflag |= PackFlags.NO_NUMSLIDER_TEXTBOX;\r\n      }\r\n\r\n      //console.error(\"textBox\", textbox, elem2, elem.getAttribute(\"sliderTextBox\"), elem2.packflag);\r\n    }\r\n\r\n    if (elem.hasAttribute(\"sliderMode\")) {\r\n      let sliderMode = elem.getAttribute(\"sliderMode\");\r\n\r\n      if (sliderMode === \"slider\") {\r\n        elem2.packflag &= ~PackFlags.FORCE_ROLLER_SLIDER;\r\n        elem2.inherit_packflag &= ~PackFlags.FORCE_ROLLER_SLIDER;\r\n\r\n        elem2.packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n        elem2.inherit_packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n      } else if (sliderMode === \"roller\") {\r\n        elem2.packflag &= ~PackFlags.SIMPLE_NUMSLIDERS;\r\n        elem2.packflag |= PackFlags.FORCE_ROLLER_SLIDER;\r\n\r\n        elem2.inherit_packflag &= ~PackFlags.SIMPLE_NUMSLIDERS;\r\n        elem2.inherit_packflag |= PackFlags.FORCE_ROLLER_SLIDER;\r\n      }\r\n\r\n      //console.error(\"sliderMode\", sliderMode, elem2, elem2.packflag & (PackFlags.SIMPLE_NUMSLIDERS | PackFlags.FORCE_ROLLER_SLIDER));\r\n    }\r\n\r\n    if (elem.hasAttribute(\"showLabel\")) {\r\n      let state = getbool(elem, \"showLabel\");\r\n\r\n      if (state) {\r\n        elem2.packflag |= PackFlags.FORCE_PROP_LABELS;\r\n        elem2.inherit_packflag |= PackFlags.FORCE_PROP_LABELS;\r\n      } else {\r\n        elem2.packflag &= ~PackFlags.FORCE_PROP_LABELS;\r\n        elem2.inherit_packflag &= ~PackFlags.FORCE_PROP_LABELS;\r\n      }\r\n    }\r\n\r\n    function doBox(key) {\r\n      if (elem.hasAttribute(key)) {\r\n        let val = elem.getAttribute(key).toLowerCase().trim();\r\n\r\n        if (val.endsWith(\"px\")) {\r\n          val = val.slice(0, val.length - 2).trim();\r\n        }\r\n\r\n        if (val.endsWith(\"%\")) {\r\n          //eek! don't support at all?\r\n          //or use aspect overlay?\r\n\r\n          console.warn(`Relative styling of '${key}' may be unstable for this element`, elem);\r\n\r\n          elem.setCSS.after(function () {\r\n            this.style[key] = val;\r\n          });\r\n        } else {\r\n          val = parseFloat(val);\r\n\r\n          if (isNaN(val) || typeof val !== \"number\") {\r\n            console.error(`Invalid style ${key}:${elem.getAttribute(key)}`);\r\n            return;\r\n          }\r\n\r\n          elem2.overrideDefault(key, val);\r\n          elem2.setCSS();\r\n          elem2.style[key] = \"\" + val + \"px\";\r\n        }\r\n      }\r\n    }\r\n\r\n    doBox(\"width\");\r\n    doBox(\"height\");\r\n    doBox(\"margin\");\r\n    doBox(\"padding\");\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let key = i ? \"margin\" : \"padding\";\r\n\r\n      doBox(key + \"-bottom\");\r\n      doBox(key + \"-top\");\r\n      doBox(key + \"-left\");\r\n      doBox(key + \"-right\");\r\n    }\r\n  }\r\n\r\n  _handlePathPrefix(elem, con) {\r\n    if (elem.hasAttribute(\"path\")) {\r\n      let prefix = con.dataPrefix;\r\n      let path = elem.getAttribute(\"path\").trim();\r\n\r\n      if (prefix.length > 0) {\r\n        prefix += \".\";\r\n      }\r\n\r\n      prefix += path;\r\n      con.dataPrefix = prefix;\r\n    }\r\n\r\n    if (elem.hasAttribute(\"massSetPath\")) {\r\n      let prefix = con.massSetPrefix;\r\n      let path = elem.getAttribute(\"massSetPath\").trim();\r\n\r\n      if (prefix.length > 0) {\r\n        prefix += \".\";\r\n      }\r\n\r\n      prefix += path;\r\n      con.massSetPrefix = prefix;\r\n    }\r\n  }\r\n\r\n  _container(elem, con, ignorePathPrefix=false) {\r\n    for (let k of this.inheritDomAttrKeys) {\r\n      if (elem.hasAttribute(k)) {\r\n        this.inheritDomAttrs[k] = elem.getAttribute(k);\r\n      }\r\n    }\r\n\r\n    let packflag = getPackFlag(elem);\r\n\r\n    con.packflag |= packflag;\r\n    con.inherit_packflag |= packflag;\r\n\r\n    this._basic(elem, con);\r\n\r\n    if (!ignorePathPrefix) {\r\n      this._handlePathPrefix(elem, con);\r\n    }\r\n  }\r\n  noteframe(elem) {\r\n    let ret = this.container.noteframe();\r\n\r\n    if (ret) {\r\n      this._basic(elem, ret);\r\n    }\r\n  }\r\n\r\n  cell(elem) {\r\n    this.push();\r\n    this.container = this.container.cell();\r\n    this._container(elem, this.container);\r\n    this.visit(elem);\r\n    this.pop();\r\n  }\r\n\r\n  table(elem) {\r\n    this.push();\r\n    this.container = this.container.table();\r\n    this._container(elem, this.container);\r\n    this.visit(elem);\r\n    this.pop();\r\n  }\r\n\r\n  panel(elem) {\r\n    let title = \"\" + elem.getAttribute(\"label\")\r\n    let closed = getbool(elem, \"closed\")\r\n\r\n    this.push()\r\n    this.container = this.container.panel(title);\r\n    this.container.closed = closed;\r\n\r\n    this._container(elem, this.container);\r\n\r\n    this.visit(elem)\r\n\r\n    this.pop();\r\n  }\r\n\r\n  pathlabel(elem) {\r\n    this._prop(elem, \"pathlabel\")\r\n  }\r\n\r\n  /**\r\n   handle a code element, which are wrapped in functions\r\n   */\r\n  code(elem) {\r\n    window._codelem = elem;\r\n\r\n    let buf = '';\r\n\r\n    for (let elem2 of elem.childNodes) {\r\n      if (elem2.nodeName === \"#text\") {\r\n        buf += elem2.textContent + '\\n';\r\n      }\r\n    }\r\n\r\n    var func, $scope = this.templateScope;\r\n\r\n    buf = `\r\nfunc = function() {\r\n  ${buf};\r\n}\r\n    `;\r\n\r\n    eval(buf);\r\n\r\n    let id = \"\" + elem.getAttribute(\"id\");\r\n\r\n    this.codefuncs[id] = func;\r\n  }\r\n\r\n  textbox(elem) {\r\n    if (elem.hasAttribute(\"path\")) {\r\n      this._prop(elem, 'textbox');\r\n    } else {\r\n      //let elem2 = this.container.textbox();\r\n      //this._basic(elem, elem2);\r\n    }\r\n  }\r\n\r\n  label(elem) {\r\n    let elem2 = this.container.label(elem.innerHTML);\r\n    this._basic(elem, elem2);\r\n  }\r\n\r\n  colorfield(elem) {\r\n    this._prop(elem, \"colorfield\");\r\n  }\r\n\r\n  /** simpleSliders=true enables simple sliders */\r\n  prop(elem) {\r\n    this._prop(elem, \"prop\")\r\n  }\r\n\r\n  _prop(elem, key) {\r\n    let packflag = getPackFlag(elem);\r\n    let path = elem.getAttribute(\"path\");\r\n\r\n    let elem2;\r\n    if (key === 'pathlabel') {\r\n      elem2 = this.container.pathlabel(path, elem.innerHTML, packflag);\r\n    } else if (key === 'textbox') {\r\n      elem2 = this.container.textbox(path, undefined, undefined, packflag);\r\n\r\n      elem2.update();\r\n\r\n      //make textboxes non-modal by default\r\n      if (elem.hasAttribute(\"modal\")) {\r\n        elem2.setAttribute(\"modal\", elem.getAttribute(\"modal\"));\r\n      }\r\n\r\n      if (elem.hasAttribute(\"realtime\")) {\r\n        elem2.setAttribute(\"realtime\", elem.getAttribute(\"realtime\"));\r\n      }\r\n    } else if (key === \"colorfield\") {\r\n      elem2 = this.container.colorPicker(path, {\r\n        packflag,\r\n        themeOverride: elem.hasAttribute(\"theme-class\") ? elem.getAttribute(\"theme-class\") : undefined\r\n      });\r\n    } else {\r\n      elem2 = this.container[key](path, packflag);\r\n    }\r\n\r\n    if (!elem2) {\r\n      elem2 = document.createElement(\"span\");\r\n      elem2.innerHTML = \"error\";\r\n      this.container.shadow.appendChild(elem2);\r\n    } else {\r\n      this._basic(elem, elem2);\r\n\r\n      if (elem.hasAttribute(\"massSetPath\") || this.container.massSetPrefix) {\r\n        let mpath = elem.getAttribute(\"massSetPath\");\r\n        if (!mpath) {\r\n          mpath = elem.getAttribute(\"path\");\r\n        }\r\n\r\n        mpath = this.container._getMassPath(this.container.ctx, path, mpath);\r\n\r\n        elem2.setAttribute(\"mass_set_path\", mpath);\r\n      }\r\n    }\r\n  }\r\n\r\n  strip(elem) {\r\n    this.push();\r\n\r\n    let dir;\r\n    if (elem.hasAttribute(\"mode\")) {\r\n      dir = elem.getAttribute(\"mode\").toLowerCase().trim();\r\n      dir = dir === \"horizontal\";\r\n    }\r\n\r\n    let margin1 = getfloat(elem, \"margin1\", undefined);\r\n    let margin2 = getfloat(elem, \"margin2\", undefined);\r\n\r\n    this.container = this.container.strip(undefined, margin1, margin2, dir);\r\n    this._container(elem, this.container);\r\n    this.visit(elem);\r\n\r\n    this.pop();\r\n  }\r\n\r\n  column(elem) {\r\n    this.push();\r\n    this.container = this.container.col();\r\n    this._container(elem, this.container);\r\n    this.visit(elem);\r\n    this.pop();\r\n  }\r\n\r\n  row(elem) {\r\n    this.push();\r\n    this.container = this.container.row();\r\n    this._container(elem, this.container);\r\n    this.visit(elem);\r\n    this.pop();\r\n  }\r\n\r\n  toolPanel(elem) {\r\n    this.tool(elem, \"toolPanel\");\r\n  }\r\n\r\n  tool(elem, key = \"tool\") {\r\n    let path = elem.getAttribute(\"path\");\r\n    let packflag = getPackFlag(elem);\r\n\r\n    let noIcons = false, iconflags;\r\n\r\n    if (getbool(elem, \"useIcons\")) {\r\n      packflag |= PackFlags.USE_ICONS;\r\n    } else if (elem.hasAttribute(\"useIcons\")) {\r\n      packflag &= ~PackFlags.USE_ICONS;\r\n      noIcons = true;\r\n    }\r\n\r\n    let label = (\"\" + elem.textContent).trim()\r\n    if (label.length > 0) {\r\n      path += \"|\" + label;\r\n    }\r\n\r\n    if (noIcons) {\r\n      iconflags = this.container.useIcons(false);\r\n    }\r\n\r\n    let elem2 = this.container[key](path, packflag);\r\n\r\n    if (elem2) {\r\n      this._basic(elem, elem2);\r\n    } else {\r\n      elem2 = document.createElement(\"strip\")\r\n      elem2.innerHTML = \"error\"\r\n      this.container.shadow.appendChild(elem2);\r\n      this._basic(elem, elem2);\r\n    }\r\n\r\n    if (noIcons) {\r\n      this.container.inherit_packflag |= iconflags;\r\n      this.container.packflag |= iconflags;\r\n    }\r\n  }\r\n\r\n  dropbox(elem) {\r\n    return this.menu(elem, true);\r\n  }\r\n\r\n  menu(elem, isDropBox = false) {\r\n    let packflag = getPackFlag(elem);\r\n    let title = elem.getAttribute(\"name\")\r\n\r\n    let list = [];\r\n\r\n    for (let child of elem.childNodes) {\r\n      if (child.tagName === \"tool\") {\r\n        let path = child.getAttribute(\"path\");\r\n        let label = child.innerHTML.trim();\r\n\r\n        if (label.length > 0) {\r\n          path += \"|\" + label;\r\n        }\r\n\r\n        list.push(path);\r\n      } else if (child.tagName === \"sep\") {\r\n        list.push(Menu.SEP);\r\n      } else if (child.tagName === \"item\") {\r\n        let id, icon, hotkey, description;\r\n\r\n        if (child.hasAttribute(\"id\")) {\r\n          id = child.getAttribute(\"id\");\r\n        }\r\n\r\n        if (child.hasAttribute(\"icon\")) {\r\n          icon = child.getAttribute(\"icon\").toUpperCase().trim();\r\n          icon = Icons[icon];\r\n        }\r\n\r\n        if (child.hasAttribute(\"hotkey\")) {\r\n          hotkey = child.getAttribute(\"hotkey\");\r\n        }\r\n\r\n        if (child.hasAttribute(\"description\")) {\r\n          description = child.getAttribute(\"description\");\r\n        }\r\n\r\n        list.push({\r\n          name: child.innerHTML.trim(),\r\n          id, icon, hotkey, description\r\n        });\r\n      }\r\n    }\r\n\r\n    let ret = this.container.menu(title, list, packflag);\r\n    if (isDropBox) {\r\n      ret.removeAttribute(\"simple\");\r\n    }\r\n\r\n    if (elem.hasAttribute(\"id\")) {\r\n      ret.setAttribute(\"id\", elem.getAttribute(\"id\"));\r\n    }\r\n\r\n    this._basic(elem, ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  button(elem) {\r\n    let title = elem.innerHTML.trim();\r\n\r\n    let ret = this.container.button(title);\r\n\r\n    if (elem.hasAttribute(\"id\")) {\r\n      ret.setAttribute(\"id\", elem.getAttribute(\"id\"));\r\n    }\r\n\r\n    this._basic(elem, ret);\r\n  }\r\n\r\n  iconbutton(elem) {\r\n    let title = elem.innerHTML.trim();\r\n\r\n    let icon = elem.getAttribute(\"icon\");\r\n    if (icon) {\r\n      icon = UIBase.getIconEnum()[icon];\r\n    }\r\n    let ret = this.container.iconbutton(icon, title);\r\n\r\n    if (elem.hasAttribute(\"id\")) {\r\n      ret.setAttribute(\"id\", elem.getAttribute(\"id\"));\r\n    }\r\n\r\n    this._basic(elem, ret);\r\n  }\r\n\r\n  tab(elem) {\r\n    this.push();\r\n\r\n    let title = \"\" + elem.getAttribute(\"label\");\r\n\r\n    let tabs = this.container;\r\n\r\n    this.container = this.container.tab(title);\r\n\r\n    if (elem.hasAttribute(\"overflow\")) {\r\n      this.container.setAttribute(\"overflow\", elem.getAttribute(\"overflow\"));\r\n    }\r\n\r\n    if (elem.hasAttribute(\"overflow-y\")) {\r\n      this.container.setAttribute(\"overflow-y\", elem.getAttribute(\"overflow-y\"));\r\n    }\r\n\r\n    this._container(elem, this.container)\r\n    this.visit(elem);\r\n\r\n    this.pop();\r\n  }\r\n\r\n  tabs(elem) {\r\n    let pos = elem.getAttribute(\"pos\") || \"left\"\r\n\r\n    this.push();\r\n\r\n    let tabs = this.container.tabs(pos)\r\n    this.container = tabs;\r\n\r\n    if (elem.hasAttribute(\"movable-tabs\")) {\r\n      tabs.setAttribute(\"movable-tabs\", elem.getAttribute(\"movable-tabs\"));\r\n    }\r\n\r\n    this._container(elem, tabs);\r\n    this.visit(elem);\r\n\r\n    this.pop();\r\n  }\r\n}\r\n\r\nexport function initPage(ctx, xml, parentContainer = undefined, templateVars = {}, templateScope = {}) {\r\n  let tree = parseXML(xml);\r\n  let container = UIBase.createElement(\"container-x\");\r\n\r\n  container.ctx = ctx;\r\n  if (ctx) {\r\n    container._init();\r\n  }\r\n\r\n  if (parentContainer) {\r\n    parentContainer.add(container);\r\n  }\r\n\r\n  let handler = new Handler(ctx, container);\r\n\r\n  handler.templateVars = Object.assign({}, templateVars);\r\n  handler.templateScope = templateScope;\r\n\r\n  handler.handle(tree);\r\n\r\n  return container;\r\n\r\n}\r\n\r\nexport function loadPage(ctx, url, parentContainer_or_args = undefined, loadSourceOnly = false,\r\n                         modifySourceCB, templateVars, templateScope) {\r\n  let source;\r\n  let parentContainer;\r\n\r\n  if (parentContainer_or_args !== undefined && !(parentContainer_or_args instanceof HTMLElement)) {\r\n    let args = parentContainer_or_args;\r\n\r\n    parentContainer = args.parentContainer;\r\n    loadSourceOnly = args.loadSourceOnly;\r\n    modifySourceCB = args.modifySourceCB;\r\n    templateVars = args.templateVars;\r\n    templateScope = args.templateScope;\r\n  } else {\r\n    parentContainer = parentContainer_or_args;\r\n  }\r\n\r\n  if (pagecache.has(url)) {\r\n    source = pagecache.get(url);\r\n\r\n    if (modifySourceCB) {\r\n      source = modifySourceCB(source);\r\n    }\r\n\r\n    return new Promise((accept, reject) => {\r\n      if (loadSourceOnly) {\r\n        accept(source);\r\n      } else {\r\n        accept(initPage(ctx, source, parentContainer, templateVars, templateScope));\r\n      }\r\n    });\r\n  } else {\r\n    return new Promise((accept, reject) => {\r\n      fetch(url).then(res => res.text()).then(data => {\r\n        pagecache.set(url, data);\r\n\r\n        if (modifySourceCB) {\r\n          data = modifySourceCB(data);\r\n        }\r\n\r\n        if (loadSourceOnly) {\r\n          accept(data);\r\n        } else {\r\n          accept(initPage(ctx, data, parentContainer, templateVars, templateScope));\r\n        }\r\n      });\r\n    });\r\n  }\r\n}\r\n","import {CurveConstructors} from \"./curve1d_base.js\";\r\nimport {EnumProperty} from \"../toolsys/toolprop.js\";\r\n\r\nexport function makeGenEnum() {\r\n  let enumdef = {};\r\n  let uinames = {};\r\n  let icons = {};\r\n\r\n  for (let cls of CurveConstructors) {\r\n    let def = cls.define();\r\n\r\n    let uiname = def.uiname;\r\n    uiname = uiname === undefined ? def.name : uiname;\r\n\r\n    enumdef[def.name] = cls.name;\r\n    uinames[def.name] = uiname;\r\n    icons[def.name] = def.icon !== undefined ? def.icon : -1;\r\n  }\r\n\r\n  //return enumdef;\r\n  return new EnumProperty(undefined, enumdef).addUINames(uinames).addIcons(icons);\r\n}\r\n","import {UIBase, Icons, saveUIData, loadUIData} from '../core/ui_base.js';\r\nimport {ColumnFrame, RowFrame} from \"../core/ui.js\";\r\nimport * as util from '../path-controller/util/util.js';\r\nimport {Vector2, Vector3} from \"../path-controller/util/vectormath.js\";\r\nimport {Curve1D, mySafeJSONStringify} from \"../path-controller/curve/curve1d.js\";\r\nimport {makeGenEnum} from '../path-controller/curve/curve1d_utils.js';\r\n\r\nexport class Curve1DWidget extends ColumnFrame {\r\n  #in_onchange = false;\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.useDataPathUndo = false;\r\n\r\n    this._on_draw = this._on_draw.bind(this);\r\n    this.drawTransform = [1.0, [0, 0]];\r\n\r\n    this._value = new Curve1D();\r\n    this.checkCurve1dEvents();\r\n\r\n    this.#in_onchange = 0;\r\n\r\n    this._value._on_change = (msg) => {\r\n      if (this.#in_onchange) {\r\n        return;\r\n      }\r\n\r\n      /* Prevent infinite recursion. */\r\n      this.#in_onchange++;\r\n\r\n      try {\r\n        if (this.hasAttribute(\"datapath\")) {\r\n          let path = this.getAttribute(\"datapath\");\r\n          if (this._value !== undefined) {\r\n            let val = this.getPathValue(this.ctx, path);\r\n\r\n            if (val) {\r\n              val.load(this._value);\r\n              this.setPathValue(this.ctx, path, val);\r\n            } else {\r\n              val = this._value.copy();\r\n              this.setPathValue(this.ctx, path, val);\r\n            }\r\n          }\r\n        }\r\n\r\n        if (this.onchange) {\r\n          this.onchange(this._value);\r\n        }\r\n      } catch (error) {\r\n        if (window.DEBUG && window.DEBUG.datapath) {\r\n          console.error(error.stack);\r\n          console.error(error.message);\r\n        }\r\n      }\r\n\r\n      this.#in_onchange--;\r\n\r\n      if (this.#in_onchange < 0) {\r\n        console.warn(\"this.#in_onchange was negative\");\r\n        this.#in_onchange = 0;\r\n      }\r\n    };\r\n\r\n    this._gen_type = undefined;\r\n    this._lastGen = undefined;\r\n\r\n    this._last_dpi = undefined;\r\n    this.canvas = document.createElement(\"canvas\");\r\n\r\n    this.g = this.canvas.getContext(\"2d\");\r\n    this.canvas.g = this.g;\r\n\r\n    window.cw = this;\r\n    this.shadow.appendChild(this.canvas);\r\n  }\r\n\r\n  /**\r\n   * Checks if a curve1d instance exists at dom attribute \"datapath\"\r\n   * and if it does adds curve1d event handlers to it.\r\n   *\r\n   * Note: it's impossible to know for sure that a widget is truly dead,\r\n   * e.g. it could be hidden in a panel or something.  Curve1d's event\r\n   * handling system takes a callback that checks if a callback should\r\n   * be removed, which we provide by testing this.isConnected.\r\n   *\r\n   * Since this is not robust we have to check regularly if we need to add\r\n   * Curve1D event handlers, which is why this function exists.\r\n   */\r\n  checkCurve1dEvents() {\r\n    if (!this._value.subscribed(\"draw\", this)) {\r\n      this._value.on(\"draw\", this._on_draw, this, () => !this.isConnected);\r\n    }\r\n\r\n    if (this.ctx && this.hasAttribute(\"datapath\")) {\r\n      let curve1d;\r\n\r\n      try {\r\n        curve1d = this.ctx.api.getValue(this.ctx, this.getAttribute(\"datapath\"));\r\n      } catch (error) {\r\n        if (window.DEBUG && window.DEBUG.datapath) {\r\n          console.error(error.stack);\r\n          console.error(error.message);\r\n        }\r\n      }\r\n\r\n      if (!curve1d) {\r\n        this.disabled = true;\r\n        return;\r\n      }\r\n\r\n      if (this.disabled) {\r\n        this.disabled = false;\r\n      }\r\n\r\n      if (!curve1d.subscribed(undefined, this)) {\r\n        curve1d.on(\"select\", (bspline1) => {\r\n          let bspline2 = this._value.getGenerator(\"BSplineCurve\");\r\n\r\n          for (let i = 0; i < bspline1.points.length; i++) {\r\n            if (i >= bspline2.length) {\r\n              break;\r\n            }\r\n            bspline2.points[i].flag = bspline1.points[i].flag;\r\n          }\r\n\r\n          bspline2.redraw();\r\n        });\r\n\r\n        curve1d.on(\"transform\", (bspline1) => {\r\n          let bspline2 = this._value.getGenerator(\"BSplineCurve\");\r\n\r\n          for (let i = 0; i < bspline1.points.length; i++) {\r\n            if (i >= bspline2.length) {\r\n              break;\r\n            }\r\n            bspline2.points[i].co.load(bspline1.points[i].co);\r\n          }\r\n\r\n          bspline2.update();\r\n          bspline2.updateKnots();\r\n          bspline2.redraw();\r\n        });\r\n\r\n        curve1d.on(\"update\", () => {\r\n          console.log(\"datapath curve1d update!\");\r\n          this._value.load(curve1d);\r\n          this.rebuild();\r\n        }, this, () => !this.isConnected);\r\n      }\r\n    }\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  _on_draw(e) {\r\n    let curve = e.data;\r\n\r\n    //console.log(\"draw\");\r\n    this._redraw();\r\n  }\r\n\r\n  set value(val) {\r\n    this._value.load(val);\r\n    this.update();\r\n    this._redraw();\r\n  }\r\n\r\n  _on_change() {\r\n    if (this.onchange) {\r\n      this.onchange(this);\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.useDataPathUndo = false;\r\n    let row = this.row();\r\n\r\n    let prop = makeGenEnum();\r\n\r\n    prop.setValue(this.value.generatorType);\r\n\r\n    this.dropbox = row.listenum(undefined, \"Type\", prop, this.value.generatorType, (id) => {\r\n      console.warn(\"SELECT\", id, prop.keys[id]);\r\n\r\n      this.value.setGenerator(id);\r\n      this.value._on_change(\"curve type change\");\r\n    });\r\n    this.dropbox._init();\r\n\r\n    row.iconbutton(Icons.ZOOM_OUT, \"Zoom Out\", () => {\r\n      let curve = this._value;\r\n      if (!curve) return;\r\n      //if (isNaN(curve.uiZoom))\r\n      //  curve.uiZoom = 1.0;\r\n\r\n      curve.uiZoom *= 0.9;\r\n      if (this.getAttribute(\"datapath\")) {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), curve);\r\n      }\r\n\r\n      this._redraw();\r\n    }).iconsheet = 0;\r\n    row.iconbutton(Icons.ZOOM_IN, \"Zoom In\", () => {\r\n      let curve = this._value;\r\n      if (!curve) return;\r\n      //if (isNaN(curve.uiZoom))\r\n      //  curve.uiZoom = 1.0;\r\n\r\n      curve.uiZoom *= 1.1;\r\n      if (this.getAttribute(\"datapath\")) {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), curve);\r\n      }\r\n\r\n      this._redraw();\r\n\r\n    }).iconsheet = 0;\r\n\r\n    this.container = this.col();\r\n\r\n    let panel = this.panel(\"Range\");\r\n\r\n    let clipCheck = panel.check(undefined, \"Clip To Range\");\r\n    clipCheck.onchange = (val) => {\r\n      this._value.clipToRange = val;\r\n      this._on_change();\r\n      this._redraw();\r\n    }\r\n    clipCheck.checked = this._value.clipToRange;\r\n\r\n    let xmin = panel.slider(undefined, \"X Min\", this._value.xRange[0], -10, 10, 0.1, false, undefined, (val) => {\r\n      this._value.xRange[0] = val.value;\r\n      this._on_change();\r\n      this._redraw();\r\n    });\r\n\r\n    let xmax = panel.slider(undefined, \"X Max\", this._value.xRange[1], -10, 10, 0.1, false, undefined, (val) => {\r\n      this._value.xRange[1] = val.value;\r\n      this._on_change();\r\n      this._redraw();\r\n    });\r\n\r\n    let ymin = panel.slider(undefined, \"Y Min\", this._value.yRange[0], -10, 10, 0.1, false, undefined, (val) => {\r\n      this._value.yRange[0] = val.value;\r\n      this._on_change();\r\n      this._redraw();\r\n    });\r\n\r\n    let ymax = panel.slider(undefined, \"Y Max\", this._value.yRange[1], -10, 10, 0.1, false, undefined, (val) => {\r\n      this._value.yRange[1] = val.value;\r\n      this._on_change();\r\n      this._redraw();\r\n    });\r\n\r\n    let last_update_key = \"\";\r\n    this.container.update.after(() => {\r\n      const xRange = this._value.xRange;\r\n      const yRange = this._value.yRange;\r\n      let key = \"\" + xRange[0] + \":\" + xRange[1]\r\n        + \":\" + yRange[0] + \":\" + yRange[1] + \":\" + this._value.clipToRange;\r\n\r\n      clipCheck.checked = this._value.clipToRange;\r\n\r\n      if (key !== last_update_key) {\r\n        last_update_key = key;\r\n\r\n        xmin.setValue(xRange[0]);\r\n        xmax.setValue(xRange[1]);\r\n\r\n        ymin.setValue(yRange[0]);\r\n        ymax.setValue(yRange[1]);\r\n      }\r\n    });\r\n\r\n    xmin.displayUnit = xmin.baseUnit = \"none\";\r\n    ymin.displayUnit = ymin.baseUnit = \"none\";\r\n    xmax.displayUnit = xmax.baseUnit = \"none\";\r\n    ymax.displayUnit = ymax.baseUnit = \"none\";\r\n\r\n    panel.closed = false;\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.style[\"width\"] = \"min-contents\";\r\n    this.style[\"height\"] = \"min-contents\";\r\n    this.updateSize();\r\n  }\r\n\r\n  updateSize() {\r\n    let dpi = UIBase.getDPI();\r\n    let w = ~~(this.getDefault(\"CanvasWidth\")*dpi);\r\n    let h = ~~(this.getDefault(\"CanvasHeight\")*dpi);\r\n\r\n    let bad = w !== this.canvas.width || h !== this.canvas.height;\r\n    bad = bad || dpi !== this._last_dpi;\r\n\r\n    if (!bad) {\r\n      return;\r\n    }\r\n\r\n    this._last_dpi = dpi;\r\n    this.canvas.width = w;\r\n    this.canvas.height = h;\r\n\r\n    this.canvas.style[\"width\"] = (w/dpi) + \"px\";\r\n    this.canvas.style[\"height\"] = (h/dpi) + \"px\";\r\n\r\n    this._redraw();\r\n  }\r\n\r\n  _redraw() {\r\n    //forcibly clear canvas, works better then clearRect\r\n    this.canvas.width = this.canvas.width;\r\n    this.canvas.height = this.canvas.height;\r\n\r\n    let canvas = this.canvas, g = this.g;\r\n\r\n    //g.clearRect(0, 0, canvas.width, canvas.height);\r\n    g.beginPath();\r\n    g.rect(0, 0, canvas.width, canvas.height);\r\n    g.fillStyle = this.getDefault(\"CanvasBG\");\r\n    g.fill();\r\n\r\n    g.save();\r\n\r\n    let zoom = this._value.uiZoom;\r\n    let scale = Math.max(canvas.width, canvas.height);\r\n\r\n    g.lineWidth /= scale;\r\n\r\n    this.drawTransform[0] = scale*zoom;\r\n    this.drawTransform[1][0] = 0.0;\r\n    this.drawTransform[1][1] = -1.0;\r\n\r\n    this.drawTransform[1][0] -= 0.5 - 0.5/zoom;\r\n    this.drawTransform[1][1] += 0.5 - 0.5/zoom;\r\n\r\n    //g.scale(scale, scale);\r\n\r\n    g.scale(this.drawTransform[0], -this.drawTransform[0]);\r\n    g.translate(this.drawTransform[1][0], this.drawTransform[1][1]);\r\n\r\n    g.lineWidth /= zoom;\r\n\r\n    this._value.draw(this.canvas, this.g, this.drawTransform);\r\n    g.restore();\r\n  }\r\n\r\n  rebuild() {\r\n    let ctx = this.ctx;\r\n    if (ctx === undefined || this.container === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.checkCurve1dEvents();\r\n\r\n    let uidata = saveUIData(this.container, \"curve1d\");\r\n\r\n    this._gen_type = this.value.generatorType;\r\n    let col = this.container;\r\n\r\n    if (this._lastGen !== undefined) {\r\n      this._lastGen.killGUI(col, this.canvas);\r\n    }\r\n\r\n    let onchange = this.dropbox.onchange;\r\n    this.dropbox.onchange = undefined\r\n    this.dropbox.setValue(this.value.generatorType);\r\n    this.dropbox.onchange = onchange;\r\n\r\n    col.clear();\r\n\r\n    let onSourceUpdate = () => {\r\n      if (!this.hasAttribute(\"datapath\")) {\r\n        return;\r\n      }\r\n\r\n      let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n      this._value.load(val);\r\n      this.rebuild();\r\n    };\r\n\r\n    let dpath = this.hasAttribute(\"datapath\") ? this.getAttribute(\"datapath\") : undefined;\r\n    let gen = this.value.generators.active;\r\n\r\n    /* Turn off data path callbacks. */\r\n    this.#in_onchange++;\r\n    try {\r\n      gen.makeGUI(col, this.canvas, this.drawTransform, dpath, onSourceUpdate);\r\n\r\n      loadUIData(this.container, uidata);\r\n      for (let i = 0; i < 4; i++) {\r\n        col.flushUpdate();\r\n      }\r\n    } catch (error) {\r\n      console.warn(error.stack);\r\n      console.warn(error.message);\r\n    }\r\n\r\n    this.#in_onchange--;\r\n\r\n    this._lastGen = gen;\r\n    this._redraw();\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n    let val = this.getPathValue(this.ctx, path);\r\n\r\n    if (this._lastu === undefined) {\r\n      this._lastu = 0;\r\n    }\r\n\r\n    if (val && !val.equals(this._value) && util.time_ms() - this._lastu > 200) {\r\n      this._lastu = util.time_ms();\r\n\r\n      this._value.load(val);\r\n      this.update();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  updateGenUI() {\r\n    let bad = this._lastGen !== this.value.generators.active;\r\n\r\n    if (bad) {\r\n      this.rebuild();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.checkCurve1dEvents();\r\n    this.updateDataPath();\r\n    this.updateSize();\r\n    this.updateGenUI();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"curve-widget-x\",\r\n      style  : \"curvewidget\"\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(Curve1DWidget);\r\n","//bind module to global var to get at it in console.\r\n//\r\n//note that require has an api for handling circular\r\n//module refs, in such cases do not use these vars.\r\n\r\nimport {CSSFont} from \"../core/ui_base.js\";\r\n\r\nvar _ui = undefined;\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as ui_widgets from './ui_widgets.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport '../path-controller/util/html5_fileapi.js';\r\nimport {ColumnFrame, RowFrame, Container} from \"../core/ui.js\";\r\n\r\nlet PropFlags = toolprop.PropFlags;\r\nlet PropSubTypes = toolprop.PropSubTypes;\r\n\r\nlet EnumProperty = toolprop.EnumProperty;\r\n\r\nlet Vector2   = vectormath.Vector2,\r\n    UIBase    = ui_base.UIBase,\r\n    PackFlags = ui_base.PackFlags,\r\n    PropTypes = toolprop.PropTypes;\r\n\r\n\r\n//methods to forward to this.contents\r\nlet forward_keys = new Set([\r\n  \"row\", \"col\", \"strip\", \"noteframe\", \"helppicker\", \"vecpopup\",\r\n  \"tabs\", \"table\", \"menu\", \"listbox\", \"panel\",\r\n  \"pathlabel\", \"label\", \"listenum\", \"check\", \"iconcheck\",\r\n  \"button\", \"iconbutton\", \"colorPicker\", \"twocol\",\r\n  \"treeview\", \"slider\", \"simpleslider\", \"curve1d\",\r\n  \"noteframe\", \"vecpopup\",\r\n  \"prop\", \"tool\", \"toolPanel\", \"textbox\", \"dynamicMenu\",\r\n  \"add\", \"prepend\", \"useIcons\", \"noMarginsOrPadding\", \"wrap\"\r\n]);\r\n\r\nexport class PanelFrame extends ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this.titleframe = super.row();\r\n\r\n    this.contents = super.col();\r\n    this.contents._remove = this.contents.remove;\r\n    this.contents.remove = () => {\r\n      this.remove();\r\n    };\r\n\r\n    this._panel = this; //compatibility alias\r\n\r\n    this.contents._panel = this;\r\n    this.iconcheck = UIBase.createElement(\"iconcheck-x\");\r\n    this.iconcheck.noEmboss = true;\r\n\r\n    Object.defineProperty(this.contents, \"closed\", {\r\n      get: () => {\r\n        return this.closed;\r\n      },\r\n\r\n      set: (v) => {\r\n        this.closed = v;\r\n      }\r\n    })\r\n\r\n    Object.defineProperty(this.contents, \"title\", {\r\n      get: () => this.titleframe.getAttribute(\"title\"),\r\n      set: (v) => this.setHeaderToolTip(v)\r\n    });\r\n\r\n    this.packflag = this.inherit_packflag = 0;\r\n\r\n    this._closed = false;\r\n\r\n    this.makeHeader();\r\n  }\r\n\r\n  get inherit_packflag() {\r\n    if (!this.contents) return;\r\n    return this.contents.inherit_packflag;\r\n  }\r\n\r\n  set inherit_packflag(val) {\r\n    if (!this.contents) return;\r\n    this.contents.inherit_packflag = val;\r\n  }\r\n\r\n  get packflag() {\r\n    if (!this.contents) return;\r\n    return this.contents.packflag;\r\n  }\r\n\r\n  set packflag(val) {\r\n    if (!this.contents) return;\r\n    this.contents.packflag = val;\r\n  }\r\n\r\n  appendChild(child) {\r\n    return this.contents.shadow.appendChild(child);\r\n  }\r\n\r\n  get headerLabel() {\r\n    return this.__label.text;\r\n  }\r\n\r\n  set headerLabel(v) {\r\n    this.__label.text = v;\r\n    this.__label._updateFont();\r\n\r\n    if (this.hasAttribute(\"label\")) {\r\n      this.setAttribute(\"label\", v);\r\n    }\r\n\r\n    if (this.ctx) {\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  get dataPrefix() {\r\n    return this.contents ? this.contents.dataPrefix : \"\";\r\n  }\r\n\r\n  set dataPrefix(v) {\r\n    if (this.contents) {\r\n      this.contents.dataPrefix = v;\r\n    }\r\n  }\r\n\r\n  get closed() {\r\n    return this._closed;\r\n  }\r\n\r\n  set closed(val) {\r\n    let update = !!val !== !!this.closed;\r\n    this._closed = val;\r\n\r\n    //console.log(\"closed set\", update);\r\n    if (update) {\r\n      this._updateClosed(true);\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname            : \"panelframe-x\",\r\n      style              : \"panel\",\r\n      subclassChecksTheme: true\r\n    };\r\n  }\r\n\r\n  setHeaderToolTip(tooltip) {\r\n    this.titleframe.setAttribute(\"title\", tooltip);\r\n\r\n    this.titleframe._forEachChildWidget((child) => {\r\n      child.setAttribute(\"title\", tooltip);\r\n    });\r\n  }\r\n\r\n  saveData() {\r\n    let ret = {\r\n      closed: this._closed\r\n    };\r\n\r\n    return Object.assign(super.saveData(), ret);\r\n  }\r\n\r\n  loadData(obj) {\r\n    if (!(\"closed\" in obj)) {\r\n      this.closed = obj._closed;\r\n    } else {\r\n      this.closed = obj.closed;\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this.contents.clear();\r\n    return this;\r\n  }\r\n\r\n  makeHeader() {\r\n    let row = this.titleframe;\r\n\r\n    let iconcheck = this.iconcheck;\r\n\r\n    if (!iconcheck) {\r\n      return;\r\n    }\r\n\r\n    iconcheck.overrideDefault(\"padding\", 0);\r\n\r\n    iconcheck.noMarginsOrPadding();\r\n\r\n    iconcheck.overrideDefault(\"highlight\", {\r\n      \"background-color\" : iconcheck.getSubDefault(\"highlight\", \"background-color\")\r\n    });\r\n\r\n    iconcheck.overrideDefault(\"background-color\", \"rgba(0,0,0,0)\");\r\n    iconcheck.overrideDefault(\"BoxDepressed\", \"rgba(0,0,0,0)\");\r\n    iconcheck.overrideDefault(\"border-color\", \"rgba(0,0,0,0)\");\r\n\r\n    iconcheck.ctx = this.ctx;\r\n    iconcheck._icon_pressed = ui_base.Icons.UI_EXPAND;\r\n    iconcheck._icon = ui_base.Icons.UI_COLLAPSE;\r\n    iconcheck.drawCheck = false;\r\n    iconcheck.iconsheet = ui_base.IconSheets.SMALL;\r\n    iconcheck.checked = this._closed;\r\n\r\n    this.iconcheck.onchange = (e) => {\r\n      this.closed = this.iconcheck.checked;\r\n    };\r\n\r\n    row._add(iconcheck);\r\n\r\n    //stupid css, let's just hackishly put \" \" to create spacing2\r\n\r\n    let onclick = (e) => {\r\n      iconcheck.checked = !iconcheck.checked;\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n    };\r\n\r\n    let label = this.__label = row.label(this.getAttribute(\"label\"));\r\n\r\n    this.__label.font = \"TitleText\";\r\n\r\n    label._updateFont();\r\n\r\n    label.noMarginsOrPadding();\r\n    label.addEventListener(\"mousedown\", onclick);\r\n    label.addEventListener(\"touchdown\", onclick);\r\n\r\n    let bs = this.getDefault(\"border-style\");\r\n\r\n    row.background = this.getDefault(\"TitleBackground\");\r\n    row.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n    row.style[\"border\"] = `${this.getDefault(\"border-width\")}px ${bs} ${this.getDefault(\"border-color\")}`;\r\n\r\n    row.style[\"padding-right\"] = \"20px\";\r\n    row.style[\"padding-left\"] = \"5px\";\r\n    row.style[\"padding-top\"] = this.getDefault(\"padding-top\") + \"px\";\r\n    row.style[\"padding-bottom\"] = this.getDefault(\"padding-bottom\") + \"px\";\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.background = this.getDefault(\"background-color\");\r\n    this.style[\"width\"] = \"100%\";\r\n\r\n    this.contents.ctx = this.ctx;\r\n    if (!this._closed) {\r\n      super.add(this.contents);\r\n      this.contents.flushUpdate();\r\n    }\r\n\r\n    this.contents.dataPrefix = this.dataPrefix;\r\n\r\n    //con.style[\"margin-left\"] = \"5px\";\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    if (!this.titleframe || !this.__label) {\r\n      return;\r\n    }\r\n\r\n    let getDefault = (key, defval) => {\r\n      let val = this.getDefault(key);\r\n      return val !== undefined ? val : defval;\r\n    };\r\n\r\n    let bs = this.getDefault(\"border-style\");\r\n\r\n    let header_radius = this.getDefault(\"HeaderRadius\");\r\n    if (header_radius === undefined) {\r\n      header_radius = this.getDefault(\"border-radius\");\r\n    }\r\n\r\n    let boxmargin = getDefault(\"padding\", 0);\r\n\r\n    let paddingleft = getDefault(\"padding-left\", 0);\r\n    let paddingright = getDefault(\"padding-right\", 0);\r\n\r\n    paddingleft += boxmargin;\r\n    paddingright += boxmargin;\r\n\r\n    this.titleframe.background = this.getDefault(\"TitleBackground\");\r\n    this.titleframe.style[\"border-radius\"] = header_radius + \"px\";\r\n    this.titleframe.style[\"border\"] = `${this.getDefault(\"border-width\")}px ${bs} ${this.getDefault(\"TitleBorder\")}`;\r\n    this.style[\"border\"] = `${this.getDefault(\"border-width\")}px ${bs} ${this.getDefault(\"border-color\")}`;\r\n    this.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n\r\n    this.titleframe.style[\"padding-top\"] = this.getDefault(\"padding-top\") + \"px\";\r\n    this.titleframe.style[\"padding-bottom\"] = this.getDefault(\"padding-bottom\") + \"px\";\r\n    this.titleframe.style[\"padding-left\"] = paddingleft + \"px\";\r\n    this.titleframe.style[\"padding-right\"] = paddingright + \"px\";\r\n    this.titleframe.style[\"margin-bottom\"] = \"0px\";\r\n    this.titleframe.style[\"margin-top\"] = \"0px\";\r\n\r\n    this.__label.style[\"border\"] = \"unset\";\r\n    this.__label.style[\"border-radius\"] = \"unset\";\r\n\r\n    let bg = this.getDefault(\"background-color\");\r\n\r\n    this.background = bg;\r\n    this.contents.background = bg;\r\n    this.contents.parentWidget = this;\r\n    this.contents.style[\"background-color\"] = bg;\r\n    this.style[\"background-color\"] = bg;\r\n\r\n    let margintop, marginbottom;\r\n\r\n    if (this._closed) {\r\n      margintop = getDefault('margin-top-closed', 0);\r\n      marginbottom = getDefault('margin-bottom-closed', 5);\r\n    } else {\r\n      margintop = getDefault('margin-top', 0);\r\n      marginbottom = getDefault('margin-bottom', 0);\r\n    }\r\n\r\n    let marginleft = getDefault('margin-left', 0);\r\n    let marginright = getDefault('margin-right', 0);\r\n\r\n    this.style['margin-left'] = marginleft + \"px\";\r\n    this.style['margin-right'] = marginright + \"px\";\r\n\r\n    this.style['margin-top'] = margintop + \"px\";\r\n    this.style['margin-bottom'] = marginbottom + \"px\";\r\n\r\n    //this.style[\"padding-left\"] = paddingleft + \"px\";\r\n    //this.style[\"padding-right\"] = paddingright + \"px\";\r\n\r\n    this.__label._updateFont();\r\n  }\r\n\r\n  on_disabled() {\r\n    super.on_disabled();\r\n\r\n    this.__label._updateFont();\r\n    this.setCSS();\r\n  }\r\n\r\n  on_enabled() {\r\n    super.on_enabled();\r\n\r\n    this.__label.setCSS();\r\n    this.__label.style[\"color\"] = this.style[\"color\"];\r\n    this.setCSS();\r\n  }\r\n\r\n  update() {\r\n    let text = this.getAttribute(\"label\");\r\n\r\n    let update = text !== this.__label.text;\r\n\r\n    if (this.checkThemeUpdate()) {\r\n      update = true;\r\n      this._setVisible(this.closed, true);\r\n      this.setCSS();\r\n      this.flushSetCSS();\r\n    }\r\n\r\n    if (update) {\r\n      this.headerLabel = this.getAttribute(\"label\")\r\n\r\n      this.__label._updateFont();\r\n      this.setCSS();\r\n    }\r\n\r\n    super.update();\r\n  }\r\n\r\n  _onchange(isClosed) {\r\n    if (this.onchange) {\r\n      this.onchange(isClosed);\r\n    }\r\n\r\n    if (this.contents.onchange) {\r\n      this.contents.onchange(isClosed);\r\n    }\r\n  }\r\n\r\n  //catch setAttribute so we can detect label update\r\n  //even if close and updates disabled\r\n  setAttribute(key, value) {\r\n    let ret = super.setAttribute(key, value);\r\n\r\n    if (this.ctx) {\r\n      this.update();\r\n      this.flushUpdate();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  get noUpdateClosedContents() {\r\n    if (!this.hasAttribute(\"update-closed-contents\")) {\r\n      return false;\r\n    }\r\n\r\n    let ret = this.getAttribute(\"update-closed-contents\");\r\n    return ret === \"true\" || ret === \"on\";\r\n  }\r\n\r\n  set noUpdateClosedContents(v) {\r\n    this.setAttribute(\"update-closed-contents\", v ? \"true\" : \"false\");\r\n  }\r\n\r\n  _setVisible(isClosed, changed) {\r\n    changed = changed || !!isClosed !== !!this._closed;\r\n\r\n    this._state = isClosed;\r\n\r\n    if (isClosed) {\r\n      this.contents.style.display = \"none\";\r\n\r\n      //this.contents._remove();\r\n      //this.contents.hide(true);\r\n      if (!this.noUpdateClosedContents) {\r\n        this.contents.packflag |= PackFlags.NO_UPDATE;\r\n      }\r\n    } else {\r\n      //this.contents.hide(false);\r\n      this.contents.style.display = \"flex\";\r\n      this.contents.packflag &= ~PackFlags.NO_UPDATE;\r\n      this.contents.flushUpdate();\r\n    }\r\n\r\n    this.contents.hidden = isClosed;\r\n\r\n    if (this.parentWidget) {\r\n      this.parentWidget.flushUpdate();\r\n    } else {\r\n      this.flushUpdate();\r\n    }\r\n\r\n    if (changed) {\r\n      this._onchange(isClosed);\r\n    }\r\n\r\n    /*\r\n    for (let c of this.shadow.childNodes) {\r\n      if (c !== this.titleframe) {\r\n        c.hidden = state;\r\n      }\r\n    }*/\r\n  }\r\n\r\n  _updateClosed(changed) {\r\n    this._setVisible(this._closed, changed);\r\n\r\n    if (this.iconcheck) {\r\n      this.iconcheck.checked = this._closed;\r\n    }\r\n  }\r\n}\r\n\r\n\r\nlet makeForward = (k) => {\r\n  return function() {\r\n    return this.contents[k](...arguments);\r\n  }\r\n};\r\n\r\nfor (let k of forward_keys) {\r\n  PanelFrame.prototype[k] = makeForward(k);\r\n}\r\n\r\nUIBase.internalRegister(PanelFrame);\r\n","\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as ui from '../core/ui.js';\r\nimport {PropTypes} from '../path-controller/toolsys/toolprop.js';\r\nimport {keymap} from '../path-controller/util/simple_events.js';\r\nimport cconst from '../config/const.js';\r\nimport {color2web, web2color, validateWebColor} from \"../core/ui_base.js\";\r\n\r\nlet Vector2 = vectormath.Vector2,\r\n    Vector3 = vectormath.Vector3,\r\n    Vector4 = vectormath.Vector4,\r\n    Matrix4 = vectormath.Matrix4;\r\n\r\nexport {rgb_to_hsv, hsv_to_rgb} from \"../path-controller/util/colorutils.js\";\r\nimport {rgb_to_hsv, hsv_to_rgb, cmyk_to_rgb, rgb_to_cmyk} from \"../path-controller/util/colorutils.js\";\r\nimport {contextWrangler} from '../screen/area_wrangler.js';\r\n\r\nlet UIBase     = ui_base.UIBase,\r\n    PackFlags  = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nlet UPW = 1.25, VPW = 0.75;\r\n\r\n//*\r\nlet sample_rets = new util.cachering(() => [0, 0], 64);\r\n\r\nexport function inv_sample(u, v) {\r\n  let ret = sample_rets.next();\r\n\r\n  ret[0] = Math.pow(u, UPW);\r\n  ret[1] = Math.pow(v, VPW);\r\n\r\n  return ret;\r\n}\r\n\r\nexport function sample(u, v) {\r\n  let ret = sample_rets.next();\r\n\r\n  ret[0] = Math.pow(u, 1.0/UPW);\r\n  ret[1] = Math.pow(v, 1.0/VPW);\r\n\r\n  return ret;\r\n}\r\n\r\n//*/\r\n\r\n/* shared methods for clipboard handling */\r\nfunction colorClipboardCopy() {\r\n  let rgba = this.getRGBA();\r\n\r\n  let r = rgba[0]*255;\r\n  let g = rgba[1]*255;\r\n  let b = rgba[2]*255;\r\n  let a = rgba[3];\r\n\r\n  let data = `rgba(${r.toFixed(4)}, ${g.toFixed(4)}, ${b.toFixed(4)}, ${a.toFixed(4)})`;\r\n  //cconst.setClipboardData(\"color\", \"text/css\", data);\r\n\r\n  cconst.setClipboardData(\"color\", \"text/plain\", data);\r\n}\r\n\r\nfunction colorClipboardPaste() {\r\n  let data = cconst.getClipboardData(\"text/plain\");\r\n\r\n  if (!data || !validateCSSColor(\"\" + data.data)) {// || data.mime !== \"text/css\") {\r\n    return;\r\n  }\r\n\r\n  let color;\r\n\r\n  try {\r\n    color = css2color(data.data);\r\n  } catch (error) {\r\n    //not a color\r\n    console.log(error.stack);\r\n    console.log(error.message);\r\n  }\r\n\r\n  if (color) {\r\n    if (color.length < 4) {\r\n      color.push(1.0);\r\n    }\r\n\r\n    this.setRGBA(color);\r\n  }\r\n}\r\n\r\nlet fieldrand = new util.MersenneRandom(0);\r\n\r\nlet huefields = {};\r\n\r\nexport function getHueField(width, height, dpi) {\r\n  let key = width + \":\" + height + \":\" + dpi.toFixed(4);\r\n\r\n  if (key in huefields) {\r\n    return huefields[key];\r\n  }\r\n\r\n  let field = new ImageData(width, height);\r\n  let idata = field.data;\r\n\r\n  for (let i = 0; i < width*height; i++) {\r\n    let ix = i%width, iy = ~~(i/width);\r\n    let idx = i*4;\r\n\r\n    let rgb = hsv_to_rgb(ix/width, 1, 1);\r\n\r\n    idata[idx] = rgb[0]*255;\r\n    idata[idx + 1] = rgb[1]*255;\r\n    idata[idx + 2] = rgb[2]*255;\r\n    idata[idx + 3] = 255;\r\n  }\r\n\r\n  //*\r\n  let canvas = document.createElement(\"canvas\");\r\n  canvas.width = field.width;\r\n  canvas.height = field.height;\r\n  let g = canvas.getContext(\"2d\");\r\n  g.putImageData(field, 0, 0);\r\n  field = canvas;\r\n  //*/\r\n\r\n  huefields[key] = field;\r\n  return field;\r\n}\r\n\r\nlet fields = {};\r\n\r\nexport function getFieldImage(fieldsize, width, height, hsva) {\r\n  fieldrand.seed(0);\r\n\r\n  /* render field at half res and upscale via canvas2d */\r\n  let width2 = width>>1;\r\n  let height2 = height>>1;\r\n  let fieldsize2 = fieldsize>>1;\r\n\r\n  let hue = hsva[0];\r\n  let hue_rgb = hsv_to_rgb(hue, 1.0, 1.0);\r\n  let key = fieldsize + \":\" + width2 + \":\" + height2 + \":\" + hue.toFixed(5);\r\n\r\n  if (key in fields)\r\n    return fields[key];\r\n\r\n  let size2 = fieldsize2;\r\n  let valpow = 0.75;\r\n\r\n  let image = {\r\n    width : width,\r\n    height: height,\r\n    image : new ImageData(fieldsize2, fieldsize2),\r\n\r\n    x2sat: (x) => {\r\n      return Math.min(Math.max(x/width, 0), 1);\r\n    },\r\n    y2val: (y) => {\r\n      y = 1.0 - Math.min(Math.max(y/height, 0), 1);\r\n\r\n      return y === 0.0 ? 0.0 : y**valpow;\r\n    },\r\n    sat2x: (s) => {\r\n      return s*width;\r\n    },\r\n    val2y: (v) => {\r\n      if (v === 0)\r\n        return height;\r\n\r\n      v = v**(1.0/valpow);\r\n      return (1.0 - v)*height;\r\n    }\r\n  };\r\n\r\n  image.params = {\r\n    box: {\r\n      x     : 0,\r\n      y     : 0,\r\n      width : width,\r\n      height: height\r\n    }\r\n  };\r\n\r\n  let idata = image.image.data;\r\n  for (let i = 0; i < idata.length; i += 4) {\r\n    let i2 = i/4;\r\n    let x = i2%size2, y = ~~(i2/size2);\r\n\r\n    let v = 1.0 - (y/size2);\r\n    let s = (x/size2);\r\n\r\n    let rgb = hsv_to_rgb(hsva[0], s, v**valpow);\r\n\r\n    idata[i] = rgb[0]*255;\r\n    idata[i + 1] = rgb[1]*255;\r\n    idata[i + 2] = rgb[2]*255;\r\n    idata[i + 3] = 255;\r\n  }\r\n\r\n  //*\r\n  let image2 = document.createElement(\"canvas\");\r\n  image2.width = size2;\r\n  image2.height = size2;\r\n  let g = image2.getContext(\"2d\");\r\n  g.putImageData(image.image, 0, 0);\r\n  //*/\r\n  image.canvas = image2;\r\n  image.scale = width/size2;\r\n\r\n  fields[key] = image;\r\n  return image;\r\n}\r\n\r\n\r\nlet _update_temp = new Vector4();\r\n\r\nexport class SimpleBox {\r\n  constructor(pos = [0, 0], size = [1, 1]) {\r\n    this.pos = new Vector2(pos);\r\n    this.size = new Vector2(size);\r\n    this.r = 0;\r\n  }\r\n}\r\n\r\nexport class HueField extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.g = this.canvas.getContext(\"2d\");\r\n    this.shadow.appendChild(this.canvas);\r\n\r\n    let setFromXY = (x, y) => {\r\n      let dpi = this.getDPI();\r\n      let pad = this._getPad();\r\n\r\n      let w = this.canvas.width/dpi - pad*2.0;\r\n      x -= pad;\r\n\r\n      let h = x/w;\r\n      h = Math.min(Math.max(h, 0.0), 1.0);\r\n\r\n      this.hsva[0] = h;\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.hsva);\r\n      }\r\n\r\n      this._redraw();\r\n    };\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Left\"]:\r\n        case keymap[\"Right\"]:\r\n          let sign = e.keyCode === keymap[\"Left\"] ? -1 : 1;\r\n\r\n          this.hsva[0] = Math.min(Math.max(this.hsva[0] + 0.05*sign, 0.0), 1.0);\r\n          this._redraw();\r\n\r\n          if (this.onchange) {\r\n            this.onchange();\r\n          }\r\n          break;\r\n      }\r\n    });\r\n\r\n    this.addEventListener(\"mousedown\", (e) => {\r\n      if (this.modalRunning) {\r\n        return;\r\n      }\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n\r\n      let rect = this.canvas.getClientRects()[0];\r\n      let x = e.clientX - rect.x, y = e.clientY - rect.y;\r\n\r\n      setFromXY(x, y);\r\n\r\n      this.pushModal({\r\n        on_mousemove: (e) => {\r\n          let rect = this.canvas.getClientRects()[0];\r\n          let x = e.clientX - rect.x, y = e.clientY - rect.y;\r\n\r\n          setFromXY(x, y);\r\n        },\r\n        on_mousedown: (e) => {\r\n          this.popModal();\r\n        },\r\n        on_mouseup  : (e) => {\r\n          this.popModal();\r\n        },\r\n        on_keydown  : (e) => {\r\n          if (e.keyCode === keymap[\"Enter\"] || e.keyCode === keymap[\"Escape\"] || e.keyCode === keymap[\"Space\"]) {\r\n            this.popModal();\r\n          }\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n\r\n  static define() {\r\n    return {\r\n      tagname          : \"huefield-x\",\r\n      style            : \"colorfield\",\r\n      havePickClipboard: true\r\n    };\r\n  }\r\n\r\n  getRGBA() {\r\n    let rgb = hsv_to_rgb(this.hsva[0], this.hsva[1], this.hsva[2]);\r\n    return new Vector4().loadXYZW(rgb[0], rgb[1], rgb[2], this.hsva[3]);\r\n  }\r\n\r\n  setRGBA(rgba) {\r\n    let hsv = rgb_to_hsv(rgba[0], rgba[1], rgba[2]);\r\n    this.hsva.loadXYZW(hsv[0], hsv[1], hsv[2], rgba[3]);\r\n\r\n    this._redraw();\r\n\r\n    if (this.onchange) {\r\n      this.onchange(this.hsva);\r\n    }\r\n  }\r\n\r\n  clipboardCopy() {\r\n    colorClipboardCopy.apply(this, arguments);\r\n  }\r\n\r\n  clipboardPaste() {\r\n    colorClipboardPaste.apply(this, arguments);\r\n  }\r\n\r\n  _getPad() {\r\n    return Math.max(this.getDefault(\"circleSize\"), 15);\r\n  }\r\n\r\n  _redraw() {\r\n    let g = this.g, canvas = this.canvas;\r\n    let dpi = this.getDPI();\r\n\r\n    let w = this.getDefault(\"width\");\r\n    let h = this.getDefault(\"hueHeight\");\r\n\r\n    canvas.width = ~~(w*dpi);\r\n    canvas.height = ~~(h*dpi);\r\n\r\n    canvas.style[\"width\"] = w + \"px\";\r\n    canvas.style[\"height\"] = h + \"px\";\r\n\r\n    /* create horizontal padding to make selection of\r\n     *  endpoint hue easier */\r\n\r\n    let rselector = ~~(this._getPad()*dpi); //~~(this.getDefault(\"circleSize\")*dpi);\r\n    let r_circle = this.getDefault(\"circleSize\")*dpi;\r\n\r\n    let w2 = canvas.width, h2 = canvas.height;\r\n\r\n    w2 -= rselector*2.0;\r\n\r\n    //g.drawImage(getHueField(w2, h2, dpi), 0, 0, w2, h2, rselector*2, 0, w2, h2);\r\n    g.drawImage(getHueField(w2, h2, dpi), 0, 0, w2, h2, rselector, 0, w2, h2);\r\n\r\n    let x = this.hsva[0]*w2 + rselector;\r\n    let y = canvas.height*0.5;\r\n\r\n    g.beginPath();\r\n    g.arc(x, y, r_circle, -Math.PI, Math.PI);\r\n    g.closePath();\r\n\r\n    g.strokeStyle = \"white\";\r\n    g.lineWidth = 3*dpi;\r\n    g.stroke();\r\n\r\n    g.strokeStyle = \"grey\";\r\n    g.lineWidth = 1*dpi;\r\n    g.stroke();\r\n\r\n    if (this.disabled) {\r\n      g.beginPath();\r\n      g.fillStyle = \"rgba(25,25,25,0.75)\"\r\n      g.rect(0, 0, this.canvas.width, this.canvas.height);\r\n      g.fill();\r\n    }\r\n  }\r\n\r\n  on_disabled() {\r\n    this._redraw();\r\n  }\r\n\r\n  on_enabled() {\r\n    this._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(HueField);\r\n\r\nexport class SatValField extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.hsva = [0, 0, 0, 1];\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.g = this.canvas.getContext(\"2d\");\r\n    this.shadow.appendChild(this.canvas);\r\n\r\n    this.onchange = undefined;\r\n\r\n    let setFromXY = (x, y) => {\r\n      let field = this._getField();\r\n      let r = ~~(this.getDefault(\"circleSize\")*this.getDPI());\r\n\r\n      let sat = field.x2sat(x - r);\r\n      let val = field.y2val(y - r);\r\n\r\n      this.hsva[1] = sat;\r\n      this.hsva[2] = val;\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.hsva);\r\n      }\r\n\r\n      this._redraw();\r\n    };\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Left\"]:\r\n        case keymap[\"Right\"]: {\r\n          let sign = e.keyCode === keymap[\"Left\"] ? -1 : 1;\r\n\r\n          this.hsva[1] = Math.min(Math.max(this.hsva[1] + 0.05*sign, 0.0), 1.0);\r\n          this._redraw();\r\n\r\n          if (this.onchange) {\r\n            this.onchange(this.hsva);\r\n          }\r\n\r\n          break;\r\n        }\r\n\r\n        case keymap[\"Up\"]:\r\n        case keymap[\"Down\"]: {\r\n          let sign = e.keyCode === keymap[\"Down\"] ? -1 : 1;\r\n\r\n          this.hsva[2] = Math.min(Math.max(this.hsva[2] + 0.05*sign, 0.0), 1.0);\r\n          this._redraw();\r\n\r\n          if (this.onchange) {\r\n            this.onchange(this.hsva);\r\n          }\r\n          break;\r\n        }\r\n      }\r\n    });\r\n\r\n    this.canvas.addEventListener(\"mousedown\", (e) => {\r\n      if (this.modalRunning) {\r\n        return;\r\n      }\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n\r\n      let rect = this.canvas.getClientRects()[0];\r\n      let x = e.clientX - rect.x, y = e.clientY - rect.y;\r\n\r\n      setFromXY(x, y);\r\n\r\n      this.pushModal({\r\n        on_pointermove(e) {\r\n          this.on_mousemove(e);\r\n        },\r\n        on_mousemove: (e) => {\r\n          let rect = this.canvas.getClientRects()[0];\r\n          if (rect === undefined) {\r\n            return;\r\n          }\r\n\r\n          let x = e.clientX - rect.x, y = e.clientY - rect.y;\r\n\r\n          setFromXY(x, y);\r\n        },\r\n        on_mousedown: (e) => {\r\n          this.popModal();\r\n        },\r\n        on_mouseup  : (e) => {\r\n          this.popModal();\r\n        },\r\n        on_keydown  : (e) => {\r\n          if (e.keyCode === keymap[\"Enter\"] || e.keyCode === keymap[\"Escape\"] || e.keyCode === keymap[\"Space\"]) {\r\n            this.popModal();\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    this.canvas.addEventListener(\"touchstart\", (e) => {\r\n      if (this.modalRunning) {\r\n        return;\r\n      }\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n\r\n      let rect = this.canvas.getClientRects()[0];\r\n      let x = e.touches[0].clientX - rect.x, y = e.touches[0].clientY - rect.y;\r\n\r\n      setFromXY(x, y);\r\n\r\n      this.pushModal({\r\n        on_mousemove  : (e) => {\r\n          let rect = this.canvas.getClientRects()[0];\r\n          let x, y;\r\n\r\n          if (e.touches && e.touches.length) {\r\n            x = e.touches[0].clientX - rect.x;\r\n            y = e.touches[0].clientY - rect.y;\r\n          } else {\r\n            x = e.x;\r\n            y = e.y;\r\n          }\r\n\r\n          setFromXY(x, y);\r\n        },\r\n        on_touchmove  : (e) => {\r\n          let rect = this.canvas.getClientRects()[0];\r\n          let x = e.touches[0].clientX - rect.x, y = e.touches[0].clientY - rect.y;\r\n\r\n          setFromXY(x, y);\r\n        },\r\n        on_mousedown  : (e) => {\r\n          this.popModal();\r\n        },\r\n        on_touchcancel: (e) => {\r\n          this.popModal();\r\n        },\r\n        on_touchend   : (e) => {\r\n          this.popModal();\r\n        },\r\n        on_mouseup    : (e) => {\r\n          this.popModal();\r\n        },\r\n        on_keydown    : (e) => {\r\n          if (e.keyCode === keymap[\"Enter\"] || e.keyCode === keymap[\"Escape\"] || e.keyCode === keymap[\"Space\"]) {\r\n            this.popModal();\r\n          }\r\n        }\r\n      });\r\n    })\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname          : \"satvalfield-x\",\r\n      style            : \"colorfield\",\r\n      havePickClipboard: true\r\n    };\r\n  }\r\n\r\n  getRGBA() {\r\n    let rgb = hsv_to_rgb(this.hsva[0], this.hsva[1], this.hsva[2]);\r\n    return new Vector4().loadXYZW(rgb[0], rgb[1], rgb[2], this.hsva[3]);\r\n  }\r\n\r\n  setRGBA(rgba) {\r\n    let hsv = rgb_to_hsv(rgba[0], rgba[1], rgba[2]);\r\n    this.hsva.loadXYZW(hsv[0], hsv[1], hsv[2], rgba[3]);\r\n\r\n    this.update(true);\r\n    this._redraw();\r\n\r\n    if (this.onchange) {\r\n      this.onchange(this.hsva);\r\n    }\r\n  }\r\n\r\n  clipboardCopy() {\r\n    colorClipboardCopy.apply(this, arguments);\r\n  }\r\n\r\n  clipboardPaste() {\r\n    colorClipboardPaste.apply(this, arguments);\r\n  }\r\n\r\n  _getField() {\r\n    let dpi = this.getDPI();\r\n    let canvas = this.canvas;\r\n    let r = this.getDefault(\"circleSize\");\r\n    let w = this.getDefault(\"width\");\r\n    let h = this.getDefault(\"height\");\r\n\r\n    //r = ~~(r*dpi);\r\n\r\n    return getFieldImage(this.getDefault(\"fieldSize\"), w - r*2, h - r*2, this.hsva);\r\n  }\r\n\r\n  update(force_update = false) {\r\n    super.update();\r\n\r\n    if (force_update) {\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _redraw() {\r\n    let g = this.g, canvas = this.canvas;\r\n    let dpi = this.getDPI();\r\n\r\n    let w = this.getDefault(\"width\");\r\n    let h = this.getDefault(\"height\");\r\n\r\n    canvas.width = ~~(w*dpi);\r\n    canvas.height = ~~(h*dpi);\r\n\r\n    canvas.style[\"width\"] = w + \"px\";\r\n    canvas.style[\"height\"] = h + \"px\";\r\n    //SatValField\r\n\r\n    let rselector = ~~(this.getDefault(\"circleSize\")*dpi);\r\n\r\n    let field = this._getField()\r\n    let image = field.canvas;\r\n\r\n    g.globalAlpha = 1.0;\r\n    g.beginPath();\r\n    g.rect(0, 0, canvas.width, canvas.height);\r\n    g.fillStyle = \"rgb(200, 200, 200)\";\r\n    g.fill();\r\n\r\n    g.beginPath();\r\n\r\n    let steps = 17;\r\n    let dx = canvas.width/steps;\r\n    let dy = canvas.height/steps;\r\n\r\n    for (let i = 0; i < steps*steps; i++) {\r\n      let x = (i%steps)*dx, y = (~~(i/steps))*dy;\r\n\r\n      if (i%2 === 0) {\r\n        continue;\r\n      }\r\n      g.rect(x, y, dx, dy);\r\n    }\r\n\r\n    g.fillStyle = \"rgb(110, 110, 110)\";\r\n    g.fill();\r\n\r\n    g.globalAlpha = this.hsva[3];\r\n    g.drawImage(image, 0, 0, image.width, image.height, rselector, rselector, canvas.width - rselector*2, canvas.height - rselector*2);\r\n\r\n    let hsva = this.hsva;\r\n\r\n    let x = field.sat2x(hsva[1])*dpi + rselector;\r\n    let y = field.val2y(hsva[2])*dpi + rselector;\r\n    let r = rselector;\r\n\r\n    g.beginPath();\r\n    g.arc(x, y, r, -Math.PI, Math.PI);\r\n    g.closePath();\r\n\r\n    g.strokeStyle = \"white\";\r\n    g.lineWidth = 3*dpi;\r\n    g.stroke();\r\n\r\n    g.strokeStyle = \"grey\";\r\n    g.lineWidth = 1*dpi;\r\n    g.stroke();\r\n\r\n    if (this.disabled) {\r\n      g.beginPath();\r\n      g.fillStyle = \"rgba(25,25,25,0.75)\";\r\n      g.rect(0, 0, this.canvas.width, this.canvas.height);\r\n      g.fill();\r\n    }\r\n  }\r\n\r\n  on_disabled() {\r\n    this._redraw();\r\n  }\r\n\r\n  on_enabled() {\r\n    this._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(SatValField);\r\n\r\nexport class ColorField extends ui.ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this.hsva = new Vector4([0.05, 0.6, 0.15, 1.0]);\r\n    this.rgba = new Vector4([0, 0, 0, 0]);\r\n\r\n    this._recalcRGBA();\r\n\r\n    this._lastThemeStyle = this.constructor.define().style;\r\n\r\n    /*\r\n    this.hbox = new SimpleBox();\r\n    this.svbox = new SimpleBox();\r\n    //*/\r\n\r\n    this._last_dpi = undefined;\r\n\r\n    let satvalfield = this.satvalfield = UIBase.createElement(\"satvalfield-x\");\r\n    satvalfield.hsva = this.hsva;\r\n\r\n    let huefield = this.huefield = UIBase.createElement(\"huefield-x\");\r\n    huefield.hsva = this.hsva;\r\n\r\n    huefield.onchange = (e) => {\r\n      this.satvalfield._redraw();\r\n      this._recalcRGBA();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.rgba);\r\n      }\r\n    };\r\n\r\n    satvalfield.onchange = (e) => {\r\n      this._recalcRGBA();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.rgba);\r\n      }\r\n    };\r\n\r\n    this._add(satvalfield);\r\n    this._add(huefield);\r\n    //this.shadow.appendChild(canvas);\r\n    //this.shadow.appendChild(huecanvas);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"colorfield-x\",\r\n      style  : \"colorfield\"\r\n    };\r\n  }\r\n\r\n  setCMYK(c, m, y, k) {\r\n    let rgb = cmyk_to_rgb(c, m, y, k);\r\n    let hsv = rgb_to_hsv(rgb[0], rgb[1], rgb[2]);\r\n\r\n    this.setHSVA(hsv[0], hsv[1], hsv[2], this.hsva[3]);\r\n  }\r\n\r\n  getCMYK() {\r\n    let rgb = hsv_to_rgb(this.hsva[0], this.hsva[1], this.hsva[2]);\r\n    return rgb_to_cmyk(rgb[0], rgb[1], rgb[2]);\r\n  }\r\n\r\n  setHSVA(h, s, v, a = 1.0, fire_onchange = true) {\r\n    this.hsva[0] = h;\r\n    this.hsva[1] = s;\r\n    this.hsva[2] = v;\r\n    this.hsva[3] = a;\r\n\r\n    this._recalcRGBA();\r\n    this.update(true);\r\n\r\n    if (this.onchange && fire_onchange) {\r\n      this.onchange(this.hsva, this.rgba);\r\n    }\r\n  }\r\n\r\n  _recalcRGBA() {\r\n    let ret = hsv_to_rgb(this.hsva[0], this.hsva[1], this.hsva[2]);\r\n\r\n    this.rgba[0] = ret[0];\r\n    this.rgba[1] = ret[1];\r\n    this.rgba[2] = ret[2];\r\n    this.rgba[3] = this.hsva[3];\r\n\r\n    return this;\r\n  }\r\n\r\n  updateDPI(force_update = false, _in_update = false) {\r\n    let dpi = this.getDPI();\r\n\r\n    let update = force_update;\r\n    update = update || dpi != this._last_dpi;\r\n\r\n    if (update) {\r\n      this._last_dpi = dpi;\r\n\r\n      if (!_in_update)\r\n        this._redraw();\r\n\r\n      return true;\r\n    }\r\n  }\r\n\r\n  getRGBA() {\r\n    let rgb = hsv_to_rgb(this.hsva[0], this.hsva[1], this.hsva[2]);\r\n    return new Vector4().loadXYZW(rgb[0], rgb[1], rgb[2], this.hsva[3]);\r\n  }\r\n\r\n  setRGBA(r, g, b, a = 1.0, fire_onchange = true) {\r\n    if (typeof r === \"object\") {\r\n      g = r[1];\r\n      b = r[2];\r\n      a = r[3];\r\n      r = r[0];\r\n    }\r\n\r\n    let hsv = rgb_to_hsv(r, g, b);\r\n\r\n    this.hsva[0] = hsv[0];\r\n    this.hsva[1] = hsv[1];\r\n    this.hsva[2] = hsv[2];\r\n    this.hsva[3] = a;\r\n\r\n    this._recalcRGBA();\r\n    this.update(true);\r\n\r\n    if (this.onchange && fire_onchange) {\r\n      this.onchange(this.hsva, this.rgba);\r\n    }\r\n  }\r\n\r\n  updateThemeOverride() {\r\n    let theme = this.getStyleClass();\r\n    if (theme === this._lastThemeStyle) {\r\n      return false;\r\n    }\r\n\r\n    this._lastThemeStyle = theme;\r\n    this.huefield.overrideClass(theme);\r\n    this.satvalfield.overrideClass(theme);\r\n\r\n    for (let i=0; i<3; i++) {\r\n      this.flushSetCSS();\r\n      this.flushUpdate();\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  update(force_update = false) {\r\n    super.update();\r\n\r\n    this.updateThemeOverride();\r\n\r\n    let redraw = this.updateDPI(force_update, true);\r\n    redraw = redraw || force_update;\r\n\r\n    if (redraw) {\r\n      this.satvalfield.update(true);\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.style[\"flex-grow\"] = this.getDefault(\"flex-grow\");\r\n  }\r\n\r\n  _redraw() {\r\n    this.satvalfield._redraw();\r\n    this.huefield._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ColorField);\r\n\r\nexport class ColorPicker extends ui.ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this._lastThemeStyle = this.constructor.define().style;\r\n  }\r\n\r\n  //*\r\n  get hsva() {\r\n    return this.field.hsva;\r\n  }\r\n\r\n  get rgba() {\r\n    return this.field.rgba;\r\n  }//*/\r\n\r\n  set description(val) {\r\n    //do not allow setting description of the colorpicker container\r\n  }\r\n\r\n  static setDefault(node) {\r\n    let tabs, colorsPanel = node;\r\n\r\n    if (node.getClassDefault(\"usePanels\")) {\r\n      let panel = colorsPanel = node.panel(\"Color\");\r\n      tabs = panel.tabs();\r\n      panel.closed = true;\r\n\r\n      panel.style[\"flex-grow\"] = \"unset\";\r\n\r\n      /* force compactness */\r\n      panel.titleframe.style[\"flex-grow\"] = \"unset\";\r\n      //panel.titleframe.style[\"align-items\"] = \"unset\";\r\n    } else {\r\n      tabs = node.tabs();\r\n    }\r\n\r\n    node.cssText = node.textbox();\r\n    node.cssText.onchange = (val) => {\r\n      let ok = validateWebColor(val);\r\n      if (!ok) {\r\n        node.cssText.flash(\"red\");\r\n        return;\r\n      } else {\r\n        node.cssText.flash(\"green\");\r\n      }\r\n\r\n      val = val.trim();\r\n\r\n      let color = web2color(val);\r\n\r\n      node._no_update_textbox = true;\r\n      node.field.setRGBA(color[0], color[1], color[2], color[3]);\r\n      node._setSliders();\r\n\r\n      node._no_update_textbox = false;\r\n    };\r\n\r\n    //tabs.overrideDefault(\"background-color\", node.getDefault(\"background-color\"));\r\n\r\n    let tab = tabs.tab(\"HSV\");\r\n\r\n    node.h = tab.slider(undefined, \"Hue\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let hsva = node.hsva;\r\n      node.setHSVA(e.value, hsva[1], hsva[2], hsva[3]);\r\n    });\r\n\r\n    node.s = tab.slider(undefined, \"Saturation\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let hsva = node.hsva;\r\n      node.setHSVA(hsva[0], e.value, hsva[2], hsva[3]);\r\n    });\r\n    node.v = tab.slider(undefined, \"Value\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let hsva = node.hsva;\r\n      node.setHSVA(hsva[0], hsva[1], e.value, hsva[3]);\r\n    });\r\n    node.a = tab.slider(undefined, \"Alpha\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let hsva = node.hsva;\r\n      node.setHSVA(hsva[0], hsva[1], hsva[2], e.value);\r\n    });\r\n\r\n    node.h.baseUnit = node.h.displayUnit = \"none\";\r\n    node.s.baseUnit = node.s.displayUnit = \"none\";\r\n    node.v.baseUnit = node.v.displayUnit = \"none\";\r\n    node.a.baseUnit = node.a.displayUnit = \"none\";\r\n\r\n    tab = tabs.tab(\"RGB\");\r\n\r\n    node.r = tab.slider(undefined, \"R\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let rgba = node.rgba;\r\n      node.setRGBA(e.value, rgba[1], rgba[2], rgba[3]);\r\n    });\r\n    node.g = tab.slider(undefined, \"G\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let rgba = node.rgba;\r\n      node.setRGBA(rgba[0], e.value, rgba[2], rgba[3]);\r\n    });\r\n    node.b = tab.slider(undefined, \"B\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let rgba = node.rgba;\r\n      node.setRGBA(rgba[0], rgba[1], e.value, rgba[3]);\r\n    });\r\n    node.a2 = tab.slider(undefined, \"Alpha\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let rgba = node.rgba;\r\n      node.setRGBA(rgba[0], rgba[1], rgba[2], e.value);\r\n    });\r\n\r\n    node.r.baseUnit = node.r.displayUnit = \"none\";\r\n    node.g.baseUnit = node.g.displayUnit = \"none\";\r\n    node.b.baseUnit = node.b.displayUnit = \"none\";\r\n    node.a2.baseUnit = node.a2.displayUnit = \"none\";\r\n\r\n    if (!node.getDefault(\"noCMYK\")) {\r\n      tab = tabs.tab(\"CMYK\")\r\n      let cmyk = node.getCMYK();\r\n\r\n      let makeCMYKSlider = (label, idx) => {\r\n        let slider = tab.slider(undefined, {\r\n          name      : label,\r\n          min       : 0.0,\r\n          max       : 1.0,\r\n          is_int    : false,\r\n          defaultval: cmyk[idx],\r\n          callback  : (e) => {\r\n            let cmyk = node.getCMYK();\r\n            cmyk[idx] = e.value;\r\n            node.setCMYK(cmyk[0], cmyk[1], cmyk[2], cmyk[3]);\r\n          },\r\n          step      : 0.001\r\n        });\r\n\r\n        slider.baseUnit = slider.displayUnit = \"none\";\r\n\r\n        return slider;\r\n      }\r\n\r\n      node.cmyk = [\r\n        makeCMYKSlider(\"C\", 0),\r\n        makeCMYKSlider(\"M\", 1),\r\n        makeCMYKSlider(\"Y\", 2),\r\n        makeCMYKSlider(\"K\", 3),\r\n      ];\r\n    }\r\n\r\n    node._setSliders();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname            : \"colorpicker-x\",\r\n      style              : \"colorfield\",\r\n      havePickClipboard  : true,\r\n      copyForAllChildren : true,\r\n      pasteForAllChildren: true,\r\n    };\r\n  }\r\n\r\n  clipboardCopy() {\r\n    colorClipboardCopy.apply(this, arguments);\r\n  }\r\n\r\n  clipboardPaste() {\r\n    colorClipboardPaste.apply(this, arguments);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.field = UIBase.createElement(\"colorfield-x\");\r\n    this.field.setAttribute(\"class\", \"colorpicker\");\r\n\r\n    this.field.packflag |= this.inherit_packflag;\r\n    this.field.packflag |= this.packflag;\r\n\r\n    this.field.onchange = () => {\r\n      this._setDataPath();\r\n      this._setSliders();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.field.rgba);\r\n      }\r\n    };\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n      .colorpicker {\r\n        background-color : ${this.getDefault(\"background-color\")};\r\n      }\r\n    `;\r\n\r\n    this._style = style;\r\n\r\n    let cb = this.colorbox = document.createElement(\"div\");\r\n    cb.style[\"width\"] = \"100%\";\r\n    cb.style[\"height\"] = this.getDefault(\"colorBoxHeight\") + \"px\";\r\n    cb.style[\"background-color\"] = \"black\";\r\n\r\n    this.shadow.appendChild(style);\r\n    this.field.ctx = this.ctx;\r\n\r\n    this.add(this.colorbox);\r\n    this.add(this.field);\r\n\r\n    this.style[\"width\"] = this.getDefault(\"width\") + \"px\";\r\n  }\r\n\r\n  updateColorBox() {\r\n    let r = this.field.rgba[0], g = this.field.rgba[1], b = this.field.rgba[2];\r\n    //let a = this.field.rgba[3];\r\n\r\n    r = ~~(r*255);\r\n    g = ~~(g*255);\r\n    b = ~~(b*255);\r\n\r\n    let css = `rgb(${r},${g},${b})`;\r\n    this.colorbox.style[\"background-color\"] = css;\r\n  }\r\n\r\n  _setSliders() {\r\n    if (this.h === undefined) {\r\n      //setDefault() wasn't called\r\n      console.warn(\"colorpicker ERROR\");\r\n      return;\r\n    }\r\n\r\n    let hsva = this.field.hsva;\r\n    this.h.setValue(hsva[0], false);\r\n    this.s.setValue(hsva[1], false);\r\n    this.v.setValue(hsva[2], false);\r\n    this.a.setValue(hsva[3], false);\r\n\r\n    let rgba = this.field.rgba;\r\n\r\n    this.r.setValue(rgba[0], false);\r\n    this.g.setValue(rgba[1], false);\r\n    this.b.setValue(rgba[2], false);\r\n    this.a2.setValue(rgba[3], false);\r\n\r\n    if (this.cmyk) {\r\n      let cmyk = this.field.getCMYK();\r\n\r\n      for (let i = 0; i < 4; i++) {\r\n        this.cmyk[i].setValue(cmyk[i], false);\r\n      }\r\n    }\r\n\r\n    this.updateColorBox();\r\n\r\n    if (!this._no_update_textbox) {\r\n      this.cssText.text = color2web(this.field.rgba);\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (val === undefined) {\r\n      //console.warn(\"Bad datapath\", this.getAttribute(\"datapath\"));\r\n      this.internalDisabled = true;\r\n      return;\r\n    }\r\n\r\n    this.internalDisabled = false;\r\n\r\n    _update_temp.load(val);\r\n\r\n    if (prop.type === PropTypes.VEC3) {\r\n      _update_temp[3] = 1.0;\r\n    }\r\n\r\n    if (_update_temp.vectorDistance(this.field.rgba) > 0.01) {\r\n      this.field.setRGBA(_update_temp[0], _update_temp[1], _update_temp[2], _update_temp[3], false);\r\n      this._setSliders();\r\n      this.field.update(true);\r\n    }\r\n  }\r\n\r\n  updateThemeOverride() {\r\n    let theme = this.getStyleClass();\r\n    if (theme === this._lastThemeStyle) {\r\n      return false;\r\n    }\r\n\r\n    this._lastThemeStyle = theme;\r\n    this.field.overrideClass(theme);\r\n\r\n    this.flushSetCSS();\r\n    this.flushUpdate();\r\n\r\n    return true;\r\n  }\r\n\r\n  update() {\r\n    this.updateThemeOverride();\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n\r\n    super.update();\r\n  }\r\n\r\n  _setDataPath() {\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n      if (prop === undefined) {\r\n        console.warn(\"Bad data path for color field:\", this.getAttribute(\"datapath\"));\r\n      }\r\n\r\n      let val = this.field.rgba;\r\n      if (prop !== undefined && prop.type === PropTypes.VEC3) {\r\n        val = new Vector3();\r\n        val.load(this.field.rgba);\r\n      }\r\n\r\n      this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), val);\r\n    }\r\n  }\r\n\r\n  getCMYK() {\r\n    return this.field.getCMYK();\r\n  }\r\n\r\n  setCMYK(c, m, y, k) {\r\n    this.field.setCMYK(c, m, y, k);\r\n    this._setSliders();\r\n    this._setDataPath();\r\n  }\r\n\r\n  setHSVA(h, s, v, a) {\r\n    this.field.setHSVA(h, s, v, a);\r\n    this._setSliders();\r\n    this._setDataPath();\r\n  }\r\n\r\n  getRGBA() {\r\n    return this.field.getRGBA();\r\n  }\r\n\r\n  setRGBA(r, g, b, a) {\r\n    this.field.setRGBA(r, g, b, a)\r\n    this._setSliders();\r\n    this._setDataPath();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ColorPicker);\r\n\r\n\r\nexport class ColorPickerButton extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._highlight = false;\r\n    this._depress = false;\r\n    this._label = \"error\";\r\n\r\n    this.customLabel = undefined;\r\n\r\n    this.rgba = new Vector4([1, 1, 1, 1]);\r\n\r\n    this.labelDom = document.createElement(\"span\");\r\n    this.labelDom.textContent = this._label;\r\n    this.dom = document.createElement(\"canvas\");\r\n    this.g = this.dom.getContext(\"2d\");\r\n\r\n    this.shadow.appendChild(this.labelDom);\r\n    this.shadow.appendChild(this.dom);\r\n  }\r\n\r\n  get label() {\r\n    return this._label;\r\n  }\r\n\r\n  set label(val) {\r\n    this._label = val;\r\n    this.labelDom.textContent = val;\r\n  }\r\n\r\n  get font() {\r\n    return this._font;\r\n  }\r\n\r\n  set font(val) {\r\n    this._font = val;\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  get noLabel() {\r\n    let ret = \"\" + this.getAttribute(\"no-label\");\r\n    ret = ret.toLowerCase();\r\n\r\n    return ret === \"true\" || ret === \"yes\" || ret === \"on\";\r\n  }\r\n\r\n  set noLabel(v) {\r\n    if (this.labelDom) {\r\n      this.labelDom.hidden = true; //will be deleted later\r\n    }\r\n\r\n    this.setAttribute(\"no-label\", v ? \"true\" : \"false\");\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname          : \"color-picker-button-x\",\r\n      style            : \"colorpickerbutton\",\r\n      havePickClipboard: true\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this._font = \"DefaultText\"; //this.getDefault(\"defaultFont\");\r\n\r\n    let enter = (e) => {\r\n      this._highlight = true;\r\n      this._redraw();\r\n    }\r\n\r\n    let leave = (e) => {\r\n      this._highlight = false;\r\n      this._redraw();\r\n    }\r\n\r\n    this.addEventListener(\"pointerover\", enter, {capture: true, passive: true});\r\n    this.addEventListener(\"pointerout\", leave, {capture: true, passive: true});\r\n    this.addEventListener(\"focus\", leave, {capture: true, passive: true});\r\n\r\n\r\n    this.addEventListener(\"mousedown\", (e) => {\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n\r\n      this.click(e);\r\n    });\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  clipboardCopy() {\r\n    colorClipboardCopy.apply(this, arguments);\r\n  }\r\n\r\n  clipboardPaste() {\r\n    colorClipboardPaste.apply(this, arguments);\r\n  }\r\n\r\n  getRGBA() {\r\n    return this.rgba;\r\n  }\r\n\r\n  click(e) {\r\n    this.abortToolTips(4000);\r\n    console.warn(\"CLICK COLORPICKER\");\r\n    this.blur();\r\n\r\n    if (this.onclick) {\r\n      this.onclick(e);\r\n    }\r\n\r\n    let colorpicker = this.ctx.screen.popup(this, this);\r\n    let ctx = contextWrangler.makeSafeContext(this.ctx);\r\n\r\n    colorpicker.ctx = ctx;\r\n    colorpicker.useDataPathUndo = this.useDataPathUndo;\r\n\r\n    let path = this.hasAttribute(\"datapath\") ? this.getAttribute(\"datapath\") : undefined;\r\n\r\n    let widget = colorpicker.colorPicker(path, undefined, this.getAttribute(\"mass_set_path\"));\r\n\r\n    widget.ctx = ctx;\r\n    widget._init();\r\n    widget.setRGBA(this.rgba[0], this.rgba[1], this.rgba[2], this.rgba[3]);\r\n\r\n    widget.style[\"padding\"] = \"20px\";\r\n\r\n    let onchange = () => {\r\n      this.rgba.load(widget.rgba);\r\n      this.redraw();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this);\r\n      }\r\n    }\r\n\r\n    widget.onchange = onchange;\r\n\r\n    colorpicker.style[\"background-color\"] = widget.getDefault(\"background-color\");\r\n    //colorpicker.style[\"border-radius\"] = \"25px\";\r\n    colorpicker.style[\"border-width\"] = widget.getDefault(\"border-width\");\r\n  }\r\n\r\n  setRGBA(val) {\r\n    let a = this.rgba[3];\r\n\r\n    let old = new Vector4(this.rgba);\r\n\r\n    this.rgba.load(val);\r\n\r\n    if (val.length < 4) {\r\n      this.rgba[3] = a;\r\n    }\r\n\r\n    if (this.rgba.vectorDistance(old) < 0.001) {\r\n      return;\r\n    }\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this.rgba);\r\n    }\r\n\r\n    if (this.onchange) {\r\n      this.onchange();\r\n    }\r\n\r\n    this._redraw();\r\n    return this;\r\n  }\r\n\r\n  on_disabled() {\r\n    this.setCSS();\r\n    this._redraw();\r\n  }\r\n\r\n  _redraw() {\r\n    let canvas = this.dom, g = this.g;\r\n\r\n    g.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    if (this.disabled) {\r\n      let color = \"rgb(55, 55, 55)\";\r\n\r\n      g.save();\r\n\r\n      ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"fill\", color);\r\n      ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"clip\");\r\n      let steps = 5;\r\n      let dt = canvas.width/steps, t = 0;\r\n\r\n      g.beginPath();\r\n      g.lineWidth = 2;\r\n      g.strokeStyle = \"black\";\r\n\r\n      for (let i = 0; i < steps; i++, t += dt) {\r\n        g.moveTo(t, 0);\r\n        g.lineTo(t + dt, canvas.height);\r\n        g.moveTo(t + dt, 0);\r\n        g.lineTo(t, canvas.height);\r\n      }\r\n\r\n      g.stroke();\r\n      g.restore();\r\n      return;\r\n    }\r\n\r\n    //do checker pattern for alpha\r\n    g.save();\r\n\r\n    let grid1 = \"rgb(100, 100, 100)\";\r\n    let grid2 = \"rgb(175, 175, 175)\";\r\n\r\n    ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"clip\");\r\n    ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"fill\", grid1);\r\n\r\n    let cellsize = 10;\r\n    let totx = Math.ceil(canvas.width/cellsize), toty = Math.ceil(canvas.height/cellsize);\r\n\r\n    ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"clip\", undefined, undefined, true);\r\n    g.clip();\r\n\r\n    g.beginPath();\r\n    for (let x = 0; x < totx; x++) {\r\n      for (let y = 0; y < toty; y++) {\r\n        if ((x + y) & 1) {\r\n          continue;\r\n        }\r\n\r\n        g.rect(x*cellsize, y*cellsize, cellsize, cellsize);\r\n      }\r\n    }\r\n\r\n    g.fillStyle = grid2;\r\n    g.fill();\r\n\r\n    //g.fillStyle = \"orange\";\r\n    //g.beginPath();\r\n    //g.rect(0, 0, canvas.width, canvas.height);\r\n    //g.fill();\r\n\r\n    let color = color2css(this.rgba);\r\n    ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"fill\", color, undefined, true);\r\n    //drawRoundBox(elem, canvas, g, width, height, r=undefined, op=\"fill\", color=undefined, pad=undefined) {\r\n\r\n    if (this._highlight) {\r\n      //let color = \"rgba(200, 200, 255, 0.5)\";\r\n      let color = this.getDefault(\"BoxHighlight\");\r\n      ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"fill\", color);\r\n    }\r\n\r\n    g.restore();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    let w = this.getDefault(\"width\");\r\n    let h = this.getDefault(\"height\");\r\n    let dpi = this.getDPI();\r\n\r\n    this.style[\"width\"] = \"min-contents\" + \"px\";\r\n    this.style[\"height\"] = h + \"px\";\r\n\r\n    this.style[\"flex-direction\"] = \"row\";\r\n    this.style[\"display\"] = \"flex\";\r\n\r\n    this.labelDom.style[\"color\"] = this.getDefault(this._font).color;\r\n    this.labelDom.style[\"font\"] = ui_base.getFont(this, undefined, this._font, false);\r\n\r\n    let canvas = this.dom;\r\n\r\n    canvas.style[\"width\"] = w + \"px\";\r\n    canvas.style[\"height\"] = h + \"px\";\r\n    canvas.width = ~~(w*dpi);\r\n    canvas.height = ~~(h*dpi);\r\n\r\n    this.style[\"background-color\"] = \"rgba(0,0,0,0)\";\r\n    this._redraw();\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!(this.hasAttribute(\"datapath\"))) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n    let prop = this.getPathMeta(this.ctx, path);\r\n\r\n    if ((prop === undefined || prop.data === undefined) && cconst.DEBUG.verboseDataPath) {\r\n      console.log(\"bad path\", path);\r\n      return;\r\n    } else if (prop === undefined) {\r\n      let redraw = !this.disabled;\r\n\r\n      this.internalDisabled = true;\r\n\r\n      if (redraw) {\r\n        this._redraw();\r\n      }\r\n      return;\r\n    }\r\n\r\n    let redraw = this.disabled;\r\n\r\n    this.internalDisabled = false;\r\n\r\n    if (this.customLabel === undefined && prop.uiname !== this._label) {\r\n      this.label = prop.uiname;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, path);\r\n\r\n    if (val === undefined) {\r\n      redraw = redraw || this.disabled !== true;\r\n\r\n      this.internalDisabled = true;\r\n\r\n      if (redraw) {\r\n        this._redraw();\r\n      }\r\n\r\n    } else {\r\n      this.internalDisabled = false;\r\n\r\n      let dis;\r\n\r\n      if (val.length === 3) {\r\n        dis = Vector3.prototype.vectorDistance.call(val, this.rgba);\r\n      } else {\r\n        dis = this.rgba.vectorDistance(val);\r\n      }\r\n\r\n      if (dis > 0.0001) {\r\n        if (prop.type === PropTypes.VEC3) {\r\n          this.rgba.load(val);\r\n          this.rgba[3] = 1.0;\r\n        } else {\r\n          this.rgba.load(val);\r\n        }\r\n\r\n        redraw = true;\r\n      }\r\n\r\n      if (redraw) {\r\n        this._redraw();\r\n      }\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    if (this.noLabel && this.labelDom.isConnected) {\r\n      this.labelDom.remove();\r\n    }\r\n\r\n    if (this.customLabel !== undefined && this.customLabel !== this._label) {\r\n      this.label = this.customLabel;\r\n    }\r\n\r\n    for (let i = 0; i < this.rgba.length; i++) {\r\n      if (this.rgba[i] === undefined) {\r\n        console.warn(\"corrupted color or alpha detected\", this.rgba);\r\n        this.rgba[i] = 1.0;\r\n      }\r\n    }\r\n\r\n    let key = \"\" + this.rgba[0].toFixed(4) + \" \" + this.rgba[1].toFixed(4) + \" \" + this.rgba[2].toFixed(4) + \" \" + this.rgba[3].toFixed(4);\r\n    key += this.disabled;\r\n\r\n    if (key !== this._last_key) {\r\n      this._last_key = key;\r\n      this.redraw();\r\n    }\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n  }\r\n\r\n  redraw() {\r\n    this._redraw();\r\n  }\r\n};\r\nUIBase.internalRegister(ColorPickerButton);\r\n","\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as ui from '../core/ui.js';\r\nimport {loadUIData, saveUIData} from '../core/ui_base.js';\r\nimport {keymap} from '../path-controller/util/events.js';\r\n\r\nlet UIBase      = ui_base.UIBase,\r\n    PackFlags   = ui_base.PackFlags,\r\n    IconSheets  = ui_base.IconSheets,\r\n    iconmanager = ui_base.iconmanager;\r\n\r\nexport let tab_idgen = 1;\r\nlet debug = false;\r\nlet Vector2 = vectormath.Vector2;\r\n\r\nfunction getpx(css) {\r\n  return parseFloat(css.trim().replace(\"px\", \"\"))\r\n}\r\n\r\nlet FAKE_TAB_ID = Symbol(\"fake_tab_id\");\r\n\r\n\r\nclass TabDragEvent extends PointerEvent {\r\n}\r\n\r\n\r\n/* subclass HTMLElement so tabs can be used as the .target\r\n*  member of events*/\r\nexport class TabItem extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.name = name;\r\n    this.icon = undefined;\r\n    this.tooltip = \"\";\r\n    this.movable = true;\r\n    this.tbar = undefined;\r\n\r\n    this.ontabclick = null;\r\n    this.ontabdragstart = null;\r\n    this.ontabdragmove = null;\r\n    this.ontabdragend = null;\r\n\r\n    let helper = (key) => {\r\n      let key2 = \"on\" + key;\r\n\r\n      this.addEventListener(key, (e) => {\r\n        if (this[key2]) {\r\n          return this[key2](e);\r\n        }\r\n      });\r\n    }\r\n\r\n    helper(\"tabclick\");\r\n    helper(\"tabdragstart\");\r\n    helper(\"tabdragmove\");\r\n    helper(\"tabdragend\");\r\n\r\n    this.dom = undefined;\r\n    this.extra = undefined;\r\n    this.extraSize = undefined;\r\n\r\n    this.size = new Vector2();\r\n    this.pos = new Vector2();\r\n\r\n    this.abssize = new Vector2();\r\n    this.abspos = new Vector2();\r\n\r\n\r\n    this.addEventListener(\"pointerdown\", (e) => {\r\n      this.parentWidget.on_pointerdown(e);\r\n    });\r\n\r\n    this.addEventListener(\"pointermove\", (e) => {\r\n      this.parentWidget.on_pointermove(e);\r\n    });\r\n\r\n    this.addEventListener(\"pointerup\", (e) => {\r\n      this.parentWidget.on_pointerup(e);\r\n    });\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap.Enter:\r\n        case keymap.Space:\r\n          this.parentWidget.setActive(this, e);\r\n          break;\r\n      }\r\n    });\r\n  }\r\n\r\n  init() {\r\n    this.tabIndex = 1;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"tab-item-x\"\r\n    }\r\n  }\r\n\r\n  sendEvent(type, forwardEvent) {\r\n    let cls;\r\n\r\n    if (type === \"tabdragstart\" || type === \"tabdragend\") {\r\n      cls = TabDragEvent;\r\n    } else if (forwardEvent && forwardEvent instanceof Event) {\r\n      cls = forwardEvent.constructor;\r\n    } else {\r\n      cls = PointerEvent;\r\n    }\r\n\r\n    let e2 = {};\r\n\r\n    if (forwardEvent) {\r\n      for (let k in forwardEvent) {\r\n        if (k === \"defaultPrevented\" || k === \"cancelBubble\") {\r\n          continue;\r\n        }\r\n\r\n        e2[k] = forwardEvent[k];\r\n      }\r\n    }\r\n\r\n    e2.target = this;\r\n\r\n    e2 = new cls(type, e2);\r\n\r\n    this.dispatchEvent(e2);\r\n    return e2;\r\n  }\r\n\r\n  getClientRects() {\r\n    let r = this.tbar.getClientRects()[0];\r\n\r\n    let s = this.abssize, p = this.abspos;\r\n\r\n    s.load(this.size);\r\n    p.load(this.pos);\r\n\r\n    if (r) {\r\n      p[0] += r.x;\r\n      p[1] += r.y;\r\n    }\r\n\r\n    return [{\r\n      x  : p[0], y: p[1], width: s[0], height: s[1], left: p[0],\r\n      top: p[1], right: p[0] + s[0], bottom: p[1] + s[1]\r\n    }];\r\n  }\r\n\r\n  setCSS() {\r\n    let dpi = UIBase.getDPI();\r\n    let x = this.pos[0]/dpi;\r\n    let y = this.pos[1]/dpi;\r\n    let w = this.size[0]/dpi;\r\n    let h = this.size[1]/dpi;\r\n\r\n    if (this == this.parentWidget.tabs.active) {\r\n      this.style[\"focus-border-width\"] = \"0px\";\r\n    } else {\r\n      this.style[\"focus-border-width\"] = \"2px\";\r\n    }\r\n\r\n    this.style[\"background-color\"] = \"transparent\";\r\n\r\n    this.style[\"margin\"] = this.style[\"padding\"] = \"0px\";\r\n    this.style[\"position\"] = \"absolute\";\r\n    this.style[\"pointer-events\"] = \"auto\";\r\n\r\n    this.style[\"left\"] = x + \"px\";\r\n    this.style[\"top\"] = y + \"px\";\r\n    this.style[\"width\"] = w + \"px\";\r\n    this.style[\"height\"] = h + \"px\";\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(TabItem);\r\n\r\nexport class ModalTabMove extends events.EventHandler {\r\n  constructor(tab, tbar, dom) {\r\n    super();\r\n\r\n    this.dom = dom;\r\n    this.tab = tab;\r\n    this.tbar = tbar;\r\n    this.first = true;\r\n\r\n    this.droptarget = undefined;\r\n    this.start_mpos = new Vector2();\r\n    this.mpos = undefined;\r\n\r\n    this.dragtab = undefined;\r\n    this.dragstate = false;\r\n    this.finished = false;\r\n  }\r\n\r\n  finish() {\r\n    if (debug) if (debug) console.log(\"finish\");\r\n\r\n    if (this.finished) {\r\n      return;\r\n    }\r\n\r\n    this.finished = true;\r\n\r\n    if (this.tbar.tool === this) {\r\n      this.tbar.tool = undefined;\r\n    }\r\n\r\n    this.popModal(this.dom);\r\n    this.tbar.update(true);\r\n  }\r\n\r\n  popModal() {\r\n    if (this.dragcanvas !== undefined) {\r\n      this.dragcanvas.remove();\r\n    }\r\n    let ret = super.popModal(...arguments);\r\n\r\n    this.tab.sendEvent(\"tabdragend\");\r\n\r\n    return ret;\r\n  }\r\n\r\n  on_pointerenter(e) {\r\n  }\r\n\r\n  on_pointerleave(e) {\r\n  }\r\n\r\n  on_pointerstart(e) {\r\n  }\r\n\r\n  on_pointerend(e) {\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    this.finish();\r\n  }\r\n\r\n  on_pointercancel(e) {\r\n    this.finish();\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    this.finish();\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    return this._on_move(e, e.x, e.y);\r\n  }\r\n\r\n  _dragstate(e, x, y) {\r\n    this.dragcanvas.style[\"left\"] = x + \"px\";\r\n    this.dragcanvas.style[\"top\"] = y + \"px\";\r\n\r\n    let ctx = this.tbar.ctx;\r\n    let screen = ctx.screen;\r\n    let elem = screen.pickElement(x, y);\r\n\r\n    let e2 = new DragEvent(\"dragenter\", this.dragevent);\r\n    if (elem !== this.droptarget) {\r\n      let e2 = new DragEvent(\"dragexit\", this.dragevent);\r\n      if (this.droptarget) {\r\n        this.droptarget.dispatchEvent(e2);\r\n      }\r\n\r\n      e2 = new DragEvent(\"dragover\", this.dragevent);\r\n      this.droptarget = elem;\r\n      if (elem) {\r\n        elem.dispatchEvent(e2);\r\n      }\r\n    }\r\n    //console.log(elem);\r\n  }\r\n\r\n  _on_move(e, x, y) {\r\n    let r = this.tbar.getClientRects()[0];\r\n    let dpi = UIBase.getDPI();\r\n\r\n    if (r === undefined) {\r\n      //element was removed during/before move\r\n      this.finish();\r\n      return;\r\n    }\r\n\r\n    if (this.dragstate) {\r\n      this._dragstate(e, x, y);\r\n      return;\r\n    }\r\n\r\n    x -= r.x;\r\n    y -= r.y;\r\n\r\n    let dx, dy;\r\n\r\n    x *= dpi;\r\n    y *= dpi;\r\n\r\n    if (this.first) {\r\n      this.first = false;\r\n      this.start_mpos[0] = x;\r\n      this.start_mpos[1] = y;\r\n    }\r\n    if (this.mpos === undefined) {\r\n      this.mpos = [0, 0];\r\n      dx = dy = 0;\r\n    } else {\r\n      dx = x - this.mpos[0];\r\n      dy = y - this.mpos[1];\r\n    }\r\n\r\n    if (debug) console.log(x, y, dx, dy);\r\n\r\n    let tab = this.tab, tbar = this.tbar;\r\n    let axis = tbar.horiz ? 0 : 1;\r\n    let distx, disty;\r\n\r\n    if (tbar.horiz) {\r\n      tab.pos[0] += dx;\r\n      disty = Math.abs(y - this.start_mpos[1]);\r\n    } else {\r\n      tab.pos[1] += dy;\r\n      disty = Math.abs(x - this.start_mpos[0]);\r\n    }\r\n\r\n    let limit = 50;\r\n    let csize = tbar.horiz ? this.tbar.canvas.width : this.tbar.canvas.height;\r\n\r\n    let dragok = tab.pos[axis] + tab.size[axis] < -limit || tab.pos[axis] >= csize + limit;\r\n    dragok = dragok || disty > limit*1.5;\r\n    dragok = dragok && (this.tbar.draggable || this.tbar.getAttribute(\"draggable\"));\r\n\r\n    //console.log(dragok, disty, this.tbar.draggable);\r\n\r\n    if (dragok) {\r\n      this.dragstate = true;\r\n      this.dragevent = new DragEvent(\"dragstart\", {\r\n        dataTransfer: new DataTransfer()\r\n      });\r\n\r\n      this.dragtab = tab;\r\n      let g = this.tbar.g;\r\n      this.dragimg = g.getImageData(~~tab.pos[0], ~~tab.pos[1], ~~tab.size[0], ~~tab.size[1]);\r\n      this.dragcanvas = document.createElement(\"canvas\");\r\n      let g2 = this.drag_g = this.dragcanvas.getContext(\"2d\");\r\n\r\n      this.dragcanvas.visibleToPick = false;\r\n      this.dragcanvas.width = ~~tab.size[0];\r\n      this.dragcanvas.height = ~~tab.size[1];\r\n      this.dragcanvas.style[\"width\"] = (tab.size[0]/dpi) + \"px\";\r\n      this.dragcanvas.style[\"height\"] = (tab.size[1]/dpi) + \"px\";\r\n      this.dragcanvas.style[\"position\"] = UIBase.PositionKey;\r\n      this.dragcanvas.style[\"left\"] = e.x + \"px\";\r\n      this.dragcanvas.style[\"top\"] = e.y + \"px\";\r\n      this.dragcanvas.style[\"z-index\"] = \"500\";\r\n      document.body.appendChild(this.dragcanvas);\r\n      g2.putImageData(this.dragimg, 0, 0);\r\n\r\n\r\n      this.tbar.dispatchEvent(this.dragevent);\r\n\r\n      return;\r\n    }\r\n\r\n    let ti = tbar.tabs.indexOf(tab);\r\n    let next = ti < tbar.tabs.length - 1 ? tbar.tabs[ti + 1] : undefined;\r\n    let prev = ti > 0 ? tbar.tabs[ti - 1] : undefined;\r\n\r\n    if (next !== undefined && next.movable && tab.pos[axis] > next.pos[axis]) {\r\n      tbar.swapTabs(tab, next);\r\n    } else if (prev !== undefined && prev.movable && tab.pos[axis] < prev.pos[axis] + prev.size[axis]*0.5) {\r\n      tbar.swapTabs(tab, prev);\r\n    }\r\n\r\n    tbar.update(true);\r\n\r\n    this.mpos[0] = x;\r\n    this.mpos[1] = y;\r\n\r\n    let e2 = tab.sendEvent(\"tabdragmove\", e);\r\n\r\n    if (e2.defaultPrevented) {\r\n      this.finish();\r\n    }\r\n  }\r\n\r\n  on_keydown(e) {\r\n    if (debug) console.log(e.keyCode);\r\n\r\n    switch (e.keyCode) {\r\n      case keymap.Escape: //escape\r\n      case keymap.Space: //space\r\n      case keymap.Enter: //enter\r\n      case keymap.Tab: //tab\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\nexport class TabBar extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    let style = document.createElement(\"style\");\r\n    let canvas = document.createElement(\"canvas\");\r\n\r\n    this.iconsheet = 0;\r\n    this.movableTabs = true;\r\n\r\n    this.tabFontScale = 1.0;\r\n\r\n    this.tabs = [];\r\n    this.tabs.active = undefined;\r\n    this.tabs.highlight = undefined;\r\n\r\n    this._last_style_key = undefined;\r\n\r\n    canvas.style[\"width\"] = \"145px\";\r\n    canvas.style[\"height\"] = \"45px\";\r\n\r\n    this.r = this.getDefault(\"TabBarRadius\", undefined, 8);\r\n\r\n    this.canvas = canvas;\r\n    this.g = canvas.getContext(\"2d\");\r\n\r\n    this.canvas.style[\"touch-action\"] = \"none\";\r\n\r\n    style.textContent = `\r\n    `;\r\n\r\n    this.shadow.appendChild(style);\r\n    this.shadow.appendChild(canvas);\r\n\r\n    this._last_dpi = undefined;\r\n    this._last_pos = undefined;\r\n\r\n    this.horiz = true;\r\n    this.onchange = null;\r\n    this.onselect = null; //onselect is like onchange, but fires even if tab hasn't changed\r\n\r\n    let mx, my;\r\n\r\n    this.canvas.addEventListener(\"pointermove\", (e) => {\r\n      this.on_pointermove(e);\r\n    }, false);\r\n\r\n\r\n    this.canvas.addEventListener(\"pointerdown\", (e) => {\r\n      this.on_pointerdown(e);\r\n    });\r\n  }\r\n\r\n  _doelement(e, mx, my) {\r\n    for (let tab of this.tabs) {\r\n      let ok;\r\n\r\n      if (this.horiz) {\r\n        ok = mx >= tab.pos[0] && mx <= tab.pos[0] + tab.size[0];\r\n      } else {\r\n        ok = my >= tab.pos[1] && my <= tab.pos[1] + tab.size[1];\r\n      }\r\n\r\n      if (ok && this.tabs.highlight !== tab) {\r\n        this.tabs.highlight = tab;\r\n        this.update(true);\r\n      }\r\n    }\r\n  }\r\n\r\n  _domouse(e) {\r\n    let r = this.canvas.getClientRects()[0];\r\n\r\n    let mx = e.x - r.x;\r\n    let my = e.y - r.y;\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    mx *= dpi;\r\n    my *= dpi;\r\n\r\n    this._doelement(e, mx, my);\r\n\r\n    const is_mdown = e.type === \"mousedown\" || e.type == \"pointerdown\";\r\n    if (is_mdown && this.onselect && this._fireOnSelect().defaultPrevented) {\r\n      e.preventDefault();\r\n    }\r\n  }\r\n\r\n  _doclick(e) {\r\n    this._domouse(e);\r\n\r\n    if (e.defaultPrevented) {\r\n      return;\r\n    }\r\n\r\n    if (debug) console.log(\"mdown\");\r\n\r\n    if (e.button !== 0) {\r\n      return;\r\n    }\r\n\r\n    let ht = this.tabs.highlight;\r\n\r\n    let acte = {};\r\n    for (let k in e) {\r\n      if (k === \"defaultPrevented\" || k === \"cancelBubble\") {\r\n        continue;\r\n      }\r\n\r\n      acte[k] = e[k];\r\n    }\r\n\r\n    acte.target = ht;\r\n    acte.pointerId = e.pointerId;\r\n\r\n    acte = new PointerEvent(\"tabactive\", acte);\r\n\r\n    let e2 = ht.sendEvent(\"tabclick\", e);\r\n\r\n    if (e2.defaultPrevented) {\r\n      acte.preventDefault();\r\n    }\r\n\r\n    if (ht !== undefined && this.tool === undefined) {\r\n      this.setActive(ht, acte);\r\n\r\n      if (this.movableTabs && !acte.defaultPrevented) {\r\n        this._startMove(ht, e);\r\n      }\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    this._doclick(e);\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let r = this.canvas.getClientRects()[0];\r\n    this._domouse(e);\r\n\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n  }\r\n\r\n  on_pointerup(e) {\r\n\r\n  }\r\n\r\n\r\n  static setDefault(e) {\r\n    e.setAttribute(\"bar_pos\", \"top\");\r\n    e.updatePos(true);\r\n\r\n    return e;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"tabbar-x\",\r\n      style  : \"tabs\"\r\n    };\r\n  }\r\n\r\n  _ensureNoModal() {\r\n    if (this.tool) {\r\n      this.tool.finish();\r\n      this.tool = undefined;\r\n    }\r\n  }\r\n\r\n  get tool() {\r\n    return this._tool;\r\n  }\r\n\r\n  set tool(v) {\r\n    //console.warn(\"SET TOOL\", v, this._id);\r\n    this._tool = v;\r\n  }\r\n\r\n  _startMove(tab = this.tabs.active, event, pointerId = event ? event.pointerId : undefined, pointerElem = tab) {\r\n    if (this.movableTabs) {\r\n      let e2 = tab.sendEvent(\"tabdragstart\", event);\r\n\r\n      if (e2.defaultPrevented) {\r\n        return;\r\n      }\r\n\r\n      if (this.tool) {\r\n        this.tool.finish();\r\n      }\r\n\r\n      let edom = this.getScreen();\r\n      let tool = this.tool = new ModalTabMove(tab, this, edom);\r\n\r\n      if (event && pointerElem && pointerId !== undefined) {\r\n        tool.pushPointerModal(pointerElem, pointerId);\r\n      } else {\r\n        tool.pushModal(edom, false);\r\n      }\r\n    }\r\n  }\r\n\r\n  _fireOnSelect() {\r\n    let e = this._makeOnSelectEvt();\r\n\r\n    if (this.onselect) {\r\n      this.onselect(e);\r\n    }\r\n\r\n    return e;\r\n  }\r\n\r\n  _makeOnSelectEvt() {\r\n    return {\r\n      tab             : this.tabs.highlight,\r\n      defaultPrevented: false,\r\n      preventDefault() {\r\n        this.defaultPrevented = true;\r\n      }\r\n    }\r\n    /*\r\n      return new MouseEvent(\"mousedown\", {\r\n        target : [this.tabs.highlight],\r\n        tab : \"sdfdsf\"\r\n      });\r\n\r\n   */\r\n  }\r\n\r\n  getTab(name_or_id) {\r\n    for (let tab of this.tabs) {\r\n      if (tab.id === name_or_id || tab.name === name_or_id)\r\n        return tab;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  clear() {\r\n    for (let t of this.tabs) {\r\n      if (t.dom) {\r\n        t.dom.remove();\r\n      }\r\n\r\n      t.remove();\r\n    }\r\n\r\n    this.tabs = [];\r\n    this.setCSS();\r\n    this._redraw();\r\n  }\r\n\r\n  saveData() {\r\n    let taborder = [];\r\n\r\n    for (let tab of this.tabs) {\r\n      taborder.push(tab.name);\r\n    }\r\n\r\n    let act = this.tabs.active !== undefined ? this.tabs.active.name : \"null\";\r\n\r\n    return {\r\n      taborder: taborder,\r\n      active  : act\r\n    };\r\n  }\r\n\r\n  loadData(obj) {\r\n    if (!obj.taborder) {\r\n      return;\r\n    }\r\n\r\n    let tabs = this.tabs;\r\n    let active = undefined;\r\n    let ntabs = [];\r\n\r\n    ntabs.active = undefined;\r\n    ntabs.highlight = undefined;\r\n\r\n    for (let tname of obj.taborder) {\r\n      let tab = this.getTab(tname);\r\n\r\n      if (tab === undefined) {\r\n        continue;\r\n      }\r\n\r\n      if (tab.name === obj.active) {\r\n        active = tab;\r\n      }\r\n\r\n      ntabs.push(tab);\r\n    }\r\n\r\n    for (let tab of tabs) {\r\n      if (ntabs.indexOf(tab) < 0) {\r\n        ntabs.push(tab);\r\n      }\r\n    }\r\n\r\n    this.tabs = ntabs;\r\n\r\n    try {\r\n      if (active !== undefined) {\r\n        this.setActive(active);\r\n      } else if (this.tabs.length > 0) {\r\n        this.setActive(this.tabs[0]);\r\n      }\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n    }\r\n\r\n    this.update(true);\r\n\r\n    return this;\r\n  }\r\n\r\n  swapTabs(a, b) {\r\n    let tabs = this.tabs;\r\n\r\n    let ai = tabs.indexOf(a);\r\n    let bi = tabs.indexOf(b);\r\n\r\n    tabs[ai] = b;\r\n    tabs[bi] = a;\r\n\r\n    this.update(true);\r\n  }\r\n\r\n  addIconTab(icon, id, tooltip, movable = true) {\r\n    let tab = this.addTab(\"\", id, tooltip, movable);\r\n    tab.icon = icon;\r\n\r\n    return tab;\r\n  }\r\n\r\n  addTab(name, id, tooltip = \"\", movable) {\r\n    let tab = UIBase.createElement(\"tab-item-x\", true);\r\n\r\n    this.shadow.appendChild(tab);\r\n    tab.parentWidget = this;\r\n\r\n\r\n    tab.name = name;\r\n    tab.id = id;\r\n    tab.tooltip = tooltip;\r\n    tab.movable = movable;\r\n    tab.tbar = this;\r\n\r\n    this.tabs.push(tab);\r\n    this.update(true);\r\n\r\n    if (this.tabs.length === 1) {\r\n      this.setActive(this.tabs[0]);\r\n    }\r\n\r\n    return tab;\r\n  }\r\n\r\n  updatePos(force_update = false) {\r\n    let pos = this.getAttribute(\"bar_pos\");\r\n\r\n    if (pos !== this._last_pos || force_update) {\r\n      this._last_pos = pos;\r\n\r\n      this.horiz = pos === \"top\" || pos === \"bottom\";\r\n      if (debug) console.log(\"tab bar position update\", this.horiz);\r\n\r\n      if (this.horiz) {\r\n        this.style[\"width\"] = \"100%\";\r\n        delete this.style[\"height\"];\r\n      } else {\r\n        this.style[\"height\"] = \"100%\";\r\n        delete this.style[\"width\"];\r\n      }\r\n\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  updateDPI(force_update = false) {\r\n    let dpi = this.getDPI();\r\n\r\n    if (dpi !== this._last_dpi) {\r\n      if (debug) console.log(\"DPI update!\");\r\n      this._last_dpi = dpi;\r\n\r\n      this.updateCanvas(true);\r\n    }\r\n  }\r\n\r\n  updateCanvas(force_update = false) {\r\n    let canvas = this.canvas;\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let rwidth = getpx(this.canvas.style[\"width\"]);\r\n    let rheight = getpx(this.canvas.style[\"height\"]);\r\n\r\n    let width = ~~(rwidth*dpi);\r\n    let height = ~~(rheight*dpi);\r\n\r\n    let update = force_update;\r\n    update = update || canvas.width !== width || canvas.height !== height;\r\n\r\n    if (update) {\r\n      canvas.width = width;\r\n      canvas.height = height;\r\n\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _getFont(tsize) {\r\n    let font = this.getDefault(\"TabText\");\r\n\r\n    if (this.tabFontScale !== 1.0) {\r\n      font = font.copy();\r\n      font.size *= this.tabFontScale;\r\n    }\r\n\r\n    return font;\r\n  }\r\n\r\n  _layout() {\r\n    if ((!this.ctx || !this.ctx.screen) && !this.isDead()) {\r\n      this.doOnce(this._layout);\r\n    }\r\n\r\n    let g = this.g;\r\n\r\n    if (debug) console.log(\"tab layout\");\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let font = this._getFont();\r\n    let tsize = (font.size*dpi);\r\n\r\n    g.font = font.genCSS(tsize);\r\n\r\n    let axis = this.horiz ? 0 : 1;\r\n\r\n    let pad = 4*dpi + Math.ceil(tsize*0.25);\r\n    let hpad = this.getDefault(\"TabPadding\", undefined, 0.0);\r\n\r\n    let x = pad;\r\n    let y = 0.0;\r\n\r\n    let h = tsize + Math.ceil(tsize*0.5) + hpad;\r\n    let iconsize = iconmanager.getTileSize(this.iconsheet);\r\n    let have_icons = false;\r\n\r\n    for (let tab of this.tabs) {\r\n      if (tab.icon !== undefined) {\r\n        have_icons = true;\r\n        h = Math.max(h, iconsize + 4);\r\n        break;\r\n      }\r\n    }\r\n\r\n    let r1 = this.parentWidget ? this.parentWidget.getClientRects()[0] : undefined;\r\n    let r2 = this.canvas.getClientRects()[0];\r\n\r\n    let rx = 0, ry = 0;\r\n    if (r2) {\r\n      rx = r2.x;//r2.x - r1.x;\r\n      ry = r2.y; //r2.y - r1.y;\r\n    }\r\n\r\n    let ti = -1;\r\n\r\n    let makeTabWatcher = (tab) => {\r\n      if (tab.watcher) {\r\n        clearInterval(tab.watcher.timer);\r\n      }\r\n\r\n      let watcher = () => {\r\n        let dead = this.tabs.indexOf(tab) < 0;\r\n        dead = dead || this.isDead();\r\n\r\n        if (dead) {\r\n          if (tab.dom)\r\n            tab.dom.remove();\r\n          tab.dom = undefined;\r\n\r\n          if (tab.watcher.timer)\r\n            clearInterval(tab.watcher.timer);\r\n        }\r\n      };\r\n\r\n      tab.watcher = watcher;\r\n      tab.watcher.timer = window.setInterval(watcher, 750);\r\n\r\n      return tab.watcher.timer;\r\n    };\r\n\r\n    let haveTabDom = false;\r\n    for (let tab of this.tabs) {\r\n      if (tab.extra) {\r\n        haveTabDom = true;\r\n      }\r\n    }\r\n\r\n    if (haveTabDom && this.ctx && this.ctx.screen && !this._size_cb) {\r\n      this._size_cb = () => {\r\n        if (this.isDead()) {\r\n          this.ctx.screen.removeEventListener(\"resize\", this._size_cb);\r\n          this._size_cb = undefined;\r\n          return;\r\n        }\r\n        if (!this.ctx) return;\r\n\r\n        this._layout();\r\n        this._redraw();\r\n      };\r\n\r\n      this.ctx.screen.addEventListener(\"resize\", this._size_cb);\r\n    }\r\n\r\n    for (let tab of this.tabs) {\r\n      ti++;\r\n\r\n      if (tab.extra && !tab.dom) {\r\n\r\n        tab.dom = document.createElement(\"div\");\r\n        tab.dom.style[\"margin\"] = tab.dom.style[\"padding\"] = \"0px\";\r\n\r\n        //XXX breaks mobile\r\n        //let z = this.calcZ();\r\n        //tab.dom.style[\"z-index\"] = z - 1 - ti;\r\n\r\n        document.body.appendChild(tab.dom);\r\n        tab.dom.style[\"position\"] = UIBase.PositionKey;\r\n        tab.dom.style[\"display\"] = \"flex\";\r\n        tab.dom.style[\"flex-direction\"] = this.horiz ? \"row\" : \"column\";\r\n\r\n        tab.dom.style[\"pointer-events\"] = \"none\";\r\n\r\n        if (!this.horiz) {\r\n          tab.dom.style[\"width\"] = (tab.size[0]/dpi) + \"px\";\r\n          tab.dom.style[\"height\"] = (tab.size[1]/dpi) + \"px\";\r\n          tab.dom.style[\"left\"] = (rx + tab.pos[0]/dpi) + \"px\";\r\n          tab.dom.style[\"top\"] = (ry + tab.pos[1]/dpi) + \"px\";\r\n        } else {\r\n          tab.dom.style[\"width\"] = (tab.size[0]/dpi) + \"px\";\r\n          tab.dom.style[\"height\"] = (tab.size[1]/dpi) + \"px\";\r\n          tab.dom.style[\"left\"] = (rx + tab.pos[0]/dpi) + \"px\";\r\n          tab.dom.style[\"top\"] = (ry + tab.pos[1]/dpi) + \"px\";\r\n        }\r\n\r\n        let font = this._getFont();\r\n        tab.dom.style[\"font\"] = font.genCSS();\r\n        tab.dom.style[\"color\"] = font.color;\r\n\r\n        tab.dom.appendChild(tab.extra);\r\n\r\n        //tab.dom.style[\"background-color\"] = \"red\";\r\n\r\n        makeTabWatcher(tab);\r\n      }\r\n\r\n      let w = g.measureText(tab.name).width;\r\n\r\n      if (tab.extra) {\r\n        w += tab.extraSize || tab.extra.getClientRects()[0].width;\r\n\r\n      }\r\n\r\n      if (tab.icon !== undefined) {\r\n        w += iconsize;\r\n      }\r\n\r\n      //don't interfere with tab dragging\r\n      let bad = this.tool !== undefined && tab === this.tabs.active;\r\n\r\n      if (!bad) {\r\n        tab.pos[axis] = x;\r\n        tab.pos[axis ^ 1] = y;\r\n      }\r\n\r\n      //tab.size = [0, 0];\r\n      tab.size[axis] = w + pad*2;\r\n      tab.size[axis ^ 1] = h;\r\n\r\n      x += w + pad*2;\r\n    }\r\n\r\n    x = (~~(x + pad))/dpi;\r\n    h = (~~h)/dpi;\r\n\r\n\r\n    if (this.horiz) {\r\n      this.canvas.style[\"width\"] = x + \"px\";\r\n      this.canvas.style[\"height\"] = h + \"px\";\r\n    } else {\r\n      this.canvas.style[\"height\"] = x + \"px\";\r\n      this.canvas.style[\"width\"] = h + \"px\";\r\n    }\r\n\r\n    for (let tab of this.tabs) {\r\n      tab.setCSS();\r\n    }\r\n\r\n    //this.canvas.width = x;\r\n  }\r\n\r\n  /** tab is a TabItem instance */\r\n  setActive(tab, event) {\r\n    if (tab.noSwitch) {\r\n      return;\r\n    }\r\n\r\n    let update = tab !== this.tabs.active;\r\n    this.tabs.active = tab;\r\n\r\n    if (update) {\r\n      if (!util.isMobile() && this.getDefault(\"focus-on-tab-click\")) {\r\n        tab.focus({preventScroll: true, focusVisible: false});\r\n      }\r\n\r\n      if (this.onchange)\r\n        this.onchange(tab, event);\r\n\r\n      this.update(true);\r\n    }\r\n  }\r\n\r\n  _redraw() {\r\n    let g = this.g;\r\n\r\n    let activecolor = this.getDefault(\"TabActive\") || \"rgba(0,0,0,0)\";\r\n\r\n    if (debug) console.log(\"tab draw\");\r\n\r\n    g.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n\r\n    let dpi = this.getDPI();\r\n    let font = this._getFont();\r\n\r\n    let tsize = font.size;\r\n    let iconsize = iconmanager.getTileSize(this.iconsheet);\r\n\r\n    tsize = (tsize*dpi);\r\n    g.font = font.genCSS(tsize);\r\n\r\n    g.lineWidth = 2;\r\n    g.strokeStyle = this.getDefault(\"TabStrokeStyle1\");\r\n\r\n    let r = this.r*dpi;\r\n    this._layout();\r\n    let tab;\r\n\r\n    const draw_text = (name, x2, y2) => {\r\n      let hpad = this.getDefault(\"TabPadding\", undefined, 0.0);\r\n      if (this.horiz) {\r\n        y2 += hpad*0.5;\r\n      } else {\r\n        y2 -= hpad*0.5;\r\n      }\r\n\r\n      g.fillText(tab.name, x2, y2);\r\n    };\r\n\r\n    let ti = -1;\r\n    for (tab of this.tabs) {\r\n      ti++;\r\n\r\n      if (tab === this.tabs.active)\r\n        continue;\r\n\r\n      let x = tab.pos[0], y = tab.pos[1];\r\n      let w = tab.size[0], h = tab.size[1];\r\n      //let tw = g.measureText(tab.name).width;\r\n      let tw = ui_base.measureText(this, tab.name, this.canvas, g, tsize, font).width;\r\n\r\n      let x2 = x + (tab.size[this.horiz ^ 1] - tw)*0.5;\r\n      let y2 = y + tsize;\r\n\r\n      if (tab === this.tabs.highlight) {\r\n        let p = 2;\r\n\r\n        g.beginPath();\r\n        g.rect(x + p, y + p, w - p*2, h - p*2);\r\n        g.fillStyle = this.getDefault(\"TabHighlight\");\r\n        g.fill();\r\n      }\r\n\r\n      g.fillStyle = this.getDefault(\"TabText\").color;\r\n\r\n      if (!this.horiz) {\r\n        let x3 = 0, y3 = y2;\r\n\r\n        g.save();\r\n        g.translate(x3, y3);\r\n        g.rotate(Math.PI/2);\r\n        g.translate(x3 - tsize, -y3 - tsize*0.5);\r\n      }\r\n\r\n      if (tab.icon !== undefined) {\r\n        iconmanager.canvasDraw(this, this.canvas, g, tab.icon, x, y, this.iconsheet);\r\n        x2 += iconsize + 4;\r\n      }\r\n\r\n      draw_text(tab.name, x2, y2);\r\n\r\n      if (!this.horiz) {\r\n        g.restore();\r\n      }\r\n\r\n      let prev = this.tabs[Math.max(ti - 1 + this.tabs.length, 0)];\r\n      let next = this.tabs[Math.min(ti + 1, this.tabs.length - 1)];\r\n\r\n      if (tab !== this.tabs[this.tabs.length - 1] && prev !== this.tabs.active && next !== this.tabs.active) {\r\n        g.beginPath();\r\n        if (this.horiz) {\r\n          g.moveTo(x + w, h - 5);\r\n          g.lineTo(x + w, 5);\r\n        } else {\r\n          g.moveTo(w - 5, y + h);\r\n          g.lineTo(5, y + h);\r\n        }\r\n        g.strokeStyle = this.getDefault(\"TabStrokeStyle1\");\r\n        g.stroke();\r\n      }\r\n    }\r\n\r\n    let th = tsize;\r\n\r\n    //draw active tab\r\n    tab = this.tabs.active;\r\n    if (tab) {\r\n      let x = tab.pos[0], y = tab.pos[1];\r\n      let w = tab.size[0], h = tab.size[1];\r\n      //let tw = g.measureText(tab.name).width;\r\n      let tw = ui_base.measureText(this, tab.name, this.canvas, g, tsize, font).width;\r\n\r\n      if (this.horiz) {\r\n        h += 2;\r\n      } else {\r\n        w += 2;\r\n      }\r\n\r\n      let x2 = x + (tab.size[this.horiz ^ 1] - tw)*0.5;\r\n      let y2 = y + tsize;\r\n\r\n      if (tab === this.tabs.active) {\r\n        /*\r\n        let x = !this.horiz ? tab.y : tab.x;\r\n        let y = !this.horiz ? tab.x : tab.y;\r\n        let w = !this.horiz ? tab.size[1] : tab.size[0];\r\n        let h = !this.horiz ? tab.size[0] : tab.size[1];\r\n\r\n        if (!this.horiz) {\r\n          //g.save();\r\n          //g.translate(0, y);\r\n          //g.rotate(Math.PI/16);\r\n          //g.translate(0, -y);\r\n        }//*/\r\n\r\n        g.beginPath();\r\n        //g.lineWidth *= 5;\r\n        let ypad = 2;\r\n\r\n        g.strokeStyle = this.getDefault(\"TabStrokeStyle2\");\r\n        g.fillStyle = activecolor;\r\n        let r2 = r*1.5;\r\n\r\n        if (this.horiz) {\r\n          g.moveTo(x - r, h);\r\n          g.quadraticCurveTo(x, h, x, h - r);\r\n          g.lineTo(x, r2);\r\n          g.quadraticCurveTo(x, ypad, x + r2, ypad)\r\n          g.lineTo(x + w - r2, ypad);\r\n          g.quadraticCurveTo(x + w, 0, x + w, r2);\r\n          g.lineTo(x + w, h - r2);\r\n          g.quadraticCurveTo(x + w, h, x + w + r, h);\r\n\r\n          g.stroke()\r\n          //\r\n          g.closePath()\r\n        } else {\r\n          g.moveTo(w, y - r);\r\n          g.quadraticCurveTo(w, y, w - r, y);\r\n          ///*\r\n          g.lineTo(r2, y);\r\n          g.quadraticCurveTo(ypad, y, ypad, y + r2);\r\n          g.lineTo(ypad, y + h - r2);\r\n          g.quadraticCurveTo(0, y + h, r2, y + h);\r\n          g.lineTo(w - r2, y + h);\r\n          g.quadraticCurveTo(w, y + h, w, y + h + r);\r\n          //*/\r\n          g.stroke()\r\n          //\r\n          g.closePath()\r\n        }\r\n\r\n        let cw = this.horiz ? this.canvas.width : this.canvas.height;\r\n\r\n        let worig = g.lineWidth;\r\n\r\n        g.lineWidth *= 0.5;\r\n\r\n        g.fill();\r\n        //g.stroke();\r\n\r\n        g.lineWidth = worig;\r\n\r\n        if (!this.horiz) {\r\n          let x3 = 0, y3 = y2;\r\n\r\n          g.save();\r\n          g.translate(x3, y3);\r\n          g.rotate(Math.PI/2);\r\n          g.translate(-x3 - tsize, -y3 - tsize*0.5);\r\n        }\r\n\r\n        g.fillStyle = this.getDefault(\"TabText\").color;\r\n\r\n        draw_text(tab.name, x2, y2);\r\n\r\n        if (!this.horiz) {\r\n          g.restore();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  removeTab(tab) {\r\n    this.tabs.remove(tab);\r\n    if (tab === this.tabs.active) {\r\n      this.tabs.active = this.tabs[0];\r\n    }\r\n\r\n    this._layout();\r\n    this._redraw();\r\n    this.setCSS();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS(false);\r\n\r\n    /* create a no stacking context */\r\n    this.style[\"contain\"] = \"layout\";\r\n\r\n    this.r = this.getDefault(\"TabBarRadius\", undefined, 8);\r\n\r\n    let r = this.r !== undefined ? this.r : 3;\r\n\r\n    this.style[\"touch-action\"] = \"none\";\r\n\r\n    this.canvas.style[\"background-color\"] = this.getDefault(\"TabInactive\");\r\n    this.canvas.style[\"border-radius\"] = r + \"px\";\r\n    //this.style[\"background-color\"] = this.getDefault(\"TabInactive\");\r\n  }\r\n\r\n  updateStyle() {\r\n    let key = \"\" + this.getDefault(\"background-color\");\r\n    key += this.getDefault(\"TabActive\");\r\n    key += this.getDefault(\"TabInactive\");\r\n    key += this.getDefault(\"TabBarRadius\");\r\n    key += this.getDefault(\"TabStrokeStyle1\");\r\n    key += this.getDefault(\"TabStrokeStyle2\");\r\n    key += this.getDefault(\"TabHighlight\");\r\n    key += JSON.stringify(this.getDefault(\"TabText\"));\r\n    key += this.tabFontScale;\r\n\r\n    if (key !== this._last_style_key) {\r\n      this._last_style_key = key;\r\n\r\n      this._layout();\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  update(force_update = false) {\r\n    let rect = this.getClientRects()[0];\r\n    if (rect) {\r\n      let key = Math.floor(rect.x*4.0) + \":\" + Math.floor(rect.y*4.0);\r\n      if (key !== this._last_p_key) {\r\n        this._last_p_key = key;\r\n\r\n        //console.log(\"tab bar autobuild\");\r\n        this._layout();\r\n      }\r\n    }\r\n    super.update();\r\n\r\n    this.updateStyle();\r\n    this.updatePos(force_update);\r\n    this.updateDPI(force_update);\r\n    this.updateCanvas(force_update);\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(TabBar);\r\n\r\nexport class TabContainer extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._last_style_key = \"\";\r\n\r\n    this.dataPrefix = \"\";\r\n\r\n    this.inherit_packflag = 0;\r\n    this.packflag = 0;\r\n\r\n    this.tabFontScale = 1.0;\r\n\r\n    this.tbar = UIBase.createElement(\"tabbar-x\");\r\n    this.tbar.parentWidget = this;\r\n    this.tbar.setAttribute(\"class\", \"_tbar_\" + this._id);\r\n    this.tbar.constructor.setDefault(this.tbar);\r\n    this.tbar.tabFontScale = this.tabFontScale;\r\n\r\n    this._remakeStyle();\r\n\r\n    this.tabs = {};\r\n\r\n    this._last_horiz = undefined;\r\n    this._last_bar_pos = undefined;\r\n    this._tab = undefined;\r\n\r\n    let div = document.createElement(\"div\");\r\n    div.setAttribute(\"class\", `_tab_${this._id}`);\r\n    div.appendChild(this.tbar);\r\n    this.shadow.appendChild(div);\r\n\r\n    this.tbar.parentWidget = this;\r\n\r\n    this.tbar.onselect = (e) => {\r\n      if (this.onselect) {\r\n        this.onselect(e);\r\n      }\r\n    };\r\n\r\n    this.tbar.onchange = (tab, event) => {\r\n      if (this._tab) {\r\n        HTMLElement.prototype.remove.call(this._tab);\r\n      }\r\n\r\n      this._tab = this.tabs[tab.id];\r\n      //this._tab = document.createElement(\"div\");\r\n      //this._tab.innerText = \"SDfdsfsdyay\";\r\n\r\n      this._tab.parentWidget = this;\r\n\r\n      //ensure we get full update convergence when switching\r\n      //tabs\r\n      for (let i = 0; i < 2; i++) {\r\n        this._tab.flushUpdate();\r\n      }\r\n\r\n      let div = document.createElement(\"div\");\r\n\r\n      this.tbar.setCSS.once(() => div.style[\"background-color\"] = this.getDefault(\"background-color\"), div);\r\n\r\n      div.setAttribute(\"class\", `_tab_${this._id}`);\r\n      div.appendChild(this._tab);\r\n\r\n      this.shadow.appendChild(div);\r\n\r\n      if (this.onchange) {\r\n        this.onchange(tab, event);\r\n      }\r\n    }\r\n  }\r\n\r\n  get movableTabs() {\r\n    let attr;\r\n\r\n    if (!this.hasAttribute(\"movable-tabs\")) {\r\n      attr = this.getDefault(\"movable-tabs\");\r\n\r\n      if (attr === undefined || attr === null) {\r\n        attr = \"true\";\r\n      }\r\n\r\n      if (typeof attr === \"boolean\" || typeof attr === \"number\") {\r\n        attr = attr ? \"true\" : \"false\";\r\n      }\r\n    } else {\r\n      attr = \"\" + this.getAttribute(\"movable-tabs\");\r\n    }\r\n\r\n    attr = attr.toLowerCase();\r\n\r\n    return attr === \"true\";\r\n  }\r\n\r\n  set movableTabs(val) {\r\n    val = !!val;\r\n\r\n    this.setAttribute(\"movable-tabs\", val ? \"true\" : \"false\");\r\n    this.tbar.movableTabs = this.movableTabs;\r\n  }\r\n\r\n  get hideScrollBars() {\r\n    let attr = (\"\" + this.getAttribute(\"hide-scrollbars\")).toLowerCase();\r\n    return attr === \"true\" || attr === \"yes\";\r\n  }\r\n\r\n  set hideScrollBars(val) {\r\n    val = !!val;\r\n\r\n    this.setAttribute(\"hide-scrollbars\", \"\" + val);\r\n  }\r\n\r\n  static setDefault(e) {\r\n    e.setAttribute(\"bar_pos\", \"top\");\r\n\r\n    return e;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"tabcontainer-x\",\r\n      style  : \"tabs\"\r\n    };\r\n  }\r\n\r\n  _startMove(tab = this.tbar.tabs.active, event) {\r\n    return this.tbar._startMove(tab, event);\r\n  }\r\n\r\n  _ensureNoModal() {\r\n    return this.tbar._ensureNoModal();\r\n  }\r\n\r\n  saveData() {\r\n    let json = super.saveData() || {};\r\n    json.tabs = {};\r\n\r\n    for (let k in this.tabs) {\r\n      let tab = this.tabs[k];\r\n\r\n      if (k === this.tbar.tabs.active.id) {\r\n        //no need to save active tab here\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        json.tabs[tab.id] = JSON.parse(saveUIData(tab, \"tab\"));\r\n      } catch (error) {\r\n        console.error(\"Failed to save tab UI layout\", tab.id);\r\n      }\r\n    }\r\n\r\n    return json;\r\n  }\r\n\r\n  loadData(json) {\r\n    if (!json.tabs) {\r\n      return;\r\n    }\r\n\r\n    for (let k in json.tabs) {\r\n      if (!(k in this.tabs)) {\r\n        continue;\r\n      }\r\n\r\n      let uidata = JSON.stringify(json.tabs[k]);\r\n      loadUIData(this.tabs[k], uidata);\r\n    }\r\n  }\r\n\r\n  enableDrag() {\r\n    this.tbar.draggable = this.draggable = true;\r\n    this.tbar.addEventListener(\"dragstart\", (e) => {\r\n      this.dispatchEvent(new DragEvent(\"dragstart\", e));\r\n    });\r\n    this.tbar.addEventListener(\"dragover\", (e) => {\r\n      this.dispatchEvent(new DragEvent(\"dragover\", e));\r\n    });\r\n    this.tbar.addEventListener(\"dragexit\", (e) => {\r\n      this.dispatchEvent(new DragEvent(\"dragexit\", e));\r\n    });\r\n    /*\r\n    let doms = [this, this.tbar, this.tbar.canvas];\r\n    for (let dom of doms) {\r\n      dom.setAttribute(\"draggable\", \"true\");\r\n      dom.draggable = true;\r\n\r\n      dom.addEventListener(\"dragstart\", (e) => {\r\n        console.log(\"drag start\", e);\r\n      });\r\n\r\n      dom.addEventListener(\"drag\", (e) => {\r\n        console.log(\"drag\", e);\r\n      });\r\n    }*/\r\n  }\r\n\r\n  clear() {\r\n    this.tbar.clear();\r\n    if (this._tab !== undefined) {\r\n      HTMLElement.prototype.remove.call(this._tab);\r\n      this._tab = undefined;\r\n    }\r\n\r\n    this.tabs = {};\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.background = this.getDefault(\"background-color\");\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.background = this.getDefault(\"background-color\");\r\n    this._remakeStyle();\r\n  }\r\n\r\n  _remakeStyle() {\r\n    let horiz = this.tbar.horiz;\r\n    let display = \"flex\";\r\n    let flexDir = !horiz ? \"row\" : \"column\";\r\n    let bgcolor = this.__background; //this.getDefault(\"background-color\");\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n      ._tab_${this._id} {\r\n        display : ${display};\r\n        flex-direction : ${flexDir};\r\n        margin : 0px;\r\n        padding : 0px;\r\n        align-self : flex-start;\r\n        ${!horiz ? \"vertical-align : top;\" : \"\"}\r\n      }\r\n      \r\n      ._tbar_${this._id} {\r\n        list-style-type : none;\r\n        align-self : flex-start;\r\n        background-color : ${bgcolor};\r\n        flex-direction : ${flexDir};\r\n        ${!horiz ? \"vertical-align : top;\" : \"\"}\r\n      }\r\n    `;\r\n\r\n    if (this._style)\r\n      this._style.remove();\r\n    this._style = style;\r\n\r\n    this.shadow.prepend(style);\r\n  }\r\n\r\n  icontab(icon, id, tooltip) {\r\n    let t = this.tab(\"\", id, tooltip);\r\n    t._tab.icon = icon;\r\n\r\n    return t;\r\n  }\r\n\r\n  removeTab(tab) {\r\n    let tab2 = tab._tab;\r\n    this.tbar.removeTab(tab2);\r\n    tab.remove();\r\n  }\r\n\r\n  tab(name, id = undefined, tooltip = undefined, movable = true) {\r\n    if (id === undefined) {\r\n      id = tab_idgen++;\r\n    }\r\n\r\n    let col = UIBase.createElement(\"colframe-x\");\r\n\r\n    this.tabs[id] = col;\r\n\r\n    col.dataPrefix = this.dataPrefix;\r\n\r\n    col.ctx = this.ctx;\r\n    col._tab = this.tbar.addTab(name, id, tooltip, movable);\r\n\r\n    col.inherit_packflag |= this.inherit_packflag;\r\n    col.packflag |= this.packflag;\r\n\r\n    //let cls = this.tbar.horiz ? ui.ColumnFrame : ui.RowFrame;\r\n\r\n    col.parentWidget = this;\r\n\r\n    if (col.ctx) {\r\n      col._init();\r\n    }\r\n\r\n    col.setCSS();\r\n\r\n    if (this._tab === undefined) {\r\n      this.setActive(col);\r\n    }\r\n\r\n    col.noSwitch = function () {\r\n      this._tab.noSwitch = true;\r\n      return this;\r\n    }\r\n\r\n    function defineTabEvent(key) {\r\n      key = \"on\" + key;\r\n\r\n      Object.defineProperty(col, key, {\r\n        get() {\r\n          return this._tab[key];\r\n        },\r\n        set(v) {\r\n          this._tab[key] = v;\r\n        }\r\n      });\r\n    }\r\n\r\n    defineTabEvent(\"tabclick\");\r\n    defineTabEvent(\"tabdragmove\");\r\n    defineTabEvent(\"tabdragstart\");\r\n    defineTabEvent(\"tabdragend\");\r\n\r\n    return col;\r\n  }\r\n\r\n  setActive(tab) {\r\n    if (typeof tab === \"string\") {\r\n      tab = this.getTab(tab);\r\n    }\r\n\r\n    if (!tab) {\r\n      return;\r\n    }\r\n\r\n    if (tab._tab !== this.tbar.tabs.active) {\r\n      this.tbar.setActive(tab._tab);\r\n    }\r\n  }\r\n\r\n  getTabCount() {\r\n    return this.tbar.tabs.length;\r\n  }\r\n\r\n  moveTab(tab, i) {\r\n    tab = tab._tab;\r\n\r\n    let tab2 = this.tbar.tabs[i];\r\n\r\n    if (tab !== tab2) {\r\n      this.tbar.swapTabs(tab, tab2);\r\n    }\r\n\r\n    this.tbar.setCSS();\r\n    this.tbar._layout();\r\n    this.tbar._redraw();\r\n  }\r\n\r\n  getTab(name_or_id) {\r\n    if (name_or_id in this.tabs) {\r\n      return this.tabs[name_or_id];\r\n    }\r\n\r\n    for (let k in this.tabs) {\r\n      let t = this.tabs[k];\r\n\r\n      if (t.name === name_or_id) {\r\n        return t;\r\n      }\r\n    }\r\n\r\n    throw new Error(\"Unknown tab \" + name_or_id);\r\n  }\r\n\r\n  updateBarPos() {\r\n    let barpos = this.getAttribute(\"bar_pos\");\r\n\r\n    if (barpos !== this._last_bar_pos) {\r\n      this.horiz = barpos === \"top\" || barpos === \"bottom\";\r\n      this._last_bar_pos = barpos;\r\n\r\n      this.tbar.setAttribute(\"bar_pos\", barpos);\r\n      this.tbar.update(true);\r\n      this.update();\r\n    }\r\n  }\r\n\r\n  updateHoriz() {\r\n    let horiz = this.tbar.horiz;\r\n\r\n    if (this._last_horiz !== horiz) {\r\n      this._last_horiz = horiz;\r\n      this._remakeStyle();\r\n    }\r\n  }\r\n\r\n  updateStyle() {\r\n    let key = \"\" + this.getDefault(\"background-color\");\r\n\r\n    if (key !== this._last_style_key) {\r\n      this._last_style_key = key;\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  getActive() {\r\n    return this.tbar.tabs.active;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.tbar.movableTabs = this.movableTabs;\r\n\r\n    if (this._tab !== undefined) {\r\n      this._tab.update();\r\n    }\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-direction\"] = !this.horiz ? \"row\" : \"column\";\r\n\r\n    this.tbar.tabFontScale = this.tabFontScale;\r\n\r\n    this.updateStyle();\r\n    this.updateHoriz();\r\n    this.updateBarPos();\r\n    this.tbar.update();\r\n\r\n    let act = this.tbar.tabs.active;\r\n\r\n    if (act && !this.hideScrollBars) {\r\n      let container = this.tabs[act.id];\r\n\r\n      //propegate overflow-y to tab container as a whole\r\n\r\n      if (container.hasAttribute(\"overflow-y\") && this.style[\"overflow-y\"] !== container.getAttribute(\"overflow-y\")) {\r\n        this.style[\"overflow-y\"] = container.getAttribute(\"overflow-y\");\r\n        //container.style[\"overflow-y\"] = \"unset\";\r\n      } else if (!container.hasAttribute(\"overflow-y\")) {\r\n        this.style[\"overflow-y\"] = this.getDefault(\"overflow-y\") || \"unset\";\r\n      }\r\n\r\n      if (container.hasAttribute(\"overflow\") && this.style[\"overflow\"] !== container.getAttribute(\"overflow\")) {\r\n        this.style[\"overflow\"] = container.getAttribute(\"overflow\");\r\n        //container.style[\"overflow-y\"] = \"unset\";\r\n      } else if (!container.hasAttribute(\"overflow\")) {\r\n        this.style[\"overflow\"] = this.getDefault(\"overflow\") || \"unset\";\r\n      }\r\n    } else if (this.hideScrollBars) {\r\n      this.style[\"overflow\"] = this.style[\"overflow-y\"] = \"unset\";\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(TabContainer);\r\n","//bind module to global var to get at it in console.\r\n//\r\n//note that require has an api for handling circular\r\n//module refs, in such cases do not use these vars.\r\n\r\nimport {Container} from \"../core/ui.js\";\r\n\r\nvar _ui = undefined;\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_curvewidget from './ui_curvewidget.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as ui_widgets from './ui_widgets.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\n\r\nlet PropFlags = toolprop.PropFlags;\r\nlet PropSubTypes = toolprop.PropSubTypes;\r\n\r\nlet EnumProperty = toolprop.EnumProperty;\r\n\r\nlet Vector2 = vectormath.Vector2,\r\n  UIBase = ui_base.UIBase,\r\n  PackFlags = ui_base.PackFlags,\r\n  PropTypes = toolprop.PropTypes;\r\n\r\n\r\nconst list = util.list;\r\n\r\nexport class TableRow extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.dom.remove();\r\n    this.dom = document.createElement(\"tr\");\r\n\r\n    //kind of dumb, but this.dom doesn't live within this element itself, bleh\r\n    //this.shadow.appendChild(this.dom);\r\n    this.dom.setAttribute(\"class\", \"containerx\");\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"tablerow-x\"\r\n  };}\r\n\r\n  _add(child) {\r\n    child.ctx = this.ctx;\r\n    child.parentWidget = this;\r\n\r\n    let td = document.createElement(\"td\");\r\n    td.appendChild(child);\r\n\r\n    this.dom.appendChild(td);\r\n    child.onadd();\r\n  }\r\n};\r\nUIBase.internalRegister(TableRow);\r\n\r\nexport class TableFrame extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.dom = document.createElement(\"table\");\r\n    this.shadow.appendChild(this.dom);\r\n    this.dom.setAttribute(\"class\", \"containerx\");\r\n\r\n    //this.dom.style[\"display\"] = \"block\";\r\n  }\r\n\r\n  update() {\r\n    //this.style[\"display\"] = \"inline-block\";\r\n    super.update();\r\n  }\r\n\r\n  _add(child) {\r\n    child.ctx = this.ctx;\r\n    child.parentWidget = this;\r\n    this.dom.appendChild(child);\r\n    child.onadd();\r\n  }\r\n\r\n  add(child) {\r\n    this._add(child);\r\n  }\r\n\r\n  row() {\r\n    let tr = document.createElement(\"tr\");\r\n    let cls = \"table-tr\";\r\n\r\n    tr.setAttribute(\"class\", cls);\r\n    this.dom.appendChild(tr);\r\n    let this2 = this;\r\n\r\n    function maketd() {\r\n      let td = document.createElement(\"td\");\r\n      tr.appendChild(td);\r\n\r\n      td.style[\"margin\"] = tr.style[\"margin\"];\r\n      td.style[\"padding\"] = tr.style[\"padding\"];\r\n\r\n      let container = UIBase.createElement(\"rowframe-x\");\r\n\r\n      container.ctx = this2.ctx;\r\n      container.parentWidget = this2;\r\n      container.setAttribute(\"class\", cls);\r\n\r\n      td.setAttribute(\"class\", cls);\r\n      td.appendChild(container);\r\n\r\n      return container;\r\n    }\r\n\r\n    //hrm wish I could subclass html elements easier\r\n    let ret = {\r\n      _tr : tr,\r\n\r\n      style : tr.style,\r\n\r\n      focus : function(args) {\r\n        tr.focus(args);\r\n      },\r\n\r\n      blur : function(args) {\r\n        tr.blur(args);\r\n      },\r\n\r\n      remove : () => {\r\n        tr.remove();\r\n      },\r\n\r\n      addEventListener : function(type, cb, arg) {\r\n        tr.addEventListener(type, cb, arg);\r\n      },\r\n\r\n      removeEventListener : function(type, cb, arg) {\r\n        tr.removeEventListener(type, cb, arg);\r\n      },\r\n\r\n      setAttribute : function(attr, val) {\r\n        if (attr == \"class\") {\r\n          cls = val;\r\n        }\r\n\r\n        tr.setAttribute(attr, val);\r\n      },\r\n\r\n      scrollTo : function() {\r\n        return this._tr.scrollTo(...arguments);\r\n      },\r\n\r\n      scrollIntoView : function() {\r\n        return this._tr.scrollIntoView(...arguments);\r\n      },\r\n\r\n      clear : function() {\r\n        for (let node of list(tr.childNodes)) {\r\n          tr.removeChild(node);\r\n        }\r\n      }\r\n    };\r\n\r\n    function makefunc(f) {\r\n      ret[f] = function() {\r\n        let container = maketd();\r\n\r\n        container.background = tr.style[\"background-color\"]; //\"rgba(0,0,0,0)\";\r\n        return container[f].apply(container, arguments);\r\n      }\r\n    }\r\n\r\n    let _bg = \"\";\r\n\r\n    //need to implement proper proxy here!\r\n    Object.defineProperty(ret, \"tabIndex\", {\r\n      set : function(f) {\r\n        tr.tabIndex = f;\r\n      },\r\n\r\n      get : function(f) {\r\n        return tr.tabIndex;\r\n      }\r\n    });\r\n\r\n    Object.defineProperty(ret, \"background\", {\r\n      set : function(bg) {\r\n        _bg = bg;\r\n        tr.style[\"background-color\"] = bg;\r\n\r\n        for (let node of tr.childNodes) {\r\n          if (node.childNodes.length > 0) {\r\n            node.childNodes[0].background = bg;\r\n            node.style[\"background-color\"] = bg;\r\n          }\r\n        }\r\n      }, get : function() {\r\n        return _bg;\r\n      }\r\n    });\r\n\r\n    /*\r\n    Object.defineProperty(ret, \"class\", {\r\n      set(bg) {\r\n        tr.class = bg;\r\n      }\r\n    });//*/\r\n\r\n    ret.cell = () => {\r\n      let container = maketd();\r\n      container.background = tr.style[\"background-color\"];\r\n      return container;\r\n    };\r\n    \r\n    //makefunc(\"cell\");\r\n    makefunc(\"label\");\r\n    makefunc(\"tool\");\r\n    makefunc(\"prop\");\r\n    makefunc(\"pathlabel\");\r\n    makefunc(\"button\");\r\n    makefunc(\"iconbutton\");\r\n    makefunc(\"textbox\");\r\n    makefunc(\"col\");\r\n    makefunc(\"row\");\r\n    makefunc(\"table\");\r\n    makefunc(\"listenum\");\r\n    makefunc(\"check\");\r\n\r\n    return ret;\r\n  }\r\n\r\n  clear() {\r\n    super.clear();\r\n    for (let child of list(this.dom.childNodes)) {\r\n      child.remove();\r\n    }\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"tableframe-x\"\r\n  };}\r\n}\r\nUIBase.internalRegister(TableFrame);\r\n\r\n","\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as simple_toolsys from '../path-controller/toolsys/toolsys.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\n\r\nimport {TableFrame} from './ui_table.js';\r\nimport {Container, ColumnFrame, RowFrame} from '../core/ui.js';\r\nimport {keymap} from '../path-controller/util/events.js';\r\n\r\nlet EnumProperty = toolprop.EnumProperty,\r\n    PropTypes    = toolprop.PropTypes;\r\n\r\nlet UIBase     = ui_base.UIBase,\r\n    PackFlags  = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nfunction getpx(css) {\r\n  return parseFloat(css.trim().replace(\"px\", \"\"))\r\n}\r\n\r\nclass ListItem extends RowFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    let highlight = () => {\r\n      //console.log(\"listitem mouseover\");\r\n      this.highlight = true;\r\n      this.setBackground();\r\n    };\r\n\r\n    let unhighlight = () => {\r\n      //console.log(\"listitem mouseleave\");\r\n      this.highlight = false;\r\n      this.setBackground();\r\n    };\r\n\r\n    this.addEventListener(\"mouseover\", highlight);\r\n    this.addEventListener(\"mousein\", highlight);\r\n\r\n    this.addEventListener(\"mouseleave\", unhighlight);\r\n    this.addEventListener(\"mouseout\", unhighlight);\r\n    this.addEventListener(\"blur\", unhighlight);\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n      .listitem {\r\n        -moz-user-focus: normal;\r\n        moz-user-focus: normal;\r\n        user-focus: normal;\r\n      }\r\n    `;\r\n\r\n    this.shadowRoot.prepend(style);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"listitem-x\",\r\n      style  : \"listbox\"\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.setAttribute(\"class\", \"listitem\");\r\n\r\n    this.style[\"width\"] = \"100%\";\r\n    this.style[\"height\"] = this.getDefault(\"ItemHeight\") + \"px\";\r\n    this.style[\"flex-grow\"] = \"unset\";\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  setBackground() {\r\n    if (this.highlight && this.is_active) {\r\n      this.background = this.getDefault(\"ListActiveHighlight\");\r\n    } else if (this.highlight) {\r\n      this.background = this.getDefault(\"ListHighlight\");\r\n    } else if (this.is_active) {\r\n      this.background = this.getDefault(\"ListActive\");\r\n    } else {\r\n      this.background = this.getDefault(\"background-color\");\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.setBackground();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ListItem);\r\n\r\nclass ListBox extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.items = [];\r\n    this.idmap = {};\r\n    this.items.active = undefined;\r\n    this.highlight = false;\r\n    this.is_active = false;\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n      .listbox {\r\n        -moz-user-focus: normal;\r\n        moz-user-focus: normal;\r\n        user-focus: normal;\r\n      }\r\n    `;\r\n    this.shadow.prepend(style);\r\n\r\n    this.onkeydown = (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Up\"]:\r\n        case keymap[\"Down\"]:\r\n          if (this.items.length == 0)\r\n            return;\r\n\r\n          if (this.items.active === undefined) {\r\n            this.setActive(this.items[0]);\r\n            return;\r\n          }\r\n\r\n          let i = this.items.indexOf(this.items.active);\r\n          let dir = e.keyCode == keymap[\"Up\"] ? -1 : 1;\r\n\r\n          i = Math.max(Math.min(i + dir, this.items.length - 1), 0);\r\n          this.setActive(this.items[i]);\r\n\r\n          break;\r\n      }\r\n    };\r\n\r\n    //this.addEventListener(\"keydown\", on_keydown);\r\n\r\n    //this._table =  this.table();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"listbox-x\",\r\n      style  : \"listbox\"\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.setCSS();\r\n\r\n    this.style[\"width\"] = this.getDefault(\"width\") + \"px\";\r\n    this.style[\"height\"] = this.getDefault(\"height\") + \"px\";\r\n    this.style[\"overflow\"] = \"scroll\";\r\n\r\n    //this.setAttribute(\"class\", \"listbox\");\r\n    //this.setAttribute(\"tabindex\", 0);\r\n    //this.tabIndex = 0;\r\n  }\r\n\r\n  addItem(name, id) {\r\n    let item = UIBase.createElement(\"listitem-x\");\r\n\r\n    item._id = id === undefined ? this.items.length : id;\r\n    this.idmap[item._id] = item;\r\n\r\n    //item.addEventListener(\"keydown\", this.onkeydown);\r\n    this.tabIndex = 1;\r\n    this.setAttribute(\"tabindex\", 1);\r\n\r\n    this.add(item);\r\n    this.items.push(item);\r\n\r\n    item.label(name);\r\n    let this2 = this;\r\n\r\n    item.onclick = function () {\r\n      this2.setActive(this);\r\n      this.setBackground();\r\n    };\r\n\r\n    return item;\r\n  }\r\n\r\n  removeItem(item) {\r\n    if (typeof item == \"number\") {\r\n      item = this.idmap[item];\r\n    }\r\n\r\n    item.remove();\r\n    delete this.idmap[item._id];\r\n    this.items.remove(item);\r\n  }\r\n\r\n  setActive(item) {\r\n    if (typeof item == \"number\") {\r\n      item = this.idmap[item];\r\n    }\r\n\r\n    //console.log(\"set active!\");\r\n\r\n    if (item === this.items.active) {\r\n      return;\r\n    }\r\n\r\n    if (this.items.active !== undefined) {\r\n      this.items.active.highlight = false;\r\n      this.items.active.is_active = false;\r\n      this.items.active.setBackground();\r\n    }\r\n\r\n    this.items.active = item;\r\n\r\n    if (item) {\r\n      item.is_active = true;\r\n\r\n      item.setBackground();\r\n      item.scrollIntoViewIfNeeded();\r\n    }\r\n\r\n    if (this.onchange) {\r\n      this.onchange(item ? item._id : undefined, item);\r\n    }\r\n  }\r\n\r\n  clear() {\r\n\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ListBox);\r\n","import {UIBase} from '../core/ui_base.js';\r\nimport * as util from '../path-controller/util/util.js';\r\nimport {keymap} from '../path-controller/util/simple_events.js';\r\n\r\nexport class ProgressCircle extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.g = this.canvas.getContext(\"2d\");\r\n\r\n    this.shadow.appendChild(this.canvas);\r\n    this.size = 150;\r\n    this.animreq = undefined;\r\n    this._value = 0.0;\r\n    this.startTime = util.time_ms();\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this.flagRedraw();\r\n    this.update();\r\n\r\n    //enable keyboard focus\r\n    this.tabIndex = 0;\r\n    this.setAttribute(\"tab-index\", 0);\r\n    this.setAttribute(\"tabindex\", 0);\r\n\r\n    let onkey = (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Escape\"]:\r\n          if (this.oncancel) {\r\n            this.oncancel(this);\r\n          }\r\n          break;\r\n      }\r\n    }\r\n\r\n    this.addEventListener(\"keydown\", onkey);\r\n    this.canvas.addEventListener(\"keydown\", onkey);\r\n  }\r\n\r\n  flagRedraw() {\r\n    if (this.animreq !== undefined) {\r\n      return;\r\n    }\r\n\r\n    this.animreq = requestAnimationFrame(() => {\r\n      this.animreq = undefined;\r\n      this.draw();\r\n    })\r\n  }\r\n\r\n  draw() {\r\n    let c = this.canvas, g = this.g;\r\n\r\n    let clr1 = \"rgb(68,69,83)\";\r\n    let clr2 = \"rgb(141,154,196)\";\r\n    let clr3 = \"rgb(214,110,54)\";\r\n\r\n    let t = (util.time_ms() - this.startTime) / 1000.0;\r\n\r\n    g.save();\r\n    g.clearRect(0, 0, c.width, c.height);\r\n\r\n    g.lineWidth /= c.width*0.5;\r\n    g.scale(c.width, c.height);\r\n    g.translate(0.5, 0.5);\r\n\r\n    g.fillStyle = clr2;\r\n    g.strokeStyle = clr1;\r\n\r\n    g.beginPath();\r\n    g.moveTo(0, 0);\r\n    g.arc(0, 0, 0.45, Math.PI, -Math.PI);\r\n    //g.closePath()\r\n\r\n    g.moveTo(0, 0);\r\n    g.arc(0, 0, 0.2, Math.PI, -Math.PI);\r\n    //g.closePath()\r\n\r\n    g.clip(\"evenodd\");\r\n\r\n    g.beginPath();\r\n    g.arc(0, 0, 0.45, -Math.PI, Math.PI);\r\n    g.fill();\r\n    g.stroke();\r\n\r\n    g.beginPath();\r\n    g.arc(0, 0, 0.2, Math.PI, -Math.PI);\r\n    g.stroke();\r\n\r\n    g.beginPath();\r\n\r\n    let th = this._value*Math.PI*2.0;\r\n\r\n    let steps = 12;\r\n    let dth = (Math.PI*2.0) / steps;\r\n    let lwid = g.lineWidth;\r\n    g.lineWidth *= 3;\r\n\r\n    for (let i=0; i<steps; i++) {\r\n      let th1 = i * dth;\r\n      th1 += t;\r\n\r\n      let r1 = 0.2;\r\n      let r2 = 0.45;\r\n      let th2 = th1 + dth*0.5;\r\n\r\n      g.beginPath();\r\n      g.moveTo(Math.cos(th1)*r1, Math.sin(th1)*r1);\r\n      g.lineTo(Math.cos(th2)*r2, Math.sin(th2)*r2);\r\n      g.strokeStyle = \"rgba(255,255,255,0.5)\";\r\n      g.stroke();\r\n    }\r\n\r\n    g.lineWidth = lwid;\r\n\r\n    g.beginPath();\r\n    g.moveTo(0, 0);\r\n    g.arc(0, 0, 0.4, Math.PI, -Math.PI);\r\n    //g.closePath()\r\n\r\n    g.clip(\"evenodd\");\r\n\r\n    g.beginPath();\r\n    g.fillStyle = clr3;\r\n    g.moveTo(0, 0);\r\n    g.arc(0, 0, 0.45, 0, th);\r\n    g.lineTo(0, 0);\r\n    g.fill();\r\n\r\n    g.strokeStyle = \"rgb(141,154,196)\";\r\n    g.stroke();\r\n\r\n    g.restore();\r\n  }\r\n\r\n  set value(percent) {\r\n    this._value = percent;\r\n    this.flagRedraw();\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  startTimer() {\r\n    if (this.timer !== undefined) {\r\n      return;\r\n    }\r\n\r\n    this.focus();\r\n\r\n    window.setInterval(() => {\r\n      if (!this.isConnected) {\r\n        this.endTimer();\r\n        return;\r\n      }\r\n\r\n      this.flagRedraw();\r\n    }, 50);\r\n  }\r\n\r\n  endTimer() {\r\n    if (this.timer !== undefined) {\r\n      window.clearInterval(this.timer);\r\n    }\r\n    this.timer = undefined;\r\n  }\r\n\r\n  update() {\r\n    if (!this.isConnected && this.timer) {\r\n      this.endTimer();\r\n    }\r\n\r\n    let size = ~~(this.size*UIBase.getDPI());\r\n\r\n    if (size !== this.canvas.width) {\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    let c = this.canvas;\r\n\r\n    let size = ~~(this.size*UIBase.getDPI());\r\n\r\n    if (c.width !== size) {\r\n      c.width = c.height = size;\r\n\r\n      size /= UIBase.getDPI();\r\n      c.style[\"width\"] = size + \"px\";\r\n      c.style[\"height\"] = size + \"px\";\r\n\r\n      c.style[\"display\"] = \"flex\";\r\n\r\n      this.style[\"width\"] = size + \"px\";\r\n      this.style[\"height\"] = size + \"px\";\r\n\r\n      //forcibly redraw in this case, do not queue with flagRedraw\r\n      this.draw();\r\n    }\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"align-items\"] = \"center\";\r\n    this.style[\"justify-content\"] = \"center\";\r\n    this.style[\"width\"] = \"100%\";\r\n    this.style[\"height\"] = \"100%\";\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname : \"progress-circle-x\"\r\n    }\r\n  }\r\n}\r\nUIBase.register(ProgressCircle);\r\n","import {PackFlags, UIBase} from \"../core/ui_base.js\";\r\nimport {ColumnFrame} from \"../core/ui.js\";\r\nimport {PropTypes, PropFlags} from \"../path-controller/toolsys/toolprop.js\";\r\n\r\nimport {UndoFlags, ToolFlags} from \"../path-controller/toolsys/toolsys.js\";\r\nimport {DataPath, DataTypes} from \"../path-controller/controller/controller.js\";\r\n\r\nimport {ToolProperty} from '../path-controller/toolsys/toolprop.js';\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport cconst from '../config/const.js';\r\n\r\nconst LastKey = Symbol(\"LastToolPanelId\");\r\nlet tool_idgen = 0;\r\n\r\nexport function getLastToolStruct(ctx) {\r\n  let ret = ctx.state._last_tool;\r\n\r\n  if (!ret) {\r\n    ret = ctx.toolstack.head;\r\n  } else {\r\n    let msg = \"Passing the last tool to last-tool-panel via appstate._last_tool is deprecated;\";\r\n    msg += \"\\nctx.toolstack.head is now used instead.\";\r\n\r\n    console.warn(msg);\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nconst last_tool_eventmap = [];\r\n//window.last_tool_eventmap = last_tool_eventmap;\r\n\r\n/* Try to avoid memory leaks when last tool panels are hidden. */\r\nwindow.setInterval(() => {\r\n  for (const entry of last_tool_eventmap) {\r\n    const panel = entry.panel;\r\n    if (!panel.isConnected || panel.hidden) {\r\n      if (window.DEBUG && window.DEBUG.lastToolPanel) {\r\n        console.log(\"Disconnecting last tool panel from toolstack.\");\r\n      }\r\n\r\n      panel.unlinkEvents();\r\n      panel.needsRebuild = true;\r\n      break;\r\n    }\r\n  }\r\n}, 500);\r\n\r\n/*\r\n*\r\n* This panel shows the most recently executed ToolOp's\r\n* settings.  It assumes that recent toolops are accessible\r\n* in ctx.last_tool.\r\n* */\r\nexport class LastToolPanel extends ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this.ignoreOnChange = false;\r\n    this.on_change = null;\r\n    this._tool_id = undefined;\r\n    this.useDataPathUndo = false;\r\n    this.needsRebuild = false;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.useDataPathUndo = false;\r\n    this.rebuild();\r\n  }\r\n\r\n  /** client code can subclass and override this method */\r\n  getToolStackHead(ctx) {\r\n    //don't process the root toolop\r\n    let bad = ctx.toolstack.length === 0 || ctx.toolstack.cur >= ctx.toolstack.length;\r\n    bad = bad || ctx.toolstack.cur < 0;\r\n    bad = bad || ctx.toolstack[ctx.toolstack.cur].undoflag & UndoFlags.IS_UNDO_ROOT;\r\n\r\n    if (bad) {\r\n      return undefined;\r\n    }\r\n\r\n    return ctx.toolstack[ctx.toolstack.cur];\r\n  }\r\n\r\n  rebuild() {\r\n    let ctx = this.ctx;\r\n    if (ctx === undefined) {\r\n      this._tool_id = -1; //wait for .ctx\r\n      return;\r\n    }\r\n\r\n    this.needsRebuild = false;\r\n\r\n    this.clear();\r\n\r\n    this.label(\"Recent Command Settings\");\r\n\r\n    let tool = this.getToolStackHead(ctx);\r\n\r\n    if (!tool) {\r\n      this.setCSS();\r\n      return;\r\n    }\r\n\r\n    let def = tool.constructor.tooldef();\r\n    let name = def.uiname !== undefined ? def.uiname : def.name;\r\n\r\n    let panel = this.panel(def.uiname);\r\n\r\n    this.on_change = () => {\r\n      if (this.ignoreOnChange) {\r\n        return;\r\n      }\r\n\r\n      if (tool.modalRunning) {\r\n        return;\r\n      }\r\n\r\n      if (tool === ctx.toolstack.head) {\r\n        this.ignoreOnChange = true;\r\n        ctx.toolstack.rerun(tool);\r\n        this.ignoreOnChange = false;\r\n      } else {\r\n        this.unlinkEvents();\r\n      }\r\n    };\r\n\r\n    this.buildTool(ctx, tool, panel);\r\n    this.flushUpdate();\r\n    this.flushUpdate();\r\n  }\r\n\r\n  unlinkEvents() {\r\n    for (const entry of Array.from(last_tool_eventmap)) {\r\n      if (entry.panel === this || !entry.panel.isConnected) {\r\n        entry.prop.off(\"change\", entry.cb);\r\n        last_tool_eventmap.remove(entry);\r\n\r\n        if (entry.panel !== this) {\r\n          entry.panel.needsRebuild = true;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /** client code can subclass and override this method */\r\n  buildTool(ctx, tool, panel) {\r\n    if (tool.flag & ToolFlags.PRIVATE) {\r\n      return;\r\n    }\r\n\r\n    this.unlinkEvents();\r\n    this.last_tool = tool;\r\n\r\n    panel.useDataPathUndo = false;\r\n    for (let k in tool.inputs) {\r\n      let prop = tool.inputs[k];\r\n\r\n      if (prop.flag & (PropFlags.PRIVATE | PropFlags.READ_ONLY)) {\r\n        continue;\r\n      }\r\n\r\n      prop.on(\"change\", this.on_change);\r\n      last_tool_eventmap.push({\r\n        panel: this,\r\n        cb   : this.on_change,\r\n        prop\r\n      })\r\n\r\n      let path = `last_tool.${k}`;\r\n      let uiname = prop.uiname ?? ToolProperty.makeUIName(k);\r\n\r\n      panel.label(uiname);\r\n      let packflag = 0;\r\n\r\n      /* Default to roller number sliders. */\r\n      if (!(prop.flag & PropFlags.SIMPLE_SLIDER)) {\r\n        packflag |= PackFlags.FORCE_ROLLER_SLIDER;\r\n      }\r\n\r\n      let ret = panel.prop(path, packflag);\r\n\r\n      if (ret) {\r\n        //ret.onchange = function() {\r\n        //ctx.toolstack.rerun(tool);\r\n        //}\r\n      }\r\n    }\r\n    this.setCSS();\r\n\r\n    //console.log(\"Building last tool settings\");\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n    let ctx = this.ctx;\r\n\r\n    if (!ctx) {\r\n      return;\r\n    }\r\n\r\n    let tool = this.getToolStackHead(ctx);\r\n\r\n    this.needsRebuild |= tool && (!(LastKey in tool) || tool[LastKey] !== this._tool_id);\r\n\r\n    if (this.needsRebuild) {\r\n      tool[LastKey] = tool_idgen++;\r\n      this._tool_id = tool[LastKey];\r\n\r\n      this.rebuild();\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"last-tool-panel-x\"\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(LastToolPanel);\r\n","export const mimeMap = {\r\n  \".js\"  : \"application/javascript\",\r\n  \".json\": \"text/json\",\r\n  \".html\": \"text/html\",\r\n  \".txt\" : \"text/plain\",\r\n  \".jpg\" : \"image/jpeg\",\r\n  \".png\" : \"image/png\",\r\n  \".tiff\": \"image/tiff\",\r\n  \".gif\" : \"image/gif\",\r\n  \".bmp\" : \"image/bitmap\",\r\n  \".tga\" : \"image/targa\",\r\n  \".svg\" : \"image/svg+xml\",\r\n  \".xml\" : \"text/xml\",\r\n  \".webp\": \"image/webp\",\r\n  \"svg\"  : \"image/svg+xml\",\r\n  \"txt\"  : \"text/plain\",\r\n  \"html\" : \"text/html\",\r\n  \"css\"  : \"text/css\",\r\n  \"ts\"   : \"application/typescript\",\r\n  \"py\"   : \"application/python\",\r\n  \"c\"    : \"application/c\",\r\n  \"cpp\"  : \"application/cpp\",\r\n  \"cc\"   : \"application/cpp\",\r\n  \"h\"    : \"application/c\",\r\n  \"hh\"   : \"application/cpp\",\r\n  \"hpp\"  : \"application/cpp\",\r\n  \"sh\"   : \"application/bash\",\r\n  \"mjs\"  : \"application/javascript\",\r\n  \"cjs\"  : \"application/javascript\",\r\n  \"gif\"  : \"image/gif\"\r\n};\r\n\r\nexport var textMimes = new Set([\r\n  \"application/javascript\", \"application/x-javscript\",\r\n  \"image/svg+xml\", \"application/xml\"\r\n]);\r\n\r\nexport function isMimeText(mime) {\r\n  if (!mime) {\r\n    return false;\r\n  }\r\n\r\n  if (mime.startsWith(\"text\")) {\r\n    return true;\r\n  }\r\n\r\n  return textMimes.has(mime);\r\n}\r\n\r\nexport function getExtension(path) {\r\n  if (!path) {\r\n    return \"\";\r\n  }\r\n\r\n  let i = path.length;\r\n  while (i > 0 && path[i] !== \".\") {\r\n    i--;\r\n  }\r\n\r\n  return path.slice(i, path.length).trim().toLowerCase();\r\n}\r\n\r\nexport function getMime(path) {\r\n  let ext = getExtension(path);\r\n  if (ext in mimeMap) {\r\n    return mimeMap[ext];\r\n  }\r\n\r\n  return \"application/x-octet-stream\";\r\n}\r\n\r\nexport class PlatformAPI {\r\n  static writeFile(data, handle, mime) {\r\n    throw new Error(\"implement me\");\r\n    //returns a promise\r\n  }\r\n\r\n  static resolveURL(path, base = location.href) {\r\n    base = base.trim();\r\n\r\n    if (path.startsWith(\"./\")) {\r\n      path = path.slice(2, path.length).trim();\r\n    }\r\n\r\n    while (path.startsWith(\"/\")) {\r\n      path = path.slice(1, path.length).trim();\r\n    }\r\n\r\n    while (base.endsWith(\"/\")) {\r\n      base = base.slice(0, base.length - 1).trim();\r\n    }\r\n\r\n    let exts = [\"html\", \"txt\", \"js\", \"php\", \"cgi\"]\r\n    for (let ext of exts) {\r\n      ext = \".\" + ext;\r\n      if (base.endsWith(ext)) {\r\n        let i = base.length - 1;\r\n        while (i > 0 && base[i] !== \"/\") {\r\n          i--;\r\n        }\r\n\r\n        base = base.slice(0, i).trim();\r\n      }\r\n    }\r\n\r\n    while (base.endsWith(\"/\")) {\r\n      base = base.slice(0, base.length - 1).trim();\r\n    }\r\n\r\n    path = (base + \"/\" + path).split(\"/\")\r\n    let path2 = [];\r\n\r\n    for (let i = 0; i < path.length; i++) {\r\n      if (path[i] === \"..\") {\r\n        path2.pop();\r\n      } else {\r\n        path2.push(path[i]);\r\n      }\r\n    }\r\n\r\n    return path2.join(\"/\");\r\n  }\r\n\r\n  //returns a promise that resolves to a FilePath that can be used for re-saving.\r\n  static showOpenDialog(title, args = new FileDialogArgs()) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  //returns a promise\r\n  static showSaveDialog(title, savedata_cb, args = new FileDialogArgs()) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  //returns a promise.  if mime is a text type, a string will be fed to the promise,\r\n  //otherwise it will be an ArrayBuffer\r\n  static readFile(path, mime) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n}\r\n\r\nexport class FileDialogArgs {\r\n  constructor() {\r\n    this.multi = false; //allow selecting multiple files\r\n    this.addToRecentList = false; //update recent file list\r\n\r\n    /* example for filters:\r\n    [{\r\n      name : \"Images\",\r\n      mime : \"image/png\"\r\n      extensions : \"[\"png\", \"jpg\"]\r\n    }]\r\n    * */\r\n    this.filters = []\r\n  }\r\n}\r\n\r\n/*a file path, some platforms may not return real payhs*/\r\nexport class FilePath {\r\n  constructor(data, filename = \"unnamed\") {\r\n    this.data = data;\r\n    this.filename = filename;\r\n  }\r\n}\r\n","let promise;\r\n\r\nif (window.haveElectron) {\r\n  promise = import('./electron/electron_api.js');\r\n} else {\r\n  promise = import('./web/web_api.js');\r\n}\r\n\r\nexport var platform;\r\n\r\npromise.then((module) => {\r\n  platform = module.platform;\r\n  promise = undefined;\r\n});\r\n\r\nexport function getPlatformAsync() {\r\n  if (promise) {\r\n    return new Promise((accept, reject) => {\r\n      promise.then(mod => {\r\n        accept(mod.platform);\r\n      });\r\n    });\r\n  }\r\n\r\n  return new Promise((accept, reject) => {\r\n    accept(platform);\r\n  })\r\n}\r\n","\"use strict\";\r\n\r\nlet _nativeTheme;\r\n\r\nfunction getNativeTheme() {\r\n  if (_nativeTheme) {\r\n    return _nativeTheme;\r\n  }\r\n\r\n  let remote = getElectron().remote;\r\n  if (!remote) { /* Newer electron version with no remote, client must provide it */\r\n    ipcRenderer.invoke(\"nativeTheme\");\r\n  } else {\r\n    _nativeTheme = remote.nativeTheme;\r\n  }\r\n\r\n  return _nativeTheme;\r\n}\r\n\r\nfunction getElectronVersion() {\r\n  let key = navigator.userAgent;\r\n  let i = key.search(\"Electron\");\r\n  key = key.slice(i + 9, key.length);\r\n\r\n  i = key.search(/[ \\t]/);\r\n  if (i >= 0) {\r\n    key = key.slice(0, i);\r\n  }\r\n\r\n  key = key.trim();\r\n  key = key.split(\".\").map(f => parseInt(f));\r\n\r\n  return key;\r\n}\r\n\r\n/*\r\n* wrap require to keep angular from auto-importing\r\n* this api in browsers\r\n* */\r\nfunction getElectron() {\r\n  return require('electron');\r\n}\r\n\r\nfunction myRequire(mod) {\r\n  return globalThis.require(mod);\r\n}\r\n\r\nimport {Menu, DropBox} from '../../widgets/ui_menu.js';\r\nimport {getIconManager} from \"../../core/ui_base.js\";\r\nimport cconst from \"../../config/const.js\";\r\nimport * as util from '../../util/util.js';\r\n\r\nimport {FileDialogArgs, FilePath} from '../platform_base.js';\r\n\r\nfunction getFilename(path) {\r\n  let filename = path.replace(/\\\\/g, \"/\");\r\n  let i = filename.length - 1;\r\n  while (i >= 0 && filename[i] !== \"/\") {\r\n    i--;\r\n  }\r\n\r\n  if (filename[i] === \"/\") {\r\n    i++;\r\n  }\r\n\r\n  if (i > 0) {\r\n    filename = filename.slice(i, filename.length).trim();\r\n  }\r\n\r\n  return filename;\r\n}\r\n\r\nlet _menu_init = false;\r\nlet _init = false;\r\n\r\nimport {mimeMap} from '../platform_base.js';\r\n\r\nlet electron_menu_idgen = 1;\r\nlet ipcRenderer;\r\n\r\nexport class ElectronMenu extends Array {\r\n  constructor(args = {}) {\r\n    super();\r\n\r\n    this._ipcId = electron_menu_idgen++;\r\n\r\n    for (let k in args) {\r\n      this[k] = args[k];\r\n    }\r\n  }\r\n\r\n  insert(i, item) {\r\n    this.length++;\r\n\r\n    let j = this.length - 1;\r\n    while (j > i) {\r\n      this[j] = this[j - 1];\r\n      j--;\r\n    }\r\n    this[i] = item;\r\n\r\n    return this;\r\n  }\r\n\r\n  static setApplicationMenu(menu) {\r\n    initElectronIpc();\r\n\r\n    ipcRenderer.invoke(\"set-menu-bar\", menu);\r\n  }\r\n\r\n  closePopup() {\r\n    ipcRenderer.invoke(\"close-menu\", this._ipcId);\r\n  }\r\n\r\n  append(item) {\r\n    this.push(item);\r\n  }\r\n\r\n  popup(args) {\r\n    let {x, y, callback} = args;\r\n\r\n    callback = wrapRemoteCallback(\"popup_menu_click\", callback);\r\n\r\n    const {ipcRenderer} = require('electron')\r\n    ipcRenderer.invoke(\"popup-menu\", this, x, y, callback);\r\n  }\r\n}\r\n\r\nlet callbacks = {};\r\nlet keybase = 1;\r\n\r\nexport function wrapRemoteCallback(key, callback) {\r\n  key = \"remote_\" + key + (keybase++);\r\n  callbacks[key] = callback;\r\n\r\n  return key;\r\n}\r\n\r\nlet ipcInit = false;\r\n\r\nfunction initElectronIpc() {\r\n  if (ipcInit) {\r\n    return;\r\n  }\r\n\r\n  ipcInit = true;\r\n  ipcRenderer = require('electron').ipcRenderer;\r\n\r\n  ipcRenderer.on('invoke-menu-callback', (event, key, args) => {\r\n    //console.error(\"Electron menu callback\", key, args);\r\n    callbacks[key].apply(undefined, args);\r\n  });\r\n\r\n  ipcRenderer.on(\"nativeTheme\", (event, module) => {\r\n    _nativeTheme = Object.assign({}, module);\r\n    _nativeTheme._themeSource = _nativeTheme.themeSource;\r\n\r\n    Object.defineProperty(_nativeTheme, \"themeSource\", {\r\n      get() {\r\n        return this._themeSource;\r\n      },\r\n      set(v) {\r\n        ipcRenderer.invoke(\"nativeTheme.setThemeSource\", v);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n\r\nexport class ElectronMenuItem {\r\n  constructor(args) {\r\n    for (let k in args) {\r\n      this[k] = args[k];\r\n    }\r\n\r\n    if (this.click) {\r\n      this.click = wrapRemoteCallback(\"menu_click\", this.click);\r\n    }\r\n  }\r\n}\r\n\r\nfunction patchDropBox() {\r\n  initElectronIpc();\r\n\r\n  if (cconst.noElectronMenus) {\r\n    return;\r\n  }\r\n\r\n  //haveElectron = false;\r\n  //return;\r\n  DropBox.prototype._onpress = function _onpress(e) {\r\n    if (this._menu !== undefined) {\r\n      this._menu.close();\r\n      this._menu = undefined;\r\n      this._pressed = false;\r\n      this._redraw();\r\n      return;\r\n    }\r\n\r\n    this._build_menu();\r\n\r\n    let emenu = buildElectronMenu(this._menu);\r\n\r\n    this._menu.close = () => {\r\n      emenu.closePopup(); //getCurrentWindow);\r\n    };\r\n\r\n    //console.log(\"menu dropbox click\", this._menu);\r\n\r\n    if (this._menu === undefined) {\r\n      return;\r\n    }\r\n\r\n    this._menu._dropbox = this;\r\n    this.dom._background = this.getDefault(\"BoxDepressed\");\r\n    this._background = this.getDefault(\"BoxDepressed\");\r\n    this._redraw();\r\n    this._pressed = true;\r\n    this.setCSS();\r\n\r\n    let onclose = this._menu.onclose;\r\n    this._menu.onclose = () => {\r\n      this._pressed = false;\r\n      this._redraw();\r\n\r\n      let menu = this._menu;\r\n      if (menu) {\r\n        this._menu = undefined;\r\n        menu._dropbox = undefined;\r\n      }\r\n\r\n      if (onclose) {\r\n        onclose.call(menu);\r\n      }\r\n    }\r\n\r\n    let menu = this._menu;\r\n    let screen = this.getScreen();\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let x = e.x, y = e.y;\r\n    let rects = this.dom.getClientRects();\r\n\r\n    x = rects[0].x;\r\n    y = rects[0].y + Math.ceil(rects[0].height);\r\n\r\n    x = ~~x;\r\n    y = ~~y;\r\n\r\n    emenu.popup({\r\n      x       : x,\r\n      y       : y,\r\n      callback: () => {\r\n\r\n        if (this._menu) {\r\n          this._menu.onclose();\r\n        }\r\n      }\r\n    })\r\n  };\r\n}\r\n\r\nlet on_tick = () => {\r\n  let nativeTheme = getNativeTheme();\r\n\r\n  if (nativeTheme) {\r\n    let mode = nativeTheme.shouldUseDarkColors ? \"dark\" : \"light\";\r\n\r\n    if (mode !== cconst.colorSchemeType) {\r\n      nativeTheme.themeSource = cconst.colorSchemeType;\r\n    }\r\n  }\r\n}\r\n\r\nexport function checkInit() {\r\n  if (window.haveElectron && !_init) {\r\n    _init = true;\r\n\r\n\r\n    patchDropBox();\r\n    setInterval(on_tick, 350);\r\n  }\r\n}\r\n\r\nexport let iconcache = {};\r\n\r\nfunction makeIconKey(icon, iconsheet, invertColors) {\r\n  return \"\" + icon + \":\" + iconsheet + \":\" + invertColors;\r\n}\r\n\r\nexport function getNativeIcon(icon, iconsheet = 0, invertColors = false, size = 16) {\r\n  //let key = makeIconKey(icon, iconsheet, invertColors);\r\n  //if (key in iconcache) {\r\n  //  return iconcache[key];\r\n  //}\r\n\r\n  let icongen;\r\n\r\n  try {\r\n    icongen = myRequire(\"./icogen.js\");\r\n  } catch (error) {\r\n    icongen = myRequire(\"./icogen.cjs\");\r\n  }\r\n\r\n\r\n  window.icongen = icongen;\r\n  let nativeImage = getElectron().nativeImage;\r\n\r\n  let manager = getIconManager();\r\n  let sheet = manager.findSheet(iconsheet);\r\n  let images = [];\r\n\r\n  let sizes = icongen.GetRequiredICOImageSizes();\r\n\r\n  //for (let size of sizes) {\r\n  if (1) {\r\n    let iconsheet = manager.findClosestSheet(size);\r\n    let tilesize = manager.getTileSize(iconsheet);\r\n\r\n    let canvas = document.createElement(\"canvas\");\r\n    let g = canvas.getContext(\"2d\");\r\n\r\n    canvas.width = canvas.height = size;\r\n\r\n    if (invertColors) {\r\n      g.filter = \"invert(100%)\";\r\n    }\r\n\r\n    let scale = size/tilesize;\r\n    g.scale(scale, scale);\r\n\r\n    manager.canvasDraw({getDPI: () => 1.0}, canvas, g, icon, 0, 0, iconsheet);\r\n\r\n    let header = \"data:image/png;base64,\";\r\n    let data = canvas.toDataURL();\r\n\r\n    data = data.slice(header.length, data.length);\r\n    data = Buffer.from(data, \"base64\");\r\n\r\n    myRequire(\"fs\").writeFileSync(\"./myicon2.png\", data);\r\n\r\n    images.push(data);\r\n  }\r\n  //}\r\n\r\n  //let ico = icongen.GenerateICO(images);\r\n  //icon = nativeImage.createFromBuffer(ico);\r\n  //icon = nativeImage.createFromBitmap(ico);\r\n  //myRequire(\"fs\").writeFileSync(\"myicon2.ico\", ico);\r\n  return \"myicon2.png\"\r\n  return icon;\r\n  return undefined\r\n\r\n  window._icon = icon;\r\n  return icon;\r\n}\r\n\r\nlet map = {\r\n  CTRL   : \"Control\",\r\n  ALT    : \"Alt\",\r\n  SHIFT  : \"Shift\",\r\n  COMMAND: \"Command\"\r\n};\r\n\r\nexport function buildElectronHotkey(hk) {\r\n  hk = hk.trim().replace(/[ \\t-]+/g, \"+\");\r\n  for (let k in map) {\r\n    hk = hk.replace(k, map[k]);\r\n  }\r\n\r\n  return hk;\r\n}\r\n\r\nexport function buildElectronMenu(menu) {\r\n  let electron = getElectron().remote;\r\n\r\n  initElectronIpc();\r\n\r\n  //let ElectronMenu = electron.Menu;\r\n  //let ElectronMenuItem = electron.MenuItem;\r\n\r\n  let emenu = new ElectronMenu();\r\n\r\n  let buildItem = (item) => {\r\n    if (item._isMenu) {\r\n      let menu2 = item._menu;\r\n\r\n      return new ElectronMenuItem({\r\n        submenu: buildElectronMenu(item._menu),\r\n        label  : menu2.getAttribute(\"title\")\r\n      });\r\n    }\r\n\r\n\r\n    let hotkey = item.hotkey;\r\n    let icon = item.icon;\r\n    let label = \"\" + item.label;\r\n\r\n    if (hotkey && typeof hotkey !== \"string\") {\r\n      hotkey = buildElectronHotkey(hotkey);\r\n    } else {\r\n      hotkey = \"\" + hotkey;\r\n    }\r\n\r\n    if (icon < 0) {\r\n      icon = undefined;\r\n    }\r\n\r\n    let args = {\r\n      id                 : \"\" + item._id,\r\n      label              : label,\r\n      accelerator        : hotkey,\r\n      icon               : icon ? getNativeIcon(icon) : undefined,\r\n      click              : function () {\r\n        menu.onselect(item._id);\r\n      },\r\n      registerAccelerator: false\r\n    };\r\n\r\n    return new ElectronMenuItem(args);\r\n  }\r\n\r\n  for (let item of menu.items) {\r\n    //buildItem(item);\r\n    emenu.append(buildItem(item));\r\n\r\n  }\r\n\r\n  return emenu;\r\n}\r\n\r\nexport function initMenuBar(menuEditor, override = false) {\r\n  checkInit();\r\n\r\n  if (!window.haveElectron) {\r\n    return;\r\n  }\r\n\r\n  if (_menu_init && !override) {\r\n    return;\r\n  }\r\n\r\n  _menu_init = true;\r\n\r\n  //let win = electron.getCurrentWindow();\r\n\r\n  let menu = new ElectronMenu();\r\n\r\n  let _roles = new Set([\"undo\", \"redo\", \"cut\", \"copy\", \"paste\", \"delete\", \"about\",\r\n                        \"quit\", \"open\", \"save\", \"load\", \"paste\", \"cut\", \"zoom\"]);\r\n  let roles = {};\r\n  for (let k of _roles) {\r\n    roles[k] = k;\r\n  }\r\n\r\n  roles = Object.assign(roles, {\r\n    \"select all\": \"selectAll\",\r\n    \"file\"      : \"fileMenu\",\r\n    \"edit\"      : \"editMenu\",\r\n    \"view\"      : \"viewMenu\",\r\n    \"app\"       : \"appMenu\",\r\n    \"help\"      : \"help\",\r\n    \"zoom in\"   : \"zoomIn\",\r\n    \"zoom out\"  : \"zoomOut\"\r\n  });\r\n\r\n  /*\r\n  let item = new MenuItem({\r\n    label : \"Label\",\r\n    tooltip : \"Tooltip\",\r\n    icon : getNativeIcon(0),\r\n    accelerator : \"Control+Z\",\r\n    checked : true,\r\n    id : 0,\r\n    role : undefined,\r\n    click : (arg) => {\r\n      console.log(\"menu click!\", arg)\r\n    },\r\n    submenu : undefined,\r\n    role :  undo, redo, cut, copy, paste, pasteAndMatchStyle, delete, selectAll, reload,\r\n            forceReload, toggleDevTools, resetZoom, zoomIn, zoomOut, togglefullscreen, window,\r\n             minimize, close, help, about, services, hide, hideOthers, unhide, quit, startSpeaking,\r\n             stopSpeaking, close, minimize, zoom, front, appMenu, fileMenu, editMenu, viewMenu, recentDocuments,\r\n              toggleTabBar, selectNextTab, selectPreviousTab, mergeAllWindows, clearRecentDocuments, moveTabToNewWindow\r\n               or windowMenu - Define the action of the menu item, when specified the click property will be ignored.\r\n                See roles.\r\n\r\n  });//*/\r\n\r\n\r\n  let header = menuEditor.header;\r\n  for (let dbox of header.traverse(DropBox)) {\r\n    dbox._build_menu();\r\n    dbox.update();\r\n\r\n    dbox._build_menu();\r\n    let menu2 = dbox._menu;\r\n    menu2.ctx = dbox.ctx;\r\n    menu2._init();\r\n    menu2.update();\r\n\r\n    let title = dbox._genLabel();\r\n    let args = {\r\n      label  : title,\r\n      tooltip: dbox.description,\r\n      submenu: buildElectronMenu(menu2)\r\n    };\r\n\r\n    menu.insert(0, new ElectronMenuItem(args));\r\n  }\r\n\r\n\r\n  ElectronMenu.setApplicationMenu(menu);\r\n  //win.setMenu(menu);\r\n}\r\n\r\nimport {PlatformAPI, isMimeText} from '../platform_base.js';\r\n\r\nexport class platform extends PlatformAPI {\r\n  static showOpenDialog(title, args = new FileDialogArgs()) {\r\n    console.log(args.filters);\r\n\r\n    let eargs = {\r\n      defaultPath: args.defaultPath,\r\n      filters    : this._sanitizeFilters(args.filters ?? []),\r\n      properties : [\r\n        \"openFile\", \"showHiddenFiles\", \"createDirectory\"\r\n      ]\r\n    }\r\n\r\n    if (args.multi) {\r\n      eargs.properties.push(\"multiSelections\");\r\n    }\r\n\r\n    if (!args.addToRecentList) {\r\n      eargs.properties.push(\"dontAddToRecent\");\r\n    }\r\n\r\n    initElectronIpc();\r\n\r\n    return new Promise((accept, reject) => {\r\n      ipcRenderer.invoke('show-open-dialog', eargs, wrapRemoteCallback(\"open-dialog\", (ret) => {\r\n        if (ret.canceled || ret.cancelled) {\r\n          reject(\"cancel\");\r\n        } else {\r\n          accept(ret.filePaths.map(f => new FilePath(f, getFilename(f))));\r\n        }\r\n      }), wrapRemoteCallback(\"show-open-dialog\", (error) => {\r\n        reject(error);\r\n      }));\r\n    });\r\n  }\r\n\r\n  static _sanitizeFilters(filters) {\r\n    let filters2 = [];\r\n\r\n    for (let filter of filters) {\r\n      if (Array.isArray(filter)) {\r\n        let ext = filter[0];\r\n\r\n        filter = {extensions: filter};\r\n\r\n        ext = ext.replace(/\\./g, \"\").trim().toLowerCase();\r\n        if (ext in mimeMap) {\r\n          filter.mime = mimeMap[ext];\r\n        }\r\n\r\n        filter.name = ext;\r\n      }\r\n\r\n      console.log(filter.extensions);\r\n      filter.extensions = filter.extensions.map(f => f.startsWith(\".\") ? f.slice(1, f.length) : f);\r\n\r\n      filters2.push(filter);\r\n    }\r\n\r\n    return filters2;\r\n  }\r\n\r\n  static showSaveDialog(title, filedata_cb, args = new FileDialogArgs()) {\r\n    console.log(args.filters);\r\n\r\n    let eargs = {\r\n      defaultPath: args.defaultPath,\r\n      filters    : this._sanitizeFilters(args.filters ?? []),\r\n      properties : [\r\n        \"openFile\", \"showHiddenFiles\", \"createDirectory\"\r\n      ]\r\n    }\r\n\r\n    if (args.multi) {\r\n      eargs.properties.push(\"multiSelections\");\r\n    }\r\n\r\n    if (!args.addToRecentList) {\r\n      eargs.properties.push(\"dontAddToRecent\");\r\n    }\r\n\r\n    return new Promise((accept, reject) => {\r\n      initElectronIpc();\r\n\r\n      let onthen = (ret) => {\r\n        if (ret.canceled) {\r\n          reject(\"cancel\");\r\n        } else {\r\n          let path = ret.filePath;\r\n          let filedata = filedata_cb();\r\n\r\n          if (filedata instanceof ArrayBuffer) {\r\n            filedata = new Uint8Array(filedata);\r\n          }\r\n\r\n          require('fs').writeFileSync(path, filedata);\r\n          console.log(\"saved file\", filedata);\r\n\r\n          accept(new FilePath(path, getFilename(path)));\r\n        }\r\n      }\r\n\r\n      let oncatch = (error) => {\r\n        reject(error);\r\n      }\r\n\r\n      ipcRenderer.invoke('show-save-dialog', eargs, wrapRemoteCallback('dialog', onthen), wrapRemoteCallback('dialog', oncatch));\r\n\r\n    });\r\n  }\r\n\r\n  static readFile(path, mime) {\r\n    return new Promise((accept, reject) => {\r\n      let fs = require('fs');\r\n\r\n      if (isMimeText(mime)) {\r\n        accept(fs.readFileSync(path.data, \"utf8\"));\r\n      } else {\r\n        accept(fs.readFileSync(path.data).buffer);\r\n      }\r\n    });\r\n  }\r\n\r\n  static writeFile(data, handle, mime) {\r\n    return new Promise((accept, reject) => {\r\n      let fs = require('fs');\r\n\r\n      fs.writeFileSync(handle.data, data);\r\n      accept(handle);\r\n    });\r\n  }\r\n}\r\n","\"use strict\";\r\nexport const SVG_URL = 'http://www.w3.org/2000/svg';\r\n\r\nimport * as util from './util.js';\r\nimport * as vectormath from './vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as ui from '../core/ui.js';\r\nimport * as math from './math.js';\r\n\r\nconst Vector2 = vectormath.Vector2;\r\n\r\nexport class CanvasOverdraw extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.shadow.appendChild(this.canvas);\r\n    this.g = this.canvas.getContext(\"2d\");\r\n\r\n    this.screen = undefined;\r\n    this.shapes = [];\r\n    this.otherChildren = []; //non-svg elements\r\n    this.font = undefined;\r\n\r\n    let style = document.createElement(\"style\")\r\n    style.textContent = `\r\n      .overdrawx {\r\n        pointer-events : none;\r\n      }\r\n    `;\r\n\r\n    this.shadow.appendChild(style);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname : 'screen-overdraw-canvas-x'\r\n    }\r\n  }\r\n\r\n  startNode(node, screen) {\r\n    if (screen) {\r\n      this.screen = screen;\r\n      this.ctx = screen.ctx;\r\n    }\r\n\r\n    if (!this.parentNode) {\r\n      node.appendChild(this);\r\n    }\r\n\r\n    this.style[\"display\"] = \"float\";\r\n    this.style[\"z-index\"] = this.zindex_base;\r\n\r\n    this.style[\"position\"] = \"absolute\";\r\n    this.style[\"left\"] = \"0px\";\r\n    this.style[\"top\"] = \"0px\";\r\n\r\n    this.style[\"width\"] = \"100%\" //screen.size[0] + \"px\";\r\n    this.style[\"height\"] = \"100%\" //screen.size[1] + \"px\";\r\n\r\n    this.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.svg = document.createElementNS(SVG_URL, \"svg\");\r\n    this.svg.style[\"width\"] = \"100%\";\r\n    this.svg.style[\"height\"] = \"100%\";\r\n\r\n    this.svg.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.shadow.appendChild(this.svg);\r\n    //this.style[\"background-color\"] = \"green\";\r\n  }\r\n\r\n  start(screen) {\r\n    this.screen = screen;\r\n    this.ctx = screen.ctx;\r\n\r\n    screen.parentNode.appendChild(this);\r\n\r\n    this.style[\"display\"] = \"float\";\r\n    this.style[\"z-index\"] = this.zindex_base;\r\n\r\n    this.style[\"position\"] = \"absolute\";\r\n    this.style[\"left\"] = \"0px\";\r\n    this.style[\"top\"] = \"0px\";\r\n\r\n    this.style[\"width\"] = screen.size[0] + \"px\";\r\n    this.style[\"height\"] = screen.size[1] + \"px\";\r\n\r\n    this.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.svg = document.createElementNS(SVG_URL, \"svg\");\r\n    this.svg.style[\"width\"] = \"100%\";\r\n    this.svg.style[\"height\"] = \"100%\";\r\n\r\n    this.shadow.appendChild(this.svg);\r\n\r\n    //this.style[\"background-color\"] = \"green\";\r\n  }\r\n}\r\n\r\nexport class Overdraw extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.visibleToPick = false;\r\n\r\n    this.screen = undefined;\r\n    this.shapes = [];\r\n    this.otherChildren = []; //non-svg elements\r\n    this.font = undefined;\r\n\r\n    let style = document.createElement(\"style\")\r\n    style.textContent = `\r\n      .overdrawx {\r\n        pointer-events : none;\r\n      }\r\n    `;\r\n\r\n    this.shadow.appendChild(style);\r\n\r\n    this.zindex_base = 1000;\r\n  }\r\n\r\n  startNode(node, screen, cssPosition=\"relative\") {\r\n    if (screen) {\r\n      this.screen = screen;\r\n      this.ctx = screen.ctx;\r\n    }\r\n\r\n    if (!this.parentNode) {\r\n      node.appendChild(this);\r\n    }\r\n\r\n    this.style[\"z-index\"] = this.zindex_base;\r\n\r\n    this.style[\"position\"] = cssPosition;\r\n\r\n    //this.style[\"left\"] = \"0px\";\r\n    //this.style[\"top\"] = \"0px\";\r\n    this.style[\"margin\"] = this.style[\"padding\"] = \"0px\";\r\n\r\n    this.style[\"width\"] = \"100%\" //screen.size[0] + \"px\";\r\n    this.style[\"height\"] = \"100%\" //screen.size[1] + \"px\";\r\n\r\n    this.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.svg = document.createElementNS(SVG_URL, \"svg\");\r\n    this.svg.style[\"width\"] = \"100%\";\r\n    this.svg.style[\"height\"] = \"100%\";\r\n\r\n    this.svg.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.shadow.appendChild(this.svg);\r\n    //this.style[\"background-color\"] = \"green\";\r\n  }\r\n\r\n  start(screen) {\r\n    this.screen = screen;\r\n    this.ctx = screen.ctx;\r\n\r\n    screen.parentNode.appendChild(this);\r\n\r\n    this.style[\"display\"] = \"float\";\r\n    this.style[\"z-index\"] = this.zindex_base;\r\n\r\n    this.style[\"position\"] = \"absolute\";\r\n    this.style[\"left\"] = \"0px\";\r\n    this.style[\"top\"] = \"0px\";\r\n\r\n    this.style[\"width\"] = screen.size[0] + \"px\";\r\n    this.style[\"height\"] = screen.size[1] + \"px\";\r\n\r\n    this.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.svg = document.createElementNS(SVG_URL, \"svg\");\r\n    this.svg.style[\"width\"] = \"100%\";\r\n    this.svg.style[\"height\"] = \"100%\";\r\n\r\n    this.shadow.appendChild(this.svg);\r\n\r\n    //this.style[\"background-color\"] = \"green\";\r\n  }\r\n\r\n  clear() {\r\n    for (let child of util.list(this.svg.childNodes)) {\r\n      child.remove();\r\n    }\r\n\r\n    for (let child of this.otherChildren) {\r\n      child.remove();\r\n    }\r\n\r\n    this.otherChildren.length = 0;\r\n  }\r\n\r\n  drawTextBubbles(texts, cos, colors) {\r\n    let boxes = [];\r\n    let elems = [];\r\n\r\n    let cent = new Vector2();\r\n\r\n    for (let i=0; i<texts.length; i++) {\r\n      let co = cos[i];\r\n      let text = texts[i];\r\n      let color;\r\n\r\n      if (colors !== undefined) {\r\n        color = colors[i];\r\n      }\r\n\r\n      cent.add(co);\r\n      let box = this.text(texts[i], co[0], co[1], {color : color});\r\n\r\n      boxes.push(box);\r\n      let font = box.style[\"font\"];\r\n      let pat = /[0-9]+px/;\r\n      let size = font.match(pat)[0];\r\n\r\n      //console.log(\"size\", size);\r\n\r\n      if (size === undefined) {\r\n        size = this.getDefault(\"DefaultText\").size;\r\n      } else {\r\n        size = ui_base.parsepx(size);\r\n      }\r\n\r\n      //console.log(size);\r\n      let tsize = ui_base.measureTextBlock(this, text, undefined, undefined, size, font);\r\n\r\n      box.minsize = [\r\n        ~~tsize.width,\r\n        ~~tsize.height\r\n      ];\r\n\r\n      let pad = ui_base.parsepx(box.style[\"padding\"]);\r\n\r\n      box.minsize[0] += pad*2;\r\n      box.minsize[1] += pad*2;\r\n\r\n      let x = ui_base.parsepx(box.style[\"left\"]);\r\n      let y = ui_base.parsepx(box.style[\"top\"]);\r\n\r\n      box.grads = new Array(4);\r\n      box.params = [x, y, box.minsize[0], box.minsize[1]];\r\n      box.startpos = new Vector2([x, y]);\r\n\r\n      box.setCSS = function() {\r\n        this.style[\"padding\"] = \"0px\";\r\n        this.style[\"margin\"] = \"0px\";\r\n        this.style[\"left\"] = ~~this.params[0] + \"px\";\r\n        this.style[\"top\"] = ~~this.params[1] + \"px\";\r\n        this.style[\"width\"] = ~~this.params[2] + \"px\";\r\n        this.style[\"height\"] = ~~this.params[3] + \"px\";\r\n      };\r\n\r\n      box.setCSS();\r\n      //console.log(box.params);\r\n      elems.push(box);\r\n    }\r\n\r\n    if (boxes.length === 0) {\r\n      return;\r\n    }\r\n\r\n    cent.mulScalar(1.0 / boxes.length);\r\n\r\n    function error() {\r\n      let p1 = [0, 0], p2 = [0, 0];\r\n      let s1 = [0, 0], s2 = [0, 0];\r\n\r\n      let ret = 0.0;\r\n\r\n      for (let box1 of boxes) {\r\n        for (let box2 of boxes) {\r\n          if (box2 === box1) {\r\n            continue;\r\n          }\r\n\r\n          s1[0] = box1.params[2];\r\n          s1[1] = box1.params[3];\r\n          s2[0] = box2.params[2];\r\n          s2[1] = box2.params[3];\r\n\r\n          let overlap = math.aabb_overlap_area(box1.params, s1, box2.params, s2);\r\n          ret += overlap;\r\n        }\r\n\r\n        ret += box1.startpos.vectorDistance(box1.params)*0.25;\r\n      }\r\n\r\n      return ret;\r\n    }\r\n\r\n    function solve() {\r\n      //console.log(\"ERROR\", error());\r\n      let r1 = error();\r\n      if (r1 === 0.0) {\r\n        return;\r\n      }\r\n\r\n      let df = 0.0001;\r\n      let totgs = 0.0;\r\n\r\n      for (let box of boxes) {\r\n        for (let i=0; i<box.params.length; i++) {\r\n          let orig = box.params[i];\r\n          box.params[i] += df;\r\n          let r2 = error();\r\n          box.params[i] = orig;\r\n\r\n          box.grads[i] = (r2 - r1) / df;\r\n          totgs += box.grads[i]**2;\r\n        }\r\n      }\r\n\r\n      if (totgs === 0.0) {\r\n        return;\r\n      }\r\n\r\n      r1 /= totgs;\r\n      let k = 0.4;\r\n\r\n      for (let box of boxes) {\r\n        for (let i = 0; i < box.params.length; i++) {\r\n          box.params[i] += -r1*box.grads[i]*k;\r\n        }\r\n\r\n        box.params[2] = Math.max(box.params[2], box.minsize[0]);\r\n        box.params[3] = Math.max(box.params[3], box.minsize[1]);\r\n\r\n        box.setCSS();\r\n      }\r\n    }\r\n\r\n    for (let i=0; i<15; i++) {\r\n      solve();\r\n    }\r\n\r\n    for (let box of boxes) {\r\n      elems.push(this.line(box.startpos, box.params));\r\n    }\r\n\r\n    return elems;\r\n  }\r\n\r\n  text(text, x, y, args={}) {\r\n    args = Object.assign({}, args);\r\n\r\n    if (args.font === undefined) {\r\n      if (this.font !== undefined)\r\n        args.font = this.font;\r\n      else\r\n        args.font = this.getDefault(\"DefaultText\").genCSS();\r\n    }\r\n\r\n    if (!args[\"background-color\"]) {\r\n      args[\"background-color\"] = \"rgba(75, 75, 75, 0.75)\";\r\n    }\r\n\r\n    args.color = args.color ? args.color : \"white\";\r\n    if (typeof args.color === \"object\") {\r\n      args.color = ui_base.color2css(args.color);\r\n    }\r\n\r\n    args[\"padding\"] = args[\"padding\"] === undefined ? \"5px\" : args[\"padding\"];\r\n    args[\"border-color\"] = args[\"border-color\"] ? args[\"border-color\"] : \"grey\";\r\n    args[\"border-radius\"] = args[\"border-radius\"] ? args[\"border-radius\"] : \"25px\";\r\n    args[\"border-width\"] = args[\"border-width\"] !== undefined ? args[\"border-width\"] : \"2px\";\r\n\r\n    if (typeof args[\"border-width\"] === \"number\") {\r\n      args[\"border-width\"] = \"\" + args[\"border-width\"] + \"px\";\r\n    }\r\n    if (typeof args[\"border-radius\"] === \"number\") {\r\n      args[\"border-radius\"] = \"\" + args[\"border-radius\"] + \"px\";\r\n    }\r\n\r\n    //not sure I need SVG for this. . .\r\n    let box = document.createElement(\"div\")\r\n\r\n    box.setAttribute(\"class\", \"overdrawx\");\r\n\r\n    box.style[\"position\"] = \"fixed\";\r\n    box.style[\"width\"] = \"min-contents\";\r\n    box.style[\"height\"] = \"min-contents\";\r\n    box.style[\"border-width\"] = args[\"border-width\"]\r\n    box.style[\"border-radius\"] = \"25px\";\r\n    box.style[\"pointer-events\"] = \"none\";\r\n    box.style[\"z-index\"] = this.zindex_base + 1;\r\n    box.style[\"background-color\"] = args[\"background-color\"];\r\n    box.style[\"padding\"] = args[\"padding\"];\r\n\r\n    box.style[\"left\"] = x + \"px\";\r\n    box.style[\"top\"] = y + \"px\";\r\n\r\n    box.style[\"display\"] = \"flex\";\r\n    box.style[\"justify-content\"] = \"center\";\r\n    box.style[\"align-items\"] = \"center\";\r\n\r\n    box.innerText = text;\r\n    box.style[\"font\"] = args.font;\r\n    box.style[\"color\"] = args.color;\r\n\r\n    this.otherChildren.push(box);\r\n    this.shadow.appendChild(box);\r\n\r\n    return box;\r\n  }\r\n\r\n  circle(p, r, stroke=\"black\", fill=\"none\") {\r\n    let circle = document.createElementNS(SVG_URL, \"circle\");\r\n    circle.setAttribute(\"cx\", p[0]);\r\n    circle.setAttribute(\"cy\", p[1]);\r\n    circle.setAttribute(\"r\", r);\r\n\r\n    if (fill) {\r\n      circle.setAttribute(\"style\", `stroke:${stroke};stroke-width:2;fill:${fill}`);\r\n    } else {\r\n      circle.setAttribute(\"style\", `stroke:${stroke};stroke-width:2`);\r\n    }\r\n\r\n    this.svg.appendChild(circle);\r\n\r\n    return circle;\r\n  }\r\n\r\n  line(v1, v2, color=\"black\") {\r\n    let line = document.createElementNS(SVG_URL, \"line\");\r\n    line.setAttribute(\"x1\", v1[0]);\r\n    line.setAttribute(\"y1\", v1[1]);\r\n    line.setAttribute(\"x2\", v2[0]);\r\n    line.setAttribute(\"y2\", v2[1]);\r\n    line.setAttribute(\"style\", `stroke:${color};stroke-width:2`);\r\n\r\n    this.svg.appendChild(line);\r\n    return line;\r\n  }\r\n\r\n  rect(p, size, color=\"black\") {\r\n    let line = document.createElementNS(SVG_URL, \"rect\");\r\n    line.setAttribute(\"x\", p[0]);\r\n    line.setAttribute(\"y\", p[1]);\r\n    line.setAttribute(\"width\", size[0]);\r\n    line.setAttribute(\"height\", size[1]);\r\n    line.setAttribute(\"style\", `fill:${color};stroke-width:2`);\r\n\r\n    line.setColor = (color) => {\r\n      line.setAttribute(\"style\", `fill:${color};stroke-width:2`);\r\n    };\r\n\r\n    this.svg.appendChild(line);\r\n    return line;\r\n  }\r\n\r\n  end() {\r\n    this.clear();\r\n    this.remove();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"overdraw-x\",\r\n    style   : \"overdraw\"\r\n  };}\r\n}\r\n\r\nui_base.UIBase.internalRegister(Overdraw);\r\n","import '../util/ScreenOverdraw.js';\r\nimport {UIBase, Icons} from '../core/ui_base.js';\r\nimport {Container} from '../core/ui.js';\r\nimport {pushModalLight, popModalLight, keymap} from '../path-controller/util/simple_events.js';\r\nimport {parsepx} from '../core/ui_theme.js';\r\nimport {Vector2} from '../path-controller/util/vectormath.js';\r\nimport * as math from '../path-controller/util/math.js';\r\n\r\nexport class TreeItem extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.treeParent = undefined;\r\n    this.treeChildren = [];\r\n    this.treeView = undefined;\r\n    this.treeDepth = 0;\r\n\r\n    this.header = this.row();\r\n\r\n    this._icon1 = this.header.iconbutton(Icons.TREE_COLLAPSE);\r\n    this._icon1.iconsheet = 0;\r\n    this._icon1.drawButtonBG = false;\r\n\r\n    this._icon2 = undefined;\r\n\r\n    this._icon1.onclick = () => {\r\n      if (this.opened) {\r\n        this.close();\r\n      }  else {\r\n        this.open();\r\n      }\r\n    }\r\n\r\n    this.opened = true;\r\n\r\n    this._label = this.header.label(\"unlabeled\");\r\n    this._labelText = \"unlabeled\";\r\n  }\r\n\r\n  set icon(id) {\r\n    if (this._icon2) {\r\n      this._icon2 = id;\r\n    } else {\r\n      this._icon2 = UIBase.createElement(\"icon-label-x\");\r\n      this._icon2.icon = id;\r\n      this._icon2.iconsheet = 0;\r\n\r\n\r\n      this.header.insert(1, this._icon2);\r\n    }\r\n  }\r\n\r\n  get icon() {\r\n    if (this._icon2)\r\n      return this._icon2.icon;\r\n    else\r\n      return -1;\r\n  }\r\n\r\n  open() {\r\n    this._icon1.icon = Icons.TREE_COLLAPSE;\r\n    this.opened = true;\r\n    this.treeView._open(this);\r\n  }\r\n\r\n  close() {\r\n    this._icon1.icon = Icons.TREE_EXPAND;\r\n    this.opened = false;\r\n    this.treeView._close(this);\r\n  }\r\n\r\n  set text(b) {\r\n    if (typeof b === \"string\") {\r\n      this._label.text = b;\r\n      this._labelText = b;\r\n    } else if (b instanceof HTMLElement) {\r\n      this._label.remove();\r\n      this.header.add(b);\r\n\r\n      this._label = b;\r\n      this._labelText = b;\r\n    }\r\n  }\r\n\r\n  get text() {\r\n    return this._labelText;\r\n  }\r\n\r\n\r\n  item(name, args={}) {\r\n    args.treeParent = this;\r\n    return this.parentWidget.item(name, args);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"tree-item-x\",\r\n    style   : \"treeview\"\r\n  }}\r\n}\r\nUIBase.internalRegister(TreeItem);\r\n\r\nexport class TreeView extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.items = [];\r\n    this.strokes = [];\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-direction\"] = \"column\";\r\n\r\n    //this.shadow.appendChild(this.overdraw);\r\n\r\n    this.overdraw = UIBase.createElement(\"overdraw-x\");\r\n    console.log(this.overdraw.startNode);\r\n    this.overdraw.startNode(this);\r\n\r\n    this.style[\"margin\"] = this.style[\"padding\"] = \"0px\";\r\n\r\n    this.updateOverdraw();\r\n  }\r\n\r\n  _forAllChildren(item, cb) {\r\n    let visit = (n) => {\r\n      cb(n);\r\n\r\n      for (let c of n.treeChildren) {\r\n        visit(c);\r\n      }\r\n    }\r\n\r\n    for (let c of item.treeChildren) {\r\n      visit(c);\r\n    }\r\n  }\r\n\r\n  _open(item) {\r\n    this._forAllChildren(item, (c) => {\r\n      if (c.opened) {\r\n        c.unhide();\r\n      }\r\n    })\r\n\r\n    this._makeStrokes();\r\n  }\r\n\r\n  _close(item) {\r\n    this._forAllChildren(item, (c) => {\r\n      c.hide();\r\n    })\r\n\r\n    this._makeStrokes();\r\n  }\r\n\r\n  _makeStrokes() {\r\n    if (!this.overdraw) {\r\n      //this.doOnce(this._makeStrokes);\r\n      return;\r\n    }\r\n\r\n    for (let elem of this.strokes) {\r\n      elem.remove();\r\n    }\r\n    this.strokes.length = 0;\r\n\r\n    let hidden = (item) => {\r\n      return item.hidden;\r\n      let p = item;\r\n\r\n      while (p) {\r\n        if (!p.opened)\r\n          return true;\r\n        p = p.treeParent;\r\n      }\r\n\r\n      return false;\r\n    }\r\n\r\n    let items = this.items;\r\n    if (items.length == 0) {\r\n      return;\r\n    }\r\n\r\n    this.overdraw.clear();\r\n\r\n    let next = (i) => {\r\n      i++;\r\n\r\n      while (i < items.length && hidden(items[i])) {\r\n        i++;\r\n        continue;\r\n      }\r\n\r\n      return i;\r\n    }\r\n\r\n    let i = 0;\r\n    if (hidden(items[i]))\r\n      i = next(i);\r\n\r\n    let origin = this.overdraw.getBoundingClientRect();\r\n    let overdraw = this.overdraw;\r\n\r\n    let line = function(x1, y1, x2, y2) {\r\n      let ox = origin.x, oy = origin.y;\r\n\r\n      x1 -= ox; y1 -= oy;\r\n      x2 -= ox; y2 -= oy;\r\n\r\n      overdraw.line([x1, y1], [x2, y2]);\r\n    }\r\n\r\n    console.log(\"making lines\", i);\r\n\r\n    let indent = this.getDefault(\"itemIndent\");\r\n    let rowh = this.getDefault(\"rowHeight\");\r\n\r\n    let getx = (depth) => {\r\n      return (depth+2.2)*indent + origin.x;\r\n    }\r\n\r\n    this.overdraw.style[\"z-index\"] = \"0\";\r\n\r\n    let prev = undefined;\r\n\r\n    for (; i<items.length; i = next(i)) {\r\n      let item = this.items[i];\r\n      let item2 = next(i);\r\n      item2 = item2 < items.length ? items[item2] : undefined;\r\n\r\n      let r = item._icon1.getBoundingClientRect();\r\n\r\n      if (!r) continue;\r\n\r\n      let x1 = getx(item.treeDepth);\r\n      let y1 = origin.y + (i+1)*rowh - rowh*0.25;\r\n\r\n\r\n      if (item2 && item2.treeDepth > item.treeDepth) {//} && (!prev || prev.treeDepth !== item.treeDepth)) {\r\n        let y2 = y1 + rowh*0.75;\r\n\r\n        line(x1, y1, x1, y2)\r\n        line(x1, y2, getx(item2.treeDepth)-3, y2);\r\n\r\n      } else if (item2 && item2.treeDepth === item.treeDepth) {\r\n        line(x1, y1, x1, y1+rowh*0.5)\r\n      }\r\n\r\n      prev = item;\r\n    }\r\n  }\r\n\r\n  updateOverdraw() {\r\n    let mm = new math.MinMax(2);\r\n    let ok = false;\r\n\r\n    for (let item of this.items) {\r\n      if (item.hidden) {\r\n        //continue;\r\n      }\r\n\r\n      for (let r of item.getClientRects()) {\r\n        //console.log(r.y);\r\n        mm.minmax([r.x, r.y]);\r\n        mm.minmax([r.x+r.width, r.y+r.height]);\r\n        ok = true;\r\n      }\r\n    }\r\n\r\n    if (!ok) {\r\n      return;\r\n    }\r\n\r\n    let r = this.getClientRects()[0];\r\n    if (!r) return;\r\n\r\n    let x = r.left;\r\n    let y = r.top;// - r.y;\r\n\r\n    let od = this.overdraw;\r\n    let w = mm.max[0] - mm.min[0];\r\n    let h = mm.max[1] - mm.min[1];\r\n\r\n    od.style[\"margin\"] = \"0px\";\r\n    od.style[\"padding\"] = \"0px\";\r\n    od.svg.style[\"margin\"] = \"0px\";\r\n\r\n    od.style[\"position\"] = UIBase.PositionKey;\r\n\r\n    od.style[\"width\"] = (r.width-1) + \"px\";\r\n    od.style[\"height\"] = (r.height-1) + \"px\";\r\n\r\n    od.style[\"left\"] = x + \"px\";\r\n    od.style[\"top\"] =  y + \"px\";\r\n\r\n    //od.style[\"background-color\"] = \"rgba(50, 50, 50, 0.25)\";\r\n    //od.svg.style[\"background-color\"] = \"rgba(50, 50, 50, 0.25)\";\r\n\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateOverdraw();\r\n  }\r\n\r\n  item(name, args={icon : undefined}) {\r\n    let ret = UIBase.createElement(\"tree-item-x\");\r\n    this.add(ret);\r\n    ret._init();\r\n\r\n    ret.text = name;\r\n\r\n    if (args.icon) {\r\n      ret.icon = args.icon;\r\n    }\r\n\r\n    ret.treeParent = args.treeParent;\r\n    ret.treeView = this;\r\n\r\n    //ret.style[\"margin-bottom\"] = ret.style[\"margin-top\"] = \"0px\";\r\n    //ret.style[\"padding-bottom\"] = ret.style[\"padding-top\"] = \"0px\";\r\n    ret.style[\"max-height\"] = this.getDefault(\"rowHeight\") + \"px\";\r\n\r\n    if (ret.treeParent) {\r\n      ret.treeParent.treeChildren.push(ret);\r\n      ret.treeDepth = ret.treeParent.treeDepth + 1;\r\n    }\r\n\r\n    let p = ret.treeParent;\r\n    let i = 1;\r\n    while (p) {\r\n      p = p.treeParent;\r\n      i++;\r\n    }\r\n\r\n    ret.style[\"margin-left\"] = (i*this.getDefault(\"itemIndent\")) + \"px\";\r\n    this.items.push(ret);\r\n\r\n    this.doOnce(() => {\r\n      this._makeStrokes();\r\n    });\r\n\r\n    return ret;\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"tree-view-x\",\r\n    style   : \"treeview\"\r\n  }}\r\n}\r\nUIBase.internalRegister(TreeView);\r\n\r\n","import {UIBase, Icons} from '../core/ui_base.js';\r\nimport {Container} from '../core/ui.js';\r\nimport {pushModalLight, popModalLight, keymap} from '../path-controller/util/simple_events.js';\r\nimport {parsepx} from '../core/ui_theme.js';\r\n\r\nfunction startDrag(box) {\r\n  if (box._modal) {\r\n    popModalLight(box._modal);\r\n    box._modal = undefined;\r\n    return;\r\n  }\r\n\r\n  let first = true;\r\n  let lastx = 0;\r\n  let lasty = 0;\r\n\r\n  let handlers = {\r\n    on_mousemove(e) {\r\n      let x = e.x, y = e.y;\r\n\r\n      if (first) {\r\n        lastx = x;\r\n        lasty = y;\r\n        first = false;\r\n\r\n        return;\r\n      }\r\n\r\n      let dx = x - lastx;\r\n      let dy = y - lasty;\r\n\r\n      let hx = parsepx(box.style[\"left\"]);\r\n      let hy = parsepx(box.style[\"top\"]);\r\n\r\n      hx += dx;\r\n      hy += dy;\r\n\r\n      console.log(hx, hy);\r\n\r\n      box.style[\"left\"] = hx + \"px\";\r\n      box.style[\"top\"] = hy + \"px\";\r\n\r\n      lastx = x;\r\n      lasty = y;\r\n    },\r\n\r\n    end() {\r\n      if (box._modal) {\r\n        popModalLight(box._modal);\r\n        box._modal = undefined;\r\n      }\r\n    },\r\n\r\n    on_mouseup(e) {\r\n      this.end();\r\n    },\r\n\r\n    on_keydown(e) {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Escape\"]:\r\n        case keymap[\"Return\"]:\r\n          this.end();\r\n          break;\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  box._modal = pushModalLight(handlers);\r\n}\r\n\r\nexport class DragBox extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this._done = false;\r\n    this.header = UIBase.createElement(\"rowframe-x\");\r\n    this.contents = UIBase.createElement(\"container-x\");\r\n\r\n    this.header.style[\"border-radius\"] = \"20px\";\r\n\r\n    this.header.parentWidget = this;\r\n    this.contents.parentWidget = this;\r\n\r\n    this.shadow.appendChild(this.header);\r\n    this.shadow.appendChild(this.contents);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    let header = this.header;\r\n\r\n    header.ctx = this.ctx;\r\n    this.contents.ctx = this.ctx;\r\n    header._init();\r\n    this.contents._init();\r\n\r\n    this.style[\"min-width\"] = \"350px\";\r\n    header.style[\"height\"] = \"35px\";\r\n\r\n    let icon = header.iconbutton(Icons.DELETE, \"Hide\", () => {\r\n      this.end();\r\n    });\r\n    icon.iconsheet = 0; //use small icons\r\n\r\n    this.addEventListener(\"mousedown\", (e) => {\r\n      console.log(\"start drag\");\r\n      startDrag(this);\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n\r\n    }, {capture : false})\r\n\r\n    header.background = this.getDefault(\"background-color\");\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  add() {\r\n    return this.contents.add(...arguments);\r\n  }\r\n\r\n  prepend(n) {\r\n    return this.contents.prepend(n);\r\n  }\r\n\r\n  appendChild(n) {\r\n    return this.contents.appendChild(n);\r\n  }\r\n  col() {\r\n    return this.contents.col(...arguments);\r\n  }\r\n\r\n  row() {\r\n    return this.contents.row(...arguments);\r\n  }\r\n\r\n  strip() {\r\n    return this.contents.strip(...arguments);\r\n  }\r\n  button() {\r\n    return this.contents.button(...arguments);\r\n  }\r\n  iconbutton() {\r\n    return this.contents.iconbutton(...arguments);\r\n  }\r\n  iconcheck() {\r\n    return this.contents.iconcheck(...arguments);\r\n  }\r\n  tool() {\r\n    return this.contents.tool(...arguments);\r\n  }\r\n  menu() {\r\n    return this.contents.menu(...arguments);\r\n  }\r\n  prop() {\r\n    return this.contents.prop(...arguments);\r\n  }\r\n  listenum() {\r\n    return this.contents.listenum(...arguments);\r\n  }\r\n  check() {\r\n    return this.contents.check(...arguments);\r\n  }\r\n  iconenum() {\r\n    return this.contents.iconenum(...arguments);\r\n  }\r\n  slider() {\r\n    return this.contents.slider(...arguments);\r\n  }\r\n  simpleslider() {\r\n    return this.contents.simpleslider(...arguments);\r\n  }\r\n  curve() {\r\n    return this.contents.curve(...arguments);\r\n  }\r\n  textbox() {\r\n    return this.contents.textbox(...arguments);\r\n  }\r\n  textarea() {\r\n    return this.contents.textarea(...arguments);\r\n  }\r\n  viewer() {\r\n    return this.contents.viewer(...arguments);\r\n  }\r\n  panel() {\r\n    return this.contents.panel(...arguments);\r\n  }\r\n  tabs() {\r\n    return this.contents.tabs(...arguments);\r\n  }\r\n  table() {\r\n    return this.contents.table(...arguments);\r\n  }\r\n\r\n\r\n  end() {\r\n    if (this._done) {\r\n      return;\r\n    }\r\n    this.remove();\r\n\r\n    if (this._onend) {\r\n      this._onend();\r\n    }\r\n\r\n    if (this.onend) {\r\n      this.onend();\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.background = this.getDefault(\"background-color\");\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"drag-box-x\",\r\n    style   : \"panel\"\r\n  }}\r\n}\r\nUIBase.internalRegister(DragBox);\r\n","import {UIBase, saveUIData, loadUIData} from '../core/ui_base.js';\r\n\r\nimport * as util from \"../path-controller/util/util.js\"\r\nimport cconst from \"../config/const.js\";\r\nimport * as nstructjs from \"../path-controller/util/struct.js\";\r\n\r\nimport {Vector2} from '../path-controller/util/vectormath.js';\r\nimport {Container} from \"../core/ui.js\";\r\nimport {Area} from \"./ScreenArea.js\";\r\nimport {Icons} from \"../core/ui_base.js\";\r\n\r\nimport {startMenu} from \"../widgets/ui_menu.js\";\r\nimport {getAreaIntName, setAreaTypes, AreaWrangler, areaclasses} from './area_wrangler.js';\r\n\r\nlet ignore = 0;\r\n\r\nfunction dockerdebug() {\r\n  if (cconst.DEBUG.areadocker) {\r\n    console.warn(...arguments);\r\n  }\r\n}\r\n\r\nwindow.testSnapScreenVerts = function (arg) {\r\n  let screen = CTX.screen;\r\n\r\n  screen.unlisten();\r\n  screen.on_resize([screen.size[0] - 75, screen.size[1]], screen.size);\r\n  screen.on_resize = screen.updateSize = () => {\r\n  };\r\n\r\n  let p = CTX.propsbar;\r\n  p.pos[0] += 50;\r\n  p.owning_sarea.loadFromPosSize();\r\n  screen.regenBorders();\r\n\r\n  screen.size[0] = window.innerWidth - 5;\r\n\r\n  screen.snapScreenVerts(arg);\r\n}\r\n\r\nexport class AreaDocker extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this._last_update_key = undefined;\r\n    this.mpos = new Vector2();\r\n    this.needsRebuild = true;\r\n    this.ignoreChange = 0;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"area-docker-x\",\r\n      style  : \"areadocker\"\r\n    }\r\n  }\r\n\r\n  rebuild() {\r\n    if (!this.parentWidget) {\r\n      return;\r\n    }\r\n\r\n    let sarea = this.getArea().parentWidget;\r\n    if (!sarea) {\r\n      this.needsRebuild = true;\r\n      return;\r\n    }\r\n\r\n    this.needsRebuild = false;\r\n    this.ignoreChange++;\r\n\r\n    dockerdebug(\"Rebuild\", this.getArea());\r\n\r\n    let uidata = sarea.switcherData = saveUIData(this, \"switcherTabs\");\r\n\r\n    this.clear();\r\n\r\n    let tabs = this.tbar = this.tabs()\r\n    tabs.onchange = this.tab_onchange.bind(this);\r\n\r\n    let tab;\r\n\r\n    dockerdebug(sarea._id, sarea.area ? sarea.area._id : \"(no active area)\", sarea.editors)\r\n\r\n    sarea.switcherData = uidata;\r\n\r\n    for (let editor of sarea.editors) {\r\n      let def = editor.constructor.define();\r\n      let name = def.uiname;\r\n\r\n      if (!name) {\r\n        name = def.areaname || def.tagname.replace(/-x/, '');\r\n        name = ToolProperty.makeUIName(name);\r\n      }\r\n\r\n      let tab = tabs.tab(name, editor._id);\r\n\r\n      let start_mpos = new Vector2();\r\n      let mpos = new Vector2();\r\n\r\n      tab._tab.addEventListener(\"tabdragstart\", (e) => {\r\n        if (e.x !== 0 && e.y !== 0) {\r\n          start_mpos.loadXY(e.x, e.y);\r\n          this.mpos.loadXY(e.x, e.y);\r\n        } else {\r\n          start_mpos.load(this.mpos);\r\n        }\r\n\r\n        dockerdebug(\"tab drag start!\", start_mpos, e);\r\n      });\r\n      tab._tab.addEventListener(\"tabdragmove\", (e) => {\r\n        this.mpos.loadXY(e.x, e.y);\r\n\r\n        let rect = this.tbar.tbar.canvas.getBoundingClientRect();\r\n\r\n        let x = e.x, y = e.y;\r\n\r\n        let m = 8;\r\n        if (x < rect.x - m || x > rect.x + rect.width + m || y < rect.y - m || y >= rect.y + rect.height + m) {\r\n          dockerdebug(\"tab detach!\");\r\n          e.preventDefault(); //end dragging\r\n          this.detach(e);\r\n        }\r\n      });\r\n      tab._tab.addEventListener(\"tabdragend\", (e) => {\r\n\r\n        this.mpos.loadXY(e.x, e.y);\r\n        dockerdebug(\"tab drag end!\", e);\r\n      });\r\n    }\r\n\r\n    tab = this.tbar.icontab(Icons.SMALL_PLUS, \"add\", \"Add Editor\", false).noSwitch();\r\n    dockerdebug(\"Add Menu Tab\", tab);\r\n\r\n    let icon = this.addicon = tab._tab;\r\n\r\n    icon.ontabclick = e => this.on_addclick(e);\r\n    icon.setAttribute(\"menu-button\", \"true\");\r\n    icon.setAttribute(\"simple\", \"true\");\r\n\r\n    this.loadTabData(uidata);\r\n\r\n    this.ignoreChange--;\r\n  }\r\n\r\n  detach(event) {\r\n    this.tbar._ensureNoModal();\r\n\r\n    let area = this.getArea();\r\n    let sarea = this.ctx.screen.floatArea(area);\r\n\r\n    sarea.size.min([300, 300]);\r\n    sarea.loadFromPosSize();\r\n\r\n    let mpos = event ? new Vector2([event.x, event.y]) : this.mpos;\r\n\r\n    dockerdebug(\"EVENT\", event);\r\n\r\n    if (event && event instanceof PointerEvent) {\r\n      this.ctx.screen.moveAttachTool(sarea, mpos, document.body, event.pointerId);\r\n    } else {\r\n      this.ctx.screen.moveAttachTool(sarea, mpos);\r\n    }\r\n  }\r\n\r\n  loadTabData(uidata) {\r\n    this.ignoreChange++;\r\n    loadUIData(this, uidata);\r\n    this.ignoreChange--;\r\n  }\r\n\r\n  on_addclick(e) {\r\n    let mpos = new Vector2([e.x, e.y]);\r\n\r\n    if (this.addicon.menu && !this.addicon.menu.closed) {\r\n      this.addicon.menu.close();\r\n    } else {\r\n      this.addTabMenu(e.target, mpos);\r\n    }\r\n  }\r\n\r\n  tab_onchange(tab, event) {\r\n    if (this.ignoreChange) {\r\n      return;\r\n    }\r\n\r\n    dockerdebug(\"EVENT\", event);\r\n\r\n    if (event && (!(event instanceof PointerEvent) || event.pointerType === \"mouse\")) {\r\n      //event.preventDefault(); //prevent tab dragging\r\n    }\r\n\r\n    this.select(tab.id, event);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"touch-action\"] = \"none\";\r\n\r\n    this.addEventListener(\"pointermove\", (e) => {\r\n      this.mpos.loadXY(e.x, e.y);\r\n    });\r\n\r\n    this.rebuild();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n  }\r\n\r\n  getArea() {\r\n    let p = this.parentWidget;\r\n    let lastp = p;\r\n\r\n    let name = UIBase.getInternalName(\"screenarea-x\");\r\n    while (p && p.tagName.toLowerCase() !== name) {\r\n      lastp = p;\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    return lastp\r\n  }\r\n\r\n  flagUpdate() {\r\n    this.needsRebuild = true;\r\n    return this;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    let active = this.tbar.getActive();\r\n    let area = this.getArea();\r\n\r\n    let key = this.parentWidget._id;\r\n    for (let area2 of area.parentWidget.editors) {\r\n      key += area2._id + \":\";\r\n    }\r\n\r\n    if (key !== this._last_update_key) {\r\n      this._last_update_key = key;\r\n      this.needsRebuild = true;\r\n    }\r\n\r\n    if (this.needsRebuild) {\r\n      this.rebuild();\r\n      return;\r\n    }\r\n\r\n    if (this.addicon) {\r\n      let tabs = this.tbar.tbar.tabs;\r\n      let idx = tabs.indexOf(this.addicon);\r\n      if (idx !== tabs.length - 1) {\r\n        this.tbar.tbar.swapTabs(this.addicon, tabs[tabs.length - 1]);\r\n\r\n      }\r\n    }\r\n\r\n    if (!active || active._id !== area._id) {\r\n      this.ignoreChange++;\r\n\r\n      try {\r\n        this.tbar.setActive(area._id);\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        this.needsRebuild = true;\r\n      }\r\n\r\n      this.ignoreChange--;\r\n    }\r\n\r\n    window.tabs = this.tbar;\r\n\r\n    this.ignoreChange = 0;\r\n  }\r\n\r\n  select(areaId, event) {\r\n    dockerdebug(\"Tab Select!\", areaId);\r\n\r\n    this.ignoreChange++;\r\n\r\n    let area = this.getArea();\r\n    let sarea = area.parentWidget;\r\n\r\n    let uidata = saveUIData(this.tbar, \"switcherTabs\");\r\n    let newarea;\r\n\r\n    for (let area2 of sarea.editors) {\r\n      if (area2._id === areaId) {\r\n        newarea = area2;\r\n        sarea.switchEditor(area2.constructor);\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (newarea === area || !newarea.switcher) {\r\n      return;\r\n    }\r\n\r\n    //this.ctx.screen.completeSetCSS();\r\n    //this.ctx.screen.completeUpdate();\r\n    sarea.flushSetCSS();\r\n    sarea.flushUpdate();\r\n\r\n    newarea = sarea.area;\r\n\r\n    /* unswap switchers to avoid a bug in Chrome where\r\n    *  touch-action appears to not be respected due to our\r\n    *  swapping elements */\r\n\r\n    let parentw = area.switcher.parentWidget;\r\n    let newparentw = newarea.switcher.parentWidget;\r\n\r\n    let parent = area.switcher.parentNode;\r\n    let newparent = newarea.switcher.parentNode;\r\n\r\n    area.switcher = newarea.switcher;\r\n    newarea.switcher = this;\r\n\r\n    HTMLElement.prototype.remove.call(area.switcher);\r\n    HTMLElement.prototype.remove.call(newarea.switcher);\r\n\r\n    if (parent instanceof UIBase) {\r\n      parent.shadow.appendChild(area.switcher);\r\n    } else {\r\n      parent.appendChild(area.switcher);\r\n    }\r\n\r\n    if (newparent instanceof UIBase) {\r\n      newparent.shadow.prepend(newarea.switcher);\r\n    } else {\r\n      newparent.prepend(newarea.switcher);\r\n    }\r\n\r\n    area.switcher.parentWidget = parentw;\r\n    newarea.switcher.parentWidget = newparentw;\r\n\r\n    area.switcher.tbar._ensureNoModal();\r\n    newarea.switcher.tbar._ensureNoModal();\r\n\r\n    newarea.switcher.loadTabData(uidata);\r\n    area.switcher.loadTabData(uidata);\r\n\r\n    newarea.switcher.setCSS();\r\n    newarea.switcher.update();\r\n\r\n    if (event && (event instanceof PointerEvent || event instanceof MouseEvent || event instanceof TouchEvent)) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n      newarea.switcher.tbar._startMove(undefined, event);\r\n    }\r\n\r\n    //console.log(this._id);\r\n\r\n    sarea.switcherData = uidata;\r\n    this.ignoreChange--;\r\n  }\r\n\r\n  addTabMenu(tab, mpos) {\r\n    let rect = tab.getClientRects()[0];\r\n\r\n    dockerdebug(tab, tab.getClientRects());\r\n\r\n    if (!mpos) {\r\n      mpos = this.ctx.screen.mpos;\r\n    }\r\n\r\n    let menu = UIBase.createElement(\"menu-x\");\r\n\r\n    menu.closeOnMouseUp = false;\r\n    menu.ctx = this.ctx;\r\n    menu._init();\r\n\r\n    let prop = Area.makeAreasEnum();\r\n    let sarea = this.getArea().parentWidget;\r\n\r\n    if (!sarea) {\r\n      return;\r\n    }\r\n\r\n    for (let k in Object.assign({}, prop.values)) {\r\n      let ok = true;\r\n      for (let area of sarea.editors) {\r\n        if (area.constructor.define().uiname === k) {\r\n          ok = false;\r\n        }\r\n      }\r\n\r\n      if (!ok) {\r\n        continue;\r\n      }\r\n\r\n      let icon = prop.iconmap[k];\r\n      menu.addItemExtra(k, prop.values[k], undefined, icon);\r\n    }\r\n\r\n    if (!rect) {\r\n      console.warn(\"no rect!\");\r\n      return;\r\n    }\r\n\r\n    dockerdebug(mpos[0], mpos[1], rect.x, rect.y);\r\n\r\n    menu.onselect = (val) => {\r\n      dockerdebug(\"menu select\", val, this.getArea().parentWidget);\r\n\r\n      this.addicon.menu = undefined;\r\n\r\n      let sarea = this.getArea().parentWidget;\r\n      if (sarea) {\r\n        let cls = areaclasses[val];\r\n\r\n        this.ignoreChange++;\r\n        let area, ud;\r\n\r\n        try {\r\n          let uidata = saveUIData(this.tbar, \"switcherTabs\");\r\n          sarea.switchEditor(cls);\r\n\r\n          dockerdebug(\"switching\", cls);\r\n          area = sarea.area;\r\n          area._init();\r\n\r\n          if (area.switcher) {\r\n            area.switcher.rebuild();\r\n            area.switcher.loadTabData(uidata);\r\n            sarea.switcherData = uidata;\r\n          }\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n          throw error;\r\n        } finally {\r\n          this.ignoreChange = Math.max(this.ignoreChange - 1, 0);\r\n        }\r\n\r\n        dockerdebug(\"AREA\", area.switcher, area);\r\n\r\n        if (area.switcher) {\r\n          this.ignoreChange++;\r\n\r\n          try {\r\n            area.parentWidget = sarea;\r\n            area.owning_sarea = sarea;\r\n            area.switcher.parentWidget = area;\r\n            area.switcher.ctx = area.ctx;\r\n            area.switcher._init();\r\n            area.switcher.update();\r\n\r\n            dockerdebug(\"loading data\", ud);\r\n            area.switcher.loadTabData(ud);\r\n\r\n            area.switcher.rebuild(); //make sure plus tab is at end\r\n            area.flushUpdate();\r\n          } catch (error) {\r\n            throw error;\r\n          } finally {\r\n            this.ignoreChange = Math.max(this.ignoreChange - 1, 0);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    this.addicon.menu = menu;\r\n\r\n    startMenu(menu, mpos[0] - 35, rect.y + rect.height, false, 0);\r\n    return menu;\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(AreaDocker);\r\n","import {ToolTipViewer} from \"./FrameManager_ops.js\";\r\n\r\nlet _FrameManager = undefined;\r\nimport '../widgets/dragbox.js';\r\nimport '../widgets/ui_widgets2.js';\r\nimport '../widgets/ui_panel.js';\r\nimport '../widgets/ui_treeview.js';\r\n\r\nimport {DataPathError, nstructjs} from '../path-controller/controller.js';\r\n\r\nimport '../util/ScreenOverdraw.js';\r\nimport cconst from '../config/const.js';\r\nimport {haveModal, pushModalLight, popModalLight, _setScreenClass} from '../path-controller/util/simple_events.js';\r\nimport * as util from '../path-controller/util/util.js';\r\nimport '../widgets/ui_curvewidget.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as ScreenArea from './ScreenArea.js';\r\nimport * as FrameManager_ops from './FrameManager_ops.js';\r\nimport * as math from '../path-controller/util/math.js';\r\nimport * as ui_menu from '../widgets/ui_menu.js';\r\nimport '../path-controller/util/struct.js';\r\nimport {KeyMap, HotKey} from '../path-controller/util/simple_events.js';\r\nimport {keymap} from \"../path-controller/util/simple_events.js\";\r\n\r\nimport {AreaDocker} from './AreaDocker.js';\r\n\r\nimport {snap, snapi, ScreenBorder, ScreenVert, ScreenHalfEdge, SnapLimit} from \"./FrameManager_mesh.js\";\r\n\r\nexport {ScreenBorder, ScreenVert, ScreenHalfEdge} from \"./FrameManager_mesh.js\";\r\nimport {theme, PackFlags} from '../core/ui_base.js';\r\nimport * as FrameManager_mesh from './FrameManager_mesh.js';\r\nimport {makePopupArea} from \"../widgets/ui_dialog.js\";\r\n\r\nlet Area = ScreenArea.Area;\r\n\r\nimport '../widgets/ui_widgets.js';\r\nimport '../widgets/ui_tabs.js';\r\nimport '../widgets/ui_colorpicker2.js';\r\nimport '../widgets/ui_noteframe.js';\r\nimport '../widgets/ui_listbox.js';\r\nimport '../widgets/ui_table.js';\r\nimport {AreaFlags, setScreenClass} from \"./ScreenArea.js\";\r\nimport {checkForTextBox} from '../widgets/ui_textbox.js';\r\nimport {startMenu} from '../widgets/ui_menu.js';\r\n\r\nfunction list(iter) {\r\n  let ret = [];\r\n\r\n  for (let item of iter) {\r\n    ret.push(item);\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nui_menu.startMenuEventWrangling();\r\n\r\nlet _events_started = false;\r\n\r\nexport function registerToolStackGetter(func) {\r\n  FrameManager_ops.registerToolStackGetter(func);\r\n}\r\n\r\nlet Vector2         = vectormath.Vector2,\r\n    UIBase          = ui_base.UIBase,\r\n    styleScrollBars = ui_base.styleScrollBars;\r\n\r\nlet update_stack = new Array(8192);\r\nupdate_stack.cur = 0;\r\n\r\nlet screen_idgen = 0;\r\n\r\nexport function purgeUpdateStack() {\r\n  for (let i = 0; i < update_stack.length; i++) {\r\n    update_stack[i] = undefined;\r\n  }\r\n}\r\n\r\n/**\r\n * Base class for app workspaces\r\n *\r\n attributes:\r\n\r\n inherit-scale : don't resize to fit whole screen, use cssbox scaling\r\n\r\n */\r\nexport class Screen extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.snapLimit = 1;\r\n    this.fullScreen = true;\r\n\r\n    //all widget shadow DOMs reference this style tag,\r\n    //or rather they copy it\r\n    this.globalCSS = document.createElement(\"style\");\r\n    this.shadow.prepend(this.globalCSS);\r\n\r\n    this._do_updateSize = true;\r\n    this._resize_callbacks = [];\r\n\r\n    this.allBordersMovable = cconst.DEBUG.allBordersMovable;\r\n    this.needsBorderRegen = true;\r\n\r\n    this._popup_safe = 0;\r\n\r\n    //if true, will test all areas for keymaps on keypress,\r\n    //not just the active one\r\n    this.testAllKeyMaps = false;\r\n\r\n    this.needsTabRecalc = true;\r\n    this._screen_id = screen_idgen++;\r\n\r\n    this._popups = [];\r\n\r\n    this._ctx = undefined;\r\n\r\n    this.keymap = new KeyMap();\r\n\r\n    this.size = new Vector2([window.innerWidth, window.innerHeight]);\r\n    this.pos = new Vector2();\r\n    this.oldpos = new Vector2();\r\n\r\n    this.idgen = 0;\r\n    this.sareas = [];\r\n    this.sareas.active = undefined;\r\n    this.mpos = [0, 0];\r\n\r\n    this.screenborders = [];\r\n    this.screenverts = [];\r\n    this._vertmap = {};\r\n    this._edgemap = {};\r\n    this._idmap = {};\r\n\r\n    //effective bounds of screen\r\n    this._aabb = [new Vector2(), new Vector2()];\r\n\r\n    let on_mousemove = (e, x, y) => {\r\n      //let elem = this.pickElement(x, y, 1, 1, ScreenArea.ScreenArea);\r\n      let dragging = e.type === \"mousemove\" || e.type === \"touchmove\" || e.type === \"pointermove\";\r\n      dragging = dragging && (e.buttons || (e.touches && e.touches.length > 0));\r\n\r\n      /*\r\n      make sure active area is up to date.\r\n      but don't call pickElement too often as it's slow\r\n      */\r\n      if (!dragging && Math.random() > 0.9) {\r\n        let elem = this.pickElement(x, y, {\r\n          sx        : 1,\r\n          sy        : 1,\r\n          nodeclass : ScreenArea.ScreenArea,\r\n          mouseEvent: e\r\n        });\r\n\r\n        if (0) {\r\n          let elem2 = this.pickElement(x, y, 1, 1);\r\n          console.log(\"\" + this.sareas.active, elem2 ? elem2.tagName : undefined, elem !== undefined);\r\n        }\r\n\r\n        if (elem !== undefined) {\r\n          if (elem.area) {\r\n            //make sure context area stacks are up to date\r\n            elem.area.push_ctx_active();\r\n            elem.area.pop_ctx_active();\r\n          }\r\n\r\n          this.sareas.active = elem;\r\n        }\r\n      }\r\n\r\n      this.mpos[0] = x;\r\n      this.mpos[1] = y;\r\n    }\r\n    this.shadow.addEventListener(\"mousemove\", (e) => {\r\n      return on_mousemove(e, e.x, e.y);\r\n    }, {passive: true});\r\n\r\n    /*UIBase forwards touch events already\r\n    this.shadow.addEventListener(\"touchmove\", (e) => {\r\n      if (e.touches.length === 0) {\r\n        return;\r\n      }\r\n\r\n      return on_mousemove(e, e.touches[0].pageX, e.touches[0].pagesY);\r\n    }, {passive : true});\r\n    */\r\n  }\r\n\r\n  get borders() {\r\n    let this2 = this;\r\n\r\n    return (function* () {\r\n      for (let k in this2._edgemap) {\r\n        yield this2._edgemap[k];\r\n      }\r\n    })();\r\n  }\r\n\r\n  get listening() {\r\n    return this.listen_timer !== undefined;\r\n  }\r\n\r\n  get ctx() {\r\n    return this._ctx;\r\n  }\r\n\r\n  set ctx(val) {\r\n    this._ctx = val;\r\n\r\n    //fully recurse tree\r\n    let rec = (n) => {\r\n      if (n instanceof UIBase) {\r\n        n.ctx = val;\r\n      }\r\n\r\n      for (let n2 of n.childNodes) {\r\n        rec(n2);\r\n      }\r\n\r\n      if (n.shadow) {\r\n        for (let n2 of n.shadow.childNodes) {\r\n          rec(n2);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let n of this.childNodes) {\r\n      rec(n);\r\n    }\r\n\r\n    for (let n of this.shadow.childNodes) {\r\n      rec(n);\r\n    }\r\n  }\r\n\r\n  static fromJSON(obj, schedule_resize = false) {\r\n    let ret = UIBase.createElement(this.define().tagname);\r\n    return ret.loadJSON(obj, schedule_resize);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"pathux-screen-x\"\r\n    };\r\n  }\r\n\r\n  static newSTRUCT() {\r\n    return UIBase.createElement(this.define().tagname);\r\n  }\r\n\r\n  setPosSize(x, y, w, h) {\r\n    this.pos[0] = x;\r\n    this.pos[1] = y;\r\n    this.size[0] = w;\r\n    this.size[1] = h;\r\n\r\n    this.setCSS();\r\n    this._internalRegenAll();\r\n  }\r\n\r\n  setSize(w, h) {\r\n    this.size[0] = w;\r\n    this.size[1] = h;\r\n\r\n    this.setCSS();\r\n    this._internalRegenAll();\r\n  }\r\n\r\n  setPos(x, y) {\r\n    this.pos[0] = x;\r\n    this.pos[1] = y;\r\n\r\n    this.setCSS();\r\n    this._internalRegenAll();\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    if (this.hasAttribute(\"listen\")) {\r\n      this.listen();\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {*} style May be a string, a CSSStyleSheet instance, or a style tag\r\n   * @returns Promise fulfilled when style has been merged\r\n   */\r\n  mergeGlobalCSS(style) {\r\n    return new Promise((accept, reject) => {\r\n      let sheet;\r\n\r\n      let finish = () => {\r\n        let sheet2 = this.globalCSS.sheet;\r\n        if (!sheet2) {\r\n          this.doOnce(finish);\r\n          return;\r\n        }\r\n\r\n        let map = {};\r\n        for (let rule of sheet2.rules) {\r\n          map[rule.selectorText] = rule;\r\n        }\r\n\r\n        for (let rule of sheet.rules) {\r\n          let k = rule.selectorText;\r\n          if (k in map) {\r\n            let rule2 = map[k];\r\n\r\n            if (!rule.styleMap) { //handle firefox\r\n              for (let k in rule.style) {\r\n                let desc = Object.getOwnPropertyDescriptor(rule.style, k);\r\n\r\n                if (!desc || !desc.writable) {\r\n                  continue;\r\n                }\r\n                let v = rule.style[k];\r\n\r\n                if (v) {\r\n                  rule2.style[k] = rule.style[k];\r\n                }\r\n              }\r\n              continue;\r\n            }\r\n            for (let [key, val] of list(rule.styleMap.entries())) {\r\n              if (1 || rule2.styleMap.has(key)) {\r\n                //rule2.styleMap.delete(key);\r\n                let sval = \"\";\r\n\r\n                if (Array.isArray(val)) {\r\n                  for (let item of val) {\r\n                    sval += \" \" + val;\r\n                  }\r\n                  sval = sval.trim();\r\n                } else {\r\n                  sval = (\"\" + val).trim();\r\n                }\r\n\r\n                rule2.style[key] = sval;\r\n                rule2.styleMap.set(key, val);\r\n              } else {\r\n                rule2.styleMap.append(key, val);\r\n              }\r\n            }\r\n          } else {\r\n            sheet2.insertRule(rule.cssText);\r\n          }\r\n        }\r\n      }\r\n\r\n      if (typeof style === \"string\") {\r\n        try { //stupid firefox\r\n          sheet = new CSSStyleSheet();\r\n        } catch (error) {\r\n          sheet = undefined;\r\n        }\r\n\r\n        if (sheet && sheet.replaceSync) {\r\n          sheet.replaceSync(style);\r\n          finish();\r\n        } else {\r\n          let tag = document.createElement(\"style\");\r\n          tag.textContent = style;\r\n          document.body.appendChild(tag);\r\n\r\n          let cb = () => {\r\n            if (!tag.sheet) {\r\n              this.doOnce(cb);\r\n              return;\r\n            }\r\n\r\n            sheet = tag.sheet;\r\n            finish();\r\n            tag.remove();\r\n          };\r\n\r\n          this.doOnce(cb)\r\n        }\r\n      } else if (!(style instanceof CSSStyleSheet)) {\r\n        sheet = style.sheet;\r\n        finish();\r\n      } else {\r\n        sheet = style;\r\n        finish();\r\n      }\r\n    });\r\n  }\r\n\r\n  newScreenArea() {\r\n    let ret = UIBase.createElement(\"screenarea-x\");\r\n    ret.ctx = this.ctx;\r\n\r\n    if (ret.ctx) {\r\n      ret.init();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  copy() {\r\n    let ret = UIBase.createElement(this.constructor.define().tagname);\r\n    ret.ctx = this.ctx;\r\n    ret._init();\r\n\r\n    for (let sarea of this.sareas) {\r\n      let sarea2 = sarea.copy(ret);\r\n\r\n      sarea2._ctx = this.ctx;\r\n      sarea2.screen = ret;\r\n      sarea2.parentWidget = ret;\r\n\r\n      ret.appendChild(sarea2);\r\n    }\r\n\r\n    for (let sarea of ret.sareas) {\r\n      sarea.ctx = this.ctx;\r\n      sarea.area.ctx = this.ctx;\r\n\r\n      sarea.area.push_ctx_active();\r\n      sarea._init();\r\n      sarea.area._init();\r\n      sarea.area.pop_ctx_active();\r\n\r\n      for (let area of sarea.editors) {\r\n        area.ctx = this.ctx;\r\n\r\n        area.push_ctx_active();\r\n        area._init();\r\n        area.pop_ctx_active();\r\n      }\r\n    }\r\n\r\n    ret.update();\r\n    ret.regenBorders();\r\n    ret.setCSS();\r\n\r\n    return ret;\r\n  }\r\n\r\n  findScreenArea(x, y) {\r\n    for (let i = this.sareas.length - 1; i >= 0; i--) {\r\n      let sarea = this.sareas[i];\r\n\r\n      let ok = x >= sarea.pos[0] && x <= sarea.pos[0] + sarea.size[0];\r\n      ok = ok && (y >= sarea.pos[1] && y <= sarea.pos[1] + sarea.size[1]);\r\n\r\n      if (ok) {\r\n        return sarea;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param x\r\n   * @param y\r\n   * @param args arguments : {sx, sy, nodeclass, excluded_classes}\r\n   */\r\n  pickElement(x, y, args, marginy, nodeclass, excluded_classes) {\r\n    let marginx;\r\n\r\n    if (typeof args === \"object\") {\r\n      nodeclass = args.nodeclass;\r\n      excluded_classes = args.excluded_classes;\r\n    } else {\r\n      args = {\r\n        nodeclass,\r\n        excluded_classes\r\n      };\r\n    }\r\n\r\n    if (!this.ctx) {\r\n      console.warn(\"no ctx in screen\");\r\n      return;\r\n    }\r\n\r\n    let ret;\r\n    for (let i = this._popups.length - 1; i >= 0; i--) {\r\n      let popup = this._popups[i];\r\n      ret = ret || popup.pickElement(x, y, args);\r\n    }\r\n    ret = ret || super.pickElement(x, y, args);\r\n\r\n    return ret;\r\n  }\r\n\r\n  _enterPopupSafe() {\r\n    if (this._popup_safe === undefined) {\r\n      this._popup_safe = 0;\r\n    }\r\n\r\n    this._popup_safe++;\r\n  }\r\n\r\n  * _allAreas() {\r\n    for (let sarea of this.sareas) {\r\n      for (let area of sarea.editors) {\r\n        yield [area, area._area_id, sarea];\r\n      }\r\n    }\r\n  }\r\n\r\n  _exitPopupSafe() {\r\n    this._popup_safe = Math.max(this._popup_safe - 1, 0);\r\n  }\r\n\r\n  popupMenu(menu, x, y) {\r\n    startMenu(menu, x, y);\r\n\r\n    for (let i = 0; i < 3; i++) {\r\n      menu.flushSetCSS();\r\n      menu.flushUpdate();\r\n    }\r\n\r\n    return menu;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param popupDelay : if non-zero, wait for popup to layout for popupDelay miliseconds,\r\n   *                     then move the popup so it's fully inside the window (if it's outsize).\r\n   *\r\n   * */\r\n  popup(owning_node, elem_or_x, y, closeOnMouseOut = true, popupDelay = 5) {\r\n    let ret = this._popup(...arguments);\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      ret.flushUpdate();\r\n      ret.flushSetCSS();\r\n    }\r\n\r\n    if (popupDelay === 0) {\r\n      return ret;\r\n    }\r\n\r\n    let z = ret.style[\"z-index\"];\r\n\r\n    ret.style[\"z-index\"] = \"-10\";\r\n\r\n    let cb = () => {\r\n      let rect = ret.getClientRects()[0];\r\n      let size = this.size;\r\n\r\n      if (!rect) {\r\n        this.doOnce(cb);\r\n        return;\r\n      }\r\n\r\n      //console.log(\"rect\", rect);\r\n\r\n      if (rect.bottom > size[1]) {\r\n        ret.style[\"top\"] = (size[1] - rect.height - 10) + \"px\";\r\n      } else if (rect.top < 0) {\r\n        ret.style[\"top\"] = \"10px\";\r\n      }\r\n      if (rect.right > size[0]) {\r\n        ret.style[\"left\"] = (size[0] - rect.width - 10) + \"px\";\r\n      } else if (rect.left < 0) {\r\n        ret.style[\"left\"] = \"10px\";\r\n      }\r\n\r\n\r\n      ret.style[\"z-index\"] = z;\r\n\r\n      ret.flushUpdate();\r\n      ret.flushSetCSS();\r\n    }\r\n\r\n    setTimeout(cb, popupDelay);\r\n    //this.doOnce(cb);\r\n\r\n    return ret;\r\n  }\r\n\r\n  draggablePopup(x, y) {\r\n    let ret = UIBase.createElement(\"drag-box-x\");\r\n    ret.ctx = this.ctx;\r\n    ret.parentWidget = this;\r\n    ret._init();\r\n\r\n    this._popups.push(ret);\r\n\r\n    ret._onend = () => {\r\n      if (this._popups.indexOf(ret) >= 0) {\r\n        this._popups.remove(ret);\r\n      }\r\n    }\r\n\r\n    ret.style[\"z-index\"] = 205;\r\n    ret.style[\"position\"] = UIBase.PositionKey;\r\n    ret.style[\"left\"] = x + \"px\";\r\n    ret.style[\"top\"] = y + \"px\";\r\n\r\n    document.body.appendChild(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  /** makes a popup at x,y and returns a new container-x for it */\r\n  _popup(owning_node, elem_or_x, y, closeOnMouseOut = true) {\r\n    let x;\r\n\r\n    let sarea = this.sareas.active;\r\n\r\n    let w = owning_node;\r\n    while (w) {\r\n      if (w instanceof ScreenArea.ScreenArea) {\r\n        sarea = w;\r\n        break;\r\n      }\r\n      w = w.parentWidget;\r\n    }\r\n\r\n    if (typeof elem_or_x === \"object\") {\r\n      let r = elem_or_x.getClientRects()[0];\r\n\r\n      x = r.x;\r\n      y = r.y;\r\n    } else {\r\n      x = elem_or_x;\r\n    }\r\n\r\n    x += window.scrollX;\r\n    y += window.scrollY;\r\n\r\n    let container = UIBase.createElement(\"container-x\");\r\n\r\n    container.ctx = this.ctx;\r\n    container._init();\r\n\r\n    let remove = container.remove;\r\n    container.remove = () => {\r\n      if (this._popups.indexOf(container) >= 0) {\r\n        this._popups.remove(container);\r\n      }\r\n\r\n      return remove.apply(container, arguments);\r\n    };\r\n\r\n    container.overrideClass(\"popup\");\r\n\r\n    container.background = container.getDefault(\"background-color\");\r\n    container.style[\"border-radius\"] = container.getDefault(\"border-radius\") + \"px\";\r\n    container.style[\"border-color\"] = container.getDefault(\"border-color\");\r\n    container.style[\"border-style\"] = container.getDefault(\"border-style\");\r\n    container.style[\"border-width\"] = container.getDefault(\"border-width\") + \"px\";\r\n    container.style[\"box-shadow\"] = container.getDefault(\"box-shadow\");\r\n\r\n    container.style[\"position\"] = UIBase.PositionKey;\r\n    container.style[\"z-index\"] = \"2205\";\r\n    container.style[\"left\"] = x + \"px\";\r\n    container.style[\"top\"] = y + \"px\";\r\n    container.style[\"margin\"] = \"0px\";\r\n\r\n    container.parentWidget = this;\r\n\r\n    let mm = new math.MinMax(2);\r\n    let p = new Vector2();\r\n\r\n    let _update = container.update;\r\n    container.update.after(() => {\r\n      container.style[\"z-index\"] = \"2205\";\r\n    });\r\n\r\n    /*causes weird bugs\r\n    container.update = () => {\r\n      _update.call(container);\r\n\r\n      let rects = container.getClientRects();\r\n      mm.reset();\r\n\r\n      for (let r of rects) {\r\n        p[0] = r.x;\r\n        p[1] = r.y;\r\n        mm.minmax(p);\r\n\r\n        p[0] += r.width;\r\n        p[1] += r.height;\r\n        mm.minmax(p);\r\n      }\r\n\r\n      let x = mm.min[0], y = mm.min[1];\r\n\r\n      x = Math.min(x, this.size[0]-(mm.max[0]-mm.min[0]));\r\n      y = Math.min(y, this.size[1]-(mm.max[1]-mm.min[1]));\r\n\r\n      container.style[\"left\"] = x + \"px\";\r\n      container.style[\"top\"] = y + \"px\";\r\n    }//*/\r\n\r\n    document.body.appendChild(container);\r\n    //this.shadow.appendChild(container);\r\n    this.setCSS();\r\n\r\n    this._popups.push(container);\r\n\r\n    let touchpick, mousepick, keydown;\r\n\r\n    let done = false;\r\n    let end = () => {\r\n      if (this._popup_safe) {\r\n        return;\r\n      }\r\n\r\n      if (done) return;\r\n\r\n      //this.ctx.screen.removeEventListener(\"touchstart\", touchpick, true);\r\n      //this.ctx.screen.removeEventListener(\"touchmove\", touchpick, true);\r\n      this.ctx.screen.removeEventListener(\"mousedown\", mousepick, true);\r\n      this.ctx.screen.removeEventListener(\"mousemove\", mousepick, {passive: true});\r\n      this.ctx.screen.removeEventListener(\"mouseup\", mousepick, true);\r\n      window.removeEventListener(\"keydown\", keydown);\r\n\r\n      done = true;\r\n      container.remove();\r\n    };\r\n\r\n    container.end = end;\r\n\r\n    let _remove = container.remove;\r\n    container.remove = function () {\r\n      if (arguments.length == 0) {\r\n        end();\r\n      }\r\n      _remove.apply(this, arguments);\r\n    };\r\n\r\n    container._ondestroy = () => {\r\n      end();\r\n    };\r\n\r\n    let bad_time = util.time_ms();\r\n    let last_pick_time = util.time_ms();\r\n\r\n    mousepick = (e, x, y, do_timeout = true) => {\r\n      if (!container.isConnected) {\r\n        end();\r\n        return;\r\n      }\r\n\r\n      if (sarea && sarea.area) {\r\n        sarea.area.push_ctx_active();\r\n        sarea.area.pop_ctx_active();\r\n      }\r\n      //console.log(\"=======================================================popup touch start\");\r\n      //console.log(e);\r\n\r\n      if (util.time_ms() - last_pick_time < 350) {\r\n        return;\r\n      }\r\n      last_pick_time = util.time_ms();\r\n\r\n      x = x === undefined ? e.x : x;\r\n      y = y === undefined ? e.y : y;\r\n\r\n      //let elem = this.pickElement(x, y, 2, 2, undefined, [ScreenBorder]);\r\n      let elem = this.pickElement(x, y, {\r\n        sx              : 2,\r\n        sy              : 2,\r\n        excluded_classes: [ScreenBorder],\r\n        mouseEvent      : e\r\n      });\r\n\r\n      let startelem = elem;\r\n\r\n      if (elem === undefined) {\r\n        if (closeOnMouseOut) {\r\n          end();\r\n        }\r\n        return;\r\n      }\r\n\r\n      let ok = false;\r\n      let elem2 = elem;\r\n\r\n      while (elem) {\r\n        if (elem === container) {\r\n          ok = true;\r\n          break;\r\n        }\r\n        elem = elem.parentWidget;\r\n      }\r\n\r\n      if (!ok) {\r\n        do_timeout = !do_timeout || (util.time_ms() - bad_time > 100);\r\n\r\n        if (closeOnMouseOut && do_timeout) {\r\n          end();\r\n        }\r\n      } else {\r\n        bad_time = util.time_ms();\r\n      }\r\n    };\r\n\r\n    touchpick = (e) => {\r\n      let x = e.touches[0].pageX, y = e.touches[0].pageY;\r\n\r\n      return mousepick(e, x, y, false);\r\n    };\r\n\r\n    keydown = (e) => {\r\n      if (!container.isConnected) {\r\n        window.removeEventListener(\"keydown\", keydown);\r\n        return;\r\n      }\r\n\r\n      switch (e.keyCode) {\r\n        case keymap[\"Escape\"]:\r\n          end();\r\n          break;\r\n      }\r\n    };\r\n\r\n    //this.ctx.screen.addEventListener(\"touchstart\", touchpick, true);\r\n    //this.ctx.screen.addEventListener(\"touchmove\", touchpick, true);\r\n    this.ctx.screen.addEventListener(\"mousedown\", mousepick, true);\r\n    this.ctx.screen.addEventListener(\"mousemove\", mousepick, {passive: true});\r\n    this.ctx.screen.addEventListener(\"mouseup\", mousepick, true);\r\n    window.addEventListener(\"keydown\", keydown);\r\n\r\n    /*\r\n    container.addEventListener(\"mouseleave\", (e) => {\r\n      console.log(\"popup mouse leave\");\r\n      if (closeOnMouseOut)\r\n        end();\r\n    });\r\n    container.addEventListener(\"mouseout\", (e) => {\r\n      console.log(\"popup mouse out\");\r\n      if (closeOnMouseOut)\r\n        end();\r\n    });\r\n    //*/\r\n\r\n    this.calcTabOrder();\r\n\r\n    return container;\r\n  }\r\n\r\n  _recalcAABB(save = true) {\r\n    let mm = new math.MinMax(2);\r\n\r\n    for (let v of this.screenverts) {\r\n      mm.minmax(v);\r\n    }\r\n\r\n    if (save) {\r\n      this._aabb[0].load(mm.min);\r\n      this._aabb[1].load(mm.max);\r\n    }\r\n\r\n    return [new Vector2(mm.min), new Vector2(mm.max)];\r\n  }\r\n\r\n  //XXX look at if this is referenced anywhere\r\n  load() {\r\n  }\r\n\r\n  //XXX look at if this is referenced anywhere\r\n  save() {\r\n  }\r\n\r\n  popupArea(area_class) {\r\n    return makePopupArea(area_class, this);\r\n  }\r\n\r\n  remove(trigger_destroy = true) {\r\n    this.unlisten();\r\n\r\n    if (trigger_destroy) {\r\n      return super.remove();\r\n    } else {\r\n      HTMLElement.prototype.remove.call(this);\r\n    }\r\n  }\r\n\r\n  unlisten() {\r\n    if (this.listen_timer !== undefined) {\r\n      window.clearInterval(this.listen_timer);\r\n      this.listen_timer = undefined;\r\n    }\r\n  }\r\n\r\n  checkCSSSize() {\r\n    let w = this.style.width.toLowerCase().trim();\r\n    let h = this.style.height.toLowerCase().trim();\r\n\r\n    if (w.endsWith(\"px\") && h.endsWith(\"px\")) {\r\n      w = parseFloat(w.slice(0, w.length - 2).trim());\r\n      h = parseFloat(h.slice(0, h.length - 2).trim());\r\n\r\n      if (w !== this.size[0] || h !== this.size[1]) {\r\n        this.on_resize([this.size[0], this.size[1]], [w, h]);\r\n        this.size[0] = w;\r\n        this.size[1] = h;\r\n      }\r\n    }\r\n  }\r\n\r\n  getBoolAttribute(attr, defaultval = false) {\r\n    if (!this.hasAttribute(attr)) {\r\n      return defaultval;\r\n    }\r\n\r\n    let ret = this.getAttribute(attr);\r\n\r\n    if (typeof ret === \"number\") {\r\n      return !!ret;\r\n    } else if (typeof ret === \"string\") {\r\n      ret = ret.toLowerCase().trim();\r\n      ret = ret === \"true\" || ret === \"1\" || ret === \"yes\";\r\n    }\r\n\r\n    return !!ret;\r\n  }\r\n\r\n  updateSize() {\r\n    if (this.getBoolAttribute(\"inherit-scale\") || !this.fullScreen || !cconst.autoSizeUpdate) {\r\n      this.checkCSSSize();\r\n      return;\r\n    }\r\n\r\n    let width = window.innerWidth;\r\n    let height = window.innerHeight;\r\n\r\n    let ratio = window.outerHeight/window.innerHeight;\r\n    let scale = visualViewport.scale;\r\n\r\n    let pad = 4;\r\n    width = visualViewport.width*scale - pad;\r\n    height = visualViewport.height*scale - pad;\r\n\r\n    let ox = visualViewport.offsetLeft;\r\n    let oy = visualViewport.offsetTop;\r\n\r\n    if (cconst.DEBUG.customWindowSize) {\r\n      let s = cconst.DEBUG.customWindowSize;\r\n      width = s.width;\r\n      height = s.height;\r\n      ox = 0;\r\n      oy = 0;\r\n      window._DEBUG = cconst.DEBUG;\r\n    }\r\n\r\n    let key = this._calcSizeKey(width, height, ox, oy, devicePixelRatio, scale);\r\n\r\n    /* CSS IS EVIL! WHY DOES BODY HAVE A MARGIN? */\r\n    document.body.style.margin = document.body.style.padding = \"0px\";\r\n    document.body.style[\"transform-origin\"] = \"top left\";\r\n    document.body.style[\"transform\"] = `translate(${ox}px,${oy}px) scale(${1.0/scale})`;\r\n\r\n    //document.body.style[\"transform\"] = `scale(${1.0 / scale}, ${1.0 / scale})`; // translate(${ox*scale2}px, ${oy*scale2}px)`;\r\n\r\n    if (key !== this._last_ckey1) {\r\n      //console.log(\"resizing\", key, this._last_ckey1);\r\n      this._last_ckey1 = key;\r\n\r\n      this.on_resize(this.size, [width, height], false);\r\n      this.on_resize(this.size, this.size, false);\r\n\r\n      let scale = visualViewport.scale;\r\n\r\n\r\n      this.regenBorders();\r\n\r\n      this.setCSS();\r\n      this.completeUpdate();\r\n    }\r\n  }\r\n\r\n  listen(args = {updateSize: true}) {\r\n    ui_menu.setWranglerScreen(this);\r\n\r\n    let ctx = this.ctx;\r\n    startEvents(() => ctx.screen);\r\n\r\n    if (this.listen_timer !== undefined) {\r\n      return; //already listening\r\n    }\r\n\r\n    this._do_updateSize = args.updateSize !== undefined ? args.updateSize : true;\r\n\r\n    this.listen_timer = window.setInterval(() => {\r\n      if (this.isDead()) {\r\n        console.log(\"dead screen\");\r\n        this.unlisten();\r\n        return;\r\n      }\r\n\r\n      this.update();\r\n    }, 150);\r\n  }\r\n\r\n  _calcSizeKey(w, h, x, y, dpi, scale) {\r\n    if (arguments.length !== 6) {\r\n      throw new Error(\"eek\");\r\n    }\r\n\r\n    let s = \"\";\r\n    for (let i = 0; i < arguments.length; i++) {\r\n      s += arguments[i].toFixed(0) + \":\";\r\n    }\r\n\r\n    return s;\r\n  }\r\n\r\n  _ondestroy() {\r\n    if (ui_menu.getWranglerScreen() === this) {\r\n      //ui_menu.setWranglerScreen(undefined);\r\n    }\r\n\r\n    this.unlisten();\r\n\r\n    //unlike other ondestroy functions, this one physically dismantles the DOM tree\r\n    let recurse = (n, second_pass, parent) => {\r\n      if (n.__pass === second_pass) {\r\n        console.warn(\"CYCLE IN DOM TREE!\", n, parent);\r\n        return;\r\n      }\r\n\r\n      n.__pass = second_pass;\r\n\r\n      n._forEachChildWidget(n2 => {\r\n        if (n === n2)\r\n          return;\r\n        recurse(n2, second_pass, n);\r\n\r\n        try {\r\n          if (!second_pass && !n2.__destroyed) {\r\n            n2.__destroyed = true;\r\n            n2._ondestroy();\r\n          }\r\n        } catch (error) {\r\n          print_stack(error);\r\n          console.log(\"failed to exectue an ondestroy callback\");\r\n        }\r\n\r\n        n2.__destroyed = true;\r\n\r\n        try {\r\n          if (second_pass) {\r\n            n2.remove();\r\n          }\r\n        } catch (error) {\r\n          print_stack(error);\r\n          console.log(\"failed to remove element after ondestroy callback\");\r\n        }\r\n      });\r\n    };\r\n\r\n    let id = ~~(Math.random()*1024*1024);\r\n\r\n    recurse(this, id);\r\n    recurse(this, id + 1);\r\n  }\r\n\r\n  destroy() {\r\n    this._ondestroy();\r\n  }\r\n\r\n  clear() {\r\n    this._ondestroy();\r\n\r\n    this.sareas = [];\r\n    this.sareas.active = undefined;\r\n\r\n    for (let child of list(this.childNodes)) {\r\n      child.remove();\r\n    }\r\n    for (let child of list(this.shadow.childNodes)) {\r\n      child.remove();\r\n    }\r\n  }\r\n\r\n  _test_save() {\r\n    let obj = JSON.parse(JSON.stringify(this));\r\n    console.log(JSON.stringify(this));\r\n\r\n    this.loadJSON(obj);\r\n  }\r\n\r\n  loadJSON(obj, schedule_resize = false) {\r\n    this.clear();\r\n    super.loadJSON();\r\n\r\n    for (let sarea of obj.sareas) {\r\n      let sarea2 = UIBase.createElement(\"screenarea-x\");\r\n\r\n      sarea2.ctx = this.ctx;\r\n      sarea2.screen = this;\r\n\r\n      this.appendChild(sarea2);\r\n\r\n      sarea2.loadJSON(sarea);\r\n    }\r\n\r\n    this.regenBorders();\r\n    this.setCSS();\r\n\r\n    if (schedule_resize) {\r\n      window.setTimeout(() => {\r\n        this.on_resize(this.size, [window.innerWidth, window.innerHeight]);\r\n      }, 50);\r\n    }\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = {\r\n      sareas: this.sareas\r\n    };\r\n\r\n    ret.size = this.size;\r\n    ret.idgen = this.idgen;\r\n\r\n    return Object.assign(super.toJSON(), ret);\r\n  }\r\n\r\n  getHotKey(toolpath) {\r\n    let test = (keymap) => {\r\n      for (let hk of keymap) {\r\n        if (typeof hk.action != \"string\")\r\n          continue;\r\n\r\n        if (hk.action.trim().startsWith(toolpath.trim())) {\r\n          return hk;\r\n        }\r\n      }\r\n    };\r\n\r\n    let ret = test(this.keymap);\r\n    if (ret)\r\n      return ret;\r\n\r\n    if (this.sareas.active && this.sareas.active.keymap) {\r\n      let area = this.sareas.active.area;\r\n\r\n      for (let keymap of area.getKeyMaps()) {\r\n        ret = test(keymap);\r\n\r\n        if (ret)\r\n          return ret;\r\n      }\r\n    }\r\n\r\n    if (ret === undefined) {\r\n      //just to be safe, check all areas in case the\r\n      //context is confused as to which area is currently \"active\"\r\n\r\n      for (let sarea of this.sareas) {\r\n        let area = sarea.area;\r\n\r\n        for (let keymap of area.getKeyMaps()) {\r\n          ret = test(keymap);\r\n\r\n          if (ret) {\r\n            return ret;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  addEventListener(type, cb, options) {\r\n    if (type === \"resize\") {\r\n      this._resize_callbacks.push(cb);\r\n    } else {\r\n      return super.addEventListener(type, cb, options);\r\n    }\r\n  }\r\n\r\n  removeEventListener(type, cb, options) {\r\n    if (type === \"resize\") {\r\n      if (this._resize_callbacks.indexOf(cb) >= 0)\r\n        this._resize_callbacks.remove(cb);\r\n    } else {\r\n      return super.removeEventListener(type, cb, options);\r\n    }\r\n  }\r\n\r\n  execKeyMap(e) {\r\n    let handled = false;\r\n\r\n    if (window.DEBUG && window.DEBUG.keymap) {\r\n      console.warn(\"execKeyMap called\", e.keyCode, document.activeElement.tagName);\r\n    }\r\n\r\n    if (this.sareas.active) {\r\n      let area = this.sareas.active.area;\r\n\r\n      if (!area) {\r\n        return;\r\n      }\r\n\r\n      area.push_ctx_active();\r\n\r\n      for (let keymap of area.getKeyMaps()) {\r\n        if (keymap === undefined) {\r\n          continue;\r\n        }\r\n\r\n        if (keymap.handle(area.ctx, e)) {\r\n          handled = true;\r\n          break;\r\n        }\r\n      }\r\n\r\n      area.pop_ctx_active();\r\n    }\r\n\r\n    handled = handled || this.keymap.handle(this.ctx, e);\r\n\r\n    if (!handled && this.testAllKeyMaps) {\r\n      for (let sarea of this.sareas) {\r\n        if (handled) {\r\n          break;\r\n        }\r\n\r\n        sarea.area.push_ctx_active();\r\n\r\n        for (let keymap of sarea.area.getKeyMaps()) {\r\n          if (keymap.handle(sarea.area.ctx, e)) {\r\n            handled = true;\r\n            break;\r\n          }\r\n        }\r\n\r\n        sarea.area.pop_ctx_active();\r\n      }\r\n    }\r\n\r\n    return handled;\r\n  }\r\n\r\n  calcTabOrder() {\r\n    let nodes = [];\r\n    let visit = {};\r\n\r\n    let rec = (n) => {\r\n      let bad = n.tabIndex < 0 || n.tabIndex === undefined || n.tabIndex === null;\r\n      bad = bad || !(n instanceof UIBase);\r\n\r\n      if (n._id in visit || n.hidden) {\r\n        return;\r\n      }\r\n\r\n      visit[n._id] = 1;\r\n\r\n      if (!bad) {\r\n        n.__pos = n.getClientRects()[0];\r\n        if (n.__pos) {\r\n          nodes.push(n);\r\n        }\r\n      }\r\n\r\n      n._forEachChildWidget((n2) => {\r\n        rec(n2);\r\n      });\r\n    };\r\n\r\n    for (let sarea of this.sareas) {\r\n      rec(sarea);\r\n    }\r\n\r\n    for (let popup of this._popups) {\r\n      rec(popup);\r\n    }\r\n\r\n    //console.log(\"nodes2\", nodes2);\r\n    for (let i = 0; i < nodes.length; i++) {\r\n      let n = nodes[i];\r\n\r\n      n.tabIndex = i + 1;\r\n      //console.log(n.tabIndex);\r\n    }\r\n  }\r\n\r\n  drawUpdate() {\r\n    if (window.redraw_all !== undefined) {\r\n      window.redraw_all();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    let move = [];\r\n    for (let child of this.childNodes) {\r\n      if (child instanceof ScreenArea) {\r\n        move.push(child);\r\n      }\r\n    }\r\n\r\n    for (let child of move) {\r\n      console.warn(\"moved screen area to shadow\");\r\n\r\n      HTMLElement.prototype.remove.call(child);\r\n      this.shadow.appendChild(child);\r\n    }\r\n\r\n    if (this._do_updateSize) {\r\n      this.updateSize();\r\n    }\r\n\r\n    if (this.needsTabRecalc) {\r\n      this.needsTabRecalc = false;\r\n      this.calcTabOrder();\r\n    }\r\n\r\n    outer: for (let sarea of this.sareas) {\r\n      for (let b of sarea._borders) {\r\n        let movable = this.isBorderMovable(b);\r\n\r\n        if (movable !== b.movable) {\r\n          console.log(\"detected change in movable borders\");\r\n          this.regenBorders();\r\n          break outer;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (this._update_gen) {\r\n      let ret;\r\n\r\n      /*\r\n      if (cconst.DEBUG.debugUIUpdatePerf) {\r\n          for (ret = this._update_gen.next(); !ret.done; ret = this._update_gen.next()) {}\r\n\r\n        this._update_gen = this.update_intern();\r\n        return;\r\n      }\r\n      //*/\r\n\r\n      try {\r\n        ret = this._update_gen.next();\r\n      } catch (error) {\r\n        if (!(error instanceof DataPathError)) {\r\n          util.print_stack(error);\r\n          console.log(\"error in update_intern tasklet\");\r\n        }\r\n        return;\r\n      }\r\n\r\n      if (ret !== undefined && ret.done) {\r\n        this._update_gen = undefined;\r\n      }\r\n    } else {\r\n      this._update_gen = this.update_intern();\r\n    }\r\n  }\r\n\r\n  purgeUpdateStack() {\r\n    this._update_gen = undefined;\r\n    purgeUpdateStack();\r\n  }\r\n\r\n  completeSetCSS() {\r\n    let rec = (n) => {\r\n      n.setCSS();\r\n\r\n      if (n.packflag & PackFlags.NO_UPDATE) {\r\n        return;\r\n      }\r\n\r\n      n._forEachChildWidget((c) => {\r\n        rec(c);\r\n      })\r\n    }\r\n\r\n    rec(this);\r\n  }\r\n\r\n  completeUpdate() {\r\n    for (let step of this.update_intern()) {\r\n    }\r\n  }\r\n\r\n  updateScrollStyling() {\r\n    let s = theme.scrollbars;\r\n\r\n    if (!s || !s.color) return;\r\n\r\n    let key = \"\" + s.color + \":\" + s.color2 + \":\" + s.border + \":\" + s.contrast + \":\" + s.width;\r\n\r\n    if (key !== this._last_scrollstyle_key) {\r\n      this._last_scrollstyle_key = key;\r\n\r\n      //console.log(\"updating scrollbar styling\");\r\n\r\n      this.mergeGlobalCSS(styleScrollBars(s.color, s.color2, s.contrast, s.width, s.border, \"*\"));\r\n    }\r\n  }\r\n\r\n  //XXX race condition warning\r\n  update_intern() {\r\n    this.updateScrollStyling();\r\n\r\n    let popups = this._popups;\r\n\r\n    let cssText = \"\";\r\n    let sheet = this.globalCSS.sheet;\r\n    if (sheet) {\r\n      for (let rule of sheet.rules) {\r\n        cssText += rule.cssText + \"\\n\";\r\n      }\r\n\r\n      window.cssText = cssText\r\n    }\r\n    let cssTextHash = util.strhash(cssText);\r\n\r\n    if (this.needsBorderRegen) {\r\n      this.needsBorderRegen = false;\r\n      this.regenBorders();\r\n    }\r\n\r\n    super.update();\r\n    let this2 = this;\r\n\r\n    //ensure each area has proper ctx set\r\n    for (let sarea of this.sareas) {\r\n      if (!sarea.ctx) {\r\n        sarea.ctx = this.ctx;\r\n      }\r\n    }\r\n\r\n    return (function* () {\r\n      let stack = update_stack;\r\n      stack.cur = 0;\r\n\r\n      let lastn = this2;\r\n\r\n      function push(n) {\r\n        stack[stack.cur++] = n;\r\n      }\r\n\r\n      function pop(n) {\r\n        if (stack.cur < 0) {\r\n          throw new Error(\"Screen.update(): stack overflow!\");\r\n        }\r\n\r\n        return stack[--stack.cur];\r\n      }\r\n\r\n      let ctx = this2.ctx;\r\n\r\n      let SCOPE_POP = Symbol(\"pop\");\r\n      let AREA_CTX_POP = Symbol(\"pop2\");\r\n\r\n      let scopestack = [];\r\n      let areastack = [];\r\n\r\n      let t = util.time_ms();\r\n      push(this2);\r\n\r\n      for (let p of popups) {\r\n        push(p);\r\n      }\r\n\r\n      while (stack.cur > 0) {\r\n        let n = pop();\r\n\r\n        if (n === undefined) {\r\n          //console.log(\"eek!\", stack.length);\r\n          continue;\r\n        } else if (n === SCOPE_POP) {\r\n          scopestack.pop();\r\n          continue;\r\n        } else if (n === AREA_CTX_POP) {\r\n          //console.log(\"POP\", areastack[areastack.length-1].constructor.name);\r\n          areastack.pop().pop_ctx_active(ctx, true);\r\n          continue;\r\n        }\r\n\r\n        if (n instanceof Area) {\r\n          //console.log(\"PUSH\", n.constructor.name);\r\n          areastack.push(n);\r\n          n.push_ctx_active(ctx, true);\r\n          push(AREA_CTX_POP);\r\n        }\r\n\r\n        if (!n.hidden && n !== this2 && n instanceof UIBase) {\r\n          if (!n._ctx) {\r\n            n._ctx = ctx;\r\n          }\r\n\r\n          if (n._screenStyleUpdateHash !== cssTextHash) {\r\n            n._screenStyleTag.textContent = cssText;\r\n            n._screenStyleUpdateHash = cssTextHash;\r\n          }\r\n\r\n          if (scopestack.length > 0 && scopestack[scopestack.length - 1]) {\r\n            n.parentWidget = scopestack[scopestack.length - 1];\r\n\r\n            //if (n.parentWidget && n._useDataPathUndo === undefined && n.parentWidget._useDataPathUndo !== undefined) {\r\n            //  n._useDataPathUndo = n.parentWidget._useDataPathUndo;\r\n            //}\r\n          }\r\n\r\n          n.update();\r\n        }\r\n\r\n        if (util.time_ms() - t > 20) {\r\n          yield;\r\n          t = util.time_ms();\r\n        }\r\n\r\n        for (let n2 of n.childNodes) {\r\n          if (!(n2 instanceof UIBase) || !(n2.packflag & PackFlags.NO_UPDATE)) {\r\n            push(n2);\r\n          }\r\n        }\r\n\r\n        if (n.shadow === undefined) {\r\n          continue;\r\n        }\r\n\r\n        for (let n2 of n.shadow.childNodes) {\r\n          if (!(n2 instanceof UIBase) || !(n2.packflag & PackFlags.NO_UPDATE)) {\r\n            push(n2);\r\n          }\r\n        }\r\n\r\n        if (n instanceof UIBase) {\r\n          if (!(n.packflag & PackFlags.NO_UPDATE)) {\r\n            scopestack.push(n);\r\n            push(SCOPE_POP);\r\n          }\r\n        }\r\n      }\r\n    })();\r\n  }\r\n\r\n  //load pos/size from screenverts\r\n  loadFromVerts() {\r\n    let old = [0, 0];\r\n    for (let sarea of this.sareas) {\r\n      old[0] = sarea.size[0];\r\n      old[1] = sarea.size[1];\r\n\r\n      sarea.loadFromVerts();\r\n      sarea.on_resize(old);\r\n      sarea.setCSS();\r\n    }\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  /** merges sarea into the screen area opposite to sarea*/\r\n  collapseArea(sarea, border) {\r\n    let sarea2;\r\n\r\n    if (!border) {\r\n      for (let b of sarea._borders) {\r\n        let sarea2 = b.getOtherSarea(sarea);\r\n\r\n        if (sarea2 && !b.locked) {\r\n          border = b;\r\n          break;\r\n        }\r\n      }\r\n    } else if (border.locked) {\r\n      console.warn(\"Cannot remove screen border\");\r\n    }\r\n\r\n    console.warn(\"SAREA2\", border, sarea2, sarea2 !== sarea);\r\n\r\n    if (border) {\r\n      sarea2 = border.getOtherSarea(sarea);\r\n\r\n      if (!sarea2) {\r\n        console.error(\"Error merging sarea\");\r\n        return;\r\n      }\r\n\r\n      let size1 = new Vector2(sarea.pos).add(sarea.size);\r\n      let size2 = new Vector2(sarea2.pos).add(sarea2.size);\r\n\r\n      sarea2.pos.min(sarea.pos);\r\n      sarea2.size.load(size1).max(size2).sub(sarea2.pos);\r\n\r\n      sarea2.loadFromPosSize();\r\n    }\r\n\r\n    this.sareas.remove(sarea);\r\n    sarea.remove();\r\n\r\n    this.regenScreenMesh();\r\n    this._internalRegenAll();\r\n\r\n    return this;\r\n  }\r\n\r\n  splitArea(sarea, t = 0.5, horiz = true) {\r\n    let w = sarea.size[0], h = sarea.size[1];\r\n    let x = sarea.pos[0], y = sarea.size[1];\r\n    let s1, s2;\r\n\r\n    if (!horiz) {\r\n      s1 = sarea;\r\n      if (s1.ctx === undefined) {\r\n        s1.ctx = this.ctx;\r\n      }\r\n      s2 = s1.copy(this);\r\n\r\n      s1.size[0] *= t;\r\n      s2.size[0] *= (1.0 - t);\r\n\r\n      s2.pos[0] += w*t;\r\n    } else {\r\n      s1 = sarea;\r\n      if (s1.ctx === undefined) {\r\n        s1.ctx = this.ctx;\r\n      }\r\n      s2 = s1.copy(this);\r\n\r\n      s1.size[1] *= t;\r\n      s2.size[1] *= (1.0 - t);\r\n\r\n      s2.pos[1] += h*t;\r\n    }\r\n\r\n    s2.ctx = this.ctx;\r\n    this.appendChild(s2);\r\n\r\n    s1.on_resize(s1.size);\r\n    s2.on_resize(s2.size);\r\n\r\n    this.regenBorders();\r\n    this.solveAreaConstraints();\r\n\r\n    s1.setCSS();\r\n    s2.setCSS();\r\n\r\n    this.setCSS();\r\n\r\n    //XXX not sure if this is right place to do this or really necassary\r\n    if (s2.area !== undefined)\r\n      s2.area.onadd();\r\n\r\n    return s2;\r\n  }\r\n\r\n  setCSS() {\r\n    if (!this.getBoolAttribute(\"inherit-scale\")) {\r\n      this.style[\"width\"] = this.size[0] + \"px\";\r\n      this.style[\"height\"] = this.size[1] + \"px\";\r\n    }\r\n\r\n    this.style[\"overflow\"] = \"hidden\";\r\n\r\n    //call setCSS on borders\r\n    for (let key in this._edgemap) {\r\n      let b = this._edgemap[key];\r\n\r\n      b.setCSS();\r\n    }\r\n  }\r\n\r\n  regenScreenMesh(snapLimit = SnapLimit) {\r\n    this.snapLimit = snapLimit;\r\n\r\n    this.regenBorders();\r\n  }\r\n\r\n  regenBorders_stage2() {\r\n    for (let b of this.screenborders) {\r\n      b.halfedges = []\r\n    }\r\n\r\n    function hashHalfEdge(border, sarea) {\r\n      return border._id + \":\" + sarea._id;\r\n    }\r\n\r\n    function has_he(border, border2, sarea) {\r\n      for (let he of border.halfedges) {\r\n        if (border2 === he.border && sarea === he.sarea) {\r\n          return true;\r\n        }\r\n      }\r\n\r\n      return false;\r\n    }\r\n\r\n    for (let b1 of this.screenborders) {\r\n      for (let sarea of b1.sareas) {\r\n        let he = new ScreenHalfEdge(b1, sarea);\r\n        b1.halfedges.push(he);\r\n      }\r\n\r\n      let axis = b1.horiz ? 1 : 0;\r\n\r\n      let min = Math.min(b1.v1[axis], b1.v2[axis]);\r\n      let max = Math.max(b1.v1[axis], b1.v2[axis]);\r\n\r\n      for (let b2 of this.walkBorderLine(b1)) {\r\n        if (b1 === b2) {\r\n          continue;\r\n        }\r\n\r\n        let ok = b2.v1[axis] >= min && b2.v1[axis] <= max;\r\n        ok = ok || (b2.v2[axis] >= min && b2.v2[axis] <= max);\r\n\r\n        for (let sarea of b2.sareas) {\r\n          let ok2 = ok && !has_he(b2, b1, sarea);\r\n          if (ok2) {\r\n            let he2 = new ScreenHalfEdge(b2, sarea);\r\n            b1.halfedges.push(he2);\r\n          }\r\n        }\r\n\r\n      }\r\n    }\r\n\r\n\r\n    for (let b of this.screenborders) {\r\n      let movable = true;\r\n\r\n      for (let sarea of b.sareas) {\r\n        movable = movable && this.isBorderMovable(b);\r\n      }\r\n\r\n      b.movable = movable;\r\n    }\r\n  }\r\n\r\n  hasBorder(b) {\r\n    return b._id in this._idmap;\r\n  }\r\n\r\n  killScreenVertex(v) {\r\n    this.screenverts.remove(v);\r\n\r\n    delete this._edgemap[ScreenVert.hash(v, undefined, this.snapLimit)];\r\n    delete this._idmap[v._id];\r\n\r\n    return this;\r\n  }\r\n\r\n  freeBorder(b, sarea) {\r\n    if (b.sareas.indexOf(sarea) >= 0) {\r\n      b.sareas.remove(sarea);\r\n    }\r\n\r\n    let dels = [];\r\n\r\n    for (let he of b.halfedges) {\r\n      if (he.sarea === sarea) {\r\n        dels.push([b, he]);\r\n      }\r\n\r\n      for (let he2 of he.border.halfedges) {\r\n        if (he2 === he)\r\n          continue;\r\n\r\n        if (he2.sarea === sarea) {\r\n          dels.push([he.border, he2]);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let d of dels) {\r\n      if (d[0].halfedges.indexOf(d[1]) < 0) {\r\n        console.warn(\"Double remove detected; use util.set?\");\r\n        continue;\r\n      }\r\n\r\n      d[0].halfedges.remove(d[1]);\r\n    }\r\n\r\n    if (b.sareas.length === 0) {\r\n      this.killBorder(b);\r\n    }\r\n  }\r\n\r\n  killBorder(b) {\r\n    console.log(\"killing border\", b._id, b);\r\n\r\n    if (this.screenborders.indexOf(b) < 0) {\r\n      console.log(\"unknown border\", b);\r\n      b.remove();\r\n      return;\r\n    }\r\n\r\n    this.screenborders.remove(b);\r\n\r\n    let del = [];\r\n\r\n    for (let he of b.halfedges) {\r\n      if (he === he2)\r\n        continue;\r\n\r\n      for (let he2 of he.border.halfedges) {\r\n        if (he2.border === b) {\r\n          del.push([he.border, he2]);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let d of del) {\r\n      d[0].halfedges.remove(d[1]);\r\n    }\r\n\r\n    delete this._edgemap[ScreenBorder.hash(b.v1, b.v2)];\r\n    delete this._idmap[b._id];\r\n\r\n    b.v1.borders.remove(b);\r\n    b.v2.borders.remove(b);\r\n\r\n    if (b.v1.borders.length === 0) {\r\n      this.killScreenVertex(b.v1);\r\n    }\r\n    if (b.v2.borders.length === 0) {\r\n      this.killScreenVertex(b.v2);\r\n    }\r\n\r\n    b.remove();\r\n\r\n    return this;\r\n  }\r\n\r\n  //XXX rename to regenScreenMesh\r\n  regenBorders() {\r\n    for (let b of this.screenborders) {\r\n      b.remove();\r\n    }\r\n\r\n    this._idmap = {};\r\n    this.screenborders = [];\r\n    this._edgemap = {};\r\n    this._vertmap = {};\r\n    this.screenverts = []\r\n\r\n    for (let sarea of this.sareas) {\r\n      if (sarea.hidden) continue;\r\n\r\n      sarea.makeBorders(this);\r\n    }\r\n\r\n    for (let key in this._edgemap) {\r\n      let b = this._edgemap[key];\r\n\r\n      b.setCSS();\r\n    }\r\n\r\n    this.regenBorders_stage2();\r\n    this._recalcAABB();\r\n\r\n    for (let b of this.screenborders) {\r\n      b.outer = this.isBorderOuter(b);\r\n      b.movable = this.isBorderMovable(b);\r\n      b.setCSS();\r\n    }\r\n\r\n    this.updateDebugBoxes();\r\n  }\r\n\r\n  _get_debug_overlay() {\r\n    if (!this._debug_overlay) {\r\n      this._debug_overlay = UIBase.createElement(\"overdraw-x\");\r\n      let s = this._debug_overlay;\r\n\r\n      s.startNode(this, this);\r\n    }\r\n\r\n    return this._debug_overlay;\r\n  }\r\n\r\n  updateDebugBoxes() {\r\n    if (cconst.DEBUG.screenborders) {\r\n      let overlay = this._get_debug_overlay();\r\n      overlay.clear();\r\n\r\n      for (let b of this.screenborders) {\r\n        overlay.line(b.v1, b.v2, \"red\");\r\n      }\r\n      let del = [];\r\n      for (let child of document.body.childNodes) {\r\n        if (child.getAttribute && child.getAttribute(\"class\") === \"__debug\") {\r\n          del.push(child);\r\n        }\r\n      }\r\n      for (let n of del) {\r\n        n.remove();\r\n      }\r\n\r\n      let box = (x, y, s, text, color = \"red\") => {\r\n        x -= s*0.5;\r\n        y -= s*0.5;\r\n\r\n        x = Math.min(Math.max(x, 0.0), this.size[0] - s);\r\n        y = Math.min(Math.max(y, 0.0), this.size[1] - s);\r\n\r\n        let ret = UIBase.createElement(\"div\");\r\n        ret.setAttribute(\"class\", \"__debug\");\r\n\r\n\r\n        ret.style[\"position\"] = UIBase.PositionKey;\r\n        ret.style[\"left\"] = x + \"px\";\r\n        ret.style[\"top\"] = y + \"px\";\r\n        ret.style[\"height\"] = s + \"px\";\r\n        ret.style[\"width\"] = s + \"px\";//\"200px\";\r\n        ret.style[\"z-index\"] = \"1000\";\r\n        ret.style[\"pointer-events\"] = \"none\";\r\n        ret.style[\"padding\"] = ret.style[\"margin\"] = \"0px\";\r\n        ret.style['display'] = \"float\";\r\n        ret.style[\"background-color\"] = color;\r\n        document.body.appendChild(ret);\r\n\r\n        let colors = [\r\n          \"orange\",\r\n          \"black\",\r\n          \"white\",\r\n        ];\r\n\r\n        for (let i = 2; i >= 0; i--) {\r\n          ret = UIBase.createElement(\"div\");\r\n\r\n          ret.setAttribute(\"class\", \"__debug\");\r\n\r\n          ret.style[\"position\"] = UIBase.PositionKey;\r\n          ret.style[\"left\"] = x + \"px\";\r\n          ret.style[\"top\"] = y + \"px\";\r\n          ret.style[\"height\"] = s + \"px\";\r\n          ret.style[\"width\"] = \"250px\";//\"200px\";\r\n          ret.style[\"z-index\"] = \"\" + (1005 - i - 1);\r\n          ret.style[\"pointer-events\"] = \"none\";\r\n          ret.style[\"color\"] = colors[i];\r\n\r\n          let w = (i)*2;\r\n          ret.style[\"-webkit-text-stroke-width\"] = w + \"px\";\r\n          ret.style[\"-webkit-text-stroke-color\"] = colors[i];\r\n          ret.style[\"text-stroke-width\"] = w + \"px\";\r\n          ret.style[\"text-stroke-color\"] = colors[i];\r\n\r\n          ret.style[\"padding\"] = ret.style[\"margin\"] = \"0px\";\r\n          ret.style['display'] = \"float\";\r\n          ret.style[\"background-color\"] = \"rgba(0,0,0,0)\";\r\n          ret.innerText = \"\" + text;\r\n          document.body.appendChild(ret);\r\n        }\r\n\r\n      };\r\n\r\n      for (let v of this.screenverts) {\r\n        box(v[0], v[1], 10*v.borders.length, \"\" + v.borders.length, \"rgba(255,0,0,0.5)\");\r\n      }\r\n\r\n      for (let b of this.screenborders) {\r\n        for (let he of b.halfedges) {\r\n          let txt = `${he.side}, ${b.sareas.length}, ${b.halfedges.length}`;\r\n          let p = new Vector2(b.v1).add(b.v2).mulScalar(0.5);\r\n          let size = 10*b.halfedges.length;\r\n\r\n          let wadd = 25 + size*0.5;\r\n          let axis = b.horiz & 1;\r\n\r\n          if (p[axis] > he.sarea.pos[axis]) {\r\n            p[axis] -= wadd;\r\n          } else {\r\n            p[axis] += wadd;\r\n          }\r\n          box(p[0], p[1], size, txt, \"rgba(155,255,75,0.5)\")\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  checkAreaConstraint(sarea, checkOnly = false) {\r\n    let min = sarea.minSize, max = sarea.maxSize;\r\n    let vs = sarea._verts;\r\n    let chg = 0.0;\r\n    let mask = 0;\r\n\r\n    let moveBorder = (sidea, sideb, dh) => {\r\n      let b1 = sarea._borders[sidea];\r\n      let b2 = sarea._borders[sideb];\r\n      let bad = 0;\r\n\r\n      for (let i = 0; i < 2; i++) {\r\n        let b = i ? b2 : b1;\r\n        let bad2 = sarea.borderLock & (1<<sidea);\r\n\r\n        bad2 = bad2 || !b.movable;\r\n        bad2 = bad2 || this.isBorderOuter(b);\r\n\r\n        if (bad2)\r\n          bad |= 1<<i;\r\n      }\r\n\r\n      if (bad === 0) {\r\n        this.moveBorder(b1, dh*0.5);\r\n        this.moveBorder(b2, -dh*0.5);\r\n      } else if (bad === 1) {\r\n        this.moveBorder(b2, -dh);\r\n      } else if (bad === 2) {\r\n        this.moveBorder(b1, dh);\r\n      } else if (bad === 3) {\r\n        //both borders are bad, yet we need to move anyway. . .\r\n        //console.warn(\"got case of two borders being bad\");\r\n\r\n        if (!this.isBorderOuter(b1)) {\r\n          this.moveBorder(b1, dh);\r\n        } else if (!this.isBorderOuter(b2)) {\r\n          this.moveBorder(b2, -dh);\r\n        } else {\r\n          this.moveBorder(b1, dh*0.5);\r\n          this.moveBorder(b2, -dh*0.5);\r\n        }\r\n      }\r\n    };\r\n\r\n    if (max[0] !== undefined && sarea.size[0] > max[0]) {\r\n      let dh = (sarea.size[0] - max[0]);\r\n      chg += Math.abs(dh);\r\n      mask |= 1;\r\n\r\n      moveBorder(0, 2, dh);\r\n    }\r\n\r\n    if (min[0] !== undefined && sarea.size[0] < min[0]) {\r\n      let dh = (min[0] - sarea.size[0]);\r\n      chg += Math.abs(dh);\r\n      mask |= 2;\r\n\r\n      moveBorder(2, 0, dh);\r\n    }\r\n\r\n\r\n    if (max[1] !== undefined && sarea.size[1] > max[1]) {\r\n      let dh = (sarea.size[1] - max[1]);\r\n      chg += Math.abs(dh);\r\n      mask |= 4;\r\n\r\n      moveBorder(3, 1, dh);\r\n    }\r\n\r\n    if (min[1] !== undefined && sarea.size[1] < min[1]) {\r\n      let dh = (min[1] - sarea.size[1]);\r\n      chg += Math.abs(dh);\r\n      mask |= 8;\r\n\r\n      moveBorder(1, 3, dh);\r\n    }\r\n\r\n    if (sarea.pos[0] + sarea.size[0] > this.size[0]) {\r\n      mask |= 16;\r\n      let dh = ((this.size[0] - sarea.size[0]) - sarea.pos[0]);\r\n\r\n      chg += Math.abs(dh);\r\n\r\n      if (sarea.floating) {\r\n        sarea.pos[0] = this.size[0] - sarea.size[0];\r\n        sarea.loadFromPosSize();\r\n      } else {\r\n        this.moveBorder(sarea._borders[0], dh);\r\n        this.moveBorder(sarea._borders[2], dh);\r\n      }\r\n    }\r\n\r\n    if (chg === 0.0) {\r\n      return false;\r\n    }\r\n\r\n    return mask;\r\n  }\r\n\r\n  walkBorderLine(b) {\r\n    let visit = new util.set();\r\n    let ret = [b];\r\n    visit.add(b);\r\n\r\n    let rec = (b, v) => {\r\n      for (let b2 of v.borders) {\r\n        if (b2 === b) {\r\n          continue;\r\n        }\r\n\r\n        if (b2.horiz === b.horiz && !visit.has(b2)) {\r\n          visit.add(b2);\r\n          ret.push(b2);\r\n          rec(b2, b2.otherVertex(v));\r\n        }\r\n      }\r\n    }\r\n\r\n    rec(b, b.v1);\r\n    let ret2 = ret;\r\n    ret = [];\r\n\r\n    rec(b, b.v2);\r\n    ret2.reverse();\r\n\r\n    return ret2.concat(ret);\r\n  }\r\n\r\n  moveBorderWithoutVerts(halfedge, df) {\r\n    let side = halfedge.side;\r\n    let sarea = halfedge.sarea;\r\n\r\n    switch (side) {\r\n      case 0:\r\n        sarea.pos[0] += df;\r\n        sarea.size[0] -= df;\r\n        break;\r\n      case 1:\r\n        sarea.size[1] += df;\r\n        break;\r\n      case 2:\r\n        sarea.size[0] += df;\r\n        break;\r\n      case 3:\r\n        sarea.pos[1] += df;\r\n        sarea.size[1] -= df;\r\n        break;\r\n    }\r\n  }\r\n\r\n  moveBorder(b, df, strict = true) {\r\n    return this.moveBorderSimple(b, df, strict);\r\n  }\r\n\r\n  moveBorderSimple(b, df, strict = true) {\r\n    let axis = b.horiz & 1;\r\n    let axis2 = axis ^ 1;\r\n\r\n    let min = Math.min(b.v1[axis2], b.v2[axis2]);\r\n    let max = Math.max(b.v1[axis2], b.v2[axis2]);\r\n\r\n    let test = (v) => {\r\n      return v[axis2] >= min && v[axis2] <= max;\r\n    };\r\n\r\n    let vs = new util.set();\r\n\r\n    for (let b2 of this.walkBorderLine(b)) {\r\n      if (strict && !test(b2.v1) && !test(b2.v2)) {\r\n        return false;\r\n      }\r\n\r\n      vs.add(b2.v1);\r\n      vs.add(b2.v2);\r\n    }\r\n\r\n    for (let v of vs) {\r\n      v[axis] += df;\r\n    }\r\n\r\n    for (let v of vs) {\r\n      for (let b of v.borders) {\r\n        for (let sarea of b.sareas) {\r\n          sarea.loadFromVerts();\r\n        }\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  moveBorderUnused(b, df, strict = true) {\r\n    if (!b) {\r\n      console.warn(\"missing border\");\r\n      return false;\r\n    }\r\n\r\n    let axis = b.horiz & 1;\r\n\r\n    let vs = new util.set();\r\n\r\n    let visit = new util.set();\r\n\r\n    let axis2 = axis ^ 1;\r\n\r\n    let min = Math.min(b.v1[axis2], b.v2[axis2]);\r\n    let max = Math.max(b.v1[axis2], b.v2[axis2]);\r\n\r\n    let test = (v) => {\r\n      return v[axis2] >= min && v[axis2] <= max;\r\n    };\r\n\r\n    let first = true;\r\n    let found = false;\r\n    let halfedges = new util.set();\r\n    let borders = new util.set();\r\n\r\n    for (let b2 of this.walkBorderLine(b)) {\r\n      /*\r\n      if (first) {\r\n        first = false;\r\n        df = Math.max(Math.abs(df), FrameManager_mesh.SnapLimit) * Math.sign(df);\r\n      }\r\n      found = true;\r\n      for (let sarea of b2.sareas) {\r\n        halfedges.add(new ScreenHalfEdge(b2, sarea))\r\n      }\r\n      vs.add(b2.v1);\r\n      vs.add(b2.v2);\r\n      continue;\r\n      //*/\r\n\r\n      if (!strict) {\r\n        vs.add(b2.v1);\r\n        vs.add(b2.v2);\r\n        continue;\r\n      }\r\n\r\n\r\n      let t1 = test(b2.v1), t2 = test(b2.v2);\r\n\r\n      if (!t1 || !t2) {\r\n        found = true;\r\n\r\n        if (first) {\r\n          first = false;\r\n          df = Math.max(Math.abs(df), FrameManager_mesh.SnapLimit)*Math.sign(df);\r\n        }\r\n      }\r\n      if (!t1 && !t2) {\r\n        continue;\r\n      }\r\n\r\n      borders.add(b2);\r\n\r\n      //make dummy half edges to keep track of border/sarea pairs\r\n      //and especailly what the border side is\r\n      for (let sarea of b2.sareas) {\r\n        halfedges.add(new ScreenHalfEdge(b2, sarea))\r\n      }\r\n\r\n      vs.add(b2.v1);\r\n      vs.add(b2.v2);\r\n    }\r\n\r\n    for (let b2 of this.walkBorderLine(b)) {\r\n      if (borders.has(b2)) {\r\n        continue;\r\n      }\r\n\r\n      for (let he of b2.halfedges) {\r\n        borders.remove(he.border);\r\n        if (halfedges.has(he)) {\r\n          halfedges.remove(he);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let v of vs) {\r\n      let ok = v[axis2] >= min && v[axis2] <= max;\r\n\r\n      if (!ok && strict) {\r\n        //   return false;\r\n      }\r\n    }\r\n\r\n    if (!found || !strict) {\r\n      for (let v of vs) {\r\n        v[axis] += df;\r\n      }\r\n    } else {\r\n      let borders = new util.set();\r\n\r\n      for (let he of halfedges) {\r\n        borders.add(he.border);\r\n        this.moveBorderWithoutVerts(he, df);\r\n      }\r\n\r\n      for (let he of halfedges) {\r\n        he.sarea.loadFromPosSize();\r\n      }\r\n\r\n      for (let b of borders) {\r\n        let sareas = b.sareas.slice(0, b.sareas.length);\r\n\r\n        this.killBorder(b);\r\n        for (let sarea of sareas) {\r\n          sarea.loadFromPosSize();\r\n        }\r\n      }\r\n\r\n      return halfedges.length > 0;\r\n    }\r\n\r\n\r\n    for (let sarea of b.sareas) {\r\n      sarea.loadFromVerts();\r\n    }\r\n\r\n    for (let he of b.halfedges) {\r\n      he.sarea.loadFromVerts();\r\n\r\n      for (let sarea of he.border.sareas) {\r\n        sarea.loadFromVerts();\r\n        for (let b2 of sarea._borders) {\r\n          b2.setCSS();\r\n        }\r\n      }\r\n    }\r\n\r\n    b.setCSS();\r\n\r\n    return true;\r\n  }\r\n\r\n  solveAreaConstraints(snapArgument = true) {\r\n    let repeat = false;\r\n    let found = false;\r\n\r\n    let time = util.time_ms();\r\n\r\n    for (let i = 0; i < 10; i++) {\r\n      repeat = false;\r\n\r\n      for (let sarea of this.sareas) {\r\n        if (sarea.hidden) continue;\r\n\r\n        repeat = repeat || this.checkAreaConstraint(sarea);\r\n      }\r\n\r\n      found = found || repeat;\r\n\r\n      if (repeat) {\r\n        for (let sarea of this.sareas) {\r\n          sarea.loadFromVerts();\r\n        }\r\n\r\n        this.snapScreenVerts(snapArgument);\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (found) {\r\n      this.snapScreenVerts(snapArgument);\r\n      if (cconst.DEBUG.areaConstraintSolver) {\r\n        time = util.time_ms() - time;\r\n\r\n        console.log(`enforced area constraint ${time.toFixed(2)}ms`);\r\n      }\r\n      this._recalcAABB();\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  snapScreenVerts(fitToSize = true) {\r\n    let this2 = this;\r\n\r\n    function* screenverts() {\r\n      for (let v of this2.screenverts) {\r\n        let ok = 0;\r\n\r\n        for (let sarea of v.sareas) {\r\n          if (!(sarea.flag & AreaFlags.INDEPENDENT)) {\r\n            ok = 1;\r\n          }\r\n        }\r\n\r\n        if (ok) {\r\n          yield v;\r\n        }\r\n      }\r\n    }\r\n\r\n    let mm = new math.MinMax(2);\r\n    for (let v of screenverts()) {\r\n      mm.minmax(v);\r\n    }\r\n\r\n    let min = mm.min, max = mm.max;\r\n\r\n    //snap(min);\r\n    //snapi(max);\r\n\r\n    if (fitToSize) {\r\n      //fit entire screen to, well, the entire screen (size)\r\n      let vec = new Vector2(max).sub(min);\r\n      let sz = new Vector2(this.size);\r\n\r\n      sz.div(vec);\r\n\r\n      for (let v of screenverts()) {\r\n        v.sub(min).mul(sz);\r\n        //snap(v.sub(min).mul(sz));//.add(this.pos);\r\n      }\r\n\r\n      for (let v of screenverts()) {\r\n        v[0] += this.pos[0];\r\n        v[1] += this.pos[1];\r\n      }\r\n\r\n      //this.pos.zero();\r\n    } else {\r\n      for (let v of screenverts()) {\r\n        //snap(v);\r\n      }\r\n\r\n      [min, max] = this._recalcAABB();\r\n\r\n      //snap(min);\r\n      //snapi(max);\r\n\r\n      this.size.load(max).sub(min);\r\n      //this.pos.zero();\r\n      //this.pos.load(min);\r\n    }\r\n\r\n    let found = 1;\r\n\r\n    for (let sarea of this.sareas) {\r\n      if (sarea.hidden) continue;\r\n\r\n      let old = new Vector2(sarea.size);\r\n      let oldpos = new Vector2(sarea.pos);\r\n\r\n      sarea.loadFromVerts();\r\n\r\n      found = found || old.vectorDistance(sarea.size) > 1;\r\n      found = found || oldpos.vectorDistance(sarea.pos) > 1;\r\n\r\n      sarea.on_resize(old);\r\n    }\r\n\r\n    if (found) {\r\n      //this.regenBorders();\r\n      this._recalcAABB();\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  on_resize(oldsize, newsize = this.size, _set_key = true) {\r\n    //console.warn(\"resizing\");\r\n\r\n    if (_set_key) {\r\n      this._last_ckey1 = this._calcSizeKey(newsize[0], newsize[1], this.pos[0], this.pos[1], devicePixelRatio, visualViewport.scale);\r\n    }\r\n\r\n    let ratio = [newsize[0]/oldsize[0], newsize[1]/oldsize[1]];\r\n\r\n    let offx = this.pos[0] - this.oldpos[0];\r\n    let offy = this.pos[1] - this.oldpos[1];\r\n\r\n    this.oldpos.load(this.pos);\r\n\r\n    //console.log(\"resize!\", ratio);\r\n\r\n    for (let v of this.screenverts) {\r\n      v[0] *= ratio[0];\r\n      v[1] *= ratio[1];\r\n      v[0] += offx;\r\n      v[1] += offy;\r\n    }\r\n\r\n    let min = [1e17, 1e17], max = [-1e17, -1e17];\r\n    let olds = [];\r\n\r\n    for (let sarea of this.sareas) {\r\n      olds.push([sarea.size[0], sarea.size[1]]);\r\n\r\n      sarea.loadFromVerts();\r\n    }\r\n\r\n    this.size[0] = newsize[0];\r\n    this.size[1] = newsize[1];\r\n\r\n    this.snapScreenVerts();\r\n    this.solveAreaConstraints();\r\n    this._recalcAABB();\r\n\r\n\r\n    let i = 0;\r\n    for (let sarea of this.sareas) {\r\n      sarea.on_resize(sarea.size, olds[i]);\r\n      sarea.setCSS();\r\n      i++;\r\n    }\r\n\r\n    this.regenBorders();\r\n    this.setCSS();\r\n    this.calcTabOrder();\r\n\r\n    this._fireResizeCB(oldsize);\r\n  }\r\n\r\n  _fireResizeCB(oldsize = this.size) {\r\n    for (let cb of this._resize_callbacks) {\r\n      cb(oldsize);\r\n    }\r\n  }\r\n\r\n  getScreenVert(pos, added_id = \"\", floating = false) {\r\n    let key = ScreenVert.hash(pos, added_id, this.snapLimit);\r\n\r\n    if (floating || !(key in this._vertmap)) {\r\n      let v = new ScreenVert(pos, this.idgen++, added_id);\r\n\r\n      this._vertmap[key] = v;\r\n      this._idmap[v._id] = v;\r\n\r\n      this.screenverts.push(v);\r\n    }\r\n\r\n    return this._vertmap[key];\r\n  }\r\n\r\n  isBorderOuter(border) {\r\n    let sides = 0;\r\n\r\n    for (let he of border.halfedges) {\r\n      sides |= 1<<he.side;\r\n    }\r\n\r\n    let bits = 0;\r\n    for (let i = 0; i < 4; i++) {\r\n      bits += (sides & (1<<i)) ? 1 : 0;\r\n    }\r\n\r\n    let ret = bits < 2;\r\n    let floating = false;\r\n\r\n    for (let sarea of border.sareas) {\r\n      floating = floating || sarea.floating;\r\n    }\r\n\r\n    if (floating) {\r\n      //check if border is on screen limits\r\n      let axis = border.horiz ? 1 : 0;\r\n\r\n      ret = Math.abs(border.v1[axis] - this.pos[axis]) < 4;\r\n      ret = ret || Math.abs(border.v1[axis] - this.pos[axis] - this.size[axis]) < 4;\r\n    }\r\n\r\n    border.outer = ret;\r\n    return ret;\r\n  }\r\n\r\n  isBorderMovable(b, limit = 5) {\r\n    if (this.allBordersMovable)\r\n      return true;\r\n\r\n    for (let he of b.halfedges) {\r\n      if (he.sarea.borderLock & (1<<he.side)) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    let ok = !this.isBorderOuter(b);\r\n\r\n    for (let sarea of b.sareas) {\r\n      if (sarea.floating) {\r\n        ok = true;\r\n        break;\r\n      }\r\n    }\r\n\r\n    return ok;\r\n  }\r\n\r\n  getScreenBorder(sarea, v1, v2, side) {\r\n    let suffix = sarea._get_v_suffix();\r\n\r\n    if (!(v1 instanceof ScreenVert)) {\r\n      v1 = this.getScreenVert(v1, suffix);\r\n    }\r\n\r\n    if (!(v2 instanceof ScreenVert)) {\r\n      v2 = this.getScreenVert(v2, suffix);\r\n    }\r\n\r\n    let hash = ScreenBorder.hash(v1, v2);\r\n\r\n    if (!(hash in this._edgemap)) {\r\n      let sb = this._edgemap[hash] = UIBase.createElement(\"screenborder-x\");\r\n\r\n      sb._hash = hash;\r\n      sb.screen = this;\r\n      sb.v1 = v1;\r\n      sb.v2 = v2;\r\n      sb._id = this.idgen++;\r\n\r\n      v1.borders.push(sb);\r\n      v2.borders.push(sb);\r\n\r\n      sb.ctx = this.ctx;\r\n\r\n      this.screenborders.push(sb);\r\n      this.appendChild(sb);\r\n\r\n      sb.setCSS();\r\n\r\n      this._edgemap[hash] = sb;\r\n      this._idmap[sb._id] = sb;\r\n    }\r\n\r\n    return this._edgemap[hash];\r\n  }\r\n\r\n  minmaxArea(sarea, mm = undefined) {\r\n    if (mm === undefined) {\r\n      mm = new math.MinMax(2);\r\n    }\r\n\r\n    for (let b of sarea._borders) {\r\n      mm.minmax(b.v1);\r\n      mm.minmax(b.v2);\r\n    }\r\n\r\n    return mm;\r\n  }\r\n\r\n  //does sarea1 border sarea2?\r\n  areasBorder(sarea1, sarea2) {\r\n    for (let b of sarea1._borders) {\r\n      for (let sa of b.sareas) {\r\n        if (sa === sarea2)\r\n          return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  //regenerates borders, sets css and calls this.update\r\n\r\n  replaceArea(dst, src) {\r\n    if (dst === src)\r\n      return;\r\n\r\n    src.pos[0] = dst.pos[0];\r\n    src.pos[1] = dst.pos[1];\r\n    src.size[0] = dst.size[0];\r\n    src.size[1] = dst.size[1];\r\n\r\n    src.floating = dst.floating;\r\n    src._borders = dst._borders;\r\n    src._verts = dst._verts;\r\n\r\n    if (this.sareas.indexOf(src) < 0) {\r\n      this.sareas.push(src);\r\n      this.shadow.appendChild(src);\r\n    }\r\n\r\n    if (this.sareas.active === dst) {\r\n      this.sareas.active = src;\r\n    }\r\n\r\n    //this.sareas.remove(dst);\r\n    //dst.remove();\r\n\r\n    this.sareas.remove(dst);\r\n    dst.remove();\r\n\r\n    this.regenScreenMesh();\r\n    this.snapScreenVerts();\r\n    this._updateAll();\r\n  }\r\n\r\n  _internalRegenAll() {\r\n    this.snapScreenVerts();\r\n    this._recalcAABB();\r\n    this.calcTabOrder();\r\n    this.setCSS();\r\n\r\n    this.completeUpdate();\r\n    this.completeSetCSS();\r\n    this.completeUpdate();\r\n  }\r\n\r\n  _updateAll() {\r\n    for (let sarea of this.sareas) {\r\n      sarea.setCSS();\r\n    }\r\n    this.setCSS();\r\n    this.update();\r\n  }\r\n\r\n  removeArea(sarea) {\r\n    if (this.sareas.indexOf(sarea) < 0) {\r\n      console.warn(sarea, \"<- Warning: tried to remove unknown area\");\r\n      return;\r\n    }\r\n\r\n    this.sareas.remove(sarea);\r\n    sarea.remove();\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      this.snapScreenVerts();\r\n      this.regenScreenMesh();\r\n    }\r\n\r\n    this._updateAll();\r\n    this.drawUpdate();\r\n  }\r\n\r\n  appendChild(child) {\r\n    /*\r\n    if (child instanceof UIBase) {\r\n      if (child._useDataPathUndo === undefined) {\r\n        child.useDataPathUndo = this.useDataPathUndo;\r\n      }\r\n    }*/\r\n\r\n    if (child instanceof ScreenArea.ScreenArea) {\r\n      child.screen = this;\r\n      child.ctx = this.ctx;\r\n      child.parentWidget = this;\r\n\r\n      this.sareas.push(child);\r\n\r\n      if (child.size.dot(child.size) === 0) {\r\n        child.size[0] = this.size[0];\r\n        child.size[1] = this.size[1];\r\n      }\r\n\r\n      if (!child._has_evts) {\r\n        child._has_evts = true;\r\n\r\n        let onfocus = (e) => {\r\n          this.sareas.active = child;\r\n        }\r\n\r\n        let onblur = (e) => {\r\n          //XXX this is causing bugs\r\n\r\n          //if (this.sareas.active === child) {\r\n          //  this.sareas.active = undefined;\r\n          //}\r\n        }\r\n\r\n        child.addEventListener(\"focus\", onfocus);\r\n        child.addEventListener(\"mouseenter\", onfocus);\r\n        child.addEventListener(\"blur\", onblur);\r\n        child.addEventListener(\"mouseleave\", onblur);\r\n      }\r\n\r\n      this.regenBorders();\r\n      child.setCSS();\r\n      this.drawUpdate();\r\n      child._init();\r\n    }\r\n\r\n    return this.shadow.appendChild(child);\r\n    //return super.appendChild(child);\r\n  }\r\n\r\n  add(child) {\r\n    return this.appendChild(child);\r\n  }\r\n\r\n  hintPickerTool() {\r\n    (new FrameManager_ops.ToolTipViewer(this)).start();\r\n  }\r\n\r\n  removeAreaTool(border) {\r\n    let tool = new FrameManager_ops.RemoveAreaTool(this, border);\r\n    //let tool = new FrameManager_ops.AreaDragTool(this, undefined, this.mpos);\r\n    tool.start();\r\n  }\r\n\r\n  moveAttachTool(sarea, mpos = this.mpos, elem, pointerId) {\r\n    let tool = new FrameManager_ops.AreaMoveAttachTool(this, sarea, mpos);\r\n    tool.start(elem, pointerId);\r\n  }\r\n\r\n  splitTool() {\r\n    let tool = new FrameManager_ops.SplitTool(this);\r\n    //let tool = new FrameManager_ops.AreaDragTool(this, undefined, this.mpos);\r\n    tool.start();\r\n  }\r\n\r\n  areaDragTool(sarea = this.sareas.active) {\r\n    if (sarea === undefined) {\r\n      console.warn(\"no active screen area\");\r\n      return;\r\n    }\r\n\r\n    let mpos = this.mpos;\r\n    let tool = new FrameManager_ops.AreaDragTool(this, this.sareas.active, mpos);\r\n\r\n    tool.start();\r\n  }\r\n\r\n  makeBorders() {\r\n    for (let sarea of this.sareas) {\r\n      sarea.makeBorders(this);\r\n    }\r\n  }\r\n\r\n  cleanupBorders() {\r\n    let del = new Set();\r\n\r\n    for (let b of this.screenborders) {\r\n      if (b.halfedges.length === 0) {\r\n        del.add(b);\r\n      }\r\n    }\r\n\r\n    for (let b of del) {\r\n      delete this._edgemap[b._hash];\r\n      HTMLElement.prototype.remove.call(b);\r\n    }\r\n  }\r\n\r\n  mergeBlankAreas() {\r\n    for (let b of this.screenborders) {\r\n      if (b.locked) {\r\n        continue;\r\n      }\r\n\r\n      let blank, sarea;\r\n\r\n      for (let he of b.halfedges) {\r\n        if (!he.sarea.area) {\r\n          blank = he.sarea;\r\n          sarea = b.getOtherSarea(blank);\r\n\r\n          let axis = b.horiz ^ 1;\r\n\r\n          if (blank && sarea && blank.size[axis] !== sarea.size[axis]) {\r\n            blank = sarea = undefined;\r\n          }\r\n\r\n          if (blank && sarea) {\r\n            break;\r\n          } else {\r\n            blank = undefined;\r\n            sarea = undefined;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (blank && sarea && blank !== sarea) {\r\n        this.collapseArea(blank, b);\r\n      }\r\n    }\r\n\r\n    this.cleanupBorders();\r\n  }\r\n\r\n  floatArea(area) {\r\n    let sarea = area.parentWidget;\r\n\r\n    /* already floating? */\r\n    if (sarea.floating) {\r\n      return sarea;\r\n    }\r\n\r\n    sarea.editors.remove(area);\r\n    delete sarea.editormap[area.constructor.define().areaname];\r\n    sarea.area = undefined;\r\n\r\n    HTMLElement.prototype.remove.call(area);\r\n\r\n    let sarea2 = UIBase.createElement(\"screenarea-x\", true);\r\n    sarea2.floating = true;\r\n\r\n    sarea2.pos = new Vector2(sarea.pos);\r\n    sarea2.pos.addScalar(5);\r\n\r\n    sarea2.size = new Vector2(sarea.size);\r\n\r\n    sarea2.editors.push(area);\r\n    sarea2.editormap[area.constructor.define().areaname] = area;\r\n\r\n    sarea2.shadow.appendChild(area);\r\n    sarea2.area = area;\r\n\r\n    area.push_ctx_active();\r\n    area.pop_ctx_active();\r\n\r\n    area.pos = sarea2.pos;\r\n    area.size = sarea2.size;\r\n    area.parentWidget = sarea2;\r\n    area.owning_sarea = sarea2;\r\n\r\n    sarea.flushSetCSS();\r\n    sarea.flushUpdate();\r\n\r\n    sarea2.flushSetCSS();\r\n    sarea2.flushUpdate();\r\n\r\n    this.appendChild(sarea2);\r\n\r\n    if (sarea.editors.length > 0) {\r\n      let area2 = sarea.editors[0];\r\n      sarea.switch_editor(area2.constructor);\r\n\r\n      sarea.flushSetCSS();\r\n      sarea.flushUpdate();\r\n    }\r\n\r\n    sarea2.loadFromPosSize();\r\n    sarea2.bringToFront();\r\n\r\n    this.mergeBlankAreas();\r\n    this.cleanupBorders();\r\n\r\n    return sarea2;\r\n  }\r\n\r\n  on_keydown(e) {\r\n    if (checkForTextBox(this, this.mpos[0], this.mpos[1])) {\r\n      console.log(\"textbox detected\");\r\n      return;\r\n    }\r\n\r\n    if (!haveModal() && this.execKeyMap(e)) {\r\n      e.preventDefault();\r\n      return;\r\n    }\r\n\r\n    if (!haveModal() && this.sareas.active !== undefined && this.sareas.active.on_keydown) {\r\n      let area = this.sareas.active;\r\n      return this.sareas.active.on_keydown(e);\r\n    }\r\n  }\r\n\r\n  on_keyup(e) {\r\n    if (!haveModal() && this.sareas.active !== undefined && this.sareas.active.on_keyup) {\r\n      return this.sareas.active.on_keyup(e);\r\n    }\r\n  }\r\n\r\n  on_keypress(e) {\r\n    if (!haveModal() && this.sareas.active !== undefined && this.sareas.active.on_keypress) {\r\n      return this.sareas.active.on_keypress(e);\r\n    }\r\n  }\r\n\r\n  draw() {\r\n    for (let sarea of this.sareas) {\r\n      sarea.draw();\r\n    }\r\n  }\r\n\r\n  afterSTRUCT() {\r\n    for (let sarea of this.sareas) {\r\n      sarea._ctx = this.ctx;\r\n      sarea.afterSTRUCT();\r\n    }\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    this.clear();\r\n\r\n    reader(this);\r\n\r\n    //handle old files that might have saved as simple arrays\r\n    this.size = new Vector2(this.size);\r\n\r\n    let sareas = this.sareas;\r\n    this.sareas = [];\r\n\r\n    /*\r\n    let push = this.sareas.push;\r\n\r\n    this.sareas.push = function(item) {\r\n      console.error(\"this.sareas.push\", item);\r\n      push.call(this, item);\r\n    }\r\n    */\r\n\r\n    for (let sarea of sareas) {\r\n      sarea.screen = this;\r\n      sarea.parentWidget = this;\r\n\r\n      this.appendChild(sarea);\r\n    }\r\n\r\n    this.regenBorders();\r\n    this.setCSS();\r\n\r\n    this.doOnce(() => {\r\n      this.loadUIData(this.uidata);\r\n      this.uidata = undefined;\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  test_struct(appstate = _appstate) {\r\n    let data = [];\r\n    //let scripts = nstructjs.write_scripts();\r\n    nstructjs.manager.write_object(data, this);\r\n    data = new DataView(new Uint8Array(data).buffer);\r\n\r\n    let screen2 = nstructjs.manager.read_object(data, this.constructor);\r\n    screen2.ctx = this.ctx;\r\n\r\n    for (let sarea of screen2.sareas) {\r\n      sarea.screen = screen2;\r\n      sarea.ctx = this.ctx;\r\n      sarea.area.ctx = this.ctx;\r\n    }\r\n\r\n    let parent = this.parentElement;\r\n    this.remove();\r\n\r\n    appstate.screen = screen2;\r\n\r\n    parent.appendChild(screen2);\r\n\r\n    //for (let \r\n    screen2.regenBorders();\r\n    screen2.update();\r\n    screen2.listen();\r\n\r\n    screen2.doOnce(() => {\r\n      screen2.on_resize(screen2.size, [window.innerWidth, window.innerHeight]);\r\n    });\r\n\r\n    console.log(data)\r\n    return screen2;\r\n  }\r\n\r\n  saveUIData() {\r\n    try {\r\n      return ui_base.saveUIData(this, \"screen\");\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n      console.log(\"Failed to save UI state data\");\r\n    }\r\n  }\r\n\r\n  loadUIData(str) {\r\n    try {\r\n      ui_base.loadUIData(this, str);\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n      console.log(\"Failed to load UI state data\");\r\n    }\r\n  }\r\n}\r\n\r\nScreen.STRUCT = `\r\npathux.Screen { \r\n  size  : vec2;\r\n  pos   : vec2;\r\n  sareas : array(pathux.ScreenArea);\r\n  idgen : int;\r\n  uidata : string | obj.saveUIData();\r\n}\r\n`;\r\n\r\nnstructjs.register(Screen);\r\nui_base.UIBase.internalRegister(Screen);\r\n\r\nScreenArea.setScreenClass(Screen);\r\n_setScreenClass(Screen);\r\n\r\nlet get_screen_cb;\r\nlet _on_keydown;\r\n\r\nlet start_cbs = [];\r\nlet stop_cbs = [];\r\nlet keyboardDom = window;\r\n\r\nlet key_event_opts;\r\n\r\nexport function startEvents(getScreenFunc) {\r\n  get_screen_cb = getScreenFunc;\r\n\r\n  if (_events_started) {\r\n    return;\r\n  }\r\n\r\n  _events_started = true;\r\n\r\n  _on_keydown = (e) => {\r\n    /* Prevent browser from unfocuing the page with the alt key.\r\n     * Happens during touch/pen event handing in Chrome (Oct2023).\r\n     */\r\n    if (e.keyCode === keymap[\"Alt\"]) {\r\n      e.preventDefault();\r\n    }\r\n\r\n    let screen = get_screen_cb();\r\n\r\n    return screen.on_keydown(e);\r\n  };\r\n\r\n  window.addEventListener(\"keydown\", _on_keydown, key_event_opts);\r\n\r\n  for (let cb of start_cbs) {\r\n    cb();\r\n  }\r\n}\r\n\r\nexport function stopEvents() {\r\n  window.removeEventListener(\"keydown\", _on_keydown, key_event_opts);\r\n  _on_keydown = undefined;\r\n  _events_started = false;\r\n\r\n  for (let cb of stop_cbs) {\r\n    try {\r\n      cb();\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n    }\r\n  }\r\n\r\n  return get_screen_cb;\r\n}\r\n\r\nexport function setKeyboardDom(dom) {\r\n  let started = _events_started;\r\n  if (started) {\r\n    stopEvents();\r\n  }\r\n\r\n  keyboardDom = dom;\r\n\r\n  if (started) {\r\n    startEvents(get_screen_cb);\r\n  }\r\n}\r\n\r\n/** Sets options passed to addEventListener() for on_keydown hotkey handler */\r\nexport function setKeyboardOpts(opts) {\r\n  key_event_opts = opts;\r\n}\r\n\r\nexport function _onEventsStart(cb) {\r\n  start_cbs.push(cb);\r\n}\r\n\r\nexport function _onEventsStop(cb) {\r\n  stop_cbs.push(cb);\r\n}\r\n\r\n/*\r\ndocument.addEventListener(\"touchstart\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"touchmove\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"scroll\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"resize\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"pointerdown\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"pointerstart\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"pointermove\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\n*/\r\n","import {AreaFlags} from \"../screen/ScreenArea.js\";\r\nimport {keymap} from \"../path-controller/util/simple_events.js\";\r\n\r\nexport function makePopupArea(area_class, screen, args={}) {\r\n  let sarea = UIBase.createElement(\"screenarea-x\");\r\n\r\n  let width = args.width || (screen.size[0]*0.7);\r\n  let height = args.height || (screen.size[1]*0.7);\r\n  let addEscapeKeyHandler = args.addEscapeKeyHandler !== undefined ? args.addEscapeKeyHandler : true;\r\n\r\n  sarea.ctx = screen.ctx;\r\n  sarea.size[0] = width;\r\n  sarea.size[1] = height;\r\n  sarea.pos[0] = 100;\r\n  sarea.pos[1] = 100;\r\n\r\n  sarea.pos[0] = Math.min(sarea.pos[0], screen.size[0] - sarea.size[0] - 2);\r\n  sarea.pos[1] = Math.min(sarea.pos[1], screen.size[1] - sarea.size[1] - 2);\r\n\r\n  sarea.switch_editor(area_class);\r\n\r\n  sarea.overrideClass(\"popup\");\r\n  sarea.style[\"background-color\"] = sarea.getDefault(\"background-color\");\r\n  sarea.style[\"border-radius\"] = sarea.getDefault(\"border-radius\") + \"px\";\r\n  sarea.style[\"border-color\"] = sarea.getDefault(\"border-color\");\r\n  sarea.style[\"border-style\"] = sarea.getDefault(\"border-style\");\r\n  sarea.style[\"border-width\"] = sarea.getDefault(\"border-width\") + \"px\";\r\n\r\n  sarea.flag |= AreaFlags.FLOATING | AreaFlags.INDEPENDENT;\r\n\r\n  screen.appendChild(sarea);\r\n  sarea.setCSS();\r\n\r\n  if (addEscapeKeyHandler) {\r\n    sarea.on_keydown = (e) => {\r\n      if (e.keyCode === keymap.Escape) {\r\n        screen.removeArea(sarea);\r\n      }\r\n    }\r\n  }\r\n\r\n  sarea.bringToFront();\r\n\r\n  return sarea;\r\n}","import {Area, contextWrangler} from '../screen/ScreenArea.js';\r\nimport {nstructjs} from '../path-controller/controller.js';\r\nimport {UIBase} from '../core/ui_base.js';\r\nimport {Container} from '../core/ui.js';\r\nimport {parsepx} from '../core/ui_base.js';\r\nimport {Icons} from '../core/ui_base.js';\r\nimport * as util from '../util/util.js';\r\n\r\nlet sidebar_hash = new util.HashDigest();\r\n\r\nexport class SideBar extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.header = this.row();\r\n    this.header.style[\"height\"] = \"45px\";\r\n\r\n    this._last_resize_key = undefined;\r\n\r\n    this._closed = false;\r\n\r\n    this.closeIcon = this.header.iconbutton(Icons.RIGHT_ARROW, \"Close/Open sidebar\", () => {\r\n      console.log(\"click!\");\r\n      this.closed = !this._closed;\r\n    });\r\n\r\n    this._openWidth = undefined;\r\n    this.needsSetCSS = true;\r\n    this.tabbar = this.tabs(\"left\");\r\n    //this.tabbar.style[\"flex-grow\"] = \"8\";\r\n  }\r\n\r\n  saveData() {\r\n    return {\r\n      closed : this.closed\r\n    }\r\n  }\r\n\r\n  loadData(obj) {\r\n    this.closed = obj.closed;\r\n  }\r\n\r\n  set closed(val) {\r\n    if (!!this._closed === !!val) {\r\n      return;\r\n    }\r\n\r\n    if (this._openWidth === undefined && !this._closed && val) {\r\n      this._openWidth = this.width;\r\n    }\r\n\r\n    console.log(\"animate!\");\r\n    let w = val ? 50 : this._openWidth;\r\n    this.animate().goto(\"width\", w, 500);\r\n\r\n\r\n    if (val) {\r\n      this.closeIcon.icon = Icons.LEFT_ARROW;\r\n    } else {\r\n      this.closeIcon.icon = Icons.RIGHT_ARROW;\r\n    }\r\n\r\n    this._closed = val;\r\n  }\r\n\r\n  get closed() {\r\n    return this._closed;\r\n  }\r\n\r\n  get width() {\r\n    return parsepx(\"\" + this.getAttribute(\"width\"));\r\n  }\r\n\r\n  set width(val) {\r\n    this.setAttribute(\"width\", \"\" + val + \"px\");\r\n    this.update();\r\n  }\r\n\r\n  get height() {\r\n    return parsepx(\"\" + this.getAttribute(\"height\"));\r\n  }\r\n\r\n  set height(val) {\r\n    this.setAttribute(\"height\", \"\" + val + \"px\");\r\n    this.update();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"sidebar-base-x\",\r\n      style  : \"sidebar\"\r\n    }\r\n  }\r\n\r\n  tab(name) {\r\n    return this.tabbar.tab(name);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    let closed = this._closed;\r\n    this._closed = false;\r\n\r\n    if (!this.getAttribute(\"width\")) {\r\n      this.width = 300;\r\n    }\r\n    if (!this.getAttribute(\"height\")) {\r\n      this.height = 700;\r\n    }\r\n\r\n    this.setCSS();\r\n\r\n    if (closed) {\r\n      this.closed = true;\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    if (!this.parentWidget) {\r\n      return;\r\n    }\r\n\r\n    let editor = this.parentWidget;\r\n\r\n    //happens when editors are inactive\r\n    if (!editor.pos || !editor.size) {\r\n      return;\r\n    }\r\n\r\n    this.needsSetCSS = false;\r\n\r\n    let w = this.width, h = this.height;\r\n\r\n    w = isNaN(w) ? 500 : w;\r\n    h = isNaN(h) ? 500 : h;\r\n\r\n    h = Math.min(h, editor.size[1]-25);\r\n\r\n    this.style[\"position\"] = \"absolute\";\r\n    this.style[\"width\"] = w + \"px\";\r\n    this.style[\"height\"] = h + \"px\";\r\n    this.style[\"z-index\"] = \"100\";\r\n    this.style[\"overflow\"] = \"scroll\";\r\n\r\n    this.style[\"background-color\"] = this.getDefault(\"AreaHeaderBG\");\r\n\r\n    this.tabbar.style[\"height\"] = (h - 45) + \"px\";\r\n    this.style[\"left\"] = (editor.size[0] - w) + \"px\";\r\n  }\r\n\r\n  update() {\r\n    sidebar_hash.reset();\r\n    sidebar_hash.add(this.width);\r\n    sidebar_hash.add(this.height);\r\n\r\n    let key = sidebar_hash.get();\r\n    if (key !== this._last_resize_key) {\r\n      this._last_resize_key = key;\r\n      this.needsSetCSS = true;\r\n    }\r\n\r\n    if (this.needsSetCSS) {\r\n      this.setCSS();\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.register(SideBar);\r\n\r\nexport class Editor extends Area {\r\n  constructor() {\r\n    super();\r\n\r\n    this.container = UIBase.createElement(\"container-x\");\r\n    this.container.parentWidget = this;\r\n    this.shadow.appendChild(this.container);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      areaname: \"areaname\",\r\n      tagname : \"tagname-x\"\r\n    }\r\n  }\r\n\r\n  static defineAPI(api, strct) {\r\n    return strct;\r\n  }\r\n\r\n  /** \\param makeMenuBar function(ctx, container, menuBarEditor)\r\n   *\r\n   * example:\r\n   *\r\n   * function makeMenuBar(ctx, container, menuBarEditor) {\r\n   *\r\n   *  container.menu(\"File\", [\r\n   *    \"app.new()\",\r\n   *    simple.Menu.SEP,\r\n   *    \"app.save()\",\r\n   *    \"app.save(forceDialog=true)|Save As\",\r\n   *    \"app.open\"\r\n   *  ]);\r\n   * }\r\n   * */\r\n  static registerAppMenu(makeMenuBar) {\r\n    if (this !== Editor) {\r\n      throw new Error(\"must call registerAppMenu from simple.Editor base class\");\r\n    }\r\n\r\n    this.makeMenuBar = makeMenuBar;\r\n  }\r\n\r\n  /** Registers class with Area system\r\n   *  and nstructjs.  Uses nstructjs.inlineRegister\r\n   *  to handle inheritance.\r\n   **/\r\n  static register(cls) {\r\n    if (!cls.hasOwnProperty(\"define\")) {\r\n      throw new Error(\"missing define() method\");\r\n    }\r\n\r\n    if (!cls.hasOwnProperty(\"STRUCT\")) {\r\n      cls.STRUCT = nstructjs.inherit(cls, this) + `\\n}`;\r\n      nstructjs.register(cls);\r\n    } else {\r\n      /* inlineRegister handles inheritance. */\r\n      cls.STRUCT = nstructjs.inlineRegister(cls, cls.STRUCT);\r\n    }\r\n\r\n    super.register(cls);\r\n  }\r\n\r\n  makeSideBar() {\r\n    if (this.sidebar) {\r\n      this.sidebar.remove();\r\n    }\r\n\r\n    let sidebar = this.sidebar = UIBase.createElement(\"sidebar-base-x\");\r\n    sidebar.parentWidget = this;\r\n    sidebar.ctx = this.ctx;\r\n    this.shadow.appendChild(sidebar);\r\n\r\n    if (this.ctx) {\r\n      sidebar._init();\r\n\r\n      this.sidebar.flushSetCSS();\r\n      this.sidebar.flushUpdate();\r\n    }\r\n\r\n\r\n    return this.sidebar;\r\n  }\r\n\r\n  on_resize(size, oldsize) {\r\n    super.on_resize(size, oldsize);\r\n\r\n    if (this.sidebar) {\r\n      if (this.ctx && this.pos) {\r\n        this.sidebar.setCSS();\r\n      } else {\r\n        this.sidebar.needsSetCSS = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  static findEditor(cls) {\r\n    return contextWrangler.getLastArea(cls);\r\n  }\r\n  \r\n  getScreen() {\r\n    return this.ctx.screen;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.makeHeader(this.container);\r\n  }\r\n\r\n  /** creates default header and puts it in this.header */\r\n  makeHeader(container, add_note_area = true, make_draggable = true) {\r\n    return super.makeHeader(container, add_note_area, make_draggable);\r\n  }\r\n\r\n  /** called regularly */\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  /** */\r\n  setCSS() {\r\n    super.setCSS();\r\n  }\r\n}\r\n\r\n","let text = `\r\n<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\r\n<svg\r\n   xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\r\n   xmlns:cc=\"http://creativecommons.org/ns#\"\r\n   xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"\r\n   xmlns:svg=\"http://www.w3.org/2000/svg\"\r\n   xmlns=\"http://www.w3.org/2000/svg\"\r\n   xmlns:xlink=\"http://www.w3.org/1999/xlink\"\r\n   xmlns:sodipodi=\"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\"\r\n   xmlns:inkscape=\"http://www.inkscape.org/namespaces/inkscape\"\r\n   width=\"512\"\r\n   height=\"512\"\r\n   id=\"svg16099\"\r\n   version=\"1.1\"\r\n   inkscape:version=\"1.0 (4035a4fb49, 2020-05-01)\"\r\n   sodipodi:docname=\"iconsheet.svg\"\r\n   inkscape:export-filename=\"C:\\dev\\allshape\\src\\datafiles\\iconsheet16.png\"\r\n   inkscape:export-xdpi=\"45\"\r\n   inkscape:export-ydpi=\"45\">\r\n  <defs\r\n     id=\"defs16101\">\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1587\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1307\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1303\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1299\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1295\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1291\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1231\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1186\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1182\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4974\"\r\n       is_visible=\"true\" />\r\n    <linearGradient\r\n       id=\"linearGradient5481\">\r\n      <stop\r\n         id=\"stop4865\"\r\n         offset=\"0\"\r\n         style=\"stop-color:#e66700;stop-opacity:1;\" />\r\n      <stop\r\n         style=\"stop-color:#f47712;stop-opacity:1;\"\r\n         offset=\"0.52777779\"\r\n         id=\"stop4867\" />\r\n      <stop\r\n         id=\"stop4869\"\r\n         offset=\"1\"\r\n         style=\"stop-color:#f8bb8a;stop-opacity:1;\" />\r\n    </linearGradient>\r\n    <linearGradient\r\n       id=\"linearGradient17116-6\">\r\n      <stop\r\n         id=\"stop4860\"\r\n         offset=\"0\"\r\n         style=\"stop-color:#b3a500;stop-opacity:1;\" />\r\n      <stop\r\n         id=\"stop4862\"\r\n         offset=\"1\"\r\n         style=\"stop-color:#eaa500;stop-opacity:1;\" />\r\n    </linearGradient>\r\n    <linearGradient\r\n       id=\"linearGradient17116\">\r\n      <stop\r\n         id=\"stop4853\"\r\n         offset=\"0\"\r\n         style=\"stop-color:#b3a500;stop-opacity:1;\" />\r\n      <stop\r\n         id=\"stop4855\"\r\n         offset=\"1\"\r\n         style=\"stop-color:#eaa500;stop-opacity:1;\" />\r\n    </linearGradient>\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4290\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4286\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4122\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4118\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4194\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect3225\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect5012\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect5008\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4108\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect3264\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect5465\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4613\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4609\"\r\n       is_visible=\"true\" />\r\n    <linearGradient\r\n       id=\"linearGradient5609\">\r\n      <stop\r\n         id=\"stop5611\"\r\n         offset=\"0\"\r\n         style=\"stop-color:#0089e6;stop-opacity:1;\" />\r\n      <stop\r\n         style=\"stop-color:#1280f4;stop-opacity:1;\"\r\n         offset=\"0.52777779\"\r\n         id=\"stop5613\" />\r\n      <stop\r\n         id=\"stop5615\"\r\n         offset=\"1\"\r\n         style=\"stop-color:#d4eefc;stop-opacity:1;\" />\r\n    </linearGradient>\r\n    <linearGradient\r\n       id=\"linearGradient5481-8\">\r\n      <stop\r\n         style=\"stop-color:#ffc700;stop-opacity:1\"\r\n         offset=\"0\"\r\n         id=\"stop5483\" />\r\n      <stop\r\n         id=\"stop5491\"\r\n         offset=\"0.52777779\"\r\n         style=\"stop-color:#ffc700;stop-opacity:1\" />\r\n      <stop\r\n         style=\"stop-color:#ffa41c;stop-opacity:1\"\r\n         offset=\"1\"\r\n         id=\"stop5485\" />\r\n    </linearGradient>\r\n    <inkscape:perspective\r\n       sodipodi:type=\"inkscape:persp3d\"\r\n       inkscape:vp_x=\"-108.10967 : 516.24314 : 1\"\r\n       inkscape:vp_y=\"0 : 323.31882 : 0\"\r\n       inkscape:vp_z=\"57.429562 : 516.24314 : 1\"\r\n       inkscape:persp3d-origin=\"-25.340056 : 488.65327 : 1\"\r\n       id=\"perspective18342\" />\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0.0\"\r\n       refX=\"0.0\"\r\n       id=\"Arrow2Send\"\r\n       style=\"overflow:visible;\">\r\n      <path\r\n         id=\"path17173\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.62500000;stroke-linejoin:round;\"\r\n         d=\"M 8.7185878,4.0337352 L -2.2072895,0.016013256 L 8.7185884,-4.0017078 C 6.9730900,-1.6296469 6.9831476,1.6157441 8.7185878,4.0337352 z \"\r\n         transform=\"scale(0.3) rotate(180) translate(-2.3,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Mend\"\r\n       orient=\"auto\"\r\n       refY=\"0.0\"\r\n       refX=\"0.0\"\r\n       id=\"Arrow2Mend\"\r\n       style=\"overflow:visible;\">\r\n      <path\r\n         id=\"path17167\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.62500000;stroke-linejoin:round;\"\r\n         d=\"M 8.7185878,4.0337352 L -2.2072895,0.016013256 L 8.7185884,-4.0017078 C 6.9730900,-1.6296469 6.9831476,1.6157441 8.7185878,4.0337352 z \"\r\n         transform=\"scale(0.6) rotate(180) translate(0,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow1Send\"\r\n       orient=\"auto\"\r\n       refY=\"0.0\"\r\n       refX=\"0.0\"\r\n       id=\"Arrow1Send\"\r\n       style=\"overflow:visible;\">\r\n      <path\r\n         id=\"path17155\"\r\n         d=\"M 0.0,0.0 L 5.0,-5.0 L -12.5,0.0 L 5.0,5.0 L 0.0,0.0 z \"\r\n         style=\"fill-rule:evenodd;stroke:#000000;stroke-width:1.0pt;\"\r\n         transform=\"scale(0.2) rotate(180) translate(6,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Lend\"\r\n       orient=\"auto\"\r\n       refY=\"0.0\"\r\n       refX=\"0.0\"\r\n       id=\"Arrow2Lend\"\r\n       style=\"overflow:visible;\">\r\n      <path\r\n         id=\"path17161\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.62500000;stroke-linejoin:round;\"\r\n         d=\"M 8.7185878,4.0337352 L -2.2072895,0.016013256 L 8.7185884,-4.0017078 C 6.9730900,-1.6296469 6.9831476,1.6157441 8.7185878,4.0337352 z \"\r\n         transform=\"scale(1.1) rotate(180) translate(1,0)\" />\r\n    </marker>\r\n    <linearGradient\r\n       id=\"linearGradient17126\">\r\n      <stop\r\n         style=\"stop-color:#008080;stop-opacity:1;\"\r\n         offset=\"0\"\r\n         id=\"stop17128\" />\r\n      <stop\r\n         style=\"stop-color:#00b3b3;stop-opacity:1;\"\r\n         offset=\"1\"\r\n         id=\"stop17130\" />\r\n    </linearGradient>\r\n    <linearGradient\r\n       id=\"linearGradient17116-6-9\">\r\n      <stop\r\n         style=\"stop-color:#b3a500;stop-opacity:1;\"\r\n         offset=\"0\"\r\n         id=\"stop17118\" />\r\n      <stop\r\n         style=\"stop-color:#eaa500;stop-opacity:1;\"\r\n         offset=\"1\"\r\n         id=\"stop17120\" />\r\n    </linearGradient>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-2\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-2\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-6\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-8\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-7\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-6\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-8\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-9\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-79\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-5\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-3\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-1\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-33\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-4\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-1\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-3\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <linearGradient\r\n       inkscape:collect=\"always\"\r\n       xlink:href=\"#linearGradient5481-5\"\r\n       id=\"linearGradient5489-4\"\r\n       x1=\"355.89935\"\r\n       y1=\"17.125025\"\r\n       x2=\"380.47559\"\r\n       y2=\"17.125025\"\r\n       gradientUnits=\"userSpaceOnUse\" />\r\n    <linearGradient\r\n       id=\"linearGradient5481-5\">\r\n      <stop\r\n         style=\"stop-color:#e66700;stop-opacity:1;\"\r\n         offset=\"0\"\r\n         id=\"stop5483-2\" />\r\n      <stop\r\n         id=\"stop5491-9\"\r\n         offset=\"0.52777779\"\r\n         style=\"stop-color:#f47712;stop-opacity:1;\" />\r\n      <stop\r\n         style=\"stop-color:#f8bb8a;stop-opacity:1;\"\r\n         offset=\"1\"\r\n         id=\"stop5485-9\" />\r\n    </linearGradient>\r\n    <linearGradient\r\n       y2=\"17.125025\"\r\n       x2=\"380.47559\"\r\n       y1=\"17.125025\"\r\n       x1=\"355.89935\"\r\n       gradientUnits=\"userSpaceOnUse\"\r\n       id=\"linearGradient5588\"\r\n       xlink:href=\"#linearGradient5609\"\r\n       inkscape:collect=\"always\"\r\n       gradientTransform=\"matrix(1.2151103,0,0,1.1804992,-207.06775,536.98221)\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4108-1\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4108-4\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4108-9\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect3225-1\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect3225-4\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4122-2\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4122-7\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1587-6\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4194-5\"\r\n       is_visible=\"true\" />\r\n  </defs>\r\n  <sodipodi:namedview\r\n     id=\"base\"\r\n     pagecolor=\"#9c9c9c\"\r\n     bordercolor=\"#666666\"\r\n     borderopacity=\"1.0\"\r\n     inkscape:pageopacity=\"0\"\r\n     inkscape:pageshadow=\"2\"\r\n     inkscape:zoom=\"3.8325453\"\r\n     inkscape:cx=\"144.17961\"\r\n     inkscape:cy=\"49.96269\"\r\n     inkscape:document-units=\"px\"\r\n     inkscape:current-layer=\"layer1\"\r\n     showgrid=\"true\"\r\n     inkscape:window-width=\"1606\"\r\n     inkscape:window-height=\"962\"\r\n     inkscape:window-x=\"177\"\r\n     inkscape:window-y=\"71\"\r\n     inkscape:window-maximized=\"0\"\r\n     inkscape:snap-global=\"false\"\r\n     inkscape:pagecheckerboard=\"true\"\r\n     inkscape:document-rotation=\"0\">\r\n    <inkscape:grid\r\n       type=\"xygrid\"\r\n       id=\"grid16107\"\r\n       empspacing=\"1\"\r\n       visible=\"true\"\r\n       enabled=\"true\"\r\n       snapvisiblegridlinesonly=\"false\"\r\n       spacingx=\"32\"\r\n       spacingy=\"32\"\r\n       dotted=\"false\"\r\n       originx=\"0\"\r\n       originy=\"0\" />\r\n  </sodipodi:namedview>\r\n  <metadata\r\n     id=\"metadata16104\">\r\n    <rdf:RDF>\r\n      <cc:Work\r\n         rdf:about=\"\">\r\n        <dc:format>image/svg+xml</dc:format>\r\n        <dc:type\r\n           rdf:resource=\"http://purl.org/dc/dcmitype/StillImage\" />\r\n        <dc:title />\r\n      </cc:Work>\r\n    </rdf:RDF>\r\n  </metadata>\r\n  <g\r\n     inkscape:label=\"Layer 1\"\r\n     inkscape:groupmode=\"layer\"\r\n     id=\"layer1\"\r\n     transform=\"translate(0,-540.36218)\">\r\n    <ellipse\r\n       style=\"opacity:0.79203539;fill:url(#linearGradient5588);fill-opacity:1;stroke:#3c3c3c;stroke-width:1.1393038;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1\"\r\n       id=\"path3171-8\"\r\n       cx=\"240.32063\"\r\n       cy=\"557.19836\"\r\n       rx=\"14.353489\"\r\n       ry=\"14.165989\" />\r\n    <flowRoot\r\n       xml:space=\"preserve\"\r\n       id=\"flowRoot5564\"\r\n       style=\"font-style:normal;font-weight:normal;line-height:0.01%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none\"\r\n       transform=\"matrix(0.64571833,0,0,0.61432912,8.6966653,558.72048)\"><flowRegion\r\n         id=\"flowRegion5566\"\r\n         style=\"font-family:sans-serif\"><rect\r\n           id=\"rect5568\"\r\n           width=\"78.749992\"\r\n           height=\"72.5\"\r\n           x=\"346.24997\"\r\n           y=\"-21.999973\"\r\n           style=\"font-family:sans-serif\" /></flowRegion><flowPara\r\n         id=\"flowPara5570\"\r\n         style=\"font-weight:bold;font-size:40px;line-height:1.25;font-family:sans-serif;-inkscape-font-specification:'Sans Bold'\">?</flowPara></flowRoot>\r\n    <path\r\n       style=\"fill:none;stroke:#ec6900;stroke-width:4.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;marker-mid:none;marker-end:none\"\r\n       d=\"m 187.1235,559.26606 c -3.71166,-5.87882 -12.04056,-10.0009 -18.86169,0.34701\"\r\n       id=\"path4144-1\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\" />\r\n    <path\r\n       style=\"fill:#ec6900;fill-opacity:1;stroke:none;stroke-width:0.001;stroke-miterlimit:4;stroke-dasharray:none\"\r\n       d=\"m 170.01417,560.40163 2.05175,2.63036 -9.89352,4.33226 2.83717,-13.08504 z\"\r\n       id=\"path5370-7\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <path\r\n       style=\"fill:none;stroke:#1f9000;stroke-width:4.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;marker-mid:none;marker-end:none\"\r\n       d=\"m 197.1805,559.70121 c 3.69186,-5.88365 11.97631,-10.00911 18.76103,0.3473\"\r\n       id=\"path4144-1-9\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\" />\r\n    <path\r\n       style=\"fill:#1f9000;fill-opacity:1;stroke:none\"\r\n       d=\"m 213.95021,560.59037 -2.0408,2.63252 9.84072,4.33582 -2.82203,-13.09579 z\"\r\n       id=\"path5370-7-4\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <rect\r\n       style=\"fill:#000000;fill-opacity:1;stroke:none\"\r\n       id=\"rect3224\"\r\n       width=\"23.641272\"\r\n       height=\"8.4057856\"\r\n       x=\"487.73776\"\r\n       y=\"552.41565\" />\r\n    <path\r\n       style=\"fill:none;stroke:#000000;stroke-width:5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"M 498.18023,567.81152 484.7754,556.20378 498.93081,545.77569\"\r\n       id=\"path4074\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccc\" />\r\n    <path\r\n       style=\"fill:#000000;fill-opacity:1;stroke:none\"\r\n       d=\"m 17.866009,585.82436 -0.09,-4.53232 -14.5167501,7.49748 14.5683701,7.84238 z\"\r\n       id=\"path5370-5-0-6-5\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <path\r\n       style=\"fill:#000000;fill-opacity:1;stroke:none\"\r\n       d=\"m 46.366429,592.31275 0.0109,4.6129 14.90287,-7.37024 -14.68289,-8.23782 z\"\r\n       id=\"path5370-5-1-2\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <rect\r\n       style=\"opacity:0.94690265;fill:#000000;fill-opacity:1;stroke:none\"\r\n       id=\"rect5558-3-3\"\r\n       width=\"10.726034\"\r\n       height=\"5.6689787\"\r\n       x=\"-3.0812507\"\r\n       y=\"587.85645\"\r\n       transform=\"matrix(1,0,0.06880209,0.99763033,0,0)\" />\r\n    <rect\r\n       style=\"opacity:0.94690265;fill:#000000;fill-opacity:1;stroke:none\"\r\n       id=\"rect5558-1\"\r\n       width=\"10.540748\"\r\n       height=\"5.5710502\"\r\n       x=\"-22.93788\"\r\n       y=\"587.9295\"\r\n       transform=\"matrix(1,0,0.06880209,0.99763033,0,0)\" />\r\n    <path\r\n       style=\"fill:#2e2e2e;fill-opacity:1;stroke:none;stroke-width:0.685581\"\r\n       d=\"m 71.46269,592.27473 0.01481,6.27371 20.268436,-10.02379 -19.969263,-11.20374 z\"\r\n       id=\"path5370-5-1-2-1\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <path\r\n       style=\"fill:#2e2e2e;fill-opacity:1;stroke:none;stroke-width:0.685581\"\r\n       d=\"m 108.87703,578.56977 -6.27262,0.11779 10.35514,20.10117 10.87444,-20.15049 z\"\r\n       id=\"path5370-5-1-2-1-7\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <path\r\n       style=\"fill:#000000;fill-opacity:1;stroke:#363636;stroke-width:2.23946524;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 69.769603,567.95981 5.60449,-5.39601\"\r\n       id=\"path5452-5-5-1-7\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\"\r\n       inkscape:transform-center-x=\"3.061478\"\r\n       inkscape:transform-center-y=\"-0.63275351\" />\r\n    <path\r\n       style=\"fill:#000000;fill-opacity:1;stroke:#363636;stroke-width:2.23946524;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 75.172083,567.8747 -5.47097,-5.53134\"\r\n       id=\"path5452-5-5-1-7-4\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\"\r\n       inkscape:transform-center-x=\"3.196728\"\r\n       inkscape:transform-center-y=\"-0.78552851\" />\r\n    <path\r\n       style=\"fill:#ffe87e;fill-opacity:1;stroke:#a58000;stroke-width:1.02573335px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 36.512525,599.08328 -0.0847,-15.30469 14.76623,-0.079 1.13455,-5.3121 h 6.7663 l 0.52197,5.56549 h 2.38874 l -0.0349,15.41642 z\"\r\n       id=\"path4607\"\r\n       inkscape:path-effect=\"#path-effect4609\"\r\n       inkscape:original-d=\"m 36.512525,599.08328 -0.0847,-15.30469 14.76623,-0.079 1.13455,-5.3121 h 6.7663 l 0.52197,5.56549 h 2.38874 l -0.0349,15.41642 z\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccccccccc\"\r\n       transform=\"translate(-33.065965,-31.819347)\" />\r\n    <path\r\n       style=\"fill:#dfc449;fill-opacity:1;stroke:#a58000;stroke-width:1.04236829px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 38.651325,583.64804 2.27904,-5.34039 8.11475,0.19058 1.53729,4.93611 z\"\r\n       id=\"path5463\"\r\n       inkscape:path-effect=\"#path-effect5465\"\r\n       inkscape:original-d=\"m 38.651325,583.64804 2.27904,-5.34039 8.11475,0.19058 1.53729,4.93611 z\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccccc\"\r\n       transform=\"translate(-33.065965,-31.819347)\" />\r\n    <path\r\n       style=\"fill:#d7f0fb;fill-opacity:1;stroke:#4f4f4f;stroke-width:1.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;stroke-miterlimit:4;stroke-dasharray:none\"\r\n       d=\"m 71.789265,599.90744 0.17512,-24.69199 h 15.41061 l 4.378,4.90337 0.17513,19.96374 z\"\r\n       id=\"path3262\"\r\n       inkscape:path-effect=\"#path-effect3264\"\r\n       inkscape:original-d=\"m 71.789265,599.90744 0.17512,-24.69199 h 15.41061 l 4.378,4.90337 0.17513,19.96374 z\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cccccc\"\r\n       transform=\"translate(-33.561281,-31.819347)\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 73.190225,596.58015 16.81157,-0.35024\"\r\n       id=\"path4106\"\r\n       inkscape:path-effect=\"#path-effect4108\"\r\n       inkscape:original-d=\"m 73.190225,596.58015 16.81157,-0.35024\"\r\n       inkscape:connector-curvature=\"0\"\r\n       transform=\"translate(-33.561281,-31.819347)\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 73.540465,591.50166 16.81157,-0.35024\"\r\n       id=\"path4106-7\"\r\n       inkscape:path-effect=\"#path-effect4108-1\"\r\n       inkscape:original-d=\"m 73.540465,591.50166 16.81157,-0.35024\"\r\n       inkscape:connector-curvature=\"0\"\r\n       transform=\"translate(-33.561281,-31.819347)\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 73.365345,586.59829 16.81157,-0.35024\"\r\n       id=\"path4106-0\"\r\n       inkscape:path-effect=\"#path-effect4108-4\"\r\n       inkscape:original-d=\"m 73.365345,586.59829 16.81157,-0.35024\"\r\n       inkscape:connector-curvature=\"0\"\r\n       transform=\"translate(-33.561281,-31.819347)\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 73.365345,582.22027 16.81157,-0.35024\"\r\n       id=\"path4106-4\"\r\n       inkscape:path-effect=\"#path-effect4108-9\"\r\n       inkscape:original-d=\"m 73.365345,582.22027 16.81157,-0.35024\"\r\n       inkscape:connector-curvature=\"0\"\r\n       transform=\"translate(-33.561281,-31.819347)\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#f1f1f1;stroke-width:4.65793133;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 103.19489,558.19446 16.18158,0.0627\"\r\n       id=\"path5452-5-5-1-7-7\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\"\r\n       inkscape:transform-center-x=\"3.6534509\"\r\n       inkscape:transform-center-y=\"-5.3788766\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#f4f4f4;stroke-width:4.65793133;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 111.38254,565.89244 -0.15492,-16.18101\"\r\n       id=\"path5452-5-5-1-7-4-4\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\"\r\n       inkscape:transform-center-x=\"3.6340509\"\r\n       inkscape:transform-center-y=\"-5.8027516\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#f1f1f1;stroke-width:4.54087734;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 135.53124,558.66024 15.77493,0.0612\"\r\n       id=\"path5452-5-5-1-7-7-1\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\"\r\n       inkscape:transform-center-x=\"3.561639\"\r\n       inkscape:transform-center-y=\"-5.2436726\" />\r\n    <path\r\n       style=\"fill:#bfbfbf;fill-opacity:1;stroke:#ffffff;stroke-width:1.39999998;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 273.79736,565.92624 4.84986,4.15066 7.44379,-12.0346 -3.26109,-1.20718 -4.82074,8.91974 -2.46038,-2.39761 z\"\r\n       id=\"path1157\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccccccc\" />\r\n    <path\r\n       style=\"fill:#ff9d00;fill-opacity:1;stroke:#808080;stroke-width:0.78749156px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 306.19903,566.65065 4.84985,4.15066 7.4438,-12.0346 -3.26109,-1.20718 -4.82075,8.91974 -2.46037,-2.39761 z\"\r\n       id=\"path1157-6\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccccccc\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:4.85740042;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 419.41366,537.85807 12.87326,7.64338 12.79438,-7.33068\"\r\n       id=\"path1585\"\r\n       inkscape:connector-curvature=\"0\"\r\n       inkscape:path-effect=\"#path-effect1587\"\r\n       inkscape:original-d=\"m 419.41366,537.85807 12.87326,7.64338 c 4.40656,-2.37267 3.01422,-8.5404 12.79438,-7.33068\"\r\n       sodipodi:nodetypes=\"ccc\"\r\n       transform=\"matrix(0.82348572,0,0,0.82348572,75.604975,111.95505)\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:4.85740042;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 419.41366,537.85807 12.87326,7.64338 12.79438,-7.33068\"\r\n       id=\"path1585-6\"\r\n       inkscape:connector-curvature=\"0\"\r\n       inkscape:path-effect=\"#path-effect1587-6\"\r\n       inkscape:original-d=\"m 419.41366,537.85807 12.87326,7.64338 c 4.40656,-2.37267 3.01422,-8.5404 12.79438,-7.33068\"\r\n       sodipodi:nodetypes=\"ccc\"\r\n       transform=\"matrix(-0.82326686,0.01898429,-0.01898429,-0.82326686,829.82733,995.45395)\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#ffffff;stroke-width:1.4972775px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 325.7796,560.88703 9.22114,7.89176 14.15308,-22.88169 -6.20039,-2.29524 -9.16581,16.95932 -4.67796,-4.55863 z\"\r\n       id=\"path1157-6-7\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccccccc\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:none\"\r\n       d=\"m 338.27455,603.35315 -4.55847,-12.13972 -4.42325,4.14941 0.29119,-21.42993 14.0532,13.84869 -5.29334,1.40046 4.98485,11.66133 z\"\r\n       id=\"path4192-0\"\r\n       inkscape:path-effect=\"#path-effect4194-5\"\r\n       inkscape:original-d=\"m 338.27455,603.35315 -4.55847,-12.13972 -4.42325,4.14941 0.29119,-21.42993 14.0532,13.84869 -5.29334,1.40046 c 11.73953,18.68506 2.52594,6.89719 4.98485,11.66133 z\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cccccccc\"\r\n       transform=\"rotate(-9.319008,159.52768,371.93318)\" />\r\n    <text\r\n       xml:space=\"preserve\"\r\n       style=\"font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:17.712px;line-height:0%;font-family:'MV Boli';-inkscape-font-specification:'MV Boli';letter-spacing:0px;word-spacing:0px;fill:#ffdc00;fill-opacity:1;stroke:none;stroke-width:1.476\"\r\n       x=\"179.14906\"\r\n       y=\"751.84772\"\r\n       id=\"text3255-0\"\r\n       transform=\"matrix(1.2141217,-0.1513943,0.23126622,0.79480305,0,0)\"><tspan\r\n         sodipodi:role=\"line\"\r\n         id=\"tspan3257-0\"\r\n         x=\"179.14906\"\r\n         y=\"751.84772\"\r\n         style=\"font-size:44.4154px;line-height:1.25;stroke-width:1.476\">!</tspan></text>\r\n    <text\r\n       xml:space=\"preserve\"\r\n       style=\"font-style:normal;font-weight:normal;font-size:32.4516px;line-height:1.25;font-family:sans-serif;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.81129\"\r\n       x=\"131.62856\"\r\n       y=\"599.63672\"\r\n       id=\"text1309\"><tspan\r\n         sodipodi:role=\"line\"\r\n         id=\"tspan1307\"\r\n         x=\"131.62856\"\r\n         y=\"599.63672\"\r\n         style=\"font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:sans-serif;-inkscape-font-specification:'sans-serif Bold';stroke-width:0.81129\">B</tspan></text>\r\n    <text\r\n       id=\"text1309-2\"\r\n       y=\"658.43152\"\r\n       x=\"153.61592\"\r\n       style=\"font-style:normal;font-weight:normal;font-size:41.6588px;line-height:1.25;font-family:sans-serif;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.04147\"\r\n       xml:space=\"preserve\"\r\n       transform=\"scale(1.0962314,0.91221617)\"><tspan\r\n         style=\"font-style:italic;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:serif;-inkscape-font-specification:'serif Bold Italic';stroke-width:1.04147\"\r\n         y=\"658.43152\"\r\n         x=\"153.61592\"\r\n         id=\"tspan1307-4\"\r\n         sodipodi:role=\"line\">i</tspan></text>\r\n    <text\r\n       xml:space=\"preserve\"\r\n       style=\"font-style:normal;font-weight:normal;font-size:38.431px;line-height:1.25;font-family:sans-serif;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.960773\"\r\n       x=\"264.23669\"\r\n       y=\"522.23657\"\r\n       id=\"text1309-0-9\"\r\n       transform=\"scale(0.87011438,1.1492742)\"><tspan\r\n         sodipodi:role=\"line\"\r\n         id=\"tspan1307-3-4\"\r\n         x=\"264.23669\"\r\n         y=\"522.23657\"\r\n         style=\"font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:sans-serif;-inkscape-font-specification:'sans-serif Bold';stroke-width:0.960773\"><tspan\r\n           style=\"font-weight:normal;stroke-width:0.960773\"\r\n           id=\"tspan1365\">s</tspan></tspan></text>\r\n    <text\r\n       xml:space=\"preserve\"\r\n       style=\"font-style:normal;font-weight:normal;font-size:31.7797px;line-height:1.25;font-family:sans-serif;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.794494\"\r\n       x=\"195.07664\"\r\n       y=\"596.5979\"\r\n       id=\"text1309-0-2\"\r\n       transform=\"scale(0.99519471,1.0048285)\"><tspan\r\n         sodipodi:role=\"line\"\r\n         id=\"tspan1307-3-1\"\r\n         x=\"195.07664\"\r\n         y=\"596.5979\"\r\n         style=\"font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:sans-serif;-inkscape-font-specification:'sans-serif Bold';stroke-width:0.794494\">U</tspan></text>\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:3.47724;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 194.05959,600.03363 25.702,0.14808\"\r\n       id=\"path1375\" />\r\n    <path\r\n       id=\"path1375-2\"\r\n       d=\"m 227.04774,587.38832 25.63991,0.14772\"\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:3.46884;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       inkscape:transform-center-x=\"1.1856386\"\r\n       inkscape:transform-center-y=\"-0.33875464\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#484848;stroke-width:1.623;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 262.93706,592.38036 0.0134,5.70131 18.41916,-9.10923 -18.14729,-10.18151 z\"\r\n       id=\"path5370-5-1-2-1-4\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <path\r\n       inkscape:connector-curvature=\"0\"\r\n       id=\"path5370-5-1-2-1-4-0\"\r\n       d=\"m 301.44451,581.20782 -5.70129,0.0197 9.12976,18.40899 10.16128,-18.15862 z\"\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#484848;stroke-width:1.623;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\" />\r\n    <ellipse\r\n       style=\"fill:none;stroke:#242424;stroke-width:2.80047;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:20;stroke-opacity:1\"\r\n       id=\"path1040\"\r\n       ry=\"8.7032747\"\r\n       rx=\"8.4312963\"\r\n       cy=\"583.49023\"\r\n       cx=\"331.71524\" />\r\n    <path\r\n       style=\"fill:none;stroke:#242424;stroke-width:6;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 336.4644,589.47097 10.10632,10.66173\"\r\n       id=\"path1042\"\r\n       sodipodi:nodetypes=\"cc\" />\r\n    <path\r\n       style=\"fill:none;stroke:#242424;stroke-width:2.17621;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 325.36075,583.26941 12.63506,0.34484\"\r\n       id=\"path1044\" />\r\n    <ellipse\r\n       cx=\"364.00839\"\r\n       cy=\"584.36328\"\r\n       rx=\"9.6165609\"\r\n       ry=\"9.9267731\"\r\n       id=\"path1040-0\"\r\n       style=\"fill:none;stroke:#242424;stroke-width:3.19416;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:20;stroke-opacity:1\" />\r\n    <path\r\n       sodipodi:nodetypes=\"cc\"\r\n       id=\"path1042-6\"\r\n       d=\"m 369.73697,590.7899 10.89694,10.89694\"\r\n       style=\"fill:none;stroke:#242424;stroke-width:6;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\" />\r\n    <path\r\n       id=\"path1044-4\"\r\n       d=\"m 357.64269,584.09303 12.63506,0.34484\"\r\n       style=\"fill:none;stroke:#242424;stroke-width:2.17621;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\" />\r\n    <path\r\n       style=\"fill:none;stroke:#242424;stroke-width:2.17621;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 363.94156,590.78154 0.20796,-12.63806\"\r\n       id=\"path1044-4-9\" />\r\n  </g>\r\n</svg>\r\n`.trim();\r\n\r\ntext = btoa(text);\r\nexport let iconSvg = `data:image/svg+xml;base64,` + text;","\"use strict\";\r\n\r\nimport {iconSvg} from './iconsheet.js';\r\n\r\nexport const Icons = {\r\n  FOLDER        : 0, //file folder\r\n  FILE          : 1,\r\n  TINY_X        : 2, //'x' in bottom left corner\r\n  SMALL_PLUS    : 3,\r\n  SMALL_MINUS   : 4,\r\n  UNDO          : 5,\r\n  REDO          : 6,\r\n  HELP          : 7,\r\n  ENUM_UNCHECKED: 8, //overlaid on icon checkboxes when unchecked\r\n  ENUM_CHECKED  : 9, //overlaid on icon checkboxes when checked\r\n  LARGE_CHECK   : 10, //default check mark for non-icon checkboxes\r\n  CURSOR_ARROW  : 11,\r\n  NOTE_EXCL     : 12, //notification exclamation mark\r\n  SCROLL_DOWN   : 13,\r\n  SCROLL_UP     : 14,\r\n  BACKSPACE     : 15,\r\n  LEFT_ARROW    : 16,\r\n  RIGHT_ARROW   : 17,\r\n  UI_EXPAND     : 18, //triangle\r\n  UI_COLLAPSE   : 19, //triangle\r\n  BOLD          : 20,\r\n  ITALIC        : 21,\r\n  UNDERLINE     : 22,\r\n  STRIKETHRU    : 23,\r\n  TREE_EXPAND   : 24,\r\n  TREE_COLLAPSE : 25,\r\n  ZOOM_OUT      : 26,\r\n  ZOOM_IN       : 27\r\n};\r\n\r\nexport function loadDefaultIconSheet() {\r\n  let iconSheet = document.createElement(\"img\");\r\n  iconSheet.src = iconSvg;\r\n\r\n  return iconSheet;\r\n}\r\n\r\n\r\n","import nstructjs from '../path-controller/util/struct.js';\r\n\r\nimport {UIBase} from '../core/ui_base.js';\r\n\r\nexport class FileHeader {\r\n  constructor(version, magic, flags) {\r\n    this.magic = magic;\r\n    this.flags = flags;\r\n    this.version_major = version ? version[0] : 0;\r\n    this.version_minor = version ? version[1] : 0;\r\n    this.version_micro = version ? version[2] : 0;\r\n    this.schema = nstructjs.write_scripts();\r\n  }\r\n}\r\n\r\nFileHeader.STRUCT = `\r\nsimple.FileHeader {\r\n  magic         : static_string[4];\r\n  version_major : short;\r\n  version_minor : short;\r\n  version_micro : short;\r\n  flags         : short;\r\n  schema        : string; \r\n}\r\n`;\r\nnstructjs.register(FileHeader);\r\n\r\nexport class FileFull extends FileHeader {\r\n  constructor(version, magic, flags) {\r\n    super(version, magic, flags);\r\n    this.objects = [];\r\n  }\r\n}\r\n\r\nFileFull.STRUCT = nstructjs.inherit(FileFull, FileHeader) + `\r\n  objects : array(abstract(Object));\r\n  screen  : abstract(Object);\r\n}\r\n`;\r\nnstructjs.register(FileFull);\r\n\r\n\r\nexport class FileArgs {\r\n  constructor(args = {}) {\r\n    this.ext = args.ext || \".data\";\r\n    this.magic = args.magic || \"STRT\";\r\n    this.doScreen = args.doScreen !== undefined ? args.doScreen : true;\r\n    this.resetOnLoad = args.resetOnLoad !== undefined ? args.resetOnLoad : true;\r\n    this.useJSON = args.useJSON !== undefined ? args.useJSON : false;\r\n    this.version = args.version !== undefined ? args.version : 0;\r\n    this.fileFlags = args.fileFlags !== undefined ? args.fileFlags : 0;\r\n    this.fromFileOp = false; /* SimpleSaveOp and SimpleOpenOp set this to true */\r\n  }\r\n}\r\n\r\nexport class EmptyStruct {\r\n\r\n}\r\nEmptyStruct.STRUCT = `\r\nEmptyStruct {\r\n}\r\n`;\r\nnstructjs.register(EmptyStruct);\r\n\r\nexport function saveFile(appstate, args, objects) {\r\n  if (args.useJSON === undefined) {\r\n    args.useJSON = appstate.saveFilesInJSON;\r\n  }\r\n\r\n  args = new FileArgs(args);\r\n\r\n  let version = args.version;\r\n  if (typeof version === \"number\") {\r\n    if (version === Math.floor(version)) {\r\n      version = [version, 0, 0];\r\n    } else {\r\n      let major = ~~version;\r\n      let minor = ~~(Math.fract(version)*10.0);\r\n      let micro = (Math.fract(version) - minor) * 100.0;\r\n\r\n      version = [major, minor, micro];\r\n    }\r\n  }\r\n\r\n  let file = new FileFull(version, args.magic, args.fileFlags);\r\n\r\n  if (args.doScreen) {\r\n    file.screen = appstate.screen;\r\n  } else {\r\n    file.screen = new EmptyStruct();\r\n  }\r\n\r\n  for (let ob of objects) {\r\n    file.objects.push(ob);\r\n  }\r\n\r\n  if (args.useJSON) {\r\n    return nstructjs.writeJSON(file);\r\n  } else {\r\n    let data = [];\r\n    nstructjs.writeObject(data, file);\r\n    return (new Uint8Array(data)).buffer;\r\n  }\r\n}\r\n\r\nexport function loadFile(appstate, args, data) {\r\n  let header;\r\n\r\n  if (args.useJSON === undefined) {\r\n    args.useJSON = appstate.saveFilesInJSON;\r\n  }\r\n\r\n  args = new FileArgs(args);\r\n\r\n  if (!args.useJSON) {\r\n    if (data instanceof Array) {\r\n      data = (new Uint8Array(data)).buffer;\r\n    }\r\n\r\n    if (data instanceof Uint8Array) {\r\n      data = data.buffer;\r\n    }\r\n\r\n    if (data instanceof ArrayBuffer) {\r\n      data = new DataView(data);\r\n    }\r\n\r\n    header = nstructjs.readObject(data, FileHeader);\r\n  } else {\r\n    if (typeof data === \"string\") {\r\n      data = JSON.parse(data);\r\n    }\r\n\r\n    header = nstructjs.readJSON(data, FileHeader);\r\n  }\r\n\r\n  if (header.magic !== args.magic) {\r\n    throw new Error(\"invalid file\");\r\n  }\r\n\r\n  let istruct = new nstructjs.STRUCT();\r\n  istruct.parse_structs(header.schema);\r\n\r\n  let ret;\r\n\r\n  if (!args.useJSON) {\r\n    ret = istruct.readObject(data, FileFull);\r\n  } else {\r\n    ret = istruct.readJSON(data, FileFull);\r\n  }\r\n\r\n  if (args.resetOnLoad) {\r\n    appstate.reset();\r\n  }\r\n\r\n  if (args.doScreen) {\r\n    if (appstate.screen) {\r\n      appstate.screen.unlisten();\r\n      appstate.screen.remove();\r\n    }\r\n\r\n    ret.screen.ctx = appstate.ctx;\r\n\r\n    if (!(ret.screen instanceof appstate.screenClass)) {\r\n      let screen = UIBase.createElement(appstate.screenClass.define().tagname);\r\n      screen.ctx = appstate.ctx;\r\n\r\n      for (let sarea of ret.screen.sareas) {\r\n        screen.appendChild(sarea);\r\n\r\n        sarea.area.afterSTRUCT();\r\n        sarea.area.on_fileload();\r\n      }\r\n\r\n      ret.screen = screen;\r\n    }\r\n\r\n    appstate.screen = ret.screen;\r\n\r\n    document.body.appendChild(appstate.screen);\r\n    appstate.screen.listen();\r\n  }\r\n\r\n  return ret;\r\n}","import {Editor} from './editor.js';\r\nimport {UIBase} from '../core/ui_base.js';\r\nimport {nstructjs} from '../path-controller/controller.js';\r\nimport {AreaFlags} from '../screen/ScreenArea.js';\r\n\r\n/** see ./editor.js:Editor.registerAppMenu */\r\n\r\nexport class MenuBarEditor extends Editor {\r\n  constructor() {\r\n    super();\r\n\r\n    this.updateHeight();\r\n    this.borderLock = 1 | 2 | 4 | 8;\r\n    this.areaDragToolEnabled = false;\r\n\r\n    this._height = 25;\r\n\r\n    this.needsRebuild = false;\r\n  }\r\n\r\n  get height() {\r\n    return this._height;\r\n  }\r\n\r\n  set height(v) {\r\n    this._height = v;\r\n    this.updateHeight();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname : \"simple-menu-editor-x\",\r\n      areaname: \"menu\",\r\n      uiname  : \"Menu Bar\",\r\n      icon    : -1,\r\n      //hide in editor list\r\n      flag    : AreaFlags.HIDDEN | AreaFlags.NO_HEADER_CONTEXT_MENU | AreaFlags.NO_COLLAPSE | AreaFlags.NO_SWITCHER\r\n    }\r\n  }\r\n\r\n  updateHeight(force = false) {\r\n    if (!this.header)\r\n      return;\r\n\r\n    if (window.haveElectron) {\r\n      this.maxSize[1] = this.minSize[1] = 1;\r\n      electron_api.initMenuBar(this);\r\n      return;\r\n    }\r\n\r\n    if (this._height === undefined) {\r\n      let rect = this.header.getClientRects()[0];\r\n\r\n      if (rect) {\r\n        this._height = rect.height;\r\n      }\r\n    }\r\n\r\n    let update = force || this._height !== this.minSize[1];\r\n    this.minSize[1] = this.maxSize[1] = this._height;\r\n\r\n    if (update && this.ctx && this.getScreen()) {\r\n      this.getScreen().solveAreaConstraints();\r\n    }\r\n  }\r\n\r\n  makeMenuBar(container) {\r\n    if (Editor.makeMenuBar) {\r\n      Editor.makeMenuBar(this.ctx, container, this);\r\n    }\r\n  }\r\n\r\n  flagRebuild() {\r\n    this.needsRebuild = true;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.background = this.getDefault(\"AreaHeaderBG\");\r\n\r\n    this.menuRow = this.header.row();\r\n    this.makeMenuBar(this.menuRow);\r\n\r\n    this.doOnce(() => {\r\n      if (window.haveElectron) {\r\n        this.height = 1;\r\n        electron_api.initMenuBar(this);\r\n      }\r\n    });\r\n\r\n    this.updateHeight(true);\r\n    this.flushUpdate();\r\n  }\r\n\r\n  rebuild() {\r\n    this.needsRebuild = false;\r\n\r\n    this.menuRow.clear();\r\n    this.makeMenuBar(this.menuRow);\r\n    this.flushUpdate();\r\n  }\r\n\r\n  update() {\r\n    if (this.needsRebuild) {\r\n      this.rebuild();\r\n    }\r\n  }\r\n}\r\n\r\nMenuBarEditor.STRUCT = nstructjs.inherit(MenuBarEditor, Editor, \"MenuBarEditor\") + `\r\n}\r\n`;\r\n\r\nexport function registerMenuBarEditor() {\r\n  Editor.register(MenuBarEditor);\r\n}\r\n","import * as platform from '../platforms/platform.js';\r\n\r\nimport {ToolOp, UndoFlags} from '../path-controller/toolsys/toolsys.js';\r\nimport {ToolProperty, BoolProperty, StringProperty} from '../path-controller/toolsys/toolprop.js';\r\n\r\nimport {sendNote, error, warning, message} from '../widgets/ui_noteframe.js';\r\n\r\nexport class SimpleAppNewOp extends ToolOp {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : \"New\",\r\n      toolpath: \"app.new\",\r\n      inputs  : {},\r\n      undoflag: UndoFlags.NO_UNDO\r\n    }\r\n  }\r\n\r\n  exec(ctx) {\r\n    _appstate.createNewFile();\r\n  }\r\n}\r\n\r\nexport class SimpleAppSaveOp extends ToolOp {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : \"Save\",\r\n      toolpath: \"app.save\",\r\n      inputs  : {\r\n        forceDialog: new BoolProperty()\r\n      },\r\n      undoflag: UndoFlags.NO_UNDO\r\n    }\r\n  }\r\n\r\n  exec(ctx) {\r\n    let ext = _appstate.fileExt;\r\n    let useJSON = _appstate.startArgs.saveFilesInJSON;\r\n\r\n    _appstate.saveFile({\r\n      doScreen  : true,\r\n      useJSON,\r\n      fromFileOp: true\r\n    }).then(data => {\r\n\r\n      function save() {\r\n        return data;\r\n      }\r\n\r\n      platform.platform.showSaveDialog(\"Save As\", save, {\r\n        multi          : false,\r\n        addToRecentList: true,\r\n        filters        : [{\r\n          name      : \"File\",\r\n          mime      : useJSON ? \"text/json\" : \"application/x-octet-stream\",\r\n          extensions: [\".\" + ext.toLowerCase()]\r\n        }]\r\n      }).then(path => {\r\n        _appstate.currentFileRef = path;\r\n        message(\"File saved\");\r\n      }).catch(err => {\r\n        if (typeof err === \"object\" && err.message) {\r\n          err = err.message;\r\n        }\r\n\r\n        error(\"Failed to save file \" + err);\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\nexport class SimpleAppOpenOp extends ToolOp {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : \"Open\",\r\n      toolpath: \"app.open\",\r\n      inputs  : {\r\n        forceDialog: new BoolProperty()\r\n      },\r\n      undoflag: UndoFlags.NO_UNDO\r\n    }\r\n  }\r\n\r\n  exec(ctx) {\r\n    let ext = _appstate.fileExt;\r\n    let useJSON = _appstate.startArgs.saveFilesInJSON;\r\n    let mime = useJSON ? \"text/json\" : \"application/x-octet-stream\";\r\n\r\n    platform.platform.showOpenDialog(\"Open File\", {\r\n      multi          : false,\r\n      addToRecentList: true,\r\n      filters        : [{\r\n        name      : \"File\",\r\n        mime,\r\n        extensions: [\".\" + ext.toLowerCase()]\r\n      }]\r\n    }).then(paths => {\r\n      for (let path of paths) {\r\n        platform.platform.readFile(path, mime).then(data => {\r\n          console.log(\"got data!\", data);\r\n\r\n          _appstate.loadFile(data, {useJSON, doScreen: true, fromFileOp: true})\r\n            .catch(err => {\r\n              error(\"File error: \" + err.message);\r\n            });\r\n        });\r\n      }\r\n    }).catch(error => {\r\n      ctx.error(error.message);\r\n    })\r\n  }\r\n}\r\n\r\nexport function register() {\r\n  ToolOp.register(SimpleAppSaveOp);\r\n  ToolOp.register(SimpleAppOpenOp);\r\n  ToolOp.register(SimpleAppNewOp);\r\n}\r\n","import nstructjs from '../path-controller/util/struct.js';\r\nimport {Context, ContextOverlay, makeDerivedOverlay} from '../path-controller/controller/context.js';\r\n\r\nexport const DataModelClasses = [];\r\nimport {buildToolSysAPI, SavedToolDefaults, ToolStack} from '../path-controller/toolsys/toolsys.js';\r\nimport {DataAPI} from '../path-controller/controller/controller.js';\r\nimport {Screen} from '../screen/FrameManager.js';\r\nimport {areaclasses} from '../screen/area_wrangler.js';\r\nimport * as util from '../util/util.js';\r\nimport {Editor} from './editor.js';\r\n\r\nimport {Vector2} from '../path-controller/util/vectormath.js';\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nexport class DataModel {\r\n  static defineAPI(api, strct) {\r\n    return strct;\r\n  }\r\n\r\n  /** Automatically registers cls with nstructjs\r\n   *  and handles STRUCT inheritance.\r\n   */\r\n  static register(cls) {\r\n    if (!cls.hasOwnProperty(\"defineAPI\")) {\r\n      //  throw new Error(cls.name + \"is missing a defineAPI method\");\r\n    }\r\n\r\n    DataModelClasses.push(cls);\r\n\r\n    if (cls.hasOwnProperty(\"STRUCT\") && !nstructjs.isRegistered(cls)) {\r\n      cls.STRUCT = nstructjs.inlineRegister(cls, cls.STRUCT);\r\n    }\r\n  }\r\n}\r\n\r\nclass EmptyContextClass extends Context {\r\n  static defineAPI(api, strct) {\r\n  }\r\n}\r\n\r\nimport * as ui_noteframe from '../widgets/ui_noteframe.js';\r\n\r\n/**\r\n * Extend the client-provided context class\r\n * with a few standard methods and properties\r\n *\r\n * */\r\nfunction GetContextClass(ctxClass) {\r\n  let ok = 0;\r\n  let cls = ctxClass;\r\n  while (cls) {\r\n    if (cls === Context) {\r\n      ok = 1;\r\n    } else if (cls === ContextOverlay) {\r\n      ok = 2;\r\n    }\r\n\r\n    cls = cls.__proto__;\r\n  }\r\n\r\n  if (ok === 1) {\r\n    return ctxClass;\r\n  }\r\n\r\n  let OverlayDerived;\r\n\r\n  if (ok === 2) {\r\n    OverlayDerived = ctxClass;\r\n  } else {\r\n    OverlayDerived = makeDerivedOverlay(ctxClass);\r\n  }\r\n\r\n  class Overlay extends OverlayDerived {\r\n    constructor(state) {\r\n      super(state);\r\n    }\r\n\r\n    get screen() {\r\n      return this.state.screen;\r\n    }\r\n\r\n    get api() {\r\n      return this.state.api;\r\n    }\r\n\r\n    get toolstack() {\r\n      return this.state.toolstack;\r\n    }\r\n\r\n    get toolDefaults() {\r\n      return SavedToolDefaults;\r\n    }\r\n\r\n    get last_tool() {\r\n      return this.toolstack.head;\r\n    }\r\n\r\n    message(msg, timeout = 2500) {\r\n      return ui_noteframe.message(this.screen, msg, timeout);\r\n    }\r\n\r\n    error(msg, timeout = 2500) {\r\n      return ui_noteframe.error(this.screen, msg, timeout);\r\n    }\r\n\r\n    warning(msg, timeout = 2500) {\r\n      return ui_noteframe.warning(this.screen, msg, timeout);\r\n    }\r\n\r\n    progressBar(msg, percent, color, timeout = 1000) {\r\n      return ui_noteframe.progbarNote(this.screen, msg, percent, color, timeout);\r\n    }\r\n  }\r\n\r\n  Context.register(Overlay);\r\n\r\n  return class ContextDerived extends Context {\r\n    constructor(state) {\r\n      super(state);\r\n\r\n      this.pushOverlay(new Overlay(state))\r\n    }\r\n\r\n    static defineAPI(api, st) {\r\n      return Overlay.defineAPI(api, st);\r\n    }\r\n  }\r\n}\r\n\r\nexport function makeAPI(ctxClass) {\r\n  let api = new DataAPI();\r\n\r\n  for (let cls of DataModelClasses) {\r\n    if (cls.defineAPI) {\r\n      cls.defineAPI(api, api.mapStruct(cls, true));\r\n    }\r\n  }\r\n\r\n  for (let k in areaclasses) {\r\n    areaclasses[k].defineAPI(api, api.mapStruct(areaclasses[k], true));\r\n  }\r\n\r\n  if (ctxClass.defineAPI) {\r\n    ctxClass.defineAPI(api, api.mapStruct(ctxClass, true));\r\n  } else {\r\n    throw new Error(\"Context class should have a defineAPI static method\");\r\n  }\r\n\r\n  api.rootContextStruct = api.mapStruct(ctxClass, api.mapStruct(ctxClass, true));\r\n\r\n  buildToolSysAPI(api, false, api.rootContextStruct, ctxClass, true);\r\n\r\n  return api;\r\n}\r\n\r\nimport {Icons, loadDefaultIconSheet} from './icons.js';\r\nimport {IconManager, setIconManager, setIconMap, setTheme, UIBase} from '../core/ui_base.js';\r\nimport {FileArgs, loadFile, saveFile} from './file.js';\r\nimport {HotKey, KeyMap} from '../path-controller/util/simple_events.js';\r\nimport {initSplineTemplates} from '../path-controller/curve/curve1d_bspline.js';\r\nimport {MenuBarEditor, registerMenuBarEditor} from './menubar.js';\r\nimport {register} from './app_ops.js';\r\n\r\nexport class StartArgs {\r\n  constructor() {\r\n    this.singlePage = true;\r\n\r\n    this.DEBUG = {}\r\n    this.icons = Icons;\r\n    this.iconsheet = undefined; //will default to loadDefaultIconSheet();\r\n    this.iconSizes = [16, 24, 32, 48];\r\n    this.iconTileSize = 32;\r\n    this.iconsPerRow = 16;\r\n    this.theme = undefined; //see scripts/core/theme.js\r\n\r\n    this.registerSaveOpenOps = true;\r\n\r\n    this.autoLoadSplineTemplates = true;\r\n    this.showPathsInToolTips = true;\r\n    this.enableThemeAutoUpdate = false;\r\n    this.addHelpPickers = false;\r\n    this.useNumSliderTextboxes = true;\r\n    this.numSliderArrowLimit = cconst.numSliderArrowLimit;\r\n    this.simpleNumSliders = cconst.simpleNumSliders;\r\n  }\r\n}\r\n\r\nexport class SimpleScreen extends Screen {\r\n  constructor() {\r\n    super();\r\n\r\n    this.keymap = new KeyMap([\r\n      new HotKey(\"Z\", [\"CTRL\"], () => {\r\n        this.ctx.toolstack.undo(this.ctx);\r\n      }),\r\n      new HotKey(\"Z\", [\"CTRL\", \"SHIFT\"], () => {\r\n        this.ctx.toolstack.redo(this.ctx);\r\n      }),\r\n    ])\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"simple-screen-x\"\r\n    }\r\n  }\r\n\r\n  init() {\r\n    if (this.ctx.state.startArgs.registerSaveOpenOps) {\r\n      this.keymap.add(new HotKey(\"S\", [\"CTRL\"], \"app.save()\"));\r\n      this.keymap.add(new HotKey(\"O\", [\"CTRL\"], \"app.open()\"));\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.style[\"position\"] = UIBase.PositionKey;\r\n    this.style[\"left\"] = this.pos[0] + \"px\";\r\n    this.style[\"top\"] = this.pos[1] + \"px\";\r\n  }\r\n}\r\n\r\nUIBase.register(SimpleScreen);\r\n\r\nexport class AppState {\r\n  /** ctxClass is the context class.  It can be either a simple class\r\n   *  or a subclass of the more complex path.ux Context class.  Note that\r\n   *  using Context will avoid subtle undo stack errors caused by the context\r\n   *  changing after a tool is run (this is why Context has a serialization\r\n   *  mechanism).\r\n   *\r\n   *  Path.ux will actually subclass ctxClass and add a few standard methods\r\n   *  and properties, see GetContextClass.*/\r\n  constructor(ctxClass, screenClass = SimpleScreen) {\r\n    this._ctxClass = ctxClass;\r\n\r\n    ctxClass = GetContextClass(ctxClass);\r\n\r\n    this.startArgs = undefined;\r\n    this.currentFileRef = undefined; //current file path/ref\r\n\r\n    this.api = makeAPI(ctxClass);\r\n    this.ctx = new ctxClass(this);\r\n    this.ctx._state = this;\r\n    this.toolstack = new ToolStack();\r\n    this.screenClass = screenClass;\r\n    this.screen = undefined;\r\n\r\n    this.fileMagic = \"STRT\";\r\n    this.fileVersion = [0, 0, 1];\r\n    this._fileExt = \"data\";\r\n    this._fileExtSet = false;\r\n    this.saveFilesInJSON = false; /* save files in nstructjs-json */\r\n\r\n    this.defaultEditorClass = undefined; //if undefined, the first non-menubar editor will be used\r\n  }\r\n\r\n\r\n  get fileExt() {\r\n    return this._fileExt;\r\n  }\r\n\r\n  set fileExt(ext) {\r\n    this._fileExt = ext;\r\n    this._fileExtSet = true;\r\n  }\r\n\r\n  /** resets the undo stack */\r\n  reset() {\r\n    this.toolstack.reset();\r\n  }\r\n\r\n  /** Create a new file. See this.makeScreen() if you wish\r\n   *  to create a new screen at this time, and this.reset()\r\n   *  if you wish to reset the undo stack*/\r\n  createNewFile() {\r\n    console.warn(\"appstate.createNewFile: implement me, using default hack\");\r\n    let state = new this.constructor(this.ctx._ctxClass);\r\n\r\n    state.api = this.api;\r\n    state.ctx = this.ctx;\r\n    state.startArgs = this.startArgs;\r\n    state.saveFilesInJSON = this.saveFilesInJSON;\r\n\r\n    state.toolstack = this.toolstack;\r\n    state.toolstack.reset();\r\n\r\n    this.screen.unlisten();\r\n    this.screen.remove();\r\n\r\n    for (let k in state) {\r\n      this[k] = state[k];\r\n    }\r\n\r\n    this.makeScreen();\r\n  }\r\n\r\n  saveFileSync(objects, args = {}) {\r\n    args = new FileArgs(Object.assign({\r\n      magic  : this.fileMagic,\r\n      version: this.fileVersion,\r\n      ext    : this.fileExt\r\n    }, args));\r\n\r\n    return saveFile(this, args, objects);\r\n  }\r\n\r\n  /** Serialize the application state. Takes\r\n   *  a list of objects to save (with nstructjs);\r\n   *  Subclasses should override this, like so:\r\n   *\r\n   *  saveFile(args={}) {\r\n   *    let objects = app state;\r\n   *    return super.saveFile(objects, args);\r\n   *  }\r\n   **/\r\n  saveFile(objects, args = {}) {\r\n    args = new FileArgs(Object.assign({\r\n      magic  : this.fileMagic,\r\n      version: this.fileVersion,\r\n      ext    : this.fileExt\r\n    }, args));\r\n\r\n    return new Promise((accept, reject) => {\r\n      accept(this.saveFileSync(objects, args));\r\n    });\r\n  }\r\n\r\n  loadFileSync(data, args = {}) {\r\n    args = new FileArgs(Object.assign({\r\n      magic  : this.fileMagic,\r\n      version: this.fileVersion,\r\n      ext    : this.fileExt\r\n    }, args));\r\n\r\n    let ret = loadFile(this, args, data);\r\n\r\n    if (args.doScreen) {\r\n      try {\r\n        this.ensureMenuBar();\r\n      } catch (error) {\r\n        console.error(error.stack);\r\n        console.error(error.message);\r\n        console.error(\"Failed to add menu bar\");\r\n      }\r\n\r\n      this.screen.completeSetCSS();\r\n      this.screen.completeUpdate();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   *  Loads a new file. The default behavior is a\r\n   *  complete state reset (you can control this\r\n   *  with args.reset_toolstack, args.reset_context\r\n   *  and args.doScreen).\r\n   *\r\n   *  As the base class cannot know just what to do\r\n   *  with the loaded data (the objects parameter\r\n   *  passed to saveFile) it is recommended you\r\n   *  override this function like so:\r\n   *\r\n   *  loadFile(data, args) {\r\n   *    return super.loadFile(data, args).then(fileData) => {\r\n   *      // load fileData.objects into appropriate properties\r\n   *      // this is the same objects array originally passed\r\n   *      // to this.saveFile\r\n   *      this.data = fileData.objects;\r\n   *    });\r\n   *  }\r\n   *\r\n   *  @param {ArrayBuffer|JSON|DataView} data\r\n   *  @param {FileArgs} args\r\n   *  */\r\n  loadFile(data, args = {}) {\r\n    return new Promise((accept, reject) => {\r\n      accept(this.loadFileSync(data, args));\r\n    });\r\n  }\r\n\r\n  ensureMenuBar() {\r\n    let screen = this.screen;\r\n    let ok = false;\r\n\r\n    for (let sarea of screen.sareas) {\r\n      if (sarea.area instanceof MenuBarEditor) {\r\n        ok = true;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (ok) {\r\n      return;\r\n    }\r\n\r\n    if (!Editor.makeMenuBar) {\r\n      /* don't make menu bar if Editor.registerAppMenu hasn't been called */\r\n      return;\r\n    }\r\n\r\n    /* ensure screen size is up to date */\r\n    screen.update();\r\n\r\n    let sarea = UIBase.createElement(\"screenarea-x\");\r\n\r\n    screen.appendChild(sarea);\r\n\r\n    let h = 55;\r\n    let min = new Vector2().addScalar(1e17);\r\n    let max = new Vector2().addScalar(-1e17);\r\n    let tmp = new Vector2();\r\n\r\n    for (let sarea2 of screen.sareas) {\r\n      if (sarea2 === sarea) {\r\n        continue;\r\n      }\r\n\r\n      min.min(sarea2.pos);\r\n      tmp.load(sarea2.pos).add(sarea2.size);\r\n      max.max(tmp);\r\n    }\r\n\r\n    let scale = (max[1] - min[1] - h)/(max[1] - min[1]);\r\n\r\n    for (let sarea2 of screen.sareas) {\r\n      if (sarea2 === sarea) {\r\n        continue;\r\n      }\r\n\r\n      sarea2.pos[1] *= scale;\r\n      sarea2.size[1] *= scale;\r\n      sarea2.pos[1] += h;\r\n    }\r\n\r\n    sarea.pos.zero();\r\n    sarea.size[0] = screen.size[0];\r\n    sarea.size[1] = h;\r\n\r\n    screen.regenScreenMesh();\r\n    screen.snapScreenVerts();\r\n\r\n    sarea.switch_editor(MenuBarEditor);\r\n\r\n    screen.solveAreaConstraints();\r\n\r\n    screen.completeSetCSS();\r\n    screen.completeUpdate();\r\n  }\r\n\r\n  makeScreen() {\r\n    if (this.screen) {\r\n      this.screen.unlisten();\r\n      this.screen.remove();\r\n    }\r\n\r\n    let screen = this.screen = UIBase.createElement(this.screenClass.define().tagname);\r\n    let sarea = UIBase.createElement(\"screenarea-x\");\r\n\r\n    screen.ctx = this.ctx;\r\n    sarea.ctx = this.ctx;\r\n\r\n    document.body.appendChild(screen);\r\n\r\n    let cls = this.defaultEditorClass;\r\n\r\n    if (!cls) {\r\n      for (let k in areaclasses) {\r\n        cls = areaclasses[k];\r\n\r\n        if (cls !== MenuBarEditor) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    sarea.switch_editor(cls);\r\n    screen.appendChild(sarea);\r\n\r\n    screen._init();\r\n    screen.listen();\r\n    screen.update();\r\n    screen.completeSetCSS();\r\n    screen.completeUpdate();\r\n\r\n    if (Editor.makeMenuBar) {\r\n      this.ensureMenuBar();\r\n    }\r\n  }\r\n\r\n  start(args = new StartArgs()) {\r\n    nstructjs.validateStructs();\r\n\r\n    let args2 = new StartArgs();\r\n\r\n    let methodsCheck = [\r\n      \"saveFile\", \"createNewFile\", \"loadFile\"\r\n    ];\r\n\r\n    for (let method of methodsCheck) {\r\n      let m1 = AppState.prototype[method];\r\n      let m2 = this[method];\r\n\r\n      if (m1 === m2) {\r\n        console.warn(`Warning: it is recommended to override .${method} when subclassing simple.AppState`);\r\n      }\r\n    }\r\n\r\n    document.body.style[\"touch-action\"] = \"none\";\r\n\r\n    registerMenuBarEditor();\r\n\r\n    for (let k in args2) {\r\n      if (args[k] === undefined) {\r\n        args[k] = args2[k];\r\n      }\r\n    }\r\n\r\n    if (args.registerSaveOpenOps) {\r\n      register();\r\n    }\r\n\r\n    if (!args.iconsheet) {\r\n      args.iconsheet = loadDefaultIconSheet();\r\n    }\r\n\r\n    this.startArgs = args;\r\n\r\n    cconst.loadConstants(args);\r\n\r\n    if (args.autoLoadSplineTemplates) {\r\n      initSplineTemplates();\r\n    }\r\n\r\n    let sizes = [];\r\n    let images = [];\r\n\r\n    for (let size of args.iconSizes) {\r\n      sizes.push([args.iconTileSize, size]);\r\n      images.push(args.iconsheet);\r\n    }\r\n\r\n    window.iconsheet = args.iconsheet;\r\n\r\n\r\n    let iconManager = new IconManager(images, sizes, args.iconsPerRow);\r\n    setIconManager(iconManager);\r\n    setIconMap(args.icons);\r\n\r\n    if (args.theme) {\r\n      setTheme(args.theme);\r\n    }\r\n\r\n    document.body.style[\"margin\"] = \"0px\";\r\n    document.body.style[\"padding\"] = \"0px\";\r\n\r\n    if (args.singlePage) {\r\n      document.body.style[\"overflow\"] = \"hidden\";\r\n    }\r\n\r\n    this.makeScreen();\r\n\r\n    Object.defineProperty(window, \"C\", {\r\n      get() {\r\n        return this._appstate.ctx;\r\n      }\r\n    });\r\n\r\n    nstructjs.validateStructs();\r\n\r\n    if (this.saveFilesInJSON && !this._fileExtSet) {\r\n      this._fileExt = \"json\";\r\n    }\r\n\r\n    if (this._fileExt.startsWith(\".\")) {\r\n      this._fileExt = this._fileExt.slice(1, this._fileExt.length).trim();\r\n    }\r\n  }\r\n}\r\n","\r\nexport class SimpleContext {\r\n  constructor() {\r\n\r\n  }\r\n\r\n  static getContextClass() {\r\n    let props = {};\r\n\r\n    let rec = (cls) => {\r\n      let prototype = cls.prototype;\r\n\r\n      if (cls.__proto__ !== Object.__proto__) {\r\n        rec(cls);\r\n      }\r\n\r\n      for (let k in cls) {\r\n        let descr = Object.getOwnPropertyDescriptor(prototype, k);\r\n\r\n        if (descr) {\r\n          props[k] = descr;\r\n        }\r\n      }\r\n    }\r\n\r\n    console.log(props);\r\n\r\n    for (let k in props) {\r\n      if (k.search(\"_save\") >= 0 || k.search(\"_load\") >= 0) {\r\n        continue;\r\n      }\r\n\r\n    }\r\n  }\r\n}","import {PlatformAPI, isMimeText} from '../platform_base.js';\r\nimport {saveFile, loadFile} from '../../path-controller/util/html5_fileapi.js';\r\n\r\nimport {FileDialogArgs, FilePath} from '../platform_base.js';\r\n\r\nimport {mimeMap} from '../platform_base.js';\r\n\r\nexport function getWebFilters(filters=[]) {\r\n  let types = [];\r\n\r\n  for (let item of filters) {\r\n    let mime = item.mime;\r\n    let exts = [];\r\n\r\n    for (let ext of item.extensions) {\r\n      ext = \".\" + ext;\r\n      if (ext.toLowerCase() in mimeMap) {\r\n        mime = mime !== undefined ? mime : mimeMap[ext.toLowerCase()];\r\n      }\r\n\r\n      exts.push(ext);\r\n    }\r\n\r\n    if (!mime) {\r\n      mime = \"application/x-octet-stream\";\r\n    }\r\n\r\n    types.push({\r\n      description: item.name,\r\n      accept     : {\r\n        [mime]: exts\r\n      }\r\n    });\r\n  }\r\n\r\n  return types;\r\n}\r\n\r\nexport class platform extends PlatformAPI {\r\n  //returns a promise\r\n  static showOpenDialog(title, args = new FileDialogArgs()) {\r\n    let types = getWebFilters(args.filters);\r\n\r\n    return new Promise((accept, reject) => {\r\n      try {\r\n        window.showOpenFilePicker({\r\n          multiple: args.multi,\r\n          types\r\n        }).then(arg => {\r\n          let paths = [];\r\n\r\n          for (let file of arg) {\r\n            paths.push(new FilePath(file, file.name));\r\n          }\r\n\r\n          accept(paths);\r\n        });\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n    });\r\n    /*\r\n    let exts = [];\r\n\r\n    for (let list of args.filters) {\r\n      for (let ext of list.extensions) {\r\n        exts.push(ext);\r\n      }\r\n    }\r\n\r\n    return new Promise((accept, reject) => {\r\n      loadFile(args.defaultPath, exts).then((file) => {\r\n        accept([new FilePath(file)]);\r\n      });\r\n    });*/\r\n  }\r\n\r\n  static writeFile(data, handle, mime) {\r\n    handle = handle.data;\r\n\r\n    return handle.createWritable().then((file) => {\r\n      file.write(data);\r\n      file.close();\r\n    });\r\n  }\r\n\r\n  static showSaveDialog(title, savedata_cb, args = new FileDialogArgs()) {\r\n    if (!window.showSaveFilePicker) {\r\n      return this.showSaveDialog_old(...arguments);\r\n    }\r\n\r\n    let types = getWebFilters(args.filters);\r\n\r\n    return new Promise((accept, reject) => {\r\n      let fname;\r\n      let saveHandle;\r\n\r\n      try {\r\n        saveHandle = window.showSaveFilePicker({types});\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n\r\n      let handle;\r\n\r\n      saveHandle.then((handle1) => {\r\n        handle = handle1;\r\n\r\n        fname = handle.name;\r\n        console.log(\"saveHandle\", handle);\r\n        return handle.createWritable();\r\n      }).then((file) => {\r\n        let savedata = savedata_cb();\r\n\r\n        if (savedata instanceof Uint8Array || savedata instanceof DataView) {\r\n          savedata = savedata.buffer;\r\n        }\r\n\r\n        file.write(savedata);\r\n        file.close();\r\n\r\n        let path = new FilePath(handle, fname);\r\n        accept(path);\r\n      });\r\n    });\r\n  }\r\n\r\n  //returns a promise\r\n  static showSaveDialog_old(title, savedata, args = new FileDialogArgs()) {\r\n\r\n    let exts = [];\r\n\r\n    for (let list of args.filters) {\r\n      if (!Array.isArray(list) && list.filters) {\r\n        list = list.filters;\r\n      }\r\n\r\n      for (let ext of list) {\r\n        exts.push(ext);\r\n      }\r\n    }\r\n\r\n    return new Promise((accept, reject) => {\r\n      saveFile(savedata);\r\n\r\n      window.setTimeout(() => {\r\n        accept(\"undefined\");\r\n      });\r\n    });\r\n  }\r\n\r\n  //path is a FilePath instance, for web this is the actual file data\r\n  static readFile(path, mime = \"\") {\r\n    if (mime === \"\") {\r\n      mime = path.filename;\r\n      let i = mime.length-1;\r\n\r\n      while (i > 0 && mime[i] !== \".\") {\r\n        i--;\r\n      }\r\n\r\n      mime = mime.slice(i, mime.length).trim().toLowerCase();\r\n      if (mime in mimeMap) {\r\n        mime = mimeMap[mime];\r\n      }\r\n    }\r\n\r\n    return new Promise((accept, reject) => {\r\n      path.data.getFile().then((file) => {\r\n        console.log(\"file!\", file);\r\n\r\n        let promise;\r\n\r\n        if (isMimeText(mime)) {\r\n          promise = file.text();\r\n        } else {\r\n          promise = file.arrayBuffer();\r\n        }\r\n\r\n        promise.then(data => {\r\n          accept(data);\r\n        });\r\n      });\r\n    });\r\n\r\n    return new Promise((accept, reject) => {\r\n      let data = path.data;\r\n\r\n      if (isMimeText(mime)) {\r\n        let s = '';\r\n        data = new Uint8Array(data);\r\n\r\n        for (let i = 0; i < data.length; i++) {\r\n          s += String.fromCharCode(data[i]);\r\n        }\r\n\r\n        data = s;\r\n      }\r\n\r\n      accept(data);\r\n    });\r\n  }\r\n}\r\n","import './path-controller/util/polyfill.js';\r\n\r\nexport * from './xmlpage/xmlpage.js';\r\n\r\nexport * from './core/ui_base.js';\r\nexport * from './core/ui.js';\r\nexport * from './widgets/ui_widgets.js';\r\nexport * from './widgets/ui_widgets2.js';\r\nexport * from './core/ui_theme.js';\r\nexport * from './core/units.js';\r\nexport * from './widgets/ui_button.js';\r\nexport * from './widgets/ui_richedit.js';\r\nexport * from './widgets/ui_curvewidget.js';\r\nexport * from './widgets/ui_panel.js';\r\nexport * from './widgets/ui_colorpicker2.js';\r\nexport * from './widgets/ui_tabs.js';\r\nexport * from './widgets/ui_listbox.js';\r\nexport * from './widgets/ui_menu.js';\r\nexport * from './widgets/ui_progress.js';\r\nexport * from './widgets/ui_table.js';\r\nexport * from './widgets/ui_noteframe.js';\r\nexport * from './widgets/ui_numsliders.js';\r\nexport * from './widgets/ui_lasttool.js';\r\nexport * from './widgets/ui_textbox.js';\r\nexport * from './path-controller/util/graphpack.js';\r\n//export * from './docbrowser/docbrowser.js';\r\n\r\nexport * from './path-controller/util/html5_fileapi.js';\r\nexport * from './path-controller/controller.js';\r\n\r\nimport * as controller from './path-controller/controller.js';\r\n\r\nexport {controller};\r\n\r\nimport * as ui_noteframe from './widgets/ui_noteframe.js';\r\n\r\ncontroller.setNotifier(ui_noteframe);\r\n\r\nexport {\r\n  PlatformAPI, getMime, isMimeText, mimeMap, textMimes, FileDialogArgs, FilePath\r\n} from './platforms/platform_base.js';\r\n\r\nimport * as platform from './platforms/platform.js';\r\n\r\nexport {platform};\r\n\r\nimport * as electron_api from './platforms/electron/electron_api.js';\r\n\r\nexport {electron_api};\r\n\r\nexport * from './widgets/theme_editor.js';\r\nexport * from './widgets/ui_treeview.js';\r\n\r\nexport * from './screen/FrameManager.js';\r\nexport * from './screen/ScreenArea.js';\r\nexport * from './util/ScreenOverdraw.js';\r\n\r\nimport cconst from './config/const.js';\r\n\r\nexport {cconst};\r\n\r\nimport * as simple from './simple/simple.js';\r\n\r\nexport {simple};\r\n"],"names":["window","global","globalThis","self","visitgen","destroyAllCSS","visit","n","__visit","tagName","textContents","style","k","error","childNodes","c","document","head","body","sheet","styleSheets","i","rules","length","removeRule","eventDebugModule","start","debugEventLists","debugEventList","this","_addEventListener","EventTarget","prototype","addEventListener","_removeEventListener","removeEventListener","_dispatchEvent","dispatchEvent","onadd","onrem","ondispatch","add","type","data","push","a","arguments","event","thisvar","line","filename","replace","filepath","location","origin","ownerpath","apply","cb","args","pruneConnected","list","e","Node","isConnected","undefined","_debug_event_listeners","_disable_all_listeners","console","warn","EventSource","visualViewport","width","innerWidth","height","innerHeight","offsetLeft","offsetTop","pageLeft","pageTop","scale","Array","set","array","src","dst","count","RangeError","len","Math","min","Object","defineProperty","enumerable","configurable","Float64Array","Float32Array","Uint8Array","Uint8ClampedArray","Int32Array","Int16Array","Int8Array","reject","func","filter","item","Symbol","iterator","keystr","fract","f","floor","tent","abs","sign","pop_i","idx","Error","remove","suppress_error","indexOf","trace","String","contains","substr","search","Number","Boolean","key","colormap","black","red","green","yellow","blue","magenta","cyan","white","reset","grey","orange","pink","brown","lightred","peach","tab","chr","t","termColorMap","termColor","s","toString","termPrint","re1a","re1b","re2","endtag","tok","value","tokdef","s2","tokens","mintk","mini","minslice","mintype","ok","tk","slice","match","chunk","cur","stack","out","pop","iter","ret","util","freeze","__proto__","print_lines","ld","lineno","col","printColors","token","buf","lines","split","istart","max","iend","color","l","colstr","constructor","val","lexpos","lexer","parser","name","regexpr","example","re","startsWith","endsWith","trim","PUTIL_ParseError","msg","super","errfunc","lexdata","colmap","printTokens","linestart","linemap","tokints","statestack","states","__main__","statedata","logger","log","add_state","tok_int","push_state","state","pop_state","input","str","peeked_tokens","safepos","peek","next","peeknext","at_end","ignore_peek","shift","ts","tlen","results","res","exec","index","theres","max_res","def","parse","err_on_unconsumed","estr","optional","expect","test_parser","basic_types","Set","reserved_tokens","has","toUpperCase","js","rt","lex","p_Type","p","toLowerCase","arraytype","itername","iname","p_Array","p_Field","field","get","st","fields","p_Struct","JSON","stringify","struct_parseutil","NStruct","id","StructEnum","INT","FLOAT","DOUBLE","STRING","STATIC_STRING","STRUCT","TSTRUCT","ARRAY","ITER","SHORT","BYTE","BOOL","ITERKEYS","UINT","USHORT","STATIC_ARRAY","SIGNED_BYTE","OPTIONAL","ArrayTypes","ValueTypes","StructTypes","int","uint","ushort","float","double","string","static_string","struct","abstract","short","byte","bool","iterkeys","sbyte","StructTypeMap","gen_tabstr$2","stripComments","strlit","strs","mode","escape","StructParser","forEach","parser$1","p_Iter","p_IterKeys","size","p_StaticArray","num","maxlength","p_Static_String","jsonKeyword","p_Abstract","tname","DATAREF","p_DataRef","p_Optional","p_ID_or_num","is_opt","check","comment","struct_parse","struct_parser","struct_typesystem","STRUCT_ENDIAN","setBinaryEndian","temp_dataview","DataView","ArrayBuffer","uint8_view","buffer","unpack_context","pack_byte","pack_sbyte","pack_bytes","bytes","pack_int","setInt32","pack_uint","setUint32","pack_ushort","setUint16","pack_float","setFloat32","pack_double","setFloat64","pack_short","setInt16","encode_utf8","arr","charCodeAt","uc","decode_utf8","sum","j","fromCharCode","test_utf8","truncate_utf8","maxlen","last_codepoint","last2","incode","_static_sbuf_ss","pack_static_string","_static_sbuf","pack_string","unpack_bytes","dview","uctx","unpack_byte","getUint8","unpack_sbyte","getInt8","unpack_int","getInt32","unpack_uint","getUint32","unpack_ushort","getUint16","unpack_float","getFloat32","unpack_double","getFloat64","unpack_short","getInt16","_static_arr_us","unpack_string","slen","_static_arr_uss","unpack_static_string","done","struct_binpack","warninglvl$1","debug","_static_envcode_null$1","packer_debug$1","packer_debug_start$1","packer_debug_end$1","packdebug_tablevel","_get_pack_debug","packer_debug","packer_debug_start","packer_debug_end","warninglvl","cachering","tot","static","cls","gen_tabstr$1","setWarningMode2","isNaN","setDebugMode2","funcname","StructFieldTypes","StructFieldTypeMap","packNull","manager","toJSON","obj","fromJSON","instance","formatJSON$1","tlvl","formatJSON","validateJSON$1","_abstractKey","validateJSON","unpack_field","define","unpack","fakeFields","fmt_type","format","do_pack","typeid","pack","_ws_env$1","StructFieldType","StructIntField","register","StructFloatField","StructDoubleField","StructStringField","StructStaticStringField","StructStructField","stt","get_struct","write_struct","validateJSONIntern","readJSON","formatJSON_intern","writeJSON","dest","cls2","get_struct_cls","read_object","field2","StructTStructField","keywords","structName","parentcls","struct_ids","get_struct_id","struct_cls","formatArrayJson","type2","formatCtx","addComments","StructArrayField","d","env","val2","_env_call","fakeField","process","exit","json","StructIterField","starti","call","StructShortField","StructByteField","StructSignedByteField","StructBoolField","StructIterKeysField","StructUintField","StructUshortField","StructStaticArrayField","StructOptionalField","exists","_sintern2","structEval","eval","setStructEval","_struct_eval","TokSymbol","buildJSONParser","nfloat3","nfloatexp","numre","RegExp","numreTest","tests","test","char","parseFloat","tokinfo","p_Start","throwError","first","p_Object","jsonParser","nGlobal","printContext","l2","globals","DEBUG","updateDEBUG","keys","sintern2","struct_eval","truncateDollarSign$1","JSONError","printCodeLines","code","printEvalError","setTruncateDollarSign","v","_truncateDollarSign","unmangle","_static_envcode_null","gen_tabstr","update_debug_data","setWarningMode","setDebugMode","_ws_env","haveCodeGen","nbtoa","natob","define_empty_class","scls","create","loadSTRUCT","reader","newSTRUCT","idgen","allowOverriding","structs","compiled_code","null_natives","define_null_native","jsonUseColors","jsonBuf","child","parent","fmt_struct","bad","fromSTRUCT","obj2","concat","getOwnPropertySymbols","internal_only","no_helper_js","keyword","nameKeyword","script","load","new","after","from","validateStructs","onerror","getType","formatStruct","parse_structs","defined_classes","struct2","clsmap","dummy","registerGraph","srcSTRUCT","recStruct","recArray","add_class","st2","mergeScripts","stc","stp","fieldset","inlineRegister","structScript","hasOwnProperty","unregister","inherit","isRegistered","envcode","fullcode","code2","err","use_helper_js","useHelperJS","thestruct","t1","tinyeval","write_object","readObject","cls_or_struct_id","writeObject","json2","isArray","assign","objInstance","this2","was_run","flen","unpackInto","makeLoader","useInternalParser","useColors","consoleLogger","jsonLogger","message","keyTestJson","f2","basetype","validate","StructClass","deriveStructManager","_json_parser","_util","NewSTRUCT","write_scripts","nManager","include_code","nl","buf2","i2","versionToInt","mul","versionCoerce","major","minor","micro","setClassKeyword","btoa","Buffer","atob","ver_pat","ver","parseInt","versionLessThan","b","FileParams","magic","ext","blocktypes","version","Block","type_magic","FileeError","FileHelper","params","fp","unpack_ctx","read","dataview","FileError","scripts","blocks","dviewlen","byteLength","bdata","datalen","bstruct","block","doVersions","old","write","data2","writeBase64","makeBlock","readBase64","base64","struct_filehelper","truncateDollarSign","setEndian","getEndian","setAllowOverriding","__uctx","class_or_struct_id","impl","phones","iPhone","BlackBerry","HTC","Nexus","Dell","Motorola","Samsung","LG","Sony","Asus","NokiaLumia","Micromax","Palm","Vertu","Pantech","Fly","Wiko","iMobile","SimValley","Wolfgang","Alcatel","Nintendo","Amoi","INQ","OnePlus","GenericPhone","tablets","iPad","NexusTablet","GoogleTablet","SamsungTablet","Kindle","SurfaceTablet","HPTablet","AsusTablet","BlackBerryTablet","HTCtablet","MotorolaTablet","NookTablet","AcerTablet","ToshibaTablet","LGTablet","FujitsuTablet","PrestigioTablet","LenovoTablet","DellTablet","YarvikTablet","MedionTablet","ArnovaTablet","IntensoTablet","IRUTablet","MegafonTablet","EbodaTablet","AllViewTablet","ArchosTablet","AinolTablet","NokiaLumiaTablet","SonyTablet","PhilipsTablet","CubeTablet","CobyTablet","MIDTablet","MSITablet","SMiTTablet","RockChipTablet","FlyTablet","bqTablet","HuaweiTablet","NecTablet","PantechTablet","BronchoTablet","VersusTablet","ZyncTablet","PositivoTablet","NabiTablet","KoboTablet","DanewTablet","TexetTablet","PlaystationTablet","TrekstorTablet","PyleAudioTablet","AdvanTablet","DanyTechTablet","GalapadTablet","MicromaxTablet","KarbonnTablet","AllFineTablet","PROSCANTablet","YONESTablet","ChangJiaTablet","GUTablet","PointOfViewTablet","OvermaxTablet","HCLTablet","DPSTablet","VistureTablet","CrestaTablet","MediatekTablet","ConcordeTablet","GoCleverTablet","ModecomTablet","VoninoTablet","ECSTablet","StorexTablet","VodafoneTablet","EssentielBTablet","RossMoorTablet","iMobileTablet","TolinoTablet","AudioSonicTablet","AMPETablet","SkkTablet","TecnoTablet","JXDTablet","iJoyTablet","FX2Tablet","XoroTablet","ViewsonicTablet","VerizonTablet","OdysTablet","CaptivaTablet","IconbitTablet","TeclastTablet","OndaTablet","JaytechTablet","BlaupunktTablet","DigmaTablet","EvolioTablet","LavaTablet","AocTablet","MpmanTablet","CelkonTablet","WolderTablet","MediacomTablet","MiTablet","NibiruTablet","NexoTablet","LeaderTablet","UbislateTablet","PocketBookTablet","KocasoTablet","HisenseTablet","Hudl","TelstraTablet","GenericTablet","oss","AndroidOS","BlackBerryOS","PalmOS","SymbianOS","WindowsMobileOS","WindowsPhoneOS","iOS","iPadOS","MeeGoOS","MaemoOS","JavaOS","webOS","badaOS","BREWOS","uas","Chrome","Dolfin","Opera","Skyfire","Edge","IE","Firefox","Bolt","TeaShark","Blazer","Safari","WeChat","UCBrowser","baiduboxapp","baidubrowser","DiigoBrowser","Mercury","ObigoBrowser","NetFront","GenericBrowser","PaleMoon","props","Mobile","Build","Version","VendorID","iPod","Coast","Fennec","NokiaBrowser","MQQBrowser","MicroMessenger","SamsungBrowser","Iron","Tizen","Webkit","Gecko","Trident","Presto","Goanna","Android","BREW","Java","Symbian","utils","Bot","MobileBot","DesktopMode","TV","WebKit","Console","Watch","fullPattern","shortPattern","tabletPattern","hasOwnProp","equalIC","containsIC","valueLC","convertPropsToRegExp","object","MobileDetect","userAgent","maxPhoneWidth","ua","prepareUserAgent","_cache","FALLBACK_PHONE","FALLBACK_TABLET","FALLBACK_MOBILE","values","verPos","mobileDetectRules","substring","oss0","findMatch","findMatches","result","getVersionStr","propertyName","patterns","getVersion","prepareVersionNo","NaN","numbers","join","isMobileFallback","detectMobileBrowsers","isTabletFallback","prepareDetectionCache","cache","mobile","phone","tablet","phoneSized","isPhoneSized","mobileGrade","$isMobile","os","is","detectOS","getDeviceSmallerSide","screen","userAgents","versionStr","pattern","grade","_impl","module","exports","factory","amd","keyStrBase64","keyStrUriSafe","baseReverseDic","getBaseValue","alphabet","character","charAt","getInput","lzstring","compressToBase64","_compress","decompressFromBase64","_decompress","compressToUTF16","decompressFromUTF16","compressed","compressToUint8Array","uncompressed","compress","TotalLen","current_value","decompressFromUint8Array","decompress","compressToEncodedURIComponent","decompressFromEncodedURIComponent","bitsPerChar","getCharFromInt","ii","context_dictionary","context_dictionaryToCreate","context_c","context_wc","context_w","context_enlargeIn","context_dictSize","context_numBits","context_data","context_data_val","context_data_position","pow","resetValue","getNextValue","w","bits","resb","maxpower","power","dictionary","enlargeIn","dictSize","numBits","entry","position","f64tmp","u16tmp","Uint16Array","isDenormal","_isDenormal","teal","gray","MovingAvg","used","sample","timers","mdetect","mret","pollTimer","interval","time_ms","isMobile","navigator","SmartConsoleContext","random","sqrt","r","g","__console","timeInterval","timeIntervalAll","_last","last","_data","_data_length","maxCache","hash","dohash","h","WeakSet","recurse","strhash","getAllKeys","clearCache","_getData","time","_check","SmartConsole","contexts","context","tm","EmptySlot","getClassParent","iterable","searchItem","getOwnPropertyDescriptors","proto","formatNumberUI","isInt","decimals","Infinity","toFixed","performance","now","Date","getMilliseconds","color2css","merge","obja","objb","debug_cacherings","_cacherings","_clear_all_cacherings","kill_all","copy","Reflect","ownKeys","ch","_nonvector_cacherings","_stale_cacherings","sort","gen","isprivate","private","SetIter","items","freelist","equals","setb","clear","map","reduce","initial","delete","ignore_existence","HashIter","_items","_hash_null","hashtable","_keys","key2","IDGenInternalIDGen","IDGen","__cur","_debug","_internalID","isFinite","_cur","max_cur","get_callstack","print_stack","fetch_file","path","url","req","XMLHttpRequest","Promise","accept","open","onreadystatechange","status","readyState","response","statusText","send","_int32","x","nstructjs","MersenneRandom","seed","mt","Uint32Array","extract_number","nrandom","fill","twist","y","_mt","smallstr_hashes","MAXINT","hashsizes","FTAKEN","FKEY","FVAL","FTOT","digestcache","FastHash","cursize","resize","table","valueOf","probe","_i","test_fasthash","ImageReader","load_image","doaccept","createElement","promise","files","FileReader","onload","target","image","Image","canvas","getContext","drawImage","idata","getImageData","readAsDataURL","click","then","HashDigest","hashjoin","_test_hash2","fromConstructor","NullItem","MapIter","ownermap","finish","itercur","_list","return","iterstack","validateId","_test_map","m","item2","UndefinedTag","IDMap","iteritem","_test_idmap","HW","HELEM","HTOT","heaplog","MinHeapQueue","iterw","heap","end","witer","depth","ceil","swap","n1","n2","testHeapQueue","list1","Queue","initialSize","queue","enqueue","qlen","clearData","dequeue","_testQueue","steps","samples","ArrayPool","pools","Map","pool","DivLogger","elemId","maxLines","elem","update","getElementById","innerHTML","description","k2","PendingTimeoutPromises","TimeoutPromise","callback","timeout","silent","accept2","_accept2","bind","reject2","_reject2","rejected","_promise","_accept","_reject","catch","wrapPromise","finally","undefinedForGC","setInterval","EulerOrders","XYZ","XZY","YXZ","YZX","ZXY","ZYX","makeCompiledVectormathCode","es6exports","doExports","classes","Vector2","Vector3","Vector4","lens","Quat","modecode","nstructjscode","indent","pad","zero","internal_matrix","Matrix4","sin","cos","asin","exp","acos","atan2","atan","PI","E","DOT_NORM_SNAP_LIMIT","M_SQRT2","FLT_EPSILON","basic_funcs","negate","combine","interp","addFac","sub","div","mulScalar","divScalar","addScalar","subScalar","minScalar","maxScalar","clamp","bounded_acos","fac","pi","make_norm_safe_dot","_dot","dot","getBaseVector","BaseVector","vec","vectorsize","vectorDotDistance","vectorDistance","vectorDistanceSqr","line2","init_swizzle","Function","vectorLength","swapAxes","axis1","axis2","sinterp","v2","l1","normalize","perpSwap","tmp","F64BaseVector","F32BaseVector","I32BaseVector","I16BaseVector","I8BaseVector","UI32BaseVector","UI16BaseVector","UI8BaseVector","myclamp","makeVector4","structType","temp1","temp2","temp3","temp4","toCSS","loadXYZW","z","loadXYZ","v1","v3","v4","center","mulVecQuat","q","t0","t2","multVecMatrix","matrix","$matrix","m41","m11","m21","m31","m42","m12","m22","m32","m43","m13","m23","m33","m44","m14","m24","m34","cross","preNormalizedAngle","th","_v3nd_n1_normalizedDot","_v3nd_n2_normalizedDot","_v3nd4_n1_normalizedDot4","_v3nd4_n2_normalizedDot4","makeVector3","customConstructorCode","bundlehelper","constructorCode","makeVector2","initVector2","co","loadJSON","loadXY","rot2d","A","axis","isPersp","w2","vectorLengthSqr","_quat_vs3_temps","util.cachering","lookat_cache_vs3","lookat_cache_vs4","lookat_cache_ms","euler_rotate_mats","makenormalcache","temp_mats","preMultTemp","makeUnitQuat","isZero","mulQuat","qt","conjugate","dotWithQuat","q2","invert","conjugate_qt","mulscalar","nq2","mulScalarWithFactor","angle","si","last3","toMatrix","q0","q1","q3","qda","qdb","qdc","qaa","qab","qac","qbb","qbc","qcc","matrixToQuat","wmat","mat","r1","r2","r3","tr","axisAngleToQuat","nor","phi","rotationBetweenVecs","quatInterp","quat2","omega","sinom","sc1","sc2","quat","cosom","$_v3nd_n1_normalizedDot","$_v3nd_n2_normalizedDot","$_v3nd4_n1_normalizedDot4","$_v3nd4_n2_normalizedDot4","$_v3nd4_n1_normalizedDot3","$_v3nd4_n2_normalizedDot3","clone","addToHashDigest","m1","m2","loadColumn","have4","copyColumnTo","copyColumn","makeIdentity","getAsArray","getAsFloat32Array","setUniform","ctx","loc","transpose","setUniformArray","setUniformWebGLArray","uniformMatrix4fv","determinant","_determinant4x4","det","_makeAdjoint","translate","multiply","preTranslate","preMultiply","preScale","euler_rotate_order","order","xmat","ymat","zmat","euler_rotate","dec","rotate","sinA","cosA","sinA2","x2","y2","z2","flat","clearTranslation","set_w_to_one","setTranslation","resetW","makeNormalMatrix","normal","up","mm","mm2","divide","divisor","ortho","left","right","bottom","top","near","far","tx","ty","tz","frustum","B","C","D","orthographic","aspect","zscale","perspective","fovy","zNear","zFar","tan","lookat","pos","zvec","yvec","xvec","makeRotationOnly","l3","alignAxis","inputs","transformMatrix","getValue","mat2","rot","decompose","axes","getAsVecs","axis3","loadFromVecs","_translate","_rotate","_scale","_skew","_perspective","rmat","_determinant2x2","_determinant3x3","a1","a2","a3","b1","b2","b3","c1","c2","c3","d1","d2","d3","a4","b4","c4","d4","__mat","testmat","PropTypes","ENUM","FLAG","VEC2","VEC3","VEC4","MATRIX4","QUAT","PROPLIST","STRSET","CURVE","FLOAT_ARRAY","REPORT","PropSubTypes","COLOR","PropFlags","SELECT","PRIVATE","LABEL","USE_ICONS","USE_CUSTOM_GETSET","SAVE_LAST_VALUE","READ_ONLY","SIMPLE_SLIDER","FORCE_ROLLER_SLIDER","USE_BASE_UNDO","EDIT_AS_BASE_UNIT","NO_UNDO","USE_CUSTOM_PROP_GETTER","FORCE_ENUM_CHECKBOXES","NO_DEFAULT","ToolPropertyIF","subtype","apiname","uiname","flag","icon","copyTo","_fire","arg1","arg2","on","off","setValue","setStep","step","setRange","setUnit","unit","setUIRange","setIcon","StringPropertyIF","NumPropertyIF","IntPropertyIF","setRadix","radix","FloatPropertyIF","setDecimalPlaces","EnumPropertyIF","valid_values","ui_value_names","iconmap","uin","addIcons","FlagPropertyIF","Vec2PropertyIF","Vec3PropertyIF","Vec4PropertyIF","ListPropertyIF","prop","StringSetPropertyIF","definition","destructive","soft_fail","addUINames","addDescriptions","Curve1DPropertyIF","curve","FLT_EPSILONE","myfloor","normString","myToFixed","Units","Unit","unitDefine","MeterUnit","InchUnit","foot_re","FootUnit","parts","vft","vin","square_foot_re","SquareFootUnit","MileUnit","DegreeUnit","RadianUnit","setBaseUnit","baseUnit","setMetric","isMetric","_getBaseUnit","numre1","numre2","hexre1","hexre2","binre","expre","intre","isnumber","parseValueIntern","base","getUnit","toInternal","fromInternal","parseValue","displayUnit","isNumber","PixelUnit","PercentUnit","convert","unita","unitb","buildString","decimalPlaces","unitConvert","_parseValueTest","_buildStringTest","NumberConstraintsBase","IntegerConstraints","util.list","FloatConstrinats","NumberConstraints","setPropTypes","types","customPropertyTypes","PropClasses","customPropTypeBase","wordmap","sel","unsel","eid","defaultRadix","defaultDecimalPlaces","OnceTag","ToolProperty","PROP_TYPE_ID","wasSet","icon2","callbacks","lastc","ischar","upper","lower","subst","word","logBase","report","util.termColor","setDescription","setUIName","calcMemSize","strlen","saveLastValue","ignoreLastValue","clearEventCallbacks","once","cb2","range","uiRange","getStep","stepIsRelative","calcRelativeStep","setRelativeStep","noUnits","setDisplayUnit","setFlag","setIcon2","FloatArrayProperty","StringProperty","multiLine","internalRegister","NumProperty","_NumberPropertyBase","sliderDisplayExp","slideSpeed","expRate","ui_range","setSliderDisplayExp","setSlideSpeed","setExpRate","IntProperty","ReportProperty","BoolProperty","FloatProperty","EnumKeyPair","key_is_int","val_is_int","EnumProperty","string_or_int","dynamicMetaCB","descriptions","makeUIName","iconmap2","dynamicMeta","metaCB","checkMeta","calcHash","digest","util.HashDigest","updateDefinition","enumdef_or_prop","enumdef","addIcons2","meta","api_update","_loadMap","_saveMap","_values","_ui_value_names","_iconmap","_iconmap2","_descriptions","data_is_int","_is_data_int","FlagProperty","bitmask","VecPropertyBase","hasUniformSlider","uniformSlider","Vec2Property","Vec3Property","isColor","Vec4Property","QuatProperty","Mat4Property","ListProperty","splice","deleteCount","newItems","deletedItems","psize","prop1","prop2","getListItem","setListItem","StringSetProperty","util.set","config","doubleClickTime","autoLoadSplineTemplates","doubleClickHoldTime","setConfig","modalstack","singleMouseCBs","Screen","ContextAreaClass","debugDomEvents","cbsymbol","thsymbol","init","et","getkey","options","singletonMouseEvents","ddd","testSingleMouseUpEvent","singleMouseEvent","_mpos","doSingleCbs","touches","pageX","pageY","copyEvent","util.print_stack","capture","isLeftClick","button","DoubleClickHandler","down","dblEvent","start_mpos","_on_mouseup","_on_mousemove","mdown","mpos","devicePixelRatio","mousedown","isMouseDown","cpy","util.time_ms","cconst","ondblclick","abort","buttons","pathDebugEvent","extra","__prevdef","preventDefault","__stopprop","stopPropagation","eventWasTouch","sourceCapabilities","firesTouchEvents","was_touch","TouchEvent","PointerEvent","pointerType","getOwnPropertyNames","original","_setScreenClass","findScreen","rec","_setModalAreaClass","pushPointerModal","pointerId","autoStopPropagation","pushModalLight","handlers","last_mpos","touchmap","touchstart","touchmove","touchend","touchcancel","handleAreaContext","sarea","findScreenArea","area","push_ctx_active","pop_ctx_active","make_default_touchhandler","domEvents","e2","clientX","clientY","screenX","screenY","make_handler","found","handler","settings","passive","make_pointer","pointer","setPointerCapture","popModalLight","lock","modalEvents","unlock","releasePointerCapture","haveModal","_findScreen","_haveModal","keymap_latin_1","Space","Escape","Enter","Return","Up","Down","Left","Right","Num0","Num1","Num2","Num3","Num4","Num5","Num6","Num7","Num8","Num9","Home","End","Delete","Backspace","Insert","PageUp","PageDown","Tab","NumPlus","NumMinus","Shift","Ctrl","Control","Alt","keymap_latin_1_rev","keymap","reverse_keymap","HotKey","modifiers","action","mods","api","execTool","KeyMap","hotkeys","pathid","hk","handle","shiftKey","altKey","ctrlKey","commandKey","keyCode","ClassIdSymbol","ScreenClass","setScreenClass","getAreaIntName","AreaTypes","TEST_CANVAS_EDITOR","setAreaTypes","areaclasses","theWrangler","AreaWrangler","stacks","lasts","lastArea","locked","_last_screen_id","makeSafeContext","wrangler","Proxy","contextWrangler","stack1","_checkWrangler","_id","findInstance","pushLastRef","updateLastRef","getLastArea","dtvtmps","quad_co_rets2","quad_bilinear","u","quad_uv_2d","u1","u2","v2x","v2y","v3x","v3y","v4x","v4y","C1","C2","dx","dy","ClosestModes","CLOSEST","START","END","ENDPOINTS","ALL","advs","AbstractCurve","evaluate","derivative","curvature","ClosestCurveRets","cvrets","cvarrays","util.ArrayPool","cvtmp","closestPoint","poly_normal_tmps","pncent","normal_poly","vs","normal_tri","normal_quad","cent","barycentric_v2_rets","calc_proj_refs","dihedral_v3_sqr","bx","by","bz","cx","cy","cz","dz","tet_area_tmps","tet_volume","calc_projection_axes","no","ax","ay","az","_avtmps","inrect_3d","aabb_isect_line_3d","inside","closest_point_on_line","aabb_isect_cylinder_3d","radius","barycentric_v2","_linedis2","v1x","v1y","v1z","v2z","closest_p_tri_rets","uv","dist","cpt_v1","cpt_v2","cpt_v3","cpt_v4","cpt_v5","cpt_v6","cpt_p","cpt_n","cpt_mat","cpt_mat2","cpt_b","closest_point_on_quad","uvw","closest_point_on_tri","ax1","ax2","op","ax3","dist_to_tri_v3_old","planedis","p1","p2","p3","pp","dis","tmp2","linedis3d","point_in_tri","dist_to_tri_v3","_dt3s_n","dist_to_tri_v3_sqr","nx","ny","nz","feps","bx2","by2","cx2","cy2","x1","y1","z1","s1","s3","mask","lx","ly","lz","tri_area_temps","tri_area","aabb_overlap_area","pos1","size1","pos2","size2","aabb_isect_2d","aabb_isect_3d","aabb_intersect_vs","aabb_intersect_rets","aabb_intersect_2d","test_aabb_intersect_2d","setAttribute","appendChild","clearRect","sz","beginPath","rect","fillStyle","timer","stop","_timer","clearInterval","rate","aabb_intersect_vs3","aabb_intersect_3d","min1","max1","min2","max2","aabb_union","aabb_union_2d","init_prototype","$_mh","$_swapt","COLINEAR","LINECROSS","COLINEAR_ISECT","_cross_vec1","_cross_vec2","SQRT2","FEPS_DATA","F16","F32","F64","FEPS","FLOAT_MIN","FLOAT_MAX","Matrix4UI","_static_grp_points4","_static_grp_points8","get_rect_points","cs","get_rect_lines","ps","$vs_simple_tri_aabb_isect","simple_tri_aabb_isect","isect","MinMax","totaxis","_min","_max","_static_mr_co","_static_mr_cs","minmax_rect","minmax","winding_axis","up_axis","xaxis","yaxis","x3","winding","zero_z","tol","dx1","dy1","dx2","inrect_2d","$ps_aabb_isect_line_2d","aabb_isect_line_2d","point_in_aabb_2d","point_in_aabb","line_line_cross","expand_rect2d","margin","expand_line","colinear","limit","distLimit","colinear2d","precise","dy2","_llc_l1","_llc_l2","_llc_l3","_llc_l4","lli_v1","lli_v2","lli_v3","lli_v4","_zero_cn","_tmps_cn","_rets_cn","corner_normal","vec1","vec2","normalizedDot","line_line_isect","test_segment","xa1","xa2","ya1","ya2","xb1","xb2","yb1","yb2","w1","w3","w4","_asi_v1","_asi_v2","_asi_v3","_asi_v4","_asi_v5","_asi_v6","_asi2d_v1","_asi2d_v2","_asi2d_v3","_asi2d_v4","_asi2d_v5","_asi2d_v6","aabb_sphere_isect_2d","mvec","dist_to_line_2d","asi_rect","aabb_sphere_isect_vs","aabb_sphere_isect","i3","aabb_sphere_dist","mindis","convex_quad","$e1_normal_tri","$e3_normal_tri","$e2_normal_tri","isNum","_normal_tri_rets","y3","z3","$n2_normal_quad","_q1","_q2","_q3","normal_quad_old","_len","_li_vi","line_isect","calc_t","vi","dt2l_v1","dt2l_v2","dt2l_v3","dt2l_v4","dt2l_v5","clip","closest_co_out","t_out","dt3l_v1","dt3l_v2","dt3l_v3","dt3l_v4","dt3l_v5","dist_to_line_sqr","px","py","pz","len2","dist_to_line","_cplw_vs4","_cplw_vs3","_cplw_vs2","wclip","znear","clip_line_w","_v1","_v2","zfar","doclip1","doclip","dozclip","_closest_point_on_line_cache","_closest_point_rets","_closest_tmps","_circ_from_line_tan_vs","_circ_from_line_tan_ret","circ_from_line_tan","_circ_from_line_tan2d_vs","_circ_from_line_tan2d_ret","circ_from_line_tan_2d","tanx1","tany1","div2","midx","midy","_gtc_e1","_gtc_e2","_gtc_e3","_gtc_p1","_gtc_p2","_gtc_v1","_gtc_v2","_gtc_p12","_gtc_p22","_get_tri_circ_ret","get_tri_circ","e1","e3","gen_circle","stfeps","df","verts","make_vert","make_edge","makeCircleMesh","gl","mesh","Mesh","verts1","verts2","make_face_complex","minmax_verts","__iter_v","__get_iter","__ival_v","unproject","ipers","iview","newvec","project","pers","view","_sh_minv","_sh_maxv","_sh_start","_sh_end","static_cent_gbw","get_boundary_winding","points","divideScalar","totw","round","PlaneOps","reset_axis","orig1","orig2","_isrp_ret","isect_ray_plane_rets","isect_ray_plane","planeorigin","planenormal","rayorigin","raynormal","po","pn","ro","rn","_old_isect_ray_plane","Mat4Stack","update_func","set_internal_matrix","identity","loadIdentity","tril_rets","lreport","trilinear_v3","boxverts","a1x","a1y","a1z","b1x","b1y","b1z","c1x","c1y","c1z","d1x","d1y","d1z","a2x","a2y","a2z","b2x","b2y","b2z","c2x","c2y","c2z","d2x","d2y","d2z","tril_co_rets","tril_co_tmps","tril_mat_1","tril_mat_2","wtable","pih_tmps","boxfaces_table","boxfaces_tmp","boxfacenormals_tmp","point_in_hex","boxfacecents","boxfacenormals","boxverts_tmp","trilinear_co","t3","du","dv","dw","bv","trilinear_co2","grad","totg","axis_error","orig","angle_tri_v3_rets","angle_tri_v3_vs","tri_angles","th1","th2","th3","angle_v2_temps","angle_v3_temps","angle_between_vecs","vcent","_clipdata","mime","_clipboards","hasFocus","clipboard","blob","Response","text","getClipboardData","desiredMimes","setClipboardData","ClipboardItem","Blob","colorSchemeType","docManualPath","docEditorPath","useNumSliderTextboxes","numSliderArrowLimit","simpleNumSliders","menusCanPopupAbove","menu_close_time","paranoidEvents","screenborders","areaContextPushes","allBordersMovable","doOnce","areaConstraintSolver","datapaths","lastToolPanel","domEventAddRemove","debugUIUpdatePerf","screenAreaPosSizeAccesses","buttonEvents","addHelpPickers","useAreaTabSwitcher","autoSizeUpdate","showPathsInToolTips","enableThemeAutoUpdate","useNativeToolTips","noElectronMenus","loadConstants","ctrlconfig.setConfig","cfg","innerText","PATHUX_CONFIG","compatMap","BoxMargin","BoxBG","BoxRadius","background","defaultWidth","defaultHeight","DefaultWidth","DefaultHeight","BoxBorder","BoxLineWidth","BoxSubBG","BoxSub2BG","DefaultPanelBG","InnerPanelBG","Background","numslider_width","numslider_height","ColorSchemeTypes","LIGHT","DARK","parsepx","css","alpha_override","css2color_rets","basic_colors","purple","color2web","tostr","css2color","part","hasAlpha","web2color","validate_pat","validateWebColor","validate_rgba","validate_rgb","validateCSSColor","rgba","theme","invertTheme","inverted","bg","CSSFont","iscolor","setColorSchemeType","_digest","_size","font","weight","variant","calcHashUpdate","util.isMobile","mobileTextSizeMultiplier","genCSS","genKey","exportTheme","theme1","addVarDecl","sortkeys","writekey","maxwid","copyTheme","_exportTheme","EventDispatcher","_cbs","_fireEvent","copyMouseEvent","_orig","exclude","DomEventTypes","on_mousemove","on_mousedown","on_mouseup","on_touchstart","on_touchcancel","on_touchmove","on_touchend","on_mousewheel","on_keydown","on_keyup","on_pointerdown","on_pointermove","on_pointercancel","on_pointerup","getDom","dom","eventtype","modalStack","isModalHead","owner","EventHandler","_modalstate","simple_events.pushPointerModal","pushModal","_is_root","simple_events.pushModalLight","popModal","simple_events.popModalLight","CurveConstructors","CURVE_VERSION","CurveFlags","TRANSFORM","TangentModes","SMOOTH","BREAK","getCurve","throw_on_error","_udigest","CurveTypeData","typeName","hasGUI","calcHashKey","redraw","makeGUI","container","killGUI","integrate","quadSteps","ds","derivative2","inverse","best","mid","ymid","onActive","draw_transform","onInactive","destroy","_on_change","draw","unitRange","evalHermiteTable","genHermiteTable","lastdv1","lastf3","eps","dt","f3","dv1","j2","DataFlags","USE_FULL_UNDO","USE_EVAL_MASS_SET_PATHS","DataTypes","DYNAMIC_STRUCT","PROP","propCacheRings","getTempProp","getClass","DataPathError","getVecClass","proptype","isVecProperty","toolprop_abstract.Vec2PropertyIF","toolprop_abstract.Vec3PropertyIF","toolprop_abstract.Vec4PropertyIF","toolprop.Vec2Property","toolprop.Vec3Property","toolprop.Vec4Property","DataPath","evalMassSetFilter","noUndo","setProp","readOnly","read_only","customPropCallback","propGetter","customGetSet","_getValue","_setValue","getSet","dataref","datapath","customSet","customGet","simpleSlider","rollerSlider","checkStrip","editAsBaseUnit","uiNameGetter","ui_name_get","speed","relativeStep","fullSaveUndo","icons","icons2","description_map","uiNames","uinames","StructFlags","ListIface","getStruct","getKey","getActive","setActive","getIter","ToolOpIface","toolpath","is_modal","outputs","DataAPIClass","notifier","setImplementationClass","registerTool","setNotifier","ContextFlags","IS_VIEW","InheritFlag","__idgen","ContextID","CachedDef","_ret_tmp","OverlayClasses","makeDerivedOverlay","ContextOverlay","appstate","_state","onRemove","have_new_file","def2","contextDefine","Context","parents","util.getClassParent","excludedKeys","LockedContext","noWarnings","toolstack","toLocked","warning","progbar","_props","wrapget","ctx2","loadProperty","getter","contextSystem","overlay","getOwningOverlay","saveProperty","defineProp","setContext","next_key","_stack","_inside_map","_fix","fix","perc","progbarNote","validateOverlays","stack2","hasOverlay","getOverlay","override","overrides","pushOverlay","_val_out","inside_map","ikey","__allKeys","ensureProperty","util.getAllKeys","popOverlay","removeOverlay","Test0","Test1","Test2","Test3","resolveDef","testInheritance","ToolClasses","setContextClass","_ToolClasses","ToolFlags","UndoFlags","IS_UNDO_ROOT","UNDO_BARRIER","HAS_UNDO_DATA","slots","defaultUndoHandlers","undoPre","undo","setDefaultUndoHandlers","ToolPropertyCache","pathmap","accessors","userSetMap","dstruct","_buildAccessors","tdef","_getFinalToolDef","partial","pathk","mapStruct","dpath","_getAccessor","tooldef","useDefault","getPropKey","ToolMacro","SavedToolDefaults","ToolOp","events.EventHandler","_pointerId","_overdraw","__memsize","undoflag","getSlots","lastp","slots2","dinputs","doutputs","hasDefault","getDefault","drawlines","getInputs","tool","_regWithNstructjs","toolop","on_tick","canRun","onUndoDestroy","calcUndoMem","loadDefaults","force","toolprop","saveDefaultInputs","genToolString","modalEnd","redo","_was_redo","execPre","execPost","exec_pre","resetTempGeom","modal_ctx","dl","getOverdraw","makeTempLine","node","modalStart","modalRunning","toolCancel","was_cancelled","_on_cancel","outs","ins","pair","_save_inputs","PropKey","_save_outputs","MacroLink","sourcetool_idx","srckey","srcprops","desttool_idx","dstkey","dstprops","source","sourceProps","destProps","sourcePropKey","destPropKey","MacroClasses","_MacroClasses","macroidgen","tools","curtool","has_modal","connects","connectLinks","_macro_class","_getTypeClass","ready","__tooldef","_macroTypeId","connect","srctool","srcoutput","dsttool","dstinput","connectCB","i1","_do_connections","on_modal_end","ToolStack","memLimit","enforceMemLimit","_undo_branch","limitMemory","maxmem","setRestrictedToolContext","toolctx","execOrRedo","compareInputs","Equals","rerun","tctx","execCtx","modal_running","save","rewind","replay","onStep","setTimeout","_save","buildToolOpAPI","makeProp","buildToolSysAPI","registerWithNStructjs","rootCtxStruct","rootCtxClass","insertToolDefaultsIntoContext","datastruct","dynamicStruct","inst","haveprop","isContextSubclass","last_tool_save","last_tool_load","toolDefaults_save","toolDefaults_load","_testToolStackIO","_appstate","vectormath.Vector2","SplineTemplates","CONSTANT","LINEAR","SHARP","SQRT","SMOOTHER","SHARPER","SPHERE","REVERSE_LINEAR","GUASSIAN","templates","SplineTemplateIcons","RecalcFlags","BASIS","FULL","FULL_BASIS","mySafeJSONStringify","mySafeJSONParse","bin_cache","_bin_cache","eval2_rets","bez3","bez4","binomial","bin","Curve1dBSplineOpBase","dataPath","_undo","curve1d","getCurve1d","Curve1dBSplineResetOp","generators","active","Curve1dBSplineLoadTemplOp","template","loadTemplate","Curve1dBSplineDeleteOp","deletePoint","Curve1dBSplineSelectOp","point","unique","bspline","Curve1dBSplineAddOp","addFromMouse","BSplineTransformOp","dpi","storePoints","loadPoints","rco","sco","recalc","updateKnots","cancel","fastmode","startco","xRange","yRange","Curve1DPoint","tangent","seal","deg","splineCache","BSplineCache","curves","maxCurves","cache_w","curve2","_last_cache_key","regen_basis","regen_hermite","_remove","_splineCache","_idgen","BSplineCurve","_bid","_degOffset","interpolating","_ps","hermite","basis_tables","eidgen","util.IDGen","uidata","no_update","_sortPoints","degExtra","hightlight","basis","_basis","empty","_evaluate","f4","solve_interpolating","_evaluate2","error1","totgs","_dbasis","safe_inv","bas","kn","knn","knn1","ki","dbas","start_t","miny","mins","mindx","xmin","xmax","sumx","sumy","totbasis","_wrapTouchEvent","isTouch","templ","drawTransform","onSourceUpdate","transpoints","transforming","draw_trans","bstrip","row","strip","makebutton","iconbutton","iconsheet","customIcon","fullUpdate","Icons","getIconEnum","LARGE_X","TINY_X","slider","simpleslider","last_deg","checked","onchange","start_transform","useSelected","transform_op","transform_mpos","do_highlight","highlight","minp","limitsqr","do_transform","getClientRects","trans","end_transform","_save_hook","lineWidth","strokeStyle","restore","highlightPoint","makeSplineTemplateIcons","moveTo","lineTo","ls","lineCap","stroke","toDataURL","img","splineTemplatesLoaded","initSplineTemplates","_SplineTemplateIcons","Curve1D","_eventCBs","uiZoom","clipToRange","VERSION","setGenerator","generatorType","_fastmode","cb_is_dead","dead","subscribed","_pruneEventCallbacks","evt","gen1","gen2","activeCls","oldGens","active_generator","localeCompare","getGenerator","switchGenerator","patchRange","overlay_curvefunc","_active","Task","taskcb","task","AnimManager","tasks","timeOut","onend","AbstractCommand","cbs","end_cbs","animator","WaitCommand","ms","GoToCommand","startValue","SetCommand","Command","Animator","method","commands","_done","wait","goto","timeMs","cmd","while","donecb","lexlen","PUTLParseError","print_tokens","print_debug","peek_i","getTraceBack","file","userdata","ToolPaths","initToolPaths_run","buildParser","valid_datatypes","STRLIT","NUMBER","Parser","parseToolPath","check_tool_exists","initToolPaths","startstr","toolclass","testToolParser","ModelInterface","prefix","getToolDef","getToolPathHotkey","createTool","constructor_argument","pushReportContext","popReportContext","massSetProp","mass_set_path","resolveMassSetPaths","resolvePath","ignoreExistence","rootStruct","subkey","use_range","ival","getDescription","rdef","validPath","getPropName","DataPathSetOp","propType","flagBit","useFlagBit","hadError","massSetPath","destType","value2","hashThis","__ctx","paths","feq","EquationCurve","equation","_last_equation","_last_xrange","_func","textbox","label","gui","updateTextBox","makeFunc","_haserror","cosh","sinh","cbrt","GuassianCurve","offset","deviation","hslider","oslider","dslider","Ease","linear","none","amount","getPowIn","getPowOut","getPowInOut","quadIn","quadOut","quadInOut","cubicIn","cubicOut","cubicInOut","quartIn","quartOut","quartInOut","quintIn","quintOut","quintInOut","sineIn","sineOut","sineInOut","getBackIn","backIn","getBackOut","backOut","getBackInOut","backInOut","circIn","circOut","circInOut","bounceIn","bounceOut","bounceInOut","getElasticIn","amplitude","period","pi2","elasticIn","getElasticOut","elasticOut","getElasticInOut","elasticInOut","ParamKey","BOOL_FLAG","SimpleCurveBase","defaultval","_saveParams","pdef","BounceCurve","decay","freq","phase","ElasticCurve","_last_hash","EaseCurve","mode_in","mode_out","amp","RandCurve","util.MersenneRandom","_seed","in_mode","Curve1DProperty","nstructjs.inherit","nstructjs.register","SocketFlags","UPDATE","NodeFlags","SORT_TAG1","SORT_TAG2","RUN","RESORT","SocketTypes","INPUT","OUTPUT","graphIdGen","EventSocket","uiName","edges","flagUpdate","isUpdated","copyFrom","sockb","flagResort","hasNode","disconnect","sock","NodeClasses","NodeCapable","graphNode","graphExec","EventNode","allsockets","graph","sortIndex","graphNodeDef","addSocket","getSockets","socks","socksDef","EventGraph","nodes","nodeIdMap","sockIdMap","sortlist","queueReq","skipQueueExec","eventNode","queueExec","dosort","socka","entries","theEventGraph","strBoolMap","true","false","yes","DependSocket","PropSocketModes","REPLACE","MIN","MAX","PropertySocket","mixMode","binding","oldValue","mixmode","Constraint","klst","glst","wlst","ks","ws","threshold","funcDv","postSolve","no_dvs","gs","Solver","constraints","gk","simple","randCons","con","solveStep","cons","ci","ri","solveStepSimple","solve","printError","saveFile","exts","URL","createObjectURL","loadFile","readAsArrayBuffer","_testLoadFile","_testSaveFile","createFile","rgb_to_hsv_rets","rgb_to_hsv","computedH","computedS","computedV","minRGB","maxRGB","hsv_to_rgb_rets","hsv_to_rgb","RgbF_Create","rgb_to_cmyk_rets","cmyk_to_rgb_rets","cmyk_to_rgb","rgb_to_cmyk","M","Y","var_K","K","PackNodeVertex","_absPos","absPos","PackNode","vel","oldpos","copyGraph","idmap","getCenter","loadGraph","graphGetIslands","islands","visit1","island","graphPack","margin_or_args","updateCb","orignodes","decayi","nodemap","disableEdges","edge_c","restlen","loadBoxes","margin1","lasterr","besterr","disableArea","area_c","math.aabb_overlap_area","fakeVerts","fv","solveStep1","solver","rlen","rfac","boxPacker","parseutil.PUTLParseError","parseutil.tokdef","parseutil.lexer","pathParser","parseutil.parser","parserStack","tool_classes","tool_idgen","toolkey","ToolID","lt","lastmsg","lcount","reportstack","pushReportName","util.console","popReportName","DataList","getLength","DataStruct","members","inheritFlag","default_struct","existing_struct","setter","color3","vec3","toolprop.PropSubTypes","color4","vec4","arrayList","structdef","color3List","vectorList","color4List","pstruct","toolprop.BoolProperty","toolprop.FloatProperty","textblock","toolprop.StringProperty","toolprop.ReportProperty","toolprop.IntProperty","enum","toolprop.EnumProperty","funcs","flags","toolprop.ToolProperty","toolprop.FlagProperty","fromToolProp","_map_struct_idgen","_map_structs","_debug__map_structs","_dummypath","DummyIntProperty","CLS_API_KEY","CLS_API_KEY_CUSTOM","DataAPI","rootContextStruct","getStructs","setRoot","sdef","hasStruct","mergeStructs","inheritStruct","auto_create_parent","_addClass","mapStructCustom","auto_create","suffix","applyFilter","forceEval","$","inpath","resolvePath_intern","getPropOverride","datactx","newprop","lastobj2","lastkey","lastdpath","lastobj","p_key","dynstructobj","act","actkey","fakeprop","val1","bitfield","_parsePathOverrides","hotkey","getToolPathHotkey_intern","searchKeymap","sareas","getActiveArea","getKeyMaps","parseToolArgs","tpath","invoke","initSimpleController","dpt","getDataPathToolOp","setDataPathToolOp","DefaultTheme","AreaHeaderBG","BasePackFlag","BoxDepressed","BoxHighlight","mobileSizeMultiplier","DefaultText","LabelText","TitleText","oneAxisPadding","padding","disabled","pressed","checkbox","CheckSide","colorfield","circleSize","colorBoxHeight","fieldSize","hueHeight","colorpickerbutton","curvewidget","CanvasBG","CanvasHeight","CanvasWidth","dropbox","dropTextBG","depressed","iconcheck","drawCheck","listbox","ListActive","ListHighlight","menu","MenuBG","MenuBorder","MenuHighlight","MenuSeparator","border","MenuSpacing","MenuText","notification","ProgressBarBG","ProgressBar","numslider","numslider_simple","SlideHeight","TextBoxWidth","labelOnTop","addLabel","numslider_textbox","TextBoxHeight","panel","HeaderBorderRadius","HeaderRadius","TitleBackground","TitleBorder","richtext","screenborder","scrollbars","color2","contrast","sidebar","tabs","TabPadding_mobile","TabPadding","TabActive","TabBarRadius","TabHighlight","TabInactive","TabStrokeStyle1","TabStrokeStyle2","TabText","tooltip","ToolTipText","treeview","itemIndent","rowHeight","vecPopupButton","setIconMap","FOLDER","FILE","SMALL_PLUS","SMALL_MINUS","UNDO","REDO","HELP","UNCHECKED","CHECKED","LARGE_CHECK","CURSOR_ARROW","NOTE_EXCL","SCROLL_DOWN","SCROLL_UP","BACKSPACE","LEFT_ARROW","RIGHT_ARROW","UI_EXPAND","UI_COLLAPSE","BOLD","ITALIC","UNDERLINE","STRIKETHRU","TREE_EXPAND","TREE_COLLAPSE","ZOOM_OUT","ZOOM_IN","ENUM_CHECKED","ENUM_UNCHECKED","UIBase","_setUIBase","uibase","AspectKeys","_ui_base","TextBox","initAspectClass","blacklist","validProperty","descr","getOwnPropertyDescriptor","__aspect_methods","AfterAspect","clearAspectCallbacks","chain","chain2","root","_method","isDead","_method_bound","_checkbind","before","_setTextboxClass","ElementClasses","__cconst","vectormath.Vector4","Area","_setAreaClass","ErrorColors","WARNING","ERROR","OK","__theme","registered_has_happened","tagPrefix","EventCBSymbol","calcElemCBKey","setTagPrefix","getTagPrefix","class_idgen","setTheme","theme2","k3","_last_report","IsMobile","marginPaddingCSSKeys","_IconManager","tilesize","number_of_horizontal_tiles","drawsize","tilex","customIcons","onReady","util.TimeoutPromise","canvasDraw","getDPI","setCSS","fitsize","getCSS","ratio","blobUrl","CustomIcon","baseImage","images","regenIcons","doSheet","toBlob","iconsheets","IconManager","sizes","horizontal_tile_count","customIconIDMap","isReady","addCustomIcon","maxid","manager2","findSheet","findClosestSheet","sheets","minsheet","goal","getTileSize","getRealSize","iconmanager","_iconmanager","IconSheets","SMALL","LARGE","XLARGE","iconSheetFromPackFlag","PackFlags","CUSTOM_ICON_SHEET","CUSTOM_ICON_SHEET_START","SMALL_ICON","getIconManager","setIconManager","IconSheetsOverride","makeIconDiv","icontest","vectormath.Matrix4","dpistack","UIFlags","internalElementNames","externalElementNames","INHERIT_WIDTH","INHERIT_HEIGHT","VERTICAL","LARGE_ICON","FORCE_PROP_LABELS","PUT_FLAG_CHECKS_IN_COLUMNS","WRAP_CHECKBOXES","STRIP_HORIZ","STRIP_VERT","STRIP","SIMPLE_NUMSLIDERS","HIDE_CHECK_MARKS","NO_NUMSLIDER_TEXTBOX","NO_UPDATE","LABEL_ON_RIGHT","_mobile_theme_patterns","styleScrollBars","selector","inv","_testSetScrollbars","CTX","mergeGlobalCSS","calcThemeKey","_themeUpdateKey","flagThemeUpdate","_flagThemeUpdate","setTimeoutQueue","haveTimeout","_mc","timeout_cb","internalSetTimeout","HTMLElement","customElements","reflagGraph","depend","isNumArray","changed","ensureGraph","flagPropSocketUpdate","getPropertySocket","socktype","sockets","ensurePropertySocket","dependsOn","dstProp","srcProp","srcCallback","dstCallback","sockdst","socksrc","_modalstack","_tool_tip_abort_delay","_tooltip_ref","_textBoxEvents","_themeOverride","_checkTheme","_last_theme_update_key","_client_disabled_set","_useNativeToolTips","_useNativeToolTips_set","_has_own_tooltips","_tooltip_timer","pathUndoGen","_lastPathUndoGen","_useDataPathUndo","_active_animations","_screenStyleTag","_screenStyleUpdateHash","shadow","attachShadow","__cbs","_appendChild","parentWidget","_wasAddedToNodeAtSomeTime","visibleToPick","_override_class","tagname","default_overrides","my_default_overrides","class_default_overrides","_last_description","_description_final","_modaldata","packflag","_internalDisabled","__disabledState","_disdata","_ctx","_description","textContent","_getFont","_init_done","do_touch","MouseEvent","havePickClipboard","_clipboardHotkeyInit","_parentWidget","useDataPathUndo","hasAttribute","getAttribute","title","__background","overrideDefault","__updateDisable","internalDisabled","_forEachChildWidget","_reportCtxName","element","internal","setUndo","hidden","hide","sethide","contents","unhide","findArea","_cb2","connectedCallback","noMarginsOrPadding","regenTabOrder","getScreen","needsTabRecalc","noMargins","noPadding","getTotalRect","doaabb","rs","parseNumber","units.parseValue","formatNumber","units.buildString","setBoxCSS","getSubDefault","genBoxCSS","boxcode","setBG","zoom","getZoom","transform","transform2","flushSetCSS","_init","replaceChild","newnode","swapWith","parentNode","getPos","tmp1","insertBefore","ptmp","traverse","type_or_set","is_set","_clipboard_over","_last_clipboard_keyevt","_clipboard_keystart","_clipboard_events","_clipboard_keydown","_clipboard_keyend","internal_mode","is_copy","is_paste","pickElement","checkTree","pasteForAllChildren","copyForAllChildren","clipboardCopy","clipboardPaste","tabIndex","_ondestroy","ondestroy","trigger_on_destroy","on_remove","removeChild","flushUpdate","checkInit","getWinWidth","getWinHeight","calcZ","marginy","nodeclass","excluded_classes","mouseEvent","isMouseMove","scrollX","scrollY","elementFromPoint","lastelem","reverse","getBoundingClientRect","clip2","math.aabb_intersect_2d","defaults","on_disabled","on_enabled","pointerElem","_areaWrangler","bindFunc","handlers2","_flash_focus","focus","flash","rect_element","timems","autoFocus","csscolor","_flashtimer","_flashcolor","tick","PositionKey","_enterPopupSafe","_exitPopupSafe","on_resize","newsize","getPathValue","undoBreakPoint","setPathValueUndo","pathSocketUpdate","loadNumConstraints","onModifiedCallback","modified","getPathMeta","loadAttr","propkey","domkey","thiskey","oldmin","oldmax","oldint","oldedit","setPathValue","getPathDescription","_doOnce","_doOnce_reqs","zindex","positionKey","_ensureChildrenCtx","checkThemeUpdate","abortToolTips","delayMs","stop_timer","updateToolTipHandlers","start_timer","reset_timer","start_events","reset_events","stop_events","bind_handler","etype","lists","updateToolTips","_ToolTip","show","updateEventGraph","subclassChecksTheme","saveData","loadData","localOnly","overrideClass","overrideClassDefault","_doMobileDefault","mobilekey","hasClassDefault","hasSubDefault","_hasSubDefault","getStyleClass","hasClassSubDefault","_hasClassSubDefault","themeDef","parentStyle","backupkey","checkForMobile","getDefault_intern","getClassDefault","themeobj","overrideTheme","getStyle","animate","_extra_handlers","domAnimateOptions","DOMMatrix","update_trans","background_get","background_set","dx_get","dx_set","dy_get","dy_set","pixkeys","makePixHandler","proxy","receiver","anim","abortAnimations","drawRoundBox2","drawRoundBox","no_clear","_background","quadraticCurveTo","closePath","_getFont_new","do_dpi","getFont","_ensureFont","get_measure_canvas","measureTextBlock","measureText","HTMLCanvasElement","drawText","fillText","PIDX","PSHADOW","PTOT","saveUIData","ni","is_shadow","path2","_ui_version","loadUIData","_saveUIData","_loadUIData","aspect._setUIBase","events.keymap","toolprop.PropTypes","ui_base.UIBase","ui_base.PackFlags","ui_base.IconSheets","ui_base.parsepx","ButtonEventBase","_auto_depress","_highlight","_pressed","bindEvents","depress","_redraw","onclick","_onpress","onpress","captured","blur","_focus","Button","_pressedTime","_pressedTimeout","_last_name","_last_disabled","__pressed","updateDisabled","OldButton","_last_but_update_key","_name","_namePad","_leftPad","_rightPad","_last_w","_last_h","_last_dpi","_lastw","_lasth","_last_bg","updateName","updateWidth","old_bindEvents","_repos_canvas","updateDefaultSize","cssHeight","_calcUpdateKey","updateDPI","updateBorders","tw","ui_base.measureText","_genLabel","lwid","w_add","h2","_getSubKey","draw_text","ui_base.drawRoundBox","lw","_draw_text","ui_base.drawText","TextBoxBase","modalKeyEvents","_editing","_width","_had_error","_change","oninput","isModal","_startModal","_modal","_endModal","startSelected","realtime","select","keydown","on_keypress","editing","_updatePathVal","bwid","bcolor","updateDataPath","is_num","is_int","_prop_update","units.isNumber","ui_base.ErrorColors","checkForTextBox","draggable","ui_base._setTextboxClass","IconLabel","_icon","ui_base.iconmanager","ValueButtonBase","_value","Check","_checked","span","mup","mover","mleave","_label","prepend","_updatekey","csize","ui_base.Icons","ui_base.getIconManager","updatekey","IconButton","_customIcon","_draw_pressed","_icon_pressed","drawButtonBG","_extraIcon","extraDom","_last_iconsheet","domImage","_on_press","_on_depress","loadstyle","addpx","high","unhigh","_getsize","IconCheck","_drawCheck","updateDrawCheck","_updatePressed","noEmboss","Check1","getpx","debugmenu","Menu","parentMenu","_was_clicked","autoSearchMode","_ignoreFocusEvents","closeOnMouseUp","_submenu","ignoreFirstClick","itemindex","closed","started","activeItem","menustyle","buildStyle","maxx","maxy","_isMenu","onselect","close","menuWrangler","popMenu","onclose","_popup","_select","dir","hasSearchBox","scrollIntoView","selectPrev","selectNext","start_fancy","startFancy","pushMenu","dom2","sbox","dokey","addItemExtra","icon_div","ui_base.makeIconDiv","ui_base.getFont","hwid","twid","hotkey_span","addItem","li","_menu","onfocus","_getBorderStyle","pad1","boxShadow","sepcss","itemRadius","seperator","bar","calcSize","SEP","DropBox","lockTimer","_template","_searchMenuMode","_last_datapath","searchMenuMode","setDefault","wasError","_last_dbox_key","_build_menu_template","createMenu","_build_menu","_dropbox","valmap","enummap","uimap","desr","uk","callProp","_convertVal","rects","rheight","haveElectron","popup","ui_base.drawRoundBox2","setLabelOnly","MenuWrangler","menustack","lastPickElemTime","_closetimer","closereq","closetimer","spawnreq","endMenus","searchKeyDown","previousElementSibling","nextElementSibling","findMenu","menu2","closetime","startTimer","stopTimer","_menuWrangler","wrangerStarted","startMenuEventWrangling","setWranglerScreen","getWranglerScreen","doItem","id2","cbfunc","arg","startMenu","safetyDelay","_startMenuEventWrangling","_ui","toolprop.PropFlags","Label","_lastText","_font","fontDefaultName","_updateFont","_enabled_font","_last_font","Container","dataPrefix","massSetPrefix","inherit_packflag","styletag","reversed","_prefixstack","_mass_prefixstack","children","changePathPrefix","newprefix","_joinPrefix","pushMassSetPrefix","pushDataPrefix","popDataPrefix","popMassSetPrefix","scrollTop","scrollLeft","scrollTo","useIcons","enabled_or_sheet","enabled","previous","wrap","rest","themeClass_or_obj","margin2","horiz","themeClass","RowFrame","bradius","bline","bstyle","oneAxisMargin","axisPadding","otherPadding","setMargin","setPadding","setSize","saveVisibility","localStorage","storagePrefix","loadVisibility","opened","redrawCurves","listen","on_destroy","_prepend","_add","insert","NodeList","dynamicMenu","dbox","_container_inherit","toolPanel","path_or_cls","createCb","create_cb","defaultsPath","packflag_or_args","toolob","pathlabel","helppicker","hintPickerTool","colorbutton","_getMassPath","noteframe","vecpopup","textarea","checkenum","listenum","col1","col2","wrapChars","isrow","rebuild","last_hash","frame","checks","ignorecb","makecb","checkenum_panel","enumDef","getroot","do_redraw","setHeaderToolTip","twocol","parentDepth","colorPicker","themeOverride","colorpicker","viewer","asDialogFooter","ColumnFrame","TwoColumnFrame","_colWidth","colWidth","Note","_noteid","showExclMark","append","setLabel","mark","ntext","clr","ProgBarNote","_percent","barWidth","bar2","percent","NoteFrame","ui.RowFrame","_h","noteframes","note","addNote","getNoteFrames","sendNote","ui_base.color2css","_sendNote","RichEditor","textOnlyMode","controls","makeicon","execCommand","contentEditable","toggleStrikeThru","ta","getSelection","startNode","getRangeAt","anchorNode","anchorOffset","InputEvent","CustomEvent","formatStart","formatLine","formatEnd","rc","RichViewer","hideScrollBars","showScrollBars","textTransform","VectorPopupButton","VectorPanel","sliders","makeParam","_getNumParam","_setNumParam","__range","_range","vp","uslider","uniformValue","vertical","doupdate","loadNumParam","do_rebuild","ToolTip","_start_time","_estimateSize","ui_base.measureTextBlock","bwidth","toolstack_getter","registerToolStackGetter","vectormath.Vector3","simple_toolsys.UndoFlags","simple_toolsys.ToolFlags","ToolBase","simple_toolsys.ToolOp","_finished","overdraw","modaldata","AreaResizeTool","side","_side","_borders","RESIZE","getBorders","borders","otherVertex","snapScreenVerts","regenBorders","loadFromVerts","isBorderMovable","oldv1","oldv2","badcount","snapMode","moveBorder","outer","solveAreaConstraints","updateDebugBoxes","_fireResizeCB","SplitTool","canceled","splitArea","_internalRegenAll","RemoveAreaTool","collapseArea","AreaDragTool","dropArea","excludeAreas","cursorbox","boxes","TRANSLATE","_recalcAABB","getBoxRect","sa","doSplit","doSplitDrop","can_rip","floating","areasBorder","expand","removeArea","minmaxArea","editors","editormap","areaname","on_area_inactive","editor","editor2","owning_sarea","switcher","replaceArea","loadFromPosSize","nsa","makeBoxes","hcolor","box","curbox","setColor","getActiveBox","on_drag","on_dragend","wid","AreaMoveAttachTool","start_mpos2","start_pos","ToolTipViewer","pick","Keymap","ele","tip","AreaFlags","HIDDEN","FLOATING","INDEPENDENT","NO_SWITCHER","NO_HEADER_CONTEXT_MENU","NO_COLLAPSE","SnapLimit","BORDER_ZINDEX_BASE","snap","snap_limit","snapi","ScreenVert","added_id","ScreenHalfEdge","ScreenBorder","_hash","halfedges","_innerstyle","_style","inner","call_menu","bindBorderMenu","movable","FrameManager_ops.AreaResizeTool","usePickElement","on_dblclick","splitTool","removeAreaTool","popupMenu","getOtherSarea","he","_verts","borderLock","valence","sv","a0x","a0y","cursor","alpha","innerbuf","sbuf","_ScreenArea","_contextWrangler","BorderMask","LEFT","BOTTOM","RIGHT","TOP","BorderSides","inactive","areaDragToolEnabled","_area_id","minSize","maxSize","areas","onover","_get_v_suffix","on_fileload","isActiveEditor","buildDataPath","idx1","idx2","areaName","oldsize","on_area_focus","on_area_blur","on_area_active","dontSetLastRef","getBarHeight","header","makeAreaSwitcher","makeAreasEnum","switch_editor","makeHeader","add_note_area","make_draggable","switcherRow","helpRow","callmenu","notef","eventdom","mpre","last_time","do_mousemove","mdown2","areaDragTool","_isDead","afterSTRUCT","ui_base.loadUIData","saved_uidata","_getSavedUIData","ui_base.saveUIData","ScreenArea","_flag","_sarea_id","_pos","wrapVector","bringToFront","snapToScreenSize","freeBorder","makeBorders","getScreenVert","getScreenBorder","existing","switchEditor","moved","checkAreaConstraint","owining_sarea","ui_base._setAreaClass","ThemeEditor","categoryMap","build","doFolder","catkey","help","row2","do_onchange","completeSetCSS","completeUpdate","getpath","cw","setRGBA","panel2","tbox","catkey2","categories","cat","category","strcmp","sliderDomAttributes","updateSliderFromDom","SliderDefaults","NumberSliderBase","skip","NumSlider","_last_label","ma","_last_overarrow","removeAttribute","_last_width","updateConstraints","swapWithTextbox","onmousedown","overArrow","_on_click","dragStart","setMpos","rwidth","rx","szmargin","_getArrowSize","doRange","fire_onchange","setDataPath","checkConstraints","over","last_background","util.MovingAvg","startvalue","startx","sumdelta","fire","dvalue","dsign","on_pointerout","on_pointerover","restore_value","unused_setBG","fromRedraw","fromCSS","backupval","subkey2","boxbg","arrowcolor_base","arrowcolor","parseArrowColor","NumSliderSimpleBase","modal","_last_slider_key","_setFromMouse","_getButtonPos","_invertButtonX","makefunc","pointermove","pointerover","pointerout","pointerleave","pointerenter","pointerup","updateSize","setHighlight","isOverButton","sh","arc","setLineDash","boxw","SliderWithTextbox","_lock_textbox","_labelOnTop","_last_label_on_top","_numslider","_last_value","realTimeTextBox","apply_textbox","linkTextBox","in_onchange","updateLabelOnTop","NumSliderSimple","NumSliderWithTextBox","pagecache","domTransferAttrs","domEventAttrs","parseXML","xml","DOMParser","parseFromString","num_re","getIconFlag","attr","isnum","getPackFlag","getbool","myParseFloat","getfloat","customHandlers","Handler","codefuncs","templateVars","attrs","inheritDomAttrs","inheritDomAttrKeys","XMLDocument","nodeName","tree","Text","Comment","elem2","__elem","getAttributeNames","_container","_basic","pathux_ctx","rule","selectorText","styleMap","stylecode","setStyle","_getattr","codeattrs","eventType","sliderMode","doBox","_handlePathPrefix","ignorePathPrefix","cell","_prop","_codelem","$scope","templateScope","mpath","column","iconflags","noIcons","isDropBox","initPage","parentContainer","loadPage","parentContainer_or_args","loadSourceOnly","modifySourceCB","fetch","makeGenEnum","Curve1DWidget","_on_draw","checkCurve1dEvents","_gen_type","_lastGen","bspline1","bspline2","clipCheck","ymin","ymax","last_update_key","_lastu","updateGenUI","forward_keys","PanelFrame","titleframe","_panel","_closed","headerLabel","__label","_updateClosed","bs","defval","header_radius","boxmargin","paddingleft","paddingright","margintop","marginbottom","marginleft","marginright","_setVisible","_onchange","isClosed","noUpdateClosedContents","display","makeForward","UPW","VPW","sample_rets","inv_sample","colorClipboardCopy","getRGBA","colorClipboardPaste","fieldrand","huefields","getHueField","ImageData","rgb","putImageData","getFieldImage","fieldsize","hsva","width2","height2","fieldsize2","hue","valpow","x2sat","y2val","sat2x","val2y","image2","_update_temp","SimpleBox","HueField","setFromXY","_getPad","hsv","rselector","r_circle","SatValField","_getField","sat","force_update","globalAlpha","ColorField","ui.ColumnFrame","_recalcRGBA","_lastThemeStyle","satvalfield","huefield","setCMYK","setHSVA","getCMYK","_in_update","updateThemeOverride","ColorPicker","colorsPanel","cssText","_no_update_textbox","_setSliders","cmyk","makeCMYKSlider","_setDataPath","colorbox","updateColorBox","ColorPickerButton","_depress","customLabel","labelDom","noLabel","leave","widget","cellsize","totx","toty","verboseDataPath","_last_key","tab_idgen","FAKE_TAB_ID","TabDragEvent","TabItem","tbar","ontabclick","ontabdragstart","ontabdragmove","ontabdragend","helper","extraSize","abssize","abspos","sendEvent","forwardEvent","Event","ModalTabMove","droptarget","dragtab","dragstate","finished","dragcanvas","on_pointerenter","on_pointerleave","on_pointerstart","on_pointerend","_on_move","_dragstate","DragEvent","dragevent","disty","dragok","dataTransfer","DataTransfer","dragimg","g2","drag_g","ti","prev","swapTabs","defaultPrevented","TabBar","movableTabs","tabFontScale","_last_style_key","_last_pos","_doelement","mx","my","_domouse","_fireOnSelect","_doclick","ht","acte","_startMove","updatePos","_ensureNoModal","_tool","edom","_makeOnSelectEvt","getTab","name_or_id","taborder","ntabs","ai","bi","addIconTab","addTab","updateCanvas","tsize","_layout","hpad","iconsize","have_icons","ry","makeTabWatcher","watcher","haveTabDom","_size_cb","noSwitch","preventScroll","focusVisible","activecolor","ypad","worig","removeTab","updateStyle","_last_p_key","TabContainer","_remakeStyle","_last_horiz","_last_bar_pos","_tab","enableDrag","flexDir","bgcolor","icontab","tab2","defineTabEvent","getTabCount","moveTab","updateBarPos","barpos","updateHoriz","TableRow","td","TableFrame","maketd","_tr","_bg","ListItem","setBackground","unhighlight","shadowRoot","is_active","ListBox","onkeydown","removeItem","scrollIntoViewIfNeeded","ProgressCircle","animreq","startTime","flagRedraw","onkey","oncancel","requestAnimationFrame","dth","endTimer","LastKey","getLastToolStruct","_last_tool","last_tool_eventmap","unlinkEvents","needsRebuild","LastToolPanel","ignoreOnChange","on_change","_tool_id","getToolStackHead","buildTool","last_tool","mimeMap","svg","txt","html","cpp","cc","hh","hpp","mjs","cjs","gif","textMimes","isMimeText","getExtension","getMime","PlatformAPI","href","FileDialogArgs","savedata_cb","multi","addToRecentList","filters","FilePath","platform","getPlatformAsync","mod","resolve","electron_api$1","web_api","_nativeTheme","getNativeTheme","remote","getElectron","nativeTheme","ipcRenderer","getElectronVersion","require","myRequire","getFilename","_menu_init","electron_menu_idgen","ElectronMenu","_ipcId","initElectronIpc","closePopup","wrapRemoteCallback","keybase","ipcInit","_themeSource","themeSource","ElectronMenuItem","patchDropBox","emenu","buildElectronMenu","shouldUseDarkColors","iconcache","makeIconKey","invertColors","getNativeIcon","icongen","nativeImage","GetRequiredICOImageSizes","writeFileSync","CTRL","ALT","SHIFT","COMMAND","buildElectronHotkey","buildItem","submenu","accelerator","registerAccelerator","initMenuBar","menuEditor","_roles","roles","edit","app","setApplicationMenu","eargs","defaultPath","_sanitizeFilters","properties","cancelled","filePaths","filters2","extensions","filedata_cb","filePath","filedata","fs","readFileSync","SVG_URL","CanvasOverdraw","shapes","otherChildren","zindex_base","createElementNS","Overdraw","cssPosition","drawTextBubbles","texts","colors","elems","pat","minsize","grads","startpos","box1","box2","circle","TreeItem","treeParent","treeChildren","treeView","treeDepth","_icon1","_icon2","_labelText","_open","_close","TreeView","strokes","updateOverdraw","_forAllChildren","_makeStrokes","ox","oy","rowh","getx","math.MinMax","od","startDrag","lastx","lasty","hx","hy","DragBox","DELETE","iconenum","_onend","ignore","_FrameManager","dockerdebug","areadocker","testSnapScreenVerts","unlisten","propsbar","AreaDocker","_last_update_key","ignoreChange","getArea","switcherData","tab_onchange","detach","addicon","on_addclick","loadTabData","floatArea","moveAttachTool","addTabMenu","getInternalName","area2","areaId","newarea","parentw","newparentw","newparent","ud","makePopupArea","area_class","addEscapeKeyHandler","ScreenArea.Area","ui_menu.startMenuEventWrangling","_events_started","FrameManager_ops.registerToolStackGetter","ui_base.styleScrollBars","update_stack","screen_idgen","get_screen_cb","_on_keydown","purgeUpdateStack","snapLimit","fullScreen","globalCSS","_do_updateSize","_resize_callbacks","needsBorderRegen","_popup_safe","testAllKeyMaps","_screen_id","_popups","screenverts","_vertmap","_edgemap","_idmap","_aabb","dragging","sx","sy","ScreenArea.ScreenArea","listening","listen_timer","schedule_resize","setPosSize","setPos","sheet2","rule2","desc","writable","sval","insertRule","CSSStyleSheet","replaceSync","tag","newScreenArea","sarea2","_allAreas","owning_node","elem_or_x","closeOnMouseOut","popupDelay","draggablePopup","touchpick","mousepick","bad_time","last_pick_time","do_timeout","calcTabOrder","popupArea","trigger_destroy","checkCSSSize","getBoolAttribute","outerHeight","customWindowSize","_DEBUG","_calcSizeKey","_last_ckey1","ui_menu.setWranglerScreen","startEvents","ui_menu.getWranglerScreen","second_pass","__pass","__destroyed","_test_save","getHotKey","execKeyMap","handled","activeElement","__pos","drawUpdate","redraw_all","move","_update_gen","update_intern","updateScrollStyling","_last_scrollstyle_key","popups","cssTextHash","util.strhash","SCOPE_POP","AREA_CTX_POP","scopestack","areastack","regenScreenMesh","regenBorders_stage2","has_he","border2","walkBorderLine","he2","hasBorder","killScreenVertex","dels","killBorder","del","isBorderOuter","_get_debug_overlay","_debug_overlay","wadd","checkOnly","chg","sidea","sideb","dh","bad2","ret2","moveBorderWithoutVerts","halfedge","strict","moveBorderSimple","moveBorderUnused","FrameManager_mesh.SnapLimit","snapArgument","repeat","fitToSize","_set_key","offx","offy","olds","sides","sb","sarea1","_updateAll","_has_evts","onblur","FrameManager_ops.ToolTipViewer","FrameManager_ops.RemoveAreaTool","FrameManager_ops.AreaMoveAttachTool","FrameManager_ops.SplitTool","FrameManager_ops.AreaDragTool","cleanupBorders","mergeBlankAreas","blank","test_struct","screen2","parentElement","ScreenArea.setScreenClass","start_cbs","stop_cbs","keyboardDom","key_event_opts","getScreenFunc","stopEvents","setKeyboardDom","setKeyboardOpts","opts","_onEventsStart","_onEventsStop","sidebar_hash","SideBar","_last_resize_key","closeIcon","_openWidth","needsSetCSS","tabbar","Editor","strct","makeMenuBar","makeSideBar","iconSvg","loadDefaultIconSheet","iconSheet","FileHeader","version_major","version_minor","version_micro","schema","FileFull","objects","FileArgs","doScreen","resetOnLoad","useJSON","fileFlags","fromFileOp","EmptyStruct","saveFilesInJSON","ob","istruct","screenClass","MenuBarEditor","updateHeight","_height","electron_api","flagRebuild","menuRow","registerMenuBarEditor","SimpleAppNewOp","createNewFile","SimpleAppSaveOp","forceDialog","fileExt","startArgs","platform.platform","showSaveDialog","currentFileRef","SimpleAppOpenOp","showOpenDialog","readFile","DataModelClasses","DataModel","EmptyContextClass","GetContextClass","ctxClass","OverlayDerived","Overlay","toolDefaults","ui_noteframe.message","ui_noteframe.error","ui_noteframe.warning","progressBar","ui_noteframe.progbarNote","defineAPI","makeAPI","StartArgs","singlePage","iconSizes","iconTileSize","iconsPerRow","registerSaveOpenOps","SimpleScreen","AppState","_ctxClass","fileMagic","fileVersion","_fileExt","_fileExtSet","defaultEditorClass","makeScreen","saveFileSync","loadFileSync","ensureMenuBar","args2","methodsCheck","SimpleContext","getWebFilters","controller.setNotifier","ui_noteframe","showOpenFilePicker","multiple","createWritable","showSaveFilePicker","showSaveDialog_old","fname","saveHandle","handle1","savedata","getFile","arrayBuffer"],"mappings":"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"}