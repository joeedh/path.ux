{"version":3,"file":"pathux.min.js","sources":["../scripts/path-controller/util/polyfill.js","../scripts/path-controller/util/nstructjs_es6.js","../scripts/path-controller/util/mobile-detect.js","../scripts/path-controller/extern/lz-string/lz-string.js","../scripts/path-controller/util/util.js","../scripts/path-controller/util/vectormath.js","../scripts/path-controller/toolsys/toolprop_abstract.js","../scripts/core/units.js","../scripts/path-controller/config/config.js","../scripts/path-controller/util/simple_events.js","../scripts/path-controller/util/events.js","../scripts/path-controller/curve/curve1d_base.js","../scripts/path-controller/curve/curve1d_bspline.js","../scripts/path-controller/curve/curve1d_basic.js","../scripts/path-controller/curve/ease.js","../scripts/path-controller/curve/curve1d_anim.js","../scripts/path-controller/curve/curve1d.js","../scripts/path-controller/toolsys/toolprop.js","../scripts/core/ui_consts.js","../scripts/screen/area_wrangler.js","../scripts/path-controller/util/math.js","../scripts/config/const.js","../scripts/core/ui_theme.js","../scripts/core/anim.js","../scripts/path-controller/util/parseutil.js","../scripts/path-controller/controller/controller_base.js","../scripts/path-controller/toolsys/toolsys.js","../scripts/path-controller/toolsys/toolpath.js","../scripts/path-controller/controller/controller_abstract.js","../scripts/path-controller/controller/controller_ops.js","../scripts/path-controller/controller/controller.js","../scripts/path-controller/util/colorutils.js","../scripts/core/theme.js","../scripts/icon_enum.js","../scripts/core/aspect.js","../scripts/core/ui_base.js","../scripts/widgets/ui_button.js","../scripts/widgets/ui_textbox.js","../scripts/widgets/ui_widgets.js","../scripts/path-controller/util/html5_fileapi.js","../scripts/widgets/ui_menu.js","../scripts/core/ui.js","../scripts/widgets/ui_noteframe.js","../scripts/widgets/ui_richedit.js","../scripts/widgets/ui_widgets2.js","../scripts/screen/FrameManager_ops.js","../scripts/screen/FrameManager_mesh.js","../scripts/screen/ScreenArea.js","../scripts/widgets/theme_editor.js","../scripts/widgets/ui_numsliders.js","../scripts/xmlpage/xmlpage.js","../scripts/path-controller/curve/curve1d_utils.js","../scripts/widgets/ui_curvewidget.js","../scripts/widgets/ui_panel.js","../scripts/widgets/ui_colorpicker2.js","../scripts/widgets/ui_tabs.js","../scripts/widgets/ui_table.js","../scripts/widgets/ui_listbox.js","../scripts/widgets/ui_progress.js","../scripts/widgets/ui_lasttool.js","../scripts/path-controller/util/solver.js","../scripts/path-controller/util/graphpack.js","../scripts/path-controller/controller/context.js","../scripts/platforms/platform_base.js","../scripts/platforms/platform.js","../scripts/platforms/electron/electron_api.js","../scripts/util/ScreenOverdraw.js","../scripts/widgets/ui_treeview.js","../scripts/widgets/dragbox.js","../scripts/screen/AreaDocker.js","../scripts/screen/FrameManager.js","../scripts/widgets/ui_dialog.js","../scripts/simple/editor.js","../scripts/simple/iconsheet.js","../scripts/simple/icons.js","../scripts/simple/file.js","../scripts/simple/menubar.js","../scripts/simple/app_ops.js","../scripts/simple/app.js","../scripts/simple/context_class.js","../scripts/platforms/web/web_api.js","../scripts/pathux.js"],"sourcesContent":["if (typeof window === \"undefined\" && typeof global !== \"undefined\") {\r\n  global.window = global;\r\n}\r\n\r\n(function () {\r\n  let visitgen = 0;\r\n\r\n  window.destroyAllCSS = function () {\r\n    visitgen++;\r\n\r\n    let visit = (n) => {\r\n      if (n.__visit === visitgen) {\r\n        return;\r\n      }\r\n\r\n      n.__visit = visitgen;\r\n      if (n.tagName === \"STYLE\") {\r\n        n.textContents = '';\r\n      }\r\n\r\n      if (n.style) {\r\n        for (let k in n.style) {\r\n          try {\r\n            n.style[k] = \"\";\r\n          } catch (error) {\r\n\r\n          }\r\n        }\r\n      }\r\n\r\n      if (!n.childNodes) {\r\n        return;\r\n      }\r\n\r\n      for (let c of n.childNodes) {\r\n        visit(c);\r\n      }\r\n    }\r\n\r\n    visit(document.head);\r\n    visit(document.body);\r\n\r\n    for (let sheet of document.styleSheets) {\r\n      for (let i = 0; i < sheet.rules.length; i++) {\r\n        sheet.removeRule(sheet.rules[0]);\r\n      }\r\n    }\r\n  }\r\n})();\r\n\r\nwindow.eventDebugModule = (function () {\r\n  \"use strict\";\r\n\r\n  return {\r\n    start() {\r\n      window.debugEventLists = {}\r\n      window.debugEventList = [];\r\n\r\n      this._addEventListener = EventTarget.prototype.addEventListener;\r\n      this._removeEventListener = EventTarget.prototype.removeEventListener;\r\n      this._dispatchEvent = EventTarget.prototype.dispatchEvent;\r\n\r\n      EventTarget.prototype.addEventListener = this.onadd;\r\n      EventTarget.prototype.removeEventListener = this.onrem;\r\n      EventTarget.prototype.dispatchEvent = this.ondispatch;\r\n    },\r\n\r\n    add(type, data) {\r\n      if (!(type in debugEventLists)) {\r\n        debugEventLists[type] = [];\r\n      }\r\n\r\n      debugEventLists[type].push(data);\r\n    },\r\n\r\n    ondispatch() {\r\n      let a = arguments;\r\n\r\n      eventDebugModule.add(\"Dispatch\", {\r\n        event    : a[0],\r\n        thisvar  : a[4],\r\n        line     : a[5],\r\n        filename : a[6].replace(/\\\\/g, \"/\"),\r\n        filepath : location.origin + a[6].replace(/\\\\/g, \"/\") + \":\" + a[5],\r\n        ownerpath: a[7]\r\n      });\r\n\r\n      return eventDebugModule._dispatchEvent.apply(this, arguments);\r\n    },\r\n\r\n    onadd() {\r\n      let a = arguments;\r\n\r\n      eventDebugModule.add(\"Add\", {\r\n        type     : a[0],\r\n        cb       : a[1],\r\n        args     : a[2],\r\n        thisvar  : a[4],\r\n        line     : a[5],\r\n        filename : a[6].replace(/\\\\/g, \"/\"),\r\n        filepath : location.origin + a[6].replace(/\\\\/g, \"/\") + \":\" + a[5],\r\n        ownerpath: a[7]\r\n      });\r\n\r\n\r\n      return eventDebugModule._addEventListener.apply(this, arguments);\r\n    },\r\n\r\n    pruneConnected() {\r\n      for (let k in debugEventLists) {\r\n        let list = debugEventLists[k];\r\n\r\n        for (let i = 0; i < list.length; i++) {\r\n          let e = list[i];\r\n\r\n          if (!e.thisvar || !(e.thisvar instanceof Node)) {\r\n            continue;\r\n          }\r\n\r\n          if (!e.thisvar.isConnected) {\r\n            list[i] = list[list.length - 1];\r\n            list[list.length - 1] = undefined;\r\n            list.length--;\r\n            i--;\r\n          }\r\n        }\r\n      }\r\n    },\r\n\r\n\r\n    onrem() {\r\n      let a = arguments;\r\n\r\n      eventDebugModule.add(\"Rem\", {\r\n        type     : a[0],\r\n        cb       : a[1],\r\n        args     : a[2],\r\n        thisvar  : a[4],\r\n        line     : a[5],\r\n        filename : a[6].replace(/\\\\/g, \"/\"),\r\n        filepath : location.origin + a[6].replace(/\\\\/g, \"/\") + \":\" + a[5],\r\n        ownerpath: a[7]\r\n      });\r\n\r\n\r\n      return eventDebugModule._removeEventListener.apply(this, arguments);\r\n    }\r\n  }\r\n})();\r\n\r\nif (typeof _debug_event_listeners !== \"undefined\" && _debug_event_listeners) {\r\n  eventDebugModule.start();\r\n}\r\n\r\n/*\r\nif (navigator.userAgent.toLowerCase().search(\"chrome\") >= 0) {\r\n  console.warn(\"Patching Google Chrome scrollbar bug\");\r\n\r\n  let cb = (e) => {\r\n    if (e.touches.length == 1) {\r\n      let e2 = Object.create(e);\r\n      e2.pageX = e.touches[0].pageX;\r\n      e2.pageY = e.touches[0].pageY;\r\n      e2.x = e2.screenX = e2.pageX;\r\n      e2.y = e2.screenY = e2.pageY;\r\n      e2.button = 0;\r\n      e2.buttons = 1;\r\n\r\n      let type;\r\n      if (e.type === \"touchstart\")\r\n        type = \"mousedown\";\r\n      else \r\n        type = \"mousemove\";\r\n\r\n      console.log(e2);\r\n        //console.log(e.target);\r\n      e2 = new MouseEvent(type, e);\r\n      e.target.dispatchEvent(e2);\r\n    }\r\n  };\r\n\r\n  window.addEventListener(\"touchstart\", (e) => cb(e));\r\n  window.addEventListener(\"touchmove\", (e) => cb(e));\r\n\r\n  document.addEventListener(\"touchstart\", (e) => cb(e));\r\n  document.addEventListener(\"touchmove\", (e) => cb(e));\r\n}\r\n//*/\r\n\r\nif (window._disable_all_listeners) {\r\n  console.warn(\"Disabling all event listeners\");\r\n  EventTarget.prototype.addEventListener = () => {\r\n  };\r\n  EventSource.prototype.addEventListener = () => {\r\n  };\r\n}\r\n\r\nif (typeof visualViewport === \"undefined\") {\r\n  (function () {\r\n    class MyVisualViewport {\r\n      get width() {\r\n        return window.innerWidth;\r\n      }\r\n\r\n      get height() {\r\n        return window.innerHeight;\r\n      }\r\n\r\n      get offsetLeft() {\r\n        return 0;\r\n      }\r\n\r\n      get offsetTop() {\r\n        return 0;\r\n      }\r\n\r\n      get pageLeft() {\r\n        return 0;\r\n      }\r\n\r\n      get pageTop() {\r\n        return 0;\r\n      }\r\n\r\n      get scale() {\r\n        return 1.0;\r\n      }\r\n    }\r\n\r\n    window.visualViewport = new MyVisualViewport();\r\n  })();\r\n}\r\n\r\nif (Array.prototype.set === undefined) {\r\n  /**\r\n   * A version of TypedArray.prototype.set for Array\r\n   * Unliked typed array version the array will be\r\n   * resized if the source array range extends past\r\n   * the array length.\r\n   *\r\n   * array.set(array) array.set(array, src_offset) array.set(array, src_offset, count)\r\n   * array.set(array, src_offset, dest_offset, count\r\n   * @param array\r\n   */\r\n  Array.prototype.set = function set(array) {\r\n    if (arguments.length === 0) {\r\n      //WASM somehow manages to call this\r\n      return;\r\n    }\r\n\r\n    let src, dst, count;\r\n\r\n    if (arguments.length === 0) {\r\n      src = 0;\r\n      dst = 0;\r\n      count = array.length;\r\n    } else if (arguments.length === 1) {\r\n      count = array.length;\r\n      src = arguments[1];\r\n      dst = 0;\r\n    } else if (arguments.length === 2) {\r\n      src = arguments[1];\r\n      count = arguments[2];\r\n    } else if (arguments.length === 3) {\r\n      src = arguments[1];\r\n      dst = arguments[2];\r\n      count = arguments[3];\r\n    }\r\n\r\n    src = src === undefined ? 0 : src;\r\n    dst = dst === undefined ? 0 : dst;\r\n    count = count === undefined ? array.length : count;\r\n\r\n    if (count < 0) {\r\n      throw new RangeError(\"Count must be >= zero\");\r\n    }\r\n\r\n    let len = Math.min(src + count, array.length) - src;\r\n\r\n    if (dst + len > this.length) {\r\n      this.length = dst + len;\r\n    }\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      this[dst + i] = array[src + i];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  Object.defineProperty(Array.prototype, \"set\", {\r\n    enumerable  : false,\r\n    configurable: true,\r\n  });\r\n\r\n  if (Float64Array.prototype.set === undefined) {\r\n    Float64Array.prototype.set = Array.prototype.set;\r\n    Float32Array.prototype.set = Array.prototype.set;\r\n    Uint8Array.prototype.set = Array.prototype.set;\r\n    Uint8ClampedArray.prototype.set = Array.prototype.set;\r\n    Int32Array.prototype.set = Array.prototype.set;\r\n    Int16Array.prototype.set = Array.prototype.set;\r\n    Int8Array.prototype.set = Array.prototype.set;\r\n  }\r\n}\r\n\r\nif (Array.prototype.reject === undefined) {\r\n  Array.prototype.reject = function reject(func) {\r\n    return this.filter((item) => !func(item));\r\n  }\r\n\r\n  Object.defineProperty(Array.prototype, \"reject\", {\r\n    enumerable  : false,\r\n    configurable: true,\r\n  });\r\n}\r\n\r\nif (window.Symbol == undefined) { //eek!\r\n  window.Symbol = {\r\n    iterator: \"$__iterator__$\",\r\n    keystr  : \"$__keystr__$\"\r\n  }\r\n} else if (Symbol.keystr === undefined) {\r\n  Symbol.keystr = Symbol(\"keystr\");\r\n}\r\n\r\n/* use util.list\r\nwindow.list = function list(iter) {\r\n  var ret = [];\r\n\r\n  if (typeof iter == \"string\") {\r\n    iter = new String();\r\n  }\r\n\r\n  if (Symbol.iterator in iter) {\r\n    for (var item of iter) {\r\n      ret.push(item);\r\n    }\r\n  } else {\r\n    iter.forEach(function (item) {\r\n      ret.push(item);\r\n    }, this);\r\n  }\r\n\r\n  return ret;\r\n};*/\r\n\r\n//XXX surely browser vendors have fixed this by now. . .\r\n/*Override array iterator to not allocate too much*/\r\n\r\n/*\r\nfunction ArrayIter(array) {\r\n  this.array = array;\r\n  this.i = 0;\r\n  this.ret = {done : false, value : undefined};\r\n}\r\n\r\nArrayIter.prototype[Symbol.iterator] = function() {\r\n  return this;\r\n}\r\n\r\nArrayIter.prototype.next = function() {\r\n  var ret = this.ret;\r\n  \r\n  if (this.i >= this.array.length) {\r\n    ret.done = true;\r\n    ret.value = undefined;\r\n    return ret;\r\n  }\r\n  \r\n  ret.value = this.array[this.i++];\r\n  return ret;\r\n};//*/\r\n\r\n\r\n//Array.prototype[Symbol.iterator] = function() {\r\n//  return new ArrayIter(this);\r\n//}\r\n\r\nif (Math.fract === undefined) {\r\n  Math.fract = function fract(f) {\r\n    return f - Math.floor(f);\r\n  };\r\n}\r\n\r\nif (Math.tent === undefined) {\r\n  Math.tent = function tent(f) {\r\n    return 1.0 - Math.abs(Math.fract(f) - 0.5)*2.0;\r\n  };\r\n}\r\n\r\nif (Math.sign === undefined) {\r\n  Math.sign = function sign(f) {\r\n    return (f > 0.0)*2.0 - 1.0;\r\n  };\r\n}\r\n\r\nif (Array.prototype.pop_i === undefined) {\r\n  Array.prototype.pop_i = function (idx) {\r\n    if (idx < 0 || idx >= this.length) {\r\n      throw new Error(\"Index out of range\");\r\n    }\r\n\r\n    while (idx < this.length) {\r\n      this[idx] = this[idx + 1];\r\n      idx++;\r\n    }\r\n\r\n    this.length -= 1;\r\n  }\r\n\r\n  Object.defineProperty(Array.prototype, \"pop_i\", {\r\n    enumerable  : false,\r\n    configurable: true,\r\n  });\r\n}\r\n\r\nif (Array.prototype.remove === undefined) {\r\n  Array.prototype.remove = function (item, suppress_error) {\r\n    var i = this.indexOf(item);\r\n\r\n    if (i < 0) {\r\n      if (suppress_error)\r\n        console.trace(\"Warning: item not in array\", item);\r\n      else\r\n        throw new Error(\"Error: item not in array \" + item);\r\n\r\n      return;\r\n    }\r\n\r\n    this.pop_i(i);\r\n  }\r\n\r\n  Object.defineProperty(Array.prototype, \"remove\", {\r\n    enumerable  : false,\r\n    configurable: true,\r\n  });\r\n}\r\n\r\nif (String.prototype.contains === undefined) {\r\n  String.prototype.contains = function (substr) {\r\n    return String.search(substr) >= 0;\r\n  }\r\n}\r\n\r\nString.prototype[Symbol.keystr] = function () {\r\n  return this;\r\n};\r\n\r\nNumber.prototype[Symbol.keystr] = Boolean.prototype[Symbol.keystr] = function () {\r\n  return \"\" + this;\r\n};\r\n\r\nArray.prototype[Symbol.keystr] = function () {\r\n  let key = \"\";\r\n  for (let item of this) {\r\n    key += item[Symbol.keystr]() + \":\";\r\n  }\r\n\r\n  return key;\r\n};\r\n","let colormap = {\r\n  \"black\"   : 30,\r\n  \"red\"     : 31,\r\n  \"green\"   : 32,\r\n  \"yellow\"  : 33,\r\n  \"blue\"    : 34,\r\n  \"magenta\" : 35,\r\n  \"cyan\"    : 36,\r\n  \"white\"   : 37,\r\n  \"reset\"   : 0,\r\n  \"grey\"    : 2,\r\n  \"orange\"  : 202,\r\n  \"pink\"    : 198,\r\n  \"brown\"   : 314,\r\n  \"lightred\": 91,\r\n  \"peach\"   : 210\r\n};\r\n\r\nlet termColorMap = {};\r\nfor (let k in colormap) {\r\n  termColorMap[k] = colormap[k];\r\n  termColorMap[colormap[k]] = k;\r\n}\r\n\r\nfunction termColor(s, c) {\r\n  if (typeof s === \"symbol\") {\r\n    s = s.toString();\r\n  } else {\r\n    s = \"\" + s;\r\n  }\r\n\r\n  if (c in colormap)\r\n    c = colormap[c];\r\n\r\n  if (c > 107) {\r\n    let s2 = '\\u001b[38;5;' + c + \"m\";\r\n    return s2 + s + '\\u001b[0m'\r\n  }\r\n\r\n  return '\\u001b[' + c + 'm' + s + '\\u001b[0m'\r\n};\r\n\r\nfunction termPrint() {\r\n  //let console = window.console;\r\n\r\n  let s = '';\r\n  for (let i = 0; i < arguments.length; i++) {\r\n    if (i > 0) {\r\n      s += ' ';\r\n    }\r\n    s += arguments[i];\r\n  }\r\n\r\n  let re1a = /\\u001b\\[[1-9][0-9]?m/;\r\n  let re1b = /\\u001b\\[[1-9][0-9];[0-9][0-9]?;[0-9]+m/;\r\n  let re2 = /\\u001b\\[0m/;\r\n\r\n  let endtag = '\\u001b[0m';\r\n\r\n  function tok(s, type) {\r\n    return {\r\n      type : type,\r\n      value: s\r\n    }\r\n  }\r\n\r\n  let tokdef = [\r\n    [re1a, \"start\"],\r\n    [re1b, \"start\"],\r\n    [re2, \"end\"]\r\n  ];\r\n\r\n  let s2 = s;\r\n\r\n  let i = 0;\r\n  let tokens = [];\r\n\r\n  while (s2.length > 0) {\r\n    let ok = false;\r\n\r\n    let mintk = undefined, mini = undefined;\r\n    let minslice = undefined, mintype = undefined;\r\n\r\n    for (let tk of tokdef) {\r\n      let i = s2.search(tk[0]);\r\n\r\n      if (i >= 0 && (mini === undefined || i < mini)) {\r\n        minslice = s2.slice(i, s2.length).match(tk[0])[0];\r\n        mini = i;\r\n        mintype = tk[1];\r\n        mintk = tk;\r\n        ok = true;\r\n      }\r\n    }\r\n\r\n    if (!ok) {\r\n      break;\r\n    }\r\n\r\n    if (mini > 0) {\r\n      let chunk = s2.slice(0, mini);\r\n      tokens.push(tok(chunk, \"chunk\"));\r\n    }\r\n\r\n    s2 = s2.slice(mini+minslice.length, s2.length);\r\n    let t = tok(minslice, mintype);\r\n\r\n    tokens.push(t);\r\n  }\r\n\r\n  if (s2.length > 0) {\r\n    tokens.push(tok(s2, \"chunk\"));\r\n  }\r\n\r\n  let stack = [];\r\n  let cur;\r\n\r\n  let out = '';\r\n\r\n  for (let t of tokens) {\r\n    if (t.type === \"chunk\") {\r\n      out += t.value;\r\n    } else if (t.type === \"start\") {\r\n      stack.push(cur);\r\n      cur = t.value;\r\n\r\n      out += t.value;\r\n    } else if (t.type === \"end\") {\r\n      cur = stack.pop();\r\n      if (cur) {\r\n        out += cur;\r\n      } else {\r\n        out += endtag;\r\n      }\r\n    }\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\n\"use strict\";\r\n\r\nfunction print_lines(ld, lineno, col, printColors, token) {\r\n  let buf = '';\r\n  let lines = ld.split(\"\\n\");\r\n  let istart = Math.max(lineno - 5, 0);\r\n  let iend  = Math.min(lineno + 3, lines.length);\r\n\r\n  let color = printColors ? (c) => c : termColor;\r\n\r\n  for (let i=istart; i<iend; i++) {\r\n    let l = \"\" + (i + 1);\r\n    while (l.length < 3) {\r\n      l = \" \" + l;\r\n    }\r\n\r\n    l += `: ${lines[i]}\\n`;\r\n\r\n    if (i === lineno && token && token.value.length === 1) {\r\n      l = l.slice(0, col+5) + color(l[col+5], \"yellow\") + l.slice(col+6, l.length);\r\n    }\r\n    buf += l;\r\n    if (i === lineno) {\r\n      let colstr = '     ';\r\n      for (let i=0; i<col; i++) {\r\n        colstr += ' ';\r\n      }\r\n      colstr += color(\"^\", \"red\");\r\n\r\n      buf += colstr + \"\\n\";\r\n    }\r\n  }\r\n\r\n  buf = \"------------------\\n\" + buf + \"\\n==================\\n\";\r\n  return buf;\r\n}\r\n\r\nclass token {\r\n  constructor(type, val, lexpos, lineno, lexer, parser, col) {\r\n    this.type = type;\r\n    this.value = val;\r\n    this.lexpos = lexpos;\r\n    this.lineno = lineno;\r\n    this.col = col;\r\n    this.lexer = lexer;\r\n    this.parser = parser;\r\n  }\r\n\r\n  toString() {\r\n    if (this.value !== undefined)\r\n      return \"token(type=\" + this.type + \", value='\" + this.value + \"')\";\r\n    else\r\n      return \"token(type=\" + this.type + \")\";\r\n  }\r\n}\r\n\r\nclass tokdef {\r\n  constructor(name, regexpr, func, example) {\r\n    this.name = name;\r\n    this.re = regexpr;\r\n    this.func = func;\r\n    this.example = example;\r\n    \r\n    if (example === undefined && regexpr) {\r\n      let s = \"\" + regexpr;\r\n      if (s.startsWith(\"/\") && s.endsWith(\"/\")) {\r\n        s = s.slice(1, s.length-1);\r\n      }\r\n      \r\n      if (s.startsWith(\"\\\\\")) {\r\n        s = s.slice(1, s.length);\r\n      }\r\n      s = s.trim();\r\n      \r\n      if (s.length === 1) {\r\n        this.example = s;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nclass PUTIL_ParseError extends Error {\r\n  constructor(msg) {\r\n    super();\r\n  }\r\n}\r\n\r\nclass lexer {\r\n  constructor(tokdef, errfunc) {\r\n    this.tokdef = tokdef;\r\n    this.tokens = new Array();\r\n    this.lexpos = 0;\r\n    this.lexdata = \"\";\r\n    this.colmap = undefined;\r\n    this.lineno = 0;\r\n    this.printTokens = false;\r\n    this.linestart = 0;\r\n    this.errfunc = errfunc;\r\n    this.linemap = undefined;\r\n    this.tokints = {};\r\n    for (let i = 0; i < tokdef.length; i++) {\r\n      this.tokints[tokdef[i].name] = i;\r\n    }\r\n    this.statestack = [[\"__main__\", 0]];\r\n    this.states = {\"__main__\": [tokdef, errfunc]};\r\n    this.statedata = 0;\r\n\r\n    this.logger = function() {\r\n      console.log(...arguments);\r\n    };\r\n  }\r\n\r\n  add_state(name, tokdef, errfunc) {\r\n    if (errfunc === undefined) {\r\n      errfunc = function (lexer) {\r\n        return true;\r\n      };\r\n    }\r\n    this.states[name] = [tokdef, errfunc];\r\n  }\r\n\r\n  tok_int(name) {\r\n  }\r\n\r\n  push_state(state, statedata) {\r\n    this.statestack.push([state, statedata]);\r\n    state = this.states[state];\r\n    this.statedata = statedata;\r\n    this.tokdef = state[0];\r\n    this.errfunc = state[1];\r\n  }\r\n\r\n  pop_state() {\r\n    let item = this.statestack[this.statestack.length - 1];\r\n    let state = this.states[item[0]];\r\n    this.tokdef = state[0];\r\n    this.errfunc = state[1];\r\n    this.statedata = item[1];\r\n  }\r\n\r\n  input(str) {\r\n    let linemap = this.linemap = new Array(str.length);\r\n    let lineno = 0;\r\n    let col = 0;\r\n    let colmap = this.colmap = new Array(str.length);\r\n\r\n    for (let i=0; i<str.length; i++, col++) {\r\n      let c = str[i];\r\n\r\n      linemap[i] = lineno;\r\n      colmap[i] = col;\r\n\r\n      if (c === \"\\n\") {\r\n        lineno++;\r\n        col = 0;\r\n      }\r\n    }\r\n\r\n    while (this.statestack.length > 1) {\r\n      this.pop_state();\r\n    }\r\n    this.lexdata = str;\r\n    this.lexpos = 0;\r\n    this.lineno = 0;\r\n    this.tokens = new Array();\r\n    this.peeked_tokens = [];\r\n  }\r\n\r\n  error() {\r\n    if (this.errfunc !== undefined && !this.errfunc(this))\r\n      return;\r\n\r\n    let safepos = Math.min(this.lexpos, this.lexdata.length-1);\r\n    let line = this.linemap[safepos];\r\n    let col = this.colmap[safepos];\r\n\r\n    let s = print_lines(this.lexdata, line, col, true);\r\n\r\n    this.logger(\"  \" + s);\r\n    this.logger(\"Syntax error near line \" + (this.lineno + 1));\r\n\r\n    let next = Math.min(this.lexpos + 8, this.lexdata.length);\r\n\r\n    throw new PUTIL_ParseError(\"Parse error\");\r\n  }\r\n\r\n  peek() {\r\n    let tok = this.next(true);\r\n    if (tok === undefined)\r\n      return undefined;\r\n    this.peeked_tokens.push(tok);\r\n    return tok;\r\n  }\r\n\r\n  peeknext() {\r\n    if (this.peeked_tokens.length > 0) {\r\n      return this.peeked_tokens[0];\r\n    }\r\n\r\n    return this.peek();\r\n  }\r\n\r\n  at_end() {\r\n    return this.lexpos >= this.lexdata.length && this.peeked_tokens.length === 0;\r\n  }\r\n\r\n  //ignore_peek is optional, false\r\n  next(ignore_peek) {\r\n    if (!ignore_peek && this.peeked_tokens.length > 0) {\r\n      let tok = this.peeked_tokens[0];\r\n      this.peeked_tokens.shift();\r\n\r\n      if (!ignore_peek && this.printTokens) {\r\n        this.logger(\"\"+tok);\r\n      }\r\n\r\n      return tok;\r\n    }\r\n\r\n    if (this.lexpos >= this.lexdata.length)\r\n      return undefined;\r\n\r\n    let ts = this.tokdef;\r\n    let tlen = ts.length;\r\n    let lexdata = this.lexdata.slice(this.lexpos, this.lexdata.length);\r\n    let results = [];\r\n\r\n    for (var i = 0; i < tlen; i++) {\r\n      let t = ts[i];\r\n      if (t.re === undefined)\r\n        continue;\r\n      let res = t.re.exec(lexdata);\r\n      if (res !== null && res !== undefined && res.index === 0) {\r\n        results.push([t, res]);\r\n      }\r\n    }\r\n\r\n    let max_res = 0;\r\n    let theres = undefined;\r\n    for (var i = 0; i < results.length; i++) {\r\n      let res = results[i];\r\n      if (res[1][0].length > max_res) {\r\n        theres = res;\r\n        max_res = res[1][0].length;\r\n      }\r\n    }\r\n\r\n    if (theres === undefined) {\r\n      this.error();\r\n      return;\r\n    }\r\n\r\n    let def = theres[0];\r\n    let col = this.colmap[Math.min(this.lexpos, this.lexdata.length-1)];\r\n\r\n    if (this.lexpos < this.lexdata.length) {\r\n      this.lineno = this.linemap[this.lexpos];\r\n    }\r\n\r\n    let tok = new token(def.name, theres[1][0], this.lexpos, this.lineno, this, undefined, col);\r\n    this.lexpos += tok.value.length;\r\n\r\n    if (def.func) {\r\n      tok = def.func(tok);\r\n      if (tok === undefined) {\r\n        return this.next();\r\n      }\r\n    }\r\n\r\n    if (!ignore_peek && this.printTokens) {\r\n      this.logger(\"\"+tok);\r\n    }\r\n    return tok;\r\n  }\r\n}\r\n\r\nclass parser {\r\n  constructor(lexer, errfunc) {\r\n    this.lexer = lexer;\r\n    this.errfunc = errfunc;\r\n    this.start = undefined;\r\n\r\n    this.logger = function() {\r\n      console.log(...arguments);\r\n    };\r\n  }\r\n\r\n  parse(data, err_on_unconsumed) {\r\n    if (err_on_unconsumed === undefined)\r\n      err_on_unconsumed = true;\r\n\r\n    if (data !== undefined)\r\n      this.lexer.input(data);\r\n\r\n    let ret = this.start(this);\r\n\r\n    if (err_on_unconsumed && !this.lexer.at_end() && this.lexer.next() !== undefined) {\r\n      this.error(undefined, \"parser did not consume entire input\");\r\n    }\r\n    return ret;\r\n  }\r\n\r\n  input(data) {\r\n    this.lexer.input(data);\r\n  }\r\n\r\n  error(token, msg) {\r\n    let estr;\r\n\r\n    if (msg === undefined)\r\n      msg = \"\";\r\n    if (token === undefined)\r\n      estr = \"Parse error at end of input: \" + msg;\r\n    else\r\n      estr = `Parse error at line ${token.lineno + 1}:${token.col+1}: ${msg}`;\r\n\r\n    let buf = \"\";\r\n    let ld = this.lexer.lexdata;\r\n    let lineno = token ? token.lineno : this.lexer.linemap[this.lexer.linemap.length-1];\r\n    let col = token ? token.col : 0;\r\n\r\n    ld = ld.replace(/\\r/g, '');\r\n\r\n    this.logger(print_lines(ld, lineno, col, true, token));\r\n    this.logger(estr);\r\n\r\n    if (this.errfunc && !this.errfunc(token)) {\r\n      return;\r\n    }\r\n    throw new PUTIL_ParseError(estr);\r\n  }\r\n\r\n  peek() {\r\n    let tok = this.lexer.peek();\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n    return tok;\r\n  }\r\n\r\n  peeknext() {\r\n    let tok = this.lexer.peeknext();\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n    return tok;\r\n  }\r\n\r\n  next() {\r\n    let tok = this.lexer.next();\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n    return tok;\r\n  }\r\n\r\n  optional(type) {\r\n    let tok = this.peek();\r\n    if (tok === undefined)\r\n      return false;\r\n    if (tok.type === type) {\r\n      this.next();\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  at_end() {\r\n    return this.lexer.at_end();\r\n  }\r\n\r\n  expect(type, msg) {\r\n    let tok = this.next();\r\n    \r\n    if (msg === undefined) {\r\n      msg = type;\r\n      \r\n      for (let tk of this.lexer.tokdef) {\r\n        if (tk.name === type && tk.example) {\r\n          msg = tk.example;\r\n        }\r\n      }\r\n    }\r\n    \r\n    if (tok === undefined || tok.type !== type) {\r\n      this.error(tok, \"Expected \" + msg);\r\n    }\r\n    return tok.value;\r\n  }\r\n}\r\n\r\nfunction test_parser() {\r\n  let basic_types = new Set([\"int\", \"float\", \"double\", \"vec2\", \"vec3\", \"vec4\", \"mat4\", \"string\"]);\r\n  let reserved_tokens = new Set([\"int\", \"float\", \"double\", \"vec2\", \"vec3\", \"vec4\", \"mat4\", \"string\", \"static_string\", \"array\"]);\r\n\r\n  function tk(name, re, func) {\r\n    return new tokdef(name, re, func);\r\n  }\r\n\r\n  let tokens = [tk(\"ID\", /[a-zA-Z]+[a-zA-Z0-9_]*/, function (t) {\r\n    if (reserved_tokens.has(t.value)) {\r\n      t.type = t.value.toUpperCase();\r\n    }\r\n    return t;\r\n  }), tk(\"OPEN\", /\\{/), tk(\"CLOSE\", /}/), tk(\"COLON\", /:/), tk(\"JSCRIPT\", /\\|/, function (t) {\r\n    let js = \"\";\r\n    let lexer = t.lexer;\r\n    while (lexer.lexpos < lexer.lexdata.length) {\r\n      let c = lexer.lexdata[lexer.lexpos];\r\n      if (c === \"\\n\")\r\n        break;\r\n      js += c;\r\n      lexer.lexpos++;\r\n    }\r\n    if (js.endsWith(\";\")) {\r\n      js = js.slice(0, js.length - 1);\r\n      lexer.lexpos--;\r\n    }\r\n    t.value = js;\r\n    return t;\r\n  }), tk(\"LPARAM\", /\\(/), tk(\"RPARAM\", /\\)/), tk(\"COMMA\", /,/), tk(\"NUM\", /[0-9]/), tk(\"SEMI\", /;/), tk(\"NEWLINE\", /\\n/, function (t) {\r\n    t.lexer.lineno += 1;\r\n  }), tk(\"SPACE\", / |\\t/, function (t) {\r\n  })];\r\n\r\n  for (let rt of reserved_tokens) {\r\n    tokens.push(tk(rt.toUpperCase()));\r\n  }\r\n\r\n  let a = `\r\n  Loop {\r\n    eid : int;\r\n    flag : int;\r\n    index : int;\r\n    type : int;\r\n\r\n    co : vec3;\r\n    no : vec3;\r\n    loop : int | eid(loop);\r\n    edges : array(e, int) | e.eid;\r\n\r\n    loops :, array(Loop);\r\n  }\r\n  `;\r\n\r\n\r\n  function errfunc(lexer) {\r\n    return true;\r\n  }\r\n\r\n  let lex = new lexer(tokens, errfunc);\r\n  console.log(\"Testing lexical scanner...\");\r\n  lex.input(a);\r\n  let token;\r\n  while (token = lex.next()) {\r\n    console.log(token.toString());\r\n  }\r\n  let parse = new parser(lex);\r\n  parse.input(a);\r\n\r\n  function p_Array(p) {\r\n    p.expect(\"ARRAY\");\r\n    p.expect(\"LPARAM\");\r\n    let arraytype = p_Type(p);\r\n    let itername = \"\";\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = arraytype;\r\n      arraytype = p_Type(p);\r\n    }\r\n    p.expect(\"RPARAM\");\r\n    return {type: \"array\", data: {type: arraytype, iname: itername}}\r\n  }\r\n\r\n  function p_Type(p) {\r\n    let tok = p.peek();\r\n    if (tok.type === \"ID\") {\r\n      p.next();\r\n      return {type: \"struct\", data: \"\\\"\" + tok.value + \"\\\"\"}\r\n    }\r\n    else if (basic_types.has(tok.type.toLowerCase())) {\r\n      p.next();\r\n      return {type: tok.type.toLowerCase()}\r\n    }\r\n    else if (tok.type === \"ARRAY\") {\r\n      return p_Array(p);\r\n    }\r\n    else {\r\n      p.error(tok, \"invalid type \" + tok.type);\r\n    }\r\n  }\r\n\r\n  function p_Field(p) {\r\n    let field = {};\r\n    console.log(\"-----\", p.peek().type);\r\n    field.name = p.expect(\"ID\", \"struct field name\");\r\n    p.expect(\"COLON\");\r\n    field.type = p_Type(p);\r\n    field.set = undefined;\r\n    field.get = undefined;\r\n    let tok = p.peek();\r\n    if (tok.type === \"JSCRIPT\") {\r\n      field.get = tok.value;\r\n      p.next();\r\n    }\r\n    tok = p.peek();\r\n    if (tok.type === \"JSCRIPT\") {\r\n      field.set = tok.value;\r\n      p.next();\r\n    }\r\n    p.expect(\"SEMI\");\r\n    return field;\r\n  }\r\n\r\n  function p_Struct(p) {\r\n    let st = {};\r\n    st.name = p.expect(\"ID\", \"struct name\");\r\n    st.fields = [];\r\n    p.expect(\"OPEN\");\r\n    while (1) {\r\n      if (p.at_end()) {\r\n        p.error(undefined);\r\n      }\r\n      else if (p.optional(\"CLOSE\")) {\r\n        break;\r\n      }\r\n      else {\r\n        st.fields.push(p_Field(p));\r\n      }\r\n    }\r\n    return st;\r\n  }\r\n\r\n  let ret = p_Struct(parse);\r\n  console.log(JSON.stringify(ret));\r\n}\r\n\r\n//test_parser();\r\n\r\nvar struct_parseutil = /*#__PURE__*/Object.freeze({\r\n  __proto__: null,\r\n  token: token,\r\n  tokdef: tokdef,\r\n  PUTIL_ParseError: PUTIL_ParseError,\r\n  lexer: lexer,\r\n  parser: parser\r\n});\r\n\r\n\"use strict\";\r\n\r\nclass NStruct {\r\n  constructor(name) {\r\n    this.fields = [];\r\n    this.id = -1;\r\n    this.name = name;\r\n  }\r\n}\r\n\r\n//the discontinuous id's are to make sure\r\n//the version I originally wrote (which had a few application-specific types)\r\n//and this one do not become totally incompatible.\r\nconst StructEnum = {\r\n  INT          : 0,\r\n  FLOAT        : 1,\r\n  DOUBLE       : 2,\r\n  STRING       : 7,\r\n  STATIC_STRING: 8, //fixed-length string\r\n  STRUCT       : 9,\r\n  TSTRUCT      : 10,\r\n  ARRAY        : 11,\r\n  ITER         : 12,\r\n  SHORT        : 13,\r\n  BYTE         : 14,\r\n  BOOL         : 15,\r\n  ITERKEYS     : 16,\r\n  UINT         : 17,\r\n  USHORT       : 18,\r\n  STATIC_ARRAY : 19,\r\n  SIGNED_BYTE  : 20\r\n};\r\n\r\nconst ValueTypes = new Set([\r\n  StructEnum.INT,\r\n  StructEnum.FLOAT,\r\n  StructEnum.DOUBLE,\r\n  StructEnum.STRING,\r\n  StructEnum.STATIC_STRING,\r\n  StructEnum.SHORT,\r\n  StructEnum.BYTE,\r\n  StructEnum.BOOL,\r\n  StructEnum.UINT,\r\n  StructEnum.USHORT,\r\n  StructEnum.SIGNED_BYTE\r\n\r\n]);\r\n\r\nlet StructTypes = {\r\n  \"int\"          : StructEnum.INT,\r\n  \"uint\"         : StructEnum.UINT,\r\n  \"ushort\"       : StructEnum.USHORT,\r\n  \"float\"        : StructEnum.FLOAT,\r\n  \"double\"       : StructEnum.DOUBLE,\r\n  \"string\"       : StructEnum.STRING,\r\n  \"static_string\": StructEnum.STATIC_STRING,\r\n  \"struct\"       : StructEnum.STRUCT,\r\n  \"abstract\"     : StructEnum.TSTRUCT,\r\n  \"array\"        : StructEnum.ARRAY,\r\n  \"iter\"         : StructEnum.ITER,\r\n  \"short\"        : StructEnum.SHORT,\r\n  \"byte\"         : StructEnum.BYTE,\r\n  \"bool\"         : StructEnum.BOOL,\r\n  \"iterkeys\"     : StructEnum.ITERKEYS,\r\n  \"sbyte\"        : StructEnum.SIGNED_BYTE\r\n};\r\n\r\nlet StructTypeMap = {};\r\n\r\nfor (let k in StructTypes) {\r\n  StructTypeMap[StructTypes[k]] = k;\r\n}\r\n\r\nfunction gen_tabstr(t) {\r\n  let s = \"\";\r\n  for (let i = 0; i < t; i++) {\r\n    s += \"  \";\r\n  }\r\n  return s;\r\n}\r\n\r\nfunction stripComments(buf) {\r\n  let s = '';\r\n\r\n  const MAIN = 0, COMMENT = 1, STR = 2;\r\n\r\n  let p, n;\r\n  let strs = new Set([\"'\", '\"', \"`\"]);\r\n  let mode = MAIN;\r\n  let strlit;\r\n  let escape = false;\r\n\r\n  for (let i = 0; i < buf.length; i++) {\r\n    let p = i > 0 ? buf[i - 1] : undefined;\r\n    let c = buf[i];\r\n    let n = i < buf.length - 1 ? buf[i + 1] : undefined;\r\n\r\n    switch (mode) {\r\n      case MAIN:\r\n        if (c === \"/\" && n === \"/\") {\r\n          mode = COMMENT;\r\n          continue;\r\n        }\r\n\r\n        if (strs.has(c)) {\r\n          strlit = c;\r\n          mode = STR;\r\n        }\r\n\r\n        s += c;\r\n\r\n        break;\r\n      case COMMENT:\r\n        if (n === \"\\n\") {\r\n          mode = MAIN;\r\n        }\r\n        break;\r\n      case STR:\r\n        if (c === strlit && !escape) {\r\n          mode = MAIN;\r\n        }\r\n\r\n        s += c;\r\n        break;\r\n    }\r\n\r\n    if (c === \"\\\\\") {\r\n      escape ^= true;\r\n    } else {\r\n      escape = false;\r\n    }\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nfunction StructParser() {\r\n  let basic_types = new Set([\r\n    \"int\", \"float\", \"double\", \"string\", \"short\", \"byte\", \"sbyte\", \"bool\", \"uint\", \"ushort\"\r\n  ]);\r\n\r\n  let reserved_tokens = new Set([\r\n    \"int\", \"float\", \"double\", \"string\", \"static_string\", \"array\",\r\n    \"iter\", \"abstract\", \"short\", \"byte\", \"sbyte\", \"bool\", \"iterkeys\", \"uint\", \"ushort\",\r\n    \"static_array\"\r\n  ]);\r\n\r\n  function tk(name, re, func) {\r\n    return new tokdef(name, re, func);\r\n  }\r\n\r\n  let tokens = [\r\n    tk(\"ID\", /[a-zA-Z_$]+[a-zA-Z0-9_\\.$]*/, function (t) {\r\n\r\n      if (reserved_tokens.has(t.value)) {\r\n        t.type = t.value.toUpperCase();\r\n      }\r\n      return t;\r\n    }, \"identifier\"),\r\n    tk(\"OPEN\", /\\{/),\r\n    tk(\"EQUALS\", /=/),\r\n    tk(\"CLOSE\", /}/),\r\n    tk(\"STRLIT\", /\\\"[^\"]*\\\"/, t => {\r\n      t.value = t.value.slice(1, t.value.length - 1);\r\n      return t;\r\n    }),\r\n    tk(\"STRLIT\", /\\'[^']*\\'/, t => {\r\n      t.value = t.value.slice(1, t.value.length - 1);\r\n      return t;\r\n    }),\r\n    tk(\"COLON\", /:/),\r\n    tk(\"SOPEN\", /\\[/),\r\n    tk(\"SCLOSE\", /\\]/),\r\n    tk(\"JSCRIPT\", /\\|/, function (t) {\r\n      let js = \"\";\r\n      let lexer = t.lexer;\r\n      while (lexer.lexpos < lexer.lexdata.length) {\r\n        let c = lexer.lexdata[lexer.lexpos];\r\n        if (c === \"\\n\")\r\n          break;\r\n        js += c;\r\n        lexer.lexpos++;\r\n      }\r\n\r\n      while (js.trim().endsWith(\";\")) {\r\n        js = js.slice(0, js.length - 1);\r\n        lexer.lexpos--;\r\n      }\r\n      t.value = js.trim();\r\n      return t;\r\n    }),\r\n    tk(\"LPARAM\", /\\(/),\r\n    tk(\"RPARAM\", /\\)/),\r\n    tk(\"COMMA\", /,/),\r\n    tk(\"NUM\", /[0-9]+/, undefined, \"number\"),\r\n    tk(\"SEMI\", /;/),\r\n    tk(\"NEWLINE\", /\\n/, function (t) {\r\n      t.lexer.lineno += 1;\r\n    }, \"newline\"),\r\n    tk(\"SPACE\", / |\\t/, function (t) {\r\n    }, \"whitespace\")\r\n  ];\r\n\r\n  reserved_tokens.forEach(function (rt) {\r\n    tokens.push(tk(rt.toUpperCase()));\r\n  });\r\n\r\n  function errfunc(lexer) {\r\n    return true;\r\n  }\r\n\r\n  class Lexer extends lexer {\r\n    input(str) {\r\n      str = stripComments(str);\r\n      return super.input(str);\r\n    }\r\n  }\r\n\r\n  let lex = new Lexer(tokens, errfunc);\r\n  let parser$1 = new parser(lex);\r\n\r\n  function p_Static_String(p) {\r\n    p.expect(\"STATIC_STRING\");\r\n    p.expect(\"SOPEN\");\r\n    let num = p.expect(\"NUM\");\r\n    p.expect(\"SCLOSE\");\r\n    return {type: StructEnum.STATIC_STRING, data: {maxlength: num}}\r\n  }\r\n\r\n  function p_DataRef(p) {\r\n    p.expect(\"DATAREF\");\r\n    p.expect(\"LPARAM\");\r\n    let tname = p.expect(\"ID\");\r\n    p.expect(\"RPARAM\");\r\n    return {type: StructEnum.DATAREF, data: tname}\r\n  }\r\n\r\n  function p_Array(p) {\r\n    p.expect(\"ARRAY\");\r\n    p.expect(\"LPARAM\");\r\n    let arraytype = p_Type(p);\r\n\r\n    let itername = \"\";\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = arraytype.data.replace(/\"/g, \"\");\r\n      arraytype = p_Type(p);\r\n    }\r\n\r\n    p.expect(\"RPARAM\");\r\n    return {type: StructEnum.ARRAY, data: {type: arraytype, iname: itername}}\r\n  }\r\n\r\n  function p_Iter(p) {\r\n    p.expect(\"ITER\");\r\n    p.expect(\"LPARAM\");\r\n\r\n    let arraytype = p_Type(p);\r\n    let itername = \"\";\r\n\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = arraytype.data.replace(/\"/g, \"\");\r\n      arraytype = p_Type(p);\r\n    }\r\n\r\n    p.expect(\"RPARAM\");\r\n    return {type: StructEnum.ITER, data: {type: arraytype, iname: itername}}\r\n  }\r\n\r\n  function p_StaticArray(p) {\r\n    p.expect(\"STATIC_ARRAY\");\r\n    p.expect(\"SOPEN\");\r\n    let arraytype = p_Type(p);\r\n    let itername = \"\";\r\n\r\n    p.expect(\"COMMA\");\r\n    let size = p.expect(\"NUM\");\r\n\r\n    if (size < 0 || Math.abs(size - Math.floor(size)) > 0.000001) {\r\n      console.log(Math.abs(size - Math.floor(size)));\r\n      p.error(\"Expected an integer\");\r\n    }\r\n\r\n    size = Math.floor(size);\r\n\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = p_Type(p).data;\r\n    }\r\n\r\n    p.expect(\"SCLOSE\");\r\n    return {type: StructEnum.STATIC_ARRAY, data: {type: arraytype, size: size, iname: itername}}\r\n  }\r\n\r\n  function p_IterKeys(p) {\r\n    p.expect(\"ITERKEYS\");\r\n    p.expect(\"LPARAM\");\r\n\r\n    let arraytype = p_Type(p);\r\n    let itername = \"\";\r\n\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = arraytype.data.replace(/\"/g, \"\");\r\n      arraytype = p_Type(p);\r\n    }\r\n\r\n    p.expect(\"RPARAM\");\r\n    return {type: StructEnum.ITERKEYS, data: {type: arraytype, iname: itername}}\r\n  }\r\n\r\n  function p_Abstract(p) {\r\n    p.expect(\"ABSTRACT\");\r\n    p.expect(\"LPARAM\");\r\n    let type = p.expect(\"ID\");\r\n\r\n    let jsonKeyword = \"_structName\";\r\n\r\n    if (p.optional(\"COMMA\")) {\r\n      jsonKeyword = p.expect(\"STRLIT\");\r\n    }\r\n\r\n    p.expect(\"RPARAM\");\r\n\r\n    return {\r\n      type: StructEnum.TSTRUCT,\r\n      data: type,\r\n      jsonKeyword\r\n    }\r\n  }\r\n\r\n  function p_Type(p) {\r\n    let tok = p.peek();\r\n\r\n    if (tok.type === \"ID\") {\r\n      p.next();\r\n      return {type: StructEnum.STRUCT, data: tok.value}\r\n    } else if (basic_types.has(tok.type.toLowerCase())) {\r\n      p.next();\r\n      return {type: StructTypes[tok.type.toLowerCase()]}\r\n    } else if (tok.type === \"ARRAY\") {\r\n      return p_Array(p);\r\n    } else if (tok.type === \"ITER\") {\r\n      return p_Iter(p);\r\n    } else if (tok.type === \"ITERKEYS\") {\r\n      return p_IterKeys(p);\r\n    } else if (tok.type === \"STATIC_ARRAY\") {\r\n      return p_StaticArray(p);\r\n    } else if (tok.type === \"STATIC_STRING\") {\r\n      return p_Static_String(p);\r\n    } else if (tok.type === \"ABSTRACT\") {\r\n      return p_Abstract(p);\r\n    } else if (tok.type === \"DATAREF\") {\r\n      return p_DataRef(p);\r\n    } else {\r\n      p.error(tok, \"invalid type \" + tok.type);\r\n    }\r\n  }\r\n\r\n  function p_ID_or_num(p) {\r\n    let t = p.peeknext();\r\n\r\n    if (t.type === \"NUM\") {\r\n      p.next();\r\n      return t.value;\r\n    } else {\r\n      return p.expect(\"ID\", \"struct field name\");\r\n    }\r\n  }\r\n\r\n  function p_Field(p) {\r\n    let field = {};\r\n\r\n    field.name = p_ID_or_num(p);\r\n    p.expect(\"COLON\");\r\n\r\n    field.type = p_Type(p);\r\n    field.set = undefined;\r\n    field.get = undefined;\r\n\r\n    let check = 0;\r\n\r\n    let tok = p.peek();\r\n    if (tok.type === \"JSCRIPT\") {\r\n      field.get = tok.value;\r\n      check = 1;\r\n      p.next();\r\n    }\r\n\r\n    tok = p.peek();\r\n    if (tok.type === \"JSCRIPT\") {\r\n      check = 1;\r\n      field.set = tok.value;\r\n      p.next();\r\n    }\r\n\r\n    p.expect(\"SEMI\");\r\n\r\n    return field;\r\n  }\r\n\r\n  function p_Struct(p) {\r\n    let name = p.expect(\"ID\", \"struct name\");\r\n\r\n    let st = new NStruct(name);\r\n\r\n    let tok = p.peek();\r\n    let id = -1;\r\n\r\n    if (tok.type === \"ID\" && tok.value === \"id\") {\r\n      p.next();\r\n      p.expect(\"EQUALS\");\r\n      st.id = p.expect(\"NUM\");\r\n    }\r\n\r\n    p.expect(\"OPEN\");\r\n    while (1) {\r\n      if (p.at_end()) {\r\n        p.error(undefined);\r\n      } else if (p.optional(\"CLOSE\")) {\r\n        break;\r\n      } else {\r\n        st.fields.push(p_Field(p));\r\n      }\r\n    }\r\n\r\n    return st;\r\n  }\r\n\r\n  parser$1.start = p_Struct;\r\n  return parser$1;\r\n}\r\n\r\nconst struct_parse = StructParser();\r\n\r\nvar struct_parser = /*#__PURE__*/Object.freeze({\r\n  __proto__: null,\r\n  NStruct: NStruct,\r\n  StructEnum: StructEnum,\r\n  ValueTypes: ValueTypes,\r\n  StructTypes: StructTypes,\r\n  StructTypeMap: StructTypeMap,\r\n  stripComments: stripComments,\r\n  struct_parse: struct_parse\r\n});\r\n\r\n/** dead file */\r\n\r\nvar struct_typesystem = /*#__PURE__*/Object.freeze({\r\n  __proto__: null\r\n});\r\n\r\n\"use strict\";\r\n\r\nvar STRUCT_ENDIAN = true; //little endian\r\n\r\nfunction setBinaryEndian(mode) {\r\n  STRUCT_ENDIAN = !!mode;\r\n}\r\n\r\nlet temp_dataview = new DataView(new ArrayBuffer(16));\r\nlet uint8_view = new Uint8Array(temp_dataview.buffer);\r\n\r\nclass unpack_context {\r\n  constructor() {\r\n    this.i = 0;\r\n  }\r\n}\r\n\r\nfunction pack_byte(array, val) {\r\n  array.push(val);\r\n}\r\n\r\nfunction pack_sbyte(array, val) {\r\n  if (val < 0) {\r\n    val = 256 + val;\r\n  }\r\n\r\n  array.push(val);\r\n}\r\n\r\nfunction pack_bytes(array, bytes) {\r\n  for (let i = 0; i < bytes.length; i++) {\r\n    array.push(bytes[i]);\r\n  }\r\n}\r\n\r\nfunction pack_int(array, val) {\r\n  temp_dataview.setInt32(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n  array.push(uint8_view[2]);\r\n  array.push(uint8_view[3]);\r\n}\r\n\r\nfunction pack_uint(array, val) {\r\n  temp_dataview.setUint32(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n  array.push(uint8_view[2]);\r\n  array.push(uint8_view[3]);\r\n}\r\n\r\nfunction pack_ushort(array, val) {\r\n  temp_dataview.setUint16(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n}\r\n\r\nfunction pack_float(array, val) {\r\n  temp_dataview.setFloat32(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n  array.push(uint8_view[2]);\r\n  array.push(uint8_view[3]);\r\n}\r\n\r\nfunction pack_double(array, val) {\r\n  temp_dataview.setFloat64(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n  array.push(uint8_view[2]);\r\n  array.push(uint8_view[3]);\r\n  array.push(uint8_view[4]);\r\n  array.push(uint8_view[5]);\r\n  array.push(uint8_view[6]);\r\n  array.push(uint8_view[7]);\r\n}\r\n\r\nfunction pack_short(array, val) {\r\n  temp_dataview.setInt16(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n}\r\n\r\nfunction encode_utf8(arr, str) {\r\n  for (let i = 0; i < str.length; i++) {\r\n    let c = str.charCodeAt(i);\r\n\r\n    while (c !== 0) {\r\n      let uc = c & 127;\r\n      c = c >> 7;\r\n\r\n      if (c !== 0)\r\n        uc |= 128;\r\n\r\n      arr.push(uc);\r\n    }\r\n  }\r\n}\r\n\r\nfunction decode_utf8(arr) {\r\n  let str = \"\";\r\n  let i = 0;\r\n\r\n  while (i < arr.length) {\r\n    let c = arr[i];\r\n    let sum = c & 127;\r\n    let j = 0;\r\n    let lasti = i;\r\n\r\n    while (i < arr.length && (c & 128)) {\r\n      j += 7;\r\n      i++;\r\n      c = arr[i];\r\n\r\n      c = (c & 127) << j;\r\n      sum |= c;\r\n    }\r\n\r\n    if (sum === 0) break;\r\n\r\n    str += String.fromCharCode(sum);\r\n    i++;\r\n  }\r\n\r\n  return str;\r\n}\r\n\r\nfunction test_utf8() {\r\n  let s = \"a\" + String.fromCharCode(8800) + \"b\";\r\n  let arr = [];\r\n\r\n  encode_utf8(arr, s);\r\n  let s2 = decode_utf8(arr);\r\n\r\n  if (s !== s2) {\r\n    throw new Error(\"UTF-8 encoding/decoding test failed\");\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction truncate_utf8(arr, maxlen) {\r\n  let len = Math.min(arr.length, maxlen);\r\n\r\n  let last_codepoint = 0;\r\n  let last2 = 0;\r\n\r\n  let incode = false;\r\n  let i = 0;\r\n  let code = 0;\r\n  while (i < len) {\r\n    incode = arr[i] & 128;\r\n\r\n    if (!incode) {\r\n      last2 = last_codepoint + 1;\r\n      last_codepoint = i + 1;\r\n    }\r\n\r\n    i++;\r\n  }\r\n\r\n  if (last_codepoint < maxlen)\r\n    arr.length = last_codepoint;\r\n  else\r\n    arr.length = last2;\r\n\r\n  return arr;\r\n}\r\n\r\nlet _static_sbuf_ss = new Array(2048);\r\n\r\nfunction pack_static_string(data, str, length) {\r\n  if (length === undefined)\r\n    throw new Error(\"'length' paremter is not optional for pack_static_string()\");\r\n\r\n  let arr = length < 2048 ? _static_sbuf_ss : new Array();\r\n  arr.length = 0;\r\n\r\n  encode_utf8(arr, str);\r\n  truncate_utf8(arr, length);\r\n\r\n  for (let i = 0; i < length; i++) {\r\n    if (i >= arr.length) {\r\n      data.push(0);\r\n    } else {\r\n      data.push(arr[i]);\r\n    }\r\n  }\r\n}\r\n\r\nlet _static_sbuf = new Array(32);\r\n\r\n/*strings are packed as 32-bit unicode codepoints*/\r\nfunction pack_string(data, str) {\r\n  _static_sbuf.length = 0;\r\n  encode_utf8(_static_sbuf, str);\r\n\r\n  pack_int(data, _static_sbuf.length);\r\n\r\n  for (let i = 0; i < _static_sbuf.length; i++) {\r\n    data.push(_static_sbuf[i]);\r\n  }\r\n}\r\n\r\nfunction unpack_bytes(dview, uctx, len) {\r\n  let ret = new DataView(dview.buffer.slice(uctx.i, uctx.i + len));\r\n  uctx.i += len;\r\n\r\n  return ret;\r\n}\r\n\r\nfunction unpack_byte(dview, uctx) {\r\n  return dview.getUint8(uctx.i++);\r\n}\r\n\r\nfunction unpack_sbyte(dview, uctx) {\r\n  return dview.getInt8(uctx.i++);\r\n}\r\n\r\nfunction unpack_int(dview, uctx) {\r\n  uctx.i += 4;\r\n  return dview.getInt32(uctx.i - 4, STRUCT_ENDIAN);\r\n}\r\n\r\nfunction unpack_uint(dview, uctx) {\r\n  uctx.i += 4;\r\n  return dview.getUint32(uctx.i - 4, STRUCT_ENDIAN);\r\n}\r\n\r\nfunction unpack_ushort(dview, uctx) {\r\n  uctx.i += 2;\r\n  return dview.getUint16(uctx.i - 2, STRUCT_ENDIAN);\r\n}\r\n\r\nfunction unpack_float(dview, uctx) {\r\n  uctx.i += 4;\r\n  return dview.getFloat32(uctx.i - 4, STRUCT_ENDIAN);\r\n}\r\n\r\nfunction unpack_double(dview, uctx) {\r\n  uctx.i += 8;\r\n  return dview.getFloat64(uctx.i - 8, STRUCT_ENDIAN);\r\n}\r\n\r\nfunction unpack_short(dview, uctx) {\r\n  uctx.i += 2;\r\n  return dview.getInt16(uctx.i - 2, STRUCT_ENDIAN);\r\n}\r\n\r\nlet _static_arr_us = new Array(32);\r\n\r\nfunction unpack_string(data, uctx) {\r\n  let slen = unpack_int(data, uctx);\r\n\r\n  if (!slen) {\r\n    return \"\";\r\n  }\r\n\r\n  let str = \"\";\r\n  let arr = slen < 2048 ? _static_arr_us : new Array(slen);\r\n\r\n  arr.length = slen;\r\n  for (let i = 0; i < slen; i++) {\r\n    arr[i] = unpack_byte(data, uctx);\r\n  }\r\n\r\n  return decode_utf8(arr);\r\n}\r\n\r\nlet _static_arr_uss = new Array(2048);\r\n\r\nfunction unpack_static_string(data, uctx, length) {\r\n  let str = \"\";\r\n\r\n  if (length === undefined)\r\n    throw new Error(\"'length' cannot be undefined in unpack_static_string()\");\r\n\r\n  let arr = length < 2048 ? _static_arr_uss : new Array(length);\r\n  arr.length = 0;\r\n\r\n  let done = false;\r\n  for (let i = 0; i < length; i++) {\r\n    let c = unpack_byte(data, uctx);\r\n\r\n    if (c === 0) {\r\n      done = true;\r\n    }\r\n\r\n    if (!done && c !== 0) {\r\n      arr.push(c);\r\n      //arr.length++;\r\n    }\r\n  }\r\n\r\n  truncate_utf8(arr, length);\r\n  return decode_utf8(arr);\r\n}\r\n\r\nvar struct_binpack = /*#__PURE__*/Object.freeze({\r\n  __proto__: null,\r\n  get STRUCT_ENDIAN () { return STRUCT_ENDIAN; },\r\n  setBinaryEndian: setBinaryEndian,\r\n  temp_dataview: temp_dataview,\r\n  uint8_view: uint8_view,\r\n  unpack_context: unpack_context,\r\n  pack_byte: pack_byte,\r\n  pack_sbyte: pack_sbyte,\r\n  pack_bytes: pack_bytes,\r\n  pack_int: pack_int,\r\n  pack_uint: pack_uint,\r\n  pack_ushort: pack_ushort,\r\n  pack_float: pack_float,\r\n  pack_double: pack_double,\r\n  pack_short: pack_short,\r\n  encode_utf8: encode_utf8,\r\n  decode_utf8: decode_utf8,\r\n  test_utf8: test_utf8,\r\n  pack_static_string: pack_static_string,\r\n  pack_string: pack_string,\r\n  unpack_bytes: unpack_bytes,\r\n  unpack_byte: unpack_byte,\r\n  unpack_sbyte: unpack_sbyte,\r\n  unpack_int: unpack_int,\r\n  unpack_uint: unpack_uint,\r\n  unpack_ushort: unpack_ushort,\r\n  unpack_float: unpack_float,\r\n  unpack_double: unpack_double,\r\n  unpack_short: unpack_short,\r\n  unpack_string: unpack_string,\r\n  unpack_static_string: unpack_static_string\r\n});\r\n\r\nlet warninglvl = 2;\r\nlet debug = 0;\r\n\r\nlet _static_envcode_null = \"\";\r\nlet packer_debug, packer_debug_start, packer_debug_end;\r\nlet packdebug_tablevel = 0;\r\n\r\nfunction _get_pack_debug() {\r\n  return {\r\n    packer_debug, packer_debug_start, packer_debug_end,\r\n    debug, warninglvl\r\n  }\r\n}\r\n\r\nclass cachering extends Array {\r\n  constructor(cb, tot) {\r\n    super();\r\n    this.length = tot;\r\n    this.cur = 0;\r\n\r\n    for (let i = 0; i < tot; i++) {\r\n      this[i] = cb();\r\n    }\r\n  }\r\n\r\n  static fromConstructor(cls, tot) {\r\n    return new cachering(() => new cls(), tot);\r\n  }\r\n\r\n  next() {\r\n    let ret = this[this.cur];\r\n\r\n    this.cur = (this.cur + 1)%this.length;\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nfunction gen_tabstr$1(tot) {\r\n  let ret = \"\";\r\n\r\n  for (let i = 0; i < tot; i++) {\r\n    ret += \" \";\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nfunction setWarningMode2(t) {\r\n  if (typeof t !== \"number\" || isNaN(t)) {\r\n    throw new Error(\"Expected a single number (>= 0) argument to setWarningMode\");\r\n  }\r\n\r\n  warninglvl = t;\r\n}\r\n\r\nfunction setDebugMode2(t) {\r\n  debug = t;\r\n\r\n  if (debug) {\r\n    packer_debug = function () {\r\n      let tab = gen_tabstr$1(packdebug_tablevel);\r\n\r\n      if (arguments.length > 0) {\r\n        console.warn(tab, ...arguments);\r\n      } else {\r\n        console.warn(\"Warning: undefined msg\");\r\n      }\r\n    };\r\n    packer_debug_start = function (funcname) {\r\n      packer_debug(\"Start \" + funcname);\r\n      packdebug_tablevel++;\r\n    };\r\n\r\n    packer_debug_end = function (funcname) {\r\n      packdebug_tablevel--;\r\n\r\n      if (funcname) {\r\n        packer_debug(\"Leave \" + funcname);\r\n      }\r\n    };\r\n  } else {\r\n    packer_debug = function () {\r\n    };\r\n    packer_debug_start = function () {\r\n    };\r\n    packer_debug_end = function () {\r\n    };\r\n  }\r\n}\r\n\r\nsetDebugMode2(debug);\r\n\r\nconst StructFieldTypes = [];\r\nconst StructFieldTypeMap = {};\r\n\r\nfunction packNull(manager, data, field, type) {\r\n  StructFieldTypeMap[type.type].packNull(manager, data, field, type);\r\n}\r\n\r\nfunction toJSON(manager, val, obj, field, type) {\r\n  return StructFieldTypeMap[type.type].toJSON(manager, val, obj, field, type);\r\n}\r\n\r\nfunction fromJSON(manager, val, obj, field, type, instance) {\r\n  return StructFieldTypeMap[type.type].fromJSON(manager, val, obj, field, type, instance);\r\n}\r\n\r\nfunction validateJSON(manager, val, obj, field, type, instance, _abstractKey) {\r\n  return StructFieldTypeMap[type.type].validateJSON(manager, val, obj, field, type, instance, _abstractKey);\r\n}\r\n\r\n\r\nfunction unpack_field(manager, data, type, uctx) {\r\n  let name;\r\n\r\n  if (debug) {\r\n    name = StructFieldTypeMap[type.type].define().name;\r\n    packer_debug_start(\"R \" + name);\r\n  }\r\n\r\n  let ret = StructFieldTypeMap[type.type].unpack(manager, data, type, uctx);\r\n\r\n  if (debug) {\r\n    packer_debug_end();\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nlet fakeFields = new cachering(() => {\r\n  return {type: undefined, get: undefined, set: undefined}\r\n}, 256);\r\n\r\nfunction fmt_type(type) {\r\n  return StructFieldTypeMap[type.type].format(type);\r\n}\r\n\r\nfunction do_pack(manager, data, val, obj, field, type) {\r\n  let name;\r\n\r\n  if (debug) {\r\n    name = StructFieldTypeMap[type.type].define().name;\r\n    packer_debug_start(\"W \" + name);\r\n  }\r\n\r\n  let typeid = type;\r\n  if (typeof typeid !== \"number\") {\r\n    typeid = typeid.type;\r\n  }\r\n\r\n  let ret = StructFieldTypeMap[typeid].pack(manager, data, val, obj, field, type);\r\n\r\n  if (debug) {\r\n    packer_debug_end();\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nlet _ws_env = [[undefined, undefined]];\r\n\r\nclass StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    this.pack(manager, data, 0, 0, field, type);\r\n  }\r\n\r\n  static format(type) {\r\n    return this.define().name;\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    return val;\r\n  }\r\n\r\n  static fromJSON(manager, val, obj, field, type, instance) {\r\n    return val;\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance, _abstractKey) {\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   return false to override default\r\n   helper js for packing\r\n   */\r\n  static useHelperJS(field) {\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   Define field class info.\r\n\r\n   Example:\r\n   <pre>\r\n   static define() {return {\r\n    type : StructEnum.INT,\r\n    name : \"int\"\r\n  }}\r\n   </pre>\r\n   */\r\n  static define() {\r\n    return {\r\n      type: -1,\r\n      name: \"(error)\"\r\n    }\r\n  }\r\n\r\n  /**\r\n   Register field packer/unpacker class.  Will throw an error if define() method is bad.\r\n   */\r\n  static register(cls) {\r\n    if (StructFieldTypes.indexOf(cls) >= 0) {\r\n      throw new Error(\"class already registered\");\r\n    }\r\n\r\n    if (cls.define === StructFieldType.define) {\r\n      throw new Error(\"you forgot to make a define() static method\");\r\n    }\r\n\r\n    if (cls.define().type === undefined) {\r\n      throw new Error(\"cls.define().type was undefined!\");\r\n    }\r\n\r\n    if (cls.define().type in StructFieldTypeMap) {\r\n      throw new Error(\"type \" + cls.define().type + \" is used by another StructFieldType subclass\");\r\n    }\r\n\r\n    StructFieldTypes.push(cls);\r\n    StructFieldTypeMap[cls.define().type] = cls;\r\n  }\r\n}\r\n\r\nclass StructIntField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_int(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_int(data, uctx);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (typeof val !== \"number\" || val !== Math.floor(val)) {\r\n      return \"\" + val + \" is not an integer\";\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.INT,\r\n      name: \"int\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructIntField);\r\n\r\nclass StructFloatField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_float(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_float(data, uctx);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance, _abstractKey) {\r\n    if (typeof val !== \"number\") {\r\n      return \"Not a float: \" + val;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.FLOAT,\r\n      name: \"float\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructFloatField);\r\n\r\nclass StructDoubleField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_double(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_double(data, uctx);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (typeof val !== \"number\") {\r\n      return \"Not a double: \" + val;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.DOUBLE,\r\n      name: \"double\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructDoubleField);\r\n\r\nclass StructStringField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    val = !val ? \"\" : val;\r\n\r\n    pack_string(data, val);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (typeof val !== \"string\") {\r\n      return \"Not a string: \" + val;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    this.pack(manager, data, \"\", 0, field, type);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_string(data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.STRING,\r\n      name: \"string\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructStringField);\r\n\r\nclass StructStaticStringField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    val = !val ? \"\" : val;\r\n\r\n    pack_static_string(data, val, type.data.maxlength);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (typeof val !== \"string\") {\r\n      return \"Not a string: \" + val;\r\n    }\r\n\r\n\r\n    if (val.length > type.data.maxlength) {\r\n      return \"String is too big; limit is \" + type.data.maxlength + \"; string:\" + val;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static format(type) {\r\n    return `static_string[${type.data.maxlength}]`;\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    this.pack(manager, data, \"\", 0, field, type);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_static_string(data, uctx, type.data.maxlength);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.STATIC_STRING,\r\n      name: \"static_string\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructStaticStringField);\r\n\r\nclass StructStructField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    packer_debug(\"struct\", stt.name);\r\n\r\n    manager.write_struct(data, val, stt);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance, _abstractKey) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    if (!val) {\r\n      return \"Expected \" + stt.name + \" object\";\r\n    }\r\n\r\n    return manager.validateJSONIntern(val, stt, _abstractKey);\r\n  }\r\n\r\n  static format(type) {\r\n    return type.data;\r\n  }\r\n\r\n  static fromJSON(manager, val, obj, field, type, instance) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    return manager.readJSON(val, stt, instance);\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    let stt = manager.get_struct(type.data);\r\n    return manager.writeJSON(val, stt);\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, dest) {\r\n    let cls2 = manager.get_struct_cls(type.data);\r\n\r\n    packer_debug(\"struct\", cls2 ? cls2.name : \"(error)\");\r\n    return manager.read_object(data, cls2, uctx, dest);\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    packer_debug(\"struct\", type);\r\n\r\n    for (let field2 of stt.fields) {\r\n      let type2 = field2.type;\r\n\r\n      packNull(manager, data, field2, type2);\r\n    }\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let cls2 = manager.get_struct_cls(type.data);\r\n    packer_debug(\"struct\", cls2 ? cls2.name : \"(error)\");\r\n\r\n    return manager.read_object(data, cls2, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.STRUCT,\r\n      name: \"struct\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructStructField);\r\n\r\nclass StructTStructField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    let cls = manager.get_struct_cls(type.data);\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    const keywords = manager.constructor.keywords;\r\n\r\n    //make sure inheritance is correct\r\n    if (val.constructor.structName !== type.data && (val instanceof cls)) {\r\n      //if (DEBUG.Struct) {\r\n      //    console.log(val.constructor.structName+\" inherits from \"+cls.structName);\r\n      //}\r\n      stt = manager.get_struct(val.constructor.structName);\r\n    } else if (val.constructor.structName === type.data) {\r\n      stt = manager.get_struct(type.data);\r\n    } else {\r\n      console.trace();\r\n      throw new Error(\"Bad struct \" + val.constructor.structName + \" passed to write_struct\");\r\n    }\r\n\r\n    packer_debug(\"int \" + stt.id);\r\n\r\n    pack_int(data, stt.id);\r\n    manager.write_struct(data, val, stt);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance, _abstractKey) {\r\n    let key = type.jsonKeyword;\r\n\r\n    if (typeof val !== \"object\") {\r\n      return typeof val + \" is not an object\";\r\n    }\r\n\r\n    let stt = manager.get_struct(val[key]);\r\n    let cls = manager.get_struct_cls(stt.name);\r\n    let parentcls = manager.get_struct_cls(type.data);\r\n\r\n    let ok = false;\r\n\r\n    do {\r\n      if (cls === parentcls) {\r\n        ok = true;\r\n        break;\r\n      }\r\n\r\n      cls = cls.prototype.__proto__.constructor;\r\n    } while (cls && cls !== Object);\r\n\r\n    if (!ok) {\r\n      return stt.name + \" is not a child class off \" + type.data;\r\n    }\r\n\r\n    return manager.validateJSONIntern(val, stt, type.jsonKeyword);\r\n  }\r\n\r\n\r\n  static fromJSON(manager, val, obj, field, type, instance) {\r\n    let key = type.jsonKeyword;\r\n\r\n    let stt = manager.get_struct(val[key]);\r\n\r\n    return manager.readJSON(val, stt, instance);\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    const keywords = manager.constructor.keywords;\r\n\r\n    let stt = manager.get_struct(val.constructor.structName);\r\n    let ret = manager.writeJSON(val, stt);\r\n\r\n    ret[type.jsonKeyword] = \"\" + stt.name;\r\n\r\n    return ret;\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    pack_int(data, stt.id);\r\n    packNull(manager, data, field, {type: StructEnum.STRUCT, data: type.data});\r\n  }\r\n\r\n  static format(type) {\r\n    return \"abstract(\" + type.data + \")\";\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, dest) {\r\n    let id = unpack_int(data, uctx);\r\n\r\n    packer_debug(\"-int \" + id);\r\n    if (!(id in manager.struct_ids)) {\r\n      packer_debug(\"tstruct id: \" + id);\r\n      console.trace();\r\n      console.log(id);\r\n      console.log(manager.struct_ids);\r\n      throw new Error(\"Unknown struct type \" + id + \".\");\r\n    }\r\n\r\n    let cls2 = manager.get_struct_id(id);\r\n\r\n    packer_debug(\"struct name: \" + cls2.name);\r\n\r\n    cls2 = manager.struct_cls[cls2.name];\r\n\r\n    return manager.read_object(data, cls2, uctx, dest);\r\n    //packer_debug(\"ret\", ret);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let id = unpack_int(data, uctx);\r\n\r\n    packer_debug(\"-int \" + id);\r\n    if (!(id in manager.struct_ids)) {\r\n      packer_debug(\"tstruct id: \" + id);\r\n      console.trace();\r\n      console.log(id);\r\n      console.log(manager.struct_ids);\r\n      throw new Error(\"Unknown struct type \" + id + \".\");\r\n    }\r\n\r\n    let cls2 = manager.get_struct_id(id);\r\n\r\n    packer_debug(\"struct name: \" + cls2.name);\r\n    cls2 = manager.struct_cls[cls2.name];\r\n\r\n    return manager.read_object(data, cls2, uctx);\r\n    //packer_debug(\"ret\", ret);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.TSTRUCT,\r\n      name: \"tstruct\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructTStructField);\r\n\r\nclass StructArrayField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    if (val === undefined) {\r\n      console.trace();\r\n      console.log(\"Undefined array fed to struct struct packer!\");\r\n      console.log(\"Field: \", field);\r\n      console.log(\"Type: \", type);\r\n      console.log(\"\");\r\n      packer_debug(\"int 0\");\r\n      pack_int(data, 0);\r\n      return;\r\n    }\r\n\r\n    packer_debug(\"int \" + val.length);\r\n    pack_int(data, val.length);\r\n\r\n    let d = type.data;\r\n\r\n    let itername = d.iname;\r\n    let type2 = d.type;\r\n\r\n    let env = _ws_env;\r\n    for (let i = 0; i < val.length; i++) {\r\n      let val2 = val[i];\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n      }\r\n\r\n      //XXX not sure I really need this fakeField stub here. . .\r\n      let fakeField = fakeFields.next();\r\n      fakeField.type = type2;\r\n      do_pack(manager, data, val2, obj, fakeField, type2);\r\n    }\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    pack_int(data, 0);\r\n  }\r\n\r\n  static format(type) {\r\n    if (type.data.iname !== \"\" && type.data.iname !== undefined) {\r\n      return \"array(\" + type.data.iname + \", \" + fmt_type(type.data.type) + \")\";\r\n    } else {\r\n      return \"array(\" + fmt_type(type.data.type) + \")\";\r\n    }\r\n  }\r\n\r\n  static useHelperJS(field) {\r\n    return !field.type.data.iname;\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance, _abstractKey) {\r\n    if (!val) {\r\n      return \"not an array: \" + val;\r\n    }\r\n\r\n    for (let i = 0; i < val.length; i++) {\r\n      let ret = validateJSON(manager, val[i], val, field, type.data.type, undefined, _abstractKey);\r\n\r\n      if (typeof ret === \"string\" || !ret) {\r\n        return ret;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static fromJSON(manager, val, obj, field, type, instance) {\r\n    let ret = instance || [];\r\n\r\n    ret.length = 0;\r\n\r\n    for (let i = 0; i < val.length; i++) {\r\n      let val2 = fromJSON(manager, val[i], val, field, type.data.type, undefined);\r\n\r\n      if (val2 === undefined) {\r\n        console.log(val2);\r\n        console.error(\"eeek\");\r\n        process.exit();\r\n      }\r\n\r\n      ret.push(val2);\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    val = val || [];\r\n    let json = [];\r\n\r\n    let itername = type.data.iname;\r\n\r\n    for (let i = 0; i < val.length; i++) {\r\n      let val2 = val[i];\r\n      let env = _ws_env;\r\n\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n\r\n        //console.log(\"VAL2\", val2, toJSON(manager, val2, val, field, type.data.type));\r\n      }\r\n\r\n      json.push(toJSON(manager, val2, val, field, type.data.type));\r\n    }\r\n\r\n    return json;\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, dest) {\r\n    let len = unpack_int(data, uctx);\r\n    dest.length = 0;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      dest.push(unpack_field(manager, data, type.data.type, uctx));\r\n    }\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let len = unpack_int(data, uctx);\r\n    packer_debug(\"-int \" + len);\r\n\r\n    let arr = new Array(len);\r\n    for (let i = 0; i < len; i++) {\r\n      arr[i] = unpack_field(manager, data, type.data.type, uctx);\r\n    }\r\n\r\n    return arr;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.ARRAY,\r\n      name: \"array\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructArrayField);\r\n\r\nclass StructIterField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    //this was originally implemented to use ES6 iterators.\r\n    function forEach(cb, thisvar) {\r\n      if (val && val[Symbol.iterator]) {\r\n        for (let item of val) {\r\n          cb.call(thisvar, item);\r\n        }\r\n      } else if (val && val.forEach) {\r\n        val.forEach(function (item) {\r\n          cb.call(thisvar, item);\r\n        });\r\n      } else {\r\n        console.trace();\r\n        console.log(\"Undefined iterable list fed to struct struct packer!\", val);\r\n        console.log(\"Field: \", field);\r\n        console.log(\"Type: \", type);\r\n        console.log(\"\");\r\n      }\r\n    }\r\n\r\n    /* save space for length */\r\n    let starti = data.length;\r\n    data.length += 4;\r\n\r\n    let d = type.data, itername = d.iname, type2 = d.type;\r\n    let env = _ws_env;\r\n\r\n    let i = 0;\r\n    forEach(function (val2) {\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n      }\r\n\r\n      //XXX not sure I really need this fakeField stub here. . .\r\n      let fakeField = fakeFields.next();\r\n      fakeField.type = type2;\r\n      do_pack(manager, data, val2, obj, fakeField, type2);\r\n\r\n      i++;\r\n    }, this);\r\n\r\n    /* write length */\r\n    temp_dataview.setInt32(0, i, STRUCT_ENDIAN);\r\n\r\n    data[starti++] = uint8_view[0];\r\n    data[starti++] = uint8_view[1];\r\n    data[starti++] = uint8_view[2];\r\n    data[starti++] = uint8_view[3];\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    return StructArrayField.validateJSON(...arguments);\r\n  }\r\n\r\n  static fromJSON() {\r\n    return StructArrayField.fromJSON(...arguments);\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    val = val || [];\r\n    let json = [];\r\n\r\n    let itername = type.data.iname;\r\n\r\n    for (let val2 of val) {\r\n      let env = _ws_env;\r\n\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n\r\n        //console.log(\"VAL2\", val2, toJSON(manager, val2, val, field, type.data.type));\r\n      }\r\n\r\n      json.push(toJSON(manager, val2, val, field, type.data.type));\r\n    }\r\n\r\n    return json;\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    pack_int(data, 0);\r\n  }\r\n\r\n  static useHelperJS(field) {\r\n    return !field.type.data.iname;\r\n  }\r\n\r\n  static format(type) {\r\n    if (type.data.iname !== \"\" && type.data.iname !== undefined) {\r\n      return \"iter(\" + type.data.iname + \", \" + fmt_type(type.data.type) + \")\";\r\n    } else {\r\n      return \"iter(\" + fmt_type(type.data.type) + \")\";\r\n    }\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, arr) {\r\n    let len = unpack_int(data, uctx);\r\n    packer_debug(\"-int \" + len);\r\n\r\n    arr.length = 0;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      arr.push(unpack_field(manager, data, type.data.type, uctx));\r\n    }\r\n\r\n    return arr;\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let len = unpack_int(data, uctx);\r\n    packer_debug(\"-int \" + len);\r\n\r\n    let arr = new Array(len);\r\n    for (let i = 0; i < len; i++) {\r\n      arr[i] = unpack_field(manager, data, type.data.type, uctx);\r\n    }\r\n\r\n    return arr;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.ITER,\r\n      name: \"iter\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructIterField);\r\n\r\nclass StructShortField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_short(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_short(data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.SHORT,\r\n      name: \"short\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructShortField);\r\n\r\nclass StructByteField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_byte(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_byte(data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.BYTE,\r\n      name: \"byte\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructByteField);\r\n\r\nclass StructSignedByteField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_sbyte(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_sbyte(data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.SIGNED_BYTE,\r\n      name: \"sbyte\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructSignedByteField);\r\n\r\nclass StructBoolField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_byte(data, !!val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return !!unpack_byte(data, uctx);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (val === 0 || val === 1 || val === true || val === false || val === \"true\" || val === \"false\") {\r\n      return true;\r\n    }\r\n\r\n    return \"\" + val + \" is not a bool\";\r\n  }\r\n\r\n  static fromJSON(manager, val, obj, field, type, instance) {\r\n    if (val === \"false\") {\r\n      val = false;\r\n    }\r\n\r\n    return !!val;\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    return !!val;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.BOOL,\r\n      name: \"bool\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructBoolField);\r\n\r\nclass StructIterKeysField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    //this was originally implemented to use ES6 iterators.\r\n    if ((typeof val !== \"object\" && typeof val !== \"function\") || val === null) {\r\n      console.warn(\"Bad object fed to iterkeys in struct packer!\", val);\r\n      console.log(\"Field: \", field);\r\n      console.log(\"Type: \", type);\r\n      console.log(\"\");\r\n\r\n      pack_int(data, 0);\r\n      return;\r\n    }\r\n\r\n    let len = 0.0;\r\n    for (let k in val) {\r\n      len++;\r\n    }\r\n\r\n    packer_debug(\"int \" + len);\r\n    pack_int(data, len);\r\n\r\n    let d = type.data, itername = d.iname, type2 = d.type;\r\n    let env = _ws_env;\r\n\r\n    let i = 0;\r\n    for (let val2 in val) {\r\n      if (i >= len) {\r\n        if (warninglvl > 0)\r\n          console.warn(\"Warning: object keys magically replaced on us\", val, i);\r\n        return;\r\n      }\r\n\r\n      if (itername && itername.trim().length > 0 && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n      } else {\r\n        val2 = val[val2]; //fetch value\r\n      }\r\n\r\n      let f2 = {type: type2, get: undefined, set: undefined};\r\n      do_pack(manager, data, val2, obj, f2, type2);\r\n\r\n      i++;\r\n    }\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    return StructArrayField.validateJSON(...arguments);\r\n  }\r\n\r\n  static fromJSON() {\r\n    return StructArrayField.fromJSON(...arguments);\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    val = val || [];\r\n    let json = [];\r\n\r\n    let itername = type.data.iname;\r\n\r\n    for (let k in val) {\r\n      let val2 = val[k];\r\n      let env = _ws_env;\r\n\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n\r\n        //console.log(\"VAL2\", val2, toJSON(manager, val2, val, field, type.data.type));\r\n      }\r\n\r\n      json.push(toJSON(manager, val2, val, field, type.data.type));\r\n    }\r\n\r\n    return json;\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    pack_int(data, 0);\r\n  }\r\n\r\n  static useHelperJS(field) {\r\n    return !field.type.data.iname;\r\n  }\r\n\r\n  static format(type) {\r\n    if (type.data.iname !== \"\" && type.data.iname !== undefined) {\r\n      return \"iterkeys(\" + type.data.iname + \", \" + fmt_type(type.data.type) + \")\";\r\n    } else {\r\n      return \"iterkeys(\" + fmt_type(type.data.type) + \")\";\r\n    }\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, arr) {\r\n    let len = unpack_int(data, uctx);\r\n    packer_debug(\"-int \" + len);\r\n\r\n    arr.length = 0;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      arr.push(unpack_field(manager, data, type.data.type, uctx));\r\n    }\r\n\r\n    return arr;\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let len = unpack_int(data, uctx);\r\n    packer_debug(\"-int \" + len);\r\n\r\n    let arr = new Array(len);\r\n    for (let i = 0; i < len; i++) {\r\n      arr[i] = unpack_field(manager, data, type.data.type, uctx);\r\n    }\r\n\r\n    return arr;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.ITERKEYS,\r\n      name: \"iterkeys\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructIterKeysField);\r\n\r\nclass StructUintField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_uint(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_uint(data, uctx);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (typeof val !== \"number\" || val !== Math.floor(val)) {\r\n      return \"\" + val + \" is not an integer\";\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.UINT,\r\n      name: \"uint\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructUintField);\r\n\r\n\r\nclass StructUshortField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_ushort(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_ushort(data, uctx);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (typeof val !== \"number\" || val !== Math.floor(val)) {\r\n      return \"\" + val + \" is not an integer\";\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.USHORT,\r\n      name: \"ushort\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructUshortField);\r\n\r\n//let writeEmpty = writeEmpty = function writeEmpty(stt) {\r\n//}\r\n\r\nclass StructStaticArrayField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    if (type.data.size === undefined) {\r\n      throw new Error(\"type.data.size was undefined\");\r\n    }\r\n\r\n    let itername = type.data.iname;\r\n\r\n    if (val === undefined || !val.length) {\r\n      this.packNull(manager, data, field, type);\r\n      return;\r\n    }\r\n\r\n    for (let i = 0; i < type.data.size; i++) {\r\n      let i2 = Math.min(i, Math.min(val.length - 1, type.data.size));\r\n      let val2 = val[i2];\r\n\r\n      //*\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        let env = _ws_env;\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n      }\r\n\r\n      do_pack(manager, data, val2, val, field, type.data.type);\r\n    }\r\n  }\r\n\r\n  static useHelperJS(field) {\r\n    return !field.type.data.iname;\r\n  }\r\n\r\n  static validateJSON() {\r\n    return StructArrayField.validateJSON(...arguments);\r\n  }\r\n\r\n  static fromJSON() {\r\n    return StructArrayField.fromJSON(...arguments);\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    let size = type.data.size;\r\n    for (let i = 0; i < size; i++) {\r\n      packNull(manager, data, field, type.data.type);\r\n    }\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    return StructArrayField.toJSON(...arguments);\r\n  }\r\n\r\n  static format(type) {\r\n    let type2 = StructFieldTypeMap[type.data.type.type].format(type.data.type);\r\n\r\n    let ret = `static_array[${type2}, ${type.data.size}`;\r\n\r\n    if (type.data.iname) {\r\n      ret += `, ${type.data.iname}`;\r\n    }\r\n    ret += `]`;\r\n\r\n    return ret;\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, ret) {\r\n    packer_debug(\"-size: \" + type.data.size);\r\n\r\n    ret.length = 0;\r\n\r\n    for (let i = 0; i < type.data.size; i++) {\r\n      ret.push(unpack_field(manager, data, type.data.type, uctx));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    packer_debug(\"-size: \" + type.data.size);\r\n\r\n    let ret = [];\r\n\r\n    for (let i = 0; i < type.data.size; i++) {\r\n      ret.push(unpack_field(manager, data, type.data.type, uctx));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.STATIC_ARRAY,\r\n      name: \"static_array\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructStaticArrayField);\r\n\r\nvar _sintern2 = /*#__PURE__*/Object.freeze({\r\n  __proto__: null,\r\n  _get_pack_debug: _get_pack_debug,\r\n  setWarningMode2: setWarningMode2,\r\n  setDebugMode2: setDebugMode2,\r\n  StructFieldTypes: StructFieldTypes,\r\n  StructFieldTypeMap: StructFieldTypeMap,\r\n  packNull: packNull,\r\n  toJSON: toJSON,\r\n  fromJSON: fromJSON,\r\n  validateJSON: validateJSON,\r\n  do_pack: do_pack,\r\n  StructFieldType: StructFieldType\r\n});\r\n\r\nvar structEval = eval;\r\n\r\nfunction setStructEval(val) {\r\n  structEval = val;\r\n}\r\n\r\nvar _struct_eval = /*#__PURE__*/Object.freeze({\r\n  __proto__: null,\r\n  get structEval () { return structEval; },\r\n  setStructEval: setStructEval\r\n});\r\n\r\nconst TokSymbol = Symbol(\"token-info\");\r\n\r\nfunction buildJSONParser() {\r\n  let tk = (name, re, func, example) => new tokdef(name, re, func, example);\r\n\r\n  let parse;\r\n\r\n  let nint = \"[+-]?[0-9]+\";\r\n  let nhex = \"[+-]?0x[0-9a-fA-F]+\";\r\n  let nfloat1 = \"[+-]?[0-9]+\\\\.[0-9]*\";\r\n  let nfloat2 = \"[+-]?[0-9]*\\\\.[0-9]+\";\r\n  let nfloat3 = \"[+-]?[0-9]+\\\\.[0-9]+\";\r\n  let nfloatexp = \"[+-]?[0-9]+\\\\.[0-9]+[eE][+-]?[0-9]+\";\r\n\r\n  let nfloat = `(${nfloat1})|(${nfloat2})|(${nfloatexp})`;\r\n  let num = `(${nint})|(${nfloat})|(${nhex})`;\r\n  let numre = new RegExp(num);\r\n\r\n  let numreTest = new RegExp(`(${num})$`);\r\n\r\n  //nfloat3 has to be its own regexp, the parser\r\n  //always chooses the token handler that parses the most input,\r\n  //and we don't want the partial 0. and .0 handles to split\r\n  //e.g. 3.5 into 3 and 0.5\r\n  nfloat3 = new RegExp(nfloat3);\r\n  nfloatexp = new RegExp(nfloatexp);\r\n\r\n  let tests = [\"1.234234\", \".23432\", \"-234.\", \"1e-17\", \"-0x23423ff\", \"+23423\", \"-4.263256414560601e-14\"];\r\n  for (let test of tests) {\r\n    if (!numreTest.test(test)) {\r\n      console.error(\"Error! Number regexp failed:\", test);\r\n    }\r\n  }\r\n\r\n  let tokens = [\r\n    tk(\"BOOL\", /true|false/),\r\n    tk(\"WS\", /[ \\r\\t\\n]/, t => undefined), //drop token\r\n    tk(\"STRLIT\", /[\"']/, t => {\r\n      let lex = t.lexer;\r\n      let char = t.value;\r\n      let i = lex.lexpos;\r\n      let lexdata = lex.lexdata;\r\n\r\n      let escape = 0;\r\n      t.value = \"\";\r\n      let prev;\r\n\r\n      while (i < lexdata.length) {\r\n        let c = lexdata[i];\r\n\r\n        t.value += c;\r\n\r\n        if (c === \"\\\\\") {\r\n          escape ^= true;\r\n        } else if (!escape && c === char) {\r\n          break;\r\n        } else {\r\n          escape = false;\r\n        }\r\n\r\n        i++;\r\n      }\r\n\r\n      lex.lexpos = i + 1;\r\n\r\n      if (t.value.length > 0) {\r\n        t.value = t.value.slice(0, t.value.length - 1);\r\n      }\r\n\r\n      return t;\r\n    }),\r\n    tk(\"LSBRACKET\", /\\[/),\r\n    tk(\"RSBRACKET\", /]/),\r\n    tk(\"LBRACE\", /{/),\r\n    tk(\"RBRACE\", /}/),\r\n    tk(\"NULL\", /null/),\r\n    tk(\"COMMA\", /,/),\r\n    tk(\"COLON\", /:/),\r\n    tk(\"NUM\", numre, t => (t.value = parseFloat(t.value), t)),\r\n    tk(\"NUM\", nfloat3, t => (t.value = parseFloat(t.value), t)),\r\n    tk(\"NUM\", nfloatexp, t => (t.value = parseFloat(t.value), t)),\r\n  ];\r\n\r\n  function tokinfo(t) {\r\n    return {\r\n      lexpos: t.lexpos,\r\n      lineno: t.lineno,\r\n      col   : t.col,\r\n      fields: {},\r\n    };\r\n  }\r\n\r\n  function p_Array(p) {\r\n    p.expect(\"LSBRACKET\");\r\n    let t = p.peeknext();\r\n    let first = true;\r\n\r\n    let ret = [];\r\n\r\n    ret[TokSymbol] = tokinfo(t);\r\n\r\n    while (t && t.type !== \"RSBRACKET\") {\r\n      if (!first) {\r\n        p.expect(\"COMMA\");\r\n      }\r\n\r\n      ret[TokSymbol].fields[ret.length] = tokinfo(t);\r\n      ret.push(p_Start(p));\r\n\r\n      first = false;\r\n      t = p.peeknext();\r\n    }\r\n    p.expect(\"RSBRACKET\");\r\n\r\n    return ret;\r\n  }\r\n\r\n  function p_Object(p) {\r\n    p.expect(\"LBRACE\");\r\n\r\n    let obj = {};\r\n\r\n    let first = true;\r\n    let t = p.peeknext();\r\n\r\n    obj[TokSymbol] = tokinfo(t);\r\n    while (t && t.type !== \"RBRACE\") {\r\n      if (!first) {\r\n        p.expect(\"COMMA\");\r\n      }\r\n\r\n      let key = p.expect(\"STRLIT\");\r\n      p.expect(\"COLON\");\r\n\r\n      let val = p_Start(p, true);\r\n\r\n      obj[key] = val;\r\n      first = false;\r\n\r\n      t = p.peeknext();\r\n      obj[TokSymbol].fields[key] = tokinfo(t);\r\n    }\r\n\r\n    p.expect(\"RBRACE\");\r\n\r\n    return obj;\r\n  }\r\n\r\n  function p_Start(p, throwError = true) {\r\n    let t = p.peeknext();\r\n    if (t.type === \"LSBRACKET\") {\r\n      return p_Array(p);\r\n    } else if (t.type === \"LBRACE\") {\r\n      return p_Object(p);\r\n    } else if (t.type === \"STRLIT\" || t.type === \"NUM\" || t.type === \"NULL\" || t.type === \"BOOL\") {\r\n      return p.next().value;\r\n    } else {\r\n      p.error(t, \"Unknown token\");\r\n    }\r\n  }\r\n\r\n  function p_Error(token, msg) {\r\n    throw new PUTIL_ParseError(\"Parse Error\");\r\n  }\r\n\r\n  let lex = new lexer(tokens);\r\n  lex.linestart = 0;\r\n  parse = new parser(lex, p_Error);\r\n  parse.start = p_Start;\r\n  //lex.printTokens = true;\r\n\r\n  return parse;\r\n}\r\n\r\nvar jsonParser = buildJSONParser();\r\n\r\n/*\r\nbuildJSONParser().parse(`\r\n{\r\n                \"alteredX\": -110.95731659202336,\r\n                \"alteredY\": -359.9154922611667,\r\n                \"alteredZ\": -4.263256414560601e-14\r\n}\r\n`.trim()) //*/\r\n\r\nfunction printContext(buf, tokinfo, printColors=true) {\r\n  let lines = buf.split(\"\\n\");\r\n\r\n  if (!tokinfo) {\r\n    return '';\r\n  }\r\n\r\n  let lineno = tokinfo.lineno;\r\n  let col = tokinfo.col;\r\n\r\n  let istart = Math.max(lineno-50, 0);\r\n  let iend = Math.min(lineno+2, lines.length-1);\r\n\r\n  let s = '';\r\n\r\n  if (printColors) {\r\n    s += termColor(\"  /* pretty-printed json */\\n\", \"blue\");\r\n  } else {\r\n    s += \"/* pretty-printed json */\\n\";\r\n  }\r\n\r\n  for (let i=istart; i<iend; i++) {\r\n    let l = lines[i];\r\n\r\n    let idx = \"\" + i;\r\n    while (idx.length < 3) {\r\n      idx = \" \" + idx;\r\n    }\r\n\r\n    if (i === lineno && printColors) {\r\n      s += termColor(`${idx}: ${l}\\n`, \"yellow\");\r\n    } else {\r\n      s += `${idx}: ${l}\\n`;\r\n    }\r\n\r\n    if (i === lineno) {\r\n      let l2 = '';\r\n      for (let j=0; j<col+5; j++) {\r\n        l2 += \" \";\r\n      }\r\n\r\n      s += l2 + \"^\\n\";\r\n    }\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nvar nGlobal;\r\n\r\nif (typeof globalThis !== \"undefined\") {\r\n  nGlobal = globalThis;\r\n} else if (typeof window !== \"undefined\") {\r\n  nGlobal = window;\r\n} else if (typeof global !== \"undefined\") {\r\n  nGlobal = global;\r\n} else if (typeof globals !== \"undefined\") {\r\n  nGlobal = globals;\r\n} else if (typeof self !== \"undefined\") {\r\n  nGlobal = self;\r\n}\r\n\r\nconst DEBUG = {};\r\n\r\nfunction updateDEBUG() {\r\n  for (let k in Object.keys(DEBUG)) {\r\n    delete DEBUG[k];\r\n  }\r\n\r\n  if (typeof nGlobal.DEBUG === \"object\") {\r\n    for (let k in nGlobal.DEBUG) {\r\n      DEBUG[k] = nGlobal.DEBUG[k];\r\n    }\r\n  }\r\n}\r\n\r\n\"use strict\";\r\n\r\n//needed to avoid a rollup bug in configurable mode\r\nvar sintern2 = _sintern2;\r\nvar struct_eval = _struct_eval;\r\n\r\nlet warninglvl$1 = 2;\r\n\r\nvar truncateDollarSign = true;\r\nvar manager;\r\n\r\nclass JSONError extends Error {};\r\n\r\nfunction setTruncateDollarSign(v) {\r\n  truncateDollarSign = !!v;\r\n}\r\n\r\nfunction _truncateDollarSign(s) {\r\n  let i = s.search(\"$\");\r\n\r\n  if (i > 0) {\r\n    return s.slice(0, i).trim();\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nfunction unmangle(name) {\r\n  if (truncateDollarSign) {\r\n    return _truncateDollarSign(name);\r\n  } else {\r\n    return name;\r\n  }\r\n}\r\n\r\nlet _static_envcode_null$1 = \"\";\r\n\r\n//truncate webpack-mangled names\r\n\r\nfunction gen_tabstr$2(tot) {\r\n  let ret = \"\";\r\n\r\n  for (let i = 0; i < tot; i++) {\r\n    ret += \" \";\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nlet packer_debug$1, packer_debug_start$1, packer_debug_end$1;\r\n\r\nfunction update_debug_data() {\r\n  let ret = _get_pack_debug();\r\n\r\n  packer_debug$1 = ret.packer_debug;\r\n  packer_debug_start$1 = ret.packer_debug_start;\r\n  packer_debug_end$1 = ret.packer_debug_end;\r\n  warninglvl$1 = ret.warninglvl;\r\n}\r\n\r\nupdate_debug_data();\r\n\r\nfunction setWarningMode(t) {\r\n  sintern2.setWarningMode2(t);\r\n\r\n  if (typeof t !== \"number\" || isNaN(t)) {\r\n    throw new Error(\"Expected a single number (>= 0) argument to setWarningMode\");\r\n  }\r\n\r\n  warninglvl$1 = t;\r\n}\r\n\r\nfunction setDebugMode(t) {\r\n  sintern2.setDebugMode2(t);\r\n  update_debug_data();\r\n}\r\n\r\nlet _ws_env$1 = [[undefined, undefined]];\r\n\r\nfunction define_empty_class(scls, name) {\r\n  let cls = function () {\r\n  };\r\n\r\n  cls.prototype = Object.create(Object.prototype);\r\n  cls.constructor = cls.prototype.constructor = cls;\r\n\r\n  let keywords = scls.keywords;\r\n\r\n  cls.STRUCT = name + \" {\\n  }\\n\";\r\n  cls.structName = name;\r\n\r\n  cls.prototype.loadSTRUCT = function (reader) {\r\n    reader(this);\r\n  };\r\n\r\n  cls.newSTRUCT = function () {\r\n    return new this();\r\n  };\r\n\r\n  return cls;\r\n}\r\n\r\nlet haveCodeGen;\r\n\r\n//$KEYWORD_CONFIG_START\r\n\r\nclass STRUCT {\r\n  constructor() {\r\n    this.idgen = 0;\r\n    this.allowOverriding = true;\r\n\r\n    this.structs = {};\r\n    this.struct_cls = {};\r\n    this.struct_ids = {};\r\n\r\n    this.compiled_code = {};\r\n    this.null_natives = {};\r\n\r\n    this.define_null_native(\"Object\", Object);\r\n\r\n    this.jsonUseColors = true;\r\n    this.jsonBuf = '';\r\n  }\r\n\r\n  static inherit(child, parent, structName = child.name) {\r\n    const keywords = this.keywords;\r\n\r\n    if (!parent.STRUCT) {\r\n      return structName + \"{\\n\";\r\n    }\r\n\r\n    let stt = struct_parse.parse(parent.STRUCT);\r\n    let code = structName + \"{\\n\";\r\n    code += STRUCT.fmt_struct(stt, true);\r\n    return code;\r\n  }\r\n\r\n  /** invoke loadSTRUCT methods on parent objects.  note that\r\n   reader() is only called once.  it is called however.*/\r\n  static Super(obj, reader) {\r\n    if (warninglvl$1 > 0)\r\n      console.warn(\"deprecated\");\r\n\r\n    reader(obj);\r\n\r\n    function reader2(obj) {\r\n    }\r\n\r\n    let cls = obj.constructor;\r\n    let bad = cls === undefined || cls.prototype === undefined || cls.prototype.__proto__ === undefined;\r\n\r\n    if (bad) {\r\n      return;\r\n    }\r\n\r\n    let parent = cls.prototype.__proto__.constructor;\r\n    bad = bad || parent === undefined;\r\n\r\n    if (!bad && parent.prototype.loadSTRUCT && parent.prototype.loadSTRUCT !== obj.loadSTRUCT) { //parent.prototype.hasOwnProperty(\"loadSTRUCT\")) {\r\n      parent.prototype.loadSTRUCT.call(obj, reader2);\r\n    }\r\n  }\r\n\r\n  /** deprecated.  used with old fromSTRUCT interface. */\r\n  static chain_fromSTRUCT(cls, reader) {\r\n    if (warninglvl$1 > 0)\r\n      console.warn(\"Using deprecated (and evil) chain_fromSTRUCT method, eek!\");\r\n\r\n    let proto = cls.prototype;\r\n    let parent = cls.prototype.prototype.constructor;\r\n\r\n    let obj = parent.fromSTRUCT(reader);\r\n    let obj2 = new cls();\r\n\r\n    let keys = Object.keys(obj).concat(Object.getOwnPropertySymbols(obj));\r\n    //let keys=Object.keys(proto);\r\n\r\n    for (let i = 0; i < keys.length; i++) {\r\n      let k = keys[i];\r\n\r\n      try {\r\n        obj2[k] = obj[k];\r\n      } catch (error) {\r\n        if (warninglvl$1 > 0)\r\n          console.warn(\"  failed to set property\", k);\r\n      }\r\n      //let k=keys[i];\r\n      //if (k==\"__proto__\")\r\n      // continue;\r\n      //obj[k] = proto[k];\r\n    }\r\n\r\n    /*\r\n    if (proto.toString !== Object.prototype.toString)\r\n      obj2.toString = proto.toString;\r\n    //*/\r\n\r\n    return obj2;\r\n  }\r\n\r\n  //defined_classes is an array of class constructors\r\n  //with STRUCT scripts, *OR* another STRUCT instance\r\n  //\r\n\r\n  static formatStruct(stt, internal_only, no_helper_js) {\r\n    return this.fmt_struct(stt, internal_only, no_helper_js);\r\n  }\r\n\r\n  static fmt_struct(stt, internal_only, no_helper_js) {\r\n    if (internal_only === undefined)\r\n      internal_only = false;\r\n    if (no_helper_js === undefined)\r\n      no_helper_js = false;\r\n\r\n    let s = \"\";\r\n    if (!internal_only) {\r\n      s += stt.name;\r\n      if (stt.id !== -1)\r\n        s += \" id=\" + stt.id;\r\n      s += \" {\\n\";\r\n    }\r\n    let tab = \"  \";\r\n\r\n    function fmt_type(type) {\r\n      return StructFieldTypeMap[type.type].format(type);\r\n\r\n      if (type.type === StructEnum.ARRAY || type.type === StructEnum.ITER || type.type === StructEnum.ITERKEYS) {\r\n        if (type.data.iname !== \"\" && type.data.iname !== undefined) {\r\n          return \"array(\" + type.data.iname + \", \" + fmt_type(type.data.type) + \")\";\r\n        } else {\r\n          return \"array(\" + fmt_type(type.data.type) + \")\";\r\n        }\r\n      } else if (type.type === StructEnum.STATIC_STRING) {\r\n        return \"static_string[\" + type.data.maxlength + \"]\";\r\n      } else if (type.type === StructEnum.STRUCT) {\r\n        return type.data;\r\n      } else if (type.type === StructEnum.TSTRUCT) {\r\n        return \"abstract(\" + type.data + \")\";\r\n      } else {\r\n        return StructTypeMap[type.type];\r\n      }\r\n    }\r\n\r\n    let fields = stt.fields;\r\n    for (let i = 0; i < fields.length; i++) {\r\n      let f = fields[i];\r\n      s += tab + f.name + \" : \" + fmt_type(f.type);\r\n      if (!no_helper_js && f.get !== undefined) {\r\n        s += \" | \" + f.get.trim();\r\n      }\r\n      s += \";\\n\";\r\n    }\r\n    if (!internal_only)\r\n      s += \"}\";\r\n    return s;\r\n  }\r\n\r\n  static setClassKeyword(keyword, nameKeyword = undefined) {\r\n    if (!nameKeyword) {\r\n      nameKeyword = keyword.toLowerCase() + \"Name\";\r\n    }\r\n\r\n    this.keywords = {\r\n      script: keyword,\r\n      name  : nameKeyword,\r\n      load  : \"load\" + keyword,\r\n      new   : \"new\" + keyword,\r\n      after : \"after\" + keyword,\r\n      from  : \"from\" + keyword\r\n    };\r\n  }\r\n\r\n  define_null_native(name, cls) {\r\n    const keywords = this.constructor.keywords;\r\n    let obj = define_empty_class(this.constructor, name);\r\n\r\n    let stt = struct_parse.parse(obj.STRUCT);\r\n\r\n    stt.id = this.idgen++;\r\n\r\n    this.structs[name] = stt;\r\n    this.struct_cls[name] = cls;\r\n    this.struct_ids[stt.id] = stt;\r\n\r\n    this.null_natives[name] = 1;\r\n  }\r\n\r\n  validateStructs(onerror) {\r\n    function getType(type) {\r\n      switch (type.type) {\r\n        case StructEnum.ITERKEYS:\r\n        case StructEnum.ITER:\r\n        case StructEnum.STATIC_ARRAY:\r\n        case StructEnum.ARRAY:\r\n          return getType(type.data.type);\r\n        case StructEnum.TSTRUCT:\r\n          return type;\r\n        case StructEnum.STRUCT:\r\n        default:\r\n          return type;\r\n      }\r\n    }\r\n\r\n    function formatType(type) {\r\n      let ret = {};\r\n\r\n      ret.type = type.type;\r\n\r\n      if (typeof ret.type === \"number\") {\r\n        for (let k in StructEnum) {\r\n          if (StructEnum[k] === ret.type) {\r\n            ret.type = k;\r\n            break;\r\n          }\r\n        }\r\n      } else if (typeof ret.type === \"object\") {\r\n        ret.type = formatType(ret.type);\r\n      }\r\n\r\n      if (typeof type.data === \"object\") {\r\n        ret.data = formatType(type.data);\r\n      } else {\r\n        ret.data = type.data;\r\n      }\r\n\r\n      return ret;\r\n    }\r\n\r\n    function throwError(stt, field, msg) {\r\n      let buf = STRUCT.formatStruct(stt);\r\n\r\n      console.error(buf + \"\\n\\n\" + msg);\r\n\r\n      if (onerror) {\r\n        onerror(msg, stt, field);\r\n      } else {\r\n        throw new Error(msg);\r\n      }\r\n    }\r\n\r\n    for (let k in this.structs) {\r\n      let stt = this.structs[k];\r\n\r\n      for (let field of stt.fields) {\r\n        if (field.name === \"this\") {\r\n          let type = field.type.type;\r\n\r\n          if (ValueTypes.has(type)) {\r\n            throwError(stt, field, \"'this' cannot be used with value types\");\r\n          }\r\n        }\r\n\r\n        let type = getType(field.type);\r\n\r\n        if (type.type !== StructEnum.STRUCT && type.type !== StructEnum.TSTRUCT) {\r\n          continue;\r\n        }\r\n\r\n        if (!(type.data in this.structs)) {\r\n          let msg = stt.name + \":\" + field.name + \": Unknown struct \" + type.data + \".\";\r\n          throwError(stt, field, msg);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  forEach(func, thisvar) {\r\n    for (let k in this.structs) {\r\n      let stt = this.structs[k];\r\n\r\n      if (thisvar !== undefined)\r\n        func.call(thisvar, stt);\r\n      else\r\n        func(stt);\r\n    }\r\n  }\r\n\r\n  //defaults to structjs.manager\r\n  parse_structs(buf, defined_classes) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    if (defined_classes === undefined) {\r\n      defined_classes = manager;\r\n    }\r\n\r\n    if (defined_classes instanceof STRUCT) {\r\n      let struct2 = defined_classes;\r\n      defined_classes = [];\r\n\r\n      for (let k in struct2.struct_cls) {\r\n        defined_classes.push(struct2.struct_cls[k]);\r\n      }\r\n    }\r\n\r\n    if (defined_classes === undefined) {\r\n      defined_classes = [];\r\n\r\n      for (let k in manager.struct_cls) {\r\n        defined_classes.push(manager.struct_cls[k]);\r\n      }\r\n    }\r\n\r\n    let clsmap = {};\r\n\r\n    for (let i = 0; i < defined_classes.length; i++) {\r\n      let cls = defined_classes[i];\r\n\r\n      if (!cls.structName && cls.STRUCT) {\r\n        let stt = struct_parse.parse(cls.STRUCT.trim());\r\n        cls.structName = stt.name;\r\n      } else if (!cls.structName && cls.name !== \"Object\") {\r\n        if (warninglvl$1 > 0)\r\n          console.log(\"Warning, bad class in registered class list\", unmangle(cls.name), cls);\r\n        continue;\r\n      }\r\n\r\n      clsmap[cls.structName] = defined_classes[i];\r\n    }\r\n\r\n    struct_parse.input(buf);\r\n\r\n    while (!struct_parse.at_end()) {\r\n      let stt = struct_parse.parse(undefined, false);\r\n\r\n      if (!(stt.name in clsmap)) {\r\n        if (!(stt.name in this.null_natives))\r\n          if (warninglvl$1 > 0)\r\n            console.log(\"WARNING: struct \" + stt.name + \" is missing from class list.\");\r\n\r\n        let dummy = define_empty_class(this.constructor, stt.name);\r\n\r\n        dummy.STRUCT = STRUCT.fmt_struct(stt);\r\n        dummy.structName = stt.name;\r\n\r\n        dummy.prototype.structName = dummy.name;\r\n\r\n        this.struct_cls[dummy.structName] = dummy;\r\n        this.structs[dummy.structName] = stt;\r\n\r\n        if (stt.id !== -1)\r\n          this.struct_ids[stt.id] = stt;\r\n      } else {\r\n        this.struct_cls[stt.name] = clsmap[stt.name];\r\n        this.structs[stt.name] = stt;\r\n\r\n        if (stt.id !== -1)\r\n          this.struct_ids[stt.id] = stt;\r\n      }\r\n\r\n      let tok = struct_parse.peek();\r\n      while (tok && (tok.value === \"\\n\" || tok.value === \"\\r\" || tok.value === \"\\t\" || tok.value === \" \")) {\r\n        tok = struct_parse.peek();\r\n      }\r\n    }\r\n  }\r\n\r\n  /** adds all structs referenced by cls inside of srcSTRUCT\r\n   *  to this */\r\n  registerGraph(srcSTRUCT, cls) {\r\n    if (!cls.structName) {\r\n      console.warn(\"class was not in srcSTRUCT\");\r\n      return this.register(cls);\r\n    }\r\n\r\n    let recStruct;\r\n\r\n    let recArray = (t) => {\r\n      switch (t.type) {\r\n        case StructEnum.ARRAY:\r\n          return recArray(t.data.type);\r\n        case StructEnum.ITERKEYS:\r\n          return recArray(t.data.type);\r\n        case StructEnum.STATIC_ARRAY:\r\n          return recArray(t.data.type);\r\n        case StructEnum.ITER:\r\n          return recArray(t.data.type);\r\n        case StructEnum.STRUCT:\r\n        case StructEnum.TSTRUCT: {\r\n          let st = srcSTRUCT.structs[t.data];\r\n          let cls = srcSTRUCT.struct_cls[st.name];\r\n\r\n          return recStruct(st, cls);\r\n        }\r\n      }\r\n    };\r\n\r\n    recStruct = (st, cls) => {\r\n      if (!(cls.structName in this.structs)) {\r\n        this.add_class(cls, cls.structName);\r\n      }\r\n\r\n      for (let f of st.fields) {\r\n        if (f.type.type === StructEnum.STRUCT || f.type.type === StructEnum.TSTRUCT) {\r\n          let st2 = srcSTRUCT.structs[f.type.data];\r\n          let cls2 = srcSTRUCT.struct_cls[st2.name];\r\n\r\n          recStruct(st2, cls2);\r\n        } else if (f.type.type === StructEnum.ARRAY) {\r\n          recArray(f.type);\r\n        } else if (f.type.type === StructEnum.ITER) {\r\n          recArray(f.type);\r\n        } else if (f.type.type === StructEnum.ITERKEYS) {\r\n          recArray(f.type);\r\n        } else if (f.type.type === StructEnum.STATIC_ARRAY) {\r\n          recArray(f.type);\r\n        }\r\n      }\r\n    };\r\n\r\n    let st = srcSTRUCT.structs[cls.structName];\r\n    recStruct(st, cls);\r\n  }\r\n\r\n  register(cls, structName) {\r\n    return this.add_class(cls, structName);\r\n  }\r\n\r\n  unregister(cls) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    if (!cls || !cls.structName || !(cls.structName in this.struct_cls)) {\r\n      console.warn(\"Class not registered with nstructjs\", cls);\r\n      return;\r\n    }\r\n\r\n\r\n    let st = this.structs[cls.structName];\r\n\r\n    delete this.structs[cls.structName];\r\n    delete this.struct_cls[cls.structName];\r\n    delete this.struct_ids[st.id];\r\n  }\r\n\r\n  add_class(cls, structName) {\r\n    //do not register Object\r\n    if (cls === Object) {\r\n      return;\r\n    }\r\n\r\n    const keywords = this.constructor.keywords;\r\n    if (cls.STRUCT) {\r\n      let bad = false;\r\n\r\n      let p = cls;\r\n      while (p) {\r\n        p = p.__proto__;\r\n\r\n        if (p && p.STRUCT && p.STRUCT === cls.STRUCT) {\r\n          bad = true;\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (bad) {\r\n        console.warn(\"Generating \" + keywords.script + \" script for derived class \" + unmangle(cls.name));\r\n        if (!structName) {\r\n          structName = unmangle(cls.name);\r\n        }\r\n\r\n        cls.STRUCT = STRUCT.inherit(cls, p) + \"\\n}\";\r\n      }\r\n    }\r\n\r\n    if (!cls.STRUCT) {\r\n      throw new Error(\"class \" + unmangle(cls.name) + \" has no \" + keywords.script + \" script\");\r\n    }\r\n\r\n    let stt = struct_parse.parse(cls.STRUCT);\r\n\r\n    stt.name = unmangle(stt.name);\r\n\r\n    cls.structName = stt.name;\r\n\r\n    //create default newSTRUCT\r\n    if (cls.newSTRUCT === undefined) {\r\n      cls.newSTRUCT = function () {\r\n        return new this();\r\n      };\r\n    }\r\n\r\n    if (structName !== undefined) {\r\n      stt.name = cls.structName = structName;\r\n    } else if (cls.structName === undefined) {\r\n      cls.structName = stt.name;\r\n    } else {\r\n      stt.name = cls.structName;\r\n    }\r\n\r\n    if (cls.structName in this.structs) {\r\n      console.warn(\"Struct \" + unmangle(cls.structName) + \" is already registered\", cls);\r\n\r\n      if (!this.allowOverriding) {\r\n        throw new Error(\"Struct \" + unmangle(cls.structName) + \" is already registered\");\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    if (stt.id === -1)\r\n      stt.id = this.idgen++;\r\n\r\n    this.structs[cls.structName] = stt;\r\n    this.struct_cls[cls.structName] = cls;\r\n    this.struct_ids[stt.id] = stt;\r\n  }\r\n\r\n  isRegistered(cls) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    if (!cls.hasOwnProperty(\"structName\")) {\r\n      return false;\r\n    }\r\n\r\n    return cls === this.struct_cls[cls.structName];\r\n  }\r\n\r\n  get_struct_id(id) {\r\n    return this.struct_ids[id];\r\n  }\r\n\r\n  get_struct(name) {\r\n    if (!(name in this.structs)) {\r\n      console.warn(\"Unknown struct\", name);\r\n      throw new Error(\"Unknown struct \" + name);\r\n    }\r\n    return this.structs[name];\r\n  }\r\n\r\n  get_struct_cls(name) {\r\n    if (!(name in this.struct_cls)) {\r\n      console.trace();\r\n      throw new Error(\"Unknown struct \" + name);\r\n    }\r\n    return this.struct_cls[name];\r\n  }\r\n\r\n  _env_call(code, obj, env) {\r\n    let envcode = _static_envcode_null$1;\r\n    if (env !== undefined) {\r\n      envcode = \"\";\r\n      for (let i = 0; i < env.length; i++) {\r\n        envcode = \"let \" + env[i][0] + \" = env[\" + i.toString() + \"][1];\\n\" + envcode;\r\n      }\r\n    }\r\n    let fullcode = \"\";\r\n    if (envcode !== _static_envcode_null$1)\r\n      fullcode = envcode + code;\r\n    else\r\n      fullcode = code;\r\n    let func;\r\n\r\n    //fullcode = fullcode.replace(/\\bthis\\b/, \"obj\");\r\n\r\n    if (!(fullcode in this.compiled_code)) {\r\n      let code2 = \"func = function(obj, env) { \" + envcode + \"return \" + code + \"}\";\r\n      try {\r\n        func = struct_eval.structEval(code2);\r\n      } catch (err) {\r\n        console.warn(err.stack);\r\n\r\n        console.warn(code2);\r\n        console.warn(\" \");\r\n        throw err;\r\n      }\r\n      this.compiled_code[fullcode] = func;\r\n    } else {\r\n      func = this.compiled_code[fullcode];\r\n    }\r\n    try {\r\n      return func.call(obj, obj, env);\r\n    } catch (err) {\r\n      console.warn(err.stack);\r\n\r\n      let code2 = \"func = function(obj, env) { \" + envcode + \"return \" + code + \"}\";\r\n      console.warn(code2);\r\n      console.warn(\" \");\r\n      throw err;\r\n    }\r\n  }\r\n\r\n  write_struct(data, obj, stt) {\r\n    function use_helper_js(field) {\r\n      let type = field.type.type;\r\n      let cls = StructFieldTypeMap[type];\r\n      return cls.useHelperJS(field);\r\n    }\r\n\r\n    let fields = stt.fields;\r\n    let thestruct = this;\r\n    for (let i = 0; i < fields.length; i++) {\r\n      let f = fields[i];\r\n      let t1 = f.type;\r\n      let t2 = t1.type;\r\n\r\n      if (use_helper_js(f)) {\r\n        let val;\r\n        let type = t2;\r\n        if (f.get !== undefined) {\r\n          val = thestruct._env_call(f.get, obj);\r\n        } else {\r\n          val = f.name === \"this\" ? obj : obj[f.name];\r\n        }\r\n\r\n        if (DEBUG.tinyeval) {\r\n          console.log(\"\\n\\n\\n\", f.get, \"Helper JS Ret\", val, \"\\n\\n\\n\");\r\n        }\r\n\r\n        sintern2.do_pack(this, data, val, obj, f, t1);\r\n      } else {\r\n        let val = f.name === \"this\" ? obj : obj[f.name];\r\n        sintern2.do_pack(this, data, val, obj, f, t1);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   @param data : array to write data into,\r\n   @param obj  : structable object\r\n   */\r\n  write_object(data, obj) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    let cls = obj.constructor.structName;\r\n    let stt = this.get_struct(cls);\r\n\r\n    if (data === undefined) {\r\n      data = [];\r\n    }\r\n\r\n    this.write_struct(data, obj, stt);\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   Read an object from binary data\r\n\r\n   @param data : DataView or Uint8Array instance\r\n   @param cls_or_struct_id : Structable class\r\n   @param uctx : internal parameter\r\n   @return {cls_or_struct_id} Instance of cls_or_struct_id\r\n   */\r\n  readObject(data, cls_or_struct_id, uctx) {\r\n    if (data instanceof Uint8Array || data instanceof Uint8ClampedArray) {\r\n      data = new DataView(data.buffer);\r\n    } else if (data instanceof Array) {\r\n      data = new DataView(new Uint8Array(data).buffer);\r\n    }\r\n\r\n    return this.read_object(data, cls_or_struct_id, uctx);\r\n  }\r\n\r\n  /**\r\n   @param data array to write data into,\r\n   @param obj structable object\r\n   */\r\n  writeObject(data, obj) {\r\n    return this.write_object(data, obj);\r\n  }\r\n\r\n  writeJSON(obj, stt = undefined) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    let cls = obj.constructor;\r\n    stt = stt || this.get_struct(cls.structName);\r\n\r\n    function use_helper_js(field) {\r\n      let type = field.type.type;\r\n      let cls = StructFieldTypeMap[type];\r\n      return cls.useHelperJS(field);\r\n    }\r\n\r\n    let toJSON = sintern2.toJSON;\r\n\r\n    let fields = stt.fields;\r\n    let thestruct = this;\r\n    let json = {};\r\n\r\n    for (let i = 0; i < fields.length; i++) {\r\n      let f = fields[i];\r\n      let val;\r\n      let t1 = f.type;\r\n\r\n      let json2;\r\n\r\n      if (use_helper_js(f)) {\r\n        if (f.get !== undefined) {\r\n          val = thestruct._env_call(f.get, obj);\r\n        } else {\r\n          val = f.name === \"this\" ? obj : obj[f.name];\r\n        }\r\n\r\n        if (DEBUG.tinyeval) {\r\n          console.log(\"\\n\\n\\n\", f.get, \"Helper JS Ret\", val, \"\\n\\n\\n\");\r\n        }\r\n\r\n        json2 = toJSON(this, val, obj, f, t1);\r\n      } else {\r\n        val = f.name === \"this\" ? obj : obj[f.name];\r\n        json2 = toJSON(this, val, obj, f, t1);\r\n      }\r\n\r\n      if (f.name !== 'this') {\r\n        json[f.name] = json2;\r\n      } else { //f.name was 'this'?\r\n        let isArray = Array.isArray(json2);\r\n        isArray = isArray || f.type.type === StructTypes.ARRAY;\r\n        isArray = isArray || f.type.type === StructTypes.STATIC_ARRAY;\r\n\r\n        if (isArray) {\r\n          json.length = json2.length;\r\n\r\n          for (let i = 0; i < json2.length; i++) {\r\n            json[i] = json2[i];\r\n          }\r\n        } else {\r\n          Object.assign(json, json2);\r\n        }\r\n      }\r\n    }\r\n\r\n    return json;\r\n  }\r\n\r\n  /**\r\n   @param data : DataView or Uint8Array instance\r\n   @param cls_or_struct_id : Structable class\r\n   @param uctx : internal parameter\r\n   */\r\n  read_object(data, cls_or_struct_id, uctx, objInstance) {\r\n    const keywords = this.constructor.keywords;\r\n    let cls, stt;\r\n\r\n    if (data instanceof Array) {\r\n      data = new DataView(new Uint8Array(data).buffer);\r\n    }\r\n\r\n    if (typeof cls_or_struct_id === \"number\") {\r\n      cls = this.struct_cls[this.struct_ids[cls_or_struct_id].name];\r\n    } else {\r\n      cls = cls_or_struct_id;\r\n    }\r\n\r\n    if (cls === undefined) {\r\n      throw new Error(\"bad cls_or_struct_id \" + cls_or_struct_id);\r\n    }\r\n\r\n    stt = this.structs[cls.structName];\r\n\r\n    if (uctx === undefined) {\r\n      uctx = new unpack_context();\r\n\r\n      packer_debug$1(\"\\n\\n=Begin reading \" + cls.structName + \"=\");\r\n    }\r\n    let thestruct = this;\r\n\r\n    let this2 = this;\r\n\r\n    function unpack_field(type) {\r\n      return StructFieldTypeMap[type.type].unpack(this2, data, type, uctx);\r\n    }\r\n\r\n    function unpack_into(type, dest) {\r\n      return StructFieldTypeMap[type.type].unpackInto(this2, data, type, uctx, dest);\r\n    }\r\n\r\n    let was_run = false;\r\n\r\n    function makeLoader(stt) {\r\n      return function load(obj) {\r\n        if (was_run) {\r\n          return;\r\n        }\r\n\r\n        was_run = true;\r\n\r\n        let fields = stt.fields;\r\n        let flen = fields.length;\r\n\r\n        for (let i = 0; i < flen; i++) {\r\n          let f = fields[i];\r\n\r\n          if (f.name === 'this') {\r\n            //load data into obj directly\r\n            unpack_into(f.type, obj);\r\n          } else {\r\n            obj[f.name] = unpack_field(f.type);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    let load = makeLoader(stt);\r\n\r\n    if (cls.prototype.loadSTRUCT !== undefined) {\r\n      let obj = objInstance;\r\n\r\n      if (!obj && cls.newSTRUCT !== undefined) {\r\n        obj = cls.newSTRUCT(load);\r\n      } else if (!obj) {\r\n        obj = new cls();\r\n      }\r\n\r\n      obj.loadSTRUCT(load);\r\n\r\n      if (!was_run) {\r\n        console.warn(\"\" + cls.structName + \".prototype.loadSTRUCT() did not execute its loader callback!\");\r\n        load(obj);\r\n      }\r\n\r\n      return obj;\r\n    } else if (cls.fromSTRUCT !== undefined) {\r\n      if (warninglvl$1 > 1)\r\n        console.warn(\"Warning: class \" + unmangle(cls.name) + \" is using deprecated fromSTRUCT interface; use newSTRUCT/loadSTRUCT instead\");\r\n      return cls.fromSTRUCT(load);\r\n    } else { //default case, make new instance and then call load() on it\r\n      let obj = objInstance;\r\n\r\n      if (!obj && cls.newSTRUCT !== undefined) {\r\n        obj = cls.newSTRUCT(load);\r\n      } else if (!obj) {\r\n        obj = new cls();\r\n      }\r\n\r\n      load(obj);\r\n\r\n      return obj;\r\n    }\r\n  }\r\n\r\n  validateJSON(json, cls_or_struct_id, useInternalParser=true, useColors=true, consoleLogger=function(){console.log(...arguments);}, _abstractKey=\"_structName\") {\r\n    if (cls_or_struct_id === undefined) {\r\n      throw new Error(this.constructor.name + \".prototype.validateJSON: Expected at least two arguments\");\r\n    }\r\n\r\n    try {\r\n      json = JSON.stringify(json, undefined, 2);\r\n\r\n      this.jsonBuf = json;\r\n      this.jsonUseColors = useColors;\r\n      this.jsonLogger = consoleLogger;\r\n\r\n      //add token annotations\r\n      jsonParser.logger = this.jsonLogger;\r\n\r\n      if (useInternalParser) {\r\n        json = jsonParser.parse(json);\r\n      } else {\r\n        json = JSON.parse(json);\r\n      }\r\n\r\n      this.validateJSONIntern(json, cls_or_struct_id, _abstractKey);\r\n\r\n    } catch (error) {\r\n      if (!(error instanceof JSONError)) {\r\n        console.error(error.stack);\r\n      }\r\n\r\n      this.jsonLogger(error.message);\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  validateJSONIntern(json, cls_or_struct_id, _abstractKey=\"_structName\") {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    let cls, stt;\r\n\r\n    if (typeof cls_or_struct_id === \"number\") {\r\n      cls = this.struct_cls[this.struct_ids[cls_or_struct_id].name];\r\n    } else if (cls_or_struct_id instanceof NStruct) {\r\n      cls = this.get_struct_cls(cls_or_struct_id.name);\r\n    } else {\r\n      cls = cls_or_struct_id;\r\n    }\r\n\r\n    if (cls === undefined) {\r\n      throw new Error(\"bad cls_or_struct_id \" + cls_or_struct_id);\r\n    }\r\n\r\n    stt = this.structs[cls.structName];\r\n\r\n    let fields = stt.fields;\r\n    let flen = fields.length;\r\n\r\n    let keys = new Set();\r\n    keys.add(_abstractKey);\r\n\r\n    let keyTestJson = json;\r\n\r\n    for (let i = 0; i < flen; i++) {\r\n      let f = fields[i];\r\n\r\n      let val;\r\n\r\n      let tokinfo;\r\n\r\n      if (f.name === 'this') {\r\n        val = json;\r\n        keyTestJson = {\r\n          \"this\" : json\r\n        };\r\n\r\n        keys.add(\"this\");\r\n        tokinfo = json[TokSymbol];\r\n      } else {\r\n        val = json[f.name];\r\n        keys.add(f.name);\r\n\r\n        tokinfo = json[TokSymbol] ? json[TokSymbol].fields[f.name] : undefined;\r\n        if (!tokinfo) {\r\n          let f2 = fields[Math.max(i-1, 0)];\r\n          tokinfo = TokSymbol[TokSymbol] ? json[TokSymbol].fields[f2.name] : undefined;\r\n        }\r\n\r\n        if (!tokinfo) {\r\n          tokinfo = json[TokSymbol];\r\n        }\r\n      }\r\n\r\n      if (val === undefined) {\r\n        //console.warn(\"nstructjs.readJSON: Missing field \" + f.name + \" in struct \" + stt.name);\r\n        //continue;\r\n      }\r\n\r\n      let instance = f.name === 'this' ? val : json;\r\n\r\n      let ret = sintern2.validateJSON(this, val, json, f, f.type, instance, _abstractKey);\r\n\r\n      if (!ret || typeof ret === \"string\") {\r\n        let msg = typeof ret === \"string\" ? \": \" + ret : \"\";\r\n\r\n        if (tokinfo) {\r\n          this.jsonLogger(printContext(this.jsonBuf, tokinfo, this.jsonUseColors));\r\n        }\r\n\r\n        //console.error(cls.STRUCT);\r\n\r\n        if (val === undefined) {\r\n          throw new JSONError(\"Missing json field \" + f.name + msg);\r\n        } else {\r\n          throw new JSONError(\"Invalid json field \" + f.name + msg);\r\n        }\r\n\r\n        return false;\r\n      }\r\n    }\r\n\r\n    for (let k in keyTestJson) {\r\n      if (typeof json[k] === \"symbol\") {\r\n        //ignore symbols\r\n        continue;\r\n      }\r\n\r\n      if (!keys.has(k)) {\r\n        this.jsonLogger(cls.STRUCT);\r\n        throw new JSONError(\"Unknown json field \" + k);\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  readJSON(json, cls_or_struct_id, objInstance = undefined) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    let cls, stt;\r\n\r\n    if (typeof cls_or_struct_id === \"number\") {\r\n      cls = this.struct_cls[this.struct_ids[cls_or_struct_id].name];\r\n    } else if (cls_or_struct_id instanceof NStruct) {\r\n      cls = this.get_struct_cls(cls_or_struct_id.name);\r\n    } else {\r\n      cls = cls_or_struct_id;\r\n    }\r\n\r\n    if (cls === undefined) {\r\n      throw new Error(\"bad cls_or_struct_id \" + cls_or_struct_id);\r\n    }\r\n\r\n    stt = this.structs[cls.structName];\r\n\r\n    packer_debug$1(\"\\n\\n=Begin reading \" + cls.structName + \"=\");\r\n    let thestruct = this;\r\n    let this2 = this;\r\n    let was_run = false;\r\n    let fromJSON = sintern2.fromJSON;\r\n\r\n    function makeLoader(stt) {\r\n      return function load(obj) {\r\n        if (was_run) {\r\n          return;\r\n        }\r\n\r\n        was_run = true;\r\n\r\n        let fields = stt.fields;\r\n        let flen = fields.length;\r\n\r\n        for (let i = 0; i < flen; i++) {\r\n          let f = fields[i];\r\n\r\n          let val;\r\n\r\n          if (f.name === 'this') {\r\n            val = json;\r\n          } else {\r\n            val = json[f.name];\r\n          }\r\n\r\n          if (val === undefined) {\r\n            console.warn(\"nstructjs.readJSON: Missing field \" + f.name + \" in struct \" + stt.name);\r\n            continue;\r\n          }\r\n\r\n          let instance = f.name === 'this' ? obj : objInstance;\r\n\r\n          let ret = fromJSON(this2, val, obj, f, f.type, instance);\r\n\r\n          if (f.name !== 'this') {\r\n            obj[f.name] = ret;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    let load = makeLoader(stt);\r\n\r\n    if (cls.prototype.loadSTRUCT !== undefined) {\r\n      let obj = objInstance;\r\n\r\n      if (!obj && cls.newSTRUCT !== undefined) {\r\n        obj = cls.newSTRUCT(load);\r\n      } else if (!obj) {\r\n        obj = new cls();\r\n      }\r\n\r\n      obj.loadSTRUCT(load);\r\n      return obj;\r\n    } else if (cls.fromSTRUCT !== undefined) {\r\n      if (warninglvl$1 > 1)\r\n        console.warn(\"Warning: class \" + unmangle(cls.name) + \" is using deprecated fromSTRUCT interface; use newSTRUCT/loadSTRUCT instead\");\r\n      return cls.fromSTRUCT(load);\r\n    } else { //default case, make new instance and then call load() on it\r\n      let obj = objInstance;\r\n\r\n      if (!obj && cls.newSTRUCT !== undefined) {\r\n        obj = cls.newSTRUCT(load);\r\n      } else if (!obj) {\r\n        obj = new cls();\r\n      }\r\n\r\n      load(obj);\r\n\r\n      return obj;\r\n    }\r\n  }\r\n};\r\n//$KEYWORD_CONFIG_END\r\n\r\nif (haveCodeGen) {\r\n  var StructClass;\r\n\r\n  eval(code);\r\n\r\n  STRUCT = StructClass;\r\n}\r\n\r\nSTRUCT.setClassKeyword(\"STRUCT\");\r\n\r\nfunction deriveStructManager(keywords = {\r\n  script: \"STRUCT\",\r\n  name  : undefined, //script.toLowerCase + \"Name\"\r\n  load  : undefined, //\"load\" + script\r\n  new   : undefined, //\"new\" + script\r\n  from  : undefined, //\"from\" + script\r\n}) {\r\n\r\n  if (!keywords.name) {\r\n    keywords.name = keywords.script.toLowerCase() + \"Name\";\r\n  }\r\n\r\n  if (!keywords.load) {\r\n    keywords.load = \"load\" + keywords.script;\r\n  }\r\n\r\n  if (!keywords.new) {\r\n    keywords.new = \"new\" + keywords.script;\r\n  }\r\n\r\n  if (!keywords.from) {\r\n    keywords.from = \"from\" + keywords.script;\r\n  }\r\n\r\n  if (!haveCodeGen) {\r\n    class NewSTRUCT extends STRUCT {\r\n\r\n    }\r\n\r\n    NewSTRUCT.keywords = keywords;\r\n    return NewSTRUCT;\r\n  } else {\r\n    var StructClass;\r\n\r\n    let code2 = code;\r\n    code2 = code2.replace(/\\[keywords.script\\]/g, keywords.script);\r\n\r\n    eval(code2);\r\n    return StructClass;\r\n  }\r\n}\r\n\r\n//main struct script manager\r\nmanager = new STRUCT();\r\n\r\n/**\r\n * Write all defined structs out to a string.\r\n *\r\n * @param nManager STRUCT instance, defaults to nstructjs.manager\r\n * @param include_code include save code snippets\r\n * */\r\nfunction write_scripts(nManager = manager, include_code = false) {\r\n  let buf = \"\";\r\n\r\n  /* prevent code generation bugs in configurable mode */\r\n  let nl = String.fromCharCode(10);\r\n  let tab = String.fromCharCode(9);\r\n\r\n  nManager.forEach(function (stt) {\r\n    buf += STRUCT.fmt_struct(stt, false, !include_code) + nl;\r\n  });\r\n\r\n  let buf2 = buf;\r\n  buf = \"\";\r\n\r\n  for (let i = 0; i < buf2.length; i++) {\r\n    let c = buf2[i];\r\n    if (c === nl) {\r\n      buf += nl;\r\n      let i2 = i;\r\n      while (i < buf2.length && (buf2[i] === \" \" || buf2[i] === tab || buf2[i] === nl)) {\r\n        i++;\r\n      }\r\n      if (i !== i2)\r\n        i--;\r\n    } else {\r\n      buf += c;\r\n    }\r\n  }\r\n\r\n  return buf;\r\n}\r\n\r\n\"use strict\";\r\n\r\nlet nbtoa, natob;\r\n\r\nif (typeof btoa === \"undefined\") {\r\n  nbtoa = function btoa(str) {\r\n    let buffer = new Buffer(\"\" + str, 'binary');\r\n    return buffer.toString('base64');\r\n  };\r\n\r\n  natob = function atob(str) {\r\n    return new Buffer(str, 'base64').toString('binary');\r\n  };\r\n} else {\r\n  natob = atob;\r\n  nbtoa = btoa;\r\n}\r\n\r\n/*\r\nfile format:\r\n  magic signature              : 4 bytes\r\n  file version major           : 2 bytes\r\n  file version minor           : 1 bytes\r\n  file version micro           : 1 bytes\r\n  length of struct scripts     : 4 bytes\r\n  struct scripts for this file : ...\r\n  \r\n  block:\r\n    magic signature for block              : 4 bytes\r\n    length of data  (not including header) : 4 bytes\r\n    id of struct type                      : 4 bytes\r\n    \r\n    data                                   : ...\r\n*/\r\n\r\nfunction versionToInt(v) {\r\n  v = versionCoerce(v);\r\n  let mul = 64;\r\n  return ~~(v.major*mul*mul*mul + v.minor*mul*mul + v.micro*mul);\r\n}\r\n\r\nlet ver_pat = /[0-9]+\\.[0-9]+\\.[0-9]+$/;\r\n\r\nfunction versionCoerce(v) {\r\n  if (!v) {\r\n    throw new Error(\"empty version: \" + v);\r\n  }\r\n\r\n  if (typeof v === \"string\") {\r\n    if (!ver_pat.exec(v)) {\r\n      throw new Error(\"invalid version string \" + v);\r\n    }\r\n\r\n    let ver = v.split(\".\");\r\n    return {\r\n      major : parseInt(ver[0]),\r\n      minor : parseInt(ver[1]),\r\n      micro : parseInt(ver[2])\r\n    }\r\n  } else if (Array.isArray(v)) {\r\n    return {\r\n      major : v[0],\r\n      minor : v[1],\r\n      micro : v[2]\r\n    }\r\n  } else if (typeof v === \"object\") {\r\n    let test = (k) => k in v && typeof v[k] === \"number\";\r\n\r\n    if (!test(\"major\") || !test(\"minor\") || !test(\"micro\")) {\r\n      throw new Error(\"invalid version object: \" + v);\r\n    }\r\n\r\n    return v;\r\n  } else {\r\n    throw new Error(\"invalid version \" + v);\r\n  }\r\n}\r\n\r\nfunction versionLessThan(a, b) {\r\n  return versionToInt(a) < versionToInt(b);\r\n}\r\n\r\nclass FileParams {\r\n  constructor() {\r\n    this.magic = \"STRT\";\r\n    this.ext = \".bin\";\r\n    this.blocktypes = [\"DATA\"];\r\n\r\n    this.version = {\r\n      major: 0,\r\n      minor: 0,\r\n      micro: 1\r\n    };\r\n  }\r\n}\r\n\r\n//used to define blocks\r\nclass Block {\r\n  constructor(type_magic, data) {\r\n    this.type = type_magic;\r\n    this.data = data;\r\n  }\r\n}\r\n\r\nclass FileeError extends Error {\r\n}\r\n\r\nclass FileHelper {\r\n  //params can be FileParams instance, or object literal\r\n  //(it will convert to FileParams)\r\n  constructor(params) {\r\n    if (params === undefined) {\r\n      params = new FileParams();\r\n    } else {\r\n      let fp = new FileParams();\r\n\r\n      for (let k in params) {\r\n        fp[k] = params[k];\r\n      }\r\n      params = fp;\r\n    }\r\n\r\n    this.version = params.version;\r\n    this.blocktypes = params.blocktypes;\r\n    this.magic = params.magic;\r\n    this.ext = params.ext;\r\n    this.struct = undefined;\r\n    this.unpack_ctx = undefined;\r\n  }\r\n\r\n  read(dataview) {\r\n    this.unpack_ctx = new unpack_context();\r\n\r\n    let magic = unpack_static_string(dataview, this.unpack_ctx, 4);\r\n\r\n    if (magic !== this.magic) {\r\n      throw new FileError(\"corrupted file\");\r\n    }\r\n\r\n    this.version = {};\r\n    this.version.major = unpack_short(dataview, this.unpack_ctx);\r\n    this.version.minor = unpack_byte(dataview, this.unpack_ctx);\r\n    this.version.micro = unpack_byte(dataview, this.unpack_ctx);\r\n\r\n    let struct = this.struct = new STRUCT();\r\n\r\n    let scripts = unpack_string(dataview, this.unpack_ctx);\r\n    this.struct.parse_structs(scripts, manager);\r\n\r\n    let blocks = [];\r\n    let dviewlen = dataview.buffer.byteLength;\r\n\r\n    while (this.unpack_ctx.i < dviewlen) {\r\n      //console.log(\"reading block. . .\", this.unpack_ctx.i, dviewlen);\r\n\r\n      let type = unpack_static_string(dataview, this.unpack_ctx, 4);\r\n      let datalen = unpack_int(dataview, this.unpack_ctx);\r\n      let bstruct = unpack_int(dataview, this.unpack_ctx);\r\n      let bdata;\r\n\r\n      //console.log(type, datalen, bstruct);\r\n\r\n      if (bstruct === -2) { //string data, e.g. JSON\r\n        bdata = unpack_static_string(dataview, this.unpack_ctx, datalen);\r\n      } else {\r\n        bdata = unpack_bytes(dataview, this.unpack_ctx, datalen);\r\n        bdata = struct.read_object(bdata, bstruct, new unpack_context());\r\n      }\r\n\r\n      let block = new Block();\r\n      block.type = type;\r\n      block.data = bdata;\r\n\r\n      blocks.push(block);\r\n    }\r\n\r\n    this.blocks = blocks;\r\n    return blocks;\r\n  }\r\n\r\n  doVersions(old) {\r\n    let blocks = this.blocks;\r\n\r\n    if (versionLessThan(old, \"0.0.1\")) {\r\n      //do something\r\n    }\r\n  }\r\n\r\n  write(blocks) {\r\n    this.struct = manager;\r\n    this.blocks = blocks;\r\n\r\n    let data = [];\r\n\r\n    pack_static_string(data, this.magic, 4);\r\n    pack_short(data, this.version.major);\r\n    pack_byte(data, this.version.minor & 255);\r\n    pack_byte(data, this.version.micro & 255);\r\n\r\n    let scripts = write_scripts();\r\n    pack_string(data, scripts);\r\n\r\n    let struct = this.struct;\r\n\r\n    for (let block of blocks) {\r\n      if (typeof block.data === \"string\") { //string data, e.g. JSON\r\n        pack_static_string(data, block.type, 4);\r\n        pack_int(data, block.data.length);\r\n        pack_int(data, -2); //flag as string data\r\n        pack_static_string(data, block.data, block.data.length);\r\n        continue;\r\n      }\r\n\r\n      let structName = block.data.constructor.structName;\r\n      if (structName === undefined || !(structName in struct.structs)) {\r\n        throw new Error(\"Non-STRUCTable object \" + block.data);\r\n      }\r\n\r\n      let data2 = [];\r\n      let stt = struct.structs[structName];\r\n\r\n      struct.write_object(data2, block.data);\r\n\r\n      pack_static_string(data, block.type, 4);\r\n      pack_int(data, data2.length);\r\n      pack_int(data, stt.id);\r\n\r\n      pack_bytes(data, data2);\r\n    }\r\n\r\n    return new DataView(new Uint8Array(data).buffer);\r\n  }\r\n\r\n  writeBase64(blocks) {\r\n    let dataview = this.write(blocks);\r\n\r\n    let str = \"\";\r\n    let bytes = new Uint8Array(dataview.buffer);\r\n\r\n    for (let i = 0; i < bytes.length; i++) {\r\n      str += String.fromCharCode(bytes[i]);\r\n    }\r\n\r\n    return nbtoa(str);\r\n  }\r\n\r\n  makeBlock(type, data) {\r\n    return new Block(type, data);\r\n  }\r\n\r\n  readBase64(base64) {\r\n    let data = natob(base64);\r\n    let data2 = new Uint8Array(data.length);\r\n\r\n    for (let i = 0; i < data.length; i++) {\r\n      data2[i] = data.charCodeAt(i);\r\n    }\r\n\r\n    return this.read(new DataView(data2.buffer));\r\n  }\r\n}\r\n\r\nvar struct_filehelper = /*#__PURE__*/Object.freeze({\r\n  __proto__: null,\r\n  versionToInt: versionToInt,\r\n  versionCoerce: versionCoerce,\r\n  versionLessThan: versionLessThan,\r\n  FileParams: FileParams,\r\n  Block: Block,\r\n  FileeError: FileeError,\r\n  FileHelper: FileHelper\r\n});\r\n\r\n/** truncate webpack mangled names. defaults to true\r\n *  so Mesh$1 turns into Mesh */\r\nfunction truncateDollarSign$1(value = true) {\r\n  setTruncateDollarSign(value);\r\n}\r\n\r\nfunction validateStructs(onerror) {\r\n  return manager.validateStructs(onerror);\r\n}\r\n\r\n/**\r\n true means little endian, false means big endian\r\n */\r\nfunction setEndian(mode) {\r\n  let ret = STRUCT_ENDIAN;\r\n\r\n  setBinaryEndian(mode);\r\n\r\n  return ret;\r\n}\r\n\r\nfunction consoleLogger() {\r\n  console.log(...arguments);\r\n}\r\n\r\n/** Validate json\r\n *\r\n * @param json\r\n * @param cls\r\n * @param useInternalParser If true (the default) an internal parser will be used that generates nicer error messages\r\n * @param printColors\r\n * @param logger\r\n * @returns {*}\r\n */\r\nfunction validateJSON$1(json, cls, useInternalParser, printColors=true, logger=consoleLogger) {\r\n  return manager.validateJSON(json, cls, useInternalParser, printColors, logger);\r\n}\r\n\r\nfunction getEndian() {\r\n  return STRUCT_ENDIAN;\r\n}\r\n\r\nfunction setAllowOverriding(t) {\r\n  return manager.allowOverriding = !!t;\r\n}\r\n\r\nfunction isRegistered(cls) {\r\n  return manager.isRegistered(cls);\r\n}\r\n\r\n/** Register a class with nstructjs **/\r\nfunction register(cls, structName) {\r\n  return manager.register(cls, structName);\r\n}\r\n\r\nfunction unregister(cls) {\r\n  manager.unregister(cls);\r\n}\r\n\r\nfunction inherit(child, parent, structName = child.name) {\r\n\r\n  return STRUCT.inherit(...arguments);\r\n}\r\n\r\n/**\r\n @param data : DataView\r\n */\r\nfunction readObject(data, cls, __uctx = undefined) {\r\n  return manager.readObject(data, cls, __uctx);\r\n}\r\n\r\n/**\r\n @param data : Array instance to write bytes to\r\n */\r\nfunction writeObject(data, obj) {\r\n  return manager.writeObject(data, obj);\r\n}\r\n\r\nfunction writeJSON(obj) {\r\n  return manager.writeJSON(obj);\r\n}\r\n\r\nfunction readJSON(json, class_or_struct_id) {\r\n  return manager.readJSON(json, class_or_struct_id);\r\n}\r\n\r\nexport { JSONError, STRUCT, _truncateDollarSign, struct_binpack as binpack, consoleLogger, deriveStructManager, struct_filehelper as filehelper, getEndian, inherit, isRegistered, manager, struct_parser as parser, struct_parseutil as parseutil, readJSON, readObject, register, setAllowOverriding, setDebugMode, setEndian, setTruncateDollarSign, setWarningMode, truncateDollarSign$1 as truncateDollarSign, struct_typesystem as typesystem, unpack_context, unregister, validateJSON$1 as validateJSON, validateStructs, writeJSON, writeObject, write_scripts };\r\n","// THIS FILE IS GENERATED - DO NOT EDIT!\r\n/*!mobile-detect v1.4.4 2019-09-21*/\r\n/*global module:false, define:false*/\r\n/*jshint latedef:false*/\r\n/*!@license Copyright 2013, Heinrich Goebl, License: MIT, see https://github.com/hgoebl/mobile-detect.js*/\r\n(function (define, undefined) {\r\ndefine(function () {\r\n    'use strict';\r\n\r\n    var impl = {};\r\n\r\n    impl.mobileDetectRules = {\r\n    \"phones\": {\r\n        \"iPhone\": \"\\\\biPhone\\\\b|\\\\biPod\\\\b\",\r\n        \"BlackBerry\": \"BlackBerry|\\\\bBB10\\\\b|rim[0-9]+|\\\\b(BBA100|BBB100|BBD100|BBE100|BBF100|STH100)\\\\b-[0-9]+\",\r\n        \"HTC\": \"HTC|HTC.*(Sensation|Evo|Vision|Explorer|6800|8100|8900|A7272|S510e|C110e|Legend|Desire|T8282)|APX515CKT|Qtek9090|APA9292KT|HD_mini|Sensation.*Z710e|PG86100|Z715e|Desire.*(A8181|HD)|ADR6200|ADR6400L|ADR6425|001HT|Inspire 4G|Android.*\\\\bEVO\\\\b|T-Mobile G1|Z520m|Android [0-9.]+; Pixel\",\r\n        \"Nexus\": \"Nexus One|Nexus S|Galaxy.*Nexus|Android.*Nexus.*Mobile|Nexus 4|Nexus 5|Nexus 6\",\r\n        \"Dell\": \"Dell[;]? (Streak|Aero|Venue|Venue Pro|Flash|Smoke|Mini 3iX)|XCD28|XCD35|\\\\b001DL\\\\b|\\\\b101DL\\\\b|\\\\bGS01\\\\b\",\r\n        \"Motorola\": \"Motorola|DROIDX|DROID BIONIC|\\\\bDroid\\\\b.*Build|Android.*Xoom|HRI39|MOT-|A1260|A1680|A555|A853|A855|A953|A955|A956|Motorola.*ELECTRIFY|Motorola.*i1|i867|i940|MB200|MB300|MB501|MB502|MB508|MB511|MB520|MB525|MB526|MB611|MB612|MB632|MB810|MB855|MB860|MB861|MB865|MB870|ME501|ME502|ME511|ME525|ME600|ME632|ME722|ME811|ME860|ME863|ME865|MT620|MT710|MT716|MT720|MT810|MT870|MT917|Motorola.*TITANIUM|WX435|WX445|XT300|XT301|XT311|XT316|XT317|XT319|XT320|XT390|XT502|XT530|XT531|XT532|XT535|XT603|XT610|XT611|XT615|XT681|XT701|XT702|XT711|XT720|XT800|XT806|XT860|XT862|XT875|XT882|XT883|XT894|XT901|XT907|XT909|XT910|XT912|XT928|XT926|XT915|XT919|XT925|XT1021|\\\\bMoto E\\\\b|XT1068|XT1092|XT1052\",\r\n        \"Samsung\": \"\\\\bSamsung\\\\b|SM-G950F|SM-G955F|SM-G9250|GT-19300|SGH-I337|BGT-S5230|GT-B2100|GT-B2700|GT-B2710|GT-B3210|GT-B3310|GT-B3410|GT-B3730|GT-B3740|GT-B5510|GT-B5512|GT-B5722|GT-B6520|GT-B7300|GT-B7320|GT-B7330|GT-B7350|GT-B7510|GT-B7722|GT-B7800|GT-C3010|GT-C3011|GT-C3060|GT-C3200|GT-C3212|GT-C3212I|GT-C3262|GT-C3222|GT-C3300|GT-C3300K|GT-C3303|GT-C3303K|GT-C3310|GT-C3322|GT-C3330|GT-C3350|GT-C3500|GT-C3510|GT-C3530|GT-C3630|GT-C3780|GT-C5010|GT-C5212|GT-C6620|GT-C6625|GT-C6712|GT-E1050|GT-E1070|GT-E1075|GT-E1080|GT-E1081|GT-E1085|GT-E1087|GT-E1100|GT-E1107|GT-E1110|GT-E1120|GT-E1125|GT-E1130|GT-E1160|GT-E1170|GT-E1175|GT-E1180|GT-E1182|GT-E1200|GT-E1210|GT-E1225|GT-E1230|GT-E1390|GT-E2100|GT-E2120|GT-E2121|GT-E2152|GT-E2220|GT-E2222|GT-E2230|GT-E2232|GT-E2250|GT-E2370|GT-E2550|GT-E2652|GT-E3210|GT-E3213|GT-I5500|GT-I5503|GT-I5700|GT-I5800|GT-I5801|GT-I6410|GT-I6420|GT-I7110|GT-I7410|GT-I7500|GT-I8000|GT-I8150|GT-I8160|GT-I8190|GT-I8320|GT-I8330|GT-I8350|GT-I8530|GT-I8700|GT-I8703|GT-I8910|GT-I9000|GT-I9001|GT-I9003|GT-I9010|GT-I9020|GT-I9023|GT-I9070|GT-I9082|GT-I9100|GT-I9103|GT-I9220|GT-I9250|GT-I9300|GT-I9305|GT-I9500|GT-I9505|GT-M3510|GT-M5650|GT-M7500|GT-M7600|GT-M7603|GT-M8800|GT-M8910|GT-N7000|GT-S3110|GT-S3310|GT-S3350|GT-S3353|GT-S3370|GT-S3650|GT-S3653|GT-S3770|GT-S3850|GT-S5210|GT-S5220|GT-S5229|GT-S5230|GT-S5233|GT-S5250|GT-S5253|GT-S5260|GT-S5263|GT-S5270|GT-S5300|GT-S5330|GT-S5350|GT-S5360|GT-S5363|GT-S5369|GT-S5380|GT-S5380D|GT-S5560|GT-S5570|GT-S5600|GT-S5603|GT-S5610|GT-S5620|GT-S5660|GT-S5670|GT-S5690|GT-S5750|GT-S5780|GT-S5830|GT-S5839|GT-S6102|GT-S6500|GT-S7070|GT-S7200|GT-S7220|GT-S7230|GT-S7233|GT-S7250|GT-S7500|GT-S7530|GT-S7550|GT-S7562|GT-S7710|GT-S8000|GT-S8003|GT-S8500|GT-S8530|GT-S8600|SCH-A310|SCH-A530|SCH-A570|SCH-A610|SCH-A630|SCH-A650|SCH-A790|SCH-A795|SCH-A850|SCH-A870|SCH-A890|SCH-A930|SCH-A950|SCH-A970|SCH-A990|SCH-I100|SCH-I110|SCH-I400|SCH-I405|SCH-I500|SCH-I510|SCH-I515|SCH-I600|SCH-I730|SCH-I760|SCH-I770|SCH-I830|SCH-I910|SCH-I920|SCH-I959|SCH-LC11|SCH-N150|SCH-N300|SCH-R100|SCH-R300|SCH-R351|SCH-R400|SCH-R410|SCH-T300|SCH-U310|SCH-U320|SCH-U350|SCH-U360|SCH-U365|SCH-U370|SCH-U380|SCH-U410|SCH-U430|SCH-U450|SCH-U460|SCH-U470|SCH-U490|SCH-U540|SCH-U550|SCH-U620|SCH-U640|SCH-U650|SCH-U660|SCH-U700|SCH-U740|SCH-U750|SCH-U810|SCH-U820|SCH-U900|SCH-U940|SCH-U960|SCS-26UC|SGH-A107|SGH-A117|SGH-A127|SGH-A137|SGH-A157|SGH-A167|SGH-A177|SGH-A187|SGH-A197|SGH-A227|SGH-A237|SGH-A257|SGH-A437|SGH-A517|SGH-A597|SGH-A637|SGH-A657|SGH-A667|SGH-A687|SGH-A697|SGH-A707|SGH-A717|SGH-A727|SGH-A737|SGH-A747|SGH-A767|SGH-A777|SGH-A797|SGH-A817|SGH-A827|SGH-A837|SGH-A847|SGH-A867|SGH-A877|SGH-A887|SGH-A897|SGH-A927|SGH-B100|SGH-B130|SGH-B200|SGH-B220|SGH-C100|SGH-C110|SGH-C120|SGH-C130|SGH-C140|SGH-C160|SGH-C170|SGH-C180|SGH-C200|SGH-C207|SGH-C210|SGH-C225|SGH-C230|SGH-C417|SGH-C450|SGH-D307|SGH-D347|SGH-D357|SGH-D407|SGH-D415|SGH-D780|SGH-D807|SGH-D980|SGH-E105|SGH-E200|SGH-E315|SGH-E316|SGH-E317|SGH-E335|SGH-E590|SGH-E635|SGH-E715|SGH-E890|SGH-F300|SGH-F480|SGH-I200|SGH-I300|SGH-I320|SGH-I550|SGH-I577|SGH-I600|SGH-I607|SGH-I617|SGH-I627|SGH-I637|SGH-I677|SGH-I700|SGH-I717|SGH-I727|SGH-i747M|SGH-I777|SGH-I780|SGH-I827|SGH-I847|SGH-I857|SGH-I896|SGH-I897|SGH-I900|SGH-I907|SGH-I917|SGH-I927|SGH-I937|SGH-I997|SGH-J150|SGH-J200|SGH-L170|SGH-L700|SGH-M110|SGH-M150|SGH-M200|SGH-N105|SGH-N500|SGH-N600|SGH-N620|SGH-N625|SGH-N700|SGH-N710|SGH-P107|SGH-P207|SGH-P300|SGH-P310|SGH-P520|SGH-P735|SGH-P777|SGH-Q105|SGH-R210|SGH-R220|SGH-R225|SGH-S105|SGH-S307|SGH-T109|SGH-T119|SGH-T139|SGH-T209|SGH-T219|SGH-T229|SGH-T239|SGH-T249|SGH-T259|SGH-T309|SGH-T319|SGH-T329|SGH-T339|SGH-T349|SGH-T359|SGH-T369|SGH-T379|SGH-T409|SGH-T429|SGH-T439|SGH-T459|SGH-T469|SGH-T479|SGH-T499|SGH-T509|SGH-T519|SGH-T539|SGH-T559|SGH-T589|SGH-T609|SGH-T619|SGH-T629|SGH-T639|SGH-T659|SGH-T669|SGH-T679|SGH-T709|SGH-T719|SGH-T729|SGH-T739|SGH-T746|SGH-T749|SGH-T759|SGH-T769|SGH-T809|SGH-T819|SGH-T839|SGH-T919|SGH-T929|SGH-T939|SGH-T959|SGH-T989|SGH-U100|SGH-U200|SGH-U800|SGH-V205|SGH-V206|SGH-X100|SGH-X105|SGH-X120|SGH-X140|SGH-X426|SGH-X427|SGH-X475|SGH-X495|SGH-X497|SGH-X507|SGH-X600|SGH-X610|SGH-X620|SGH-X630|SGH-X700|SGH-X820|SGH-X890|SGH-Z130|SGH-Z150|SGH-Z170|SGH-ZX10|SGH-ZX20|SHW-M110|SPH-A120|SPH-A400|SPH-A420|SPH-A460|SPH-A500|SPH-A560|SPH-A600|SPH-A620|SPH-A660|SPH-A700|SPH-A740|SPH-A760|SPH-A790|SPH-A800|SPH-A820|SPH-A840|SPH-A880|SPH-A900|SPH-A940|SPH-A960|SPH-D600|SPH-D700|SPH-D710|SPH-D720|SPH-I300|SPH-I325|SPH-I330|SPH-I350|SPH-I500|SPH-I600|SPH-I700|SPH-L700|SPH-M100|SPH-M220|SPH-M240|SPH-M300|SPH-M305|SPH-M320|SPH-M330|SPH-M350|SPH-M360|SPH-M370|SPH-M380|SPH-M510|SPH-M540|SPH-M550|SPH-M560|SPH-M570|SPH-M580|SPH-M610|SPH-M620|SPH-M630|SPH-M800|SPH-M810|SPH-M850|SPH-M900|SPH-M910|SPH-M920|SPH-M930|SPH-N100|SPH-N200|SPH-N240|SPH-N300|SPH-N400|SPH-Z400|SWC-E100|SCH-i909|GT-N7100|GT-N7105|SCH-I535|SM-N900A|SGH-I317|SGH-T999L|GT-S5360B|GT-I8262|GT-S6802|GT-S6312|GT-S6310|GT-S5312|GT-S5310|GT-I9105|GT-I8510|GT-S6790N|SM-G7105|SM-N9005|GT-S5301|GT-I9295|GT-I9195|SM-C101|GT-S7392|GT-S7560|GT-B7610|GT-I5510|GT-S7582|GT-S7530E|GT-I8750|SM-G9006V|SM-G9008V|SM-G9009D|SM-G900A|SM-G900D|SM-G900F|SM-G900H|SM-G900I|SM-G900J|SM-G900K|SM-G900L|SM-G900M|SM-G900P|SM-G900R4|SM-G900S|SM-G900T|SM-G900V|SM-G900W8|SHV-E160K|SCH-P709|SCH-P729|SM-T2558|GT-I9205|SM-G9350|SM-J120F|SM-G920F|SM-G920V|SM-G930F|SM-N910C|SM-A310F|GT-I9190|SM-J500FN|SM-G903F|SM-J330F\",\r\n        \"LG\": \"\\\\bLG\\\\b;|LG[- ]?(C800|C900|E400|E610|E900|E-900|F160|F180K|F180L|F180S|730|855|L160|LS740|LS840|LS970|LU6200|MS690|MS695|MS770|MS840|MS870|MS910|P500|P700|P705|VM696|AS680|AS695|AX840|C729|E970|GS505|272|C395|E739BK|E960|L55C|L75C|LS696|LS860|P769BK|P350|P500|P509|P870|UN272|US730|VS840|VS950|LN272|LN510|LS670|LS855|LW690|MN270|MN510|P509|P769|P930|UN200|UN270|UN510|UN610|US670|US740|US760|UX265|UX840|VN271|VN530|VS660|VS700|VS740|VS750|VS910|VS920|VS930|VX9200|VX11000|AX840A|LW770|P506|P925|P999|E612|D955|D802|MS323|M257)|LM-G710\",\r\n        \"Sony\": \"SonyST|SonyLT|SonyEricsson|SonyEricssonLT15iv|LT18i|E10i|LT28h|LT26w|SonyEricssonMT27i|C5303|C6902|C6903|C6906|C6943|D2533\",\r\n        \"Asus\": \"Asus.*Galaxy|PadFone.*Mobile\",\r\n        \"NokiaLumia\": \"Lumia [0-9]{3,4}\",\r\n        \"Micromax\": \"Micromax.*\\\\b(A210|A92|A88|A72|A111|A110Q|A115|A116|A110|A90S|A26|A51|A35|A54|A25|A27|A89|A68|A65|A57|A90)\\\\b\",\r\n        \"Palm\": \"PalmSource|Palm\",\r\n        \"Vertu\": \"Vertu|Vertu.*Ltd|Vertu.*Ascent|Vertu.*Ayxta|Vertu.*Constellation(F|Quest)?|Vertu.*Monika|Vertu.*Signature\",\r\n        \"Pantech\": \"PANTECH|IM-A850S|IM-A840S|IM-A830L|IM-A830K|IM-A830S|IM-A820L|IM-A810K|IM-A810S|IM-A800S|IM-T100K|IM-A725L|IM-A780L|IM-A775C|IM-A770K|IM-A760S|IM-A750K|IM-A740S|IM-A730S|IM-A720L|IM-A710K|IM-A690L|IM-A690S|IM-A650S|IM-A630K|IM-A600S|VEGA PTL21|PT003|P8010|ADR910L|P6030|P6020|P9070|P4100|P9060|P5000|CDM8992|TXT8045|ADR8995|IS11PT|P2030|P6010|P8000|PT002|IS06|CDM8999|P9050|PT001|TXT8040|P2020|P9020|P2000|P7040|P7000|C790\",\r\n        \"Fly\": \"IQ230|IQ444|IQ450|IQ440|IQ442|IQ441|IQ245|IQ256|IQ236|IQ255|IQ235|IQ245|IQ275|IQ240|IQ285|IQ280|IQ270|IQ260|IQ250\",\r\n        \"Wiko\": \"KITE 4G|HIGHWAY|GETAWAY|STAIRWAY|DARKSIDE|DARKFULL|DARKNIGHT|DARKMOON|SLIDE|WAX 4G|RAINBOW|BLOOM|SUNSET|GOA(?!nna)|LENNY|BARRY|IGGY|OZZY|CINK FIVE|CINK PEAX|CINK PEAX 2|CINK SLIM|CINK SLIM 2|CINK +|CINK KING|CINK PEAX|CINK SLIM|SUBLIM\",\r\n        \"iMobile\": \"i-mobile (IQ|i-STYLE|idea|ZAA|Hitz)\",\r\n        \"SimValley\": \"\\\\b(SP-80|XT-930|SX-340|XT-930|SX-310|SP-360|SP60|SPT-800|SP-120|SPT-800|SP-140|SPX-5|SPX-8|SP-100|SPX-8|SPX-12)\\\\b\",\r\n        \"Wolfgang\": \"AT-B24D|AT-AS50HD|AT-AS40W|AT-AS55HD|AT-AS45q2|AT-B26D|AT-AS50Q\",\r\n        \"Alcatel\": \"Alcatel\",\r\n        \"Nintendo\": \"Nintendo (3DS|Switch)\",\r\n        \"Amoi\": \"Amoi\",\r\n        \"INQ\": \"INQ\",\r\n        \"OnePlus\": \"ONEPLUS\",\r\n        \"GenericPhone\": \"Tapatalk|PDA;|SAGEM|\\\\bmmp\\\\b|pocket|\\\\bpsp\\\\b|symbian|Smartphone|smartfon|treo|up.browser|up.link|vodafone|\\\\bwap\\\\b|nokia|Series40|Series60|S60|SonyEricsson|N900|MAUI.*WAP.*Browser\"\r\n    },\r\n    \"tablets\": {\r\n        \"iPad\": \"iPad|iPad.*Mobile\",\r\n        \"NexusTablet\": \"Android.*Nexus[\\\\s]+(7|9|10)\",\r\n        \"GoogleTablet\": \"Android.*Pixel C\",\r\n        \"SamsungTablet\": \"SAMSUNG.*Tablet|Galaxy.*Tab|SC-01C|GT-P1000|GT-P1003|GT-P1010|GT-P3105|GT-P6210|GT-P6800|GT-P6810|GT-P7100|GT-P7300|GT-P7310|GT-P7500|GT-P7510|SCH-I800|SCH-I815|SCH-I905|SGH-I957|SGH-I987|SGH-T849|SGH-T859|SGH-T869|SPH-P100|GT-P3100|GT-P3108|GT-P3110|GT-P5100|GT-P5110|GT-P6200|GT-P7320|GT-P7511|GT-N8000|GT-P8510|SGH-I497|SPH-P500|SGH-T779|SCH-I705|SCH-I915|GT-N8013|GT-P3113|GT-P5113|GT-P8110|GT-N8010|GT-N8005|GT-N8020|GT-P1013|GT-P6201|GT-P7501|GT-N5100|GT-N5105|GT-N5110|SHV-E140K|SHV-E140L|SHV-E140S|SHV-E150S|SHV-E230K|SHV-E230L|SHV-E230S|SHW-M180K|SHW-M180L|SHW-M180S|SHW-M180W|SHW-M300W|SHW-M305W|SHW-M380K|SHW-M380S|SHW-M380W|SHW-M430W|SHW-M480K|SHW-M480S|SHW-M480W|SHW-M485W|SHW-M486W|SHW-M500W|GT-I9228|SCH-P739|SCH-I925|GT-I9200|GT-P5200|GT-P5210|GT-P5210X|SM-T311|SM-T310|SM-T310X|SM-T210|SM-T210R|SM-T211|SM-P600|SM-P601|SM-P605|SM-P900|SM-P901|SM-T217|SM-T217A|SM-T217S|SM-P6000|SM-T3100|SGH-I467|XE500|SM-T110|GT-P5220|GT-I9200X|GT-N5110X|GT-N5120|SM-P905|SM-T111|SM-T2105|SM-T315|SM-T320|SM-T320X|SM-T321|SM-T520|SM-T525|SM-T530NU|SM-T230NU|SM-T330NU|SM-T900|XE500T1C|SM-P605V|SM-P905V|SM-T337V|SM-T537V|SM-T707V|SM-T807V|SM-P600X|SM-P900X|SM-T210X|SM-T230|SM-T230X|SM-T325|GT-P7503|SM-T531|SM-T330|SM-T530|SM-T705|SM-T705C|SM-T535|SM-T331|SM-T800|SM-T700|SM-T537|SM-T807|SM-P907A|SM-T337A|SM-T537A|SM-T707A|SM-T807A|SM-T237|SM-T807P|SM-P607T|SM-T217T|SM-T337T|SM-T807T|SM-T116NQ|SM-T116BU|SM-P550|SM-T350|SM-T550|SM-T9000|SM-P9000|SM-T705Y|SM-T805|GT-P3113|SM-T710|SM-T810|SM-T815|SM-T360|SM-T533|SM-T113|SM-T335|SM-T715|SM-T560|SM-T670|SM-T677|SM-T377|SM-T567|SM-T357T|SM-T555|SM-T561|SM-T713|SM-T719|SM-T813|SM-T819|SM-T580|SM-T355Y?|SM-T280|SM-T817A|SM-T820|SM-W700|SM-P580|SM-T587|SM-P350|SM-P555M|SM-P355M|SM-T113NU|SM-T815Y|SM-T585|SM-T285|SM-T825|SM-W708|SM-T835|SM-T830|SM-T837V|SM-T720|SM-T510|SM-T387V\",\r\n        \"Kindle\": \"Kindle|Silk.*Accelerated|Android.*\\\\b(KFOT|KFTT|KFJWI|KFJWA|KFOTE|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|WFJWAE|KFSAWA|KFSAWI|KFASWI|KFARWI|KFFOWI|KFGIWI|KFMEWI)\\\\b|Android.*Silk\\/[0-9.]+ like Chrome\\/[0-9.]+ (?!Mobile)\",\r\n        \"SurfaceTablet\": \"Windows NT [0-9.]+; ARM;.*(Tablet|ARMBJS)\",\r\n        \"HPTablet\": \"HP Slate (7|8|10)|HP ElitePad 900|hp-tablet|EliteBook.*Touch|HP 8|Slate 21|HP SlateBook 10\",\r\n        \"AsusTablet\": \"^.*PadFone((?!Mobile).)*$|Transformer|TF101|TF101G|TF300T|TF300TG|TF300TL|TF700T|TF700KL|TF701T|TF810C|ME171|ME301T|ME302C|ME371MG|ME370T|ME372MG|ME172V|ME173X|ME400C|Slider SL101|\\\\bK00F\\\\b|\\\\bK00C\\\\b|\\\\bK00E\\\\b|\\\\bK00L\\\\b|TX201LA|ME176C|ME102A|\\\\bM80TA\\\\b|ME372CL|ME560CG|ME372CG|ME302KL| K010 | K011 | K017 | K01E |ME572C|ME103K|ME170C|ME171C|\\\\bME70C\\\\b|ME581C|ME581CL|ME8510C|ME181C|P01Y|PO1MA|P01Z|\\\\bP027\\\\b|\\\\bP024\\\\b|\\\\bP00C\\\\b\",\r\n        \"BlackBerryTablet\": \"PlayBook|RIM Tablet\",\r\n        \"HTCtablet\": \"HTC_Flyer_P512|HTC Flyer|HTC Jetstream|HTC-P715a|HTC EVO View 4G|PG41200|PG09410\",\r\n        \"MotorolaTablet\": \"xoom|sholest|MZ615|MZ605|MZ505|MZ601|MZ602|MZ603|MZ604|MZ606|MZ607|MZ608|MZ609|MZ615|MZ616|MZ617\",\r\n        \"NookTablet\": \"Android.*Nook|NookColor|nook browser|BNRV200|BNRV200A|BNTV250|BNTV250A|BNTV400|BNTV600|LogicPD Zoom2\",\r\n        \"AcerTablet\": \"Android.*; \\\\b(A100|A101|A110|A200|A210|A211|A500|A501|A510|A511|A700|A701|W500|W500P|W501|W501P|W510|W511|W700|G100|G100W|B1-A71|B1-710|B1-711|A1-810|A1-811|A1-830)\\\\b|W3-810|\\\\bA3-A10\\\\b|\\\\bA3-A11\\\\b|\\\\bA3-A20\\\\b|\\\\bA3-A30\",\r\n        \"ToshibaTablet\": \"Android.*(AT100|AT105|AT200|AT205|AT270|AT275|AT300|AT305|AT1S5|AT500|AT570|AT700|AT830)|TOSHIBA.*FOLIO\",\r\n        \"LGTablet\": \"\\\\bL-06C|LG-V909|LG-V900|LG-V700|LG-V510|LG-V500|LG-V410|LG-V400|LG-VK810\\\\b\",\r\n        \"FujitsuTablet\": \"Android.*\\\\b(F-01D|F-02F|F-05E|F-10D|M532|Q572)\\\\b\",\r\n        \"PrestigioTablet\": \"PMP3170B|PMP3270B|PMP3470B|PMP7170B|PMP3370B|PMP3570C|PMP5870C|PMP3670B|PMP5570C|PMP5770D|PMP3970B|PMP3870C|PMP5580C|PMP5880D|PMP5780D|PMP5588C|PMP7280C|PMP7280C3G|PMP7280|PMP7880D|PMP5597D|PMP5597|PMP7100D|PER3464|PER3274|PER3574|PER3884|PER5274|PER5474|PMP5097CPRO|PMP5097|PMP7380D|PMP5297C|PMP5297C_QUAD|PMP812E|PMP812E3G|PMP812F|PMP810E|PMP880TD|PMT3017|PMT3037|PMT3047|PMT3057|PMT7008|PMT5887|PMT5001|PMT5002\",\r\n        \"LenovoTablet\": \"Lenovo TAB|Idea(Tab|Pad)( A1|A10| K1|)|ThinkPad([ ]+)?Tablet|YT3-850M|YT3-X90L|YT3-X90F|YT3-X90X|Lenovo.*(S2109|S2110|S5000|S6000|K3011|A3000|A3500|A1000|A2107|A2109|A1107|A5500|A7600|B6000|B8000|B8080)(-|)(FL|F|HV|H|)|TB-X103F|TB-X304X|TB-X304F|TB-X304L|TB-X505F|TB-X505L|TB-X505X|TB-X605F|TB-X605L|TB-8703F|TB-8703X|TB-8703N|TB-8704N|TB-8704F|TB-8704X|TB-8704V|TB-7304F|TB-7304I|TB-7304X|Tab2A7-10F|Tab2A7-20F|TB2-X30L|YT3-X50L|YT3-X50F|YT3-X50M|YT-X705F|YT-X703F|YT-X703L|YT-X705L|YT-X705X|TB2-X30F|TB2-X30L|TB2-X30M|A2107A-F|A2107A-H|TB3-730F|TB3-730M|TB3-730X|TB-7504F|TB-7504X\",\r\n        \"DellTablet\": \"Venue 11|Venue 8|Venue 7|Dell Streak 10|Dell Streak 7\",\r\n        \"YarvikTablet\": \"Android.*\\\\b(TAB210|TAB211|TAB224|TAB250|TAB260|TAB264|TAB310|TAB360|TAB364|TAB410|TAB411|TAB420|TAB424|TAB450|TAB460|TAB461|TAB464|TAB465|TAB467|TAB468|TAB07-100|TAB07-101|TAB07-150|TAB07-151|TAB07-152|TAB07-200|TAB07-201-3G|TAB07-210|TAB07-211|TAB07-212|TAB07-214|TAB07-220|TAB07-400|TAB07-485|TAB08-150|TAB08-200|TAB08-201-3G|TAB08-201-30|TAB09-100|TAB09-211|TAB09-410|TAB10-150|TAB10-201|TAB10-211|TAB10-400|TAB10-410|TAB13-201|TAB274EUK|TAB275EUK|TAB374EUK|TAB462EUK|TAB474EUK|TAB9-200)\\\\b\",\r\n        \"MedionTablet\": \"Android.*\\\\bOYO\\\\b|LIFE.*(P9212|P9514|P9516|S9512)|LIFETAB\",\r\n        \"ArnovaTablet\": \"97G4|AN10G2|AN7bG3|AN7fG3|AN8G3|AN8cG3|AN7G3|AN9G3|AN7dG3|AN7dG3ST|AN7dG3ChildPad|AN10bG3|AN10bG3DT|AN9G2\",\r\n        \"IntensoTablet\": \"INM8002KP|INM1010FP|INM805ND|Intenso Tab|TAB1004\",\r\n        \"IRUTablet\": \"M702pro\",\r\n        \"MegafonTablet\": \"MegaFon V9|\\\\bZTE V9\\\\b|Android.*\\\\bMT7A\\\\b\",\r\n        \"EbodaTablet\": \"E-Boda (Supreme|Impresspeed|Izzycomm|Essential)\",\r\n        \"AllViewTablet\": \"Allview.*(Viva|Alldro|City|Speed|All TV|Frenzy|Quasar|Shine|TX1|AX1|AX2)\",\r\n        \"ArchosTablet\": \"\\\\b(101G9|80G9|A101IT)\\\\b|Qilive 97R|Archos5|\\\\bARCHOS (70|79|80|90|97|101|FAMILYPAD|)(b|c|)(G10| Cobalt| TITANIUM(HD|)| Xenon| Neon|XSK| 2| XS 2| PLATINUM| CARBON|GAMEPAD)\\\\b\",\r\n        \"AinolTablet\": \"NOVO7|NOVO8|NOVO10|Novo7Aurora|Novo7Basic|NOVO7PALADIN|novo9-Spark\",\r\n        \"NokiaLumiaTablet\": \"Lumia 2520\",\r\n        \"SonyTablet\": \"Sony.*Tablet|Xperia Tablet|Sony Tablet S|SO-03E|SGPT12|SGPT13|SGPT114|SGPT121|SGPT122|SGPT123|SGPT111|SGPT112|SGPT113|SGPT131|SGPT132|SGPT133|SGPT211|SGPT212|SGPT213|SGP311|SGP312|SGP321|EBRD1101|EBRD1102|EBRD1201|SGP351|SGP341|SGP511|SGP512|SGP521|SGP541|SGP551|SGP621|SGP641|SGP612|SOT31|SGP771|SGP611|SGP612|SGP712\",\r\n        \"PhilipsTablet\": \"\\\\b(PI2010|PI3000|PI3100|PI3105|PI3110|PI3205|PI3210|PI3900|PI4010|PI7000|PI7100)\\\\b\",\r\n        \"CubeTablet\": \"Android.*(K8GT|U9GT|U10GT|U16GT|U17GT|U18GT|U19GT|U20GT|U23GT|U30GT)|CUBE U8GT\",\r\n        \"CobyTablet\": \"MID1042|MID1045|MID1125|MID1126|MID7012|MID7014|MID7015|MID7034|MID7035|MID7036|MID7042|MID7048|MID7127|MID8042|MID8048|MID8127|MID9042|MID9740|MID9742|MID7022|MID7010\",\r\n        \"MIDTablet\": \"M9701|M9000|M9100|M806|M1052|M806|T703|MID701|MID713|MID710|MID727|MID760|MID830|MID728|MID933|MID125|MID810|MID732|MID120|MID930|MID800|MID731|MID900|MID100|MID820|MID735|MID980|MID130|MID833|MID737|MID960|MID135|MID860|MID736|MID140|MID930|MID835|MID733|MID4X10\",\r\n        \"MSITablet\": \"MSI \\\\b(Primo 73K|Primo 73L|Primo 81L|Primo 77|Primo 93|Primo 75|Primo 76|Primo 73|Primo 81|Primo 91|Primo 90|Enjoy 71|Enjoy 7|Enjoy 10)\\\\b\",\r\n        \"SMiTTablet\": \"Android.*(\\\\bMID\\\\b|MID-560|MTV-T1200|MTV-PND531|MTV-P1101|MTV-PND530)\",\r\n        \"RockChipTablet\": \"Android.*(RK2818|RK2808A|RK2918|RK3066)|RK2738|RK2808A\",\r\n        \"FlyTablet\": \"IQ310|Fly Vision\",\r\n        \"bqTablet\": \"Android.*(bq)?.*\\\\b(Elcano|Curie|Edison|Maxwell|Kepler|Pascal|Tesla|Hypatia|Platon|Newton|Livingstone|Cervantes|Avant|Aquaris ([E|M]10|M8))\\\\b|Maxwell.*Lite|Maxwell.*Plus\",\r\n        \"HuaweiTablet\": \"MediaPad|MediaPad 7 Youth|IDEOS S7|S7-201c|S7-202u|S7-101|S7-103|S7-104|S7-105|S7-106|S7-201|S7-Slim|M2-A01L|BAH-L09|BAH-W09|AGS-L09|CMR-AL19\",\r\n        \"NecTablet\": \"\\\\bN-06D|\\\\bN-08D\",\r\n        \"PantechTablet\": \"Pantech.*P4100\",\r\n        \"BronchoTablet\": \"Broncho.*(N701|N708|N802|a710)\",\r\n        \"VersusTablet\": \"TOUCHPAD.*[78910]|\\\\bTOUCHTAB\\\\b\",\r\n        \"ZyncTablet\": \"z1000|Z99 2G|z930|z990|z909|Z919|z900\",\r\n        \"PositivoTablet\": \"TB07STA|TB10STA|TB07FTA|TB10FTA\",\r\n        \"NabiTablet\": \"Android.*\\\\bNabi\",\r\n        \"KoboTablet\": \"Kobo Touch|\\\\bK080\\\\b|\\\\bVox\\\\b Build|\\\\bArc\\\\b Build\",\r\n        \"DanewTablet\": \"DSlide.*\\\\b(700|701R|702|703R|704|802|970|971|972|973|974|1010|1012)\\\\b\",\r\n        \"TexetTablet\": \"NaviPad|TB-772A|TM-7045|TM-7055|TM-9750|TM-7016|TM-7024|TM-7026|TM-7041|TM-7043|TM-7047|TM-8041|TM-9741|TM-9747|TM-9748|TM-9751|TM-7022|TM-7021|TM-7020|TM-7011|TM-7010|TM-7023|TM-7025|TM-7037W|TM-7038W|TM-7027W|TM-9720|TM-9725|TM-9737W|TM-1020|TM-9738W|TM-9740|TM-9743W|TB-807A|TB-771A|TB-727A|TB-725A|TB-719A|TB-823A|TB-805A|TB-723A|TB-715A|TB-707A|TB-705A|TB-709A|TB-711A|TB-890HD|TB-880HD|TB-790HD|TB-780HD|TB-770HD|TB-721HD|TB-710HD|TB-434HD|TB-860HD|TB-840HD|TB-760HD|TB-750HD|TB-740HD|TB-730HD|TB-722HD|TB-720HD|TB-700HD|TB-500HD|TB-470HD|TB-431HD|TB-430HD|TB-506|TB-504|TB-446|TB-436|TB-416|TB-146SE|TB-126SE\",\r\n        \"PlaystationTablet\": \"Playstation.*(Portable|Vita)\",\r\n        \"TrekstorTablet\": \"ST10416-1|VT10416-1|ST70408-1|ST702xx-1|ST702xx-2|ST80208|ST97216|ST70104-2|VT10416-2|ST10216-2A|SurfTab\",\r\n        \"PyleAudioTablet\": \"\\\\b(PTBL10CEU|PTBL10C|PTBL72BC|PTBL72BCEU|PTBL7CEU|PTBL7C|PTBL92BC|PTBL92BCEU|PTBL9CEU|PTBL9CUK|PTBL9C)\\\\b\",\r\n        \"AdvanTablet\": \"Android.* \\\\b(E3A|T3X|T5C|T5B|T3E|T3C|T3B|T1J|T1F|T2A|T1H|T1i|E1C|T1-E|T5-A|T4|E1-B|T2Ci|T1-B|T1-D|O1-A|E1-A|T1-A|T3A|T4i)\\\\b \",\r\n        \"DanyTechTablet\": \"Genius Tab G3|Genius Tab S2|Genius Tab Q3|Genius Tab G4|Genius Tab Q4|Genius Tab G-II|Genius TAB GII|Genius TAB GIII|Genius Tab S1\",\r\n        \"GalapadTablet\": \"Android.*\\\\bG1\\\\b(?!\\\\))\",\r\n        \"MicromaxTablet\": \"Funbook|Micromax.*\\\\b(P250|P560|P360|P362|P600|P300|P350|P500|P275)\\\\b\",\r\n        \"KarbonnTablet\": \"Android.*\\\\b(A39|A37|A34|ST8|ST10|ST7|Smart Tab3|Smart Tab2)\\\\b\",\r\n        \"AllFineTablet\": \"Fine7 Genius|Fine7 Shine|Fine7 Air|Fine8 Style|Fine9 More|Fine10 Joy|Fine11 Wide\",\r\n        \"PROSCANTablet\": \"\\\\b(PEM63|PLT1023G|PLT1041|PLT1044|PLT1044G|PLT1091|PLT4311|PLT4311PL|PLT4315|PLT7030|PLT7033|PLT7033D|PLT7035|PLT7035D|PLT7044K|PLT7045K|PLT7045KB|PLT7071KG|PLT7072|PLT7223G|PLT7225G|PLT7777G|PLT7810K|PLT7849G|PLT7851G|PLT7852G|PLT8015|PLT8031|PLT8034|PLT8036|PLT8080K|PLT8082|PLT8088|PLT8223G|PLT8234G|PLT8235G|PLT8816K|PLT9011|PLT9045K|PLT9233G|PLT9735|PLT9760G|PLT9770G)\\\\b\",\r\n        \"YONESTablet\": \"BQ1078|BC1003|BC1077|RK9702|BC9730|BC9001|IT9001|BC7008|BC7010|BC708|BC728|BC7012|BC7030|BC7027|BC7026\",\r\n        \"ChangJiaTablet\": \"TPC7102|TPC7103|TPC7105|TPC7106|TPC7107|TPC7201|TPC7203|TPC7205|TPC7210|TPC7708|TPC7709|TPC7712|TPC7110|TPC8101|TPC8103|TPC8105|TPC8106|TPC8203|TPC8205|TPC8503|TPC9106|TPC9701|TPC97101|TPC97103|TPC97105|TPC97106|TPC97111|TPC97113|TPC97203|TPC97603|TPC97809|TPC97205|TPC10101|TPC10103|TPC10106|TPC10111|TPC10203|TPC10205|TPC10503\",\r\n        \"GUTablet\": \"TX-A1301|TX-M9002|Q702|kf026\",\r\n        \"PointOfViewTablet\": \"TAB-P506|TAB-navi-7-3G-M|TAB-P517|TAB-P-527|TAB-P701|TAB-P703|TAB-P721|TAB-P731N|TAB-P741|TAB-P825|TAB-P905|TAB-P925|TAB-PR945|TAB-PL1015|TAB-P1025|TAB-PI1045|TAB-P1325|TAB-PROTAB[0-9]+|TAB-PROTAB25|TAB-PROTAB26|TAB-PROTAB27|TAB-PROTAB26XL|TAB-PROTAB2-IPS9|TAB-PROTAB30-IPS9|TAB-PROTAB25XXL|TAB-PROTAB26-IPS10|TAB-PROTAB30-IPS10\",\r\n        \"OvermaxTablet\": \"OV-(SteelCore|NewBase|Basecore|Baseone|Exellen|Quattor|EduTab|Solution|ACTION|BasicTab|TeddyTab|MagicTab|Stream|TB-08|TB-09)|Qualcore 1027\",\r\n        \"HCLTablet\": \"HCL.*Tablet|Connect-3G-2.0|Connect-2G-2.0|ME Tablet U1|ME Tablet U2|ME Tablet G1|ME Tablet X1|ME Tablet Y2|ME Tablet Sync\",\r\n        \"DPSTablet\": \"DPS Dream 9|DPS Dual 7\",\r\n        \"VistureTablet\": \"V97 HD|i75 3G|Visture V4( HD)?|Visture V5( HD)?|Visture V10\",\r\n        \"CrestaTablet\": \"CTP(-)?810|CTP(-)?818|CTP(-)?828|CTP(-)?838|CTP(-)?888|CTP(-)?978|CTP(-)?980|CTP(-)?987|CTP(-)?988|CTP(-)?989\",\r\n        \"MediatekTablet\": \"\\\\bMT8125|MT8389|MT8135|MT8377\\\\b\",\r\n        \"ConcordeTablet\": \"Concorde([ ]+)?Tab|ConCorde ReadMan\",\r\n        \"GoCleverTablet\": \"GOCLEVER TAB|A7GOCLEVER|M1042|M7841|M742|R1042BK|R1041|TAB A975|TAB A7842|TAB A741|TAB A741L|TAB M723G|TAB M721|TAB A1021|TAB I921|TAB R721|TAB I720|TAB T76|TAB R70|TAB R76.2|TAB R106|TAB R83.2|TAB M813G|TAB I721|GCTA722|TAB I70|TAB I71|TAB S73|TAB R73|TAB R74|TAB R93|TAB R75|TAB R76.1|TAB A73|TAB A93|TAB A93.2|TAB T72|TAB R83|TAB R974|TAB R973|TAB A101|TAB A103|TAB A104|TAB A104.2|R105BK|M713G|A972BK|TAB A971|TAB R974.2|TAB R104|TAB R83.3|TAB A1042\",\r\n        \"ModecomTablet\": \"FreeTAB 9000|FreeTAB 7.4|FreeTAB 7004|FreeTAB 7800|FreeTAB 2096|FreeTAB 7.5|FreeTAB 1014|FreeTAB 1001 |FreeTAB 8001|FreeTAB 9706|FreeTAB 9702|FreeTAB 7003|FreeTAB 7002|FreeTAB 1002|FreeTAB 7801|FreeTAB 1331|FreeTAB 1004|FreeTAB 8002|FreeTAB 8014|FreeTAB 9704|FreeTAB 1003\",\r\n        \"VoninoTablet\": \"\\\\b(Argus[ _]?S|Diamond[ _]?79HD|Emerald[ _]?78E|Luna[ _]?70C|Onyx[ _]?S|Onyx[ _]?Z|Orin[ _]?HD|Orin[ _]?S|Otis[ _]?S|SpeedStar[ _]?S|Magnet[ _]?M9|Primus[ _]?94[ _]?3G|Primus[ _]?94HD|Primus[ _]?QS|Android.*\\\\bQ8\\\\b|Sirius[ _]?EVO[ _]?QS|Sirius[ _]?QS|Spirit[ _]?S)\\\\b\",\r\n        \"ECSTablet\": \"V07OT2|TM105A|S10OT1|TR10CS1\",\r\n        \"StorexTablet\": \"eZee[_']?(Tab|Go)[0-9]+|TabLC7|Looney Tunes Tab\",\r\n        \"VodafoneTablet\": \"SmartTab([ ]+)?[0-9]+|SmartTabII10|SmartTabII7|VF-1497|VFD 1400\",\r\n        \"EssentielBTablet\": \"Smart[ ']?TAB[ ]+?[0-9]+|Family[ ']?TAB2\",\r\n        \"RossMoorTablet\": \"RM-790|RM-997|RMD-878G|RMD-974R|RMT-705A|RMT-701|RME-601|RMT-501|RMT-711\",\r\n        \"iMobileTablet\": \"i-mobile i-note\",\r\n        \"TolinoTablet\": \"tolino tab [0-9.]+|tolino shine\",\r\n        \"AudioSonicTablet\": \"\\\\bC-22Q|T7-QC|T-17B|T-17P\\\\b\",\r\n        \"AMPETablet\": \"Android.* A78 \",\r\n        \"SkkTablet\": \"Android.* (SKYPAD|PHOENIX|CYCLOPS)\",\r\n        \"TecnoTablet\": \"TECNO P9|TECNO DP8D\",\r\n        \"JXDTablet\": \"Android.* \\\\b(F3000|A3300|JXD5000|JXD3000|JXD2000|JXD300B|JXD300|S5800|S7800|S602b|S5110b|S7300|S5300|S602|S603|S5100|S5110|S601|S7100a|P3000F|P3000s|P101|P200s|P1000m|P200m|P9100|P1000s|S6600b|S908|P1000|P300|S18|S6600|S9100)\\\\b\",\r\n        \"iJoyTablet\": \"Tablet (Spirit 7|Essentia|Galatea|Fusion|Onix 7|Landa|Titan|Scooby|Deox|Stella|Themis|Argon|Unique 7|Sygnus|Hexen|Finity 7|Cream|Cream X2|Jade|Neon 7|Neron 7|Kandy|Scape|Saphyr 7|Rebel|Biox|Rebel|Rebel 8GB|Myst|Draco 7|Myst|Tab7-004|Myst|Tadeo Jones|Tablet Boing|Arrow|Draco Dual Cam|Aurix|Mint|Amity|Revolution|Finity 9|Neon 9|T9w|Amity 4GB Dual Cam|Stone 4GB|Stone 8GB|Andromeda|Silken|X2|Andromeda II|Halley|Flame|Saphyr 9,7|Touch 8|Planet|Triton|Unique 10|Hexen 10|Memphis 4GB|Memphis 8GB|Onix 10)\",\r\n        \"FX2Tablet\": \"FX2 PAD7|FX2 PAD10\",\r\n        \"XoroTablet\": \"KidsPAD 701|PAD[ ]?712|PAD[ ]?714|PAD[ ]?716|PAD[ ]?717|PAD[ ]?718|PAD[ ]?720|PAD[ ]?721|PAD[ ]?722|PAD[ ]?790|PAD[ ]?792|PAD[ ]?900|PAD[ ]?9715D|PAD[ ]?9716DR|PAD[ ]?9718DR|PAD[ ]?9719QR|PAD[ ]?9720QR|TelePAD1030|Telepad1032|TelePAD730|TelePAD731|TelePAD732|TelePAD735Q|TelePAD830|TelePAD9730|TelePAD795|MegaPAD 1331|MegaPAD 1851|MegaPAD 2151\",\r\n        \"ViewsonicTablet\": \"ViewPad 10pi|ViewPad 10e|ViewPad 10s|ViewPad E72|ViewPad7|ViewPad E100|ViewPad 7e|ViewSonic VB733|VB100a\",\r\n        \"VerizonTablet\": \"QTAQZ3|QTAIR7|QTAQTZ3|QTASUN1|QTASUN2|QTAXIA1\",\r\n        \"OdysTablet\": \"LOOX|XENO10|ODYS[ -](Space|EVO|Xpress|NOON)|\\\\bXELIO\\\\b|Xelio10Pro|XELIO7PHONETAB|XELIO10EXTREME|XELIOPT2|NEO_QUAD10\",\r\n        \"CaptivaTablet\": \"CAPTIVA PAD\",\r\n        \"IconbitTablet\": \"NetTAB|NT-3702|NT-3702S|NT-3702S|NT-3603P|NT-3603P|NT-0704S|NT-0704S|NT-3805C|NT-3805C|NT-0806C|NT-0806C|NT-0909T|NT-0909T|NT-0907S|NT-0907S|NT-0902S|NT-0902S\",\r\n        \"TeclastTablet\": \"T98 4G|\\\\bP80\\\\b|\\\\bX90HD\\\\b|X98 Air|X98 Air 3G|\\\\bX89\\\\b|P80 3G|\\\\bX80h\\\\b|P98 Air|\\\\bX89HD\\\\b|P98 3G|\\\\bP90HD\\\\b|P89 3G|X98 3G|\\\\bP70h\\\\b|P79HD 3G|G18d 3G|\\\\bP79HD\\\\b|\\\\bP89s\\\\b|\\\\bA88\\\\b|\\\\bP10HD\\\\b|\\\\bP19HD\\\\b|G18 3G|\\\\bP78HD\\\\b|\\\\bA78\\\\b|\\\\bP75\\\\b|G17s 3G|G17h 3G|\\\\bP85t\\\\b|\\\\bP90\\\\b|\\\\bP11\\\\b|\\\\bP98t\\\\b|\\\\bP98HD\\\\b|\\\\bG18d\\\\b|\\\\bP85s\\\\b|\\\\bP11HD\\\\b|\\\\bP88s\\\\b|\\\\bA80HD\\\\b|\\\\bA80se\\\\b|\\\\bA10h\\\\b|\\\\bP89\\\\b|\\\\bP78s\\\\b|\\\\bG18\\\\b|\\\\bP85\\\\b|\\\\bA70h\\\\b|\\\\bA70\\\\b|\\\\bG17\\\\b|\\\\bP18\\\\b|\\\\bA80s\\\\b|\\\\bA11s\\\\b|\\\\bP88HD\\\\b|\\\\bA80h\\\\b|\\\\bP76s\\\\b|\\\\bP76h\\\\b|\\\\bP98\\\\b|\\\\bA10HD\\\\b|\\\\bP78\\\\b|\\\\bP88\\\\b|\\\\bA11\\\\b|\\\\bA10t\\\\b|\\\\bP76a\\\\b|\\\\bP76t\\\\b|\\\\bP76e\\\\b|\\\\bP85HD\\\\b|\\\\bP85a\\\\b|\\\\bP86\\\\b|\\\\bP75HD\\\\b|\\\\bP76v\\\\b|\\\\bA12\\\\b|\\\\bP75a\\\\b|\\\\bA15\\\\b|\\\\bP76Ti\\\\b|\\\\bP81HD\\\\b|\\\\bA10\\\\b|\\\\bT760VE\\\\b|\\\\bT720HD\\\\b|\\\\bP76\\\\b|\\\\bP73\\\\b|\\\\bP71\\\\b|\\\\bP72\\\\b|\\\\bT720SE\\\\b|\\\\bC520Ti\\\\b|\\\\bT760\\\\b|\\\\bT720VE\\\\b|T720-3GE|T720-WiFi\",\r\n        \"OndaTablet\": \"\\\\b(V975i|Vi30|VX530|V701|Vi60|V701s|Vi50|V801s|V719|Vx610w|VX610W|V819i|Vi10|VX580W|Vi10|V711s|V813|V811|V820w|V820|Vi20|V711|VI30W|V712|V891w|V972|V819w|V820w|Vi60|V820w|V711|V813s|V801|V819|V975s|V801|V819|V819|V818|V811|V712|V975m|V101w|V961w|V812|V818|V971|V971s|V919|V989|V116w|V102w|V973|Vi40)\\\\b[\\\\s]+|V10 \\\\b4G\\\\b\",\r\n        \"JaytechTablet\": \"TPC-PA762\",\r\n        \"BlaupunktTablet\": \"Endeavour 800NG|Endeavour 1010\",\r\n        \"DigmaTablet\": \"\\\\b(iDx10|iDx9|iDx8|iDx7|iDxD7|iDxD8|iDsQ8|iDsQ7|iDsQ8|iDsD10|iDnD7|3TS804H|iDsQ11|iDj7|iDs10)\\\\b\",\r\n        \"EvolioTablet\": \"ARIA_Mini_wifi|Aria[ _]Mini|Evolio X10|Evolio X7|Evolio X8|\\\\bEvotab\\\\b|\\\\bNeura\\\\b\",\r\n        \"LavaTablet\": \"QPAD E704|\\\\bIvoryS\\\\b|E-TAB IVORY|\\\\bE-TAB\\\\b\",\r\n        \"AocTablet\": \"MW0811|MW0812|MW0922|MTK8382|MW1031|MW0831|MW0821|MW0931|MW0712\",\r\n        \"MpmanTablet\": \"MP11 OCTA|MP10 OCTA|MPQC1114|MPQC1004|MPQC994|MPQC974|MPQC973|MPQC804|MPQC784|MPQC780|\\\\bMPG7\\\\b|MPDCG75|MPDCG71|MPDC1006|MP101DC|MPDC9000|MPDC905|MPDC706HD|MPDC706|MPDC705|MPDC110|MPDC100|MPDC99|MPDC97|MPDC88|MPDC8|MPDC77|MP709|MID701|MID711|MID170|MPDC703|MPQC1010\",\r\n        \"CelkonTablet\": \"CT695|CT888|CT[\\\\s]?910|CT7 Tab|CT9 Tab|CT3 Tab|CT2 Tab|CT1 Tab|C820|C720|\\\\bCT-1\\\\b\",\r\n        \"WolderTablet\": \"miTab \\\\b(DIAMOND|SPACE|BROOKLYN|NEO|FLY|MANHATTAN|FUNK|EVOLUTION|SKY|GOCAR|IRON|GENIUS|POP|MINT|EPSILON|BROADWAY|JUMP|HOP|LEGEND|NEW AGE|LINE|ADVANCE|FEEL|FOLLOW|LIKE|LINK|LIVE|THINK|FREEDOM|CHICAGO|CLEVELAND|BALTIMORE-GH|IOWA|BOSTON|SEATTLE|PHOENIX|DALLAS|IN 101|MasterChef)\\\\b\",\r\n        \"MediacomTablet\": \"M-MPI10C3G|M-SP10EG|M-SP10EGP|M-SP10HXAH|M-SP7HXAH|M-SP10HXBH|M-SP8HXAH|M-SP8MXA\",\r\n        \"MiTablet\": \"\\\\bMI PAD\\\\b|\\\\bHM NOTE 1W\\\\b\",\r\n        \"NibiruTablet\": \"Nibiru M1|Nibiru Jupiter One\",\r\n        \"NexoTablet\": \"NEXO NOVA|NEXO 10|NEXO AVIO|NEXO FREE|NEXO GO|NEXO EVO|NEXO 3G|NEXO SMART|NEXO KIDDO|NEXO MOBI\",\r\n        \"LeaderTablet\": \"TBLT10Q|TBLT10I|TBL-10WDKB|TBL-10WDKBO2013|TBL-W230V2|TBL-W450|TBL-W500|SV572|TBLT7I|TBA-AC7-8G|TBLT79|TBL-8W16|TBL-10W32|TBL-10WKB|TBL-W100\",\r\n        \"UbislateTablet\": \"UbiSlate[\\\\s]?7C\",\r\n        \"PocketBookTablet\": \"Pocketbook\",\r\n        \"KocasoTablet\": \"\\\\b(TB-1207)\\\\b\",\r\n        \"HisenseTablet\": \"\\\\b(F5281|E2371)\\\\b\",\r\n        \"Hudl\": \"Hudl HT7S3|Hudl 2\",\r\n        \"TelstraTablet\": \"T-Hub2\",\r\n        \"GenericTablet\": \"Android.*\\\\b97D\\\\b|Tablet(?!.*PC)|BNTV250A|MID-WCDMA|LogicPD Zoom2|\\\\bA7EB\\\\b|CatNova8|A1_07|CT704|CT1002|\\\\bM721\\\\b|rk30sdk|\\\\bEVOTAB\\\\b|M758A|ET904|ALUMIUM10|Smartfren Tab|Endeavour 1010|Tablet-PC-4|Tagi Tab|\\\\bM6pro\\\\b|CT1020W|arc 10HD|\\\\bTP750\\\\b|\\\\bQTAQZ3\\\\b|WVT101|TM1088|KT107\"\r\n    },\r\n    \"oss\": {\r\n        \"AndroidOS\": \"Android\",\r\n        \"BlackBerryOS\": \"blackberry|\\\\bBB10\\\\b|rim tablet os\",\r\n        \"PalmOS\": \"PalmOS|avantgo|blazer|elaine|hiptop|palm|plucker|xiino\",\r\n        \"SymbianOS\": \"Symbian|SymbOS|Series60|Series40|SYB-[0-9]+|\\\\bS60\\\\b\",\r\n        \"WindowsMobileOS\": \"Windows CE.*(PPC|Smartphone|Mobile|[0-9]{3}x[0-9]{3})|Windows Mobile|Windows Phone [0-9.]+|WCE;\",\r\n        \"WindowsPhoneOS\": \"Windows Phone 10.0|Windows Phone 8.1|Windows Phone 8.0|Windows Phone OS|XBLWP7|ZuneWP7|Windows NT 6.[23]; ARM;\",\r\n        \"iOS\": \"\\\\biPhone.*Mobile|\\\\biPod|\\\\biPad|AppleCoreMedia\",\r\n        \"iPadOS\": \"CPU OS 13\",\r\n        \"MeeGoOS\": \"MeeGo\",\r\n        \"MaemoOS\": \"Maemo\",\r\n        \"JavaOS\": \"J2ME\\/|\\\\bMIDP\\\\b|\\\\bCLDC\\\\b\",\r\n        \"webOS\": \"webOS|hpwOS\",\r\n        \"badaOS\": \"\\\\bBada\\\\b\",\r\n        \"BREWOS\": \"BREW\"\r\n    },\r\n    \"uas\": {\r\n        \"Chrome\": \"\\\\bCrMo\\\\b|CriOS|Android.*Chrome\\/[.0-9]* (Mobile)?\",\r\n        \"Dolfin\": \"\\\\bDolfin\\\\b\",\r\n        \"Opera\": \"Opera.*Mini|Opera.*Mobi|Android.*Opera|Mobile.*OPR\\/[0-9.]+$|Coast\\/[0-9.]+\",\r\n        \"Skyfire\": \"Skyfire\",\r\n        \"Edge\": \"Mobile Safari\\/[.0-9]* Edge\",\r\n        \"IE\": \"IEMobile|MSIEMobile\",\r\n        \"Firefox\": \"fennec|firefox.*maemo|(Mobile|Tablet).*Firefox|Firefox.*Mobile|FxiOS\",\r\n        \"Bolt\": \"bolt\",\r\n        \"TeaShark\": \"teashark\",\r\n        \"Blazer\": \"Blazer\",\r\n        \"Safari\": \"Version.*Mobile.*Safari|Safari.*Mobile|MobileSafari\",\r\n        \"WeChat\": \"\\\\bMicroMessenger\\\\b\",\r\n        \"UCBrowser\": \"UC.*Browser|UCWEB\",\r\n        \"baiduboxapp\": \"baiduboxapp\",\r\n        \"baidubrowser\": \"baidubrowser\",\r\n        \"DiigoBrowser\": \"DiigoBrowser\",\r\n        \"Mercury\": \"\\\\bMercury\\\\b\",\r\n        \"ObigoBrowser\": \"Obigo\",\r\n        \"NetFront\": \"NF-Browser\",\r\n        \"GenericBrowser\": \"NokiaBrowser|OviBrowser|OneBrowser|TwonkyBeamBrowser|SEMC.*Browser|FlyFlow|Minimo|NetFront|Novarra-Vision|MQQBrowser|MicroMessenger\",\r\n        \"PaleMoon\": \"Android.*PaleMoon|Mobile.*PaleMoon\"\r\n    },\r\n    \"props\": {\r\n        \"Mobile\": \"Mobile\\/[VER]\",\r\n        \"Build\": \"Build\\/[VER]\",\r\n        \"Version\": \"Version\\/[VER]\",\r\n        \"VendorID\": \"VendorID\\/[VER]\",\r\n        \"iPad\": \"iPad.*CPU[a-z ]+[VER]\",\r\n        \"iPhone\": \"iPhone.*CPU[a-z ]+[VER]\",\r\n        \"iPod\": \"iPod.*CPU[a-z ]+[VER]\",\r\n        \"Kindle\": \"Kindle\\/[VER]\",\r\n        \"Chrome\": [\r\n            \"Chrome\\/[VER]\",\r\n            \"CriOS\\/[VER]\",\r\n            \"CrMo\\/[VER]\"\r\n        ],\r\n        \"Coast\": [\r\n            \"Coast\\/[VER]\"\r\n        ],\r\n        \"Dolfin\": \"Dolfin\\/[VER]\",\r\n        \"Firefox\": [\r\n            \"Firefox\\/[VER]\",\r\n            \"FxiOS\\/[VER]\"\r\n        ],\r\n        \"Fennec\": \"Fennec\\/[VER]\",\r\n        \"Edge\": \"Edge\\/[VER]\",\r\n        \"IE\": [\r\n            \"IEMobile\\/[VER];\",\r\n            \"IEMobile [VER]\",\r\n            \"MSIE [VER];\",\r\n            \"Trident\\/[0-9.]+;.*rv:[VER]\"\r\n        ],\r\n        \"NetFront\": \"NetFront\\/[VER]\",\r\n        \"NokiaBrowser\": \"NokiaBrowser\\/[VER]\",\r\n        \"Opera\": [\r\n            \" OPR\\/[VER]\",\r\n            \"Opera Mini\\/[VER]\",\r\n            \"Version\\/[VER]\"\r\n        ],\r\n        \"Opera Mini\": \"Opera Mini\\/[VER]\",\r\n        \"Opera Mobi\": \"Version\\/[VER]\",\r\n        \"UCBrowser\": [\r\n            \"UCWEB[VER]\",\r\n            \"UC.*Browser\\/[VER]\"\r\n        ],\r\n        \"MQQBrowser\": \"MQQBrowser\\/[VER]\",\r\n        \"MicroMessenger\": \"MicroMessenger\\/[VER]\",\r\n        \"baiduboxapp\": \"baiduboxapp\\/[VER]\",\r\n        \"baidubrowser\": \"baidubrowser\\/[VER]\",\r\n        \"SamsungBrowser\": \"SamsungBrowser\\/[VER]\",\r\n        \"Iron\": \"Iron\\/[VER]\",\r\n        \"Safari\": [\r\n            \"Version\\/[VER]\",\r\n            \"Safari\\/[VER]\"\r\n        ],\r\n        \"Skyfire\": \"Skyfire\\/[VER]\",\r\n        \"Tizen\": \"Tizen\\/[VER]\",\r\n        \"Webkit\": \"webkit[ \\/][VER]\",\r\n        \"PaleMoon\": \"PaleMoon\\/[VER]\",\r\n        \"Gecko\": \"Gecko\\/[VER]\",\r\n        \"Trident\": \"Trident\\/[VER]\",\r\n        \"Presto\": \"Presto\\/[VER]\",\r\n        \"Goanna\": \"Goanna\\/[VER]\",\r\n        \"iOS\": \" \\\\bi?OS\\\\b [VER][ ;]{1}\",\r\n        \"Android\": \"Android [VER]\",\r\n        \"BlackBerry\": [\r\n            \"BlackBerry[\\\\w]+\\/[VER]\",\r\n            \"BlackBerry.*Version\\/[VER]\",\r\n            \"Version\\/[VER]\"\r\n        ],\r\n        \"BREW\": \"BREW [VER]\",\r\n        \"Java\": \"Java\\/[VER]\",\r\n        \"Windows Phone OS\": [\r\n            \"Windows Phone OS [VER]\",\r\n            \"Windows Phone [VER]\"\r\n        ],\r\n        \"Windows Phone\": \"Windows Phone [VER]\",\r\n        \"Windows CE\": \"Windows CE\\/[VER]\",\r\n        \"Windows NT\": \"Windows NT [VER]\",\r\n        \"Symbian\": [\r\n            \"SymbianOS\\/[VER]\",\r\n            \"Symbian\\/[VER]\"\r\n        ],\r\n        \"webOS\": [\r\n            \"webOS\\/[VER]\",\r\n            \"hpwOS\\/[VER];\"\r\n        ]\r\n    },\r\n    \"utils\": {\r\n        \"Bot\": \"Googlebot|facebookexternalhit|Google-AMPHTML|s~amp-validator|AdsBot-Google|Google Keyword Suggestion|Facebot|YandexBot|YandexMobileBot|bingbot|ia_archiver|AhrefsBot|Ezooms|GSLFbot|WBSearchBot|Twitterbot|TweetmemeBot|Twikle|PaperLiBot|Wotbox|UnwindFetchor|Exabot|MJ12bot|YandexImages|TurnitinBot|Pingdom|contentkingapp\",\r\n        \"MobileBot\": \"Googlebot-Mobile|AdsBot-Google-Mobile|YahooSeeker\\/M1A1-R2D2\",\r\n        \"DesktopMode\": \"WPDesktop\",\r\n        \"TV\": \"SonyDTV|HbbTV\",\r\n        \"WebKit\": \"(webkit)[ \\/]([\\\\w.]+)\",\r\n        \"Console\": \"\\\\b(Nintendo|Nintendo WiiU|Nintendo 3DS|Nintendo Switch|PLAYSTATION|Xbox)\\\\b\",\r\n        \"Watch\": \"SM-V700\"\r\n    }\r\n};\r\n\r\n    // following patterns come from http://detectmobilebrowsers.com/\r\n    impl.detectMobileBrowsers = {\r\n        fullPattern: /(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i,\r\n        shortPattern: /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i,\r\n        tabletPattern: /android|ipad|playbook|silk/i\r\n    };\r\n\r\n    var hasOwnProp = Object.prototype.hasOwnProperty,\r\n        isArray;\r\n\r\n    impl.FALLBACK_PHONE = 'UnknownPhone';\r\n    impl.FALLBACK_TABLET = 'UnknownTablet';\r\n    impl.FALLBACK_MOBILE = 'UnknownMobile';\r\n\r\n    isArray = ('isArray' in Array) ?\r\n        Array.isArray : function (value) { return Object.prototype.toString.call(value) === '[object Array]'; };\r\n\r\n    function equalIC(a, b) {\r\n        return a != null && b != null && a.toLowerCase() === b.toLowerCase();\r\n    }\r\n\r\n    function containsIC(array, value) {\r\n        var valueLC, i, len = array.length;\r\n        if (!len || !value) {\r\n            return false;\r\n        }\r\n        valueLC = value.toLowerCase();\r\n        for (i = 0; i < len; ++i) {\r\n            if (valueLC === array[i].toLowerCase()) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function convertPropsToRegExp(object) {\r\n        for (var key in object) {\r\n            if (hasOwnProp.call(object, key)) {\r\n                object[key] = new RegExp(object[key], 'i');\r\n            }\r\n        }\r\n    }\r\n\r\n    function prepareUserAgent(userAgent) {\r\n        return (userAgent || '').substr(0, 500); // mitigate vulnerable to ReDoS\r\n    }\r\n\r\n    (function init() {\r\n        var key, values, value, i, len, verPos, mobileDetectRules = impl.mobileDetectRules;\r\n        for (key in mobileDetectRules.props) {\r\n            if (hasOwnProp.call(mobileDetectRules.props, key)) {\r\n                values = mobileDetectRules.props[key];\r\n                if (!isArray(values)) {\r\n                    values = [values];\r\n                }\r\n                len = values.length;\r\n                for (i = 0; i < len; ++i) {\r\n                    value = values[i];\r\n                    verPos = value.indexOf('[VER]');\r\n                    if (verPos >= 0) {\r\n                        value = value.substring(0, verPos) + '([\\\\w._\\\\+]+)' + value.substring(verPos + 5);\r\n                    }\r\n                    values[i] = new RegExp(value, 'i');\r\n                }\r\n                mobileDetectRules.props[key] = values;\r\n            }\r\n        }\r\n        convertPropsToRegExp(mobileDetectRules.oss);\r\n        convertPropsToRegExp(mobileDetectRules.phones);\r\n        convertPropsToRegExp(mobileDetectRules.tablets);\r\n        convertPropsToRegExp(mobileDetectRules.uas);\r\n        convertPropsToRegExp(mobileDetectRules.utils);\r\n\r\n        // copy some patterns to oss0 which are tested first (see issue#15)\r\n        mobileDetectRules.oss0 = {\r\n            WindowsPhoneOS: mobileDetectRules.oss.WindowsPhoneOS,\r\n            WindowsMobileOS: mobileDetectRules.oss.WindowsMobileOS\r\n        };\r\n    }());\r\n\r\n    /**\r\n     * Test userAgent string against a set of rules and find the first matched key.\r\n     * @param {Object} rules (key is String, value is RegExp)\r\n     * @param {String} userAgent the navigator.userAgent (or HTTP-Header 'User-Agent').\r\n     * @returns {String|null} the matched key if found, otherwise <tt>null</tt>\r\n     * @private\r\n     */\r\n    impl.findMatch = function(rules, userAgent) {\r\n        for (var key in rules) {\r\n            if (hasOwnProp.call(rules, key)) {\r\n                if (rules[key].test(userAgent)) {\r\n                    return key;\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * Test userAgent string against a set of rules and return an array of matched keys.\r\n     * @param {Object} rules (key is String, value is RegExp)\r\n     * @param {String} userAgent the navigator.userAgent (or HTTP-Header 'User-Agent').\r\n     * @returns {Array} an array of matched keys, may be empty when there is no match, but not <tt>null</tt>\r\n     * @private\r\n     */\r\n    impl.findMatches = function(rules, userAgent) {\r\n        var result = [];\r\n        for (var key in rules) {\r\n            if (hasOwnProp.call(rules, key)) {\r\n                if (rules[key].test(userAgent)) {\r\n                    result.push(key);\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n\r\n    /**\r\n     * Check the version of the given property in the User-Agent.\r\n     *\r\n     * @param {String} propertyName\r\n     * @param {String} userAgent\r\n     * @return {String} version or <tt>null</tt> if version not found\r\n     * @private\r\n     */\r\n    impl.getVersionStr = function (propertyName, userAgent) {\r\n        var props = impl.mobileDetectRules.props, patterns, i, len, match;\r\n        if (hasOwnProp.call(props, propertyName)) {\r\n            patterns = props[propertyName];\r\n            len = patterns.length;\r\n            for (i = 0; i < len; ++i) {\r\n                match = patterns[i].exec(userAgent);\r\n                if (match !== null) {\r\n                    return match[1];\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * Check the version of the given property in the User-Agent.\r\n     * Will return a float number. (eg. 2_0 will return 2.0, 4.3.1 will return 4.31)\r\n     *\r\n     * @param {String} propertyName\r\n     * @param {String} userAgent\r\n     * @return {Number} version or <tt>NaN</tt> if version not found\r\n     * @private\r\n     */\r\n    impl.getVersion = function (propertyName, userAgent) {\r\n        var version = impl.getVersionStr(propertyName, userAgent);\r\n        return version ? impl.prepareVersionNo(version) : NaN;\r\n    };\r\n\r\n    /**\r\n     * Prepare the version number.\r\n     *\r\n     * @param {String} version\r\n     * @return {Number} the version number as a floating number\r\n     * @private\r\n     */\r\n    impl.prepareVersionNo = function (version) {\r\n        var numbers;\r\n\r\n        numbers = version.split(/[a-z._ \\/\\-]/i);\r\n        if (numbers.length === 1) {\r\n            version = numbers[0];\r\n        }\r\n        if (numbers.length > 1) {\r\n            version = numbers[0] + '.';\r\n            numbers.shift();\r\n            version += numbers.join('');\r\n        }\r\n        return Number(version);\r\n    };\r\n\r\n    impl.isMobileFallback = function (userAgent) {\r\n        return impl.detectMobileBrowsers.fullPattern.test(userAgent) ||\r\n            impl.detectMobileBrowsers.shortPattern.test(userAgent.substr(0,4));\r\n    };\r\n\r\n    impl.isTabletFallback = function (userAgent) {\r\n        return impl.detectMobileBrowsers.tabletPattern.test(userAgent);\r\n    };\r\n\r\n    impl.prepareDetectionCache = function (cache, userAgent, maxPhoneWidth) {\r\n        if (cache.mobile !== undefined) {\r\n            return;\r\n        }\r\n        var phone, tablet, phoneSized;\r\n\r\n        // first check for stronger tablet rules, then phone (see issue#5)\r\n        tablet = impl.findMatch(impl.mobileDetectRules.tablets, userAgent);\r\n        if (tablet) {\r\n            cache.mobile = cache.tablet = tablet;\r\n            cache.phone = null;\r\n            return; // unambiguously identified as tablet\r\n        }\r\n\r\n        phone = impl.findMatch(impl.mobileDetectRules.phones, userAgent);\r\n        if (phone) {\r\n            cache.mobile = cache.phone = phone;\r\n            cache.tablet = null;\r\n            return; // unambiguously identified as phone\r\n        }\r\n\r\n        // our rules haven't found a match -> try more general fallback rules\r\n        if (impl.isMobileFallback(userAgent)) {\r\n            phoneSized = MobileDetect.isPhoneSized(maxPhoneWidth);\r\n            if (phoneSized === undefined) {\r\n                cache.mobile = impl.FALLBACK_MOBILE;\r\n                cache.tablet = cache.phone = null;\r\n            } else if (phoneSized) {\r\n                cache.mobile = cache.phone = impl.FALLBACK_PHONE;\r\n                cache.tablet = null;\r\n            } else {\r\n                cache.mobile = cache.tablet = impl.FALLBACK_TABLET;\r\n                cache.phone = null;\r\n            }\r\n        } else if (impl.isTabletFallback(userAgent)) {\r\n            cache.mobile = cache.tablet = impl.FALLBACK_TABLET;\r\n            cache.phone = null;\r\n        } else {\r\n            // not mobile at all!\r\n            cache.mobile = cache.tablet = cache.phone = null;\r\n        }\r\n    };\r\n\r\n    // t is a reference to a MobileDetect instance\r\n    impl.mobileGrade = function (t) {\r\n        // impl note:\r\n        // To keep in sync w/ Mobile_Detect.php easily, the following code is tightly aligned to the PHP version.\r\n        // When changes are made in Mobile_Detect.php, copy this method and replace:\r\n        //     $this-> / t.\r\n        //     self::MOBILE_GRADE_(.) / '$1'\r\n        //     , self::VERSION_TYPE_FLOAT / (nothing)\r\n        //     isIOS() / os('iOS')\r\n        //     [reg] / (nothing)   <-- jsdelivr complaining about unescaped unicode character U+00AE\r\n        var $isMobile = t.mobile() !== null;\r\n\r\n        if (\r\n            // Apple iOS 3.2-5.1 - Tested on the original iPad (4.3 / 5.0), iPad 2 (4.3), iPad 3 (5.1), original iPhone (3.1), iPhone 3 (3.2), 3GS (4.3), 4 (4.3 / 5.0), and 4S (5.1)\r\n            t.os('iOS') && t.version('iPad')>=4.3 ||\r\n            t.os('iOS') && t.version('iPhone')>=3.1 ||\r\n            t.os('iOS') && t.version('iPod')>=3.1 ||\r\n\r\n            // Android 2.1-2.3 - Tested on the HTC Incredible (2.2), original Droid (2.2), HTC Aria (2.1), Google Nexus S (2.3). Functional on 1.5 & 1.6 but performance may be sluggish, tested on Google G1 (1.5)\r\n            // Android 3.1 (Honeycomb)  - Tested on the Samsung Galaxy Tab 10.1 and Motorola XOOM\r\n            // Android 4.0 (ICS)  - Tested on a Galaxy Nexus. Note: transition performance can be poor on upgraded devices\r\n            // Android 4.1 (Jelly Bean)  - Tested on a Galaxy Nexus and Galaxy 7\r\n            ( t.version('Android')>2.1 && t.is('Webkit') ) ||\r\n\r\n            // Windows Phone 7-7.5 - Tested on the HTC Surround (7.0) HTC Trophy (7.5), LG-E900 (7.5), Nokia Lumia 800\r\n            t.version('Windows Phone OS')>=7.0 ||\r\n\r\n            // Blackberry 7 - Tested on BlackBerry Torch 9810\r\n            // Blackberry 6.0 - Tested on the Torch 9800 and Style 9670\r\n            t.is('BlackBerry') && t.version('BlackBerry')>=6.0 ||\r\n            // Blackberry Playbook (1.0-2.0) - Tested on PlayBook\r\n            t.match('Playbook.*Tablet') ||\r\n\r\n            // Palm WebOS (1.4-2.0) - Tested on the Palm Pixi (1.4), Pre (1.4), Pre 2 (2.0)\r\n            ( t.version('webOS')>=1.4 && t.match('Palm|Pre|Pixi') ) ||\r\n            // Palm WebOS 3.0  - Tested on HP TouchPad\r\n            t.match('hp.*TouchPad') ||\r\n\r\n            // Firefox Mobile (12 Beta) - Tested on Android 2.3 device\r\n            ( t.is('Firefox') && t.version('Firefox')>=12 ) ||\r\n\r\n            // Chrome for Android - Tested on Android 4.0, 4.1 device\r\n            ( t.is('Chrome') && t.is('AndroidOS') && t.version('Android')>=4.0 ) ||\r\n\r\n            // Skyfire 4.1 - Tested on Android 2.3 device\r\n            ( t.is('Skyfire') && t.version('Skyfire')>=4.1 && t.is('AndroidOS') && t.version('Android')>=2.3 ) ||\r\n\r\n            // Opera Mobile 11.5-12: Tested on Android 2.3\r\n            ( t.is('Opera') && t.version('Opera Mobi')>11 && t.is('AndroidOS') ) ||\r\n\r\n            // Meego 1.2 - Tested on Nokia 950 and N9\r\n            t.is('MeeGoOS') ||\r\n\r\n            // Tizen (pre-release) - Tested on early hardware\r\n            t.is('Tizen') ||\r\n\r\n            // Samsung Bada 2.0 - Tested on a Samsung Wave 3, Dolphin browser\r\n            // @todo: more tests here!\r\n            t.is('Dolfin') && t.version('Bada')>=2.0 ||\r\n\r\n            // UC Browser - Tested on Android 2.3 device\r\n            ( (t.is('UC Browser') || t.is('Dolfin')) && t.version('Android')>=2.3 ) ||\r\n\r\n            // Kindle 3 and Fire  - Tested on the built-in WebKit browser for each\r\n            ( t.match('Kindle Fire') ||\r\n                t.is('Kindle') && t.version('Kindle')>=3.0 ) ||\r\n\r\n            // Nook Color 1.4.1 - Tested on original Nook Color, not Nook Tablet\r\n            t.is('AndroidOS') && t.is('NookTablet') ||\r\n\r\n            // Chrome Desktop 11-21 - Tested on OS X 10.7 and Windows 7\r\n            t.version('Chrome')>=11 && !$isMobile ||\r\n\r\n            // Safari Desktop 4-5 - Tested on OS X 10.7 and Windows 7\r\n            t.version('Safari')>=5.0 && !$isMobile ||\r\n\r\n            // Firefox Desktop 4-13 - Tested on OS X 10.7 and Windows 7\r\n            t.version('Firefox')>=4.0 && !$isMobile ||\r\n\r\n            // Internet Explorer 7-9 - Tested on Windows XP, Vista and 7\r\n            t.version('MSIE')>=7.0 && !$isMobile ||\r\n\r\n            // Opera Desktop 10-12 - Tested on OS X 10.7 and Windows 7\r\n            // @reference: http://my.opera.com/community/openweb/idopera/\r\n            t.version('Opera')>=10 && !$isMobile\r\n\r\n            ){\r\n            return 'A';\r\n        }\r\n\r\n        if (\r\n            t.os('iOS') && t.version('iPad')<4.3 ||\r\n            t.os('iOS') && t.version('iPhone')<3.1 ||\r\n            t.os('iOS') && t.version('iPod')<3.1 ||\r\n\r\n            // Blackberry 5.0: Tested on the Storm 2 9550, Bold 9770\r\n            t.is('Blackberry') && t.version('BlackBerry')>=5 && t.version('BlackBerry')<6 ||\r\n\r\n            //Opera Mini (5.0-6.5) - Tested on iOS 3.2/4.3 and Android 2.3\r\n            ( t.version('Opera Mini')>=5.0 && t.version('Opera Mini')<=6.5 &&\r\n                (t.version('Android')>=2.3 || t.is('iOS')) ) ||\r\n\r\n            // Nokia Symbian^3 - Tested on Nokia N8 (Symbian^3), C7 (Symbian^3), also works on N97 (Symbian^1)\r\n            t.match('NokiaN8|NokiaC7|N97.*Series60|Symbian/3') ||\r\n\r\n            // @todo: report this (tested on Nokia N71)\r\n            t.version('Opera Mobi')>=11 && t.is('SymbianOS')\r\n            ){\r\n            return 'B';\r\n        }\r\n\r\n        if (\r\n        // Blackberry 4.x - Tested on the Curve 8330\r\n            t.version('BlackBerry')<5.0 ||\r\n            // Windows Mobile - Tested on the HTC Leo (WinMo 5.2)\r\n            t.match('MSIEMobile|Windows CE.*Mobile') || t.version('Windows Mobile')<=5.2\r\n\r\n            ){\r\n            return 'C';\r\n        }\r\n\r\n        //All older smartphone platforms and featurephones - Any device that doesn't support media queries\r\n        //will receive the basic, C grade experience.\r\n        return 'C';\r\n    };\r\n\r\n    impl.detectOS = function (ua) {\r\n        return impl.findMatch(impl.mobileDetectRules.oss0, ua) ||\r\n            impl.findMatch(impl.mobileDetectRules.oss, ua);\r\n    };\r\n\r\n    impl.getDeviceSmallerSide = function () {\r\n        return window.screen.width < window.screen.height ?\r\n            window.screen.width :\r\n            window.screen.height;\r\n    };\r\n\r\n    /**\r\n     * Constructor for MobileDetect object.\r\n     * <br>\r\n     * Such an object will keep a reference to the given user-agent string and cache most of the detect queries.<br>\r\n     * <div style=\"background-color: #d9edf7; border: 1px solid #bce8f1; color: #3a87ad; padding: 14px; border-radius: 2px; margin-top: 20px\">\r\n     *     <strong>Find information how to download and install:</strong>\r\n     *     <a href=\"https://github.com/hgoebl/mobile-detect.js/\">github.com/hgoebl/mobile-detect.js/</a>\r\n     * </div>\r\n     *\r\n     * @example <pre>\r\n     *     var md = new MobileDetect(window.navigator.userAgent);\r\n     *     if (md.mobile()) {\r\n     *         location.href = (md.mobileGrade() === 'A') ? '/mobile/' : '/lynx/';\r\n     *     }\r\n     * </pre>\r\n     *\r\n     * @param {string} userAgent typically taken from window.navigator.userAgent or http_header['User-Agent']\r\n     * @param {number} [maxPhoneWidth=600] <strong>only for browsers</strong> specify a value for the maximum\r\n     *        width of smallest device side (in logical \"CSS\" pixels) until a device detected as mobile will be handled\r\n     *        as phone.\r\n     *        This is only used in cases where the device cannot be classified as phone or tablet.<br>\r\n     *        See <a href=\"http://developer.android.com/guide/practices/screens_support.html\">Declaring Tablet Layouts\r\n     *        for Android</a>.<br>\r\n     *        If you provide a value < 0, then this \"fuzzy\" check is disabled.\r\n     * @constructor\r\n     * @global\r\n     */\r\n    function MobileDetect(userAgent, maxPhoneWidth) {\r\n        this.ua = prepareUserAgent(userAgent);\r\n        this._cache = {};\r\n        //600dp is typical 7\" tablet minimum width\r\n        this.maxPhoneWidth = maxPhoneWidth || 600;\r\n    }\r\n\r\n    MobileDetect.prototype = {\r\n        constructor: MobileDetect,\r\n\r\n        /**\r\n         * Returns the detected phone or tablet type or <tt>null</tt> if it is not a mobile device.\r\n         * <br>\r\n         * For a list of possible return values see {@link MobileDetect#phone} and {@link MobileDetect#tablet}.<br>\r\n         * <br>\r\n         * If the device is not detected by the regular expressions from Mobile-Detect, a test is made against\r\n         * the patterns of <a href=\"http://detectmobilebrowsers.com/\">detectmobilebrowsers.com</a>. If this test\r\n         * is positive, a value of <code>UnknownPhone</code>, <code>UnknownTablet</code> or\r\n         * <code>UnknownMobile</code> is returned.<br>\r\n         * When used in browser, the decision whether phone or tablet is made based on <code>screen.width/height</code>.<br>\r\n         * <br>\r\n         * When used server-side (node.js), there is no way to tell the difference between <code>UnknownTablet</code>\r\n         * and <code>UnknownMobile</code>, so you will get <code>UnknownMobile</code> here.<br>\r\n         * Be aware that since v1.0.0 in this special case you will get <code>UnknownMobile</code> only for:\r\n         * {@link MobileDetect#mobile}, not for {@link MobileDetect#phone} and {@link MobileDetect#tablet}.\r\n         * In versions before v1.0.0 all 3 methods returned <code>UnknownMobile</code> which was tedious to use.\r\n         * <br>\r\n         * In most cases you will use the return value just as a boolean.\r\n         *\r\n         * @returns {String} the key for the phone family or tablet family, e.g. \"Nexus\".\r\n         * @function MobileDetect#mobile\r\n         */\r\n        mobile: function () {\r\n            impl.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth);\r\n            return this._cache.mobile;\r\n        },\r\n\r\n        /**\r\n         * Returns the detected phone type/family string or <tt>null</tt>.\r\n         * <br>\r\n         * The returned tablet (family or producer) is one of following keys:<br>\r\n         * <br><tt>iPhone, BlackBerry, HTC, Nexus, Dell, Motorola, Samsung, LG, Sony, Asus,\r\n         * NokiaLumia, Micromax, Palm, Vertu, Pantech, Fly, Wiko, iMobile, SimValley,\r\n         * Wolfgang, Alcatel, Nintendo, Amoi, INQ, OnePlus, GenericPhone</tt><br>\r\n         * <br>\r\n         * If the device is not detected by the regular expressions from Mobile-Detect, a test is made against\r\n         * the patterns of <a href=\"http://detectmobilebrowsers.com/\">detectmobilebrowsers.com</a>. If this test\r\n         * is positive, a value of <code>UnknownPhone</code> or <code>UnknownMobile</code> is returned.<br>\r\n         * When used in browser, the decision whether phone or tablet is made based on <code>screen.width/height</code>.<br>\r\n         * <br>\r\n         * When used server-side (node.js), there is no way to tell the difference between <code>UnknownTablet</code>\r\n         * and <code>UnknownMobile</code>, so you will get <code>null</code> here, while {@link MobileDetect#mobile}\r\n         * will return <code>UnknownMobile</code>.<br>\r\n         * Be aware that since v1.0.0 in this special case you will get <code>UnknownMobile</code> only for:\r\n         * {@link MobileDetect#mobile}, not for {@link MobileDetect#phone} and {@link MobileDetect#tablet}.\r\n         * In versions before v1.0.0 all 3 methods returned <code>UnknownMobile</code> which was tedious to use.\r\n         * <br>\r\n         * In most cases you will use the return value just as a boolean.\r\n         *\r\n         * @returns {String} the key of the phone family or producer, e.g. \"iPhone\"\r\n         * @function MobileDetect#phone\r\n         */\r\n        phone: function () {\r\n            impl.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth);\r\n            return this._cache.phone;\r\n        },\r\n\r\n        /**\r\n         * Returns the detected tablet type/family string or <tt>null</tt>.\r\n         * <br>\r\n         * The returned tablet (family or producer) is one of following keys:<br>\r\n         * <br><tt>iPad, NexusTablet, GoogleTablet, SamsungTablet, Kindle, SurfaceTablet,\r\n         * HPTablet, AsusTablet, BlackBerryTablet, HTCtablet, MotorolaTablet, NookTablet,\r\n         * AcerTablet, ToshibaTablet, LGTablet, FujitsuTablet, PrestigioTablet,\r\n         * LenovoTablet, DellTablet, YarvikTablet, MedionTablet, ArnovaTablet,\r\n         * IntensoTablet, IRUTablet, MegafonTablet, EbodaTablet, AllViewTablet,\r\n         * ArchosTablet, AinolTablet, NokiaLumiaTablet, SonyTablet, PhilipsTablet,\r\n         * CubeTablet, CobyTablet, MIDTablet, MSITablet, SMiTTablet, RockChipTablet,\r\n         * FlyTablet, bqTablet, HuaweiTablet, NecTablet, PantechTablet, BronchoTablet,\r\n         * VersusTablet, ZyncTablet, PositivoTablet, NabiTablet, KoboTablet, DanewTablet,\r\n         * TexetTablet, PlaystationTablet, TrekstorTablet, PyleAudioTablet, AdvanTablet,\r\n         * DanyTechTablet, GalapadTablet, MicromaxTablet, KarbonnTablet, AllFineTablet,\r\n         * PROSCANTablet, YONESTablet, ChangJiaTablet, GUTablet, PointOfViewTablet,\r\n         * OvermaxTablet, HCLTablet, DPSTablet, VistureTablet, CrestaTablet,\r\n         * MediatekTablet, ConcordeTablet, GoCleverTablet, ModecomTablet, VoninoTablet,\r\n         * ECSTablet, StorexTablet, VodafoneTablet, EssentielBTablet, RossMoorTablet,\r\n         * iMobileTablet, TolinoTablet, AudioSonicTablet, AMPETablet, SkkTablet,\r\n         * TecnoTablet, JXDTablet, iJoyTablet, FX2Tablet, XoroTablet, ViewsonicTablet,\r\n         * VerizonTablet, OdysTablet, CaptivaTablet, IconbitTablet, TeclastTablet,\r\n         * OndaTablet, JaytechTablet, BlaupunktTablet, DigmaTablet, EvolioTablet,\r\n         * LavaTablet, AocTablet, MpmanTablet, CelkonTablet, WolderTablet, MediacomTablet,\r\n         * MiTablet, NibiruTablet, NexoTablet, LeaderTablet, UbislateTablet,\r\n         * PocketBookTablet, KocasoTablet, HisenseTablet, Hudl, TelstraTablet,\r\n         * GenericTablet</tt><br>\r\n         * <br>\r\n         * If the device is not detected by the regular expressions from Mobile-Detect, a test is made against\r\n         * the patterns of <a href=\"http://detectmobilebrowsers.com/\">detectmobilebrowsers.com</a>. If this test\r\n         * is positive, a value of <code>UnknownTablet</code> or <code>UnknownMobile</code> is returned.<br>\r\n         * When used in browser, the decision whether phone or tablet is made based on <code>screen.width/height</code>.<br>\r\n         * <br>\r\n         * When used server-side (node.js), there is no way to tell the difference between <code>UnknownTablet</code>\r\n         * and <code>UnknownMobile</code>, so you will get <code>null</code> here, while {@link MobileDetect#mobile}\r\n         * will return <code>UnknownMobile</code>.<br>\r\n         * Be aware that since v1.0.0 in this special case you will get <code>UnknownMobile</code> only for:\r\n         * {@link MobileDetect#mobile}, not for {@link MobileDetect#phone} and {@link MobileDetect#tablet}.\r\n         * In versions before v1.0.0 all 3 methods returned <code>UnknownMobile</code> which was tedious to use.\r\n         * <br>\r\n         * In most cases you will use the return value just as a boolean.\r\n         *\r\n         * @returns {String} the key of the tablet family or producer, e.g. \"SamsungTablet\"\r\n         * @function MobileDetect#tablet\r\n         */\r\n        tablet: function () {\r\n            impl.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth);\r\n            return this._cache.tablet;\r\n        },\r\n\r\n        /**\r\n         * Returns the (first) detected user-agent string or <tt>null</tt>.\r\n         * <br>\r\n         * The returned user-agent is one of following keys:<br>\r\n         * <br><tt>Chrome, Dolfin, Opera, Skyfire, Edge, IE, Firefox, Bolt, TeaShark, Blazer,\r\n         * Safari, WeChat, UCBrowser, baiduboxapp, baidubrowser, DiigoBrowser, Mercury,\r\n         * ObigoBrowser, NetFront, GenericBrowser, PaleMoon</tt><br>\r\n         * <br>\r\n         * In most cases calling {@link MobileDetect#userAgent} will be sufficient. But there are rare\r\n         * cases where a mobile device pretends to be more than one particular browser. You can get the\r\n         * list of all matches with {@link MobileDetect#userAgents} or check for a particular value by\r\n         * providing one of the defined keys as first argument to {@link MobileDetect#is}.\r\n         *\r\n         * @returns {String} the key for the detected user-agent or <tt>null</tt>\r\n         * @function MobileDetect#userAgent\r\n         */\r\n        userAgent: function () {\r\n            if (this._cache.userAgent === undefined) {\r\n                this._cache.userAgent = impl.findMatch(impl.mobileDetectRules.uas, this.ua);\r\n            }\r\n            return this._cache.userAgent;\r\n        },\r\n\r\n        /**\r\n         * Returns all detected user-agent strings.\r\n         * <br>\r\n         * The array is empty or contains one or more of following keys:<br>\r\n         * <br><tt>Chrome, Dolfin, Opera, Skyfire, Edge, IE, Firefox, Bolt, TeaShark, Blazer,\r\n         * Safari, WeChat, UCBrowser, baiduboxapp, baidubrowser, DiigoBrowser, Mercury,\r\n         * ObigoBrowser, NetFront, GenericBrowser, PaleMoon</tt><br>\r\n         * <br>\r\n         * In most cases calling {@link MobileDetect#userAgent} will be sufficient. But there are rare\r\n         * cases where a mobile device pretends to be more than one particular browser. You can get the\r\n         * list of all matches with {@link MobileDetect#userAgents} or check for a particular value by\r\n         * providing one of the defined keys as first argument to {@link MobileDetect#is}.\r\n         *\r\n         * @returns {Array} the array of detected user-agent keys or <tt>[]</tt>\r\n         * @function MobileDetect#userAgents\r\n         */\r\n        userAgents: function () {\r\n            if (this._cache.userAgents === undefined) {\r\n                this._cache.userAgents = impl.findMatches(impl.mobileDetectRules.uas, this.ua);\r\n            }\r\n            return this._cache.userAgents;\r\n        },\r\n\r\n        /**\r\n         * Returns the detected operating system string or <tt>null</tt>.\r\n         * <br>\r\n         * The operating system is one of following keys:<br>\r\n         * <br><tt>AndroidOS, BlackBerryOS, PalmOS, SymbianOS, WindowsMobileOS, WindowsPhoneOS,\r\n         * iOS, iPadOS, MeeGoOS, MaemoOS, JavaOS, webOS, badaOS, BREWOS</tt><br>\r\n         *\r\n         * @returns {String} the key for the detected operating system.\r\n         * @function MobileDetect#os\r\n         */\r\n        os: function () {\r\n            if (this._cache.os === undefined) {\r\n                this._cache.os = impl.detectOS(this.ua);\r\n            }\r\n            return this._cache.os;\r\n        },\r\n\r\n        /**\r\n         * Get the version (as Number) of the given property in the User-Agent.\r\n         * <br>\r\n         * Will return a float number. (eg. 2_0 will return 2.0, 4.3.1 will return 4.31)\r\n         *\r\n         * @param {String} key a key defining a thing which has a version.<br>\r\n         *        You can use one of following keys:<br>\r\n         * <br><tt>Mobile, Build, Version, VendorID, iPad, iPhone, iPod, Kindle, Chrome, Coast,\r\n         * Dolfin, Firefox, Fennec, Edge, IE, NetFront, NokiaBrowser, Opera, Opera Mini,\r\n         * Opera Mobi, UCBrowser, MQQBrowser, MicroMessenger, baiduboxapp, baidubrowser,\r\n         * SamsungBrowser, Iron, Safari, Skyfire, Tizen, Webkit, PaleMoon, Gecko, Trident,\r\n         * Presto, Goanna, iOS, Android, BlackBerry, BREW, Java, Windows Phone OS, Windows\r\n         * Phone, Windows CE, Windows NT, Symbian, webOS</tt><br>\r\n         *\r\n         * @returns {Number} the version as float or <tt>NaN</tt> if User-Agent doesn't contain this version.\r\n         *          Be careful when comparing this value with '==' operator!\r\n         * @function MobileDetect#version\r\n         */\r\n        version: function (key) {\r\n            return impl.getVersion(key, this.ua);\r\n        },\r\n\r\n        /**\r\n         * Get the version (as String) of the given property in the User-Agent.\r\n         * <br>\r\n         *\r\n         * @param {String} key a key defining a thing which has a version.<br>\r\n         *        You can use one of following keys:<br>\r\n         * <br><tt>Mobile, Build, Version, VendorID, iPad, iPhone, iPod, Kindle, Chrome, Coast,\r\n         * Dolfin, Firefox, Fennec, Edge, IE, NetFront, NokiaBrowser, Opera, Opera Mini,\r\n         * Opera Mobi, UCBrowser, MQQBrowser, MicroMessenger, baiduboxapp, baidubrowser,\r\n         * SamsungBrowser, Iron, Safari, Skyfire, Tizen, Webkit, PaleMoon, Gecko, Trident,\r\n         * Presto, Goanna, iOS, Android, BlackBerry, BREW, Java, Windows Phone OS, Windows\r\n         * Phone, Windows CE, Windows NT, Symbian, webOS</tt><br>\r\n         *\r\n         * @returns {String} the \"raw\" version as String or <tt>null</tt> if User-Agent doesn't contain this version.\r\n         *\r\n         * @function MobileDetect#versionStr\r\n         */\r\n        versionStr: function (key) {\r\n            return impl.getVersionStr(key, this.ua);\r\n        },\r\n\r\n        /**\r\n         * Global test key against userAgent, os, phone, tablet and some other properties of userAgent string.\r\n         *\r\n         * @param {String} key the key (case-insensitive) of a userAgent, an operating system, phone or\r\n         *        tablet family.<br>\r\n         *        For a complete list of possible values, see {@link MobileDetect#userAgent},\r\n         *        {@link MobileDetect#os}, {@link MobileDetect#phone}, {@link MobileDetect#tablet}.<br>\r\n         *        Additionally you have following keys:<br>\r\n         * <br><tt>Bot, MobileBot, DesktopMode, TV, WebKit, Console, Watch</tt><br>\r\n         *\r\n         * @returns {boolean} <tt>true</tt> when the given key is one of the defined keys of userAgent, os, phone,\r\n         *                    tablet or one of the listed additional keys, otherwise <tt>false</tt>\r\n         * @function MobileDetect#is\r\n         */\r\n        is: function (key) {\r\n            return containsIC(this.userAgents(), key) ||\r\n                   equalIC(key, this.os()) ||\r\n                   equalIC(key, this.phone()) ||\r\n                   equalIC(key, this.tablet()) ||\r\n                   containsIC(impl.findMatches(impl.mobileDetectRules.utils, this.ua), key);\r\n        },\r\n\r\n        /**\r\n         * Do a quick test against navigator::userAgent.\r\n         *\r\n         * @param {String|RegExp} pattern the pattern, either as String or RegExp\r\n         *                        (a string will be converted to a case-insensitive RegExp).\r\n         * @returns {boolean} <tt>true</tt> when the pattern matches, otherwise <tt>false</tt>\r\n         * @function MobileDetect#match\r\n         */\r\n        match: function (pattern) {\r\n            if (!(pattern instanceof RegExp)) {\r\n                pattern = new RegExp(pattern, 'i');\r\n            }\r\n            return pattern.test(this.ua);\r\n        },\r\n\r\n        /**\r\n         * Checks whether the mobile device can be considered as phone regarding <code>screen.width</code>.\r\n         * <br>\r\n         * Obviously this method makes sense in browser environments only (not for Node.js)!\r\n         * @param {number} [maxPhoneWidth] the maximum logical pixels (aka. CSS-pixels) to be considered as phone.<br>\r\n         *        The argument is optional and if not present or falsy, the value of the constructor is taken.\r\n         * @returns {boolean|undefined} <code>undefined</code> if screen size wasn't detectable, else <code>true</code>\r\n         *          when screen.width is less or equal to maxPhoneWidth, otherwise <code>false</code>.<br>\r\n         *          Will always return <code>undefined</code> server-side.\r\n         */\r\n        isPhoneSized: function (maxPhoneWidth) {\r\n            return MobileDetect.isPhoneSized(maxPhoneWidth || this.maxPhoneWidth);\r\n        },\r\n\r\n        /**\r\n         * Returns the mobile grade ('A', 'B', 'C').\r\n         *\r\n         * @returns {String} one of the mobile grades ('A', 'B', 'C').\r\n         * @function MobileDetect#mobileGrade\r\n         */\r\n        mobileGrade: function () {\r\n            if (this._cache.grade === undefined) {\r\n                this._cache.grade = impl.mobileGrade(this);\r\n            }\r\n            return this._cache.grade;\r\n        }\r\n    };\r\n\r\n    // environment-dependent\r\n    if (typeof window !== 'undefined' && window.screen) {\r\n        MobileDetect.isPhoneSized = function (maxPhoneWidth) {\r\n            return maxPhoneWidth < 0 ? undefined : impl.getDeviceSmallerSide() <= maxPhoneWidth;\r\n        };\r\n    } else {\r\n        MobileDetect.isPhoneSized = function () {};\r\n    }\r\n\r\n    // should not be replaced by a completely new object - just overwrite existing methods\r\n    MobileDetect._impl = impl;\r\n    \r\n    MobileDetect.version = '1.4.4 2019-09-21';\r\n\r\n    return MobileDetect;\r\n}); // end of call of define()\r\n})((function (undefined) {\r\n    if (typeof module !== 'undefined' && module.exports) {\r\n        return function (factory) { module.exports = factory(); };\r\n    } else if (typeof define === 'function' && define.amd) {\r\n        return define;\r\n    } else if (typeof window !== 'undefined') {\r\n        return function (factory) { window.MobileDetect = factory(); };\r\n    } else {\r\n        // please file a bug if you get this error!\r\n        throw new Error('unknown environment');\r\n    }\r\n})());","// Copyright (c) 2013 Pieroxy <pieroxy@pieroxy.net>\r\n// This work is free. You can redistribute it and/or modify it\r\n// under the terms of the WTFPL, Version 2\r\n// For more information see LICENSE.txt or http://www.wtfpl.net/\r\n//\r\n// For more information, the home page:\r\n// http://pieroxy.net/blog/pages/lz-string/testing.html\r\n//\r\n// LZ-based compression algorithm, version 1.4.4\r\n\r\n// private property\r\nlet f = String.fromCharCode;\r\nlet keyStrBase64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\r\nlet keyStrUriSafe = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$\";\r\nlet baseReverseDic = {};\r\n\r\nfunction getBaseValue(alphabet, character) {\r\n  if (!baseReverseDic[alphabet]) {\r\n    baseReverseDic[alphabet] = {};\r\n    for (let i = 0; i < alphabet.length; i++) {\r\n      baseReverseDic[alphabet][alphabet.charAt(i)] = i;\r\n    }\r\n  }\r\n  return baseReverseDic[alphabet][character];\r\n}\r\n\r\nfunction getInput(input) {\r\n  if (input === null) {\r\n    return '';\r\n  } else if (input === '') {\r\n    return null;\r\n  }\r\n\r\n  if (typeof input === \"string\") {\r\n    return input;\r\n  }\r\n\r\n  if (input instanceof ArrayBuffer) {\r\n    input = new Uint8Array(input);\r\n  }\r\n\r\n  let s = '';\r\n  for (let i = 0; i < input.length; i++) {\r\n    s += String.fromCharCode(input[i]);\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nexport default {\r\n  compressToBase64: function (input) {\r\n    input = getInput(input);\r\n\r\n    if (!input) return \"\";\r\n\r\n    let res = this._compress(input, 6, function (a) {\r\n      return keyStrBase64.charAt(a);\r\n    });\r\n    switch (res.length%4) { // To produce valid Base64\r\n      default: // When could this happen ?\r\n      case 0 :\r\n        return res;\r\n      case 1 :\r\n        return res + \"===\";\r\n      case 2 :\r\n        return res + \"==\";\r\n      case 3 :\r\n        return res + \"=\";\r\n    }\r\n  },\r\n\r\n  decompressFromBase64: function (input) {\r\n    if (input === null) return \"\";\r\n    if (input === \"\") return null;\r\n\r\n    input = getInput(input);\r\n    return this._decompress(input.length, 32, function (index) {\r\n      return getBaseValue(keyStrBase64, input.charAt(index));\r\n    });\r\n  },\r\n\r\n  compressToUTF16: function (input) {\r\n    if (input === null) return \"\";\r\n\r\n    input = getInput(input);\r\n    return this._compress(input, 15, function (a) {\r\n      return f(a + 32);\r\n    }) + \" \";\r\n  },\r\n\r\n  decompressFromUTF16: function (compressed) {\r\n    if (compressed === null) return \"\";\r\n    if (compressed === \"\") return null;\r\n\r\n    compressed = getInput(compressed);\r\n    return this._decompress(compressed.length, 16384, function (index) {\r\n      return compressed.charCodeAt(index) - 32;\r\n    });\r\n  },\r\n\r\n  //compress into uint8array (UCS-2 big endian format)\r\n  compressToUint8Array: function (uncompressed) {\r\n    uncompressed = getInput(uncompressed);\r\n\r\n    let compressed = this.compress(uncompressed);\r\n    let buf = new Uint8Array(compressed.length*2); // 2 bytes per character\r\n\r\n    for (let i = 0, TotalLen = compressed.length; i < TotalLen; i++) {\r\n      let current_value = compressed.charCodeAt(i);\r\n      buf[i*2] = current_value>>>8;\r\n      buf[i*2 + 1] = current_value%256;\r\n    }\r\n    return buf;\r\n  },\r\n\r\n  //decompress from uint8array (UCS-2 big endian format)\r\n  decompressFromUint8Array: function (compressed) {\r\n    if (compressed === null || compressed === undefined) {\r\n      return this.decompress(compressed);\r\n    } else {\r\n      compressed = getInput(compressed);\r\n\r\n      let buf = new Array(compressed.length/2); // 2 bytes per character\r\n      for (let i = 0, TotalLen = buf.length; i < TotalLen; i++) {\r\n        buf[i] = compressed[i*2]*256 + compressed[i*2 + 1];\r\n      }\r\n\r\n      let result = [];\r\n      buf.forEach(function (c) {\r\n        result.push(f(c));\r\n      });\r\n      return this.decompress(result.join(''));\r\n\r\n    }\r\n\r\n  },\r\n\r\n\r\n  //compress into a string that is already URI encoded\r\n  compressToEncodedURIComponent: function (input) {\r\n    if (input === null) return \"\";\r\n    return this._compress(input, 6, function (a) {\r\n      return keyStrUriSafe.charAt(a);\r\n    });\r\n  },\r\n\r\n  //decompress from an output of compressToEncodedURIComponent\r\n  decompressFromEncodedURIComponent: function (input) {\r\n    if (input === null) return \"\";\r\n    if (input === \"\") return null;\r\n    input = input.replace(/ /g, \"+\");\r\n    return this._decompress(input.length, 32, function (index) {\r\n      return getBaseValue(keyStrUriSafe, input.charAt(index));\r\n    });\r\n  },\r\n\r\n  compress : function (uncompressed) {\r\n    return this._compress(uncompressed, 16, function (a) {\r\n      return f(a);\r\n    });\r\n  },\r\n\r\n  _compress: function (uncompressed, bitsPerChar, getCharFromInt) {\r\n    uncompressed = getInput(uncompressed);\r\n\r\n    if (uncompressed === null) return \"\";\r\n    let i, value, context_dictionary = {}, context_dictionaryToCreate = {}, context_c = \"\", context_wc = \"\",\r\n        context_w                                                                                      = \"\", context_enlargeIn = 2, // Compensate for the first entry which should not count\r\n        context_dictSize                                                                               = 3, context_numBits = 2, context_data                                        = [], context_data_val = 0,\r\n        context_data_position                                                                          = 0, ii;\r\n\r\n    for (ii = 0; ii < uncompressed.length; ii += 1) {\r\n      context_c = uncompressed.charAt(ii);\r\n      if (!Object.prototype.hasOwnProperty.call(context_dictionary, context_c)) {\r\n        context_dictionary[context_c] = context_dictSize++;\r\n        context_dictionaryToCreate[context_c] = true;\r\n      }\r\n\r\n      context_wc = context_w + context_c;\r\n      if (Object.prototype.hasOwnProperty.call(context_dictionary, context_wc)) {\r\n        context_w = context_wc;\r\n      } else {\r\n        if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate, context_w)) {\r\n          if (context_w.charCodeAt(0) < 256) {\r\n            for (i = 0; i < context_numBits; i++) {\r\n              context_data_val = (context_data_val<<1);\r\n              if (context_data_position === bitsPerChar - 1) {\r\n                context_data_position = 0;\r\n                context_data.push(getCharFromInt(context_data_val));\r\n                context_data_val = 0;\r\n              } else {\r\n                context_data_position++;\r\n              }\r\n            }\r\n            value = context_w.charCodeAt(0);\r\n            for (i = 0; i < 8; i++) {\r\n              context_data_val = (context_data_val<<1) | (value & 1);\r\n              if (context_data_position === bitsPerChar - 1) {\r\n                context_data_position = 0;\r\n                context_data.push(getCharFromInt(context_data_val));\r\n                context_data_val = 0;\r\n              } else {\r\n                context_data_position++;\r\n              }\r\n              value = value>>1;\r\n            }\r\n          } else {\r\n            value = 1;\r\n            for (i = 0; i < context_numBits; i++) {\r\n              context_data_val = (context_data_val<<1) | value;\r\n              if (context_data_position == bitsPerChar - 1) {\r\n                context_data_position = 0;\r\n                context_data.push(getCharFromInt(context_data_val));\r\n                context_data_val = 0;\r\n              } else {\r\n                context_data_position++;\r\n              }\r\n              value = 0;\r\n            }\r\n            value = context_w.charCodeAt(0);\r\n            for (i = 0; i < 16; i++) {\r\n              context_data_val = (context_data_val<<1) | (value & 1);\r\n              if (context_data_position === bitsPerChar - 1) {\r\n                context_data_position = 0;\r\n                context_data.push(getCharFromInt(context_data_val));\r\n                context_data_val = 0;\r\n              } else {\r\n                context_data_position++;\r\n              }\r\n              value = value>>1;\r\n            }\r\n          }\r\n          context_enlargeIn--;\r\n          if (context_enlargeIn === 0) {\r\n            context_enlargeIn = Math.pow(2, context_numBits);\r\n            context_numBits++;\r\n          }\r\n          delete context_dictionaryToCreate[context_w];\r\n        } else {\r\n          value = context_dictionary[context_w];\r\n          for (i = 0; i < context_numBits; i++) {\r\n            context_data_val = (context_data_val<<1) | (value & 1);\r\n            if (context_data_position === bitsPerChar - 1) {\r\n              context_data_position = 0;\r\n              context_data.push(getCharFromInt(context_data_val));\r\n              context_data_val = 0;\r\n            } else {\r\n              context_data_position++;\r\n            }\r\n            value = value>>1;\r\n          }\r\n\r\n\r\n        }\r\n        context_enlargeIn--;\r\n        if (context_enlargeIn === 0) {\r\n          context_enlargeIn = Math.pow(2, context_numBits);\r\n          context_numBits++;\r\n        }\r\n        // Add wc to the dictionary.\r\n        context_dictionary[context_wc] = context_dictSize++;\r\n        context_w = String(context_c);\r\n      }\r\n    }\r\n\r\n    // Output the code for w.\r\n    if (context_w !== \"\") {\r\n      if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate, context_w)) {\r\n        if (context_w.charCodeAt(0) < 256) {\r\n          for (i = 0; i < context_numBits; i++) {\r\n            context_data_val = (context_data_val<<1);\r\n            if (context_data_position === bitsPerChar - 1) {\r\n              context_data_position = 0;\r\n              context_data.push(getCharFromInt(context_data_val));\r\n              context_data_val = 0;\r\n            } else {\r\n              context_data_position++;\r\n            }\r\n          }\r\n          value = context_w.charCodeAt(0);\r\n          for (i = 0; i < 8; i++) {\r\n            context_data_val = (context_data_val<<1) | (value & 1);\r\n            if (context_data_position === bitsPerChar - 1) {\r\n              context_data_position = 0;\r\n              context_data.push(getCharFromInt(context_data_val));\r\n              context_data_val = 0;\r\n            } else {\r\n              context_data_position++;\r\n            }\r\n            value = value>>1;\r\n          }\r\n        } else {\r\n          value = 1;\r\n          for (i = 0; i < context_numBits; i++) {\r\n            context_data_val = (context_data_val<<1) | value;\r\n            if (context_data_position === bitsPerChar - 1) {\r\n              context_data_position = 0;\r\n              context_data.push(getCharFromInt(context_data_val));\r\n              context_data_val = 0;\r\n            } else {\r\n              context_data_position++;\r\n            }\r\n            value = 0;\r\n          }\r\n          value = context_w.charCodeAt(0);\r\n          for (i = 0; i < 16; i++) {\r\n            context_data_val = (context_data_val<<1) | (value & 1);\r\n            if (context_data_position === bitsPerChar - 1) {\r\n              context_data_position = 0;\r\n              context_data.push(getCharFromInt(context_data_val));\r\n              context_data_val = 0;\r\n            } else {\r\n              context_data_position++;\r\n            }\r\n            value = value>>1;\r\n          }\r\n        }\r\n        context_enlargeIn--;\r\n        if (context_enlargeIn === 0) {\r\n          context_enlargeIn = Math.pow(2, context_numBits);\r\n          context_numBits++;\r\n        }\r\n        delete context_dictionaryToCreate[context_w];\r\n      } else {\r\n        value = context_dictionary[context_w];\r\n        for (i = 0; i < context_numBits; i++) {\r\n          context_data_val = (context_data_val<<1) | (value & 1);\r\n          if (context_data_position === bitsPerChar - 1) {\r\n            context_data_position = 0;\r\n            context_data.push(getCharFromInt(context_data_val));\r\n            context_data_val = 0;\r\n          } else {\r\n            context_data_position++;\r\n          }\r\n          value = value>>1;\r\n        }\r\n\r\n\r\n      }\r\n      context_enlargeIn--;\r\n      if (context_enlargeIn === 0) {\r\n        context_enlargeIn = Math.pow(2, context_numBits);\r\n        context_numBits++;\r\n      }\r\n    }\r\n\r\n    // Mark the end of the stream\r\n    value = 2;\r\n    for (i = 0; i < context_numBits; i++) {\r\n      context_data_val = (context_data_val<<1) | (value & 1);\r\n      if (context_data_position === bitsPerChar - 1) {\r\n        context_data_position = 0;\r\n        context_data.push(getCharFromInt(context_data_val));\r\n        context_data_val = 0;\r\n      } else {\r\n        context_data_position++;\r\n      }\r\n      value = value>>1;\r\n    }\r\n\r\n    // Flush the last char\r\n    while (true) {\r\n      context_data_val = (context_data_val<<1);\r\n      if (context_data_position === bitsPerChar - 1) {\r\n        context_data.push(getCharFromInt(context_data_val));\r\n        break;\r\n      } else context_data_position++;\r\n    }\r\n    return context_data.join('');\r\n  },\r\n\r\n  decompress: function (compressed) {\r\n    if (compressed === null) return \"\";\r\n    if (compressed === \"\") return null;\r\n\r\n    compressed = getInput(compressed);\r\n\r\n    return this._decompress(compressed.length, 32768, function (index) {\r\n      return compressed.charCodeAt(index);\r\n    });\r\n  },\r\n\r\n  _decompress: function (length, resetValue, getNextValue) {\r\n    let dictionary = [], next, enlargeIn = 4, dictSize = 4, numBits = 3, entry = \"\", result = [], i, w,\r\n        bits, resb,\r\n        maxpower, power, c, data                                                            = {val: getNextValue(0), position: resetValue, index: 1};\r\n\r\n    for (i = 0; i < 3; i += 1) {\r\n      dictionary[i] = i;\r\n    }\r\n\r\n    bits = 0;\r\n    maxpower = Math.pow(2, 2);\r\n    power = 1;\r\n    while (power !== maxpower) {\r\n      resb = data.val & data.position;\r\n      data.position >>= 1;\r\n      if (data.position === 0) {\r\n        data.position = resetValue;\r\n        data.val = getNextValue(data.index++);\r\n      }\r\n      bits |= (resb > 0 ? 1 : 0)*power;\r\n      power <<= 1;\r\n    }\r\n\r\n    switch (next = bits) {\r\n      case 0:\r\n        bits = 0;\r\n        maxpower = Math.pow(2, 8);\r\n        power = 1;\r\n        while (power !== maxpower) {\r\n          resb = data.val & data.position;\r\n          data.position >>= 1;\r\n          if (data.position === 0) {\r\n            data.position = resetValue;\r\n            data.val = getNextValue(data.index++);\r\n          }\r\n          bits |= (resb > 0 ? 1 : 0)*power;\r\n          power <<= 1;\r\n        }\r\n        c = f(bits);\r\n        break;\r\n      case 1:\r\n        bits = 0;\r\n        maxpower = Math.pow(2, 16);\r\n        power = 1;\r\n        while (power !== maxpower) {\r\n          resb = data.val & data.position;\r\n          data.position >>= 1;\r\n          if (data.position === 0) {\r\n            data.position = resetValue;\r\n            data.val = getNextValue(data.index++);\r\n          }\r\n          bits |= (resb > 0 ? 1 : 0)*power;\r\n          power <<= 1;\r\n        }\r\n        c = f(bits);\r\n        break;\r\n      case 2:\r\n        return \"\";\r\n    }\r\n    dictionary[3] = c;\r\n    w = c;\r\n    result.push(c);\r\n    while (true) {\r\n      if (data.index > length) {\r\n        return \"\";\r\n      }\r\n\r\n      bits = 0;\r\n      maxpower = Math.pow(2, numBits);\r\n      power = 1;\r\n      while (power !== maxpower) {\r\n        resb = data.val & data.position;\r\n        data.position >>= 1;\r\n        if (data.position === 0) {\r\n          data.position = resetValue;\r\n          data.val = getNextValue(data.index++);\r\n        }\r\n        bits |= (resb > 0 ? 1 : 0)*power;\r\n        power <<= 1;\r\n      }\r\n\r\n      switch (c = bits) {\r\n        case 0:\r\n          bits = 0;\r\n          maxpower = Math.pow(2, 8);\r\n          power = 1;\r\n          while (power !== maxpower) {\r\n            resb = data.val & data.position;\r\n            data.position >>= 1;\r\n            if (data.position === 0) {\r\n              data.position = resetValue;\r\n              data.val = getNextValue(data.index++);\r\n            }\r\n            bits |= (resb > 0 ? 1 : 0)*power;\r\n            power <<= 1;\r\n          }\r\n\r\n          dictionary[dictSize++] = f(bits);\r\n          c = dictSize - 1;\r\n          enlargeIn--;\r\n          break;\r\n        case 1:\r\n          bits = 0;\r\n          maxpower = Math.pow(2, 16);\r\n          power = 1;\r\n          while (power !== maxpower) {\r\n            resb = data.val & data.position;\r\n            data.position >>= 1;\r\n            if (data.position === 0) {\r\n              data.position = resetValue;\r\n              data.val = getNextValue(data.index++);\r\n            }\r\n            bits |= (resb > 0 ? 1 : 0)*power;\r\n            power <<= 1;\r\n          }\r\n          dictionary[dictSize++] = f(bits);\r\n          c = dictSize - 1;\r\n          enlargeIn--;\r\n          break;\r\n        case 2:\r\n          return result.join('');\r\n      }\r\n\r\n      if (enlargeIn === 0) {\r\n        enlargeIn = Math.pow(2, numBits);\r\n        numBits++;\r\n      }\r\n\r\n      if (dictionary[c]) {\r\n        entry = dictionary[c];\r\n      } else {\r\n        if (c === dictSize) {\r\n          entry = w + w.charAt(0);\r\n        } else {\r\n          return null;\r\n        }\r\n      }\r\n      result.push(entry);\r\n\r\n      // Add w+entry[0] to the dictionary.\r\n      dictionary[dictSize++] = w + entry.charAt(0);\r\n      enlargeIn--;\r\n\r\n      w = entry;\r\n\r\n      if (enlargeIn === 0) {\r\n        enlargeIn = Math.pow(2, numBits);\r\n        numBits++;\r\n      }\r\n\r\n    }\r\n  }\r\n};\r\n","import './polyfill.js';\r\nimport './struct.js';\r\nimport './mobile-detect.js';\r\nimport nstructjs from './struct.js';\r\n\r\nlet f64tmp = new Float64Array(1);\r\nlet u16tmp = new Uint16Array(f64tmp.buffer);\r\n\r\nexport function isDenormal(f) {\r\n  f64tmp[0] = f;\r\n\r\n  let a = u16tmp[0], b = u16tmp[1], c = u16tmp[2], d = u16tmp[3];\r\n\r\n  //zero? check both positive and negative zero\r\n  if (a === 0 && b === 0 && c === 0 && (d === 0 || d === 32768)) {\r\n    return false;\r\n  }\r\n\r\n  let test = d & ~(1<<15);\r\n  test = test>>4;\r\n\r\n  //window.console.log(u16tmp[0], u16tmp[1], u16tmp[2], u16tmp[3], \"|\", test);\r\n\r\n  return test === 0;\r\n}\r\n\r\nglobalThis._isDenormal = isDenormal;\r\n\r\n\r\nlet colormap = {\r\n  \"black\"   : 30,\r\n  \"red\"     : 31,\r\n  \"green\"   : 32,\r\n  \"yellow\"  : 33,\r\n  \"blue\"    : 34,\r\n  \"magenta\" : 35,\r\n  \"cyan\"    : 36,\r\n  \"teal\"    : 36,\r\n  \"white\"   : 37,\r\n  \"reset\"   : 0,\r\n  \"grey\"    : 2,\r\n  \"gray\"    : 2,\r\n  \"orange\"  : 202,\r\n  \"pink\"    : 198,\r\n  \"brown\"   : 314,\r\n  \"lightred\": 91,\r\n  \"peach\"   : 210\r\n}\r\n\r\nexport let termColorMap = {};\r\nfor (let k in colormap) {\r\n  termColorMap[k] = colormap[k];\r\n  termColorMap[colormap[k]] = k;\r\n}\r\n\r\nexport function termColor(s, c, d = 0) {\r\n  if (typeof s === \"symbol\") {\r\n    s = s.toString();\r\n  } else {\r\n    s = \"\" + s;\r\n  }\r\n\r\n  if (c in colormap)\r\n    c = colormap[c]\r\n\r\n  if (c > 107) {\r\n    let s2 = '\\u001b[38;5;' + c + \"m\"\r\n    return s2 + s + '\\u001b[39m'\r\n  }\r\n\r\n  return '\\u001b[' + c + 'm' + s + '\\u001b[39m';\r\n};\r\n\r\nexport function termPrint() {\r\n  //let console = window.console;\r\n\r\n  let s = '';\r\n  for (let i = 0; i < arguments.length; i++) {\r\n    if (i > 0) {\r\n      s += ' ';\r\n    }\r\n    s += arguments[i];\r\n  }\r\n\r\n  let re1a = /\\u001b\\[[1-9][0-9]?m/;\r\n  let re1b = /\\u001b\\[[1-9][0-9];[0-9][0-9]?;[0-9]+m/\r\n  let re2 = /\\u001b\\[39m/;\r\n\r\n  let endtag = '\\u001b[39m';\r\n\r\n  function tok(s, type) {\r\n    return {\r\n      type : type,\r\n      value: s\r\n    }\r\n  }\r\n\r\n  let tokdef = [\r\n    [re1a, \"start\"],\r\n    [re1b, \"start\"],\r\n    [re2, \"end\"]\r\n  ];\r\n\r\n  let s2 = s;\r\n\r\n  let i = 0;\r\n  let tokens = [];\r\n\r\n  while (s2.length > 0) {\r\n    let ok = false;\r\n\r\n    let mintk = undefined, mini = undefined;\r\n    let minslice = undefined, mintype = undefined;\r\n\r\n    for (let tk of tokdef) {\r\n      let i = s2.search(tk[0]);\r\n\r\n      if (i >= 0 && (mini === undefined || i < mini)) {\r\n        minslice = s2.slice(i, s2.length).match(tk[0])[0];\r\n        mini = i;\r\n        mintype = tk[1];\r\n        mintk = tk;\r\n        ok = true;\r\n      }\r\n    }\r\n\r\n    if (!ok) {\r\n      break;\r\n    }\r\n\r\n    if (mini > 0) {\r\n      let chunk = s2.slice(0, mini);\r\n      tokens.push(tok(chunk, \"chunk\"));\r\n    }\r\n\r\n    s2 = s2.slice(mini + minslice.length, s2.length);\r\n    let t = tok(minslice, mintype);\r\n\r\n    tokens.push(t);\r\n  }\r\n\r\n  if (s2.length > 0) {\r\n    tokens.push(tok(s2, \"chunk\"));\r\n  }\r\n\r\n  let stack = [];\r\n  let cur;\r\n\r\n  let out = '';\r\n\r\n  for (let t of tokens) {\r\n    if (t.type === \"chunk\") {\r\n      out += t.value;\r\n    } else if (t.type === \"start\") {\r\n      stack.push(cur);\r\n      cur = t.value;\r\n\r\n      out += t.value;\r\n    } else if (t.type === \"end\") {\r\n      cur = stack.pop();\r\n      if (cur) {\r\n        out += cur;\r\n      } else {\r\n        out += endtag;\r\n      }\r\n    }\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\nglobalThis.termColor = termColor;\r\n\r\nexport class MovingAvg extends Array {\r\n  constructor(size = 64) {\r\n    super();\r\n\r\n    this.length = size;\r\n    this.cur = 0;\r\n    this.used = 0;\r\n    this.sum = 0;\r\n  }\r\n\r\n  reset() {\r\n    this.cur = this.used = this.sum = 0.0;\r\n\r\n    return this;\r\n  }\r\n\r\n  add(val) {\r\n    if (this.used < this.length) {\r\n      this[this.cur] = val;\r\n      this.used++;\r\n    } else {\r\n      this.sum -= this[this.cur];\r\n      this[this.cur] = val;\r\n    }\r\n\r\n    this.sum += val;\r\n    this.cur = (this.cur + 1)%this.length;\r\n\r\n    return this.sample();\r\n  }\r\n\r\n  sample() {\r\n    return this.used ? this.sum/this.used : 0.0;\r\n  }\r\n}\r\n\r\nexport let timers = {};\r\n\r\nexport function pollTimer(id, interval) {\r\n  if (!(id in timers)) {\r\n    timers[id] = time_ms();\r\n  }\r\n\r\n  if (time_ms() - timers[id] >= interval) {\r\n    timers[id] = time_ms();\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nlet mdetect = undefined;\r\nlet mret = undefined;\r\n\r\nexport function isMobile() {\r\n  if (!window.MobileDetect) {\r\n    return;\r\n  }\r\n\r\n  if (mret === undefined) {\r\n    mdetect = new MobileDetect(navigator.userAgent);\r\n    let ret = mdetect.mobile();\r\n\r\n    if (typeof ret === \"string\") {\r\n      ret = ret.toLowerCase();\r\n    }\r\n\r\n    mret = ret;\r\n  }\r\n\r\n  return mret;\r\n}\r\n\r\n//window._isMobile = isMobile;\r\n\r\n//let SmartConsoleTag = Symbol(\"SmartConsoleTag\");\r\n//let tagid = 0;\r\n\r\nexport class SmartConsoleContext {\r\n  constructor(name, console) {\r\n    this.name = name;\r\n\r\n    let c = [random(), random(), random()];\r\n    let sum = Math.sqrt(c[0]*c[0] + c[1]*c[1] + c[2]*c[2]);\r\n    sum = 255/sum;\r\n\r\n    let r = ~~(c[0]*sum);\r\n    let g = ~~(c[1]*sum);\r\n    let b = ~~(c[2]*sum);\r\n\r\n    this.color = `rgb(${r},${g},${b})`;\r\n    this.__console = console;\r\n\r\n    //minimum time between prints of same message\r\n    this.timeInterval = 375;\r\n\r\n    //minimum time in general\r\n    this.timeIntervalAll = 245;\r\n\r\n    this._last = 0;\r\n    this.last = 0;\r\n    this.last2 = 0;\r\n    this._data = {};\r\n    this._data_length = 0;\r\n    this.maxCache = 256;\r\n  }\r\n\r\n\r\n  hash(args) {\r\n    let sum = 0;\r\n    let mul = (1<<19) - 1, off = (1<<27) - 1;\r\n    let i = 0;\r\n\r\n    function dohash(h) {\r\n      h = (h*mul + off + i*mul*0.25) & mul;\r\n\r\n      i++;\r\n      sum = sum ^ h;\r\n    }\r\n\r\n    let visit = new WeakSet();\r\n\r\n    let recurse = (n) => {\r\n      if (typeof n === \"string\") {\r\n        dohash(strhash(n));\r\n      } else if (typeof n === \"undefined\" || n === null) {\r\n        dohash(0);\r\n      } else if (typeof n === \"object\") {\r\n        if (n === undefined) {\r\n          //n[SmartConsoleTag] = tagid++;\r\n        }\r\n\r\n        if (visit.has(n)) {\r\n          return;\r\n        }\r\n\r\n        visit.add(n); //[SmartConsoleTag]);\r\n\r\n        let keys = getAllKeys(n);\r\n\r\n        for (let k of keys) {\r\n          let v;\r\n\r\n          if (typeof k !== \"string\") {\r\n            continue;\r\n          }\r\n\r\n          try {\r\n            v = n[k];\r\n          } catch (error) {\r\n            continue;\r\n          }\r\n\r\n          recurse(v);\r\n        }\r\n      } else if (typeof n === \"function\") {\r\n        dohash(strhash(\"\" + n.name));\r\n      }\r\n    };\r\n\r\n    //let str = \"\";\r\n\r\n    for (let i = 0; i < args.length; i++) {\r\n      recurse(args[i]);\r\n      //str += args[i] + \" \";\r\n    }\r\n\r\n    //window.console.log(\"HASH\", sum, str);\r\n    return sum;\r\n  }\r\n\r\n  clearCache() {\r\n    this._data_length = 0;\r\n    this._data = {};\r\n    return this;\r\n  }\r\n\r\n  _getData(args) {\r\n    let key = this.hash(args);\r\n\r\n    if (!(key in this._data)) {\r\n      if (this._data_length > this.maxCache) {\r\n        this.clearCache();\r\n      }\r\n\r\n      this._data[key] = {\r\n        time : 0,\r\n        count: 0\r\n      };\r\n\r\n      this._data_length++;\r\n    }\r\n\r\n    return this._data[key];\r\n  }\r\n\r\n  _check(args) {\r\n    if (this.timeIntervalAll > 0 && time_ms() - this.last2 < this.timeIntervalAll) {\r\n      return false;\r\n    }\r\n\r\n    this.last2 = time_ms();\r\n\r\n    return true;\r\n    /*\r\n    this.last2 = time_ms();\r\n\r\n    let d = this._getData(args);\r\n    let last = this.last;\r\n\r\n    this.last = d;\r\n\r\n    if (d !== last) {\r\n      d.count = 0;\r\n      d.time = time_ms();\r\n      return true;\r\n    }\r\n\r\n    if (time_ms() - d.time > this.timeInterval) {\r\n      d.time = time_ms();\r\n      return true;\r\n    }\r\n\r\n    return false;*/\r\n  }\r\n\r\n  log() {\r\n    if (this._check(arguments)) {\r\n      window.console.log(\"%c\", \"color:\" + this.color, ...arguments);\r\n    }\r\n  }\r\n\r\n  warn() {\r\n    if (this._check(arguments)) {\r\n      window.console.log(\"%c\" + this.name, \"color : \" + this.color, ...arguments);\r\n    }\r\n  }\r\n\r\n  trace() {\r\n    if (this._check(arguments)) {\r\n      window.console.trace(...arguments);\r\n    }\r\n  }\r\n\r\n  error() {\r\n    if (this._check(arguments)) {\r\n      window.console.error(...arguments);\r\n    }\r\n  }\r\n}\r\n\r\nexport class SmartConsole {\r\n  constructor() {\r\n    this.contexts = {};\r\n  }\r\n\r\n  context(name) {\r\n    if (!(name in this.contexts)) {\r\n      this.contexts[name] = new SmartConsoleContext(name, this);\r\n    }\r\n\r\n    return this.contexts[name];\r\n  }\r\n\r\n  log() {\r\n    let c = this.context(\"default\");\r\n    return c.log(...arguments);\r\n  }\r\n\r\n  warn() {\r\n    let c = this.context(\"default\");\r\n    return c.warn(...arguments);\r\n  }\r\n\r\n  trace() {\r\n    let c = this.context(\"default\");\r\n    return c.trace(...arguments);\r\n  }\r\n\r\n  error() {\r\n    let c = this.context(\"default\");\r\n    return c.error(...arguments);\r\n  }\r\n}\r\n\r\nexport const console = new SmartConsole();\r\n\r\nglobalThis.tm = 0.0;\r\n\r\nvar EmptySlot = {};\r\n\r\nexport function getClassParent(cls) {\r\n  let p = cls.prototype;\r\n\r\n  if (p) p = p.__proto__;\r\n  if (p) p = p.constructor\r\n  ;\r\n  return p;\r\n}\r\n\r\n//make global for debugging purposes in console\r\n//window._getClassParent = getClassParent;\r\n\r\nexport function list(iterable) {\r\n  let ret = [];\r\n\r\n  for (let item of iterable) {\r\n    ret.push(item);\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n\r\n/** Count items in list; if searchItem is not undefined then a count\r\n *  of the number of times searchItem occurs will be returned.*/\r\nexport function count(iterable, searchItem=undefined) {\r\n  let count = 0;\r\n\r\n  if (searchItem !== undefined) {\r\n    for (let item of iterable) {\r\n      if (item === searchItem) {\r\n        count++;\r\n      }\r\n    }\r\n  } else {\r\n    for (let item of iterable) {\r\n      count++;\r\n    }\r\n  }\r\n\r\n  return count;\r\n}\r\n\r\n/*\r\n* returns all object keys, including\r\n* inherited ones\r\n* */\r\nexport function getAllKeys(obj) {\r\n  let keys = new Set();\r\n\r\n  if (typeof obj !== \"object\" && typeof obj !== \"function\") {\r\n    throw new Error(\"must pass an object ot getAllKeys; object was: \" + obj);\r\n  }\r\n\r\n  let p;\r\n\r\n  while (p && p !== Object) {\r\n    for (let k in Object.getOwnPropertyDescriptors(obj)) {\r\n      if (k === \"__proto__\")\r\n        continue;\r\n\r\n      keys.add(k);\r\n    }\r\n\r\n    for (let k of Object.getOwnPropertySymbols(obj)) {\r\n      keys.add(k);\r\n    }\r\n\r\n    p = p.__proto__;\r\n  }\r\n\r\n  let cls = obj.constructor;\r\n  if (!cls)\r\n    return keys;\r\n\r\n  while (cls) {\r\n    let proto = cls.prototype;\r\n    if (!proto) {\r\n      cls = getClassParent(cls);\r\n      continue;\r\n    }\r\n\r\n    for (let k in proto) {\r\n      keys.add(k);\r\n    }\r\n\r\n    for (let k in Object.getOwnPropertyDescriptors(proto)) {\r\n      keys.add(k);\r\n    }\r\n\r\n    cls = getClassParent(cls);\r\n  }\r\n\r\n  return keys;\r\n}\r\n\r\n//globalThis._getAllKeys = getAllKeys;\r\n\r\nexport function btoa(buf) {\r\n  if (buf instanceof ArrayBuffer) {\r\n    buf = new Uint8Array(buf);\r\n  }\r\n\r\n  if (typeof buf == \"string\" || buf instanceof String) {\r\n    return window.btoa(buf);\r\n  }\r\n\r\n  var ret = \"\";\r\n  for (var i = 0; i < buf.length; i++) {\r\n    ret += String.fromCharCode(buf[i]);\r\n  }\r\n\r\n  return btoa(ret);\r\n};\r\n\r\nexport function formatNumberUI(val, isInt = false, decimals = 5) {\r\n  if (val === undefined || val === null) {\r\n    val = \"0\";\r\n  } else if (isNaN(val)) {\r\n    val = \"NaN\";\r\n  } else if (val === -Infinity) {\r\n    val = \"-\" + String.fromCharCode(0x221E);\r\n  } else if (val === Infinity) {\r\n    val = \"+\" + String.fromCharCode(0x221E);\r\n  } else if (!isInt) {\r\n    val = val.toFixed(decimals);\r\n  } else {\r\n    val = \"\" + Math.floor(val);\r\n  }\r\n\r\n  return val;\r\n}\r\n\r\n//window.formatNumberUI = formatNumberUI;\r\n\r\nexport function atob(buf) {\r\n  let data = window.atob(buf);\r\n  let ret = [];\r\n\r\n  for (let i = 0; i < data.length; i++) {\r\n    ret.push(data.charCodeAt(i));\r\n  }\r\n\r\n  return new Uint8Array(ret);\r\n}\r\n\r\nexport function time_ms() {\r\n  if (window.performance)\r\n    return window.performance.now();\r\n  else\r\n    return new Date().getMilliseconds();\r\n}\r\n\r\nexport function color2css(c) {\r\n  var ret = c.length == 3 ? \"rgb(\" : \"rgba(\";\r\n\r\n  for (var i = 0; i < 3; i++) {\r\n    if (i > 0)\r\n      ret += \",\";\r\n\r\n    ret += ~~(c[i]*255);\r\n  }\r\n\r\n  if (c.length == 4)\r\n    ret += \",\" + c[3];\r\n  ret += \")\";\r\n\r\n  return ret;\r\n}\r\n\r\nexport function merge(obja, objb) {\r\n  return Object.assign({}, obja, objb);\r\n  /*\r\n  var ret = {};\r\n\r\n  for (var k in obja) {\r\n    ret[k] = obja[k];\r\n  }\r\n\r\n  for (var k in objb) {\r\n    ret[k] = objb[k];\r\n  }\r\n\r\n  return ret;\r\n  //*/\r\n};\r\n\r\nconst debug_cacherings = false;\r\n\r\nif (debug_cacherings) {\r\n  window._cacherings = [];\r\n\r\n  window._clear_all_cacherings = function (kill_all = false) {\r\n    function copy(obj) {\r\n      if (typeof obj.copy === \"function\") {\r\n        return obj.copy();\r\n      } else if (obj.constructor === Object) {\r\n        let ret = {};\r\n\r\n        for (let k of Reflect.ownKeys(obj)) {\r\n          let v;\r\n\r\n          try {\r\n            v = obj[k];\r\n          } catch (error) {\r\n            continue;\r\n          }\r\n\r\n          if (typeof v !== \"object\") {\r\n            ret[k] = v;\r\n          } else {\r\n            ret[k] = copy(v);\r\n          }\r\n        }\r\n\r\n        return ret;\r\n      } else {\r\n        return new obj.constructor();\r\n      }\r\n    }\r\n\r\n    for (let ch of window._cacherings) {\r\n      let obj = ch[0];\r\n      let len = ch.length;\r\n\r\n      ch.length = 0;\r\n      ch.cur = 0;\r\n\r\n      if (kill_all) {\r\n        continue;\r\n      }\r\n\r\n      for (let i = 0; i < len; i++) {\r\n        ch.push(copy(obj));\r\n      }\r\n    }\r\n  }\r\n\r\n  window._nonvector_cacherings = function () {\r\n    for (let ch of window._cacherings) {\r\n      if (ch.length === 0) {\r\n        continue;\r\n      }\r\n\r\n      let name = ch[0].constructor.name;\r\n      let ok = !name.startsWith(\"Vector\") && !name.startsWith(\"Quat\");\r\n      ok = ok && !name.startsWith(\"TriEditor\");\r\n      ok = ok && !name.startsWith(\"QuadEditor\");\r\n      ok = ok && !name.startsWith(\"PointEditor\");\r\n      ok = ok && !name.startsWith(\"LineEditor\");\r\n\r\n      if (ok) {\r\n        console.log(name, ch);\r\n      }\r\n    }\r\n  }\r\n\r\n  window._stale_cacherings = function () {\r\n    let ret = _cacherings.concat([]);\r\n\r\n    ret.sort((a, b) => a.gen - b.gen);\r\n    return ret;\r\n  }\r\n}\r\n\r\nexport class cachering extends Array {\r\n  constructor(func, size, isprivate = false) {\r\n    super()\r\n\r\n    this.private = isprivate;\r\n    this.cur = 0;\r\n\r\n    if (!isprivate && debug_cacherings) {\r\n      this.gen = 0;\r\n      window._cacherings.push(this);\r\n    }\r\n\r\n    for (var i = 0; i < size; i++) {\r\n      this.push(func());\r\n    }\r\n  }\r\n\r\n  static fromConstructor(cls, size, isprivate = false) {\r\n    var func = function () {\r\n      return new cls();\r\n    }\r\n\r\n    return new cachering(func, size, isprivate);\r\n  }\r\n\r\n  next() {\r\n    if (debug_cacherings) {\r\n      this.gen++;\r\n    }\r\n\r\n    let ret = this[this.cur];\r\n    this.cur = (this.cur + 1)%this.length;\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nexport class SetIter {\r\n  constructor(set) {\r\n    this.set = set;\r\n    this.i = 0;\r\n    this.ret = {done: false, value: undefined};\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return this;\r\n  }\r\n\r\n  next() {\r\n    var ret = this.ret;\r\n\r\n    while (this.i < this.set.items.length && this.set.items[this.i] === EmptySlot) {\r\n      this.i++;\r\n    }\r\n\r\n    if (this.i >= this.set.items.length) {\r\n      ret.done = true;\r\n      ret.value = undefined;\r\n\r\n      return ret;\r\n    }\r\n\r\n\r\n    ret.value = this.set.items[this.i++];\r\n    return ret;\r\n  }\r\n}\r\n\r\n/**\r\n Set\r\n\r\n Stores objects in a set; each object is converted to a value via\r\n a [Symbol.keystr] method, and if that value already exists in the set\r\n then the object is not added.\r\n\r\n\r\n * */\r\nexport class set {\r\n  constructor(input) {\r\n    this.items = [];\r\n    this.keys = {};\r\n    this.freelist = [];\r\n\r\n    this.length = 0;\r\n\r\n    if (typeof input == \"string\") {\r\n      input = new String(input);\r\n    }\r\n\r\n    if (input !== undefined) {\r\n      if (Symbol.iterator in input) {\r\n        for (var item of input) {\r\n          this.add(item);\r\n        }\r\n      } else if (\"forEach\" in input) {\r\n        input.forEach(function (item) {\r\n          this.add(item);\r\n        }, this);\r\n      } else if (input instanceof Array) {\r\n        for (var i = 0; i < input.length; i++) {\r\n          this.add(input[i]);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  get size() {\r\n    return this.length;\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return new SetIter(this);\r\n  }\r\n\r\n  equals(setb) {\r\n    for (let item of this) {\r\n      if (!setb.has(item)) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    for (let item of setb) {\r\n      if (!this.has(item)) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  clear() {\r\n    this.items.length = 0;\r\n    this.keys = {};\r\n    this.freelist.length = 0;\r\n    this.length = 0;\r\n\r\n    return this;\r\n  }\r\n\r\n  filter(f, thisvar) {\r\n    let i = 0;\r\n    let ret = new set();\r\n\r\n    for (let item of this) {\r\n      if (f.call(thisvar, item, i++, this)) {\r\n        ret.add(item);\r\n      }\r\n    }\r\n\r\n    return ret;\r\n\r\n  }\r\n\r\n  map(f, thisvar) {\r\n    let ret = new set();\r\n\r\n    let i = 0;\r\n\r\n    for (let item of this) {\r\n      ret.add(f.call(thisvar, item, i++, this));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  reduce(f, initial) {\r\n    if (initial === undefined) {\r\n      for (let item of this) {\r\n        initial = item;\r\n        break;\r\n      }\r\n    }\r\n\r\n    let i = 0;\r\n    for (let item of this) {\r\n      initial = f(initial, item, i++, this);\r\n    }\r\n\r\n    return initial;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new set();\r\n    for (let item of this) {\r\n      ret.add(item);\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  add(item) {\r\n    var key = item[Symbol.keystr]();\r\n\r\n    if (key in this.keys) return;\r\n\r\n    if (this.freelist.length > 0) {\r\n      var i = this.freelist.pop();\r\n\r\n      this.keys[key] = i;\r\n      this.items[i] = item;\r\n    } else {\r\n      var i = this.items.length;\r\n\r\n      this.keys[key] = i;\r\n      this.items.push(item);\r\n    }\r\n\r\n    this.length++;\r\n  }\r\n\r\n  delete(item, ignore_existence = true) {\r\n    this.remove(item, ignore_existence);\r\n  }\r\n\r\n  remove(item, ignore_existence) {\r\n    var key = item[Symbol.keystr]();\r\n\r\n    if (!(key in this.keys)) {\r\n      if (!ignore_existence) {\r\n        console.warn(\"Warning, item\", item, \"is not in set\");\r\n      }\r\n      return;\r\n    }\r\n\r\n    var i = this.keys[key];\r\n    this.freelist.push(i);\r\n    this.items[i] = EmptySlot;\r\n\r\n    delete this.keys[key];\r\n\r\n    this.length--;\r\n  }\r\n\r\n  has(item) {\r\n    return item[Symbol.keystr]() in this.keys;\r\n  }\r\n\r\n  forEach(func, thisvar) {\r\n    for (var i = 0; i < this.items.length; i++) {\r\n      var item = this.items[i];\r\n\r\n      if (item === EmptySlot)\r\n        continue;\r\n\r\n      thisvar !== undefined ? func.call(thisvar, item) : func(item);\r\n    }\r\n  }\r\n}\r\n\r\nexport class HashIter {\r\n  constructor(hash) {\r\n    this.hash = hash;\r\n    this.i = 0;\r\n    this.ret = {done: false, value: undefined};\r\n  }\r\n\r\n  next() {\r\n    var items = this.hash._items;\r\n\r\n    if (this.i >= items.length) {\r\n      this.ret.done = true;\r\n      this.ret.value = undefined;\r\n\r\n      return this.ret;\r\n    }\r\n\r\n    do {\r\n      this.i += 2;\r\n    } while (this.i < items.length && items[i] === _hash_null);\r\n\r\n    return this.ret;\r\n  }\r\n}\r\n\r\nvar _hash_null = {};\r\n\r\nexport class hashtable {\r\n  constructor() {\r\n    this._items = [];\r\n    this._keys = {};\r\n    this.length = 0;\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return new HashIter(this);\r\n  }\r\n\r\n  set(key, val) {\r\n    var key2 = key[Symbol.keystr]();\r\n\r\n    var i;\r\n    if (!(key2 in this._keys)) {\r\n      i = this._items.length;\r\n\r\n      try {\r\n        this._items.push(0);\r\n        this._items.push(0);\r\n      } catch (error) {\r\n        console.log(\":::\", this._items.length, key, key2, val)\r\n        throw error;\r\n      }\r\n\r\n      this._keys[key2] = i;\r\n      this.length++;\r\n    } else {\r\n      i = this._keys[key2];\r\n    }\r\n\r\n    this._items[i] = key;\r\n    this._items[i + 1] = val;\r\n  }\r\n\r\n  remove(key) {\r\n    var key2 = key[Symbol.keystr]();\r\n\r\n    if (!(key2 in this._keys)) {\r\n      console.warn(\"Warning, key not in hashtable:\", key, key2);\r\n      return;\r\n    }\r\n\r\n    var i = this._keys[key2];\r\n\r\n    this._items[i] = _hash_null;\r\n    this._items[i + 1] = _hash_null;\r\n\r\n    delete this._keys[key2];\r\n    this.length--;\r\n  }\r\n\r\n  has(key) {\r\n    var key2 = key[Symbol.keystr]();\r\n\r\n    return key2 in this._keys;\r\n  }\r\n\r\n  get(key) {\r\n    var key2 = key[Symbol.keystr]();\r\n\r\n    if (!(key2 in this._keys)) {\r\n      console.warn(\"Warning, item not in hash\", key, key2);\r\n      return undefined;\r\n    }\r\n\r\n    return this._items[this._keys[key2] + 1];\r\n  }\r\n\r\n  add(key, val) {\r\n    return this.set(key, val);\r\n  }\r\n\r\n  keys() {\r\n    var ret = [];\r\n\r\n    for (var i = 0; i < this._items.length; i += 2) {\r\n      var key = this._items[i];\r\n\r\n      if (key !== _hash_null) {\r\n        ret.push(key);\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  values() {\r\n    var ret = [];\r\n\r\n    for (var i = 0; i < this._items.length; i += 2) {\r\n      var item = this._items[i + 1];\r\n\r\n      if (item !== _hash_null) {\r\n        ret.push(item);\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  forEach(cb, thisvar) {\r\n    if (thisvar == undefined)\r\n      thisvar = self;\r\n\r\n    for (var k in this._keys) {\r\n      var i = this._keys[k];\r\n\r\n      cb.call(thisvar, k, this._items[i]);\r\n    }\r\n  }\r\n}\r\n\r\nlet IDGenInternalIDGen = 0;\r\n\r\nexport class IDGen {\r\n  constructor() {\r\n    this.__cur = 1;\r\n\r\n    this._debug = false;\r\n    this._internalID = IDGenInternalIDGen++;\r\n  }\r\n\r\n  /*\r\n  get _cur() {\r\n    return this.__cur;\r\n  }\r\n\r\n  set _cur(v) {\r\n    if (this._debug && pollTimer(\"_idgen_debug\", 450)) {\r\n      window.console.warn(\"_cur access\", v);\r\n    }\r\n\r\n    this.__cur = v;\r\n  }\r\n\r\n  // */\r\n\r\n  get cur() {\r\n    return this.__cur;\r\n  }\r\n\r\n  set cur(v) {\r\n    if (isNaN(v) || !isFinite(v)) {\r\n      throw new Error(\"NaN error in util.IDGen\");\r\n    }\r\n\r\n    this.__cur = v;\r\n  }\r\n\r\n  get _cur() {\r\n    return this.cur;\r\n  }\r\n\r\n  set _cur(v) {\r\n    window.console.warn(\"Deprecated use of IDGen._cur\");\r\n    this.cur = v;\r\n  }\r\n\r\n  static fromJSON(obj) {\r\n    let ret = new IDGen();\r\n\r\n    ret.cur = obj.cur === undefined ? obj._cur : obj.cur;\r\n\r\n    return ret;\r\n  }\r\n\r\n  next() {\r\n    return this.cur++;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new IDGen();\r\n    ret.cur = this.cur;\r\n\r\n    return ret;\r\n  }\r\n\r\n  max_cur(id) {\r\n    this.cur = Math.max(this.cur, id + 1);\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      cur: this.cur\r\n    };\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n  }\r\n}\r\n\r\nIDGen.STRUCT = `\r\nIDGen {\r\n  cur : int;\r\n}\r\n`;\r\nnstructjs.register(IDGen);\r\n\r\n\r\nfunction get_callstack(err) {\r\n  return (\"\"+err.stack).split(\"\\n\");\r\n}\r\n\r\nexport function print_stack(err) {\r\n  if (!err) {\r\n    window.console.trace();\r\n  } else {\r\n    window.console.log(err.stack);\r\n  }\r\n}\r\n\r\n\r\nglobalThis.get_callstack = get_callstack;\r\nglobalThis.print_stack = print_stack;\r\n\r\nexport function fetch_file(path) {\r\n  var url = location.origin + \"/\" + path\r\n\r\n  var req = new XMLHttpRequest(\r\n  );\r\n\r\n  return new Promise(function (accept, reject) {\r\n    req.open(\"GET\", url)\r\n    req.onreadystatechange = function (e) {\r\n      if (req.status == 200 && req.readyState == 4) {\r\n        accept(req.response);\r\n      } else if (req.status >= 400) {\r\n        reject(req.status, req.statusText);\r\n      }\r\n    }\r\n    req.send();\r\n  });\r\n}\r\n\r\n//from:https://en.wikipedia.org/wiki/Mersenne_Twister\r\nfunction _int32(x) {\r\n  // Get the 31 least significant bits.\r\n  return ~~(((1<<30) - 1) & (~~x))\r\n}\r\n\r\nexport class MersenneRandom {\r\n  constructor(seed) {\r\n    // Initialize the index to 0\r\n    this.index = 624;\r\n    this.mt = new Uint32Array(624);\r\n\r\n    this.seed(seed);\r\n  }\r\n\r\n  random() {\r\n    return this.extract_number()/(1<<30);\r\n  }\r\n\r\n  /** normal-ish distribution */\r\n  nrandom(n=3) {\r\n    let ret = 0.0;\r\n\r\n    for (let i=0; i<n; i++) {\r\n      ret += this.random();\r\n    }\r\n\r\n    return ret / n;\r\n  }\r\n\r\n  seed(seed) {\r\n    seed = ~~(seed*8192);\r\n\r\n    // Initialize the index to 0\r\n    this.index = 624;\r\n    this.mt.fill(0, 0, this.mt.length);\r\n\r\n    this.mt[0] = seed;  // Initialize the initial state to the seed\r\n\r\n    for (var i = 1; i < 624; i++) {\r\n      this.mt[i] = _int32(\r\n        1812433253*(this.mt[i - 1] ^ this.mt[i - 1]>>30) + i);\r\n    }\r\n  }\r\n\r\n  extract_number() {\r\n    if (this.index >= 624)\r\n      this.twist();\r\n\r\n    var y = this.mt[this.index];\r\n\r\n    // Right shift by 11 bits\r\n    y = y ^ y>>11;\r\n    // Shift y left by 7 and take the bitwise and of 2636928640\r\n    y = y ^ y<<7 & 2636928640;\r\n    // Shift y left by 15 and take the bitwise and of y and 4022730752\r\n    y = y ^ y<<15 & 4022730752;\r\n    // Right shift by 18 bits\r\n    y = y ^ y>>18;\r\n\r\n    this.index = this.index + 1;\r\n\r\n    return _int32(y);\r\n  }\r\n\r\n  twist() {\r\n    for (var i = 0; i < 624; i++) {\r\n      // Get the most significant bit and add it to the less significant\r\n      // bits of the next number\r\n      var y = _int32((this.mt[i] & 0x80000000) +\r\n        (this.mt[(i + 1)%624] & 0x7fffffff));\r\n      this.mt[i] = this.mt[(i + 397)%624] ^ y>>1;\r\n\r\n      if (y%2 != 0)\r\n        this.mt[i] = this.mt[i] ^ 0x9908b0df;\r\n    }\r\n\r\n    this.index = 0;\r\n  }\r\n}\r\n\r\nvar _mt = new MersenneRandom(0);\r\n\r\nexport function random() {\r\n  return _mt.extract_number()/(1<<30);\r\n}\r\n\r\nexport function seed(n) {\r\n//  console.trace(\"seed called\");\r\n  _mt.seed(n);\r\n}\r\n\r\nlet smallstr_hashes = {};\r\n\r\nexport function strhash(str) {\r\n  if (str.length <= 64) {\r\n    let hash = smallstr_hashes[str];\r\n\r\n    if (hash !== undefined) {\r\n      return hash;\r\n    }\r\n  }\r\n\r\n  var hash = 0;\r\n\r\n  for (var i = 0; i < str.length; i++) {\r\n    var ch = str.charCodeAt(i);\r\n\r\n    hash = hash < 0 ? -hash : hash;\r\n\r\n    hash ^= (ch*524287 + 4323543) & ((1<<19) - 1);\r\n  }\r\n\r\n  if (str.length <= 64) {\r\n    smallstr_hashes[str] = hash;\r\n  }\r\n\r\n  return hash;\r\n}\r\n\r\nvar hashsizes = [\r\n  /*2, 5, 11, 19, 37, 67, 127, */223, 383, 653, 1117, 1901, 3251,\r\n                                 5527, 9397, 15991, 27191, 46229, 78593, 133631, 227177, 38619,\r\n                                 656587, 1116209, 1897561, 3225883, 5484019, 9322861, 15848867,\r\n                                 26943089, 45803279, 77865577, 132371489, 225031553\r\n];\r\n\r\nvar FTAKEN = 0, FKEY = 1, FVAL = 2, FTOT = 3;\r\n\r\nexport class FastHash extends Array {\r\n  constructor() {\r\n    super();\r\n\r\n    this.cursize = 0;\r\n    this.size = hashsizes[this.cursize];\r\n    this.used = 0;\r\n\r\n    this.length = this.size*FTOT;\r\n    this.fill(0, 0, this.length);\r\n  }\r\n\r\n  resize(size) {\r\n    var table = this.slice(0, this.length);\r\n\r\n    this.length = size*FTOT;\r\n    this.size = size;\r\n    this.fill(0, 0, this.length);\r\n\r\n    for (var i = 0; i < table.length; i += FTOT) {\r\n      if (!table[i + FTAKEN]) continue;\r\n\r\n      var key = table[i + FKEY], val = table[i + FVAL];\r\n      this.set(key, val);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  get(key) {\r\n    var hash = typeof key == \"string\" ? strhash(key) : key;\r\n    hash = typeof hash == \"object\" ? hash.valueOf() : hash;\r\n\r\n    var probe = 0;\r\n\r\n    var h = (hash + probe)%this.size;\r\n\r\n    var _i = 0;\r\n    while (_i++ < 50000 && this[h*FTOT + FTAKEN]) {\r\n      if (this[h*FTOT + FKEY] == key) {\r\n        return this[h*FTOT + FVAL];\r\n      }\r\n\r\n      probe = (probe + 1)*2;\r\n      h = (hash + probe)%this.size;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  has(key) {\r\n    var hash = typeof key == \"string\" ? strhash(key) : key;\r\n    hash = typeof hash == \"object\" ? hash.valueOf() : hash;\r\n\r\n    var probe = 0;\r\n\r\n    var h = (hash + probe)%this.size;\r\n\r\n    var _i = 0;\r\n    while (_i++ < 50000 && this[h*FTOT + FTAKEN]) {\r\n      if (this[h*FTOT + FKEY] == key) {\r\n        return true;\r\n      }\r\n\r\n      probe = (probe + 1)*2;\r\n      h = (hash + probe)%this.size;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  set(key, val) {\r\n    var hash = typeof key == \"string\" ? strhash(key) : key;\r\n    hash = typeof hash == \"object\" ? hash.valueOf() : hash;\r\n\r\n    if (this.used > this.size/3) {\r\n      this.resize(hashsizes[this.cursize++]);\r\n    }\r\n\r\n    var probe = 0;\r\n\r\n    var h = (hash + probe)%this.size;\r\n\r\n    var _i = 0;\r\n    while (_i++ < 50000 && this[h*FTOT + FTAKEN]) {\r\n      if (this[h*FTOT + FKEY] == key) {\r\n        this[h*FTOT + FVAL] = val;\r\n        return;\r\n      }\r\n\r\n      probe = (probe + 1)*2;\r\n      h = (hash + probe)%this.size;\r\n    }\r\n\r\n    this[h*FTOT + FTAKEN] = 1;\r\n    this[h*FTOT + FKEY] = key;\r\n    this[h*FTOT + FVAL] = val;\r\n\r\n    this.used++;\r\n  }\r\n}\r\n\r\nexport function test_fasthash() {\r\n  var h = new FastHash();\r\n  console.log(\"bleh hash:\", strhash(\"bleh\"));\r\n\r\n  h.set(\"bleh\", 1);\r\n  h.set(\"bleh\", 2);\r\n  h.set(\"bleh\", 3);\r\n\r\n  console.log(h);\r\n\r\n  return h;\r\n};\r\n\r\nexport class ImageReader {\r\n  load_image() {\r\n    let input = document.createElement(\"input\");\r\n    input.type = \"file\";\r\n\r\n    let doaccept;\r\n\r\n    let promise = new Promise((accept, reject) => {\r\n      doaccept = accept;\r\n    });\r\n\r\n    input.addEventListener(\"change\", function (e) {\r\n      let files = this.files;\r\n      console.log(\"got file\", e, files)\r\n\r\n      if (files.length == 0) return;\r\n\r\n      var reader = new FileReader();\r\n      var this2 = this;\r\n\r\n      reader.onload = (e) => {\r\n        let data = e.target.result;\r\n        let image = new Image();\r\n\r\n        image.src = data;\r\n        image.onload = (e) => {\r\n          console.log(\"got image\", image.width, image.height);\r\n\r\n          let canvas = document.createElement(\"canvas\");\r\n          let g = canvas.getContext(\"2d\");\r\n\r\n          canvas.width = image.width;\r\n          canvas.height = image.height;\r\n\r\n          g.drawImage(image, 0, 0);\r\n          let idata = g.getImageData(0, 0, image.width, image.height);\r\n\r\n          doaccept(idata);\r\n        }\r\n      };\r\n\r\n      reader.readAsDataURL(files[0]);\r\n    });\r\n\r\n    input.click();\r\n    return promise;\r\n  }\r\n\r\n  example() {\r\n    this.load_image().then((idata) => {\r\n      console.log(idata);\r\n    });\r\n  }\r\n};\r\n\r\nlet digestcache;\r\n\r\n/** NOT CRYPTOGRAPHIC */\r\nexport class HashDigest {\r\n  constructor() {\r\n    this.i = 0;\r\n    this.hash = 0;\r\n  }\r\n\r\n  static cachedDigest() {\r\n    return digestcache.next().reset();\r\n  }\r\n\r\n  reset() {\r\n    this.i = 0;\r\n    this.hash = 0;\r\n\r\n    return this;\r\n  }\r\n\r\n  get() {\r\n    return this.hash;\r\n  }\r\n\r\n  add(v) {\r\n    if (typeof v === \"string\") {\r\n      v = strhash(v);\r\n    }\r\n\r\n    if (typeof v === \"object\" && Array.isArray(v)) {\r\n      for (let i=0; i<v.length; i++) {\r\n        this.add(v[i]);\r\n      }\r\n\r\n      return this;\r\n    }\r\n\r\n    if (v >= -5 && v <= 5) {\r\n      v *= 32;\r\n    }\r\n\r\n    //try to deal with subdecimal floating point error\r\n\r\n    let f = Math.fract(v)*(1024*512);\r\n    f = (~~f)/(1024*512);\r\n    v = Math.floor(v) + f;\r\n\r\n    //glibc linear congruel generator\r\n    this.i = ((this.i + (~~v))*1103515245 + 12345) & ((1<<29) - 1);\r\n    //according to wikipedia only the top 16 bits are random\r\n    //this.i = this.i>>16;\r\n\r\n    let v2 = (v*1024*1024) & ((1<<29) - 1)\r\n    v = v | v2;\r\n\r\n    v = ~~v;\r\n\r\n    this.hash ^= v ^ this.i;\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nwindow._test_hash2 = () => {\r\n  let h = new HashDigest();\r\n\r\n  let tests = [\r\n    [0, 0, 0, 0],\r\n    [0, 0, 0],\r\n    [0, 0],\r\n    [0],\r\n    [1],\r\n    [2],\r\n    [3],\r\n    [strhash(\"yay\")],\r\n    [strhash(\"yay\"), strhash(\"yay\")],\r\n    [strhash(\"yay\"), strhash(\"yay\"), strhash(\"yay\")]\r\n  ]\r\n\r\n  for (let test of tests) {\r\n    let h = new HashDigest();\r\n    for (let f of test) {\r\n      h.add(f);\r\n    }\r\n\r\n    window.console.log(h.get());\r\n  }\r\n  for (let i = 0; i < 50; i++) {\r\n    h.add(0);\r\n    //window.console.log(h.i/((1<<30)-1), h.hash);\r\n  }\r\n}\r\n\r\ndigestcache = cachering.fromConstructor(HashDigest, 512);\r\n\r\n//globalThis._HashDigest = HashDigest;\r\n\r\nexport function hashjoin(hash, val) {\r\n  let sum = 0;\r\n  let mul = (1<<19) - 1, off = (1<<27) - 1;\r\n  let i = 0;\r\n\r\n  h = (h*mul + off + i*mul*0.25) & mul;\r\n}\r\n\r\nlet NullItem = {};\r\n\r\nexport class MapIter {\r\n  constructor(ownermap) {\r\n    this.ret = {done: true, value: undefined};\r\n    this.value = new Array(2);\r\n    this.i = 0;\r\n    this.map = ownermap;\r\n    this.done = true;\r\n  }\r\n\r\n  finish() {\r\n    if (!this.done) {\r\n      this.done = true;\r\n      this.map.itercur--;\r\n    }\r\n  }\r\n\r\n  next() {\r\n    let ret = this.ret;\r\n    let i = this.i;\r\n    let map = this.map, list = map._list;\r\n    //window.console.log(this)\r\n\r\n    while (i < list.length && list[i] === NullItem) {\r\n      i += 2;\r\n    }\r\n\r\n    //window.console.log(\"  --\", i, list[i], list[i+1]);\r\n\r\n    if (i >= list.length) {\r\n      ret.done = true;\r\n      ret.value = undefined;\r\n\r\n      this.finish();\r\n      return ret;\r\n    }\r\n\r\n    this.i = i + 2;\r\n\r\n    ret.value = this.value;\r\n    ret.value[0] = list[i];\r\n    ret.value[1] = list[i + 1];\r\n    ret.done = false;\r\n\r\n    return ret;\r\n  }\r\n\r\n  return() {\r\n    this.finish();\r\n\r\n    return this.ret;\r\n  }\r\n\r\n  reset() {\r\n    this.i = 0;\r\n    this.value[0] = undefined;\r\n    this.value[1] = undefined;\r\n    this.done = false;\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nexport class map {\r\n  constructor() {\r\n    this._items = {};\r\n    this._list = [];\r\n\r\n    this.size = 0;\r\n\r\n    this.iterstack = new Array(8);\r\n    this.itercur = 0;\r\n    for (let i = 0; i < this.iterstack.length; i++) {\r\n      this.iterstack[i] = new MapIter(this);\r\n    }\r\n\r\n    this.freelist = [];\r\n  }\r\n\r\n  has(key) {\r\n    return key[Symbol.keystr]() in this._items;\r\n  }\r\n\r\n  set(key, v) {\r\n    let k = key[Symbol.keystr]();\r\n\r\n    let i = this._items[k];\r\n\r\n    if (i === undefined) {\r\n      if (this.freelist.length > 0) {\r\n        i = this.freelist.pop();\r\n      } else {\r\n        i = this._list.length;\r\n        this._list.length += 2;\r\n      }\r\n\r\n      this.size++;\r\n    }\r\n\r\n    this._list[i] = key;\r\n    this._list[i + 1] = v;\r\n\r\n    this._items[k] = i;\r\n  }\r\n\r\n  keys() {\r\n    let this2 = this;\r\n    return (function* () {\r\n      for (let [key, val] of this2) {\r\n        yield key;\r\n      }\r\n    })()\r\n  }\r\n\r\n  values() {\r\n    let this2 = this;\r\n    return (function* () {\r\n      for (let [key, val] of this2) {\r\n        yield val;\r\n      }\r\n    })()\r\n  }\r\n\r\n  get(k) {\r\n    k = k[Symbol.keystr]();\r\n\r\n    let i = this._items[k];\r\n    if (i !== undefined) {\r\n      return this._list[i + 1];\r\n    }\r\n  }\r\n\r\n  delete(k) {\r\n    k = k[Symbol.keystr]();\r\n\r\n    if (!(k in this._items)) {\r\n      return false;\r\n    }\r\n\r\n    let i = this._items[k];\r\n\r\n    this.freelist.push(i);\r\n\r\n    this._list[i] = NullItem;\r\n    this._list[i + 1] = NullItem;\r\n\r\n    delete this._items[k];\r\n    this.size--;\r\n\r\n    return true;\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    let ret = this.iterstack[this.itercur].reset();\r\n    this.itercur++;\r\n\r\n    if (this.itercur === this.iterstack.length) {\r\n      this.iterstack.push(new MapIter(this));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n}\r\n\r\nglobalThis._test_map = function () {\r\n  let m = new map();\r\n\r\n  m.set(\"1\", 2);\r\n  m.set(11, 3);\r\n  m.set(\"5\", 4);\r\n  m.set(\"3\", 5);\r\n  m.set(\"3\", 6);\r\n  m.delete(\"3\");\r\n\r\n  for (let [key, item] of m) {\r\n    for (let [key2, item2] of m) {\r\n      window.console.log(key, item, key2, item2);\r\n    }\r\n    break;\r\n  }\r\n\r\n  console.log(\"itercur\", m.itercur);\r\n\r\n  return m;\r\n}\r\n\r\nfunction validateId(id) {\r\n  let bad = typeof id !== \"number\";\r\n  bad = bad || id !== ~~id;\r\n  bad = bad || isNaN(id);\r\n\r\n  if (bad) {\r\n    throw new Error(\"bad number \" + id);\r\n  }\r\n\r\n  return bad;\r\n}\r\n\r\nlet UndefinedTag = {};\r\n\r\nexport class IDMap extends Array {\r\n  constructor() {\r\n    super();\r\n\r\n    this._keys = new Set();\r\n    this.size = 0;\r\n  }\r\n\r\n  has(id) {\r\n    validateId(id);\r\n\r\n    if (id < 0 || id >= this.length) {\r\n      return false;\r\n    }\r\n\r\n    return this[id] !== undefined;\r\n  }\r\n\r\n  set(id, val) {\r\n    validateId(id);\r\n\r\n    if (id < 0) {\r\n      console.warn(\"got -1 id in IDMap\");\r\n      return;\r\n    }\r\n\r\n    if (id >= this.length) {\r\n      this.length = id + 1;\r\n    }\r\n\r\n    if (val === undefined) {\r\n      val = UndefinedTag;\r\n    }\r\n\r\n    let ret = false;\r\n\r\n    if (this[id] === undefined) {\r\n      this.size++;\r\n      this._keys.add(id);\r\n      ret = true;\r\n    }\r\n\r\n    this[id] = val;\r\n    return ret;\r\n  }\r\n\r\n  /* we allow -1, which always returns undefined*/\r\n  get(id) {\r\n    validateId(id);\r\n\r\n    if (id === -1) {\r\n      return undefined;\r\n    } else if (id < 0) {\r\n      console.warn(\"id was negative\");\r\n      return undefined;\r\n    }\r\n\r\n    let ret = id < this.length ? this[id] : undefined;\r\n    ret = ret === UndefinedTag ? undefined : ret;\r\n\r\n    return ret;\r\n  }\r\n\r\n  delete(id) {\r\n    if (!this.has(id)) {\r\n      return false;\r\n    }\r\n\r\n    this._keys.remove(id);\r\n    this[id] = undefined;\r\n    this.size--;\r\n\r\n    return true;\r\n  }\r\n\r\n  keys() {\r\n    let this2 = this;\r\n    return (function* () {\r\n      for (let id of this2._keys) {\r\n        yield id;\r\n      }\r\n    })();\r\n  }\r\n\r\n  values() {\r\n    let this2 = this;\r\n    return (function* () {\r\n      for (let id of this2._keys) {\r\n        yield this2[id];\r\n      }\r\n    })();\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    let this2 = this;\r\n    let iteritem = [0, 0];\r\n\r\n    return (function* () {\r\n      for (let id of this2._keys) {\r\n        iteritem[0] = id;\r\n        iteritem[1] = this2[id];\r\n\r\n        if (iteritem[1] === UndefinedTag) {\r\n          iteritem[1] = undefined;\r\n        }\r\n\r\n        yield iteritem;\r\n      }\r\n    })();\r\n  }\r\n}\r\n\r\nglobalThis._test_idmap = function () {\r\n  let map = new IDMap();\r\n\r\n  for (let i = 0; i < 5; i++) {\r\n    let id = ~~(Math.random()*55);\r\n\r\n    map.set(id, \"yay\" + i);\r\n  }\r\n\r\n  for (let [key, val] of map) {\r\n    window.console.log(key, val, map.has(key), map.get(key));\r\n  }\r\n\r\n  return map;\r\n}\r\n\r\nlet HW = 0, HELEM = 1, HTOT = 2;\r\n\r\nfunction heaplog() {\r\n  //window.console.log(...arguments);\r\n}\r\n\r\nexport class MinHeapQueue {\r\n  constructor(iter, iterw = iter) {\r\n    this.heap = [];\r\n    this.freelist = [];\r\n    this.length = 0;\r\n    this.end = 0;\r\n\r\n    if (iter) {\r\n      let witer = iterw[Symbol.iterator]();\r\n\r\n      for (let item of iter) {\r\n        let w = witer.next().value;\r\n        this.push(item, w);\r\n      }\r\n    }\r\n  }\r\n\r\n  push(e, w) {\r\n    if (typeof w !== \"number\") {\r\n      throw new Error(\"w must be a number\");\r\n    }\r\n\r\n    if (isNaN(w)) {\r\n      throw new Error(\"NaN\");\r\n    }\r\n\r\n    this.length++;\r\n    let depth = Math.ceil(Math.log(this.length)/Math.log(2.0));\r\n    let tot = Math.pow(2, depth) + 1;\r\n\r\n    heaplog(depth, tot);\r\n\r\n    if (this.heap.length < tot*HTOT) {\r\n      let start = this.heap.length/HTOT;\r\n\r\n      for (let i = start; i < tot; i++) {\r\n        this.freelist.push(i*HTOT);\r\n      }\r\n    }\r\n\r\n    let heap = this.heap;\r\n    heap.length = tot*HTOT;\r\n\r\n    let n = this.freelist.pop();\r\n\r\n    heaplog(\"freelist\", this.freelist);\r\n    this.end = Math.max(this.end, n);\r\n\r\n    heap[n] = w;\r\n    heap[n + 1] = e;\r\n\r\n    while (n > 0) {\r\n      n /= HTOT;\r\n\r\n      let p = (n - 1)>>1;\r\n      n *= HTOT;\r\n      p *= HTOT;\r\n\r\n      if (heap[p] === undefined || heap[p] > w) {\r\n        if (n === this.end) {\r\n          this.end = p;\r\n        }\r\n\r\n        heap[n] = heap[p];\r\n        heap[n + 1] = heap[p + 1];\r\n\r\n        heap[p] = w;\r\n        heap[p + 1] = e;\r\n\r\n        n = p;\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  pop() {\r\n    if (this.length === 0) {\r\n      return undefined;\r\n      //throw new Error(\"heap is empty\");\r\n    }\r\n\r\n    let heap = this.heap;\r\n\r\n    if (this.end === 0) {\r\n      let ret = heap[1];\r\n      this.freelist.push(0);\r\n      heap[0] = undefined;\r\n\r\n      this.length = 0;\r\n\r\n      return ret;\r\n    }\r\n\r\n    let ret = heap[1];\r\n\r\n    let end = this.end;\r\n\r\n    function swap(n1, n2) {\r\n      let t = heap[n1];\r\n      heap[n1] = heap[n2];\r\n      heap[n2] = t;\r\n\r\n      t = heap[n1 + 1];\r\n      heap[n1 + 1] = heap[n2 + 1];\r\n      heap[n2 + 1] = t;\r\n    }\r\n\r\n    heaplog(\"end\", end);\r\n    heaplog(heap.concat([]));\r\n\r\n    heap[0] = heap[end];\r\n    heap[1] = heap[end + 1];\r\n    heap[end] = undefined;\r\n    heap[end + 1] = undefined;\r\n\r\n    let n = 0;\r\n    while (n < heap.length) {\r\n      n /= HTOT;\r\n\r\n      let n1 = n*2 + 1;\r\n      let n2 = n*2 + 2;\r\n\r\n      n1 = ~~(n1*HTOT);\r\n      n2 = ~~(n2*HTOT);\r\n      n = ~~(n*HTOT);\r\n\r\n      heaplog(\"  \", heap[n], heap[n1], heap[n2]);\r\n\r\n      if (heap[n1] !== undefined && heap[n2] !== undefined) {\r\n        if (heap[n1] > heap[n2]) {\r\n          let t = n1;\r\n          n1 = n2;\r\n          n2 = t;\r\n        }\r\n\r\n        if (heap[n] > heap[n1]) {\r\n          swap(n, n1);\r\n          n = n1;\r\n        } else if (heap[n] > heap[n2]) {\r\n          swap(n, n2);\r\n          n = n2;\r\n        } else {\r\n          break;\r\n        }\r\n      } else if (heap[n1] !== undefined) {\r\n        if (heap[n] > heap[n1]) {\r\n          swap(n, n1);\r\n          n = n1;\r\n        } else {\r\n          break;\r\n        }\r\n      } else if (heap[n2] !== undefined) {\r\n        if (heap[n] > heap[n2]) {\r\n          swap(n, n2);\r\n          n = n2;\r\n        } else {\r\n          break;\r\n        }\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n\r\n    this.freelist.push(this.end);\r\n\r\n    heap[this.end] = undefined;\r\n    heap[this.end + 1] = undefined;\r\n\r\n    while (this.end > 0 && heap[this.end] === undefined) {\r\n      this.end -= HTOT;\r\n    }\r\n\r\n    this.length--;\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nglobalThis.testHeapQueue = function (list1 = [1, 8, -3, 11, 33]) {\r\n  let h = new MinHeapQueue(list1);\r\n\r\n  window.console.log(h.heap.concat([]));\r\n\r\n  let list = [];\r\n  let len = h.length;\r\n\r\n  for (let i = 0; i < len; i++) {\r\n    list.push(h.pop());\r\n  }\r\n\r\n  window.console.log(h.heap.concat([]));\r\n\r\n  return list;\r\n}\r\n\r\nexport class Queue {\r\n  constructor(n = 32) {\r\n    n = Math.max(n, 8);\r\n\r\n    this.initialSize = n;\r\n\r\n    this.queue = new Array(n);\r\n    this.a = 0;\r\n    this.b = 0;\r\n    this.length = 0;\r\n  }\r\n\r\n  enqueue(item) {\r\n    let qlen = this.queue.length;\r\n\r\n    let b = this.b;\r\n\r\n    this.queue[b] = item;\r\n    this.b = (this.b + 1)%qlen;\r\n\r\n    if (this.length >= qlen || this.a === this.b) {\r\n      let newsize = qlen<<1;\r\n      let queue = new Array(newsize);\r\n\r\n      for (let i = 0; i < qlen; i++) {\r\n        let i2 = (i + this.a)%qlen;\r\n\r\n        queue[i] = this.queue[i2];\r\n      }\r\n\r\n      this.a = 0;\r\n      this.b = qlen;\r\n      this.queue = queue;\r\n    }\r\n\r\n    this.length++;\r\n  }\r\n\r\n  clear(clearData = true) {\r\n    this.queue.length = this.initialSize;\r\n\r\n    if (clearData) {\r\n      for (let i = 0; i < this.queue.length; i++) {\r\n        this.queue[i] = undefined;\r\n      }\r\n    }\r\n\r\n    this.a = this.b = 0;\r\n    this.length = 0;\r\n\r\n    return this;\r\n  }\r\n\r\n  dequeue() {\r\n    if (this.length === 0) {\r\n      return undefined;\r\n    }\r\n    this.length--;\r\n\r\n    let ret = this.queue[this.a];\r\n\r\n    this.queue[this.a] = undefined;\r\n\r\n    this.a = (this.a + 1)%this.queue.length;\r\n    return ret;\r\n  }\r\n}\r\n\r\nglobalThis._testQueue = function (steps = 15, samples = 15) {\r\n  let queue = new Queue(3);\r\n\r\n  for (let i = 0; i < steps; i++) {\r\n    let list = [];\r\n\r\n    for (let j = 0; j < samples; j++) {\r\n      let item = {f: Math.random()};\r\n      list.push(item);\r\n\r\n      queue.enqueue(item);\r\n    }\r\n\r\n    let j = 0;\r\n\r\n    while (queue.length > 0) {\r\n      let item = queue.dequeue();\r\n\r\n      if (item !== list[j]) {\r\n        console.log(item, list);\r\n        throw new Error(\"got wrong item\", item);\r\n      }\r\n\r\n      j++;\r\n\r\n      if (j > 10000) {\r\n        console.error(\"Infinite loop error\");\r\n        break;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n\r\nexport class ArrayPool {\r\n  constructor() {\r\n    this.pools = new Map();\r\n    this.map = new Array(1024);\r\n  }\r\n\r\n  get(n, clear) {\r\n    let pool;\r\n\r\n    if (n < 1024) {\r\n      pool = this.map[n];\r\n    } else {\r\n      pool = this.pools.get(n);\r\n    }\r\n\r\n    if (!pool) {\r\n      let tot;\r\n\r\n      if (n > 512) {\r\n        tot = 32;\r\n      } else if (n > 256) {\r\n        tot = 64;\r\n      } else if (n > 128) {\r\n        tot = 256;\r\n      } else if (n > 64) {\r\n        tot = 512;\r\n      } else {\r\n        tot = 1024;\r\n      }\r\n\r\n      pool = new cachering(() => new Array(n), tot);\r\n      if (n < 1024) {\r\n        this.map[n] = pool;\r\n      }\r\n      this.pools.set(n, pool);\r\n\r\n      return this.get(n, clear);\r\n    }\r\n\r\n    let ret = pool.next();\r\n    if (ret.length !== n) {\r\n      console.warn(\"Array length was set\", n, ret);\r\n      ret.length = n;\r\n    }\r\n\r\n    if (clear) {\r\n      for (let i = 0; i < n; i++) {\r\n        ret[i] = undefined;\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\n/** jsFiddle-friendly */\r\nexport class DivLogger {\r\n  constructor(elemId, maxLines=16) {\r\n    this.elemId = elemId;\r\n    this.elem = undefined;\r\n    this.lines = new Array();\r\n    this.maxLines = maxLines;\r\n  }\r\n\r\n  push(line) {\r\n    if (this.lines.length > this.maxLines) {\r\n      this.lines.shift();\r\n      this.lines.push(line);\r\n    } else {\r\n      this.lines.push(line);\r\n    }\r\n\r\n    this.update();\r\n  }\r\n\r\n  update() {\r\n    let buf = this.lines.join(`<br>`);\r\n    buf = buf.replace(/[ \\t]/g, \"&nbsp;\");\r\n\r\n    if (!this.elem) {\r\n      this.elem = document.getElementById(this.elemId);\r\n    }\r\n\r\n    this.elem.innerHTML = buf;\r\n  }\r\n\r\n  toString(obj, depth=0) {\r\n    let s = '';\r\n\r\n    let tab = '';\r\n    for (let i=0; i<depth; i++) {\r\n      tab += '$TAB';\r\n    }\r\n\r\n    if (typeof obj === \"symbol\") {\r\n      return `[${obj.description}]`;\r\n    }\r\n\r\n    const DEPTH_LIMIT = 1;\r\n    const CHAR_LIMIT = 100;\r\n\r\n    if (typeof obj === \"object\" && Array.isArray(obj)) {\r\n      s = \"[$NL\";\r\n      for (let i=0; i<obj.length; i++) {\r\n        let v = obj[i];\r\n\r\n        if (depth >= DEPTH_LIMIT) {\r\n          v = typeof v;\r\n        } else {\r\n          v = this.toString(v, depth+1);\r\n        }\r\n\r\n        s += tab + \"$TAB\";\r\n        s += v + (i !== obj.length - 1 ? \",\" : \"\") + \"$NL\";\r\n      }\r\n\r\n      let keys = Reflect.ownKeys(obj);\r\n      for (let i=0; i<keys.length; i++) {\r\n        let k = keys[i];\r\n        let n;\r\n\r\n        let k2 = this.toString(k);\r\n\r\n        if (typeof k !== \"symbol\" && !isNaN(n = parseInt(k))) {\r\n          if (n >= 0 && n < obj.length) {\r\n            continue;\r\n          }\r\n        }\r\n\r\n        let v;\r\n        try {\r\n          v = obj[k];\r\n        } catch (error) {\r\n          v = \"(error)\";\r\n        }\r\n\r\n        s += tab + `$TAB${k2} : ${v}`;\r\n\r\n        if (i < keys.length-1) {\r\n          s += \",\";\r\n        }\r\n\r\n        if (!s.endsWith(\"$NL\") && !s.endsWith(\"\\n\")) {\r\n          s += \"$NL\";\r\n        }\r\n      }\r\n      s += \"$TAB]$NL\";\r\n\r\n      if (s.length < CHAR_LIMIT) {\r\n        s = s.replace(/\\$NL/g, \"\");\r\n        s = s.replace(/(\\$TAB)+/g, \" \");\r\n      } else {\r\n        s = s.replace(/\\$NL/g, \"\\n\");\r\n        s = s.replace(/\\$TAB/g, \"  \");\r\n      }\r\n    } else if (typeof obj === \"object\") {\r\n      s = '{$NL';\r\n\r\n      let keys = Reflect.ownKeys(obj);\r\n      for (let i=0; i<keys.length; i++) {\r\n        let k = keys[i];\r\n        let k2 = this.toString(k);\r\n\r\n        let v;\r\n        try {\r\n          v = obj[k];\r\n        } catch (error) {\r\n          v = '(error)';\r\n        }\r\n\r\n        if (depth >= DEPTH_LIMIT) {\r\n          v = typeof v;\r\n        } else {\r\n          v = this.toString(v, depth+1);\r\n        }\r\n\r\n        s += tab + `$TAB${k2} : ${v}`;\r\n\r\n        if (i < keys.length-1) {\r\n          s += \",\";\r\n        }\r\n\r\n        if (!s.endsWith(\"$NL\") && !s.endsWith(\"\\n\")) {\r\n          s += \"$NL\";\r\n        }\r\n      }\r\n      s += tab + \"}$NL\";\r\n\r\n      if (s.length < CHAR_LIMIT) {\r\n        s = s.replace(/\\$NL/g, \"\");\r\n        s = s.replace(/(\\$TAB)+/g, \" \");\r\n      } else {\r\n        s = s.replace(/\\$NL/g, \"\\n\");\r\n        s = s.replace(/\\$TAB/g, \"  \");\r\n      }\r\n    } else if (typeof obj === \"undefined\") {\r\n      s = 'undefined';\r\n    } else if (typeof obj === \"function\") {\r\n      s = 'function ' + obj.name;\r\n    } else {\r\n      s = \"\" + obj;\r\n    }\r\n\r\n    return s;\r\n  }\r\n}\r\n\r\nexport const PendingTimeoutPromises = new Set();\r\n\r\nexport class TimeoutPromise {\r\n  constructor(callback, timeout=3000, silent=false) {\r\n    if (!callback) {\r\n      return;\r\n    }\r\n\r\n    this.silent = silent;\r\n    this.timeout = timeout;\r\n\r\n    let accept2 = this._accept2.bind(this);\r\n    let reject2 = this._reject2.bind(this);\r\n\r\n    this.time = time_ms();\r\n\r\n    this.rejected = false;\r\n\r\n    this._promise = new Promise((accept, reject) => {\r\n      this._accept = accept;\r\n      this._reject = reject;\r\n\r\n      callback(accept2, reject2);\r\n    });\r\n\r\n    PendingTimeoutPromises.add(this);\r\n  }\r\n\r\n  _accept2(val) {\r\n    if (this.bad) {\r\n      if (!this.silent) {\r\n        this._reject(new Error(\"Timeout\"));\r\n      }\r\n    } else {\r\n      return this._accept(val);\r\n    }\r\n  }\r\n\r\n  static wrapPromise(promise, timeout=3000, callback) {\r\n    let p = new TimeoutPromise();\r\n\r\n    p._promise = promise;\r\n\r\n    p._accept = callback;\r\n    p._reject = function(error) {\r\n      throw error;\r\n    }\r\n\r\n    p.then(val => {\r\n      p._accept2(val);\r\n    }).catch(error => {\r\n      p._reject2(error);\r\n    });\r\n\r\n    return p;\r\n  }\r\n\r\n  _reject2(error) {\r\n    this._reject(error);\r\n  }\r\n\r\n  then(callback) {\r\n    let cb = (val) => {\r\n      let ret = callback(val);\r\n\r\n      if (ret instanceof Promise) {\r\n        ret = TimeoutPromise.wrapPromise(ret, this.timeout, callback);\r\n      }\r\n\r\n      return ret;\r\n    }\r\n\r\n    this._promise.then(cb);\r\n    return this;\r\n  }\r\n\r\n  catch(callback) {\r\n    this._promise.catch(callback);\r\n    return this;\r\n  }\r\n\r\n  finally(callback) {\r\n    this._promise.catch(callback);\r\n    return this;\r\n  }\r\n\r\n  get bad() {\r\n    return time_ms() - this.time > this.timeout;\r\n  }\r\n}\r\n\r\nwindow.setInterval(() => {\r\n  let bad = [];\r\n\r\n  for (let promise of PendingTimeoutPromises) {\r\n    if (promise.bad) {\r\n      bad.push(promise);\r\n    }\r\n  }\r\n\r\n  for (let promise of bad) {\r\n    PendingTimeoutPromises.delete(promise);\r\n  }\r\n\r\n  for (let promise of bad) {\r\n    try {\r\n      promise._reject(new Error(\"Timeout\"));\r\n    } catch (error) {\r\n      print_stack(error);\r\n    }\r\n  }\r\n}, 250);\r\n\r\nimport lzstring from '../extern/lz-string/lz-string.js';\r\n\r\nexport function compress(data) {\r\n  return lzstring.compressToUint8Array(data);\r\n}\r\n\r\nexport function decompress(data) {\r\n  if (data instanceof DataView) {\r\n    data = data.buffer;\r\n  }\r\n\r\n  if (data instanceof ArrayBuffer) {\r\n    data = new Uint8Array(data);\r\n  }\r\n\r\n  return lzstring.decompressFromUint8Array(data);\r\n}\r\n","import * as util from './util.js';\r\nimport nstructjs from './struct.js';\r\n\r\nexport const EulerOrders = {\r\n  XYZ: 0,\r\n  XZY: 1,\r\n  YXZ: 2,\r\n  YZX: 3,\r\n  ZXY: 4,\r\n  ZYX: 5\r\n};\r\n\r\n/**\r\n * @param mode one of 'es', 'commonjs', 'rjs'\r\n */\r\nwindow.makeCompiledVectormathCode = function (mode = \"es\") {\r\n  let s = \"\";\r\n  let es6exports = mode === \"es\";\r\n\r\n  function doExports(name) {\r\n    if (es6exports) {\r\n      return \"export\";\r\n    } else {\r\n      return `var ${name} = exports.${name} =`;\r\n    }\r\n  }\r\n\r\n  let classes = [Vector2, Vector3, Vector4, a];\r\n  let lens = {\r\n    Vector2: 2,\r\n    Vector3: 3,\r\n    Vector4: 4,\r\n    Quat   : 4\r\n  };\r\n\r\n  let modecode = \"\";\r\n\r\n  let nstructjscode = `\r\n  let g = typeof window !== \"undefined\" ? window : \"undefined\";\r\n  \r\n  g = g || (typeof global !== \"undefined\" ? global : \"undefined\");\r\n  g = g || (typeof self !== \"undefined\" ? self : \"undefined\");\r\n  g = g || (typeof globals !== \"undefined\" ? globals : \"undefined\");\r\n\r\n  if (typeof nstructjs === \"undefined\") {\r\n    //add nstructjs stub\r\n    g.nstructjs = {\r\n      register : function() {}\r\n    }\r\n  }\r\n  `\r\n\r\n  if (mode !== \"rjs\") {\r\n    if (mode === \"commonjs\") {\r\n      modecode = `if (typeof module !== \"undefined\" && typeof exports === \"undefined\") {\r\n      if (module.exports === undefined) {\r\n        module.exports = {};\r\n      }\r\n      \r\n      g.exports = module.exports;\r\n    } else if (typeof module === \"undefined\") {\r\n      g.exports = g.vectormath = {};\r\n    }\\n`;\r\n    }\r\n\r\n    s += `{\r\n      ${nstructjscode}\r\n    ${modecode}\r\n  }`;\r\n  }\r\n\r\n  s += `\r\nclass cachering extends Array {\r\n  constructor(func, size) {\r\n    super()\r\n\r\n    this.cur = 0;\r\n\r\n    for (var i=0; i<size; i++) {\r\n      this.push(func());\r\n    }\r\n  }\r\n\r\n  static fromConstructor(cls, size) {\r\n    var func = function() {\r\n      return new cls();\r\n    }\r\n\r\n    return new cachering(func, size);\r\n  }\r\n\r\n  next() {\r\n    var ret = this[this.cur];\r\n    this.cur = (this.cur+1)%this.length;\r\n\r\n    return ret;\r\n  }\r\n}\r\n`;\r\n  s += `\r\n\r\nvar M_SQRT2 = Math.sqrt(2.0);\r\nvar FLT_EPSILON = 2.22e-16;  \r\nvar sin=Math.sin, cos=Math.cos, abs=Math.abs, log=Math.log,\r\n    asin=Math.asin, exp=Math.exp, acos=Math.acos, fract=Math.fract,\r\n    sign=Math.sign, tent=Math.tent, atan2=Math.atan2, atan=Math.atan,\r\n    pow=Math.pow, sqrt=Math.sqrt, floor=Math.floor, ceil=Math.ceil,\r\n    min=Math.min, max=Math.max, PI=Math.PI, E=2.718281828459045;\r\n\r\nvar DOT_NORM_SNAP_LIMIT = 0.00000000001;\r\n\r\n${doExports(\"BaseVector\")} class BaseVector extends Array {\r\n  constructor() {\r\n    super();\r\n    \r\n    this.vec = undefined; //for compatibility with old files\r\n  }\r\n\r\n  copy() {\r\n    return new this.constructor(this);\r\n  }\r\n\r\n  load(data) {\r\n    throw new Error(\"Implement me!\");\r\n  }\r\n  \r\n  vectorLength() {\r\n    return sqrt(this.dot(this));\r\n  }\r\n  \r\n  normalize() {\r\n    var l = this.vectorLength();\r\n    if (l > 0.00000001) {\r\n      this.mulScalar(1.0/l);\r\n    }\r\n    \r\n    return this;\r\n  }\r\n}\r\n  \r\n`;\r\n\r\n  function indent(s, pad = \"  \") {\r\n    let l = s.split(\"\\n\");\r\n    let s2 = \"\";\r\n\r\n    for (let l2 of l) {\r\n      s2 += pad + l2 + \"\\n\";\r\n    }\r\n\r\n    return s2;\r\n  }\r\n\r\n  let i = 0;\r\n  for (let cls of classes) {\r\n    s += doExports(cls.name) + \" class \" + cls.name + \" extends BaseVector {\\n\";\r\n\r\n    let keys = Reflect.ownKeys(cls.prototype);\r\n\r\n    for (let k of keys) {\r\n      let v = cls.prototype[k];\r\n\r\n      if (typeof v !== \"function\") {\r\n        continue;\r\n      }\r\n\r\n      if (typeof k === \"symbol\") {\r\n        k = \"  [\" + k.toString() + \"]\";\r\n      }\r\n\r\n      v = (\"\" + v).trim();\r\n      if (v.startsWith(\"function(\") || v.startsWith(\"function (\")) {\r\n        v = k + v.slice(8, v.length).trim();\r\n      } else if (v.startsWith(\"function\")) {\r\n        v = v.slice(8, v.length).trim();\r\n      }\r\n\r\n      if (v.endsWith(\";}\")) {\r\n        v = v.slice(0, v.length - 1) + \"\\n  }\\n\";\r\n      }\r\n\r\n      let zero = \"\";\r\n      let l = lens[cls.name];\r\n\r\n      for (let j = 0; j < l; j++) {\r\n        if (j > 0) {\r\n          zero += \" = \";\r\n        }\r\n        zero += `this[${j}]`;\r\n      }\r\n\r\n      zero += \" = 0.0\";\r\n\r\n      if (k === \"constructor\") {\r\n        s += `  constructor(data) {\r\n    super(${l});\r\n        \r\n    this.vec = undefined; //for compatibility with old files\r\n    \r\n    if (arguments.length > 1) {\r\n      throw new Error(\"unexpected argument\");\r\n    }\r\n\r\n    //this.length = ${l};\r\n    ${zero};\r\n\r\n    if (data !== undefined) {\r\n      this.load(data);\r\n    }\r\n  }\r\n`;\r\n      } else {\r\n        s += indent(v);\r\n      }\r\n\r\n      s += \"\\n\";\r\n      i++;\r\n    }\r\n    s += \"}\\n\\n\"\r\n\r\n    s += `${cls.name}.STRUCT = \\`${cls.STRUCT}\\`;\\n`;\r\n    s += `nstructjs.register(${cls.name});\\n\\n`;\r\n  }\r\n\r\n  s += \"\\n\\n\" + (\"\" + internal_matrix).trim() + \"\\n\";\r\n  s += \"\\n\" + doExports(\"Matrix4\") + Matrix4;\r\n\r\n  s += `\\n  Matrix4.STRUCT = \\`${Matrix4.STRUCT}\\`;\\n`;\r\n  s += \"nstructjs.register(Matrix4)\\n\";\r\n\r\n  s += `\r\n  var _quat_vs3_temps = cachering.fromConstructor(Vector3, 64);\r\n  var _v3nd4_n1_normalizedDot4 = new Vector3();\r\n  var _v3nd4_n2_normalizedDot4 = new Vector3();\r\n  var _v3nd_n1_normalizedDot = new Vector3();\r\n  var _v3nd_n2_normalizedDot = new Vector3();\r\n\r\n  var $_v3nd4_n1_normalizedDot4 = new Vector3();\r\n  var $_v3nd4_n2_normalizedDot4 = new Vector3();\r\n  var $_v3nd_n1_normalizedDot = new Vector3();\r\n  var $_v3nd_n2_normalizedDot = new Vector3();\r\n\r\n  var lookat_cache_vs3 = cachering.fromConstructor(Vector3, 64);\r\n  var lookat_cache_vs4 = cachering.fromConstructor(Vector4, 64);\r\n\r\n  var makenormalcache = cachering.fromConstructor(Vector3, 64);\r\n`;\r\n\r\n  if (mode === \"rjs\") {\r\n    s = `define([], function() {\r\n  \"use strict\";\r\n\r\n  let exports = {};\r\n\r\n  {\r\n    ${nstructjscode}\r\n  }\r\n  ${indent(s)}\r\n\r\n  return exports;\r\n});\r\n`;\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nvar sin                                                          = Math.sin, cos                                          = Math.cos, abs                          = Math.abs, log = Math.log,\r\n    asin                                                         = Math.asin, exp                                        = Math.exp, acos = Math.acos, fract = Math.fract,\r\n    sign = Math.sign, tent = Math.tent, atan2 = Math.atan2, atan = Math.atan,\r\n    pow                                                          = Math.pow, sqrt = Math.sqrt, floor                      = Math.floor, ceil = Math.ceil,\r\n    min                                                          = Math.min, max = Math.max, PI = Math.PI, E = 2.718281828459045;\r\n\r\nvar DOT_NORM_SNAP_LIMIT = 0.00000000001;\r\nvar M_SQRT2 = Math.sqrt(2.0);\r\nvar FLT_EPSILON = 2.22e-16;\r\n\r\nvar basic_funcs = {\r\n  equals   : [[\"b\"], \"this[X] === b[X]\", \"&&\"],\r\n  /*dot is made manually so it's safe for acos\r\n  dot     : [[\"b\"], \"this[X]*b[X]\", \"+\"],\r\n   */\r\n  zero     : [[], \"0.0;\"],\r\n  negate   : [[], \"-this[X];\"],\r\n  combine  : [[\"b\", \"u\", \"v\"], \"this[X]*u + this[X]*v;\"],\r\n  interp   : [[\"b\", \"t\"], \"this[X] + (b[X] - this[X])*t;\"],\r\n  add      : [[\"b\"], \"this[X] + b[X];\"],\r\n  addFac   : [[\"b\", \"F\"], \"this[X] + b[X]*F;\"],\r\n  fract    : [[], \"Math.fract(this[X]);\"],\r\n  sub      : [[\"b\"], \"this[X] - b[X];\"],\r\n  mul      : [[\"b\"], \"this[X] * b[X];\"],\r\n  div      : [[\"b\"], \"this[X] / b[X];\"],\r\n  mulScalar: [[\"b\"], \"this[X] * b;\"],\r\n  divScalar: [[\"b\"], \"this[X] / b;\"],\r\n  addScalar: [[\"b\"], \"this[X] + b;\"],\r\n  subScalar: [[\"b\"], \"this[X] - b;\"],\r\n  minScalar: [[\"b\"], \"Math.min(this[X], b);\"],\r\n  maxScalar: [[\"b\"], \"Math.max(this[X], b);\"],\r\n  ceil     : [[], \"Math.ceil(this[X])\"],\r\n  floor    : [[], \"Math.floor(this[X])\"],\r\n  abs      : [[], \"Math.abs(this[X])\"],\r\n  min      : [[\"b\"], \"Math.min(this[X], b[X])\"],\r\n  max      : [[\"b\"], \"Math.max(this[X], b[X])\"],\r\n  clamp    : [[\"MIN\", \"MAX\"], \"min(max(this[X], MAX), MIN)\"],\r\n};\r\n\r\nfunction bounded_acos(fac) {\r\n  if (fac <= -1.0)\r\n    return Math.pi;\r\n  else if (fac >= 1.0)\r\n    return 0.0;\r\n  else\r\n    return Math.acos(fac);\r\n}\r\n\r\nfunction make_norm_safe_dot(cls) {\r\n  var _dot = cls.prototype.dot;\r\n\r\n  cls.prototype._dot = _dot;\r\n  cls.prototype.dot = function (b) {\r\n    var ret = _dot.call(this, b);\r\n\r\n    if (ret >= 1.0 - DOT_NORM_SNAP_LIMIT && ret <= 1.0 + DOT_NORM_SNAP_LIMIT)\r\n      return 1.0;\r\n    if (ret >= -1.0 - DOT_NORM_SNAP_LIMIT && ret <= -1.0 + DOT_NORM_SNAP_LIMIT)\r\n      return -1.0;\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nfunction getBaseVector(parent) {\r\n  return class BaseVector extends parent {\r\n    constructor() {\r\n      super(...arguments);\r\n\r\n      this.vec = undefined; //for compatibility with old nstructjs-saved files\r\n\r\n      //this.xyzw = this.init_swizzle(4);\r\n      //this.xyz = this.init_swizzle(3);\r\n      //this.xy = this.init_swizzle(2);\r\n    }\r\n\r\n    static inherit(cls, vectorsize) {\r\n      make_norm_safe_dot(cls);\r\n\r\n      var f;\r\n\r\n      var vectorDotDistance = \"f = function vectorDotDistance(b) {\\n\";\r\n      for (var i = 0; i < vectorsize; i++) {\r\n        vectorDotDistance += \"  let d\" + i + \" = this[\" + i + \"]-b[\" + i + \"];\\n\\n  \";\r\n      }\r\n\r\n      vectorDotDistance += \"  return \"\r\n      for (var i = 0; i < vectorsize; i++) {\r\n        if (i > 0)\r\n          vectorDotDistance += \" + \";\r\n        vectorDotDistance += \"d\" + i + \"*d\" + i;\r\n      }\r\n      vectorDotDistance += \";\\n\"\r\n      vectorDotDistance += \"};\";\r\n      cls.prototype.vectorDotDistance = eval(vectorDotDistance);\r\n\r\n      var f;\r\n      var vectorDistance = \"f = function vectorDistance(b) {\\n\";\r\n      for (var i = 0; i < vectorsize; i++) {\r\n        vectorDistance += `  let d${i} = this[${i}] - (b[${i}]||0);\\n\\n  `;\r\n        //vectorDistance += \"  let d\"+i+\" = this[\"+i+\"]-(b[\"+i+\"]||0);\\n\\n  \";\r\n      }\r\n\r\n      vectorDistance += \"  return Math.sqrt(\"\r\n      for (var i = 0; i < vectorsize; i++) {\r\n        if (i > 0)\r\n          vectorDistance += \" + \";\r\n        vectorDistance += \"d\" + i + \"*d\" + i;\r\n      }\r\n      vectorDistance += \");\\n\"\r\n      vectorDistance += \"};\";\r\n      cls.prototype.vectorDistance = eval(vectorDistance);\r\n\r\n      var vectorDistanceSqr = \"f = function vectorDistanceSqr(b) {\\n\";\r\n      for (var i = 0; i < vectorsize; i++) {\r\n        vectorDistanceSqr += `  let d${i} = this[${i}] - (b[${i}]||0);\\n\\n  `;\r\n        //vectorDistanceSqr += \"  let d\"+i+\" = this[\"+i+\"]-(b[\"+i+\"]||0);\\n\\n  \";\r\n      }\r\n\r\n      vectorDistanceSqr += \"  return (\"\r\n      for (var i = 0; i < vectorsize; i++) {\r\n        if (i > 0)\r\n          vectorDistanceSqr += \" + \";\r\n        vectorDistanceSqr += \"d\" + i + \"*d\" + i;\r\n      }\r\n      vectorDistanceSqr += \");\\n\"\r\n      vectorDistanceSqr += \"};\";\r\n      cls.prototype.vectorDistanceSqr = eval(vectorDistanceSqr);\r\n\r\n\r\n      for (var k in basic_funcs) {\r\n        var func = basic_funcs[k];\r\n        var args = func[0];\r\n        var line = func[1];\r\n        var f;\r\n\r\n        var code = \"f = function \" + k + \"(\"\r\n        for (var i = 0; i < args.length; i++) {\r\n          if (i > 0)\r\n            code += \", \";\r\n\r\n          line = line.replace(args[i], args[i].toLowerCase());\r\n          code += args[i].toLowerCase();\r\n        }\r\n        code += \") {\\n\";\r\n\r\n        if (func.length > 2) {\r\n          //make summation\r\n          code += \"  return \";\r\n\r\n          for (var i = 0; i < vectorsize; i++) {\r\n            if (i > 0)\r\n              code += func[2];\r\n\r\n            code += \"(\" + line.replace(/X/g, \"\" + i) + \")\";\r\n          }\r\n          code += \";\\n\";\r\n        } else {\r\n          for (var i = 0; i < vectorsize; i++) {\r\n            var line2 = line.replace(/X/g, \"\" + i);\r\n            code += \"  this[\" + i + \"] = \" + line2 + \";\\n\";\r\n          }\r\n          code += \"  return this;\\n\"\r\n        }\r\n\r\n        code += \"}\\n\";\r\n\r\n        //console.log(code);\r\n        var f = eval(code);\r\n\r\n        cls.prototype[k] = f;\r\n        //console.log(k, f);\r\n      }\r\n    }\r\n\r\n    copy() {\r\n      return new this.constructor(this);\r\n    }\r\n\r\n    load(data) {\r\n      throw new Error(\"Implement me!\");\r\n    }\r\n\r\n    init_swizzle(size) {\r\n      var ret = {};\r\n      var cls = size === 4 ? Vector4 : (size === 3 ? Vector3 : Vector2);\r\n\r\n      for (var k in cls.prototype) {\r\n        var v = cls.prototype[k];\r\n        if (typeof v !== \"function\" && !(v instanceof Function))\r\n          continue;\r\n\r\n        ret[k] = v.bind(this);\r\n      }\r\n\r\n      return ret;\r\n    }\r\n\r\n    vectorLength() {\r\n      return sqrt(this.dot(this));\r\n    }\r\n\r\n    swapAxes(axis1, axis2) {\r\n      let t = this[axis1];\r\n      this[axis1] = this[axis2];\r\n      this[axis2] = t;\r\n\r\n      return this;\r\n    }\r\n\r\n    normalize() {\r\n      /*\r\n      for (let i=0; i<this.length; i++) {\r\n        if (util.isDenormal(this[i])) {\r\n          console.error(\"Denormal error\", i, this[i]);\r\n          this[i] = 0.0;\r\n        }\r\n      }\r\n      //*/\r\n\r\n      let l = this.vectorLength();\r\n\r\n      /*\r\n      if (util.isDenormal(l)) {\r\n        console.error(\"Denormal error\", l);\r\n      }\r\n      //*/\r\n\r\n      if (l > 0.00000001) {\r\n        this.mulScalar(1.0/l);\r\n      }\r\n\r\n      return this;\r\n    }\r\n  }\r\n}\r\n\r\nexport const BaseVector = getBaseVector(Array);\r\nexport const F64BaseVector = getBaseVector(Float64Array);\r\nexport const F32BaseVector = getBaseVector(Float32Array);\r\n\r\nfunction myclamp(f, a, b) {\r\n  return Math.min(Math.max(f, a), b);\r\n}\r\n\r\nexport class Vector4 extends BaseVector {\r\n  constructor(data) {\r\n    super(4);\r\n\r\n    if (arguments.length > 1) {\r\n      throw new Error(\"unexpected argument\");\r\n    }\r\n\r\n    this[0] = this[1] = this[2] = this[3] = 0.0;\r\n\r\n    if (data !== undefined) {\r\n      this.load(data);\r\n    }\r\n  }\r\n\r\n  toCSS() {\r\n    let r = ~~(this[0]*255);\r\n    let g = ~~(this[1]*255);\r\n    let b = ~~(this[2]*255);\r\n    let a = this[3];\r\n    return `rgba(${r},${g},${b},${a})`\r\n  }\r\n\r\n  loadXYZW(x, y, z, w) {\r\n    this[0] = x;\r\n    this[1] = y;\r\n    this[2] = z;\r\n    this[3] = w;\r\n\r\n    return this;\r\n  }\r\n\r\n  loadXYZ(x, y, z) {\r\n    this[0] = x;\r\n    this[1] = y;\r\n    this[2] = z;\r\n\r\n    return this;\r\n  }\r\n\r\n  load(data) {\r\n    if (data === undefined)\r\n      return this;\r\n\r\n    this[0] = data[0];\r\n    this[1] = data[1];\r\n    this[2] = data[2];\r\n    this[3] = data[3];\r\n\r\n    return this;\r\n  }\r\n\r\n  dot(b) {\r\n    return this[0]*b[0] + this[1]*b[1] + this[2]*b[2] + this[3]*b[3];\r\n  }\r\n\r\n  mulVecQuat(q) {\r\n    let t0 = -q[1] * this[0] - q[2] * this[1] - q[3] * this[2];\r\n    let t1 = q[0] * this[0] + q[2] * this[2] - q[3] * this[1];\r\n    let t2 = q[0] * this[1] + q[3] * this[0] - q[1] * this[2];\r\n\r\n    this[2] = q[0] * this[2] + q[1] * this[1] - q[2] * this[0];\r\n    this[0] = t1;\r\n    this[1] = t2;\r\n\r\n    t1 = t0 * -q[1] + this[0] * q[0] - this[1] * q[3] + this[2] * q[2];\r\n    t2 = t0 * -q[2] + this[1] * q[0] - this[2] * q[1] + this[0] * q[3];\r\n\r\n    this[2] = t0 * -q[3] + this[2] * q[0] - this[0] * q[2] + this[1] * q[1];\r\n    this[0] = t1;\r\n    this[1] = t2;\r\n\r\n    return this;\r\n  }\r\n\r\n  multVecMatrix(matrix) {\r\n    var x = this[0];\r\n    var y = this[1];\r\n    var z = this[2];\r\n    var w = this[3];\r\n\r\n    this[0] = w*matrix.$matrix.m41 + x*matrix.$matrix.m11 + y*matrix.$matrix.m21 + z*matrix.$matrix.m31;\r\n    this[1] = w*matrix.$matrix.m42 + x*matrix.$matrix.m12 + y*matrix.$matrix.m22 + z*matrix.$matrix.m32;\r\n    this[2] = w*matrix.$matrix.m43 + x*matrix.$matrix.m13 + y*matrix.$matrix.m23 + z*matrix.$matrix.m33;\r\n    this[3] = w*matrix.$matrix.m44 + x*matrix.$matrix.m14 + y*matrix.$matrix.m24 + z*matrix.$matrix.m34;\r\n\r\n    return this[3];\r\n  }\r\n\r\n  cross(v) {\r\n    var x = this[1]*v[2] - this[2]*v[1];\r\n    var y = this[2]*v[0] - this[0]*v[2];\r\n    var z = this[0]*v[1] - this[1]*v[0];\r\n\r\n    this[0] = x;\r\n    this[1] = y;\r\n    this[2] = z;\r\n\r\n    return this;\r\n  }\r\n\r\n  preNormalizedAngle(v2) {\r\n    let th = this.dot(v2)*0.99999;\r\n    return Math.acos(th);\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    if (typeof this.vec !== \"undefined\") {\r\n      this.load(this.vec);\r\n      this.vec = undefined;\r\n    }\r\n  }\r\n};\r\nVector4.STRUCT = `\r\nvec4 {\r\n  0 : float;\r\n  1 : float;\r\n  2 : float;\r\n  3 : float;\r\n}\r\n`;\r\nnstructjs.manager.add_class(Vector4);\r\n\r\n\r\nvar _v3nd_n1_normalizedDot, _v3nd_n2_normalizedDot;\r\nvar _v3nd4_n1_normalizedDot4, _v3nd4_n2_normalizedDot4;\r\n\r\nexport class Vector3 extends F64BaseVector {\r\n  constructor(data) {\r\n    super(3);\r\n\r\n    if (arguments.length > 1) {\r\n      throw new Error(\"unexpected argument\");\r\n    }\r\n\r\n    this[0] = this[1] = this[2] = 0.0;\r\n\r\n    if (data !== undefined) {\r\n      this.load(data);\r\n    }\r\n\r\n    if (this.constructor === Vector3) {\r\n      Object.preventExtensions(this);\r\n    }\r\n  }\r\n\r\n  //normalizedDot4\r\n  static normalizedDot4(v1, v2, v3, v4) {\r\n    $_v3nd4_n1_normalizedDot4.load(v2).sub(v1).normalize();\r\n    $_v3nd4_n2_normalizedDot4.load(v4).sub(v3).normalize();\r\n\r\n    return $_v3nd4_n1_normalizedDot4.dot($_v3nd4_n2_normalizedDot4);\r\n  }\r\n\r\n  static normalizedDot3(v1, center, v2) {\r\n    $_v3nd4_n1_normalizedDot3.load(v1).sub(center).normalize();\r\n    $_v3nd4_n2_normalizedDot3.load(v2).sub(center).normalize();\r\n\r\n    return $_v3nd4_n1_normalizedDot3.dot($_v3nd4_n2_normalizedDot3);\r\n  }\r\n\r\n  toCSS() {\r\n    let r = ~~(this[0]*255);\r\n    let g = ~~(this[1]*255);\r\n    let b = ~~(this[2]*255);\r\n    return `rgb(${r},${g},${b})`\r\n  }\r\n\r\n  loadXYZ(x, y, z) {\r\n    this[0] = x;\r\n    this[1] = y;\r\n    this[2] = z;\r\n\r\n    return this;\r\n  }\r\n\r\n  loadXY(x, y) {\r\n    this[0] = x;\r\n    this[1] = y;\r\n\r\n    return this;\r\n  }\r\n\r\n  toJSON() {\r\n    return [this[0], this[1], this[2]];\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    return this.load(obj);\r\n  }\r\n\r\n  initVector3() {\r\n    this.length = 3;\r\n    this[0] = this[1] = this[2] = 0;\r\n    return this;\r\n  }\r\n\r\n  load(data) {\r\n    if (data === undefined)\r\n      return this;\r\n\r\n    //if (isNaN(data[0]) || isNaN(data[1]) || isNaN(data[2])) {\r\n    //  throw new Error(\"NaN\");\r\n    //}\r\n\r\n    this[0] = data[0];\r\n    this[1] = data[1];\r\n    this[2] = data[2];\r\n\r\n    return this;\r\n  }\r\n\r\n  dot(b) {\r\n    return this[0]*b[0] + this[1]*b[1] + this[2]*b[2];\r\n  }\r\n\r\n  normalizedDot(v) {\r\n    $_v3nd_n1_normalizedDot.load(this);\r\n    $_v3nd_n2_normalizedDot.load(v);\r\n    $_v3nd_n1_normalizedDot.normalize();\r\n    $_v3nd_n2_normalizedDot.normalize();\r\n    return $_v3nd_n1_normalizedDot.dot($_v3nd_n2_normalizedDot);\r\n  }\r\n\r\n  mulVecQuat(q) {\r\n    let t0 = -q[1] * this[0] - q[2] * this[1] - q[3] * this[2];\r\n    let t1 = q[0] * this[0] + q[2] * this[2] - q[3] * this[1];\r\n    let t2 = q[0] * this[1] + q[3] * this[0] - q[1] * this[2];\r\n\r\n    this[2] = q[0] * this[2] + q[1] * this[1] - q[2] * this[0];\r\n    this[0] = t1;\r\n    this[1] = t2;\r\n\r\n    t1 = t0 * -q[1] + this[0] * q[0] - this[1] * q[3] + this[2] * q[2];\r\n    t2 = t0 * -q[2] + this[1] * q[0] - this[2] * q[1] + this[0] * q[3];\r\n\r\n    this[2] = t0 * -q[3] + this[2] * q[0] - this[0] * q[2] + this[1] * q[1];\r\n    this[0] = t1;\r\n    this[1] = t2;\r\n\r\n    return this;\r\n  }\r\n\r\n  multVecMatrix(matrix, ignore_w) {\r\n    if (ignore_w === undefined) {\r\n      ignore_w = false;\r\n    }\r\n    var x = this[0];\r\n    var y = this[1];\r\n    var z = this[2];\r\n    this[0] = matrix.$matrix.m41 + x*matrix.$matrix.m11 + y*matrix.$matrix.m21 + z*matrix.$matrix.m31;\r\n    this[1] = matrix.$matrix.m42 + x*matrix.$matrix.m12 + y*matrix.$matrix.m22 + z*matrix.$matrix.m32;\r\n    this[2] = matrix.$matrix.m43 + x*matrix.$matrix.m13 + y*matrix.$matrix.m23 + z*matrix.$matrix.m33;\r\n    var w = matrix.$matrix.m44 + x*matrix.$matrix.m14 + y*matrix.$matrix.m24 + z*matrix.$matrix.m34;\r\n\r\n    if (!ignore_w && w !== 1 && w !== 0 && matrix.isPersp) {\r\n      this[0] /= w;\r\n      this[1] /= w;\r\n      this[2] /= w;\r\n    }\r\n    return w;\r\n  }\r\n\r\n  cross(v) {\r\n    var x = this[1]*v[2] - this[2]*v[1];\r\n    var y = this[2]*v[0] - this[0]*v[2];\r\n    var z = this[0]*v[1] - this[1]*v[0];\r\n\r\n    this[0] = x;\r\n    this[1] = y;\r\n    this[2] = z;\r\n\r\n    return this;\r\n  }\r\n\r\n  //axis is optional, 0\r\n  rot2d(A, axis) {\r\n    var x = this[0];\r\n    var y = this[1];\r\n\r\n    if (axis === 1) {\r\n      this[0] = x*cos(A) + y*sin(A);\r\n      this[1] = y*cos(A) - x*sin(A);\r\n    } else {\r\n      this[0] = x*cos(A) - y*sin(A);\r\n      this[1] = y*cos(A) + x*sin(A);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  preNormalizedAngle(v2) {\r\n    let th = this.dot(v2)*0.99999;\r\n    return Math.acos(th);\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    if (typeof this.vec !== \"undefined\") {\r\n      this.load(this.vec);\r\n      this.vec = undefined;\r\n    }\r\n  }\r\n}\r\n\r\nVector3.STRUCT = `\r\nvec3 {\r\n  0 : float;\r\n  1 : float;\r\n  2 : float;\r\n}\r\n`;\r\nnstructjs.manager.add_class(Vector3);\r\n\r\nexport class Vector2 extends BaseVector {\r\n  constructor(data) {\r\n    super(2);\r\n\r\n    if (arguments.length > 1) {\r\n      throw new Error(\"unexpected argument\");\r\n    }\r\n\r\n    this[0] = this[1] = 0.0;\r\n\r\n    if (data !== undefined) {\r\n      this.load(data);\r\n    }\r\n  }\r\n\r\n  initVector2(co) {\r\n    this.length = 2;\r\n\r\n    if (co !== undefined) {\r\n      this[0] = co[0];\r\n      this[1] = co[1];\r\n    } else {\r\n      this[0] = this[1] = 0.0;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  loadXY(x, y) {\r\n    this[0] = x;\r\n    this[1] = y;\r\n\r\n    return this;\r\n  }\r\n\r\n  toJSON() {\r\n    return [this[0], this[1]];\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    return this.load(obj);\r\n  }\r\n\r\n  loadXY(x, y) {\r\n    this[0] = x;\r\n    this[1] = y;\r\n\r\n    return this;\r\n  }\r\n\r\n  load(data) {\r\n    if (data === undefined)\r\n      return this;\r\n\r\n    this[0] = data[0];\r\n    this[1] = data[1];\r\n\r\n    return this;\r\n  }\r\n\r\n  //axis is optional, 0\r\n  rot2d(A, axis) {\r\n    var x = this[0];\r\n    var y = this[1];\r\n\r\n    if (axis === 1) {\r\n      this[0] = x*cos(A) + y*sin(A);\r\n      this[1] = y*cos(A) - x*sin(A);\r\n    } else {\r\n      this[0] = x*cos(A) - y*sin(A);\r\n      this[1] = y*cos(A) + x*sin(A);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  dot(b) {\r\n    return this[0]*b[0] + this[1]*b[1];\r\n  }\r\n\r\n  multVecMatrix(matrix) {\r\n    var x = this[0];\r\n    var y = this[1];\r\n\r\n    var w = 1.0;\r\n\r\n    this[0] = w*matrix.$matrix.m41 + x*matrix.$matrix.m11 + y*matrix.$matrix.m21;\r\n    this[1] = w*matrix.$matrix.m42 + x*matrix.$matrix.m12 + y*matrix.$matrix.m22;\r\n\r\n    if (matrix.isPersp) {\r\n      let w2 = w*matrix.$matrix.m44 + x*matrix.$matrix.m14 + y*matrix.$matrix.m24;\r\n\r\n      if (w2  !==  0.0) {\r\n        this[0] /= w2;\r\n        this[1] /= w2;\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  mulVecQuat(q) {\r\n    let t0 = -q[1] * this[0] - q[2] * this[1];\r\n    let t1 = q[0] * this[0] - q[3] * this[1];\r\n    let t2 = q[0] * this[1] + q[3] * this[0];\r\n\r\n    let z  = q[1] * this[1] - q[2] * this[0];\r\n    this[0] = t1;\r\n    this[1] = t2;\r\n\r\n    t1 = t0 * -q[1] + this[0] * q[0] - this[1] * q[3] + z * q[2];\r\n    t2 = t0 * -q[2] + this[1] * q[0] - z * q[1] + this[0] * q[3];\r\n\r\n    this[0] = t1;\r\n    this[1] = t2;\r\n\r\n    return this;\r\n  }\r\n\r\n  vectorLengthSqr() {\r\n    return this.dot(this);\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    if (typeof this.vec !== undefined) {\r\n      this.load(this.vec);\r\n      this.vec = undefined;\r\n    }\r\n  }\r\n};\r\nVector2.STRUCT = `\r\nvec2 {\r\n  0 : float;\r\n  1 : float;\r\n}\r\n`;\r\nnstructjs.manager.add_class(Vector2);\r\n\r\nlet _quat_vs3_temps = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport class Quat extends Vector4 {\r\n  makeUnitQuat() {\r\n    this[0] = 1.0;\r\n    this[1] = this[2] = this[3] = 0.0;\r\n  }\r\n\r\n  isZero() {\r\n    return (this[0] === 0 && this[1] === 0 && this[2] === 0 && this[3] === 0);\r\n  }\r\n\r\n  mulQuat(qt) {\r\n    var a = this[0]*qt[0] - this[1]*qt[1] - this[2]*qt[2] - this[3]*qt[3];\r\n    var b = this[0]*qt[1] + this[1]*qt[0] + this[2]*qt[3] - this[3]*qt[2];\r\n    var c = this[0]*qt[2] + this[2]*qt[0] + this[3]*qt[1] - this[1]*qt[3];\r\n    this[3] = this[0]*qt[3] + this[3]*qt[0] + this[1]*qt[2] - this[2]*qt[1];\r\n    this[0] = a;\r\n    this[1] = b;\r\n    this[2] = c;\r\n  }\r\n\r\n  conjugate() {\r\n    this[1] = -this[1];\r\n    this[2] = -this[2];\r\n    this[3] = -this[3];\r\n  }\r\n\r\n  dotWithQuat(q2) {\r\n    return this[0]*q2[0] + this[1]*q2[1] + this[2]*q2[2] + this[3]*q2[3];\r\n  }\r\n\r\n  invert() {\r\n    var f = this.dot(this);\r\n\r\n    if (f === 0.0)\r\n      return;\r\n\r\n    conjugate_qt(q);\r\n    this.mulscalar(1.0/f);\r\n  }\r\n\r\n  sub(q2) {\r\n    var nq2 = new Quat();\r\n\r\n    nq2[0] = -q2[0];\r\n    nq2[1] = q2[1];\r\n    nq2[2] = q2[2];\r\n    nq2[3] = q2[3];\r\n\r\n    this.mul(nq2);\r\n  }\r\n\r\n  mulScalarWithFactor(fac) {\r\n    var angle = fac*bounded_acos(this[0]);\r\n    var co = Math.cos(angle);\r\n    var si = Math.sin(angle);\r\n\r\n    this[0] = co;\r\n\r\n    var last3 = Vector3([this[1], this[2], this[3]]);\r\n    last3.normalize();\r\n    last3.mulScalar(si);\r\n    this[1] = last3[0];\r\n    this[2] = last3[1];\r\n    this[3] = last3[2];\r\n    return this;\r\n  }\r\n\r\n  toMatrix(m) {\r\n    if (m === undefined) {\r\n      m = new Matrix4();\r\n    }\r\n\r\n    var q0 = M_SQRT2*this[0];\r\n    var q1 = M_SQRT2*this[1];\r\n    var q2 = M_SQRT2*this[2];\r\n    var q3 = M_SQRT2*this[3];\r\n    var qda = q0*q1;\r\n    var qdb = q0*q2;\r\n    var qdc = q0*q3;\r\n    var qaa = q1*q1;\r\n    var qab = q1*q2;\r\n    var qac = q1*q3;\r\n    var qbb = q2*q2;\r\n    var qbc = q2*q3;\r\n    var qcc = q3*q3;\r\n    m.$matrix.m11 = (1.0 - qbb - qcc);\r\n    m.$matrix.m12 = (qdc + qab);\r\n    m.$matrix.m13 = (-qdb + qac);\r\n    m.$matrix.m14 = 0.0;\r\n    m.$matrix.m21 = (-qdc + qab);\r\n    m.$matrix.m22 = (1.0 - qaa - qcc);\r\n    m.$matrix.m23 = (qda + qbc);\r\n    m.$matrix.m24 = 0.0;\r\n    m.$matrix.m31 = (qdb + qac);\r\n    m.$matrix.m32 = (-qda + qbc);\r\n    m.$matrix.m33 = (1.0 - qaa - qbb);\r\n    m.$matrix.m34 = 0.0;\r\n    m.$matrix.m41 = m.$matrix.m42 = m.$matrix.m43 = 0.0;\r\n    m.$matrix.m44 = 1.0;\r\n\r\n    return m;\r\n  }\r\n\r\n  matrixToQuat(wmat) {\r\n    var mat = temp_mats.next();\r\n    mat.load(wmat);\r\n\r\n    mat.$matrix.m41 = mat.$matrix.m42 = mat.$matrix.m43 = 0;\r\n    mat.$matrix.m44 = 1.0;\r\n\r\n    var r1 = new Vector3([mat.$matrix.m11, mat.$matrix.m12, mat.$matrix.m13]);\r\n    var r2 = new Vector3([mat.$matrix.m21, mat.$matrix.m22, mat.$matrix.m23]);\r\n    var r3 = new Vector3([mat.$matrix.m31, mat.$matrix.m32, mat.$matrix.m33]);\r\n\r\n    r1.normalize();\r\n    r2.normalize();\r\n    r3.normalize();\r\n\r\n    mat.$matrix.m11 = r1[0];\r\n    mat.$matrix.m12 = r1[1];\r\n    mat.$matrix.m13 = r1[2];\r\n    mat.$matrix.m21 = r2[0];\r\n    mat.$matrix.m22 = r2[1];\r\n    mat.$matrix.m23 = r2[2];\r\n    mat.$matrix.m31 = r3[0];\r\n    mat.$matrix.m32 = r3[1];\r\n    mat.$matrix.m33 = r3[2];\r\n    var tr = 0.25*(1.0 + mat.$matrix.m11 + mat.$matrix.m22 + mat.$matrix.m33);\r\n    var s = 0;\r\n    if (tr > FLT_EPSILON) {\r\n      s = Math.sqrt(tr);\r\n      this[0] = s;\r\n      s = 1.0/(4.0*s);\r\n      this[1] = ((mat.$matrix.m23 - mat.$matrix.m32)*s);\r\n      this[2] = ((mat.$matrix.m31 - mat.$matrix.m13)*s);\r\n      this[3] = ((mat.$matrix.m12 - mat.$matrix.m21)*s);\r\n    } else {\r\n      if (mat.$matrix.m11 > mat.$matrix.m22 && mat.$matrix.m11 > mat.$matrix.m33) {\r\n        s = 2.0*Math.sqrt(1.0 + mat.$matrix.m11 - mat.$matrix.m22 - mat.$matrix.m33);\r\n        this[1] = (0.25*s);\r\n        s = 1.0/s;\r\n        this[0] = ((mat.$matrix.m32 - mat.$matrix.m23)*s);\r\n        this[2] = ((mat.$matrix.m21 + mat.$matrix.m12)*s);\r\n        this[3] = ((mat.$matrix.m31 + mat.$matrix.m13)*s);\r\n      } else if (mat.$matrix.m22 > mat.$matrix.m33) {\r\n        s = 2.0*Math.sqrt(1.0 + mat.$matrix.m22 - mat.$matrix.m11 - mat.$matrix.m33);\r\n        this[2] = (0.25*s);\r\n        s = 1.0/s;\r\n        this[0] = ((mat.$matrix.m31 - mat.$matrix.m13)*s);\r\n        this[1] = ((mat.$matrix.m21 + mat.$matrix.m12)*s);\r\n        this[3] = ((mat.$matrix.m32 + mat.$matrix.m23)*s);\r\n      } else {\r\n        s = 2.0*Math.sqrt(1.0 + mat.$matrix.m33 - mat.$matrix.m11 - mat.$matrix.m22);\r\n        this[3] = (0.25*s);\r\n        s = 1.0/s;\r\n        this[0] = ((mat.$matrix.m21 - mat.$matrix.m12)*s);\r\n        this[1] = ((mat.$matrix.m31 + mat.$matrix.m13)*s);\r\n        this[2] = ((mat.$matrix.m32 + mat.$matrix.m23)*s);\r\n      }\r\n    }\r\n    this.normalize();\r\n  }\r\n\r\n  normalize() {\r\n    var len = Math.sqrt(this.dot(this));\r\n\r\n    if (len !== 0.0) {\r\n      this.mulScalar(1.0/len);\r\n    } else {\r\n      this[1] = 1.0;\r\n      this[0] = this[2] = this[3] = 0.0;\r\n    }\r\n    return this;\r\n  }\r\n\r\n  axisAngleToQuat(axis, angle) {\r\n    let nor = _quat_vs3_temps.next().load(axis);\r\n    nor.normalize();\r\n\r\n    if (nor.dot(nor) !== 0.0) {\r\n      var phi = angle/2.0;\r\n      var si = Math.sin(phi);\r\n      this[0] = Math.cos(phi);\r\n      this[1] = nor[0]*si;\r\n      this[2] = nor[1]*si;\r\n      this[3] = nor[2]*si;\r\n    } else {\r\n      this.makeUnitQuat();\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  rotationBetweenVecs(v1, v2, fac = 1.0) {\r\n    v1 = new Vector3(v1);\r\n    v2 = new Vector3(v2);\r\n    v1.normalize();\r\n    v2.normalize();\r\n\r\n    if (Math.abs(v1.dot(v2)) > 0.9999) {\r\n      this.makeUnitQuat();\r\n      return this;\r\n    }\r\n\r\n    let axis = new Vector3(v1);\r\n    axis.cross(v2);\r\n\r\n    let angle = v1.preNormalizedAngle(v2)*fac;\r\n\r\n    this.axisAngleToQuat(axis, angle);\r\n\r\n    return this;\r\n  }\r\n\r\n  quatInterp(quat2, t) {\r\n    let quat = new Quat();\r\n    let cosom = this[0]*quat2[0] + this[1]*quat2[1] + this[2]*quat2[2] + this[3]*quat2[3];\r\n    if (cosom < 0.0) {\r\n      cosom = -cosom;\r\n      quat[0] = -this[0];\r\n      quat[1] = -this[1];\r\n      quat[2] = -this[2];\r\n      quat[3] = -this[3];\r\n    } else {\r\n      quat[0] = this[0];\r\n      quat[1] = this[1];\r\n      quat[2] = this[2];\r\n      quat[3] = this[3];\r\n    }\r\n\r\n    let omega, sinom, sc1, sc2;\r\n    if ((1.0 - cosom) > 0.0001) {\r\n      omega = Math.acos(cosom);\r\n      sinom = Math.sin(omega);\r\n      sc1 = Math.sin((1.0 - t)*omega)/sinom;\r\n      sc2 = Math.sin(t*omega)/sinom;\r\n    } else {\r\n      sc1 = 1.0 - t;\r\n      sc2 = t;\r\n    }\r\n    this[0] = sc1*quat[0] + sc2*quat2[0];\r\n    this[1] = sc1*quat[1] + sc2*quat2[1];\r\n    this[2] = sc1*quat[2] + sc2*quat2[2];\r\n    this[3] = sc1*quat[3] + sc2*quat2[3];\r\n\r\n    return this;\r\n  }\r\n};\r\n\r\nQuat.STRUCT = nstructjs.inherit(Quat, Vector4, 'quat') + `\r\n}\r\n`;\r\nnstructjs.register(Quat);\r\n\r\n_v3nd4_n1_normalizedDot4 = new Vector3();\r\n_v3nd4_n2_normalizedDot4 = new Vector3();\r\n_v3nd_n1_normalizedDot = new Vector3();\r\n_v3nd_n2_normalizedDot = new Vector3();\r\n\r\nBaseVector.inherit(Vector4, 4);\r\nF64BaseVector.inherit(Vector3, 3);\r\nBaseVector.inherit(Vector2, 2);\r\n\r\nlookat_cache_vs3 = util.cachering.fromConstructor(Vector3, 64);\r\nlookat_cache_vs4 = util.cachering.fromConstructor(Vector4, 64);\r\n\r\nmakenormalcache = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nvar $_v3nd_n1_normalizedDot = new Vector3();\r\nvar $_v3nd_n2_normalizedDot = new Vector3();\r\nvar $_v3nd4_n1_normalizedDot4 = new Vector3();\r\nvar $_v3nd4_n2_normalizedDot4 = new Vector3();\r\nvar $_v3nd4_n1_normalizedDot3 = new Vector3();\r\nvar $_v3nd4_n2_normalizedDot3 = new Vector3();\r\n\r\nvar M_SQRT2 = Math.sqrt(2.0);\r\nvar FLT_EPSILON = 2.22e-16;\r\n\r\nclass internal_matrix {\r\n  constructor() {\r\n    this.m11 = 1.0;\r\n    this.m12 = 0.0;\r\n    this.m13 = 0.0;\r\n    this.m14 = 0.0;\r\n    this.m21 = 0.0;\r\n    this.m22 = 1.0;\r\n    this.m23 = 0.0;\r\n    this.m24 = 0.0;\r\n    this.m31 = 0.0;\r\n    this.m32 = 0.0;\r\n    this.m33 = 1.0;\r\n    this.m34 = 0.0;\r\n    this.m41 = 0.0;\r\n    this.m42 = 0.0;\r\n    this.m43 = 0.0;\r\n    this.m44 = 1.0;\r\n  }\r\n}\r\n\r\nvar lookat_cache_vs3;\r\nvar lookat_cache_vs4;\r\nvar lookat_cache_ms;\r\nvar euler_rotate_mats;\r\nvar makenormalcache;\r\nvar temp_mats;\r\n\r\nlet preMultTemp;\r\n\r\nexport class Matrix4 {\r\n  constructor(m) {\r\n    this.$matrix = new internal_matrix();\r\n    this.isPersp = false;\r\n\r\n    if (typeof m === 'object') {\r\n      if (\"length\" in m && m.length >= 16) {\r\n        this.load(m);\r\n      } else if (m instanceof Matrix4) {\r\n        this.load(m);\r\n      }\r\n    }\r\n  }\r\n\r\n  static fromJSON() {\r\n    var mat = new Matrix4();\r\n    mat.load(json.items);\r\n    mat.isPersp = json.isPersp;\r\n    return mat;\r\n  }\r\n\r\n  copy() {\r\n    return this.clone();\r\n  }\r\n\r\n  clone() {\r\n    return new Matrix4(this);\r\n  }\r\n\r\n  addToHashDigest(hash) {\r\n    let m = this.$matrix;\r\n\r\n    hash.add(m.m11);\r\n    hash.add(m.m12);\r\n    hash.add(m.m13);\r\n    hash.add(m.m14);\r\n\r\n    hash.add(m.m21);\r\n    hash.add(m.m22);\r\n    hash.add(m.m23);\r\n    hash.add(m.m24);\r\n\r\n    hash.add(m.m31);\r\n    hash.add(m.m32);\r\n    hash.add(m.m33);\r\n    hash.add(m.m34);\r\n\r\n    hash.add(m.m41);\r\n    hash.add(m.m42);\r\n    hash.add(m.m43);\r\n    hash.add(m.m44);\r\n\r\n    return this;\r\n  }\r\n\r\n  equals(m) {\r\n    let m1 = this.$matrix;\r\n    let m2 = m.$matrix;\r\n\r\n    let ok = 1;\r\n\r\n    ok = ok && m1.m11 === m2.m11;\r\n    ok = ok && m1.m12 === m2.m12;\r\n    ok = ok && m1.m13 === m2.m13;\r\n    ok = ok && m1.m14 === m2.m14;\r\n\r\n    ok = ok && m1.m21 === m2.m21;\r\n    ok = ok && m1.m22 === m2.m22;\r\n    ok = ok && m1.m23 === m2.m23;\r\n    ok = ok && m1.m24 === m2.m24;\r\n\r\n    ok = ok && m1.m31 === m2.m31;\r\n    ok = ok && m1.m32 === m2.m32;\r\n    ok = ok && m1.m33 === m2.m33;\r\n    ok = ok && m1.m34 === m2.m34;\r\n\r\n    ok = ok && m1.m41 === m2.m41;\r\n    ok = ok && m1.m42 === m2.m42;\r\n    ok = ok && m1.m43 === m2.m43;\r\n    ok = ok && m1.m44 === m2.m44;\r\n\r\n    return ok;\r\n  }\r\n\r\n  loadColumn(i, vec) {\r\n    let m = this.$matrix;\r\n    let have4 = vec.length > 3;\r\n\r\n    switch (i) {\r\n      case 0:\r\n        m.m11 = vec[0];\r\n        m.m21 = vec[1];\r\n        m.m31 = vec[2];\r\n        if (have4) {\r\n          m.m41 = vec[3];\r\n        }\r\n        break;\r\n      case 1:\r\n        m.m12 = vec[0];\r\n        m.m22 = vec[1];\r\n        m.m32 = vec[2];\r\n        if (have4) {\r\n          m.m42 = vec[3];\r\n        }\r\n        break;\r\n      case 2:\r\n        m.m13 = vec[0];\r\n        m.m23 = vec[1];\r\n        m.m33 = vec[2];\r\n        if (have4) {\r\n          m.m43 = vec[3];\r\n        }\r\n        break;\r\n      case 3:\r\n        m.m14 = vec[0];\r\n        m.m24 = vec[1];\r\n        m.m34 = vec[2];\r\n        if (have4) {\r\n          m.m44 = vec[3];\r\n        }\r\n        break;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  copyColumnTo(i, vec) {\r\n    let m = this.$matrix;\r\n    let have4 = vec.length > 3;\r\n\r\n    switch (i) {\r\n      case 0:\r\n        vec[0] = m.m11;\r\n        vec[1] = m.m21;\r\n        vec[2] = m.m31;\r\n        if (have4) {\r\n          vec[3] = m.m41;\r\n        }\r\n        break;\r\n      case 1:\r\n        vec[0] = m.m12;\r\n        vec[1] = m.m22;\r\n        vec[2] = m.m32;\r\n        if (have4) {\r\n          vec[3] = m.m42;\r\n        }\r\n        break;\r\n      case 2:\r\n        vec[0] = m.m13;\r\n        vec[1] = m.m23;\r\n        vec[2] = m.m33;\r\n        if (have4) {\r\n          vec[3] = m.m43;\r\n        }\r\n        break;\r\n      case 3:\r\n        vec[0] = m.m14;\r\n        vec[1] = m.m24;\r\n        vec[2] = m.m34;\r\n        if (have4) {\r\n          vec[3] = m.m44;\r\n        }\r\n        break;\r\n    }\r\n\r\n    return vec;\r\n  }\r\n\r\n  copyColumn(i) {\r\n    return this.copyColumnTo(i, new Vector3());\r\n  }\r\n\r\n  load() {\r\n    if (arguments.length === 1 && typeof arguments[0] === 'object') {\r\n      var matrix;\r\n      if (arguments[0] instanceof Matrix4) {\r\n        matrix = arguments[0].$matrix;\r\n        this.isPersp = arguments[0].isPersp;\r\n        this.$matrix.m11 = matrix.m11;\r\n        this.$matrix.m12 = matrix.m12;\r\n        this.$matrix.m13 = matrix.m13;\r\n        this.$matrix.m14 = matrix.m14;\r\n        this.$matrix.m21 = matrix.m21;\r\n        this.$matrix.m22 = matrix.m22;\r\n        this.$matrix.m23 = matrix.m23;\r\n        this.$matrix.m24 = matrix.m24;\r\n        this.$matrix.m31 = matrix.m31;\r\n        this.$matrix.m32 = matrix.m32;\r\n        this.$matrix.m33 = matrix.m33;\r\n        this.$matrix.m34 = matrix.m34;\r\n        this.$matrix.m41 = matrix.m41;\r\n        this.$matrix.m42 = matrix.m42;\r\n        this.$matrix.m43 = matrix.m43;\r\n        this.$matrix.m44 = matrix.m44;\r\n        return this;\r\n      } else\r\n        matrix = arguments[0];\r\n      if (\"length\" in matrix && matrix.length >= 16) {\r\n        this.$matrix.m11 = matrix[0];\r\n        this.$matrix.m12 = matrix[1];\r\n        this.$matrix.m13 = matrix[2];\r\n        this.$matrix.m14 = matrix[3];\r\n        this.$matrix.m21 = matrix[4];\r\n        this.$matrix.m22 = matrix[5];\r\n        this.$matrix.m23 = matrix[6];\r\n        this.$matrix.m24 = matrix[7];\r\n        this.$matrix.m31 = matrix[8];\r\n        this.$matrix.m32 = matrix[9];\r\n        this.$matrix.m33 = matrix[10];\r\n        this.$matrix.m34 = matrix[11];\r\n        this.$matrix.m41 = matrix[12];\r\n        this.$matrix.m42 = matrix[13];\r\n        this.$matrix.m43 = matrix[14];\r\n        this.$matrix.m44 = matrix[15];\r\n        return this;\r\n      }\r\n    }\r\n\r\n    this.makeIdentity();\r\n\r\n    return this;\r\n  }\r\n\r\n  toJSON() {\r\n    return {isPersp: this.isPersp, items: this.getAsArray()}\r\n  }\r\n\r\n  getAsArray() {\r\n    return [this.$matrix.m11, this.$matrix.m12, this.$matrix.m13, this.$matrix.m14, this.$matrix.m21, this.$matrix.m22,\r\n            this.$matrix.m23, this.$matrix.m24, this.$matrix.m31, this.$matrix.m32, this.$matrix.m33, this.$matrix.m34,\r\n            this.$matrix.m41, this.$matrix.m42, this.$matrix.m43, this.$matrix.m44];\r\n  }\r\n\r\n  getAsFloat32Array() {\r\n    return new Float32Array(this.getAsArray());\r\n  }\r\n\r\n  setUniform(ctx, loc, transpose) {\r\n    if (Matrix4.setUniformArray === undefined) {\r\n      Matrix4.setUniformWebGLArray = new Float32Array(16);\r\n      Matrix4.setUniformArray = new Array(16);\r\n    }\r\n\r\n    Matrix4.setUniformArray[0] = this.$matrix.m11;\r\n    Matrix4.setUniformArray[1] = this.$matrix.m12;\r\n    Matrix4.setUniformArray[2] = this.$matrix.m13;\r\n    Matrix4.setUniformArray[3] = this.$matrix.m14;\r\n    Matrix4.setUniformArray[4] = this.$matrix.m21;\r\n    Matrix4.setUniformArray[5] = this.$matrix.m22;\r\n    Matrix4.setUniformArray[6] = this.$matrix.m23;\r\n    Matrix4.setUniformArray[7] = this.$matrix.m24;\r\n    Matrix4.setUniformArray[8] = this.$matrix.m31;\r\n    Matrix4.setUniformArray[9] = this.$matrix.m32;\r\n    Matrix4.setUniformArray[10] = this.$matrix.m33;\r\n    Matrix4.setUniformArray[11] = this.$matrix.m34;\r\n    Matrix4.setUniformArray[12] = this.$matrix.m41;\r\n    Matrix4.setUniformArray[13] = this.$matrix.m42;\r\n    Matrix4.setUniformArray[14] = this.$matrix.m43;\r\n    Matrix4.setUniformArray[15] = this.$matrix.m44;\r\n\r\n    Matrix4.setUniformWebGLArray.set(Matrix4.setUniformArray);\r\n\r\n    ctx.uniformMatrix4fv(loc, transpose, Matrix4.setUniformWebGLArray);\r\n\r\n    return this;\r\n  }\r\n\r\n  makeIdentity() {\r\n    this.$matrix.m11 = 1;\r\n    this.$matrix.m12 = 0;\r\n    this.$matrix.m13 = 0;\r\n    this.$matrix.m14 = 0;\r\n    this.$matrix.m21 = 0;\r\n    this.$matrix.m22 = 1;\r\n    this.$matrix.m23 = 0;\r\n    this.$matrix.m24 = 0;\r\n    this.$matrix.m31 = 0;\r\n    this.$matrix.m32 = 0;\r\n    this.$matrix.m33 = 1;\r\n    this.$matrix.m34 = 0;\r\n    this.$matrix.m41 = 0;\r\n    this.$matrix.m42 = 0;\r\n    this.$matrix.m43 = 0;\r\n    this.$matrix.m44 = 1;\r\n\r\n    //drop isPersp\r\n    this.isPersp = false;\r\n\r\n    return this;\r\n  }\r\n\r\n  transpose() {\r\n    var tmp = this.$matrix.m12;\r\n    this.$matrix.m12 = this.$matrix.m21;\r\n    this.$matrix.m21 = tmp;\r\n    tmp = this.$matrix.m13;\r\n    this.$matrix.m13 = this.$matrix.m31;\r\n    this.$matrix.m31 = tmp;\r\n    tmp = this.$matrix.m14;\r\n    this.$matrix.m14 = this.$matrix.m41;\r\n    this.$matrix.m41 = tmp;\r\n    tmp = this.$matrix.m23;\r\n    this.$matrix.m23 = this.$matrix.m32;\r\n    this.$matrix.m32 = tmp;\r\n    tmp = this.$matrix.m24;\r\n    this.$matrix.m24 = this.$matrix.m42;\r\n    this.$matrix.m42 = tmp;\r\n    tmp = this.$matrix.m34;\r\n    this.$matrix.m34 = this.$matrix.m43;\r\n    this.$matrix.m43 = tmp;\r\n\r\n    return this;\r\n  }\r\n\r\n  determinant() {\r\n    return this._determinant4x4();\r\n  }\r\n\r\n  invert() {\r\n    var det = this._determinant4x4();\r\n\r\n    if (Math.abs(det) < 1e-08)\r\n      return null;\r\n\r\n    this._makeAdjoint();\r\n\r\n    this.$matrix.m11 /= det;\r\n    this.$matrix.m12 /= det;\r\n    this.$matrix.m13 /= det;\r\n    this.$matrix.m14 /= det;\r\n    this.$matrix.m21 /= det;\r\n    this.$matrix.m22 /= det;\r\n    this.$matrix.m23 /= det;\r\n    this.$matrix.m24 /= det;\r\n    this.$matrix.m31 /= det;\r\n    this.$matrix.m32 /= det;\r\n    this.$matrix.m33 /= det;\r\n    this.$matrix.m34 /= det;\r\n    this.$matrix.m41 /= det;\r\n    this.$matrix.m42 /= det;\r\n    this.$matrix.m43 /= det;\r\n    this.$matrix.m44 /= det;\r\n\r\n    return this;\r\n  }\r\n\r\n  translate(x, y, z) {\r\n    if (typeof x === 'object' && \"length\" in x) {\r\n      var t = x;\r\n\r\n      x = t[0];\r\n      y = t[1];\r\n      z = t[2];\r\n    }\r\n\r\n    x = x === undefined ? 0 : x;\r\n    y = y === undefined ? 0 : y;\r\n    z = z === undefined ? 0 : z;\r\n\r\n    var matrix = temp_mats.next().makeIdentity();\r\n\r\n    matrix.$matrix.m41 = x;\r\n    matrix.$matrix.m42 = y;\r\n    matrix.$matrix.m43 = z;\r\n\r\n    this.multiply(matrix);\r\n    return this;\r\n  }\r\n\r\n  preTranslate(x, y, z) {\r\n    if (typeof x === 'object' && \"length\" in x) {\r\n      var t = x;\r\n\r\n      x = t[0];\r\n      y = t[1];\r\n      z = t[2];\r\n    }\r\n\r\n    x = x === undefined ? 0 : x;\r\n    y = y === undefined ? 0 : y;\r\n    z = z === undefined ? 0 : z;\r\n\r\n    var matrix = temp_mats.next().makeIdentity();\r\n\r\n    matrix.$matrix.m41 = x;\r\n    matrix.$matrix.m42 = y;\r\n    matrix.$matrix.m43 = z;\r\n\r\n    this.preMultiply(matrix);\r\n    return this;\r\n  }\r\n\r\n  scale(x, y, z, w = 1.0) {\r\n    if (typeof x === 'object' && \"length\" in x) {\r\n      var t = x;\r\n      x = t[0];\r\n      y = t[1];\r\n      z = t[2];\r\n    } else {\r\n      if (x === undefined)\r\n        x = 1;\r\n\r\n      if (z === undefined) {\r\n        if (y === undefined) {\r\n          y = x;\r\n          z = x;\r\n        } else {\r\n          z = x;\r\n        }\r\n      } else if (y === undefined) {\r\n        y = x;\r\n      }\r\n    }\r\n\r\n\r\n    var matrix = temp_mats.next().makeIdentity();\r\n    matrix.$matrix.m11 = x;\r\n    matrix.$matrix.m22 = y;\r\n    matrix.$matrix.m33 = z;\r\n    matrix.$matrix.m44 = w;\r\n    this.multiply(matrix);\r\n    return this\r\n  }\r\n\r\n  preScale(x, y, z, w = 1.0) {\r\n    let mat = temp_mats.next().makeIdentity();\r\n    mat.scale(x, y, z, w);\r\n\r\n    this.preMultiply(mat);\r\n    return this\r\n  }\r\n\r\n  /*\r\n  on factor;\r\n  off period;\r\n\r\n  c1 := cx; comment: cos(thx);\r\n  s1 := sx; comment: sin(thx);\r\n\r\n  c2 := cy; comment: cos(thy);\r\n  s2 := sy; comment: sin(thy);\r\n\r\n  c3 := cz; comment: cos(thz);\r\n  s3 := sz; comment: sin(thz);\r\n\r\n  cx := cos(thx);\r\n  sx := sin(thx);\r\n  cy := cos(thy);\r\n  sy := sin(thy);\r\n  cz := cos(thz);\r\n  sz := sin(thz);\r\n\r\n  imat := mat((1, 0, 0, 0),\r\n              (0, 1, 0, 0),\r\n              (0, 0, 1, 0),\r\n              (0, 0, 0, 1));\r\n\r\n  xmat :=mat((1,  0,  0,  0),\r\n             (0, c1, -s1, 0),\r\n             (0, s1,  c1, 0),\r\n             (0,  0,  0,  0));\r\n\r\n  ymat :=mat((c2, 0, s2, 0),\r\n             (0,  1,  0,  0),\r\n             (-s2, 0,  c2, 0),\r\n             (0,  0,  0,  0));\r\n\r\n  zmat :=mat(( c3, -s3, 0, 0),\r\n             (s3, c3, 0, 0),\r\n             ( 0,  0,  1, 0),\r\n             ( 0,  0,  0, 0));\r\n\r\n  mmat := mat((m11, m21, m31, 0),\r\n              (m12, m22, m32, 0),\r\n              (m13, m23, m33, 0),\r\n              (0,   0,   0,   0));\r\n\r\n  fmat := zmat * ymat * xmat;\r\n\r\n  f1 := m11**2 + m12**2 + m13**2 - 1.0;\r\n  f2 := m21**2 + m22**2 + m23**2 - 1.0;\r\n  f3 := m31**2 + m32**2 + m33**2 - 1.0;\r\n\r\n  tmat := fmat * mmat;\r\n  f1 := tmat(1, 1) - 1.0;\r\n  f2 := tmat(2, 2) - 1.0;\r\n  f3 := tmat(3, 3) - 1.0;\r\n\r\n  operator myasin;\r\n\r\n  fthy := asin(mmat(3, 1));\r\n  f1 := mmat(3,1)**2 + mmat(2,1)**2 + mmat(1,1)**2 = 1.0;\r\n\r\n  fmat2 := sub(thy=fthy, fmat);\r\n\r\n  fmat3 := fmat2 * (tp mmat);\r\n  ffz := solve(fmat2(1, 1) - m11, thz);\r\n  ffx := solve(fmat2(3, 3) - m33, thx);\r\n\r\n  fthz := part(ffz, 1, 2);\r\n  fthx := part(ffx, 1, 2);\r\n\r\n  sub(thx=fthx, thy=fthy, thz=fthz, fmat);\r\n\r\n(cos(thy)*cos(thz),         cos(thx)*sin(thz)-cos(thz)*sin(thx)*sin(thy),  -(cos(thx)*cos(thz)*sin(thy)+sin(thx)*sin(thz)), 0),\r\n\r\n(-cos(thy)*sin(thz),        cos(thx)*cos(thz) + sin(thx)*sin(thy)*sin(thz),  cos(thx)*sin(thy)*sin(thz)-cos(thz)*sin(thx), 0),\r\n\r\n(sin(thy),                  cos(thy)*sin(thx),                               cos(thx)*cos(thy),  0),\r\n\r\n    (0,0,0,1))\r\n\r\n  */\r\n\r\n  euler_rotate_order(x, y, z, order = EulerOrders.XYZ) {\r\n    if (y === undefined) {\r\n      y = 0.0;\r\n    }\r\n    if (z === undefined) {\r\n      z = 0.0;\r\n    }\r\n\r\n    x = -x;\r\n    y = -y;\r\n    z = -z;\r\n\r\n    let xmat = euler_rotate_mats.next().makeIdentity();\r\n\r\n    let m = xmat.$matrix;\r\n\r\n    let c = Math.cos(x), s = Math.sin(x);\r\n\r\n    m.m22 = c;\r\n    m.m23 = s;\r\n    m.m32 = -s;\r\n    m.m33 = c;\r\n\r\n    let ymat = euler_rotate_mats.next().makeIdentity();\r\n    c = Math.cos(y);\r\n    s = Math.sin(y);\r\n    m = ymat.$matrix;\r\n\r\n    m.m11 = c;\r\n    m.m13 = -s;\r\n    m.m31 = s;\r\n    m.m33 = c;\r\n\r\n    let zmat = euler_rotate_mats.next().makeIdentity();\r\n    c = Math.cos(z);\r\n    s = Math.sin(z);\r\n    m = zmat.$matrix;\r\n\r\n    m.m11 = c;\r\n    m.m12 = s;\r\n    m.m21 = -s;\r\n    m.m22 = c;\r\n\r\n    let a, b;\r\n\r\n    switch (order) {\r\n      case EulerOrders.XYZ:\r\n        a = xmat;\r\n        b = ymat;\r\n        c = zmat;\r\n        break;\r\n      case EulerOrders.XZY:\r\n        a = xmat;\r\n        b = zmat;\r\n        c = ymat;\r\n        break;\r\n      case EulerOrders.YXZ:\r\n        a = ymat;\r\n        b = xmat;\r\n        c = zmat;\r\n        break;\r\n      case EulerOrders.YZX:\r\n        a = ymat;\r\n        b = zmat;\r\n        c = xmat;\r\n        break;\r\n      case EulerOrders.ZXY:\r\n        a = zmat;\r\n        b = xmat;\r\n        c = ymat;\r\n        break;\r\n      case EulerOrders.ZYX:\r\n        a = zmat;\r\n        b = ymat;\r\n        c = xmat;\r\n        break;\r\n    }\r\n\r\n    b.preMultiply(c);\r\n    b.multiply(a);\r\n\r\n    this.preMultiply(b);\r\n\r\n    return this;\r\n  }\r\n\r\n  euler_rotate(x, y, z) {\r\n    if (y === undefined) {\r\n      y = 0.0;\r\n    }\r\n    if (z === undefined) {\r\n      z = 0.0;\r\n    }\r\n    window.Matrix4 = Matrix4;\r\n\r\n    var xmat = euler_rotate_mats.next().makeIdentity();\r\n    var m = xmat.$matrix;\r\n\r\n    var c = Math.cos(x), s = Math.sin(x);\r\n\r\n    m.m22 = c;\r\n    m.m23 = s;\r\n    m.m32 = -s;\r\n    m.m33 = c;\r\n\r\n    var ymat = euler_rotate_mats.next().makeIdentity();\r\n    c = Math.cos(y);\r\n    s = Math.sin(y);\r\n    var m = ymat.$matrix;\r\n\r\n    m.m11 = c;\r\n    m.m13 = -s;\r\n    m.m31 = s;\r\n    m.m33 = c;\r\n\r\n    ymat.multiply(xmat);\r\n\r\n    var zmat = euler_rotate_mats.next().makeIdentity();\r\n    c = Math.cos(z);\r\n    s = Math.sin(z);\r\n    var m = zmat.$matrix;\r\n\r\n    m.m11 = c;\r\n    m.m12 = s;\r\n    m.m21 = -s;\r\n    m.m22 = c;\r\n\r\n    zmat.multiply(ymat);\r\n\r\n    //console.log(\"\"+ymat);\r\n    //this.multiply(zmat);\r\n    this.preMultiply(zmat);\r\n\r\n    return this;\r\n  }\r\n\r\n  toString() {\r\n    var s = \"\"\r\n    var m = this.$matrix;\r\n\r\n    function dec(d) {\r\n      var ret = d.toFixed(3);\r\n\r\n      if (ret[0] !== \"-\") //make room for negative signs\r\n        ret = \" \" + ret\r\n      return ret\r\n    }\r\n\r\n    s = dec(m.m11) + \", \" + dec(m.m12) + \", \" + dec(m.m13) + \", \" + dec(m.m14) + \"\\n\";\r\n    s += dec(m.m21) + \", \" + dec(m.m22) + \", \" + dec(m.m23) + \", \" + dec(m.m24) + \"\\n\";\r\n    s += dec(m.m31) + \", \" + dec(m.m32) + \", \" + dec(m.m33) + \", \" + dec(m.m34) + \"\\n\";\r\n    s += dec(m.m41) + \", \" + dec(m.m42) + \", \" + dec(m.m43) + \", \" + dec(m.m44) + \"\\n\";\r\n\r\n    return s\r\n  }\r\n\r\n  rotate(angle, x, y, z) {\r\n    if (typeof x === 'object' && \"length\" in x) {\r\n      var t = x;\r\n      x = t[0];\r\n      y = t[1];\r\n      z = t[2];\r\n    } else {\r\n      if (arguments.length === 1) {\r\n        x = y = 0;\r\n        z = 1;\r\n      } else if (arguments.length === 3) {\r\n        this.rotate(angle, 1, 0, 0);\r\n        this.rotate(x, 0, 1, 0);\r\n        this.rotate(y, 0, 0, 1);\r\n        return;\r\n      }\r\n    }\r\n\r\n    angle /= 2;\r\n    var sinA = Math.sin(angle);\r\n    var cosA = Math.cos(angle);\r\n    var sinA2 = sinA*sinA;\r\n    var len = Math.sqrt(x*x + y*y + z*z);\r\n\r\n    if (len === 0) {\r\n      x = 0;\r\n      y = 0;\r\n      z = 1;\r\n    } else if (len !== 1) {\r\n      x /= len;\r\n      y /= len;\r\n      z /= len;\r\n    }\r\n\r\n    var mat = temp_mats.next().makeIdentity();\r\n\r\n    if (x === 1 && y === 0 && z === 0) {\r\n      mat.$matrix.m11 = 1;\r\n      mat.$matrix.m12 = 0;\r\n      mat.$matrix.m13 = 0;\r\n      mat.$matrix.m21 = 0;\r\n      mat.$matrix.m22 = 1 - 2*sinA2;\r\n      mat.$matrix.m23 = 2*sinA*cosA;\r\n      mat.$matrix.m31 = 0;\r\n      mat.$matrix.m32 = -2*sinA*cosA;\r\n      mat.$matrix.m33 = 1 - 2*sinA2;\r\n      mat.$matrix.m14 = mat.$matrix.m24 = mat.$matrix.m34 = 0;\r\n      mat.$matrix.m41 = mat.$matrix.m42 = mat.$matrix.m43 = 0;\r\n      mat.$matrix.m44 = 1;\r\n    } else if (x === 0 && y === 1 && z === 0) {\r\n      mat.$matrix.m11 = 1 - 2*sinA2;\r\n      mat.$matrix.m12 = 0;\r\n      mat.$matrix.m13 = -2*sinA*cosA;\r\n      mat.$matrix.m21 = 0;\r\n      mat.$matrix.m22 = 1;\r\n      mat.$matrix.m23 = 0;\r\n      mat.$matrix.m31 = 2*sinA*cosA;\r\n      mat.$matrix.m32 = 0;\r\n      mat.$matrix.m33 = 1 - 2*sinA2;\r\n      mat.$matrix.m14 = mat.$matrix.m24 = mat.$matrix.m34 = 0;\r\n      mat.$matrix.m41 = mat.$matrix.m42 = mat.$matrix.m43 = 0;\r\n      mat.$matrix.m44 = 1;\r\n    } else if (x === 0 && y === 0 && z === 1) {\r\n      mat.$matrix.m11 = 1 - 2*sinA2;\r\n      mat.$matrix.m12 = 2*sinA*cosA;\r\n      mat.$matrix.m13 = 0;\r\n      mat.$matrix.m21 = -2*sinA*cosA;\r\n      mat.$matrix.m22 = 1 - 2*sinA2;\r\n      mat.$matrix.m23 = 0;\r\n      mat.$matrix.m31 = 0;\r\n      mat.$matrix.m32 = 0;\r\n      mat.$matrix.m33 = 1;\r\n      mat.$matrix.m14 = mat.$matrix.m24 = mat.$matrix.m34 = 0;\r\n      mat.$matrix.m41 = mat.$matrix.m42 = mat.$matrix.m43 = 0;\r\n      mat.$matrix.m44 = 1;\r\n    } else {\r\n      var x2 = x*x;\r\n      var y2 = y*y;\r\n      var z2 = z*z;\r\n      mat.$matrix.m11 = 1 - 2*(y2 + z2)*sinA2;\r\n      mat.$matrix.m12 = 2*(x*y*sinA2 + z*sinA*cosA);\r\n      mat.$matrix.m13 = 2*(x*z*sinA2 - y*sinA*cosA);\r\n      mat.$matrix.m21 = 2*(y*x*sinA2 - z*sinA*cosA);\r\n      mat.$matrix.m22 = 1 - 2*(z2 + x2)*sinA2;\r\n      mat.$matrix.m23 = 2*(y*z*sinA2 + x*sinA*cosA);\r\n      mat.$matrix.m31 = 2*(z*x*sinA2 + y*sinA*cosA);\r\n      mat.$matrix.m32 = 2*(z*y*sinA2 - x*sinA*cosA);\r\n      mat.$matrix.m33 = 1 - 2*(x2 + y2)*sinA2;\r\n      mat.$matrix.m14 = mat.$matrix.m24 = mat.$matrix.m34 = 0;\r\n      mat.$matrix.m41 = mat.$matrix.m42 = mat.$matrix.m43 = 0;\r\n      mat.$matrix.m44 = 1;\r\n    }\r\n    this.multiply(mat);\r\n\r\n    return this;\r\n  }\r\n\r\n  normalize() {\r\n    let m = this.$matrix;\r\n\r\n    let v1 = new Vector4([m.m11, m.m12, m.m13, m.m14]);\r\n    let v2 = new Vector4([m.m21, m.m22, m.m23, m.m24]);\r\n    let v3 = new Vector4([m.m31, m.m32, m.m33, m.m34]);\r\n    let v4 = new Vector4([m.m41, m.m42, m.m43, m.m44]);\r\n\r\n    v1.normalize();\r\n    v2.normalize();\r\n    v3.normalize();\r\n\r\n    let flat = new Array().concat(v1).concat(v2).concat(v3).concat(v4);\r\n    this.load(flat);\r\n\r\n    return this;\r\n  }\r\n\r\n  clearTranslation(set_w_to_one = false) {\r\n    let m = this.$matrix;\r\n\r\n    m.m41 = m.m42 = m.m43 = 0.0;\r\n\r\n    if (set_w_to_one) {\r\n      m.m44 = 1.0;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  setTranslation(x, y, z, resetW = true) {\r\n    if (typeof x === \"object\") {\r\n      y = x[1];\r\n      z = x[2];\r\n      x = x[0];\r\n    }\r\n\r\n    let m = this.$matrix;\r\n\r\n    m.m41 = x;\r\n    m.m42 = y;\r\n    m.m43 = z;\r\n\r\n    if (resetW) {\r\n      m.m44 = 1.0;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  //this is really like the lookAt method, isn't it.\r\n  makeNormalMatrix(normal, up = undefined) {\r\n    if (normal === undefined) {\r\n      throw new Error(\"normal cannot be undefined\");\r\n    }\r\n\r\n    let n = makenormalcache.next().load(normal).normalize();\r\n\r\n    if (up === undefined) {\r\n      up = makenormalcache.next().zero();\r\n\r\n      if (Math.abs(n[2]) > 0.95) {\r\n        up[1] = 1.0;\r\n      } else {\r\n        up[2] = 1.0;\r\n      }\r\n    }\r\n\r\n    up = makenormalcache.next().load(up);\r\n\r\n    up.normalize();\r\n\r\n    if (up.dot(normal) > 0.99) {\r\n      this.makeIdentity();\r\n      return this;\r\n    } else if (up.dot(normal) < -0.99) {\r\n      this.makeIdentity();\r\n      this.scale(1.0, 1.0, -1.0);\r\n      return this;\r\n    }\r\n\r\n    let x = makenormalcache.next();\r\n    let y = makenormalcache.next();\r\n\r\n    x.load(n).cross(up).normalize();\r\n    y.load(x).cross(n).normalize();\r\n    //y.negate();\r\n\r\n    this.makeIdentity();\r\n    let m = this.$matrix;\r\n\r\n    m.m11 = x[0];\r\n    m.m12 = x[1];\r\n    m.m13 = x[2];\r\n\r\n    m.m21 = y[0];\r\n    m.m22 = y[1];\r\n    m.m23 = y[2];\r\n\r\n    m.m31 = n[0];\r\n    m.m32 = n[1];\r\n    m.m33 = n[2];\r\n    m.m44 = 1.0;\r\n\r\n    return this;\r\n  }\r\n\r\n  preMultiply(mat) {\r\n    preMultTemp.load(mat);\r\n    preMultTemp.multiply(this);\r\n\r\n    this.load(preMultTemp);\r\n\r\n    return this;\r\n  }\r\n\r\n  multiply(mat) {\r\n    let mm = this.$matrix;\r\n    let mm2 = mat.$matrix;\r\n\r\n    let m11 = (mm2.m11*mm.m11 + mm2.m12*mm.m21 + mm2.m13*mm.m31 + mm2.m14*mm.m41);\r\n    let m12 = (mm2.m11*mm.m12 + mm2.m12*mm.m22 + mm2.m13*mm.m32 + mm2.m14*mm.m42);\r\n    let m13 = (mm2.m11*mm.m13 + mm2.m12*mm.m23 + mm2.m13*mm.m33 + mm2.m14*mm.m43);\r\n    let m14 = (mm2.m11*mm.m14 + mm2.m12*mm.m24 + mm2.m13*mm.m34 + mm2.m14*mm.m44);\r\n    let m21 = (mm2.m21*mm.m11 + mm2.m22*mm.m21 + mm2.m23*mm.m31 + mm2.m24*mm.m41);\r\n    let m22 = (mm2.m21*mm.m12 + mm2.m22*mm.m22 + mm2.m23*mm.m32 + mm2.m24*mm.m42);\r\n    let m23 = (mm2.m21*mm.m13 + mm2.m22*mm.m23 + mm2.m23*mm.m33 + mm2.m24*mm.m43);\r\n    let m24 = (mm2.m21*mm.m14 + mm2.m22*mm.m24 + mm2.m23*mm.m34 + mm2.m24*mm.m44);\r\n    let m31 = (mm2.m31*mm.m11 + mm2.m32*mm.m21 + mm2.m33*mm.m31 + mm2.m34*mm.m41);\r\n    let m32 = (mm2.m31*mm.m12 + mm2.m32*mm.m22 + mm2.m33*mm.m32 + mm2.m34*mm.m42);\r\n    let m33 = (mm2.m31*mm.m13 + mm2.m32*mm.m23 + mm2.m33*mm.m33 + mm2.m34*mm.m43);\r\n    let m34 = (mm2.m31*mm.m14 + mm2.m32*mm.m24 + mm2.m33*mm.m34 + mm2.m34*mm.m44);\r\n    let m41 = (mm2.m41*mm.m11 + mm2.m42*mm.m21 + mm2.m43*mm.m31 + mm2.m44*mm.m41);\r\n    let m42 = (mm2.m41*mm.m12 + mm2.m42*mm.m22 + mm2.m43*mm.m32 + mm2.m44*mm.m42);\r\n    let m43 = (mm2.m41*mm.m13 + mm2.m42*mm.m23 + mm2.m43*mm.m33 + mm2.m44*mm.m43);\r\n    let m44 = (mm2.m41*mm.m14 + mm2.m42*mm.m24 + mm2.m43*mm.m34 + mm2.m44*mm.m44);\r\n\r\n    mm.m11 = m11;\r\n    mm.m12 = m12;\r\n    mm.m13 = m13;\r\n    mm.m14 = m14;\r\n    mm.m21 = m21;\r\n    mm.m22 = m22;\r\n    mm.m23 = m23;\r\n    mm.m24 = m24;\r\n    mm.m31 = m31;\r\n    mm.m32 = m32;\r\n    mm.m33 = m33;\r\n    mm.m34 = m34;\r\n    mm.m41 = m41;\r\n    mm.m42 = m42;\r\n    mm.m43 = m43;\r\n    mm.m44 = m44;\r\n\r\n    return this;\r\n  }\r\n\r\n  divide(divisor) {\r\n    this.$matrix.m11 /= divisor;\r\n    this.$matrix.m12 /= divisor;\r\n    this.$matrix.m13 /= divisor;\r\n    this.$matrix.m14 /= divisor;\r\n    this.$matrix.m21 /= divisor;\r\n    this.$matrix.m22 /= divisor;\r\n    this.$matrix.m23 /= divisor;\r\n    this.$matrix.m24 /= divisor;\r\n    this.$matrix.m31 /= divisor;\r\n    this.$matrix.m32 /= divisor;\r\n    this.$matrix.m33 /= divisor;\r\n    this.$matrix.m34 /= divisor;\r\n    this.$matrix.m41 /= divisor;\r\n    this.$matrix.m42 /= divisor;\r\n    this.$matrix.m43 /= divisor;\r\n    this.$matrix.m44 /= divisor;\r\n\r\n    return this;\r\n  }\r\n\r\n  ortho(left, right, bottom, top, near, far) {\r\n    console.warn(\"Matrix4.ortho() is deprecated, use .orthographic() instead\");\r\n\r\n    var tx = (left + right)/(left - right);\r\n    var ty = (top + bottom)/(top - bottom);\r\n    var tz = (far + near)/(far - near);\r\n    var matrix = temp_mats.next().makeIdentity();\r\n\r\n    matrix.$matrix.m11 = 2/(left - right);\r\n    matrix.$matrix.m12 = 0;\r\n    matrix.$matrix.m13 = 0;\r\n    matrix.$matrix.m14 = 0;\r\n    matrix.$matrix.m21 = 0;\r\n    matrix.$matrix.m22 = 2/(top - bottom);\r\n    matrix.$matrix.m23 = 0;\r\n    matrix.$matrix.m24 = 0;\r\n    matrix.$matrix.m31 = 0;\r\n    matrix.$matrix.m32 = 0;\r\n    matrix.$matrix.m33 = -2/(far - near);\r\n    matrix.$matrix.m34 = 0;\r\n    matrix.$matrix.m41 = tx;\r\n    matrix.$matrix.m42 = ty;\r\n    matrix.$matrix.m43 = tz;\r\n    matrix.$matrix.m44 = 1;\r\n\r\n    this.multiply(matrix);\r\n\r\n    return this;\r\n  }\r\n\r\n  frustum(left, right, bottom, top, near, far) {\r\n    var matrix = temp_mats.next().makeIdentity();\r\n\r\n    var A = (right + left)/(right - left);\r\n    var B = (top + bottom)/(top - bottom);\r\n    var C = -(far + near)/(far - near);\r\n    var D = -(2*far*near)/(far - near);\r\n\r\n    matrix.$matrix.m11 = (2*near)/(right - left);\r\n    matrix.$matrix.m12 = 0;\r\n    matrix.$matrix.m13 = 0;\r\n    matrix.$matrix.m14 = 0;\r\n    matrix.$matrix.m21 = 0;\r\n    matrix.$matrix.m22 = 2*near/(top - bottom);\r\n    matrix.$matrix.m23 = 0;\r\n    matrix.$matrix.m24 = 0;\r\n    matrix.$matrix.m31 = A;\r\n    matrix.$matrix.m32 = B;\r\n    matrix.$matrix.m33 = C;\r\n    matrix.$matrix.m34 = -1;\r\n    matrix.$matrix.m41 = 0;\r\n    matrix.$matrix.m42 = 0;\r\n    matrix.$matrix.m43 = D;\r\n    matrix.$matrix.m44 = 0;\r\n\r\n    this.isPersp = true;\r\n    this.multiply(matrix);\r\n\r\n    return this;\r\n  }\r\n\r\n  orthographic(scale, aspect, near, far) {\r\n    let mat = temp_mats.next().makeIdentity();\r\n\r\n    let zscale = far - near;\r\n\r\n    mat.scale(2.0/aspect, 2.0, -1.0/scale/zscale, 1.0/scale);\r\n    mat.translate(0.0, 0.0, 0.5*zscale - near);\r\n\r\n    this.isPersp = true; //we still make use of auto homogenous divide in BaseVector.multVecMatrix\r\n    this.multiply(mat);\r\n\r\n    return mat;\r\n  }\r\n\r\n  perspective(fovy, aspect, zNear, zFar) {\r\n    var top = Math.tan(fovy*Math.PI/360)*zNear;\r\n    var bottom = -top;\r\n    var left = aspect*bottom;\r\n    var right = aspect*top;\r\n\r\n    this.frustum(left, right, bottom, top, zNear, zFar);\r\n\r\n    return this;\r\n  }\r\n\r\n  lookat(pos, target, up) {\r\n    var matrix = lookat_cache_ms.next();\r\n    matrix.makeIdentity();\r\n\r\n    var vec = lookat_cache_vs3.next().load(pos).sub(target);\r\n    var len = vec.vectorLength();\r\n    vec.normalize();\r\n\r\n    var zvec = vec;\r\n    var yvec = lookat_cache_vs3.next().load(up).normalize();\r\n    var xvec = lookat_cache_vs3.next().load(yvec).cross(zvec).normalize();\r\n\r\n    let mm = matrix.$matrix;\r\n\r\n    mm.m11 = xvec[0];\r\n    mm.m12 = yvec[0];\r\n    mm.m13 = zvec[0];\r\n    mm.m14 = 0;\r\n    mm.m21 = xvec[1];\r\n    mm.m22 = yvec[1];\r\n    mm.m23 = zvec[1];\r\n    mm.m24 = 0;\r\n    mm.m31 = xvec[2];\r\n    mm.m32 = yvec[2];\r\n    mm.m33 = zvec[2];\r\n\r\n    //*\r\n    mm.m11 = xvec[0];\r\n    mm.m12 = xvec[1];\r\n    mm.m13 = xvec[2];\r\n    mm.m14 = 0;\r\n    mm.m21 = yvec[0];\r\n    mm.m22 = yvec[1];\r\n    mm.m23 = yvec[2];\r\n    mm.m24 = 0;\r\n    mm.m31 = zvec[0];\r\n    mm.m32 = zvec[1];\r\n    mm.m33 = zvec[2];\r\n    mm.m34 = 0;\r\n    mm.m41 = pos[0];\r\n    mm.m42 = pos[1];\r\n    mm.m43 = pos[2];\r\n    mm.m44 = 1;\r\n    //*/\r\n\r\n    this.multiply(matrix);\r\n\r\n\r\n    return this;\r\n  }\r\n\r\n  makeRotationOnly() {\r\n    var m = this.$matrix;\r\n\r\n    m.m41 = m.m42 = m.m43 = 0.0;\r\n    m.m44 = 1.0;\r\n\r\n    let l1 = Math.sqrt(m.m11*m.m11 + m.m12*m.m12 + m.m13*m.m13);\r\n    let l2 = Math.sqrt(m.m21*m.m21 + m.m22*m.m22 + m.m23*m.m23);\r\n    let l3 = Math.sqrt(m.m31*m.m31 + m.m32*m.m32 + m.m33*m.m33);\r\n\r\n    if (l1) {\r\n      m.m11 /= l1;\r\n      m.m12 /= l1;\r\n      m.m13 /= l1;\r\n    }\r\n\r\n    if (l2) {\r\n      m.m21 /= l2;\r\n      m.m22 /= l2;\r\n      m.m23 /= l2;\r\n    }\r\n\r\n    if (l3) {\r\n      m.m31 /= l3;\r\n      m.m32 /= l3;\r\n      m.m33 /= l3;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  alignAxis(axis, vec) {\r\n    vec = new Vector3(vec);\r\n    vec.normalize();\r\n\r\n    let mat = this.inputs.transformMatrix.getValue();\r\n    let m = mat.$matrix;\r\n\r\n    let mat2 = new Matrix4(mat);\r\n    let loc = new Vector3(), scale = new Vector3(), rot = new Vector3();\r\n\r\n    //we don't use rot\r\n    mat2.decompose(loc, rot, scale);\r\n\r\n    mat2.makeRotationOnly();\r\n    let axes = mat2.getAsVecs();\r\n\r\n    let axis2 = (axis + 1) % 3;\r\n    let axis3 = (axis + 2) % 3;\r\n\r\n    axes[axis].load(vec)\r\n    axes[axis2].cross(axes[axis]).cross(axes[axis])\r\n    axes[axis3].load(axes[axis]).cross(axes[axis2])\r\n\r\n    axes[0][3] = 1.0;\r\n    axes[1][3] = 1.0;\r\n    axes[2][3] = 1.0;\r\n\r\n    axes[0].normalize();\r\n    axes[1].normalize();\r\n    axes[2].normalize();\r\n\r\n    this.loadFromVecs(axes);\r\n    this.scale(scale[0], scale[1], scale[2]);\r\n\r\n    m.m41 = loc[0];\r\n    m.m42 = loc[1];\r\n    m.m43 = loc[2];\r\n\r\n    return this;\r\n  }\r\n\r\n  decompose(_translate, _rotate, _scale, _skew, _perspective, order = EulerOrders.XYZ) {\r\n    if (this.$matrix.m44 === 0)\r\n      return false;\r\n\r\n    let mat = temp_mats.next().load(this);\r\n    let m = mat.$matrix;\r\n\r\n    let t = _translate, r = _rotate, s = _scale;\r\n    if (t) {\r\n      t[0] = m.m41;\r\n      t[1] = m.m42;\r\n      t[2] = m.m43;\r\n    }\r\n\r\n    let l1 = Math.sqrt(m.m11*m.m11 + m.m12*m.m12 + m.m13*m.m13);\r\n    let l2 = Math.sqrt(m.m21*m.m21 + m.m22*m.m22 + m.m23*m.m23);\r\n    let l3 = Math.sqrt(m.m31*m.m31 + m.m32*m.m32 + m.m33*m.m33);\r\n\r\n    if (l1) {\r\n      m.m11 /= l1;\r\n      m.m12 /= l1;\r\n      m.m13 /= l1;\r\n    }\r\n    if (l2) {\r\n      m.m21 /= l2;\r\n      m.m22 /= l2;\r\n      m.m23 /= l2;\r\n    }\r\n    if (l3) {\r\n      m.m31 /= l3;\r\n      m.m32 /= l3;\r\n      m.m33 /= l3;\r\n    }\r\n\r\n    if (s) {\r\n      s[0] = l1;\r\n      s[1] = l2;\r\n      s[2] = l3;\r\n    }\r\n\r\n    if (r) { //THREE.js code\r\n      let clamp = myclamp;\r\n\r\n      let rmat = temp_mats.next().load(this);\r\n      rmat.normalize();\r\n\r\n      m = rmat.$matrix;\r\n\r\n      // assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n      let m11 = m.m11, m12 = m.m12, m13 = m.m13, m14 = m.m14;\r\n      let m21 = m.m21, m22 = m.m22, m23 = m.m23, m24 = m.m24;\r\n      let m31 = m.m31, m32 = m.m32, m33 = m.m33, m34 = m.m34;\r\n      //let m41 = m.m41, m42 = m.m42, m43 = m.m43, m44 = m.m44;\r\n\r\n      if (order === EulerOrders.XYZ) {\r\n\r\n        r[1] = Math.asin(clamp(m13, -1, 1));\r\n\r\n        if (Math.abs(m13) < 0.9999999) {\r\n\r\n          r[0] = Math.atan2(-m23, m33);\r\n          r[2] = Math.atan2(-m12, m11);\r\n\r\n        } else {\r\n\r\n          r[0] = Math.atan2(m32, m22);\r\n          r[2] = 0;\r\n\r\n        }\r\n\r\n      } else if (order === EulerOrders.YXZ) {\r\n\r\n        r[0] = Math.asin(-clamp(m23, -1, 1));\r\n\r\n        if (Math.abs(m23) < 0.9999999) {\r\n\r\n          r[1] = Math.atan2(m13, m33);\r\n          r[2] = Math.atan2(m21, m22);\r\n\r\n        } else {\r\n\r\n          r[1] = Math.atan2(-m31, m11);\r\n          r[2] = 0;\r\n\r\n        }\r\n\r\n      } else if (order === EulerOrders.ZXY) {\r\n\r\n        r[0] = Math.asin(clamp(m32, -1, 1));\r\n\r\n        if (Math.abs(m32) < 0.9999999) {\r\n\r\n          r[1] = Math.atan2(-m31, m33);\r\n          r[2] = Math.atan2(-m12, m22);\r\n\r\n        } else {\r\n\r\n          r[1] = 0;\r\n          r[2] = Math.atan2(m21, m11);\r\n\r\n        }\r\n\r\n      } else if (order === EulerOrders.ZYX) {\r\n\r\n        r[1] = Math.asin(-clamp(m31, -1, 1));\r\n\r\n        if (Math.abs(m31) < 0.9999999) {\r\n\r\n          r[0] = Math.atan2(m32, m33);\r\n          r[2] = Math.atan2(m21, m11);\r\n\r\n        } else {\r\n\r\n          r[0] = 0;\r\n          r[2] = Math.atan2(-m12, m22);\r\n\r\n        }\r\n\r\n      } else if (order === EulerOrders.YZX) {\r\n\r\n        r[2] = Math.asin(clamp(m21, -1, 1));\r\n\r\n        if (Math.abs(m21) < 0.9999999) {\r\n\r\n          r[0] = Math.atan2(-m23, m22);\r\n          r[1] = Math.atan2(-m31, m11);\r\n\r\n        } else {\r\n\r\n          r[0] = 0;\r\n          r[1] = Math.atan2(m13, m33);\r\n\r\n        }\r\n\r\n      } else if (order === EulerOrders.XZY) {\r\n\r\n        r[2] = Math.asin(-clamp(m12, -1, 1));\r\n\r\n        if (Math.abs(m12) < 0.9999999) {\r\n\r\n          r[0] = Math.atan2(m32, m22);\r\n          r[1] = Math.atan2(m13, m11);\r\n\r\n        } else {\r\n\r\n          r[0] = Math.atan2(-m23, m33);\r\n          r[1] = 0;\r\n\r\n        }\r\n\r\n      } else {\r\n        console.warn('unsupported euler order:', order);\r\n      }\r\n      //r[0] = Math.atan2(m.m23, m.m33);\r\n      //r[1] = Math.atan2(-m.m13, Math.sqrt(m.m23*m.m23 + m.m33*m.m33));\r\n      //r[2] = Math.atan2(m.m12, m.m11);\r\n    }\r\n  }\r\n\r\n  _determinant2x2(a, b, c, d) {\r\n    return a*d - b*c;\r\n  }\r\n\r\n  _determinant3x3(a1, a2, a3, b1, b2, b3, c1, c2, c3) {\r\n    return a1*this._determinant2x2(b2, b3, c2, c3) - b1*this._determinant2x2(a2, a3, c2, c3) + c1*this._determinant2x2(a2, a3, b2, b3);\r\n  }\r\n\r\n  determinant() {\r\n    return this._determinant4x4();\r\n  }\r\n\r\n  _determinant4x4() {\r\n    var a1 = this.$matrix.m11;\r\n    var b1 = this.$matrix.m12;\r\n    var c1 = this.$matrix.m13;\r\n    var d1 = this.$matrix.m14;\r\n    var a2 = this.$matrix.m21;\r\n    var b2 = this.$matrix.m22;\r\n    var c2 = this.$matrix.m23;\r\n    var d2 = this.$matrix.m24;\r\n    var a3 = this.$matrix.m31;\r\n    var b3 = this.$matrix.m32;\r\n    var c3 = this.$matrix.m33;\r\n    var d3 = this.$matrix.m34;\r\n    var a4 = this.$matrix.m41;\r\n    var b4 = this.$matrix.m42;\r\n    var c4 = this.$matrix.m43;\r\n    var d4 = this.$matrix.m44;\r\n    return a1*this._determinant3x3(b2, b3, b4, c2, c3, c4, d2, d3, d4) - b1*this._determinant3x3(a2, a3, a4, c2, c3, c4, d2, d3, d4) + c1*this._determinant3x3(a2, a3, a4, b2, b3, b4, d2, d3, d4) - d1*this._determinant3x3(a2, a3, a4, b2, b3, b4, c2, c3, c4);\r\n  }\r\n\r\n  _makeAdjoint() {\r\n    var a1 = this.$matrix.m11;\r\n    var b1 = this.$matrix.m12;\r\n    var c1 = this.$matrix.m13;\r\n    var d1 = this.$matrix.m14;\r\n    var a2 = this.$matrix.m21;\r\n    var b2 = this.$matrix.m22;\r\n    var c2 = this.$matrix.m23;\r\n    var d2 = this.$matrix.m24;\r\n    var a3 = this.$matrix.m31;\r\n    var b3 = this.$matrix.m32;\r\n    var c3 = this.$matrix.m33;\r\n    var d3 = this.$matrix.m34;\r\n    var a4 = this.$matrix.m41;\r\n    var b4 = this.$matrix.m42;\r\n    var c4 = this.$matrix.m43;\r\n    var d4 = this.$matrix.m44;\r\n\r\n    this.$matrix.m11 = this._determinant3x3(b2, b3, b4, c2, c3, c4, d2, d3, d4);\r\n    this.$matrix.m21 = -this._determinant3x3(a2, a3, a4, c2, c3, c4, d2, d3, d4);\r\n    this.$matrix.m31 = this._determinant3x3(a2, a3, a4, b2, b3, b4, d2, d3, d4);\r\n    this.$matrix.m41 = -this._determinant3x3(a2, a3, a4, b2, b3, b4, c2, c3, c4);\r\n    this.$matrix.m12 = -this._determinant3x3(b1, b3, b4, c1, c3, c4, d1, d3, d4);\r\n    this.$matrix.m22 = this._determinant3x3(a1, a3, a4, c1, c3, c4, d1, d3, d4);\r\n    this.$matrix.m32 = -this._determinant3x3(a1, a3, a4, b1, b3, b4, d1, d3, d4);\r\n    this.$matrix.m42 = this._determinant3x3(a1, a3, a4, b1, b3, b4, c1, c3, c4);\r\n    this.$matrix.m13 = this._determinant3x3(b1, b2, b4, c1, c2, c4, d1, d2, d4);\r\n    this.$matrix.m23 = -this._determinant3x3(a1, a2, a4, c1, c2, c4, d1, d2, d4);\r\n    this.$matrix.m33 = this._determinant3x3(a1, a2, a4, b1, b2, b4, d1, d2, d4);\r\n    this.$matrix.m43 = -this._determinant3x3(a1, a2, a4, b1, b2, b4, c1, c2, c4);\r\n    this.$matrix.m14 = -this._determinant3x3(b1, b2, b3, c1, c2, c3, d1, d2, d3);\r\n    this.$matrix.m24 = this._determinant3x3(a1, a2, a3, c1, c2, c3, d1, d2, d3);\r\n    this.$matrix.m34 = -this._determinant3x3(a1, a2, a3, b1, b2, b3, d1, d2, d3);\r\n    this.$matrix.m44 = this._determinant3x3(a1, a2, a3, b1, b2, b3, c1, c2, c3);\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    this.load(this.mat);\r\n    this.__mat = this.mat;\r\n    //delete this.mat;\r\n  }\r\n}\r\n\r\nMatrix4.STRUCT = `\r\nmat4 {\r\n  mat      : array(float) | this.getAsArray();\r\n  isPersp  : int          | this.isPersp;\r\n}\r\n`;\r\nnstructjs.register(Matrix4);\r\n\r\npreMultTemp = new Matrix4();\r\n\r\nwindow.testmat = (x = 0, y = 0, z = Math.PI*0.5) => {\r\n  let m1 = new Matrix4();\r\n  m1.euler_rotate(x, y, z);\r\n  //m1.scale(2.0, 0.5, 3.0);\r\n\r\n  let t = [0, 0, 0], r = [0, 0, 0], s = [0, 0, 0]\r\n\r\n  m1.decompose(t, r, s);\r\n\r\n  window.console.log(\"\\n\");\r\n  window.console.log(t);\r\n  window.console.log(r);\r\n  window.console.log(s);\r\n\r\n\r\n  let mat = m1.clone();\r\n  mat.transpose();\r\n  mat.multiply(m1);\r\n\r\n  console.log(mat.toString());\r\n  return r;\r\n}\r\n\r\nlookat_cache_ms = util.cachering.fromConstructor(Matrix4, 64);\r\neuler_rotate_mats = util.cachering.fromConstructor(Matrix4, 64);\r\ntemp_mats = util.cachering.fromConstructor(Matrix4, 64);\r\n","\"use strict\";\r\n\r\n/*\r\nthis file is a skeleton that defines the contract\r\nthat any tool property library must implement to interface with path.ux.\r\n*/\r\n\r\n//maps prop type names to integers\r\nimport * as util from \"../util/util.js\";\r\n\r\nexport let PropTypes = {\r\n  INT        : 1,\r\n  STRING     : 2,\r\n  BOOL       : 4,\r\n  ENUM       : 8,\r\n  FLAG       : 16,\r\n  FLOAT      : 32,\r\n  VEC2       : 64,\r\n  VEC3       : 128,\r\n  VEC4       : 256,\r\n  MATRIX4    : 512,\r\n  QUAT       : 1024,\r\n  PROPLIST   : 4096,\r\n  STRSET     : 8192,\r\n  CURVE      : 8192<<1,\r\n  FLOAT_ARRAY: 8192<<2,\r\n  REPORT     : 8192<<3\r\n  //ITER : 8192<<1\r\n};\r\n\r\nexport const PropSubTypes = {\r\n  COLOR: 1\r\n};\r\n\r\n//flags\r\nexport const PropFlags = {\r\n  SELECT                : 1,\r\n  PRIVATE               : 2,\r\n  LABEL                 : 4,\r\n  USE_ICONS             : 64,\r\n  USE_CUSTOM_GETSET     : 128, //used by controller.js interface\r\n  SAVE_LAST_VALUE       : 256,\r\n  READ_ONLY             : 512,\r\n  SIMPLE_SLIDER         : 1<<10,\r\n  FORCE_ROLLER_SLIDER   : 1<<11,\r\n  USE_BASE_UNDO         : 1<<12, //internal to simple_controller.js\r\n  EDIT_AS_BASE_UNIT     : 1<<13, //user textbox input should be interpreted in display unit\r\n  NO_UNDO               : 1<<14,\r\n  USE_CUSTOM_PROP_GETTER: 1<<15, //hrm, not sure I need this\r\n  FORCE_ENUM_CHECKBOXES : 1<<16,\r\n  NO_DEFAULT            : 1<<17,\r\n};\r\n\r\nexport class ToolPropertyIF {\r\n  constructor(type, subtype, apiname, uiname, description, flag, icon) {\r\n    this.data = undefined;\r\n\r\n    this.type = type;\r\n    this.subtype = subtype;\r\n\r\n    this.apiname = apiname;\r\n    this.uiname = uiname;\r\n    this.description = description;\r\n    this.flag = flag;\r\n    this.icon = icon;\r\n  }\r\n\r\n  equals(b) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  copyTo(b) {\r\n\r\n  }\r\n\r\n  copy() {\r\n\r\n  }\r\n\r\n  _fire(type, arg1, arg2) {\r\n  }\r\n\r\n  on(type, cb) {\r\n  }\r\n\r\n  off(type, cb) {\r\n  }\r\n\r\n  getValue() {\r\n  }\r\n\r\n  setValue(val) {\r\n  }\r\n\r\n  setStep(step) {\r\n  }\r\n\r\n  setRange(min, max) {\r\n  }\r\n\r\n  setUnit(unit) {\r\n  }\r\n\r\n  //some clients have seperate ui range\r\n  setUIRange(min, max) {\r\n  }\r\n\r\n  setIcon(icon) {\r\n  }\r\n}\r\n\r\nexport class StringPropertyIF extends ToolPropertyIF {\r\n  constructor() {\r\n    super(PropTypes.STRING);\r\n  }\r\n}\r\n\r\nexport class NumPropertyIF extends ToolPropertyIF {\r\n};\r\n\r\nexport class IntPropertyIF extends ToolPropertyIF {\r\n  constructor() {\r\n    super(PropTypes.INT);\r\n  }\r\n\r\n  setRadix(radix) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n}\r\n\r\nexport class FloatPropertyIF extends ToolPropertyIF {\r\n  constructor() {\r\n    super(PropTypes.FLOAT);\r\n  }\r\n\r\n  setDecimalPlaces(n) {\r\n  }\r\n}\r\n\r\nexport class EnumPropertyIF extends ToolPropertyIF {\r\n  constructor(value, valid_values) {\r\n    super(PropTypes.ENUM);\r\n\r\n    this.values = {}\r\n    this.keys = {};\r\n    this.ui_value_names = {};\r\n    this.iconmap = {};\r\n\r\n    if (valid_values === undefined) return this;\r\n\r\n    if (valid_values instanceof Array || valid_values instanceof String) {\r\n      for (var i = 0; i < valid_values.length; i++) {\r\n        this.values[valid_values[i]] = valid_values[i];\r\n        this.keys[valid_values[i]] = valid_values[i];\r\n      }\r\n    } else {\r\n      for (var k in valid_values) {\r\n        this.values[k] = valid_values[k];\r\n        this.keys[valid_values[k]] = k;\r\n      }\r\n    }\r\n\r\n    for (var k in this.values) {\r\n      var uin = k[0].toUpperCase() + k.slice(1, k.length);\r\n\r\n      uin = uin.replace(/\\_/g, \" \");\r\n      this.ui_value_names[k] = uin;\r\n    }\r\n  }\r\n\r\n  addIcons(iconmap) {\r\n    if (this.iconmap === undefined) {\r\n      this.iconmap = {};\r\n    }\r\n    for (var k in iconmap) {\r\n      this.iconmap[k] = iconmap[k];\r\n    }\r\n  }\r\n}\r\n\r\nexport class FlagPropertyIF extends EnumPropertyIF {\r\n  constructor(valid_values) {\r\n    super(PropTypes.FLAG);\r\n  }\r\n}\r\n\r\nexport class Vec2PropertyIF extends ToolPropertyIF {\r\n  constructor(valid_values) {\r\n    super(PropTypes.VEC2);\r\n  }\r\n}\r\n\r\nexport class Vec3PropertyIF extends ToolPropertyIF {\r\n  constructor(valid_values) {\r\n    super(PropTypes.VEC3);\r\n  }\r\n}\r\n\r\nexport class Vec4PropertyIF extends ToolPropertyIF {\r\n  constructor(valid_values) {\r\n    super(PropTypes.VEC4);\r\n  }\r\n}\r\n\r\n/**\r\n * List of other tool props (all of one type)\r\n */\r\nexport class ListPropertyIF extends ToolPropertyIF {\r\n  /*\r\n  * Prop must be a ToolProperty subclass instance\r\n  * */\r\n  constructor(prop) {\r\n    super(PropTypes.PROPLIST);\r\n\r\n    this.prop = prop;\r\n  }\r\n\r\n  get length() {\r\n  }\r\n\r\n  set length(val) {\r\n  }\r\n\r\n  copyTo(b) {\r\n  }\r\n\r\n  copy() {\r\n  }\r\n\r\n  /**\r\n   * clear list\r\n   * */\r\n  clear() {\r\n\r\n  }\r\n\r\n  push(item = this.prop.copy()) {\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n  }\r\n}\r\n\r\n//like FlagsProperty but uses strings\r\nexport class StringSetPropertyIF extends ToolPropertyIF {\r\n  constructor(value = undefined, definition = []) {\r\n    super(PropTypes.STRSET);\r\n  }\r\n\r\n  /*\r\n  * Values can be a string, undefined/null, or a list/set/object-literal of strings.\r\n  * If destructive is true, then existing set will be cleared.\r\n  * */\r\n  setValue(values, destructive = true, soft_fail = true) {\r\n  }\r\n\r\n  getValue() {\r\n  }\r\n\r\n  addIcons(iconmap) {\r\n  }\r\n\r\n\r\n  addUINames(map) {\r\n  }\r\n\r\n  addDescriptions(map) {\r\n  }\r\n\r\n  copyTo(b) {\r\n  }\r\n\r\n  copy() {\r\n  }\r\n}\r\n\r\nexport class Curve1DPropertyIF extends ToolPropertyIF {\r\n  constructor(curve, uiname) {\r\n    super(PropTypes.CURVE);\r\n\r\n    this.data = curve;\r\n  }\r\n\r\n  getValue() {\r\n    return this.curve;\r\n  }\r\n\r\n  setValue(curve) {\r\n    if (curve === undefined) {\r\n      return;\r\n    }\r\n\r\n    let json = JSON.parse(JSON.stringify(curve));\r\n    this.data.load(json);\r\n  }\r\n\r\n  copyTo(b) {\r\n    b.setValue(this.data);\r\n  }\r\n}\r\n\r\n","import * as util from '../path-controller/util/util.js';\r\nimport {Vector2, Vector3, Vector4, Quat, Matrix4} from '../path-controller/util/vectormath.js';\r\n\r\n/*\r\nall units convert to meters\r\n*/\r\n\r\nconst FLT_EPSILONE = 1.192092895507812e-07;\r\n\r\nfunction myfloor(f) {\r\n  return Math.floor(f + FLT_EPSILONE*2.0);\r\n}\r\n\r\nfunction normString(s) {\r\n  //remove all whitespace\r\n  s = s.replace(/ /g, \"\").replace(/\\t/g, \"\");\r\n  return s.toLowerCase();\r\n}\r\n\r\nfunction myToFixed(f, decimals) {\r\n  if (typeof f !== \"number\") {\r\n    return \"(error)\";\r\n  }\r\n\r\n  f = f.toFixed(decimals);\r\n  while (f.endsWith(\"0\") && f.search(/\\./) >= 0) {\r\n    f = f.slice(0, f.length - 1);\r\n  }\r\n\r\n  if (f.endsWith(\".\")) {\r\n    f = f.slice(0, f.length - 1);\r\n  }\r\n\r\n  if (f.length === 0)\r\n    f = \"0\";\r\n\r\n  return f.trim();\r\n}\r\n\r\nexport const Units = [];\r\n\r\nexport class Unit {\r\n  static getUnit(name) {\r\n    if (name === \"none\" || name === undefined) {\r\n      return undefined;\r\n    }\r\n\r\n    for (let cls of Units) {\r\n      if (cls.unitDefine().name === name) {\r\n        return cls;\r\n      }\r\n    }\r\n\r\n    throw new Error(\"Unknown unit \" + name);\r\n  }\r\n\r\n  static register(cls) {\r\n    Units.push(cls);\r\n  }\r\n\r\n  //subclassed static methods start here\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"\",\r\n      uiname : \"\",\r\n      type   : \"\", //e.g. distance\r\n      icon   : -1,\r\n      pattern: undefined //a re literal to validate strings\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n\r\n  }\r\n\r\n  static validate(string) {\r\n    string = normString(string);\r\n    let def = this.unitDefine();\r\n\r\n    let m = string.match(def.pattern);\r\n    if (!m)\r\n      return false;\r\n\r\n    return m[0] === string;\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n\r\n  }\r\n\r\n  static fromInternal(value) {\r\n\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n\r\n  }\r\n}\r\n\r\nexport class MeterUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"meter\",\r\n      uiname : \"Meter\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d*)?m$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    if (string.endsWith(\"m\")) {\r\n      string = string.slice(0, string.length - 1);\r\n    }\r\n\r\n    return parseFloat(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n    return \"\" + myToFixed(value, decimals) + \" m\";\r\n  }\r\n}\r\n\r\nUnit.register(MeterUnit);\r\n\r\nexport class InchUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"inch\",\r\n      uiname : \"Inch\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d*)?(in|inch)$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = string.toLowerCase();\r\n    let i = string.indexOf(\"i\");\r\n\r\n    if (i >= 0) {\r\n      string = string.slice(0, i);\r\n    }\r\n\r\n    return parseInt(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value*0.0254;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value/0.0254;\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n    return \"\" + myToFixed(value, decimals) + \"in\";\r\n  }\r\n}\r\n\r\nUnit.register(InchUnit);\r\n\r\nlet foot_re = /((-?\\d+(\\.\\d*)?ft)(-?\\d+(\\.\\d*)?(in|inch))?)|(-?\\d+(\\.\\d*)?(in|inch))$/\r\n\r\nexport class FootUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"foot\",\r\n      uiname : \"Foot\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: foot_re\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    let i = string.search(\"ft\");\r\n    let parts = [];\r\n    let vft = 0.0, vin = 0.0;\r\n\r\n    if (i >= 0) {\r\n      parts = string.split(\"ft\");\r\n      let j = parts[1].search(\"in\");\r\n\r\n      if (j >= 0) {\r\n        parts = [parts[0]].concat(parts[1].split(\"in\"));\r\n        vin = parseFloat(parts[1]);\r\n      }\r\n\r\n      vft = parseFloat(parts[0]);\r\n    } else {\r\n      string = string.replace(/in/g, \"\");\r\n      vin = parseFloat(string);\r\n    }\r\n\r\n    return vin/12.0 + vft;\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value*0.3048;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value/0.3048;\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n    let vft = myfloor(value);\r\n    let vin = ((value + FLT_EPSILONE*2)*12)%12;\r\n\r\n    if (vft === 0.0) {\r\n      return myToFixed(vin, decimals) + \" in\";\r\n    }\r\n\r\n    let s = \"\" + vft + \" ft\";\r\n    if (vin !== 0.0) {\r\n      s += \" \" + myToFixed(vin, decimals) + \" in\";\r\n    }\r\n\r\n    return s;\r\n  }\r\n}\r\n\r\nUnit.register(FootUnit);\r\n\r\n\r\nlet square_foot_re = /((-?\\d+(\\.\\d*)?ft(\\u00b2)?)(-?\\d+(\\.\\d*)?(in|inch)(\\u00b2)?)?)|(-?\\d+(\\.\\d*)?(in|inch)(\\u00b2)?)$/\r\n\r\nexport class SquareFootUnit extends FootUnit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"square_foot\",\r\n      uiname : \"Square Feet\",\r\n      type   : \"area\",\r\n      icon   : -1,\r\n      pattern: square_foot_re\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = string.replace(/\\u00b2/g, \"\");\r\n    return super.parse(string);\r\n  }\r\n\r\n\r\n  static buildString(value, decimals = 2) {\r\n    let vft = myfloor(value);\r\n    let vin = ((value + FLT_EPSILONE*2)*12)%12;\r\n\r\n    if (vft === 0.0) {\r\n      return myToFixed(vin, decimals) + \" in\\u00b2\";\r\n    }\r\n\r\n    let s = \"\" + vft + \" ft\\u00b2\";\r\n    if (vin !== 0.0) {\r\n      s += \" \" + myToFixed(vin, decimals) + \" in\\u00b2\";\r\n    }\r\n\r\n    return s;\r\n  }\r\n}\r\n\r\nUnit.register(SquareFootUnit);\r\n\r\n\r\nexport class MileUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"mile\",\r\n      uiname : \"Mile\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d+)?miles$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    string = string.replace(/miles/, \"\");\r\n    return parseFloat(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value*1609.34;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value/1609.34;\r\n  }\r\n\r\n  static buildString(value, decimals = 3) {\r\n    return \"\" + myToFixed(value, decimals) + \" miles\";\r\n  }\r\n}\r\n\r\nUnit.register(MileUnit);\r\n\r\nexport class DegreeUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"degree\",\r\n      uiname : \"Degrees\",\r\n      type   : \"angle\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d+)?(\\u00B0|degree|deg|d|degree|degrees)$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    if (string.search(\"d\") >= 0) {\r\n      string = string.slice(0, string.search(\"d\")).trim();\r\n    } else if (string.search(\"\\u00B0\") >= 0) {\r\n      string = string.slice(0, string.search(\"\\u00B0\")).trim();\r\n    }\r\n\r\n    return parseFloat(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value/180.0*Math.PI;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value*180.0/Math.PI;\r\n  }\r\n\r\n  static buildString(value, decimals = 3) {\r\n    return \"\" + myToFixed(value, decimals) + \" \\u00B0\";\r\n  }\r\n};\r\nUnit.register(DegreeUnit);\r\n\r\nexport class RadianUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"radian\",\r\n      uiname : \"Radians\",\r\n      type   : \"angle\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d+)?(r|rad|radian|radians)$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    if (string.search(\"r\") >= 0) {\r\n      string = string.slice(0, string.search(\"r\")).trim();\r\n    }\r\n\r\n    return parseFloat(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static buildString(value, decimals = 3) {\r\n    return \"\" + myToFixed(value, decimals) + \" r\";\r\n  }\r\n};\r\n\r\nUnit.register(RadianUnit);\r\n\r\nexport function setBaseUnit(unit) {\r\n  Unit.baseUnit = unit;\r\n}\r\n\r\nwindow._getBaseUnit = () => Unit.baseUnit;\r\n\r\nexport function setMetric(val) {\r\n  Unit.isMetric = val;\r\n}\r\n\r\nUnit.isMetric = true;\r\nUnit.baseUnit = \"meter\";\r\n\r\nlet numre1 = /[+\\-]?[0-9]+(\\.[0-9]*)?$/\r\nlet numre2 = /[+\\-]?[0-9]?(\\.[0-9]*)+$/\r\nlet hexre1 = /[+\\-]?[0-9a-fA-F]+h$/\r\nlet hexre2 = /[+\\-]?0x[0-9a-fA-F]+$/\r\nlet binre = /[+\\-]?0b[01]+$/\r\nlet expre = /[+\\-]?[0-9]+(\\.[0-9]*)?[eE]\\-?[0-9]+$/\r\nlet intre = /[+\\-]?[0-9]+$/\r\n\r\nfunction isnumber(s) {\r\n  s = (\"\" + s).trim();\r\n\r\n  function test(re) {\r\n    return s.search(re) === 0;\r\n  }\r\n\r\n  return test(intre) || test(numre1) || test(numre2) || test(hexre1) || test(hexre2) || test(binre) || test(expre);\r\n}\r\n\r\n\r\nexport function parseValueIntern(string, baseUnit = undefined) {\r\n  string = string.trim();\r\n  if (string[0] === \".\") {\r\n    string = \"0\" + string;\r\n  }\r\n\r\n  if (typeof baseUnit === \"string\") {\r\n    let base = Unit.getUnit(baseUnit);\r\n\r\n    if (base === undefined && baseUnit !== \"none\") {\r\n      console.warn(\"Unknown unit \" + baseUnit);\r\n      return NaN;\r\n    }\r\n\r\n    baseUnit = base;\r\n  }\r\n\r\n  //unannotated string?\r\n  if (isnumber(string)) {\r\n    //assume base unit\r\n    let f = parseFloat(string);\r\n\r\n    return f;\r\n  }\r\n\r\n  if (baseUnit === undefined) {\r\n    console.warn(\"No base unit in units.js:parseValueIntern\");\r\n  }\r\n\r\n  for (let unit of Units) {\r\n    let def = unit.unitDefine();\r\n\r\n    if (unit.validate(string)) {\r\n      console.log(unit);\r\n      let value = unit.parse(string);\r\n\r\n      if (baseUnit) {\r\n        value = unit.toInternal(value);\r\n        return baseUnit.fromInternal(value);\r\n      } else {\r\n        return value;\r\n      }\r\n    }\r\n  }\r\n\r\n  return NaN;\r\n}\r\n\r\n/* if displayUnit is undefined, final value will be converted from displayUnit to baseUnit */\r\nexport function parseValue(string, baseUnit = undefined, displayUnit = undefined) {\r\n  displayUnit = Unit.getUnit(displayUnit);\r\n  baseUnit = Unit.getUnit(baseUnit);\r\n\r\n  let f = parseValueIntern(string, displayUnit || baseUnit);\r\n\r\n  if (baseUnit) {\r\n    if (displayUnit) {\r\n      f = displayUnit.toInternal(f);\r\n    }\r\n\r\n    f = baseUnit.fromInternal(f);\r\n  }\r\n\r\n  return f;\r\n}\r\n\r\nexport function isNumber(string) {\r\n  if (isnumber(string)) {\r\n    return true;\r\n  }\r\n\r\n  for (let unit of Units) {\r\n    let def = unit.unitDefine();\r\n\r\n    if (unit.validate(string)) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nexport class PixelUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"pixel\",\r\n      uiname : \"Pixel\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d*)?px$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    if (string.endsWith(\"px\")) {\r\n      string = string.slice(0, string.length - 2).trim();\r\n    }\r\n\r\n    return parseFloat(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n    return \"\" + myToFixed(value, decimals) + \"px\";\r\n  }\r\n}\r\n\r\nUnit.register(PixelUnit);\r\n\r\nexport function convert(value, unita, unitb) {\r\n  if (typeof unita === \"string\")\r\n    unita = Unit.getUnit(unita);\r\n\r\n  if (typeof unitb === \"string\")\r\n    unitb = Unit.getUnit(unitb);\r\n\r\n  return unitb.fromInternal(unita.toInternal(value));\r\n}\r\n\r\n/**\r\n *\r\n * @param value Note: is not converted to internal unit\r\n * @param unit: Unit to use, should be a string referencing unit type, see unitDefine().name\r\n * @returns {*}\r\n */\r\nexport function buildString(value, baseUnit = Unit.baseUnit, decimalPlaces = 3, displayUnit = Unit.baseUnit) {\r\n  if (typeof baseUnit === \"string\" && baseUnit !== \"none\") {\r\n    baseUnit = Unit.getUnit(baseUnit);\r\n  }\r\n  if (typeof displayUnit === \"string\" && displayUnit !== \"none\") {\r\n    displayUnit = Unit.getUnit(displayUnit);\r\n  }\r\n\r\n\r\n  if (baseUnit !== \"none\" && displayUnit !== baseUnit && displayUnit !== \"none\") {\r\n    value = convert(value, baseUnit, displayUnit);\r\n  }\r\n\r\n  if (displayUnit !== \"none\") {\r\n    return displayUnit.buildString(value, decimalPlaces);\r\n  } else {\r\n    return myToFixed(value, decimalPlaces);\r\n  }\r\n}\r\n\r\nwindow._parseValueTest = parseValue;\r\nwindow._buildStringTest = buildString;\r\n","export let config = {\r\n  doubleClickTime : 500,\r\n\r\n  //auto load 1d bspline templates, can hurt startup time\r\n  autoLoadSplineTemplates : true,\r\n\r\n  //timeout for press-and-hold (touch) version of double clicking\r\n  doubleClickHoldTime : 750,\r\n  DEBUG : {\r\n\r\n  }\r\n};\r\n\r\nexport function setConfig(obj) {\r\n  for (let k in obj) {\r\n    config[k] = obj[k];\r\n  }\r\n}\r\n\r\nexport default config;\r\n","import * as util from \"./util.js\";\r\nimport cconst from '../config/config.js';\r\nimport {Vector2} from './vectormath.js';\r\n\r\nexport let modalstack = [];\r\nlet singleMouseCBs = {};\r\n\r\nfunction debugDomEvents() {\r\n  let cbsymbol = Symbol(\"event-callback\");\r\n  let thsymbol = Symbol(\"debug-info\");\r\n  \r\n  let idgen = 0;\r\n  \r\n  function init(et) {\r\n    if (!et[thsymbol]) {\r\n      et[thsymbol] = idgen++;\r\n    }\r\n  }\r\n  \r\n  function getkey(et, type, options) {\r\n    init(et);\r\n    return \"\" + et[thsymbol] + \":\" + type + \":\" + JSON.stringify(options);\r\n  }\r\n  \r\n  let addEventListener = EventTarget.prototype.addEventListener;\r\n  let removeEventListener = EventTarget.prototype.removeEventListener;\r\n  \r\n  EventTarget.prototype.addEventListener = function(type, cb, options) {\r\n    init(this);\r\n    \r\n    if (!cb[cbsymbol]) {\r\n      cb[cbsymbol] = new Set();\r\n    }\r\n    \r\n    let key = getkey(this, type, options);\r\n    cb[cbsymbol].add(key);\r\n    \r\n    return addEventListener.call(this, type, cb, options);\r\n  }\r\n  \r\n  EventTarget.prototype.removeEventListener = function(type, cb, options) {\r\n    init(this);\r\n    \r\n    if (!cb[cbsymbol]) {\r\n      console.error(\"Invalid callback in removeEventListener for\", type, this, cb);\r\n      return;\r\n    }\r\n    \r\n    let key = getkey(this, type, options);\r\n    \r\n    if (!cb[cbsymbol].has(key)) {\r\n      console.error(\"Callback not in removeEventListener;\", type, this, cb);\r\n      return;\r\n    }\r\n    \r\n    cb[cbsymbol].delete(key);\r\n    \r\n    return removeEventListener.call(this, type, cb, options);\r\n  }\r\n}\r\n\r\n//debugDomEvents();\r\n\r\nfunction singletonMouseEvents() {\r\n  let keys = [\"mousedown\", \"mouseup\", \"mousemove\"];\r\n  for (let k of keys) {\r\n    singleMouseCBs[k] = new Set();\r\n  }\r\n\r\n  let ddd = -1.0;\r\n  window.testSingleMouseUpEvent = (type = \"mousedown\") => {\r\n    let id = ddd++;\r\n    singleMouseEvent(() => {\r\n      console.log(\"mouse event\", id);\r\n    }, type)\r\n  };\r\n\r\n  let _mpos = new Vector2();\r\n\r\n  function doSingleCbs(e, type) {\r\n    let list = singleMouseCBs[type];\r\n    singleMouseCBs[type] = new Set();\r\n\r\n    if (e.type !== \"touchend\" && e.type !== \"touchcancel\") {\r\n      _mpos[0] = e.touches && e.touches.length > 0 ? e.touches[0].pageX : e.x;\r\n      _mpos[1] = e.touches && e.touches.length > 0 ? e.touches[0].pageY : e.y;\r\n    }\r\n\r\n    if (e.touches) {\r\n      e = copyEvent(e);\r\n\r\n      e.type = type;\r\n      if (e.touches.length > 0) {\r\n        e.x = e.pageX = e.touches[0].pageX;\r\n        e.y = e.pageY = e.touches[0].pageY;\r\n      } else {\r\n        e.x = _mpos[0];\r\n        e.y = _mpos[1];\r\n      }\r\n    }\r\n\r\n    for (let cb of list) {\r\n      try {\r\n        cb(e);\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        console.warn(\"Error in event callback\");\r\n      }\r\n    }\r\n  }\r\n\r\n  window.addEventListener(\"mouseup\", (e) => {\r\n    doSingleCbs(e, \"mouseup\");\r\n  }, {capture: true});\r\n  window.addEventListener(\"touchcancel\", (e) => {\r\n    doSingleCbs(e, \"mouseup\");\r\n  }, {capture: true});\r\n  document.addEventListener(\"touchend\", (e) => {\r\n    doSingleCbs(e, \"mouseup\");\r\n  }, {capture: true});\r\n\r\n  document.addEventListener(\"mousedown\", (e) => {\r\n    doSingleCbs(e, \"mousedown\");\r\n  }, {capture: true});\r\n  document.addEventListener(\"touchstart\", (e) => {\r\n    doSingleCbs(e, \"mousedown\");\r\n  }, {capture: true});\r\n\r\n  document.addEventListener(\"mousemove\", (e) => {\r\n    doSingleCbs(e, \"mousemove\");\r\n  }, {capture: true});\r\n  document.addEventListener(\"touchmove\", (e) => {\r\n    doSingleCbs(e, \"mousemove\");\r\n  }, {capture: true});\r\n\r\n  return {\r\n    singleMouseEvent(cb, type) {\r\n      if (!(type in singleMouseCBs)) {\r\n        throw new Error(\"not a mouse event\");\r\n      }\r\n\r\n      singleMouseCBs[type].add(cb);\r\n    }\r\n  };\r\n};\r\n\r\nsingletonMouseEvents = singletonMouseEvents();\r\n\r\n/**\r\n * adds a mouse event callback that only gets called once\r\n * */\r\nexport function singleMouseEvent(cb, type) {\r\n  return singletonMouseEvents.singleMouseEvent(cb, type);\r\n}\r\n\r\n\r\n/*tests if either the left mouse button is down,\r\n* or a touch event has happened and e.touches.length == 1*/\r\nexport function isLeftClick(e) {\r\n  if (e.touches !== undefined) {\r\n    return e.touches.length === 1;\r\n  }\r\n\r\n  return e.button === 0;\r\n}\r\n\r\nexport class DoubleClickHandler {\r\n  constructor() {\r\n    this.down = 0;\r\n    this.last = 0;\r\n    this.dblEvent = undefined;\r\n\r\n    this.start_mpos = new Vector2();\r\n\r\n    this._on_mouseup = this._on_mouseup.bind(this);\r\n    this._on_mousemove = this._on_mousemove.bind(this);\r\n  }\r\n\r\n  _on_mouseup(e) {\r\n    //console.log(\"mup\", e);\r\n    this.mdown = false;\r\n  }\r\n\r\n  _on_mousemove(e) {\r\n    let mpos = new Vector2();\r\n    mpos[0] = e.x;\r\n    mpos[1] = e.y;\r\n\r\n    let dist = mpos.vectorDistance(this.start_mpos)*devicePixelRatio;\r\n\r\n    if (dist > 11) {\r\n      //console.log(\"cancel\", dist);\r\n      this.mdown = false;\r\n    }\r\n\r\n    if (this.mdown) {\r\n      singleMouseEvent(this._on_mousemove, \"mousemove\");\r\n    }\r\n\r\n    this.update();\r\n  }\r\n\r\n  mousedown(e) {\r\n    //console.log(\"mdown\", e.x, e.y);\r\n\r\n    if (!this.last) {\r\n      this.last = 0;\r\n    }\r\n    if (!this.down) {\r\n      this.down = 0;\r\n    }\r\n    if (!this.up) {\r\n      this.up = 0;\r\n    }\r\n\r\n    if (isMouseDown(e)) {\r\n      this.mdown = true;\r\n\r\n      let cpy = Object.assign({}, e);\r\n\r\n      this.start_mpos[0] = e.x;\r\n      this.start_mpos[1] = e.y;\r\n\r\n      singleMouseEvent(this._on_mousemove, \"mousemove\");\r\n\r\n      if (e.type.search(\"touch\") >= 0 && e.touches.length > 0) {\r\n        cpy.x = cpy.pageX = e.touches[0].pageX;\r\n        cpy.y = cpy.pageY = e.touches[1].pageY;\r\n      } else {\r\n        cpy.x = cpy.pageX = e.x;\r\n        cpy.y = cpy.pageY = e.y;\r\n      }\r\n\r\n      //stupid real MouseEvent class zeros .x/.y\r\n      //continue using hackish copyEvent for now...\r\n\r\n      this.dblEvent = copyEvent(e);\r\n      this.dblEvent.type = \"dblclick\";\r\n\r\n      this.last = this.down;\r\n      this.down = util.time_ms();\r\n\r\n      if (this.down - this.last < cconst.doubleClickTime) {\r\n        this.mdown = false;\r\n        this.ondblclick(this.dblEvent);\r\n\r\n        this.down = this.last = 0.0;\r\n      } else {\r\n        singleMouseEvent(this._on_mouseup, \"mouseup\");\r\n      }\r\n    } else {\r\n      this.mdown = false;\r\n    }\r\n  }\r\n\r\n  //you may override this\r\n  ondblclick(e) {\r\n\r\n  }\r\n\r\n  update() {\r\n    if (modalstack.length > 0) {\r\n      //cancel double click requests\r\n      this.mdown = false;\r\n    }\r\n\r\n    if (this.mdown && util.time_ms() - this.down > cconst.doubleClickHoldTime) {\r\n      this.mdown = false;\r\n      this.ondblclick(this.dblEvent);\r\n    }\r\n  }\r\n\r\n  abort() {\r\n    this.last = this.down = 0;\r\n  }\r\n}\r\n\r\nexport function isMouseDown(e) {\r\n  let mdown = 0;\r\n\r\n  if (e.touches !== undefined) {\r\n    mdown = e.touches.length > 0;\r\n  } else {\r\n    mdown = e.buttons;\r\n  }\r\n\r\n  mdown = mdown & 1;\r\n\r\n  return mdown;\r\n}\r\n\r\nexport function pathDebugEvent(e, extra) {\r\n  e.__prevdef = e.preventDefault;\r\n  e.__stopprop = e.stopPropagation;\r\n\r\n  e.preventDefault = function () {\r\n    console.warn(\"preventDefault\", extra);\r\n    return this.__prevdef();\r\n  };\r\n\r\n  e.stopPropagation = function () {\r\n    console.warn(\"stopPropagation\", extra);\r\n    return this.__stopprop();\r\n  }\r\n}\r\n\r\n/** Returns true if event came from a touchscreen or pen device */\r\nexport function eventWasTouch(e) {\r\n  let ret = e.sourceCapabilities && e.sourceCapabilities.firesTouchEvents;\r\n  ret = ret || e.was_touch;\r\n  ret = ret || e instanceof TouchEvent;\r\n  ret = ret || e.touches !== undefined;\r\n\r\n  if (e instanceof PointerEvent) {\r\n    ret = ret || (e.pointerType === \"pen\" || e.pointerType === \"touch\");\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nexport function copyEvent(e) {\r\n  let ret = {};\r\n  let keys = [];\r\n\r\n  for (let k in e) {\r\n    keys.push(k);\r\n  }\r\n\r\n  keys = keys.concat(Object.getOwnPropertySymbols(e));\r\n  keys = keys.concat(Object.getOwnPropertyNames(e));\r\n\r\n  for (let k of keys) {\r\n    let v;\r\n\r\n    try {\r\n      v = e[k];\r\n    } catch (error) {\r\n      console.warn(\"read error for event key\", k);\r\n      continue;\r\n    }\r\n\r\n    if (typeof v == \"function\") {\r\n      ret[k] = v.bind(e);\r\n    } else {\r\n      ret[k] = v;\r\n    }\r\n  }\r\n\r\n  ret.original = e;\r\n\r\n  return ret;\r\n}\r\n\r\nlet Screen;\r\n\r\nexport function _setScreenClass(cls) {\r\n  Screen = cls;\r\n}\r\n\r\nfunction findScreen() {\r\n  let rec = (n) => {\r\n    for (let n2 of n.childNodes) {\r\n      if (n2 && typeof n2 === \"object\" && n2 instanceof Screen) {\r\n        return n2;\r\n      }\r\n    }\r\n\r\n    for (let n2 of n.childNodes) {\r\n      let ret = rec(n2);\r\n      if (ret) {\r\n        return ret;\r\n      }\r\n    }\r\n  };\r\n\r\n  return rec(document.body);\r\n}\r\n\r\nwindow._findScreen = findScreen;\r\n\r\nlet ContextAreaClass;\r\n\r\nexport function _setModalAreaClass(cls) {\r\n  ContextAreaClass = cls;\r\n}\r\n\r\nexport function pushPointerModal(obj, elem, pointerId, autoStopPropagation = true) {\r\n  return pushModalLight(obj, autoStopPropagation, elem, pointerId);\r\n}\r\n\r\nexport function pushModalLight(obj, autoStopPropagation = true, elem, pointerId) {\r\n  let keys;\r\n\r\n  if (pointerId === undefined) {\r\n    keys = new Set([\r\n      \"keydown\", \"keyup\", \"keypress\", \"mousedown\", \"mouseup\", \"touchstart\", \"touchend\",\r\n      \"touchcancel\", \"mousewheel\", \"mousemove\", \"mouseover\", \"mouseout\", \"mouseenter\",\r\n      \"mouseleave\", \"dragstart\", \"drag\", \"dragend\", \"dragexit\", \"dragleave\", \"dragover\",\r\n      \"dragenter\", \"drop\", \"pointerdown\", \"pointermove\", \"pointerup\", \"pointercancel\",\r\n      \"pointerstart\", \"pointerend\", \"pointerleave\", \"pointerexit\", \"pointerenter\",\r\n      \"pointerover\"\r\n    ]);\r\n  } else {\r\n    keys = new Set([\r\n      \"keydown\", \"keyup\", \"keypress\", \"mousewheel\"\r\n    ]);\r\n  }\r\n\r\n  let ret = {\r\n    keys     : keys,\r\n    handlers : {},\r\n    last_mpos: [0, 0]\r\n  };\r\n\r\n  let touchmap = {\r\n    \"touchstart\" : \"mousedown\",\r\n    \"touchmove\"  : \"mousemove\",\r\n    \"touchend\"   : \"mouseup\",\r\n    \"touchcancel\": \"mouseup\"\r\n  };\r\n\r\n  let mpos = [0, 0];\r\n\r\n  let screen = findScreen();\r\n  if (screen) {\r\n    mpos[0] = screen.mpos[0];\r\n    mpos[1] = screen.mpos[1];\r\n    screen = undefined;\r\n  }\r\n\r\n  function handleAreaContext() {\r\n    let screen = findScreen();\r\n    if (screen) {\r\n      let sarea = screen.findScreenArea(mpos[0], mpos[1]);\r\n      if (sarea && sarea.area) {\r\n        sarea.area.push_ctx_active();\r\n        sarea.area.pop_ctx_active();\r\n      }\r\n    }\r\n  }\r\n\r\n  function make_default_touchhandler(type, state) {\r\n    return function (e) {\r\n      //console.warn(\"touch event!\", type, touchmap[type], e.touches.length);\r\n      if (cconst.DEBUG.domEvents) {\r\n        pathDebugEvent(e);\r\n      }\r\n\r\n      if (touchmap[type] in ret.handlers) {\r\n        let type2 = touchmap[type];\r\n\r\n        let e2 = copyEvent(e);\r\n\r\n        e2.was_touch = true;\r\n        e2.type = type2;\r\n        e2.button = type == \"touchcancel\" ? 1 : 0;\r\n        e2.touches = e.touches;\r\n\r\n        if (e.touches.length > 0) {\r\n          let dpi = window.devicePixelRatio; //UIBase.getDPI();\r\n          let t = e.touches[0];\r\n\r\n          mpos[0] = t.pageX;\r\n          mpos[1] = t.pageY;\r\n\r\n          e2.pageX = e2.x = t.pageX;// * dpi;\r\n          e2.pageY = e2.y = t.pageY;// * dpi;\r\n          e2.clientX = t.clientX;// * dpi;\r\n          e2.clientY = t.clientY;// * dpi;\r\n          e2.x = t.clientX;// * dpi;\r\n          e2.y = t.clientY;// * dpi;\r\n\r\n          ret.last_mpos[0] = e2.x;\r\n          ret.last_mpos[1] = e2.y;\r\n        } else {\r\n          e2.x = e2.clientX = e2.pageX = e2.screenX = ret.last_mpos[0];\r\n          e2.y = e2.clientY = e2.pageY = e2.screenY = ret.last_mpos[1];\r\n        }\r\n\r\n        e2.was_touch = true;\r\n\r\n        handleAreaContext();\r\n        //console.log(e2.x, e2.y);\r\n        ret.handlers[type2](e2);\r\n      }\r\n\r\n      if (autoStopPropagation) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n    }\r\n  }\r\n\r\n  function make_handler(type, key) {\r\n    return function (e) {\r\n      if (cconst.DEBUG.domEvents) {\r\n        pathDebugEvent(e);\r\n      }\r\n\r\n      if (typeof key !== \"string\") {\r\n        //console.warn(\"key was undefined\", key, type);\r\n        return;\r\n      }\r\n\r\n      if (key.startsWith(\"mouse\")) {\r\n        mpos[0] = e.pageX;\r\n        mpos[1] = e.pageY;\r\n      }\r\n\r\n      handleAreaContext();\r\n\r\n      if (key !== undefined)\r\n        obj[key](e);\r\n\r\n      if (autoStopPropagation) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n    }\r\n  }\r\n\r\n  let found = {};\r\n\r\n  for (let k of keys) {\r\n    let key;\r\n\r\n    if (obj[k])\r\n      key = k;\r\n    else if (obj[\"on\" + k])\r\n      key = \"on\" + k;\r\n    else if (obj[\"on_\" + k])\r\n      key = \"on_\" + k;\r\n    else if (k in touchmap)\r\n      continue; //default touch event handlers will be done seperately\r\n    else\r\n      key = undefined; //make handler that still blocks events\r\n\r\n    //check we don't override other mouse pointer event handlers\r\n    if (key === undefined && k.search(\"pointer\") === 0) {\r\n      continue;\r\n    }\r\n\r\n    if (key !== undefined) {\r\n      found[k] = 1;\r\n    }\r\n\r\n    let handler = make_handler(k, key);\r\n    ret.handlers[k] = handler;\r\n\r\n    let settings = handler.settings = {passive: false, capture: true};\r\n    window.addEventListener(k, handler, settings);\r\n  }\r\n\r\n  for (let k in touchmap) {\r\n    if (!(k in found)) {\r\n      //console.log(\"making touch handler for\", '\"' + k + '\"', ret.handlers[k]);\r\n\r\n      ret.handlers[k] = make_default_touchhandler(k, ret);\r\n\r\n      let settings = ret.handlers[k].settings = {passive: false, capture: true};\r\n      window.addEventListener(k, ret.handlers[k], settings);\r\n    }\r\n  }\r\n\r\n  if (pointerId !== undefined) {\r\n    ret.pointer = {\r\n      elem, pointerId\r\n    };\r\n\r\n    function make_pointer(k) {\r\n      let k2 = \"on_\" + k;\r\n\r\n      ret.pointer[k] = function (e) {\r\n        if (obj[k2] !== undefined) {\r\n          obj[k2](e);\r\n        }\r\n\r\n        if (autoStopPropagation) {\r\n          e.stopPropagation();\r\n          e.preventDefault();\r\n        }\r\n      }\r\n    }\r\n\r\n    make_pointer(\"pointerdown\");\r\n    make_pointer(\"pointermove\");\r\n    make_pointer(\"pointerup\");\r\n    make_pointer(\"pointerstart\");\r\n    make_pointer(\"pointerend\");\r\n    make_pointer(\"pointerleave\");\r\n    make_pointer(\"pointerenter\");\r\n    make_pointer(\"pointerout\");\r\n    make_pointer(\"pointerover\");\r\n    make_pointer(\"pointerexit\");\r\n    make_pointer(\"pointercancel\");\r\n\r\n    for (let k in ret.pointer) {\r\n      if (k !== \"elem\" && k !== \"pointerId\") {\r\n        elem.addEventListener(k, ret.pointer[k]);\r\n      }\r\n    }\r\n\r\n    try {\r\n      elem.setPointerCapture(pointerId)\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n\r\n      console.log(\"attempting fallback\");\r\n      \r\n      for (let k in ret.pointer) {\r\n        if (k !== \"elem\" && k !== \"pointerId\") {\r\n          elem.removeEventListener(k, ret.pointer[k]);\r\n        }\r\n      }\r\n\r\n      delete ret.pointer;\r\n\r\n      modalstack.push(ret);\r\n      popModalLight(ret);\r\n\r\n      for (let k in obj) {\r\n        if (k === \"pointercancel\" || k === \"pointerend\" || k === \"pointerstart\") {\r\n          continue;\r\n        }\r\n\r\n        if (k.startsWith(\"pointer\")) {\r\n          let k2 = k.replace(/pointer/, \"mouse\");\r\n          if (k2 in obj) {\r\n            console.warn(\"warning, existing mouse handler\", k2);\r\n            continue;\r\n          }\r\n\r\n          let v = obj[k];\r\n          obj[k] = undefined;\r\n\r\n          obj[k2] = v;\r\n        }\r\n      }\r\n\r\n      console.log(obj);\r\n\r\n      return pushModalLight(obj, autoStopPropagation);\r\n    }\r\n  }\r\n\r\n  modalstack.push(ret);\r\n  ContextAreaClass.lock();\r\n\r\n  if (cconst.DEBUG.modalEvents) {\r\n    console.warn(\"pushModalLight\", ret.pointer ? \"(pointer events)\" : \"\");\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nif (0) {\r\n  let addevent = EventTarget.prototype.addEventListener;\r\n  let remevent = EventTarget.prototype.removeEventListener;\r\n\r\n  const funckey = Symbol(\"eventfunc\");\r\n\r\n  EventTarget.prototype.addEventListener = function (name, func, args) {\r\n    //if (name.startsWith(\"key\")) {\r\n    console.warn(\"listener added\", name, func, args);\r\n    //}\r\n\r\n    let func2 = function (e) {\r\n      let proxy = new Proxy(e, {\r\n        get(target, p, receiver) {\r\n          if (p === \"preventDefault\") {\r\n            return function () {\r\n              console.warn(\"preventDefault\", name, arguments);\r\n              return e.preventDefault(...arguments);\r\n            }\r\n          } else if (p === \"stopPropagation\") {\r\n            return function () {\r\n              console.warn(\"stopPropagation\", name, arguments);\r\n              return e.preventDefault(...arguments);\r\n            }\r\n          }\r\n\r\n          return e[p];\r\n        }\r\n      });\r\n\r\n      return func.call(this, proxy);\r\n    }\r\n\r\n    func[funckey] = func2;\r\n\r\n    return addevent.call(this, name, func2, args);\r\n  }\r\n\r\n  EventTarget.prototype.removeEventListener = function (name, func, args) {\r\n    //if (name.startsWith(\"key\")) {\r\n    console.warn(\"listener removed\", name, func, args);\r\n    //}\r\n\r\n    func = func[funckey];\r\n\r\n    return remevent.call(this, name, func, args);\r\n  }\r\n}\r\n\r\nexport function popModalLight(state) {\r\n  if (state === undefined) {\r\n    console.warn(\"Bad call to popModalLight: state was undefined\");\r\n    return;\r\n  }\r\n\r\n  if (state !== modalstack[modalstack.length - 1]) {\r\n    if (modalstack.indexOf(state) < 0) {\r\n      console.warn(\"Error in popModalLight; modal handler not found\");\r\n      return;\r\n    } else {\r\n      console.warn(\"Error in popModalLight; called in wrong order\");\r\n    }\r\n  }\r\n\r\n  for (let k in state.handlers) {\r\n    //console.log(k);\r\n    window.removeEventListener(k, state.handlers[k], state.handlers[k].settings);\r\n  }\r\n\r\n  state.handlers = {};\r\n  modalstack.remove(state);\r\n  ContextAreaClass.unlock();\r\n\r\n  if (cconst.DEBUG.modalEvents) {\r\n    console.warn(\"popModalLight\", modalstack, state.pointer ? \"(pointer events)\" : \"\");\r\n  }\r\n\r\n  if (state.pointer) {\r\n    let elem = state.pointer.elem;\r\n\r\n    try {\r\n      elem.releasePointerCapture(state.pointer.pointerId);\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n    }\r\n\r\n    for (let k in state.pointer) {\r\n      if (k !== \"elem\" && k !== \"pointerId\") {\r\n        elem.removeEventListener(k, state.pointer[k]);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport function haveModal() {\r\n  return modalstack.length > 0;\r\n}\r\n\r\nwindow._haveModal = haveModal; //for debugging console\r\n\r\nexport var keymap_latin_1 = {\r\n  \"Space\" : 32,\r\n  \"Escape\": 27,\r\n  \"Enter\" : 13,\r\n  \"Return\": 13,\r\n  \"Up\"    : 38,\r\n  \"Down\"  : 40,\r\n  \"Left\"  : 37,\r\n  \"Right\" : 39,\r\n\r\n  \"Num0\"     : 96,\r\n  \"Num1\"     : 97,\r\n  \"Num2\"     : 98,\r\n  \"Num3\"     : 99,\r\n  \"Num4\"     : 100,\r\n  \"Num5\"     : 101,\r\n  \"Num6\"     : 102,\r\n  \"Num7\"     : 103,\r\n  \"Num8\"     : 104,\r\n  \"Num9\"     : 105,\r\n  \"Home\"     : 36,\r\n  \"End\"      : 35,\r\n  \"Delete\"   : 46,\r\n  \"Backspace\": 8,\r\n  \"Insert\"   : 45,\r\n  \"PageUp\"   : 33,\r\n  \"PageDown\" : 34,\r\n  \"Tab\"      : 9,\r\n  \"-\"        : 189,\r\n  \"=\"        : 187,\r\n  \".\"        : 190,\r\n  \"/\"        : 191,\r\n  \",\"        : 188,\r\n  \";\"        : 186,\r\n  \"'\"        : 222,\r\n  \"[\"        : 219,\r\n  \"]\"        : 221,\r\n  \"NumPlus\"  : 107,\r\n  \"NumMinus\" : 109,\r\n  \"Shift\"    : 16,\r\n  \"Ctrl\"     : 17,\r\n  \"Control\"  : 17,\r\n  \"Alt\"      : 18\r\n}\r\n\r\nfor (var i = 0; i < 26; i++) {\r\n  keymap_latin_1[String.fromCharCode(i + 65)] = i + 65\r\n}\r\nfor (var i = 0; i < 10; i++) {\r\n  keymap_latin_1[String.fromCharCode(i + 48)] = i + 48\r\n}\r\n\r\nfor (var k in keymap_latin_1) {\r\n  if (!(k in keymap_latin_1)) {\r\n    keymap_latin_1[keymap_latin_1[k]] = k;\r\n  }\r\n}\r\n\r\nvar keymap_latin_1_rev = {}\r\nfor (var k in keymap_latin_1) {\r\n  keymap_latin_1_rev[keymap_latin_1[k]] = k\r\n}\r\n\r\nexport var keymap = keymap_latin_1;\r\nexport var reverse_keymap = keymap_latin_1_rev;\r\n\r\nexport class HotKey {\r\n  /**action can be a callback or a toolpath string*/\r\n  constructor(key, modifiers, action, uiname) {\r\n    this.action = action;\r\n    this.mods = modifiers;\r\n    this.key = keymap[key];\r\n    this.uiname = uiname;\r\n  }\r\n\r\n  exec(ctx) {\r\n    if (typeof this.action == \"string\") {\r\n      ctx.api.execTool(ctx, this.action);\r\n    } else {\r\n      this.action(ctx);\r\n    }\r\n  }\r\n\r\n  buildString() {\r\n    let s = \"\";\r\n\r\n    for (let i = 0; i < this.mods.length; i++) {\r\n      if (i > 0) {\r\n        s += \" + \";\r\n      }\r\n\r\n      let k = this.mods[i].toLowerCase();\r\n      k = k[0].toUpperCase() + k.slice(1, k.length).toLowerCase();\r\n\r\n      s += k;\r\n    }\r\n\r\n    if (this.mods.length > 0) {\r\n      s += \"+\";\r\n    }\r\n\r\n    s += reverse_keymap[this.key];\r\n\r\n    return s.trim();\r\n  }\r\n}\r\n\r\nexport class KeyMap extends Array {\r\n  /**\r\n   *\r\n   * @param pathid{string} Id of keymap, used when patching hotkeys, when\r\n   *                       that is implemented\r\n   * */\r\n  constructor(hotkeys = [], pathid = \"undefined\") {\r\n    super();\r\n\r\n    this.pathid = pathid;\r\n\r\n    for (let hk of hotkeys) {\r\n      this.add(hk);\r\n    }\r\n  }\r\n\r\n  handle(ctx, e) {\r\n    let mods = new util.set();\r\n    if (e.shiftKey)\r\n      mods.add(\"shift\");\r\n    if (e.altKey)\r\n      mods.add(\"alt\");\r\n    if (e.ctrlKey) {\r\n      mods.add(\"ctrl\");\r\n    }\r\n    if (e.commandKey) {\r\n      mods.add(\"command\");\r\n    }\r\n\r\n    for (let hk of this) {\r\n      let ok = e.keyCode === hk.key;\r\n      if (!ok) continue;\r\n\r\n      let count = 0;\r\n      for (let m of hk.mods) {\r\n        m = m.toLowerCase().trim();\r\n\r\n        if (!mods.has(m)) {\r\n          ok = false;\r\n          break;\r\n        }\r\n\r\n        count++;\r\n      }\r\n\r\n      if (count !== mods.length) {\r\n        ok = false;\r\n      }\r\n\r\n      if (ok) {\r\n        try {\r\n          hk.exec(ctx);\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n          console.log(\"failed to execute a hotkey\", keymap[e.keyCode]);\r\n        }\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n\r\n  add(hk) {\r\n    this.push(hk);\r\n  }\r\n\r\n  push(hk) {\r\n    super.push(hk);\r\n  }\r\n}\r\n\r\n","\"use strict\";\r\n\r\nimport * as util from './util.js';\r\nimport * as simple_events from './simple_events.js';\r\n\r\nexport {keymap, reverse_keymap, keymap_latin_1} from './simple_events.js';\r\n\r\nexport class EventDispatcher {\r\n  constructor() {\r\n    this._cbs = {};\r\n  }\r\n\r\n  _fireEvent(type, data) {\r\n    let stop = false;\r\n\r\n    data = {\r\n      stopPropagation() {\r\n        stop = true;\r\n      },\r\n\r\n      data : data\r\n    };\r\n\r\n    if (type in this._cbs) {\r\n      for (let cb of this._cbs[type]) {\r\n        cb(data);\r\n        if (stop) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  on(type, cb) {\r\n    if (!(type in this._cbs)) {\r\n      this._cbs[type] = [];\r\n    }\r\n\r\n    this._cbs[type].push(cb);\r\n    return this;\r\n  }\r\n\r\n  off(type, cb) {\r\n    if (!(type in this._cbs)) {\r\n      console.warn(\"event handler not in list\", type, cb);\r\n      return this;\r\n    }\r\n\r\n    let stack = this._cbs[type];\r\n    if (stack.indexOf(cb) < 0) {\r\n      console.warn(\"event handler not in list\", type, cb);\r\n      return this;\r\n    }\r\n\r\n    stack.remove(cb);\r\n    return this;\r\n  }\r\n}\r\nexport function copyMouseEvent(e) {\r\n  let ret = {};\r\n  \r\n  function bind(func, obj) {\r\n    return function() {\r\n      return this._orig.apply(func, arguments);\r\n    }\r\n  }\r\n  \r\n  let exclude = new Set([\r\n    //\"prototype\",\r\n    //\"constructor\",\r\n    \"__proto__\"\r\n  ]);\r\n  \r\n  ret._orig = e;\r\n  \r\n  for (let k in e) {\r\n    let v = e[k];\r\n    \r\n    if (exclude.has(k)) {\r\n      continue;\r\n    }\r\n    \r\n    if (typeof v == \"function\") {\r\n      v = bind(v);\r\n    }\r\n    \r\n    ret[k] = v;\r\n  }\r\n\r\n  ret.ctrlKey = e.ctrlKey;\r\n  ret.shiftKey = e.shiftKey;\r\n  ret.altKey = e.altKey;\r\n\r\n  for (let i=0; i<2; i++) {\r\n    let key = i ? \"targetTouches\" : \"touches\";\r\n\r\n    if (e[key]) {\r\n      ret[key] = [];\r\n\r\n      for (let t of e[key]) {\r\n        let t2 = {};\r\n        ret[key].push(t2);\r\n\r\n        for (let k in t) {\r\n          t2[k] = t[k];\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nexport const DomEventTypes = {\r\n  on_mousemove   : 'mousemove',\r\n  on_mousedown   : 'mousedown',\r\n  on_mouseup     : 'mouseup',\r\n  on_touchstart  : 'touchstart',\r\n  on_touchcancel : 'touchcanel',\r\n  on_touchmove   : 'touchmove',\r\n  on_touchend    : 'touchend',\r\n  on_mousewheel  : 'mousewheel',\r\n  on_keydown     : 'keydown',\r\n  on_keyup       : 'keyup',\r\n  on_pointerdown : 'pointerdown',\r\n  on_pointermove : 'pointermove',\r\n  on_pointercancel : 'pointercancel',\r\n  on_pointerup   : 'pointerup',\r\n\r\n  //on_keypress    : 'keypress'\r\n};\r\n\r\nfunction getDom(dom, eventtype) {\r\n  if (eventtype.startsWith(\"key\"))\r\n    return window;\r\n  return dom;\r\n}\r\n\r\nexport let modalStack = [];\r\nexport function isModalHead(owner) {\r\n  return modalStack.length === 0 ||\r\n         modalStack[modalStack.length-1] === owner;\r\n}\r\n\r\nexport class EventHandler {\r\n  pushPointerModal(dom, pointerId) {\r\n    if (this._modalstate) {\r\n      console.warn(\"pushPointerModal called twiced!\");\r\n      return;\r\n    }\r\n    \r\n    this._modalstate = simple_events.pushPointerModal(this, dom, pointerId);\r\n  }\r\n  pushModal(dom, _is_root) {\r\n    if (this._modalstate) {\r\n      console.warn(\"pushModal called twiced!\");\r\n      return;\r\n    }\r\n    \r\n    this._modalstate = simple_events.pushModalLight(this);\r\n  }\r\n  \r\n  popModal() {\r\n    if (this._modalstate !== undefined) {\r\n      let modalstate = this._modalstate;\r\n\r\n      //window.setTimeout(() => {\r\n        simple_events.popModalLight(modalstate);\r\n      //});\r\n\r\n      this._modalstate = undefined;\r\n    }\r\n  }\r\n}\r\n\r\nexport function pushModal(dom, handlers) {\r\n  console.warn(\"Deprecated call to pathux.events.pushModal; use api in simple_events.js instead\");\r\n  let h = new EventHandler();\r\n  \r\n  for (let k in handlers) {\r\n    h[k] = handlers[k];\r\n  }\r\n  \r\n  handlers.popModal = () => {\r\n    return h.popModal(dom);\r\n  }\r\n  \r\n  h.pushModal(dom, false);\r\n  \r\n  return h;\r\n}\r\n","import nstructjs from \"../util/struct.js\";\r\nimport * as util from '../util/util.js';\r\n\r\nexport const CurveConstructors = [];\r\nexport const CURVE_VERSION = 1.0;\r\n\r\nexport const CurveFlags = {\r\n  SELECT: 1\r\n};\r\n\r\n\r\nexport const TangentModes = {\r\n  SMOOTH: 1,\r\n  BREAK : 2\r\n};\r\n\r\nexport function getCurve(type, throw_on_error = true) {\r\n  for (let cls of CurveConstructors) {\r\n    if (cls.name === type)\r\n      return cls;\r\n    if (cls.define().name === type)\r\n      return cls;\r\n  }\r\n\r\n  if (throw_on_error) {\r\n    throw new Error(\"Unknown curve type \" + type)\r\n  } else {\r\n    console.warn(\"Unknown curve type\", type);\r\n    return getCurve(\"ease\");\r\n  }\r\n}\r\n\r\nlet _udigest = new util.HashDigest();\r\n\r\nexport class CurveTypeData {\r\n  constructor() {\r\n    this.type = this.constructor.define().typeName;\r\n  }\r\n\r\n  get hasGUI() {\r\n    throw new Error(\"get hasGUI(): implement me!\");\r\n  }\r\n\r\n  static register(cls) {\r\n    if (cls.define === CurveTypeData.define) {\r\n      throw new Error(\"missing define() static method\");\r\n    }\r\n\r\n    let def = cls.define();\r\n\r\n    if (!def.name) {\r\n      throw new Error(cls.name + \".define() result is missing 'name' field\");\r\n    }\r\n\r\n    if (!def.typeName) {\r\n      throw new Error(cls.name + \".define() is missing .typeName, which should equal class name; needed for minificaiton\");\r\n    }\r\n\r\n    CurveConstructors.push(cls);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      uiname  : \"Some Curve\",\r\n      name    : \"somecurve\",\r\n      typeName: CurveTypeData\r\n    }\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    let d = digest;\r\n\r\n    d.add(this.type);\r\n\r\n    return d.get();\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      type: this.type\r\n    }\r\n  }\r\n\r\n  equals(b) {\r\n    return this.type === b.type;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    this.type = obj.type;\r\n\r\n    return this;\r\n  }\r\n\r\n  redraw() {\r\n    if (this.parent)\r\n      this.parent.redraw();\r\n  }\r\n\r\n  makeGUI(container) {\r\n\r\n  }\r\n\r\n  killGUI(container) {\r\n    container.clear();\r\n  }\r\n\r\n  evaluate(s) {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  integrate(s1, quadSteps = 64) {\r\n    let ret = 0.0, ds = s1/quadSteps;\r\n\r\n    for (let i = 0, s = 0; i < quadSteps; i++, s += ds) {\r\n      ret += this.evaluate(s)*ds;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  derivative(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.evaluate(s) - this.evaluate(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.evaluate(s + df) - this.evaluate(s))/df;\r\n    } else {\r\n      return (this.evaluate(s + df) - this.evaluate(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  derivative2(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.derivative(s) - this.derivative(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.derivative(s + df) - this.derivative(s))/df;\r\n    } else {\r\n      return (this.derivative(s + df) - this.derivative(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  inverse(y) {\r\n    let steps = 9;\r\n    let ds = 1.0/steps, s = 0.0;\r\n    let best = undefined;\r\n    let ret = undefined;\r\n\r\n    for (let i = 0; i < steps; i++, s += ds) {\r\n      let s1 = s, s2 = s + ds;\r\n\r\n      let mid;\r\n\r\n      for (let j = 0; j < 11; j++) {\r\n        let y1 = this.evaluate(s1);\r\n        let y2 = this.evaluate(s2);\r\n        mid = (s1 + s2)*0.5;\r\n\r\n        if (Math.abs(y1 - y) < Math.abs(y2 - y)) {\r\n          s2 = mid;\r\n        } else {\r\n          s1 = mid;\r\n        }\r\n      }\r\n\r\n      let ymid = this.evaluate(mid);\r\n\r\n      if (best === undefined || Math.abs(y - ymid) < best) {\r\n        best = Math.abs(y - ymid);\r\n        ret = mid;\r\n      }\r\n    }\r\n\r\n    return ret === undefined ? 0.0 : ret;\r\n  }\r\n\r\n  onActive(parent, draw_transform) {\r\n  }\r\n\r\n  onInactive(parent, draw_transform) {\r\n  }\r\n\r\n  reset() {\r\n\r\n  }\r\n\r\n  destroy() {\r\n  }\r\n\r\n  update() {\r\n    if (this.parent)\r\n      this.parent._on_change();\r\n  }\r\n\r\n  draw(canvas, g, draw_transform) {\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n  }\r\n}\r\n\r\nCurveTypeData.STRUCT = `\r\nCurveTypeData {\r\n  type : string;\r\n}\r\n`;\r\nnstructjs.register(CurveTypeData);\r\n\r\n\r\nexport function evalHermiteTable(table, t) {\r\n  let s = t*(table.length/4);\r\n\r\n  let i = Math.floor(s);\r\n  s -= i;\r\n\r\n  i *= 4;\r\n\r\n  let a = table[i] + (table[i + 1] - table[i])*s;\r\n  let b = table[i + 2] + (table[i + 3] - table[i + 2])*s;\r\n\r\n  return a + (b - a)*s;\r\n  //return table[i] + (table[i + 3] - table[i])*s;\r\n}\r\n\r\nexport function genHermiteTable(evaluate, steps) {\r\n  //console.log(\"building spline approx\");\r\n\r\n  let table = new Array(steps);\r\n\r\n  let eps = 0.00001;\r\n  let dt = (1.0 - eps*4.001)/(steps - 1);\r\n  let t = eps*4;\r\n  let lastdv1, lastf3;\r\n\r\n  for (let j = 0; j < steps; j++, t += dt) {\r\n    //let f1 = evaluate(t - eps*2);\r\n    let f2 = evaluate(t - eps);\r\n    let f3 = evaluate(t);\r\n    let f4 = evaluate(t + eps);\r\n    //let f5 = evaluate(t + eps*2);\r\n\r\n    let dv1 = (f4 - f2)/(eps*2);\r\n    dv1 /= steps;\r\n\r\n    if (j > 0) {\r\n      let j2 = j - 1;\r\n\r\n      table[j2*4] = lastf3;\r\n      table[j2*4 + 1] = lastf3 + lastdv1/3.0;\r\n      table[j2*4 + 2] = f3 - dv1/3.0;\r\n      table[j2*4 + 3] = f3;\r\n    }\r\n\r\n    lastdv1 = dv1;\r\n    lastf3 = f3;\r\n  }\r\n\r\n  return table;\r\n}\r\n","\"use strict\";\r\n\r\nimport nstructjs from \"../util/struct.js\";\r\nimport config from '../config/config.js';\r\n\r\nimport * as util from '../util/util.js';\r\n//import * as ui_base from './ui_base.js';\r\nimport * as vectormath from '../util/vectormath.js';\r\n//import {EventDispatcher} from \"../util/events.js\";\r\n\r\nlet Vector2 = vectormath.Vector2;\r\n\r\nexport const SplineTemplates = {\r\n  CONSTANT      : 0,\r\n  LINEAR        : 1,\r\n  SHARP         : 2,\r\n  SQRT          : 3,\r\n  SMOOTH        : 4,\r\n  SMOOTHER      : 5,\r\n  SHARPER       : 6,\r\n  SPHERE        : 7,\r\n  REVERSE_LINEAR: 8,\r\n  GUASSIAN      : 9\r\n};\r\n\r\nconst templates = {\r\n  [SplineTemplates.CONSTANT]      : [\r\n    [1, 1], [1, 1]\r\n  ],\r\n  [SplineTemplates.LINEAR]        : [\r\n    [0, 0], [1, 1]\r\n  ],\r\n  [SplineTemplates.SHARP]         : [\r\n    [0, 0], [0.9999, 0.0001], [1, 1]\r\n  ],\r\n  [SplineTemplates.SQRT]          : [\r\n    [0, 0], [0.05, 0.25], [0.33, 0.65], [1, 1]\r\n  ],\r\n  [SplineTemplates.SMOOTH]        : [\r\n    \"DEG\", 2, [0, 0], [1.0/3.0, 0], [2.0/3.0, 1.0], [1, 1]\r\n  ],\r\n  [SplineTemplates.SMOOTHER]      : [\r\n    \"DEG\", 6, [0, 0], [1.0/2.25, 0], [2.0/3.0, 1.0], [1, 1]\r\n  ],\r\n  [SplineTemplates.SHARPER]       : [\r\n    [0, 0], [0.3, 0.03], [0.7, 0.065], [0.9, 0.16], [1, 1]\r\n  ],\r\n  [SplineTemplates.SPHERE]        : [\r\n    [0, 0], [0.01953, 0.23438], [0.08203, 0.43359], [0.18359, 0.625], [0.35938, 0.81641], [0.625, 0.97656], [1, 1]\r\n  ],\r\n  [SplineTemplates.REVERSE_LINEAR]: [\r\n    [0, 1], [1, 0]\r\n  ],\r\n  [SplineTemplates.GUASSIAN]      : [\r\n    \"DEG\", 5, [0, 0], [0.17969, 0.007], [0.48958, 0.01172], [0.77995, 0.99609], [1, 1]\r\n  ]\r\n};\r\n\r\n//is initialized below\r\nexport const SplineTemplateIcons = {};\r\n\r\nlet RecalcFlags = {\r\n  BASIS: 1,\r\n  FULL : 2,\r\n  ALL  : 3,\r\n\r\n  //private flag\r\n  FULL_BASIS: 4\r\n}\r\n\r\nexport function mySafeJSONStringify(obj) {\r\n  return JSON.stringify(obj.toJSON(), function (key) {\r\n    let v = this[key];\r\n\r\n    if (typeof v === \"number\") {\r\n      if (v !== Math.floor(v)) {\r\n        v = parseFloat(v.toFixed(5));\r\n      } else {\r\n        v = v;\r\n      }\r\n    }\r\n\r\n    return v;\r\n  });\r\n}\r\n\r\nexport function mySafeJSONParse(buf) {\r\n  return JSON.parse(buf, (key, val) => {\r\n\r\n  });\r\n};\r\n\r\nwindow.mySafeJSONStringify = mySafeJSONStringify;\r\n\r\n\r\nlet bin_cache = {};\r\nwindow._bin_cache = bin_cache;\r\n\r\nlet eval2_rets = util.cachering.fromConstructor(Vector2, 32);\r\n\r\n/*\r\n  I hate these stupid curve widgets.  This horrible one here works by\r\n  root-finding the x axis on a two dimensional b-spline (which works\r\n  surprisingly well).\r\n*/\r\n\r\nfunction bez3(a, b, c, t) {\r\n  let r1 = a + (b - a)*t;\r\n  let r2 = b + (c - b)*t;\r\n\r\n  return r1 + (r2 - r1)*t;\r\n}\r\n\r\nfunction bez4(a, b, c, d, t) {\r\n  let r1 = bez3(a, b, c, t);\r\n  let r2 = bez3(b, c, d, t);\r\n\r\n  return r1 + (r2 - r1)*t;\r\n}\r\n\r\nexport function binomial(n, i) {\r\n  if (i > n) {\r\n    throw new Error(\"Bad call to binomial(n, i), i was > than n\");\r\n  }\r\n\r\n  if (i === 0 || i === n) {\r\n    return 1;\r\n  }\r\n\r\n  let key = \"\" + n + \",\" + i;\r\n\r\n  if (key in bin_cache)\r\n    return bin_cache[key];\r\n\r\n  let ret = binomial(n - 1, i - 1) + bin(n - 1, i);\r\n  bin_cache[key] = ret;\r\n\r\n  return ret;\r\n}\r\n\r\nwindow.bin = binomial;\r\n\r\nimport {CurveFlags, TangentModes, CurveTypeData} from './curve1d_base.js';\r\n\r\nexport class Curve1DPoint extends Vector2 {\r\n  constructor(co) {\r\n    super(co);\r\n\r\n    this.rco = new Vector2(co);\r\n    this.sco = new Vector2(co);\r\n\r\n    //for transform\r\n    this.startco = new Vector2();\r\n    this.eid = -1;\r\n    this.flag = 0;\r\n\r\n    this.tangent = TangentModes.SMOOTH;\r\n\r\n    Object.seal(this);\r\n  }\r\n\r\n  set deg(v) {\r\n    console.warn(\"old file data detected\");\r\n  }\r\n\r\n  static fromJSON(obj) {\r\n    let ret = new Curve1DPoint(obj);\r\n\r\n    ret.eid = obj.eid;\r\n    ret.flag = obj.flag;\r\n    ret.tangent = obj.tangent;\r\n\r\n    ret.rco.load(obj.rco);\r\n\r\n    return ret;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new Curve1DPoint(this);\r\n\r\n    ret.tangent = this.tangent;\r\n    ret.flag = this.flag;\r\n    ret.eid = this.eid;\r\n\r\n    ret.startco.load(this.startco);\r\n    ret.rco.load(this.rco);\r\n    ret.sco.load(this.sco);\r\n\r\n    return ret;\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      0: this[0],\r\n      1: this[1],\r\n\r\n      eid    : this.eid,\r\n      flag   : this.flag,\r\n      tangent: this.tangent,\r\n\r\n      rco: this.rco\r\n    };\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    this.sco.load(this);\r\n    this.rco.load(this);\r\n\r\n    splineCache.update(this);\r\n  }\r\n};\r\nCurve1DPoint.STRUCT = `\r\nCurve1DPoint {\r\n  0       : float;\r\n  1       : float;\r\n  eid     : int;\r\n  flag    : int;\r\n  tangent : int;\r\n  rco     : vec2;\r\n}\r\n`;\r\nnstructjs.register(Curve1DPoint);\r\n\r\nlet _udigest = new util.HashDigest();\r\n\r\nclass BSplineCache {\r\n  constructor() {\r\n    this.curves = [];\r\n    this.map = new Map();\r\n    this.maxCurves = 32;\r\n    this.gen = 0;\r\n  }\r\n\r\n  limit() {\r\n    if (this.curves.length <= this.maxCurves) {\r\n      return;\r\n    }\r\n\r\n    this.curves.sort((a, b) => b.cache_w - a.cache_w);\r\n    while (this.curves.length > this.maxCurves) {\r\n      let curve = this.curves.pop();\r\n      this.map.delete(curve.calcHashKey());\r\n    }\r\n  }\r\n\r\n  has(curve) {\r\n    let curve2 = this.map.get(curve.calcHashKey());\r\n    return curve2 && curve2.equals(curve);\r\n  }\r\n\r\n  get(curve) {\r\n    let key = curve.calcHashKey();\r\n    curve._last_cache_key = key;\r\n\r\n    let curve2 = this.map.get(key);\r\n    if (curve2 && curve2.equals(curve)) {\r\n      curve2.cache_w = this.gen++;\r\n      return curve2;\r\n    }\r\n\r\n    curve2 = curve.copy();\r\n    curve2._last_cache_key = key;\r\n\r\n    curve2.updateKnots();\r\n    curve2.regen_basis();\r\n    curve2.regen_hermite();\r\n\r\n    this.map.set(curve2);\r\n    this.curves.push(curve2);\r\n\r\n    curve2.cache_w = this.gen++;\r\n\r\n    this.limit();\r\n\r\n    return curve2;\r\n  }\r\n\r\n  _remove(key) {\r\n    let curve = this.map.get(key);\r\n    this.map.delete(key);\r\n    this.curves.remove(curve);\r\n  }\r\n\r\n  update(curve) {\r\n    let key = curve._last_cache_key;\r\n\r\n    if (this.map.has(key)) {\r\n      this._remove(curve);\r\n      this.get(curve);\r\n    }\r\n  }\r\n}\r\n\r\nlet splineCache = new BSplineCache();\r\nwindow._splineCache = splineCache;\r\n\r\nclass BSplineCurve extends CurveTypeData {\r\n  constructor() {\r\n    super();\r\n\r\n    this.cache_w = 0;\r\n    this._last_cache_key = 0;\r\n\r\n    this._last_update_key = \"\";\r\n\r\n    this.fastmode = false;\r\n    this.points = [];\r\n    this.length = 0;\r\n    this.interpolating = false;\r\n\r\n    this.range = [new Vector2([0, 1]), new Vector2([0, 1])];\r\n\r\n    this._ps = [];\r\n    this.hermite = [];\r\n    this.fastmode = false;\r\n\r\n    this.deg = 6;\r\n    this.recalc = RecalcFlags.ALL;\r\n    this.basis_tables = [];\r\n    this.eidgen = new util.IDGen();\r\n\r\n    this.add(0, 0);\r\n    this.add(1, 1);\r\n\r\n    this.mpos = new Vector2();\r\n\r\n    this.on_mousedown = this.on_mousedown.bind(this);\r\n    this.on_mousemove = this.on_mousemove.bind(this);\r\n    this.on_mouseup = this.on_mouseup.bind(this);\r\n    this.on_keydown = this.on_keydown.bind(this);\r\n    this.on_touchstart = this.on_touchstart.bind(this);\r\n    this.on_touchmove = this.on_touchmove.bind(this);\r\n    this.on_touchend = this.on_touchend.bind(this);\r\n    this.on_touchcancel = this.on_touchcancel.bind(this);\r\n  }\r\n\r\n  get hasGUI() {\r\n    return this.uidata !== undefined;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      uiname  : \"B-Spline\",\r\n      name    : \"bspline\",\r\n      typeName: \"BSplineCurve\"\r\n    }\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    let d = digest;\r\n\r\n    super.calcHashKey(d);\r\n\r\n    d.add(this.deg);\r\n    d.add(this.interpolating);\r\n\r\n    for (let p of this.points) {\r\n      let x = ~~(p[0]*1024);\r\n      let y = ~~(p[1]*1024);\r\n\r\n      d.add(x);\r\n      d.add(y);\r\n      d.add(p.tangent); //is an enum\r\n    }\r\n\r\n    d.add(this.range[0][0]);\r\n    d.add(this.range[0][1]);\r\n    d.add(this.range[1][0]);\r\n    d.add(this.range[1][1]);\r\n\r\n    return d.get();\r\n  }\r\n\r\n  copyTo(b) {\r\n    b.deg = this.deg;\r\n    b.interpolating = this.interpolating;\r\n    b.fastmode = this.fastmode;\r\n\r\n    for (let p of this.points) {\r\n      let p2 = p.copy();\r\n\r\n      b.points.push(p2);\r\n    }\r\n\r\n    return b;\r\n  }\r\n\r\n  copy() {\r\n    let curve = new BSplineCurve();\r\n    this.copyTo(curve);\r\n    return curve;\r\n  }\r\n\r\n  equals(b) {\r\n    if (b.type !== this.type) {\r\n      return false;\r\n    }\r\n\r\n    let bad = this.points.length !== b.points.length;\r\n\r\n    bad = bad || this.deg !== b.deg;\r\n    bad = bad || this.interpolating !== b.interpolating;\r\n\r\n    if (bad) {\r\n      return false;\r\n    }\r\n\r\n    for (let i = 0; i < this.points.length; i++) {\r\n      let p1 = this.points[i];\r\n      let p2 = b.points[i];\r\n\r\n      let dist = p1.vectorDistance(p2);\r\n\r\n      if (p1.vectorDistance(p2) > 0.00001) {\r\n        return false;\r\n      }\r\n\r\n      if (p1.tangent !== p2.tangent) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  remove(p) {\r\n    let ret = this.points.remove(p);\r\n    this.length = this.points.length;\r\n\r\n    return ret;\r\n  }\r\n\r\n  add(x, y, no_update = false) {\r\n    let p = new Curve1DPoint();\r\n    this.recalc = RecalcFlags.ALL;\r\n\r\n    p.eid = this.eidgen.next();\r\n\r\n    p[0] = x;\r\n    p[1] = y;\r\n\r\n    p.sco.load(p);\r\n    p.rco.load(p);\r\n\r\n    this.points.push(p);\r\n    if (!no_update) {\r\n      this.update();\r\n    }\r\n\r\n    this.length = this.points.length;\r\n\r\n    return p;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  _sortPoints() {\r\n    if (!this.interpolating) {\r\n      for (let i = 0; i < this.points.length; i++) {\r\n        this.points[i].rco.load(this.points[i]);\r\n      }\r\n    }\r\n\r\n    this.points.sort(function (a, b) {\r\n      return a[0] - b[0];\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  updateKnots(recalc = true, points = this.points) {\r\n    if (recalc) {\r\n      this.recalc = RecalcFlags.ALL;\r\n    }\r\n\r\n    this._sortPoints();\r\n\r\n    this._ps = [];\r\n    if (points.length < 2) {\r\n      return;\r\n    }\r\n    let a = points[0][0], b = points[points.length - 1][0];\r\n\r\n    for (let i = 0; i < points.length - 1; i++) {\r\n      this._ps.push(points[i]);\r\n    }\r\n\r\n    if (points.length < 3) {\r\n      return;\r\n    }\r\n\r\n    let l1 = points[points.length - 1];\r\n    let l2 = points[points.length - 2];\r\n\r\n    let p = l1.copy();\r\n    p.rco[0] = l1.rco[0] - 0.00004;\r\n    p.rco[1] = l2.rco[1] + (l1.rco[1] - l2.rco[1])/3.0;\r\n    //this._ps.push(p);\r\n\r\n    p = l1.copy();\r\n    p.rco[0] = l1.rco[0] - 0.00003;\r\n    p.rco[1] = l2.rco[1] + (l1.rco[1] - l2.rco[1])/3.0;\r\n    //this._ps.push(p);\r\n\r\n    p = l1.copy();\r\n    p.rco[0] = l1.rco[0] - 0.00001;\r\n    p.rco[1] = l2.rco[1] + (l1.rco[1] - l2.rco[1])/3.0;\r\n    this._ps.push(p);\r\n\r\n    p = l1.copy();\r\n    p.rco[0] = l1.rco[0] - 0.00001;\r\n    p.rco[1] = l2.rco[1] + (l1.rco[1] - l2.rco[1])*2.0/3.0;\r\n    this._ps.push(p);\r\n\r\n    this._ps.push(l1);\r\n\r\n    if (!this.interpolating) {\r\n      for (let i = 0; i < this._ps.length; i++) {\r\n        this._ps[i].rco.load(this._ps[i]);\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < points.length; i++) {\r\n      let p = points[i];\r\n      let x = p[0], y = p[1];//this.evaluate(x);\r\n\r\n      p.sco[0] = x;\r\n      p.sco[1] = y;\r\n    }\r\n  }\r\n\r\n  toJSON() {\r\n    this._sortPoints();\r\n\r\n    let ret = super.toJSON();\r\n\r\n    ret = Object.assign(ret, {\r\n      points       : this.points.map(p => p.toJSON()),\r\n      deg          : this.deg,\r\n      interpolating: this.interpolating,\r\n      eidgen       : this.eidgen.toJSON(),\r\n      range        : this.range\r\n    });\r\n\r\n    return ret;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    this.interpolating = obj.interpolating;\r\n    this.deg = obj.deg;\r\n\r\n    this.length = 0;\r\n    this.points = [];\r\n    this._ps = [];\r\n\r\n    if (obj.range) {\r\n      this.range = [new Vector2(obj.range[0]), new Vector2(obj.range[1])];\r\n    }\r\n\r\n    this.hightlight = undefined;\r\n    this.eidgen = util.IDGen.fromJSON(obj.eidgen);\r\n    this.recalc = RecalcFlags.ALL;\r\n    this.mpos = [0, 0];\r\n\r\n    for (let i = 0; i < obj.points.length; i++) {\r\n      this.points.push(Curve1DPoint.fromJSON(obj.points[i]));\r\n    }\r\n\r\n    this.updateKnots();\r\n    this.redraw();\r\n\r\n    return this;\r\n  }\r\n\r\n  basis(t, i) {\r\n    if (this.recalc & RecalcFlags.FULL_BASIS) {\r\n      return this._basis(t, i);\r\n    }\r\n\r\n    if (this.recalc & RecalcFlags.BASIS) {\r\n      this.regen_basis();\r\n      this.recalc &= ~RecalcFlags.BASIS;\r\n    }\r\n\r\n    i = Math.min(Math.max(i, 0), this._ps.length - 1);\r\n    t = Math.min(Math.max(t, 0.0), 1.0)*0.999999999;\r\n\r\n    let table = this.basis_tables[i];\r\n\r\n    let s = t*(table.length/4)*0.99999;\r\n\r\n    let j = ~~s;\r\n    s -= j;\r\n\r\n    j *= 4;\r\n    return table[j] + (table[j + 3] - table[j])*s;\r\n\r\n    return bez4(table[j], table[j + 1], table[j + 2], table[j + 3], s);\r\n  }\r\n\r\n  reset(empty = false) {\r\n    this.length = 0;\r\n    this.points = [];\r\n    this._ps = [];\r\n\r\n    if (!empty) {\r\n      this.add(0, 0, true);\r\n      this.add(1, 1, true);\r\n    }\r\n\r\n    this.recalc = 1;\r\n    this.updateKnots();\r\n    this.update();\r\n\r\n    return this;\r\n  }\r\n\r\n  regen_hermite(steps) {\r\n    if (splineCache.has(this)) {\r\n      console.log(\"loading spline approx from cached bspline data\");\r\n\r\n      this.hermite = splineCache.get(this).hermite;\r\n      return;\r\n    }\r\n\r\n    if (steps === undefined) {\r\n      steps = this.fastmode ? 120 : 340;\r\n    }\r\n\r\n    if (this.interpolating) {\r\n      steps *= 2;\r\n    }\r\n\r\n    this.hermite = new Array(steps);\r\n    let table = this.hermite;\r\n\r\n    let eps = 0.00001;\r\n    let dt = (1.0 - eps*4.001)/(steps - 1);\r\n    let t = eps*4;\r\n    let lastdv1, lastf3;\r\n\r\n    for (let j = 0; j < steps; j++, t += dt) {\r\n      let f1 = this._evaluate(t - eps*2);\r\n      let f2 = this._evaluate(t - eps);\r\n      let f3 = this._evaluate(t);\r\n      let f4 = this._evaluate(t + eps);\r\n      let f5 = this._evaluate(t + eps*2);\r\n\r\n      let dv1 = (f4 - f2)/(eps*2);\r\n      dv1 /= steps;\r\n\r\n      if (j > 0) {\r\n        let j2 = j - 1;\r\n\r\n        table[j2*4] = lastf3;\r\n        table[j2*4 + 1] = lastf3 + lastdv1/3.0;\r\n        table[j2*4 + 2] = f3 - dv1/3.0;\r\n        table[j2*4 + 3] = f3;\r\n      }\r\n\r\n      lastdv1 = dv1;\r\n      lastf3 = f3;\r\n    }\r\n  }\r\n\r\n  solve_interpolating() {\r\n    //this.recalc |= RecalcFlags.FULL_BASIS;\r\n\r\n    for (let p of this._ps) {\r\n      p.rco.load(p);\r\n    }\r\n\r\n    let points = this.points.concat(this.points);\r\n\r\n\r\n    this._evaluate2(0.5);\r\n\r\n    let error1 = (p) => {\r\n      //return p.vectorDistance(this._evaluate2(p[0]));\r\n      return this._evaluate(p[0]) - p[1];\r\n    }\r\n\r\n    let error = (p) => {\r\n      return error1(p);\r\n\r\n      /*\r\n      let err = 0.0;\r\n      for (let p of this.points) {\r\n        //err += error1(p)**2;\r\n        err += Math.abs(error1(p));\r\n      }\r\n\r\n      //return Math.sqrt(err);\r\n      return err;\r\n      //*/\r\n    };\r\n\r\n    let err = 0.0;\r\n    let g = new Vector2();\r\n\r\n    for (let step = 0; step < 25; step++) {\r\n      err = 0.0;\r\n\r\n      for (let p of this._ps) {\r\n        let r1 = error(p);\r\n        const df = 0.000001;\r\n\r\n        err += Math.abs(r1);\r\n\r\n        if (p === this._ps[this._ps.length - 1]) {\r\n          continue;\r\n        }\r\n\r\n        g.zero();\r\n\r\n        for (let i = 0; i < 2; i++) {\r\n          let orig = p.rco[i];\r\n          p.rco[i] += df;\r\n          let r2 = error(p);\r\n          p.rco[i] = orig;\r\n\r\n          g[i] = (r2 - r1)/df;\r\n        }\r\n\r\n        let totgs = g.dot(g);\r\n\r\n        if (totgs < 0.00000001) {\r\n          continue;\r\n        }\r\n\r\n        r1 /= totgs;\r\n        let k = 0.5;\r\n\r\n        p.rco[0] += -r1*g[0]*k;\r\n        p.rco[1] += -r1*g[1]*k;\r\n      }\r\n\r\n      let th = this.fastmode ? 0.001 : 0.00005;\r\n      if (err < th) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    //this.recalc &= ~RecalcFlags.FULL_BASIS;\r\n  }\r\n\r\n  regen_basis() {\r\n    if (splineCache.has(this)) {\r\n      console.log(\"loading from cached bspline data\");\r\n\r\n      this.basis_tables = splineCache.get(this).basis_tables;\r\n      return;\r\n    }\r\n\r\n    //let steps = this.fastmode && !this.interpolating ? 64 : 128;\r\n    let steps = this.fastmode ? 64 : 128;\r\n\r\n    if (this.interpolating) {\r\n      steps *= 2;\r\n    }\r\n\r\n    this.basis_tables = new Array(this._ps.length);\r\n\r\n    for (let i = 0; i < this._ps.length; i++) {\r\n      let table = this.basis_tables[i] = new Array((steps - 1)*4);\r\n\r\n      let eps = 0.00001;\r\n      let dt = (1.0 - eps*8)/(steps - 1);\r\n      let t = eps*4;\r\n      let lastdv1 = 0.0, lastf3 = 0.0;\r\n\r\n      for (let j = 0; j < steps; j++, t += dt) {\r\n        //let f1 = this._basis(t - eps*2, i);\r\n        let f2 = this._basis(t - eps, i);\r\n        let f3 = this._basis(t, i);\r\n        let f4 = this._basis(t + eps, i);\r\n        //let f5 = this._basis(t + eps*2, i);\r\n\r\n        let dv1 = (f4 - f2)/(eps*2);\r\n        dv1 /= steps;\r\n\r\n        if (j > 0) {\r\n          let j2 = j - 1;\r\n\r\n          table[j2*4] = lastf3;\r\n          table[j2*4 + 1] = lastf3 + lastdv1/3.0;\r\n          table[j2*4 + 2] = f3 - dv1/3.0;\r\n          table[j2*4 + 3] = f3;\r\n        }\r\n\r\n        lastdv1 = dv1;\r\n        lastf3 = f3;\r\n      }\r\n    }\r\n  }\r\n\r\n  _basis(t, i) {\r\n    let len = this._ps.length;\r\n    let ps = this._ps;\r\n\r\n    function safe_inv(n) {\r\n      return n === 0 ? 0 : 1.0/n;\r\n    }\r\n\r\n    function bas(s, i, n) {\r\n      let kp = Math.min(Math.max(i - 1, 0), len - 1);\r\n      let kn = Math.min(Math.max(i + 1, 0), len - 1);\r\n      let knn = Math.min(Math.max(i + n, 0), len - 1);\r\n      let knn1 = Math.min(Math.max(i + n + 1, 0), len - 1);\r\n      let ki = Math.min(Math.max(i, 0), len - 1);\r\n\r\n      if (n === 0) {\r\n        return s >= ps[ki].rco[0] && s < ps[kn].rco[0] ? 1 : 0;\r\n      } else {\r\n\r\n        let a = (s - ps[ki].rco[0])*safe_inv(ps[knn].rco[0] - ps[ki].rco[0] + 0.0001);\r\n        let b = (ps[knn1].rco[0] - s)*safe_inv(ps[knn1].rco[0] - ps[kn].rco[0] + 0.0001);\r\n\r\n        return a*bas(s, i, n - 1) + b*bas(s, i + 1, n - 1);\r\n      }\r\n    }\r\n\r\n    let p = this._ps[i].rco, nk, pk;\r\n    let deg = this.deg;\r\n\r\n    let b = bas(t, i - deg, deg);\r\n\r\n    return b;\r\n  }\r\n\r\n  evaluate(t) {\r\n    let a = this.points[0].rco, b = this.points[this.points.length - 1].rco;\r\n\r\n    if (t < a[0]) return a[1];\r\n    if (t > b[0]) return b[1];\r\n\r\n    if (this.points.length === 2) {\r\n      t = (t - a[0])/(b[0] - a[0]);\r\n      return a[1] + (b[1] - a[1])*t;\r\n    }\r\n\r\n    if (this.recalc) {\r\n      this.regen_basis();\r\n\r\n      if (this.interpolating) {\r\n        this.solve_interpolating();\r\n      }\r\n\r\n      this.regen_hermite();\r\n      this.recalc = 0;\r\n    }\r\n\r\n    t *= 0.999999;\r\n\r\n    let table = this.hermite;\r\n    let s = t*(table.length/4);\r\n\r\n    let i = Math.floor(s);\r\n    s -= i;\r\n\r\n    i *= 4;\r\n\r\n    return table[i] + (table[i + 3] - table[i])*s;\r\n  }\r\n\r\n  _evaluate(t) {\r\n    let start_t = t;\r\n\r\n    if (this.points.length > 1) {\r\n      let a = this.points[0], b = this.points[this.points.length - 1];\r\n\r\n      //if (t < a[0]) return a[1];\r\n      //if (t >= b[0]) return b[1];\r\n    }\r\n\r\n    for (let i = 0; i < 35; i++) {\r\n      let df = 0.0001;\r\n      let ret1 = this._evaluate2(t < 0.5 ? t : t - df);\r\n      let ret2 = this._evaluate2(t < 0.5 ? t + df : t);\r\n\r\n      let f1 = Math.abs(ret1[0] - start_t);\r\n      let f2 = Math.abs(ret2[0] - start_t);\r\n      let g = (f2 - f1)/df;\r\n\r\n      if (f1 === f2) break;\r\n\r\n      //if (f1 < 0.0005) break;\r\n\r\n      if (f1 === 0.0 || g === 0.0)\r\n        return this._evaluate2(t)[1];\r\n\r\n      let fac = -(f1/g)*0.5;\r\n      if (fac === 0.0) {\r\n        fac = 0.01;\r\n      } else if (Math.abs(fac) > 0.1) {\r\n        fac = 0.1*Math.sign(fac);\r\n      }\r\n\r\n      t += fac;\r\n      let eps = 0.00001;\r\n      t = Math.min(Math.max(t, eps), 1.0 - eps);\r\n    }\r\n\r\n    return this._evaluate2(t)[1];\r\n  }\r\n\r\n  _evaluate2(t) {\r\n    let ret = eval2_rets.next();\r\n\r\n    t *= 0.9999999;\r\n\r\n    let totbasis = 0;\r\n    let sumx = 0;\r\n    let sumy = 0;\r\n\r\n    for (let i = 0; i < this._ps.length; i++) {\r\n      let p = this._ps[i].rco;\r\n      let b = this.basis(t, i);\r\n\r\n      sumx += b*p[0];\r\n      sumy += b*p[1];\r\n\r\n      totbasis += b;\r\n    }\r\n\r\n    if (totbasis !== 0.0) {\r\n      sumx /= totbasis;\r\n      sumy /= totbasis;\r\n    }\r\n\r\n    ret[0] = sumx;\r\n    ret[1] = sumy;\r\n\r\n    return ret;\r\n  }\r\n\r\n  _wrapTouchEvent(e) {\r\n    return {\r\n      x              : e.touches.length ? e.touches[0].pageX : this.mpos[0],\r\n      y              : e.touches.length ? e.touches[0].pageY : this.mpos[1],\r\n      button         : 0,\r\n      shiftKey       : e.shiftKey,\r\n      altKey         : e.altKey,\r\n      ctrlKey        : e.ctrlKey,\r\n      isTouch        : true,\r\n      commandKey     : e.commandKey,\r\n      stopPropagation: () => e.stopPropagation(),\r\n      preventDefault : () => e.preventDefault()\r\n    };\r\n  }\r\n\r\n  on_touchstart(e) {\r\n    this.mpos[0] = e.touches[0].pageX;\r\n    this.mpos[1] = e.touches[0].pageY;\r\n\r\n    let e2 = this._wrapTouchEvent(e);\r\n\r\n    this.on_mousemove(e2);\r\n    this.on_mousedown(e2);\r\n  }\r\n\r\n  loadTemplate(templ) {\r\n    if (templ === undefined || !templates[templ]) {\r\n      console.warn(\"Unknown bspline template\", templ);\r\n      return;\r\n    }\r\n\r\n    templ = templates[templ];\r\n\r\n    this.reset(true);\r\n    this.deg = 3.0;\r\n\r\n    for (let i = 0; i < templ.length; i++) {\r\n      let p = templ[i];\r\n\r\n      if (p === \"DEG\") {\r\n        this.deg = templ[i + 1];\r\n        i++;\r\n        continue;\r\n      }\r\n\r\n      this.add(p[0], p[1], true);\r\n    }\r\n\r\n    this.recalc = 1;\r\n    this.updateKnots();\r\n    this.update();\r\n    this.redraw();\r\n  }\r\n\r\n  on_touchmove(e) {\r\n    this.mpos[0] = e.touches[0].pageX;\r\n    this.mpos[1] = e.touches[0].pageY;\r\n\r\n    let e2 = this._wrapTouchEvent(e);\r\n    this.on_mousemove(e2);\r\n  }\r\n\r\n  on_touchend(e) {\r\n    this.on_mouseup(this._wrapTouchEvent(e));\r\n  }\r\n\r\n  on_touchcancel(e) {\r\n    this.on_touchend(e);\r\n  }\r\n\r\n  makeGUI(container, canvas, drawTransform) {\r\n    this.uidata = {\r\n      start_mpos : new Vector2(),\r\n      transpoints: [],\r\n\r\n      dom         : container,\r\n      canvas      : canvas,\r\n      g           : canvas.g,\r\n      transforming: false,\r\n      draw_trans  : drawTransform\r\n    };\r\n\r\n    canvas.addEventListener(\"touchstart\", this.on_touchstart);\r\n    canvas.addEventListener(\"touchmove\", this.on_touchmove);\r\n    canvas.addEventListener(\"touchend\", this.on_touchend);\r\n    canvas.addEventListener(\"touchcancel\", this.on_touchcancel);\r\n\r\n    canvas.addEventListener(\"mousedown\", this.on_mousedown);\r\n    canvas.addEventListener(\"mousemove\", this.on_mousemove);\r\n    canvas.addEventListener(\"mouseup\", this.on_mouseup);\r\n    canvas.addEventListener(\"keydown\", this.on_keydown);\r\n\r\n    let bstrip = container.row().strip();\r\n\r\n    let makebutton = (strip, k) => {\r\n      let uiname = k[0] + k.slice(1, k.length).toLowerCase();\r\n      uiname = uiname.replace(/_/g, \" \");\r\n\r\n      let icon = strip.iconbutton(-1, uiname, () => {\r\n        this.loadTemplate(SplineTemplates[k]);\r\n      });\r\n\r\n      icon.iconsheet = 0;\r\n      icon.customIcon = SplineTemplateIcons[k];\r\n    }\r\n\r\n    for (let k in SplineTemplates) {\r\n      makebutton(bstrip, k);\r\n    }\r\n\r\n    let row = container.row();\r\n\r\n    let fullUpdate = () => {\r\n      this.updateKnots();\r\n      this.update();\r\n      this.regen_basis();\r\n      this.recalc = RecalcFlags.ALL;\r\n      this.redraw();\r\n    };\r\n\r\n    let Icons = row.constructor.getIconEnum();\r\n\r\n    row.iconbutton(Icons.TINY_X, \"Delete Point\", () => {\r\n      for (let i = 0; i < this.points.length; i++) {\r\n        let p = this.points[i];\r\n\r\n        if (p.flag & CurveFlags.SELECT) {\r\n          this.points.remove(p);\r\n          i--;\r\n        }\r\n      }\r\n\r\n      fullUpdate();\r\n    });\r\n\r\n    row.button(\"Reset\", () => {\r\n      this.reset();\r\n    });\r\n\r\n    let slider = row.simpleslider(undefined, \"Degree\", this.deg, 1, 6, 1, true, true, (slider) => {\r\n      this.deg = Math.floor(slider.value);\r\n\r\n      fullUpdate();\r\n    });\r\n\r\n    slider.baseUnit = \"none\";\r\n    slider.displayUnit = \"none\";\r\n\r\n    row = container.row();\r\n    let check = row.check(undefined, \"Interpolating\");\r\n    check.checked = this.interpolating;\r\n\r\n    check.onchange = () => {\r\n      this.interpolating = check.value;\r\n      fullUpdate();\r\n    }\r\n\r\n    let panel = container.panel(\"Range\");\r\n\r\n    let xmin = panel.slider(undefined, \"X Min\", this.range[0][0], -10, 10, 0.1, false, undefined, (val) => {\r\n      this.range[0][0] = val.value;\r\n    });\r\n\r\n    let xmax = panel.slider(undefined, \"X Max\", this.range[0][1], -10, 10, 0.1, false, undefined, (val) => {\r\n      this.range[0][1] = val.value;\r\n    });\r\n\r\n    let ymin = panel.slider(undefined, \"Y Min\", this.range[1][0], -10, 10, 0.1, false, undefined, (val) => {\r\n      this.range[1][0] = val.value;\r\n    });\r\n\r\n    let ymax = panel.slider(undefined, \"Y Max\", this.range[1][1], -10, 10, 0.1, false, undefined, (val) => {\r\n      this.range[1][1] = val.value;\r\n    });\r\n\r\n    xmin.displayUnit = xmin.baseUnit = \"none\";\r\n    ymin.displayUnit = ymin.baseUnit = \"none\";\r\n    xmax.displayUnit = xmax.baseUnit = \"none\";\r\n    ymax.displayUnit = ymax.baseUnit = \"none\";\r\n\r\n    panel.closed = true;\r\n\r\n    container.update.after(() => {\r\n      let key = this.calcHashKey();\r\n      if (key !== this._last_update_key) {\r\n        this._last_update_key = key;\r\n\r\n        slider.setValue(this.deg);\r\n        xmin.setValue(this.range[0][0]);\r\n        xmax.setValue(this.range[0][1]);\r\n\r\n        ymin.setValue(this.range[1][0]);\r\n        ymax.setValue(this.range[1][1]);\r\n      }\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  killGUI(container, canvas) {\r\n    if (this.uidata !== undefined) {\r\n      let ud = this.uidata;\r\n      this.uidata = undefined;\r\n\r\n      canvas.removeEventListener(\"touchstart\", this.on_touchstart);\r\n      canvas.removeEventListener(\"touchmove\", this.on_touchmove);\r\n      canvas.removeEventListener(\"touchend\", this.on_touchend);\r\n      canvas.removeEventListener(\"touchcancel\", this.on_touchcancel);\r\n\r\n      canvas.removeEventListener(\"mousedown\", this.on_mousedown);\r\n      canvas.removeEventListener(\"mousemove\", this.on_mousemove);\r\n      canvas.removeEventListener(\"mouseup\", this.on_mouseup);\r\n      canvas.removeEventListener(\"keydown\", this.on_keydown);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  start_transform() {\r\n    this.uidata.transpoints = [];\r\n\r\n    for (let p of this.points) {\r\n      if (p.flag & CurveFlags.SELECT) {\r\n        this.uidata.transpoints.push(p);\r\n        p.startco.load(p);\r\n      }\r\n    }\r\n  }\r\n\r\n  on_mousedown(e) {\r\n    this.uidata.start_mpos.load(this.transform_mpos(e.x, e.y));\r\n    this.fastmode = true;\r\n\r\n    let mpos = this.transform_mpos(e.x, e.y);\r\n    let x = mpos[0], y = mpos[1];\r\n    this.do_highlight(x, y);\r\n\r\n    if (this.points.highlight !== undefined) {\r\n      if (!e.shiftKey) {\r\n        for (let i = 0; i < this.points.length; i++) {\r\n          this.points[i].flag &= ~CurveFlags.SELECT;\r\n        }\r\n\r\n        this.points.highlight.flag |= CurveFlags.SELECT;\r\n      } else {\r\n        this.points.highlight.flag ^= CurveFlags.SELECT;\r\n      }\r\n\r\n\r\n      this.uidata.transforming = true;\r\n\r\n      this.start_transform();\r\n\r\n      this.updateKnots();\r\n      this.update();\r\n      this.redraw();\r\n      return;\r\n    } else { //if (!e.isTouch) {\r\n      let p = this.add(this.uidata.start_mpos[0], this.uidata.start_mpos[1]);\r\n      this.points.highlight = p;\r\n\r\n      this.updateKnots();\r\n      this.update();\r\n      this.redraw();\r\n\r\n      this.points.highlight.flag |= CurveFlags.SELECT;\r\n\r\n      this.uidata.transforming = true;\r\n      this.uidata.transpoints = [this.points.highlight];\r\n      this.uidata.transpoints[0].startco.load(this.uidata.transpoints[0]);\r\n    }\r\n  }\r\n\r\n  do_highlight(x, y) {\r\n    let trans = this.uidata.draw_trans;\r\n    let mindis = 1e17, minp = undefined;\r\n    let limit = 19/trans[0], limitsqr = limit*limit;\r\n\r\n    for (let i = 0; i < this.points.length; i++) {\r\n      let p = this.points[i];\r\n      let dx = x - p.sco[0], dy = y - p.sco[1], dis = dx*dx + dy*dy;\r\n\r\n      if (dis < mindis && dis < limitsqr) {\r\n        mindis = dis;\r\n        minp = p;\r\n      }\r\n    }\r\n\r\n    if (this.points.highlight !== minp) {\r\n      this.points.highlight = minp;\r\n      this.redraw()\r\n    }\r\n  }\r\n\r\n  do_transform(x, y) {\r\n    let off = new Vector2([x, y]).sub(this.uidata.start_mpos);\r\n\r\n    for (let i = 0; i < this.uidata.transpoints.length; i++) {\r\n      let p = this.uidata.transpoints[i];\r\n      p.load(p.startco).add(off);\r\n\r\n      p[0] = Math.min(Math.max(p[0], this.range[0][0]), this.range[0][1]);\r\n      p[1] = Math.min(Math.max(p[1], this.range[1][0]), this.range[1][1]);\r\n    }\r\n\r\n    this.updateKnots();\r\n    this.update();\r\n    this.redraw();\r\n  }\r\n\r\n  transform_mpos(x, y) {\r\n    let r = this.uidata.canvas.getClientRects()[0];\r\n    let dpi = devicePixelRatio; //evil module cycle: UIBase.getDPI();\r\n\r\n    x -= parseInt(r.left);\r\n    y -= parseInt(r.top);\r\n\r\n    x *= dpi;\r\n    y *= dpi;\r\n\r\n    let trans = this.uidata.draw_trans;\r\n\r\n    x = x/trans[0] - trans[1][0];\r\n    y = -y/trans[0] - trans[1][1];\r\n\r\n    return [x, y];\r\n  }\r\n\r\n  on_mousemove(e) {\r\n    if (e.isTouch && this.uidata.transforming) {\r\n      e.preventDefault();\r\n    }\r\n\r\n    let mpos = this.transform_mpos(e.x, e.y);\r\n    let x = mpos[0], y = mpos[1];\r\n\r\n    if (this.uidata.transforming) {\r\n      this.do_transform(x, y);\r\n      this.evaluate(0.5);\r\n      //this.update();\r\n      //this.doSave();\r\n    } else {\r\n      this.do_highlight(x, y);\r\n    }\r\n  }\r\n\r\n  end_transform() {\r\n    this.uidata.transforming = false;\r\n    this.fastmode = false;\r\n    this.updateKnots();\r\n    this.update();\r\n\r\n    splineCache.update(this);\r\n  }\r\n\r\n  on_mouseup(e) {\r\n    this.end_transform();\r\n  }\r\n\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case 88: //xkeey\r\n      case 46: //delete\r\n        if (this.points.highlight !== undefined) {\r\n          this.points.remove(this.points.highlight);\r\n          this.recalc = RecalcFlags.ALL;\r\n\r\n          this.points.highlight = undefined;\r\n          this.updateKnots();\r\n          this.update();\r\n\r\n          if (this._save_hook !== undefined) {\r\n            this._save_hook();\r\n          }\r\n        }\r\n        break;\r\n    }\r\n  }\r\n\r\n  draw(canvas, g, draw_trans) {\r\n    g.save();\r\n\r\n    if (this.uidata === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.uidata.canvas = canvas;\r\n    this.uidata.g = g;\r\n    this.uidata.draw_trans = draw_trans;\r\n\r\n    let sz = draw_trans[0], pan = draw_trans[1];\r\n    g.lineWidth *= 3.0;\r\n\r\n    for (let ssi = 0; ssi < 2; ssi++) {\r\n      break; //uncomment to draw basis functions\r\n      for (let si = 0; si < this.points.length; si++) {\r\n        g.beginPath();\r\n\r\n        let f = 0;\r\n        for (let i = 0; i < steps; i++, f += df) {\r\n          let totbasis = 0;\r\n\r\n          for (let j = 0; j < this.points.length; j++) {\r\n            totbasis += this.basis(f, j);\r\n          }\r\n\r\n          let val = this.basis(f, si);\r\n\r\n          if (ssi)\r\n            val /= (totbasis === 0 ? 1 : totbasis);\r\n\r\n          (i === 0 ? g.moveTo : g.lineTo).call(g, f, ssi ? val : val*0.5, w, w);\r\n        }\r\n\r\n        let color, alpha = this.points[si] === this.points.highlight ? 1.0 : 0.7;\r\n\r\n        if (ssi) {\r\n          color = \"rgba(105, 25, 5,\" + alpha + \")\";\r\n        } else {\r\n          color = \"rgba(25, 145, 45,\" + alpha + \")\";\r\n        }\r\n        g.strokeStyle = color;\r\n        g.stroke();\r\n      }\r\n    }\r\n\r\n    g.lineWidth /= 3.0;\r\n\r\n    let w = 0.03;\r\n\r\n    for (let p of this.points) {\r\n      g.beginPath();\r\n\r\n      if (p === this.points.highlight) {\r\n        g.fillStyle = \"green\";\r\n      } else if (p.flag & CurveFlags.SELECT) {\r\n        g.fillStyle = \"red\";\r\n      } else {\r\n        g.fillStyle = \"orange\";\r\n      }\r\n\r\n      g.rect(p.sco[0] - w/2, p.sco[1] - w/2, w, w);\r\n\r\n      g.fill();\r\n    }\r\n\r\n    g.restore();\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n\r\n    this.updateKnots();\r\n    this.recalc = RecalcFlags.ALL;\r\n  }\r\n}\r\n\r\nBSplineCurve.STRUCT = nstructjs.inherit(BSplineCurve, CurveTypeData) + `\r\n  points        : array(Curve1DPoint);\r\n  deg           : int;\r\n  eidgen        : IDGen;\r\n  interpolating : bool;\r\n  range         : array(vec2);\r\n}\r\n`;\r\nnstructjs.register(BSplineCurve);\r\nCurveTypeData.register(BSplineCurve);\r\n\r\n\r\nfunction makeSplineTemplateIcons(size = 64) {\r\n  let dpi = devicePixelRatio;\r\n  size = ~~(size*dpi);\r\n\r\n  for (let k in SplineTemplates) {\r\n    let curve = new BSplineCurve();\r\n    curve.loadTemplate(SplineTemplates[k])\r\n\r\n    curve.fastmode = true;\r\n\r\n    let canvas = document.createElement(\"canvas\");\r\n    canvas.width = canvas.height = size;\r\n\r\n    let g = canvas.getContext(\"2d\");\r\n    let steps = 64;\r\n\r\n    curve.update();\r\n\r\n    let scale = 0.5;\r\n\r\n    g.translate(-0.5, -0.5);\r\n    g.scale(size*scale, size*scale);\r\n    g.translate(0.5, 0.5);\r\n\r\n    //margin\r\n    let m = 0.0;\r\n\r\n    let tent = f => 1.0 - Math.abs(Math.fract(f) - 0.5)*2.0;\r\n\r\n    for (let i = 0; i < steps; i++) {\r\n      let s = i/(steps - 1);\r\n      let f = 1.0 - curve.evaluate(tent(s));\r\n\r\n      s = s*(1.0 - m*2.0) + m;\r\n      f = f*(1.0 - m*2.0) + m;\r\n\r\n      //s += 0.5;\r\n      //f += 0.5;\r\n\r\n      if (i === 0) {\r\n        g.moveTo(s, f);\r\n      } else {\r\n        g.lineTo(s, f);\r\n      }\r\n    }\r\n\r\n    const ls = 7.0;\r\n\r\n    g.lineCap = \"round\";\r\n    g.strokeStyle = \"black\";\r\n    g.lineWidth = ls*3*dpi/(size*scale);\r\n    g.stroke();\r\n\r\n    g.strokeStyle = \"white\";\r\n    g.lineWidth = ls*dpi/(size*scale);\r\n    g.stroke();\r\n\r\n    let url = canvas.toDataURL();\r\n    let img = document.createElement(\"img\");\r\n    img.src = url;\r\n\r\n    SplineTemplateIcons[k] = img;\r\n    SplineTemplateIcons[SplineTemplates[k]] = img;\r\n  }\r\n}\r\n\r\nlet splineTemplatesLoaded = false;\r\n\r\nexport function initSplineTemplates() {\r\n  if (splineTemplatesLoaded) {\r\n    return;\r\n  }\r\n\r\n  splineTemplatesLoaded = true;\r\n\r\n  for (let k in SplineTemplates) {\r\n    let curve = new BSplineCurve();\r\n    curve.loadTemplate(SplineTemplates[k]);\r\n    splineCache.get(curve);\r\n  }\r\n\r\n  makeSplineTemplateIcons();\r\n  window._SplineTemplateIcons = SplineTemplateIcons;\r\n}\r\n\r\n//delay to ensure config is fully loaded\r\nwindow.setTimeout(() => {\r\n  if (config.autoLoadSplineTemplates) {\r\n    initSplineTemplates();\r\n  }\r\n}, 0);\r\n\r\n","import nstructjs from \"../util/struct.js\";\r\nimport {CurveFlags, TangentModes, CurveTypeData} from './curve1d_base.js';\r\nimport {Vector2, Vector3, Vector4, Quat, Matrix4} from '../util/vectormath.js';\r\nimport {genHermiteTable, evalHermiteTable} from './curve1d_base.js';\r\nimport * as util from '../util/util.js';\r\n\r\nlet _udigest = new util.HashDigest();\r\n\r\nfunction feq(a, b) {\r\n  return Math.abs(a - b) < 0.00001;\r\n}\r\n\r\nclass EquationCurve extends CurveTypeData {\r\n  constructor(type) {\r\n    super();\r\n\r\n    this.equation = \"x\";\r\n    this._last_equation = \"\";\r\n    this.hermite = undefined;\r\n  }\r\n\r\n  get hasGUI() {\r\n    return this.uidata !== undefined;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      uiname  : \"Equation\",\r\n      name    : \"equation\",\r\n      typeName: \"EquationCurve\"\r\n    }\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    let d = digest;\r\n\r\n    super.calcHashKey(d);\r\n\r\n    d.add(this.equation);\r\n\r\n    return d.get();\r\n  }\r\n\r\n  equals(b) {\r\n    return super.equals(b) && this.equation === b.equation;\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = super.toJSON();\r\n\r\n    return Object.assign(ret, {\r\n      equation: this.equation\r\n    });\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    if (obj.equation !== undefined) {\r\n      this.equation = obj.equation;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  makeGUI(container, canvas, drawTransform) {\r\n    this.uidata = {\r\n      canvas    : canvas,\r\n      g         : canvas.g,\r\n      draw_trans: drawTransform,\r\n    };\r\n\r\n    let row = container.row();\r\n\r\n    let text = this.uidata.textbox = row.textbox(undefined, \"\"+this.equation);\r\n    text.onchange = (val) => {\r\n      console.log(val);\r\n      this.equation = val;\r\n      this.update();\r\n      this.redraw();\r\n    }\r\n\r\n    container.label(\"Equation\");\r\n\r\n  }\r\n\r\n  killGUI(dom, gui, canvas, g, draw_transform) {\r\n    if (this.uidata !== undefined) {\r\n      this.uidata.textbox.remove();\r\n    }\r\n\r\n    this.uidata = undefined;\r\n  }\r\n\r\n  updateTextBox() {\r\n    if (this.uidata && this.uidata.textbox) {\r\n      this.uidata.textbox.text = this.equation;\r\n    }\r\n  }\r\n\r\n  evaluate(s) {\r\n    if (!this.hermite || this._last_equation !== this.equation) {\r\n      this._last_equation = this.equation;\r\n\r\n      this.updateTextBox();\r\n\r\n      this._evaluate(0.0);\r\n\r\n      if (this._haserror) {\r\n        console.warn(\"ERROR!\");\r\n        return 0.0;\r\n      }\r\n\r\n      let steps = 32;\r\n      this.hermite = genHermiteTable((s) => this._evaluate(s), steps);\r\n    }\r\n\r\n    return evalHermiteTable(this.hermite, s);\r\n  }\r\n\r\n  _evaluate(s) {\r\n    let sin = Math.sin, cos = Math.cos, pi = Math.PI, PI = Math.PI,\r\n        e                                                = Math.E, E                                    = Math.E, tan                      = Math.tan, abs      = Math.abs,\r\n        floor                                            = Math.floor, ceil                         = Math.ceil, acos = Math.acos,\r\n        asin                                             = Math.asin, atan                           = Math.atan, cosh = Math.cos,\r\n        sinh                                             = Math.sinh, log                            = Math.log, pow = Math.pow,\r\n        exp                                              = Math.exp, sqrt                             = Math.sqrt, cbrt = Math.cbrt,\r\n        min                                              = Math.min, max = Math.max;\r\n\r\n    try {\r\n      let x = s;\r\n      let ret = eval(this.equation);\r\n\r\n      this._haserror = false;\r\n\r\n      return ret;\r\n    } catch (error) {\r\n      this._haserror = true;\r\n      console.warn(\"ERROR!\");\r\n      return 0.0;\r\n    }\r\n  }\r\n\r\n  derivative(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.evaluate(s) - this.evaluate(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.evaluate(s + df) - this.evaluate(s))/df;\r\n    } else {\r\n      return (this.evaluate(s + df) - this.evaluate(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  derivative2(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.derivative(s) - this.derivative(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.derivative(s + df) - this.derivative(s))/df;\r\n    } else {\r\n      return (this.derivative(s + df) - this.derivative(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  inverse(y) {\r\n    let steps = 9;\r\n    let ds = 1.0/steps, s = 0.0;\r\n    let best = undefined;\r\n    let ret = undefined;\r\n\r\n    for (let i = 0; i < steps; i++, s += ds) {\r\n      let s1 = s, s2 = s + ds;\r\n\r\n      let mid;\r\n\r\n      for (let j = 0; j < 11; j++) {\r\n        let y1 = this.evaluate(s1);\r\n        let y2 = this.evaluate(s2);\r\n        mid = (s1 + s2)*0.5;\r\n\r\n        if (Math.abs(y1 - y) < Math.abs(y2 - y)) {\r\n          s2 = mid;\r\n        } else {\r\n          s1 = mid;\r\n        }\r\n      }\r\n\r\n      let ymid = this.evaluate(mid);\r\n\r\n      if (best === undefined || Math.abs(y - ymid) < best) {\r\n        best = Math.abs(y - ymid);\r\n        ret = mid;\r\n      }\r\n    }\r\n\r\n    return ret === undefined ? 0.0 : ret;\r\n  }\r\n\r\n  onActive(parent, draw_transform) {\r\n  }\r\n\r\n  onInactive(parent, draw_transform) {\r\n  }\r\n\r\n  reset() {\r\n    this.equation = \"x\";\r\n  }\r\n\r\n  destroy() {\r\n  }\r\n\r\n  draw(canvas, g, draw_transform) {\r\n    g.save();\r\n    if (this._haserror) {\r\n\r\n      g.fillStyle = g.strokeStyle = \"rgba(255, 50, 0, 0.25)\";\r\n      g.beginPath();\r\n      g.rect(0, 0, 1, 1);\r\n      g.fill();\r\n\r\n      g.beginPath();\r\n      g.moveTo(0, 0);\r\n      g.lineTo(1, 1);\r\n      g.moveTo(0, 1);\r\n      g.lineTo(1, 0);\r\n\r\n      g.lineWidth *= 3;\r\n      g.stroke();\r\n\r\n      g.restore();\r\n      return;\r\n    }\r\n\r\n    g.restore();\r\n  }\r\n}\r\n\r\nEquationCurve.STRUCT = nstructjs.inherit(EquationCurve, CurveTypeData) + `\r\n  equation : string;\r\n}\r\n`;\r\nnstructjs.register(EquationCurve);\r\nCurveTypeData.register(EquationCurve);\r\n\r\n\r\nclass GuassianCurve extends CurveTypeData {\r\n  constructor(type) {\r\n    super();\r\n\r\n    this.height = 1.0;\r\n    this.offset = 1.0;\r\n    this.deviation = 0.3; //standard deviation\r\n  }\r\n\r\n  get hasGUI() {\r\n    return this.uidata !== undefined;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      uiname  : \"Guassian\",\r\n      name    : \"guassian\",\r\n      typeName: \"GuassianCurve\"\r\n    }\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    super.calcHashKey(digest);\r\n\r\n    let d = digest;\r\n\r\n    d.add(this.height);\r\n    d.add(this.offset);\r\n    d.add(this.deviation);\r\n\r\n    return d.get();\r\n  }\r\n\r\n  equals(b) {\r\n    let r = super.equals(b);\r\n\r\n    r = r && feq(this.height, b.height);\r\n    r = r && feq(this.offset, b.offset);\r\n    r = r && feq(this.deviation, b.deviation);\r\n\r\n    return r;\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = super.toJSON();\r\n\r\n    return Object.assign(ret, {\r\n      height   : this.height,\r\n      offset   : this.offset,\r\n      deviation: this.deviation\r\n    });\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    this.height = obj.height !== undefined ? obj.height : 1.0;\r\n    this.offset = obj.offset;\r\n    this.deviation = obj.deviation;\r\n\r\n    return this;\r\n  }\r\n\r\n  makeGUI(container, canvas, drawTransform) {\r\n    this.uidata = {\r\n      canvas    : canvas,\r\n      g         : canvas.g,\r\n      draw_trans: drawTransform,\r\n    };\r\n\r\n    this.uidata.hslider = container.slider(undefined, \"Height\", this.height, -10, 10, 0.0001);\r\n    this.uidata.hslider.onchange = () => {\r\n      this.height = this.uidata.hslider.value;\r\n      this.redraw();\r\n      this.update();\r\n    }\r\n    this.uidata.oslider = container.slider(undefined, \"Offset\", this.offset, -10, 10, 0.0001);\r\n    this.uidata.oslider.onchange = () => {\r\n      this.offset = this.uidata.oslider.value;\r\n      this.redraw();\r\n      this.update();\r\n    }\r\n    this.uidata.dslider = container.slider(undefined, \"STD Deviation\", this.deviation, -10, 10, 0.0001);\r\n    this.uidata.dslider.onchange = () => {\r\n      this.deviation = this.uidata.dslider.value;\r\n      this.redraw();\r\n      this.update();\r\n    }\r\n\r\n    /*\r\n    this.uidata.oslider = gui.slider(undefined, \"Offset\", this.offset,\r\n      -2.5, 2.5, 0.0001, false, false, (val) => {this.offset = val, this.update(), this.redraw();});\r\n    this.uidata.dslider = gui.slider(undefined, \"STD Deviation\", this.deviation,\r\n      0.0001, 1.25, 0.0001, false, false, (val) => {this.deviation = val, this.update(), this.redraw();});\r\n    //*/\r\n  }\r\n\r\n  killGUI(dom, gui, canvas, g, draw_transform) {\r\n    if (this.uidata !== undefined) {\r\n      this.uidata.hslider.remove();\r\n      this.uidata.oslider.remove();\r\n      this.uidata.dslider.remove();\r\n    }\r\n\r\n    this.uidata = undefined;\r\n  }\r\n\r\n  evaluate(s) {\r\n    let r = this.height*Math.exp(-((s - this.offset)*(s - this.offset))/(2*this.deviation*this.deviation));\r\n    return r;\r\n  }\r\n\r\n  derivative(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.evaluate(s) - this.evaluate(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.evaluate(s + df) - this.evaluate(s))/df;\r\n    } else {\r\n      return (this.evaluate(s + df) - this.evaluate(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  derivative2(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.derivative(s) - this.derivative(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.derivative(s + df) - this.derivative(s))/df;\r\n    } else {\r\n      return (this.derivative(s + df) - this.derivative(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  inverse(y) {\r\n    let steps = 9;\r\n    let ds = 1.0/steps, s = 0.0;\r\n    let best = undefined;\r\n    let ret = undefined;\r\n\r\n    for (let i = 0; i < steps; i++, s += ds) {\r\n      let s1 = s, s2 = s + ds;\r\n\r\n      let mid;\r\n\r\n      for (let j = 0; j < 11; j++) {\r\n        let y1 = this.evaluate(s1);\r\n        let y2 = this.evaluate(s2);\r\n        mid = (s1 + s2)*0.5;\r\n\r\n        if (Math.abs(y1 - y) < Math.abs(y2 - y)) {\r\n          s2 = mid;\r\n        } else {\r\n          s1 = mid;\r\n        }\r\n      }\r\n\r\n      let ymid = this.evaluate(mid);\r\n\r\n      if (best === undefined || Math.abs(y - ymid) < best) {\r\n        best = Math.abs(y - ymid);\r\n        ret = mid;\r\n      }\r\n    }\r\n\r\n    return ret === undefined ? 0.0 : ret;\r\n  }\r\n}\r\n\r\nGuassianCurve.STRUCT = nstructjs.inherit(GuassianCurve, CurveTypeData) + `\r\n  height    : float;\r\n  offset    : float;\r\n  deviation : float;\r\n}\r\n`;\r\nnstructjs.register(GuassianCurve);\r\nCurveTypeData.register(GuassianCurve);\r\n","/*\r\n* Ease\r\n* Visit http://createjs.com/ for documentation, updates and examples.\r\n*\r\n* Copyright (c) 2010 gskinner.com, inc.\r\n*\r\n* Permission is hereby granted, free of charge, to any person\r\n* obtaining a copy of this software and associated documentation\r\n* files (the \"Software\"), to deal in the Software without\r\n* restriction, including without limitation the rights to use,\r\n* copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n* copies of the Software, and to permit persons to whom the\r\n* Software is furnished to do so, subject to the following\r\n* conditions:\r\n*\r\n* The above copyright notice and this permission notice shall be\r\n* included in all copies or substantial portions of the Software.\r\n*\r\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\r\n* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\r\n* OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\r\n* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\r\n* HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\r\n* WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\r\n* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\r\n* OTHER DEALINGS IN THE SOFTWARE.\r\n*/\r\n\r\n/**\r\n* @module TweenJS\r\n*/\r\n\r\n\r\n/**\r\n * The Ease class provides a collection of easing functions for use with TweenJS. It does not use the standard 4 param\r\n * easing signature. Instead it uses a single param which indicates the current linear ratio (0 to 1) of the tween.\r\n *\r\n * Most methods on Ease can be passed directly as easing functions:\r\n *\r\n *      createjs.Tween.get(target).to({x:100}, 500, createjs.Ease.linear);\r\n *\r\n * However, methods beginning with \"get\" will return an easing function based on parameter values:\r\n *\r\n *      createjs.Tween.get(target).to({y:200}, 500, createjs.Ease.getPowIn(2.2));\r\n *\r\n * Please see the <a href=\"http://www.createjs.com/Demos/TweenJS/Tween_SparkTable\">spark table demo</a> for an\r\n * overview of the different ease types on <a href=\"http://tweenjs.com\">TweenJS.com</a>.\r\n *\r\n * <em>Equations derived from work by Robert Penner.</em>\r\n * @class Ease\r\n * @static\r\n **/\r\n\r\n\r\nfunction Ease() {\r\n  throw \"Ease cannot be instantiated.\";\r\n}\r\n\r\nexport default Ease;\r\n\r\n// static methods and properties\r\n/**\r\n * @method linear\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.linear = function(t) { return t; };\r\n\r\n/**\r\n * Identical to linear.\r\n * @method none\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.none = Ease.linear;\r\n\r\n/**\r\n * Mimics the simple -100 to 100 easing in Adobe Flash/Animate.\r\n * @method get\r\n * @param {Number} amount A value from -1 (ease in) to 1 (ease out) indicating the strength and direction of the ease.\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.get = function(amount) {\r\n  if (amount < -1) { amount = -1; }\r\n  else if (amount > 1) { amount = 1; }\r\n  return function(t) {\r\n    if (amount==0) { return t; }\r\n    if (amount<0) { return t*(t*-amount+1+amount); }\r\n    return t*((2-t)*amount+(1-amount));\r\n  };\r\n};\r\n\r\n/**\r\n * Configurable exponential ease.\r\n * @method getPowIn\r\n * @param {Number} pow The exponent to use (ex. 3 would return a cubic ease).\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getPowIn = function(pow) {\r\n  return function(t) {\r\n    return Math.pow(t,pow);\r\n  };\r\n};\r\n\r\n/**\r\n * Configurable exponential ease.\r\n * @method getPowOut\r\n * @param {Number} pow The exponent to use (ex. 3 would return a cubic ease).\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getPowOut = function(pow) {\r\n  return function(t) {\r\n    return 1-Math.pow(1-t,pow);\r\n  };\r\n};\r\n\r\n/**\r\n * Configurable exponential ease.\r\n * @method getPowInOut\r\n * @param {Number} pow The exponent to use (ex. 3 would return a cubic ease).\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getPowInOut = function(pow) {\r\n  return function(t) {\r\n    if ((t*=2)<1) return 0.5*Math.pow(t,pow);\r\n    return 1-0.5*Math.abs(Math.pow(2-t,pow));\r\n  };\r\n};\r\n\r\n/**\r\n * @method quadIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quadIn = Ease.getPowIn(2);\r\n/**\r\n * @method quadOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quadOut = Ease.getPowOut(2);\r\n/**\r\n * @method quadInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quadInOut = Ease.getPowInOut(2);\r\n\r\n/**\r\n * @method cubicIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.cubicIn = Ease.getPowIn(3);\r\n/**\r\n * @method cubicOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.cubicOut = Ease.getPowOut(3);\r\n/**\r\n * @method cubicInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.cubicInOut = Ease.getPowInOut(3);\r\n\r\n/**\r\n * @method quartIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quartIn = Ease.getPowIn(4);\r\n/**\r\n * @method quartOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quartOut = Ease.getPowOut(4);\r\n/**\r\n * @method quartInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quartInOut = Ease.getPowInOut(4);\r\n\r\n/**\r\n * @method quintIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quintIn = Ease.getPowIn(5);\r\n/**\r\n * @method quintOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quintOut = Ease.getPowOut(5);\r\n/**\r\n * @method quintInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quintInOut = Ease.getPowInOut(5);\r\n\r\n/**\r\n * @method sineIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.sineIn = function(t) {\r\n  return 1-Math.cos(t*Math.PI/2);\r\n};\r\n\r\n/**\r\n * @method sineOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.sineOut = function(t) {\r\n  return Math.sin(t*Math.PI/2);\r\n};\r\n\r\n/**\r\n * @method sineInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.sineInOut = function(t) {\r\n  return -0.5*(Math.cos(Math.PI*t) - 1);\r\n};\r\n\r\n/**\r\n * Configurable \"back in\" ease.\r\n * @method getBackIn\r\n * @param {Number} amount The strength of the ease.\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getBackIn = function(amount) {\r\n  return function(t) {\r\n    return t*t*((amount+1)*t-amount);\r\n  };\r\n};\r\n/**\r\n * @method backIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.backIn = Ease.getBackIn(1.7);\r\n\r\n/**\r\n * Configurable \"back out\" ease.\r\n * @method getBackOut\r\n * @param {Number} amount The strength of the ease.\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getBackOut = function(amount) {\r\n  return function(t) {\r\n    return (--t*t*((amount+1)*t + amount) + 1);\r\n  };\r\n};\r\n/**\r\n * @method backOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.backOut = Ease.getBackOut(1.7);\r\n\r\n/**\r\n * Configurable \"back in out\" ease.\r\n * @method getBackInOut\r\n * @param {Number} amount The strength of the ease.\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getBackInOut = function(amount) {\r\n  amount*=1.525;\r\n  return function(t) {\r\n    if ((t*=2)<1) return 0.5*(t*t*((amount+1)*t-amount));\r\n    return 0.5*((t-=2)*t*((amount+1)*t+amount)+2);\r\n  };\r\n};\r\n/**\r\n * @method backInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.backInOut = Ease.getBackInOut(1.7);\r\n\r\n/**\r\n * @method circIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.circIn = function(t) {\r\n  return -(Math.sqrt(1-t*t)- 1);\r\n};\r\n\r\n/**\r\n * @method circOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.circOut = function(t) {\r\n  return Math.sqrt(1-(--t)*t);\r\n};\r\n\r\n/**\r\n * @method circInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.circInOut = function(t) {\r\n  if ((t*=2) < 1) return -0.5*(Math.sqrt(1-t*t)-1);\r\n  return 0.5*(Math.sqrt(1-(t-=2)*t)+1);\r\n};\r\n\r\n/**\r\n * @method bounceIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.bounceIn = function(t) {\r\n  return 1-Ease.bounceOut(1-t);\r\n};\r\n\r\n/**\r\n * @method bounceOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.bounceOut = function(t) {\r\n  if (t < 1/2.75) {\r\n    return (7.5625*t*t);\r\n  } else if (t < 2/2.75) {\r\n    return (7.5625*(t-=1.5/2.75)*t+0.75);\r\n  } else if (t < 2.5/2.75) {\r\n    return (7.5625*(t-=2.25/2.75)*t+0.9375);\r\n  } else {\r\n    return (7.5625*(t-=2.625/2.75)*t +0.984375);\r\n  }\r\n};\r\n\r\n/**\r\n * @method bounceInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.bounceInOut = function(t) {\r\n  if (t<0.5) return Ease.bounceIn (t*2) * .5;\r\n  return Ease.bounceOut(t*2-1)*0.5+0.5;\r\n};\r\n\r\n/**\r\n * Configurable elastic ease.\r\n * @method getElasticIn\r\n * @param {Number} amplitude\r\n * @param {Number} period\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getElasticIn = function(amplitude,period) {\r\n  var pi2 = Math.PI*2;\r\n  return function(t) {\r\n    if (t==0 || t==1) return t;\r\n    var s = period/pi2*Math.asin(1/amplitude);\r\n    return -(amplitude*Math.pow(2,10*(t-=1))*Math.sin((t-s)*pi2/period));\r\n  };\r\n};\r\n/**\r\n * @method elasticIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.elasticIn = Ease.getElasticIn(1,0.3);\r\n\r\n/**\r\n * Configurable elastic ease.\r\n * @method getElasticOut\r\n * @param {Number} amplitude\r\n * @param {Number} period\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getElasticOut = function(amplitude,period) {\r\n  var pi2 = Math.PI*2;\r\n  return function(t) {\r\n    if (t==0 || t==1) return t;\r\n    var s = period/pi2 * Math.asin(1/amplitude);\r\n    return (amplitude*Math.pow(2,-10*t)*Math.sin((t-s)*pi2/period )+1);\r\n  };\r\n};\r\n/**\r\n * @method elasticOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.elasticOut = Ease.getElasticOut(1,0.3);\r\n\r\n/**\r\n * Configurable elastic ease.\r\n * @method getElasticInOut\r\n * @param {Number} amplitude\r\n * @param {Number} period\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getElasticInOut = function(amplitude,period) {\r\n  var pi2 = Math.PI*2;\r\n  return function(t) {\r\n    var s = period/pi2 * Math.asin(1/amplitude);\r\n    if ((t*=2)<1) return -0.5*(amplitude*Math.pow(2,10*(t-=1))*Math.sin( (t-s)*pi2/period ));\r\n    return amplitude*Math.pow(2,-10*(t-=1))*Math.sin((t-s)*pi2/period)*0.5+1;\r\n  };\r\n};\r\n/**\r\n * @method elasticInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.elasticInOut = Ease.getElasticInOut(1,0.3*1.5);\r\n","import nstructjs from \"../util/struct.js\";\r\nimport {CurveConstructors, CurveTypeData} from \"./curve1d_base.js\";\r\nimport Ease from './ease.js';\r\nimport * as util from '../util/util.js';\r\n\r\nfunction bez3(a, b, c, t) {\r\n  var r1 = a + (b - a)*t;\r\n  var r2 = b + (c - b)*t;\r\n\r\n  return r1 + (r2 - r1)*t;\r\n}\r\n\r\nfunction bez4(a, b, c, d, t) {\r\n  var r1 = bez3(a, b, c, t);\r\n  var r2 = bez3(b, c, d, t);\r\n\r\n  return r1 + (r2 - r1)*t;\r\n}\r\n\r\nexport class ParamKey {\r\n  constructor(key, val) {\r\n    this.key = key;\r\n    this.val = val;\r\n  }\r\n}\r\n\r\nParamKey.STRUCT = `\r\nParamKey {\r\n  key : string;\r\n  val : float;\r\n}\r\n`\r\nnstructjs.register(ParamKey);\r\nlet BOOL_FLAG = 1e17;\r\n\r\nlet _udigest = new util.HashDigest();\r\n\r\nexport class SimpleCurveBase extends CurveTypeData {\r\n  constructor() {\r\n    super();\r\n\r\n    this.type = this.constructor.name;\r\n\r\n    let def = this.constructor.define();\r\n    let params = def.params;\r\n\r\n    this.params = {};\r\n    for (let k in params) {\r\n      this.params[k] = params[k][1];\r\n    }\r\n  }\r\n\r\n  get hasGUI() {\r\n    return true;\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    let d = digest;\r\n    super.calcHashKey(d);\r\n\r\n    for (let k in this.params) {\r\n      digest.add(k);\r\n      digest.add(this.params[k]);\r\n    }\r\n\r\n    return d.get();\r\n  }\r\n\r\n  equals(b) {\r\n    if (this.type !== b.type) {\r\n      return false;\r\n    }\r\n\r\n    for (let k in this.params) {\r\n      if (Math.abs(this.params[k] - b.params[k]) > 0.000001) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  redraw() {\r\n    if (this.parent)\r\n      this.parent.redraw();\r\n  }\r\n\r\n  makeGUI(container) {\r\n    let def = this.constructor.define();\r\n    let params = def.params;\r\n\r\n    for (let k in params) {\r\n      let p = params[k];\r\n\r\n      if (p[2] === BOOL_FLAG) {\r\n        let check = container.check(undefined, p[0]);\r\n        check.checked = !!this.params[k];\r\n        check.key = k;\r\n\r\n        let this2 = this;\r\n        check.onchange = function () {\r\n          this2.params[this.key] = this.checked ? 1 : 0;\r\n          this2.update();\r\n          this2.redraw();\r\n        }\r\n      } else {\r\n        let slider = container.slider(undefined, {\r\n          name      : p[0],\r\n          defaultval: this.params[k],\r\n          min       : p[2],\r\n          max       : p[3]\r\n        })\r\n        slider.baseUnit = slider.displayUnit = \"none\";\r\n\r\n        slider.key = k;\r\n\r\n        let this2 = this;\r\n        slider.onchange = function () {\r\n          this2.params[this.key] = this.value;\r\n          this2.update();\r\n          this2.redraw();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  killGUI(container) {\r\n    container.clear();\r\n  }\r\n\r\n  evaluate(s) {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  reset() {\r\n\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  draw(canvas, g, draw_transform) {\r\n    let steps = 128;\r\n    let s = 0, ds = 1.0/(steps - 1);\r\n\r\n    g.beginPath();\r\n    for (let i = 0; i < steps; i++, s += ds) {\r\n      let co = this.evaluate(s);\r\n\r\n      if (i) {\r\n        g.lineTo(co[0], co[1]);\r\n      } else {\r\n        g.moveTo(co[0], co[1]);\r\n      }\r\n    }\r\n\r\n    g.stroke();\r\n  }\r\n\r\n  _saveParams() {\r\n    let ret = [];\r\n    for (let k in this.params) {\r\n      ret.push(new ParamKey(k, this.params[k]));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  toJSON() {\r\n    return Object.assign(super.toJSON(), {\r\n      params: this.params\r\n    });\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    for (let k in obj.params) {\r\n      this.params[k] = obj.params[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n\r\n    let ps = this.params;\r\n    this.params = {};\r\n\r\n    let pdef = this.constructor.define().params;\r\n    if (!pdef) {\r\n      console.warn(\"Missing define function for curve\", this.constructor.name)\r\n      return;\r\n    }\r\n\r\n    for (let pair of ps) {\r\n      if (pair.key in pdef) {\r\n        this.params[pair.key] = pair.val;\r\n      }\r\n    }\r\n\r\n    for (let k in pdef) {\r\n      if (!(k in this.params)) {\r\n        this.params[k] = pdef[k][1];\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nSimpleCurveBase.STRUCT = nstructjs.inherit(SimpleCurveBase, CurveTypeData) + `\r\n  params : array(ParamKey) | obj._saveParams();\r\n}\r\n`;\r\nnstructjs.register(SimpleCurveBase);\r\n\r\nexport class BounceCurve extends SimpleCurveBase {\r\n  static define() {\r\n    return {\r\n      params  : {\r\n        decay : [\"Decay\", 1.0, 0.1, 5.0],\r\n        scale : [\"Scale\", 1.0, 0.01, 10.0],\r\n        freq  : [\"Freq\", 1.0, 0.01, 50.0],\r\n        phase : [\"Phase\", 0.0, -Math.PI*2.0, Math.PI*2.0],\r\n        offset: [\"Offset\", 0.0, -2.0, 2.0]\r\n      },\r\n      name    : \"bounce\",\r\n      uiname  : \"Bounce\",\r\n      typeName: \"BounceCurve\"\r\n\r\n    }\r\n  }\r\n\r\n  _evaluate(t) {\r\n    let params = this.params;\r\n    let decay = params.decay + 1.0;\r\n    let scale = params.scale;\r\n    let freq = params.freq;\r\n    let phase = params.phase;\r\n    let offset = params.offset;\r\n\r\n    t *= freq;\r\n    let t2 = Math.abs(Math.cos(phase + t*Math.PI*2.0))*scale;\r\n    ;//+ (1.0-scale);\r\n\r\n    t2 *= Math.exp(decay*t)/Math.exp(decay);\r\n\r\n    return t2;\r\n  }\r\n\r\n  evaluate(t) {\r\n    let s = this._evaluate(0.0);\r\n    let e = this._evaluate(1.0);\r\n\r\n    return (this._evaluate(t) - s)/(e - s) + this.params.offset;\r\n  }\r\n}\r\n\r\nCurveTypeData.register(BounceCurve);\r\nBounceCurve.STRUCT = nstructjs.inherit(BounceCurve, SimpleCurveBase) + `\r\n}`;\r\nnstructjs.register(BounceCurve);\r\n\r\n\r\nexport class ElasticCurve extends SimpleCurveBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._func = undefined;\r\n    this._last_hash = undefined;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      params  : {\r\n        mode     : [\"Out Mode\", false, BOOL_FLAG, BOOL_FLAG],\r\n        amplitude: [\"Amplitude\", 1.0, 0.01, 10.0],\r\n        period   : [\"Period\", 1.0, 0.01, 5.0]\r\n      },\r\n      name    : \"elastic\",\r\n      uiname  : \"Elastic\",\r\n      typeName: \"ElasticCurve\",\r\n    }\r\n  }\r\n\r\n  evaluate(t) {\r\n    let hash = ~~(this.params.mode*127 + this.params.amplitude*256 + this.params.period*512);\r\n\r\n    if (hash !== this._last_hash || !this._func) {\r\n      this._last_hash = hash;\r\n\r\n      if (this.params.mode) {\r\n        this._func = Ease.getElasticOut(this.params.amplitude, this.params.period);\r\n      } else {\r\n        this._func = Ease.getElasticIn(this.params.amplitude, this.params.period);\r\n      }\r\n    }\r\n    return this._func(t);\r\n  }\r\n}\r\n\r\nCurveTypeData.register(ElasticCurve);\r\nElasticCurve.STRUCT = nstructjs.inherit(ElasticCurve, SimpleCurveBase) + `\r\n}`;\r\nnstructjs.register(ElasticCurve);\r\n\r\n\r\nexport class EaseCurve extends SimpleCurveBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      params  : {\r\n        mode_in  : [\"in\", true, BOOL_FLAG, BOOL_FLAG],\r\n        mode_out : [\"out\", true, BOOL_FLAG, BOOL_FLAG],\r\n        amplitude: [\"Amplitude\", 1.0, 0.01, 4.0]\r\n      },\r\n      name    : \"ease\",\r\n      uiname  : \"Ease\",\r\n      typeName: \"EaseCurve\"\r\n    }\r\n  }\r\n\r\n  evaluate(t) {\r\n    let amp = this.params.amplitude;\r\n    let a1 = this.params.mode_in ? 1.0 - amp : 1.0/3.0;\r\n    let a2 = this.params.mode_out ? amp : 2.0/3.0;\r\n\r\n    return bez4(0.0, a1, a2, 1.0, t);\r\n  }\r\n}\r\n\r\nCurveTypeData.register(EaseCurve);\r\nEaseCurve.STRUCT = nstructjs.inherit(EaseCurve, SimpleCurveBase) + `\r\n}`;\r\nnstructjs.register(EaseCurve);\r\n\r\n\r\nexport class RandCurve extends SimpleCurveBase {\r\n  constructor() {\r\n    super();\r\n    this.random = new util.MersenneRandom();\r\n    this.seed = 0;\r\n  }\r\n\r\n  get seed() {\r\n    return this._seed;\r\n  }\r\n\r\n  set seed(v) {\r\n    this.random.seed(v);\r\n    this._seed = v;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      params  : {\r\n        amplitude: [\"Amplitude\", 1.0, 0.01, 4.0],\r\n        decay    : [\"Decay\", 1.0, 0.0, 5.0],\r\n        in_mode  : [\"In\", true, BOOL_FLAG, BOOL_FLAG]\r\n      },\r\n      name    : \"random\",\r\n      uiname  : \"Random\",\r\n      typeName: \"RandCurve\"\r\n    }\r\n  }\r\n\r\n  evaluate(t) {\r\n    let r = this.random.random();\r\n    let decay = this.params.decay + 1.0;\r\n    let amp = this.params.amplitude;\r\n    let in_mode = this.params.in_mode;\r\n\r\n    if (in_mode) {\r\n      t = 1.0 - t;\r\n    }\r\n    //r *= t;\r\n\r\n    let d;\r\n\r\n    //r *= 0.5;\r\n\r\n    if (in_mode) {\r\n      d = Math.exp(t*decay)/Math.exp(decay);\r\n    } else {\r\n      d = Math.exp(t*decay)/Math.exp(decay);\r\n    }\r\n\r\n    t = t + (r - t)*d;\r\n\r\n    if (in_mode) {\r\n      t = 1.0 - t;\r\n    }\r\n\r\n    return t;\r\n  }\r\n}\r\n\r\nCurveTypeData.register(RandCurve);\r\nRandCurve.STRUCT = nstructjs.inherit(RandCurve, SimpleCurveBase) + `\r\n}`;\r\nnstructjs.register(RandCurve);\r\n\r\n\r\n","\"use strict\";\r\n\r\n/*FIXME: not sure this works anymore*/\r\nimport nstructjs from \"../util/struct.js\";\r\n\r\nimport * as util from '../util/util.js';\r\n//import * as ui_base from './ui_base.js';\r\nimport * as vectormath from '../util/vectormath.js';\r\nimport {EventDispatcher} from \"../util/events.js\";\r\n\r\nexport {getCurve} from './curve1d_base.js';\r\nexport {SplineTemplates, SplineTemplateIcons} from './curve1d_bspline.js';\r\n\r\nvar Vector2 = vectormath.Vector2;\r\n\r\nimport './curve1d_basic.js';\r\nimport './curve1d_bspline.js';\r\nimport './curve1d_anim.js';\r\n\r\nexport function mySafeJSONStringify(obj) {\r\n  return JSON.stringify(obj.toJSON(), function (key) {\r\n    let v = this[key];\r\n\r\n    if (typeof v === \"number\") {\r\n      if (v !== Math.floor(v)) {\r\n        v = parseFloat(v.toFixed(5));\r\n      } else {\r\n        v = v;\r\n      }\r\n    }\r\n\r\n    return v;\r\n  });\r\n}\r\n\r\nexport function mySafeJSONParse(buf) {\r\n  return JSON.parse(buf, (key, val) => {\r\n\r\n  });\r\n};\r\n\r\nwindow.mySafeJSONStringify = mySafeJSONStringify;\r\n\r\nexport {CurveConstructors, CURVE_VERSION, CurveTypeData} from './curve1d_base.js';\r\nimport {CurveConstructors, CURVE_VERSION, CurveTypeData} from './curve1d_base.js';\r\n\r\nlet _udigest = new util.HashDigest();\r\n\r\nexport class Curve1D extends EventDispatcher {\r\n  constructor() {\r\n    super();\r\n\r\n    this.uiZoom = 1.0;\r\n\r\n    this.generators = [];\r\n    this.VERSION = CURVE_VERSION;\r\n\r\n    for (let gen of CurveConstructors) {\r\n      gen = new gen();\r\n\r\n      gen.parent = this;\r\n      this.generators.push(gen);\r\n    }\r\n\r\n    //this.generators.active = this.generators[0];\r\n    this.setGenerator(\"bspline\");\r\n  }\r\n\r\n  get generatorType() {\r\n    return this.generators.active ? this.generators.active.type : undefined;\r\n  }\r\n\r\n  get fastmode() {\r\n    return this._fastmode;\r\n  }\r\n\r\n  set fastmode(val) {\r\n    this._fastmode = val;\r\n\r\n    for (let gen of this.generators) {\r\n      gen.fastmode = val;\r\n    }\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    let d = digest;\r\n\r\n    for (let g of this.generators) {\r\n      g.calcHashKey(d);\r\n    }\r\n\r\n    return d.get();\r\n  }\r\n\r\n  equals(b) {\r\n    let gen1 = this.generators.active;\r\n    let gen2 = b.generators.active;\r\n\r\n    if (!gen1 || !gen2 || gen1.constructor !== gen2.constructor) {\r\n      return false;\r\n    }\r\n\r\n    return gen1.equals(gen2);\r\n  }\r\n\r\n  load(b) {\r\n    if (b === undefined) {\r\n      return;\r\n    }\r\n\r\n    let buf1 = mySafeJSONStringify(b);\r\n    let buf2 = mySafeJSONStringify(this);\r\n\r\n    if (buf1 === buf2) {\r\n      return;\r\n    }\r\n\r\n    this.loadJSON(JSON.parse(buf1));\r\n    this._on_change();\r\n    this.redraw();\r\n\r\n    return this;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new Curve1D();\r\n    ret.loadJSON(JSON.parse(mySafeJSONStringify(this)));\r\n    return ret;\r\n  }\r\n\r\n  _on_change() {\r\n\r\n  }\r\n\r\n  redraw() {\r\n    this._fireEvent(\"draw\", this);\r\n  }\r\n\r\n  setGenerator(type) {\r\n    for (let gen of this.generators) {\r\n      if (gen.constructor.define().name === type\r\n        || gen.type === type\r\n        || gen.constructor.define().typeName === type\r\n        || gen.constructor === type) {\r\n        if (this.generators.active) {\r\n          this.generators.active.onInactive();\r\n        }\r\n\r\n        this.generators.active = gen;\r\n        gen.onActive();\r\n\r\n        return;\r\n      }\r\n    }\r\n\r\n    throw new Error(\"unknown curve type \" + type);\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = {\r\n      generators      : [],\r\n      uiZoom          : this.uiZoom,\r\n      VERSION         : this.VERSION,\r\n      active_generator: this.generatorType\r\n    };\r\n\r\n    for (let gen of this.generators) {\r\n      ret.generators.push(gen.toJSON());\r\n    }\r\n\r\n    ret.generators.sort((a, b) => a.type.localeCompare(b.type));\r\n\r\n    return ret;\r\n  }\r\n\r\n  getGenerator(type, throw_on_error = true) {\r\n    for (let gen of this.generators) {\r\n      if (gen.type === type) {\r\n        return gen;\r\n      }\r\n    }\r\n\r\n    //was a new generator registerd?\r\n    for (let cls of CurveConstructors) {\r\n      if (cls.define().typeName === type) {\r\n        let gen = new cls();\r\n        gen.type = type;\r\n        this.generators.push(gen);\r\n        return gen;\r\n      }\r\n    }\r\n\r\n    if (throw_on_error) {\r\n      throw new Error(\"Unknown generator \" + type + \".\");\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  switchGenerator(type) {\r\n    let gen = this.getGenerator(type);\r\n\r\n    if (gen !== this.generators.active) {\r\n      let old = this.generators.active;\r\n\r\n      this.generators.active = gen;\r\n\r\n      old.onInactive(this);\r\n      gen.onActive(this);\r\n    }\r\n\r\n    return gen;\r\n  }\r\n\r\n  destroy() {\r\n    return this;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    this.VERSION = obj.VERSION;\r\n\r\n    this.uiZoom = parseFloat(obj.uiZoom) || this.uiZoom;\r\n\r\n    //this.generators = [];\r\n    for (let gen of obj.generators) {\r\n      let gen2 = this.getGenerator(gen.type, false);\r\n\r\n      if (!gen2 || !(gen2 instanceof CurveTypeData)) {\r\n        //old curve class?\r\n        console.warn(\"Bad curve generator class:\", gen2);\r\n        if (gen2) {\r\n          this.generators.remove(gen2);\r\n        }\r\n        continue;\r\n      }\r\n\r\n      gen2.parent = undefined;\r\n      gen2.reset();\r\n      gen2.loadJSON(gen);\r\n      gen2.parent = this;\r\n\r\n      if (gen.type === obj.active_generator) {\r\n        this.generators.active = gen2;\r\n      }\r\n\r\n      //this.generators.push(gen2);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  evaluate(s) {\r\n    return this.generators.active.evaluate(s);\r\n  }\r\n\r\n  integrate(s, quadSteps) {\r\n    return this.generators.active.integrate(s, quadSteps);\r\n  }\r\n\r\n  derivative(s) {\r\n    return this.generators.active.derivative(s);\r\n  }\r\n\r\n  derivative2(s) {\r\n    return this.generators.active.derivative2(s);\r\n  }\r\n\r\n  inverse(s) {\r\n    return this.generators.active.inverse(s);\r\n  }\r\n\r\n  reset() {\r\n    this.generators.active.reset();\r\n  }\r\n\r\n  update() {\r\n    return this.generators.active.update();\r\n  }\r\n\r\n  draw(canvas, g, draw_transform) {\r\n    let w = canvas.width, h = canvas.height;\r\n\r\n    g.save();\r\n\r\n    let sz = draw_transform[0], pan = draw_transform[1];\r\n\r\n    g.beginPath();\r\n    g.moveTo(-1, 0);\r\n    g.lineTo(1, 0);\r\n    g.strokeStyle = \"red\";\r\n    g.stroke();\r\n\r\n    g.beginPath();\r\n    g.moveTo(0, -1);\r\n    g.lineTo(0, 1);\r\n    g.strokeStyle = \"green\";\r\n    g.stroke();\r\n\r\n    //g.rect(0, 0, 1, 1);\r\n    //g.fillStyle = \"rgb(50, 50, 50)\";\r\n    //g.fill();\r\n\r\n    let f = 0, steps = 64;\r\n    let df = 1/(steps - 1);\r\n    w = 6.0/sz;\r\n\r\n    let curve = this.generators.active;\r\n\r\n    g.beginPath();\r\n    for (let i = 0; i < steps; i++, f += df) {\r\n      let val = curve.evaluate(f);\r\n\r\n      (i === 0 ? g.moveTo : g.lineTo).call(g, f, val, w, w);\r\n    }\r\n\r\n    g.strokeStyle = \"grey\";\r\n    g.stroke();\r\n\r\n    if (this.overlay_curvefunc !== undefined) {\r\n      g.beginPath();\r\n      f = 0.0;\r\n\r\n      for (let i = 0; i < steps; i++, f += df) {\r\n        let val = this.overlay_curvefunc(f);\r\n\r\n        (i === 0 ? g.moveTo : g.lineTo).call(g, f, val, w, w);\r\n      }\r\n\r\n      g.strokeStyle = \"green\";\r\n      g.stroke();\r\n    }\r\n\r\n    this.generators.active.draw(canvas, g, draw_transform);\r\n\r\n    g.restore();\r\n    return this;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    this.generators = [];\r\n    reader(this);\r\n\r\n    //console.log(\"VERSION\", this.VERSION);\r\n\r\n    if (this.VERSION <= 0.75) {\r\n      this.generators = [];\r\n\r\n      for (let cls of CurveConstructors) {\r\n        this.generators.push(new cls());\r\n      }\r\n\r\n      this.generators.active = this.getGenerator(\"BSplineCurve\");\r\n    }\r\n\r\n    for (let gen of this.generators.concat([])) {\r\n      if (!(gen instanceof CurveTypeData)) {\r\n        console.warn(\"Bad generator data found:\", gen);\r\n        this.generators.remove(gen);\r\n        continue;\r\n      }\r\n\r\n      if (gen.type === this._active) {\r\n        this.generators.active = gen;\r\n      }\r\n    }\r\n\r\n    delete this._active;\r\n  }\r\n}\r\n\r\nCurve1D.STRUCT = `\r\nCurve1D {\r\n  generators  : array(abstract(CurveTypeData));\r\n  _active     : string | obj.generators.active.type;\r\n  VERSION     : float;\r\n  uiZoom      : float;\r\n}\r\n`;\r\nnstructjs.register(Curve1D);\r\n\r\n","import * as util from '../util/util.js';\r\nimport {Vector2, Vector3, Vector4, Quat, Matrix4} from '../util/vectormath.js';\r\nimport {ToolPropertyIF, PropTypes, PropFlags} from \"./toolprop_abstract.js\";\r\nimport nstructjs from '../util/struct.js';\r\n\r\nexport {PropTypes, PropFlags} from './toolprop_abstract.js';\r\n\r\nexport const NumberConstraintsBase = new Set([\r\n  'range', 'expRate', 'step', 'uiRange', 'baseUnit', 'displayUnit', 'stepIsRelative',\r\n  'slideSpeed'\r\n]);\r\n\r\nexport const IntegerConstraints = new Set([\r\n  'radix'\r\n].concat(util.list(NumberConstraintsBase)));\r\n\r\nexport const FloatConstrinats = new Set([\r\n  'decimalPlaces'\r\n].concat(util.list(NumberConstraintsBase)));\r\n\r\nexport const NumberConstraints = new Set(util.list(IntegerConstraints).concat(util.list(FloatConstrinats)));\r\n\r\nexport const PropSubTypes = {\r\n  COLOR: 1\r\n};\r\n\r\nlet first = (iter) => {\r\n  if (iter === undefined) {\r\n    return undefined;\r\n  }\r\n\r\n  if (!(Symbol.iterator in iter)) {\r\n    for (let item in iter) {\r\n      return item;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  for (let item of iter) {\r\n    return item;\r\n  }\r\n};\r\n\r\n//set PropTypes to custom type integers\r\nexport function setPropTypes(types) {\r\n  for (let k in types) {\r\n    PropTypes[k] = types[k];\r\n  }\r\n}\r\n\r\nexport let customPropertyTypes = [];\r\nexport let PropClasses = {};\r\n\r\nlet customPropTypeBase = 17;\r\n\r\nlet wordmap = {\r\n  sel  : \"select\",\r\n  unsel: \"deselect\",\r\n  eid  : \"id\",\r\n  props: \"properties\",\r\n  res  : \"resource\",\r\n\r\n};\r\n\r\nexport var defaultRadix = 10;\r\nexport var defaultDecimalPlaces = 4;\r\n\r\nclass OnceTag {\r\n  constructor(cb) {\r\n    this.cb = cb;\r\n  }\r\n}\r\n\r\nexport class ToolProperty extends ToolPropertyIF {\r\n  constructor(type, subtype, apiname, uiname = \"\", description = \"\", flag = 0, icon = -1) {\r\n    super();\r\n\r\n    this.data = undefined;\r\n\r\n    if (type === undefined) {\r\n      type = this.constructor.PROP_TYPE_ID;\r\n    }\r\n\r\n    this.type = type;\r\n    this.subtype = subtype;\r\n\r\n    //is false if this property still has its default value,\r\n    //i.e. it hasn't been set by the user or anyone else\r\n    this.wasSet = false;\r\n\r\n    this.apiname = apiname;\r\n    this.uiname = uiname !== undefined ? uiname : apiname;\r\n    this.description = description;\r\n    this.flag = flag;\r\n    this.icon = icon;\r\n    this.icon2 = icon; //another icon, e.g. unchecked state\r\n\r\n    //remember to update NumberConstraintsBase et al when adding new number\r\n    //constraints\r\n\r\n    this.decimalPlaces = defaultDecimalPlaces;\r\n    this.radix = defaultRadix;\r\n    this.step = 0.05;\r\n\r\n    this.callbacks = {};\r\n  }\r\n\r\n  static internalRegister(cls) {\r\n    PropClasses[new cls().type] = cls;\r\n  }\r\n\r\n  static getClass(type) {\r\n    return PropClasses[type];\r\n  }\r\n\r\n  static setDefaultRadix(n) {\r\n    defaultRadix = n;\r\n  }\r\n\r\n  static setDefaultDecimalPlaces(n) {\r\n    defaultDecimalPlaces = n;\r\n  }\r\n\r\n  static makeUIName(name) {\r\n    let parts = [\"\"];\r\n    let lastc = undefined;\r\n\r\n    let ischar = (c) => {\r\n      c = c.charCodeAt(0);\r\n\r\n      let upper = c >= \"A\".charCodeAt(0);\r\n      upper = upper && c <= \"Z\".charCodeAt(0);\r\n\r\n      let lower = c >= \"a\".charCodeAt(0);\r\n      lower = lower && c <= \"z\".charCodeAt(0);\r\n\r\n      return upper || lower;\r\n    }\r\n\r\n    for (let i = 0; i < name.length; i++) {\r\n      let c = name[i];\r\n\r\n      if (c === '_' || c === '-' || c === '$') {\r\n        lastc = c;\r\n        c = ' ';\r\n        parts.push('');\r\n        continue;\r\n      }\r\n\r\n      if (i > 0 && c === c.toUpperCase() && lastc !== lastc.toUpperCase()) {\r\n        if (ischar(c) && ischar(lastc)) {\r\n          parts.push('');\r\n        }\r\n      }\r\n\r\n      parts[parts.length - 1] += c;\r\n      lastc = c;\r\n    }\r\n\r\n\r\n    let subst = (word) => {\r\n      if (word in wordmap) {\r\n        return wordmap[word];\r\n      } else {\r\n        return word;\r\n      }\r\n    }\r\n\r\n    parts = parts\r\n      .filter(f => f.trim().length > 0)\r\n      .map(f => subst(f))\r\n      .map(f => f[0].toUpperCase() + f.slice(1, f.length).toLowerCase())\r\n      .join(\" \").trim();\r\n    return parts;\r\n  }\r\n\r\n  static register(cls) {\r\n    cls.PROP_TYPE_ID = (1<<customPropTypeBase);\r\n    PropTypes[cls.name] = cls.PROP_TYPE_ID;\r\n\r\n    customPropTypeBase++;\r\n    customPropertyTypes.push(cls);\r\n\r\n    PropClasses[new cls().type] = cls;\r\n\r\n    return cls.PROP_TYPE_ID;\r\n  }\r\n\r\n  static calcRelativeStep(step, value, logBase = 1.5) {\r\n    value = Math.log(Math.abs(value) + 1.0)/Math.log(logBase);\r\n    value = Math.max(value, step);\r\n\r\n    this.report(util.termColor(\"STEP\", \"red\"), value);\r\n    return value;\r\n  }\r\n\r\n  setDescription(s) {\r\n    this.description = s;\r\n    return this;\r\n  }\r\n\r\n  setUIName(s) {\r\n    this.uiname = s;\r\n    return this;\r\n  }\r\n\r\n  calcMemSize() {\r\n    function strlen(s) {\r\n      //length of string plus an assumed member pointer\r\n      return s !== undefined ? s.length + 8 : 8;\r\n    }\r\n\r\n    let tot = 0;\r\n\r\n    tot += strlen(this.apiname) + strlen(this.uiname);\r\n    tot += strlen(this.description);\r\n\r\n    tot += 11*8; //assumed member pointers\r\n    for (let k in this.callbacks) {\r\n      tot += 24;\r\n    }\r\n\r\n    return tot;\r\n  }\r\n\r\n  equals(b) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  private() {\r\n    this.flag |= PropFlags.PRIVATE;\r\n    return this;\r\n  }\r\n\r\n  saveLastValue() {\r\n    this.flag |= PropFlags.SAVE_LAST_VALUE;\r\n    return this;\r\n  }\r\n\r\n  report() {\r\n    console.warn(...arguments);\r\n  }\r\n\r\n  _fire(type, arg1, arg2) {\r\n    if (this.callbacks[type] === undefined) {\r\n      return;\r\n    }\r\n\r\n    let stack = this.callbacks[type];\r\n    stack = stack.concat([]); //copy\r\n\r\n    for (let i = 0; i < stack.length; i++) {\r\n      let cb = stack[i];\r\n\r\n      if (cb instanceof OnceTag) {\r\n        let j = i;\r\n\r\n        //remove callback;\r\n        while (j < stack.length - 1) {\r\n          stack[j] = stack[j + 1];\r\n          j++;\r\n        }\r\n\r\n        stack[j] = undefined;\r\n        stack.length--;\r\n\r\n        i--;\r\n\r\n        cb.cb.call(this, arg1, arg2);\r\n      } else {\r\n        cb.call(this, arg1, arg2);\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  clearEventCallbacks() {\r\n    this.callbacks = {}\r\n    return this;\r\n  }\r\n\r\n  once(type, cb) {\r\n    if (this.callbacks[type] === undefined) {\r\n      this.callbacks[type] = [];\r\n    }\r\n\r\n    //check if cb is already in callback list inside a OnceTag\r\n    for (let cb2 of this.callbacks[type]) {\r\n      if (cb2 instanceof OnceTag && cb2.cb === cb) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    cb = new OnceTag(cb);\r\n\r\n    this.callbacks[type].push(cb);\r\n\r\n    return this;\r\n  }\r\n\r\n  on(type, cb) {\r\n    if (this.callbacks[type] === undefined) {\r\n      this.callbacks[type] = [];\r\n    }\r\n\r\n    this.callbacks[type].push(cb);\r\n    return this;\r\n  }\r\n\r\n  off(type, cb) {\r\n    this.callbacks[type].remove(cb);\r\n    return this;\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      type       : this.type,\r\n      subtype    : this.subtype,\r\n      apiname    : this.apiname,\r\n      uiname     : this.uiname,\r\n      description: this.description,\r\n      flag       : this.flag,\r\n      icon       : this.icon,\r\n      data       : this.data,\r\n      range      : this.range,\r\n      uiRange    : this.uiRange,\r\n      step       : this.step\r\n    };\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    this.type = obj.type;\r\n    this.subtype = obj.subtype;\r\n    this.apiname = obj.apiname;\r\n    this.uiname = obj.uiname;\r\n    this.description = obj.description;\r\n    this.flag = obj.flag;\r\n    this.icon = obj.icon;\r\n    this.data = obj.data;\r\n\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  setValue(val) {\r\n    if (this.constructor === ToolProperty) {\r\n      throw new Error(\"implement me!\");\r\n    }\r\n\r\n    this.wasSet = true;\r\n\r\n    this._fire(\"change\", val);\r\n  }\r\n\r\n  copyTo(b) {\r\n    b.apiname = this.apiname;\r\n\r\n    b.uiname = this.uiname;\r\n    b.description = this.description;\r\n    b.icon = this.icon;\r\n    b.icon2 = this.icon2;\r\n\r\n    b.baseUnit = this.baseUnit;\r\n    b.subtype = this.subtype;\r\n    b.displayUnit = this.displayUnit;\r\n\r\n    b.flag = this.flag;\r\n\r\n    for (let k in this.callbacks) {\r\n      b.callbacks[k] = this.callbacks[k];\r\n    }\r\n  }\r\n\r\n  copy() { //default copy method\r\n    let ret = new this.constructor();\r\n\r\n    this.copyTo(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  setStep(step) {\r\n    this.step = step;\r\n    return this;\r\n  }\r\n\r\n  getStep(value = 1.0) {\r\n    if (this.stepIsRelative) {\r\n      return ToolProperty.calcRelativeStep(this.step, value);\r\n    } else {\r\n      return this.step;\r\n    }\r\n  }\r\n\r\n  setRelativeStep(step) {\r\n    this.step = step;\r\n    this.stepIsRelative = true;\r\n  }\r\n\r\n  setRange(min, max) {\r\n    if (min === undefined || max === undefined) {\r\n      throw new Error(\"min and/or max cannot be undefined\");\r\n    }\r\n\r\n    this.range = [min, max];\r\n    return this;\r\n  }\r\n\r\n  noUnits() {\r\n    this.baseUnit = this.displayUnit = \"none\";\r\n    return this;\r\n  }\r\n\r\n  setBaseUnit(unit) {\r\n    this.baseUnit = unit;\r\n    return this;\r\n  }\r\n\r\n  setDisplayUnit(unit) {\r\n    this.displayUnit = unit;\r\n    return this;\r\n  }\r\n\r\n  setFlag(f, combine = false) {\r\n    this.flag = combine ? this.flag | f : f;\r\n    return this;\r\n  }\r\n\r\n  setUIRange(min, max) {\r\n    if (min === undefined || max === undefined) {\r\n      throw new Error(\"min and/or max cannot be undefined\");\r\n    }\r\n\r\n    this.uiRange = [min, max];\r\n    return this;\r\n  }\r\n\r\n  setIcon(icon) {\r\n    this.icon = icon;\r\n\r\n    return this;\r\n  }\r\n\r\n  setIcon2(icon) {\r\n    this.icon2 = icon;\r\n\r\n    return this;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    if (this.uiRange[0] === -1e17 && this.uiRange[1] === 1e17) {\r\n      this.uiRange = undefined;\r\n    }\r\n\r\n    if (this.baseUnit === \"undefined\") {\r\n      this.baseUnit = undefined;\r\n    }\r\n\r\n    if (this.displayUnit === \"undefined\") {\r\n      this.displayUnit = undefined;\r\n    }\r\n  }\r\n}\r\n\r\nToolProperty.STRUCT = `\r\nToolProperty { \r\n  apiname        : string | \"\"+this.apiname;\r\n  type           : int;\r\n  flag           : int;\r\n  subtype        : int;\r\n  icon           : int;\r\n  icon2          : int;\r\n  baseUnit       : string | \"\"+this.baseUnit;\r\n  displayUnit    : string | \"\"+this.displayUnit;\r\n  range          : array(float) | this.range ? this.range : [-1e17, 1e17];\r\n  uiRange        : array(float) | this.uiRange ? this.uiRange : [-1e17, 1e17];\r\n  description    : string;\r\n  stepIsRelative : bool;\r\n  step           : float;\r\n  expRate        : float;\r\n  radix          : float;\r\n  decimalPlaces  : int;\r\n  uiname         : string | this.uiname || this.apiname || \"\";\r\n}\r\n`;\r\nnstructjs.register(ToolProperty);\r\n\r\nwindow.ToolProperty = ToolProperty;\r\n\r\nexport class FloatArrayProperty extends ToolProperty {\r\n  constructor(value, apiname, uiname, description, flag, icon) {\r\n    super(PropTypes.FLOAT_ARRAY, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.value = [];\r\n\r\n    if (value !== undefined) {\r\n      this.setValue(value);\r\n    }\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return this.value[Symbol.iterator]();\r\n  }\r\n\r\n  setValue(value) {\r\n    super.setValue();\r\n\r\n    if (value === undefined) {\r\n      throw new Error(\"value was undefined in FloatArrayProperty's setValue method\");\r\n    }\r\n\r\n    this.value.length = 0;\r\n\r\n    for (let item of value) {\r\n      if (typeof item !== \"number\" && typeof item !== \"boolean\") {\r\n        console.log(value);\r\n        throw new Error(\"bad item for FloatArrayProperty \" + item);\r\n      }\r\n\r\n      this.value.push(item);\r\n    }\r\n  }\r\n\r\n  push(item) {\r\n    if (typeof item !== \"number\" && typeof item !== \"boolean\") {\r\n      console.log(value);\r\n      throw new Error(\"bad item for FloatArrayProperty \" + item);\r\n    }\r\n\r\n    this.value.push(item);\r\n  }\r\n\r\n  getValue() {\r\n    return this.value;\r\n  }\r\n\r\n  clear() {\r\n    this.value.length = 0;\r\n    return this;\r\n  }\r\n}\r\n\r\nFloatArrayProperty.STRUCT = nstructjs.inherit(FloatArrayProperty, ToolProperty) + `\r\n  value : array(float);\r\n}`;\r\nnstructjs.register(FloatArrayProperty);\r\n\r\nexport class StringProperty extends ToolProperty {\r\n  constructor(value, apiname, uiname, description, flag, icon) {\r\n    super(PropTypes.STRING, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.multiLine = false;\r\n\r\n    if (value) {\r\n      this.setValue(value);\r\n    } else {\r\n      this.setValue(\"\");\r\n    }\r\n\r\n    this.wasSet = false;\r\n  }\r\n\r\n  calcMemSize() {\r\n    return super.calcMemSize() + (this.data !== undefined ? this.data.length*4 : 0) + 8;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data === b.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n\r\n    b.data = this.data;\r\n    b.multiLine = this.multiLine;\r\n\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  setValue(val) {\r\n    //fire events\r\n    super.setValue(val);\r\n    this.data = val;\r\n  }\r\n}\r\n\r\nStringProperty.STRUCT = nstructjs.inherit(StringProperty, ToolProperty) + `\r\n  data : string;\r\n}\r\n`;\r\nnstructjs.register(StringProperty);\r\nToolProperty.internalRegister(StringProperty);\r\n\r\n/*\r\nlet num_res = [\r\n  /([0-9]+)/,\r\n  /((0x)?[0-9a-fA-F]+(h?))/,\r\n  /([0-9]+\\.[0-9]*)/,\r\n  /([0-9]*\\.[0-9]+)/,\r\n  /(\\.[0-9]+)/\r\n];\r\n//num_re = /([0-9]+\\.[0-9]*)|([0-9]*\\.[0-9]+)/\r\n*/\r\n\r\nexport {isNumber} from '../../core/units.js';\r\n/*\r\nexport function isNumber(f) {\r\n  if (f === \"NaN\" || (typeof f == \"number\" && isNaN(f))) {\r\n    return false;\r\n  }\r\n\r\n  f = (\"\" + f).trim();\r\n\r\n  let ok = false;\r\n\r\n  for (let re of num_res) {\r\n    let ret = f.match(re)\r\n    if (!ret) {\r\n      ok = false;\r\n      continue;\r\n    }\r\n\r\n    ok = ret[0].length === f.length;\r\n    if (ok) {\r\n      break;\r\n    }\r\n  }\r\n\r\n  return ok;\r\n}*/\r\n\r\n//window.isNumber = isNumber;\r\n\r\nexport class NumProperty extends ToolProperty {\r\n  constructor(type, value, apiname,\r\n              uiname, description, flag, icon) {\r\n    super(type, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.data = 0;\r\n    this.range = [0, 0];\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data == b.data;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n  }\r\n};\r\nNumProperty.STRUCT = nstructjs.inherit(NumProperty, ToolProperty) + `\r\n  range : array(float);\r\n  data  : float;\r\n}\r\n`;\r\n\r\nexport class _NumberPropertyBase extends ToolProperty {\r\n  constructor(type, value, apiname,\r\n              uiname, description, flag, icon) {\r\n    super(type, null, apiname, uiname, description, flag, icon);\r\n\r\n    this.data = 0.0;\r\n\r\n    //remember to update NumberConstraintsBase et al when adding new number\r\n    //constraints\r\n\r\n    /** controls roller slider rate */\r\n    this.slideSpeed = 1.0;\r\n\r\n    /** exponential rate, used by roller sliders */\r\n    this.expRate = 1.33;\r\n    this.step = 0.1;\r\n\r\n    this.stepIsRelative = false;\r\n\r\n    this.range = [-1e17, 1e17];\r\n\r\n    /** if undefined this.range will be used */\r\n    this.uiRange = undefined;\r\n\r\n    if (value !== undefined && value !== null) {\r\n      this.setValue(value);\r\n      this.wasSet = false;\r\n    }\r\n  }\r\n\r\n  get ui_range() {\r\n    this.report(\"NumberProperty.ui_range is deprecated\");\r\n    return this.uiRange;\r\n  }\r\n\r\n  set ui_range(val) {\r\n    this.report(\"NumberProperty.ui_range is deprecated\");\r\n    this.uiRange = val;\r\n  }\r\n\r\n  calcMemSize() {\r\n    return super.calcMemSize() + 8*8;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data === b.data;\r\n  }\r\n\r\n  toJSON() {\r\n    let json = super.toJSON();\r\n\r\n    json.data = this.data;\r\n    json.expRate = this.expRate;\r\n\r\n    return json;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    this.data = obj.data || this.data;\r\n    this.expRate = obj.expRate || this.expRate;\r\n\r\n    return this;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n\r\n    b.displayUnit = this.displayUnit;\r\n    b.baseUnit = this.baseUnit;\r\n    b.expRate = this.expRate;\r\n    b.step = this.step;\r\n    b.range = this.range ? [this.range[0], this.range[1]] : undefined;\r\n    b.uiRange = this.uiRange ? [this.uiRange[0], this.uiRange[1]] : undefined;\r\n    b.slideSpeed = this.slideSpeed;\r\n    \r\n    b.data = this.data;\r\n  }\r\n\r\n\r\n  setSlideSpeed(f) {\r\n    this.slideSpeed = f;\r\n\r\n    return this;\r\n  }\r\n\r\n  /*\r\n  * non-linear exponent for number sliders\r\n  * in roll mode\r\n  * */\r\n  setExpRate(exp) {\r\n    this.expRate = exp;\r\n  }\r\n\r\n  setValue(val) {\r\n    if (val === undefined || val === null) {\r\n      return;\r\n    }\r\n\r\n    if (typeof val !== \"number\") {\r\n      throw new Error(\"Invalid number \" + val);\r\n    }\r\n\r\n    this.data = val;\r\n\r\n    super.setValue(val);\r\n    return this;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    let get = (key) => {\r\n      if (key in obj) {\r\n        this[key] = obj[key];\r\n      }\r\n    };\r\n\r\n    get(\"range\");\r\n    get(\"step\");\r\n    get(\"expRate\");\r\n    get(\"ui_range\");\r\n\r\n    return this;\r\n  }\r\n};\r\n_NumberPropertyBase.STRUCT = nstructjs.inherit(_NumberPropertyBase, ToolProperty) + `\r\n  range      : array(float);\r\n  expRate    : float;\r\n  data       : float;\r\n  step       : float;\r\n  slideSpeed : float;\r\n}\r\n`;\r\nnstructjs.register(_NumberPropertyBase);\r\n\r\nexport class IntProperty extends _NumberPropertyBase {\r\n  constructor(value, apiname,\r\n              uiname, description, flag, icon) {\r\n    super(PropTypes.INT, value, apiname, uiname, description, flag, icon);\r\n\r\n    //remember to update NumberConstraintsBase et al when adding new number\r\n    //constraints\r\n\r\n    this.radix = 10;\r\n  }\r\n\r\n  setValue(val) {\r\n    super.setValue(Math.floor(val));\r\n    return this;\r\n  }\r\n\r\n  setRadix(radix) {\r\n    this.radix = radix;\r\n  }\r\n\r\n  toJSON() {\r\n    let json = super.toJSON();\r\n\r\n    json.data = this.data;\r\n    json.radix = this.radix;\r\n\r\n    return json;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    this.data = obj.data || this.data;\r\n    this.radix = obj.radix || this.radix;\r\n\r\n    return this;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n  }\r\n}\r\n\r\nIntProperty.STRUCT = nstructjs.inherit(IntProperty, _NumberPropertyBase) + `\r\n  data : int;\r\n}`;\r\nnstructjs.register(IntProperty);\r\n\r\nToolProperty.internalRegister(IntProperty);\r\n\r\nexport class ReportProperty extends StringProperty {\r\n  constructor(value, apiname, uiname, description, flag, icon) {\r\n    super(value, apiname, uiname, description, flag, icon);\r\n\r\n    this.type = PropTypes.REPORT;\r\n  }\r\n}\r\n\r\nReportProperty.STRUCT = nstructjs.inherit(ReportProperty, StringProperty) + `\r\n}\r\n`;\r\nnstructjs.register(ReportProperty);\r\nToolProperty.internalRegister(ReportProperty);\r\n\r\nexport class BoolProperty extends ToolProperty {\r\n  constructor(value, apiname,\r\n              uiname, description, flag, icon) {\r\n    super(PropTypes.BOOL, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.data = !!value;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data == b.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n    b.data = this.data;\r\n\r\n    return this;\r\n  }\r\n\r\n  setValue(val) {\r\n    this.data = !!val;\r\n    super.setValue(val);\r\n\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = super.toJSON();\r\n\r\n    return ret;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nToolProperty.internalRegister(BoolProperty);\r\nBoolProperty.STRUCT = nstructjs.inherit(BoolProperty, ToolProperty) + `\r\n  data : bool;\r\n}\r\n`;\r\nnstructjs.register(BoolProperty);\r\n\r\n\r\nexport class FloatProperty extends _NumberPropertyBase {\r\n  constructor(value, apiname,\r\n              uiname, description, flag, icon) {\r\n    super(PropTypes.FLOAT, value, apiname, uiname, description, flag, icon);\r\n\r\n    //remember to update NumberConstraintsBase et al when adding new number\r\n    //constraints\r\n\r\n    this.decimalPlaces = 4;\r\n  }\r\n\r\n  setDecimalPlaces(n) {\r\n    this.decimalPlaces = n;\r\n    return this;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n    b.data = this.data;\r\n    return this;\r\n  }\r\n\r\n  setValue(val) {\r\n    this.data = val;\r\n\r\n    //fire events\r\n    super.setValue(val);\r\n\r\n    return this;\r\n  }\r\n\r\n  toJSON() {\r\n    let json = super.toJSON();\r\n\r\n    json.data = this.data;\r\n    json.decimalPlaces = this.decimalPlaces;\r\n\r\n    return json;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    this.data = obj.data || this.data;\r\n    this.decimalPlaces = obj.decimalPlaces || this.decimalPlaces;\r\n\r\n    return this;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n  }\r\n}\r\n\r\nToolProperty.internalRegister(FloatProperty);\r\nFloatProperty.STRUCT = nstructjs.inherit(FloatProperty, _NumberPropertyBase) + `\r\n  decimalPlaces : int;\r\n  data          : float;\r\n}\r\n`;\r\nnstructjs.register(FloatProperty);\r\n\r\nexport class EnumKeyPair {\r\n  constructor(key, val) {\r\n    this.key = \"\" + key;\r\n    this.val = \"\" + val;\r\n    this.key_is_int = typeof key === \"number\" || typeof key === \"boolean\";\r\n    this.val_is_int = typeof val === \"number\" || typeof val === \"boolean\";\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    if (this.val_is_int) {\r\n      this.val = parseInt(this.val);\r\n    }\r\n\r\n    if (this.key_is_int) {\r\n      this.key = parseInt(this.key);\r\n    }\r\n  }\r\n}\r\n\r\nEnumKeyPair.STRUCT = `\r\nEnumKeyPair {\r\n  key        : string;\r\n  val        : string;\r\n  key_is_int : bool;\r\n  val_is_int : bool; \r\n}\r\n`\r\nnstructjs.register(EnumKeyPair);\r\n\r\nexport class EnumProperty extends ToolProperty {\r\n  constructor(string_or_int, valid_values, apiname,\r\n              uiname, description, flag, icon) {\r\n    super(PropTypes.ENUM, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.values = {};\r\n    this.keys = {};\r\n    this.ui_value_names = {};\r\n    this.descriptions = {};\r\n\r\n    if (valid_values === undefined) return this;\r\n\r\n    if (valid_values instanceof Array || valid_values instanceof String) {\r\n      for (var i = 0; i < valid_values.length; i++) {\r\n        this.values[valid_values[i]] = valid_values[i];\r\n        this.keys[valid_values[i]] = valid_values[i];\r\n      }\r\n    } else {\r\n      for (var k in valid_values) {\r\n        this.values[k] = valid_values[k];\r\n        this.keys[valid_values[k]] = k;\r\n      }\r\n    }\r\n\r\n    if (string_or_int === undefined) {\r\n      this.data = first(valid_values);\r\n    } else {\r\n      this.setValue(string_or_int);\r\n    }\r\n\r\n    for (var k in this.values) {\r\n      let uin = k.replace(/[_-]/g, \" \").trim();\r\n      uin = uin.split(\" \")\r\n\r\n      let uiname = ToolProperty.makeUIName(k);\r\n\r\n      this.ui_value_names[k] = uiname;\r\n      this.descriptions[k] = uiname;\r\n    }\r\n\r\n    this.iconmap = {};\r\n    this.iconmap2 = {};\r\n\r\n    this.wasSet = false;\r\n  }\r\n\r\n  calcHash(digest = new util.HashDigest()) {\r\n    for (let key in this.keys) {\r\n      digest.add(key);\r\n      digest.add(this.keys[key]);\r\n    }\r\n\r\n    return digest.get();\r\n  }\r\n\r\n  updateDefinition(enumdef_or_prop) {\r\n    let descriptions = this.descriptions;\r\n    let ui_value_names = this.ui_value_names;\r\n\r\n    this.values = {};\r\n    this.keys = {};\r\n    this.ui_value_names = {};\r\n    this.descriptions = {};\r\n\r\n    let enumdef;\r\n\r\n    if (enumdef_or_prop instanceof EnumProperty) {\r\n      enumdef = enumdef_or_prop.values;\r\n    } else {\r\n      enumdef = enumdef_or_prop;\r\n    }\r\n\r\n    for (let k in enumdef) {\r\n      let v = enumdef[k];\r\n\r\n      this.values[k] = v;\r\n      this.keys[v] = k;\r\n    }\r\n\r\n    if (enumdef_or_prop instanceof EnumProperty) {\r\n      let prop = enumdef_or_prop;\r\n      this.iconmap = Object.assign({}, prop.iconmap);\r\n      this.iconmap2 = Object.assign({}, prop.iconmap2);\r\n\r\n      this.ui_value_names = Object.assign({}, prop.ui_value_names);\r\n      this.descriptions = Object.assign({}, prop.descriptions);\r\n    } else {\r\n      for (let k in this.values) {\r\n        if (k in ui_value_names) {\r\n          this.ui_value_names[k] = ui_value_names[k];\r\n        } else {\r\n          this.ui_value_names[k] = ToolProperty.makeUIName(k);\r\n        }\r\n\r\n        if (k in descriptions) {\r\n          this.descriptions[k] = descriptions[k];\r\n        } else {\r\n          this.descriptions[k] = ToolProperty.makeUIName(k);\r\n        }\r\n      }\r\n    }\r\n\r\n    this._fire('metaChange', this);\r\n\r\n    return this;\r\n  }\r\n\r\n  calcMemSize() {\r\n    let tot = super.calcMemSize();\r\n\r\n    for (let k in this.values) {\r\n      tot += (k.length*4 + 16)*4;\r\n    }\r\n\r\n    if (this.descriptions) {\r\n      for (let k in this.descriptions) {\r\n        tot += (k.length + this.descriptions[k].length)*4;\r\n      }\r\n    }\r\n\r\n    return tot + 64;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.getValue() === b.getValue();\r\n  }\r\n\r\n  addUINames(map) {\r\n    for (let k in map) {\r\n      this.ui_value_names[k] = map[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addDescriptions(map) {\r\n    for (let k in map) {\r\n      this.descriptions[k] = map[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addIcons2(iconmap2) {\r\n    if (this.iconmap2 === undefined) {\r\n      this.iconmap2 = {};\r\n    }\r\n\r\n    for (let k in iconmap2) {\r\n      this.iconmap2[k] = iconmap2[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addIcons(iconmap) {\r\n    if (this.iconmap === undefined) {\r\n      this.iconmap = {};\r\n    }\r\n    for (let k in iconmap) {\r\n      this.iconmap[k] = iconmap[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  copyTo(p) {\r\n    super.copyTo(p);\r\n\r\n    p.data = this.data;\r\n\r\n    p.keys = Object.assign({}, this.keys);\r\n    p.values = Object.assign({}, this.values);\r\n    p.ui_value_names = this.ui_value_names;\r\n    p.update = this.update;\r\n    p.api_update = this.api_update;\r\n\r\n    p.iconmap = this.iconmap;\r\n    p.iconmap2 = this.iconmap2;\r\n    p.descriptions = this.descriptions;\r\n\r\n    return p;\r\n  }\r\n\r\n  copy() {\r\n    var p = new this.constructor(\"dummy\", {\"dummy\": 0}, this.apiname, this.uiname, this.description, this.flag)\r\n\r\n    this.copyTo(p);\r\n    return p;\r\n  }\r\n\r\n  getValue() {\r\n    if (this.data in this.values)\r\n      return this.values[this.data];\r\n    else\r\n      return this.data;\r\n  }\r\n\r\n  setValue(val) {\r\n    if (!(val in this.values) && (val in this.keys))\r\n      val = this.keys[val];\r\n\r\n    if (!(val in this.values)) {\r\n      this.report(\"Invalid value for enum!\", val, this.values);\r\n      return;\r\n    }\r\n\r\n    this.data = val;\r\n\r\n    //fire events\r\n    super.setValue(val);\r\n    return this;\r\n  }\r\n\r\n  _loadMap(obj) {\r\n    if (!obj) {\r\n      return {};\r\n    }\r\n\r\n    let ret = {};\r\n    for (let k of obj) {\r\n      ret[k.key] = k.val;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  _saveMap(obj) {\r\n    obj = obj === undefined ? {} : obj;\r\n    let ret = [];\r\n\r\n    for (let k in obj) {\r\n      ret.push(new EnumKeyPair(k, obj[k]));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n\r\n    this.keys = this._loadMap(this._keys);\r\n    this.values = this._loadMap(this._values);\r\n    this.ui_value_names = this._loadMap(this._ui_value_names);\r\n    this.iconmap = this._loadMap(this._iconmap);\r\n    this.iconmap2 = this._loadMap(this._iconmap2);\r\n    this.descriptions = this._loadMap(this._descriptions);\r\n\r\n    if (this.data_is_int) {\r\n      this.data = parseInt(this.data);\r\n      delete this.data_is_int;\r\n    } else if (this.data in this.keys) {\r\n      this.data = this.keys[this.data];\r\n    }\r\n  }\r\n\r\n  _is_data_int() {\r\n    return typeof this.data === \"number\";\r\n  }\r\n}\r\n\r\nToolProperty.internalRegister(EnumProperty);\r\nEnumProperty.STRUCT = nstructjs.inherit(EnumProperty, ToolProperty) + `\r\n  data            : string             | \"\"+this.data;\r\n  data_is_int     : bool               | this._is_data_int();\r\n  _keys           : array(EnumKeyPair) | this._saveMap(this.keys) ;\r\n  _values         : array(EnumKeyPair) | this._saveMap(this.values) ;\r\n  _ui_value_names : array(EnumKeyPair) | this._saveMap(this.ui_value_names) ;\r\n  _iconmap        : array(EnumKeyPair) | this._saveMap(this.iconmap) ;\r\n  _iconmap2       : array(EnumKeyPair) | this._saveMap(this.iconmap2) ;\r\n  _descriptions   : array(EnumKeyPair) | this._saveMap(this.descriptions) ;  \r\n}\r\n`;\r\nnstructjs.register(EnumProperty);\r\n\r\nexport class FlagProperty extends EnumProperty {\r\n  constructor(string, valid_values, apiname,\r\n              uiname, description, flag, icon) {\r\n    super(string, valid_values, apiname,\r\n      uiname, description, flag, icon);\r\n\r\n    this.type = PropTypes.FLAG;\r\n    this.wasSet = false;\r\n  }\r\n\r\n  setValue(bitmask) {\r\n    this.data = bitmask;\r\n\r\n    //do not trigger EnumProperty's setValue\r\n    ToolProperty.prototype.setValue.call(this, bitmask);\r\n    return this;\r\n  }\r\n}\r\n\r\nToolProperty.internalRegister(FlagProperty);\r\nFlagProperty.STRUCT = nstructjs.inherit(FlagProperty, EnumProperty) + `\r\n}\r\n`;\r\nnstructjs.register(FlagProperty);\r\n\r\n\r\nexport class VecPropertyBase extends FloatProperty {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(undefined, apiname, uiname, description);\r\n\r\n    this.hasUniformSlider = false;\r\n  }\r\n\r\n  calcMemSize() {\r\n    return super.calcMemSize() + this.data.length*8;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data.vectorDistance(b.data) < 0.00001;\r\n  }\r\n\r\n  uniformSlider(state = true) {\r\n    this.hasUniformSlider = state;\r\n    return this;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n    b.hasUniformSlider = this.hasUniformSlider;\r\n  }\r\n}\r\n\r\nVecPropertyBase.STRUCT = nstructjs.inherit(VecPropertyBase, FloatProperty) + `\r\n  hasUniformSlider : bool | this.hasUniformSlider || false;\r\n}\r\n`;\r\n\r\n\r\nexport class Vec2Property extends FloatProperty {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(undefined, apiname, uiname, description);\r\n\r\n    this.type = PropTypes.VEC2;\r\n    this.data = new Vector2(data);\r\n  }\r\n\r\n  setValue(v) {\r\n    this.data.load(v);\r\n\r\n    //do not trigger parent classes's setValue\r\n    ToolProperty.prototype.setValue.call(this, v);\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    let data = b.data;\r\n    super.copyTo(b);\r\n\r\n    b.data = data;\r\n    b.data.load(this.data);\r\n  }\r\n}\r\n\r\nVec2Property.STRUCT = nstructjs.inherit(Vec2Property, VecPropertyBase) + `\r\n  data : vec2;\r\n}\r\n`;\r\nnstructjs.register(Vec2Property);\r\n\r\nToolProperty.internalRegister(Vec2Property);\r\n\r\nexport class Vec3Property extends VecPropertyBase {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(undefined, apiname, uiname, description);\r\n\r\n    this.type = PropTypes.VEC3;\r\n    this.data = new Vector3(data);\r\n  }\r\n\r\n  isColor() {\r\n    this.subtype = PropSubTypes.COLOR;\r\n    return this;\r\n  }\r\n\r\n  setValue(v) {\r\n    this.data.load(v);\r\n\r\n    //do not trigger parent classes's setValue\r\n    ToolProperty.prototype.setValue.call(this, v);\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    let data = b.data;\r\n    super.copyTo(b);\r\n\r\n    b.data = data;\r\n    b.data.load(this.data);\r\n  }\r\n}\r\n\r\nVec3Property.STRUCT = nstructjs.inherit(Vec3Property, VecPropertyBase) + `\r\n  data : vec3;\r\n}\r\n`;\r\nnstructjs.register(Vec3Property);\r\nToolProperty.internalRegister(Vec3Property);\r\n\r\nexport class Vec4Property extends FloatProperty {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(undefined, apiname, uiname, description);\r\n\r\n    this.type = PropTypes.VEC4;\r\n    this.data = new Vector4(data);\r\n  }\r\n\r\n  setValue(v, w = 1.0) {\r\n    this.data.load(v);\r\n\r\n    //do not trigger parent classes's setValue\r\n    ToolProperty.prototype.setValue.call(this, v);\r\n\r\n    if (v.length < 3) {\r\n      this.data[2] = 0.0;\r\n    }\r\n    if (v.length < 4) {\r\n      this.data[3] = w;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  isColor() {\r\n    this.subtype = PropSubTypes.COLOR;\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    let data = b.data;\r\n    super.copyTo(b);\r\n\r\n    b.data = data;\r\n    b.data.load(this.data);\r\n  }\r\n}\r\n\r\nVec4Property.STRUCT = nstructjs.inherit(Vec4Property, VecPropertyBase) + `\r\n  data : vec4;\r\n}\r\n`;\r\nnstructjs.register(Vec4Property);\r\nToolProperty.internalRegister(Vec4Property);\r\n\r\nexport class QuatProperty extends ToolProperty {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(PropTypes.QUAT, undefined, apiname, uiname, description);\r\n    this.data = new Quat(data);\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data.vectorDistance(b.data) < 0.00001;\r\n  }\r\n\r\n  setValue(v) {\r\n    this.data.load(v);\r\n    super.setValue(v);\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    let data = b.data;\r\n    super.copyTo(b);\r\n\r\n    b.data = data;\r\n    b.data.load(this.data);\r\n  }\r\n}\r\n\r\nQuatProperty.STRUCT = nstructjs.inherit(QuatProperty, VecPropertyBase) + `\r\n  data : vec4;\r\n}\r\n`;\r\nnstructjs.register(QuatProperty);\r\n\r\nToolProperty.internalRegister(QuatProperty);\r\n\r\nexport class Mat4Property extends ToolProperty {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(PropTypes.MATRIX4, undefined, apiname, uiname, description);\r\n    this.data = new Matrix4(data);\r\n  }\r\n\r\n  calcMemSize() {\r\n    return super.calcMemSize() + 16*8 + 32;\r\n  }\r\n\r\n  equals(b) {\r\n    let m1 = this.data.$matrix;\r\n    let m2 = b.data.$matrix;\r\n\r\n    for (let i = 1; i <= 4; i++) {\r\n      for (let j = 1; j <= 4; j++) {\r\n        let key = `m${i}${j}`;\r\n\r\n        if (Math.abs(m1[key] - m2[key]) > 0.00001) {\r\n          return false;\r\n        }\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  setValue(v) {\r\n    this.data.load(v);\r\n    super.setValue(v);\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    let data = b.data;\r\n    super.copyTo(b);\r\n    b.data = data;\r\n\r\n    b.data.load(this.data);\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n  }\r\n}\r\n\r\nMat4Property.STRUCT = nstructjs.inherit(Mat4Property, FloatProperty) + `\r\n  data           : mat4;\r\n}\r\n`;\r\nnstructjs.register(Mat4Property);\r\nToolProperty.internalRegister(Mat4Property);\r\n\r\n/**\r\n * List of other tool props (all of one type)\r\n */\r\nexport class ListProperty extends ToolProperty {\r\n  /*\r\n  * Prop must be a ToolProperty subclass instance\r\n  * */\r\n  constructor(prop, list = [], uiname = \"\") {\r\n    super(PropTypes.PROPLIST);\r\n\r\n    this.uiname = uiname;\r\n\r\n    if (typeof prop == \"number\") {\r\n      prop = PropClasses[prop];\r\n\r\n      if (prop !== undefined) {\r\n        prop = new prop();\r\n      }\r\n    } else if (prop !== undefined) {\r\n      if (prop instanceof ToolProperty) {\r\n        prop = prop.copy();\r\n      } else {\r\n        prop = new prop();\r\n      }\r\n    }\r\n\r\n\r\n    this.prop = prop;\r\n    this.value = [];\r\n\r\n    if (list) {\r\n      for (let val of list) {\r\n        this.push(val);\r\n      }\r\n    }\r\n\r\n    this.wasSet = false;\r\n  }\r\n\r\n  get length() {\r\n    return this.value.length;\r\n  }\r\n\r\n  set length(val) {\r\n    this.value.length = val;\r\n  }\r\n\r\n  calcMemSize() {\r\n    let tot = super.calcMemSize();\r\n\r\n    let psize = this.prop ? this.prop.calcMemSize() + 8 : 8;\r\n    if (!this.prop && this.value.length > 0) {\r\n      psize = this.value[0].calcMemSize();\r\n    }\r\n\r\n    tot += psize*this.value.length + 8;\r\n    tot += 16;\r\n\r\n    return tot;\r\n  }\r\n\r\n  equals(b) {\r\n    let l1 = this.value ? this.value.length : 0;\r\n    let l2 = b.value ? b.value.length : 0;\r\n\r\n    if (l1 !== l2) {\r\n      return false;\r\n    }\r\n\r\n    for (let i = 0; i < l1; i++) {\r\n      let prop1 = this.value[i];\r\n      let prop2 = b.value[i];\r\n\r\n      let bad = prop1.constructor !== prop2.constructor;\r\n      bad = bad || !prop1.equals(prop2);\r\n\r\n      if (bad) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n\r\n    b.prop = this.prop.copy();\r\n\r\n    for (let prop of this.value) {\r\n      b.value.push(prop.copy());\r\n    }\r\n\r\n    return b;\r\n  }\r\n\r\n  copy() {\r\n    return this.copyTo(new ListProperty(this.prop.copy()));\r\n  }\r\n\r\n  push(item = undefined) {\r\n    if (item === undefined) {\r\n      item = this.prop.copy();\r\n    }\r\n\r\n    if (!(item instanceof ToolProperty)) {\r\n      let prop = this.prop.copy();\r\n      prop.setValue(item);\r\n      item = prop;\r\n    }\r\n\r\n    this.value.push(item);\r\n    return item;\r\n  }\r\n\r\n  clear() {\r\n    this.value.length = 0;\r\n  }\r\n\r\n  getListItem(i) {\r\n    return this.value[i].getValue();\r\n  }\r\n\r\n  setListItem(i, val) {\r\n    this.value[i].setValue(val);\r\n  }\r\n\r\n  setValue(value) {\r\n    this.clear();\r\n\r\n    for (let item of value) {\r\n      let prop = this.push();\r\n\r\n      if (typeof item !== \"object\") {\r\n        prop.setValue(item);\r\n      } else if (item instanceof prop.constructor) {\r\n        item.copyTo(prop);\r\n      } else {\r\n        this.report(item);\r\n        throw new Error(\"invalid value \" + item);\r\n      }\r\n    }\r\n\r\n    super.setValue(value);\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.value;\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    let list = this.value;\r\n\r\n    return (function* () {\r\n      for (let item of list) {\r\n        yield item.getValue();\r\n      }\r\n    })();\r\n  }\r\n}\r\n\r\nListProperty.STRUCT = nstructjs.inherit(ListProperty, ToolProperty) + `\r\n  prop  : abstract(ToolProperty);\r\n  value : array(abstract(ToolProperty));\r\n}`;\r\nnstructjs.register(ListProperty);\r\n\r\nToolProperty.internalRegister(ListProperty);\r\n\r\n\r\n//like FlagsProperty but uses strings\r\nexport class StringSetProperty extends ToolProperty {\r\n  constructor(value = undefined, definition = []) {\r\n    super(PropTypes.STRSET);\r\n\r\n    let values = [];\r\n\r\n    this.value = new util.set();\r\n\r\n    let def = definition;\r\n    if (Array.isArray(def) || def instanceof util.set || def instanceof Set) {\r\n      for (let item of def) {\r\n        values.push(item);\r\n      }\r\n    } else if (typeof def === \"object\") {\r\n      for (let k in def) {\r\n        values.push(k);\r\n      }\r\n    } else if (typeof def === \"string\") {\r\n      values.push(def);\r\n    }\r\n\r\n    this.values = {};\r\n    this.ui_value_names = {};\r\n    this.descriptions = {};\r\n    this.iconmap = {};\r\n    this.iconmap2 = {};\r\n\r\n    for (let v of values) {\r\n      this.values[v] = v;\r\n\r\n      let uiname = ToolProperty.makeUIName(v);\r\n      this.ui_value_names[v] = uiname;\r\n    }\r\n\r\n    if (value !== undefined) {\r\n      this.setValue(value);\r\n    }\r\n\r\n    this.wasSet = false;\r\n  }\r\n\r\n  calcMemSize() {\r\n    let tot = super.calcMemSize();\r\n\r\n    for (let k in this.values) {\r\n      tot += (k.length + 16)*5;\r\n    }\r\n\r\n    if (this.descriptions) {\r\n      for (let k in this.descriptions) {\r\n        tot += (k.length + this.descriptions[k].length + 8)*4;\r\n      }\r\n    }\r\n\r\n    return tot + 64;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.value.equals(b.value);\r\n  }\r\n\r\n  /*\r\n  * Values can be a string, undefined/null, or a list/set/object-literal of strings.\r\n  * If destructive is true, then existing set will be cleared.\r\n  * */\r\n  setValue(values, destructive = true, soft_fail = true) {\r\n    let bad = typeof values !== \"string\";\r\n    bad = bad && typeof values !== \"object\";\r\n    bad = bad && values !== undefined && values !== null;\r\n\r\n    if (bad) {\r\n      if (soft_fail) {\r\n        this.report(\"Invalid argument to StringSetProperty.prototype.setValue() \" + values);\r\n        return;\r\n      } else {\r\n        throw new Error(\"Invalid argument to StringSetProperty.prototype.setValue() \" + values);\r\n      }\r\n    }\r\n\r\n    //handle undefined/null\r\n    if (!values) {\r\n      this.value.clear();\r\n    } else if (typeof values === \"string\") {\r\n      if (destructive)\r\n        this.value.clear();\r\n\r\n      if (!(values in this.values)) {\r\n        if (soft_fail) {\r\n          this.report(`\"${values}\" is not in this StringSetProperty`);\r\n          return;\r\n        } else {\r\n          throw new Error(`\"${values}\" is not in this StringSetProperty`);\r\n        }\r\n      }\r\n\r\n      this.value.add(values);\r\n    } else {\r\n      let data = [];\r\n\r\n      if (Array.isArray(values) || values instanceof util.set || values instanceof Set) {\r\n        for (let item of values) {\r\n          data.push(item);\r\n        }\r\n      } else { //object literal?\r\n        for (let k in values) {\r\n          data.push(k);\r\n        }\r\n      }\r\n\r\n      for (let item of data) {\r\n        if (!(item in this.values)) {\r\n          if (soft_fail) {\r\n            this.report(`\"${item}\" is not in this StringSetProperty`);\r\n            continue;\r\n          } else {\r\n            throw new Error(`\"${item}\" is not in this StringSetProperty`);\r\n          }\r\n        }\r\n\r\n        this.value.add(item);\r\n      }\r\n    }\r\n\r\n    super.setValue();\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.value;\r\n  }\r\n\r\n  addIcons2(iconmap2) {\r\n    if (iconmap2 === undefined)\r\n      return;\r\n\r\n    for (let k in iconmap2) {\r\n      this.iconmap2[k] = iconmap2[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addIcons(iconmap) {\r\n    if (iconmap === undefined)\r\n      return;\r\n\r\n    for (let k in iconmap) {\r\n      this.iconmap[k] = iconmap[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addUINames(map) {\r\n    for (let k in map) {\r\n      this.ui_value_names[k] = map[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addDescriptions(map) {\r\n    for (let k in map) {\r\n      this.descriptions[k] = map[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n\r\n    for (let val of this.value) {\r\n      b.value.add(val);\r\n    }\r\n\r\n    b.values = {};\r\n    for (let k in this.values) {\r\n      b.values[k] = this.values[k];\r\n    }\r\n\r\n    b.ui_value_names = {};\r\n    for (let k in this.ui_value_names) {\r\n      b.ui_value_names[k] = this.ui_value_names[k];\r\n    }\r\n\r\n    b.iconmap = {};\r\n    b.iconmap2 = {};\r\n\r\n    for (let k in this.iconmap) {\r\n      b.iconmap[k] = this.iconmap[k];\r\n    }\r\n\r\n    for (let k in this.iconmap2) {\r\n      b.iconmap2[k] = this.iconmap2[k];\r\n    }\r\n\r\n    b.descriptions = {};\r\n    for (let k in this.descriptions) {\r\n      b.descriptions[k] = this.descriptions[k];\r\n    }\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    let values = this.values;\r\n    this.values = {};\r\n\r\n    for (let s of values) {\r\n      this.values[s] = s;\r\n    }\r\n\r\n    this.value = new util.set(this.value);\r\n  }\r\n}\r\n\r\nStringSetProperty.STRUCT = nstructjs.inherit(StringSetProperty, ToolProperty) + `\r\n  value  : iter(string);\r\n  values : iterkeys(string);  \r\n}`;\r\nnstructjs.register(StringSetProperty);\r\n\r\nToolProperty.internalRegister(StringSetProperty);\r\n\r\nimport {Curve1D} from '../curve/curve1d.js';\r\n\r\nexport class Curve1DProperty extends ToolProperty {\r\n  constructor(curve, apiname, uiname, description, flag, icon) {\r\n    super(PropTypes.CURVE, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.data = new Curve1D();\r\n\r\n    if (curve !== undefined) {\r\n      this.setValue(curve);\r\n    }\r\n\r\n    this.wasSet = false;\r\n  }\r\n\r\n  calcMemSize() {\r\n    //bleh, just return a largish block size\r\n    return 1024;\r\n  }\r\n\r\n  equals(b) {\r\n\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  evaluate(t) {\r\n    return this.data.evaluate(t);\r\n  }\r\n\r\n  setValue(curve) {\r\n    if (curve === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.data.load(curve);\r\n    super.setValue(curve);\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n\r\n    b.setValue(this.data);\r\n  }\r\n}\r\n\r\nCurve1DProperty.STRUCT = nstructjs.inherit(Curve1DProperty, ToolProperty) + `\r\n  data : Curve1D;\r\n}\r\n`;\r\n\r\nnstructjs.register(Curve1DProperty);\r\nToolProperty.internalRegister(Curve1DProperty);\r\n\r\n","export const ClassIdSymbol = Symbol(\"pathux-class-id\");\r\n","//import * as nstructjs from './struct.js';\r\nimport {haveModal, _setModalAreaClass} from '../path-controller/util/simple_events.js';\r\nimport * as util from '../path-controller/util/util.js';\r\n\r\nimport '../path-controller/util/struct.js';\r\n\r\nlet ScreenClass = undefined;\r\n\r\nimport {ClassIdSymbol} from '../core/ui_consts.js';\r\n\r\n\r\nexport function setScreenClass(cls) {\r\n  ScreenClass = cls;\r\n}\r\n\r\nexport function getAreaIntName(name) {\r\n  let hash = 0;\r\n\r\n  for (let i = 0; i < name.length; i++) {\r\n    let c = name.charCodeAt(i);\r\n\r\n    if (i%2 === 0) {\r\n      hash += c<<8;\r\n      hash *= 13;\r\n      hash = hash & ((1<<15) - 1);\r\n    } else {\r\n      hash += c;\r\n    }\r\n  }\r\n\r\n  return hash;\r\n}\r\n\r\n//XXX get rid of me\r\nwindow.getAreaIntName = getAreaIntName;\r\n\r\n//XXX get rid of me\r\nexport var AreaTypes = {\r\n  TEST_CANVAS_EDITOR: 0\r\n};\r\n\r\n  export function setAreaTypes(def) {\r\n  for (let k in AreaTypes) {\r\n    delete AreaTypes[k];\r\n  }\r\n\r\n  for (let k in def) {\r\n    AreaTypes[k] = def[k];\r\n  }\r\n}\r\n\r\nexport let areaclasses = {};\r\n\r\n/*hackish! store ref an active wrangler so simple_event's modal\r\n* system can lock it!*/\r\nlet theWrangler = undefined;\r\n\r\nexport class AreaWrangler {\r\n  constructor() {\r\n    this.stacks = new Map();\r\n    this.lasts = new Map();\r\n    this.lastArea = undefined;\r\n    this.stack = [];\r\n    this.idgen = 0;\r\n    this.locked = 0;\r\n    this._last_screen_id = undefined;\r\n\r\n    theWrangler = this;\r\n  }\r\n\r\n  /*Yeek this is particularly evil, it creates a context\r\n  * that can be used by popups with the original context\r\n  * area stack intact of the elements that spawned them.*/\r\n  makeSafeContext(ctx) {\r\n    let wrangler = this.copy();\r\n    let this2 = this;\r\n\r\n    return new Proxy(ctx, {\r\n      get(target, key, rec) {\r\n        wrangler.copyTo(contextWrangler);\r\n        return target[key];\r\n      }\r\n    });\r\n  }\r\n\r\n  copyTo(ret) {\r\n    for (let [key, stack1] of this.stacks) {\r\n      ret.stack.set(key, util.list(stack1));\r\n    }\r\n\r\n    for (let [key, val] of this.lasts) {\r\n      ret.lasts.set(key, val);\r\n    }\r\n\r\n    ret.stack = util.list(this.stack);\r\n    ret.lastArea = this.lastArea;\r\n  }\r\n\r\n  copy(b) {\r\n    let ret = new AreaWrangler();\r\n    this.copyTo(ret);\r\n    return ret;\r\n  }\r\n\r\n  _checkWrangler(ctx) {\r\n    if (ctx === undefined) {\r\n      return true;\r\n    }\r\n\r\n    if (this._last_screen_id === undefined) {\r\n      this._last_screen_id = ctx.screen._id;\r\n      return true;\r\n    }\r\n\r\n    if (ctx.screen._id !== this._last_screen_id) {\r\n      this.reset();\r\n\r\n      this._last_screen_id = ctx.screen._id;\r\n      console.warn(\"contextWrangler detected a new screen; new file?\");\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  reset() {\r\n    theWrangler = this;\r\n    this.stacks = new Map();\r\n    this.lasts = new Map();\r\n    this.lastArea = undefined;\r\n    this.stack = [];\r\n    this.locked = 0;\r\n    this._last_screen_id = undefined;\r\n\r\n    return this;\r\n  }\r\n\r\n  static findInstance() {\r\n    return theWrangler;\r\n  }\r\n\r\n  static lock() {\r\n    return this.findInstance().lock();\r\n  }\r\n\r\n  static unlock() {\r\n    return this.findInstance().unlock();\r\n  }\r\n\r\n  lock() {\r\n    this.locked++;\r\n    return this;\r\n  }\r\n\r\n  unlock() {\r\n    this.locked = Math.max(this.locked - 1, 0);\r\n    return this;\r\n  }\r\n\r\n  push(type, area, pushLastRef = true) {\r\n    theWrangler = this;\r\n\r\n    if (haveModal() || this.locked) {\r\n      pushLastRef = false;\r\n    }\r\n\r\n    if (pushLastRef || !this.lasts.has(type[ClassIdSymbol])) {\r\n      this.lasts.set(type[ClassIdSymbol], area);\r\n      this.lastArea = area;\r\n    }\r\n\r\n    let stack = this.stacks.get(type[ClassIdSymbol]);\r\n    if (stack === undefined) {\r\n      stack = [];\r\n      this.stacks.set(type[ClassIdSymbol], stack);\r\n    }\r\n\r\n    let last = this.lasts.get(type[ClassIdSymbol]);\r\n\r\n    stack.push(last);\r\n    stack.push(area);\r\n\r\n    this.stack.push(area);\r\n  }\r\n\r\n  updateLastRef(type, area) {\r\n    theWrangler = this;\r\n\r\n    if ((this.locked || haveModal()) && this.lasts.has(type[ClassIdSymbol])) {\r\n      return;\r\n    }\r\n\r\n    this.lasts.set(type[ClassIdSymbol], area);\r\n    this.lastArea = area;\r\n  }\r\n\r\n  pop(type, area) {\r\n    let stack = this.stacks.get(type[ClassIdSymbol]);\r\n\r\n    if (stack === undefined) {\r\n      console.warn(\"pop_ctx_area called in error\");\r\n      //throw new Error(\"pop_ctx_area called in error\");\r\n      return;\r\n    }\r\n\r\n    if (stack.length > 0) {\r\n      stack.pop();\r\n      let last = stack.pop();\r\n\r\n      /* paranoia isConnected check to ensure stale elements don't\r\n       * pollute the lasts stack */\r\n      if (!this.locked && last && last.isConnected) {\r\n        this.lasts.set(type[ClassIdSymbol], last);\r\n      }\r\n    } else {\r\n      console.error(\"pop_ctx_area called in error\");\r\n    }\r\n\r\n    if (this.stack.length > 0) {\r\n      this.stack.pop();\r\n    }\r\n  }\r\n\r\n  getLastArea(type) {\r\n    //if (Math.random() > 0.9995) {\r\n      //console.warn(\"getLastArea!\", type, this.lasts.get(type[ClassIdSymbol]));\r\n    //}\r\n\r\n    if (type === undefined) {\r\n      if (this.stack.length > 0) {\r\n        return this.stack[this.stack.length - 1];\r\n      } else {\r\n        return this.lastArea;\r\n      }\r\n    } else {\r\n      if (this.stacks.has(type[ClassIdSymbol])) {\r\n        let stack = this.stacks.get(type[ClassIdSymbol]);\r\n\r\n        if (stack.length > 0) {\r\n          return stack[stack.length-1];\r\n        }\r\n      }\r\n\r\n      return this.lasts.get(type[ClassIdSymbol]);\r\n    }\r\n  }\r\n}\r\n_setModalAreaClass(AreaWrangler);\r\n\r\nexport let contextWrangler = new AreaWrangler();\r\n","\"use strict\";\r\n\r\nimport * as util from './util.js';\r\nimport * as vectormath from './vectormath.js';\r\n\r\nimport {Vector2, Vector3, Vector4, Matrix4, Quat} from './vectormath.js';\r\n\r\nlet dtvtmps = util.cachering.fromConstructor(Vector3, 32);\r\n\r\n\r\nlet quad_co_rets2 = util.cachering.fromConstructor(Vector2, 512);\r\n\r\nexport function quad_bilinear(v1, v2, v3, v4, u, v) {\r\n  return -((v1 - v2)*u - v1 - (u*v1 - u*v2 + u*v3 - u*v4 - v1 + v4)*v);\r\n}\r\n\r\n/*\r\n\r\n on factor;\r\n off period;\r\n\r\n a1 := v1 + (v2 - v1) * u;\r\n a2 := v4 + (v3 - v4) * u;\r\n bilin := a1 + (a2 - a1) * v;\r\n\r\n v1x := 0;\r\n v1y := 0;\r\n\r\n bx := sub(v1=v1x, v2=v2x, v3=v3x, v4=v4x, bilin);\r\n by := sub(v1=v1y, v2=v2y, v3=v3y, v4=v4y, bilin);\r\n\r\n f1 := bx - x;\r\n f2 := by - y;\r\n\r\n ff := solve({f1, f2}, {u, v});\r\n\r\n */\r\nfunction quad_uv_2d(p, v1, v2, v3, v4) {\r\n  let u, v;\r\n\r\n  let v2x = v2[0] - v1[0];\r\n  let v2y = v2[1] - v1[1];\r\n  let v3x = v3[0] - v1[0];\r\n  let v3y = v3[1] - v1[1];\r\n  let v4x = v4[0] - v1[0];\r\n  let v4y = v4[1] - v1[1];\r\n\r\n  let x = p[0] - v1[0];\r\n  let y = p[1] - v1[1];\r\n  let sqrt = Math.sqrt;\r\n\r\n  let A = 2*(((v4y + y)*x - 2*v4x*y)*\r\n      v3y + (v4x*y - v4y*x)*(v4y + y) - ((v4x - x)*v2y - v3x*y)*(v4y - y))*v2x - 2*(\r\n      (v4x*y - v4y*x)*(v4x + x) - (v4x - x)*v3y*x + ((2*v4y - y)*x - v4x*y)*v3x)*\r\n    v2y + (v4x*y - v4y*x + v3y*x - v3x*y)**2 + (v4x - x)**2*v2y**2 + (v4y - y)**2*\r\n    v2x**2;\r\n\r\n  let B = v4x*y - v4y*x + v3y*x - v3x*y;\r\n\r\n  let C1 = (2*(v3x - v4x)*v2y - 2*(v3y - v4y)*v2x);\r\n  let C2 = (2*(v3x*v4y - v3y*v4x + v2y*v4x) - 2*v2x*v4y);\r\n\r\n  let u1, u2;\r\n\r\n  if (A < 0.0) {\r\n    console.log(\"A was < 0\", A);\r\n    A = -A;\r\n    C1 = C2 = 0.0;\r\n  }\r\n\r\n  if (Math.abs(C1) < 0.00001) { //perfectly 90 degrees?\r\n    let dx = v2x;\r\n    let dy = v2y;\r\n\r\n    console.log(\"C1 bad\");\r\n\r\n    let l = Math.sqrt(dx*dx + dy*dy);\r\n    if (l > 0.000001) {\r\n      dx /= l*l;\r\n      dy /= l*l;\r\n    }\r\n\r\n    u1 = u2 = dx*x + dy*y;\r\n  } else {\r\n    u1 = (-(B + sqrt(A) - (v4y - y)*v2x) - (v4x - x)*v2y)/C1;\r\n    u2 = (-(B - sqrt(A) - (v4y - y)*v2x) - (v4x - x)*v2y)/C1;\r\n  }\r\n\r\n  if (Math.abs(C2) < 0.00001) { //perfectly 90 degrees?\r\n    let dx, dy;\r\n\r\n    dx = v3x - v2x;\r\n    dy = v3y - v2y;\r\n\r\n    console.log(\"C2 bad\");\r\n\r\n    let l = Math.sqrt(dx**2 + dy**2);\r\n    if (l > 0.00001) {\r\n      dx /= l*l;\r\n      dy /= l*l;\r\n    }\r\n\r\n    v1 = v2 = x*dx + y*dy;\r\n  } else {\r\n    v1 = (-(B - sqrt(A) + (v4y + y)*v2x) + (v4x + x)*v2y)/C2;\r\n    v2 = (-(B + sqrt(A) + (v4y + y)*v2x) + (v4x + x)*v2y)/C2;\r\n  }\r\n\r\n  let ret = quad_co_rets2.next();\r\n\r\n  let d1 = (u1 - 0.5)**2 + (v1 - 0.5)**2;\r\n  let d2 = (u2 - 0.5)**2 + (v2 - 0.5)**2;\r\n\r\n  if (d1 < d2) {\r\n    ret[0] = u1;\r\n    ret[1] = v1;\r\n  } else {\r\n    ret[0] = u2;\r\n    ret[1] = v2;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n\r\nexport const ClosestModes = {\r\n  CLOSEST  : 0,\r\n  START    : 1,\r\n  END      : 2,\r\n  ENDPOINTS: 3,\r\n  ALL      : 4\r\n};\r\n\r\nlet advs = util.cachering.fromConstructor(Vector4, 128);\r\n\r\nexport class AbstractCurve {\r\n  evaluate(t) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  derivative(t) {\r\n  }\r\n\r\n  curvature(t) {\r\n\r\n  }\r\n\r\n  normal(t) {\r\n\r\n  }\r\n\r\n  width(t) {\r\n\r\n  }\r\n}\r\n\r\nexport class ClosestCurveRets {\r\n  constructor() {\r\n    this.p = new Vector3();\r\n    this.t = 0;\r\n  }\r\n}\r\n\r\nlet cvrets = util.cachering.fromConstructor(ClosestCurveRets, 2048);\r\nlet cvarrays = new util.ArrayPool();\r\nlet cvtmp = new Array(1024);\r\n\r\nexport function closestPoint(p, curve, mode) {\r\n  let steps = 5;\r\n  let s = 0, ds = 1.0/steps;\r\n\r\n  let ri = 0;\r\n\r\n  for (let i = 0; i < steps; i++, s += ds) {\r\n    let c1 = curve.evaluate(s);\r\n    let c2 = curve.evaluate(s + ds);\r\n\r\n\r\n  }\r\n}\r\n\r\nlet poly_normal_tmps = util.cachering.fromConstructor(Vector3, 64);\r\nlet pncent = new Vector3();\r\n\r\nexport function normal_poly(vs) {\r\n  if (vs.length === 3) {\r\n    return poly_normal_tmps.next().load(normal_tri(vs[0], vs[1], vs[2]));\r\n  } else if (vs.length === 4) {\r\n    return poly_normal_tmps.next().load(normal_quad(vs[0], vs[1], vs[2], vs[3]));\r\n  }\r\n\r\n  if (vs.length === 0) {\r\n    return poly_normal_tmps.next().zero();\r\n  }\r\n\r\n  let cent = pncent.zero();\r\n  let tot = 0;\r\n\r\n  for (let v of vs) {\r\n    cent.add(v);\r\n    tot++;\r\n  }\r\n\r\n  cent.mulScalar(1.0/tot);\r\n  let n = poly_normal_tmps.next().zero();\r\n\r\n  for (let i = 0; i < vs.length; i++) {\r\n    let a = vs[i];\r\n    let b = vs[(i + 1)%vs.length];\r\n    let c = cent;\r\n\r\n    let n2 = normal_tri(a, b, c);\r\n    n.add(n2);\r\n  }\r\n\r\n  n.normalize();\r\n  return n;\r\n}\r\n\r\n/*\r\non factor;\r\noff period;\r\n\r\nf1 := u*v1x + v*v2x + (1.0-u-v)*v3x - px;\r\nf2 := u*v1y + v*v2y + (1.0-u-v)*v3y - py;\r\n\r\nff := solve({f1, f2}, {u, v});\r\n\r\non fort;\r\npart(ff, 1, 1);\r\npart(ff, 1, 2);\r\noff fort;\r\n\r\n*/\r\n\r\nlet barycentric_v2_rets = util.cachering.fromConstructor(Vector2, 2048);\r\nlet calc_proj_refs = new util.cachering(() => [0, 0], 64);\r\n\r\n/*\r\n  a b c d\r\n     b\r\n\r\n  a------c\r\n\r\n     d\r\n\r\n  on factor;\r\n  load_package avector;\r\n\r\n  ax := 0;\r\n  ay := 0;\r\n  az := 0;\r\n\r\n  a := avec(ax, ay, az);\r\n  b := avec(bx, by, bz);\r\n  c := avec(cx, cy, cz);\r\n  d := avec(dx, dy, dz);\r\n\r\n  n1 := d cross c;\r\n  n2 := c cross b;\r\n\r\n  n1 := n1 / (VMOD n1);\r\n  n2 := n2 / (VMOD n2);\r\n\r\n  d := n1 dot n2;\r\n  on fort;\r\n\r\n  d*d;\r\n\r\n  off fort;\r\n\r\n\r\n  */\r\n\r\n/**\r\n\r\n v2\r\n\r\n v1------v3\r\n\r\n v4\r\n\r\n */\r\nexport function dihedral_v3_sqr(v1, v2, v3, v4) {\r\n  let bx = v2[0] - v1[0];\r\n  let by = v2[1] - v1[1];\r\n  let bz = v2[2] - v1[2];\r\n\r\n  let cx = v3[0] - v1[0];\r\n  let cy = v3[1] - v1[1];\r\n  let cz = v3[2] - v1[2];\r\n\r\n  let dx = v4[0] - v1[0];\r\n  let dy = v4[1] - v1[1];\r\n  let dz = v4[2] - v1[2];\r\n\r\n\r\n  return ((bx*cz - bz*cx)*(cx*dz - cz*dx) + (by*cz - bz*cy)*(cy*dz - cz*dy) + (bx*cy - by*cx)*\r\n    (cx*dy - cy*dx))**2/(((bx*cz - bz*cx)**2 + (by*cz - bz*cy)**2\r\n    + (bx*cy - by*cx)**2)*((cx*dz - cz*dx)**2 + (cy*dz - cz*dy)**2 + (cx*dy - cy*dx)**2));\r\n}\r\n\r\nlet tet_area_tmps = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport function tet_volume(a, b, c, d) {\r\n  a = tet_area_tmps.next().load(a);\r\n  b = tet_area_tmps.next().load(b);\r\n  c = tet_area_tmps.next().load(c);\r\n  d = tet_area_tmps.next().load(d);\r\n\r\n  a.sub(d);\r\n  b.sub(d);\r\n  c.sub(d);\r\n\r\n  b.cross(c);\r\n  return a.dot(b)/6.0;\r\n}\r\n\r\nexport function calc_projection_axes(no) {\r\n  let ax = Math.abs(no[0]), ay = Math.abs(no[1]), az = Math.abs(no[2]);\r\n\r\n  let ret = calc_proj_refs.next();\r\n\r\n  if (ax > ay && ax > az) {\r\n    ret[0] = 1;\r\n    ret[1] = 2;\r\n  } else if (ay > az && ay > ax) {\r\n    ret[0] = 0;\r\n    ret[1] = 2;\r\n  } else {\r\n    ret[0] = 0;\r\n    ret[1] = 1;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nlet _avtmps = util.cachering.fromConstructor(Vector3, 128);\r\n\r\nfunction inrect_3d(p, min, max) {\r\n  let ok = p[0] >= min[0] && p[0] <= max[0];\r\n  ok = ok && p[1] >= min[1] && p[1] <= max[1];\r\n  ok = ok && p[2] >= min[2] && p[2] <= max[2];\r\n\r\n  return ok;\r\n}\r\n\r\nexport function aabb_isect_line_3d(v1, v2, min, max) {\r\n  let inside = inrect_3d(v1, min, max);\r\n  inside = inside || inrect_3d(v2, min, max);\r\n\r\n  if (inside) {\r\n    return true;\r\n  }\r\n\r\n  let cent = _avtmps.next().load(min).interp(max, 0.5);\r\n\r\n  let p = closest_point_on_line(cent, v1, v2, true);\r\n  if (!p) {\r\n    return false;\r\n  }\r\n\r\n  p = p[0];\r\n\r\n  return inrect_3d(p, min, max);\r\n}\r\n\r\nexport function aabb_isect_cylinder_3d(v1, v2, radius, min, max) {\r\n  let inside = inrect_3d(v1, min, max);\r\n  inside = inside || inrect_3d(v2, min, max);\r\n\r\n  if (inside) {\r\n    return true;\r\n  }\r\n\r\n  let cent = _avtmps.next().load(min).interp(max, 0.5);\r\n\r\n  let p = closest_point_on_line(cent, v1, v2, true);\r\n  if (!p) {\r\n    return false;\r\n  }\r\n\r\n  p = p[0];\r\n\r\n  let size = _avtmps.next().load(max).sub(min);\r\n\r\n  size.mulScalar(0.5);\r\n  size.addScalar(radius); //*(3**0.5));\r\n\r\n  p.sub(cent).abs();\r\n\r\n  return p[0] <= size[0] && p[1] <= size[1] && p[2] <= size[2];\r\n}\r\n\r\nexport function barycentric_v2(p, v1, v2, v3, axis1 = 0, axis2 = 1, out = undefined) {\r\n  let div = (v2[axis1]*v3[axis2] - v2[axis2]*v3[axis1] + (v2[axis2] - v3[axis2])*v1[axis1] - (v2[axis1] - v3[axis1])*v1[axis2]);\r\n\r\n  if (Math.abs(div) < 0.000001) {\r\n    div = 0.00001;\r\n  }\r\n\r\n  let u = (v2[axis1]*v3[axis2] - v2[axis2]*v3[axis1] + (v2[axis2] - v3[axis2])*p[axis1] - (v2[axis1] - v3[axis1])*p[axis2])/div;\r\n  let v = (-(v1[axis1]*v3[axis2] - v1[axis2]*v3[axis1] + (v1[axis2] - v3[axis2])*p[axis1]) + (v1[axis1] - v3[axis1])*p[axis2])/div;\r\n\r\n  if (!out) {\r\n    out = barycentric_v2_rets.next();\r\n  }\r\n\r\n  out[0] = u;\r\n  out[1] = v;\r\n\r\n  return out;\r\n}\r\n\r\n/*\r\n\r\non factor;\r\n\r\nload_package \"avector\";\r\n\r\npx := 0;\r\npy := 0;\r\npz := 0;\r\n\r\nv1 := avec(v1x, v1y, v1z);\r\nv2 := avec(v2x, v2y, v2z);\r\np := avec(px, py, pz);\r\n\r\nt1 := p - v1;\r\nt2 := v2 - v1;\r\n\r\nl1 := t2 / VMOD t2;\r\n\r\nt := dot(t1, t2);\r\n\r\np2 := v1 + t2*t;\r\n\r\non fort;\r\ndot(p2, p2);\r\noff fort;\r\n\r\n**/\r\n\r\nfunction _linedis2(co, v1, v2) {\r\n  let v1x = v1[0] - co[0];\r\n  let v1y = v1[1] - co[1];\r\n  let v1z = v1[2] - co[2];\r\n\r\n  let v2x = v2[0] - co[0];\r\n  let v2y = v2[1] - co[1];\r\n  let v2z = v2[2] - co[2];\r\n\r\n  let dis = (((v1y - v2y)*v1y + (v1z - v2z)*v1z + (v1x - v2x)*v1x)*(v1y - v2y) - v1y)**2 +\r\n    (((v1y - v2y)*v1y + (v1z - v2z)*v1z + (v1x - v2x)*v1x)*(v1z - v2z) - v1z)**2 +\r\n    (((v1y - v2y)*v1y + (v1z - v2z)*v1z + (v1x - v2x)*v1x)*(v1x - v2x) - v1x)**2;\r\n\r\n  return dis;\r\n}\r\n\r\nlet closest_p_tri_rets = new util.cachering(() => {\r\n  return {\r\n    co  : new Vector3(),\r\n    uv  : new Vector2(),\r\n    dist: 0\r\n  }\r\n}, 512);\r\n\r\nlet cpt_v1 = new Vector3();\r\nlet cpt_v2 = new Vector3();\r\nlet cpt_v3 = new Vector3();\r\nlet cpt_v4 = new Vector3();\r\nlet cpt_v5 = new Vector3();\r\nlet cpt_v6 = new Vector3();\r\nlet cpt_p = new Vector3();\r\nlet cpt_n = new Vector3();\r\nlet cpt_mat = new Matrix4();\r\nlet cpt_mat2 = new Matrix4();\r\nlet cpt_b = new Vector3();\r\n\r\nexport function closest_point_on_quad(p, v1, v2, v3, v4, n, uvw) {\r\n  let a = closest_point_on_tri(p, v1, v2, v3, n, uvw);\r\n  let b = closest_point_on_tri(p, v1, v3, v4, n, uvw);\r\n\r\n  return a.dist <= b.dist ? a : b;\r\n}\r\n\r\nexport function closest_point_on_tri(p, v1, v2, v3, n, uvw) {\r\n  let op = p;\r\n\r\n  if (uvw) {\r\n    uvw[0] = uvw[1] = 0.0;\r\n    if (uvw.length > 2) {\r\n      uvw[2] = 0.0;\r\n    }\r\n  }\r\n\r\n  v1 = cpt_v1.load(v1);\r\n  v2 = cpt_v2.load(v2);\r\n  v3 = cpt_v3.load(v3);\r\n  p = cpt_p.load(p);\r\n\r\n  if (n === undefined) {\r\n    n = cpt_n.load(normal_tri(v1, v2, v3));\r\n  }\r\n\r\n  v1.sub(p);\r\n  v2.sub(p);\r\n  v3.sub(p);\r\n  p.zero();\r\n\r\n\r\n  /*use least squares to solve for barycentric coordinates\r\n    then clip to triangle\r\n\r\n    we do this in 2d, as all solutions are coplanar anyway and that way we\r\n    can have one of the equations be \"u+v+w = 1\".\r\n    should investigate if this is really necassary.\r\n   */\r\n\r\n  let ax1, ax2;\r\n  let ax = Math.abs(n[0]), ay = Math.abs(n[1]), az = Math.abs(n[2]);\r\n  if (ax === 0.0 && ay === 0.0 && az === 0.0) {\r\n    console.log(\"eek1\", n, v1, v2, v3);\r\n    let ret = closest_p_tri_rets.next();\r\n\r\n    ret.dist = 1e17;\r\n    ret.co.zero();\r\n    ret.uv.zero();\r\n\r\n    return ret;\r\n  }\r\n\r\n  let ax3;\r\n  if (ax >= ay && ax >= az) {\r\n    ax1 = 1;\r\n    ax2 = 2;\r\n    ax3 = 0;\r\n  } else if (ay >= ax && ay >= az) {\r\n    ax1 = 0;\r\n    ax2 = 2;\r\n    ax3 = 1;\r\n  } else {\r\n    ax1 = 0;\r\n    ax2 = 1;\r\n    ax3 = 2;\r\n  }\r\n\r\n  let mat = cpt_mat;\r\n  let mat2 = cpt_mat2;\r\n  mat.makeIdentity();\r\n\r\n  let m = mat.$matrix;\r\n\r\n  m.m11 = v1[ax1];\r\n  m.m12 = v2[ax1];\r\n  m.m13 = v3[ax1];\r\n  m.m14 = 0.0;\r\n\r\n  m.m21 = v1[ax2];\r\n  m.m22 = v2[ax2];\r\n  m.m23 = v3[ax2];\r\n  m.m24 = 0.0;\r\n\r\n  /*\r\n  m.m31 = v1[ax3];\r\n  m.m32 = v2[ax3];\r\n  m.m33 = v3[ax3];\r\n  m.m34 = 0.0;\r\n  */\r\n\r\n  m.m31 = 1;\r\n  m.m32 = 1;\r\n  m.m33 = 1;\r\n  m.m34 = 0.0;\r\n\r\n  mat.transpose();\r\n\r\n  let b = cpt_b.zero();\r\n\r\n  b[0] = p[ax1];\r\n  b[1] = p[ax2];\r\n  //b[2] = p[ax3];\r\n  b[2] = 1.0;\r\n  b[3] = 0.0;\r\n\r\n  mat2.load(mat).transpose();\r\n\r\n  mat.preMultiply(mat2);\r\n\r\n  if (mat.invert() === null) {\r\n    console.log(\"eek2\", mat.determinant(), ax1, ax2, n);\r\n    let ret = closest_p_tri_rets.next();\r\n\r\n    ret.dist = 1e17;\r\n    ret.co.zero();\r\n    ret.uv.zero();\r\n\r\n    return ret;\r\n  }\r\n\r\n  mat.multiply(mat2);\r\n\r\n\r\n  b.multVecMatrix(mat);\r\n\r\n  let u = b[0];\r\n  let v = b[1];\r\n  let w = b[2];\r\n\r\n  for (let i = 0; i < 1; i++) {\r\n    u = Math.min(Math.max(u, 0.0), 1.0);\r\n    v = Math.min(Math.max(v, 0.0), 1.0);\r\n    w = Math.min(Math.max(w, 0.0), 1.0);\r\n\r\n    let tot = u + v + w;\r\n\r\n    if (tot !== 0.0) {\r\n      tot = 1.0/tot;\r\n      u *= tot;\r\n      v *= tot;\r\n      w *= tot;\r\n    }\r\n  }\r\n\r\n  if (uvw) {\r\n    uvw[0] = u;\r\n    uvw[1] = v;\r\n    if (uvw.length > 2) {\r\n      uvw[2] = w;\r\n    }\r\n  }\r\n\r\n  let x = v1[0]*u + v2[0]*v + v3[0]*w;\r\n  let y = v1[1]*u + v2[1]*v + v3[1]*w;\r\n  let z = v1[2]*u + v2[2]*v + v3[2]*w;\r\n\r\n  let ret = closest_p_tri_rets.next();\r\n\r\n  ret.co.loadXYZ(x, y, z);\r\n  ret.uv[0] = u;\r\n  ret.uv[1] = v;\r\n\r\n  ret.dist = ret.co.vectorLength();\r\n  ret.co.add(op);\r\n\r\n  return ret;\r\n}\r\n\r\nexport function dist_to_tri_v3_old(co, v1, v2, v3, no = undefined) {\r\n  if (!no) {\r\n    no = dtvtmps.next().load(normal_tri(v1, v2, v3));\r\n  }\r\n\r\n  let p = dtvtmps.next().load(co);\r\n  p.sub(v1);\r\n\r\n  let planedis = -p.dot(no);\r\n\r\n  let [axis, axis2] = calc_projection_axes(no);\r\n\r\n  let p1 = dtvtmps.next();\r\n  let p2 = dtvtmps.next();\r\n  let p3 = dtvtmps.next();\r\n\r\n  p1[0] = v1[axis];\r\n  p1[1] = v1[axis2];\r\n  p1[2] = 0.0;\r\n\r\n  p2[0] = v2[axis];\r\n  p2[1] = v2[axis2];\r\n  p2[2] = 0.0;\r\n\r\n  p3[0] = v3[axis];\r\n  p3[1] = v3[axis2];\r\n  p3[2] = 0.0;\r\n\r\n  let pp = dtvtmps.next();\r\n  pp[0] = co[axis];\r\n  pp[1] = co[axis2];\r\n  pp[2] = 0.0;\r\n\r\n  let dis = 1e17;\r\n\r\n  function linedis2d(a, b, c) {\r\n    let dx1 = a[0] - b[0];\r\n    let dy1 = a[1] - b[1];\r\n    let dx2 = c[0] - b[0];\r\n    let dy2 = c[1] - b[1];\r\n\r\n    let len = dx2*dx2 + dy2*dy2;\r\n    len = len > 0.000001 ? 1.0 / len : 0.0;\r\n\r\n    dx2 *= len;\r\n    dy2 *= len;\r\n\r\n    return Math.abs(dx1*dy2 - dx2*dy1);\r\n  }\r\n\r\n  let tmp = dtvtmps.next();\r\n  let tmp2 = dtvtmps.next();\r\n\r\n  function linedis3d(a, b, c) {\r\n    tmp.load(a).sub(b);\r\n    tmp2.load(c).sub(b).normalize();\r\n\r\n    let t = tmp.dot(tmp2);\r\n    t = Math.min(Math.max(t, 0.0), b.vectorDistance(c));\r\n\r\n    tmp2.mulScalar(t).add(b);\r\n\r\n    return tmp2.vectorDistance(a);\r\n  }\r\n\r\n\r\n  /* are we above the triangle? if so use plane distance */\r\n  if (point_in_tri(pp, p1, p2, p3)) {\r\n    return Math.abs(planedis);\r\n  }\r\n\r\n  /* get distance to the closest edge */\r\n  dis = Math.min(dis, linedis3d(co, v1, v2));\r\n  dis = Math.min(dis, linedis3d(co, v2, v3));\r\n  dis = Math.min(dis, linedis3d(co, v3, v1));\r\n\r\n  if (0) {\r\n    let uv = barycentric_v2(pp, p1, p2, p3);\r\n\r\n    let w = 1.0 - uv[0] - uv[1];\r\n    uv[0] = Math.min(Math.max(uv[0], 0.0), 1.0);\r\n    uv[1] = Math.min(Math.max(uv[1], 0.0), 1.0);\r\n    w = Math.min(Math.max(w, 0.0), 1.0);\r\n\r\n    let sum = (uv[0] + uv[1] + w);\r\n    sum = sum !== 0.0 ? 1.0/sum : 0.0;\r\n\r\n    w *= sum;\r\n    uv[0] *= sum;\r\n    uv[1] *= sum;\r\n\r\n    pp.zero();\r\n\r\n    pp.addFac(v1, uv[0]);\r\n    pp.addFac(v2, uv[1]);\r\n    pp.addFac(v3, 1.0 - uv[0] - uv[1]);\r\n\r\n    dis = Math.min(dis, pp.vectorDistance(co));\r\n  }\r\n\r\n  return dis;\r\n}\r\n\r\n\r\nexport function dist_to_tri_v3(p, v1, v2, v3, n) {\r\n  return dist_to_tri_v3_old(p, v1, v2, v3, n);\r\n  //return Math.sqrt(Math.abs(dist_to_tri_v3_sqr(p, v1, v2, v3, n)));\r\n}\r\n\r\n\r\n/* reduce script\r\n\r\non factor;\r\n\r\nax := 0;\r\nay := 0;\r\n\r\ne1x := bx - ax;\r\ne1y := by - ay;\r\ne2x := cx - bx;\r\ne2y := cy - by;\r\ne3x := ax - cx;\r\ne3y := ay - cy;\r\n\r\nl1 := (e1x**2 + e1y**2)**0.5;\r\nl2 := (e2x**2 + e2y**2)**0.5;\r\nl3 := (e3x**2 + e3y**2)**0.5;\r\n\r\nload_package \"avector\";\r\n\r\ne1 := avec(e1x / l1, e1y / l1, 0.0);\r\ne2 := avec(e2x / l2, e2y / l2, 0.0);\r\ne3 := avec(e3x / l3, e3y / l3, 0.0);\r\n\r\nd1 := x1*e1[1] - y1*e1[0];\r\nd2 := x1*e2[1] - y1*e2[0];\r\nd3 := x1*e3[1] - y1*e3[0];\r\n\r\nd1 := d1**2;\r\nd2 := d2**2;\r\nd3 := d3**2;\r\n\r\non fort;\r\nd1;\r\nd2;\r\nd3;\r\noff fort;\r\n\r\n*/\r\n\r\nlet _dt3s_n = new Vector3();\r\n\r\nexport function dist_to_tri_v3_sqr(p, v1, v2, v3, n) {\r\n  if (n === undefined) {\r\n    n = _dt3s_n;\r\n    n.load(normal_tri(v1, v2, v3));\r\n  }\r\n\r\n  // find projection axis;\r\n  let axis1, axis2, axis3;\r\n  let nx = n[0] < 0.0 ? -n[0] : n[0];\r\n  let ny = n[1] < 0.0 ? -n[1] : n[1];\r\n  let nz = n[2] < 0.0 ? -n[2] : n[2];\r\n\r\n  const feps = 0.0000001;\r\n\r\n  if (nx > ny && nx > nz) {\r\n    axis1 = 1;\r\n    axis2 = 2;\r\n    axis3 = 0;\r\n  } else if (ny > nx && ny > nz) {\r\n    axis1 = 0;\r\n    axis2 = 2;\r\n    axis3 = 1;\r\n  } else {\r\n    axis1 = 0;\r\n    axis2 = 1;\r\n    axis3 = 2;\r\n  }\r\n\r\n  //n.load(normal_tri(v1, v2, v3));\r\n\r\n  let planedis = (p[0] - v1[0])*n[0] + (p[1] - v1[1])*n[1] + (p[2] - v1[2])*n[2];\r\n  planedis = planedis < 0.0 ? -planedis : planedis;\r\n\r\n  let ax = v1[axis1], ay = v1[axis2], az = v1[axis3];\r\n\r\n  let bx = v2[axis1] - ax, by = v2[axis2] - ay, bz = v2[axis3] - az;\r\n  let cx = v3[axis1] - ax, cy = v3[axis2] - ay, cz = v3[axis3] - az;\r\n\r\n  let bx2 = bx*bx, by2 = by*by, bz2 = bz*bz, cx2 = cx*cx, cy2 = cy*cy, cz2 = cz*cz;\r\n\r\n  let x1 = p[axis1] - ax;\r\n  let y1 = p[axis2] - ay;\r\n  let z1 = p[axis3] - az;\r\n\r\n  const testf = 0.0;\r\n\r\n  let l1 = Math.sqrt(bx**2 + by**2);\r\n  let l2 = Math.sqrt((cx - bx)**2 + (cy - by)**2);\r\n  let l3 = Math.sqrt(cx**2 + cy**2);\r\n\r\n  let s1 = x1*by - y1*bx < testf;\r\n  let s2 = (x1 - bx)*(cy - by) - (y1 - by)*(cx - bx) < testf;\r\n  let s3 = (x1* -cy + y1*cx) < testf;\r\n\r\n  /*\r\n    (x1-cx)*-cy - (y1-cy)*-cx\r\n   reduces to:\r\n     x1*-cy + y1*cx;\r\n   */\r\n\r\n  //console.log(axis1, axis2, axis3, n);\r\n  //console.log(s1, s2, s3);\r\n  //console.log(bx, by, cx, cy);\r\n\r\n  if (1 && n[axis3] < 0.0) {\r\n    s1 = !s1;\r\n    s2 = !s2;\r\n    s3 = !s3;\r\n    /*\r\n        bx = v3[axis1];\r\n        by = v3[axis2];\r\n        bz = v3[axis3];\r\n\r\n        cx = v2[axis1];\r\n        cy = v2[axis2];\r\n        cz = v2[axis3];\r\n\r\n        bx2 = bx*bx;\r\n        by2 = by*by;\r\n        bz2 = bz*bz;\r\n\r\n        cx2 = cx*cx;\r\n        cy2 = cy*cy;\r\n        cz2 = cz*cz;*/\r\n  }\r\n\r\n  let mask = (s1 & 1) | (s2<<1) | (s3<<2);\r\n  if (mask === 0 || mask === 7) {\r\n    return planedis*planedis;\r\n  }\r\n\r\n  let d1, d2, d3, div;\r\n\r\n\r\n  /*\r\n//\\  3|\r\n//  \\ |\r\n//    b\r\n//    | \\\r\n//  1 |   \\  2\r\n//    |  0  \\\r\n// ___a_______c___\r\n//  5 |   4      \\ 6\r\n*/\r\n\r\n  let dis = 0.0;\r\n  let lx, ly, lz;\r\n\r\n  lx = bx;\r\n  ly = by;\r\n  lz = bz;\r\n\r\n  nx = n[axis1];\r\n  ny = n[axis2];\r\n  nz = n[axis3];\r\n\r\n  switch (mask) {\r\n    case 1:\r\n      div = (bx2 + by2);\r\n\r\n      if (div > feps) {\r\n        d1 = (bx*y1 - by*x1);\r\n        d1 = (d1*d1)/div;\r\n\r\n        lx = -by;\r\n        ly = bx;\r\n        lz = bz;\r\n      } else {\r\n        d1 = x1*x1 + y1*y1;\r\n\r\n        lx = x1;\r\n        ly = y1;\r\n        lz = z1;\r\n      }\r\n\r\n      dis = d1;\r\n      break;\r\n    case 3:\r\n      lx = x1 - bx;\r\n      ly = y1 - by;\r\n      lz = z1 - bz;\r\n\r\n      dis = lx*lx + ly*ly;\r\n      return lx*lx + ly*ly + lz*lz;\r\n    case 2:\r\n      div = (bx - cx)**2 + (by - cy)**2;\r\n\r\n      if (div > feps) {\r\n        d2 = ((bx - cx)*y1 - (by - cy)*x1);\r\n        d2 = d2/div;\r\n\r\n        lx = (by - cy);\r\n        ly = (cx - bx);\r\n        lz = cz - bz;\r\n      } else {\r\n        d2 = (x1 - bx)*(x1 - bx) + (y1 - by)*(y1 - by);\r\n\r\n        lx = x1 - bx;\r\n        ly = y1 - by;\r\n        lz = z1 - bz;\r\n      }\r\n\r\n      dis = d2;\r\n      break;\r\n    case 6:\r\n      lx = x1 - cx;\r\n      ly = y1 - cy;\r\n      lz = z1 - cz;\r\n\r\n      return lx*lx + ly*ly + lz*lz;\r\n    case 4:\r\n      div = (cx2 + cy2);\r\n\r\n      if (div > feps) {\r\n        d3 = (cx*y1 - cy*x1);\r\n        d3 = (d3*d3)/div;\r\n\r\n        lx = cy;\r\n        ly = -cx;\r\n        lz = cz;\r\n      } else {\r\n        d3 = (x1 - cx)*(x1 - cx) + (y1 - cy)*(y1 - cy);\r\n\r\n        lx = x1 - cx;\r\n        ly = y1 - cy;\r\n        lz = z1 - cz;\r\n      }\r\n\r\n      dis = d3;\r\n      break;\r\n    case 5:\r\n      lx = x1;\r\n      ly = y1;\r\n      lz = z1;\r\n\r\n      return lx*lx + ly*ly + lz*lz;\r\n  }\r\n\r\n  //lx = p[axis1] - v1[axis1];\r\n  //ly = p[axis2] - v1[axis2];\r\n  {\r\n    let d = lx*nx + ly*ny + lz*nz;\r\n\r\n    d = -d;\r\n\r\n    lx += nx*d;\r\n    ly += ny*d;\r\n    lz += nz*d;\r\n\r\n    //dis = lx*lx + ly*ly;\r\n\r\n    if (0 && Math.random() > 0.999) {\r\n      console.log(\"d\", d.toFixed(6));\r\n      console.log(lx*nx + ly*ny + lz*nz);\r\n    }\r\n  }\r\n\r\n  let mul = ((lx**2 + ly**2)*nz**2 + (lx*nx + ly*ny)**2)/((lx**2 + ly**2)*nz**2);\r\n  //let mul = ((lx**2+ly**2)*nz**2+(lx*nx+ly*ny)**2)/((ly**2+lz**2+lx**2)*nz**2);\r\n\r\n  //mul = 1.0 / nz;\r\n  //mul *= mul;\r\n\r\n  if (Math.random() > 0.999) {\r\n    console.log(mul.toFixed(4));\r\n  }\r\n\r\n  //mul = 1.0;\r\n\r\n  if (0) {\r\n    let odis = dis;\r\n\r\n    dis = x1**2 + y1**2 + z1**2;\r\n\r\n    if (Math.random() > 0.999) {\r\n      console.log((dis/odis).toFixed(4), mul.toFixed(4));\r\n    }\r\n    mul = 1.0;\r\n  }\r\n\r\n  /*\r\n  on factor;\r\n\r\n  dx := sqrt(dis)*(lx / sqrt(lx**2 + ly**2));\r\n  dy := sqrt(dis)*(ly / sqrt(lx**2 + ly**2));\r\n  f2 := dx*nx + dy*ny + dz*nz;\r\n\r\n  fz := solve(f2, dz);\r\n  fz := part(fz, 1, 2);\r\n\r\n  dis2 := dx*dx + dy*dy + fz*fz;\r\n  fmul := dis2/dis;\r\n\r\n  on fort;\r\n  fmul;\r\n  off fort;\r\n\r\n\r\n  */\r\n\r\n  return dis*mul + planedis*planedis;\r\n}\r\n\r\nlet tri_area_temps = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport function tri_area(v1, v2, v3) {\r\n  let l1 = v1.vectorDistance(v2);\r\n  let l2 = v2.vectorDistance(v3);\r\n  let l3 = v3.vectorDistance(v1);\r\n\r\n  let s = (l1 + l2 + l3)/2.0;\r\n  return Math.sqrt(s*(s - l1)*(s - l2)*(s - l3))\r\n}\r\n\r\nexport function aabb_overlap_area(pos1, size1, pos2, size2) {\r\n  let r1 = 0.0, r2 = 0.0;\r\n\r\n  for (let i = 0; i < 2; i++) {\r\n    let a1 = pos1[i], a2 = pos2[i];\r\n    let b1 = pos1[i] + size1[i];\r\n    let b2 = pos2[i] + size2[i];\r\n\r\n    if (b1 >= a2 && b2 >= a1) {\r\n      let r = Math.abs(a2 - b1);\r\n      r = Math.min(r, Math.abs(a1 - b2));\r\n\r\n      if (i) {\r\n        r2 = r;\r\n      } else {\r\n        r1 = r;\r\n      }\r\n    }\r\n  }\r\n\r\n  return r1*r2;\r\n}\r\n\r\n/**\r\n * Returns true if two aabbs intersect\r\n * @param {*} pos1\r\n * @param {*} size1\r\n * @param {*} pos2\r\n * @param {*} size2\r\n */\r\n\r\nexport function aabb_isect_2d(pos1, size1, pos2, size2) {\r\n  let ret = 0;\r\n  for (let i = 0; i < 2; i++) {\r\n    let a = pos1[i];\r\n    let b = pos1[i] + size1[i];\r\n    let c = pos2[i];\r\n    let d = pos2[i] + size2[i];\r\n    if (b >= c && a <= d)\r\n      ret += 1;\r\n  }\r\n  return ret === 2;\r\n};\r\n\r\n\r\nexport function aabb_isect_3d(pos1, size1, pos2, size2) {\r\n  let ret = 0;\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    let a = pos1[i];\r\n    let b = pos1[i] + size1[i];\r\n\r\n    let c = pos2[i];\r\n    let d = pos2[i] + size2[i];\r\n\r\n    if (b >= c && a <= d)\r\n      ret += 1;\r\n  }\r\n  return ret === 3;\r\n}\r\n\r\n\r\nlet aabb_intersect_vs = util.cachering.fromConstructor(Vector2, 32);\r\nlet aabb_intersect_rets = new util.cachering(() => {\r\n  return {\r\n    pos : new Vector2(),\r\n    size: new Vector2()\r\n  }\r\n}, 512);\r\n\r\n/**\r\n * Returns aabb that's the intersection of two aabbs\r\n * @param {*} pos1\r\n * @param {*} size1\r\n * @param {*} pos2\r\n * @param {*} size2\r\n */\r\nexport function aabb_intersect_2d(pos1, size1, pos2, size2) {\r\n  let v1 = aabb_intersect_vs.next().load(pos1);\r\n  let v2 = aabb_intersect_vs.next().load(pos1).add(size1);\r\n  let v3 = aabb_intersect_vs.next().load(pos2);\r\n  let v4 = aabb_intersect_vs.next().load(pos2).add(size2);\r\n\r\n  let min = aabb_intersect_vs.next().zero();\r\n  let max = aabb_intersect_vs.next().zero();\r\n\r\n  let tot = 0;\r\n\r\n  for (let i = 0; i < 2; i++) {\r\n    if (v2[i] >= v3[i] && v1[i] <= v4[i]) {\r\n      tot++;\r\n\r\n      min[i] = Math.max(v3[i], v1[i]);\r\n      max[i] = Math.min(v2[i], v4[i]);\r\n    }\r\n  }\r\n\r\n  if (tot !== 2) {\r\n    return undefined;\r\n  }\r\n\r\n  let ret = aabb_intersect_rets.next();\r\n  ret.pos.load(min);\r\n  ret.size.load(max).sub(min);\r\n\r\n  return ret;\r\n}\r\n\r\nwindow.test_aabb_intersect_2d = function () {\r\n  let canvas = document.getElementById(\"test_canvas\");\r\n\r\n  if (!canvas) {\r\n    canvas = document.createElement(\"canvas\");\r\n    canvas.setAttribute(\"id\", \"test_canvas\");\r\n    canvas.g = canvas.getContext(\"2d\");\r\n\r\n    document.body.appendChild(canvas);\r\n  }\r\n\r\n  canvas.width = ~~(window.innerWidth*devicePixelRatio);\r\n  canvas.height = ~~(window.innerHeight*devicePixelRatio);\r\n  canvas.style.width = (canvas.width/devicePixelRatio) + \"px\";\r\n  canvas.style.height = (canvas.height/devicePixelRatio) + \"px\";\r\n  canvas.style.position = \"absolute\";\r\n  canvas.style[\"z-index\"] = \"1000\";\r\n\r\n  let g = canvas.g;\r\n  g.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n  let sz = 800;\r\n  let a1 = new Vector2([Math.random()*sz, Math.random()*sz]).floor();\r\n  let a2 = new Vector2([Math.random()*sz, Math.random()*sz]).floor();\r\n  let b1 = new Vector2([Math.random()*sz, Math.random()*sz]).floor();\r\n  let b2 = new Vector2([Math.random()*sz, Math.random()*sz]).floor();\r\n\r\n  let p1 = new Vector2();\r\n  let s1 = new Vector2();\r\n  let p2 = new Vector2();\r\n  let s2 = new Vector2();\r\n\r\n  p1.load(a1).min(a2);\r\n  s1.load(a1).max(a2);\r\n  p2.load(b1).min(b2);\r\n  s2.load(b1).max(b2);\r\n\r\n  s1.sub(p1);\r\n  s2.sub(p1);\r\n\r\n  console.log(p1, s1);\r\n  console.log(p2, s2);\r\n\r\n  g.beginPath();\r\n  g.rect(0, 0, canvas.width, canvas.height);\r\n  g.fillStyle = \"white\";\r\n  g.fill();\r\n\r\n  g.beginPath();\r\n  g.rect(p1[0], p1[1], s1[0], s1[1]);\r\n  g.fillStyle = \"rgba(255, 100, 75, 1.0)\";\r\n  g.fill();\r\n\r\n  g.beginPath();\r\n  g.rect(p2[0], p2[1], s2[0], s2[1]);\r\n  g.fillStyle = \"rgba(75, 100, 255, 1.0)\";\r\n  g.fill();\r\n\r\n  let ret = aabb_intersect_2d(p1, s1, p2, s2);\r\n\r\n  if (ret) {\r\n\r\n    g.beginPath();\r\n    g.rect(ret.pos[0], ret.pos[1], ret.size[0], ret.size[1]);\r\n    g.fillStyle = \"rgba(0, 0, 0, 1.0)\";\r\n    g.fill();\r\n  }\r\n\r\n  /*\r\n  window.setTimeout(() => {\r\n    canvas.remove();\r\n  }, 2000);\r\n  //*/\r\n\r\n  return {\r\n    end  : test_aabb_intersect_2d.end,\r\n    timer: test_aabb_intersect_2d.timer\r\n  };\r\n}\r\n\r\ntest_aabb_intersect_2d.stop = function stop() {\r\n  if (test_aabb_intersect_2d._timer) {\r\n    console.log(\"stopping timer\");\r\n\r\n    window.clearInterval(test_aabb_intersect_2d._timer);\r\n    test_aabb_intersect_2d._timer = undefined;\r\n  }\r\n}\r\n\r\ntest_aabb_intersect_2d.end = function end() {\r\n  test_aabb_intersect_2d.stop();\r\n\r\n  let canvas = document.getElementById(\"test_canvas\");\r\n  if (canvas) {\r\n    canvas.remove();\r\n  }\r\n}\r\ntest_aabb_intersect_2d.timer = function timer(rate = 500) {\r\n  if (test_aabb_intersect_2d._timer) {\r\n    window.clearInterval(test_aabb_intersect_2d._timer);\r\n    test_aabb_intersect_2d._timer = undefined;\r\n    console.log(\"stopping timer\");\r\n    return;\r\n  }\r\n\r\n  console.log(\"starting timer\");\r\n\r\n  test_aabb_intersect_2d._timer = window.setInterval(() => {\r\n    test_aabb_intersect_2d();\r\n  }, rate);\r\n};\r\n\r\nlet aabb_intersect_vs3 = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport function aabb_intersect_3d(min1, max1, min2, max2) {\r\n  let tot = 0;\r\n\r\n  for (let i = 0; i < 2; i++) {\r\n    if (max1[i] >= min2[i] && min1[i] <= max2[i]) {\r\n      tot++;\r\n    }\r\n  }\r\n\r\n  if (tot !== 3) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n/**\r\n * AABB union of a and b.\r\n * Result is in a.\r\n *\r\n * @param a List of two vectors\r\n * @param b List of two vectors\r\n * @returns a\r\n */\r\nexport function aabb_union(a, b) {\r\n  for (let i = 0; i < 2; i++) {\r\n    for (let j = 0; j < a[i].length; j++) {\r\n      a[i][j] = i ? Math.max(a[i][j], b[i][j]) : Math.min(a[i][j], b[i][j]);\r\n    }\r\n  }\r\n\r\n  return a;\r\n}\r\n\r\nexport function aabb_union_2d(pos1, size1, pos2, size2) {\r\n  let v1 = aabb_intersect_vs.next();\r\n  let v2 = aabb_intersect_vs.next();\r\n  let min = aabb_intersect_vs.next();\r\n  let max = aabb_intersect_vs.next();\r\n  v1.load(pos1).add(size1);\r\n  v2.load(pos2).add(size2);\r\n\r\n  min.load(v1).min(v2);\r\n  max.load(v1).max(v2);\r\n\r\n  max.sub(min);\r\n  let ret = aabb_intersect_rets.next();\r\n\r\n  ret.pos.load(min);\r\n  ret.pos.load(max);\r\n\r\n  return ret;\r\n}\r\n\r\n//XXX refactor to use es6 classes,\r\n//    or at last the class system in typesystem.js\r\nfunction init_prototype(cls, proto) {\r\n  for (var k in proto) {\r\n    cls.prototype[k] = proto[k];\r\n  }\r\n\r\n  return cls.prototype;\r\n}\r\n\r\nfunction inherit(cls, parent, proto) {\r\n  cls.prototype = Object.create(parent.prototype);\r\n\r\n  for (var k in proto) {\r\n    cls.prototype[k] = proto[k];\r\n  }\r\n\r\n  return cls.prototype;\r\n}\r\n\r\nvar set = util.set;\r\n\r\n//everything below here was compiled from es6 code  \r\n//variables starting with $ are function static local vars,\r\n//like in C.  don't use them outside their owning functions.\r\n//\r\n//except for $_mh and $_swapt.  they were used with a C macro\r\n//preprocessor.\r\nvar $_mh, $_swapt;\r\n\r\n//XXX destroy me\r\nexport const feps = 2.22e-16;\r\n\r\nexport const COLINEAR = 1;\r\nexport const LINECROSS = 2;\r\nexport const COLINEAR_ISECT = 3;\r\n\r\nvar _cross_vec1 = new Vector3();\r\nvar _cross_vec2 = new Vector3();\r\n\r\nexport const SQRT2 = Math.sqrt(2.0);\r\nexport const FEPS_DATA = {\r\n  F16: 1.11e-16,\r\n  F32: 5.96e-08,\r\n  F64: 4.88e-04\r\n};\r\n\r\n/*use 32 bit epsilon by default, since we're often working from\r\n  32-bit float data.  note that javascript uses 64-bit doubles \r\n  internally.*/\r\nexport const FEPS = FEPS_DATA.F32;\r\nexport const FLOAT_MIN = -1e+21;\r\nexport const FLOAT_MAX = 1e+22;\r\nexport const Matrix4UI = Matrix4;\r\n\r\n/*\r\nvar Matrix4UI=exports.Matrix4UI = function(loc, rot, size) {\r\n  if (rot==undefined) {\r\n      rot = undefined;\r\n  }\r\n  \r\n  if (size==undefined) {\r\n      size = undefined;\r\n  }\r\n  \r\n  Object.defineProperty(this, \"loc\", {get: function() {\r\n    var t=new Vector3();\r\n    this.decompose(t);\r\n    return t;\r\n  }, set: function(loc) {\r\n    var l=new Vector3(), r=new Vector3(), s=new Vector3();\r\n    this.decompose(l, r, s);\r\n    this.calc(loc, r, s);\r\n  }});\r\n  \r\n  Object.defineProperty(this, \"size\", {get: function() {\r\n    var t=new Vector3();\r\n    this.decompose(undefined, undefined, t);\r\n    return t;\r\n  }, set: function(size) {\r\n    var l=new Vector3(), r=new Vector3(), s=new Vector3();\r\n    this.decompose(l, r, s);\r\n    this.calc(l, r, size);\r\n  }});\r\n  \r\n  Object.defineProperty(this, \"rot\", {get: function() {\r\n    var t=new Vector3();\r\n    this.decompose(undefined, t);\r\n    return t;\r\n  }, set: function(rot) {\r\n    var l=new Vector3(), r=new Vector3(), s=new Vector3();\r\n    this.decompose(l, r, s);\r\n    this.calc(l, rot, s);\r\n  }});\r\n  \r\n  if (loc instanceof Matrix4) {\r\n      this.load(loc);\r\n      return ;\r\n  }\r\n  \r\n  if (rot==undefined)\r\n    rot = [0, 0, 0];\r\n  if (size==undefined)\r\n    size = [1.0, 1.0, 1.0];\r\n  this.makeIdentity();\r\n  this.calc(loc, rot, size);\r\n};\r\n\r\nMatrix4UI.prototype = inherit(Matrix4UI, Matrix4, {\r\n  calc : function(loc, rot, size) {\r\n    this.rotate(rot[0], rot[1], rot[2]);\r\n    this.scale(size[0], size[1], size[2]);\r\n    this.translate(loc[0], loc[1], loc[2]);\r\n  }\r\n\r\n});\r\n*/\r\n\r\nif (FLOAT_MIN != FLOAT_MIN || FLOAT_MAX != FLOAT_MAX) {\r\n  FLOAT_MIN = 1e-05;\r\n  FLOAT_MAX = 1000000.0;\r\n  console.log(\"Floating-point 16-bit system detected!\");\r\n}\r\n\r\nvar _static_grp_points4 = new Array(4);\r\nvar _static_grp_points8 = new Array(8);\r\n\r\nexport function get_rect_points(p, size) {\r\n  var cs;\r\n  if (p.length == 2) {\r\n    cs = _static_grp_points4;\r\n    cs[0] = p;\r\n    cs[1] = [p[0] + size[0], p[1]];\r\n    cs[2] = [p[0] + size[0], p[1] + size[1]];\r\n    cs[3] = [p[0], p[1] + size[1]];\r\n  } else if (p.length == 3) {\r\n    cs = _static_grp_points8;\r\n    cs[0] = p;\r\n    cs[1] = [p[0] + size[0], p[1], p[2]];\r\n    cs[2] = [p[0] + size[0], p[1] + size[1], p[2]];\r\n    cs[3] = [p[0], p[1] + size[0], p[2]];\r\n    cs[4] = [p[0], p[1], p[2] + size[2]];\r\n    cs[5] = [p[0] + size[0], p[1], p[2] + size[2]];\r\n    cs[6] = [p[0] + size[0], p[1] + size[1], p[2] + size[2]];\r\n    cs[7] = [p[0], p[1] + size[0], p[2] + size[2]];\r\n  } else {\r\n    throw \"get_rect_points has no implementation for \" + p.length + \"-dimensional data\";\r\n  }\r\n  return cs;\r\n};\r\n\r\nexport function get_rect_lines(p, size) {\r\n  var ps = get_rect_points(p, size);\r\n  if (p.length == 2) {\r\n    return [[ps[0], ps[1]], [ps[1], ps[2]], [ps[2], ps[3]], [ps[3], ps[0]]];\r\n  } else if (p.length == 3) {\r\n    var l1 = [[ps[0], ps[1]], [ps[1], ps[2]], [ps[2], ps[3]], [ps[3], ps[0]]];\r\n    var l2 = [[ps[4], ps[5]], [ps[5], ps[6]], [ps[6], ps[7]], [ps[7], ps[4]]];\r\n    l1.concat(l2);\r\n    l1.push([ps[0], ps[4]]);\r\n    l1.push([ps[1], ps[5]]);\r\n    l1.push([ps[2], ps[6]]);\r\n    l1.push([ps[3], ps[7]]);\r\n    return l1;\r\n  } else {\r\n    throw \"get_rect_points has no implementation for \" + p.length + \"-dimensional data\";\r\n  }\r\n};\r\n\r\nvar $vs_simple_tri_aabb_isect = [0, 0, 0];\r\n\r\nexport function simple_tri_aabb_isect(v1, v2, v3, min, max) {\r\n  $vs_simple_tri_aabb_isect[0] = v1;\r\n  $vs_simple_tri_aabb_isect[1] = v2;\r\n  $vs_simple_tri_aabb_isect[2] = v3;\r\n  for (var i = 0; i < 3; i++) {\r\n    var isect = true;\r\n    for (var j = 0; j < 3; j++) {\r\n      if ($vs_simple_tri_aabb_isect[j][i] < min[i] || $vs_simple_tri_aabb_isect[j][i] >= max[i])\r\n        isect = false;\r\n    }\r\n    if (isect)\r\n      return true;\r\n  }\r\n  return false;\r\n};\r\n\r\nexport class MinMax {\r\n  constructor(totaxis) {\r\n    if (totaxis == undefined) {\r\n      totaxis = 1;\r\n    }\r\n    this.totaxis = totaxis;\r\n    if (totaxis != 1) {\r\n      let cls;\r\n\r\n      switch (totaxis) {\r\n        case 2:\r\n          cls = Vector2;\r\n          break;\r\n        case 3:\r\n          cls = Vector3;\r\n          break;\r\n        case 4:\r\n          cls = Vector4;\r\n          break;\r\n        default:\r\n          cls = Array;\r\n          break;\r\n      }\r\n\r\n      this._min = new cls(totaxis);\r\n      this._max = new cls(totaxis);\r\n      this.min = new cls(totaxis);\r\n      this.max = new cls(totaxis);\r\n    } else {\r\n      this.min = this.max = 0;\r\n      this._min = FLOAT_MAX;\r\n      this._max = FLOAT_MIN;\r\n    }\r\n    this.reset();\r\n    this._static_mr_co = new Array(this.totaxis);\r\n    this._static_mr_cs = new Array(this.totaxis*this.totaxis);\r\n  }\r\n\r\n  static fromSTRUCT(reader) {\r\n    var ret = new MinMax();\r\n    reader(ret);\r\n    return ret;\r\n  }\r\n\r\n  load(mm) {\r\n    if (this.totaxis == 1) {\r\n      this.min = mm.min;\r\n      this.max = mm.max;\r\n      this._min = mm.min;\r\n      this._max = mm.max;\r\n    } else {\r\n      this.min = new Vector3(mm.min);\r\n      this.max = new Vector3(mm.max);\r\n      this._min = new Vector3(mm._min);\r\n      this._max = new Vector3(mm._max);\r\n    }\r\n  }\r\n\r\n  reset() {\r\n    var totaxis = this.totaxis;\r\n    if (totaxis == 1) {\r\n      this.min = this.max = 0;\r\n      this._min = FLOAT_MAX;\r\n      this._max = FLOAT_MIN;\r\n    } else {\r\n      for (var i = 0; i < totaxis; i++) {\r\n        this._min[i] = FLOAT_MAX;\r\n        this._max[i] = FLOAT_MIN;\r\n        this.min[i] = 0;\r\n        this.max[i] = 0;\r\n      }\r\n    }\r\n  }\r\n\r\n  minmax_rect(p, size) {\r\n    var totaxis = this.totaxis;\r\n    var cs = this._static_mr_cs;\r\n    if (totaxis == 2) {\r\n      cs[0] = p;\r\n      cs[1] = [p[0] + size[0], p[1]];\r\n      cs[2] = [p[0] + size[0], p[1] + size[1]];\r\n      cs[3] = [p[0], p[1] + size[1]];\r\n    } else if (totaxis = 3) {\r\n      cs[0] = p;\r\n      cs[1] = [p[0] + size[0], p[1], p[2]];\r\n      cs[2] = [p[0] + size[0], p[1] + size[1], p[2]];\r\n      cs[3] = [p[0], p[1] + size[0], p[2]];\r\n      cs[4] = [p[0], p[1], p[2] + size[2]];\r\n      cs[5] = [p[0] + size[0], p[1], p[2] + size[2]];\r\n      cs[6] = [p[0] + size[0], p[1] + size[1], p[2] + size[2]];\r\n      cs[7] = [p[0], p[1] + size[0], p[2] + size[2]];\r\n    } else {\r\n      throw \"Minmax.minmax_rect has no implementation for \" + totaxis + \"-dimensional data\";\r\n    }\r\n    for (var i = 0; i < cs.length; i++) {\r\n      this.minmax(cs[i]);\r\n    }\r\n  }\r\n\r\n  minmax(p) {\r\n    var totaxis = this.totaxis;\r\n\r\n    if (totaxis == 1) {\r\n      this._min = this.min = Math.min(this._min, p);\r\n      this._max = this.max = Math.max(this._max, p);\r\n    } else if (totaxis == 2) {\r\n      this._min[0] = this.min[0] = Math.min(this._min[0], p[0]);\r\n      this._min[1] = this.min[1] = Math.min(this._min[1], p[1]);\r\n      this._max[0] = this.max[0] = Math.max(this._max[0], p[0]);\r\n      this._max[1] = this.max[1] = Math.max(this._max[1], p[1]);\r\n    } else if (totaxis == 3) {\r\n      this._min[0] = this.min[0] = Math.min(this._min[0], p[0]);\r\n      this._min[1] = this.min[1] = Math.min(this._min[1], p[1]);\r\n      this._min[2] = this.min[2] = Math.min(this._min[2], p[2]);\r\n      this._max[0] = this.max[0] = Math.max(this._max[0], p[0]);\r\n      this._max[1] = this.max[1] = Math.max(this._max[1], p[1]);\r\n      this._max[2] = this.max[2] = Math.max(this._max[2], p[2]);\r\n    } else {\r\n      for (var i = 0; i < totaxis; i++) {\r\n        this._min[i] = this.min[i] = Math.min(this._min[i], p[i]);\r\n        this._max[i] = this.max[i] = Math.max(this._max[i], p[i]);\r\n      }\r\n    }\r\n  }\r\n};\r\nMinMax.STRUCT = \"\\n  math.MinMax {\\n    min     : vec3;\\n    max     : vec3;\\n    _min    : vec3;\\n    _max    : vec3;\\n    totaxis : int;\\n  }\\n\";\r\n\r\nexport function winding_axis(a, b, c, up_axis) {\r\n  let xaxis = (up_axis + 1)%3;\r\n  let yaxis = (up_axis + 2)%3;\r\n\r\n  let x1 = a[xaxis], y1 = a[yaxis];\r\n  let x2 = b[xaxis], y2 = b[yaxis];\r\n  let x3 = c[xaxis], y3 = c[yaxis];\r\n\r\n  let dx1 = x1 - x2, dy1 = y1 - y2;\r\n  let dx2 = x3 - x2, dy2 = y3 - y2;\r\n\r\n  let f = dx1*dy2 - dy1*dx2;\r\n  return f >= 0.0;\r\n}\r\n\r\nexport function winding(a, b, c, zero_z, tol = 0.0) {\r\n  let t1 = _cross_vec1;\r\n  let t2 = _cross_vec2;\r\n\r\n  for (let i = 0; i < a.length; i++) {\r\n    t1[i] = b[i] - a[i];\r\n    t2[i] = c[i] - a[i];\r\n  }\r\n\r\n  return t1[0]*t2[1] - t1[1]*t2[0] > tol;\r\n  /*\r\n  t1.load(a).sub(b);\r\n  t2.load(c).sub(b);\r\n  return t[0]*\r\n  \r\n  for (var i=0; i<a.length; i++) {\r\n      _cross_vec1[i] = b[i]-a[i];\r\n      _cross_vec2[i] = c[i]-a[i];\r\n  }\r\n  if (a.length==2 || zero_z) {\r\n      _cross_vec1[2] = 0.0;\r\n      _cross_vec2[2] = 0.0;\r\n  }\r\n  _cross_vec1.cross(_cross_vec2);\r\n  return _cross_vec1[2]>tol;\r\n*/\r\n}\r\n\r\nexport function inrect_2d(p, pos, size) {\r\n  if (p == undefined || pos == undefined || size == undefined) {\r\n    console.trace();\r\n    console.log(\"Bad paramters to inrect_2d()\");\r\n    console.log(\"p: \", p, \", pos: \", pos, \", size: \", size);\r\n    return false;\r\n  }\r\n  return p[0] >= pos[0] && p[0] <= pos[0] + size[0] && p[1] >= pos[1] && p[1] <= pos[1] + size[1];\r\n};\r\nvar $smin_aabb_isect_line_2d = new Vector2();\r\nvar $ssize_aabb_isect_line_2d = new Vector2();\r\nvar $sv1_aabb_isect_line_2d = new Vector2();\r\nvar $ps_aabb_isect_line_2d = [new Vector2(), new Vector2(), new Vector2()];\r\nvar $l1_aabb_isect_line_2d = [0, 0];\r\nvar $smax_aabb_isect_line_2d = new Vector2();\r\nvar $sv2_aabb_isect_line_2d = new Vector2();\r\nvar $l2_aabb_isect_line_2d = [0, 0];\r\n\r\nexport function aabb_isect_line_2d(v1, v2, min, max) {\r\n  for (var i = 0; i < 2; i++) {\r\n    $smin_aabb_isect_line_2d[i] = Math.min(min[i], v1[i]);\r\n    $smax_aabb_isect_line_2d[i] = Math.max(max[i], v2[i]);\r\n  }\r\n  $smax_aabb_isect_line_2d.sub($smin_aabb_isect_line_2d);\r\n  $ssize_aabb_isect_line_2d.load(max).sub(min);\r\n  if (!aabb_isect_2d($smin_aabb_isect_line_2d, $smax_aabb_isect_line_2d, min, $ssize_aabb_isect_line_2d))\r\n    return false;\r\n  for (var i = 0; i < 4; i++) {\r\n    if (inrect_2d(v1, min, $ssize_aabb_isect_line_2d))\r\n      return true;\r\n    if (inrect_2d(v2, min, $ssize_aabb_isect_line_2d))\r\n      return true;\r\n  }\r\n  $ps_aabb_isect_line_2d[0] = min;\r\n  $ps_aabb_isect_line_2d[1][0] = min[0];\r\n  $ps_aabb_isect_line_2d[1][1] = max[1];\r\n  $ps_aabb_isect_line_2d[2] = max;\r\n  $ps_aabb_isect_line_2d[3][0] = max[0];\r\n  $ps_aabb_isect_line_2d[3][1] = min[1];\r\n  $l1_aabb_isect_line_2d[0] = v1;\r\n  $l1_aabb_isect_line_2d[1] = v2;\r\n  for (var i = 0; i < 4; i++) {\r\n    var a = $ps_aabb_isect_line_2d[i], b = $ps_aabb_isect_line_2d[(i + 1)%4];\r\n    $l2_aabb_isect_line_2d[0] = a;\r\n    $l2_aabb_isect_line_2d[1] = b;\r\n    if (line_line_cross($l1_aabb_isect_line_2d, $l2_aabb_isect_line_2d))\r\n      return true;\r\n  }\r\n  return false;\r\n};\r\n\r\n\r\nexport function expand_rect2d(pos, size, margin) {\r\n  pos[0] -= Math.floor(margin[0]);\r\n  pos[1] -= Math.floor(margin[1]);\r\n  size[0] += Math.floor(margin[0]*2.0);\r\n  size[1] += Math.floor(margin[1]*2.0);\r\n};\r\n\r\nexport function expand_line(l, margin) {\r\n  var c = new Vector3();\r\n  c.add(l[0]);\r\n  c.add(l[1]);\r\n  c.mulScalar(0.5);\r\n  l[0].sub(c);\r\n  l[1].sub(c);\r\n  var l1 = l[0].vectorLength();\r\n  var l2 = l[1].vectorLength();\r\n  l[0].normalize();\r\n  l[1].normalize();\r\n  l[0].mulScalar(margin + l1);\r\n  l[1].mulScalar(margin + l2);\r\n  l[0].add(c);\r\n  l[1].add(c);\r\n  return l;\r\n};\r\n\r\n//stupidly ancient function, todo: rewrite\r\nexport function colinear(a, b, c, limit = 2.2e-16) {\r\n  for (var i = 0; i < 3; i++) {\r\n    _cross_vec1[i] = b[i] - a[i];\r\n    _cross_vec2[i] = c[i] - a[i];\r\n  }\r\n\r\n  if (a.vectorDistance(b) < feps*100 && a.vectorDistance(c) < feps*100) {\r\n    return true;\r\n  }\r\n  if (_cross_vec1.dot(_cross_vec1) < limit || _cross_vec2.dot(_cross_vec2) < limit)\r\n    return true;\r\n  _cross_vec1.cross(_cross_vec2);\r\n  return _cross_vec1.dot(_cross_vec1) < limit;\r\n};\r\n\r\nvar _llc_l1 = [new Vector3(), new Vector3()];\r\nvar _llc_l2 = [new Vector3(), new Vector3()];\r\nvar _llc_l3 = [new Vector3(), new Vector3()];\r\nvar _llc_l4 = [new Vector3(), new Vector3()];\r\n\r\nvar lli_v1 = new Vector3(), lli_v2 = new Vector3(), lli_v3 = new Vector3(), lli_v4 = new Vector3();\r\n\r\nvar _zero_cn = new Vector3();\r\nvar _tmps_cn = util.cachering.fromConstructor(Vector3, 64);\r\nvar _rets_cn = util.cachering.fromConstructor(Vector3, 64);\r\n\r\n//vec1, vec2 should both be normalized\r\nexport function corner_normal(vec1, vec2, width) {\r\n  var ret = _rets_cn.next().zero();\r\n\r\n  var vec = _tmps_cn.next().zero();\r\n  vec.load(vec1).add(vec2).normalize();\r\n\r\n  /*\r\n  ret.load(vec).mulScalar(width);\r\n  return ret;\r\n  */\r\n\r\n  //handle colinear case\r\n  if (Math.abs(vec1.normalizedDot(vec2)) > 0.9999) {\r\n    if (vec1.dot(vec2) > 0.0001) {\r\n      ret.load(vec1).add(vec2).normalize();\r\n    } else {\r\n      ret.load(vec1).normalize();\r\n    }\r\n\r\n    ret.mulScalar(width);\r\n\r\n    return ret;\r\n  } else { //XXX\r\n    //ret.load(vec).mulScalar(width);\r\n    //return ret;\r\n  }\r\n\r\n  vec1 = _tmps_cn.next().load(vec1).mulScalar(width);\r\n  vec2 = _tmps_cn.next().load(vec2).mulScalar(width);\r\n\r\n  var p1 = _tmps_cn.next().load(vec1);\r\n  var p2 = _tmps_cn.next().load(vec2);\r\n\r\n  vec1.addFac(vec1, 0.01);\r\n  vec2.addFac(vec2, 0.01);\r\n\r\n  var sc = 1.0;\r\n\r\n  p1[0] += vec1[1]*sc;\r\n  p1[1] += -vec1[0]*sc;\r\n\r\n  p2[0] += -vec2[1]*sc;\r\n  p2[1] += vec2[0]*sc;\r\n\r\n  var p = line_line_isect(vec1, p1, vec2, p2, false);\r\n\r\n  if (p == undefined || p === COLINEAR_ISECT || p.dot(p) < 0.000001) {\r\n    ret.load(vec1).add(vec2).normalize().mulScalar(width);\r\n  } else {\r\n    ret.load(p);\r\n\r\n    if (vec.dot(vec) > 0 && vec.dot(ret) < 0) {\r\n      ret.load(vec).mulScalar(width);\r\n    }\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n//test_segment is optional, true\r\nexport function line_line_isect(v1, v2, v3, v4, test_segment) {\r\n  test_segment = test_segment === undefined ? true : test_segment;\r\n\r\n  if (!line_line_cross(v1, v2, v3, v4)) {\r\n    return undefined;\r\n  }\r\n\r\n  /*\r\n  on factor;\r\n  off period;\r\n  \r\n  xa := xa1 + (xa2 - xa1)*t1;\r\n  xb := xb1 + (xb2 - xb1)*t2;\r\n  ya := ya1 + (ya2 - ya1)*t1;\r\n  yb := yb1 + (yb2 - yb1)*t2;\r\n  \r\n  f1 := xa - xb;\r\n  f2 := ya - yb;\r\n  \r\n  f := solve({f1, f2}, {t1, t2});\r\n  ft1 := part(f, 1, 1, 2);\r\n  ft2 := part(f, 1, 2, 2);\r\n  \r\n  */\r\n\r\n  var xa1 = v1[0], xa2 = v2[0], ya1 = v1[1], ya2 = v2[1];\r\n  var xb1 = v3[0], xb2 = v4[0], yb1 = v3[1], yb2 = v4[1];\r\n\r\n  var div = ((xa1 - xa2)*(yb1 - yb2) - (xb1 - xb2)*(ya1 - ya2));\r\n  if (div < 0.00000001) { //parallel but intersecting lines.\r\n    return COLINEAR_ISECT;\r\n  } else { //intersection exists\r\n    var t1 = (-((ya1 - yb2)*xb1 - (yb1 - yb2)*xa1 - (ya1 - yb1)*xb2))/div;\r\n\r\n    return lli_v1.load(v1).interp(v2, t1);\r\n  }\r\n}\r\n\r\nexport function line_line_cross(a, b, c, d) {\r\n  /*\r\n  var limit=feps*1000;\r\n  if (Math.abs(l1[0].vectorDistance(l2[0])+l1[1].vectorDistance(l2[0])-l1[0].vectorDistance(l1[1]))<limit) {\r\n      return true;\r\n  }\r\n  if (Math.abs(l1[0].vectorDistance(l2[1])+l1[1].vectorDistance(l2[1])-l1[0].vectorDistance(l1[1]))<limit) {\r\n      return true;\r\n  }\r\n  if (Math.abs(l2[0].vectorDistance(l1[0])+l2[1].vectorDistance(l1[0])-l2[0].vectorDistance(l2[1]))<limit) {\r\n      return true;\r\n  }\r\n  if (Math.abs(l2[0].vectorDistance(l1[1])+l2[1].vectorDistance(l1[1])-l2[0].vectorDistance(l2[1]))<limit) {\r\n      return true;\r\n  }\r\n  //*/\r\n\r\n  let w1 = winding(a, b, c);\r\n  let w2 = winding(c, a, d);\r\n  let w3 = winding(a, b, d);\r\n  let w4 = winding(c, b, d);\r\n  return (w1 === w2) && (w3 === w4) && (w1 !== w3);\r\n};\r\n\r\nvar _asi_v1 = new Vector3();\r\nvar _asi_v2 = new Vector3();\r\nvar _asi_v3 = new Vector3();\r\nvar _asi_v4 = new Vector3();\r\nvar _asi_v5 = new Vector3();\r\nvar _asi_v6 = new Vector3();\r\n\r\nexport function point_in_aabb_2d(p, min, max) {\r\n  return p[0] >= min[0] && p[0] <= max[0] && p[1] >= min[1] && p[1] <= max[1];\r\n}\r\n\r\nvar _asi2d_v1 = new Vector2();\r\nvar _asi2d_v2 = new Vector2();\r\nvar _asi2d_v3 = new Vector2();\r\nvar _asi2d_v4 = new Vector2();\r\nvar _asi2d_v5 = new Vector2();\r\nvar _asi2d_v6 = new Vector2();\r\n\r\nexport function aabb_sphere_isect_2d(p, r, min, max) {\r\n  var v1 = _asi2d_v1, v2 = _asi2d_v2, v3 = _asi2d_v3, mvec = _asi2d_v4;\r\n  var v4 = _asi2d_v5;\r\n\r\n  p = _asi2d_v6.load(p);\r\n  v1.load(p);\r\n  v2.load(p);\r\n\r\n  min = _asi_v5.load(min);\r\n  max = _asi_v6.load(max);\r\n\r\n  mvec.load(max).sub(min).normalize().mulScalar(r + 0.0001);\r\n\r\n  v1.sub(mvec);\r\n  v2.add(mvec);\r\n  v3.load(p);\r\n\r\n  var ret = point_in_aabb_2d(v1, min, max) || point_in_aabb_2d(v2, min, max)\r\n    || point_in_aabb_2d(v3, min, max);\r\n\r\n  if (ret)\r\n    return ret;\r\n\r\n  /*\r\n  v1.load(min).add(max).mulScalar(0.5);\r\n  ret = ret || v1.vectorDistance(p) < r;\r\n  \r\n  v1.load(min);\r\n  ret = ret || v1.vectorDistance(p) < r;\r\n  \r\n  v1.load(max);\r\n  ret = ret || v1.vectorDistance(p) < r;\r\n  \r\n  v1[0] = min[0], v1[1] = max[1];\r\n  ret = ret || v1.vectorDistance(p) < r;\r\n  \r\n  v1[0] = max[0], v1[1] = min[1];\r\n  ret = ret || v1.vectorDistance(p) < r;\r\n  */\r\n  //*\r\n  v1.load(min);\r\n  v2[0] = min[0];\r\n  v2[1] = max[1];\r\n  ret = ret || dist_to_line_2d(p, v1, v2) < r;\r\n\r\n  v1.load(max);\r\n  v2[0] = max[0];\r\n  v2[1] = max[1];\r\n  ret = ret || dist_to_line_2d(p, v1, v2) < r;\r\n\r\n  v1.load(max);\r\n  v2[0] = max[0];\r\n  v2[1] = min[1];\r\n  ret = ret || dist_to_line_2d(p, v1, v2) < r;\r\n\r\n  v1.load(max);\r\n  v2[0] = min[0];\r\n  v2[1] = min[1];\r\n  ret = ret || dist_to_line_2d(p, v1, v2) < r;\r\n  //*/\r\n  return ret;\r\n};\r\n\r\nexport function point_in_aabb(p, min, max) {\r\n  return p[0] >= min[0] && p[0] <= max[0] && p[1] >= min[1] && p[1] <= max[1]\r\n    && p[2] >= min[2] && p[2] <= max[2];\r\n}\r\n\r\nlet asi_rect = new Array(8);\r\nfor (let i = 0; i < 8; i++) {\r\n  asi_rect[i] = new Vector3();\r\n}\r\n\r\nlet aabb_sphere_isect_vs = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport function aabb_sphere_isect(p, r, min, max) {\r\n  {\r\n    let p1 = aabb_sphere_isect_vs.next().load(p);\r\n    let min1 = aabb_sphere_isect_vs.next().load(min);\r\n    let max1 = aabb_sphere_isect_vs.next().load(max);\r\n    if (p.length === 2) {\r\n      p1[2] = 0.0;\r\n    }\r\n    if (min1.length === 2) {\r\n      min1[2] = 0.0;\r\n    }\r\n    if (max.length === 2) {\r\n      max1[2] = 0.0;\r\n    }\r\n\r\n    p = p1;\r\n    min = min1;\r\n    max = max1;\r\n  }\r\n\r\n  let cent = aabb_sphere_isect_vs.next().load(min).interp(max, 0.5);\r\n  p.sub(cent);\r\n  min.sub(cent);\r\n  max.sub(cent);\r\n\r\n  r *= r;\r\n\r\n  let isect = point_in_aabb(p, min, max);\r\n\r\n  if (isect) {\r\n    return true;\r\n  }\r\n\r\n  let rect = asi_rect;\r\n\r\n  rect[0].loadXYZ(min[0], min[1], min[2]);\r\n  rect[1].loadXYZ(min[0], max[1], min[2]);\r\n  rect[2].loadXYZ(max[0], max[1], min[2]);\r\n  rect[3].loadXYZ(max[0], min[1], min[2]);\r\n\r\n  rect[4].loadXYZ(min[0], min[1], max[2]);\r\n  rect[5].loadXYZ(min[0], max[1], max[2]);\r\n  rect[6].loadXYZ(max[0], max[1], max[2]);\r\n  rect[7].loadXYZ(max[0], min[1], max[2]);\r\n\r\n  for (let i = 0; i < 8; i++) {\r\n    if (p.vectorDistanceSqr(rect[i]) < r) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  let p2 = aabb_sphere_isect_vs.next().load(p);\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    p2.load(p);\r\n\r\n    let i2 = (i + 1)%3;\r\n    let i3 = (i + 2)%3;\r\n\r\n    p2[i] = p2[i] < 0.0 ? min[i] : max[i];\r\n\r\n    p2[i2] = Math.min(Math.max(p2[i2], min[i2]), max[i2]);\r\n    p2[i3] = Math.min(Math.max(p2[i3], min[i3]), max[i3]);\r\n\r\n    let isect = p2.vectorDistanceSqr(p) <= r;\r\n\r\n    if (isect) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n};\r\n\r\nexport function aabb_sphere_dist(p, min, max) {\r\n  {\r\n    let p1 = aabb_sphere_isect_vs.next().load(p);\r\n    let min1 = aabb_sphere_isect_vs.next().load(min);\r\n    let max1 = aabb_sphere_isect_vs.next().load(max);\r\n    if (p.length === 2) {\r\n      p1[2] = 0.0;\r\n    }\r\n    if (min1.length === 2) {\r\n      min1[2] = 0.0;\r\n    }\r\n    if (max.length === 2) {\r\n      max1[2] = 0.0;\r\n    }\r\n\r\n    p = p1;\r\n    min = min1;\r\n    max = max1;\r\n  }\r\n\r\n  let cent = aabb_sphere_isect_vs.next().load(min).interp(max, 0.5);\r\n  p.sub(cent);\r\n  min.sub(cent);\r\n  max.sub(cent);\r\n\r\n  let isect = point_in_aabb(p, min, max);\r\n\r\n  if (isect) {\r\n    return 0.0;\r\n  }\r\n\r\n  let rect = asi_rect;\r\n\r\n  rect[0].loadXYZ(min[0], min[1], min[2]);\r\n  rect[1].loadXYZ(min[0], max[1], min[2]);\r\n  rect[2].loadXYZ(max[0], max[1], min[2]);\r\n  rect[3].loadXYZ(max[0], min[1], min[2]);\r\n\r\n  rect[4].loadXYZ(min[0], min[1], max[2]);\r\n  rect[5].loadXYZ(min[0], max[1], max[2]);\r\n  rect[6].loadXYZ(max[0], max[1], max[2]);\r\n  rect[7].loadXYZ(max[0], min[1], max[2]);\r\n\r\n  let mindis;\r\n\r\n  for (let i = 0; i < 8; i++) {\r\n    let dis = p.vectorDistanceSqr(rect[i]);\r\n\r\n    if (mindis === undefined || dis < mindis) {\r\n      mindis = dis;\r\n    }\r\n  }\r\n\r\n  let p2 = aabb_sphere_isect_vs.next().load(p);\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    p2.load(p);\r\n\r\n    let i2 = (i + 1)%3;\r\n    let i3 = (i + 2)%3;\r\n\r\n    p2[i] = p2[i] < 0.0 ? min[i] : max[i];\r\n\r\n    p2[i2] = Math.min(Math.max(p2[i2], min[i2]), max[i2]);\r\n    p2[i3] = Math.min(Math.max(p2[i3], min[i3]), max[i3]);\r\n\r\n    let dis = p2.vectorDistanceSqr(p);\r\n    if (mindis === undefined || dis < mindis) {\r\n      mindis = dis;\r\n    }\r\n  }\r\n\r\n  return mindis === undefined ? 1e17 : mindis;\r\n};\r\n\r\nexport function point_in_tri(p, v1, v2, v3) {\r\n  var w1 = winding(p, v1, v2);\r\n  var w2 = winding(p, v2, v3);\r\n  var w3 = winding(p, v3, v1);\r\n  return w1 == w2 && w2 == w3;\r\n};\r\n\r\nexport function convex_quad(v1, v2, v3, v4) {\r\n  return line_line_cross([v1, v3], [v2, v4]);\r\n};\r\n\r\nvar $e1_normal_tri = new Vector3();\r\nvar $e3_normal_tri = new Vector3();\r\nvar $e2_normal_tri = new Vector3();\r\n\r\nexport function isNum(f) {\r\n  let ok = typeof f === \"number\";\r\n\r\n  ok = ok && !isNaN(f) && isFinite(f);\r\n\r\n  return ok;\r\n}\r\n\r\nconst _normal_tri_rets = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport function normal_tri(v1, v2, v3) {\r\n  let x1 = v2[0] - v1[0];\r\n  let y1 = v2[1] - v1[1];\r\n  let z1 = v2[2] - v1[2];\r\n  let x2 = v3[0] - v1[0];\r\n  let y2 = v3[1] - v1[1];\r\n  let z2 = v3[2] - v1[2];\r\n\r\n  if (!isNum(x1 + y1 + z1 + z2 + y2 + z2)) {\r\n    throw new Error(\"NaN in normal_tri\");\r\n  }\r\n\r\n  let x3, y3, z3;\r\n\r\n  x1 = v2[0] - v1[0];\r\n  y1 = v2[1] - v1[1];\r\n  z1 = v2[2] - v1[2];\r\n  x2 = v3[0] - v1[0];\r\n  y2 = v3[1] - v1[1];\r\n  z2 = v3[2] - v1[2];\r\n  x3 = y1*z2 - z1*y2;\r\n  y3 = z1*x2 - x1*z2;\r\n  z3 = x1*y2 - y1*x2;\r\n\r\n  let len = Math.sqrt((x3*x3 + y3*y3 + z3*z3));\r\n\r\n  if (len > 1e-05)\r\n    len = 1.0/len;\r\n\r\n  x3 *= len;\r\n  y3 *= len;\r\n  z3 *= len;\r\n\r\n  let n = _normal_tri_rets.next();\r\n\r\n  if (!isNum(x3 + y3 + z3)) {\r\n    throw new Error(\"NaN!\");\r\n  }\r\n\r\n  n[0] = x3;\r\n  n[1] = y3;\r\n  n[2] = z3;\r\n\r\n  return n;\r\n};\r\n\r\nvar $n2_normal_quad = new Vector3();\r\n\r\nlet _q1 = new Vector3(), _q2 = new Vector3(), _q3 = new Vector3();\r\n\r\nexport function normal_quad(v1, v2, v3, v4) {\r\n  _q1.load(normal_tri(v1, v2, v3));\r\n  _q2.load(normal_tri(v2, v3, v4));\r\n\r\n  _q1.add(_q2).normalize();\r\n  return _q1;\r\n}\r\n\r\nexport function normal_quad_old(v1, v2, v3, v4) {\r\n  var n = normal_tri(v1, v2, v3);\r\n  $n2_normal_quad[0] = n[0];\r\n  $n2_normal_quad[1] = n[1];\r\n  $n2_normal_quad[2] = n[2];\r\n  n = normal_tri(v1, v3, v4);\r\n  $n2_normal_quad[0] = $n2_normal_quad[0] + n[0];\r\n  $n2_normal_quad[1] = $n2_normal_quad[1] + n[1];\r\n  $n2_normal_quad[2] = $n2_normal_quad[2] + n[2];\r\n  var _len = Math.sqrt(($n2_normal_quad[0]*$n2_normal_quad[0] + $n2_normal_quad[1]*$n2_normal_quad[1] + $n2_normal_quad[2]*$n2_normal_quad[2]));\r\n  if (_len > 1e-05)\r\n    _len = 1.0/_len;\r\n  $n2_normal_quad[0] *= _len;\r\n  $n2_normal_quad[1] *= _len;\r\n  $n2_normal_quad[2] *= _len;\r\n  return $n2_normal_quad;\r\n};\r\n\r\nvar _li_vi = new Vector3();\r\n\r\n//calc_t is optional, false\r\nexport function line_isect(v1, v2, v3, v4, calc_t) {\r\n  if (calc_t == undefined) {\r\n    calc_t = false;\r\n  }\r\n  var div = (v2[0] - v1[0])*(v4[1] - v3[1]) - (v2[1] - v1[1])*(v4[0] - v3[0]);\r\n  if (div == 0.0)\r\n    return [new Vector3(), COLINEAR, 0.0];\r\n  var vi = _li_vi;\r\n  vi[0] = 0;\r\n  vi[1] = 0;\r\n  vi[2] = 0;\r\n  vi[0] = ((v3[0] - v4[0])*(v1[0]*v2[1] - v1[1]*v2[0]) - (v1[0] - v2[0])*(v3[0]*v4[1] - v3[1]*v4[0]))/div;\r\n  vi[1] = ((v3[1] - v4[1])*(v1[0]*v2[1] - v1[1]*v2[0]) - (v1[1] - v2[1])*(v3[0]*v4[1] - v3[1]*v4[0]))/div;\r\n  if (calc_t || v1.length == 3) {\r\n    var n1 = new Vector2(v2).sub(v1);\r\n    var n2 = new Vector2(vi).sub(v1);\r\n    var t = n2.vectorLength()/n1.vectorLength();\r\n    n1.normalize();\r\n    n2.normalize();\r\n    if (n1.dot(n2) < 0.0) {\r\n      t = -t;\r\n    }\r\n    if (v1.length == 3) {\r\n      vi[2] = v1[2] + (v2[2] - v1[2])*t;\r\n    }\r\n    return [vi, LINECROSS, t];\r\n  }\r\n  return [vi, LINECROSS];\r\n};\r\n\r\nvar dt2l_v1 = new Vector2();\r\nvar dt2l_v2 = new Vector2();\r\nvar dt2l_v3 = new Vector2();\r\nvar dt2l_v4 = new Vector2();\r\nvar dt2l_v5 = new Vector2();\r\n\r\nexport function dist_to_line_2d(p, v1, v2, clip, closest_co_out = undefined, t_out = undefined) {\r\n  if (clip == undefined) {\r\n    clip = true;\r\n  }\r\n\r\n  v1 = dt2l_v4.load(v1);\r\n  v2 = dt2l_v5.load(v2);\r\n\r\n  var n = dt2l_v1;\r\n  var vec = dt2l_v3;\r\n\r\n  n.load(v2).sub(v1).normalize();\r\n  vec.load(p).sub(v1);\r\n\r\n  var t = vec.dot(n);\r\n  if (clip) {\r\n    t = Math.min(Math.max(t, 0.0), v1.vectorDistance(v2));\r\n  }\r\n\r\n  n.mulScalar(t).add(v1);\r\n\r\n  if (closest_co_out) {\r\n    closest_co_out[0] = n[0];\r\n    closest_co_out[1] = n[1];\r\n  }\r\n\r\n  if (t_out !== undefined) {\r\n    t_out = t;\r\n  }\r\n\r\n  return n.vectorDistance(p);\r\n}\r\n\r\nvar dt3l_v1 = new Vector3();\r\nvar dt3l_v2 = new Vector3();\r\nvar dt3l_v3 = new Vector3();\r\nvar dt3l_v4 = new Vector3();\r\nvar dt3l_v5 = new Vector3();\r\n\r\nexport function dist_to_line_sqr(p, v1, v2, clip = true) {\r\n  let px = p[0] - v1[0];\r\n  let py = p[1] - v1[1];\r\n  let pz = p.length < 3 ? 0.0 : p[2] - v1[2];\r\n\r\n  pz = pz === undefined ? 0.0 : pz;\r\n\r\n  let v2x = v2[0] - v1[0];\r\n  let v2y = v2[1] - v1[1];\r\n  let v2z = v2.length < 3 ? 0.0 : v2[2] - v1[2];\r\n\r\n  let len = v2x*v2x + v2y*v2y + v2z*v2z;\r\n\r\n  if (len === 0.0) {\r\n    return Math.sqrt(px*px + py*py + pz*pz);\r\n  }\r\n\r\n  let len2 = 1.0/len;\r\n  v2x *= len2;\r\n  v2y *= len2;\r\n  v2z *= len2;\r\n\r\n  let t = px*v2x + py*v2y + pz*v2z;\r\n  if (clip) {\r\n    t = Math.min(Math.max(t, 0.0), len);\r\n  }\r\n\r\n  v2x *= t;\r\n  v2y *= t;\r\n  v2z *= t;\r\n\r\n  return (v2x - px)*(v2x - px) + (v2y - py)*(v2y - py) + (v2z - pz)*(v2z - pz);\r\n}\r\n\r\nexport function dist_to_line(p, v1, v2, clip = true) {\r\n  return Math.sqrt(dist_to_line_sqr(p, v1, v2, clip));\r\n}\r\n\r\n//p cam be 2d, 3d, or 4d point, v1/v2 however must be full homogenous coordinates\r\nvar _cplw_vs4 = util.cachering.fromConstructor(Vector4, 64);\r\nvar _cplw_vs3 = util.cachering.fromConstructor(Vector3, 64);\r\nvar _cplw_vs2 = util.cachering.fromConstructor(Vector2, 64);\r\n\r\nfunction wclip(x1, x2, w1, w2, near) {\r\n  var r1 = near*w1 - x1;\r\n  var r2 = (w1 - w2)*near - (x1 - x2);\r\n\r\n  if (r2 == 0.0) return 0.0;\r\n\r\n  return r1/r2;\r\n}\r\n\r\nfunction clip(a, b, znear) {\r\n  if (a - b == 0.0) return 0.0;\r\n\r\n  return (a - znear)/(a - b);\r\n}\r\n\r\n/*clips v1 and v2 to lie within homogenous projection range\r\n  v1 and v2 are assumed to be projected, pre-division Vector4's\r\n  returns a positive number (how much the line was scaled) if either _v1 or _v2 are\r\n  in front of the near clipping plane otherwise, returns 0\r\n */\r\nexport function clip_line_w(_v1, _v2, znear, zfar) {\r\n  var v1 = _cplw_vs4.next().load(_v1);\r\n  var v2 = _cplw_vs4.next().load(_v2);\r\n\r\n  //are we fully behind the view plane?\r\n  if ((v1[2] < 1.0 && v2[2] < 1.0))\r\n    return false;\r\n\r\n  function doclip1(v1, v2, axis) {\r\n    if (v1[axis]/v1[3] < -1) {\r\n      var t = wclip(v1[axis], v2[axis], v1[3], v2[3], -1);\r\n      v1.interp(v2, t);\r\n    } else if (v1[axis]/v1[3] > 1) {\r\n      var t = wclip(v1[axis], v2[axis], v1[3], v2[3], 1);\r\n      v1.interp(v2, t);\r\n    }\r\n  }\r\n\r\n  function doclip(v1, v2, axis) {\r\n    doclip1(v1, v2, axis);\r\n    doclip1(v2, v1, axis);\r\n  }\r\n\r\n  function dozclip(v1, v2) {\r\n    if (v1[2] < 1) {\r\n      var t = clip(v1[2], v2[2], 1);\r\n      v1.interp(v2, t);\r\n    } else if (v2[2] < 1) {\r\n      var t = clip(v2[2], v1[2], 1);\r\n      v2.interp(v1, t);\r\n    }\r\n  }\r\n\r\n  dozclip(v1, v2, 1);\r\n  doclip(v1, v2, 0);\r\n  doclip(v1, v2, 1);\r\n\r\n  for (var i = 0; i < 4; i++) {\r\n    _v1[i] = v1[i];\r\n    _v2[i] = v2[i];\r\n  }\r\n\r\n  return !(v1[0]/v1[3] == v2[0]/v2[3] || v1[1]/v2[3] == v2[1]/v2[3]);\r\n};\r\n\r\n//clip is optional, true.  clip point to lie within line segment v1->v2\r\nvar _closest_point_on_line_cache = util.cachering.fromConstructor(Vector3, 64);\r\nvar _closest_point_rets = new util.cachering(function () {\r\n  return [0, 0];\r\n}, 64);\r\n\r\nvar _closest_tmps = [new Vector3(), new Vector3(), new Vector3()];\r\n\r\nexport function closest_point_on_line(p, v1, v2, clip = true) {\r\n  var l1 = _closest_tmps[0], l2 = _closest_tmps[1];\r\n  var len;\r\n\r\n\r\n  l1.load(v2).sub(v1);\r\n\r\n  if (clip) {\r\n    len = l1.vectorLength();\r\n  }\r\n\r\n  l1.normalize();\r\n  l2.load(p).sub(v1);\r\n\r\n  var t = l2.dot(l1);\r\n  if (clip) {\r\n    //t = t*(t<0.0) + t*(t>1.0) + (t>1.0);\r\n    t = t < 0.0 ? 0.0 : t;\r\n    t = t > len ? len : t;\r\n  }\r\n\r\n  var p = _closest_point_on_line_cache.next();\r\n  p.load(l1).mulScalar(t).add(v1);\r\n  var ret = _closest_point_rets.next();\r\n\r\n  ret[0] = p;\r\n  ret[1] = t;\r\n\r\n  return ret;\r\n};\r\n\r\n/*given input line (a,d) and tangent t,\r\n  returns a circle that goes through both\r\n  a and d, whose normalized tangent at a is the same\r\n  as normalized t.\r\n  \r\n  note that t need not be normalized, this function\r\n  does that itself*/\r\nvar _circ_from_line_tan_vs = util.cachering.fromConstructor(Vector3, 32);\r\nvar _circ_from_line_tan_ret = new util.cachering(function () {\r\n  return [new Vector3(), 0];\r\n}, 64);\r\n\r\nexport function circ_from_line_tan(a, b, t) {\r\n  let p1 = _circ_from_line_tan_vs.next();\r\n  let t2 = _circ_from_line_tan_vs.next();\r\n  let n1 = _circ_from_line_tan_vs.next();\r\n\r\n  p1.load(a).sub(b);\r\n  t2.load(t).normalize();\r\n  n1.load(p1).normalize().cross(t2).cross(t2).normalize();\r\n\r\n  let ax = p1[0], ay = p1[1], az = p1[2], nx = n1[0], ny = n1[1], nz = n1[2];\r\n  let r = -(ax*ax + ay*ay + az*az);\r\n  let div = (2*(ax*nx + ay*ny + az*nz));\r\n\r\n  if (Math.abs(div) > 0.000001) {\r\n    r /= div;\r\n  } else {\r\n    r = 1000000.0;\r\n  }\r\n\r\n  let ret = _circ_from_line_tan_ret.next();\r\n  ret[0].load(n1).mulScalar(r).add(a)\r\n  ret[1] = r;\r\n\r\n  return ret;\r\n}\r\n\r\n/*given input line (a,d) and tangent t,\r\n  returns a circle that goes through both\r\n  a and d, whose normalized tangent at a is the same\r\n  as normalized t.\r\n\r\n  note that t need not be normalized, this function\r\n  does that itself*/\r\nvar _circ_from_line_tan2d_vs = util.cachering.fromConstructor(Vector3, 32);\r\nvar _circ_from_line_tan2d_ret = new util.cachering(function () {\r\n  return [new Vector2(), 0];\r\n}, 64);\r\n\r\nexport function circ_from_line_tan_2d(a, b, t) {\r\n  a = _circ_from_line_tan2d_vs.next().load(a);\r\n  b = _circ_from_line_tan2d_vs.next().load(b);\r\n  t = _circ_from_line_tan2d_vs.next().load(t);\r\n\r\n  a[2] = b[2] = t[2] = 0.0;\r\n\r\n  let p1 = _circ_from_line_tan2d_vs.next();\r\n  let t2 = _circ_from_line_tan2d_vs.next();\r\n  let n1 = _circ_from_line_tan2d_vs.next();\r\n\r\n  p1.load(a).sub(b);\r\n  t2.load(t).normalize();\r\n  n1.load(p1).normalize().cross(t2).cross(t2).normalize();\r\n\r\n  if (1) {\r\n    let cx, cy, r;\r\n    let x1 = a[0], y1 = a[1];\r\n    let x2 = b[0], y2 = b[1];\r\n    let tanx1 = t[0], tany1 = t[1];\r\n\r\n    let div = (4.0*((x1 - x2)*tany1 - (y1 - y2)*tanx1)**2);\r\n    let div2 = (2.0*(x1 - x2)*tany1 - 2.0*(y1 - y2)*tanx1);\r\n\r\n    if (Math.abs(div) < 0.0001 || Math.abs(div2) < 0.0001) {\r\n      let ret = _circ_from_line_tan2d_ret.next();\r\n\r\n      ret[0].load(a).interp(b, 0.5);\r\n      let dx = a[1] - b[1];\r\n      let dy = b[0] - a[0];\r\n\r\n      r = 1000000.0;\r\n\r\n      ret[0][0] += dx*r;\r\n      ret[0][1] += dy*r;\r\n      ret[1] = r;\r\n\r\n      return ret;\r\n    }\r\n    cx = (((x1 + x2)*(x1 - x2) - (y1 - y2)**2)*tany1 - 2.0*(y1 - y2)*tanx1*x1\r\n    )/div2;\r\n\r\n    cy = (-((y1 + y2)*(y1 - y2) - x2**2 - (x1 - 2.0*x2)*x1)*tanx1 + 2.0*(x1 -\r\n      x2)*tany1*y1)/div2;\r\n\r\n    r = (((y1 - y2)**2 + x2**2 + (x1 - 2.0*x2)*x1)**2*(tanx1**2 + tany1**2)\r\n    )/div;\r\n\r\n    let midx = a[0]*0.5 + b[0]*0.5;\r\n    let midy = a[1]*0.5 + b[1]*0.5;\r\n\r\n    //mirror\r\n    cx = 2.0*midx - cx;\r\n    cy = 2.0*midy - cy;\r\n\r\n    let ret = _circ_from_line_tan2d_ret.next();\r\n    ret[0].loadXY(cx, cy);\r\n    ret[1] = Math.sqrt(r);\r\n\r\n    return ret;\r\n  } else {\r\n    let ax = p1[0], ay = p1[1], az = p1[2], nx = n1[0], ny = n1[1], nz = n1[2];\r\n    let r = -(ax*ax + ay*ay + az*az);\r\n    let div = (2*(ax*nx + ay*ny + az*nz));\r\n\r\n    if (Math.abs(div) > 0.000001) {\r\n      r /= div;\r\n    } else {\r\n      r = 1000000.0;\r\n    }\r\n\r\n    let ret = _circ_from_line_tan2d_ret.next();\r\n    ret[0].load(n1).mulScalar(r).add(a)\r\n    ret[1] = r;\r\n\r\n    return ret;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nvar _gtc_e1 = new Vector3();\r\nvar _gtc_e2 = new Vector3();\r\nvar _gtc_e3 = new Vector3();\r\nvar _gtc_p1 = new Vector3();\r\nvar _gtc_p2 = new Vector3();\r\nvar _gtc_v1 = new Vector3();\r\nvar _gtc_v2 = new Vector3();\r\nvar _gtc_p12 = new Vector3();\r\nvar _gtc_p22 = new Vector3();\r\nvar _get_tri_circ_ret = new util.cachering(function () {\r\n  return [0, 0]\r\n});\r\n\r\nexport function get_tri_circ(a, b, c) {\r\n  var v1 = _gtc_v1;\r\n  var v2 = _gtc_v2;\r\n  var e1 = _gtc_e1;\r\n  var e2 = _gtc_e2;\r\n  var e3 = _gtc_e3;\r\n  var p1 = _gtc_p1;\r\n  var p2 = _gtc_p2;\r\n\r\n  for (var i = 0; i < 3; i++) {\r\n    e1[i] = b[i] - a[i];\r\n    e2[i] = c[i] - b[i];\r\n    e3[i] = a[i] - c[i];\r\n  }\r\n\r\n  for (var i = 0; i < 3; i++) {\r\n    p1[i] = (a[i] + b[i])*0.5;\r\n    p2[i] = (c[i] + b[i])*0.5;\r\n  }\r\n\r\n  e1.normalize();\r\n\r\n  v1[0] = -e1[1];\r\n  v1[1] = e1[0];\r\n  v1[2] = e1[2];\r\n\r\n  v2[0] = -e2[1];\r\n  v2[1] = e2[0];\r\n  v2[2] = e2[2];\r\n\r\n  v1.normalize();\r\n  v2.normalize();\r\n\r\n  var cent;\r\n  var type;\r\n  for (var i = 0; i < 3; i++) {\r\n    _gtc_p12[i] = p1[i] + v1[i];\r\n    _gtc_p22[i] = p2[i] + v2[i];\r\n  }\r\n\r\n  var ret = line_isect(p1, _gtc_p12, p2, _gtc_p22);\r\n  cent = ret[0];\r\n  type = ret[1];\r\n\r\n  e1.load(a);\r\n  e2.load(b);\r\n  e3.load(c);\r\n\r\n  var r = e1.sub(cent).vectorLength();\r\n  if (r < feps)\r\n    r = e2.sub(cent).vectorLength();\r\n  if (r < feps)\r\n    r = e3.sub(cent).vectorLength();\r\n\r\n  var ret = _get_tri_circ_ret.next();\r\n  ret[0] = cent;\r\n  ret[1] = r;\r\n\r\n  return ret;\r\n};\r\n\r\nexport function gen_circle(m, origin, r, stfeps) {\r\n  var pi = Math.PI;\r\n  var f = -pi/2;\r\n  var df = (pi*2)/stfeps;\r\n  var verts = new Array();\r\n  for (var i = 0; i < stfeps; i++) {\r\n    var x = origin[0] + r*Math.sin(f);\r\n    var y = origin[1] + r*Math.cos(f);\r\n    var v = m.make_vert(new Vector3([x, y, origin[2]]));\r\n    verts.push(v);\r\n    f += df;\r\n  }\r\n  for (var i = 0; i < verts.length; i++) {\r\n    var v1 = verts[i];\r\n    var v2 = verts[(i + 1)%verts.length];\r\n    m.make_edge(v1, v2);\r\n  }\r\n  return verts;\r\n};\r\n\r\nvar cos = Math.cos;\r\nvar sin = Math.sin;\r\n\r\n//axis is optional, 0\r\nexport function rot2d(v1, A, axis) {\r\n  var x = v1[0];\r\n  var y = v1[1];\r\n\r\n  if (axis == 1) {\r\n    v1[0] = x*cos(A) + y*sin(A);\r\n    v1[2] = y*cos(A) - x*sin(A);\r\n  } else {\r\n    v1[0] = x*cos(A) - y*sin(A);\r\n    v1[1] = y*cos(A) + x*sin(A);\r\n  }\r\n}\r\n\r\nexport function makeCircleMesh(gl, radius, stfeps) {\r\n  var mesh = new Mesh();\r\n  var verts1 = gen_circle(mesh, new Vector3(), radius, stfeps);\r\n  var verts2 = gen_circle(mesh, new Vector3(), radius/1.75, stfeps);\r\n  mesh.make_face_complex([verts1, verts2]);\r\n  return mesh;\r\n};\r\n\r\nexport function minmax_verts(verts) {\r\n  var min = new Vector3([1000000000000.0, 1000000000000.0, 1000000000000.0]);\r\n  var max = new Vector3([-1000000000000.0, -1000000000000.0, -1000000000000.0]);\r\n  var __iter_v = __get_iter(verts);\r\n  var v;\r\n  while (1) {\r\n    var __ival_v = __iter_v.next();\r\n    if (__ival_v.done) {\r\n      break;\r\n    }\r\n    v = __ival_v.value;\r\n    for (var i = 0; i < 3; i++) {\r\n      min[i] = Math.min(min[i], v.co[i]);\r\n      max[i] = Math.max(max[i], v.co[i]);\r\n    }\r\n  }\r\n  return [min, max];\r\n};\r\n\r\nexport function unproject(vec, ipers, iview) {\r\n  var newvec = new Vector3(vec);\r\n  newvec.multVecMatrix(ipers);\r\n  newvec.multVecMatrix(iview);\r\n  return newvec;\r\n};\r\n\r\nexport function project(vec, pers, view) {\r\n  var newvec = new Vector3(vec);\r\n  newvec.multVecMatrix(pers);\r\n  newvec.multVecMatrix(view);\r\n  return newvec;\r\n};\r\n\r\nvar _sh_minv = new Vector3();\r\nvar _sh_maxv = new Vector3();\r\nvar _sh_start = [];\r\nvar _sh_end = [];\r\n\r\nvar static_cent_gbw = new Vector3();\r\n\r\nexport function get_boundary_winding(points) {\r\n  var cent = static_cent_gbw.zero();\r\n  if (points.length == 0)\r\n    return false;\r\n  for (var i = 0; i < points.length; i++) {\r\n    cent.add(points[i]);\r\n  }\r\n  cent.divideScalar(points.length);\r\n  var w = 0, totw = 0;\r\n  for (var i = 0; i < points.length; i++) {\r\n    var v1 = points[i];\r\n    var v2 = points[(i + 1)%points.length];\r\n    if (!colinear(v1, v2, cent)) {\r\n      w += winding(v1, v2, cent);\r\n      totw += 1;\r\n    }\r\n  }\r\n  if (totw > 0)\r\n    w /= totw;\r\n  return Math.round(w) == 1;\r\n};\r\n\r\nexport class PlaneOps {\r\n  constructor(normal) {\r\n    var no = normal;\r\n    this.axis = [0, 0, 0];\r\n    this.reset_axis(normal);\r\n  }\r\n\r\n  reset_axis(no) {\r\n    var ax, ay, az;\r\n    var nx = Math.abs(no[0]), ny = Math.abs(no[1]), nz = Math.abs(no[2]);\r\n    if (nz > nx && nz > ny) {\r\n      ax = 0;\r\n      ay = 1;\r\n      az = 2;\r\n    } else if (nx > ny && nx > nz) {\r\n      ax = 2;\r\n      ay = 1;\r\n      az = 0;\r\n    } else {\r\n      ax = 0;\r\n      ay = 2;\r\n      az = 1;\r\n    }\r\n    this.axis = [ax, ay, az];\r\n  }\r\n\r\n  convex_quad(v1, v2, v3, v4) {\r\n    var ax = this.axis;\r\n    v1 = new Vector3([v1[ax[0]], v1[ax[1]], v1[ax[2]]]);\r\n    v2 = new Vector3([v2[ax[0]], v2[ax[1]], v2[ax[2]]]);\r\n    v3 = new Vector3([v3[ax[0]], v3[ax[1]], v3[ax[2]]]);\r\n    v4 = new Vector3([v4[ax[0]], v4[ax[1]], v4[ax[2]]]);\r\n    return convex_quad(v1, v2, v3, v4);\r\n  }\r\n\r\n  line_isect(v1, v2, v3, v4) {\r\n    var ax = this.axis;\r\n    var orig1 = v1, orig2 = v2;\r\n    v1 = new Vector3([v1[ax[0]], v1[ax[1]], v1[ax[2]]]);\r\n    v2 = new Vector3([v2[ax[0]], v2[ax[1]], v2[ax[2]]]);\r\n    v3 = new Vector3([v3[ax[0]], v3[ax[1]], v3[ax[2]]]);\r\n    v4 = new Vector3([v4[ax[0]], v4[ax[1]], v4[ax[2]]]);\r\n    var ret = line_isect(v1, v2, v3, v4, true);\r\n    var vi = ret[0];\r\n    if (ret[1] == LINECROSS) {\r\n      ret[0].load(orig2).sub(orig1).mulScalar(ret[2]).add(orig1);\r\n    }\r\n    return ret;\r\n  }\r\n\r\n  line_line_cross(l1, l2) {\r\n    var ax = this.axis;\r\n    var v1 = l1[0], v2 = l1[1], v3 = l2[0], v4 = l2[1];\r\n    v1 = new Vector3([v1[ax[0]], v1[ax[1]], 0.0]);\r\n    v2 = new Vector3([v2[ax[0]], v2[ax[1]], 0.0]);\r\n    v3 = new Vector3([v3[ax[0]], v3[ax[1]], 0.0]);\r\n    v4 = new Vector3([v4[ax[0]], v4[ax[1]], 0.0]);\r\n    return line_line_cross([v1, v2], [v3, v4]);\r\n  }\r\n\r\n  winding(v1, v2, v3) {\r\n    var ax = this.axis;\r\n    if (v1 == undefined)\r\n      console.trace();\r\n    v1 = new Vector3([v1[ax[0]], v1[ax[1]], 0.0]);\r\n    v2 = new Vector3([v2[ax[0]], v2[ax[1]], 0.0]);\r\n    v3 = new Vector3([v3[ax[0]], v3[ax[1]], 0.0]);\r\n    return winding(v1, v2, v3);\r\n  }\r\n\r\n  colinear(v1, v2, v3) {\r\n    var ax = this.axis;\r\n    v1 = new Vector3([v1[ax[0]], v1[ax[1]], 0.0]);\r\n    v2 = new Vector3([v2[ax[0]], v2[ax[1]], 0.0]);\r\n    v3 = new Vector3([v3[ax[0]], v3[ax[1]], 0.0]);\r\n    return colinear(v1, v2, v3);\r\n  }\r\n\r\n  get_boundary_winding(points) {\r\n    var ax = this.axis;\r\n    var cent = new Vector3();\r\n    if (points.length == 0)\r\n      return false;\r\n    for (var i = 0; i < points.length; i++) {\r\n      cent.add(points[i]);\r\n    }\r\n    cent.divideScalar(points.length);\r\n    var w = 0, totw = 0;\r\n    for (var i = 0; i < points.length; i++) {\r\n      var v1 = points[i];\r\n      var v2 = points[(i + 1)%points.length];\r\n      if (!this.colinear(v1, v2, cent)) {\r\n        w += this.winding(v1, v2, cent);\r\n        totw += 1;\r\n      }\r\n    }\r\n    if (totw > 0)\r\n      w /= totw;\r\n    return Math.round(w) == 1;\r\n  }\r\n}\r\n\r\n/*\r\non factor;\r\n\r\npx := rox + rnx*t;\r\npy := roy + rny*t;\r\npz := roz + rnz*t;\r\n\r\nf1 := (px-pox)*pnx + (py-poy)*pny + (pz-poz)*pnz;\r\nff := solve(f1, t);\r\non fort;\r\npart(ff, 1, 2);\r\noff fort;\r\n\r\n* */\r\nvar _isrp_ret = new Vector3();\r\nlet isect_ray_plane_rets = util.cachering.fromConstructor(Vector3, 256);\r\n\r\nexport function isect_ray_plane(planeorigin, planenormal, rayorigin, raynormal) {\r\n  let po = planeorigin, pn = planenormal, ro = rayorigin, rn = raynormal;\r\n\r\n  let div = (pn[1]*rn[1] + pn[2]*rn[2] + pn[0]*rn[0]);\r\n\r\n  if (Math.abs(div) < 0.000001) {\r\n    return undefined;\r\n  }\r\n\r\n  let t = ((po[1] - ro[1])*pn[1] + (po[2] - ro[2])*pn[2] + (po[0] - ro[0])*pn[0])/div;\r\n  _isrp_ret.load(ro).addFac(rn, t);\r\n\r\n  return isect_ray_plane_rets.next().load(_isrp_ret);\r\n}\r\n\r\nexport function _old_isect_ray_plane(planeorigin, planenormal, rayorigin, raynormal) {\r\n  var p = planeorigin, n = planenormal;\r\n  var r = rayorigin, v = raynormal;\r\n\r\n  var d = p.vectorLength();\r\n  var t = -(r.dot(n) - p.dot(n))/v.dot(n);\r\n  _isrp_ret.load(v);\r\n  _isrp_ret.mulScalar(t);\r\n  _isrp_ret.add(r);\r\n  return _isrp_ret;\r\n};\r\n\r\nexport function mesh_find_tangent(mesh, viewvec, offvec, projmat, verts) {\r\n  if (verts == undefined)\r\n    verts = mesh.verts.selected;\r\n  var vset = new set();\r\n  var eset = new set();\r\n  var __iter_v = __get_iter(verts);\r\n  var v;\r\n  while (1) {\r\n    var __ival_v = __iter_v.next();\r\n    if (__ival_v.done) {\r\n      break;\r\n    }\r\n    v = __ival_v.value;\r\n    vset.add(v);\r\n  }\r\n  var __iter_v = __get_iter(vset);\r\n  var v;\r\n  while (1) {\r\n    var __ival_v = __iter_v.next();\r\n    if (__ival_v.done) {\r\n      break;\r\n    }\r\n    v = __ival_v.value;\r\n    var __iter_e = __get_iter(v.edges);\r\n    var e;\r\n    while (1) {\r\n      var __ival_e = __iter_e.next();\r\n      if (__ival_e.done) {\r\n        break;\r\n      }\r\n      e = __ival_e.value;\r\n      if (vset.has(e.other_vert(v))) {\r\n        eset.add(e);\r\n      }\r\n    }\r\n  }\r\n  if (eset.length == 0) {\r\n    return new Vector3(offvec);\r\n  }\r\n  var tanav = new Vector3();\r\n  var evec = new Vector3();\r\n  var tan = new Vector3();\r\n  var co2 = new Vector3();\r\n  var __iter_e = __get_iter(eset);\r\n  var e;\r\n  while (1) {\r\n    var __ival_e = __iter_e.next();\r\n    if (__ival_e.done) {\r\n      break;\r\n    }\r\n    e = __ival_e.value;\r\n    evec.load(e.v1.co).multVecMatrix(projmat);\r\n    co2.load(e.v2.co).multVecMatrix(projmat);\r\n    evec.sub(co2);\r\n    evec.normalize();\r\n    tan[0] = evec[1];\r\n    tan[1] = -evec[0];\r\n    tan[2] = 0.0;\r\n    if (tan.dot(offvec) < 0.0)\r\n      tan.mulScalar(-1.0);\r\n    tanav.add(tan);\r\n  }\r\n  tanav.normalize();\r\n  return tanav;\r\n};\r\n\r\nexport class Mat4Stack {\r\n  constructor() {\r\n    this.stack = [];\r\n    this.matrix = new Matrix4();\r\n    this.matrix.makeIdentity();\r\n    this.update_func = undefined;\r\n  }\r\n\r\n  set_internal_matrix(mat, update_func) {\r\n    this.update_func = update_func;\r\n    this.matrix = mat;\r\n  }\r\n\r\n  reset(mat) {\r\n    this.matrix.load(mat);\r\n    this.stack = [];\r\n    if (this.update_func != undefined)\r\n      this.update_func();\r\n  }\r\n\r\n  load(mat) {\r\n    this.matrix.load(mat);\r\n    if (this.update_func != undefined)\r\n      this.update_func();\r\n  }\r\n\r\n  multiply(mat) {\r\n    this.matrix.multiply(mat);\r\n    if (this.update_func != undefined)\r\n      this.update_func();\r\n  }\r\n\r\n  identity() {\r\n    this.matrix.loadIdentity();\r\n    if (this.update_func != undefined)\r\n      this.update_func();\r\n  }\r\n\r\n  push(mat2) {\r\n    this.stack.push(new Matrix4(this.matrix));\r\n    if (mat2 != undefined) {\r\n      this.matrix.load(mat2);\r\n      if (this.update_func != undefined)\r\n        this.update_func();\r\n    }\r\n  }\r\n\r\n  pop() {\r\n    var mat = this.stack.pop(this.stack.length - 1);\r\n    this.matrix.load(mat);\r\n    if (this.update_func != undefined)\r\n      this.update_func();\r\n    return mat;\r\n  }\r\n}\r\n\r\n\r\n/*\r\n\r\non factor;\r\noff period;\r\n\r\nload_package \"avector\";\r\n\r\n\r\na1 := avec(a1x, a1y, a1z);\r\nb1 := avec(b1x, b1y, b1z);\r\nc1 := avec(c1x, c1y, c1z);\r\nd1 := avec(d1x, d1y, d1z);\r\n\r\na1x := 0;\r\na1y := 0;\r\na1z := 0;\r\n\r\na2 := avec(a2x, a2y, a2z);\r\nb2 := avec(b2x, b2y, b2z);\r\nc2 := avec(c2x, c2y, c2z);\r\nd2 := avec(d2x, d2y, d2z);\r\n\r\np1 := a1 + (b1 - a1) * v;\r\np2 := d1 + (c1 - d1) * v;\r\np3 := p1 + (p2 - p1) * u;\r\n\r\np4 := a2 + (b2 - a2) * v;\r\np5 := d2 + (c2 - d2) * v;\r\np6 := p4 + (p5 - p4) * u;\r\n\r\np7 := p3 + (p6 - p3) * w;\r\n\r\nf1 := p7[0] - goalx;\r\nf2 := p7[1] - goaly;\r\nf3 := p7[2] - goalz;\r\n\r\ncomment: solve({f1, f2, f3}, {u, v, w});\r\n\r\non fort;\r\np7;\r\noff fort;\r\n\r\nsub(u=0, v=1, w=0, p7[0]);\r\n\r\n*/\r\n\r\nconst tril_rets = util.cachering.fromConstructor(Vector3, 128);\r\n\r\nfunction lreport() {\r\n  //console.log(...arguments);\r\n}\r\n\r\nexport function trilinear_v3(uvw, boxverts) {\r\n  let [u, v, w] = uvw;\r\n\r\n  const a1x = boxverts[0][0], a1y = boxverts[0][1], a1z = boxverts[0][2];\r\n\r\n  const b1x = boxverts[1][0] - a1x, b1y = boxverts[1][1] - a1y, b1z = boxverts[1][2] - a1z;\r\n  const c1x = boxverts[2][0] - a1x, c1y = boxverts[2][1] - a1y, c1z = boxverts[2][2] - a1z;\r\n  const d1x = boxverts[3][0] - a1x, d1y = boxverts[3][1] - a1y, d1z = boxverts[3][2] - a1z;\r\n\r\n  const a2x = boxverts[4][0] - a1x, a2y = boxverts[4][1] - a1y, a2z = boxverts[4][2] - a1z;\r\n  const b2x = boxverts[5][0] - a1x, b2y = boxverts[5][1] - a1y, b2z = boxverts[5][2] - a1z;\r\n  const c2x = boxverts[6][0] - a1x, c2y = boxverts[6][1] - a1y, c2z = boxverts[6][2] - a1z;\r\n  const d2x = boxverts[7][0] - a1x, d2y = boxverts[7][1] - a1y, d2z = boxverts[7][2] - a1z;\r\n\r\n  const x = (((a2x - b2x)*v - a2x + (c2x - d2x)*v + d2x)*u - ((a2x - b2x)*v - a2x) - (\r\n      ((c1x - d1x)*v + d1x - b1x*v)*u + b1x*v))*w + ((c1x - d1x)*v + d1x - b1x*v)*u +\r\n    b1x*v;\r\n  const y = (((a2y - b2y)*v - a2y + (c2y - d2y)*v + d2y)*u - ((a2y - b2y)*v - a2y) - (\r\n      ((c1y - d1y)*v + d1y - b1y*v)*u + b1y*v))*w + ((c1y - d1y)*v + d1y - b1y*v)*u +\r\n    b1y*v;\r\n  const z = (((a2z - b2z)*v - a2z + (c2z - d2z)*v + d2z)*u - ((a2z - b2z)*v - a2z) - (\r\n      ((c1z - d1z)*v + d1z - b1z*v)*u + b1z*v))*w + ((c1z - d1z)*v + d1z - b1z*v)*u +\r\n    b1z*v;\r\n\r\n  let p = tril_rets.next();\r\n\r\n  p[0] = x + a1x;\r\n  p[1] = y + a1y;\r\n  p[2] = z + a1z;\r\n\r\n  return p;\r\n}\r\n\r\nlet tril_co_rets = util.cachering.fromConstructor(Vector3, 128);\r\nlet tril_co_tmps = util.cachering.fromConstructor(Vector3, 16);\r\nlet tril_mat_1 = new Matrix4();\r\nlet tril_mat_2 = new Matrix4();\r\n\r\nlet wtable = [\r\n  [\r\n    [0.5, 0.5, 0], //u triplet\r\n    [0.5, 0.5, 0], //v triplet\r\n    [0.5, 0.5, 0]  //w triplet\r\n  ],\r\n  [\r\n    [0.5, 0.5, 0],\r\n    [0.0, 0.5, 0.5],\r\n    [0.5, 0.5, 0]\r\n  ],\r\n  [\r\n    [0.0, 0.5, 0.5],\r\n    [0.0, 0.5, 0.5],\r\n    [0.5, 0.5, 0]\r\n  ],\r\n  [\r\n    [0.0, 0.5, 0.5],\r\n    [0.5, 0.5, 0],\r\n    [0.5, 0.5, 0]\r\n  ],\r\n];\r\n\r\nfor (let i = 0; i < 4; i++) {\r\n  let w = wtable[i];\r\n  w = [w[0], w[1], [0.0, 0.5, 0.5]];\r\n  wtable.push(w);\r\n}\r\n\r\nconst pih_tmps = util.cachering.fromConstructor(Vector3, 16);\r\nconst boxfaces_table = [\r\n  [0, 1, 2, 3],\r\n  [7, 6, 5, 4],\r\n  [0, 4, 5, 1],\r\n  [1, 5, 6, 2],\r\n  [2, 6, 7, 3],\r\n  [3, 7, 4, 0]\r\n];\r\n\r\nlet boxfaces_tmp = new Array(6);\r\nfor (let i = 0; i < 6; i++) {\r\n  boxfaces_tmp[i] = new Vector3();\r\n}\r\n\r\nlet boxfacenormals_tmp = new Array(6);\r\nfor (let i = 0; i < 6; i++) {\r\n  boxfacenormals_tmp[i] = new Vector3();\r\n}\r\n\r\nexport function point_in_hex(p, boxverts, boxfacecents = undefined, boxfacenormals = undefined) {\r\n  if (!boxfacecents) {\r\n    boxfacecents = boxfaces_tmp;\r\n\r\n    for (let i = 0; i < 6; i++) {\r\n      let [v1, v2, v3, v4] = boxfaces_table[i];\r\n      v1 = boxverts[v1];\r\n      v2 = boxverts[v2];\r\n      v3 = boxverts[v3];\r\n      v4 = boxverts[v4];\r\n\r\n      boxfacecents[i].load(v1).add(v2).add(v3).add(v4).mulScalar(0.25);\r\n    }\r\n  }\r\n\r\n  if (!boxfacenormals) {\r\n    boxfacenormals = boxfacenormals_tmp;\r\n    for (let i = 0; i < 6; i++) {\r\n      let [v1, v2, v3, v4] = boxfaces_table[i];\r\n      v1 = boxverts[v1];\r\n      v2 = boxverts[v2];\r\n      v3 = boxverts[v3];\r\n      v4 = boxverts[v4];\r\n\r\n      let n = normal_quad(v1, v2, v3, v4);\r\n      boxfacenormals[i].load(n).negate();\r\n    }\r\n  }\r\n\r\n  let t1 = pih_tmps.next();\r\n  let t2 = pih_tmps.next();\r\n\r\n  let cent = pih_tmps.next().zero();\r\n  for (let i = 0; i < 6; i++) {\r\n    cent.add(boxfacecents[i]);\r\n  }\r\n  cent.mulScalar(1.0/6.0);\r\n\r\n  let ret = true;\r\n\r\n  for (let i = 0; i < 6; i++) {\r\n    t1.load(p).sub(boxfacecents[i]);\r\n    t2.load(cent).sub(boxfacecents[i]);\r\n    let n = boxfacenormals[i];\r\n\r\n    if (1) {\r\n      t1.normalize();\r\n      t2.normalize();\r\n\r\n      //console.log(i, \"DOT\", n.dot(t1).toFixed(5), n, t1);\r\n    }\r\n\r\n    if (t1.dot(t2) < 0) {\r\n      //console.log(\"\\n\");\r\n      ret = false;\r\n      return false;\r\n    }\r\n  }\r\n\r\n  //console.log(\"\\n\");\r\n  return ret;\r\n  //return true;\r\n}\r\n\r\nconst boxverts_tmp = new Array(8);\r\nfor (let i = 0; i < 8; i++) {\r\n  boxverts_tmp[i] = new Vector3();\r\n}\r\n\r\nexport function trilinear_co(p, boxverts) {\r\n  let uvw = tril_co_rets.next();\r\n\r\n  uvw.zero();\r\n\r\n  let u = tril_co_tmps.next();\r\n  let v = tril_co_tmps.next();\r\n  let w = tril_co_tmps.next();\r\n\r\n  u.loadXYZ(0.0, 0.5, 1.0);\r\n  v.loadXYZ(0.0, 0.5, 1.0);\r\n  w.loadXYZ(0.0, 0.5, 1.0);\r\n\r\n  let uvw2 = tril_co_tmps.next();\r\n\r\n  for (let step = 0; step < 4; step++) {\r\n    uvw.loadXYZ(u[1], v[1], w[1]);\r\n\r\n    let mini = undefined;\r\n    let mindis = trilinear_v3(uvw, boxverts).vectorDistanceSqr(p);\r\n\r\n    for (let i = 0; i < 8; i++) {\r\n      let [t1, t2, t3] = wtable[i];\r\n\r\n      let u2 = t1[0]*u[0] + t1[1]*u[1] + t1[2]*u[2];\r\n      let v2 = t2[0]*v[0] + t2[1]*v[1] + t2[2]*v[2];\r\n      let w2 = t3[0]*w[0] + t3[1]*w[1] + t3[2]*w[2];\r\n\r\n      let du = Math.abs(u2 - u[1]);\r\n      let dv = Math.abs(v2 - v[1]);\r\n      let dw = Math.abs(w2 - w[1]);\r\n\r\n      uvw.loadXYZ(u2, v2, w2);\r\n      let dis = trilinear_v3(uvw, boxverts).vectorDistanceSqr(p);\r\n\r\n      if (mindis === undefined || dis < mindis) {\r\n        //mindis = dis;\r\n        //mini = i;\r\n      }\r\n\r\n      if (1) {\r\n        let bv = boxverts_tmp;\r\n\r\n        /*\r\n        let dd = 1.0 - 0.001;\r\n\r\n        du *= dd;\r\n        dv *= dd;\r\n        dw *= dd;\r\n        //*/\r\n\r\n        bv[0].loadXYZ(u2 - du, v2 - dv, w2 - dw);\r\n        bv[1].loadXYZ(u2 - du, v2 + dv, w2 - dw);\r\n        bv[2].loadXYZ(u2 + du, v2 + dv, w2 - dw);\r\n        bv[3].loadXYZ(u2 + du, v2 - dv, w2 - dw);\r\n\r\n        bv[4].loadXYZ(u2 - du, v2 - dv, w2 + dw);\r\n        bv[5].loadXYZ(u2 - du, v2 + dv, w2 + dw);\r\n        bv[6].loadXYZ(u2 + du, v2 + dv, w2 + dw);\r\n        bv[7].loadXYZ(u2 + du, v2 - dv, w2 + dw);\r\n\r\n        for (let j = 0; j < 8; j++) {\r\n          bv[j].load(trilinear_v3(bv[j], boxverts));\r\n        }\r\n\r\n        if (point_in_hex(p, bv)) {\r\n          mini = i;\r\n          mindis = dis;\r\n          //console.log(\"DIS\", (dis**0.5).toFixed(3));\r\n          break;\r\n        }\r\n\r\n        //console.log(\"\\n\");\r\n      }\r\n    }\r\n\r\n    if (mini === undefined) {\r\n      lreport(\"mindis:\", (mindis**0.5).toFixed(3));\r\n      break;\r\n    }\r\n\r\n    let [t1, t2, t3] = wtable[mini];\r\n\r\n    let u2 = t1[0]*u[0] + t1[1]*u[1] + t1[2]*u[2];\r\n    let v2 = t2[0]*v[0] + t2[1]*v[1] + t2[2]*v[2];\r\n    let w2 = t3[0]*w[0] + t3[1]*w[1] + t3[2]*w[2];\r\n\r\n    let du = Math.abs(u2 - u[1]);\r\n    let dv = Math.abs(v2 - v[1]);\r\n    let dw = Math.abs(w2 - w[1]);\r\n\r\n    u[0] = u2 - du;\r\n    v[0] = v2 - dv;\r\n    w[0] = w2 - dw;\r\n\r\n    u[1] = u2;\r\n    v[1] = v2;\r\n    w[1] = w2;\r\n\r\n    u[2] = u2 + du;\r\n    v[2] = v2 + dv;\r\n    w[2] = w2 + dw;\r\n\r\n    lreport(\"mindis:\", (mindis**0.5).toFixed(3), u2, v2, w2);\r\n  }\r\n\r\n  uvw.loadXYZ(u[1], v[1], w[1]);\r\n\r\n  //console.log(\"uvw\", uvw);\r\n\r\n  //return uvw;\r\n\r\n  return trilinear_co2(p, boxverts, uvw);\r\n}\r\n\r\n//newton-raphson\r\nexport function trilinear_co2(p, boxverts, uvw) {\r\n  //let uvw = tril_co_rets.next();\r\n  let grad = tril_co_tmps.next();\r\n\r\n  //uvw[0] = uvw[1] = uvw[2] = 0.5;\r\n\r\n  let df = 0.00001;\r\n\r\n  let mat = tril_mat_1;\r\n  let m = mat.$matrix;\r\n  let mat2 = tril_mat_2;\r\n\r\n  let r1 = tril_co_tmps.next();\r\n\r\n  for (let step = 0; step < 55; step++) {\r\n    //let r1 = trilinear_v3(uvw, boxverts).vectorDistance(p);\r\n    let totg = 0;\r\n\r\n    for (let i = 0; i < 3; i++) {\r\n      let axis_error = 0.0;\r\n\r\n      if (uvw[i] < 0) {\r\n        axis_error = -uvw[i];\r\n      } else if (uvw[i] > 1.0) {\r\n        axis_error = uvw[i] - 1.0;\r\n      }\r\n      //r1[i] = trilinear_v3(uvw, boxverts)[i] - p[i];\r\n      r1[i] = trilinear_v3(uvw, boxverts).vectorDistance(p) + 10.0*axis_error;\r\n\r\n      let orig = uvw[i];\r\n\r\n      uvw[i] += df;\r\n      //let r2 = trilinear_v3(uvw, boxverts)[i] - p[i];\r\n\r\n      if (uvw[i] < 0) {\r\n        axis_error = -uvw[i];\r\n      } else if (uvw[i] > 1.0) {\r\n        axis_error = uvw[i] - 1.0;\r\n      } else {\r\n        axis_error = 0.0;\r\n      }\r\n      let r2 = trilinear_v3(uvw, boxverts).vectorDistance(p) + 10.0*axis_error;\r\n      uvw[i] = orig;\r\n\r\n      grad[i] = (r2 - r1[i])/df;\r\n      totg += grad[i]**2;\r\n    }\r\n\r\n    if (totg === 0.0) {\r\n      break;\r\n    }\r\n\r\n    let err = trilinear_v3(uvw, boxverts).vectorDistance(p);\r\n\r\n    if (1) {\r\n      //grad.normalize();\r\n      uvw.addFac(grad, -err/totg*0.85);\r\n    } else {\r\n      mat.makeIdentity();\r\n      m.m11 = grad[0];\r\n      m.m12 = grad[1];\r\n      m.m13 = grad[2];\r\n      m.m22 = m.m33 = m.m44 = 0.0;\r\n\r\n      mat.transpose();\r\n      mat2.load(mat).transpose();\r\n\r\n      //right-indepdenent pseudo inverse\r\n      //mat.multiply(mat2).invert();\r\n      //mat.preMultiply(mat2);\r\n\r\n      //left-independent\r\n      mat.preMultiply(mat2).invert();\r\n      mat.multiply(mat2);\r\n\r\n      grad.load(r1);\r\n      grad.multVecMatrix(mat);\r\n      uvw.addFac(grad, -1.0);\r\n    }\r\n\r\n    lreport(\"error:\", err.toFixed(3), uvw);\r\n\r\n    if (r1.dot(r1)**0.5 < 0.0001) {\r\n      break;\r\n    }\r\n  }\r\n\r\n  lreport(\"\\n\");\r\n\r\n  return uvw;\r\n}\r\n\r\nlet angle_tri_v3_rets = util.cachering.fromConstructor(Vector3, 32);\r\nlet angle_tri_v3_vs = util.cachering.fromConstructor(Vector3, 32);\r\n\r\nexport function tri_angles(v1, v2, v3) {\r\n  let t1 = angle_tri_v3_vs.next().load(v1).sub(v2);\r\n  let t2 = angle_tri_v3_vs.next().load(v3).sub(v2);\r\n  let t3 = angle_tri_v3_vs.next().load(v2).sub(v3);\r\n\r\n  t1.normalize();\r\n  t2.normalize();\r\n  t3.normalize();\r\n\r\n  let th1 = Math.acos(t1.dot(t2)*0.99999);\r\n  t2.negate();\r\n\r\n  let th2 = Math.acos(t2.dot(t3)*0.99999);\r\n  let th3 = Math.PI - (th1 + th2);\r\n\r\n  let ret = angle_tri_v3_rets.next();\r\n\r\n  ret[0] = th1;\r\n  ret[1] = th2;\r\n  ret[2] = th3;\r\n\r\n  return ret;\r\n}\r\n\r\n\r\n","let _clipdata = {\r\n  name: \"nothing\",\r\n  mime: \"nothing\",\r\n  data: undefined\r\n};\r\n\r\nlet _clipboards = {};\r\n\r\nimport * as ctrlconfig from '../path-controller/config/config.js';\r\n\r\nwindow.setInterval(() => {\r\n  let cb = navigator.clipboard;\r\n\r\n  if (!cb || !cb.read) {\r\n    return;\r\n  }\r\n\r\n  cb.read().then((data) => {\r\n    for (let item of data) {\r\n      for (let i = 0; i < item.types.length; i++) {\r\n        let type = item.types[i];\r\n\r\n        if (!(type in _clipboards)) {\r\n          _clipboards[type] = {\r\n            name: type,\r\n            mime: type,\r\n            data: undefined\r\n          };\r\n        }\r\n        ;\r\n\r\n        item.getType(type).then((blob) => new Response(blob).text()).then((text) => {\r\n          _clipboards[type].data = text;\r\n        });\r\n      }\r\n\r\n      //item.getType(\"text/css\").then((blob) => blob.text()).then((text) => {\r\n      //  console.log(\"text\", text);\r\n      //});\r\n    }\r\n    //_clipdata.mime =\r\n  }).catch(function () {\r\n  });\r\n}, 200);\r\n\r\nlet exports = {\r\n  /*client code can override this using .loadConstants, here is a simple implementation\r\n    that just handles color data\r\n\r\n    desiredMimes is either a string, or an array of strings\r\n   */\r\n  getClipboardData(desiredMimes = \"text/plain\") {\r\n    if (typeof desiredMimes === \"string\") {\r\n      desiredMimes = [desiredMimes];\r\n    }\r\n\r\n    for (let m of desiredMimes) {\r\n      let cb = _clipboards[m];\r\n\r\n      if (cb && cb.data) {\r\n        return cb;\r\n      }\r\n    }\r\n  },\r\n  /*client code can override this, here is a simple implementation\r\n    that just handles color data\r\n   */\r\n  setClipboardData(name, mime, data) {\r\n    _clipboards[mime] = {\r\n      name: name,\r\n      mime: mime,\r\n      data: data\r\n    };\r\n\r\n    let clipboard = navigator.clipboard;\r\n    if (!clipboard) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      clipboard.write([new ClipboardItem({\r\n        [mime]: new Blob([data], {type: mime})\r\n      })]).catch((error) => {\r\n        //try pushing through text/plain\r\n        if (mime.startsWith(\"text\") && mime !== \"text/plain\") {\r\n          this.setClipboardData(name, \"text/plain\", data);\r\n        } else {\r\n          console.error(error);\r\n        }\r\n      });\r\n    } catch (error) {\r\n      console.log(error.stack);\r\n      console.log(\"failed to write to system clipboard\");\r\n    }\r\n  },\r\n  colorSchemeType: \"light\",\r\n  docManualPath  : \"../simple_docsys/doc_build/\",\r\n\r\n  //add textboxes to rollar sliders,\r\n  //note that  users can also double click them to\r\n  //enter text as well\r\n  useNumSliderTextboxes: true,\r\n\r\n  numSliderArrowLimit: 3, //threshold to check if numslider arrow was clicked\r\n  simpleNumSliders   : false,\r\n\r\n  menusCanPopupAbove: false,\r\n  menu_close_time   : 500,\r\n  doubleClickTime   : 500,\r\n\r\n  //timeout for press-and-hold (touch) version of double clicking\r\n  doubleClickHoldTime: 750,\r\n  DEBUG              : {\r\n    paranoidEvents      : false,\r\n    screenborders       : false,\r\n    areaContextPushes   : false,\r\n    allBordersMovable   : false,\r\n    doOnce              : false,\r\n    modalEvents         : false,\r\n    areaConstraintSolver: false,\r\n    datapaths           : false,\r\n\r\n    domEvents        : false,\r\n    domEventAddRemove: false,\r\n\r\n    debugUIUpdatePerf: false, //turns async FrameManager.update_intern loop into sync\r\n\r\n    screenAreaPosSizeAccesses: false,\r\n    buttonEvents             : false,\r\n\r\n    /*\r\n    customWindowSize: {\r\n      width: 2048, height: 2048\r\n    },\r\n    //*/\r\n  },\r\n\r\n  //auto load 1d bspline templates, can hurt startup time\r\n  autoLoadSplineTemplates: true,\r\n\r\n  addHelpPickers: true,\r\n\r\n  useAreaTabSwitcher : false,\r\n  autoSizeUpdate     : true,\r\n  showPathsInToolTips: true,\r\n\r\n  enableThemeAutoUpdate: true,\r\n  useNativeToolTips: false,\r\n\r\n  loadConstants: function (args) {\r\n    for (let k in args) {\r\n      if (k === \"loadConstants\")\r\n        continue;\r\n\r\n      this[k] = args[k];\r\n    }\r\n\r\n    console.error(\"CC\", ctrlconfig);\r\n    ctrlconfig.setConfig(this);\r\n  }\r\n};\r\n\r\nexport default exports;\r\nwindow.DEBUG = exports.DEBUG;\r\n\r\nlet cfg = document.getElementById(\"pathux-config\");\r\nif (cfg) {\r\n  console.error(\"CONFIG CONFIG\", cfg.innerText);\r\n  exports.loadConstants(JSON.parse(cfg.innerText));\r\n}\r\n","/*\r\nTHEME REFACTOR:\r\n\r\n* Use CSS as much as possible\r\n* Create a compatibility layer\r\n\r\n*/\r\nimport * as util from \"../path-controller/util/util.js\";\r\nimport {Vector3, Vector4} from '../path-controller/util/vectormath.js';\r\nimport nstructjs from \"../path-controller/util/struct.js\";\r\nimport cconst from '../config/const.js';\r\n\r\nexport let compatMap = {\r\n  BoxMargin : \"padding\",\r\n  BoxBG : \"background\",\r\n  BoxRadius : \"border-radius\",\r\n  background : \"background-color\",\r\n  defaultWidth : \"width\",\r\n  defaultHeight : \"height\",\r\n  DefaultWidth : \"width\",\r\n  DefaultHeight : \"height\",\r\n  BoxBorder : \"border-color\",\r\n  BoxLineWidth : \"border-width\",\r\n  BoxSubBG : \"background-color\",\r\n  BoxSub2BG : \"background-color\",\r\n  DefaultPanelBG : \"background-color\",\r\n  InnerPanelBG : \"background-color\",\r\n  Background : \"background-color\",\r\n  numslider_width : \"width\",\r\n  numslider_height : \"height\",\r\n};\r\n\r\nexport let ColorSchemeTypes = {\r\n  LIGHT : \"light\",\r\n  DARK  : \"dark\"\r\n};\r\n\r\nexport function parsepx(css) {\r\n  return parseFloat(css.trim().replace(\"px\", \"\"))\r\n}\r\n\r\nexport function color2css(c, alpha_override) {\r\n  let r = ~~(c[0]*255);\r\n  let g = ~~(c[1]*255);\r\n  let b = ~~(c[2]*255);\r\n  let a = c.length < 4 ? 1.0 : c[3];\r\n\r\n  a = alpha_override !== undefined ? alpha_override : a;\r\n\r\n  if (c.length === 3 && alpha_override === undefined) {\r\n    return `rgb(${r},${g},${b})`;\r\n  } else {\r\n    return `rgba(${r},${g},${b}, ${a})`;\r\n  }\r\n}\r\nwindow.color2css = color2css;\r\n\r\nlet css2color_rets = util.cachering.fromConstructor(Vector4, 64);\r\nlet basic_colors = {\r\n  'white' : [1,1,1],\r\n  'grey' : [0.5, 0.5, 0.5],\r\n  'gray' : [0.5, 0.5, 0.5],\r\n  'black' : [0, 0, 0],\r\n  'red' : [1, 0, 0],\r\n  'yellow' : [1, 1, 0],\r\n  'green' : [0, 1, 0],\r\n  'teal' : [0, 1, 1],\r\n  'cyan' : [0, 1, 1],\r\n  'blue' : [0, 0, 1],\r\n  'orange' : [1, 0.5, 0.25],\r\n  'brown' : [0.5, 0.4, 0.3],\r\n  'purple' : [1, 0, 1],\r\n  'pink' : [1, 0.5, 0.5]\r\n};\r\n\r\nexport function color2web(color) {\r\n  function tostr(n) {\r\n    n = ~~(n*255);\r\n    let s = n.toString(16);\r\n\r\n    if (s.length > 2) {\r\n      s = s.slice(0, 2);\r\n    }\r\n\r\n    while (s.length < 2) {\r\n      s = \"0\" + s;\r\n    }\r\n\r\n    return s;\r\n  }\r\n\r\n  if (color.length === 3 || color[3] === 1.0) {\r\n    let r = tostr(color[0]);\r\n    let g = tostr(color[1]);\r\n    let b = tostr(color[2]);\r\n\r\n    return \"#\" + r + g + b;\r\n  } else {\r\n    let r = tostr(color[0]);\r\n    let g = tostr(color[1]);\r\n    let b = tostr(color[2]);\r\n    let a = tostr(color[3]);\r\n\r\n    return \"#\" + r + g + b + a;\r\n  }\r\n}\r\n\r\nwindow.color2web = color2web;\r\n\r\nexport function css2color(color) {\r\n  if (!color) {\r\n    return new Vector4([0,0,0,1]);\r\n  }\r\n\r\n  color = (\"\"+color).trim();\r\n\r\n  let ret = css2color_rets.next();\r\n\r\n  if (color[0] === \"#\") {\r\n    color = color.slice(1, color.length);\r\n    let parts = [];\r\n\r\n    for (let i=0; i<color.length>>1; i++) {\r\n      let part = \"0x\" + color.slice(i*2, i*2+2);\r\n      parts.push(parseInt(part));\r\n    }\r\n\r\n    ret.zero();\r\n    let i;\r\n    for (i=0; i<Math.min(parts.length, ret.length); i++) {\r\n      ret[i] = parts[i] / 255.0;\r\n    }\r\n\r\n    if (i < 4) {\r\n      ret[3] = 1.0;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  if (color in basic_colors) {\r\n    ret.load(basic_colors[color]);\r\n    ret[3] = 1.0;\r\n    return ret;\r\n  }\r\n\r\n  color = color.replace(\"rgba\", \"\").replace(\"rgb\", \"\").replace(/[\\(\\)]/g, \"\").trim().split(\",\")\r\n\r\n  for (let i=0; i<color.length; i++) {\r\n    ret[i] = parseFloat(color[i]);\r\n    if (i < 3) {\r\n      ret[i] /= 255;\r\n    }\r\n  }\r\n\r\n  if (color.length === 3) {\r\n    color.push(1.0);\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nwindow.css2color = css2color\r\n\r\nexport function web2color(str) {\r\n  if (typeof str === \"string\" && str.trim()[0] !== \"#\") {\r\n    str = \"#\" + str.trim();\r\n  }\r\n\r\n  return css2color(str);\r\n}\r\nwindow.web2color = web2color;\r\n\r\nlet validate_pat = /\\#?[0-9a-fA-F]{6}([0-9a-fA-F]{2})?$/;\r\n\r\nexport function validateWebColor(str) {\r\n  if (typeof str !== \"string\" && !(str instanceof String))\r\n    return false;\r\n\r\n  return str.trim().search(validate_pat) === 0;\r\n}\r\n\r\nlet num = \"(([0-9]+\\.[0-9]+)|[0-9a-f]+)\";\r\n\r\nlet validate_rgba = new RegExp(`rgba\\\\(${num},${num},${num},${num}\\\\)$`);\r\nlet validate_rgb = new RegExp(`rgb\\\\(${num},${num},${num}\\\\)$`);\r\n\r\nexport function validateCSSColor(color) {\r\n  if (color.toLowerCase() in basic_colors) {\r\n    return true;\r\n  }\r\n\r\n  let rgba = color.toLowerCase().replace(/[ \\t]/g, \"\");\r\n  rgba = rgba.trim();\r\n\r\n  if (validate_rgba.test(rgba) || validate_rgb.exec(rgba)) {\r\n    return true;\r\n  }\r\n\r\n  return validateWebColor(color);\r\n}\r\n\r\nwindow.validateCSSColor = validateCSSColor;\r\n\r\nexport let theme = {};\r\n\r\nexport function invertTheme() {\r\n  cconst.colorSchemeType = cconst.colorSchemeType === ColorSchemeTypes.LIGHT ? ColorSchemeTypes.DARK : ColorSchemeTypes.LIGHT;\r\n\r\n  function inverted(color) {\r\n    if (Array.isArray(color)) {\r\n      for (let i = 0; i < 3; i++) {\r\n        color[i] = 1.0 - color[i];\r\n      }\r\n\r\n      return color;\r\n    }\r\n\r\n    color = css2color(color);\r\n    return color2css(inverted(color));\r\n  }\r\n\r\n  let bg = document.body.style[\"background-color\"];\r\n  //if (!bg) {\r\n  bg = cconst.colorSchemeType === ColorSchemeTypes.LIGHT ? \"rgb(200,200,200)\" : \"rgb(55, 55, 55)\";\r\n  //} else {\r\n  //  bg = inverted(bg);\r\n  //}\r\n\r\n  document.body.style[\"background-color\"] = bg;\r\n\r\n  for (let style in theme) {\r\n    style = theme[style];\r\n\r\n    for (let k in style) {\r\n      let v = style[k];\r\n\r\n      if (v instanceof CSSFont) {\r\n        v.color = inverted(v.color);\r\n      } else if (typeof v === \"string\") {\r\n        v = v.trim().toLowerCase();\r\n\r\n        let iscolor = v.search(\"rgb\") >= 0;\r\n        iscolor = iscolor || v in basic_colors;\r\n        iscolor = iscolor || validateWebColor(v);\r\n\r\n        if (iscolor) {\r\n          style[k] = inverted(v);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nwindow.invertTheme = invertTheme;\r\n\r\nexport function setColorSchemeType(mode) {\r\n  if (!!mode !== cconst.colorSchemeType) {\r\n    invertTheme();\r\n    cconst.colorSchemeType = mode;\r\n  }\r\n\r\n}\r\nwindow.validateWebColor = validateWebColor;\r\n\r\nlet _digest = new util.HashDigest();\r\n\r\nexport class CSSFont {\r\n  constructor(args={}) {\r\n    this._size = args.size ? args.size : 12;\r\n    this.font = args.font;\r\n    this.style = args.style !== undefined ? args.style : \"normal\";\r\n    this.weight = args.weight !== undefined ? args.weight : \"normal\";\r\n    this.variant = args.variant !== undefined ? args.variant : \"normal\";\r\n    this.color = args.color;\r\n  }\r\n\r\n  calcHashUpdate(digest=_digest.reset()) {\r\n    digest.add(this._size || 0);\r\n    digest.add(this.font);\r\n    digest.add(this.style);\r\n    digest.add(this.weight);\r\n    digest.add(this.variant);\r\n    digest.add(this.color);\r\n\r\n    return digest.get();\r\n  }\r\n\r\n  set size(val) {\r\n    this._size = val;\r\n  }\r\n\r\n  get size() {\r\n    if (util.isMobile()) {\r\n      let mul = theme.base.mobileTextSizeMultiplier / visualViewport.scale;\r\n      if (mul) {\r\n        return this._size * mul;;\r\n      }\r\n    }\r\n\r\n    return this._size;\r\n  }\r\n\r\n  copyTo(b) {\r\n    b._size = this._size;\r\n    b.font = this.font;\r\n    b.style = this.style;\r\n    b.color = this.color;\r\n    b.variant = this.variant;\r\n    b.weight = this.weight;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new CSSFont();\r\n    this.copyTo(ret);\r\n    return ret;\r\n  }\r\n\r\n  genCSS(size=this.size) {\r\n    return `${this.style} ${this.variant} ${this.weight} ${size}px ${this.font}`;\r\n  }\r\n\r\n  //deprecated, use genKey()\r\n  hash() {\r\n    return this.genKey();\r\n  }\r\n\r\n  genKey() {\r\n    let color = this.color;\r\n\r\n    if (typeof this.color === \"object\" || typeof this.color === \"function\") {\r\n      color = JSON.stringify(color);\r\n    }\r\n\r\n    return this.genCSS() + \":\" + this.size + \":\" + color;\r\n  }\r\n}\r\nCSSFont.STRUCT = `\r\nCSSFont {\r\n  size     : float | obj._size;\r\n  font     : string | obj.font || \"\";\r\n  style    : string | obj.font || \"\";\r\n  color    : string | \"\"+obj.color;\r\n  variant  : string | obj.variant || \"\";\r\n  weight   : string | \"\"+obj.weight;\r\n}\r\n`;\r\nnstructjs.register(CSSFont);\r\n\r\nexport function exportTheme(theme1=theme, addVarDecl=true) {\r\n  let sortkeys = (obj) => {\r\n    let keys = [];\r\n    for (let k in obj) {\r\n      keys.push(k);\r\n    }\r\n    keys.sort();\r\n\r\n    return keys;\r\n  }\r\n\r\n  let s = addVarDecl ? \"var theme = {\\n\" : \"{\\n\";\r\n\r\n  function writekey(v, indent=\"\") {\r\n    if (typeof v === \"string\") {\r\n      if (v.search(\"\\n\") >= 0) {\r\n        v = \"`\" + v + \"`\";\r\n      } else {\r\n        v = \"'\" + v + \"'\";\r\n      }\r\n\r\n      return v;\r\n    } else if (typeof v === \"object\") {\r\n      if (v instanceof CSSFont) {\r\n        return `new CSSFont({\r\n${indent}  font    : ${writekey(v.font)},\r\n${indent}  weight  : ${writekey(v.weight)},\r\n${indent}  variant : ${writekey(v.variant)},\r\n${indent}  style   : ${writekey(v.style)},\r\n${indent}  size    : ${writekey(v._size)},\r\n${indent}  color   : ${writekey(v.color)}\r\n${indent}})`;\r\n      } else {\r\n        let s = \"{\\n\";\r\n\r\n        for (let k of sortkeys(v)) {\r\n          let v2 = v[k];\r\n\r\n          if (k.search(\" \") >= 0 || k.search(\"-\") >= 0) {\r\n            k = \"'\" + k + \"'\";\r\n          }\r\n\r\n          s += indent + \"  \" + k + \" : \" + writekey(v2, indent + \"  \") + \",\\n\";\r\n        }\r\n\r\n        s += indent + \"}\";\r\n        return s;\r\n      }\r\n    } else {\r\n      return \"\"+v;\r\n    }\r\n\r\n    return \"error\";\r\n  }\r\n\r\n  for (let k of sortkeys(theme1)) {\r\n    let k2 = k;\r\n\r\n    if (k.search(\"-\") >= 0 || k.search(\" \") >= 0) {\r\n      k2 = \"'\" + k + \"'\";\r\n    }\r\n    s += \"  \" + k2 + \": \";\r\n\r\n    let v = theme1[k];\r\n    if (typeof v !== \"object\" || v instanceof CSSFont) {\r\n      s += writekey(v, \"  \") + \",\\n\";\r\n    } else {\r\n      s += \" {\\n\"\r\n      let s2 = \"\";\r\n\r\n      let maxwid = 0;\r\n\r\n      for (let k2 of sortkeys(v)) {\r\n        if (k2.search(\"-\") >= 0 || k2.search(\" \") >= 0) {\r\n          k2 = \"'\" + k2 + \"'\";\r\n        }\r\n\r\n        maxwid = Math.max(maxwid, k2.length);\r\n      }\r\n\r\n      for (let k2 of sortkeys(v)) {\r\n        let v2 = v[k2];\r\n\r\n        if (k2.search(\"-\") >= 0 || k2.search(\" \") >= 0) {\r\n          k2 = \"'\" + k2 + \"'\";\r\n        }\r\n\r\n        let pad = \"\";\r\n\r\n        for (let i=0; i<maxwid-k2.length; i++) {\r\n          pad += \" \";\r\n        }\r\n\r\n        s2 += \"    \" + k2 + pad + \": \" + writekey(v2, \"    \") + \",\\n\";\r\n      }\r\n\r\n      s += s2;\r\n      s += \"  },\\n\\n\"\r\n    }\r\n  }\r\n  s += \"};\\n\";\r\n\r\n  return s;\r\n}\r\nwindow._exportTheme = exportTheme;\r\n\r\n","import {Vector2, Matrix4, Quat, Vector3, Vector4} from '../path-controller/util/vectormath.js';\r\nimport * as math from '../path-controller/util/math.js'\r\nimport {color2css, css2color, parsepx} from './ui_theme.js';\r\nimport {Curve1D, getCurve} from \"../path-controller/curve/curve1d.js\";\r\nimport * as util from '../path-controller/util/util.js';\r\n\r\nclass Task {\r\n  constructor(taskcb) {\r\n    this.task = taskcb;\r\n    this.start = util.time_ms();\r\n    this.done = false;\r\n  }\r\n}\r\n\r\nexport class AnimManager {\r\n  constructor() {\r\n    this.tasks = [];\r\n    this.timer = undefined;\r\n\r\n    //all animation tasks that last longer then 10 seconds are terminated\r\n    this.timeOut = 10*1000.0;\r\n  }\r\n\r\n  stop() {\r\n    if (this.timer !== undefined) {\r\n      window.clearInterval(this.timer);\r\n      this.timer = undefined;\r\n    }\r\n  }\r\n\r\n  add(task) {\r\n    this.tasks.push(new Task(task));\r\n  }\r\n\r\n  remove(task) {\r\n    for (let t of this.tasks) {\r\n      if (t.task === task) {\r\n        t.dead = true;\r\n        this.tasks.remove(t);\r\n        return;\r\n      }\r\n    }\r\n  }\r\n\r\n  start() {\r\n    this.timer = window.setInterval(() => {\r\n      for (let t of this.tasks) {\r\n        try {\r\n          t.task();\r\n        } catch (error) {\r\n          t.done = true;\r\n          util.print_stack(error);\r\n        }\r\n\r\n        if (util.time_ms() - t.start > this.timeOut) {\r\n          t.dead = true;\r\n        }\r\n      }\r\n\r\n      for (let i=0; i<this.tasks.length; i++) {\r\n        if (this.tasks[i].done) {\r\n          let t = this.tasks[i];\r\n          this.tasks.remove(t);\r\n          i--;\r\n\r\n          try {\r\n            if (t.task.onend) {\r\n              t.task.onend();\r\n            }\r\n          } catch (error) {\r\n            util.print_stack(error);\r\n          }\r\n        }\r\n      }\r\n    }, 1000/40.0);\r\n  }\r\n}\r\n\r\n\r\nexport const manager = new AnimManager();\r\nmanager.start();\r\n\r\nexport class AbstractCommand {\r\n  constructor() {\r\n    this.cbs = [];\r\n    this.end_cbs = [];\r\n  }\r\n\r\n  start(animator, done) {\r\n\r\n  }\r\n\r\n  exec(animator, done) {\r\n\r\n  }\r\n}\r\n\r\nexport class WaitCommand extends AbstractCommand {\r\n  constructor(ms) {\r\n    super();\r\n    this.ms = ms;\r\n  }\r\n\r\n  start(animator, done) {\r\n    this.time = animator.time;\r\n  }\r\n\r\n  exec(animator, done) {\r\n    if (animator.time - this.time > this.ms) {\r\n      done();\r\n    }\r\n  }\r\n}\r\n\r\nexport class GoToCommand extends AbstractCommand {\r\n  constructor(obj, key, value, time, curve=\"ease\") {\r\n    super();\r\n\r\n    this.object = obj;\r\n    this.key = key;\r\n    this.value = value;\r\n    this.ms = time;\r\n\r\n    if (typeof curve === \"string\") {\r\n      this.curve = new (getCurve(curve))();\r\n    } else {\r\n      this.curve = curve;\r\n    }\r\n  }\r\n\r\n  start(animator, done) {\r\n    this.time = animator.time;\r\n\r\n    let value = this.object[this.key];\r\n\r\n    if (Array.isArray(value)) {\r\n      this.startValue = util.list(value);\r\n    } else {\r\n      this.startValue = value;\r\n    }\r\n  }\r\n\r\n  exec(animator, done) {\r\n    let t = animator.time - this.time;\r\n    let ms = this.ms;\r\n\r\n    if (t > ms) {\r\n      done();\r\n      t = ms;\r\n    }\r\n\r\n    t /= ms;\r\n\r\n    t = this.curve.evaluate(t);\r\n\r\n    if (Array.isArray(this.startValue)) {\r\n      let value = this.object[this.key];\r\n\r\n      for (let i=0; i<this.startValue.length; i++) {\r\n        if (value[i] === undefined || this.value[i] === undefined) {\r\n          continue;\r\n        }\r\n\r\n        value[i] = this.startValue[i] + (this.value[i] - this.startValue[i]) * t;\r\n      }\r\n    } else {\r\n      this.object[this.key] = this.startValue + (this.value - this.startValue) * t;\r\n\r\n    }\r\n  }\r\n}\r\n\r\nexport class SetCommand extends AbstractCommand {\r\n  constructor(obj, key, val) {\r\n    super();\r\n\r\n    this.object = obj;\r\n    this.key = key;\r\n    this.value = val;\r\n  }\r\n\r\n  start(animator, done) {\r\n    this.object[key] = val;\r\n    done();\r\n  }\r\n}\r\n\r\nexport class Command {\r\n  constructor(type, args) {\r\n    this.args = args;\r\n    this.cbs = [];\r\n  }\r\n}\r\n\r\nexport class Animator {\r\n  constructor(owner, method = \"update\") {\r\n    this.on_tick = this.on_tick.bind(this);\r\n    this.on_tick.onend = () => {\r\n      if (this.onend) {\r\n        this.onend();\r\n      }\r\n    }\r\n\r\n    this.commands = [];\r\n    this.owner = owner;\r\n    this._done = false;\r\n    this.method = method;\r\n    this.onend = null;\r\n    this.first = true;\r\n\r\n    this.time = 0.0;\r\n    this.last = util.time_ms();\r\n\r\n    this.bind(owner);\r\n  }\r\n\r\n  bind(owner) {\r\n    this._done = false;\r\n    this.owner = owner;\r\n    //this.owner[this.method].after(this.on_tick);\r\n    manager.add(this.on_tick);\r\n  }\r\n\r\n  wait(ms) {\r\n    this.commands.push(new WaitCommand(ms));\r\n    return this;\r\n  }\r\n\r\n  goto(key, val, timeMs, curve = \"ease\") {\r\n    let cmd = new GoToCommand(this.owner, key, val, timeMs, curve);\r\n    this.commands.push(cmd);\r\n    return this;\r\n  }\r\n\r\n  set(key, val, time) {\r\n    let cmd = new SetCommand(this.owner, key, val);\r\n    this.commands.push(cmd);\r\n    return this;\r\n  }\r\n\r\n  while(cb) {\r\n    this.commands[this.commands.length - 1].cbs.push(cb);\r\n    return this;\r\n  }\r\n\r\n  then(cb) {\r\n    this.commands[this.commands.length-1].end_cbs.push(cb);\r\n    return this;\r\n  }\r\n\r\n  end() {\r\n    if (this._done) {\r\n      return;\r\n    }\r\n\r\n    this._done = true;\r\n    manager.remove(this.on_tick);\r\n    //this.owner.update.remove(this.on_tick);\r\n\r\n    if (this.onend) {\r\n      this.onend();\r\n    }\r\n  }\r\n\r\n  on_tick() {\r\n    if (this._done) {\r\n      throw new Error(\"animation wasn't properly cleaned up\");\r\n    }\r\n\r\n    let dt = util.time_ms() - this.last;\r\n    this.time += dt;\r\n    this.last = util.time_ms();\r\n\r\n    if (this.commands.length === 0) {\r\n      this.end();\r\n      return\r\n    }\r\n\r\n    let cmd = this.commands[0];\r\n    let done = false;\r\n\r\n    function donecb() {\r\n      done = true;\r\n    }\r\n\r\n    if (this.first) {\r\n      this.first = false;\r\n      //console.log(cmd, cmd.start)\r\n      cmd.start(this, donecb);\r\n    }\r\n\r\n    try {\r\n      cmd.exec(this, donecb);\r\n    } catch (error) {\r\n      done = true;\r\n      util.print_stack(error);\r\n    }\r\n\r\n    for (let cb of this.commands[0].cbs) {\r\n      try {\r\n        cb();\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n      }\r\n    }\r\n\r\n    if (done) {\r\n      for (let cb of this.commands[0].end_cbs) {\r\n        try {\r\n          cb();\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n        }\r\n      }\r\n      while (this.commands.length > 0) {\r\n        this.commands.shift();\r\n\r\n        done = false;\r\n\r\n        if (this.commands.length > 0) {\r\n          this.commands[0].start(this, donecb);\r\n        }\r\n\r\n        if (!done) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","export class token {\r\n  constructor(type, val, lexpos, lexlen, lineno, lexer, parser) {\r\n    this.type = type;\r\n    this.value = val;\r\n    this.lexpos = lexpos;\r\n    this.lexlen = lexlen;\r\n    this.lineno = lineno;\r\n    this.lexer = lexer;\r\n    this.parser = parser;\r\n  }\r\n\r\n  setValue(val) {\r\n    this.value = val;\r\n    return this;\r\n  }\r\n\r\n  toString() {\r\n    if (this.value !== undefined)\r\n      return \"token(type=\" + this.type + \", value='\" + this.value + \"')\"\r\n    else\r\n      return \"token(type=\" + this.type + \")\"\r\n  }\r\n}\r\n\r\n//func is optional. it takes a function\r\n//with one parameter, token, and either\r\n//a) returns the token, or b) returns\r\n//undefined, in which case the token\r\n//should be ignored by the lexer\r\nexport class tokdef {\r\n  constructor(name, regexpr, func) {\r\n    this.name = name;\r\n    this.re = regexpr\r\n    this.func = func\r\n  }\r\n}\r\n\r\nexport class PUTLParseError extends Error {\r\n}\r\n\r\n//errfunc is optional.  it requires\r\n//a function that takes one param, lexer,\r\n//and returns true if the lexer\r\n//should propegate an error when an error\r\n//has happened\r\nexport class lexer {\r\n  constructor(tokdef, errfunc) {\r\n    this.tokdef = tokdef;\r\n    this.tokens = new Array();\r\n    this.lexpos = 0;\r\n    this.lexdata = \"\";\r\n    this.lineno = 0;\r\n    this.errfunc = errfunc;\r\n    this.tokints = {}\r\n    this.print_tokens = false;\r\n    this.print_debug = false;\r\n\r\n    for (let i = 0; i < tokdef.length; i++) {\r\n      this.tokints[tokdef[i].name] = i;\r\n    }\r\n\r\n    this.statestack = [[\"__main__\", 0]];\r\n    this.states = {\"__main__\": [tokdef, errfunc]};\r\n    this.statedata = 0; //public variable\r\n  }\r\n\r\n  copy() {\r\n    let ret = new lexer(this.tokdef, this.errfunc);\r\n\r\n    for (let k in this.states) {\r\n      let state = this.states[k];\r\n\r\n      state = [state[0], state[1]];\r\n      ret.states[k] = state;\r\n    }\r\n\r\n    ret.statedata = this.statedata;\r\n\r\n    return ret;\r\n  }\r\n\r\n//errfunc is optional, defines state-specific error function\r\n  add_state(name, tokdef, errfunc) {\r\n    if (errfunc === undefined) {\r\n      errfunc = function (lexer) {\r\n        return true;\r\n      };\r\n    }\r\n\r\n    this.states[name] = [tokdef, errfunc];\r\n  }\r\n\r\n  tok_int(name) {\r\n\r\n  }\r\n\r\n  //statedata is optional.\r\n  //it stores state-specific data in lexer.statedata.\r\n  push_state(state, statedata) {\r\n    this.statestack.push([state, statedata])\r\n\r\n    state = this.states[state];\r\n    this.statedata = statedata;\r\n\r\n    this.tokdef = state[0];\r\n    this.errfunc = state[1];\r\n  }\r\n\r\n  pop_state() {\r\n    let item = this.statestack[this.statestack.length - 1];\r\n    let state = this.states[item[0]];\r\n\r\n    this.tokdef = state[0];\r\n    this.errfunc = state[1];\r\n    this.statedata = item[1];\r\n  }\r\n\r\n  input(str) {\r\n    //go back to main state\r\n    while (this.statestack.length > 1) {\r\n      this.pop_state();\r\n    }\r\n\r\n    this.lexdata = str;\r\n    this.lexpos = 0;\r\n    this.lineno = 0;\r\n    this.tokens = new Array();\r\n\r\n    this.peeked_tokens = [];\r\n  }\r\n\r\n  error() {\r\n    if (this.errfunc !== undefined && !this.errfunc(this))\r\n      return;\r\n\r\n    console.log(\"Syntax error near line \" + this.lineno);\r\n    let next = Math.min(this.lexpos + 8, this.lexdata.length);\r\n    console.log(\"  \" + this.lexdata.slice(this.lexpos, next));\r\n\r\n    throw new PUTLParseError(\"Parse error\");\r\n  }\r\n\r\n  peek() {\r\n    let tok = this.next(true);\r\n\r\n    if (tok === undefined)\r\n      return undefined;\r\n\r\n    this.peeked_tokens.push(tok);\r\n    return tok;\r\n  }\r\n\r\n\r\n  peek_i(i) {\r\n    while (this.peeked_tokens.length <= i) {\r\n      let t = this.peek();\r\n      if (t === undefined)\r\n        return undefined;\r\n    }\r\n\r\n    return this.peeked_tokens[i];\r\n  }\r\n\r\n  at_end() {\r\n    return this.lexpos >= this.lexdata.length && this.peeked_tokens.length === 0;\r\n  }\r\n\r\n  next(ignore_peek) {\r\n    if (ignore_peek !== true && this.peeked_tokens.length > 0) {\r\n      let tok = this.peeked_tokens[0];\r\n\r\n      if (this.print_debug) {\r\n        console.log(\"PEEK_SHIFTING\", \"\" + tok);\r\n      }\r\n\r\n      this.peeked_tokens.shift();\r\n\r\n      if (this.print_tokens) {\r\n        console.log(tok.toString());\r\n      }\r\n\r\n      return tok;\r\n    }\r\n\r\n    if (this.lexpos >= this.lexdata.length)\r\n      return undefined;\r\n\r\n    let ts = this.tokdef;\r\n    let tlen = ts.length;\r\n\r\n    let lexdata = this.lexdata.slice(this.lexpos, this.lexdata.length);\r\n\r\n    let results = []\r\n\r\n    for (let i = 0; i < tlen; i++) {\r\n      let t = ts[i];\r\n\r\n      if (t.re === undefined)\r\n        continue;\r\n\r\n      let res = t.re.exec(lexdata);\r\n\r\n      if (res !== null && res !== undefined && res.index === 0) {\r\n        results.push([t, res]);\r\n      }\r\n    }\r\n\r\n    let max_res = 0;\r\n    let theres = undefined;\r\n    for (let i = 0; i < results.length; i++) {\r\n      let res = results[i];\r\n\r\n      if (res[1][0].length > max_res) {\r\n        theres = res;\r\n        max_res = res[1][0].length;\r\n      }\r\n    }\r\n\r\n    if (theres === undefined) {\r\n      this.error();\r\n      return;\r\n    }\r\n\r\n    let def = theres[0];\r\n\r\n    let lexlen = max_res;\r\n    let tok = new token(def.name, theres[1][0], this.lexpos, lexlen, this.lineno, this, undefined);\r\n    this.lexpos += max_res;\r\n\r\n    if (def.func) {\r\n      tok = def.func(tok)\r\n\r\n      if (tok === undefined) {\r\n        return this.next(ignore_peek);\r\n      }\r\n    }\r\n\r\n    if (this.print_tokens) {\r\n      console.log(tok.toString());\r\n    }\r\n\r\n    if (!ignore_peek && this.print_debug) {\r\n      console.log(\"CONSUME\", tok.toString(), \"\\n\" + getTraceBack());\r\n    }\r\n\r\n    return tok;\r\n  }\r\n}\r\n\r\nexport function getTraceBack(limit, start) {\r\n  try {\r\n    throw new Error();\r\n  } catch (error) {\r\n    let stack = error.stack.split(\"\\n\");\r\n    stack = stack.slice(1, stack.length);\r\n\r\n    if (start === undefined) {\r\n      start = 0;\r\n    }\r\n\r\n    for (let i = 0; i < stack.length; i++) {\r\n      let l = stack[i];\r\n\r\n      let j = l.length - 1;\r\n      while (j > 0 && l[j] !== \"/\") {\r\n        j--;\r\n      }\r\n\r\n      let k = j;\r\n      while (k >= 0 && l[k] !== \"(\") {\r\n        k--;\r\n      }\r\n\r\n      let func = l.slice(0, k).trim();\r\n      let file = l.slice(j + 1, l.length - 1);\r\n\r\n      l = `  ${func} (${file})`;\r\n\r\n      if (l.search(/parseutil\\.js/) >= 0) {\r\n        start = Math.max(start, i);\r\n      }\r\n      stack[i] = l;\r\n    }\r\n\r\n    if (limit !== undefined) {\r\n      stack.length = Math.min(stack.length, limit);\r\n    }\r\n\r\n    if (start !== undefined) {\r\n      stack = stack.slice(start, stack.length);\r\n    }\r\n\r\n    stack = stack.join(\"\\n\");\r\n    return stack;\r\n  }\r\n}\r\n\r\nexport class parser {\r\n  constructor(lexer, errfunc) {\r\n    this.lexer = lexer;\r\n    this.errfunc = errfunc;\r\n    this.start = undefined;\r\n    this.userdata = undefined;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new parser(this.lexer.copy(), this.errfunc);\r\n    ret.start = this.start;\r\n\r\n    return ret;\r\n  }\r\n\r\n\r\n  parse(data, err_on_unconsumed) {\r\n    if (err_on_unconsumed === undefined)\r\n      err_on_unconsumed = true;\r\n\r\n    if (data !== undefined)\r\n      this.lexer.input(data);\r\n\r\n    let ret = this.start(this);\r\n\r\n    if (err_on_unconsumed && !this.lexer.at_end() && this.lexer.next() !== undefined) {\r\n      //console.log(this.lexer.lexdata.slice(this.lexer.lexpos-1, this.lexer.lexdata.length));\r\n      this.error(undefined, \"parser did not consume entire input\");\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  input(data) {\r\n    this.lexer.input(data);\r\n  }\r\n\r\n  error(tok, msg) {\r\n    if (msg === undefined)\r\n      msg = \"\"\r\n\r\n    let estr;\r\n\r\n    if (tok === undefined)\r\n      estr = \"Parse error at end of input: \" + msg\r\n    else\r\n      estr = \"Parse error at line \" + (tok.lineno + 1) + \": \" + msg;\r\n\r\n    let buf = \"1| \"\r\n    let ld = this.lexer.lexdata;\r\n    let l = 1;\r\n    for (let i = 0; i < ld.length; i++) {\r\n      let c = ld[i];\r\n      if (c === '\\n') {\r\n        l++;\r\n        buf += \"\\n\" + l + \"| \"\r\n      } else {\r\n        buf += c;\r\n      }\r\n    }\r\n\r\n    console.log(\"------------------\")\r\n    console.log(buf);\r\n    console.log(\"==================\")\r\n    console.log(estr);\r\n\r\n    if (this.errfunc && !this.errfunc(tok)) {\r\n      return;\r\n    }\r\n\r\n    throw new PUTLParseError(estr);\r\n  }\r\n\r\n  peek() {\r\n    let tok = this.lexer.peek();\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n\r\n    return tok;\r\n  }\r\n\r\n  peek_i(i) {\r\n    let tok = this.lexer.peek_i(i);\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n\r\n    return tok;\r\n  }\r\n\r\n  peeknext() {\r\n    return this.peek_i(0);\r\n  }\r\n\r\n  next() {\r\n    let tok = this.lexer.next();\r\n\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n\r\n    return tok;\r\n  }\r\n\r\n  optional(type) {\r\n    let tok = this.peek_i(0);\r\n\r\n    if (tok && tok.type === type) {\r\n      this.next();\r\n\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  at_end() {\r\n    return this.lexer.at_end();\r\n  }\r\n\r\n  expect(type, msg) {\r\n    let tok = this.next();\r\n\r\n    if (msg === undefined)\r\n      msg = type\r\n\r\n    if (tok === undefined || tok.type != type) {\r\n      this.error(tok, \"Expected \" + msg + \", not \" + tok.type);\r\n    }\r\n\r\n    return tok.value;\r\n  }\r\n}\r\n\r\nfunction test_parser() {\r\n  let basic_types = new set([\r\n    \"int\",\r\n    \"float\",\r\n    \"double\",\r\n    \"vec2\",\r\n    \"vec3\",\r\n    \"vec4\",\r\n    \"mat4\",\r\n    \"string\"]);\r\n\r\n  let reserved_tokens = new set([\r\n    \"int\",\r\n    \"float\",\r\n    \"double\",\r\n    \"vec2\",\r\n    \"vec3\",\r\n    \"vec4\",\r\n    \"mat4\",\r\n    \"string\",\r\n    \"static_string\",\r\n    \"array\"]);\r\n\r\n  function tk(name, re, func) {\r\n    return new tokdef(name, re, func);\r\n  }\r\n\r\n  let tokens = [\r\n    tk(\"ID\", /[a-zA-Z]+[a-zA-Z0-9_]*/, function (t) {\r\n      if (reserved_tokens.has(t.value)) {\r\n        t.type = t.value.toUpperCase();\r\n      }\r\n\r\n      return t;\r\n    }),\r\n    tk(\"OPEN\", /\\{/),\r\n    tk(\"CLOSE\", /}/),\r\n    tk(\"COLON\", /:/),\r\n    tk(\"JSCRIPT\", /\\|/, function (t) {\r\n      let js = \"\"\r\n      let lexer = t.lexer;\r\n      while (lexer.lexpos < lexer.lexdata.length) {\r\n        let c = lexer.lexdata[lexer.lexpos];\r\n        if (c === \"\\n\")\r\n          break;\r\n\r\n        js += c;\r\n        lexer.lexpos++;\r\n      }\r\n\r\n      if (js.endsWith(\";\")) {\r\n        js = js.slice(0, js.length - 1);\r\n        lexer.lexpos--;\r\n      }\r\n\r\n      t.value = js;\r\n      return t;\r\n    }),\r\n\r\n    tk(\"LPARAM\", /\\(/),\r\n    tk(\"RPARAM\", /\\)/),\r\n    tk(\"COMMA\", /,/),\r\n    tk(\"NUM\", /[0-9]/),\r\n    tk(\"SEMI\", /;/),\r\n    tk(\"NEWLINE\", /\\n/, function (t) {\r\n      t.lexer.lineno += 1;\r\n    }),\r\n    tk(\"SPACE\", / |\\t/, function (t) {\r\n      //throw out non-newline whitespace tokens\r\n    })\r\n  ];\r\n\r\n  for (let rt in reserved_tokens) {\r\n    tokens.push(tk(rt.toUpperCase()));\r\n  }\r\n\r\n  /*let a =\r\n  Loop {\r\n    eid : int;\r\n    flag : int;\r\n    index : int;\r\n    type : int;\r\n\r\n    co : vec3;\r\n    no : vec3;\r\n    loop : int | eid(loop);\r\n    edges : array(e, int) | e.eid;\r\n\r\n    loops : array(Loop);\r\n  }\r\n  `;\r\n  */\r\n\r\n  function errfunc(lexer) {\r\n    return true; //throw error\r\n  }\r\n\r\n  let lex = new lexer(tokens, errfunc)\r\n  console.log(\"Testing lexical scanner...\")\r\n\r\n  lex.input(a);\r\n\r\n  let tok;\r\n  while (tok = lex.next()) {\r\n    console.log(tok.toString())\r\n  }\r\n\r\n  let parser = new parser(lex);\r\n  parser.input(a);\r\n\r\n  function p_Array(p) {\r\n    p.expect(\"ARRAY\");\r\n    p.expect(\"LPARAM\");\r\n\r\n    let arraytype = p_Type(p);\r\n    let itername = \"\";\r\n\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = arraytype;\r\n      arraytype = p_Type(p);\r\n    }\r\n\r\n\r\n    p.expect(\"RPARAM\");\r\n\r\n    return {type: \"array\", data: {type: arraytype, iname: itername}};\r\n  }\r\n\r\n  function p_Type(p) {\r\n    let tok = p.peek()\r\n\r\n    if (tok.type === \"ID\") {\r\n      p.next();\r\n      return {type: \"struct\", data: \"\\\"\" + tok.value + \"\\\"\"};\r\n    } else if (basic_types.has(tok.type.toLowerCase())) {\r\n      p.next();\r\n      return {type: tok.type.toLowerCase()};\r\n    } else if (tok.type === \"ARRAY\") {\r\n      return p_Array(p);\r\n    } else {\r\n      p.error(tok, \"invalid type \" + tok.type); //(tok.value === \"\" ? tok.type : tok.value));\r\n    }\r\n  }\r\n\r\n  function p_Field(p) {\r\n    let field = {}\r\n\r\n    console.log(\"-----\", p.peek().type);\r\n\r\n    field.name = p.expect(\"ID\", \"struct field name\");\r\n    p.expect(\"COLON\");\r\n\r\n    field.type = p_Type(p);\r\n    field.set = undefined;\r\n    field.get = undefined;\r\n\r\n    let tok = p.peek();\r\n    if (tok.type === \"JSCRIPT\") {\r\n      field.get = tok.value;\r\n      p.next()\r\n    }\r\n\r\n    tok = p.peek();\r\n    if (tok.type === \"JSCRIPT\") {\r\n      field.set = tok.value;\r\n      p.next();\r\n    }\r\n\r\n    p.expect(\"SEMI\");\r\n\r\n    return field;\r\n  }\r\n\r\n  function p_Struct(p) {\r\n    let st = {}\r\n    st.name = p.expect(\"ID\", \"struct name\")\r\n    st.fields = [];\r\n\r\n    p.expect(\"OPEN\");\r\n\r\n    while (1) {\r\n      if (p.at_end()) {\r\n        p.error(undefined);\r\n      } else if (p.optional(\"CLOSE\")) {\r\n        break;\r\n      } else {\r\n        st.fields.push(p_Field(p));\r\n      }\r\n    }\r\n\r\n    return st;\r\n  }\r\n\r\n  let ret = p_Struct(parser);\r\n\r\n  console.log(JSON.stringify(ret));\r\n}\r\n","import {PropFlags, PropTypes} from '../toolsys/toolprop_abstract.js';\r\nimport {Quat, Vector2, Vector3, Vector4} from '../util/vectormath.js';\r\nimport * as toolprop_abstract from '../toolsys/toolprop_abstract.js';\r\nimport * as toolprop from '../toolsys/toolprop.js';\r\nimport {print_stack, cachering} from '../util/util.js';\r\n\r\nexport const DataFlags = {\r\n  READ_ONLY             : 1,\r\n  USE_CUSTOM_GETSET     : 2,\r\n  USE_FULL_UNDO         : 4, //DataPathSetOp in controller_ops.js saves/loads entire file for undo/redo\r\n  USE_CUSTOM_PROP_GETTER: 8,\r\n};\r\n\r\n\r\nexport const DataTypes = {\r\n  STRUCT        : 0,\r\n  DYNAMIC_STRUCT: 1,\r\n  PROP          : 2,\r\n  ARRAY         : 3\r\n};\r\n\r\nlet propCacheRings = {};\r\n\r\nexport function getTempProp(type) {\r\n  if (!(type in propCacheRings)) {\r\n    propCacheRings[type] = cachering.fromConstructor(ToolProperty.getClass(type), 32);\r\n  }\r\n\r\n  return propCacheRings[type].next();\r\n}\r\n\r\nexport class DataPathError extends Error {\r\n};\r\n\r\n\r\nexport function getVecClass(proptype) {\r\n  switch (proptype) {\r\n    case PropTypes.VEC2:\r\n      return Vector2;\r\n    case PropTypes.VEC3:\r\n      return Vector3;\r\n    case PropTypes.VEC4:\r\n      return Vector4;\r\n    case PropTypes.QUAT:\r\n      return Quat;\r\n    default:\r\n      throw new Error(\"bad prop type \" + proptype);\r\n  }\r\n}\r\n\r\nexport function isVecProperty(prop) {\r\n  if (!prop || typeof prop !== \"object\" || prop === null)\r\n    return false;\r\n\r\n  let ok = false;\r\n\r\n  ok = ok || prop instanceof toolprop_abstract.Vec2PropertyIF;\r\n  ok = ok || prop instanceof toolprop_abstract.Vec3PropertyIF;\r\n  ok = ok || prop instanceof toolprop_abstract.Vec4PropertyIF;\r\n  ok = ok || prop instanceof toolprop.Vec2Property;\r\n  ok = ok || prop instanceof toolprop.Vec3Property;\r\n  ok = ok || prop instanceof toolprop.Vec4Property;\r\n\r\n  ok = ok || prop.type === PropTypes.VEC2;\r\n  ok = ok || prop.type === PropTypes.VEC3;\r\n  ok = ok || prop.type === PropTypes.VEC4;\r\n  ok = ok || prop.type === PropTypes.QUAT;\r\n\r\n  return ok;\r\n}\r\n\r\nexport class DataPath {\r\n  constructor(path, apiname, prop, type = DataTypes.PROP) {\r\n    this.type = type;\r\n    this.data = prop;\r\n    this.apiname = apiname;\r\n    this.path = path;\r\n    this.flag = 0;\r\n    this.struct = undefined;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new DataPath();\r\n\r\n    ret.flag = this.flag;\r\n    ret.type = this.type;\r\n    ret.data = this.data;\r\n    ret.apiname = this.apiname;\r\n    ret.path = this.path;\r\n    ret.struct = this.struct;\r\n\r\n    return ret;\r\n  }\r\n\r\n  /** this property should not be treated as something\r\n   *  that should be kept track off in the undo stack*/\r\n  noUndo() {\r\n    this.data.flag |= PropFlags.NO_UNDO;\r\n    return this;\r\n  }\r\n\r\n  setProp(prop) {\r\n    this.data = prop;\r\n  }\r\n\r\n  readOnly() {\r\n    this.flag |= DataFlags.READ_ONLY;\r\n\r\n    if (this.type === DataTypes.PROP) {\r\n      this.data.flag |= PropFlags.READ_ONLY;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  read_only() {\r\n    console.warn(\"DataPath.read_only is deprecated; use readOnly\");\r\n    return this.readOnly();\r\n  }\r\n\r\n  /** used to override tool property settings,\r\n   *  e.g. ranges, units, etc; returns a\r\n   *  base class instance of ToolProperty.\r\n   *\r\n   *  The this context points to the original ToolProperty and contains\r\n   *  a few useful references:\r\n   *\r\n   *  this.dataref - an object instance of this struct type\r\n   *  this.ctx - a context\r\n   *\r\n   *  callback takes one argument, a new (freshly copied of original)\r\n   *  tool property to modify\r\n   *\r\n   * */\r\n  customPropCallback(callback) {\r\n    this.flag |= DataFlags.USE_CUSTOM_PROP_GETTER;\r\n    this.data.flag |= PropFlags.USE_CUSTOM_PROP_GETTER;\r\n    this.propGetter = callback;\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * For the callbacks 'this' points to an internal ToolProperty;\r\n   * Referencing object lives in 'this.dataref'; calling context in 'this.ctx';\r\n   * and the datapath is 'this.datapath'\r\n   **/\r\n  customGetSet(get, set) {\r\n    this.flag |= DataFlags.USE_CUSTOM_GETSET;\r\n\r\n    if (this.type !== DataTypes.DYNAMIC_STRUCT && this.type !== DataTypes.STRUCT) {\r\n      this.data.flag |= PropFlags.USE_CUSTOM_GETSET;\r\n      this.data._getValue = this.data.getValue;\r\n      this.data._setValue = this.data.setValue;\r\n\r\n      if (get)\r\n        this.data.getValue = get;\r\n\r\n      if (set)\r\n        this.data.setValue = set;\r\n    } else {\r\n      this.getSet = {\r\n        get, set\r\n      };\r\n\r\n      this.getSet.dataref = undefined;\r\n      this.getSet.datapath = undefined;\r\n      this.getSet.ctx = undefined;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  customSet(set) {\r\n    this.customGetSet(undefined, set);\r\n    return this;\r\n  }\r\n\r\n  customGet(get) {\r\n    this.customGetSet(get, undefined);\r\n    return this;\r\n  }\r\n\r\n  /**db will be executed with underlying data object\r\n   that contains this path in 'this.dataref'\r\n\r\n   main event is 'change'\r\n   */\r\n  on(type, cb) {\r\n    if (this.type == DataTypes.PROP) {\r\n      this.data.on(type, cb);\r\n    } else {\r\n      throw new Error(\"invalid call to DataPath.on\");\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  off(type, cb) {\r\n    if (this.type === DataTypes.PROP) {\r\n      this.data.off(type, cb);\r\n    }\r\n  }\r\n\r\n  simpleSlider() {\r\n    this.data.flag |= PropFlags.SIMPLE_SLIDER;\r\n    this.data.flag &= ~PropFlags.FORCE_ROLLER_SLIDER;\r\n    return this;\r\n  }\r\n\r\n  rollerSlider() {\r\n    this.data.flag &= ~PropFlags.SIMPLE_SLIDER;\r\n    this.data.flag |= PropFlags.FORCE_ROLLER_SLIDER;\r\n\r\n    return this;\r\n  }\r\n\r\n  noUnits() {\r\n    this.baseUnit(\"none\");\r\n    this.displayUnit(\"none\");\r\n    return this;\r\n  }\r\n\r\n  baseUnit(unit) {\r\n    this.data.setBaseUnit(unit);\r\n    return this;\r\n  }\r\n\r\n  displayUnit(unit) {\r\n    this.data.setDisplayUnit(unit);\r\n    return this;\r\n  }\r\n\r\n  unit(unit) {\r\n    return this.baseUnit(unit).displayUnit(unit);\r\n  }\r\n\r\n  editAsBaseUnit() {\r\n    this.data.flag |= PropFlags.EDIT_AS_BASE_UNIT;\r\n    return this;\r\n  }\r\n\r\n  range(min, max) {\r\n    this.data.setRange(min, max);\r\n    return this;\r\n  }\r\n\r\n  uiRange(min, max) {\r\n    this.data.setUIRange(min, max);\r\n    return this;\r\n  }\r\n\r\n  decimalPlaces(n) {\r\n    this.data.setDecimalPlaces(n);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * like other callbacks (until I refactor it),\r\n   * func will be called with a mysterious object that stores\r\n   * the following properties:\r\n   *\r\n   * this.dataref  : owning object reference\r\n   * this.datactx  : ctx\r\n   * this.datapath : datapath\r\n   * */\r\n  uiNameGetter(func) {\r\n    this.ui_name_get = func;\r\n    return this;\r\n  }\r\n\r\n  expRate(exp) {\r\n    this.data.setExpRate(exp);\r\n    return this;\r\n  }\r\n\r\n  slideSpeed(speed) {\r\n    this.data.setSlideSpeed(speed);\r\n    return this;\r\n  }\r\n\r\n  /**adds a slider for moving vector component sliders simultaneously*/\r\n  uniformSlider(state = true) {\r\n    this.data.uniformSlider(state);\r\n\r\n    return this;\r\n  }\r\n\r\n  radix(r) {\r\n    this.data.setRadix(r);\r\n    return this;\r\n  }\r\n\r\n  relativeStep(s) {\r\n    this.data.setRelativeStep(s);\r\n    return this;\r\n  }\r\n\r\n  step(s) {\r\n    this.data.setStep(s);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Tell DataPathSetOp to save/load entire app state for undo/redo\r\n   *\r\n   * */\r\n  fullSaveUndo() {\r\n    this.flag |= DataFlags.USE_FULL_UNDO;\r\n    this.data.flag |= PropFlags.USE_BASE_UNDO;\r\n\r\n    return this;\r\n  }\r\n\r\n  icon(i) {\r\n    this.data.setIcon(i);\r\n    return this;\r\n  }\r\n\r\n  icon2(i) {\r\n    this.data.setIcon2(i);\r\n    return this;\r\n  }\r\n\r\n  icons(icons) { //for enum/flag properties\r\n    this.data.addIcons(icons);\r\n    return this;\r\n  }\r\n\r\n  /** secondary icons (e.g. disabled states) */\r\n  icons2(icons) {\r\n    this.data.addIcons2(icons);\r\n    return this;\r\n  }\r\n\r\n  descriptions(description_map) { //for enum/flag properties\r\n    this.data.addDescriptions(description_map);\r\n    return this;\r\n  }\r\n\r\n  uiNames(uinames) {\r\n    this.data.addUINames(uinames);\r\n    return this;\r\n  }\r\n\r\n  description(d) {\r\n    this.data.description = d;\r\n    return this;\r\n  }\r\n}\r\n\r\nexport const StructFlags = {\r\n  NO_UNDO: 1 //struct and its child structs can't participate in undo\r\n             //via the DataPathToolOp\r\n};\r\n\r\nexport class ListIface {\r\n  getStruct(api, list, key) {\r\n\r\n  }\r\n\r\n  get(api, list, key) {\r\n\r\n  }\r\n\r\n  getKey(api, list, obj) {\r\n\r\n  }\r\n\r\n  getActive(api, list) {\r\n\r\n  }\r\n\r\n  setActive(api, list, val) {\r\n\r\n  }\r\n\r\n  set(api, list, key, val) {\r\n    list[key] = val;\r\n  }\r\n\r\n  getIter() {\r\n\r\n  }\r\n\r\n  filter(api, list, filter) {\r\n\r\n  }\r\n}\r\n\r\nexport class ToolOpIface {\r\n  constructor() {\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"!untitled tool\",\r\n      icon       : -1,\r\n      toolpath   : \"logical_module.tool\", //logical_module need not match up to real module name\r\n      description: undefined,\r\n      is_modal   : false,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n};\r\n\r\n\r\nlet DataAPIClass = undefined;\r\n\r\nexport function setImplementationClass(cls) {\r\n  DataAPIClass = cls;\r\n}\r\n\r\nexport function registerTool(cls) {\r\n  if (DataAPIClass === undefined) {\r\n    throw new Error(\"data api not initialized properly; call setImplementationClass\");\r\n  }\r\n\r\n  return DataAPIClass.registerTool(cls);\r\n}\r\n","\"use strict\";\r\nimport nstructjs from '../util/struct.js';\r\n\r\n/**\r\n\r\n ToolOps are base operators for modifying application state.\r\n They operate on Contexts and can use the datapath API.\r\n They make up the undo stack.\r\n\r\n ToolOp subclasses handle undo with their undoPre (run before tool execution)\r\n and undo methods.  You can set default handlers (most commonly this is just\r\n saving/reloading the app state) with setDefaultUndoHandlers.\r\n\r\n ToolOps have inputs and outputs (which are ToolProperties) and can also\r\n be modal.\r\n\r\n ## Rules\r\n\r\n Tools are never, EVER allowed to store direct pointers to the application state,\r\n with one exception: tools in modal mode may store such pointers, but they must\r\n delete them when existing modal mode by overriding modalEnd.\r\n\r\n This is to prevent very evil and difficult to debug bugs in the undo stack\r\n and nasty memory leaks.\r\n\r\n ## Example\r\n\r\n <pre>\r\n\r\n const ExampleEnum = {\r\n  ITEM1 : 0,\r\n  ITEM2 : 1\r\n}\r\n\r\n class MyTool extends ToolOp {\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Tool Name\",\r\n      toolpath   : \"my.tool\",\r\n      inputs     : {\r\n          input1 : new IntProperty(),\r\n          input2 : new EnumProperty(0, ExampleEnum)\r\n      },\r\n      outputs    : {\r\n          someoutput : new IntProperty\r\n      }\r\n    }\r\n  }\r\n\r\n  undoPre(ctx) {\r\n    //run before tool starts\r\n  }\r\n\r\n  undo(ctx) {\r\n    //undo handler\r\n  }\r\n\r\n  execPre(ctx) {\r\n    //run right before exec\r\n  }\r\n  exec(ctx) {\r\n    //main execution method\r\n  }\r\n  execPost(ctx) {\r\n    //run right after exec\r\n  }\r\n}\r\n ToolOp.register(MyTool);\r\n\r\n </pre>\r\n */\r\n\r\nimport * as events from '../util/events.js';\r\nimport {keymap} from '../util/simple_events.js';\r\nimport {PropFlags, PropTypes} from './toolprop.js';\r\nimport {DataPath} from '../controller/controller_base.js';\r\nimport * as util from '../util/util.js';\r\n\r\nexport let ToolClasses = [];\r\nwindow._ToolClasses = ToolClasses;\r\n\r\nexport function setContextClass(cls) {\r\n  console.warn(\"setContextClass is deprecated\");\r\n}\r\n\r\nexport const ToolFlags = {\r\n  PRIVATE: 1\r\n\r\n};\r\n\r\n\r\nexport const UndoFlags = {\r\n  NO_UNDO      : 2,\r\n  IS_UNDO_ROOT : 4,\r\n  UNDO_BARRIER : 8,\r\n  HAS_UNDO_DATA: 16\r\n};\r\n\r\nclass InheritFlag {\r\n  constructor(slots = {}) {\r\n    this.slots = slots;\r\n  }\r\n}\r\n\r\nlet modalstack = [];\r\n\r\nlet defaultUndoHandlers = {\r\n  undoPre(ctx) {\r\n    throw new Error(\"implement me\");\r\n  },\r\n  undo(ctx) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n}\r\n\r\nexport function setDefaultUndoHandlers(undoPre, undo) {\r\n  if (!undoPre || !undo) {\r\n    throw new Error(\"invalid parameters to setDefaultUndoHandlers\");\r\n  }\r\n\r\n  defaultUndoHandlers.undoPre = undoPre;\r\n  defaultUndoHandlers.undo = undo;\r\n}\r\n\r\nexport class ToolPropertyCache {\r\n  constructor() {\r\n    this.map = new Map();\r\n    this.pathmap = new Map();\r\n    this.accessors = {};\r\n\r\n    this.userSetMap = new Set();\r\n\r\n    this.api = undefined;\r\n    this.dstruct = undefined;\r\n  }\r\n\r\n  static getPropKey(cls, key, prop) {\r\n    return prop.apiname && prop.apiname.length > 0 ? prop.apiname : key;\r\n  }\r\n\r\n  _buildAccessors(cls, key, prop, dstruct, api) {\r\n    let tdef = cls._getFinalToolDef();\r\n\r\n    this.api = api;\r\n    this.dstruct = dstruct;\r\n\r\n    if (!tdef.toolpath) {\r\n      console.warn(\"Bad tool property\", cls, \"it's tooldef was missing a toolpath field\");\r\n      return;\r\n    }\r\n\r\n    let path = tdef.toolpath.trim().split(\".\").filter(f => f.trim().length > 0);\r\n    let obj = this.accessors;\r\n\r\n    let st = dstruct;\r\n    let partial = \"\";\r\n\r\n    for (let i = 0; i < path.length; i++) {\r\n      let k = path[i];\r\n      let pathk = k;\r\n\r\n      if (i === 0) {\r\n        pathk = \"accessors.\" + k;\r\n      }\r\n\r\n      if (i > 0) {\r\n        partial += \".\";\r\n      }\r\n      partial += k;\r\n\r\n      if (!(k in obj)) {\r\n        obj[k] = {};\r\n      }\r\n\r\n      let st2 = api.mapStruct(obj[k], true, k);\r\n      if (!(k in st.pathmap)) {\r\n        st.struct(pathk, k, k, st2);\r\n      }\r\n      st = st2;\r\n\r\n      this.pathmap.set(partial, obj[k]);\r\n\r\n      obj = obj[k];\r\n    }\r\n\r\n    let name = prop.apiname !== undefined && prop.apiname.length > 0 ? prop.apiname : key;\r\n    let prop2 = prop.copy()\r\n\r\n    let dpath = new DataPath(name, name, prop2);\r\n    let uiname = prop.uiname;\r\n\r\n    if (!uiname || uiname.trim().length === 0) {\r\n      uiname = prop.apiname;\r\n    }\r\n    if (!uiname || uiname.trim().length === 0) {\r\n      uiname = key;\r\n    }\r\n\r\n    uiname = ToolProperty.makeUIName(uiname);\r\n\r\n    prop2.uiname = uiname;\r\n    prop2.description = prop2.description || prop2.uiname;\r\n\r\n    st.add(dpath);\r\n\r\n    obj[name] = prop2.getValue();\r\n  }\r\n\r\n  _getAccessor(cls) {\r\n    let toolpath = cls.tooldef().toolpath.trim();\r\n    return this.pathmap.get(toolpath);\r\n  }\r\n\r\n  useDefault(cls, key, prop) {\r\n    key = this.userSetMap.has(cls.tooldef().trim() + \".\" + this.constructor.getPropKey(key));\r\n    key = key.trim();\r\n\r\n    return key;\r\n  }\r\n\r\n  has(cls, key, prop) {\r\n    if (prop.flag & PropFlags.NO_DEFAULT) {\r\n      return false;\r\n    }\r\n\r\n    let obj = this._getAccessor(cls);\r\n\r\n    key = this.constructor.getPropKey(cls, key, prop);\r\n    return obj && key in obj;\r\n  }\r\n\r\n  get(cls, key, prop) {\r\n    if (cls === ToolMacro) {\r\n      return;\r\n    }\r\n\r\n    let obj = this._getAccessor(cls);\r\n    key = this.constructor.getPropKey(cls, key, prop);\r\n\r\n    if (obj) {\r\n      return obj[key];\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  set(cls, key, prop) {\r\n    if (cls === ToolMacro) {\r\n      return;\r\n    }\r\n\r\n    let toolpath = cls.tooldef().toolpath.trim();\r\n    let obj = this._getAccessor(cls);\r\n\r\n    if (!obj) {\r\n      console.warn(\"Warning, toolop \" + cls.name + \" was not in the default map; unregistered?\");\r\n      this._buildAccessors(cls, key, prop, this.dstruct, this.api);\r\n\r\n      obj = this.pathmap.get(toolpath);\r\n    }\r\n\r\n    if (!obj) {\r\n      console.error(\"Malformed toolpath in toolop definition: \" + toolpath);\r\n      return;\r\n    }\r\n\r\n    key = this.constructor.getPropKey(cls, key, prop);\r\n\r\n    //copy prop first in case we're a non-primitive-value type, e.g. vector properties\r\n    obj[key] = prop.copy().getValue();\r\n\r\n    let path = toolpath + \".\" + key;\r\n    this.userSetMap.add(path);\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nexport const SavedToolDefaults = new ToolPropertyCache();\r\n\r\nexport class ToolOp extends events.EventHandler {\r\n  /**\r\n   Main ToolOp constructor.  It reads the inputs/outputs properteis from\r\n   this.constructor.tooldef() and copies them to build this.inputs and this.outputs.\r\n   If inputs or outputs are wrapped in ToolOp.inherit(), it will walk up the class\r\n   chain to fetch parent class properties.\r\n\r\n\r\n   Default input values are loaded from SavedToolDefaults.  If initialized (buildToolSysAPI\r\n   has been called) SavedToolDefaults will have a copy of all the default\r\n   property values of all registered ToolOps.\r\n   **/\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this._overdraw = undefined;\r\n    this.__memsize = undefined;\r\n\r\n    var def = this.constructor.tooldef();\r\n\r\n    if (def.undoflag !== undefined) {\r\n      this.undoflag = def.undoflag;\r\n    }\r\n\r\n    if (def.flag !== undefined) {\r\n      this.flag = def.flag;\r\n    }\r\n\r\n    this._accept = this._reject = undefined;\r\n    this._promise = undefined;\r\n\r\n    for (var k in def) {\r\n      this[k] = def[k];\r\n    }\r\n\r\n    let getSlots = (slots, key) => {\r\n      if (slots === undefined)\r\n        return {};\r\n\r\n      if (!(slots instanceof InheritFlag)) {\r\n        return slots;\r\n      }\r\n\r\n      slots = {};\r\n      let p = this.constructor;\r\n      let lastp = undefined;\r\n\r\n      while (p !== undefined && p !== Object && p !== ToolOp && p !== lastp) {\r\n        if (p.tooldef) {\r\n          let def = p.tooldef();\r\n\r\n          if (def[key] !== undefined) {\r\n            let slots2 = def[key];\r\n            let stop = !(slots2 instanceof InheritFlag);\r\n\r\n            if (slots2 instanceof InheritFlag) {\r\n              slots2 = slots2.slots;\r\n            }\r\n\r\n            for (let k in slots2) {\r\n              if (!(k in slots)) {\r\n                slots[k] = slots2[k];\r\n              }\r\n            }\r\n\r\n            if (stop) {\r\n              break;\r\n            }\r\n          }\r\n        }\r\n\r\n        lastp = p;\r\n        p = p.prototype.__proto__.constructor;\r\n      }\r\n\r\n      return slots;\r\n    };\r\n\r\n    let dinputs = getSlots(def.inputs, \"inputs\");\r\n    let doutputs = getSlots(def.outputs, \"outputs\");\r\n\r\n    this.inputs = {};\r\n    this.outputs = {};\r\n\r\n    if (dinputs) {\r\n      for (let k in dinputs) {\r\n        let prop = dinputs[k].copy();\r\n        prop.apiname = prop.apiname && prop.apiname.length > 0 ? prop.apiname : k;\r\n\r\n        if (!this.hasDefault(prop, k)) {\r\n          this.inputs[k] = prop;\r\n          continue;\r\n        }\r\n\r\n        try {\r\n          prop.setValue(this.getDefault(prop, k));\r\n        } catch (error) {\r\n          console.log(error.stack);\r\n          console.log(error.message);\r\n        }\r\n\r\n        prop.wasSet = false;\r\n        this.inputs[k] = prop;\r\n      }\r\n    }\r\n\r\n    if (doutputs) {\r\n      for (let k in doutputs) {\r\n        let prop = doutputs[k].copy();\r\n        prop.apiname = prop.apiname && prop.apiname.length > 0 ? prop.apiname : k;\r\n\r\n        this.outputs[k] = prop;\r\n      }\r\n    }\r\n\r\n    this.drawlines = [];\r\n  }\r\n\r\n  /**\r\n   ToolOp definition.\r\n\r\n   An example:\r\n   <pre>\r\n   static tooldef() {\r\n    return {\r\n      uiname   : \"Tool Name\",\r\n      toolpath : \"logical_module.tool\", //logical_module need not match up to a real module\r\n      icon     : -1, //tool's icon, or -1 if there is none\r\n      description : \"tooltip\",\r\n      is_modal : false, //tool is interactive and takes control of events\r\n      hotkey   : undefined,\r\n      undoflag : 0, //see UndoFlags\r\n      flag     : 0,\r\n      inputs   : ToolOp.inherit({\r\n        f32val : new Float32Property(1.0),\r\n        path   : new StringProperty(\"./path\");\r\n      }),\r\n      outputs  : {}\r\n      }\r\n    }\r\n   </pre>\r\n   */\r\n  static tooldef() {\r\n    if (this === ToolOp) {\r\n      throw new Error(\"Tools must implemented static tooldef() methods!\");\r\n    }\r\n\r\n    return {};\r\n  }\r\n\r\n  /** Returns a read-only map of input property values,\r\n   *  e.g. `let {prop1, prop2} = this.getValues()` */\r\n  getInputs() {\r\n    let ret = {};\r\n\r\n    for (let k in this.inputs) {\r\n      ret[k] = this.inputs[k].getValue();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  static Equals(a, b) {\r\n    if (!a || !b) return false;\r\n    if (a.constructor !== b.constructor) return false;\r\n\r\n    let bad = false;\r\n\r\n    for (let k in a.inputs) {\r\n      bad = bad || !(k in b.inputs);\r\n      bad = bad || a.inputs[k].constructor !== b.inputs[k];\r\n      bad = bad || !a.inputs[k].equals(b.inputs[k]);\r\n\r\n      if (bad) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return !bad;\r\n  }\r\n\r\n  static inherit(slots = {}) {\r\n    return new InheritFlag(slots);\r\n  }\r\n\r\n  /**\r\n\r\n   Creates a new instance of this toolop from args and a context.\r\n   This is often use to fill properties with default arguments\r\n   stored somewhere in the context.\r\n\r\n   */\r\n  static invoke(ctx, args) {\r\n    let tool = new this();\r\n\r\n    for (let k in args) {\r\n      if (!(k in tool.inputs)) {\r\n        console.warn(\"Unknown tool argument \" + k);\r\n        continue;\r\n      }\r\n\r\n      let prop = tool.inputs[k];\r\n      let val = args[k];\r\n\r\n      if ((typeof val === \"string\") && prop.type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n        if (val in prop.values) {\r\n          val = prop.values[val];\r\n        } else {\r\n          console.warn(\"Possible invalid enum/flag:\", val);\r\n          continue;\r\n        }\r\n      }\r\n\r\n      tool.inputs[k].setValue(val);\r\n    }\r\n\r\n    return tool;\r\n  }\r\n\r\n  static register(cls) {\r\n    if (ToolClasses.indexOf(cls) >= 0) {\r\n      console.warn(\"Tried to register same ToolOp class twice:\", cls.name, cls);\r\n      return;\r\n    }\r\n\r\n    ToolClasses.push(cls);\r\n  }\r\n\r\n  static _regWithNstructjs(cls, structName = cls.name) {\r\n    if (nstructjs.isRegistered(cls)) {\r\n      return;\r\n    }\r\n\r\n    let parent = cls.prototype.__proto__.constructor;\r\n\r\n    if (!cls.hasOwnProperty(\"STRUCT\")) {\r\n      if (parent !== ToolOp && parent !== ToolMacro && parent !== Object) {\r\n        this._regWithNstructjs(parent);\r\n      }\r\n\r\n      cls.STRUCT = nstructjs.inherit(cls, parent) + '}\\n';\r\n    }\r\n\r\n    nstructjs.register(cls);\r\n  }\r\n\r\n  static isRegistered(cls) {\r\n    return ToolClasses.indexOf(cls) >= 0;\r\n  }\r\n\r\n  static unregister(cls) {\r\n    if (ToolClasses.indexOf(cls) >= 0) {\r\n      ToolClasses.remove(cls);\r\n    }\r\n  }\r\n\r\n  static _getFinalToolDef() {\r\n    let def = this.tooldef();\r\n\r\n    let getSlots = (slots, key) => {\r\n      if (slots === undefined)\r\n        return {};\r\n\r\n      if (!(slots instanceof InheritFlag)) {\r\n        return slots;\r\n      }\r\n\r\n      slots = {};\r\n      let p = this\r\n\r\n      while (p !== undefined && p !== Object && p !== ToolOp) {\r\n        if (p.tooldef) {\r\n          let def = p.tooldef();\r\n\r\n          if (def[key] !== undefined) {\r\n            let slots2 = def[key];\r\n            let stop = !(slots2 instanceof InheritFlag);\r\n\r\n            if (slots2 instanceof InheritFlag) {\r\n              slots2 = slots2.slots;\r\n            }\r\n\r\n            for (let k in slots2) {\r\n              if (!(k in slots)) {\r\n                slots[k] = slots2[k];\r\n              }\r\n            }\r\n\r\n            if (stop) {\r\n              break;\r\n            }\r\n          }\r\n\r\n        }\r\n        p = p.prototype.__proto__.constructor;\r\n      }\r\n\r\n      return slots;\r\n    };\r\n\r\n    let dinputs = getSlots(def.inputs, \"inputs\");\r\n    let doutputs = getSlots(def.outputs, \"outputs\");\r\n\r\n    def.inputs = dinputs;\r\n    def.outputs = doutputs;\r\n\r\n    return def;\r\n  }\r\n\r\n  static onTick() {\r\n    for (let toolop of modalstack) {\r\n      toolop.on_tick();\r\n    }\r\n  }\r\n\r\n  static searchBoxOk(ctx) {\r\n    let flag = this.tooldef().flag;\r\n    let ret = !(flag && (flag & ToolFlags.PRIVATE));\r\n    ret = ret && this.canRun(ctx);\r\n\r\n    return ret;\r\n  }\r\n\r\n  //toolop is an optional instance of this class, may be undefined\r\n  static canRun(ctx, toolop = undefined) {\r\n    return true;\r\n  }\r\n\r\n  /** Called when the undo system needs to destroy\r\n   *  this toolop to save memory*/\r\n  onUndoDestroy() {\r\n\r\n  }\r\n\r\n  /** Used by undo system to limit memory */\r\n  calcMemSize(ctx) {\r\n    if (this.__memsize !== undefined) {\r\n      return this.__memsize;\r\n    }\r\n\r\n    let tot = 0;\r\n\r\n    for (let step = 0; step < 2; step++) {\r\n      let props = step ? this.outputs : this.inputs;\r\n\r\n      for (let k in props) {\r\n        let prop = props[k];\r\n\r\n        let size = prop.calcMemSize();\r\n\r\n        if (isNaN(size) || !isFinite(size)) {\r\n          console.warn(\"Got NaN when calculating mem size for property\", prop);\r\n          continue;\r\n        }\r\n\r\n        tot += size;\r\n      }\r\n    }\r\n\r\n    let size = this.calcUndoMem(ctx);\r\n\r\n    if (isNaN(size) || !isFinite(size)) {\r\n      console.warn(\"Got NaN in calcMemSize\", this);\r\n    } else {\r\n      tot += size;\r\n    }\r\n\r\n    this.__memsize = tot;\r\n\r\n    return tot;\r\n  }\r\n\r\n  loadDefaults(force = true) {\r\n    for (let k in this.inputs) {\r\n      let prop = this.inputs[k];\r\n\r\n      if (!force && prop.wasSet) {\r\n        continue;\r\n      }\r\n\r\n      if (this.hasDefault(prop, k)) {\r\n        prop.setValue(this.getDefault(prop, k));\r\n        prop.wasSet = false;\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  hasDefault(toolprop, key = toolprop.apiname) {\r\n    return SavedToolDefaults.has(this.constructor, key, toolprop);\r\n  }\r\n\r\n  getDefault(toolprop, key = toolprop.apiname) {\r\n    let cls = this.constructor;\r\n\r\n    if (SavedToolDefaults.has(cls, key, toolprop)) {\r\n      return SavedToolDefaults.get(cls, key, toolprop);\r\n    } else {\r\n      return toolprop.getValue();\r\n    }\r\n  }\r\n\r\n  saveDefaultInputs() {\r\n    for (let k in this.inputs) {\r\n      let prop = this.inputs[k];\r\n\r\n      if (prop.flag & PropFlags.SAVE_LAST_VALUE) {\r\n        SavedToolDefaults.set(this.constructor, k, prop);\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  genToolString() {\r\n    let def = this.constructor.tooldef();\r\n    let path = def.toolpath + \"(\";\r\n\r\n    for (let k in this.inputs) {\r\n      let prop = this.inputs[k];\r\n\r\n      path += k + \"=\";\r\n      if (prop.type === PropTypes.STRING)\r\n        path += \"'\";\r\n\r\n      if (prop.type === PropTypes.FLOAT) {\r\n        path += prop.getValue().toFixed(3);\r\n      } else {\r\n        path += prop.getValue();\r\n      }\r\n\r\n      if (prop.type === PropTypes.STRING)\r\n        path += \"'\";\r\n      path += \" \";\r\n    }\r\n    path += \")\";\r\n    return path;\r\n  }\r\n\r\n  on_tick() {\r\n\r\n  }\r\n\r\n  /**default on_keydown implementation for modal tools,\r\n   no need to call super() to execute this if you don't want to*/\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case keymap[\"Enter\"]:\r\n      case keymap[\"Space\"]:\r\n        this.modalEnd(false);\r\n        break;\r\n      case keymap[\"Escape\"]:\r\n        this.modalEnd(true);\r\n        break;\r\n    }\r\n  }\r\n\r\n  //called after undoPre\r\n  calcUndoMem(ctx) {\r\n    console.warn(\"ToolOp.prototype.calcUndoMem: implement me!\");\r\n    return 0;\r\n  }\r\n\r\n  undoPre(ctx) {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  undo(ctx) {\r\n    throw new Error(\"implement me!\");\r\n    //_appstate.loadUndoFile(this._undo);\r\n  }\r\n\r\n  redo(ctx) {\r\n    this._was_redo = true; //also set by toolstack.redo\r\n\r\n    this.undoPre(ctx);\r\n    this.execPre(ctx);\r\n    this.exec(ctx);\r\n    this.execPost(ctx);\r\n  }\r\n\r\n  //for compatibility with fairmotion\r\n  exec_pre(ctx) {\r\n    this.execPre(ctx);\r\n  }\r\n\r\n  execPre(ctx) {\r\n  }\r\n\r\n  exec(ctx) {\r\n  }\r\n\r\n  execPost(ctx) {\r\n\r\n  }\r\n\r\n  /**for use in modal mode only*/\r\n  resetTempGeom() {\r\n    var ctx = this.modal_ctx;\r\n\r\n    for (var dl of this.drawlines) {\r\n      dl.remove();\r\n    }\r\n\r\n    this.drawlines.length = 0;\r\n  }\r\n\r\n  error(msg) {\r\n    console.warn(msg);\r\n  }\r\n\r\n  getOverdraw() {\r\n    if (this._overdraw === undefined) {\r\n      this._overdraw = document.createElement(\"overdraw-x\");\r\n      this._overdraw.start(this.modal_ctx.screen);\r\n    }\r\n\r\n    return this._overdraw;\r\n  }\r\n\r\n  /**for use in modal mode only*/\r\n  makeTempLine(v1, v2, style) {\r\n    let line = this.getOverdraw().line(v1, v2, style);\r\n    this.drawlines.push(line);\r\n    return line;\r\n  }\r\n\r\n  pushModal(node) {\r\n    throw new Error(\"cannot call this; use modalStart\")\r\n  }\r\n\r\n  popModal() {\r\n    throw new Error(\"cannot call this; use modalEnd\");\r\n  }\r\n\r\n  /**returns promise to be executed on modalEnd*/\r\n  modalStart(ctx) {\r\n    if (this.modalRunning) {\r\n      console.warn(\"Warning, tool is already in modal mode consuming events\");\r\n      return this._promise;\r\n    }\r\n\r\n    this.modal_ctx = ctx;\r\n    this.modalRunning = true\r\n\r\n    this._promise = new Promise((accept, reject) => {\r\n      this._accept = accept;\r\n      this._reject = reject;\r\n\r\n      modalstack.push(this);\r\n      super.pushModal(ctx.screen);\r\n    });\r\n\r\n    return this._promise;\r\n  }\r\n\r\n  /*eek, I've not been using this.\r\n    guess it's a non-enforced contract, I've been naming\r\n    cancel methods 'cancel' all this time.\r\n\r\n    XXX fix\r\n  */\r\n  toolCancel() {\r\n  }\r\n\r\n  modalEnd(was_cancelled) {\r\n    if (this._modalstate) {\r\n      modalstack.pop();\r\n    }\r\n\r\n    if (this._overdraw !== undefined) {\r\n      this._overdraw.end();\r\n      this._overdraw = undefined;\r\n    }\r\n\r\n    if (was_cancelled && this._on_cancel !== undefined) {\r\n      if (this._accept) {\r\n        this._accept(this.modal_ctx, true);\r\n      }\r\n\r\n      this._on_cancel(this);\r\n      this._on_cancel = undefined;\r\n    }\r\n\r\n    this.resetTempGeom();\r\n\r\n    var ctx = this.modal_ctx;\r\n\r\n    this.modal_ctx = undefined;\r\n    this.modalRunning = false;\r\n    this.is_modal = false;\r\n\r\n    super.popModal();\r\n\r\n    this._promise = undefined;\r\n\r\n    if (this._accept) {\r\n      this._accept(ctx, false);//Context, was_cancelled\r\n      this._accept = this._reject = undefined;\r\n    }\r\n\r\n    this.saveDefaultInputs();\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    let outs = this.outputs;\r\n    let ins = this.inputs;\r\n\r\n    this.inputs = {};\r\n    this.outputs = {};\r\n\r\n    for (let pair of ins) {\r\n      this.inputs[pair.key] = pair.val;\r\n    }\r\n\r\n    for (let pair of outs) {\r\n      this.outputs[pair.key] = pair.val;\r\n    }\r\n  }\r\n\r\n  _save_inputs() {\r\n    let ret = [];\r\n    for (let k in this.inputs) {\r\n      ret.push(new PropKey(k, this.inputs[k]));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  _save_outputs() {\r\n    let ret = [];\r\n    for (let k in this.outputs) {\r\n      ret.push(new PropKey(k, this.outputs[k]));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nToolOp.STRUCT = `\r\ntoolsys.ToolOp {\r\n  inputs  : array(toolsys.PropKey) | this._save_inputs();\r\n  outputs : array(toolsys.PropKey) | this._save_outputs();\r\n}\r\n`;\r\nnstructjs.register(ToolOp);\r\n\r\nclass PropKey {\r\n  constructor(key, val) {\r\n    this.key = key;\r\n    this.val = val;\r\n  }\r\n}\r\n\r\nPropKey.STRUCT = `\r\ntoolsys.PropKey {\r\n  key : string;\r\n  val : abstract(ToolProperty);\r\n}\r\n`;\r\nnstructjs.register(PropKey);\r\n\r\nexport class MacroLink {\r\n  constructor(sourcetool_idx, srckey, srcprops = \"outputs\", desttool_idx, dstkey, dstprops = \"inputs\") {\r\n    this.source = sourcetool_idx;\r\n    this.dest = desttool_idx;\r\n\r\n    this.sourceProps = srcprops;\r\n    this.destProps = dstprops;\r\n\r\n    this.sourcePropKey = srckey;\r\n    this.destPropKey = dstkey;\r\n  }\r\n}\r\n\r\nMacroLink.STRUCT = `\r\ntoolsys.MacroLink {\r\n  source         : int;\r\n  dest           : int;\r\n  sourcePropKey  : string;\r\n  destPropKey    : string;\r\n  sourceProps    : string;\r\n  destProps      : string; \r\n}\r\n`;\r\nnstructjs.register(MacroLink);\r\n\r\nexport const MacroClasses = {};\r\nwindow._MacroClasses = MacroClasses;\r\n\r\nlet macroidgen = 0;\r\n\r\n\r\nexport class ToolMacro extends ToolOp {\r\n  constructor() {\r\n    super();\r\n\r\n    this.tools = [];\r\n    this.curtool = 0;\r\n    this.has_modal = false;\r\n    this.connects = [];\r\n    this.connectLinks = [];\r\n\r\n    this._macro_class = undefined;\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname: \"Tool Macro\"\r\n    }\r\n  }\r\n\r\n  //toolop is an optional instance of this class, may be undefined\r\n  static canRun(ctx, toolop = undefined) {\r\n    return true;\r\n  }\r\n\r\n  _getTypeClass() {\r\n    if (this._macro_class && this._macro_class.ready) {\r\n      return this._macro_class;\r\n    }\r\n\r\n    if (!this._macro_class) {\r\n      this._macro_class = class MacroTypeClass extends ToolOp {\r\n        static tooldef() {\r\n          return this.__tooldef;\r\n        }\r\n      }\r\n\r\n      this._macro_class.__tooldef = {\r\n        toolpath: this.constructor.tooldef().toolpath || ''\r\n      };\r\n      this._macro_class.ready = false;\r\n    }\r\n\r\n    if (!this.tools || this.tools.length === 0) {\r\n      /* We've been invoked by ToolOp constructor,\r\n      *  for now just return an empty class  */\r\n      return this._macro_class;\r\n    }\r\n\r\n    let key = \"\";\r\n    for (let tool of this.tools) {\r\n      key = tool.constructor.name + \":\";\r\n    }\r\n\r\n    /* Handle child classes of ToolMacro */\r\n    if (this.constructor !== ToolMacro) {\r\n      key += \":\" + this.constructor.tooldef().toolpath;\r\n    }\r\n\r\n    for (let k in this.inputs) {\r\n      key += k + \":\";\r\n    }\r\n\r\n    if (key in MacroClasses) {\r\n      this._macro_class = MacroClasses[key];\r\n      return this._macro_class;\r\n    }\r\n\r\n    let name = \"Macro(\"\r\n    let i = 0;\r\n    let is_modal;\r\n\r\n    for (let tool of this.tools) {\r\n      let def = tool.constructor.tooldef();\r\n\r\n      if (i > 0) {\r\n        name += \", \";\r\n      } else {\r\n        is_modal = def.is_modal;\r\n      }\r\n\r\n      if (def.uiname) {\r\n        name += def.uiname;\r\n      } else if (def.toolpath) {\r\n        name += def.toolpath;\r\n      } else {\r\n        name += tool.constructor.name;\r\n      }\r\n\r\n      i++;\r\n    }\r\n\r\n    let inputs = {};\r\n\r\n    for (let k in this.inputs) {\r\n      inputs[k] = this.inputs[k].copy().clearEventCallbacks();\r\n      inputs[k].wasSet = false;\r\n    }\r\n\r\n    let tdef = {\r\n      uiname  : name,\r\n      toolpath: key,\r\n      inputs,\r\n      outputs : {},\r\n      is_modal\r\n    };\r\n\r\n    let cls = this._macro_class;\r\n    cls.__tooldef = tdef;\r\n    cls._macroTypeId = macroidgen++;\r\n    cls.ready = true;\r\n\r\n    /*\r\n    let cls = {\r\n      name : key,\r\n      tooldef() {\r\n        return tdef\r\n      },\r\n      _getFinalToolDef() {\r\n        return this.tooldef();\r\n      }\r\n    };//*/\r\n\r\n    MacroClasses[key] = cls;\r\n\r\n    return cls;\r\n  }\r\n\r\n  saveDefaultInputs() {\r\n    for (let k in this.inputs) {\r\n      let prop = this.inputs[k];\r\n\r\n      if (prop.flag & PropFlags.SAVE_LAST_VALUE) {\r\n        SavedToolDefaults.set(this._getTypeClass(), k, prop);\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  hasDefault(toolprop, key = toolprop.apiname) {\r\n    return SavedToolDefaults.has(this._getTypeClass(), key, toolprop);\r\n  }\r\n\r\n  getDefault(toolprop, key = toolprop.apiname) {\r\n    let cls = this._getTypeClass();\r\n\r\n    if (SavedToolDefaults.has(cls, key, toolprop)) {\r\n      return SavedToolDefaults.get(cls, key, toolprop);\r\n    } else {\r\n      return toolprop.getValue();\r\n    }\r\n  }\r\n\r\n  connect(srctool, srcoutput, dsttool, dstinput, srcprops = \"outputs\", dstprops = \"inputs\") {\r\n    if (typeof dsttool === \"function\") {\r\n      return this.connectCB(...arguments);\r\n    }\r\n\r\n    let i1 = this.tools.indexOf(srctool);\r\n    let i2 = this.tools.indexOf(dsttool);\r\n\r\n    if (i1 < 0 || i2 < 0) {\r\n      throw new Error(\"tool not in macro\");\r\n    }\r\n\r\n    //remove linked properties from this.inputs\r\n    if (srcprops === \"inputs\") {\r\n      let tool = this.tools[i1];\r\n\r\n      let prop = tool.inputs[srcoutput];\r\n      if (prop === this.inputs[srcoutput]) {\r\n        delete this.inputs[srcoutput];\r\n      }\r\n    }\r\n\r\n    if (dstprops === \"inputs\") {\r\n      let tool = this.tools[i2];\r\n      let prop = tool.inputs[dstinput];\r\n\r\n      if (this.inputs[dstinput] === prop) {\r\n        delete this.inputs[dstinput];\r\n      }\r\n    }\r\n\r\n    this.connectLinks.push(new MacroLink(i1, srcoutput, srcprops, i2, dstinput, dstprops));\r\n    return this;\r\n  }\r\n\r\n  connectCB(srctool, dsttool, callback, thisvar) {\r\n    this.connects.push({\r\n      srctool : srctool,\r\n      dsttool : dsttool,\r\n      callback: callback,\r\n      thisvar : thisvar\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  add(tool) {\r\n    if (tool.is_modal) {\r\n      this.is_modal = true;\r\n    }\r\n\r\n    for (let k in tool.inputs) {\r\n      let prop = tool.inputs[k];\r\n\r\n      if (!(prop.flag & PropFlags.PRIVATE)) {\r\n        this.inputs[k] = prop;\r\n      }\r\n    }\r\n\r\n    this.tools.push(tool);\r\n\r\n    return this;\r\n  }\r\n\r\n  _do_connections(tool) {\r\n    let i = this.tools.indexOf(tool);\r\n\r\n    for (let c of this.connectLinks) {\r\n      if (c.source === i) {\r\n        let tool2 = this.tools[c.dest];\r\n\r\n        tool2[c.destProps][c.destPropKey].setValue(tool[c.sourceProps][c.sourcePropKey].getValue());\r\n      }\r\n    }\r\n\r\n    for (var c of this.connects) {\r\n      if (c.srctool === tool) {\r\n        c.callback.call(c.thisvar, c.srctool, c.dsttool);\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n  canRun(ctx) {\r\n    if (this.tools.length == 0)\r\n      return false;\r\n\r\n    //poll first tool only in list\r\n    return this.tools[0].constructor.canRun(ctx);\r\n  }//*/\r\n\r\n  modalStart(ctx) {\r\n    //macros obviously can't call loadDefaults in the constructor\r\n    //like normal tool ops can.\r\n    this.loadDefaults(false);\r\n\r\n    this._promise = new Promise((function (accept, reject) {\r\n      this._accept = accept;\r\n      this._reject = reject;\r\n    }).bind(this));\r\n\r\n    this.curtool = 0;\r\n\r\n    let i;\r\n\r\n    for (i = 0; i < this.tools.length; i++) {\r\n      if (this.tools[i].is_modal)\r\n        break;\r\n\r\n      this.tools[i].undoPre(ctx);\r\n      this.tools[i].execPre(ctx);\r\n      this.tools[i].exec(ctx);\r\n      this.tools[i].execPost(ctx);\r\n      this._do_connections(this.tools[i]);\r\n    }\r\n\r\n    var on_modal_end = (function on_modal_end() {\r\n      this._do_connections(this.tools[this.curtool]);\r\n      this.curtool++;\r\n\r\n      while (this.curtool < this.tools.length &&\r\n      !this.tools[this.curtool].is_modal) {\r\n        this.tools[this.curtool].undoPre(ctx);\r\n        this.tools[this.curtool].execPre(ctx);\r\n        this.tools[this.curtool].exec(ctx);\r\n        this.tools[this.curtool].execPost(ctx);\r\n        this._do_connections(this.tools[this.curtool]);\r\n\r\n        this.curtool++;\r\n      }\r\n\r\n      if (this.curtool < this.tools.length) {\r\n        this.tools[this.curtool].undoPre(ctx);\r\n        this.tools[this.curtool].modalStart(ctx).then(on_modal_end);\r\n      } else {\r\n        this._accept(this, false);\r\n      }\r\n    }).bind(this);\r\n\r\n    if (i < this.tools.length) {\r\n      this.curtool = i;\r\n      this.tools[this.curtool].undoPre(ctx);\r\n      this.tools[this.curtool].modalStart(ctx).then(on_modal_end);\r\n    }\r\n\r\n    return this._promise;\r\n  }\r\n\r\n  loadDefaults(force = true) {\r\n    return super.loadDefaults(force);\r\n  }\r\n\r\n  exec(ctx) {\r\n    //macros obviously can't call loadDefaults in the constructor\r\n    //like normal tool ops can.\r\n    //note that this will detect if the user changes property values\r\n\r\n    this.loadDefaults(false);\r\n\r\n    for (var i = 0; i < this.tools.length; i++) {\r\n      this.tools[i].undoPre(ctx);\r\n      this.tools[i].execPre(ctx);\r\n      this.tools[i].exec(ctx);\r\n      this.tools[i].execPost(ctx);\r\n      this._do_connections(this.tools[i]);\r\n    }\r\n  }\r\n\r\n  calcUndoMem(ctx) {\r\n    let tot = 0;\r\n\r\n    for (let tool of this.tools) {\r\n      tot += tool.calcUndoMem(ctx);\r\n    }\r\n\r\n    return tot;\r\n  }\r\n\r\n  calcMemSize(ctx) {\r\n    let tot = 0;\r\n\r\n    for (let tool of this.tools) {\r\n      tot += tool.calcMemSize(ctx);\r\n    }\r\n\r\n    return tot;\r\n  }\r\n\r\n  undoPre() {\r\n    return; //undoPre is handled in exec() or modalStart()\r\n  }\r\n\r\n  undo(ctx) {\r\n    for (var i = this.tools.length - 1; i >= 0; i--) {\r\n      this.tools[i].undo(ctx);\r\n    }\r\n  }\r\n}\r\n\r\nToolMacro.STRUCT = nstructjs.inherit(ToolMacro, ToolOp, \"toolsys.ToolMacro\") + `\r\n  tools        : array(abstract(toolsys.ToolOp));\r\n  connectLinks : array(toolsys.MacroLink);\r\n}\r\n`;\r\nnstructjs.register(ToolMacro);\r\n\r\nexport class ToolStack extends Array {\r\n  constructor(ctx) {\r\n    super();\r\n\r\n    this.memLimit = 512*1024*1024;\r\n    this.enforceMemLimit = false;\r\n\r\n    this.cur = -1;\r\n    this.ctx = ctx;\r\n\r\n    this.modalRunning = 0;\r\n\r\n    this._undo_branch = undefined; //used to save undo branch in case of tool cancel\r\n  }\r\n\r\n  get head() {\r\n    return this[this.cur];\r\n  }\r\n\r\n  limitMemory(maxmem = this.memLimit, ctx = this.ctx) {\r\n    if (maxmem === undefined) {\r\n      throw new Error(\"maxmem cannot be undefined\");\r\n    }\r\n\r\n    let size = this.calcMemSize();\r\n\r\n    let start = 0;\r\n\r\n    while (start < this.cur - 2 && size > maxmem) {\r\n      size -= this[start].calcMemSize(ctx);\r\n      start++;\r\n    }\r\n\r\n    if (start === 0) {\r\n      return size;\r\n    }\r\n\r\n    for (let i = 0; i < start; i++) {\r\n      this[i].onUndoDestroy();\r\n    }\r\n\r\n    this.cur -= start;\r\n\r\n    for (let i = 0; i < this.length - start; i++) {\r\n      this[i] = this[i + start];\r\n    }\r\n    this.length -= start;\r\n\r\n    return this.calcMemSize(ctx);\r\n  }\r\n\r\n  calcMemSize(ctx = this.ctx) {\r\n    let tot = 0;\r\n\r\n    for (let tool of this) {\r\n      try {\r\n        tot += tool.calcMemSize();\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        console.error(\"Failed to execute a calcMemSize method\");\r\n      }\r\n    }\r\n\r\n    return tot;\r\n  }\r\n\r\n  setRestrictedToolContext(ctx) {\r\n    this.toolctx = ctx;\r\n  }\r\n\r\n  reset(ctx) {\r\n    if (ctx !== undefined) {\r\n      this.ctx = ctx;\r\n    }\r\n\r\n    this.modalRunning = 0;\r\n    this.cur = -1;\r\n    this.length = 0;\r\n  }\r\n\r\n  /**\r\n   * runs .undo,.redo if toolstack head is same as tool\r\n   *\r\n   * otherwise, .execTool(ctx, tool) is called.\r\n   *\r\n   * @param compareInputs : check if toolstack head has identical input values, defaults to false\r\n   * */\r\n  execOrRedo(ctx, tool, compareInputs = false) {\r\n    let head = this.head;\r\n\r\n    let ok = compareInputs ? ToolOp.Equals(head, tool) : head && head.constructor === tool.constructor;\r\n\r\n    tool.__memsize = undefined; //reset cache memsize\r\n\r\n    if (ok) {\r\n      //console.warn(\"Same tool detected\");\r\n\r\n      this.undo();\r\n\r\n      //can inputs differ? in that case, execute new tool\r\n      if (!compareInputs) {\r\n        this.execTool(ctx, tool);\r\n      } else {\r\n        this.rerun();\r\n      }\r\n\r\n      return false;\r\n    } else {\r\n      this.execTool(ctx, tool);\r\n      return true;\r\n    }\r\n  }\r\n\r\n  execTool(ctx, toolop) {\r\n    if (this.enforceMemLimit) {\r\n      this.limitMemory(this.memLimit, ctx);\r\n    }\r\n\r\n    if (!toolop.constructor.canRun(ctx, toolop)) {\r\n      console.log(\"toolop.constructor.canRun returned false\");\r\n      return;\r\n    }\r\n\r\n    let tctx = ctx.toLocked();\r\n\r\n    let undoflag = toolop.constructor.tooldef().undoflag;\r\n    if (toolop.undoflag !== undefined) {\r\n      undoflag = toolop.undoflag;\r\n    }\r\n    undoflag = undoflag === undefined ? 0 : undoflag;\r\n\r\n    //if (!(undoflag & UndoFlags.IS_UNDO_ROOT) && !(undoflag & UndoFlags.NO_UNDO)) {\r\n    //tctx = new SavedContext(ctx, ctx.datalib);\r\n    //}\r\n\r\n    toolop.execCtx = tctx;\r\n\r\n    if (!(undoflag & UndoFlags.NO_UNDO)) {\r\n      this.cur++;\r\n\r\n      //save branch for if tool cancel\r\n      this._undo_branch = this.slice(this.cur + 1, this.length);\r\n\r\n      //truncate\r\n      this.length = this.cur + 1;\r\n\r\n      this[this.cur] = toolop;\r\n      toolop.undoPre(tctx);\r\n    }\r\n\r\n    if (toolop.is_modal) {\r\n      ctx = toolop.modal_ctx = ctx;\r\n\r\n      this.modal_running = true;\r\n\r\n      toolop._on_cancel = (function (toolop) {\r\n        if (!(toolop.undoflag & UndoFlags.NO_UNDO)) {\r\n          this[this.cur].undo(ctx);\r\n          this.pop_i(this.cur);\r\n          this.cur--;\r\n        }\r\n      }).bind(this);\r\n\r\n      //will handle calling .exec itself\r\n      toolop.modalStart(ctx);\r\n    } else {\r\n      toolop.execPre(tctx);\r\n      toolop.exec(tctx);\r\n      toolop.execPost(tctx);\r\n      toolop.saveDefaultInputs();\r\n    }\r\n  }\r\n\r\n  toolCancel(ctx, tool) {\r\n    if (tool._was_redo) { //also set by toolstack.redo\r\n      //ignore tool cancel requests on redo\r\n      return;\r\n    }\r\n\r\n    if (tool !== this[this.cur]) {\r\n      console.warn(\"toolCancel called in error\", this, tool);\r\n      return;\r\n    }\r\n\r\n    this.undo();\r\n    this.length = this.cur + 1;\r\n\r\n    if (this._undo_branch !== undefined) {\r\n      for (let item of this._undo_branch) {\r\n        this.push(item);\r\n      }\r\n    }\r\n  }\r\n\r\n  undo() {\r\n    if (this.enforceMemLimit) {\r\n      this.limitMemory(this.memLimit);\r\n    }\r\n\r\n    if (this.cur >= 0 && !(this[this.cur].undoflag & UndoFlags.IS_UNDO_ROOT)) {\r\n      let tool = this[this.cur];\r\n\r\n      tool.undo(tool.execCtx);\r\n\r\n      this.cur--;\r\n    }\r\n  }\r\n\r\n  //reruns a tool if it's at the head of the stack\r\n  rerun(tool) {\r\n    if (this.enforceMemLimit) {\r\n      this.limitMemory(this.memLimit);\r\n    }\r\n\r\n    if (tool === this[this.cur]) {\r\n      tool._was_redo = false;\r\n\r\n      if (!tool.execCtx) {\r\n        tool.execCtx = this.ctx;\r\n      }\r\n\r\n      tool.undo(tool.execCtx);\r\n\r\n      tool._was_redo = true; //also set by toolstack.redo\r\n\r\n      tool.undoPre(tool.execCtx);\r\n      tool.execPre(tool.execCtx);\r\n      tool.exec(tool.execCtx);\r\n      tool.execPost(tool.execCtx);\r\n    } else {\r\n      console.warn(\"Tool wasn't at head of stack\", tool);\r\n    }\r\n  }\r\n\r\n  redo() {\r\n    if (this.enforceMemLimit) {\r\n      this.limitMemory(this.memLimit);\r\n    }\r\n\r\n    if (this.cur >= -1 && this.cur + 1 < this.length) {\r\n      //console.log(\"redo!\", this.cur, this.length);\r\n\r\n      this.cur++;\r\n      let tool = this[this.cur];\r\n\r\n\r\n      if (!tool.execCtx) {\r\n        tool.execCtx = this.ctx;\r\n      }\r\n\r\n      tool._was_redo = true;\r\n      tool.redo(tool.execCtx);\r\n\r\n      tool.saveDefaultInputs();\r\n    }\r\n  }\r\n\r\n  save() {\r\n    let data = [];\r\n    nstructjs.writeObject(data, this);\r\n    return data;\r\n  }\r\n\r\n  rewind() {\r\n    while (this.cur >= 0) {\r\n      let last = this.cur;\r\n      this.undo();\r\n\r\n      //prevent infinite loops\r\n      if (last === this.cur) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**cb is a function(ctx), if it returns the value false then playback stops\r\n   promise will still be fulfilled.\r\n\r\n   onstep is a callback, if it returns a promise that promise will be\r\n   waited on, otherwise execution is queue with window.setTimeout().\r\n   */\r\n  replay(cb, onStep) {\r\n    let cur = this.cur;\r\n\r\n    this.rewind();\r\n\r\n    let last = this.cur;\r\n\r\n    let start = util.time_ms();\r\n\r\n    return new Promise((accept, reject) => {\r\n      let next = () => {\r\n        last = this.cur;\r\n\r\n        if (cb && cb(ctx) === false) {\r\n          accept();\r\n          return;\r\n        }\r\n\r\n        if (this.cur < this.length) {\r\n          this.cur++;\r\n          this.rerun();\r\n        }\r\n\r\n        if (last === this.cur) {\r\n          console.warn(\"time:\", (util.time_ms() - start)/1000.0);\r\n          accept(this);\r\n        } else {\r\n          if (onStep) {\r\n            let ret = onStep();\r\n\r\n            if (ret && ret instanceof Promise) {\r\n              ret.then(() => {\r\n                next();\r\n              });\r\n            } else {\r\n              window.setTimeout(() => {\r\n                next();\r\n              })\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      next();\r\n    });\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    for (let item of this._stack) {\r\n      this.push(item);\r\n    }\r\n\r\n    delete this._stack;\r\n  }\r\n\r\n  //note that this makes sure tool classes are registered with nstructjs\r\n  //during save\r\n  _save() {\r\n    for (let tool of this) {\r\n      let cls = tool.constructor;\r\n\r\n      if (!nstructjs.isRegistered(cls)) {\r\n        cls._regWithNstructjs(cls);\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nToolStack.STRUCT = `\r\ntoolsys.ToolStack {\r\n  cur    : int;\r\n  _stack : array(abstract(toolsys.ToolOp)) | this._save();\r\n}\r\n`;\r\nnstructjs.register(ToolStack);\r\n\r\nwindow._testToolStackIO = function () {\r\n  let data = [];\r\n  let cls = _appstate.toolstack.constructor;\r\n\r\n  nstructjs.writeObject(data, _appstate.toolstack);\r\n  data = new DataView(new Uint8Array(data).buffer);\r\n\r\n  let toolstack = nstructjs.readObject(data, cls);\r\n\r\n  _appstate.toolstack.rewind();\r\n\r\n  toolstack.cur = -1;\r\n  toolstack.ctx = _appstate.toolstack.ctx;\r\n  _appstate.toolstack = toolstack;\r\n\r\n  return toolstack;\r\n}\r\n\r\nexport function buildToolSysAPI(api, registerWithNStructjs = true, rootCtxStruct = undefined) {\r\n  let datastruct = api.mapStruct(ToolPropertyCache, true);\r\n\r\n  for (let cls of ToolClasses) {\r\n    let def = cls._getFinalToolDef();\r\n\r\n    for (let k in def.inputs) {\r\n      let prop = def.inputs[k];\r\n\r\n      if (!(prop.flag & (PropFlags.PRIVATE | PropFlags.READ_ONLY))) {\r\n        SavedToolDefaults._buildAccessors(cls, k, prop, datastruct, api);\r\n      }\r\n    }\r\n  }\r\n\r\n  if (rootCtxStruct) {\r\n    rootCtxStruct.struct(\"toolDefaults\", \"toolDefaults\", \"Tool Defaults\", api.mapStruct(ToolPropertyCache));\r\n  }\r\n\r\n  if (!registerWithNStructjs) {\r\n    return;\r\n  }\r\n\r\n  //register tools with nstructjs\r\n  for (let cls of ToolClasses) {\r\n    try {\r\n      if (!nstructjs.isRegistered(cls)) {\r\n        ToolOp._regWithNstructjs(cls);\r\n      }\r\n    } catch (error) {\r\n      console.log(error.stack);\r\n      console.error(\"Failed to register a tool with nstructjs\");\r\n    }\r\n  }\r\n}\r\n","import {ToolClasses, ToolOp, ToolFlags, UndoFlags, ToolMacro} from './toolsys.js';\r\nimport {tokdef, lexer, parser, PUTLParseError} from '../util/parseutil.js';\r\nimport {DataPathError} from '../controller/controller_base.js';\r\nimport {cachering} from '../util/util.js';\r\n\r\nexport let ToolPaths = {};\r\n\r\nvar initToolPaths_run = false;\r\n\r\nexport function buildParser() {\r\n  let t = (name, re, func) => new tokdef(name, re, func);\r\n\r\n  let tokens = [\r\n    t('ID', /[a-zA-Z_$]+[a-zA-Z0-9_$]*/, (t) => {\r\n      if (t.value == \"true\" || t.value == \"false\") {\r\n        t.type = \"BOOL\";\r\n        t.value = t.value == \"true\";\r\n      }\r\n\r\n      return t;\r\n    }),\r\n    t('LPAREN', /\\(/),\r\n    t('RPAREN', /\\)/),\r\n    t('LSBRACKET', /\\[/),\r\n    t('RSBRACKET', /\\]/),\r\n    t('DOT', /\\./),\r\n    t('COMMA', /\\,/),\r\n    t('EQUALS', /\\=/),\r\n    t('STRLIT', /\"[^\"]*\"/, (t) => {\r\n      t.value = t.value.slice(1, t.value.length-1);\r\n      return t;\r\n    }),\r\n    t('STRLIT', /'[^']*'/, (t) => {\r\n      t.value = t.value.slice(1, t.value.length-1);\r\n      return t;\r\n    }),\r\n    t('NUMBER', /-?[0-9]+/, (t) => {\r\n      t.value = parseInt(t.value);\r\n      return t;\r\n    }),\r\n    t('NUMBER', /-?[0-9]+\\.[0-9]*/, (t) => {\r\n      t.value = parseFloat(t.value);\r\n      return t;\r\n    }),\r\n    t('WS', /[ \\n\\r\\t]/, (t) => undefined) //ignore whitespace\r\n  ];\r\n\r\n  let lexerror = (t) => {\r\n    console.warn(\"Parse error\");\r\n    return true;\r\n  };\r\n\r\n  let valid_datatypes = {\r\n    \"STRLIT\" : 1, \"NUMBER\" : 1, \"BOOL\" : 1\r\n  };\r\n\r\n  function p_Start(p) {\r\n    let args = {};\r\n\r\n    while (!p.at_end()) {\r\n      let keyword = p.expect(\"ID\");\r\n\r\n      p.expect(\"EQUALS\");\r\n\r\n      let t = p.next();\r\n      if (!(t.type in valid_datatypes)) {\r\n        throw new PUTLParseError(\"parse error: unexpected \" + t.type);\r\n      }\r\n\r\n      args[keyword] = t.value;\r\n    }\r\n\r\n    return args;\r\n  }\r\n\r\n  let lex = new lexer(tokens, lexerror)\r\n  let p = new parser(lex);\r\n  p.start = p_Start;\r\n\r\n  return p;\r\n}\r\n\r\nexport let Parser = buildParser();\r\n/*\r\nlet parse_rets = new cachering(() => return {\r\n  toolclass : undefined,\r\n  args : {}\r\n}, 64);\r\n//*/\r\n\r\nexport function parseToolPath(str, check_tool_exists=true) {\r\n  if (!initToolPaths_run) {\r\n    initToolPaths_run = true;\r\n    initToolPaths();\r\n  }\r\n\r\n  let startstr = str;\r\n\r\n  let i1 = str.search(/\\(/);\r\n  let i2 = str.search(/\\)/);\r\n  let args = \"\";\r\n\r\n  if (i1 >= 0 && i2 >= 0) {\r\n    args = str.slice(i1+1, i2).trim();\r\n    str = str.slice(0, i1).trim();\r\n  }\r\n\r\n  if (!(str in ToolPaths) && check_tool_exists) {\r\n    throw new DataPathError(\"unknown tool \" + str);\r\n  }\r\n\r\n  let ret;\r\n\r\n  try {\r\n    ret = Parser.parse(args);\r\n  } catch (error) {\r\n    console.log(error);\r\n    throw new DataPathError(`\"${startstr}\"\\n  ${error.message}`);\r\n  }\r\n\r\n  return {\r\n    toolclass : ToolPaths[str],\r\n    args      : ret\r\n  };\r\n}\r\n\r\nexport function testToolParser() {\r\n  let ret = parseToolPath(\"view3d.sometool(selectmode=1 str='str' bool=true)\", false);\r\n\r\n  return ret;\r\n}\r\n\r\nwindow.parseToolPath = parseToolPath;\r\n//window._ToolPaths = ToolPaths;\r\n\r\n//tool path parser for simple_toolsys.js\r\nexport function initToolPaths() {\r\n  for (let cls of ToolClasses) {\r\n    if (!cls.hasOwnProperty(\"tooldef\")) { //ignore abstract classes\r\n      continue;\r\n    }\r\n\r\n    let def = cls.tooldef();\r\n    let path = def.toolpath;\r\n\r\n    ToolPaths[path] = cls;\r\n  }\r\n}","import {ToolOp} from '../toolsys/toolsys.js';\r\nimport {print_stack} from '../util/util.js';\r\nimport {PropFlags, PropTypes} from '../toolsys/toolprop_abstract.js';\r\nimport {ToolProperty} from '../toolsys/toolprop.js';\r\nimport {DataPathError, isVecProperty, ListIface} from './controller_base.js';\r\n\r\nexport class ModelInterface {\r\n  constructor() {\r\n    this.prefix = \"\";\r\n  }\r\n\r\n  getToolDef(path) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  getToolPathHotkey(ctx, path) {\r\n    return undefined;\r\n  }\r\n\r\n  get list() {\r\n    throw new Error(\"implement me\");\r\n    return ListIface;\r\n  }\r\n\r\n  createTool(path, inputs={}, constructor_argument=undefined) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  //returns tool class, or undefined if one cannot be found for path\r\n  parseToolPath(path) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  /**\r\n   * runs .undo,.redo if toolstack head is same as tool\r\n   *\r\n   * otherwise, .execTool(ctx, tool) is called.\r\n   *\r\n   * @param compareInputs : check if toolstack head has identical input values, defaults to false\r\n   * */\r\n  execOrRedo(ctx, toolop, compareInputs=false) {\r\n    return ctx.toolstack.execOrRedo(ctx, toolop, compareInputs);\r\n  }\r\n\r\n  execTool(ctx, path, inputs={}, constructor_argument=undefined) {\r\n    return new Promise((accept, reject) => {\r\n      let tool = path;\r\n\r\n      try {\r\n        if (typeof tool == \"string\" || !(tool instanceof ToolOp)) {\r\n          tool = this.createTool(ctx, path, inputs, constructor_argument);\r\n        }\r\n      } catch (error) {\r\n        print_stack(error);\r\n        reject(error);\r\n        return;\r\n      }\r\n\r\n      //give client a chance to change tool instance directly\r\n      accept(tool);\r\n\r\n      //execute\r\n      try {\r\n        ctx.toolstack.execTool(ctx, tool);\r\n      } catch (error) { //for some reason chrome is suppressing errors\r\n        print_stack(error);\r\n        throw error;\r\n      }\r\n    });\r\n  }\r\n\r\n  //used by simple_controller.js for tagging error messages\r\n  pushReportContext(name) {\r\n\r\n  }\r\n\r\n  //used by simple_controller.js for tagging error messages\r\n  popReportContext() {\r\n\r\n  }\r\n\r\n  static toolRegistered(tool) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  static registerTool(tool) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  //not yet supported by path.ux's controller implementation\r\n  massSetProp(ctx, mass_set_path, value) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  /** takes a mass_set_path and returns an array of individual paths */\r\n  resolveMassSetPaths(ctx, mass_set_path) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  /**\r\n   * @example\r\n   *\r\n   * return {\r\n   *   obj      : [object owning property key]\r\n   *   parent   : [parent of obj]\r\n   *   key      : [property key]\r\n   *   subkey   : used by flag properties, represents a key within the property\r\n   *   value    : [value of property]\r\n   *   prop     : [optional toolprop.ToolProperty representing the property definition]\r\n   *   struct   : [optional datastruct representing the type, if value is an object]\r\n   *   mass_set : mass setter string, if controller implementation supports it\r\n   * }\r\n   */\r\n  resolvePath(ctx, path, ignoreExistence, rootStruct) {\r\n  }\r\n\r\n  setValue(ctx, path, val, rootStruct) {\r\n    let res = this.resolvePath(ctx, path, undefined,  rootStruct);\r\n    let prop = res.prop;\r\n\r\n    if (prop !== undefined && (prop.flag & PropFlags.READ_ONLY)) {\r\n      throw new DataPathError(\"Tried to set read only property\");\r\n    }\r\n\r\n    if (prop !== undefined && (prop.flag & PropFlags.USE_CUSTOM_GETSET)) {\r\n      prop.dataref = res.obj;\r\n      prop.ctx = ctx;\r\n      prop.datapath = path;\r\n\r\n      if (res.subkey !== undefined) {\r\n        let val2 = prop.getValue();\r\n        if (typeof val2 === \"object\") {\r\n          val2 = val2.copy();\r\n        }\r\n\r\n        if (prop.type === PropTypes.FLAG) {\r\n          if (val) {\r\n            val2 |= prop.values[res.subkey];\r\n          } else {\r\n            val2 &= ~prop.values[res.subkey];\r\n          }\r\n\r\n          val = val2;\r\n        } else if (prop.type === PropTypes.ENUM) {\r\n          val = prop.values[res.subkey];\r\n        } else {\r\n          val2[res.subkey] = val;\r\n          val = val2;\r\n        }\r\n      }\r\n\r\n      prop.setValue(val);\r\n      return;\r\n    }\r\n\r\n    if (prop !== undefined) {\r\n      if (prop.type === PropTypes.CURVE && !val) {\r\n        throw new DataPathError(\"can't set curve data to nothing\");\r\n      }\r\n\r\n      let use_range = (prop.type & (PropTypes.INT | PropTypes.FLOAT));\r\n\r\n      use_range = use_range || (res.subkey && (prop.type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4)));\r\n      use_range = use_range && prop.range;\r\n      use_range = use_range && !(prop.range[0] === 0.0 && prop.range[1] === 0.0);\r\n      use_range = use_range && typeof val === \"number\";\r\n\r\n      if (use_range) {\r\n        val = Math.min(Math.max(val, prop.range[0]), prop.range[1]);\r\n      }\r\n    }\r\n\r\n    let old = res.obj[res.key];\r\n\r\n    if (res.subkey !== undefined && res.prop !== undefined && res.prop.type === PropTypes.ENUM) {\r\n      let ival = res.prop.values[res.subkey];\r\n\r\n      if (val) {\r\n        res.obj[res.key] = ival;\r\n      }\r\n    } else if (res.prop !== undefined && res.prop.type === PropTypes.FLAG) {\r\n      if (res.subkey !== undefined) {\r\n        let ival = res.prop.values[res.subkey];\r\n\r\n        if (val) {\r\n          res.obj[res.key] |= ival;\r\n        } else {\r\n          res.obj[res.key] &= ~ival;\r\n        }\r\n      } else if (typeof val === \"number\" || typeof val === \"boolean\") {\r\n        val = typeof val === \"boolean\" ? (val & 1) : val;\r\n\r\n        res.obj[res.key] = val;\r\n      } else {\r\n        throw new DataPathError(\"Expected a number for a bitmask property\");\r\n      }\r\n    } else if (res.subkey !== undefined && isVecProperty(res.prop)) {\r\n      if (res.key !== \"\") {\r\n        res.obj[res.key][res.subkey] = val;\r\n      } else {\r\n        res.obj[res.subkey] = val;\r\n      }\r\n    } else if (res.key === \"\" && isVecProperty(res.prop)) {\r\n      for (let i=0; i<res.obj.length; i++) {\r\n        res.obj[i] = val[i];\r\n      }\r\n    } else if (!(prop !== undefined && prop instanceof ListIface)) {\r\n      res.obj[res.key] = val;\r\n    }\r\n\r\n    if (prop !== undefined && prop instanceof ListIface) {\r\n      prop.set(this, res.obj, res.key, val);\r\n    } else if (prop !== undefined) {\r\n      prop.dataref = res.obj;\r\n      prop.datapath = path;\r\n      prop.ctx = ctx;\r\n\r\n      prop._fire(\"change\", res.obj[res.key], old);\r\n    }\r\n  }\r\n\r\n  getDescription(ctx, path) {\r\n    let rdef = this.resolvePath(ctx, path);\r\n    if (rdef === undefined) {\r\n      throw new DataPathError(\"invalid path \" + path);\r\n    }\r\n\r\n    if (!rdef.prop || !(rdef.prop instanceof ToolProperty)) {\r\n      return \"\";\r\n    }\r\n\r\n    let type = rdef.prop.type;\r\n    let prop = rdef.prop;\r\n\r\n    if (rdef.subkey !== undefined) {\r\n      let subkey = rdef.subkey;\r\n\r\n      if (type & (PropTypes.VEC2|PropTypes.VEC3|PropTypes.VEC4)) {\r\n        if (prop.descriptions && subkey in prop.descriptions) {\r\n          return prop.descriptions[subkey];\r\n        }\r\n      } else if (type & (PropTypes.ENUM|PropTypes.FLAG)) {\r\n        if (!(subkey in prop.values) && subkey in prop.keys) {\r\n          subkey = prop.keys[subkey]\r\n        };\r\n\r\n        if (prop.descriptions && subkey in prop.descriptions) {\r\n          return prop.descriptions[subkey];\r\n        }\r\n      } else if (type === PropTypes.PROPLIST) {\r\n        let val = tdef.value;\r\n        if (typeof val === \"object\" && val instanceof ToolProperty) {\r\n          return val.description;\r\n        }\r\n      }\r\n    }\r\n\r\n    return rdef.prop.description ? rdef.prop.description : rdef.prop.uiname;\r\n  }\r\n\r\n  validPath(ctx, path, rootStruct) {\r\n    try {\r\n      this.getValue(ctx, path, rootStruct);\r\n      return true;\r\n    } catch (error) {\r\n      if (!(error instanceof DataPathError)) {\r\n        throw error;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  getPropName(ctx, path) {\r\n    let i = path.length-1;\r\n    while (i >= 0 && path[i] !== \".\") {\r\n      i--;\r\n    }\r\n\r\n    path = path.slice(i+1, path.length).trim();\r\n\r\n    if (path.endsWith(\"]\")) {\r\n      i = path.length - 1;\r\n      while (i >= 0 && path[i] !== \"[\") {\r\n        i--;\r\n      }\r\n\r\n      path = path.slice(0, i).trim();\r\n\r\n      return this.getPropName(ctx, path);\r\n    }\r\n\r\n    return path;\r\n  }\r\n\r\n  getValue(ctx, path, rootStruct=undefined) {\r\n    if (typeof ctx == \"string\") {\r\n      throw new Error(\"You forgot to pass context to getValue\");\r\n    }\r\n\r\n    let ret = this.resolvePath(ctx, path, undefined, rootStruct);\r\n\r\n    if (ret === undefined) {\r\n      throw new DataPathError(\"invalid path \" + path);\r\n    }\r\n\r\n    let exec = ret.prop !== undefined && (ret.prop.flag & PropFlags.USE_CUSTOM_GETSET);\r\n\r\n    //resolvePath handles the case of vector properties with custom callbacks for us\r\n    //(and possibly all the other cases too, need to check)\r\n    exec = exec && !(ret.prop !== undefined && (ret.prop.type & (PropTypes.VEC2|PropTypes.VEC3|PropTypes.VEC4|PropTypes.QUAT)));\r\n\r\n    if (exec) {\r\n      ret.prop.dataref = ret.obj;\r\n      ret.prop.datapath = path;\r\n      ret.prop.ctx = ctx;\r\n\r\n      let val = ret.prop.getValue();\r\n\r\n      if (typeof val === \"string\" && (ret.prop.type & (PropTypes.FLAG|PropTypes.ENUM))) {\r\n        val = ret.prop.values[val];\r\n      }\r\n\r\n      if (ret.subkey && ret.prop.type === PropTypes.ENUM) {\r\n        val = val === ret.prop.values[ret.subkey];\r\n      } else if (ret.subkey && ret.prop.type === PropTypes.FLAG) {\r\n        val = val & ret.prop.values[ret.subkey];\r\n      }\r\n\r\n      return val;\r\n\r\n    }\r\n\r\n    return ret.value;\r\n  }\r\n}\r\n","import {ToolOp, ToolFlags} from \"../toolsys/toolsys.js\";\r\nimport {\r\n  PropTypes, PropFlags, BoolProperty, IntProperty, FloatProperty, FlagProperty,\r\n  EnumProperty, StringProperty, Vec3Property, Vec2Property, Vec4Property,\r\n  QuatProperty, Mat4Property\r\n} from \"../toolsys/toolprop.js\";\r\n\r\nimport * as util from '../util/util.js';\r\nimport {isVecProperty, getVecClass} from \"./controller_base.js\";\r\n\r\nexport class DataPathSetOp extends ToolOp {\r\n  constructor() {\r\n    super();\r\n\r\n    this.propType = -1;\r\n    this._undo = undefined;\r\n  }\r\n\r\n  setValue(ctx, val, object) {\r\n    let prop = this.inputs.prop;\r\n    let path = this.inputs.dataPath.getValue();\r\n\r\n    if (prop.type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n      let rdef = ctx.api.resolvePath(ctx, path);\r\n      if (rdef.subkey !== undefined) {\r\n        let subkey = rdef.subkey;\r\n        if (typeof subkey === \"string\") {\r\n          subkey = rdef.prop.values[subkey];\r\n        }\r\n\r\n        this.inputs.flagBit.setValue(subkey);\r\n        this.inputs.useFlagBit.setValue(true);\r\n      }\r\n\r\n      //if (rdef.subkey !== undefined) {\r\n      //  val = rdef.value;\r\n      //val = !!val;\r\n      //}\r\n    }\r\n\r\n    prop.dataref = object;\r\n    prop.ctx = ctx;\r\n    prop.datapath = path;\r\n\r\n    try {\r\n      prop.setValue(val);\r\n      this.hadError = false;\r\n    } catch (error) {\r\n      console.error(\"Error setting datapath\", path);\r\n      this.hadError = true;\r\n    }\r\n  }\r\n\r\n  static create(ctx, datapath, value, id, massSetPath) {\r\n    let rdef = ctx.api.resolvePath(ctx, datapath);\r\n\r\n    if (rdef === undefined || rdef.prop === undefined) {\r\n      console.warn(\"DataPathSetOp failed\", rdef, rdef.prop);\r\n      return;\r\n    }\r\n\r\n    let prop = rdef.prop;\r\n    let tool = new DataPathSetOp();\r\n\r\n    tool.propType = prop.type;\r\n    tool.inputs.destType.setValue(prop.type);\r\n\r\n    if (prop && (prop.flag & PropFlags.USE_BASE_UNDO)) {\r\n      tool.inputs.fullSaveUndo.setValue(true);\r\n    }\r\n\r\n    let mask = PropTypes.FLAG | PropTypes.ENUM;\r\n    mask |= PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4 | PropTypes.QUAT;\r\n\r\n    if (rdef.subkey !== undefined && (prop.type & mask)) {\r\n      if (prop.type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n        let i = datapath.length - 1;\r\n\r\n        //chope off enum selector\r\n        while (i >= 0 && datapath[i] !== '[') {\r\n          i--;\r\n        }\r\n\r\n        if (i >= 0) {\r\n          datapath = datapath.slice(0, i);\r\n        }\r\n\r\n        tool.inputs.prop = new IntProperty();\r\n      } else {\r\n        tool.inputs.prop = new FloatProperty();\r\n      }\r\n\r\n      let subkey = rdef.subkey;\r\n      if (typeof subkey !== \"number\") {\r\n        subkey = rdef.prop.values[subkey];\r\n      }\r\n\r\n      if (prop.type === PropTypes.FLAG) {\r\n        tool.inputs.flagBit.setValue(subkey);\r\n        tool.inputs.useFlagBit.setValue(true);\r\n      }\r\n\r\n      if (prop.type === PropTypes.ENUM) {\r\n        value = subkey;\r\n      } else if (prop.type === PropTypes.FLAG) {\r\n        let value2 = ctx.api.getValue(ctx, datapath);\r\n\r\n        if (typeof value2 !== \"number\") {\r\n          value2 = typeof value2 === \"boolean\" ? (value & 1) : 0;\r\n        }\r\n\r\n        if (value) {\r\n          value2 |= subkey;\r\n        } else {\r\n          value2 &= ~subkey;\r\n        }\r\n\r\n        value = value2;\r\n      }\r\n      //value = rdef.obj[rdef.key];\r\n      //console.log(\"rdef.value\", value);\r\n    } else {\r\n      tool.inputs.prop = prop.copy();\r\n    }\r\n\r\n    tool.inputs.dataPath.setValue(datapath);\r\n\r\n    if (massSetPath) {\r\n      tool.inputs.massSetPath.setValue(massSetPath);\r\n    } else {\r\n      tool.inputs.massSetPath.setValue(\"\");\r\n    }\r\n\r\n    tool.id = id;\r\n\r\n    tool.setValue(ctx, value, rdef.obj);\r\n\r\n    return tool;\r\n  }\r\n\r\n  hash(massSetPath, dataPath, prop, id) {\r\n    massSetPath = massSetPath === undefined ? \"\" : massSetPath;\r\n    massSetPath = massSetPath === null ? \"\" : massSetPath;\r\n\r\n    let ret = \"\" + massSetPath + \":\" + dataPath + \":\" + prop + \":\" + id;\r\n\r\n    return ret;\r\n  }\r\n\r\n  hashThis() {\r\n    return this.hash(this.inputs.massSetPath.getValue(),\r\n      this.inputs.dataPath.getValue(),\r\n      this.propType,\r\n      this.id);\r\n  }\r\n\r\n  undoPre(ctx) {\r\n    if (this.inputs.fullSaveUndo.getValue()) {\r\n      return super.undoPre(ctx);\r\n    }\r\n\r\n    if (this.__ctx)\r\n      ctx = this.__ctx;\r\n\r\n    this._undo = {};\r\n\r\n    let paths = new Set();\r\n\r\n    if (this.inputs.massSetPath.getValue().trim()) {\r\n      let massSetPath = this.inputs.massSetPath.getValue().trim();\r\n\r\n      paths = new Set(ctx.api.resolveMassSetPaths(ctx, massSetPath));\r\n\r\n    }\r\n\r\n    paths.add(this.inputs.dataPath.getValue());\r\n\r\n    for (let path of paths) {\r\n      let val = ctx.api.getValue(ctx, path);\r\n\r\n      if (typeof val === \"object\") {\r\n        val = val.copy();\r\n      }\r\n\r\n      this._undo[path] = val;\r\n    }\r\n\r\n    /*\r\n    for (let path of paths) {\r\n      let rdef = ctx.api.resolvePath(ctx, path);\r\n\r\n      if (rdef === undefined) {\r\n        console.warn(\"Failed to lookup path in DataPathSetOp.undoPre\", path);\r\n        continue;\r\n      }\r\n\r\n      let prop = rdef.prop;\r\n      let value = rdef.value;\r\n\r\n      if (prop.type & (PropTypes.ENUM|PropTypes.FLAG)) {\r\n        this._undo[path] = rdef.obj[rdef.key];\r\n      } else if (isVecProperty(prop)) {\r\n        if (rdef.subkey) {\r\n          this._undo[path] = rdef.value;\r\n        } else {\r\n          let cls = getVecClass(prop.type);\r\n          this._undo[path] = new cls(rdef.value);\r\n        }\r\n      } else {\r\n        let prop2 = prop.copy();\r\n\r\n        prop2.dataref = rdef.obj;\r\n        prop2.datapath = path;\r\n        prop2.ctx = ctx;\r\n\r\n        prop2.setValue(value);\r\n\r\n        this._undo[path] = prop2.getValue();\r\n      }\r\n    }*/\r\n  }\r\n\r\n  undo(ctx) {\r\n    if (this.__ctx)\r\n      ctx = this.__ctx;\r\n\r\n    if (this.inputs.fullSaveUndo.getValue()) {\r\n      return super.undo(ctx);\r\n    }\r\n\r\n    for (let path in this._undo) {\r\n      let rdef = ctx.api.resolvePath(ctx, path);\r\n\r\n      if (rdef.prop !== undefined && (rdef.prop.type & (PropTypes.ENUM | PropTypes.FLAG))) {\r\n        let old = rdef.obj[rdef.key];\r\n\r\n        if (rdef.subkey) {\r\n          let key = rdef.subkey;\r\n\r\n          if (typeof key !== \"number\") {\r\n            key = rdef.prop.values[key];\r\n          }\r\n\r\n          if (rdef.prop.type === PropTypes.FLAG) {\r\n            if (this._undo[path]) {\r\n              rdef.obj[rdef.key] |= key;\r\n            } else {\r\n              rdef.obj[rdef.key] &= ~key;\r\n            }\r\n          } else {\r\n            rdef.obj[rdef.key] = key;\r\n          }\r\n        } else {\r\n          rdef.obj[rdef.key] = this._undo[path];\r\n        }\r\n\r\n        rdef.prop.dataref = rdef.obj;\r\n        rdef.prop.datapath = path;\r\n        rdef.prop.ctx = ctx;\r\n\r\n        rdef.prop._fire(\"change\", rdef.obj[rdef.key], old);\r\n      } else {\r\n        try {\r\n          ctx.api.setValue(ctx, path, this._undo[path]);\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n          console.warn(\"Failed to set property in undo for DataPathSetOp\");\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  exec(ctx) {\r\n    //use saved ctx we got from modal start\r\n    if (this.__ctx) {\r\n      ctx = this.__ctx;\r\n    }\r\n\r\n    let path = this.inputs.dataPath.getValue();\r\n    let massSetPath = this.inputs.massSetPath.getValue().trim();\r\n\r\n    try {\r\n      ctx.api.setValue(ctx, path, this.inputs.prop.getValue());\r\n      this.hadError = false;\r\n    } catch (error) {\r\n      console.log(error.stack);\r\n      console.log(error.message);\r\n      console.log(\"error setting \" + path);\r\n\r\n      this.hadError = true;\r\n    }\r\n\r\n    if (massSetPath) {\r\n      let value = this.inputs.prop.getValue();\r\n      let useFlagBit = this.inputs.useFlagBit.getValue();\r\n\r\n      if (useFlagBit && this.inputs.destType.getValue() === PropTypes.FLAG) {\r\n        let bit = this.inputs.flagBit.getValue();\r\n\r\n        value = !!(value & bit);\r\n      }\r\n      try {\r\n        ctx.api.massSetProp(ctx, massSetPath, value);\r\n      } catch (error) {\r\n        console.log(error.stack);\r\n        console.log(error.message);\r\n        console.log(\"error setting \" + path);\r\n\r\n        this.hadError = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  modalStart(ctx) {\r\n    this.__ctx = ctx.toLocked();\r\n\r\n    //save full, modal ctx\r\n    super.modalStart(this.__ctx);\r\n\r\n    this.exec(this.__ctx);\r\n    this.modalEnd(false);\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname  : \"Property Set\",\r\n      toolpath: \"app.prop_set\",\r\n      icon    : -1,\r\n      flag    : ToolFlags.PRIVATE,\r\n      is_modal: true,\r\n      inputs  : {\r\n        dataPath    : new StringProperty(),\r\n        massSetPath : new StringProperty(),\r\n        fullSaveUndo: new BoolProperty(false),\r\n        flagBit     : new IntProperty(),\r\n        useFlagBit  : new BoolProperty(),\r\n        destType    : new EnumProperty(PropTypes.INT, PropTypes),\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nToolOp.register(DataPathSetOp);\r\n","/**\r\n\r\n This is the main datapath controller module, inspired by Blender's RNA system.\r\n\r\n Datapaths are special bindings for objects; they store types (e.g. float, int, enumeration, string),\r\n as well as lots of UI-specific metadata (like human-readable names, tooltips, icons, numeric ranges, etc).\r\n\r\n Controller bindings are intended to present a more unified and coherent model of the\r\n application model than may actually exists.  This is inspired by Blender's RNA system, which\r\n hides almost all of Blender's core data structure complexity (Blender is written in C) from\r\n users who e.g. write python scripts, extend the UI, use advanced animation features, or anything else\r\n that uses RNA paths.\r\n\r\n ## Contexts\r\n\r\n The datapath system works in tandem with the context module.  Contexts are client-provided classes\r\n that the datapath API and ToolOps use to communicate with the application state.\r\n\r\n ## Example\r\n\r\n <pre>\r\n\r\n function initMyDataAPI() {\r\n  let api = new DataAPI();\r\n\r\n  //map MyContextClass to a struct, true tells mapStruct to auto-create\r\n  //the struct if it doesn't already exist\r\n  let st = api.mapStruct(MyContextClass, true);\r\n\r\n  //set fields of struct, e.g. st.int, st.float, st.enum, st.struct, etc\r\n\r\n  //build toolsys api\r\n  buildToolSysAPI(api);\r\n\r\n  //create bindings for default tool operator settings\r\n  cstruct.struct(\"propCache\", \"toolDefaults\", \"Tool Defaults\", api.mapStruct(ToolPropertyCache));\r\n\r\n  return api;\r\n}\r\n </pre>\r\n */\r\nimport * as toolprop from '../toolsys/toolprop.js';\r\nimport * as parseutil from '../util/parseutil.js';\r\nimport {print_stack} from '../util/util.js';\r\nimport {ToolOp, UndoFlags, ToolFlags} from \"../toolsys/toolsys.js\";\r\nimport {Vec2Property, Vec3Property, Vec4Property, PropTypes, PropFlags} from '../toolsys/toolprop.js';\r\nimport * as toolprop_abstract from '../toolsys/toolprop_abstract.js';\r\nimport * as util from '../util/util.js';\r\n\r\nimport {DataPath, DataFlags, DataTypes, DataPathError, StructFlags, getTempProp} from './controller_base.js';\r\n\r\nexport * from './controller_base.js';\r\n\r\nlet PUTLParseError = parseutil.PUTLParseError;\r\n\r\nlet tk = (name, re, func) => new parseutil.tokdef(name, re, func);\r\nlet tokens = [\r\n  tk(\"ID\", /[a-zA-Z_$]+[a-zA-Z_$0-9]*/),\r\n  tk(\"NUM\", /-?[0-9]+/, (t) => {\r\n    t.value = parseInt(t.value);\r\n    return t;\r\n  }),\r\n  tk('NUMBER', /-?[0-9]+\\.[0-9]*/, (t) => {\r\n    t.value = parseFloat(t.value);\r\n    return t;\r\n  }),\r\n  tk(\"STRLIT\", /'.*?'/, (t) => {\r\n    t.value = t.value.slice(1, t.value.length - 1);\r\n    return t;\r\n  }),\r\n  tk(\"STRLIT\", /\".*?\"/, (t) => {\r\n    t.value = t.value.slice(1, t.value.length - 1);\r\n    return t;\r\n  }),\r\n  tk(\"DOT\", /\\./),\r\n  tk(\"EQUALS\", /(\\=)|(\\=\\=)/),\r\n  tk(\"LSBRACKET\", /\\[/),\r\n  tk(\"RSBRACKET\", /\\]/),\r\n  tk(\"AND\", /\\&/),\r\n  tk(\"WS\", /[ \\t\\n\\r]+/, (t) => undefined) //drok token\r\n];\r\n\r\nlet lexer = new parseutil.lexer(tokens, (t) => {\r\n  console.warn(\"Parse error\", t);\r\n  throw new DataPathError();\r\n});\r\n\r\nexport let pathParser = new parseutil.parser(lexer);\r\n\r\nlet parserStack = new Array(32);\r\nfor (let i = 0; i < parserStack.length; i++) {\r\n  parserStack[i] = pathParser.copy();\r\n}\r\nparserStack.cur = 0;\r\n\r\nimport {\r\n  setImplementationClass, isVecProperty, ListIface\r\n} from './controller_base.js';\r\nimport {initToolPaths, parseToolPath} from '../toolsys/toolpath.js';\r\nimport {ModelInterface} from './controller_abstract.js';\r\n\r\nexport {DataPathError, DataFlags} from './controller_base.js';\r\n\r\nimport {ToolClasses} from '../toolsys/toolsys.js';\r\nimport {ToolProperty, IntProperty} from \"../toolsys/toolprop.js\";\r\n\r\nlet tool_classes = ToolClasses;\r\n\r\nlet tool_idgen = 1;\r\nSymbol.ToolID = Symbol(\"toolid\");\r\n\r\nfunction toolkey(cls) {\r\n  if (!(Symbol.ToolID in cls)) {\r\n    cls[Symbol.ToolID] = tool_idgen++;\r\n  }\r\n\r\n  return cls[Symbol.ToolID];\r\n}\r\n\r\nlet lt = util.time_ms();\r\nlet lastmsg = undefined;\r\nlet lcount = 0;\r\n\r\nlet reportstack = [\"api\"];\r\n\r\nexport function pushReportName(name) {\r\n  if (reportstack.length > 1024) {\r\n    console.trace(\"eerk, reportstack overflowed\");\r\n    reportstack.length = 0;\r\n    reportstack.push(\"api\");\r\n  }\r\n\r\n  reportstack.push(name);\r\n}\r\n\r\nfunction report(msg) {\r\n  let name = reportstack.length === 0 ? \"api\" : reportstack[reportstack.length - 1];\r\n\r\n  util.console.context(name).warn(msg);\r\n}\r\n\r\nexport function popReportName() {\r\n  reportstack.pop();\r\n}\r\n\r\n\r\nexport class DataList extends ListIface {\r\n  constructor(callbacks) {\r\n    super();\r\n\r\n    if (callbacks === undefined) {\r\n      throw new DataPathError(\"missing callbacks argument to DataList\");\r\n    }\r\n\r\n    this.cb = {};\r\n\r\n    if (typeof callbacks === \"object\" && !Array.isArray(callbacks)) {\r\n      for (let k in callbacks) {\r\n        this.cb[k] = callbacks[k];\r\n      }\r\n    } else {\r\n      for (let cb of callbacks) {\r\n        this.cb[cb.name] = cb;\r\n      }\r\n    }\r\n\r\n    let check = (key) => {\r\n      if (!(key in this.cbs)) {\r\n        throw new DataPathError(`Missing ${key} callback in DataList`);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   Generic list API.\r\n\r\n   * Callbacks is an array of name functions, like so:\r\n   - function getStruct(api, list, key) //return DataStruct type of object in key, key is optional if omitted return base type of all objects?\r\n   - function get(api, list, key)\r\n   - function set(api, list, key, val) //this one has default behavior: list[key] = val\r\n   - function getLength(api, list)\r\n   - function getActive(api, list)\r\n   - function setActive(api, list, key)\r\n   - function getIter(api, list)\r\n   - function getKey(api, list, object) returns object's key in this list, either a string or a number\r\n   * */\r\n\r\n  copy() {\r\n    let ret = new DataList([this.cb.get]);\r\n\r\n    for (let k in this.cb) {\r\n      ret.cb[k] = this.cb[k];\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  get(api, list, key) {\r\n    return this.cb.get(api, list, key);\r\n  }\r\n\r\n  getLength(api, list) {\r\n    this._check(\"getLength\");\r\n    return this.cb.getLength(api, list);\r\n  }\r\n\r\n  _check(cb) {\r\n    if (!(cb in this.cb)) {\r\n      throw new DataPathError(cb + \" not supported by this list\");\r\n    }\r\n  }\r\n\r\n  set(api, list, key, val) {\r\n    if (this.cb.set === undefined) {\r\n      list[key] = val;\r\n    } else {\r\n      this.cb.set(api, list, key, val);\r\n    }\r\n  }\r\n\r\n  getIter(api, list) {\r\n    this._check(\"getIter\");\r\n    return this.cb.getIter(api, list);\r\n  }\r\n\r\n  filter(api, list, bitmask) {\r\n    this._check(\"filter\");\r\n    return this.cb.filter(api, list, bitmask);\r\n  }\r\n\r\n  getActive(api, list) {\r\n    this._check(\"getActive\");\r\n    return this.cb.getActive(api, list);\r\n  }\r\n\r\n  setActive(api, list, key) {\r\n    this._check(\"setActive\");\r\n    this.cb.setActive(api, list, key);\r\n  }\r\n\r\n  getKey(api, list, obj) {\r\n    this._check(\"getKey\");\r\n    return this.cb.getKey(api, list, obj);\r\n  }\r\n\r\n  getStruct(api, list, key) {\r\n    if (this.cb.getStruct !== undefined) {\r\n      return this.cb.getStruct(api, list, key);\r\n    }\r\n\r\n    let obj = this.get(api, list, key);\r\n\r\n    if (obj === undefined)\r\n      return undefined;\r\n\r\n    return api.getStruct(obj.constructor);\r\n  }\r\n}\r\n\r\nexport class DataStruct {\r\n  constructor(members = [], name = \"unnamed\") {\r\n    this.members = [];\r\n    this.name = name;\r\n    this.pathmap = {};\r\n    this.flag = 0;\r\n    this.dpath = undefined; //owning DataPath\r\n\r\n    this.inheritFlag = 0;\r\n\r\n    for (let m of members) {\r\n      this.add(m);\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this.pathmap = {};\r\n    this.members = [];\r\n\r\n    return this;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new DataStruct();\r\n\r\n    ret.name = this.name;\r\n    ret.flag = this.flag;\r\n    ret.inheritFlag = this.inheritFlag;\r\n\r\n    for (let m of this.members) {\r\n      let m2 = m.copy();\r\n\r\n      //don't copy struct or list references, just\r\n      //direct properties\r\n\r\n      if (m2.type === DataTypes.PROP) {\r\n        m2.data = m2.data.copy();\r\n      }\r\n\r\n      ret.add(m2);\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   * Like .struct, but the type of struct is looked up\r\n   * for objects at runtime.  Note that to work correctly each object\r\n   * must create its own struct definition via api.mapStruct\r\n   *\r\n   * @param path\r\n   * @param apiname\r\n   * @param uiname\r\n   * @param default_struct : default struct if one can't be looked up\r\n   * @returns {*}\r\n   */\r\n  dynamicStruct(path, apiname, uiname, default_struct = undefined) {\r\n    let ret = default_struct ? default_struct : new DataStruct();\r\n\r\n    let dpath = new DataPath(path, apiname, ret, DataTypes.DYNAMIC_STRUCT);\r\n    ret.inheritFlag |= this.inheritFlag;\r\n\r\n    ret.dpath = dpath;\r\n\r\n    this.add(dpath);\r\n    return ret;\r\n  }\r\n\r\n  struct(path, apiname, uiname, existing_struct = undefined) {\r\n    let ret = existing_struct ? existing_struct : new DataStruct();\r\n\r\n    let dpath = new DataPath(path, apiname, ret, DataTypes.STRUCT);\r\n    ret.inheritFlag |= this.inheritFlag;\r\n\r\n    ret.dpath = dpath;\r\n\r\n    this.add(dpath);\r\n    return ret;\r\n  }\r\n\r\n  customGet(getter) {\r\n    this.dpath.customGet(getter);\r\n\r\n    return this;\r\n  }\r\n\r\n  customGetSet(getter, setter) {\r\n    this.dpath.customGetSet(getter, setter);\r\n\r\n    return this;\r\n  }\r\n\r\n  color3(path, apiname, uiname, description) {\r\n    let ret = this.vec3(path, apiname, uiname, description);\r\n\r\n    ret.data.subtype = toolprop.PropSubTypes.COLOR;\r\n    ret.range(0, 1);\r\n    ret.simpleSlider();\r\n\r\n    ret.noUnits();\r\n\r\n    return ret;\r\n  }\r\n\r\n  color4(path, apiname, uiname, description = uiname) {\r\n    let ret = this.vec4(path, apiname, uiname, description);\r\n\r\n    ret.data.subtype = toolprop.PropSubTypes.COLOR;\r\n    ret.range(0, 1);\r\n    ret.simpleSlider();\r\n\r\n    ret.noUnits();\r\n\r\n    return ret;\r\n  }\r\n\r\n  arrayList(path, apiname, structdef, uiname, description) {\r\n    let ret = this.list(path, apiname, [\r\n      function getIter(api, list) {\r\n        return list[Symbol.iterator]();\r\n      },\r\n      function getLength(api, list) {\r\n        return list.length;\r\n      },\r\n      function get(api, list, key) {\r\n        return list[key];\r\n      },\r\n      function set(api, list, key, val) {\r\n        if (typeof key === \"string\") {\r\n          key = parseInt(key);\r\n        }\r\n\r\n        if (key < 0 || key >= list.length) {\r\n          throw new DataPathError(\"Invalid index \" + key);\r\n        }\r\n\r\n        list[key] = val;\r\n      },\r\n      function getKey(api, list, obj) {\r\n        return list.indexOf(obj);\r\n      },\r\n      function getStruct(api, list, key) {\r\n        return structdef;\r\n      }]);\r\n\r\n    return ret;\r\n  }\r\n\r\n  color3List(path, apiname, uiname, description) {\r\n    return this.vectorList(3, path, apiname, uiname, description, toolprop.PropSubTypes.COLOR);\r\n  }\r\n\r\n  color4List(path, apiname, uiname, description) {\r\n    return this.vectorList(4, path, apiname, uiname, description, toolprop.PropSubTypes.COLOR);\r\n  }\r\n\r\n  vectorList(size, path, apiname, uiname, description, subtype) {\r\n    let type;\r\n\r\n    switch (size) {\r\n      case 2:\r\n        type = toolprop.Vec2Property;\r\n        break;\r\n      case 3:\r\n        type = toolprop.Vec3Property;\r\n      case 4:\r\n        type = toolprop.Vec4Property;\r\n    }\r\n\r\n    if (type === undefined) {\r\n      throw new DataPathError(\"Invalid size for vectorList; expected 2 3 or 4\");\r\n    }\r\n\r\n    let prop = new type(undefined, apiname, uiname, description);\r\n\r\n    let pstruct = new DataStruct(undefined, \"Vector\");\r\n    pstruct.vec3(\"\", \"co\", \"Coords\", \"Coordinates\");\r\n\r\n    let ret = this.list(path, apiname, [\r\n      function getIter(api, list) {\r\n        return list[Symbol.iterator]();\r\n      },\r\n      function getLength(api, list) {\r\n        return list.length;\r\n      },\r\n      function get(api, list, key) {\r\n        return list[key];\r\n      },\r\n      function set(api, list, key, val) {\r\n        if (typeof key == \"string\") {\r\n          key = parseInt(key);\r\n        }\r\n\r\n        if (key < 0 || key >= list.length) {\r\n          throw new DataPathError(\"Invalid index \" + key);\r\n        }\r\n\r\n        list[key] = val;\r\n      },\r\n      function getKey(api, list, obj) {\r\n        return list.indexOf(obj);\r\n      },\r\n      function getStruct(api, list, key) {\r\n        return pstruct;\r\n      }]);\r\n\r\n    return ret;\r\n  }\r\n\r\n  bool(path, apiname, uiname, description) {\r\n    let prop = new toolprop.BoolProperty(undefined, apiname, uiname, description);\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  vec2(path, apiname, uiname, description) {\r\n    let prop = new toolprop.Vec2Property(undefined, apiname, uiname, description);\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  vec3(path, apiname, uiname, description) {\r\n    let prop = new toolprop.Vec3Property(undefined, apiname, uiname, description);\r\n    //prop.uiname = uiname;\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  vec4(path, apiname, uiname, description) {\r\n    let prop = new toolprop.Vec4Property(undefined, apiname, uiname, description);\r\n    //prop.uiname = uiname;\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  float(path, apiname, uiname, description) {\r\n    let prop = new toolprop.FloatProperty(0, apiname, uiname, description);\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  textblock(path, apiname, uiname, description) {\r\n    let prop = new toolprop.StringProperty(undefined, apiname, uiname, description);\r\n    prop.multiLine = true;\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  report(path, apiname, uiname, description) {\r\n    let prop = new toolprop.ReportProperty(undefined, apiname, uiname, description);\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  string(path, apiname, uiname, description) {\r\n    let prop = new toolprop.StringProperty(undefined, apiname, uiname, description);\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  int(path, apiname, uiname, description, prop = undefined) {\r\n    if (!prop) {\r\n      prop = new toolprop.IntProperty(0, apiname, uiname, description);\r\n    }\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  curve1d(path, apiname, uiname, description) {\r\n    let prop = new toolprop.Curve1DProperty(undefined);\r\n\r\n    prop.apiname = apiname;\r\n    prop.uiname = uiname;\r\n    prop.description = description;\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  enum(path, apiname, enumdef, uiname, description) {\r\n    let prop;\r\n\r\n    if (enumdef instanceof toolprop.EnumProperty) {\r\n      prop = enumdef;\r\n    } else {\r\n      prop = new toolprop.EnumProperty(undefined, enumdef, apiname, uiname, description);\r\n    }\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  list(path, apiname, funcs) {\r\n    let array = new DataList(funcs);\r\n\r\n    let dpath = new DataPath(path, apiname, array);\r\n    dpath.type = DataTypes.ARRAY;\r\n\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  flags(path, apiname, enumdef, uiname, description) {\r\n    let prop;\r\n\r\n    if (enumdef === undefined || !(enumdef instanceof toolprop.ToolProperty)) {\r\n      prop = new toolprop.FlagProperty(undefined, enumdef, apiname, uiname, description);\r\n    } else {\r\n      prop = enumdef;\r\n    }\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  remove(m) {\r\n    if (typeof m === \"string\") {\r\n      m = this.pathmap[m];\r\n    }\r\n\r\n    if (!(m.apiname in this.pathmap)) {\r\n      throw new Error(\"Member not in struct \" + m.apiname);\r\n    }\r\n\r\n    delete this.pathmap[m.apiname];\r\n    this.members.remove(m);\r\n  }\r\n\r\n  fromToolProp(path, prop, apiname) {\r\n    if (apiname === undefined) {\r\n      apiname = prop.apiname !== undefined && prop.apiname.length > 0 ? prop.apiname : k;\r\n    }\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n\r\n    this.add(dpath);\r\n\r\n    return dpath;\r\n  }\r\n\r\n  add(m) {\r\n    if (m.apiname in this.pathmap) {\r\n      if (window.DEBUG.datapaths) {\r\n        console.warn(\"Overriding existing member '\" + m.apiname + \"' in datapath struct\", this.name);\r\n      }\r\n\r\n      this.remove(this.pathmap[m.apiname]);\r\n    }\r\n\r\n    m.flag |= this.inheritFlag;\r\n\r\n    this.members.push(m);\r\n    m.parent = this;\r\n\r\n    this.pathmap[m.apiname] = m;\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nlet _map_struct_idgen = 1;\r\nlet _map_structs = {};\r\n\r\nwindow._debug__map_structs = _map_structs; //global for debugging purposes only\r\n\r\nlet _dummypath = new DataPath();\r\n\r\nlet DummyIntProperty = new IntProperty();\r\nconst CLS_API_KEY = Symbol(\"dp_map_id\");\r\nconst CLS_API_KEY_CUSTOM = Symbol(\"dp_map_custom\");\r\n\r\nexport class DataAPI extends ModelInterface {\r\n  constructor() {\r\n    super();\r\n\r\n    this.rootContextStruct = undefined;\r\n    this.structs = [];\r\n  }\r\n\r\n  get list() {\r\n    return undefined;\r\n  }\r\n\r\n  static toolRegistered(cls) {\r\n    return ToolOp.isRegistered(cls);\r\n    //let key = toolkey(cls);\r\n    //return key in tool_classes;\r\n  }\r\n\r\n  static registerTool(cls) {\r\n    console.warn(\"Outdated function simple_controller.DataAPI.registerTool called\");\r\n\r\n    return ToolOp.register(cls);\r\n\r\n    //let key = toolkey(cls);\r\n    //\r\n    //if (!(key in tool_classes)) {\r\n    //  tool_classes[key] = cls;\r\n    //}\r\n  }\r\n\r\n  getStructs() {\r\n    return this.structs;\r\n  }\r\n\r\n  setRoot(sdef) {\r\n    this.rootContextStruct = sdef;\r\n  }\r\n\r\n  hasStruct(cls) {\r\n    return cls.hasOwnProperty(CLS_API_KEY);\r\n  }\r\n\r\n  getStruct(cls) {\r\n    return this.mapStruct(cls, false);\r\n  }\r\n\r\n  mergeStructs(dest, src) {\r\n    for (let m of src.members) {\r\n      dest.add(m.copy());\r\n    }\r\n  }\r\n\r\n  inheritStruct(cls, parent, auto_create_parent = false) {\r\n    let st = this.mapStruct(parent, auto_create_parent);\r\n\r\n    if (st === undefined) {\r\n      throw new Error(\"parent has no struct definition\");\r\n    }\r\n\r\n    st = st.copy();\r\n    st.name = cls.name;\r\n\r\n    this._addClass(cls, st);\r\n    return st;\r\n  }\r\n\r\n  /**\r\n   * Look up struct definition for a class.\r\n   *\r\n   * @param cls: the class\r\n   * @param auto_create: If true, automatically create definition if not already existing.\r\n   * @returns {IterableIterator<*>}\r\n   */\r\n\r\n  _addClass(cls, dstruct) {\r\n    let key = _map_struct_idgen++;\r\n    cls[CLS_API_KEY] = key;\r\n\r\n    this.structs.push(dstruct);\r\n\r\n    _map_structs[key] = dstruct;\r\n  }\r\n\r\n  /* Associate cls with a DataStruct\r\n   * via callback, which will be called\r\n   * with an instance of cls as its argument*/\r\n  mapStructCustom(cls, callback) {\r\n    this.mapStruct(cls, true);\r\n    cls[CLS_API_KEY_CUSTOM] = callback;\r\n  }\r\n\r\n  mapStruct(cls, auto_create = true, name = cls.name) {\r\n    let key;\r\n\r\n    if (!cls.hasOwnProperty(CLS_API_KEY)) {\r\n      key = undefined;\r\n    } else {\r\n      key = cls[CLS_API_KEY];\r\n    }\r\n\r\n    if (key === undefined && auto_create) {\r\n      let dstruct = new DataStruct(undefined, name);\r\n      this._addClass(cls, dstruct);\r\n      return dstruct;\r\n    } else if (key === undefined) {\r\n      throw new Error(\"class does not have a struct definition: \" + name);\r\n    }\r\n\r\n    return _map_structs[key];\r\n  }\r\n\r\n  //used for tagging error messages\r\n  pushReportContext(name) {\r\n    pushReportName(name);\r\n  }\r\n\r\n  //used for tagging error messages\r\n  popReportContext() {\r\n    popReportName();\r\n  }\r\n\r\n  /*\r\n  massSetProp operate on lists.  The idea is to\r\n  write a filter str inside a data path, e.g.\r\n\r\n  ctx.api.massSetProp(ctx, \"obj.list[{$.select}].value\", 1);\r\n\r\n\r\n  * */\r\n  massSetProp(ctx, massSetPath, value) {\r\n    for (let path of this.resolveMassSetPaths(ctx, massSetPath)) {\r\n      this.setValue(ctx, path, value);\r\n    }\r\n  }\r\n\r\n  resolveMassSetPaths(ctx, massSetPath) {\r\n    if (massSetPath.startsWith(\"/\")) {\r\n      massSetPath = massSetPath.slice(1, massSetPath.length);\r\n    }\r\n\r\n    let start = massSetPath.search(\"{\");\r\n    let end = massSetPath.search(\"}\");\r\n\r\n    if (start < 0 || end < 0) {\r\n      throw new DataPathError(\"Invalid mass set datapath: \" + massSetPath);\r\n      return;\r\n    }\r\n\r\n    let prefix = massSetPath.slice(0, start - 1);\r\n    let filter = massSetPath.slice(start + 1, end);\r\n    let suffix = massSetPath.slice(end + 2, massSetPath.length);\r\n\r\n    let rdef = this.resolvePath(ctx, prefix);\r\n\r\n    if (!(rdef.prop instanceof DataList)) {\r\n      throw new DataPathError(\"massSetPath expected a path resolving to a DataList: \" + massSetPath);\r\n    }\r\n\r\n    let paths = [];\r\n\r\n    let list = rdef.prop;\r\n    let api = ctx.api;\r\n\r\n    function applyFilter(obj) {\r\n      //console.log(filter, obj, obj.constructor.name);\r\n\r\n      if (obj === undefined) {\r\n        return undefined;\r\n      } else if (typeof obj === \"object\" || typeof obj === \"function\") {\r\n        let st = api.mapStruct(obj.constructor, false);\r\n\r\n        let path = filter;\r\n        if (path.startsWith(\"$\")) {\r\n          path = path.slice(1, filter.length).trim();\r\n        }\r\n        if (path.startsWith(\".\")) {\r\n          path = path.slice(1, filter.length).trim();\r\n        }\r\n\r\n        try {\r\n          return api.getValue(obj, path, st);\r\n        } catch (error) {\r\n          if (!(error instanceof DataPathError)) {\r\n            util.print_stack(error);\r\n            console.error(\"Error in datapath callback\");\r\n          }\r\n\r\n          return false;\r\n        }\r\n      } else {\r\n        let $ = obj;\r\n        return eval(filter);\r\n      }\r\n    }\r\n\r\n    for (let obj of list.getIter(this, rdef.value)) {\r\n      if (!applyFilter(obj)) {\r\n        continue;\r\n      }\r\n\r\n      let key = \"\" + list.getKey(this, rdef.value, obj);\r\n      let path = `${prefix}[${key}]${suffix}`;\r\n\r\n      /* validate the final path */\r\n      try {\r\n        this.getValue(ctx, path);\r\n      } catch (error) {\r\n        if (!(error instanceof DataPathError)) {\r\n          util.print_stack(error);\r\n          console.error(path + \": Error in datapath API\");\r\n        }\r\n\r\n        continue;\r\n      }\r\n\r\n      paths.push(path);\r\n    }\r\n\r\n    return paths;\r\n  }\r\n\r\n  resolvePath(ctx, inpath, ignoreExistence = false, dstruct = undefined) {\r\n    let parser = parserStack[parserStack.cur++];\r\n    let ret = undefined;\r\n\r\n    if (inpath[0] === \"/\") {\r\n      inpath = inpath.slice(1, inpath.length).trim();\r\n    }\r\n\r\n    try {\r\n      ret = this.resolvePath_intern(ctx, inpath, ignoreExistence, parser, dstruct)\r\n    } catch (error) {\r\n      //throw new DataPathError(\"bad path \" + path);\r\n      if (!(error instanceof DataPathError)) {\r\n        util.print_stack(error);\r\n        report(\"error while evaluating path \" + inpath);\r\n      }\r\n\r\n      if (window.DEBUG && window.DEBUG.datapaths) {\r\n        util.print_stack(error);\r\n      }\r\n\r\n      ret = undefined;\r\n    }\r\n\r\n    parserStack.cur--;\r\n\r\n    if (ret !== undefined && ret.prop && ret.dpath && (ret.dpath.flag & DataFlags.USE_CUSTOM_PROP_GETTER)) {\r\n      let prop = ret.prop;\r\n\r\n      prop.ctx = ctx;\r\n      prop.datapath = inpath;\r\n      prop.dataref = ret.obj;\r\n\r\n      let newprop = getTempProp(prop.type);\r\n      prop.copyTo(newprop);\r\n\r\n      ret.dpath.propGetter.call(prop, newprop);\r\n      ret.prop = newprop;\r\n\r\n      prop.ctx = prop.datapath = prop.dataref = undefined;\r\n    }\r\n\r\n    if (ret !== undefined && ret.prop && ret.dpath && ret.dpath.ui_name_get) {\r\n      let dummy = {\r\n        datactx : ctx,\r\n        datapath: inpath,\r\n        dataref : ret.obj\r\n      };\r\n\r\n      let name = ret.dpath.ui_name_get.call(dummy);\r\n\r\n      ret.prop.uiname = \"\" + name;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   get meta information for a datapath.\r\n\r\n   @param ignoreExistence: don't try to get actual data associated with path,\r\n   just want meta information\r\n   */\r\n  resolvePath_intern(ctx, inpath, ignoreExistence = false, p = pathParser, dstruct = undefined) {\r\n    inpath = inpath.replace(\"==\", \"=\");\r\n\r\n    p.input(inpath);\r\n\r\n    dstruct = dstruct || this.rootContextStruct;\r\n\r\n    let obj = ctx;\r\n    let lastobj = ctx;\r\n    let subkey;\r\n    let lastobj2 = undefined;\r\n    let lastkey = undefined;\r\n    let prop = undefined;\r\n    let lastdpath = undefined;\r\n\r\n    function p_key() {\r\n      let t = p.peeknext();\r\n      if (t.type === \"NUM\" || t.type === \"STRLIT\") {\r\n        p.next();\r\n        return t.value;\r\n      } else {\r\n        throw new PUTLParseError(\"Expected list key\");\r\n      }\r\n    }\r\n\r\n    let _i = 0;\r\n    while (!p.at_end()) {\r\n      let key = p.expect(\"ID\");\r\n      let dpath = dstruct.pathmap[key];\r\n\r\n      lastdpath = dpath;\r\n\r\n      if (dpath === undefined) {\r\n        if (key === \"length\" && prop !== undefined && prop instanceof DataList) {\r\n          prop.getLength(this, obj);\r\n          key = \"length\";\r\n\r\n          prop = DummyIntProperty;\r\n\r\n          prop.name = \"length\";\r\n          prop.flag = PropFlags.READ_ONLY;\r\n\r\n          dpath = _dummypath;\r\n          dpath.type = DataTypes.PROP;\r\n          dpath.data = prop;\r\n          dpath.struct = dpath.parent = dstruct;\r\n          dpath.flag = DataFlags.READ_ONLY;\r\n          dpath.path = \"length\";\r\n\r\n          /*\r\n          parent: lastobj2,\r\n            obj: lastobj,\r\n            value: obj,\r\n            key: lastkey,\r\n            //*/\r\n        } else if (key === \"active\" && prop !== undefined && prop instanceof DataList) {\r\n          let act = prop.getActive(this, obj);\r\n\r\n          if (act === undefined && !ignoreExistence) {\r\n            throw new DataPathError(\"no active elem ent for list\");\r\n          }\r\n\r\n          let actkey = obj !== undefined && act !== undefined ? prop.getKey(this, obj, act) : undefined;\r\n\r\n          dstruct = prop.getStruct(this, obj, actkey);\r\n          if (dstruct === undefined) {\r\n            throw new DataPathError(\"couldn't get data type for \" + inpath + \"'s element '\" + key + \"'\");\r\n          }\r\n\r\n          _dummypath.parent = dpath;\r\n          dpath = _dummypath;\r\n\r\n          lastobj = obj;\r\n          obj = act;\r\n\r\n          dpath.type = DataTypes.STRUCT;\r\n          dpath.data = dstruct;\r\n          dpath.path = key;\r\n\r\n          p.optional(\"DOT\");\r\n\r\n          continue;\r\n        } else {\r\n          throw new DataPathError(inpath + \": unknown property \" + key);\r\n        }\r\n      }\r\n\r\n      let dynstructobj = undefined;\r\n\r\n      if (dpath.type === DataTypes.STRUCT) {\r\n        dstruct = dpath.data;\r\n      } else if (dpath.type === DataTypes.DYNAMIC_STRUCT) {\r\n        let ok = false;\r\n\r\n        if (obj !== undefined) {\r\n          let obj2;\r\n\r\n          if (dpath.flag & DataFlags.USE_CUSTOM_GETSET) {\r\n            let fakeprop = dpath.getSet;\r\n            fakeprop.ctx = ctx;\r\n            fakeprop.dataref = obj;\r\n            fakeprop.datapath = inpath;\r\n\r\n            obj2 = fakeprop.get();\r\n\r\n            fakeprop.ctx = fakeprop.datapath = fakeprop.dataref = undefined;\r\n          } else {\r\n            obj2 = obj[dpath.path];\r\n          }\r\n\r\n          dynstructobj = obj2;\r\n\r\n          if (obj2 !== undefined) {\r\n            if (CLS_API_KEY_CUSTOM in obj2.constructor) {\r\n              dstruct = obj2.constructor[CLS_API_KEY_CUSTOM](obj2);\r\n            } else {\r\n              dstruct = this.mapStruct(obj2.constructor, false);\r\n            }\r\n          } else {\r\n            dstruct = dpath.data;\r\n          }\r\n\r\n          if (dstruct === undefined) {\r\n            dstruct = dpath.data;\r\n          }\r\n\r\n          ok = dstruct !== undefined;\r\n        }\r\n\r\n        if (!ok) {\r\n          throw new DataPathError(\"dynamic struct error for path: \" + inpath);\r\n        }\r\n      } else {\r\n        prop = dpath.data;\r\n      }\r\n\r\n      if (dpath.path.search(/\\./) >= 0) {\r\n        let keys = dpath.path.split(/\\./);\r\n\r\n        for (let key of keys) {\r\n          lastobj2 = lastobj;\r\n          lastobj = obj;\r\n          lastkey = key;\r\n\r\n          if (obj === undefined && !ignoreExistence) {\r\n            throw new DataPathError(\"no data for \" + inpath);\r\n          } else if (obj !== undefined) {\r\n            obj = obj[key.trim()];\r\n          }\r\n        }\r\n      } else {\r\n        lastobj2 = lastobj;\r\n        lastobj = obj;\r\n\r\n        lastkey = dpath.path;\r\n\r\n        if (dpath.flag & DataFlags.USE_CUSTOM_GETSET) {\r\n          let fakeprop = dpath.getSet;\r\n\r\n          if (!fakeprop && dpath.type === DataTypes.PROP) {\r\n            let prop = dpath.data;\r\n\r\n            prop.ctx = ctx;\r\n            prop.dataref = obj;\r\n            prop.datapath = inpath;\r\n\r\n            try {\r\n              obj = prop.getValue();\r\n            } catch (error) {\r\n              util.print_stack(error);\r\n              obj = undefined;\r\n            }\r\n\r\n            if (typeof obj === \"string\" && (prop.type & (PropTypes.ENUM | PropTypes.FLAG))) {\r\n              obj = prop.values[obj];\r\n            }\r\n\r\n            prop.ctx = prop.dataref = prop.datapath = undefined;\r\n          } else {\r\n            fakeprop.ctx = ctx;\r\n            fakeprop.dataref = obj;\r\n            fakeprop.datapath = inpath;\r\n\r\n            obj = fakeprop.get();\r\n            fakeprop.ctx = fakeprop.datapath = fakeprop.dataref = undefined;\r\n          }\r\n        } else if (obj === undefined && !ignoreExistence) {\r\n          throw new DataPathError(\"no data for \" + inpath);\r\n        } else if (dpath.type === DataTypes.DYNAMIC_STRUCT) {\r\n          obj = dynstructobj;\r\n        } else if (obj !== undefined && dpath.path !== \"\") {\r\n          obj = obj[dpath.path];\r\n        }\r\n      }\r\n\r\n      let t = p.peeknext();\r\n      if (t === undefined) {\r\n        break;\r\n      }\r\n\r\n      if (t.type === \"DOT\") {\r\n        p.next();\r\n      } else if (t.type === \"EQUALS\" && prop !== undefined && (prop.type & (PropTypes.ENUM | PropTypes.FLAG))) {\r\n        p.expect(\"EQUALS\");\r\n\r\n        let t2 = p.peeknext();\r\n        let type = t2 && t2.type === \"ID\" ? \"ID\" : \"NUM\";\r\n\r\n        let val = p.expect(type);\r\n\r\n        let val1 = val;\r\n\r\n        if (typeof val == \"string\") {\r\n          val = prop.values[val];\r\n        }\r\n\r\n        if (val === undefined) {\r\n          throw new DataPathError(\"unknown value \" + val1);\r\n        }\r\n\r\n        if (val in prop.keys) {\r\n          subkey = prop.keys[val];\r\n        }\r\n\r\n        key = dpath.path;\r\n        obj = !!(lastobj[key] == val);\r\n      } else if (t.type === \"AND\" && prop !== undefined && (prop.type & (PropTypes.ENUM | PropTypes.FLAG))) {\r\n        p.expect(\"AND\");\r\n\r\n        let t2 = p.peeknext();\r\n        let type = t2 && t2.type === \"ID\" ? \"ID\" : \"NUM\";\r\n\r\n        let val = p.expect(type);\r\n\r\n        let val1 = val;\r\n\r\n        if (typeof val == \"string\") {\r\n          val = prop.values[val];\r\n        }\r\n\r\n        if (val === undefined) {\r\n          throw new DataPathError(\"unknown value \" + val1);\r\n        }\r\n\r\n        if (val in prop.keys) {\r\n          subkey = prop.keys[val];\r\n        }\r\n\r\n        key = dpath.path;\r\n        obj = !!(lastobj[key] & val);\r\n      } else if (t.type === \"LSBRACKET\" && prop !== undefined && (prop.type & (PropTypes.ENUM | PropTypes.FLAG))) {\r\n        p.expect(\"LSBRACKET\");\r\n\r\n        let t2 = p.peeknext();\r\n        let type = t2 && t2.type === \"ID\" ? \"ID\" : \"NUM\";\r\n\r\n        let val = p.expect(type);\r\n\r\n        let val1 = val;\r\n\r\n        if (typeof val == \"string\") {\r\n          val = prop.values[val];\r\n        }\r\n\r\n        if (val === undefined) {\r\n          console.warn(inpath, prop.values, val1, prop);\r\n          throw new DataPathError(\"unknown value \" + val1);\r\n        }\r\n\r\n        if (val in prop.keys) {\r\n          subkey = prop.keys[val];\r\n        }\r\n\r\n        let bitfield;\r\n        key = dpath.path;\r\n\r\n        if (!(prop.flag & PropFlags.USE_CUSTOM_GETSET)) {\r\n          bitfield = lastobj ? lastobj[key] : 0;\r\n        } else {\r\n          prop.dataref = lastobj;\r\n          prop.datapath = inpath;\r\n          prop.ctx = ctx;\r\n\r\n          try {\r\n            bitfield = prop.getValue();\r\n          } catch (error) {\r\n            util.print_stack(error);\r\n\r\n            bitfield = NaN;\r\n          }\r\n        }\r\n\r\n        if (lastobj === undefined && !ignoreExistence) {\r\n          throw new DataPathError(\"no data for path \" + inpath);\r\n        } else if (lastobj !== undefined) {\r\n          if (prop.type === PropTypes.ENUM) {\r\n            obj = !!(bitfield === val);\r\n          } else {\r\n            obj = !!(bitfield & val);\r\n          }\r\n        }\r\n\r\n        p.expect(\"RSBRACKET\");\r\n      } else if (t.type === \"LSBRACKET\" && prop !== undefined && isVecProperty(prop)) {\r\n        p.expect(\"LSBRACKET\");\r\n        let num = p.expect(\"NUM\");\r\n        p.expect(\"RSBRACKET\");\r\n\r\n        subkey = num;\r\n\r\n        if (prop !== undefined && !(prop.type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4 | PropTypes.QUAT))) {\r\n          lastobj = obj;\r\n        }\r\n\r\n        obj = obj[num];\r\n      } else if (t.type === \"LSBRACKET\") {\r\n        p.expect(\"LSBRACKET\")\r\n\r\n        if (lastobj && lastkey && typeof lastkey === \"string\" && lastkey.length > 0) {\r\n          lastobj = lastobj[lastkey];\r\n        }\r\n\r\n        lastkey = p_key();\r\n        p.expect(\"RSBRACKET\");\r\n\r\n        if (!(prop instanceof DataList)) {\r\n          throw new DataPathError(\"bad property, not a list\");\r\n        }\r\n\r\n        obj = prop.get(this, lastobj, lastkey);\r\n        dstruct = prop.getStruct(this, lastobj, lastkey);\r\n\r\n        if (!dstruct) {\r\n          throw new DataPathError(inpath + \": list has no entry \" + lastkey);\r\n        }\r\n\r\n        if (p.peeknext() !== undefined && p.peeknext().type === \"DOT\") {\r\n          p.next();\r\n        }\r\n      }\r\n\r\n      if (_i++ > 1000) {\r\n        console.warn(\"infinite loop in resolvePath parser\");\r\n        break;\r\n      }\r\n    }\r\n\r\n    return {\r\n      dpath  : lastdpath,\r\n      parent : lastobj2,\r\n      obj    : lastobj,\r\n      value  : obj,\r\n      key    : lastkey,\r\n      dstruct: dstruct,\r\n      prop   : prop,\r\n      subkey : subkey\r\n    };\r\n  }\r\n\r\n  resolvePathOld2(ctx, path) {\r\n    let splitchars = new Set([\".\", \"[\", \"]\", \"=\", \"&\"]);\r\n    let subkey = undefined;\r\n\r\n    path = path.replace(/\\=\\=/g, \"=\");\r\n\r\n    path = \".\" + this.prefix + path;\r\n\r\n    let p = [\"\"];\r\n    for (let i = 0; i < path.length; i++) {\r\n      let s = path[i];\r\n\r\n      if (splitchars.has(s)) {\r\n        if (s !== \"]\") {\r\n          p.push(s);\r\n        }\r\n\r\n        p.push(\"\");\r\n        continue;\r\n      }\r\n\r\n      p[p.length - 1] += s;\r\n    }\r\n\r\n    for (let i = 0; i < p.length; i++) {\r\n      p[i] = p[i].trim();\r\n\r\n      if (p[i].length === 0) {\r\n        p.remove(p[i]);\r\n        i--;\r\n      }\r\n\r\n      let c = parseInt(p[i]);\r\n      if (!isNaN(c)) {\r\n        p[i] = c;\r\n      }\r\n    }\r\n\r\n    let i = 0;\r\n\r\n    let parent1, obj = ctx, parent2;\r\n    let key = undefined;\r\n    let dstruct = undefined;\r\n    let arg = undefined;\r\n    let type = \"normal\";\r\n    let retpath = p;\r\n    let prop;\r\n    let lastkey = key, a;\r\n    let apiname = key;\r\n\r\n    while (i < p.length - 1) {\r\n      lastkey = key;\r\n      apiname = key;\r\n\r\n      if (dstruct !== undefined && dstruct.pathmap[lastkey]) {\r\n        let dpath = dstruct.pathmap[lastkey];\r\n\r\n        apiname = dpath.apiname;\r\n      }\r\n\r\n      let a = p[i];\r\n      let b = p[i + 1];\r\n\r\n      //check for enum/flag propertys with [] form\r\n      if (a === \"[\") {\r\n        let ok = false;\r\n\r\n        key = b;\r\n        prop = undefined;\r\n\r\n        if (dstruct !== undefined && dstruct.pathmap[lastkey]) {\r\n          let dpath = dstruct.pathmap[lastkey];\r\n\r\n          if (dpath.type === DataTypes.PROP) {\r\n            prop = dpath.data;\r\n          }\r\n        }\r\n\r\n        if (prop !== undefined && (prop.type === PropTypes.ENUM || prop.type === PropTypes.FLAG)) {\r\n          util.console.context(\"api\").log(\"found flag/enum property\");\r\n          ok = true;\r\n        }\r\n\r\n        if (ok) {\r\n          if (isNaN(parseInt(key))) {\r\n            key = prop.values[key];\r\n          } else if (typeof key == \"int\") {\r\n            key = parseInt(key);\r\n          }\r\n\r\n          let value = obj;\r\n          if (typeof value == \"string\") {\r\n            value = prop.values[key];\r\n          }\r\n\r\n          if (prop.type === PropTypes.ENUM) {\r\n            value = !!(value == key);\r\n          } else { //flag\r\n            value = !!(value & key);\r\n          }\r\n\r\n          if (key in prop.keys) {\r\n            subkey = prop.keys[key];\r\n          }\r\n\r\n          obj = value;\r\n          i++;\r\n          continue;\r\n        }\r\n      }\r\n\r\n      if (dstruct !== undefined && dstruct.pathmap[lastkey]) {\r\n        let dpath = dstruct.pathmap[lastkey];\r\n\r\n        if (dpath.type == DataTypes.PROP) {\r\n          prop = dpath.data;\r\n        }\r\n      }\r\n\r\n      if (a === \".\" || a === \"[\") {\r\n        key = b;\r\n\r\n        parent2 = parent1;\r\n        parent1 = obj;\r\n        obj = obj[b];\r\n\r\n        if (obj === undefined || obj === null) {\r\n          break;\r\n        }\r\n\r\n        if (typeof obj == \"object\") {\r\n          dstruct = this.mapStruct(obj.constructor, false);\r\n        }\r\n\r\n        i += 2;\r\n        continue;\r\n      } else if (a === \"&\") {\r\n        obj &= b;\r\n        arg = b;\r\n\r\n        if (b in prop.keys) {\r\n          subkey = prop.keys[b];\r\n        }\r\n\r\n        i += 2;\r\n        type = \"flag\";\r\n        continue;\r\n      } else if (a === \"=\") {\r\n        obj = obj == b;\r\n        arg = b;\r\n\r\n        if (b in prop.keys) {\r\n          subkey = prop.keys[b];\r\n        }\r\n\r\n        i += 2;\r\n        type = \"enum\";\r\n        continue;\r\n      } else {\r\n        throw new DataPathError(\"bad path \" + path);\r\n      }\r\n\r\n      i++;\r\n    }\r\n\r\n    if (lastkey !== undefined && dstruct !== undefined && dstruct.pathmap[lastkey]) {\r\n      let dpath = dstruct.pathmap[key];\r\n\r\n      apiname = dpath.apiname;\r\n    }\r\n\r\n\r\n    if (dstruct !== undefined && dstruct.pathmap[key]) {\r\n      let dpath = dstruct.pathmap[key];\r\n\r\n      if (dpath.type == DataTypes.PROP) {\r\n        prop = dpath.data;\r\n      }\r\n    }\r\n\r\n    return {\r\n      parent : parent2,\r\n      obj    : parent1,\r\n      value  : obj,\r\n      key    : key,\r\n      dstruct: dstruct,\r\n      subkey : subkey,\r\n      prop   : prop,\r\n      arg    : arg,\r\n      type   : type,\r\n      _path  : retpath\r\n    };\r\n  }\r\n\r\n  /*returns {\r\n    obj : [object owning property key]\r\n    parent : [parent of obj]\r\n    key : [property key]\r\n    value : [value of property]\r\n    prop : [optional toolprop.ToolProperty representing the property definition]\r\n    struct : [optional datastruct representing the type, if value is an object]\r\n  }\r\n  */\r\n  resolvePathold(ctx, path) {\r\n    path = this.prefix + path;\r\n    path = path.replace(/\\[/g, \".\").replace(/\\]/g, \"\").trim().split(\".\");\r\n\r\n    let parent1, obj = ctx, parent2;\r\n    let key = undefined;\r\n    let dstruct = undefined;\r\n\r\n    for (let c of path) {\r\n      let c2 = parseInt(c);\r\n      if (!isNaN(c2)) {\r\n        c = c2;\r\n      }\r\n\r\n      parent2 = parent1;\r\n      parent1 = obj;\r\n      key = c;\r\n\r\n      if (typeof obj == \"number\") {\r\n        //bitmask test\r\n        obj = obj & c;\r\n        break;\r\n      }\r\n\r\n      obj = obj[c];\r\n\r\n      if (typeof obj == \"object\") {\r\n        dstruct = this.mapStruct(obj.constructor, false);\r\n      }\r\n    }\r\n\r\n    let prop;\r\n\r\n    if (dstruct !== undefined && dstruct.pathmap[key]) {\r\n      let dpath = dstruct.pathmap[key];\r\n\r\n      if (dpath.type == DataTypes.PROP) {\r\n        prop = dpath.data;\r\n      }\r\n    }\r\n\r\n    return {\r\n      parent : parent2,\r\n      obj    : parent1,\r\n      value  : obj,\r\n      key    : key,\r\n      dstruct: dstruct,\r\n      prop   : prop\r\n    };\r\n  }\r\n\r\n  _stripToolUIName(path, uiNameOut = undefined) {\r\n    if (path.search(/\\|/) >= 0) {\r\n      if (uiNameOut) {\r\n        uiNameOut[0] = path.slice(path.search(/\\|/) + 1, path.length).trim();\r\n      }\r\n      path = path.slice(0, path.search(/\\|/)).trim();\r\n    }\r\n\r\n    return path.trim();\r\n  }\r\n\r\n  getToolDef(path) {\r\n    let uiname = [undefined];\r\n\r\n    path = this._stripToolUIName(path, uiname);\r\n    uiname = uiname[0];\r\n\r\n    let cls = this.parseToolPath(path);\r\n    if (cls === undefined) {\r\n      throw new DataPathError(\"unknown path \\\"\" + path + \"\\\"\");\r\n    }\r\n\r\n    let def = cls.tooldef();\r\n    if (uiname) {\r\n      def.uiname = uiname;\r\n    }\r\n\r\n    return def;\r\n  }\r\n\r\n  getToolPathHotkey(ctx, path) {\r\n    path = this._stripToolUIName(path);\r\n\r\n    try {\r\n      return this.getToolPathHotkey_intern(ctx, path);\r\n    } catch (error) {\r\n      print_stack(error);\r\n      util.console.context(\"api\").log(\"failed to fetch tool path: \" + path);\r\n\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  getToolPathHotkey_intern(ctx, path) {\r\n    let screen = ctx.screen;\r\n    let this2 = this;\r\n\r\n    function searchKeymap(keymap) {\r\n      if (keymap === undefined) {\r\n        return undefined;\r\n      }\r\n\r\n      for (let hk of keymap) {\r\n        if (typeof hk.action !== \"string\") {\r\n          continue;\r\n        }\r\n\r\n        let tool = this2._stripToolUIName(hk.action);\r\n        if (tool === path) {\r\n          return hk.buildString();\r\n        }\r\n      }\r\n    }\r\n\r\n    if (screen.sareas.length === 0) {\r\n      return searchKeymap(screen.keymap);\r\n    }\r\n\r\n    //client might have its own area subclass with\r\n    //getActiveArea defined (that's encouraged),\r\n    //which is why we don't just call Area.getActiveArea\r\n    let areacls = screen.sareas[0].area.constructor;\r\n    let area = areacls.getActiveArea();\r\n\r\n    if (area) {\r\n      for (let keymap of area.getKeyMaps()) {\r\n        let ret = searchKeymap(keymap);\r\n\r\n        if (ret !== undefined) {\r\n          return ret;\r\n        }\r\n      }\r\n    }\r\n\r\n    //search all other areas\r\n    for (let sarea of screen.sareas) {\r\n      if (!sarea.area) continue;\r\n\r\n      for (let keymap of sarea.area.getKeyMaps()) {\r\n        let ret = searchKeymap(keymap);\r\n\r\n        if (ret) {\r\n          return ret;\r\n        }\r\n      }\r\n    }\r\n\r\n    return this.keymap ? searchKeymap(this.keymap) : false;\r\n  }\r\n\r\n  parseToolPath(path) {\r\n    try {\r\n      return parseToolPath(path).toolclass;\r\n    } catch (error) {\r\n      if (error instanceof DataPathError) {\r\n        console.warn(\"warning, bad tool path \" + path);\r\n        return undefined;\r\n      } else {\r\n        throw error;\r\n      }\r\n    }\r\n  }\r\n\r\n  parseToolArgs(path) {\r\n    return parseToolPath(path).args;\r\n  }\r\n\r\n  createTool(ctx, path, inputs = {}) {\r\n    let cls;\r\n    let args;\r\n\r\n    if (typeof path == \"string\" || path instanceof String) {\r\n      //parseToolPath will raise DataPathError if path is malformed\r\n      let tpath = parseToolPath(path);\r\n\r\n      cls = tpath.toolclass;\r\n      args = tpath.args;\r\n    } else {\r\n      cls = path;\r\n      args = {};\r\n    }\r\n\r\n    if (!cls) {\r\n      debugger;\r\n      console.error(\"Unknown tool \" + path);\r\n    }\r\n\r\n    let tool = cls.invoke(ctx, args);\r\n\r\n    if (inputs !== undefined) {\r\n      for (let k in inputs) {\r\n        if (!(k in tool.inputs)) {\r\n          console.warn(cls.tooldef().uiname + \": Unknown tool property \\\"\" + k + \"\\\"\");\r\n          continue;\r\n        }\r\n\r\n        tool.inputs[k].setValue(inputs[k]);\r\n      }\r\n    }\r\n\r\n    return tool;\r\n  }\r\n}\r\n\r\nexport function initSimpleController() {\r\n  initToolPaths();\r\n}\r\n\r\nimport {DataPathSetOp} from \"./controller_ops.js\";\r\n\r\nlet dpt = DataPathSetOp;\r\n\r\nexport function getDataPathToolOp() {\r\n  return dpt;\r\n}\r\n\r\nexport function setDataPathToolOp(cls) {\r\n  ToolOp.unregister(DataPathSetOp);\r\n\r\n  if (!ToolOp.isRegistered(cls)) {\r\n    ToolOp.register(cls);\r\n  }\r\n\r\n  dpt = cls;\r\n}\r\n\r\nsetImplementationClass(DataAPI);\r\n","import * as util from '../util/util.js';\r\nimport * as vectormath from '../util/vectormath.js';\r\nimport {Vector3, Vector4} from '../util/vectormath.js';\r\n\r\nlet rgb_to_hsv_rets = new util.cachering(() => [0, 0, 0], 64);\r\n\r\nexport function rgb_to_hsv(r, g, b) {\r\n  let computedH = 0;\r\n  let computedS = 0;\r\n  let computedV = 0;\r\n\r\n  if (r == null || g == null || b == null ||\r\n    isNaN(r) || isNaN(g) || isNaN(b)) {\r\n    throw new Error(`Please enter numeric RGB values! r: ${r} g: ${g} b: ${b}`);\r\n  }\r\n  /*\r\n  if (r<0 || g<0 || b<0 || r>1.0 || g>1.0 || b>1.0) {\r\n   throw new Error('RGB values must be in the range 0 to 1.0');\r\n   return;\r\n  }//*/\r\n\r\n  let minRGB = Math.min(r, Math.min(g, b));\r\n  let maxRGB = Math.max(r, Math.max(g, b));\r\n\r\n  // Black-gray-white\r\n  if (minRGB === maxRGB) {\r\n    computedV = minRGB;\r\n\r\n    let ret = rgb_to_hsv_rets.next();\r\n    ret[0] = 0, ret[1] = 0, ret[2] = computedV;\r\n    return ret;\r\n  }\r\n\r\n  // Colors other than black-gray-white:\r\n  let d = (r === minRGB) ? g - b : ((b === minRGB) ? r - g : b - r);\r\n  let h = (r === minRGB) ? 3 : ((b === minRGB) ? 1 : 5);\r\n\r\n  computedH = (60*(h - d/(maxRGB - minRGB)))/360.0;\r\n  computedS = (maxRGB - minRGB)/maxRGB;\r\n  computedV = maxRGB;\r\n\r\n  let ret = rgb_to_hsv_rets.next();\r\n  ret[0] = computedH, ret[1] = computedS, ret[2] = computedV;\r\n  return ret;\r\n}\r\n\r\nlet hsv_to_rgb_rets = new util.cachering(() => [0, 0, 0], 64);\r\n\r\nexport function hsv_to_rgb(h, s, v) {\r\n  let c = 0, m = 0, x = 0;\r\n  let ret = hsv_to_rgb_rets.next();\r\n\r\n  ret[0] = ret[1] = ret[2] = 0.0;\r\n  h *= 360.0;\r\n\r\n  c = v*s;\r\n  x = c*(1.0 - Math.abs(((h/60.0)%2) - 1.0));\r\n  m = v - c;\r\n  let color;\r\n\r\n  function RgbF_Create(r, g, b) {\r\n    ret[0] = r;\r\n    ret[1] = g;\r\n    ret[2] = b;\r\n\r\n    return ret;\r\n  }\r\n\r\n  if (h >= 0.0 && h < 60.0) {\r\n    color = RgbF_Create(c + m, x + m, m);\r\n  } else if (h >= 60.0 && h < 120.0) {\r\n    color = RgbF_Create(x + m, c + m, m);\r\n  } else if (h >= 120.0 && h < 180.0) {\r\n    color = RgbF_Create(m, c + m, x + m);\r\n  } else if (h >= 180.0 && h < 240.0) {\r\n    color = RgbF_Create(m, x + m, c + m);\r\n  } else if (h >= 240.0 && h < 300.0) {\r\n    color = RgbF_Create(x + m, m, c + m);\r\n  } else if (h >= 300.0) {\r\n    color = RgbF_Create(c + m, m, x + m);\r\n  } else {\r\n    color = RgbF_Create(m, m, m);\r\n  }\r\n\r\n  return color;\r\n}\r\n\r\nlet rgb_to_cmyk_rets = util.cachering.fromConstructor(Vector4, 512);\r\nlet cmyk_to_rgb_rets = util.cachering.fromConstructor(Vector3, 512);\r\n\r\nexport function cmyk_to_rgb(c, m, y, k) {\r\n  let ret = cmyk_to_rgb_rets.next();\r\n\r\n  if (k === 1.0) {\r\n    ret.zero();\r\n    return ret;\r\n  }\r\n\r\n  c = c - c*k + k;\r\n  m = m - m*k + k;\r\n  y = y - y*k + k;\r\n\r\n  ret[0] = 1.0 - c;\r\n  ret[1] = 1.0 - m;\r\n  ret[2] = 1.0 - y;\r\n\r\n  return ret;\r\n}\r\n\r\nexport function rgb_to_cmyk(r, g, b) {\r\n  //CMYK and CMY values from 0 to 1\r\n  let ret = rgb_to_cmyk_rets.next();\r\n\r\n  let C = 1.0 - r;\r\n  let M = 1.0 - g;\r\n  let Y = 1.0 - b;\r\n\r\n  let var_K = 1\r\n\r\n  if (C < var_K) var_K = C\r\n  if (M < var_K) var_K = M\r\n  if (Y < var_K) var_K = Y\r\n  if (var_K === 1) { //Black\r\n    C = 0\r\n    M = 0\r\n    Y = 0\r\n  } else {\r\n    C = (C - var_K)/(1 - var_K)\r\n    M = (M - var_K)/(1 - var_K)\r\n    Y = (Y - var_K)/(1 - var_K)\r\n  }\r\n\r\n  let K = var_K\r\n\r\n  ret[0] = C;\r\n  ret[1] = M;\r\n  ret[2] = Y;\r\n  ret[3] = K;\r\n\r\n  return ret;\r\n}\r\n\r\n","import {CSSFont} from './ui_theme.js';\r\n\r\nexport const DefaultTheme = {\r\n  base: {\r\n    AreaHeaderBG        : 'rgba(200, 200, 200, 0.95)',\r\n    BasePackFlag        : 0,\r\n    BoxDepressed        : 'rgba(130,130,130, 1)',\r\n    BoxHighlight        : 'rgba(151,208,239, 1)',\r\n    \"flex-grow\"         : \"unset\",\r\n    DefaultText         : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 14,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n    LabelText           : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 14,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n    TitleText           : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 12,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n    'background-color'  : 'rgba(207,207,207, 0.5)',\r\n    'border-color'      : 'rgba(34,34,34, 1)',\r\n    'border-radius'     : 12.010619764585666,\r\n    'focus-border-width': 2,\r\n    oneAxisPadding      : 2,\r\n    padding             : 1,\r\n  },\r\n\r\n  button: {\r\n    DefaultText        : new CSSFont({\r\n      font   : 'poppins',\r\n      weight : 'bold',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 12,\r\n      color  : 'rgba(35,35,35, 1)'\r\n    }),\r\n    'background-color' : 'rgba(238,238,238, 0.8672412740773168)',\r\n    'border-color'     : 'rgba(255,255,255, 1)',\r\n    'border-radius'    : 4,\r\n    'border-style'     : 'solid',\r\n    'border-width'     : 2,\r\n    disabled           : {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgb(109,109,109)'\r\n      }),\r\n      'background-color': 'rgb(19,19,19)',\r\n      'border-color'    : '#f58f8f',\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 1,\r\n    },\r\n    height             : 25,\r\n    highlight          : {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgba(255,255,255, 1)'\r\n      }),\r\n      'background-color': 'rgba(138,222,255, 1)',\r\n      'border-color'    : 'rgba(255,255,255, 1)',\r\n      'border-radius'   : 4,\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 2,\r\n    },\r\n    'highlight-pressed': {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgba(35,35,35, 1)'\r\n      }),\r\n      'background-color': 'rgba(113,113,113, 1)',\r\n      'border-color'    : '#DADCE0',\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 1,\r\n    },\r\n    margin             : 4,\r\n    'margin-left'      : 4,\r\n    'margin-right'     : 4,\r\n    padding            : 1,\r\n    pressed            : {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgba(35,35,35, 1)'\r\n      }),\r\n      'background-color': 'rgba(113,113,113, 1)',\r\n      'border-color'    : '#DADCE0',\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 1,\r\n    },\r\n    width              : 25,\r\n  },\r\n\r\n  checkbox: {\r\n    CheckSide: 'left',\r\n    height   : 32,\r\n    width    : 32,\r\n    \"background-color\" : \"rgb(168,168,168)\",\r\n  },\r\n\r\n  colorfield: {\r\n    circleSize    : 11,\r\n    colorBoxHeight: 24,\r\n    fieldSize     : 400,\r\n    height        : 256,\r\n    hueHeight     : 32,\r\n    width         : 256,\r\n  },\r\n\r\n  colorpickerbutton: {\r\n    height: 32,\r\n    width : 95,\r\n  },\r\n\r\n  curvewidget: {\r\n    CanvasBG    : 'rgb(44,44,44)',\r\n    CanvasHeight: 256,\r\n    CanvasWidth : 256,\r\n  },\r\n\r\n  dropbox: {\r\n    dropTextBG: 'rgba(233,233,233, 1)',\r\n    height    : 25,\r\n    width     : 32,\r\n  },\r\n\r\n  iconbutton: {\r\n    highlight: {\r\n      'background-color': 'rgba(133,182,255,0.8)',\r\n      'border-color'    : 'black',\r\n      'border-radius'   : 5,\r\n      'border-width'    : 1,\r\n      height            : 32,\r\n      'margin-bottom'   : 1,\r\n      'margin-left'     : 2,\r\n      'margin-right'    : 2,\r\n      'margin-top'      : 1,\r\n      padding           : 2,\r\n      width             : 32,\r\n    },\r\n    depressed: {\r\n      'background-color': 'rgba(42,61,77,0.8)',\r\n      'border-color'    : 'black',\r\n      'border-radius'   : 5,\r\n      'border-width'    : 1,\r\n      height            : 32,\r\n      'margin-bottom'   : 1,\r\n      'margin-left'     : 2,\r\n      'margin-right'    : 2,\r\n      'margin-top'      : 1,\r\n      padding           : 2,\r\n      width             : 32,\r\n    },\r\n\r\n    'background-color': 'rgba(15,15,15, 0)',\r\n    'border-color'    : 'black',\r\n    'border-radius'   : 5,\r\n    'border-width'    : 1,\r\n    height            : 32,\r\n    'margin-bottom'   : 1,\r\n    'margin-left'     : 2,\r\n    'margin-right'    : 2,\r\n    'margin-top'      : 1,\r\n    padding           : 2,\r\n    width             : 32,\r\n  },\r\n\r\n  iconcheck: {\r\n    highlight         : {\r\n      'background-color': 'rgba(133,182,255,0.8)',\r\n      'border-color'    : 'black',\r\n      'border-radius'   : 5,\r\n      'border-width'    : 1,\r\n      height            : 32,\r\n      'margin-bottom'   : 1,\r\n      'margin-left'     : 2,\r\n      'margin-right'    : 2,\r\n      'margin-top'      : 1,\r\n      padding           : 2,\r\n      width             : 32,\r\n    },\r\n    depressed         : {\r\n      'background-color': 'rgba(42,61,77,0.8)',\r\n      'border-color'    : 'black',\r\n      'border-radius'   : 5,\r\n      'border-width'    : 1,\r\n      height            : 32,\r\n      'margin-bottom'   : 1,\r\n      'margin-left'     : 2,\r\n      'margin-right'    : 2,\r\n      'margin-top'      : 1,\r\n      padding           : 2,\r\n      width             : 32,\r\n    },\r\n    'background-color': 'rgba(15,15,15, 0)',\r\n    'border-color'    : 'rgba(237,209,209, 1)',\r\n    'border-radius'   : 5,\r\n    'border-width'    : 0,\r\n    drawCheck         : true,\r\n    height            : 32,\r\n    'margin-bottom'   : 1,\r\n    'margin-left'     : 2,\r\n    'margin-right'    : 2,\r\n    'margin-top'      : 1,\r\n    padding           : 2,\r\n    width             : 32,\r\n  },\r\n\r\n  label: {\r\n    LabelText: new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 14,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n  },\r\n\r\n  listbox: {\r\n    ListActive   : 'rgba(200, 205, 215, 1.0)',\r\n    ListHighlight: 'rgba(155, 220, 255, 0.5)',\r\n    height       : 200,\r\n    width        : 110,\r\n  },\r\n\r\n  menu: {\r\n    MenuBG          : 'rgba(250, 250, 250, 1.0)',\r\n    \"item-radius\"   : 0,\r\n    MenuBorder      : '1px solid grey',\r\n    MenuHighlight   : 'rgba(155, 220, 255, 1.0)',\r\n    MenuSeparator   : {\r\n      width             : \"100%\",\r\n      height            : 2,\r\n      padding           : 0,\r\n      margin            : 0,\r\n      border            : \"none\",\r\n      \"background-color\": \"grey\"\r\n    },\r\n    'box-shadow'    : '5px 5px 25px rgba(0,0,0,0.75)',\r\n    MenuSpacing     : 5,\r\n    MenuText        : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 12,\r\n      color  : 'rgba(25, 25, 25, 1.0)'\r\n    }),\r\n    \"padding-top\"   : 0,\r\n    \"padding-left\"  : 0,\r\n    \"padding-right\" : 0,\r\n    \"padding-bottom\": 0,\r\n    'border-color'  : 'grey',\r\n    'border-radius' : 5,\r\n    'border-style'  : 'solid',\r\n    'border-width'  : 1,\r\n  },\r\n\r\n  notification: {\r\n    DefaultText       : new CSSFont({\r\n      font   : 'poppins',\r\n      weight : 'bold',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 12,\r\n      color  : 'rgb(55,55,55)'\r\n    }),\r\n    \"background-color\": \"rgba(72,72,72,0)\",\r\n    \"border-radius\"   : 5,\r\n    \"border-color\"    : \"grey\",\r\n    \"border-width\"    : 1,\r\n    \"border-style\"    : \"solid\",\r\n    ProgressBarBG     : \"rgb(74,148,183)\",\r\n    ProgressBar       : \"rgb(250,132,58)\",\r\n  },\r\n\r\n  numslider: {\r\n    'background-color': 'rgba(219,219,219, 1)',\r\n    'border-color'    : 'black',\r\n    'border-radius'   : 1,\r\n    height            : 18,\r\n    width             : 90,\r\n  },\r\n\r\n  numslider_simple: {\r\n    SlideHeight       : 10,\r\n    TextBoxWidth      : 45,\r\n    'background-color': 'rgba(219,219,219, 1)',\r\n    height            : 18,\r\n    labelOnTop        : true,\r\n    width             : 135,\r\n  },\r\n\r\n  numslider_textbox: {\r\n    TextBoxHeight     : 25,\r\n    TextBoxWidth      : 50,\r\n    'background-color': 'rgba(219,219,219, 1)',\r\n    height            : 25,\r\n    labelOnTop        : true,\r\n    width             : 120,\r\n  },\r\n\r\n  panel: {\r\n    HeaderBorderRadius    : 5.329650280441558,\r\n    HeaderRadius          : 4,\r\n    TitleBackground       : 'rgba(177,219,255, 1)',\r\n    TitleBorder           : 'rgba(104,104,104, 1)',\r\n    TitleText             : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 14,\r\n      color  : 'rgba(0,0,0, 1)'\r\n    }),\r\n    'background-color'    : 'rgba(184,184,184, 0.7594818376068376)',\r\n    'border-color'        : 'rgba(0,0,0, 0.5598061397157866)',\r\n    'border-radius'       : 4,\r\n    'border-style'        : 'groove',\r\n    'border-width'        : 1.141,\r\n    'margin-bottom'       : 0,\r\n    'margin-bottom-closed': 0,\r\n    'margin-left'         : 5.6584810220495445,\r\n    'margin-right'        : 0,\r\n    'margin-top'          : 0,\r\n    'margin-top-closed'   : 0,\r\n    'padding-bottom'      : 0,\r\n    'padding-left'        : 0,\r\n    'padding-right'       : 0,\r\n    'padding-top'         : 0,\r\n  },\r\n\r\n  richtext: {\r\n    DefaultText       : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 16,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n    'background-color': 'rgb(245, 245, 245)',\r\n  },\r\n\r\n  screenborder: {\r\n    'border-inner'   : 'grey',\r\n    'border-outer'   : 'rgba(228,228,228, 1)',\r\n    'border-width'   : 2,\r\n    'mouse-threshold': 8,\r\n  },\r\n\r\n  scrollbars: {\r\n    border  : undefined,\r\n    color   : undefined,\r\n    color2  : undefined,\r\n    contrast: undefined,\r\n    width   : undefined,\r\n  },\r\n\r\n  sidebar: {\r\n    'background-color': 'rgba(55, 55, 55, 0.5)',\r\n  },\r\n\r\n  strip: {\r\n    'background-color': 'rgba(75,75,75, 0.33213141025641024)',\r\n    'border-color'    : 'rgba(0,0,0, 0.31325409987877156)',\r\n    'border-radius'   : 8.76503417507447,\r\n    'border-style'    : 'solid',\r\n    'border-width'    : 1,\r\n    margin            : 2,\r\n    oneAxisPadding    : 2,\r\n    padding           : 1,\r\n    \"flex-grow\"       : \"unset\",\r\n  },\r\n\r\n  tabs: {\r\n    \"movable-tabs\"    : \"true\",\r\n    TabActive         : 'rgba(212,212,212, 1)',\r\n    TabBarRadius      : 6,\r\n    TabHighlight      : 'rgba(50, 50, 50, 0.2)',\r\n    TabInactive       : 'rgba(183,183,183, 1)',\r\n    TabStrokeStyle1   : 'rgba(0,0,0, 1)',\r\n    TabStrokeStyle2   : 'rgba(0,0,0, 1)',\r\n    TabText           : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'bold',\r\n      style  : 'normal',\r\n      size   : 15,\r\n      color  : 'rgba(0,0,0, 1)'\r\n    }),\r\n    'background-color': 'rgba(222,222,222, 1)',\r\n  },\r\n\r\n  textbox: {\r\n    DefaultText       : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 14,\r\n      color  : 'rgba(3,3,3, 1)'\r\n    }),\r\n    'background-color': 'rgba(245,245,245, 1)',\r\n  },\r\n\r\n  tooltip: {\r\n    ToolTipText       : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'bold',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 12,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n    'background-color': 'rgba(255,255,255, 1)',\r\n    'border-color'    : 'rgba(139,139,139, 1)',\r\n    'border-radius'   : 3,\r\n    'border-style'    : 'solid',\r\n    'border-width'    : 1,\r\n    padding           : 5,\r\n  },\r\n\r\n  treeview: {\r\n    itemIndent: 10,\r\n    rowHeight : 18,\r\n  },\r\n\r\n  vecPopupButton: {\r\n    height : 18,\r\n    padding: 3,\r\n    width  : 100,\r\n  },\r\n\r\n};\r\n","\"use strict\";\r\n\r\n/*\r\nIcons are defined in spritesheets that live in\r\nthe iconsheet16/32 dom nodes.  Icons are numbered start from\r\nthe upper left sprite tile.\r\n\r\nThis function sets the mapping between icon numbers and names.\r\n\r\nThe following icons should be in the icon sheet and in this map:\r\n\r\nRESIZE      :\r\nSMALL_PLUS  :\r\nTRANSLATE   : for moving things\r\nUI_EXPAND   : panel open icon\r\nUI_COLLAPSE : panel close icon\r\nNOTE_EXCL   : exclamation mark for notifications\r\nHELP        : help symbol\r\n*/\r\nexport function setIconMap(icons) {\r\n  for (let k in icons) {\r\n    Icons[k] = icons[k];\r\n  }\r\n}\r\n\r\nlet a = 0;\r\nexport let Icons = {\r\n  FOLDER: a++,\r\n  FILE  : a++,\r\n  TINY_X: a++,\r\n\r\n  SMALL_PLUS : a++,\r\n  SMALL_MINUS: a++,\r\n  UNDO       : a++,\r\n\r\n  REDO: a++,\r\n  HELP: a++,\r\n\r\n  UNCHECKED   : a++,\r\n  CHECKED     : a++,\r\n  LARGE_CHECK : a++,\r\n  CURSOR_ARROW: a++,\r\n  NOTE_EXCL   : a++,\r\n  SCROLL_DOWN : a++,\r\n  SCROLL_UP   : a++,\r\n  BACKSPACE   : a++,\r\n  LEFT_ARROW  : a++,\r\n  RIGHT_ARROW : a++,\r\n  UI_EXPAND   : a++, //triangle\r\n  UI_COLLAPSE : a++, //triangle\r\n\r\n\r\n  BOLD         : a++,\r\n  ITALIC       : a++,\r\n  UNDERLINE    : a++,\r\n  STRIKETHRU   : a++,\r\n  TREE_EXPAND  : a++,\r\n  TREE_COLLAPSE: a++,\r\n  ZOOM_OUT     : a++,\r\n  ZOOM_IN      : a++\r\n};\r\n/* used for icon checkboxes with overlayed check marks */\r\nIcons.ENUM_CHECKED = Icons.CHECKED;\r\nIcons.ENUM_UNCHECKED = Icons.UNCHECKED;\r\n\r\n\r\n","let exclude = new Set([\r\n  \"toString\", \"constructor\", \"prototype\", \"__proto__\", \"toLocaleString\",\r\n  \"hasOwnProperty\", \"shadow\"\r\n]);\r\n\r\nlet UIBase = undefined;\r\n\r\n//deal with circular module refrence\r\nexport function _setUIBase(uibase) {\r\n  UIBase = uibase;\r\n}\r\n\r\nlet AspectKeys = Symbol(\"aspect-keys\");\r\n\r\nexport function initAspectClass(object, blacklist = new Set()) {\r\n  let cls = object.constructor;\r\n\r\n  if (!cls[AspectKeys]) {\r\n    cls[AspectKeys] = [];\r\n    let keys = [];\r\n\r\n    let p = object.__proto__;\r\n    while (p) {\r\n      keys = keys.concat(Reflect.ownKeys(p));\r\n      p = p.__proto__;\r\n    }\r\n    keys = new Set(keys);\r\n\r\n    function validProperty(obj, key) {\r\n      let descr = Object.getOwnPropertyDescriptor(obj, key);\r\n\r\n      if (descr && (descr.get || descr.set)) {\r\n        return false;\r\n      }\r\n\r\n      let p = obj.constructor;\r\n      do {\r\n        if (p.prototype) {\r\n          let descr = Object.getOwnPropertyDescriptor(p.prototype, key);\r\n\r\n          if (descr && (descr.set || descr.get)) {\r\n            return false;\r\n          }\r\n        }\r\n\r\n        p = p.__proto__;\r\n      } while (p && p !== p.__proto__);\r\n\r\n      return true;\r\n    }\r\n\r\n    for (let k of keys) {\r\n      let v;\r\n\r\n      if (typeof k === \"string\" && k.startsWith(\"_\")) {\r\n        continue;\r\n      }\r\n\r\n      if (k === \"constructor\") {\r\n        continue;\r\n      }\r\n\r\n      if (blacklist.has(k) || exclude.has(k)) {\r\n        continue;\r\n      }\r\n\r\n      if (!validProperty(object, k)) {\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        v = object[k];\r\n      } catch (error) {\r\n        continue;\r\n      }\r\n\r\n      if (typeof v !== \"function\") {\r\n        continue;\r\n      }\r\n\r\n      cls[AspectKeys].push(k);\r\n    }\r\n  }\r\n\r\n  object.__aspect_methods = new Set();\r\n\r\n  for (let k of cls[AspectKeys]) {\r\n    AfterAspect.bind(object, k);\r\n  }\r\n}\r\n\r\nexport function clearAspectCallbacks(obj) {\r\n  for (let key of obj.__aspect_methods) {\r\n    obj[key].clear();\r\n  }\r\n}\r\n\r\n/**\r\n *\r\n * example:\r\n *\r\n * someobject.update.after(() => {\r\n *   do_something();\r\n *   return someobject.update.value;\r\n * }\r\n *\r\n * */\r\nexport class AfterAspect {\r\n  constructor(owner, key) {\r\n    this.owner = owner;\r\n    this.key = key;\r\n\r\n    this.chain = [[owner[key], false]];\r\n    this.chain2 = [[owner[key], false]];\r\n\r\n    this.root = [[owner[key], false]];\r\n\r\n    let this2 = this;\r\n\r\n    let method = this._method = function () {\r\n      let chain = this2.chain;\r\n      let chain2 = this2.chain2;\r\n\r\n      chain2.length = chain.length;\r\n\r\n      for (let i = 0; i < chain.length; i++) {\r\n        chain2[i] = chain[i];\r\n      }\r\n\r\n      for (let i = 0; i < chain2.length; i++) {\r\n        let [cb, node, once] = chain2[i];\r\n\r\n        if (node) {\r\n          let isDead = !node.isConnected;\r\n\r\n          if (node instanceof UIBase) {\r\n            isDead = isDead || node.isDead();\r\n          }\r\n\r\n          if (isDead) {\r\n            console.warn(\"pruning dead AfterAspect callback\", node);\r\n            chain.remove(chain2[i]);\r\n            continue;\r\n          }\r\n        }\r\n\r\n\r\n        if (once && chain.indexOf(chain2[i]) >= 0) {\r\n          chain.remove(chain2[i]);\r\n        }\r\n\r\n        if (cb && cb.apply) {\r\n          method.value = cb.apply(this, arguments);\r\n          //method.value = Reflect.apply(cb, this, arguments);\r\n          //cb.apply(this, args);\r\n        }\r\n      }\r\n\r\n      let ret = method.value;\r\n      method.value = undefined;\r\n\r\n      return ret;\r\n    };\r\n\r\n    this._method_bound = false;\r\n\r\n    method.after = this.after.bind(this);\r\n    method.once = this.once.bind(this);\r\n    method.remove = this.remove.bind(this);\r\n\r\n    owner[key].after = this.after.bind(this);\r\n    owner[key].once = this.once.bind(this);\r\n    owner[key].remove = this.remove.bind(this);\r\n  }\r\n\r\n  static bind(owner, key) {\r\n    owner.__aspect_methods.add(key);\r\n\r\n    return new AfterAspect(owner, key);\r\n  }\r\n\r\n  remove(cb) {\r\n    for (let item of this.chain) {\r\n      if (item[0] === cb) {\r\n        this.chain.remove(item);\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  once(cb, node) {\r\n    return this.after(cb, node, true);\r\n  }\r\n\r\n  _checkbind() {\r\n    if (!this._method_bound) {\r\n      this.owner[this.key] = this._method;\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this._checkbind();\r\n    this.chain = [[this.root[0][0], this.root[0][1]]];\r\n    this.chain2 = [[this.root[0][0], this.root[0][1]]];\r\n\r\n    return this;\r\n  }\r\n\r\n  before(cb, node, once) {\r\n    this._checkbind();\r\n\r\n    if (cb === undefined) {\r\n      console.warn(\"invalid call to .after(); cb was undefined\");\r\n      return;\r\n    }\r\n    this.chain = [[cb, node, once]].concat(this.chain);\r\n  }\r\n\r\n  after(cb, node, once) {\r\n    this._checkbind();\r\n\r\n    if (cb === undefined) {\r\n      console.warn(\"invalid call to .after(); cb was undefined\");\r\n      return;\r\n    }\r\n    this.chain.push([cb, node, once]);\r\n  }\r\n}\r\n","import {contextWrangler} from '../screen/area_wrangler.js';\r\n\r\nlet _ui_base = undefined;\r\n\r\n//avoid circular module references\r\nlet TextBox = undefined;\r\n\r\nexport function _setTextboxClass(cls) {\r\n  TextBox = cls;\r\n}\r\n\r\n//import * as ui_save from './ui_save.js';\r\n\r\n/*\r\nif (window.document && document.body) {\r\n  console.log(\"ensuring body.style.margin/padding are zero\");\r\n  document.body.style[\"margin\"] = \"0px\";\r\n  document.body.style[\"padding\"] = \"0px\";\r\n}\r\n */\r\n\r\nimport {Animator} from \"./anim.js\";\r\nimport './units.js';\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as math from '../path-controller/util/math.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport {\r\n  pushModalLight, popModalLight, copyEvent, pathDebugEvent,\r\n  haveModal, keymap, reverse_keymap, pushPointerModal\r\n} from '../path-controller/util/simple_events.js';\r\nimport {getDataPathToolOp} from '../path-controller/controller/controller.js';\r\nimport * as units from './units.js';\r\nimport {rgb_to_hsv, hsv_to_rgb} from \"../util/colorutils.js\";\r\n\r\nexport * from './ui_theme.js';\r\n\r\nimport {CSSFont, theme, parsepx, compatMap} from \"./ui_theme.js\";\r\n\r\nimport {DefaultTheme} from './theme.js';\r\n\r\n//global list of elements to, hopefully, prevent minification tree shaking\r\n//of live elements\r\nexport let ElementClasses = [];\r\n\r\nexport {theme} from \"./ui_theme.js\";\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nwindow.__cconst = cconst;\r\n\r\nlet Vector4 = vectormath.Vector4;\r\n\r\nexport {Icons} from '../icon_enum.js';\r\nimport {Icons} from '../icon_enum.js';\r\n\r\nexport {setIconMap} from '../icon_enum.js';\r\nimport {setIconMap} from '../icon_enum.js';\r\n\r\nimport {AfterAspect, initAspectClass} from \"./aspect.js\";\r\nimport * as aspect from './aspect.js';\r\n\r\nconst EnumProperty = toolprop.EnumProperty;\r\n\r\nlet Area;\r\nexport let _setAreaClass = (cls) => {\r\n  Area = cls;\r\n}\r\n\r\nexport const ErrorColors = {\r\n  WARNING: \"yellow\",\r\n  ERROR  : \"red\",\r\n  OK     : \"green\"\r\n};\r\n\r\nwindow.__theme = theme;\r\n\r\nlet registered_has_happened = false;\r\nlet tagPrefix = \"\";\r\nconst EventCBSymbol = Symbol(\"wrapped event callback\");\r\n\r\nfunction calcElemCBKey(elem, type, options) {\r\n  return elem._id + \":\" + type + \":\" + JSON.stringify(options || {});\r\n}\r\n\r\n/**\r\n * Sets tag prefix for pathux html elements.\r\n * Must be called prior to loading other modules.\r\n * Since this is tricky, you can alternatively\r\n * add a script tag with the prefix with the id \"pathux-tag-prefix\",\r\n * e.g.<pre> <script type=\"text/plain\" id=\"pathux-tag-prefix\">prefix</script> </pre>\r\n * */\r\nexport function setTagPrefix(prefix) {\r\n  if (registered_has_happened) {\r\n    throw new Error(\"have to call ui_base.setTagPrefix before loading any other path.ux modules\");\r\n  }\r\n\r\n  tagPrefix = \"\" + prefix;\r\n}\r\n\r\nexport function getTagPrefix(prefix) {\r\n  return tagPrefix;\r\n}\r\n\r\nlet prefix = document.getElementById(\"pathux-tag-prefix\");\r\nif (prefix) {\r\n  console.log(\"Found pathux-tag-prefix element\");\r\n  prefix = prefix.innerText.trim();\r\n  setTagPrefix(prefix);\r\n}\r\n\r\nimport {ClassIdSymbol} from './ui_consts.js';\r\nexport {ClassIdSymbol};\r\n\r\nlet class_idgen = 1;\r\n\r\nexport function setTheme(theme2) {\r\n  //merge theme\r\n  for (let k in theme2) {\r\n    let v = theme2[k];\r\n\r\n    if (typeof v !== \"object\") {\r\n      theme[k] = v;\r\n      continue;\r\n    }\r\n\r\n    let v0 = theme[k];\r\n\r\n    if (!(k in theme)) {\r\n      theme[k] = {};\r\n    }\r\n\r\n    for (let k2 in v) {\r\n      //if (v0 && !(k2 in v0)) {\r\n      //  continue;\r\n      //}\r\n\r\n      if (k2 in compatMap) {\r\n        let k3 = compatMap[k2];\r\n\r\n        if (v[k3] === undefined) {\r\n          v[k3] = v[k2];\r\n        }\r\n\r\n        delete v[k2];\r\n        k2 = k3;\r\n      }\r\n\r\n      theme[k][k2] = v[k2];\r\n    }\r\n  }\r\n}\r\n\r\nsetTheme(DefaultTheme);\r\n\r\nlet _last_report = util.time_ms();\r\n\r\nexport function report() {\r\n  if (util.time_ms() - _last_report > 350) {\r\n    console.warn(...arguments);\r\n    _last_report = util.time_ms();\r\n  }\r\n}\r\n\r\n//this function is deprecated\r\nexport function getDefault(key, elem) {\r\n  console.warn(\"Deprecated call to ui_base.js:getDefault\");\r\n\r\n  if (key in theme.base) {\r\n    return theme.base[key];\r\n  } else {\r\n    throw new Error(\"Unknown default \" + key);\r\n  }\r\n}\r\n\r\n//XXX implement me!\r\nexport function IsMobile() {\r\n  console.warn(\"ui_base.IsMobile is deprecated; use util.isMobile instead\")\r\n  return util.isMobile();\r\n};\r\n\r\nlet keys = [\"margin\", \"padding\", \"margin-block-start\", \"margin-block-end\"];\r\nkeys = keys.concat([\"padding-block-start\", \"padding-block-end\"]);\r\n\r\nkeys = keys.concat([\"margin-left\", \"margin-top\", \"margin-bottom\", \"margin-right\"]);\r\nkeys = keys.concat([\"padding-left\", \"padding-top\", \"padding-bottom\", \"padding-right\"]);\r\nexport const marginPaddingCSSKeys = keys;\r\n\r\n\r\nclass _IconManager {\r\n  constructor(image, tilesize, number_of_horizontal_tiles, drawsize) {\r\n    this.tilex = number_of_horizontal_tiles;\r\n    this.tilesize = tilesize;\r\n    this.drawsize = drawsize;\r\n\r\n    this.customIcons = new Map();\r\n\r\n    this.image = image;\r\n    this.promise = undefined;\r\n    this._accept = undefined;\r\n    this._reject = undefined;\r\n  }\r\n\r\n  get ready() {\r\n    return this.image && this.image.width;\r\n  }\r\n\r\n  onReady() {\r\n    if (this.ready) {\r\n      return new Promise((accept, reject) => {\r\n        accept(this);\r\n      });\r\n    }\r\n\r\n    if (this.promise) {\r\n      return this.promise;\r\n    }\r\n\r\n    let onload = this.image.onload;\r\n    this.image.onload = (e) => {\r\n      if (onload) {\r\n        onload.call(this.image, e);\r\n      }\r\n\r\n      if (!this._accept) {\r\n        return;\r\n      }\r\n\r\n      let accept = this._accept;\r\n      this._accept = this._reject = this.promise = undefined;\r\n\r\n      if (this.image.width) {\r\n        accept(this);\r\n      }\r\n    }\r\n\r\n    this.promise = new util.TimeoutPromise((accept, reject) => {\r\n      this._accept = accept;\r\n      this._reject = reject;\r\n    }, 15000, true); /* silently rejects on timeout */\r\n\r\n    this.promise.catch(error => {\r\n      util.print_stack(error);\r\n      this.promise = this._accept = this._reject = undefined;\r\n    });\r\n\r\n    return this.promise;\r\n  }\r\n\r\n  canvasDraw(elem, canvas, g, icon, x = 0, y = 0) {\r\n    let customIcon = this.customIcons.get(icon);\r\n\r\n    if (customIcon) {\r\n      g.drawImage(customIcon.canvas, x, y);\r\n      return;\r\n    }\r\n\r\n    let tx = icon%this.tilex;\r\n    let ty = ~~(icon/this.tilex);\r\n\r\n    let dpi = elem.getDPI();\r\n    let ts = this.tilesize;\r\n    let ds = this.drawsize;\r\n\r\n    if (!this.image) {\r\n      //console.warn(\"Failed to render an iconsheet\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      g.drawImage(this.image, tx*ts, ty*ts, ts, ts, x, y, ds*dpi, ds*dpi);\r\n    } catch (error) {\r\n      console.log(\"failed to draw an icon\");\r\n    }\r\n  }\r\n\r\n  setCSS(icon, dom, fitsize = undefined) {\r\n    if (!fitsize) {\r\n      fitsize = this.drawsize;\r\n    }\r\n\r\n    if (typeof fitsize === \"object\") {\r\n      fitsize = Math.max(fitsize[0], fitsize[1]);\r\n    }\r\n\r\n    dom.style[\"background\"] = this.getCSS(icon, fitsize);\r\n    if (this.customIcons.has(icon)) {\r\n      dom.style[\"background-size\"] = (fitsize) + \"px\";\r\n    } else {\r\n      dom.style[\"background-size\"] = (fitsize*this.tilex) + \"px\";\r\n    }\r\n\r\n    dom.style[\"background-clip\"] = \"content-box\";\r\n\r\n    if (!dom.style[\"width\"]) {\r\n      dom.style[\"width\"] = this.drawsize + \"px\";\r\n    }\r\n    if (!dom.style[\"height\"]) {\r\n      dom.style[\"height\"] = this.drawsize + \"px\";\r\n    }\r\n  }\r\n\r\n  //icon is an integer\r\n  getCSS(icon, fitsize = this.drawsize) {\r\n    if (icon === -1) { //-1 means no icon\r\n      return '';\r\n    }\r\n\r\n    if (typeof fitsize === \"object\") {\r\n      fitsize = Math.max(fitsize[0], fitsize[1]);\r\n    }\r\n\r\n    let ratio = fitsize/this.tilesize;\r\n\r\n    let customIcon = this.customIcons.get(icon);\r\n    if (customIcon !== undefined) {\r\n      //ratio = fitsize / this.drawsize;\r\n      //let d = this.drawsize*0.25;\r\n      let d = 0.0;\r\n\r\n      let css = `url(\"${customIcon.blobUrl}\")`;\r\n\r\n      return css;\r\n    }\r\n\r\n    let x = (-(icon%this.tilex)*this.tilesize)*ratio;\r\n    let y = (-(~~(icon/this.tilex))*this.tilesize)*ratio;\r\n\r\n    //x = ~~x;\r\n    //y = ~~y;\r\n\r\n    //console.log(this.tilesize, this.drawsize, x, y);\r\n    //let ts = this.tilesize;\r\n    //return `image('${this.image.src}#xywh=${x},${y},${ts},${ts}')`;\r\n    return `url(\"${this.image.src}\") ${x}px ${y}px`;\r\n  }\r\n}\r\n\r\nexport class CustomIcon {\r\n  constructor(manager, key, id, baseImage) {\r\n    this.key = key;\r\n    this.baseImage = baseImage;\r\n    this.images = []\r\n    this.id = id;\r\n    this.manager = manager;\r\n  }\r\n\r\n  regenIcons() {\r\n    let manager = this.manager;\r\n\r\n    let doSheet = (sheet) => {\r\n      let size = sheet.drawsize;\r\n      let canvas = document.createElement(\"canvas\");\r\n      let g = canvas.getContext(\"2d\");\r\n\r\n      canvas.width = canvas.height = size;\r\n      g.drawImage(this.baseImage, 0, 0, size, size);\r\n\r\n      canvas.toBlob((blob) => {\r\n        let blobUrl = URL.createObjectURL(blob);\r\n\r\n        sheet.customIcons.set(this.id, {\r\n          blobUrl,\r\n          canvas\r\n        });\r\n      })\r\n    }\r\n\r\n    for (let sheet of manager.iconsheets) {\r\n      doSheet(sheet);\r\n    }\r\n  }\r\n}\r\n\r\nexport class IconManager {\r\n  /**\r\n   images is a list of dom ids of img tags\r\n\r\n   sizes is a list of tile sizes, one per image.\r\n   you can control the final *draw* size by passing an array\r\n   of [tilesize, drawsize] instead of just a number.\r\n   */\r\n  constructor(images, sizes, horizontal_tile_count) {\r\n    this.iconsheets = [];\r\n    this.tilex = horizontal_tile_count;\r\n\r\n    this.customIcons = new Map();\r\n    this.customIconIDMap = new Map();\r\n\r\n    for (let i = 0; i < images.length; i++) {\r\n      let size, drawsize;\r\n\r\n      if (typeof sizes[i] == \"object\") {\r\n        size = sizes[i][0], drawsize = sizes[i][1];\r\n      } else {\r\n        size = drawsize = sizes[i];\r\n      }\r\n\r\n      if (util.isMobile()) {\r\n        drawsize = ~~(drawsize*theme.base.mobileSizeMultiplier);\r\n      }\r\n\r\n      this.iconsheets.push(new _IconManager(images[i], size, horizontal_tile_count, drawsize));\r\n    }\r\n  }\r\n\r\n  isReady(sheet = 0) {\r\n    return this.iconsheets[sheet].ready;\r\n  }\r\n\r\n  addCustomIcon(key, image) {\r\n    let icon = this.customIcons.get(key);\r\n\r\n    if (!icon) {\r\n      let maxid = 0;\r\n\r\n      for (let k in Icons) {\r\n        maxid = Math.max(maxid, Icons[k] + 1);\r\n      }\r\n      for (let icon of this.customIcons.values()) {\r\n        maxid = Math.max(maxid, icon.id + 1);\r\n      }\r\n\r\n      maxid = Math.max(maxid, 1000); //just to be on the safe side\r\n\r\n      let id = maxid;\r\n      icon = new CustomIcon(this, key, id, image);\r\n\r\n      this.customIcons.set(key, icon);\r\n      this.customIconIDMap.set(id, icon);\r\n    }\r\n\r\n    icon.baseImage = image;\r\n    icon.regenIcons();\r\n\r\n    return icon.id;\r\n  }\r\n\r\n  load(manager2) {\r\n    this.iconsheets = manager2.iconsheets;\r\n    this.tilex = manager2.tilex;\r\n\r\n    return this;\r\n  }\r\n\r\n  reset(horizontal_tile_count) {\r\n    this.iconsheets.length = 0;\r\n    this.tilex = horizontal_tile_count;\r\n  }\r\n\r\n  add(image, size, drawsize = size) {\r\n    this.iconsheets.push(new _IconManager(image, size, this.tilex, drawsize));\r\n    return this;\r\n  }\r\n\r\n  canvasDraw(elem, canvas, g, icon, x = 0, y = 0, sheet = 0) {\r\n    let base = this.iconsheets[sheet];\r\n\r\n    sheet = this.findSheet(sheet);\r\n    let ds = sheet.drawsize;\r\n\r\n    sheet.drawsize = base.drawsize;\r\n    sheet.canvasDraw(elem, canvas, g, icon, x, y);\r\n    sheet.drawsize = ds;\r\n  }\r\n\r\n  findClosestSheet(size) {\r\n    let sheets = this.iconsheets.concat([]);\r\n\r\n    sheets.sort((a, b) => a.drawsize - b.drawsize);\r\n    let sheet;\r\n\r\n    for (let i = 0; i < sheets.length; i++) {\r\n      if (sheets[i].drawsize <= size) {\r\n        sheet = sheets[i];\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (!sheet)\r\n      sheet = sheets[sheets.length - 1];\r\n\r\n    return this.iconsheets.indexOf(sheet);\r\n  }\r\n\r\n  findSheet(sheet) {\r\n    if (sheet === undefined) {\r\n      console.warn(\"sheet was undefined\");\r\n      sheet = 0;\r\n    }\r\n\r\n    let base = this.iconsheets[sheet];\r\n\r\n    /**sigh**/\r\n    let dpi = UIBase.getDPI();\r\n    let minsheet = undefined;\r\n    let goal = dpi*base.drawsize;\r\n\r\n    for (let sheet of this.iconsheets) {\r\n      minsheet = sheet;\r\n\r\n      if (sheet.drawsize >= goal) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return minsheet === undefined ? base : minsheet;\r\n  }\r\n\r\n  getTileSize(sheet = 0) {\r\n    return this.iconsheets[sheet].drawsize;\r\n    return this.findSheet(sheet).drawsize;\r\n  }\r\n\r\n  getRealSize(sheet = 0) {\r\n    return this.iconsheets[sheet].tilesize;\r\n    return this.findSheet(sheet).tilesize;\r\n    //return this.iconsheets[sheet].tilesize;\r\n  }\r\n\r\n  //icon is an integer\r\n  getCSS(icon, sheet = 0) {\r\n    //return this.iconsheets[sheet].getCSS(icon);\r\n    //return this.findSheet(sheet).getCSS(icon);\r\n\r\n    let base = this.iconsheets[sheet];\r\n    sheet = this.findSheet(sheet);\r\n    let ds = sheet.drawsize;\r\n\r\n    sheet.drawsize = base.drawsize;\r\n    let ret = sheet.getCSS(icon);\r\n    sheet.drawsize = ds;\r\n\r\n    return ret;\r\n  }\r\n\r\n  setCSS(icon, dom, sheet = 0, fitsize = undefined) {\r\n    //return this.iconsheets[sheet].setCSS(icon, dom);\r\n\r\n    let base = this.iconsheets[sheet];\r\n    sheet = this.findSheet(sheet);\r\n    let ds = sheet.drawsize;\r\n\r\n    sheet.drawsize = base.drawsize;\r\n    let ret = sheet.setCSS(icon, dom, fitsize);\r\n    sheet.drawsize = ds;\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nexport let iconmanager = new IconManager([\r\n  document.getElementById(\"iconsheet16\"),\r\n  document.getElementById(\"iconsheet32\"),\r\n  document.getElementById(\"iconsheet48\")\r\n], [16, 32, 64], 16);\r\n\r\nwindow._iconmanager = iconmanager; //debug global\r\n\r\n//if client code overrides iconsheets, they must follow logical convention\r\n//that the first one is \"small\" and the second is \"large\"\r\nexport let IconSheets = {\r\n  SMALL : 0,\r\n  LARGE : 1,\r\n  XLARGE: 2\r\n};\r\n\r\nexport function iconSheetFromPackFlag(flag) {\r\n  if (flag & PackFlags.CUSTOM_ICON_SHEET) {\r\n    //console.log(\"Custom Icon Sheet:\", flag>>PackFlags.CUSTOM_ICON_SHEET_START);\r\n    return flag>>PackFlags.CUSTOM_ICON_SHEET_START;\r\n  }\r\n\r\n  if ((flag & PackFlags.SMALL_ICON) && !(PackFlags.LARGE_ICON)) {\r\n    return 0//IconSheets.SMALL; //0\r\n  } else {\r\n    return 1//IconSheets.LARGE; //1\r\n  }\r\n}\r\n\r\nexport function getIconManager() {\r\n  return iconmanager;\r\n}\r\n\r\nexport function setIconManager(manager, IconSheetsOverride) {\r\n  iconmanager.load(manager);\r\n\r\n  if (IconSheetsOverride !== undefined) {\r\n    for (let k in IconSheetsOverride) {\r\n      IconSheets[k] = IconSheetsOverride[k];\r\n    }\r\n  }\r\n}\r\n\r\nexport function makeIconDiv(icon, sheet = 0) {\r\n  let size = iconmanager.getRealSize(sheet);\r\n\r\n  let drawsize = iconmanager.getTileSize(sheet);\r\n\r\n  let icontest = document.createElement(\"div\");\r\n\r\n  icontest.style[\"width\"] = icontest.style[\"min-width\"] = drawsize + \"px\";\r\n  icontest.style[\"height\"] = icontest.style[\"min-height\"] = drawsize + \"px\";\r\n\r\n  //icontest.style[\"background-color\"] = \"orange\";\r\n\r\n  icontest.style[\"margin\"] = \"0px\";\r\n  icontest.style[\"padding\"] = \"0px\";\r\n\r\n  iconmanager.setCSS(icon, icontest, sheet);\r\n\r\n  return icontest;\r\n}\r\n\r\nlet Vector2 = vectormath.Vector2;\r\nlet Matrix4 = vectormath.Matrix4;\r\n\r\nexport let dpistack = [];\r\n\r\nexport const UIFlags = {};\r\n\r\nconst internalElementNames = {};\r\nconst externalElementNames = {};\r\n\r\nexport const PackFlags = {\r\n  INHERIT_WIDTH : 1,\r\n  INHERIT_HEIGHT: 2,\r\n  VERTICAL      : 4,\r\n  USE_ICONS     : 8,\r\n  SMALL_ICON    : 16,\r\n  LARGE_ICON    : 32,\r\n\r\n  FORCE_PROP_LABELS         : 64, //force propeties (Container.prototype.prop()) to always have labels\r\n  PUT_FLAG_CHECKS_IN_COLUMNS: 128, //group flag property checkmarks in columns (doesn't apply to icons)\r\n\r\n  WRAP_CHECKBOXES: 256,\r\n\r\n  //internal flags\r\n  STRIP_HORIZ            : 512,\r\n  STRIP_VERT             : 1024,\r\n  STRIP                  : 512 | 1024,\r\n  SIMPLE_NUMSLIDERS      : 2048,\r\n  FORCE_ROLLER_SLIDER    : 4096,\r\n  HIDE_CHECK_MARKS       : (1<<13),\r\n  NO_NUMSLIDER_TEXTBOX   : (1<<14),\r\n  CUSTOM_ICON_SHEET      : 1<<15,\r\n  CUSTOM_ICON_SHEET_START: 20, //custom icon sheet bits are shifted to here\r\n  NO_UPDATE              : 1<<16\r\n};\r\n\r\nlet first = (iter) => {\r\n  if (iter === undefined) {\r\n    return undefined;\r\n  }\r\n\r\n  if (!(Symbol.iterator in iter)) {\r\n    for (let item in iter) {\r\n      return item;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  for (let item of iter) {\r\n    return item;\r\n  }\r\n}\r\n\r\nimport {DataPathError} from '../path-controller/controller/controller.js';\r\nimport {TimeoutPromise} from '../path-controller/util/util.js';\r\nimport {IntProperty, NumberConstraints, PropFlags} from '../path-controller/toolsys/toolprop.js';\r\n\r\nlet _mobile_theme_patterns = [\r\n  /.*width.*/,\r\n  /.*height.*/,\r\n  /.*size.*/,\r\n  /.*margin.*/,\r\n  /.*pad/,\r\n  /.*radius.*/\r\n];\r\n\r\n\r\nlet _idgen = 0;\r\n\r\nwindow._testSetScrollbars = function (color = \"grey\", contrast = 0.5, width = 15, border = \"solid\") {\r\n  let buf = styleScrollBars(color, undefined, contrast, width, border, \"*\");\r\n  CTX.screen.mergeGlobalCSS(buf);\r\n\r\n  //document.body.style[\"overflow\"] = \"scroll\";\r\n\r\n  /*\r\n  if (!window._tsttag) {\r\n    window._tsttag = document.createElement(\"style\");\r\n    document.body.prepend(_tsttag);\r\n  }\r\n\r\n  _tsttag.textContent = buf;\r\n  //*/\r\n\r\n  return buf;\r\n};\r\n\r\nexport function styleScrollBars(color = \"grey\", color2 = undefined, contrast = 0.5, width = 15,\r\n                                border                                                    = \"1px groove black\", selector = \"*\") {\r\n\r\n  if (!color2) {\r\n    let c = css2color(color);\r\n    let a = c.length > 3 ? c[3] : 1.0;\r\n\r\n    c = rgb_to_hsv(c[0], c[1], c[2]);\r\n    let inv = c.slice(0, c.length);\r\n\r\n    inv[2] = 1.0 - inv[2];\r\n    inv[2] += (c[2] - inv[2])*(1.0 - contrast);\r\n\r\n    inv = hsv_to_rgb(inv[0], inv[1], inv[2]);\r\n\r\n    inv.length = 4;\r\n    inv[3] = a;\r\n\r\n    inv = color2css(inv);\r\n    color2 = inv;\r\n  }\r\n\r\n  let buf = `\r\n\r\n${selector} {\r\n  scrollbar-width : ${width <= 16 ? 'thin' : 'auto'};\r\n  scrollbar-color : ${color2} ${color};\r\n}\r\n\r\n${selector}::-webkit-scrollbar {\r\n  width : ${width}px;\r\n  background-color : ${color};\r\n}\r\n\r\n${selector}::-webkit-scrollbar-track {\r\n  background-color : ${color};\r\n  border : ${border};\r\n}\r\n\r\n${selector}::-webkit-scrollbar-thumb {\r\n  background-color : ${color2};\r\n  border : ${border};\r\n}\r\n    `;\r\n\r\n  //console.log(buf);\r\n  return buf;\r\n}\r\n\r\nwindow.styleScrollBars = styleScrollBars;\r\n\r\nlet _digest = new util.HashDigest();\r\n\r\nexport function calcThemeKey(digest = _digest.reset()) {\r\n  for (let k in theme) {\r\n    let obj = theme[k];\r\n\r\n    if (typeof obj !== \"object\") {\r\n      continue;\r\n    }\r\n\r\n    for (let k2 in obj) {\r\n      let v2 = obj[k2];\r\n\r\n      if (typeof v2 === \"number\" || typeof v2 === \"boolean\" || typeof v2 === \"string\") {\r\n        digest.add(v2);\r\n      } else if (typeof v2 === \"object\" && v2 instanceof CSSFont) {\r\n        v2.calcHashUpdate(digest);\r\n      }\r\n    }\r\n  }\r\n\r\n  return digest.get();\r\n}\r\n\r\nexport var _themeUpdateKey = calcThemeKey();\r\n\r\nexport function flagThemeUpdate() {\r\n  _themeUpdateKey = calcThemeKey();\r\n}\r\n\r\nwindow._flagThemeUpdate = flagThemeUpdate;\r\n\r\nlet setTimeoutQueue = new Set();\r\nlet haveTimeout = false;\r\n\r\nfunction timeout_cb() {\r\n  if (setTimeoutQueue.size === 0) {\r\n    haveTimeout = false;\r\n    return;\r\n  }\r\n\r\n  for (let item of new Set(setTimeoutQueue)) {\r\n    let {cb, timeout, time} = item;\r\n    if (util.time_ms() - time < timeout) {\r\n      continue;\r\n    }\r\n\r\n    setTimeoutQueue.delete(item);\r\n\r\n    try {\r\n      cb();\r\n    } catch (error) {\r\n      console.error(error.stack);\r\n    }\r\n  }\r\n\r\n  window.setTimeout(timeout_cb, 0);\r\n}\r\n\r\nexport function internalSetTimeout(cb, timeout) {\r\n  if (timeout > 100) { //call directly\r\n    window.setTimeout(cb, timeout);\r\n    return;\r\n  }\r\n\r\n  setTimeoutQueue.add({\r\n    cb, timeout, time: util.time_ms()\r\n  });\r\n\r\n  if (!haveTimeout) {\r\n    haveTimeout = true;\r\n    window.setTimeout(timeout_cb, 0);\r\n  }\r\n}\r\n\r\nwindow.setTimeoutQueue = setTimeoutQueue;\r\n\r\nexport class UIBase extends HTMLElement {\r\n  constructor() {\r\n    super();\r\n\r\n    this._modalstack = [];\r\n\r\n    this._tool_tip_abort_delay = undefined;\r\n    this._tooltip_ref = undefined;\r\n\r\n    this._textBoxEvents = false;\r\n\r\n    this._themeOverride = undefined;\r\n\r\n    this._checkTheme = true;\r\n    this._last_theme_update_key = _themeUpdateKey;\r\n\r\n    this._client_disabled_set = undefined;\r\n    //this._parent_disabled_set = 0;\r\n\r\n    this._useNativeToolTips = cconst.useNativeToolTips;\r\n    this._useNativeToolTips_set = false;\r\n    this._has_own_tooltips = undefined;\r\n    this._tooltip_timer = util.time_ms();\r\n\r\n    this.pathUndoGen = 0;\r\n    this._lastPathUndoGen = 0;\r\n    this._useDataPathUndo = undefined;\r\n\r\n    this._active_animations = [];\r\n\r\n    //ref to Link element referencing Screen style node\r\n    //Screen.update_intern sets the contents of this\r\n    this._screenStyleTag = document.createElement(\"style\");\r\n    this._screenStyleUpdateHash = 0;\r\n\r\n    initAspectClass(this, new Set([\"appendChild\", \"animate\", \"shadow\", \"removeNode\", \"prepend\", \"add\", \"init\"]));\r\n\r\n    this.shadow = this.attachShadow({mode: 'open'});\r\n\r\n    if (cconst.DEBUG.paranoidEvents) {\r\n      this.__cbs = [];\r\n    }\r\n\r\n    this.shadow.appendChild(this._screenStyleTag);\r\n    this.shadow._appendChild = this.shadow.appendChild;\r\n\r\n    ///*\r\n    let appendChild = this.shadow.appendChild;\r\n    this.shadow.appendChild = (child) => {\r\n      if (child && typeof child === \"object\" && child instanceof UIBase) {\r\n        child.parentWidget = this;\r\n      }\r\n\r\n      return this.shadow._appendChild(child, ...arguments);\r\n    };\r\n    //*/\r\n\r\n    this._wasAddedToNodeAtSomeTime = false;\r\n\r\n    this.visibleToPick = true;\r\n\r\n    this._override_class = undefined;\r\n    this.parentWidget = undefined;\r\n\r\n    /*\r\n    this.shadow._appendChild = this.shadow.appendChild;\r\n    this.shadow.appendChild = (child) => {\r\n      if (child instanceof UIBase) {\r\n        child.ctx = this.ctx;\r\n        child.parentWidget = this;\r\n\r\n        if (child._useDataPathUndo === undefined) {\r\n          child.useDataPathUndo = this.useDataPathUndo;\r\n        }\r\n      }\r\n\r\n      return this.shadow._appendChild(child);\r\n    };\r\n    //*/\r\n\r\n    let tagname = this.constructor.define().tagname;\r\n    this._id = tagname.replace(/\\-/g, \"_\") + (_idgen++);\r\n\r\n    this.default_overrides = {}; //inherited by child widgets\r\n    this.my_default_overrides = {}; //not inherited to child widgets\r\n    this.class_default_overrides = {};\r\n\r\n    this._last_description = undefined;\r\n    this._description_final = undefined;\r\n\r\n    //getting css to flow down properly can be a pain, so\r\n    //some packing settings are set as bitflags here,\r\n    //see PackFlags\r\n\r\n    /*\r\n    setInterval(() => {\r\n      this.update();\r\n    }, 200);\r\n    //*/\r\n\r\n    this._modaldata = undefined;\r\n    this.packflag = this.getDefault(\"BasePackFlag\");\r\n    this._internalDisabled = false;\r\n    this.__disabledState = false;\r\n    this._disdata = undefined;\r\n    this._ctx = undefined;\r\n\r\n    this._description = undefined;\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n    .DefaultText {\r\n      font: ` + _getFont(this) + `;\r\n    }\r\n    `;\r\n    this.shadow.appendChild(style);\r\n    this._init_done = false;\r\n\r\n    //make default touch handlers that send mouse events\r\n    let do_touch = (e, type, button) => {\r\n      if (haveModal()) {\r\n        return;\r\n      }\r\n\r\n      button = button === undefined ? 0 : button;\r\n      let e2 = copyEvent(e);\r\n\r\n      if (e.touches.length === 0) {\r\n        //hrm, what to do, what to do. . .\r\n      } else {\r\n        let t = e.touches[0];\r\n\r\n        e2.pageX = t.pageX;\r\n        e2.pageY = t.pageY;\r\n        e2.screenX = t.screenX;\r\n        e2.screenY = t.screenY;\r\n        e2.clientX = t.clientX;\r\n        e2.clientY = t.clientY;\r\n        e2.x = t.x;\r\n        e2.y = t.y;\r\n      }\r\n\r\n      e2.button = button;\r\n\r\n      e2 = new MouseEvent(type, e2);\r\n\r\n      e2.was_touch = true;\r\n      e2.stopPropagation = e.stopPropagation.bind(e);\r\n      e2.preventDefault = e.preventDefault.bind(e);\r\n      e2.touches = e.touches;\r\n\r\n      this.dispatchEvent(e2);\r\n    };\r\n\r\n    this.addEventListener(\"touchstart\", (e) => {\r\n      do_touch(e, \"mousedown\", 0);\r\n    }, {passive: false});\r\n    this.addEventListener(\"touchmove\", (e) => {\r\n      do_touch(e, \"mousemove\");\r\n    }, {passive: false});\r\n    this.addEventListener(\"touchcancel\", (e) => {\r\n      do_touch(e, \"mouseup\", 2);\r\n    }, {passive: false});\r\n    this.addEventListener(\"touchend\", (e) => {\r\n      do_touch(e, \"mouseup\", 0);\r\n    }, {passive: false});\r\n\r\n    if (this.constructor.define().havePickClipboard) {\r\n      this._clipboardHotkeyInit();\r\n    }\r\n  }\r\n\r\n  /*\r\n  set default_overrides(v) {\r\n    console.error(\"default_overrides was set\", v);\r\n    this._default_overrides = v;\r\n  }\r\n\r\n  get default_overrides() {\r\n    return this._default_overrides;\r\n  }//*/\r\n\r\n  get useNativeToolTips() {\r\n    return this._useNativeToolTips;\r\n  }\r\n\r\n  set useNativeToolTips(val) {\r\n    this._useNativeToolTips = val;\r\n    this._useNativeToolTips_set = true;\r\n  }\r\n\r\n  get parentWidget() {\r\n    return this._parentWidget;\r\n  }\r\n\r\n  set parentWidget(val) {\r\n    if (val) {\r\n      this._wasAddedToNodeAtSomeTime = true;\r\n    }\r\n\r\n    this._parentWidget = val;\r\n  }\r\n\r\n  get useDataPathUndo() {\r\n    let p = this;\r\n\r\n    while (p) {\r\n      if (p._useDataPathUndo !== undefined) {\r\n        return p._useDataPathUndo;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   causes calls to setPathValue to go through\r\n   toolpath app.datapath_set(path=\"\" newValueJSON=\"\")\r\n\r\n   every child will inherit\r\n   */\r\n  set useDataPathUndo(val) {\r\n    this._useDataPathUndo = val;\r\n  }\r\n\r\n  get description() {\r\n\r\n    return this._description;\r\n  }\r\n\r\n  set description(val) {\r\n    if (val === null) {\r\n      this._description = undefined;\r\n      return;\r\n    }\r\n\r\n    this._description = val;\r\n\r\n    if (val === undefined || val === null) {\r\n      return;\r\n    }\r\n\r\n    if (cconst.showPathsInToolTips && this.hasAttribute(\"datapath\")) {\r\n      let s = \"\" + this._description;\r\n\r\n      let path = this.getAttribute(\"datapath\");\r\n      s += \"\\n    path: \" + path;\r\n\r\n      if (this.hasAttribute(\"mass_set_path\")) {\r\n        let m = this.getAttribute(\"mass_set_path\");\r\n        s += \"\\n    massSetPath: \" + m;\r\n      }\r\n\r\n      this._description_final = s;\r\n    }\r\n\r\n    if (cconst.useNativeToolTips) {\r\n      this.title = \"\" + this._description_final;\r\n    }\r\n  }\r\n\r\n  get background() {\r\n    return this.__background;\r\n  }\r\n\r\n  set background(bg) {\r\n    this.__background = bg;\r\n\r\n    this.overrideDefault(\"background-color\", bg, true);\r\n    this.style[\"background-color\"] = bg;\r\n  }\r\n\r\n  get disabled() {\r\n    //hrm, I could just propegate checks upward. . .\r\n\r\n    if (this.parentWidget && this.parentWidget.disabled) {\r\n      return true;\r\n    }\r\n\r\n    return !!this._client_disabled_set || !!this._internalDisabled;// || !!this._parent_disabled_set;\r\n  }\r\n\r\n  set disabled(v) {\r\n    this._client_disabled_set = v;\r\n    this.__updateDisable(this.disabled);\r\n  }\r\n\r\n  get internalDisabled() {\r\n    return this._internalDisabled;\r\n  }\r\n\r\n  set internalDisabled(val) {\r\n    this._internalDisabled = !!val;\r\n\r\n    this.__updateDisable(this.disabled);\r\n  }\r\n\r\n  get ctx() {\r\n    return this._ctx;\r\n  }\r\n\r\n  set ctx(c) {\r\n    this._ctx = c;\r\n\r\n    this._forEachChildWidget((n) => {\r\n      n.ctx = c;\r\n    });\r\n  }\r\n\r\n  get _reportCtxName() {\r\n    return \"\" + this._id;\r\n  }\r\n\r\n  get modalRunning() {\r\n    return this._modaldata !== undefined;\r\n  }\r\n\r\n  static getIconEnum() {\r\n    return Icons;\r\n  }\r\n\r\n  static setDefault(element) {\r\n    return element;\r\n  }\r\n\r\n  /**DEPRECATED\r\n\r\n   scaling ratio (e.g. for high-resolution displays)\r\n   */\r\n  static getDPI() {\r\n    //if (dpistack.length > 0) {\r\n    //  return dpistack[this.dpistack.length-1];\r\n    //} else {\r\n    //if (util.isMobile()) {\r\n    return window.devicePixelRatio; // * visualViewport.scale;\r\n    //}\r\n\r\n    return window.devicePixelRatio;\r\n    //}\r\n  }\r\n\r\n  static prefix(name) {\r\n    return tagPrefix + name;\r\n  }\r\n\r\n  static internalRegister(cls) {\r\n    cls[ClassIdSymbol] = class_idgen++;\r\n\r\n    registered_has_happened = true;\r\n\r\n    internalElementNames[cls.define().tagname] = this.prefix(cls.define().tagname);\r\n    customElements.define(this.prefix(cls.define().tagname), cls);\r\n  }\r\n\r\n  static getInternalName(name) {\r\n    return internalElementNames[name];\r\n  }\r\n\r\n  static createElement(name, internal = false) {\r\n    if (!internal && name in externalElementNames) {\r\n      return document.createElement(name);\r\n    } else if (name in internalElementNames) {\r\n      return document.createElement(internalElementNames[name]);\r\n    } else {\r\n      return document.createElement(name)\r\n    }\r\n  }\r\n\r\n  static register(cls) {\r\n    registered_has_happened = true;\r\n\r\n    cls[ClassIdSymbol] = class_idgen++;\r\n\r\n    ElementClasses.push(cls);\r\n\r\n    externalElementNames[cls.define().tagname] = cls.define().tagname;\r\n    customElements.define(cls.define().tagname, cls);\r\n  }\r\n\r\n  /**\r\n   * Defines core attributes of the class\r\n   *\r\n   * @example\r\n   *\r\n   * static define() {return {\r\n   *   tagname             : \"custom-element-x\",\r\n   *   style               : \"[style class in theme]\"\r\n   *   subclassChecksTheme : boolean //set to true to disable base class invokation of checkTheme()\r\n   *   havePickClipboard   : boolean //whether element supports mouse hover copy/paste\r\n   *   pasteForAllChildren : boolean //mouse hover paste happens even over child widgets\r\n   *   copyForAllChildren  : boolean //mouse hover copy happens even over child widgets\r\n   * }}\r\n   */\r\n  static define() {\r\n    throw new Error(\"Missing define() for ux element\");\r\n  }\r\n\r\n  setUndo(val) {\r\n    this.useDataPathUndo = val;\r\n    return this;\r\n  }\r\n\r\n  hide(sethide = true) {\r\n    this.hidden = sethide;\r\n\r\n    for (let n of this.shadow.childNodes) {\r\n      n.hidden = sethide;\r\n    }\r\n\r\n    this._forEachChildWidget((n) => {\r\n      n.hide(sethide);\r\n    })\r\n  }\r\n\r\n  getElementById(id) {\r\n    let ret;\r\n\r\n    let rec = (n) => {\r\n      if (ret) {\r\n        return;\r\n      }\r\n\r\n      if (n.getAttribute(\"id\") === id || n.id === id) {\r\n        ret = n;\r\n      }\r\n\r\n      if (n instanceof UIBase && n.constructor.define().tagname === \"panelframe-x\") {\r\n        rec(n.contents);\r\n      } else if (n instanceof UIBase && n.constructor.define().tagname === \"tabcontainer-x\") {\r\n        for (let k in n.tabs) {\r\n          let tab = n.tabs[k];\r\n\r\n          if (tab) {\r\n            rec(tab);\r\n          }\r\n        }\r\n      }\r\n\r\n      for (let n2 of n.childNodes) {\r\n        if (n2 instanceof HTMLElement) {\r\n          rec(n2);\r\n\r\n          if (ret) {\r\n            break;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (n.shadow) {\r\n        for (let n2 of n.shadow.childNodes) {\r\n          if (n2 instanceof HTMLElement) {\r\n            rec(n2);\r\n\r\n            if (ret) {\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    rec(this);\r\n\r\n    return ret;\r\n  }\r\n\r\n  unhide() {\r\n    this.hide(false);\r\n  }\r\n\r\n  findArea() {\r\n    let p = this;\r\n\r\n    while (p) {\r\n      if (p instanceof Area) {\r\n        return p;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    return p;\r\n  }\r\n\r\n  addEventListener(type, cb, options) {\r\n    if (cconst.DEBUG.domEventAddRemove) {\r\n      console.log(\"addEventListener\", type, this._id, options);\r\n    }\r\n\r\n    let cb2 = (e) => {\r\n      if (cconst.DEBUG.paranoidEvents) {\r\n        if (this.isDead()) {\r\n          this.removeEventListener(type, cb, options);\r\n          return;\r\n        }\r\n      }\r\n\r\n      if (cconst.DEBUG.domEvents) {\r\n        pathDebugEvent(e);\r\n      }\r\n\r\n      let area = this.findArea();\r\n\r\n      if (area) {\r\n        area.push_ctx_active();\r\n        try {\r\n          let ret = cb(e);\r\n          area.pop_ctx_active();\r\n          return ret;\r\n        } catch (error) {\r\n          area.pop_ctx_active();\r\n          throw error;\r\n        }\r\n      } else {\r\n        if (cconst.DEBUG.areaContextPushes) {\r\n          console.warn(\"Element is not part of an area?\", element);\r\n        }\r\n\r\n        return cb(e);\r\n      }\r\n    };\r\n\r\n    if (!cb[EventCBSymbol]) {\r\n      cb[EventCBSymbol] = new Map();\r\n    }\r\n\r\n    let key = calcElemCBKey(this, type, options);\r\n    cb[EventCBSymbol].set(key, cb2);\r\n\r\n    if (cconst.DEBUG.paranoidEvents) {\r\n      this.__cbs.push([type, cb2, options]);\r\n    }\r\n\r\n    return super.addEventListener(type, cb2, options);\r\n  }\r\n\r\n  removeEventListener(type, cb, options) {\r\n    if (cconst.DEBUG.paranoidEvents) {\r\n      for (let item of this.__cbs) {\r\n        if (item[0] == type && item[1] === cb._cb2 && (\"\" + item[2]) === (\"\" + options)) {\r\n          this.__cbs.remove(item);\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (cconst.DEBUG.domEventAddRemove) {\r\n      console.log(\"removeEventListener\", type, this._id, options);\r\n    }\r\n\r\n    let key = calcElemCBKey(this, type, options);\r\n\r\n    if (!cb[EventCBSymbol] || !cb[EventCBSymbol].has(key)) {\r\n      return super.removeEventListener(type, cb, options);\r\n    } else {\r\n      let cb2 = cb[EventCBSymbol].get(key);\r\n\r\n      let ret = super.removeEventListener(type, cb2, options);\r\n\r\n      cb[EventCBSymbol].delete(key);\r\n      return ret;\r\n    }\r\n  }\r\n\r\n  connectedCallback() {\r\n\r\n  }\r\n\r\n  noMarginsOrPadding() {\r\n    return;\r\n    let keys = [\"margin\", \"padding\", \"margin-block-start\", \"margin-block-end\"];\r\n    keys = keys.concat([\"padding-block-start\", \"padding-block-end\"]);\r\n\r\n    keys = keys.concat([\"margin-left\", \"margin-top\", \"margin-bottom\", \"margin-right\"]);\r\n    keys = keys.concat([\"padding-left\", \"padding-top\", \"padding-bottom\", \"padding-right\"]);\r\n\r\n    for (let k of keys) {\r\n      this.style[k] = \"0px\";\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * find owning screen and tell it to update\r\n   * the global tab order\r\n   * */\r\n  regenTabOrder() {\r\n    let screen = this.getScreen();\r\n    if (screen !== undefined) {\r\n      screen.needsTabRecalc = true;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  noMargins() {\r\n    this.style[\"margin\"] = this.style[\"margin-left\"] = this.style[\"margin-right\"] = \"0px\";\r\n    this.style[\"margin-top\"] = this.style[\"margin-bottom\"] = \"0px\";\r\n    return this;\r\n  }\r\n\r\n  noPadding() {\r\n    this.style[\"padding\"] = this.style[\"padding-left\"] = this.style[\"padding-right\"] = \"0px\";\r\n    this.style[\"padding-top\"] = this.style[\"padding-bottom\"] = \"0px\";\r\n    return this;\r\n  }\r\n\r\n  getTotalRect() {\r\n    let found = false;\r\n\r\n    let min = new Vector2([1e17, 1e17]);\r\n    let max = new Vector2([-1e17, -1e17]);\r\n\r\n    let doaabb = (n) => {\r\n      let rs = n.getClientRects();\r\n\r\n      for (let r of rs) {\r\n        min[0] = Math.min(min[0], r.x);\r\n        min[1] = Math.min(min[1], r.y);\r\n        max[0] = Math.max(max[0], r.x + r.width);\r\n        max[1] = Math.max(max[1], r.y + r.height);\r\n\r\n        found = true;\r\n      }\r\n    };\r\n\r\n    doaabb(this);\r\n\r\n    this._forEachChildWidget((n) => {\r\n      doaabb(n);\r\n    });\r\n\r\n    if (found) {\r\n      return {\r\n        width : max[0] - min[0],\r\n        height: max[1] - min[1],\r\n        x     : min[0],\r\n        y     : min[1],\r\n        left  : min[0],\r\n        top   : min[1],\r\n        right : max[0],\r\n        bottom: max[1]\r\n      };\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  parseNumber(value, args = {}) {\r\n    value = (\"\" + value).trim().toLowerCase();\r\n\r\n    let baseUnit = args.baseUnit || this.baseUnit;\r\n    let isInt = args.isInt || this.isInt;\r\n\r\n    let sign = 1.0;\r\n\r\n    if (value.startsWith(\"-\")) {\r\n      value = value.slice(1, value.length).trim();\r\n      sign = -1;\r\n    }\r\n\r\n    let hexre = /-?[0-9a-f]+h$/;\r\n\r\n    if (value.startsWith(\"0b\")) {\r\n      value = value.slice(2, value.length).trim();\r\n      value = parseInt(value, 2);\r\n    } else if (value.startsWith(\"0x\")) {\r\n      value = value.slice(2, value.length).trim();\r\n      value = parseInt(value, 16);\r\n    } else if (value.search(hexre) === 0) {\r\n      value = value.slice(0, value.length - 1).trim();\r\n      value = parseInt(value, 16);\r\n    } else {\r\n      value = units.parseValue(value, baseUnit);\r\n    }\r\n\r\n    if (isInt) {\r\n      value = ~~value;\r\n    }\r\n\r\n    return value*sign;\r\n  }\r\n\r\n  formatNumber(value, args = {}) {\r\n    let baseUnit = args.baseUnit || this.baseUnit;\r\n    let displayUnit = args.displayUnit || this.displayUnit;\r\n    let isInt = args.isInt || this.isInt;\r\n    let radix = args.radix || this.radix || 10;\r\n    let decimalPlaces = args.decimalPlaces || this.decimalPlaces;\r\n\r\n    //console.log(this.baseUnit, this.displayUnit);\r\n\r\n    if (isInt && radix !== 10) {\r\n      let ret = Math.floor(value).toString(radix);\r\n\r\n      if (radix === 2)\r\n        return \"0b\" + ret;\r\n      else if (radix === 16)\r\n        return ret + \"h\";\r\n    }\r\n\r\n    return units.buildString(value, baseUnit, decimalPlaces, displayUnit);\r\n  }\r\n\r\n  setBoxCSS(subkey) {\r\n    let boxcode = '';\r\n\r\n    //debugger;\r\n\r\n    let keys = [\"left\", \"right\", \"top\", \"bottom\"];\r\n\r\n    let sub;\r\n    if (subkey) {\r\n      sub = this.getAttribute(subkey) || {};\r\n    }\r\n\r\n    let def = (key) => {\r\n      if (sub) {\r\n        return this.getSubDefault(subkey, key);\r\n      }\r\n\r\n      return this.getDefault(key);\r\n    }\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let key = i ? \"padding\" : \"margin\";\r\n\r\n      this.style[key] = \"unset\";\r\n\r\n      let val = def(key);\r\n      if (val !== undefined) { //handle default first\r\n        for (let j = 0; j < 4; j++) {\r\n          this.style[key + \"-\" + keys[j]] = val + \"px\";\r\n        }\r\n      }\r\n\r\n      for (let j = 0; j < 4; j++) { //now do box sides\r\n        let key2 = `${key}-${keys[j]}`;\r\n        let val2 = def(key2);\r\n\r\n        if (val2 !== undefined) {\r\n          this.style[key2] = val2 + \"px\";\r\n        }\r\n      }\r\n\r\n    }\r\n\r\n    this.style[\"border-radius\"] = def(\"border-radius\") + \"px\";\r\n    this.style[\"border\"] = `${def(\"border-width\")}px ${def(\"border-style\")} ${def(\"border-color\")}`;\r\n  }\r\n\r\n  genBoxCSS(subkey) {\r\n    let boxcode = '';\r\n\r\n    let keys = [\"left\", \"right\", \"top\", \"bottom\"];\r\n\r\n    let sub;\r\n    if (subkey) {\r\n      sub = this.getAttribute(subkey) || {};\r\n    }\r\n\r\n    let def = (key) => {\r\n      if (sub) {\r\n        return this.getSubDefault(subkey, key);\r\n      }\r\n\r\n      return this.getDefault(key);\r\n    }\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let key = i ? \"padding\" : \"margin\";\r\n\r\n      let val = def(key);\r\n      if (val !== undefined) {\r\n        boxcode += `${key}: ${val} px;\\n`;\r\n      }\r\n\r\n      for (let j = 0; j < 4; j++) {\r\n        let key2 = `${key}-${keys[j]}`;\r\n        let val2 = def(key2);\r\n\r\n        if (val2 !== undefined) {\r\n          boxcode += `${key2}: ${val}px;\\n`;\r\n        }\r\n      }\r\n    }\r\n\r\n    boxcode += `border-radius: ${def(\"border-radius\")}px;\\n`;\r\n    boxcode += `border: ${def(\"border-width\")}px ${def(\"border-style\")} ${def(\"border-color\")};\\n`;\r\n\r\n    return boxcode;\r\n  }\r\n\r\n  setCSS(setBG = true) {\r\n    if (setBG) {\r\n      let bg = this.getDefault(\"background-color\");\r\n      if (bg) {\r\n        this.style[\"background-color\"] = bg;\r\n      }\r\n    }\r\n\r\n    let zoom = this.getZoom();\r\n    if (zoom === 1.0) {\r\n      return;\r\n    }\r\n\r\n    let transform = \"\" + this.style[\"transform\"];\r\n\r\n    //try to preserve user set transform by selectively deleting scale\r\n    //kind of hackish. . .\r\n\r\n    //normalize whitespace\r\n    transform = transform.replace(/[ \\t\\n\\r]+/g, ' ');\r\n    transform = transform.replace(/, /g, ',');\r\n\r\n    //cut out scale\r\n    let transform2 = transform.replace(/scale\\([^)]+\\)/, '').trim();\r\n    this.style[\"transform\"] = transform2 + ` scale(${zoom},${zoom})`;\r\n  }\r\n\r\n  flushSetCSS() {\r\n    //check init\r\n    this._init();\r\n\r\n    this.setCSS();\r\n\r\n    this._forEachChildWidget((c) => {\r\n      if (!(c.packflag & PackFlags.NO_UPDATE)) {\r\n        c.flushSetCSS();\r\n      }\r\n    });\r\n  }\r\n\r\n  /* Why is the DOM API argument order swapped here?*/\r\n  replaceChild(newnode, node) {\r\n    for (let i = 0; i < this.childNodes.length; i++) {\r\n      if (this.childNodes[i] === node) {\r\n        super.replaceChild(newnode, node);\r\n        return true;\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < this.shadow.childNodes.length; i++) {\r\n      if (this.shadow.childNodes[i] === node) {\r\n        this.shadow.replaceChild(newnode, node);\r\n        return true;\r\n      }\r\n    }\r\n\r\n    console.error(\"Unknown child node\", node);\r\n    return false;\r\n  }\r\n\r\n  swapWith(b) {\r\n    let p1 = this.parentNode;\r\n    let p2 = b.parentNode;\r\n\r\n    if (this.parentWidget && (p1 === this.parentWidget.shadow) || p1 === null) {\r\n      p1 = this.parentWidget;\r\n    }\r\n\r\n    if (b.parentWidget && (p2 === b.parentWidget.shadow) || p2 === null) {\r\n      p2 = b.parentWidget;\r\n    }\r\n\r\n    if (!p1 || !p2) {\r\n      console.error(\"Invalid call to UIBase.prototype.swapWith\", this, b, p1, p2);\r\n      return false;\r\n    }\r\n\r\n    let getPos = (n, p) => {\r\n      let i = Array.prototype.indexOf.call(p.childNodes, n);\r\n\r\n      if (i < 0 && p.shadow) {\r\n        p = p.shadow;\r\n        i = Array.prototype.indexOf.call(p.childNodes, n);\r\n      }\r\n\r\n      return [i, p];\r\n    }\r\n\r\n    let [i1, n1] = getPos(this, p1);\r\n    let [i2, n2] = getPos(b, p2);\r\n\r\n    console.log(\"i1, i2, n1, n2\", i1, i2, n1, n2);\r\n\r\n    let tmp1 = document.createElement(\"div\");\r\n    let tmp2 = document.createElement(\"div\");\r\n\r\n    n1.insertBefore(tmp1, this);\r\n    n2.insertBefore(tmp2, b);\r\n\r\n    //HTMLElement.prototype.remove.call(this);\r\n    //HTMLElement.prototype.remove.call(b);\r\n\r\n    n1.replaceChild(b, tmp1);\r\n    n2.replaceChild(this, tmp2);\r\n\r\n    let ptmp = this.parentWidget;\r\n    this.parentWidget = b.parentWidget;\r\n    b.parentWidget = ptmp;\r\n\r\n    tmp1.remove();\r\n    tmp2.remove();\r\n\r\n    return true;\r\n  }\r\n\r\n  traverse(type_or_set) {\r\n    let this2 = this;\r\n\r\n    let classes = type_or_set;\r\n\r\n    let is_set = type_or_set instanceof Set;\r\n    is_set = is_set || type_or_set instanceof util.set;\r\n    is_set = is_set || Array.isArray(type_or_set);\r\n\r\n    if (!is_set) {\r\n      classes = [type_or_set];\r\n    }\r\n\r\n    let visit = new Set();\r\n\r\n    return (function* () {\r\n      let stack = [this2];\r\n\r\n      while (stack.length > 0) {\r\n        let n = stack.pop();\r\n\r\n        visit.add(n);\r\n\r\n        if (!n || !n.childNodes) {\r\n          continue;\r\n        }\r\n\r\n        for (let cls of classes) {\r\n          if (n instanceof cls) {\r\n            yield n;\r\n          }\r\n        }\r\n\r\n        for (let c of n.childNodes) {\r\n          if (!visit.has(c)) {\r\n            stack.push(c);\r\n          }\r\n        }\r\n\r\n        if (n.shadow) {\r\n          for (let c of n.shadow.childNodes) {\r\n            if (!visit.has(c)) {\r\n              stack.push(c);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    })();\r\n  }\r\n\r\n  appendChild(child) {\r\n    if (child instanceof UIBase) {\r\n      child.ctx = this.ctx;\r\n      child.parentWidget = this;\r\n\r\n      child.useDataPathUndo = this.useDataPathUndo;\r\n    }\r\n\r\n    return super.appendChild(child);\r\n  }\r\n\r\n  _clipboardHotkeyInit() {\r\n    this._clipboard_over = false;\r\n    this._last_clipboard_keyevt = undefined;\r\n\r\n    this._clipboard_keystart = () => {\r\n      if (this._clipboard_events) {\r\n        return;\r\n      }\r\n\r\n      this._clipboard_events = true;\r\n      window.addEventListener(\"keydown\", this._clipboard_keydown, {capture: true, passive: false});\r\n    }\r\n\r\n    this._clipboard_keyend = () => {\r\n      if (!this._clipboard_events) {\r\n        return;\r\n      }\r\n\r\n      this._clipboard_events = false;\r\n      window.removeEventListener(\"keydown\", this._clipboard_keydown, {capture: true, passive: false});\r\n    }\r\n\r\n    this._clipboard_keydown = (e, internal_mode) => {\r\n      if (!this.isConnected || !cconst.getClipboardData) {\r\n        this._clipboard_keyend();\r\n        return;\r\n      }\r\n\r\n      if (e === this._last_clipboard_keyevt || !this._clipboard_over) {\r\n        return;\r\n      }\r\n\r\n      /* the user's mouse cursor might not be over the element\r\n      *  if they've tabbed to it */\r\n\r\n      let is_copy = e.keyCode === keymap[\"C\"] && (e.ctrlKey || e.commandKey) && !e.shiftKey && !e.altKey;\r\n      let is_paste = e.keyCode === keymap[\"V\"] && (e.ctrlKey || e.commandKey) && !e.shiftKey && !e.altKey;\r\n\r\n      if (!is_copy && !is_paste) {\r\n        //early out, remember that pickElement is highly expensive to run\r\n        return;\r\n      }\r\n\r\n      //pasteForAllChildren\r\n      if (!internal_mode) {\r\n        let screen = this.ctx.screen;\r\n        let elem = screen.pickElement(screen.mpos[0], screen.mpos[1]);\r\n\r\n        let checkTree = is_paste && this.constructor.define().pasteForAllChildren;\r\n        checkTree = checkTree || (is_copy && this.constructor.define().copyForAllChildren);\r\n\r\n        while (checkTree && !(elem instanceof TextBox) && elem !== this && elem.parentWidget) {\r\n          console.log(\"  \" + elem._id);\r\n\r\n          elem = elem.parentWidget;\r\n        }\r\n\r\n        console.warn(\"COLOR\", this._id, elem._id);\r\n\r\n        if (elem !== this) {\r\n          //remove global keyhandler\r\n          this._clipboard_keyend();\r\n          return;\r\n        }\r\n      } else {\r\n        console.warn(\"COLOR\", this._id);\r\n      }\r\n\r\n      this._last_clipboard_keyevt = e;\r\n\r\n      if (is_copy) {\r\n        this.clipboardCopy();\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n\r\n      if (is_paste) {\r\n        this.clipboardPaste();\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n    }\r\n\r\n    let start = (e) => {\r\n      this._clipboard_over = true;\r\n      this._clipboard_keystart();\r\n    }\r\n\r\n    let stop = (e) => {\r\n      this._clipboard_over = false;\r\n      this._clipboard_keyend();\r\n    }\r\n\r\n    this.doOnce(() => {\r\n      this.tabIndex = 0; //enable self key events when element has focus\r\n    });\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      return this._clipboard_keydown(e, true);\r\n    });\r\n\r\n    this.addEventListener(\"pointerover\", start, {capture: true, passive: true});\r\n    this.addEventListener(\"pointerout\", stop, {capture: true, passive: true});\r\n    this.addEventListener(\"focus\", stop, {capture: true, passive: true});\r\n  }\r\n\r\n  /** set havePickClipboard to true in define() to\r\n   *  enable mouseover pick clipboarding */\r\n  clipboardCopy() {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  clipboardPaste() {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  //delayed init\r\n  init() {\r\n    this._init_done = true;\r\n\r\n    if (!this.hasAttribute(\"id\") && this._id) {\r\n      this.setAttribute(\"id\", this._id);\r\n    }\r\n  }\r\n\r\n  _ondestroy() {\r\n    if (this.tabIndex >= 0) {\r\n      this.regenTabOrder();\r\n    }\r\n\r\n    if (cconst.DEBUG.paranoidEvents) {\r\n      for (let item of this.__cbs) {\r\n        this.removeEventListener(item[0], item[1], item[2]);\r\n      }\r\n\r\n      this.__cbs = [];\r\n    }\r\n\r\n\r\n    if (this.ondestroy !== undefined) {\r\n      this.ondestroy();\r\n    }\r\n  }\r\n\r\n  remove(trigger_on_destroy = true) {\r\n    if (this.tabIndex >= 0) {\r\n      this.regenTabOrder();\r\n    }\r\n\r\n    super.remove();\r\n\r\n    if (trigger_on_destroy) {\r\n      this._ondestroy();\r\n    }\r\n\r\n    if (this.on_remove) {\r\n      this.on_remove();\r\n    }\r\n\r\n    this.parentWidget = undefined;\r\n  }\r\n\r\n  /*\r\n  *\r\n  * called when elements are removed.\r\n  * you should assume the element will be reused later;\r\n  * on_destroy is the callback for when elements are permanently destroyed\r\n  * */\r\n  on_remove() {\r\n\r\n  }\r\n\r\n  removeChild(child, trigger_on_destroy = true) {\r\n    super.removeChild(child);\r\n\r\n    if (trigger_on_destroy) {\r\n      child._ondestroy();\r\n    }\r\n  }\r\n\r\n  flushUpdate(force = false) {\r\n    //check init\r\n    this._init();\r\n\r\n    this.update();\r\n\r\n    this._forEachChildWidget((c) => {\r\n      if (force || !(c.packflag & PackFlags.NO_UPDATE)) {\r\n        if (!c.ctx) {\r\n          c.ctx = this.ctx;\r\n        }\r\n\r\n        c.flushUpdate(force);\r\n      }\r\n    });\r\n  }\r\n\r\n  //used by container nodes\r\n  /**\r\n   * Iterates over all child widgets,\r\n   * including ones that might be inside\r\n   * of normal DOM nodes.\r\n   *\r\n   * This is done by recursing into the dom\r\n   * tree and stopping at any node that's\r\n   * descended from ui_base.UIBase\r\n   **/\r\n  _forEachChildWidget(cb, thisvar) {\r\n    let rec = (n) => {\r\n      if (n instanceof UIBase) {\r\n        if (thisvar !== undefined) {\r\n          cb.call(thisvar, n);\r\n        } else {\r\n          cb(n);\r\n        }\r\n      } else {\r\n        for (let n2 of n.childNodes) {\r\n          rec(n2);\r\n        }\r\n\r\n        if (n.shadow !== undefined) {\r\n          for (let n2 of n.shadow.childNodes) {\r\n            rec(n2);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    for (let n of this.childNodes) {\r\n      rec(n);\r\n    }\r\n\r\n    if (this.shadow) {\r\n      for (let n of this.shadow.childNodes) {\r\n        rec(n);\r\n      }\r\n    }\r\n  }\r\n\r\n  checkInit() {\r\n    return this._init();\r\n  }\r\n\r\n  _init() {\r\n    if (this._init_done) {\r\n      return false;\r\n    }\r\n\r\n    this._init_done = true;\r\n    this.init();\r\n\r\n    return true;\r\n  }\r\n\r\n  getWinWidth() {\r\n    return window.innerWidth;\r\n  }\r\n\r\n  getWinHeight() {\r\n    return window.innerHeight;\r\n  }\r\n\r\n  calcZ() {\r\n    let p = this;\r\n    let n = this;\r\n\r\n    while (n) {\r\n      if (n.style && n.style[\"z-index\"]) {\r\n        let z = parseFloat(n.style[\"z-index\"]);\r\n        return z;\r\n      }\r\n\r\n      n = n.parentNode;\r\n\r\n      if (!n) {\r\n        n = p = p.parentWidget;\r\n      }\r\n    }\r\n\r\n    return 0;\r\n  }\r\n\r\n  pickElement(x, y, args = {}, marginy = 0, nodeclass = UIBase, excluded_classes = undefined) {\r\n    let marginx;\r\n    let clip;\r\n    let mouseEvent;\r\n    let isMouseMove, isMouseDown;\r\n\r\n    if (typeof args === \"object\") {\r\n      marginx = args.sx || 0;\r\n      marginy = args.sy || 0;\r\n      nodeclass = args.nodeclass || UIBase;\r\n      excluded_classes = args.excluded_classes;\r\n      clip = args.clip;\r\n      mouseEvent = args.mouseEvent;\r\n    } else {\r\n      marginx = args;\r\n\r\n      args = {\r\n        marginx         : marginx || 0,\r\n        marginy         : marginy || 0,\r\n        nodeclass       : nodeclass || UIBase,\r\n        excluded_classes: excluded_classes,\r\n        clip            : clip\r\n      }\r\n    }\r\n\r\n    if (mouseEvent) {\r\n      isMouseMove = mouseEvent.type === \"mousemove\" || mouseEvent.type === \"touchmove\" || mouseEvent.type === \"pointermove\";\r\n      isMouseDown = mouseEvent.buttons || (mouseEvent.touches && mouseEvent.touches.length > 0);\r\n    }\r\n\r\n    x -= window.scrollX;\r\n    y -= window.scrollY;\r\n\r\n    let elem = document.elementFromPoint(x, y);\r\n\r\n    if (!elem) {\r\n      return;\r\n    }\r\n\r\n    let path = [elem];\r\n    let lastelem = elem;\r\n    let i = 0;\r\n\r\n    while (elem && elem.shadow) {\r\n      if (i++ > 1000) {\r\n        console.error(\"Infinite loop error\");\r\n        break;\r\n      }\r\n\r\n      elem = elem.shadow.elementFromPoint(x, y);\r\n\r\n      if (elem === lastelem) {\r\n        break;\r\n      }\r\n\r\n      if (elem) {\r\n        path.push(elem);\r\n      }\r\n\r\n      lastelem = elem;\r\n    }\r\n\r\n    path.reverse();\r\n\r\n    //console.warn(path);\r\n\r\n    for (let i = 0; i < path.length; i++) {\r\n      let node = path[i];\r\n      let ok = node instanceof nodeclass;\r\n\r\n      if (excluded_classes) {\r\n        for (let cls of excluded_classes) {\r\n          ok = ok && !(node instanceof cls);\r\n        }\r\n      }\r\n\r\n      if (clip) {\r\n        let rect = node.getBoundingClientRect();\r\n        let clip2 = math.aabb_intersect_2d(clip.pos, clip.size, [rect.x, rect.y], [rect.width, rect.height]);\r\n\r\n        ok = ok && clip2;\r\n      }\r\n\r\n      if (ok) {\r\n        window.elem = node;\r\n        //console.log(node._id);\r\n        return node;\r\n      }\r\n    }\r\n  }\r\n\r\n  __updateDisable(val) {\r\n    if (!!val === !!this.__disabledState) {\r\n      return;\r\n    }\r\n\r\n    this.__disabledState = !!val;\r\n\r\n    if (val && !this._disdata) {\r\n      let style = this.getDefault(\"disabled\") || this.getDefault(\"internalDisabled\") || {\r\n        \"background-color\": this.getDefault(\"DisabledBG\")\r\n      };\r\n\r\n      this._disdata = {\r\n        style   : {},\r\n        defaults: {}\r\n      };\r\n\r\n      for (let k in style) {\r\n        //save old style information\r\n        this._disdata.style[k] = this.style[k];\r\n        this._disdata.defaults[k] = this.default_overrides[k];\r\n\r\n        let v = style[k];\r\n\r\n        if (typeof v === \"object\" && v instanceof CSSFont) {\r\n          this.style[k] = style[k].genCSS();\r\n        } else if (typeof v === \"object\") {\r\n          continue;\r\n        } else {\r\n          this.style[k] = style[k];\r\n        }\r\n        this.default_overrides[k] = style[k];\r\n      }\r\n\r\n      this.__disabledState = !!val;\r\n      this.on_disabled();\r\n    } else if (!val && this._disdata) {\r\n\r\n      //load old style information\r\n      for (let k in this._disdata.style) {\r\n        this.style[k] = this._disdata.style[k];\r\n      }\r\n\r\n      for (let k in this._disdata.defaults) {\r\n        let v = this._disdata.defaults[k];\r\n\r\n        if (v === undefined) {\r\n          delete this.default_overrides[k];\r\n        } else {\r\n          this.default_overrides[k] = v;\r\n        }\r\n      }\r\n\r\n      //this.background = this.style[\"background-color\"];\r\n      this._disdata = undefined;\r\n\r\n      this.__disabledState = !!val;\r\n      this.on_enabled();\r\n    }\r\n\r\n    this.__disabledState = !!val;\r\n\r\n    let visit = (n) => {\r\n      if (n instanceof UIBase) {\r\n        let changed = !!n.__disabledState;\r\n\r\n        /*\r\n        if (val) {\r\n          n._parent_disabled_set = Math.max(n._parent_disabled_set + 1, 0);\r\n        } else {\r\n          n._parent_disabled_set = Math.max(n._parent_disabled_set - 1, 0);\r\n        }//*/\r\n\r\n        n.__updateDisable(n.disabled);\r\n\r\n        changed = changed !== !!n.__disabledState;\r\n        if (changed) {\r\n          n.update();\r\n          n.setCSS();\r\n        }\r\n      }\r\n    };\r\n\r\n    this._forEachChildWidget(visit);\r\n  }\r\n\r\n  on_disabled() {\r\n\r\n  }\r\n\r\n  on_enabled() {\r\n\r\n  }\r\n\r\n  pushModal(handlers = this, autoStopPropagation = true, pointerId = undefined, pointerElem = this) {\r\n    if (this._modaldata !== undefined) {\r\n      console.warn(\"UIBase.prototype.pushModal called when already in modal mode\");\r\n      this.popModal();\r\n    }\r\n\r\n    let _areaWrangler = contextWrangler.copy();\r\n\r\n    contextWrangler.copy(this.ctx);\r\n\r\n    function bindFunc(func) {\r\n      return function () {\r\n        _areaWrangler.copyTo(contextWrangler);\r\n\r\n        return func.apply(handlers, arguments);\r\n      }\r\n    }\r\n\r\n    let handlers2 = {};\r\n    for (let k in handlers) {\r\n      let func = handlers[k];\r\n\r\n      if (typeof func !== \"function\") {\r\n        continue;\r\n      }\r\n\r\n      handlers2[k] = bindFunc(func);\r\n    }\r\n    //this._modalstack.push(this.ctx);\r\n    //this.ctx = this.ctx.toLocked();\r\n\r\n    if (pointerId !== undefined && pointerElem) {\r\n      this._modaldata = pushPointerModal(handlers2, autoStopPropagation);\r\n    } else {\r\n      this._modaldata = pushModalLight(handlers2, autoStopPropagation);\r\n    }\r\n\r\n    return this._modaldata;\r\n  }\r\n\r\n  popModal() {\r\n    if (this._modaldata === undefined) {\r\n      console.warn(\"Invalid call to UIBase.prototype.popModal\");\r\n      return;\r\n    }\r\n\r\n    //this.ctx = this._modalstack.pop();\r\n    popModalLight(this._modaldata);\r\n    this._modaldata = undefined;\r\n  }\r\n\r\n  /** child classes can override this to prevent focus on flash*/\r\n  _flash_focus() {\r\n    this.focus();\r\n  }\r\n\r\n  flash(color, rect_element = this, timems = 355, autoFocus = true) {\r\n    if (typeof color != \"object\") {\r\n      color = css2color(color);\r\n    }\r\n    color = new Vector4(color);\r\n    let csscolor = color2css(color);\r\n\r\n    if (this._flashtimer !== undefined && this._flashcolor !== csscolor) {\r\n      window.setTimeout(() => {\r\n        this.flash(color, rect_element, timems, autoFocus);\r\n      }, 100);\r\n\r\n      return;\r\n    } else if (this._flashtimer !== undefined) {\r\n      return;\r\n    }\r\n\r\n    //let rect = rect_element.getClientRects()[0];\r\n    let rect = rect_element.getBoundingClientRect();\r\n\r\n    if (rect === undefined) {\r\n      return;\r\n    }\r\n\r\n    //okay, dom apparently calls onchange() on .remove, so we have\r\n    //to put the timer code first to avoid loops\r\n    let timer;\r\n    let tick = 0;\r\n    let max = ~~(timems/20);\r\n\r\n    let x = rect.x, y = rect.y;\r\n\r\n    let cb = (e) => {\r\n      if (timer === undefined) {\r\n        return\r\n      }\r\n\r\n      let a = 1.0 - tick/max;\r\n      div.style[\"background-color\"] = color2css(color, a*a*0.5);\r\n\r\n      if (tick > max) {\r\n        window.clearInterval(timer);\r\n\r\n        this._flashtimer = undefined;\r\n        this._flashcolor = undefined;\r\n        timer = undefined;\r\n\r\n        div.remove();\r\n\r\n        if (autoFocus) {\r\n          this._flash_focus();\r\n        }\r\n      }\r\n\r\n      tick++;\r\n    };\r\n\r\n    window.setTimeout(cb, 5);\r\n    this._flashtimer = timer = window.setInterval(cb, 20);\r\n\r\n    let div = document.createElement(\"div\");\r\n\r\n    div.style[\"pointer-events\"] = \"none\";\r\n    div.tabIndex = undefined;\r\n    div.style[\"z-index\"] = \"900\";\r\n    div.style[\"display\"] = \"float\";\r\n    div.style[\"position\"] = UIBase.PositionKey;\r\n    div.style[\"margin\"] = \"0px\";\r\n    div.style[\"left\"] = x + \"px\";\r\n    div.style[\"top\"] = y + \"px\";\r\n\r\n    div.style[\"background-color\"] = color2css(color, 0.5);\r\n    div.style[\"width\"] = rect.width + \"px\";\r\n    div.style[\"height\"] = rect.height + \"px\";\r\n    div.setAttribute(\"class\", \"UIBaseFlash\");\r\n\r\n    let screen = this.getScreen();\r\n    if (screen !== undefined) {\r\n      screen._enterPopupSafe();\r\n    }\r\n\r\n    document.body.appendChild(div);\r\n    if (autoFocus) {\r\n      this._flash_focus();\r\n    }\r\n\r\n    this._flashcolor = csscolor;\r\n\r\n    if (screen !== undefined) {\r\n      screen._exitPopupSafe();\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n  }\r\n\r\n  on_resize(newsize) {\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = {};\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      ret.datapath = this.getAttribute(\"datapath\");\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    if (!this._init_done) {\r\n      this._init();\r\n    }\r\n  }\r\n\r\n  getPathValue(ctx, path) {\r\n    try {\r\n      return ctx.api.getValue(ctx, path);\r\n    } catch (error) {\r\n      //report(\"data path error in ui for\" + path);\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  undoBreakPoint() {\r\n    this.pathUndoGen++;\r\n  }\r\n\r\n  setPathValueUndo(ctx, path, val) {\r\n    let mass_set_path = this.getAttribute(\"mass_set_path\");\r\n    let rdef = ctx.api.resolvePath(ctx, path);\r\n    let prop = rdef.prop;\r\n\r\n    if (ctx.api.getValue(ctx, path) === val) {\r\n      return;\r\n    }\r\n\r\n    let toolstack = this.ctx.toolstack;\r\n    let head = toolstack.head;\r\n\r\n    let bad = head === undefined || !(head instanceof getDataPathToolOp());\r\n    bad = bad || head.hashThis() !== head.hash(mass_set_path, path, prop.type, this._id);\r\n    bad = bad || this.pathUndoGen !== this._lastPathUndoGen;\r\n\r\n    //if (head !== undefined && head instanceof getDataPathToolOp()) {\r\n    //console.log(\"===>\", bad, head.hashThis());\r\n    //console.log(\"    ->\", head.hash(mass_set_path, path, prop.type, this._id));\r\n    //}\r\n\r\n    if (!bad) {\r\n      toolstack.undo();\r\n      head.setValue(ctx, val, rdef.obj);\r\n      toolstack.redo();\r\n    } else {\r\n      this._lastPathUndoGen = this.pathUndoGen;\r\n\r\n      let toolop = getDataPathToolOp().create(ctx, path, val, this._id, mass_set_path);\r\n      ctx.toolstack.execTool(this.ctx, toolop);\r\n      head = toolstack.head;\r\n    }\r\n\r\n    if (!head || head.hadError === true) {\r\n      throw new Error(\"toolpath error\");\r\n    }\r\n  }\r\n\r\n  loadNumConstraints(prop = undefined, dom = this, onModifiedCallback = undefined) {\r\n    let modified = false;\r\n\r\n    if (!prop) {\r\n      let path;\r\n\r\n      if (dom.hasAttribute(\"datapath\")) {\r\n        path = dom.getAttribute(\"datapath\");\r\n      }\r\n\r\n      if (path === undefined && this.hasAttribute(\"datapath\")) {\r\n        path = this.getAttribute(\"datapath\");\r\n      }\r\n\r\n      if (typeof path === \"string\") {\r\n        prop = this.getPathMeta(this.ctx, path);\r\n      }\r\n    }\r\n\r\n    let loadAttr = (propkey, domkey = key, thiskey = key) => {\r\n      let old = this[thiskey];\r\n\r\n      if (dom.hasAttribute(domkey)) {\r\n        this[thiskey] = parseFloat(dom.getAttribute(domkey));\r\n      } else if (prop) {\r\n        this[thiskey] = prop[propkey];\r\n      }\r\n\r\n      if (this[thiskey] !== old) {\r\n        modified = true;\r\n      }\r\n    }\r\n\r\n    for (let key of NumberConstraints) {\r\n      let thiskey = key, domkey = key;\r\n\r\n      if (key === \"range\") { //handled later\r\n        continue;\r\n      }\r\n\r\n      loadAttr(key, domkey, thiskey);\r\n    }\r\n\r\n    let oldmin = this.range[0];\r\n    let oldmax = this.range[1];\r\n\r\n    let range = prop ? prop.range : undefined;\r\n    if (range && !dom.hasAttribute(\"min\")) {\r\n      this.range[0] = range[0];\r\n    } else if (dom.hasAttribute(\"min\")) {\r\n      this.range[0] = parseFloat(dom.getAttribute(\"min\"));\r\n    }\r\n\r\n    if (range && !dom.hasAttribute(\"max\")) {\r\n      this.range[1] = range[1];\r\n    } else if (dom.hasAttribute(\"max\")) {\r\n      this.range[1] = parseFloat(dom.getAttribute(\"max\"));\r\n    }\r\n\r\n    if (this.range[0] !== oldmin || this.range[1] !== oldmax) {\r\n      modified = true;\r\n    }\r\n\r\n    let oldint = this.isInt;\r\n\r\n    if (dom.getAttribute(\"integer\")) {\r\n      let val = dom.getAttribute(\"integer\");\r\n      val = (\"\" + val).toLowerCase();\r\n\r\n      //handles anonymouse <numslider-x integer> case\r\n      this.isInt = val === \"null\" || val === \"true\" || val === \"yes\" || val === \"1\";\r\n    } else {\r\n      this.isInt = prop && prop instanceof IntProperty;\r\n    }\r\n\r\n    if (!this.isInt !== !oldint) {\r\n      modified = true;\r\n    }\r\n\r\n    let oldedit = this.editAsBaseUnit;\r\n\r\n    if (this.editAsBaseUnit === undefined) {\r\n      if (prop && (prop.flag & PropFlags.EDIT_AS_BASE_UNIT)) {\r\n        this.editAsBaseUnit = true;\r\n      } else {\r\n        this.editAsBaseUnit = false;\r\n      }\r\n    }\r\n\r\n    if (!this.editAsBaseUnit !== !oldedit) {\r\n      modified = true;\r\n    }\r\n\r\n    if (modified) {\r\n      this.setCSS();\r\n\r\n      if (onModifiedCallback) {\r\n        onModifiedCallback.call(this);\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n    adds a method call to the event queue,\r\n    but only if that method (for this instance, as differentiated\r\n    by ._id) isn't there already.\r\n\r\n    also, method won't be ran until this.ctx exists\r\n  */\r\n\r\n  pushReportContext(key) {\r\n    if (this.ctx.api.pushReportContext) {\r\n      this.ctx.api.pushReportContext(key);\r\n    }\r\n  }\r\n\r\n  popReportContext() {\r\n    if (this.ctx.api.popReportContext)\r\n      this.ctx.api.popReportContext();\r\n  }\r\n\r\n  setPathValue(ctx, path, val) {\r\n    if (this.useDataPathUndo) {\r\n      this.pushReportContext(this._reportCtxName);\r\n\r\n      try {\r\n        this.setPathValueUndo(ctx, path, val);\r\n      } catch (error) {\r\n        this.popReportContext();\r\n\r\n        if (!(error instanceof DataPathError)) {\r\n          throw error;\r\n        } else {\r\n          return;\r\n        }\r\n      }\r\n\r\n      this.popReportContext();\r\n      return;\r\n    }\r\n\r\n    this.pushReportContext(this._reportCtxName);\r\n\r\n    try {\r\n      if (this.hasAttribute(\"mass_set_path\")) {\r\n        ctx.api.massSetProp(ctx, this.getAttribute(\"mass_set_path\"), val);\r\n        ctx.api.setValue(ctx, path, val);\r\n      } else {\r\n        ctx.api.setValue(ctx, path, val);\r\n      }\r\n    } catch (error) {\r\n      this.popReportContext();\r\n\r\n      if (!(error instanceof DataPathError)) {\r\n        throw error;\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    this.popReportContext();\r\n  }\r\n\r\n  getPathMeta(ctx, path) {\r\n    this.pushReportContext(this._reportCtxName);\r\n    let ret = ctx.api.resolvePath(ctx, path);\r\n    this.popReportContext();\r\n\r\n    return ret !== undefined ? ret.prop : undefined;\r\n  }\r\n\r\n  getPathDescription(ctx, path) {\r\n    let ret;\r\n    this.pushReportContext(this._reportCtxName);\r\n\r\n    try {\r\n      ret = ctx.api.getDescription(ctx, path);\r\n    } catch (error) {\r\n      this.popReportContext();\r\n\r\n      if (error instanceof DataPathError) {\r\n        //console.warn(\"Invalid data path '\" + path + \"'\");\r\n        return undefined;\r\n      } else {\r\n        throw error;\r\n      }\r\n    }\r\n\r\n    this.popReportContext();\r\n    return ret;\r\n  }\r\n\r\n  getScreen() {\r\n    if (this.ctx !== undefined)\r\n      return this.ctx.screen;\r\n  }\r\n\r\n  isDead() {\r\n    return !this.isConnected;\r\n    let p = this, lastp = this;\r\n\r\n    function find(c, n) {\r\n      for (let n2 of c) {\r\n        if (n2 === n) {\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n\r\n    while (p) {\r\n      lastp = p;\r\n\r\n      let parent = p.parentWidget;\r\n      if (!parent) {\r\n        parent = p.parentElement ? p.parentElement : p.parentNode;\r\n      }\r\n\r\n      if (parent && p && !find(parent.childNodes, p)) {\r\n        if (parent.shadow !== undefined && !find(parent.shadow.childNodes)) {\r\n          return true;\r\n        }\r\n      }\r\n      p = parent;\r\n\r\n      if (p === document.body) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  doOnce(func, timeout = undefined) {\r\n    if (func._doOnce === undefined) {\r\n      func._doOnce_reqs = new Set();\r\n\r\n      func._doOnce = function (thisvar, trace) {\r\n        if (func._doOnce_reqs.has(thisvar._id)) {\r\n          return;\r\n        }\r\n\r\n        func._doOnce_reqs.add(thisvar._id);\r\n\r\n        function f() {\r\n          if (thisvar.isDead()) {\r\n            func._doOnce_reqs.delete(thisvar._id);\r\n\r\n            if (func === thisvar._init || !cconst.DEBUG.doOnce) {\r\n              return;\r\n            }\r\n\r\n            console.warn(\"Ignoring doOnce call for dead element\", thisvar._id, func, trace);\r\n            return;\r\n          }\r\n\r\n          if (!thisvar.ctx) {\r\n            if (cconst.DEBUG.doOnce) {\r\n              console.warn(\"doOnce call is waiting for context...\", thisvar._id, func);\r\n            }\r\n\r\n            internalSetTimeout(f, 0);\r\n            return;\r\n          }\r\n\r\n          func._doOnce_reqs.delete(thisvar._id);\r\n          func.call(thisvar);\r\n        };\r\n\r\n        internalSetTimeout(f, timeout);\r\n      }\r\n    }\r\n\r\n    let trace = new Error().stack;\r\n    func._doOnce(this, trace);\r\n  }\r\n\r\n  float(x = 0, y = 0, zindex = undefined, positionKey = UIBase.PositionKey) {\r\n    this.style.position = positionKey;\r\n\r\n    this.style.left = x + \"px\";\r\n    this.style.top = y + \"px\";\r\n\r\n    if (zindex !== undefined) {\r\n      this.style[\"z-index\"] = zindex\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  _ensureChildrenCtx() {\r\n    let ctx = this.ctx;\r\n    if (ctx === undefined) {\r\n      return;\r\n    }\r\n\r\n    this._forEachChildWidget((n) => {\r\n      n.parentWidget = this;\r\n\r\n      if (n.ctx === undefined) {\r\n        n.ctx = ctx;\r\n      }\r\n\r\n      n._ensureChildrenCtx(ctx);\r\n    });\r\n  }\r\n\r\n  checkThemeUpdate() {\r\n    if (!cconst.enableThemeAutoUpdate) {\r\n      return false;\r\n    }\r\n\r\n    if (_themeUpdateKey !== this._last_theme_update_key) {\r\n      this._last_theme_update_key = _themeUpdateKey;\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  abortToolTips(delayMs = 500) {\r\n    if (this._has_own_tooltips) {\r\n      this._has_own_tooltips.stop_timer();\r\n    }\r\n\r\n    if (this._tooltip_ref) {\r\n      this._tooltip_ref.remove();\r\n      this._tooltip_ref = undefined;\r\n    }\r\n\r\n    this._tool_tip_abort_delay = util.time_ms() + delayMs;\r\n\r\n    return this;\r\n  }\r\n\r\n  updateToolTipHandlers() {\r\n    if (!this._useNativeToolTips_set && !cconst.useNativeToolTips !== !this._useNativeToolTips) {\r\n      this._useNativeToolTips = cconst.useNativeToolTips;\r\n    }\r\n\r\n    if (!!this.useNativeToolTips === !this._has_own_tooltips) {\r\n      return;\r\n    }\r\n\r\n    if (!this.useNativeToolTips) {\r\n      let state = this._has_own_tooltips = {\r\n        start_timer : (e) => {\r\n          this._tooltip_timer = util.time_ms();\r\n          //console.warn(this._id, \"tooltip timer start\", e.type);\r\n        },\r\n        stop_timer  : (e) => {\r\n          //console.warn(this._id, \"tooltip timer end\", util.time_ms()-this._tooltip_timer, e.type);\r\n          this._tooltip_timer = undefined;\r\n        },\r\n        reset_timer : (e) => {\r\n          //console.warn(this._id, \"tooltip timer reset\", util.time_ms()-this._tooltip_timer, e.type);\r\n          if (this._tooltip_timer !== undefined) {\r\n            this._tooltip_timer = util.time_ms();\r\n          }\r\n        },\r\n        start_events: [\r\n          \"mouseover\"\r\n        ],\r\n        reset_events: [\r\n          \"mousemove\", \"mousedown\", \"mouseup\",\r\n          \"touchstart\", \"touchend\", \"keydown\", \"focus\"\r\n        ],\r\n        stop_events : [\r\n          \"mouseleave\", \"blur\", \"mouseout\"\r\n        ],\r\n        handlers    : {}\r\n      }\r\n\r\n      let bind_handler = (type, etype) => {\r\n        let handler = (e) => {\r\n          if (this._tool_tip_abort_delay !== undefined && util.time_ms() < this._tool_tip_abort_delay) {\r\n            this._tooltip_timer = undefined;\r\n            return;\r\n          }\r\n\r\n          state[type](e);\r\n        };\r\n\r\n        if (etype in state.handlers) {\r\n          console.error(type, \"is in handlers already\");\r\n          return;\r\n        }\r\n\r\n        state.handlers[etype] = handler;\r\n        return handler;\r\n      }\r\n\r\n      let i = 0;\r\n      let lists = [state.start_events, state.stop_events, state.reset_events];\r\n\r\n      for (let type of [\"start_timer\", \"stop_timer\", \"reset_timer\"]) {\r\n        for (let etype of lists[i]) {\r\n          this.addEventListener(etype, bind_handler(type, etype), {passive: true});\r\n        }\r\n\r\n        i++;\r\n      }\r\n    } else {\r\n      console.warn(this.id, \"removing tooltip handlers\");\r\n      let state = this._has_own_tooltips;\r\n\r\n      for (let k in this.state.handlers) {\r\n        let handler = this.state.handlers[k];\r\n        this.removeEventListener(k, handler);\r\n      }\r\n\r\n      this._has_own_tooltips = undefined;\r\n      this._tooltip_timer = undefined;\r\n    }\r\n  }\r\n\r\n  updateToolTips() {\r\n    if (this._description_final === undefined || this._description_final === null ||\r\n      this._description_final.trim().length === 0) {\r\n      return;\r\n    }\r\n\r\n    if (!this.ctx || !this.ctx.screen) {\r\n      return;\r\n    }\r\n\r\n    this.updateToolTipHandlers();\r\n\r\n    if (this.useNativeToolTips || this._tooltip_timer === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this._tool_tip_abort_delay !== undefined && util.time_ms() < this._tool_tip_abort_delay) {\r\n      return;\r\n    }\r\n\r\n    this._tool_tip_abort_delay = undefined;\r\n\r\n    let screen = this.ctx.screen;\r\n\r\n    const timelimit = 500;\r\n    let ok = util.time_ms() - this._tooltip_timer > timelimit;\r\n\r\n    let x = screen.mpos[0], y = screen.mpos[1];\r\n\r\n    let r = this.getClientRects();\r\n    r = r ? r[0] : r;\r\n\r\n    if (!r) {\r\n      ok = false;\r\n    } else {\r\n      ok = ok && x >= r.x && x < r.x + r.width;\r\n      ok = ok && y >= r.y && y < r.y + r.height;\r\n    }\r\n\r\n\r\n    //console.log(r);\r\n    if (r) {\r\n      //console.warn(this._id, \"possible tooltip\", x, y, r.x-3, r.y-3, r.width, r.height);\r\n    }\r\n\r\n    ok = ok && !haveModal();\r\n    ok = ok && screen.pickElement(x, y) === this;\r\n    ok = ok && this._description_final;\r\n\r\n    if (ok) {\r\n      //console.warn(\"Showing tooltop\", this.id);\r\n      this._tooltip_ref = _ToolTip.show(this._description_final, this.ctx.screen, x, y);\r\n    } else {\r\n      if (this._tooltip_ref) {\r\n        this._tooltip_ref.remove();\r\n      }\r\n\r\n      this._tooltip_ref = undefined;\r\n    }\r\n\r\n    //console.warn(this._id, \"tooltip timer end\");\r\n    if (util.time_ms() - this._tooltip_timer > timelimit) {\r\n      this._tooltip_timer = undefined;\r\n    }\r\n  }\r\n\r\n  //called regularly\r\n  update() {\r\n    this.updateToolTips();\r\n\r\n    if (this.ctx && this._description === undefined && this.getAttribute(\"datapath\")) {\r\n      let d = this.getPathDescription(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n      this.description = d;\r\n    }\r\n\r\n    if (!this._init_done) {\r\n      this._init();\r\n    }\r\n\r\n    if (this._init_done && !this.constructor.define().subclassChecksTheme) {\r\n      if (this.checkThemeUpdate()) {\r\n        console.log(\"theme update!\");\r\n\r\n        this.setCSS();\r\n      }\r\n    }\r\n  }\r\n\r\n  onadd() {\r\n    //if (this.parentWidget !== undefined) {\r\n    //  this._useDataPathUndo = this.parentWidget._useDataPathUndo;\r\n    //}\r\n\r\n    if (!this._init_done) {\r\n      this.doOnce(this._init);\r\n    }\r\n\r\n    if (this.tabIndex >= 0) {\r\n      this.regenTabOrder();\r\n    }\r\n  }\r\n\r\n  getZoom() {\r\n    if (this.parentWidget !== undefined) {\r\n      return this.parentWidget.getZoom();\r\n    }\r\n\r\n    return 1.0;\r\n  }\r\n\r\n  /**try to use this method\r\n\r\n   scaling ratio (e.g. for high-resolution displays)\r\n   for zoom ratio use getZoom()\r\n   */\r\n  getDPI() {\r\n    if (this.parentWidget !== undefined) {\r\n      return this.parentWidget.getDPI();\r\n    }\r\n\r\n    return UIBase.getDPI();\r\n  }\r\n\r\n  /**\r\n   * for saving ui state.\r\n   * see saveUIData() export\r\n   *\r\n   * should fail gracefully.\r\n   */\r\n  saveData() {\r\n    return {};\r\n  }\r\n\r\n  /**\r\n   * for saving ui state.\r\n   * see saveUIData() export\r\n   *\r\n   * should fail gracefully.\r\n   *\r\n   * also, it doesn't rebuild the object graph,\r\n   * it patches it; for true serialization use\r\n   * the toJSON/loadJSON or STRUCT interfaces.\r\n   */\r\n  loadData(obj) {\r\n    return this;\r\n  }\r\n\r\n  overrideDefault(key, val, localOnly = false) {\r\n    this.my_default_overrides[key] = val;\r\n\r\n    if (!localOnly) {\r\n      this.default_overrides[key] = val;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  overrideClass(style) {\r\n    this._override_class = style;\r\n  }\r\n\r\n  overrideClassDefault(style, key, val) {\r\n    if (!(style in this.class_default_overrides)) {\r\n      this.class_default_overrides[style] = {};\r\n    }\r\n\r\n    this.class_default_overrides[style][key] = val;\r\n  }\r\n\r\n  _doMobileDefault(key, val) {\r\n    if (!util.isMobile())\r\n      return val;\r\n\r\n    key = key.toLowerCase();\r\n    let ok = false;\r\n\r\n    for (let re of _mobile_theme_patterns) {\r\n      if (key.search(re) >= 0) {\r\n        ok = true;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (ok) {\r\n      val *= theme.base.mobileSizeMultiplier;\r\n    }\r\n\r\n    return val;\r\n  }\r\n\r\n  hasDefault(key) {\r\n    let p = this;\r\n\r\n    while (p) {\r\n      if (key in p.default_overrides) {\r\n        return true;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    return this.hasClassDefault(key);\r\n  }\r\n\r\n  /** get a sub style from a theme style class.\r\n   *  note that if key is falsy then it just forwards to this.getDefault directly*/\r\n  getSubDefault(key, subkey, backupkey = subkey, defaultval = undefined) {\r\n    /* Check if client code manually overrode a theme key for this instance. */\r\n    if (subkey && subkey in this.my_default_overrides) {\r\n      //return this.getDefault(subkey, undefined, defaultval);\r\n    }\r\n\r\n    if (!key) {\r\n      return this.getDefault(subkey, undefined, defaultval);\r\n    }\r\n\r\n    let style = this.getDefault(key);\r\n\r\n    if (!style || typeof style !== \"object\" || !(subkey in style)) {\r\n      if (defaultval !== undefined) {\r\n        return defaultval;\r\n      } else if (backupkey !== undefined) {\r\n        return this.getDefault(backupkey);\r\n      }\r\n    } else {\r\n      return style[subkey];\r\n    }\r\n  }\r\n\r\n  getDefault(key, checkForMobile = true, defaultval = undefined) {\r\n    let ret = this.getDefault_intern(key, checkForMobile, defaultval);\r\n\r\n    //convert pixel units straight to numbers\r\n    if (typeof ret === \"string\" && ret.trim().toLowerCase().endsWith(\"px\")) {\r\n      let s = ret.trim().toLowerCase();\r\n      s = s.slice(0, s.length - 2).trim();\r\n\r\n      let f = parseFloat(s);\r\n      if (!isNaN(f) && isFinite(f)) {\r\n        return f;\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  getDefault_intern(key, checkForMobile = true, defaultval = undefined) {\r\n    if (this.my_default_overrides[key] !== undefined) {\r\n      let v = this.my_default_overrides[key];\r\n      return checkForMobile ? this._doMobileDefault(key, v) : v;\r\n    }\r\n\r\n    let p = this;\r\n    while (p) {\r\n      if (p.default_overrides[key] !== undefined) {\r\n        let v = p.default_overrides[key];\r\n        checkForMobile ? this._doMobileDefault(key, v) : v;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    return this.getClassDefault(key, checkForMobile, defaultval);\r\n  }\r\n\r\n  getStyleClass() {\r\n    if (this._override_class !== undefined) {\r\n      return this._override_class;\r\n    }\r\n\r\n    let p = this.constructor, lastp = undefined;\r\n\r\n    while (p && p !== lastp && p !== UIBase && p !== Object) {\r\n      let def = p.define();\r\n\r\n      if (def.style) {\r\n        return def.style;\r\n      }\r\n\r\n      if (!p.prototype || !p.prototype.__proto__)\r\n        break;\r\n\r\n      p = p.prototype.__proto__.constructor;\r\n    }\r\n\r\n    return \"base\";\r\n  }\r\n\r\n  hasClassDefault(key) {\r\n    let style = this.getStyleClass();\r\n\r\n    let p = this;\r\n    while (p) {\r\n      let def = p.class_default_overrides[style];\r\n\r\n      if (def && (key in def)) {\r\n        return true;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    let th = this._themeOverride;\r\n\r\n    if (th && style in th && key in th[style]) {\r\n      return true;\r\n    }\r\n\r\n    if (style in theme && key in theme[style]) {\r\n      return true;\r\n    }\r\n\r\n    return key in theme.base;\r\n  }\r\n\r\n  getClassDefault(key, checkForMobile = true, defaultval = undefined) {\r\n    let style = this.getStyleClass();\r\n\r\n    if (style === \"none\") {\r\n      return undefined;\r\n    }\r\n\r\n    let val = undefined;\r\n    let p = this;\r\n    while (p) {\r\n      let def = p.class_default_overrides[style];\r\n\r\n      if (def && (key in def)) {\r\n        val = def[key];\r\n        break;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    if (val === undefined && style in theme && !(key in theme[style]) && !(key in theme.base)) {\r\n      if (window.DEBUG.theme) {\r\n        report(\"Missing theme key \", key, \"for\", style);\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let th = !i ? this._themeOverride : theme;\r\n\r\n      if (!th) {\r\n        continue;\r\n      }\r\n\r\n      if (val === undefined && style in th && key in th[style]) {\r\n        val = th[style][key];\r\n      } else if (defaultval !== undefined) {\r\n        val = defaultval;\r\n      } else if (val === undefined) {\r\n        let def = this.constructor.define();\r\n\r\n        if (def.parentStyle && key in th[def.parentStyle]) {\r\n          val = th[def.parentStyle][key];\r\n        } else {\r\n          val = th.base[key];\r\n        }\r\n      }\r\n    }\r\n\r\n    return checkForMobile ? this._doMobileDefault(key, val) : val;\r\n  }\r\n\r\n  overrideTheme(theme) {\r\n    this._themeOverride = theme;\r\n\r\n    this._forEachChildWidget((child) => {\r\n      child.overrideTheme(theme);\r\n    });\r\n\r\n    if (this.ctx) {\r\n      this.flushSetCSS();\r\n      this.flushUpdate();\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  getStyle() {\r\n    console.warn(\"deprecated call to UIBase.getStyle\");\r\n    return this.getStyleClass();\r\n  }\r\n\r\n  /** returns a new Animator instance\r\n   *\r\n   * example:\r\n   *\r\n   * container.animate().goto(\"style.width\", 500, 100, \"ease\");\r\n   * */\r\n  animate(_extra_handlers = {}) {\r\n    let transform = new DOMMatrix(this.style[\"transform\"]);\r\n\r\n    let update_trans = () => {\r\n      let t = transform;\r\n      let css = \"matrix(\" + t.a + \",\" + t.b + \",\" + t.c + \",\" + t.d + \",\" + t.e + \",\" + t.f + \")\";\r\n      this.style[\"transform\"] = css;\r\n    }\r\n\r\n    let handlers = {\r\n      background_get() {\r\n        return css2color(this.background);\r\n      },\r\n\r\n      background_set(c) {\r\n        if (typeof c !== \"string\") {\r\n          c = color2css(c);\r\n        }\r\n        this.background = c;\r\n      },\r\n\r\n      dx_get() {\r\n        return transform.m41;\r\n      },\r\n      dx_set(x) {\r\n        transform.m41 = x;\r\n        update_trans();\r\n      },\r\n\r\n      dy_get() {\r\n        return transform.m42;\r\n      },\r\n      dy_set(x) {\r\n        transform.m42 = x;\r\n        update_trans();\r\n      }\r\n    }\r\n\r\n    let pixkeys = [\"width\", \"height\", \"left\", \"top\", \"right\", \"bottom\", \"border-radius\",\r\n                   \"border-width\", \"margin\", \"padding\", \"margin-left\", \"margin-right\",\r\n                   \"margin-top\", \"margin-bottom\", \"padding-left\", \"padding-right\", \"padding-bottom\",\r\n                   \"padding-top\"];\r\n    handlers = Object.assign(handlers, _extra_handlers);\r\n\r\n    let makePixHandler = (k, k2) => {\r\n      handlers[k2 + \"_get\"] = () => {\r\n        let s = this.style[k];\r\n\r\n        if (s.endsWith(\"px\")) {\r\n          return parsepx(s);\r\n        } else {\r\n          return 0.0;\r\n        }\r\n      }\r\n\r\n      handlers[k2 + \"_set\"] = (val) => {\r\n        this.style[k] = val + \"px\";\r\n      }\r\n    }\r\n\r\n    for (let k of pixkeys) {\r\n      if (!(k in handlers)) {\r\n        makePixHandler(k, `style.${k}`);\r\n        makePixHandler(k, `style[\"${k}\"]`);\r\n        makePixHandler(k, `style['${k}']`);\r\n      }\r\n    }\r\n\r\n    let handler = {\r\n      get: (target, key, receiver) => {\r\n        console.log(key, handlers[key + \"_get\"], handlers);\r\n\r\n        if ((key + \"_get\") in handlers) {\r\n          return handlers[key + \"_get\"].call(target);\r\n        } else {\r\n          return target[key];\r\n        }\r\n      },\r\n      set: (target, key, val, receiver) => {\r\n        console.log(key);\r\n\r\n        if ((key + \"_set\") in handlers) {\r\n          handlers[key + \"_set\"].call(target, val);\r\n        } else {\r\n          target[key] = val;\r\n        }\r\n\r\n        return true;\r\n      }\r\n    }\r\n\r\n    let proxy = new Proxy(this, handler);\r\n    let anim = new Animator(proxy);\r\n\r\n    anim.onend = () => {\r\n      this._active_animations.remove(anim);\r\n    }\r\n\r\n    this._active_animations.push(anim);\r\n    return anim;\r\n  }\r\n\r\n  abortAnimations() {\r\n    for (let anim of util.list(this._active_animations)) {\r\n      anim.end();\r\n    }\r\n\r\n    this._active_animations = [];\r\n  }\r\n}\r\n\r\nexport function drawRoundBox2(elem, options = {}) {\r\n  drawRoundBox(elem, options.canvas, options.g, options.width, options.height, options.r, options.op, options.color, options.margin, options.no_clear);\r\n}\r\n\r\n/**okay, I need to refactor this function,\r\n it needs to take x, y as well as width, height,\r\n and be usable for more use cases.*/\r\nexport function drawRoundBox(elem, canvas, g, width, height, r      = undefined,\r\n                             op = \"fill\", color = undefined, margin = undefined,\r\n                             no_clear                               = false) {\r\n  width = width === undefined ? canvas.width : width;\r\n  height = height === undefined ? canvas.height : height;\r\n  g.save();\r\n\r\n  let dpi = elem.getDPI();\r\n\r\n  r = r === undefined ? elem.getDefault(\"border-radius\") : r;\r\n\r\n  if (margin === undefined) {\r\n    margin = 1;\r\n  }\r\n\r\n  r *= dpi;\r\n  let r1 = r, r2 = r;\r\n\r\n  if (r > (height - margin*2)*0.5) {\r\n    r1 = (height - margin*2)*0.5;\r\n  }\r\n\r\n  if (r > (width - margin*2)*0.5) {\r\n    r2 = (width - margin*2)*0.5;\r\n  }\r\n\r\n  let bg = color;\r\n\r\n  if (bg === undefined && canvas._background !== undefined) {\r\n    bg = canvas._background;\r\n  } else if (bg === undefined) {\r\n    bg = elem.getDefault(\"background-color\");\r\n  }\r\n\r\n  if (op === \"fill\" && !no_clear) {\r\n    g.clearRect(0, 0, width, height);\r\n  }\r\n\r\n  g.fillStyle = bg;\r\n  //hackish!\r\n  g.strokeStyle = color === undefined ? elem.getDefault(\"border-color\") : color;\r\n\r\n  let w = width, h = height;\r\n\r\n  let th = Math.PI/4;\r\n  let th2 = Math.PI*0.75;\r\n\r\n  g.beginPath();\r\n\r\n  g.moveTo(margin, margin + r1);\r\n  g.lineTo(margin, h - r1 - margin);\r\n\r\n  g.quadraticCurveTo(margin, h - margin, margin + r2, h - margin);\r\n  g.lineTo(w - margin - r2, h - margin);\r\n\r\n  g.quadraticCurveTo(w - margin, h - margin, w - margin, h - margin - r1);\r\n  g.lineTo(w - margin, margin + r1);\r\n\r\n  g.quadraticCurveTo(w - margin, margin, w - margin - r2, margin);\r\n  g.lineTo(margin + r2, margin);\r\n\r\n  g.quadraticCurveTo(margin, margin, margin, margin + r1);\r\n  g.closePath();\r\n\r\n  if (op === \"clip\") {\r\n    g.clip();\r\n  } else if (op === \"fill\") {\r\n    g.fill();\r\n  } else {\r\n    g.stroke();\r\n  }\r\n\r\n  g.restore();\r\n};\r\n\r\nexport function _getFont_new(elem, size, font = \"DefaultText\", do_dpi = true) {\r\n\r\n  font = elem.getDefault(font);\r\n\r\n  return font.genCSS(size);\r\n}\r\n\r\nexport function getFont(elem, size, font = \"DefaultText\", do_dpi = true) {\r\n  return _getFont_new(elem, size, font = \"DefaultText\", do_dpi = true);\r\n}\r\n\r\n//size is optional, defaults to font's default size\r\nexport function _getFont(elem, size, font = \"DefaultText\", do_dpi = true) {\r\n  let dpi = elem.getDPI();\r\n\r\n  let font2 = elem.getDefault(font);\r\n  if (font2 !== undefined) {\r\n    //console.warn(\"New style font detected\", font2, font2.genCSS(size));\r\n    return _getFont_new(elem, size, font, do_dpi);\r\n  }\r\n\r\n  throw new Error(\"unknown font \" + font);\r\n}\r\n\r\nexport function _ensureFont(elem, canvas, g, size) {\r\n  if (canvas.font) {\r\n    g.font = canvas.font;\r\n  } else {\r\n    let font = elem.getDefault(\"DefaultText\");\r\n    g.font = font.genCSS(size);\r\n  }\r\n}\r\n\r\nlet _mc;\r\n\r\nfunction get_measure_canvas() {\r\n  if (_mc !== undefined) {\r\n    return _mc;\r\n  }\r\n\r\n  _mc = document.createElement(\"canvas\");\r\n  _mc.width = 256;\r\n  _mc.height = 256;\r\n  _mc.g = _mc.getContext(\"2d\");\r\n\r\n  return _mc;\r\n}\r\n\r\nexport function measureTextBlock(elem, text, canvas                    = undefined,\r\n                                 g = undefined, size = undefined, font = undefined) {\r\n  let lines = text.split(\"\\n\");\r\n\r\n  let ret = {\r\n    width : 0,\r\n    height: 0\r\n  };\r\n\r\n  if (size === undefined) {\r\n    if (font !== undefined && typeof font === \"object\") {\r\n      size = font.size;\r\n    }\r\n\r\n    if (size === undefined) {\r\n      size = elem.getDefault(\"DefaultText\").size;\r\n    }\r\n  }\r\n\r\n  for (let line of lines) {\r\n    let m = measureText(elem, line, canvas, g, size, font);\r\n\r\n    ret.width = Math.max(ret.width, m.width);\r\n    let h = m.height !== undefined ? m.height : size*1.25;\r\n\r\n    ret.height += h;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nexport function measureText(elem, text, canvas                    = undefined,\r\n                            g = undefined, size = undefined, font = undefined) {\r\n  if (typeof canvas === \"object\" && canvas !== null && !(canvas instanceof HTMLCanvasElement) && canvas.tagName !== \"CANVAS\") {\r\n    let args = canvas;\r\n\r\n    canvas = args.canvas;\r\n    g = args.g;\r\n    size = args.size;\r\n    font = args.font;\r\n\r\n  }\r\n\r\n  if (g === undefined) {\r\n    canvas = get_measure_canvas();\r\n    g = canvas.g;\r\n  }\r\n\r\n  if (font !== undefined) {\r\n    if (typeof font === \"object\" && font instanceof CSSFont) {\r\n      font = font.genCSS(size);\r\n    }\r\n\r\n    g.font = font;\r\n  } else {\r\n    _ensureFont(elem, canvas, g, size);\r\n  }\r\n\r\n  let ret = g.measureText(text);\r\n\r\n  if (ret && util.isMobile()) {\r\n    let ret2 = {};\r\n    let dpi = UIBase.getDPI();\r\n\r\n    for (let k in ret) {\r\n      let v = ret[k];\r\n\r\n      if (typeof v === \"number\") {\r\n        v *= dpi;\r\n        //v *= window.devicePixelRatio;\r\n      }\r\n\r\n      ret2[k] = v;\r\n    }\r\n\r\n    ret = ret2;\r\n  }\r\n\r\n  if (size !== undefined) {\r\n    //clear custom font for next time\r\n    g.font = undefined;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n//export function drawText(elem, x, y, text, canvas, g, color=undefined, size=undefined, font=undefined) {\r\nexport function drawText(elem, x, y, text, args = {}) {\r\n  let canvas = args.canvas, g = args.g, color = args.color, font = args.font;\r\n  let size = args.size;\r\n\r\n  if (size === undefined) {\r\n    if (font !== undefined && font instanceof CSSFont) {\r\n      size = font.size;\r\n    } else {\r\n      size = elem.getDefault(\"DefaultText\").size;\r\n    }\r\n  }\r\n\r\n  size *= UIBase.getDPI();\r\n\r\n\r\n  if (color === undefined) {\r\n    if (font && font.color) {\r\n      color = font.color;\r\n    } else {\r\n      color = elem.getDefault(\"DefaultText\").color;\r\n    }\r\n  }\r\n\r\n  if (font === undefined) {\r\n    _ensureFont(elem, canvas, g, size);\r\n  } else if (typeof font === \"object\" && font instanceof CSSFont) {\r\n    g.font = font = font.genCSS(size);\r\n  } else if (font) {\r\n    g.font = font;\r\n  }\r\n\r\n  if (typeof color === \"object\") {\r\n    color = color2css(color);\r\n  }\r\n\r\n\r\n  g.fillStyle = color;\r\n  g.fillText(text, x + 0.5, y + 0.5);\r\n\r\n  if (size !== undefined) {\r\n    //clear custom font for next time\r\n    g.font = undefined;\r\n  }\r\n}\r\n\r\nlet PIDX = 0, PSHADOW = 1, PTOT = 2;\r\n\r\n/**\r\n\r\n Saves UI layout data, like panel layouts, active tabs, etc.\r\n Uses the UIBase.prototype.[save/load]Data interface.\r\n\r\n Note that this is error-tolerant.\r\n */\r\nexport function saveUIData(node, key) {\r\n  if (key === undefined) {\r\n    throw new Error(\"ui_base.saveUIData(): key cannot be undefined\");\r\n  }\r\n\r\n  let paths = [];\r\n\r\n  let rec = (n, path, ni, is_shadow) => {\r\n    path = path.slice(0, path.length); //copy path\r\n\r\n    let pi = path.length;\r\n    for (let i = 0; i < PTOT; i++) {\r\n      path.push(undefined);\r\n    }\r\n\r\n    path[pi] = ni;\r\n    path[pi + 1] = is_shadow ? 1 : 0;\r\n\r\n    if (n instanceof UIBase) {\r\n      let path2 = path.slice(0, path.length);\r\n      let data = n.saveData();\r\n\r\n      let bad = !data;\r\n      bad = bad || (typeof data === \"object\" && Object.keys(data).length === 0);\r\n\r\n      if (!bad) {\r\n        path2.push(data);\r\n\r\n        if (path2[pi + 2]) {\r\n          paths.push(path2);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < n.childNodes.length; i++) {\r\n      let n2 = n.childNodes[i];\r\n\r\n      rec(n2, path, i, false);\r\n    }\r\n\r\n    let shadow = n.shadow;\r\n\r\n    if (!shadow)\r\n      return;\r\n\r\n    for (let i = 0; i < shadow.childNodes.length; i++) {\r\n      let n2 = shadow.childNodes[i];\r\n\r\n      rec(n2, path, i, true);\r\n    }\r\n  }\r\n\r\n  rec(node, [], 0, false);\r\n\r\n  return JSON.stringify({\r\n    key        : key,\r\n    paths      : paths,\r\n    _ui_version: 1\r\n  });\r\n}\r\n\r\nwindow._saveUIData = saveUIData;\r\n\r\nexport function loadUIData(node, buf) {\r\n  if (buf === undefined || buf === null) {\r\n    return;\r\n  }\r\n\r\n  let obj = JSON.parse(buf);\r\n  let key = buf.key;\r\n\r\n  for (let path of obj.paths) {\r\n    let n = node;\r\n\r\n    let data = path[path.length - 1];\r\n    path = path.slice(2, path.length - 1); //in case some api doesn't want me calling .pop()\r\n\r\n    for (let pi = 0; pi < path.length; pi += PTOT) {\r\n      let ni = path[pi], shadow = path[pi + 1];\r\n\r\n      let list;\r\n\r\n      if (shadow) {\r\n        list = n.shadow;\r\n\r\n        if (list) {\r\n          list = list.childNodes;\r\n        }\r\n      } else {\r\n        list = n.childNodes;\r\n      }\r\n\r\n      if (list === undefined || list[ni] === undefined) {\r\n        //console.log(\"failed to load a ui data block\", path);\r\n        n = undefined;\r\n        break;\r\n      }\r\n\r\n      n = list[ni];\r\n    }\r\n\r\n    if (n !== undefined && n instanceof UIBase) {\r\n      n._init(); //ensure init's been called, _init will check if it has\r\n      n.loadData(data);\r\n\r\n      //console.log(n, path, data);\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.PositionKey = \"fixed\";\r\n\r\nwindow._loadUIData = loadUIData;\r\n\r\n//avoid explicit circular references\r\naspect._setUIBase(UIBase);\r\n//ui_save.setUIBase(UIBase);\r\n","\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as simple_toolsys from '../path-controller/toolsys/toolsys.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport {DataPathError} from '../path-controller/controller/controller.js';\r\nimport {Vector3, Vector4, Quat, Matrix4} from '../path-controller/util/vectormath.js';\r\nimport cconst from '../config/const.js';\r\nimport {_themeUpdateKey, CSSFont} from \"../core/ui_base.js\";\r\n\r\nlet keymap = events.keymap;\r\n\r\nlet EnumProperty = toolprop.EnumProperty,\r\n    PropTypes    = toolprop.PropTypes;\r\n\r\nlet UIBase     = ui_base.UIBase,\r\n    PackFlags  = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nlet parsepx = ui_base.parsepx;\r\n\r\ncconst.DEBUG.buttonEvents = true;\r\n\r\nexport class ButtonEventBase extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._auto_depress = true;\r\n    this._highlight = false;\r\n    this._pressed = false;\r\n  }\r\n\r\n  bindEvents() {\r\n    let press_gen = 0;\r\n    let depress;\r\n\r\n    let press = (e) => {\r\n      e.stopPropagation();\r\n\r\n      if (!this.modalRunning) {\r\n        let this2 = this;\r\n\r\n        this.pushModal({\r\n          on_pointerdown(e) {\r\n            this.end(e);\r\n          },\r\n\r\n          on_pointerup(e) {\r\n            this.end(e);\r\n          },\r\n\r\n          on_pointercancel(e) {\r\n            console.warn(\"Pointer cancel in button\");\r\n            this2.popModal();\r\n          },\r\n\r\n          on_keydown(e) {\r\n            switch (e.keyCode) {\r\n              case keymap[\"Enter\"]:\r\n              case keymap[\"Escape\"]:\r\n              case keymap[\"Space\"]:\r\n                this.end();\r\n                break;\r\n            }\r\n          },\r\n\r\n          end(e) {\r\n            if (!this2.modalRunning) {\r\n              return;\r\n            }\r\n\r\n            this2.popModal();\r\n            depress(e);\r\n          }\r\n        }, undefined, e.pointerId);\r\n      }\r\n\r\n      if (cconst.DEBUG.buttonEvents) {\r\n        console.log(\"button press\", this._pressed, this.disabled, e.button);\r\n      }\r\n\r\n      if (this.disabled) return;\r\n\r\n      this._pressed = true;\r\n\r\n      if (this._onpress) {\r\n        this._onpress(this);\r\n      }\r\n\r\n      this._redraw();\r\n\r\n      e.preventDefault();\r\n    };\r\n\r\n    depress = (e) => {\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(\"button depress\", e.button, e.was_touch);\r\n\r\n      if (this._auto_depress) {\r\n        this._pressed = false;\r\n\r\n        if (this.disabled) return;\r\n\r\n        this._redraw();\r\n      }\r\n\r\n      if (e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        if (util.isMobile() || e.type === \"pointerup\" && e.button) {\r\n          return;\r\n        }\r\n      }\r\n\r\n      this._redraw();\r\n\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(\"button click callback:\", this.onclick, this._onpress, this.onpress);\r\n\r\n      if (this.onclick && e && e.pointerType !== \"mouse\") {\r\n        this.onclick(this);\r\n      }\r\n\r\n      this.undoBreakPoint();\r\n    }\r\n\r\n    this.addEventListener(\"click\", () => {\r\n      this._pressed = false;\r\n      this._highlight = false;\r\n      this._redraw();\r\n    });\r\n\r\n    this.addEventListener(\"pointerdown\", press, {captured: true, passive: false});\r\n    this.addEventListener(\"pointerup\", depress, {captured: true, passive: false});\r\n    this.addEventListener(\"pointerover\", (e) => {\r\n      if (this.disabled)\r\n        return;\r\n\r\n      this._highlight = true;\r\n      this._redraw();\r\n    })\r\n\r\n    this.addEventListener(\"pointerout\", (e) => {\r\n      if (this.disabled)\r\n        return;\r\n\r\n      this._highlight = false;\r\n      this._redraw();\r\n    })\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      if (this.disabled) return;\r\n\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(e.keyCode);\r\n\r\n      switch (e.keyCode) {\r\n        case 27: //escape\r\n          this.blur();\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          break;\r\n        case 32: //spacebar\r\n        case 13: //enter\r\n          this.click();\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          break;\r\n      }\r\n    });\r\n\r\n    this.addEventListener(\"focusin\", () => {\r\n      if (this.disabled) return;\r\n\r\n      this._focus = 1;\r\n      this._redraw();\r\n      this.focus();\r\n    });\r\n\r\n    this.addEventListener(\"blur\", () => {\r\n      if (this.disabled) return;\r\n\r\n      this._focus = 0;\r\n      this._redraw();\r\n    });\r\n  }\r\n\r\n  _redraw() {\r\n\r\n  }\r\n}\r\n\r\nexport class Button extends ButtonEventBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.label = document.createElement(\"span\");\r\n    this.label.innerText = \"button\";\r\n    this.shadow.appendChild(this.label);\r\n\r\n    this.label.style[\"pointer-events\"] = \"none\";\r\n\r\n    this._pressed = false;\r\n    this._highlight = false;\r\n    this._pressedTime = 0;\r\n    this._pressedTimeout = 100;\r\n\r\n    this._auto_depress = true;\r\n\r\n    this._last_name = undefined;\r\n    this._last_disabled = undefined;\r\n  }\r\n\r\n  get name() {\r\n    return \"\" + this.getAttribute(\"name\");\r\n  }\r\n\r\n  set name(val) {\r\n    this.setAttribute(\"name\", val);\r\n  }\r\n\r\n  get _pressed() {\r\n    return this.__pressed;\r\n  }\r\n\r\n  set _pressed(v) {\r\n    let changed = !v !== !this._pressed;\r\n\r\n    if (v) {\r\n      this._pressedTime = util.time_ms();\r\n    } else if (changed && util.time_ms() - this._pressedTime < this._pressedTimeout) {\r\n      window.setTimeout(() => {\r\n        this.setCSS();\r\n      }, this._pressedTimeout - (util.time_ms() - this._pressedTime) + 1);\r\n    }\r\n\r\n    this.__pressed = v;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"button-x\",\r\n      style  : \"button\"\r\n    };\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this.tabIndex = 0;\r\n\r\n    this.bindEvents();\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  on_enabled() {\r\n    this.setCSS();\r\n  }\r\n\r\n  on_disabled() {\r\n    this.setCSS();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    if (this.hasDefault(\"pressedTimeout\")) {\r\n      this._pressedTimeout = this.getDefault(\"pressedTimeout\");\r\n    }\r\n\r\n    let subkey = undefined;\r\n\r\n    let pressed = this._pressed;\r\n    if (!pressed && util.time_ms() - this._pressedTime < this._pressedTimeout) {\r\n      pressed = true;\r\n    }\r\n\r\n    if (this.disabled) {\r\n      subkey = \"disabled\";\r\n    } else if (pressed && this._highlight) {\r\n      subkey = \"highlight-pressed\";\r\n    } else if (pressed) {\r\n      subkey = \"pressed\";\r\n    } else if (this._highlight) {\r\n      subkey = \"highlight\";\r\n    }\r\n\r\n    let h = this.getDefault(\"height\");\r\n\r\n    this.setBoxCSS(subkey);\r\n\r\n    this.label.style[\"padding\"] = this.label.style[\"margin\"] = \"0px\";\r\n    this.style[\"background-color\"] = this.getSubDefault(subkey, \"background-color\");\r\n\r\n    let font = this.getSubDefault(subkey, \"DefaultText\");\r\n    this.label.style[\"font\"] = font.genCSS();\r\n    this.label.style[\"color\"] = font.color;\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"align-items\"] = \"center\";\r\n    this.style[\"width\"] = \"max-content\";\r\n    this.style[\"height\"] = h + \"px\";\r\n\r\n    this.style[\"user-select\"] = \"none\";\r\n    this.label.style[\"user-select\"] = \"none\";\r\n  }\r\n\r\n  click() {\r\n    if (this._onpress) {\r\n      let rect = this.getClientRects();\r\n      let x = rect.x + rect.width*0.5;\r\n      let y = rect.y + rect.height*0.5;\r\n\r\n      let e = {x         : x, y: y, stopPropagation: () => {\r\n        }, preventDefault: () => {\r\n        }\r\n      };\r\n\r\n      this._onpress(e);\r\n    }\r\n\r\n    super.click();\r\n  }\r\n\r\n  _redraw() {\r\n    this.setCSS();\r\n  }\r\n\r\n  updateDisabled() {\r\n    if (this._last_disabled !== this.disabled) {\r\n      this._last_disabled = this.disabled;\r\n\r\n      //setTimeout(() => {\r\n\r\n      this._redraw();\r\n\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(\"disabled update!\", this.disabled, this.style[\"background-color\"]);\r\n      //}, 100);\r\n    }\r\n  }\r\n\r\n  update() {\r\n    if (this._last_name !== this.name) {\r\n      this.label.innerHTML = this.name;\r\n      this._last_name = this.name;\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.register(Button);\r\n\r\n//use .setAttribute(\"linear\") to disable nonlinear sliding\r\nexport class OldButton extends ButtonEventBase {\r\n  constructor() {\r\n    super();\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    this._last_but_update_key = \"\";\r\n\r\n    this._name = \"\";\r\n    this._namePad = undefined;\r\n    this._leftPad = 5; //extra pad before text\r\n    this._rightPad = 5; //extra pad after text\r\n\r\n    this._last_w = 0;\r\n    this._last_h = 0;\r\n\r\n    this._last_dpi = dpi;\r\n\r\n    this._lastw = undefined;\r\n    this._lasth = undefined;\r\n\r\n    this.dom = document.createElement(\"canvas\");\r\n    this.g = this.dom.getContext(\"2d\");\r\n\r\n    this.dom.setAttribute(\"class\", \"canvas1\");\r\n    this.dom.tabIndex = 0;\r\n\r\n    this._last_bg = undefined;\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      if (this.disabled) return;\r\n\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(e.keyCode);\r\n\r\n      switch (e.keyCode) {\r\n        case 27: //escape\r\n          this.blur();\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          break;\r\n        case 32: //spacebar\r\n        case 13: //enter\r\n          this.click();\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          break;\r\n      }\r\n    });\r\n\r\n    this.addEventListener(\"focusin\", () => {\r\n      if (this.disabled) return;\r\n\r\n      this._focus = 1;\r\n      this._redraw();\r\n      this.focus();\r\n    });\r\n\r\n    this.addEventListener(\"blur\", () => {\r\n      if (this.disabled) return;\r\n\r\n      this._focus = 0;\r\n      this._redraw();\r\n    });\r\n\r\n    this._last_disabled = false;\r\n    this._auto_depress = true;\r\n\r\n    this.shadow.appendChild(this.dom);\r\n  }\r\n\r\n  get r() {\r\n    return this.getDefault(\"border-radius\");\r\n  }\r\n\r\n  set r(val) {\r\n    this.overrideDefault(\"border-radius\", val);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"old-button-x\",\r\n      style  : \"button\"\r\n    };\r\n  }\r\n\r\n  click() {\r\n    if (this._onpress) {\r\n      let rect = this.getClientRects();\r\n      let x = rect.x + rect.width*0.5;\r\n      let y = rect.y + rect.height*0.5;\r\n\r\n      let e = {x         : x, y: y, stopPropagation: () => {\r\n        }, preventDefault: () => {\r\n        }\r\n      };\r\n\r\n      this._onpress(e);\r\n    }\r\n\r\n    super.click();\r\n  }\r\n\r\n  init() {\r\n    let dpi = this.getDPI();\r\n\r\n    //set default dimensions\r\n    let width = ~~(this.getDefault(\"width\"));\r\n    let height = ~~(this.getDefault(\"height\"));\r\n\r\n    this.dom.style[\"width\"] = width + \"px\";\r\n    this.dom.style[\"height\"] = height + \"px\";\r\n    this.dom.style[\"padding\"] = this.dom.style[\"margin\"] = \"0px\";\r\n\r\n    this.dom.width = Math.ceil(width*dpi); //parsepx(this.dom.style[\"width\"])*dpi;\r\n    this.dom.height = Math.ceil(parsepx(this.dom.style[\"height\"])*dpi);\r\n\r\n    this._name = undefined;\r\n    this.updateName();\r\n\r\n    this.bindEvents();\r\n    this._redraw();\r\n  }\r\n\r\n  setAttribute(key, val) {\r\n    super.setAttribute(key, val);\r\n\r\n    if (key === \"name\") {\r\n      this.updateName();\r\n      this.updateWidth();\r\n    }\r\n  }\r\n\r\n  old_bindEvents() {\r\n    let press_gen = 0;\r\n\r\n    let press = (e) => {\r\n      e.stopPropagation();\r\n\r\n      if (cconst.DEBUG.buttonEvents) {\r\n        console.log(\"button press\", this._pressed, this.disabled, e.button);\r\n      }\r\n\r\n      if (this.disabled) return;\r\n\r\n      this._pressed = true;\r\n\r\n      if (util.isMobile() && this.onclick && e.button === 0) {\r\n        this.onclick();\r\n      }\r\n\r\n      if (this._onpress) {\r\n        this._onpress(this);\r\n      }\r\n\r\n      this._redraw();\r\n\r\n      e.preventDefault();\r\n    };\r\n\r\n    let depress = (e) => {\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(\"button depress\", e.button, e.was_touch);\r\n\r\n      if (this._auto_depress) {\r\n        this._pressed = false;\r\n\r\n        if (this.disabled) return;\r\n\r\n        this._redraw();\r\n      }\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n\r\n      if (util.isMobile() || e.type === \"pointerup\" && e.button) {\r\n        return;\r\n      }\r\n\r\n      this._redraw();\r\n\r\n      if (cconst.DEBUG.buttonEvents) {\r\n        console.log(\"button click callback:\", this.onclick, this._onpress, this.onpress);\r\n      }\r\n\r\n      if (this.onclick && e.pointerType !== \"mouse\") {\r\n        this.onclick(this);\r\n      }\r\n\r\n      this.undoBreakPoint();\r\n    }\r\n\r\n    this.addEventListener(\"mousedown\", press, {captured: true, passive: false});\r\n    this.addEventListener(\"mouseup\", depress, {captured: true, passive: false});\r\n    this.addEventListener(\"mouseover\", (e) => {\r\n      if (this.disabled)\r\n        return;\r\n\r\n      this._highlight = true;\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    })\r\n\r\n    this.addEventListener(\"mouseout\", (e) => {\r\n      if (this.disabled)\r\n        return;\r\n\r\n      this._highlight = false;\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    })\r\n  }\r\n\r\n  updateDisabled() {\r\n    if (this._last_disabled !== this.disabled) {\r\n      this._last_disabled = this.disabled;\r\n\r\n      //setTimeout(() => {\r\n      this.dom._background = this.getDefault(\"background-color\");\r\n\r\n      this._repos_canvas();\r\n      this._redraw();\r\n\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(\"disabled update!\", this.disabled, this.style[\"background-color\"]);\r\n      //}, 100);\r\n    }\r\n  }\r\n\r\n  updateDefaultSize() {\r\n    let height = ~~(this.getDefault(\"height\")) + this.getDefault(\"padding\");\r\n    let size = this.getDefault(\"DefaultText\").size*1.33;\r\n\r\n    if (height === undefined || size === undefined || isNaN(height) || isNaN(size)) {\r\n      return;\r\n    }\r\n\r\n    height = ~~Math.max(height, size);\r\n    height = height + \"px\";\r\n\r\n    if (height !== this.style[\"height\"]) {\r\n      this.style[\"height\"] = height;\r\n      this.dom.style[\"height\"] = height;\r\n\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _calcUpdateKey() {\r\n    return _themeUpdateKey;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.style[\"user-select\"] = \"none\";\r\n    this.dom.style[\"user-select\"] = \"none\";\r\n\r\n    this.updateDefaultSize();\r\n    this.updateWidth();\r\n    this.updateDPI();\r\n    this.updateName();\r\n    this.updateDisabled();\r\n\r\n    if (this.background !== this._last_bg) {\r\n      this._last_bg = this.background;\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n\r\n    let key = this._calcUpdateKey();\r\n    if (key !== this._last_but_update_key) {\r\n      this._last_but_update_key = key;\r\n\r\n      this.setCSS();\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.dom.style[\"margin\"] = this.getDefault(\"margin\", undefined, 0) + \"px\";\r\n    this.dom.style[\"margin-left\"] = this.getDefault(\"margin-left\", undefined, 0) + \"px\";\r\n    this.dom.style[\"margin-right\"] = this.getDefault(\"margin-right\", undefined, 0) + \"px\";\r\n    this.dom.style[\"margin-top\"] = this.getDefault(\"margin-top\", undefined, 0) + \"px\";\r\n    this.dom.style[\"margin-bottom\"] = this.getDefault(\"margin-bottom\", undefined, 0) + \"px\";\r\n\r\n    let name = this._name;\r\n    if (name === undefined) {\r\n      return;\r\n    }\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let pad = this.getDefault(\"padding\");\r\n    let ts = this.getDefault(\"DefaultText\").size;\r\n\r\n    let tw = ui_base.measureText(this, this._genLabel(), {\r\n      size: ts,\r\n      font: this.getDefault(\"DefaultText\")\r\n    }).width + 2.0*pad + this._leftPad + this._rightPad;\r\n\r\n    if (this._namePad !== undefined) {\r\n      tw += this._namePad;\r\n    }\r\n\r\n    let w = this.getDefault(\"width\");\r\n\r\n    w = Math.max(w, tw);\r\n    w = ~~w;\r\n    this.dom.style[\"width\"] = w + \"px\";\r\n    this.updateBorders();\r\n  }\r\n\r\n  updateBorders() {\r\n    let lwid = this.getDefault(\"border-width\");\r\n\r\n    if (lwid) {\r\n      this.dom.style[\"border-color\"] = this.getDefault(\"border-color\");\r\n      this.dom.style[\"border-width\"] = lwid + \"px\";\r\n      this.dom.style[\"border-style\"] = \"solid\";\r\n      this.dom.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n    } else {\r\n      this.dom.style[\"border-color\"] = \"none\";\r\n      this.dom.style[\"border-width\"] = \"0px\";\r\n      this.dom.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n    }\r\n\r\n  }\r\n\r\n  updateName() {\r\n    if (!this.hasAttribute(\"name\")) {\r\n      return;\r\n    }\r\n\r\n    let name = this.getAttribute(\"name\");\r\n\r\n    if (name !== this._name) {\r\n      this._name = name;\r\n\r\n      this.setCSS();\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  updateWidth(w_add = 0) {\r\n  }\r\n\r\n  _repos_canvas() {\r\n    let dpi = this.getDPI();\r\n\r\n    let w = parsepx(this.dom.style[\"width\"]);\r\n    let h = parsepx(this.dom.style[\"height\"]);\r\n\r\n    let w2 = ~~(w*dpi);\r\n    let h2 = ~~(h*dpi);\r\n\r\n    w = w2/dpi;\r\n    h = h2/dpi;\r\n\r\n    this.dom.width = w2;\r\n    this.dom.style[\"width\"] = w + \"px\";\r\n\r\n    this.dom.height = h2;\r\n    this.dom.style[\"height\"] = h + \"px\";\r\n  }\r\n\r\n  updateDPI() {\r\n    let dpi = this.getDPI();\r\n\r\n    if (this._last_dpi !== dpi) {\r\n      //console.log(\"update dpi\", dpi);\r\n\r\n      this._last_dpi = dpi;\r\n\r\n      this.g.font = undefined; //reset font\r\n\r\n      this.setCSS();\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n\r\n    if (this.style[\"background-color\"]) {\r\n      this.dom._background = this.style[\"background-color\"];\r\n      this.style[\"background-color\"] = \"\";\r\n    }\r\n\r\n    //console.log(\">\", this.dom.style[\"background-color\"], \"-----\");\r\n    //console.log(\"width:\", this.clientWidth)\r\n  }\r\n\r\n  _genLabel() {\r\n    return \"\" + this._name;\r\n  }\r\n\r\n  _getSubKey() {\r\n    if (this._pressed) {\r\n      return 'depressed';\r\n    } else if (this._highlight) {\r\n      return 'highlight';\r\n    } else {\r\n      return undefined; //make getSubDefault forward to getDefault\r\n    }\r\n  }\r\n\r\n  _redraw(draw_text = true) {\r\n    //console.log(\"button draw\");\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let subkey = this._getSubKey();\r\n\r\n    if (this._pressed && this._highlight) {\r\n      this.dom._background = this.getSubDefault(subkey, \"highlight-pressed\", \"BoxHighlight\");\r\n    } else if (this._pressed) {\r\n      this.dom._background = this.getSubDefault(subkey, \"pressed\", \"BoxDepressed\");\r\n    } else if (this._highlight) {\r\n      this.dom._background = this.getSubDefault(subkey, \"highlight\", \"BoxHighlight\");\r\n    } else {\r\n      this.dom._background = this.getSubDefault(subkey, \"background-color\", \"background-color\");\r\n    }\r\n\r\n    ui_base.drawRoundBox(this, this.dom, this.g);\r\n\r\n    //drawn with CSS now\r\n    /*\r\n    let lwid = this.getDefault(\"border-width\");\r\n    if (lwid) {\r\n      this.g.lineWidth = lwid*dpi;\r\n      ui_base.drawRoundBox(this, this.dom, this.g, undefined, undefined, undefined, \"stroke\");\r\n    }\r\n     */\r\n\r\n    this.updateBorders();\r\n\r\n    if (this._focus) {\r\n      let w = this.dom.width, h = this.dom.height;\r\n      let p = 1/dpi;\r\n\r\n      //XXX remove this.g.translate lines after refactoring drawRoundBox, see comment in ui_base.js\r\n      this.g.translate(p, p);\r\n      let lw = this.g.lineWidth;\r\n\r\n\r\n      this.g.lineWidth = this.getDefault(\"focus-border-width\", undefined, 1.0)*dpi;\r\n\r\n      ui_base.drawRoundBox(this, this.dom, this.g, w - p*2, h - p*2, this.r, \"stroke\", this.getDefault(\"BoxHighlight\"));\r\n\r\n      this.g.lineWidth = lw;\r\n      this.g.translate(-p, -p);\r\n    }\r\n\r\n    if (draw_text) {\r\n      this._draw_text();\r\n    }\r\n  }\r\n\r\n  _draw_text() {\r\n    let dpi = this.getDPI();\r\n\r\n    let subkey = this._getSubKey();\r\n\r\n    //if (util.isMobile()) {\r\n    //dpi = dpi; //visualViewport.scale;\r\n    //}\r\n\r\n    let font = this.getSubDefault(subkey, \"DefaultText\");\r\n\r\n    let pad = this.getDefault(\"padding\")*dpi;\r\n    let ts = font.size*dpi;\r\n\r\n    let text = this._genLabel();\r\n\r\n    //console.log(text, \"text\", this._name);\r\n\r\n    let w = this.dom.width, h = this.dom.height;\r\n\r\n    let tw = ui_base.measureText(this, text, undefined, undefined, ts, font).width;\r\n\r\n    let cx = pad*0.5 + this._leftPad*dpi;\r\n    let cy = ts + (h - ts)/3.0;\r\n\r\n    let g = this.g;\r\n\r\n    ui_base.drawText(this, ~~cx, ~~cy, text, {\r\n      canvas: this.dom,\r\n      g     : this.g,\r\n      size  : ts/dpi,\r\n      font  : font\r\n    });\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(OldButton);\r\n","\"use strict\";\r\n\r\nimport * as units from '../core/units.js';\r\nimport * as util from '../path-controller/util/util.js';\r\nimport {Vector2, Vector3, Vector4, Matrix4, Quat} from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nfunction myToFixed(s, n) {\r\n  s = s.toFixed(n);\r\n\r\n  while (s.endsWith('0')) {\r\n    s = s.slice(0, s.length-1);\r\n  }\r\n  if (s.endsWith(\"\\.\")) {\r\n    s = s.slice(0, s.length-1);\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nlet keymap = events.keymap;\r\n\r\nlet EnumProperty = toolprop.EnumProperty,\r\n    PropTypes = toolprop.PropTypes;\r\n\r\nlet UIBase = ui_base.UIBase,\r\n    PackFlags = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nlet parsepx = ui_base.parsepx;\r\n\r\nimport {Button} from './ui_button.js';\r\nimport {_setTextboxClass} from '../core/ui_base.js';\r\n\r\nexport class TextBoxBase extends UIBase {\r\n  static define() {return {\r\n    modalKeyEvents : true\r\n  }}\r\n}\r\n\r\nexport class TextBox extends TextBoxBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._width = this.getDefault(\"width\") + \"px\";\r\n    this._textBoxEvents = true;\r\n\r\n    let margin = Math.ceil(3 * this.getDPI());\r\n\r\n    this._had_error = false;\r\n\r\n    this.decimalPlaces = undefined; //will inherit from property defaults\r\n\r\n    this.baseUnit = undefined; //will automatically use defaults\r\n    this.displayUnit = undefined; //will automatically use defaults\r\n\r\n    this.dom = document.createElement(\"input\");\r\n\r\n    this.dom.tabIndex = 0;\r\n    this.dom.setAttribute(\"tabindex\", 0);\r\n    this.dom.setAttribute(\"tab-index\", 0);\r\n    this.dom.style[\"margin\"] = margin + \"px\";\r\n\r\n    this.dom.setAttribute(\"type\", \"textbox\");\r\n    this.dom.onchange = (e) => {\r\n      this._change(this.dom.value);\r\n    }\r\n\r\n    this.radix = 16;\r\n\r\n    this.dom.oninput = (e) => {\r\n      this._change(this.dom.value);\r\n    }\r\n\r\n    this.shadow.appendChild(this.dom);\r\n\r\n    this.dom.addEventListener(\"focus\", (e) => {\r\n      console.log(\"Textbox focus\", this.isModal);\r\n\r\n      this._focus = 1;\r\n\r\n      if (this.isModal) {\r\n        this._startModal();\r\n        this.setCSS();\r\n      }\r\n    });\r\n\r\n    this.dom.addEventListener(\"blur\", (e) => {\r\n      console.log(\"Textbox blur\");\r\n\r\n      this._focus = 0;\r\n\r\n      if (this._modal) {\r\n        this._endModal(true);\r\n        this.setCSS();\r\n      }\r\n    });\r\n\r\n  }\r\n\r\n  /** realtime dom attribute getter, defaults to true in absence of attribute*/\r\n  get realtime() {\r\n    let ret = this.getAttribute(\"realtime\");\r\n\r\n    if (!ret) {\r\n      return true;\r\n    }\r\n\r\n    ret = ret.toLowerCase().trim();\r\n\r\n    return ret === 'yes' || ret === 'true' || ret === 'on';\r\n  }\r\n\r\n  set realtime(val) {\r\n    this.setAttribute('realtime', val ? 'true' : 'false');\r\n  }\r\n\r\n  get isModal() {\r\n    let ret = this.getAttribute(\"modal\");\r\n\r\n    if (!ret) {\r\n      return false;\r\n    }\r\n\r\n    ret = ret.toLowerCase().trim();\r\n\r\n    return ret === 'yes' || ret === 'true' || ret === 'on';\r\n  }\r\n\r\n  set isModal(val) {\r\n    this.setAttribute('modal', val ? 'true' : 'false');\r\n  }\r\n\r\n  _startModal() {\r\n    console.warn(\"textbox modal\");\r\n\r\n    if (this._modal) {\r\n      this._endModal(true);\r\n    }\r\n\r\n    let ignore = 0;\r\n\r\n    let finish = (ok) => {\r\n      this._endModal(ok);\r\n    }\r\n\r\n    let keydown = (e) => {\r\n      e.stopPropagation();\r\n\r\n      switch (e.keyCode) {\r\n        case keymap.Enter:\r\n          finish(true);\r\n          break;\r\n        case keymap.Escape:\r\n          finish(false);\r\n          break;\r\n      }\r\n\r\n      return;\r\n      if (ignore) return;\r\n\r\n      let e2 = new KeyboardEvent(e.type, e);\r\n\r\n      ignore = 1;\r\n      this.dom.dispatchEvent(e2);\r\n      ignore = 0;\r\n    };\r\n\r\n    this._modal = true;\r\n    this.pushModal({\r\n      on_mousemove : (e) => {\r\n        e.stopPropagation();\r\n      },\r\n\r\n      on_keydown : keydown,\r\n      on_keypress : keydown,\r\n      on_keyup : keydown,\r\n\r\n      on_mousedown : (e) => {\r\n        e.stopPropagation();\r\n        console.log(\"mouse down\", e, e.x, e.y);\r\n      }\r\n    }, false)\r\n  }\r\n\r\n  _flash_focus() {\r\n    //don't focus on flash\r\n  }\r\n\r\n  _endModal(ok) {\r\n    console.log(\"textbox end modal\");\r\n\r\n    this._modal = false;\r\n    this.popModal();\r\n\r\n    this.blur();\r\n\r\n    if (this.onend) {\r\n      this.onend(ok);\r\n    } else {\r\n      this._updatePathVal(this.dom.value);\r\n    }\r\n\r\n    this.blur();\r\n  }\r\n\r\n  get tabIndex() {\r\n    return this.dom.tabIndex;\r\n  }\r\n\r\n  set tabIndex(val) {\r\n    this.dom.tabIndex = val;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    //set isModal default\r\n    if (!this.hasAttribute('modal')) {\r\n      this.isModal = true;\r\n    }\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"width\"] = this._width;\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  set width(val) {\r\n    if (typeof val === \"number\") {\r\n      val += \"px\";\r\n    }\r\n\r\n    this._width = val;\r\n    this.style[\"width\"] = val;\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.overrideDefault(\"background-color\", this.getDefault(\"background-color\"));\r\n\r\n    this.background = this.getDefault(\"background-color\");\r\n    this.dom.style[\"margin\"] = this.dom.style[\"padding\"] = \"0px\";\r\n\r\n    if (this.getDefault(\"background-color\")) {\r\n      this.dom.style[\"background-color\"] = this.getDefault(\"background-color\");\r\n    }\r\n\r\n    if (this._focus) {\r\n      this.dom.style[\"border\"] = `2px dashed ${this.getDefault('focus-border-color')}`;\r\n    } else {\r\n      this.dom.style[\"border\"] = \"none\";\r\n    }\r\n\r\n    if (this.style[\"font\"]) {\r\n      this.dom.style[\"font\"] = this.style[\"font\"];\r\n    } else {\r\n      this.dom.style[\"font\"] = this.getDefault(\"DefaultText\").genCSS();\r\n      this.dom.style[\"color\"] = this.getDefault(\"DefaultText\").color;\r\n    }\r\n\r\n    this.dom.style[\"width\"] = \"100%\";\r\n    this.dom.style[\"height\"] = \"100%\";\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.ctx || !this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n    if (this._focus || this._flashtimer !== undefined || (this._had_error && this._focus)) {\r\n      return;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n    if (val === undefined || val === null) {\r\n      this.internalDisabled = true;\r\n      return;\r\n    } else {\r\n      this.internalDisabled = false;\r\n    }\r\n\r\n\r\n    let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    let text = this.text;\r\n\r\n    if (!prop) {\r\n      console.error(\"datapath error \" + this.getAttribute(\"datapath\"), val);\r\n      return;\r\n    }\r\n\r\n    let is_num = prop.type & (PropTypes.FLOAT|PropTypes.INT);\r\n    if (typeof val === \"number\" && (prop.type & (PropTypes.VEC2|PropTypes.VEC3|PropTypes.VEC4|PropTypes.QUAT))) {\r\n      is_num = true;\r\n    }\r\n\r\n    if (is_num) {\r\n      let is_int = prop.type === PropTypes.INT;\r\n\r\n      this.radix = prop.radix;\r\n\r\n      let decimalPlaces = this.decimalPlaces !== undefined ? this.decimalPlaces : prop.decimalPlaces;\r\n      if (this.hasAttribute(\"decimalPlaces\")) {\r\n        decimalPlaces = parseInt(this.getAttribute(\"decimalPlaces\"));\r\n      }\r\n\r\n      let baseUnit = this.baseUnit ?? prop.baseUnit;\r\n      if (this.hasAttribute(\"baseUnit\")) {\r\n        baseUnit = this.getAttribute(\"baseUnit\");\r\n      }\r\n\r\n      let displayUnit = this.displayUnit ?? prop.displayUnit;\r\n      if (this.hasAttribute(\"displayUnit\")) {\r\n        displayUnit = this.getAttribute(\"displayUnit\");\r\n      }\r\n\r\n      if (is_int && this.radix === 2) {\r\n        text = val.toString(this.radix);\r\n        text = \"0b\" + text;\r\n      } else if (is_int && this.radix === 16) {\r\n        text += \"h\";\r\n      } else {\r\n        text = units.buildString(val, baseUnit, decimalPlaces, displayUnit);\r\n      }\r\n    } else if (prop !== undefined && prop.type === PropTypes.STRING) {\r\n      text = val;\r\n    }\r\n\r\n    if (this.text !== text) {\r\n      this.text = text;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    if (this.dom.style[\"width\"] !== this.style[\"width\"]) {\r\n      this.dom.style[\"width\"] = this.style[\"width\"];\r\n    }\r\n    if (this.dom.style[\"height\"] !== this.style[\"height\"]) {\r\n      this.dom.style[\"height\"] = this.style[\"height\"];\r\n    }\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  select() {\r\n    this.dom.select();\r\n    //return this.dom.select.apply(this, arguments);\r\n  }\r\n\r\n  focus() {\r\n    return this.dom.focus();\r\n  }\r\n\r\n  blur() {\r\n    return this.dom.blur();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"textbox-x\",\r\n    style   : \"textbox\",\r\n    modalKeyEvents : true\r\n  };}\r\n\r\n  get text() {\r\n    return this.dom.value;\r\n  }\r\n\r\n  set text(value) {\r\n    this.dom.value = value;\r\n  }\r\n\r\n  _prop_update(prop, text) {\r\n    let is_num = prop.type & (PropTypes.FLOAT|PropTypes.INT);\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (typeof val === \"number\" && (prop.type & (PropTypes.VEC2|PropTypes.VEC3|PropTypes.VEC4|PropTypes.QUAT))) {\r\n      is_num = true;\r\n    }\r\n\r\n    if (is_num) {\r\n      let is_int = prop.type === PropTypes.INT;\r\n\r\n      this.radix = prop.radix;\r\n\r\n      let decimalPlaces = this.decimalPlaces !== undefined ? this.decimalPlaces : prop.decimalPlaces;\r\n      if (this.hasAttribute(\"decimalPlaces\")) {\r\n        decimalPlaces = parseInt(this.getAttribute(\"decimalPlaces\"));\r\n      }\r\n\r\n      let baseUnit = this.baseUnit ?? prop.baseUnit;\r\n      if (this.hasAttribute(\"baseUnit\")) {\r\n        baseUnit = this.getAttribute(\"baseUnit\");\r\n      }\r\n\r\n      let displayUnit = this.displayUnit ?? prop.displayUnit;\r\n      if (this.hasAttribute(\"displayUnit\")) {\r\n        displayUnit = this.getAttribute(\"displayUnit\");\r\n      }\r\n\r\n      if (!units.isNumber(text.trim())) {\r\n        this.flash(ui_base.ErrorColors.ERROR, this.dom, undefined, false);\r\n        this.focus();\r\n        this.dom.focus();\r\n        this._had_error = true;\r\n      } else {\r\n        let val = units.parseValue(text, baseUnit, displayUnit);\r\n\r\n        if (this._had_error) {\r\n          this.flash(ui_base.ErrorColors.OK, this.dom, undefined, false);\r\n        }\r\n\r\n        this._had_error = false;\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), val);\r\n      }\r\n    } else if (prop.type === PropTypes.STRING) {\r\n      try {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this.text);\r\n\r\n        if (this._had_error) {\r\n          this.flash(ui_base.ErrorColors.OK, this.dom, undefined, false);\r\n          this.dom.focus();\r\n        }\r\n\r\n        this._had_error = false;\r\n      } catch (error) {\r\n        console.log(error.stack);\r\n        console.log(error.message);\r\n        console.warn(\"textbox error!\");\r\n        //this._had_error = true;\r\n\r\n        this.flash(ui_base.ErrorColors.ERROR, this.dom, undefined, false);\r\n        this.dom.focus();\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  _updatePathVal(text) {\r\n    if (this.hasAttribute(\"datapath\") && this.ctx !== undefined) {\r\n      let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n      console.log(prop);\r\n\r\n      if (prop) {\r\n        this._prop_update(prop, text);\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  _change(text) {\r\n    if (this.realtime) {\r\n      this._updatePathVal(text);\r\n    }\r\n\r\n    if (this.onchange) {\r\n      this.onchange(text);\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(TextBox);\r\n\r\n/**\r\n\r\n Returns false if it's safe to call preventDefault.\r\n\r\n Returns true if the element at position x,y is\r\n either a textbox or is draggable.\r\n */\r\nexport function checkForTextBox(screen, x, y) {\r\n  let p = screen.pickElement(x, y);\r\n  //console.log(p, x, y);\r\n\r\n  while (p) {\r\n    //don't prevent draggable elements from dragging\r\n    if (p.draggable) {\r\n      return true;\r\n    }\r\n\r\n    if (p instanceof UIBase) {\r\n      //check immediate children of p\r\n      for (let i=0; i<2; i++) {\r\n        let nodes = i ? p.childNodes : p.shadow.childNodes;\r\n\r\n        for (let child of nodes) {\r\n          if (child.draggable) {\r\n            return true;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    let ok = p instanceof TextBoxBase;\r\n    ok = ok || p.constructor.define && p.constructor.define().modalKeyEvents;\r\n\r\n    if (ok) {\r\n      return true;\r\n    }\r\n\r\n    p = p.parentWidget ? p.parentWidget : p.parentNode;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nui_base._setTextboxClass(TextBox);\r\n","\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as toolsys from '../path-controller/toolsys/toolsys.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport {DataPathError} from '../path-controller/controller/controller.js';\r\nimport {Vector3, Vector4, Quat, Matrix4} from '../path-controller/util/vectormath.js';\r\nimport {isNumber, PropFlags} from \"../path-controller/toolsys/toolprop.js\";\r\nimport * as units from '../core/units.js';\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nfunction myToFixed(s, n) {\r\n  s = s.toFixed(n);\r\n\r\n  while (s.endsWith('0')) {\r\n    s = s.slice(0, s.length - 1);\r\n  }\r\n  if (s.endsWith(\"\\.\")) {\r\n    s = s.slice(0, s.length - 1);\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nlet keymap = events.keymap;\r\n\r\nlet EnumProperty = toolprop.EnumProperty,\r\n    PropTypes    = toolprop.PropTypes;\r\n\r\nlet UIBase     = ui_base.UIBase,\r\n    PackFlags  = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nlet parsepx = ui_base.parsepx;\r\n\r\nimport {Button, OldButton} from './ui_button.js';\r\nimport {eventWasTouch, popModalLight, pushModalLight} from '../path-controller/util/simple_events.js';\r\n\r\nexport {Button} from './ui_button.js';\r\n\r\nexport class IconLabel extends UIBase {\r\n  constructor() {\r\n    super();\r\n    this._icon = -1;\r\n    this.iconsheet = 1;\r\n  }\r\n\r\n  get icon() {\r\n    return this._icon;\r\n  }\r\n\r\n  set icon(id) {\r\n    this._icon = id;\r\n    this.setCSS();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"icon-label-x\"\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"margin\"] = this.style[\"padding\"] = \"0px\";\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  setCSS() {\r\n    let size = ui_base.iconmanager.getTileSize(this.iconsheet);\r\n\r\n\r\n    ui_base.iconmanager.setCSS(this.icon, this);\r\n\r\n    this.style[\"width\"] = size + \"px\";\r\n    this.style[\"height\"] = size + \"px\";\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(IconLabel);\r\n\r\nexport class ValueButtonBase extends OldButton {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(val) {\r\n    this._value = val;\r\n\r\n    if (this.ctx && this.hasAttribute(\"datapath\")) {\r\n      this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this._value);\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) return;\r\n    if (this.ctx === undefined) return;\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (val === undefined) {\r\n      let redraw = !this.disabled;\r\n\r\n      this.internalDisabled = true;\r\n\r\n      if (redraw) this._redraw();\r\n\r\n      return;\r\n    } else {\r\n      let redraw = this.disabled;\r\n\r\n      this.internalDisabled = false;\r\n      if (redraw) this._redraw();\r\n    }\r\n\r\n    if (val !== this._value) {\r\n      this._value = val;\r\n      this.updateWidth();\r\n      this._repos_canvas();\r\n      this._redraw();\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    this.updateDataPath();\r\n\r\n    super.update();\r\n  }\r\n}\r\n\r\nexport class Check extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._checked = false;\r\n    this._highlight = false;\r\n    this._focus = false;\r\n\r\n    let shadow = this.shadow;\r\n\r\n    //let form = document.createElement(\"form\");\r\n\r\n    let span = document.createElement(\"span\");\r\n    span.setAttribute(\"class\", \"checkx\");\r\n\r\n    span.style[\"display\"] = \"flex\";\r\n    span.style[\"flex-direction\"] = \"row\";\r\n    span.style[\"margin\"] = span.style[\"padding\"] = \"0px\";\r\n    //span.style[\"background\"] = ui_base.iconmanager.getCSS(1);\r\n\r\n    let sheet = 0;\r\n    let size = ui_base.iconmanager.getTileSize(0);\r\n\r\n    let check = this.canvas = document.createElement(\"canvas\");\r\n    this.g = check.getContext(\"2d\");\r\n\r\n    check.setAttribute(\"id\", check._id);\r\n    check.setAttribute(\"name\", check._id);\r\n\r\n    let mdown = (e) => {\r\n      this._highlight = false;\r\n      this.checked = !this.checked;\r\n    };\r\n\r\n    let mup = (e) => {\r\n      this._highlight = false;\r\n      this.blur();\r\n      this._redraw();\r\n    };\r\n\r\n    let mover = (e) => {\r\n      this._highlight = true;\r\n      this._redraw();\r\n    };\r\n\r\n    let mleave = (e) => {\r\n      this._highlight = false;\r\n      this._redraw();\r\n    };\r\n\r\n    span.addEventListener(\"pointerover\", mover, {passive: true});\r\n    span.addEventListener(\"mousein\", mover, {passive: true});\r\n    span.addEventListener(\"mouseleave\", mleave, {passive: true});\r\n    span.addEventListener(\"pointerout\", mleave, {passive: true});\r\n\r\n    this.addEventListener(\"blur\", (e) => {\r\n      this._highlight = this._focus = false;\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"focusin\", (e) => {\r\n      this._focus = true;\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"focus\", (e) => {\r\n      this._focus = true;\r\n      this._redraw();\r\n    });\r\n\r\n\r\n    span.addEventListener(\"pointerdown\", mdown, {passive: true});\r\n    span.addEventListener(\"pointerup\", mup, {passive: true});\r\n    span.addEventListener(\"pointercancel\", mup, {passive: true});\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Escape\"]:\r\n          this._highlight = undefined;\r\n          this._redraw();\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n\r\n          this.blur();\r\n          break;\r\n        case keymap[\"Enter\"]:\r\n        case keymap[\"Space\"]:\r\n          this.checked = !this.checked;\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          break;\r\n      }\r\n    });\r\n    this.checkbox = check;\r\n\r\n    span.appendChild(check);\r\n\r\n    let label = this._label = document.createElement(\"label\");\r\n    label.setAttribute(\"class\", \"checkx\");\r\n    span.setAttribute(\"class\", \"checkx\");\r\n    label.style[\"align-self\"] = \"center\";\r\n\r\n    let side = this.getDefault(\"CheckSide\");\r\n    if (side === \"right\") {\r\n      span.prepend(label);\r\n    } else {\r\n      span.appendChild(label);\r\n    }\r\n\r\n    shadow.appendChild(span);\r\n  }\r\n\r\n  get internalDisabled() {\r\n    return super.internalDisabled;\r\n  }\r\n\r\n  set internalDisabled(val) {\r\n    if (!!this.internalDisabled === !!val) {\r\n      return;\r\n    }\r\n\r\n    super.internalDisabled = val;\r\n    this._redraw();\r\n  }\r\n\r\n  get value() {\r\n    return this.checked;\r\n  }\r\n\r\n  set value(v) {\r\n    this.checked = v;\r\n  }\r\n\r\n  get checked() {\r\n    return this._checked;\r\n  }\r\n\r\n  set checked(v) {\r\n    v = !!v;\r\n\r\n    if (this._checked !== v) {\r\n      this._checked = v;\r\n\r\n      this.setCSS();\r\n\r\n      //this.dom.checked = v;\r\n      this._redraw();\r\n\r\n      if (this.onclick) {\r\n        this.onclick(v);\r\n      }\r\n      if (this.onchange) {\r\n        this.onchange(v);\r\n      }\r\n\r\n      if (this.hasAttribute(\"datapath\")) {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this._checked);\r\n      }\r\n    }\r\n  }\r\n\r\n  get label() {\r\n    return this._label.textContent;\r\n  }\r\n\r\n  set label(l) {\r\n    this._label.textContent = l;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname    : \"check-x\",\r\n      style      : \"checkbox\",\r\n      parentStyle: \"button\"\r\n    };\r\n  }\r\n\r\n  init() {\r\n    this.tabIndex = 1;\r\n    this.setAttribute(\"class\", \"checkx\");\r\n\r\n\r\n    let style = document.createElement(\"style\");\r\n    //let style = this.cssStyleTag();\r\n\r\n    let color = this.getDefault(\"focus-border-color\");\r\n\r\n    style.textContent = `\r\n      .checkx:focus {\r\n        outline : none;\r\n      }\r\n    `;\r\n\r\n    //document.body.prepend(style);\r\n    this.prepend(style);\r\n  }\r\n\r\n  setCSS() {\r\n    this._label.style[\"font\"] = this.getDefault(\"DefaultText\").genCSS();\r\n    this._label.style[\"color\"] = this.getDefault(\"DefaultText\").color;\r\n\r\n    this._label.style['font'] = 'normal 14px poppins'; // TODO - Jordan - add to settings\r\n\r\n    super.setCSS();\r\n\r\n    //force clear background\r\n    this.style[\"background-color\"] = \"rgba(0,0,0,0)\";\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.getAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    let redraw = false;\r\n\r\n    if (val === undefined) {\r\n      this.internalDisabled = true;\r\n      return;\r\n    } else {\r\n      redraw = this.internalDisabled;\r\n\r\n      this.internalDisabled = false;\r\n    }\r\n\r\n    val = !!val;\r\n\r\n    redraw = redraw || !!this._checked !== !!val;\r\n\r\n    if (redraw) {\r\n      this._checked = val;\r\n      this._repos_canvas();\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _repos_canvas() {\r\n  }\r\n\r\n  _redraw() {\r\n    if (this.canvas === undefined) {\r\n      //flag update\r\n      this._updatekey = \"\";\r\n      return;\r\n    }\r\n\r\n    let canvas = this.canvas, g = this.g;\r\n    let dpi = UIBase.getDPI();\r\n    let tilesize = ui_base.iconmanager.getTileSize(0);\r\n    let pad = this.getDefault(\"padding\");\r\n\r\n    let csize = tilesize + pad*2;\r\n\r\n    canvas.style[\"margin\"] = \"2px\";\r\n    canvas.style[\"width\"] = csize + \"px\";\r\n    canvas.style[\"height\"] = csize + \"px\";\r\n\r\n    csize = ~~(csize*dpi + 0.5);\r\n    tilesize = ~~(tilesize*dpi + 0.5);\r\n\r\n    canvas.width = csize;\r\n    canvas.height = csize;\r\n\r\n    g.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    g.beginPath();\r\n    g.rect(0, 0, canvas.width, canvas.height);\r\n    g.fill();\r\n\r\n    let color;\r\n\r\n    if (!this._checked && this._highlight) {\r\n      color = this.getDefault(\"BoxHighlight\");\r\n    }\r\n\r\n    ui_base.drawRoundBox(this, canvas, g, undefined, undefined, undefined, undefined, color);\r\n    if (this._checked) {\r\n      //canvasDraw(elem, canvas, g, icon, x=0, y=0, sheet=0) {\r\n      let x = (csize - tilesize)*0.5, y = (csize - tilesize)*0.5;\r\n      ui_base.iconmanager.canvasDraw(this, canvas, g, ui_base.Icons.LARGE_CHECK, x, y);\r\n    }\r\n\r\n    if (this._focus) {\r\n      color = this.getDefault(\"focus-border-color\");\r\n      g.lineWidth *= dpi;\r\n      ui_base.drawRoundBox(this, canvas, g, undefined, undefined, undefined, \"stroke\", color);\r\n    }\r\n  }\r\n\r\n  updateDPI() {\r\n    let dpi = UIBase.getDPI();\r\n\r\n    if (dpi !== this._last_dpi) {\r\n      this._last_dpi = dpi;\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateDPI();\r\n\r\n    let ready = ui_base.getIconManager().isReady(0);\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n\r\n    let updatekey = this.getDefault(\"DefaultText\").hash();\r\n    updatekey += this._checked + \":\" + this._label.textContent;\r\n    updatekey += \":\" + ready;\r\n\r\n    if (updatekey !== this._updatekey) {\r\n      this._repos_canvas();\r\n      this.setCSS();\r\n\r\n      this._updatekey = updatekey;\r\n      this._redraw();\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(Check);\r\n\r\nexport class IconButton extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._customIcon = undefined;\r\n\r\n    this._pressed = false;\r\n    this._highlight = false;\r\n    this._draw_pressed = true;\r\n\r\n    this._icon = -1;\r\n    this._icon_pressed = undefined;\r\n    this.iconsheet = 0;\r\n    this.drawButtonBG = true;\r\n\r\n    this._extraIcon = undefined; //draw another icon on top\r\n\r\n    this.extraDom = undefined;\r\n\r\n    //have to put icon in subdiv\r\n    this.dom = document.createElement(\"div\");\r\n    this.shadow.appendChild(this.dom);\r\n\r\n    this._last_iconsheet = undefined;\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Enter\"]:\r\n        case keymap[\"Space\"]:\r\n          this.click();\r\n          break;\r\n      }\r\n    });\r\n  }\r\n\r\n  click() {\r\n    if (this._onpress) {\r\n      let rect = this.getClientRects();\r\n      let x = rect.x + rect.width*0.5;\r\n      let y = rect.y + rect.height*0.5;\r\n\r\n      let e = {x : x, y : y, stopPropagation : () => {}, preventDefault : () => {}};\r\n\r\n      this._onpress(e);\r\n    }\r\n\r\n    super.click();\r\n  }\r\n\r\n  get customIcon() {\r\n    return this._customIcon;\r\n  }\r\n\r\n  set customIcon(domImage) {\r\n    this._customIcon = domImage;\r\n    this.setCSS();\r\n  }\r\n\r\n  get icon() {\r\n    return this._icon;\r\n  }\r\n\r\n  set icon(val) {\r\n    this._icon = val;\r\n    this.setCSS();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"iconbutton-x\",\r\n      style  : \"iconbutton\"\r\n    };\r\n  }\r\n\r\n  _on_press() {\r\n    this._pressed = true;\r\n    this.setCSS();\r\n  }\r\n\r\n  _on_depress() {\r\n    this._pressed = false;\r\n    this.setCSS();\r\n  }\r\n\r\n  updateDefaultSize() {\r\n\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    let def;\r\n    let pstyle = this.getDefault(\"depressed\");\r\n    let hstyle = this.getDefault(\"highlight\");\r\n\r\n    this.noMarginsOrPadding();\r\n\r\n    if (this._pressed && this._draw_pressed) {\r\n      def = k => this.getSubDefault(\"depressed\", k);\r\n    } else if (this._highlight) {\r\n      def = k => this.getSubDefault(\"highlight\", k);\r\n    } else {\r\n      def = k => this.getDefault(k);\r\n    }\r\n\r\n    let loadstyle = (key, addpx) => {\r\n      let val = def(key);\r\n      if (addpx) {\r\n        val = (\"\" + val).trim();\r\n\r\n        if (!val.toLowerCase().endsWith(\"px\")) {\r\n          val += \"px\";\r\n        }\r\n      }\r\n\r\n      this.style[key] = val;\r\n    }\r\n\r\n    let keys = [\"margin\", \"padding\", \"margin-left\", \"margin-right\", \"margin-top\", \"margin-botton\",\r\n                \"padding-left\", \"padding-bottom\", \"padding-top\", \"padding-right\",\r\n                \"border-radius\"]\r\n\r\n    for (let k of keys) {\r\n      loadstyle(k, true);\r\n    }\r\n    loadstyle(\"background-color\", false);\r\n    loadstyle(\"color\", false);\r\n\r\n    let border = `${def(\"border-width\", true)} ${def(\"border-style\", false)} ${def(\"border-color\", false)}`\r\n    this.style[\"border\"] = border;\r\n\r\n    let w = this.getDefault(\"width\");\r\n\r\n    let size = ui_base.iconmanager.getTileSize(this.iconsheet);\r\n    w = size;\r\n\r\n    this.style[\"width\"] = w + \"px\";\r\n    this.style[\"height\"] = w + \"px\";\r\n\r\n    this.dom.style[\"width\"] = w + \"px\";\r\n    this.dom.style[\"height\"] = w + \"px\";\r\n    this.dom.style[\"margin\"] = this.dom.style[\"padding\"] = \"0px\";\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"align-items\"] = \"center\";\r\n\r\n    if (this._customIcon) {\r\n      this.dom.style[\"background-image\"] = `url(\"${this._customIcon.src}\")`\r\n      this.dom.style[\"background-size\"] = \"contain\";\r\n      this.dom.style[\"background-repeat\"] = \"no-repeat\";\r\n    } else {\r\n      let icon = this.icon;\r\n\r\n      if (this._pressed && this._icon_pressed !== undefined) {\r\n        icon = this._icon_pressed;\r\n      }\r\n\r\n      ui_base.iconmanager.setCSS(icon, this.dom, this.iconsheet);\r\n    }\r\n\r\n    if (this._extraIcon !== undefined) {\r\n      let dom;\r\n\r\n      if (!this.extraDom) {\r\n        this.extraDom = dom = document.createElement(\"div\");\r\n\r\n        this.shadow.appendChild(dom);\r\n      } else {\r\n        dom = this.extraDom;\r\n      }\r\n\r\n      dom.style[\"position\"] = \"absolute\";\r\n      dom.style[\"margin\"] = dom.style[\"padding\"] = \"0px\";\r\n      dom.style[\"pointer-events\"] = \"none\";\r\n      dom.style[\"width\"] = size + \"px\";\r\n      dom.style[\"height\"] = size + \"px\";\r\n\r\n      ui_base.iconmanager.setCSS(this._extraIcon, dom, this.iconsheet);\r\n    } else if (this.extraDom) {\r\n      this.extraDom.remove();\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    let press = (e) => {\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n\r\n      if (this.modalRunning) {\r\n        this.popModal();\r\n      }\r\n\r\n      if (!eventWasTouch(e) && e.button !== 0) {\r\n        return;\r\n      }\r\n\r\n      if (1) { //!eventWasTouch(e)) {\r\n        let this2 = this;\r\n\r\n        this.pushModal({\r\n          on_mouseup(e) {\r\n            //touch events aren't fireing onclick automatically the way mouse ones are\r\n\r\n            if (this2.onclick && eventWasTouch(e)) {\r\n              this2.onclick();\r\n            }\r\n            this.end();\r\n          },\r\n          on_touchcancel(e) {\r\n            this.on_mouseup(e);\r\n            this.end();\r\n          },\r\n          on_touchend(e) {\r\n            this.on_mouseup(e);\r\n            this.end();\r\n          },\r\n          on_keydown(e) {\r\n            this.end();\r\n          },\r\n          end() {\r\n            if (this2.modalRunning) {\r\n              this2.popModal();\r\n              this2._on_depress(e)\r\n              this2.setCSS();\r\n            }\r\n          }\r\n        });\r\n      }\r\n\r\n      this._on_press(e);\r\n    }\r\n\r\n    let depress = (e) => {\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n\r\n      this._on_depress();\r\n      this.setCSS();\r\n    }\r\n\r\n    let high = (e) => {\r\n      this._highlight = true;\r\n      this.setCSS();\r\n    }\r\n\r\n    let unhigh = (e) => {\r\n      this._highlight = false;\r\n      this.setCSS();\r\n    }\r\n\r\n    this.tabIndex = 0;\r\n\r\n    this.addEventListener(\"mouseover\", high);\r\n    this.addEventListener(\"mouseexit\", unhigh);\r\n    this.addEventListener(\"mouseleave\", unhigh);\r\n    this.addEventListener(\"focus\", high);\r\n    this.addEventListener(\"blur\", unhigh);\r\n\r\n    this.addEventListener(\"mousedown\", press, {capture: true});\r\n    this.addEventListener(\"mouseup\", depress, {capture: true});\r\n    //this.addEventListener(\"touchstart\", press, {capture: true});\r\n    //this.addEventListener(\"touchcancel\", depress, {capture: true});\r\n    //this.addEventListener(\"touchend\", depress, {capture: true});\r\n    this.setCSS();\r\n\r\n    this.dom.style[\"pointer-events\"] = \"none\";\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    if (this.iconsheet !== this._last_iconsheet) {\r\n      this.setCSS();\r\n      this._last_iconsheet = this.iconsheet;\r\n    }\r\n  }\r\n\r\n  _getsize() {\r\n    let margin = this.getDefault(\"padding\");\r\n\r\n    return ui_base.iconmanager.getTileSize(this.iconsheet) + margin*2;\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(IconButton);\r\n\r\n\r\nexport class IconCheck extends IconButton {\r\n  constructor() {\r\n    super();\r\n\r\n    this._checked = undefined;\r\n    this._drawCheck = undefined;\r\n  }\r\n\r\n  get drawCheck() {\r\n    let ret = this._drawCheck;\r\n\r\n    ret = ret === undefined ? this.getDefault(\"drawCheck\") : ret;\r\n    ret = ret === undefined ? true : ret;\r\n\r\n    return ret;\r\n  }\r\n\r\n  set drawCheck(val) {\r\n    val = !!val;\r\n\r\n    if (val && (this.packflag & PackFlags.HIDE_CHECK_MARKS)) {\r\n      this.packflag &= ~PackFlags.HIDE_CHECK_MARKS;\r\n    }\r\n\r\n    let old = !!this.drawCheck;\r\n    this._drawCheck = val;\r\n\r\n    if (val !== old) {\r\n      this.updateDrawCheck();\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  click() {\r\n    super.click();\r\n    this.checked ^= true;\r\n  }\r\n\r\n  get icon() {\r\n    return this._icon;\r\n  }\r\n\r\n  set icon(val) {\r\n    this._icon = val;\r\n    this.setCSS();\r\n  }\r\n\r\n  get checked() {\r\n    return this._checked;\r\n  }\r\n\r\n  set checked(val) {\r\n    if (!!val !== !!this._checked) {\r\n      this._checked = val\r\n      this._updatePressed(!!val);\r\n      this.setCSS();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(val);\r\n      }\r\n    }\r\n  }\r\n\r\n  get noEmboss() {\r\n    let ret = this.getAttribute(\"no-emboss\");\r\n\r\n    if (!ret) {\r\n      return false;\r\n    }\r\n\r\n    ret = ret.toLowerCase().trim();\r\n\r\n    return ret === 'true' || ret === 'yes' || ret === 'on';\r\n  }\r\n\r\n  set noEmboss(val) {\r\n    this.setAttribute('no-emboss', val ? 'true' : 'false');\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname    : \"iconcheck-x\",\r\n      style      : \"iconcheck\",\r\n      parentStyle: \"iconbutton\"\r\n    };\r\n  }\r\n\r\n  _updatePressed(val) {\r\n    //don't set _pressed if we have a custom icon for press state\r\n    if (this._icon_pressed) {\r\n      this._draw_pressed = false;\r\n    }\r\n\r\n    this._pressed = val;\r\n    this.setCSS();\r\n  }\r\n\r\n  _on_depress() {\r\n    return;\r\n  }\r\n\r\n  _on_press() {\r\n    this.checked ^= true;\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), !!this.checked);\r\n    }\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  updateDefaultSize() {\r\n\r\n  }\r\n\r\n  _calcUpdateKey() {\r\n    return super._calcUpdateKey() + \":\" + this._icon;\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\") || !this.ctx) {\r\n      return;\r\n    }\r\n\r\n    if (this._icon < 0) {\r\n      let rdef;\r\n      try {\r\n        rdef = this.ctx.api.resolvePath(this.ctx, this.getAttribute(\"datapath\"));\r\n      } catch (error) {\r\n        if (error instanceof DataPathError) {\r\n          return;\r\n        } else {\r\n          throw error;\r\n        }\r\n      }\r\n\r\n      if (rdef !== undefined && rdef.prop) {\r\n        let icon, icon2, title;\r\n\r\n        if (rdef.prop.flag & PropFlags.NO_UNDO) {\r\n          this.setUndo(false);\r\n        } else {\r\n          this.setUndo(true);\r\n        }\r\n\r\n        //console.log(\"SUBKEY\", rdef.subkey, rdef.prop.iconmap);\r\n\r\n        if (rdef.subkey && (rdef.prop.type === PropTypes.FLAG || rdef.prop.type === PropTypes.ENUM)) {\r\n          icon = rdef.prop.iconmap[rdef.subkey];\r\n          icon2 = rdef.prop.iconmap2[rdef.subkey];\r\n          title = rdef.prop.descriptions[rdef.subkey];\r\n\r\n          if (title === undefined && rdef.subkey.length > 0) {\r\n            title = rdef.subkey;\r\n            title = title[0].toUpperCase() + title.slice(1, title.length).toLowerCase();\r\n          }\r\n        } else {\r\n          icon2 = rdef.prop.icon2;\r\n          icon = rdef.prop.icon;\r\n          title = rdef.prop.description;\r\n        }\r\n\r\n        if (icon2 !== undefined && icon2 !== -1) {\r\n          this._icon_pressed = icon;\r\n          icon = icon2;\r\n        }\r\n\r\n        if (icon !== undefined && icon !== this.icon)\r\n          this.icon = icon;\r\n        if (title !== undefined)\r\n          this.description = title;\r\n      }\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (val === undefined) {\r\n      this.internalDisabled = true;\r\n      return;\r\n    } else {\r\n      this.internalDisabled = false;\r\n    }\r\n\r\n    val = !!val;\r\n\r\n    if (val !== !!this._checked) {\r\n      this._checked = val;\r\n      this._updatePressed(!!val);\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  updateDrawCheck() {\r\n    if (this.drawCheck) {\r\n      this._extraIcon = this._checked ? ui_base.Icons.ENUM_CHECKED : ui_base.Icons.ENUM_UNCHECKED;\r\n    } else {\r\n      this._extraIcon = undefined;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    if (this.packflag & PackFlags.HIDE_CHECK_MARKS) {\r\n      this.drawCheck = false;\r\n    }\r\n\r\n    this.updateDrawCheck();\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n\r\n    super.update();\r\n  }\r\n\r\n  _getsize() {\r\n    let margin = this.getDefault(\"padding\");\r\n    return ui_base.iconmanager.getTileSize(this.iconsheet) + margin*2;\r\n  }\r\n\r\n  setCSS() {\r\n    this.updateDrawCheck();\r\n    super.setCSS();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(IconCheck);\r\n\r\nexport class Check1 extends Button {\r\n  constructor() {\r\n    super();\r\n\r\n    this._namePad = 40;\r\n    this._value = undefined;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname    : \"check1-x\",\r\n      parentStyle: \"button\"\r\n    };\r\n  }\r\n\r\n  _redraw() {\r\n    //console.log(\"button draw\");\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let box = 40;\r\n    ui_base.drawRoundBox(this, this.dom, this.g, box);\r\n\r\n    let ts = this.getDefault(\"DefaultText\").size;\r\n\r\n    let text = this._genLabel();\r\n\r\n    //console.log(text, \"text\", this._name);\r\n\r\n    let tw = ui_base.measureText(this, text, this.dom, this.g).width;\r\n    let cx = this.dom.width/2 - tw/2;\r\n    let cy = this.dom.height/2;\r\n\r\n    ui_base.drawText(this, box, cy + ts/2, text, {\r\n      canvas: this.dom, g: this.g\r\n    });\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(Check1);\r\n\r\nexport {checkForTextBox} from './ui_textbox.js';\r\n","export function saveFile(data, filename=\"unnamed\", exts=[], mime=\"application/x-octet-stream\") {\r\n  let blob = new Blob([data], {type : mime});\r\n  let url = URL.createObjectURL(blob);\r\n\r\n  let a = document.createElement(\"a\");\r\n  a.setAttribute(\"href\", url);\r\n  a.setAttribute(\"download\", filename);\r\n\r\n  a.click();\r\n}\r\n\r\n//returns a promise\r\nexport function loadFile(filename=\"unnamed\", exts=[]) {\r\n  let input = document.createElement(\"input\");\r\n  input.type = \"file\";\r\n\r\n  exts = exts.join(\",\");\r\n\r\n  input.setAttribute(\"accept\", exts)\r\n  return new Promise((accept, reject) => {\r\n    input.onchange = function(e) {\r\n      if (this.files === undefined || this.files.length !== 1) {\r\n        reject(\"file load error\");\r\n        return;\r\n      }\r\n\r\n      let file = this.files[0];\r\n      let reader = new FileReader();\r\n\r\n      reader.onload = function(e2) {\r\n        accept(e2.target.result);\r\n      };\r\n\r\n      reader.readAsArrayBuffer(file);\r\n    }\r\n    input.click();\r\n  });\r\n}\r\n\r\nwindow._testLoadFile = function(exts=[\"*.*\"]) {\r\n  loadFile(undefined, exts).then((data) => {\r\n    console.log(\"got file data:\", data);\r\n  });\r\n};\r\n\r\nwindow._testSaveFile = function() {\r\n  let buf = _appstate.createFile();\r\n  //console.log(buf);\r\n  saveFile(buf, \"unnamed.w3d\", [\".w3d\"]);\r\n}","\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport cconst from '../config/const.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport {OldButton} from \"./ui_button.js\";\r\nimport {DomEventTypes} from '../path-controller/util/events.js';\r\n\r\nimport {HotKey, keymap} from '../path-controller/util/simple_events.js';\r\nimport { parseToolPath } from '../pathux.js';\r\n\r\nlet EnumProperty = toolprop.EnumProperty,\r\n    PropTypes    = toolprop.PropTypes;\r\n\r\nlet UIBase     = ui_base.UIBase,\r\n    PackFlags  = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nfunction getpx(css) {\r\n  return parseFloat(css.trim().replace(\"px\", \"\"))\r\n}\r\n\r\nfunction debugmenu() {\r\n  if (window.DEBUG && window.DEBUG.menu) {\r\n    console.warn(\"%cmenu:\", \"color:blue\", ...arguments);\r\n  }\r\n}\r\n\r\n\r\nexport class Menu extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.parentMenu = undefined;\r\n\r\n    this._was_clicked = false;\r\n\r\n    this.items = [];\r\n    this.autoSearchMode = true;\r\n\r\n    this._ignoreFocusEvents = false;\r\n    this.closeOnMouseUp = true;\r\n\r\n    this._submenu = undefined;\r\n\r\n    this.ignoreFirstClick = false;\r\n\r\n    this.itemindex = 0;\r\n    this.closed = false;\r\n    this.started = false;\r\n    this.activeItem = undefined;\r\n\r\n    this.overrideDefault(\"DefaultText\", this.getDefault(\"MenuText\"));\r\n\r\n    //we have to make a container for any submenus to\r\n    this.container = document.createElement(\"span\");\r\n    this.container.style[\"display\"] = \"flex\";\r\n    this.container.style[\"color\"] = this.getDefault(\"MenuText\").color;\r\n\r\n    //this.container.style[\"background-color\"] = \"red\";\r\n    this.container.setAttribute(\"class\", \"menucon\");\r\n\r\n    this.dom = document.createElement(\"ul\");\r\n    this.dom.setAttribute(\"class\", \"menu\");\r\n    /*\r\n              place-items: start start;\r\n              flex-wrap : nowrap;\r\n              align-content : start;\r\n              place-content : start;\r\n              justify-content : start;\r\n\r\n              align-items : start;\r\n              place-items : start;\r\n              justify-items : start;\r\n    */\r\n\r\n    let style = this.menustyle = document.createElement(\"style\");\r\n    this.buildStyle();\r\n\r\n    this.dom.setAttribute(\"tabindex\", -1);\r\n\r\n    //the menu wrangler handles key events\r\n\r\n    this.shadow.appendChild(style);\r\n    this.shadow.appendChild(this.container);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"menu-x\",\r\n      style  : \"menu\"\r\n    };\r\n  }\r\n\r\n  float(x, y, zindex = undefined) {\r\n    let dpi = this.getDPI();\r\n    let rect = this.dom.getClientRects();\r\n    let maxx = this.getWinWidth() - 10;\r\n    let maxy = this.getWinHeight() - 10;\r\n\r\n    if (rect.length > 0) {\r\n      rect = rect[0];\r\n      if (y + rect.height > maxy) {\r\n        y = maxy - rect.height - 1;\r\n      }\r\n\r\n      if (x + rect.width > maxx) {\r\n        x = maxx - rect.width - 1;\r\n      }\r\n    }\r\n\r\n    super.float(x, y, 50);\r\n  }\r\n\r\n  click() {\r\n    if (this._was_clicked) {\r\n      return;\r\n    }\r\n\r\n    if (this.ignoreFirstClick) {\r\n      this.ignoreFirstClick = Math.max(this.ignoreFirstClick - 1, 0);\r\n      return;\r\n    }\r\n\r\n    if (!this.activeItem || this.activeItem._isMenu) {\r\n      return;\r\n    }\r\n\r\n    this._was_clicked = true;\r\n\r\n    if (this.onselect) {\r\n      try {\r\n        this.onselect(this.activeItem._id);\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        console.log(\"Error in menu callback\");\r\n      }\r\n    }\r\n\r\n    this.close();\r\n  }\r\n\r\n  _ondestroy() {\r\n    if (this.started) {\r\n      menuWrangler.popMenu(this);\r\n\r\n      if (this.onclose) {\r\n        this.onclose();\r\n      }\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this.setCSS();\r\n  }\r\n\r\n  close() {\r\n    if (this.closed) {\r\n      return;\r\n    }\r\n\r\n    this.closed = true;\r\n\r\n    if (this.started) {\r\n      menuWrangler.popMenu(this);\r\n    }\r\n\r\n    this.started = false;\r\n\r\n    if (this._popup) {\r\n      this._popup.end();\r\n      this._popup = undefined;\r\n    }\r\n\r\n    this.remove();\r\n    this.dom.remove();\r\n\r\n    if (this.onclose) {\r\n      this.onclose(this);\r\n    }\r\n  }\r\n\r\n  _select(dir, focus = true) {\r\n    if (this.activeItem === undefined) {\r\n      for (let item of this.items) {\r\n        if (!item.hidden) {\r\n          this.setActive(item, focus);\r\n          break;\r\n        }\r\n      }\r\n    } else {\r\n      let i = this.items.indexOf(this.activeItem);\r\n      let item = this.activeItem;\r\n\r\n      do {\r\n        i = (i + dir + this.items.length)%this.items.length;\r\n        item = this.items[i];\r\n\r\n        if (!item.hidden) {\r\n          break;\r\n        }\r\n      } while (item !== this.activeItem);\r\n\r\n      this.setActive(item, focus);\r\n    }\r\n\r\n    if (this.hasSearchBox) {\r\n      this.activeItem.scrollIntoView();\r\n    }\r\n  }\r\n\r\n  selectPrev(focus = true) {\r\n    return this._select(-1, focus);\r\n  }\r\n\r\n  selectNext(focus = true) {\r\n    return this._select(1, focus);\r\n  }\r\n\r\n  start_fancy(prepend, setActive = true) {\r\n    return this.startFancy(prepend, setActive);\r\n  }\r\n\r\n  setActive(item, focus = true) {\r\n    if (this.activeItem === item) {\r\n      return;\r\n    }\r\n\r\n    if (this.activeItem) {\r\n      this.activeItem.style[\"background-color\"] = this.getDefault(\"MenuBG\");\r\n\r\n      if (focus) {\r\n        this.activeItem.blur();\r\n      }\r\n    }\r\n\r\n    if (item) {\r\n      item.style[\"background-color\"] = this.getDefault(\"MenuHighlight\");\r\n\r\n      if (focus) {\r\n        item.focus();\r\n      }\r\n    }\r\n\r\n    this.activeItem = item;\r\n  }\r\n\r\n  startFancy(prepend, setActive = true) {\r\n    this.hasSearchBox = true;\r\n    this.started = true;\r\n    menuWrangler.pushMenu(this);\r\n\r\n    let dom2 = document.createElement(\"div\");\r\n    //let dom2 = document.createElement(\"div\");\r\n\r\n    this.dom.setAttribute(\"class\", \"menu\");\r\n    dom2.setAttribute(\"class\", \"menu\");\r\n\r\n    let sbox = this.textbox = UIBase.createElement(\"textbox-x\");\r\n    this.textbox.parentWidget = this;\r\n\r\n    dom2.appendChild(sbox);\r\n    dom2.appendChild(this.dom);\r\n\r\n    dom2.style[\"height\"] = \"300px\";\r\n    this.dom.style[\"height\"] = \"300px\";\r\n    this.dom.style[\"overflow\"] = \"scroll\";\r\n\r\n    if (prepend) {\r\n      this.container.prepend(dom2);\r\n    } else {\r\n      this.container.appendChild(dom2);\r\n    }\r\n\r\n    dom2.parentWidget = this.container;\r\n\r\n    sbox.focus();\r\n    sbox.onchange = () => {\r\n      let t = sbox.text.trim().toLowerCase();\r\n\r\n      for (let item of this.items) {\r\n        item.hidden = true;\r\n        item.remove();\r\n      }\r\n\r\n      for (let item of this.items) {\r\n        let ok = t == \"\";\r\n        ok = ok || item.innerHTML.toLowerCase().search(t) >= 0;\r\n\r\n        if (ok) {\r\n          item.hidden = false;\r\n          this.dom.appendChild(item);\r\n        } else if (item === this.activeItem) {\r\n          this.selectNext(false);\r\n        }\r\n        //item.hidden = !ok;\r\n      }\r\n    }\r\n\r\n    sbox.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case 27: //escape key\r\n          this.close();\r\n          break;\r\n        case 13: //enter key\r\n          this.click(this.activeItem);\r\n          this.close();\r\n          break;\r\n      }\r\n    });\r\n  }\r\n\r\n  start(prepend = false, setActive = true) {\r\n    this.closed = false;\r\n\r\n    this.started = true;\r\n    this.focus();\r\n\r\n    menuWrangler.pushMenu(this);\r\n\r\n    let dokey = (key) => {\r\n      let val = this.getDefault(key);\r\n      if (typeof val === \"number\") {\r\n        val = \"\" + val + \"px\";\r\n      }\r\n\r\n      if (val !== undefined) {\r\n        this.dom.style[key] = val;\r\n      }\r\n    }\r\n\r\n    dokey(\"padding\");\r\n    dokey(\"padding-top\");\r\n    dokey(\"padding-left\");\r\n    dokey(\"padding-right\");\r\n    dokey(\"padding-bottom\");\r\n\r\n    if (this.items.length > 15 && this.autoSearchMode) {\r\n      return this.start_fancy(prepend, setActive);\r\n    }\r\n\r\n    if (prepend) {\r\n      this.container.prepend(this.dom);\r\n    } else {\r\n      this.container.appendChild(this.dom);\r\n    }\r\n\r\n    if (!setActive)\r\n      return;\r\n\r\n    this.setCSS();\r\n    this.flushUpdate();\r\n\r\n    window.setTimeout(() => {\r\n      this.flushUpdate();\r\n\r\n      //select first child\r\n      //TODO: cache last child entry\r\n\r\n      if (this.activeItem === undefined) {\r\n        this.activeItem = this.dom.childNodes[0];\r\n      }\r\n\r\n      if (this.activeItem === undefined) {\r\n        return;\r\n      }\r\n\r\n      this.activeItem.focus();\r\n    }, 0);\r\n  }\r\n\r\n  addItemExtra(text, id = undefined, hotkey, icon = -1, add = true, tooltip = undefined) {\r\n    let dom = document.createElement(\"span\");\r\n\r\n    dom.style[\"display\"] = \"inline-flex\";\r\n\r\n    dom.hotkey = hotkey;\r\n    dom.icon = icon;\r\n\r\n    let icon_div;\r\n\r\n    if (1) { //icon >= 0) {\r\n      icon_div = ui_base.makeIconDiv(icon, IconSheets.SMALL);\r\n    } else {\r\n      let tilesize = ui_base.iconmanager.getTileSize(IconSheets.SMALL);\r\n\r\n      //tilesize *= window.devicePixelRatio;\r\n\r\n      icon_div = document.createElement(\"span\");\r\n      icon_div.style[\"padding\"] = icon_div.style[\"margin\"] = \"0px\";\r\n      icon_div.style[\"width\"] = tilesize + \"px\";\r\n      icon_div.style[\"height\"] = tilesize + \"px\";\r\n    }\r\n\r\n    icon_div.style[\"display\"] = \"inline-flex\";\r\n    icon_div.style[\"margin-right\"] = \"1px\";\r\n    icon_div.style[\"align\"] = \"left\";\r\n\r\n    let span = document.createElement(\"span\");\r\n\r\n    //stupid css doesn't get width right. . .\r\n    span.style[\"font\"] = ui_base.getFont(this, undefined, \"MenuText\");\r\n\r\n    let dpi = this.getDPI();\r\n    let tsize = this.getDefault(\"MenuText\").size;\r\n    //XXX proportional font fail\r\n\r\n    //XXX stupid!\r\n    let canvas = document.createElement(\"canvas\");\r\n    let g = canvas.getContext(\"2d\");\r\n\r\n    g.font = span.style[\"font\"];\r\n\r\n    let rect = span.getClientRects();\r\n\r\n    let twid = Math.ceil(g.measureText(text).width);\r\n    let hwid;\r\n    if (hotkey) {\r\n      dom.hotkey = hotkey;\r\n      g.font = ui_base.getFont(this, undefined, \"HotkeyText\");\r\n      hwid = Math.ceil(g.measureText(hotkey).width/UIBase.getDPI());\r\n      twid += hwid + 8;\r\n    }\r\n\r\n    //let twid = Math.ceil(text.trim().length * tsize / dpi);\r\n\r\n    span.innerText = text;\r\n\r\n    span.style[\"word-wrap\"] = \"none\";\r\n    span.style[\"white-space\"] = \"pre\";\r\n    span.style[\"overflow\"] = \"hidden\";\r\n    span.style[\"text-overflow\"] = \"clip\";\r\n\r\n    span.style[\"width\"] = ~~(twid) + \"px\";\r\n    span.style[\"padding\"] = \"0px\";\r\n    span.style[\"margin\"] = \"0px\";\r\n\r\n    dom.style[\"width\"] = \"100%\";\r\n\r\n    dom.appendChild(icon_div);\r\n    dom.appendChild(span);\r\n\r\n    if (hotkey) {\r\n      let hotkey_span = document.createElement(\"span\");\r\n      hotkey_span.innerText = hotkey;\r\n      hotkey_span.style[\"display\"] = \"inline-flex\";\r\n\r\n      hotkey_span.style[\"margin\"] = \"0px\";\r\n      hotkey_span.style[\"margin-left\"] = \"auto\";\r\n      hotkey_span.style[\"margin-right\"] = \"0px\";\r\n      hotkey_span.style[\"padding\"] = \"0px\";\r\n\r\n      hotkey_span.style[\"font\"] = ui_base.getFont(this, undefined, \"HotkeyText\");\r\n      hotkey_span.style[\"color\"] = this.getDefault(\"HotkeyTextColor\");\r\n\r\n      //hotkey_span.style[\"width\"] = ~~((hwid + 7)) + \"px\";\r\n      hotkey_span.style[\"width\"] = \"max-content\";\r\n\r\n      //hotkey_span.style[\"background-color\"] = \"rgba(0,0,0,0)\";\r\n\r\n      hotkey_span.style[\"text-align\"] = \"right\";\r\n      hotkey_span.style[\"justify-content\"] = \"right\";\r\n      hotkey_span[\"flex-wrap\"] = \"nowrap\";\r\n      hotkey_span[\"text-wrap\"] = \"nowrap\";\r\n\r\n      //hotkey_span.style[\"border\"] = \"1px solid red\";\r\n\r\n      //hotkey_span.style[\"display\"] = \"inline\";\r\n      //hotkey_span.style[\"float\"] = \"right\";\r\n\r\n      dom.appendChild(hotkey_span);\r\n    }\r\n\r\n    let ret = this.addItem(dom, id, add);\r\n\r\n    ret.hotkey = hotkey;\r\n    ret.icon = icon;\r\n    ret.label = text ? text : ret.innerText;\r\n\r\n    if (tooltip) {\r\n      ret.title = tooltip;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  //item can be menu or text\r\n  addItem(item, id, add = true, tooltip = undefined) {\r\n    id = id === undefined ? item : id;\r\n    let text = item;\r\n\r\n    if (typeof item === \"string\" || item instanceof String) {\r\n      let dom = document.createElement(\"dom\");\r\n      dom.style[\"text-align\"] = \"left\";\r\n\r\n      dom.textContent = item;\r\n      item = dom;\r\n      //return this.addItemExtra(item, id);\r\n    } else {\r\n      text = item.textContent;\r\n    }\r\n\r\n    let li = document.createElement(\"li\");\r\n\r\n    li.setAttribute(\"tabindex\", this.itemindex++);\r\n    li.setAttribute(\"class\", \"menuitem\");\r\n\r\n    if (tooltip !== undefined) {\r\n      li.title = tooltip;\r\n    }\r\n\r\n    if (item instanceof Menu) {\r\n      //let dom = this.addItemExtra(\"\"+item.title, id, \"\", -1, false);\r\n      let dom = document.createElement(\"span\");\r\n      dom.innerHTML = \"\" + item.title;\r\n      dom._id = dom.id = id;\r\n      dom.setAttribute(\"class\", \"menu\")\r\n\r\n      //dom = document.createElement(\"div\");\r\n      //dom.innerText = \"\"+item.title;\r\n\r\n      //dom.style[\"display\"] = \"inline-block\";\r\n      li.style[\"width\"] = \"100%\"\r\n      li.appendChild(dom);\r\n\r\n      li._isMenu = true;\r\n      li._menu = item;\r\n      item.parentMenu = this;\r\n\r\n      item.hidden = false;\r\n      item.container = this.container;\r\n    } else {\r\n      li._isMenu = false;\r\n      li.appendChild(item);\r\n    }\r\n\r\n    li._id = id;\r\n\r\n    this.items.push(li);\r\n\r\n    li.label = text ? text : li.innerText.trim();\r\n\r\n    if (add) {\r\n      li.addEventListener(\"blur\", (e) => {\r\n        if (this._ignoreFocusEvents) {\r\n          return;\r\n        }\r\n\r\n        if (this.activeItem && !this.activeItem._isMenu) {\r\n          this.setActive(undefined, false);\r\n        }\r\n      });\r\n\r\n      let onfocus = (e) => {\r\n        if (this._ignoreFocusEvents) {\r\n          return;\r\n        }\r\n\r\n        let active = this.activeItem;\r\n\r\n        if (this._submenu) {\r\n          this._submenu.close();\r\n          this._submenu = undefined;\r\n        }\r\n\r\n        if (li._isMenu) {\r\n          li._menu.onselect = (item) => {\r\n            this.onselect(item);\r\n            li._menu.close();\r\n            this.close();\r\n          };\r\n\r\n          li._menu.start(false, false);\r\n          this._submenu = li._menu;\r\n        }\r\n\r\n        this.setActive(li, false);\r\n      };\r\n\r\n      let onclick = (e) => {\r\n        onfocus(e);\r\n\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n\r\n        if (this.activeItem !== undefined && this.activeItem._isMenu) {\r\n          //ignore\r\n          return;\r\n        }\r\n\r\n        this.click();\r\n      }\r\n\r\n      li.addEventListener(\"contextmenu\", e => e.preventDefault());\r\n      this.addEventListener(\"contextmenu\", e => e.preventDefault());\r\n\r\n      li.addEventListener(\"pointerup\", onclick, {capture: true});\r\n      li.addEventListener(\"click\", onclick, {capture: true});\r\n      li.addEventListener(\"pointerdown\", onclick, {capture: true});\r\n\r\n      li.addEventListener(\"focus\", (e) => {\r\n        onfocus(e);\r\n        onfocus(e);\r\n      })\r\n\r\n      li.addEventListener(\"pointermove\", (e) => {\r\n        onfocus(e);\r\n        li.focus();\r\n      });\r\n      li.addEventListener(\"mouseover\", (e) => {\r\n        onfocus(e);\r\n        li.focus();\r\n      });\r\n      li.addEventListener(\"mouseenter\", (e) => {\r\n        onfocus(e);\r\n        li.focus();\r\n      });\r\n\r\n      li.addEventListener(\"pointerover\", (e) => {\r\n        onfocus(e);\r\n        li.focus();\r\n      });\r\n\r\n      this.dom.appendChild(li);\r\n    }\r\n\r\n    return li;\r\n  }\r\n\r\n  _getBorderStyle() {\r\n    let r = this.getDefault(\"border-width\");\r\n    let s = this.getDefault(\"border-style\");\r\n    let c = this.getDefault(\"border-color\");\r\n\r\n    return `${r}px ${s} ${c}`;\r\n  }\r\n\r\n  buildStyle() {\r\n    let pad1 = util.isMobile() ? 2 : 0;\r\n    pad1 += this.getDefault(\"MenuSpacing\");\r\n\r\n    let boxShadow = \"\";\r\n    if (this.hasDefault(\"box-shadow\")) {\r\n      boxShadow = \"box-shadow: \" + this.getDefault(\"box-shadow\") + ';';\r\n    }\r\n\r\n    let sepcss = this.getDefault(\"MenuSeparator\");\r\n    if (typeof sepcss === \"object\") {\r\n      let s = '';\r\n\r\n      for (let k in sepcss) {\r\n        let v = sepcss[k];\r\n\r\n        if (typeof v === \"number\") {\r\n          v = v.toFixed(4) + \"px\";\r\n        }\r\n\r\n        s += `    ${k}: ${v};\\n`;\r\n      }\r\n\r\n      sepcss = s;\r\n    }\r\n\r\n    let itemRadius = 0;\r\n\r\n    if (this.hasDefault(\"item-radius\")) {\r\n      itemRadius = this.getDefault(\"item-radius\");\r\n    } else {\r\n      itemRadius = this.getDefault(\"border-radius\");\r\n    }\r\n\r\n    this.menustyle.textContent = `\r\n        .menucon {\r\n          position:fixed;\r\n          float:left;\r\n          \r\n          border-radius : ${this.getDefault(\"border-radius\")}px;\r\n\r\n          display: block;\r\n          -moz-user-focus: normal;\r\n          ${boxShadow}\r\n        }\r\n        \r\n        ul.menu {\r\n          display        : flex;\r\n          flex-direction : column;\r\n          flex-wrap      : nowrap;\r\n          width          : max-content;\r\n          \r\n          margin : 0px;\r\n          padding : 0px;\r\n          border : ${this._getBorderStyle()};\r\n          border-radius : ${this.getDefault(\"border-radius\")}px;\r\n          -moz-user-focus: normal;\r\n          background-color: ${this.getDefault(\"MenuBG\")};\r\n          color : ${this.getDefault(\"MenuText\").color};\r\n        }\r\n        \r\n        .menuitem {\r\n          display : flex;\r\n          flex-wrap : nowrap;\r\n          flex-direction : row;          \r\n          \r\n          list-style-type:none;\r\n          -moz-user-focus: normal;\r\n          \r\n          margin : 0;\r\n          padding : 0px;\r\n          padding-right: 16px;\r\n          padding-left: 16px;\r\n          padding-top : ${pad1}px;\r\n          padding-bottom : ${pad1}px;\r\n          \r\n          border-radius : ${itemRadius}px;\r\n          \r\n          color : ${this.getDefault(\"MenuText\").color};\r\n          font : ${this.getDefault(\"MenuText\").genCSS()};\r\n          background-color: ${this.getDefault(\"MenuBG\")};\r\n        }\r\n        \r\n        .menuseparator {\r\n          ${sepcss}\r\n        }\r\n        \r\n        .menuitem:focus {\r\n          display : flex;\r\n          text-align: left;\r\n          \r\n          border : none;\r\n          outline : none;\r\n          border-radius : ${itemRadius}px;\r\n          \r\n          background-color: ${this.getDefault(\"MenuHighlight\")};\r\n          color : ${this.getDefault(\"MenuText\").color};\r\n          -moz-user-focus: normal;\r\n        }\r\n      `;\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.buildStyle();\r\n\r\n    this.container.style[\"color\"] = this.getDefault(\"MenuText\").color;\r\n    this.style[\"color\"] = this.getDefault(\"MenuText\").color;\r\n  }\r\n\r\n  seperator() {\r\n    let bar = document.createElement(\"div\");\r\n    bar.setAttribute(\"class\", \"menuseparator\");\r\n\r\n    this.dom.appendChild(bar);\r\n\r\n    return this;\r\n  }\r\n\r\n  menu(title) {\r\n    let ret = UIBase.createElement(\"menu-x\");\r\n\r\n    ret.setAttribute(\"name\", title);\r\n    this.addItem(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  calcSize() {\r\n\r\n  }\r\n}\r\n\r\nMenu.SEP = Symbol(\"menu seperator\");\r\nUIBase.internalRegister(Menu);\r\n\r\nexport class DropBox extends OldButton {\r\n  constructor() {\r\n    super();\r\n\r\n    this.lockTimer = 0;\r\n\r\n    this._template = undefined;\r\n\r\n    this._searchMenuMode = false;\r\n    this.altKey = undefined;\r\n\r\n    this._value = 0;\r\n\r\n    this._last_datapath = undefined;\r\n\r\n    this.r = 5;\r\n    this._menu = undefined;\r\n    this._auto_depress = false;\r\n    //this.prop = new ui_base.EnumProperty(undefined, {}, \"\", \"\", 0);\r\n\r\n    this._onpress = this._onpress.bind(this);\r\n  }\r\n\r\n  get searchMenuMode() {\r\n    return this._searchMenuMode;\r\n  }\r\n\r\n  set searchMenuMode(v) {\r\n    this._searchMenuMode = v;\r\n  }\r\n\r\n  get template() {\r\n    return this._template;\r\n  }\r\n\r\n  set template(v) {\r\n    this._template = v;\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(v) {\r\n    this.setValue(v);\r\n  }\r\n\r\n  get menu() {\r\n    return this._menu;\r\n  }\r\n\r\n  set menu(val) {\r\n    this._menu = val;\r\n\r\n    if (val !== undefined) {\r\n      this._name = val.title;\r\n      this.updateName();\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"dropbox-x\",\r\n      style  : \"dropbox\"\r\n    };\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.setAttribute(\"menu-button\", \"true\");\r\n\r\n    this.updateWidth();\r\n  }\r\n\r\n  setCSS() {\r\n    //do not call parent classes's setCSS here\r\n\r\n    this.style[\"user-select\"] = \"none\";\r\n    this.dom.style[\"user-select\"] = \"none\";\r\n\r\n    let keys;\r\n    if (this.getAttribute(\"simple\")) {\r\n      keys = [\"margin-left\", \"margin-right\", \"padding-left\", \"padding-right\"];\r\n    } else {\r\n      keys = [\r\n        \"margin\", \"margin-left\", \"margin-right\",\r\n        \"margin-top\", \"margin-bottom\", \"padding\",\r\n        \"padding-left\", \"padding-right\", \"padding-top\",\r\n        \"padding-bottom\"];\r\n    }\r\n\r\n    let setDefault = (key) => {\r\n      if (this.hasDefault(key)) {\r\n        this.dom.style[key] = this.getDefault(key, undefined, 0) + \"px\";\r\n      }\r\n    }\r\n\r\n    for (let k of keys) {\r\n      setDefault(k);\r\n    }\r\n  }\r\n\r\n  _genLabel() {\r\n    let s = super._genLabel();\r\n    let ret = \"\";\r\n\r\n    if (s.length === 0) {\r\n      s = \"(error)\";\r\n    }\r\n\r\n    this.altKey = s[0].toUpperCase().charCodeAt(0);\r\n\r\n    for (let i = 0; i < s.length; i++) {\r\n      if (s[i] === \"&\" && i < s.length - 1 && s[i + 1] !== \"&\") {\r\n        this.altKey = s[i + 1].toUpperCase().charCodeAt(0);\r\n      } else if (s[i] === \"&\" && i < s.length - 1 && s[i + 1] === \"&\") {\r\n        continue;\r\n      } else {\r\n        ret += s[i];\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  updateWidth() {\r\n    //let ret = super.updateWidth(10);\r\n    let dpi = this.getDPI();\r\n\r\n    let ts = this.getDefault(\"DefaultText\").size;\r\n    let tw = this.g.measureText(this._genLabel()).width/dpi;\r\n    //let tw = ui_base.measureText(this, this._genLabel(), undefined, undefined, ts).width + 8;\r\n    tw = ~~tw;\r\n\r\n    tw += 15;\r\n\r\n    if (!this.getAttribute(\"simple\")) {\r\n      tw += 35;\r\n    }\r\n\r\n    if (tw !== this._last_w) {\r\n      this._last_w = tw;\r\n      this.dom.style[\"width\"] = tw + \"px\";\r\n      this.style[\"width\"] = tw + \"px\";\r\n      this.width = tw;\r\n\r\n      this.overrideDefault(\"width\", tw);\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n\r\n    return 0;\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.ctx || !this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let wasError = false;\r\n    let prop, val;\r\n\r\n    try {\r\n      this.pushReportContext(this._reportCtxName);\r\n      prop = this.ctx.api.resolvePath(this.ctx, this.getAttribute(\"datapath\")).prop;\r\n      val = this.ctx.api.getValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n      prop = prop && prop.prop ? prop.prop : prop;\r\n\r\n      this.popReportContext();\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n      wasError = true;\r\n    }\r\n\r\n    if (wasError) {\r\n      this.disabled = true;\r\n      this.setCSS();\r\n      this._redraw();\r\n\r\n      return;\r\n    } else {\r\n      this.disabled = false;\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n\r\n    if (!prop) {\r\n      return;\r\n    }\r\n\r\n    if (this.prop === undefined) {\r\n      this.prop = prop;\r\n    }\r\n\r\n    prop = this.prop;\r\n\r\n    let name = this.getAttribute(\"name\");\r\n    \r\n    if (prop.type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n      name = prop.ui_value_names[prop.keys[val]];\r\n    } else {\r\n      name = \"\" + val;\r\n    }\r\n\r\n    if (name !== this.getAttribute(\"name\")) {\r\n      this.setAttribute(\"name\", name);\r\n      this.updateName();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    let path = this.getAttribute(\"datapath\");\r\n\r\n    if (path && path !== this._last_datapath) {\r\n      this._last_datapath = path;\r\n      this.prop = undefined;\r\n\r\n      this.updateDataPath();\r\n    }\r\n\r\n    super.update();\r\n\r\n    let key = this.getDefault(\"dropTextBG\");\r\n    if (key !== this._last_dbox_key) {\r\n      this._last_dbox_key = key;\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n  }\r\n\r\n  _build_menu_template() {\r\n    if (this._menu !== undefined && this._menu.parentNode !== undefined) {\r\n      this._menu.remove();\r\n    }\r\n\r\n    //let name = \"\" + this.getAttribute(\"name\");\r\n    let template = this._template;\r\n\r\n    if (typeof template === \"function\") {\r\n      template = template();\r\n    }\r\n\r\n    this._menu = createMenu(this.ctx, \"\", template);\r\n    return this._menu;\r\n  }\r\n\r\n  _build_menu() {\r\n    if (this._template) {\r\n      this._build_menu_template();\r\n      return;\r\n    }\r\n\r\n    let prop = this.prop;\r\n\r\n    if (this.prop === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this._menu !== undefined && this._menu.parentNode !== undefined) {\r\n      this._menu.remove();\r\n    }\r\n\r\n    let menu = this._menu = UIBase.createElement(\"menu-x\");\r\n\r\n    //let name = \"\" + this.getAttribute(\"name\");\r\n    menu.setAttribute(\"name\", \"\");\r\n    menu._dropbox = this;\r\n\r\n    let valmap = {};\r\n    let enummap = prop.values;\r\n    let iconmap = prop.iconmap;\r\n    let uimap = prop.ui_value_names;\r\n    let desr = prop.descriptions || {};\r\n\r\n    for (let k in enummap) {\r\n      let uk = k;\r\n\r\n      valmap[enummap[k]] = k;\r\n\r\n      if (uimap !== undefined && k in uimap) {\r\n        uk = uimap[k];\r\n      }\r\n\r\n      let tooltip = desr[k];\r\n\r\n      //menu.addItem(k, enummap[k], \":\");\r\n      if (iconmap && iconmap[k]) {\r\n        menu.addItemExtra(uk, enummap[k], undefined, iconmap[k], undefined, tooltip);\r\n      } else {\r\n        menu.addItem(uk, enummap[k], undefined, tooltip);\r\n      }\r\n    }\r\n\r\n    menu.onselect = (id) => {\r\n      this._pressed = false;\r\n\r\n      this._pressed = false;\r\n      this._redraw();\r\n\r\n      this._menu = undefined;\r\n\r\n      //check if datapath system will be calling .prop.setValue instead of us\r\n      let callProp = true;\r\n      if (this.hasAttribute(\"datapath\")) {\r\n        let rdef = this.ctx.api.resolvePath(this.ctx, this.getAttribute(\"datapath\"));\r\n        let prop = rdef.dpath.data;\r\n\r\n        callProp = !rdef || !rdef.dpath || !(rdef.dpath.data instanceof ToolProperty);\r\n      }\r\n\r\n      this._value = this._convertVal(id);\r\n\r\n      if (callProp) {\r\n        this.prop.setValue(id);\r\n      }\r\n\r\n      this.setAttribute(\"name\", this.prop.ui_value_names[valmap[id]]);\r\n      if (this.onselect) {\r\n        this.onselect(id);\r\n      }\r\n\r\n      if (this.hasAttribute(\"datapath\") && this.ctx) {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), id);\r\n      }\r\n    };\r\n  }\r\n\r\n  _onpress(e) {\r\n    this.abortToolTips(1000);\r\n\r\n    if (this._menu !== undefined) {\r\n      this.lockTimer = util.time_ms();\r\n\r\n      this._pressed = false;\r\n      this._redraw();\r\n\r\n      let menu = this._menu;\r\n      this._menu = undefined;\r\n      menu.close();\r\n      return;\r\n    }\r\n\r\n    if (util.time_ms() - this.lockTimer < 200) {\r\n      return;\r\n    }\r\n\r\n    this._build_menu();\r\n\r\n    if (this._menu === undefined) {\r\n      return;\r\n    }\r\n\r\n    this._menu.autoSearchMode = false;\r\n\r\n    this._menu._dropbox = this;\r\n    this.dom._background = this.getDefault(\"BoxDepressed\");\r\n    this._background = this.getDefault(\"BoxDepressed\");\r\n    this._redraw();\r\n    this._pressed = true;\r\n    this.setCSS();\r\n\r\n    let onclose = this._menu.onclose;\r\n    this._menu.onclose = () => {\r\n      this.lockTimer = util.time_ms();\r\n\r\n      this._pressed = false;\r\n      this._redraw();\r\n\r\n      let menu = this._menu;\r\n      if (menu) {\r\n        this._menu = undefined;\r\n        menu._dropbox = undefined;\r\n      }\r\n\r\n      if (onclose) {\r\n        onclose.call(menu);\r\n      }\r\n    }\r\n\r\n    let menu = this._menu;\r\n    let screen = this.getScreen();\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let x = e.x, y = e.y;\r\n    let rects = this.dom.getBoundingClientRect(); //getClientRects();\r\n\r\n    let rheight = rects.height;\r\n    x = rects.x - window.scrollX;\r\n    y = rects.y + rheight - window.scrollY; // + rects[0].height; // visualViewport.scale;\r\n\r\n    if (!window.haveElectron) {\r\n      //y -= 8;\r\n    }\r\n\r\n    /* need to figure out a better way to pop up a menu\r\n    *  above a given y position */\r\n    if (cconst.menusCanPopupAbove && y > screen.size[1]*0.5 && !this.searchMenuMode) {\r\n      let con = screen.popup(this, 500, 400, false, 0);\r\n\r\n      con.style[\"z-index\"] = \"-10000\";\r\n      con.style[\"position\"] = UIBase.PositionKey;\r\n      document.body.appendChild(con);\r\n\r\n      con.style[\"visibility\"] = \"hidden\";\r\n\r\n      con.add(menu);\r\n      menu.start();\r\n\r\n      let time = util.time_ms();\r\n\r\n      let timer = window.setInterval(() => {\r\n        if (util.time_ms() - time > 1500) {\r\n          window.clearInterval(timer);\r\n          return;\r\n        }\r\n\r\n        let r = menu.dom.getBoundingClientRect();\r\n\r\n        if (!r || r.height < 55) {\r\n          return;\r\n        }\r\n\r\n        window.clearInterval(timer);\r\n\r\n        y -= r.height + rheight;\r\n\r\n        menu.dom.remove();\r\n        con.remove();\r\n\r\n        let popup = this._popup = menu._popup = screen.popup(this, x, y, false, 0);\r\n        popup.noMarginsOrPadding();\r\n\r\n        //popup.shadow.appendChild(menu.dom);\r\n        popup.add(menu);\r\n        menu.start();\r\n\r\n        popup.style[\"left\"] = x + \"px\";\r\n        popup.style[\"top\"] = y + \"px\";\r\n        //menu.setCSS();\r\n      }, 1);\r\n\r\n      return;\r\n    }\r\n\r\n    /*\r\n    let w = document.createElement(\"div\");\r\n    w.style[\"width\"] = w.style[\"height\"] = \"15px\";\r\n    w.style[\"background-color\"] = \"red\";\r\n    w.style[\"z-index\"] = \"5000\";\r\n    w.style[\"position\"] = UIBase.PositionKey;\r\n    w.style[\"pointer-events\"] = \"none\";\r\n    w.style[\"left\"] = x + \"px\";\r\n    w.style[\"top\"] = y + \"px\";\r\n\r\n    document.body.appendChild(w);\r\n    //*/\r\n\r\n    let con = this._popup = menu._popup = screen.popup(this, x, y, false, 0);\r\n    con.noMarginsOrPadding();\r\n\r\n    con.add(menu);\r\n    if (this.searchMenuMode) {\r\n      menu.startFancy();\r\n    } else {\r\n      menu.start();\r\n    }\r\n  }\r\n\r\n  _redraw() {\r\n    if (this.getAttribute(\"simple\")) {\r\n      let color;\r\n\r\n      this.g.clearRect(0, 0, this.dom.width, this.dom.height);\r\n      \r\n      if (this._highlight) {\r\n        ui_base.drawRoundBox2(this, {canvas: this.dom, g: this.g, color: this.getDefault(\"BoxHighlight\")});\r\n      }\r\n\r\n      if (this._focus) {\r\n        ui_base.drawRoundBox2(this, {\r\n          canvas: this.dom, g: this.g, color: this.getDefault(\"BoxHighlight\"), op: \"stroke\", no_clear: true\r\n        });\r\n        ui_base.drawRoundBox(this, this.dom, this.g, undefined, undefined, 2, \"stroke\");\r\n      }\r\n\r\n      this._draw_text();\r\n      return;\r\n    }\r\n\r\n    super._redraw(false);\r\n\r\n    let g = this.g;\r\n    let w = this.dom.width, h = this.dom.height;\r\n    let dpi = this.getDPI();\r\n\r\n    let p = 10*dpi;\r\n    let p2 = dpi;\r\n\r\n    //*\r\n    let bg = this.getDefault(\"dropTextBG\");\r\n    if (bg !== undefined) {\r\n      g.fillStyle = bg;\r\n\r\n      g.beginPath();\r\n      g.rect(p2, p2, this.dom.width - p2 - h, this.dom.height - p2*2);\r\n      g.fill();\r\n    }\r\n    //*/\r\n\r\n    g.fillStyle = \"rgba(50, 50, 50, 0.2)\";\r\n    g.strokeStyle = \"rgba(50, 50, 50, 0.8)\";\r\n    g.beginPath();\r\n    /*\r\n    g.moveTo(w-p, p);\r\n    g.lineTo(w-(p+h*0.25), h-p);\r\n    g.lineTo(w-(p+h*0.5), p);\r\n    g.closePath();\r\n    //*/\r\n\r\n    let sz = 0.3;\r\n    g.moveTo(w - h*0.5 - p, p);\r\n    g.lineTo(w - p, p);\r\n    g.moveTo(w - h*0.5 - p, p + sz*h/3);\r\n    g.lineTo(w - p, p + sz*h/3);\r\n    g.moveTo(w - h*0.5 - p, p + sz*h*2/3);\r\n    g.lineTo(w - p, p + sz*h*2/3);\r\n\r\n    g.lineWidth = 1;\r\n    g.stroke();\r\n\r\n    this._draw_text();\r\n  }\r\n\r\n  _convertVal(val) {\r\n    if (typeof val === \"string\" && this.prop) {\r\n      if (val in this.prop.values) {\r\n        return this.prop.values[val];\r\n      } else if (val in this.prop.keys) {\r\n        return this.prop.keys[val];\r\n      } else {\r\n        return undefined;\r\n      }\r\n    }\r\n\r\n    return val;\r\n  }\r\n\r\n  setValue(val, setLabelOnly = false) {\r\n    if (val === undefined || val === this._value) {\r\n      return;\r\n    }\r\n\r\n    val = this._convertVal(val);\r\n\r\n    if (val === undefined) {\r\n      console.warn(\"Bad val\", arguments[0]);\r\n      return;\r\n    }\r\n\r\n    this._value = val;\r\n\r\n    if (this.prop !== undefined && !setLabelOnly) {\r\n      this.prop.setValue(val);\r\n      let val2 = val;\r\n\r\n      if (val2 in this.prop.keys)\r\n        val2 = this.prop.keys[val2];\r\n      val2 = this.prop.ui_value_names[val2];\r\n\r\n      this.setAttribute(\"name\", \"\" + val2);\r\n      this._name = \"\" + val2;\r\n    } else {\r\n      this.setAttribute(\"name\", \"\" + val);\r\n      this._name = \"\" + val;\r\n    }\r\n\r\n    if (this.onchange && !setLabelOnly) {\r\n      this.onchange(val);\r\n    }\r\n\r\n    this.setCSS();\r\n    this.updateDataPath();\r\n    this._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(DropBox);\r\n\r\nexport class MenuWrangler {\r\n  constructor() {\r\n    this.screen = undefined;\r\n    this.menustack = [];\r\n\r\n    this.lastPickElemTime = util.time_ms();\r\n\r\n    this._closetimer = 0;\r\n    this.closeOnMouseUp = undefined;\r\n    this.closereq = undefined;\r\n\r\n    this.timer = undefined;\r\n  }\r\n\r\n  get closetimer() {\r\n    return this._closetimer;\r\n  }\r\n\r\n  set closetimer(v) {\r\n    debugmenu(\"set closertime\", v);\r\n    this._closetimer = v;\r\n  }\r\n\r\n  get menu() {\r\n    return this.menustack.length > 0 ? this.menustack[this.menustack.length - 1] : undefined;\r\n  }\r\n\r\n  pushMenu(menu) {\r\n    debugmenu(\"pushMenu\");\r\n\r\n    this.spawnreq = undefined;\r\n\r\n    if (this.menustack.length === 0 && menu.closeOnMouseUp) {\r\n      this.closeOnMouseUp = true;\r\n    }\r\n\r\n    this.menustack.push(menu);\r\n  }\r\n\r\n  popMenu(menu) {\r\n    debugmenu(\"popMenu\");\r\n\r\n    return this.menustack.pop();\r\n  }\r\n\r\n  endMenus() {\r\n    debugmenu(\"endMenus\");\r\n\r\n    for (let menu of this.menustack) {\r\n      menu.close();\r\n    }\r\n\r\n    this.menustack = [];\r\n  }\r\n\r\n  searchKeyDown(e) {\r\n    let menu = this.menu;\r\n\r\n    e.stopPropagation();\r\n    menu._ignoreFocusEvents = true;\r\n    menu.textbox.focus();\r\n    menu._ignoreFocusEvents = false;\r\n\r\n    //if (e.shiftKey || e.altKey || e.ctrlKey || e.commandKey) {\r\n    //  return;\r\n    //}\r\n\r\n    switch (e.keyCode) {\r\n      case keymap[\"Enter\"]: //return key\r\n        menu.click(menu.activeItem);\r\n        break;\r\n      case keymap[\"Escape\"]: //escape key\r\n        menu.close();\r\n        break;\r\n      case keymap[\"Up\"]:\r\n        menu.selectPrev(false);\r\n        break;\r\n      case keymap[\"Down\"]:\r\n        menu.selectNext(false);\r\n        break;\r\n    }\r\n  }\r\n\r\n  on_keydown(e) {\r\n    window.menu = this.menu;\r\n\r\n    if (this.menu === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this.menu.hasSearchBox) {\r\n      return this.searchKeyDown(e);\r\n    }\r\n\r\n    let menu = this.menu;\r\n\r\n    switch (e.keyCode) {\r\n      case keymap[\"Left\"]: //left\r\n      case keymap[\"Right\"]: //right\r\n        if (menu._dropbox) {\r\n          let dropbox = menu._dropbox;\r\n\r\n          if (e.keyCode === keymap[\"Left\"]) {\r\n            dropbox = dropbox.previousElementSibling;\r\n          } else {\r\n            dropbox = dropbox.nextElementSibling;\r\n          }\r\n\r\n          if (dropbox !== undefined && dropbox instanceof DropBox) {\r\n            this.endMenus();\r\n            dropbox._onpress(e);\r\n          }\r\n        }\r\n        break;\r\n      case keymap[\"Up\"]: //up\r\n        menu.selectPrev();\r\n        break;\r\n      case keymap[\"Down\"]: //down\r\n        menu.selectNext();\r\n        break;\r\n      /*\r\n      let item = menu.activeItem;\r\n      if (!item) {\r\n        item = menu.items[0];\r\n      }\r\n\r\n      if (!item) {\r\n        return;\r\n      }\r\n\r\n      let item2;\r\n      let i = menu.items.indexOf(item);\r\n\r\n      if (e.keyCode == 38) {\r\n        i = (i - 1 + menu.items.length) % menu.items.length;\r\n      } else {\r\n        i = (i + 1) % menu.items.length;\r\n      }\r\n\r\n      item2 = menu.items[i];\r\n\r\n      if (item2) {\r\n        menu.setActive(item2);\r\n      }\r\n      break;//*/\r\n      case 13: //return key\r\n      case 32: //space key\r\n        menu.click(menu.activeItem);\r\n        break;\r\n      case 27: //escape key\r\n        menu.close();\r\n        break;\r\n    }\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    if (this.menu === undefined || this.screen === undefined) {\r\n      this.closetimer = util.time_ms();\r\n      return;\r\n    }\r\n\r\n    let screen = this.screen;\r\n    let x = e.pageX, y = e.pageY;\r\n\r\n    let element = screen.pickElement(x, y);\r\n\r\n    if (element !== undefined && (element instanceof DropBox || util.isMobile())) {\r\n      this.endMenus();\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    if (this.menu === undefined || this.screen === undefined) {\r\n      this.closetimer = util.time_ms();\r\n      return;\r\n    }\r\n\r\n    let screen = this.screen;\r\n    let x = e.pageX, y = e.pageY;\r\n\r\n    let element = screen.pickElement(x, y, undefined, undefined, DropBox);\r\n    if (element !== undefined) {\r\n      this.closeOnMouseUp = false;\r\n    } else {\r\n      element = screen.pickElement(x, y, undefined, undefined, Menu);\r\n\r\n      //closeOnMouseUp\r\n      if (element && this.closeOnMouseUp) {\r\n        element.click();\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  findMenu(x, y) {\r\n    let screen = this.screen;\r\n\r\n    let element = screen.pickElement(x, y);\r\n\r\n    if (element === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (element instanceof Menu) {\r\n      return element;\r\n    }\r\n\r\n    let w = element;\r\n\r\n    while (w) {\r\n      if (w instanceof Menu) {//w === this.menu) {\r\n        return w;\r\n        break;\r\n      }\r\n\r\n      w = w.parentWidget;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    if (this.menu && this.menu.hasSearchBox) {\r\n      this.closetimer = util.time_ms();\r\n      this.closereq = undefined;\r\n      return;\r\n    }\r\n\r\n    if (this.menu === undefined || this.screen === undefined) {\r\n      this.closetimer = util.time_ms();\r\n      this.closereq = undefined;\r\n      return;\r\n    }\r\n\r\n    let screen = this.screen;\r\n    let x = e.pageX, y = e.pageY;\r\n\r\n    let element;\r\n    let menu = this.menu;\r\n\r\n    if (menu) {\r\n      let r = menu.getBoundingClientRect();\r\n      let pad = 15;\r\n\r\n      if (r && x >= r.x - pad && y >= r.y - pad && x <= r.x + r.width + pad*2 && y <= r.y + r.height + pad*2) {\r\n        element = menu;\r\n      }\r\n    }\r\n\r\n    if (!element && util.time_ms() - this.lastPickElemTime > 250) {\r\n      element = screen.pickElement(x, y);\r\n      this.lastPickElemTime = util.time_ms();\r\n    }\r\n\r\n    if (element === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (element instanceof Menu) {\r\n      this.closetimer = util.time_ms();\r\n      this.closereq = undefined;\r\n      return;\r\n    }\r\n    \r\n    let destroy = element.hasAttribute(\"menu-button\") && element.hasAttribute(\"simple\");\r\n    destroy = destroy && element.menu !== this.menu;\r\n\r\n    if (destroy) {\r\n      /* check that dropbox doesn't contain our parent menu either */\r\n\r\n      let menu2 = this.menu;\r\n      while (menu2 !== element.menu) {\r\n        menu2 = menu2.parentMenu;\r\n        destroy = destroy && (menu2 === undefined || menu2 !== element.menu);\r\n      }\r\n    }\r\n\r\n    if (destroy) {\r\n      //destroy entire menu stack\r\n      this.endMenus();\r\n\r\n      this.closetimer = util.time_ms();\r\n      this.closereq = undefined;\r\n\r\n      //start new menu\r\n      element._onpress(e);\r\n      return;\r\n    }\r\n\r\n    let ok = false;\r\n\r\n    let w = element;\r\n    while (w) {\r\n      if (w instanceof Menu) {//w === this.menu) {\r\n        ok = true;\r\n        break;\r\n      }\r\n\r\n      if (w.hasAttribute(\"menu-button\") && w.menu === this.menu) {\r\n        ok = true;\r\n        break;\r\n      }\r\n\r\n      w = w.parentWidget;\r\n    }\r\n\r\n    if (!ok) {\r\n      this.closereq = this.menu;\r\n    } else {\r\n      this.closetimer = util.time_ms();\r\n      this.closereq = undefined;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    let closetime = cconst.menu_close_time;\r\n    closetime = closetime === undefined ? 50 : closetime;\r\n\r\n    let close = this.closereq && this.closereq === this.menu;\r\n    close = close && util.time_ms() - this.closetimer > closetime;\r\n\r\n    if (close) {\r\n      this.closereq = undefined;\r\n      this.endMenus();\r\n    }\r\n  }\r\n\r\n  startTimer() {\r\n    if (this.timer) {\r\n      this.stopTimer();\r\n    }\r\n\r\n    this.timer = setInterval(() => {\r\n      debugmenu(\"start menu wrangler interval\");\r\n\r\n      this.update();\r\n    }, 150);\r\n  }\r\n\r\n  stopTimer() {\r\n    if (this.timer) {\r\n      debugmenu(\"stop menu wrangler interval\");\r\n\r\n      clearInterval(this.timer);\r\n      this.timer = undefined;\r\n    }\r\n  }\r\n}\r\n\r\nexport let menuWrangler = window._menuWrangler = new MenuWrangler();\r\nlet wrangerStarted = false;\r\n\r\nexport function startMenuEventWrangling(screen) {\r\n  menuWrangler.screen = screen;\r\n\r\n  if (wrangerStarted) {\r\n    return;\r\n  }\r\n\r\n  wrangerStarted = true;\r\n\r\n  for (let k in DomEventTypes) {\r\n    if (menuWrangler[k] === undefined) {\r\n      continue;\r\n    }\r\n\r\n    let dom = k.search(\"key\") >= 0 ? window : document.body;\r\n    dom = window;\r\n    dom.addEventListener(DomEventTypes[k], menuWrangler[k].bind(menuWrangler), {passive: false, capture: true})\r\n  }\r\n\r\n  menuWrangler.screen = screen;\r\n  menuWrangler.startTimer();\r\n}\r\n\r\nwindow._startMenuEventWrangling = startMenuEventWrangling;\r\n\r\nexport function setWranglerScreen(screen) {\r\n  startMenuEventWrangling(screen);\r\n}\r\n\r\nexport function getWranglerScreen() {\r\n  return menuWrangler.screen;\r\n}\r\n\r\nexport function createMenu(ctx, title, templ) {\r\n  let menu = UIBase.createElement(\"menu-x\");\r\n  menu.ctx = ctx;\r\n  menu.setAttribute(\"name\", title);\r\n\r\n  let SEP = menu.constructor.SEP;\r\n  let id = 0;\r\n  let cbs = {};\r\n\r\n  let doItem = (item) => {\r\n    if (item !== undefined && item instanceof Menu) {\r\n      menu.addItem(item);\r\n    } else if (typeof item == \"string\") {\r\n      let def, hotkey;\r\n\r\n      try {\r\n        def = ctx.api.getToolDef(item);\r\n      } catch (error) {\r\n        menu.addItem(\"(tool path error)\", id++);\r\n        return;\r\n      }\r\n\r\n      //3Extra(text, id=undefined, hotkey, icon=-1, add=true) {\r\n      if (!def.hotkey) {\r\n        try {\r\n          hotkey = ctx.api.getToolPathHotkey(ctx, item);\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n          console.warn(\"error getting hotkey for tool \" + item);\r\n          hotkey = undefined;\r\n        }\r\n      } else {\r\n        hotkey = def.hotkey;\r\n      }\r\n\r\n      menu.addItemExtra(def.uiname, id, hotkey, def.icon);\r\n\r\n      cbs[id] = (function (toolpath) {\r\n        return function () {\r\n          ctx.api.execTool(ctx, toolpath);\r\n        }\r\n      })(item);\r\n\r\n      id++;\r\n    } else if (item === SEP) {\r\n      menu.seperator();\r\n    } else if (typeof item === \"function\" || item instanceof Function) {\r\n      doItem(item());\r\n    } else if (item instanceof Array) { //old array-based api for custom entries\r\n      let hotkey = item.length > 2 ? item[2] : undefined;\r\n      let icon = item.length > 3 ? item[3] : undefined;\r\n      let tooltip = item.length > 4 ? item[4] : undefined;\r\n      let id2 = item.length > 5 ? item[5] : id++;\r\n\r\n      if (hotkey !== undefined && hotkey instanceof HotKey) {\r\n        hotkey = hotkey.buildString();\r\n      }\r\n\r\n      menu.addItemExtra(item[0], id2, hotkey, icon, undefined, tooltip);\r\n\r\n      cbs[id2] = (function (cbfunc, arg) {\r\n        return function () {\r\n          cbfunc(arg);\r\n        }\r\n      })(item[1], id2);\r\n    } else if (typeof item === \"object\") { //new object-based api for custom entries\r\n      let {name, callback, hotkey, icon, tooltip} = item;\r\n\r\n      let id2 = item.id !== undefined ? item.id : id++;\r\n      if (hotkey !== undefined && hotkey instanceof HotKey) {\r\n        hotkey = hotkey.buildString();\r\n      }\r\n\r\n      menu.addItemExtra(name, id2, hotkey, icon, undefined, tooltip);\r\n\r\n      cbs[id2] = (function (cbfunc, arg) {\r\n        return function () {\r\n          cbfunc(arg);\r\n        }\r\n      })(callback, id2);\r\n    }\r\n  }\r\n\r\n  for (let item of templ) {\r\n    doItem(item);\r\n  }\r\n\r\n  menu.onselect = (id) => {\r\n    cbs[id]();\r\n  }\r\n\r\n  return menu;\r\n}\r\n\r\nexport function startMenu(menu, x, y, searchMenuMode = false, safetyDelay = 55) {\r\n  menuWrangler.endMenus();\r\n\r\n  let screen = menu.ctx.screen;\r\n  let con = menu._popup = screen.popup(undefined, x, y, false, safetyDelay);\r\n  con.noMarginsOrPadding();\r\n\r\n  con.add(menu);\r\n  if (searchMenuMode) {\r\n    menu.startFancy();\r\n  } else {\r\n    menu.start();\r\n  }\r\n\r\n  menu.flushUpdate();\r\n  menu.flushSetCSS();\r\n\r\n  menu._popup.flushUpdate();\r\n  menu._popup.flushSetCSS();\r\n}\r\n","//bind module to global var to get at it in console.\r\n//\r\n//note that require has an api for handling circular \r\n//module refs, in such cases do not use these vars.\r\n\r\nvar _ui = undefined;\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as units from '../core/units.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from './ui_base.js';\r\nimport * as ui_widgets from '../widgets/ui_widgets.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport '../path-controller/util/html5_fileapi.js';\r\nimport {HotKey} from '../path-controller/util/simple_events.js';\r\nimport {CSSFont} from './ui_theme.js';\r\nimport {theme, iconSheetFromPackFlag} from './ui_base.js';\r\n\r\nimport {createMenu, startMenu} from \"../widgets/ui_menu.js\";\r\n\r\nlet PropFlags = toolprop.PropFlags;\r\nlet PropSubTypes = toolprop.PropSubTypes;\r\n\r\nlet EnumProperty = toolprop.EnumProperty;\r\n\r\nlet Vector2   = vectormath.Vector2,\r\n    UIBase    = ui_base.UIBase,\r\n    PackFlags = ui_base.PackFlags,\r\n    PropTypes = toolprop.PropTypes;\r\n\r\nimport {DataPathError} from '../path-controller/controller/controller_base.js';\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nexport class Label extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._label = \"\";\r\n\r\n    this._lastText = \"\";\r\n\r\n    this.dom = document.createElement(\"div\");\r\n    this.dom.setAttribute(\"class\", \"_labelx\");\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n      div._labelx::selection {\r\n        color: none;\r\n        background: none;\r\n         -webkit-user-select:none;\r\n         user-select:none;\r\n      }\r\n    `;\r\n\r\n    this.shadow.appendChild(style);\r\n    this.shadow.appendChild(this.dom);\r\n\r\n    this.font = \"LabelText\";\r\n  }\r\n\r\n  get font() {\r\n    return this._font;\r\n  }\r\n\r\n  /**Set a font defined in ui_base.defaults\r\n   e.g. DefaultText*/\r\n  set font(fontDefaultName) {\r\n    if (typeof fontDefaultName === \"string\") {\r\n      this._font = this.getDefault(fontDefaultName);\r\n      if (!this._font) {\r\n        console.warn(\"Invalid font\", fontDefaultName);\r\n      }\r\n    } else if (typeof fontDefaultName === \"object\" && fontDefaultName instanceof CSSFont) {\r\n      this._font = fontDefaultName;\r\n    } else {\r\n      console.warn(\"Invalid font\", fontDefaultName);\r\n    }\r\n\r\n    this._updateFont();\r\n  }\r\n\r\n  get text() {\r\n    return this._label;\r\n    //return this.dom.innerText;\r\n  }\r\n\r\n  set text(text) {\r\n    this._label = text;\r\n\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      this.dom.innerText = text;\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"label-x\",\r\n      style  : \"label\"\r\n    };\r\n  }\r\n\r\n  init() {\r\n    this.dom.style[\"width\"] = \"max-content\";\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS(false);\r\n    this.setBoxCSS();\r\n  }\r\n\r\n  on_disabled() {\r\n    super.on_disabled();\r\n    this._enabled_font = this.font;\r\n    this.font = \"DefaultText\";\r\n    this._updateFont();\r\n  }\r\n\r\n  on_enabled() {\r\n    super.on_enabled();\r\n    this.font = this._enabled_font;\r\n    this._updateFont();\r\n  }\r\n\r\n  _updateFont() {\r\n    let font = this._font;\r\n    if (!font) return;\r\n\r\n    this.dom.style[\"font\"] = font.genCSS();\r\n    this.dom.style[\"color\"] = font.color;\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (this.ctx === undefined) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n    let prop = this.getPathMeta(this.ctx, path);\r\n    let val = this.getPathValue(this.ctx, path);\r\n\r\n    if (val === undefined) {\r\n      return;\r\n    }\r\n\r\n    //console.log(path);\r\n    if (prop.type & (PropTypes.INT | PropTypes.FLOAT)) {\r\n      val = units.buildString(val, prop.baseUnit, prop.decimalPlaces, prop.displayUnit);\r\n    }\r\n\r\n    val = \"\" + this._label + \" \" + val;\r\n\r\n    if (val !== this._lastText) {\r\n      this._lastText = val;\r\n      this.dom.innerText = val;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    let key = \"\";\r\n\r\n    if (this._font !== undefined && this._font instanceof CSSFont) {\r\n      key += this._font.genKey();\r\n    }\r\n\r\n    if (key !== this._last_font) {\r\n      this._last_font = key;\r\n      this._updateFont();\r\n    }\r\n\r\n    this.dom.style[\"pointer-events\"] = this.style[\"pointer-events\"];\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n  }\r\n}\r\n\r\nui_base.UIBase.internalRegister(Label);\r\n\r\nexport class Container extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.dataPrefix = '';\r\n    this.massSetPrefix = '';\r\n\r\n    this.inherit_packflag = 0;\r\n\r\n    let style = this.styletag = document.createElement(\"style\")\r\n    style.textContent = `\r\n    `;\r\n\r\n    this.shadow.appendChild(style);\r\n    this.reversed = false;\r\n\r\n    this._prefixstack = [];\r\n    this._mass_prefixstack = [];\r\n  }\r\n\r\n  set background(bg) {\r\n    this.__background = bg;\r\n\r\n    this.styletag.textContent = `div.containerx {\r\n        background-color : ${bg};\r\n      }\r\n    `;\r\n    this.style[\"background-color\"] = bg;\r\n  }\r\n\r\n  get children() {\r\n    let list = [];\r\n\r\n    this._forEachChildWidget((n) => {\r\n      list.push(n);\r\n    });\r\n\r\n    return list\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"container-x\"\r\n    };\r\n  }\r\n\r\n  /** recursively change path prefix for all children*/\r\n  changePathPrefix(newprefix) {\r\n    let prefix = this.dataPrefix.trim();\r\n    this.dataPrefix = newprefix;\r\n\r\n    if (prefix.length > 0) {\r\n      prefix += \".\";\r\n    }\r\n\r\n    let rec = (n, con) => {\r\n      if (n instanceof Container && n !== this) {\r\n        if (n.dataPrefix.startsWith(prefix)) {\r\n          n.dataPrefix = n.dataPath.slice(prefix.length, n.dataPrefix.length);\r\n          n.dataPrefix = con._joinPrefix(n.dataPrefix);\r\n          con = n;\r\n        }\r\n      }\r\n\r\n      if (n.hasAttribute(\"datapath\")) {\r\n        let path = n.getAttribute(\"datapath\");\r\n\r\n        if (path.startsWith(prefix)) {\r\n          path = path.slice(prefix.length, path.length);\r\n          path = con._joinPrefix(path);\r\n          n.setAttribute(\"datapath\", path);\r\n\r\n          //update helper tooltips\r\n          n.description = n.description;\r\n        }\r\n      }\r\n\r\n      n._forEachChildWidget((n2) => {\r\n        rec(n2, con);\r\n      });\r\n    }\r\n\r\n    rec(this, this);\r\n  }\r\n\r\n  reverse() {\r\n    this.reversed ^= true;\r\n    return this;\r\n  }\r\n\r\n  pushMassSetPrefix(val) {\r\n    this._mass_prefixstack.push(this.massSetPrefix);\r\n    this.massSetPrefix = val;\r\n    return this;\r\n  }\r\n\r\n  pushDataPrefix(val) {\r\n    this._prefixstack.push(this.dataPrefix);\r\n    this.dataPrefix = val;\r\n    return this;\r\n  }\r\n\r\n  popDataPrefix() {\r\n    this.dataPrefix = this._prefixstack.pop();\r\n    return this;\r\n  }\r\n\r\n  popMassSetPrefix() {\r\n    this.massSetPrefix = this._mass_prefixstack.pop();\r\n    return this;\r\n  }\r\n\r\n  saveData() {\r\n    if (this.scrollTop || this.scrollLeft) {\r\n      return {\r\n        scrollTop : this.scrollTop,\r\n        scrollLeft: this.scrollLeft\r\n      }\r\n    } else {\r\n      return {};\r\n    }\r\n  }\r\n\r\n  loadData(obj) {\r\n    if (!obj) return;\r\n\r\n    let x = obj.scrollLeft || 0;\r\n    let y = obj.scrollTop || 0;\r\n\r\n    this.doOnce(() => {\r\n      this.scrollTo(x, y);\r\n    }, 12);\r\n  }\r\n\r\n  init() {\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-direction\"] = this.reversed ? \"column-reverse\" : \"column\";\r\n    this.style[\"flex-wrap\"] = \"nowrap\";\r\n    this.style[\"flex-grow\"] = \"\" + this.getDefault(\"flex-grow\", undefined, \"1\");\r\n\r\n    this.setCSS();\r\n\r\n    super.init();\r\n\r\n    this.setAttribute(\"class\", \"containerx\");\r\n  }\r\n\r\n  /** Returns previous icon flags */\r\n  useIcons(enabled_or_sheet = true) {\r\n    let enabled = !!enabled_or_sheet;\r\n\r\n    let mask = PackFlags.USE_ICONS | PackFlags.SMALL_ICON | PackFlags.LARGE_ICON;\r\n    mask = mask | PackFlags.CUSTOM_ICON_SHEET;\r\n    mask = mask | (255<<PackFlags.CUSTOM_ICON_SHEET_START);\r\n\r\n    let previous = this.packflag & mask;\r\n\r\n    if (!enabled) {\r\n      this.packflag &= ~PackFlags.USE_ICONS;\r\n      this.inherit_packflag &= ~PackFlags.USE_ICONS;\r\n\r\n      return previous;\r\n    }\r\n\r\n    let sheet = enabled_or_sheet;\r\n\r\n    if (sheet === true) {\r\n      sheet = PackFlags.SMALL_ICON;\r\n    } else if (sheet === 1) {\r\n      sheet = PackFlags.LARGE_ICON;\r\n    } else {\r\n      sheet = PackFlags.CUSTOM_ICON_SHEET | (sheet<<(PackFlags.CUSTOM_ICON_SHEET_START));\r\n    }\r\n\r\n    //clear any existing sizing flags\r\n    this.packflag &= ~(PackFlags.SMALL_ICON | PackFlags.LARGE_ICON | PackFlags.CUSTOM_ICON_SHEET);\r\n    this.packflag &= ~(255<<PackFlags.CUSTOM_ICON_SHEET_START);\r\n\r\n    this.packflag |= PackFlags.USE_ICONS | sheet;\r\n    this.inherit_packflag |= PackFlags.USE_ICONS | sheet;\r\n\r\n    return previous;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param mode: flexbox wrap mode, can be wrap, nowrap, or wrap-reverse\r\n   * @returns {Container}\r\n   */\r\n  wrap(mode = \"wrap\") {\r\n    this.style[\"flex-wrap\"] = mode;\r\n    return this;\r\n  }\r\n\r\n  noMarginsOrPadding() {\r\n    super.noMarginsOrPadding();\r\n\r\n    let keys = [\"margin\", \"padding\", \"margin-block-start\", \"margin-block-end\"];\r\n    keys = keys.concat([\"padding-block-start\", \"padding-block-end\"]);\r\n\r\n    for (let k of keys) {\r\n      this.style[k] = \"0px\";\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  setCSS() {\r\n    let rest = '';\r\n\r\n    let add = (style) => {\r\n      if (!this.hasDefault(style)) {\r\n        return;\r\n      }\r\n\r\n      let val = this.getDefault(style);\r\n\r\n      if (val !== undefined) {\r\n        rest += `  ${style} = ${val};\\n`;\r\n        this.style[style] = val;\r\n      }\r\n    }\r\n\r\n    add(\"border-radius\");\r\n    add(\"border-width\");\r\n    add(\"border-top\");\r\n    add(\"border-bottom\");\r\n    add(\"border-left\");\r\n    add(\"border-right\");\r\n\r\n    this.styletag.textContent = `div.containerx {\r\n        background-color : ${this.getDefault(\"background-color\")};\r\n        ${rest}\r\n      }\r\n      `;\r\n  }\r\n\r\n  overrideDefault(key, val) {\r\n    super.overrideDefault(key, val);\r\n    this.setCSS();\r\n\r\n    return this;\r\n  }\r\n\r\n  /*\r\n  * shorthand for:\r\n  *\r\n  * .row().noMarginsOrPadding().oneAxisPadding()\r\n  * */\r\n  strip(themeClass = \"strip\", margin1 = this.getDefault(\"oneAxisPadding\"), margin2 = 1, horiz = undefined) {\r\n    if (horiz === undefined) {\r\n      horiz = this instanceof RowFrame;\r\n      horiz = horiz || this.style[\"flex-direction\"] === \"row\";\r\n    }\r\n\r\n    let flag = horiz ? PackFlags.STRIP_HORIZ : PackFlags.STRIP_VERT;\r\n\r\n    let strip = (horiz ? this.row() : this.col());\r\n\r\n    if (typeof margin1 !== \"number\") {\r\n      throw new Error(\"margin1 was not a number\");\r\n    }\r\n    if (typeof margin2 !== \"number\") {\r\n      throw new Error(\"margin2 was not a number\");\r\n    }\r\n\r\n    strip.packflag |= flag;\r\n    strip.dataPrefix = this.dataPrefix;\r\n    strip.massSetPrefix = this.massSetPrefix;\r\n\r\n    if (themeClass in theme) {\r\n      strip.overrideClass(themeClass);\r\n      strip.background = strip.getDefault(\"background-color\");\r\n      strip.setCSS();\r\n      strip.overrideClass(themeClass);\r\n\r\n      let lastkey;\r\n\r\n      strip.update.after(function () {\r\n        let bradius = strip.getDefault(\"border-radius\");\r\n        let bline = strip.getDefault(\"border-width\");\r\n        let bstyle = strip.getDefault(\"border-style\") || 'solid';\r\n        let padding = strip.getDefault(\"padding\");\r\n        let bcolor = strip.getDefault(\"border-color\") || \"rgba(0,0,0,0)\";\r\n        let margin = strip.getDefault(\"margin\") || 0;\r\n\r\n        bline = bline === undefined ? 0 : bline;\r\n        bradius = bradius === undefined ? 0 : bradius;\r\n        padding = padding === undefined ? 5 : padding;\r\n\r\n        let bg = strip.getDefault(\"background-color\");\r\n\r\n        let key = \"\" + bradius + \":\" + bline + \":\" + bg + \":\" + padding + \":\";\r\n        key += bstyle + \":\" + padding + \":\" + bcolor + \":\" + margin;\r\n\r\n        if (key !== lastkey) {\r\n          lastkey = key;\r\n\r\n          strip.oneAxisPadding(margin1 + padding, margin2 + padding);\r\n          strip.setCSS();\r\n\r\n          strip.background = bg;\r\n\r\n          strip.style[\"margin\"] = \"\" + margin + \"px\";\r\n          strip.style[\"border\"] = `${bline}px ${bstyle} ${bcolor}`;\r\n          strip.style[\"border-radius\"] = \"\" + bradius + \"px\";\r\n        }\r\n      })\r\n    } else {\r\n      console.warn(this.constructor.name + \".strip(): unknown theme class \" + themeClass);\r\n    }\r\n\r\n    /*\r\n    let prev = strip.previousElementSibling;\r\n    if (prev !== undefined && (prev.packflag & flag)) {\r\n      if (horiz) {\r\n        prev.style[\"padding-right\"] = \"0px\";\r\n      } else {\r\n        prev.style[\"padding-top\"] = \"0px\";\r\n      }\r\n    }//*/\r\n\r\n    return strip;\r\n  }\r\n\r\n  /**\r\n   * tries to set margin along one axis only in smart manner\r\n   * */\r\n  oneAxisMargin(m = this.getDefault(\"oneAxisMargin\"), m2 = 0) {\r\n    this.style[\"margin-top\"] = this.style[\"margin-bottom\"] = \"\" + m + \"px\";\r\n    this.style[\"margin-left\"] = this.style[\"margin-right\"] = \"\" + m2 + \"px\";\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * tries to set padding along one axis only in smart manner\r\n   * */\r\n  oneAxisPadding(axisPadding = this.getDefault(\"oneAxisPadding\"), otherPadding = 0) {\r\n    this.style[\"padding-top\"] = this.style[\"padding-bottom\"] = \"\" + axisPadding + \"px\";\r\n    this.style[\"padding-left\"] = this.style[\"padding-right\"] = \"\" + otherPadding + \"px\";\r\n\r\n    return this;\r\n  }\r\n\r\n  setMargin(m) {\r\n    this.style[\"margin\"] = m + \"px\";\r\n\r\n    return this;\r\n  }\r\n\r\n  setPadding(m) {\r\n    this.style[\"padding\"] = m + \"px\";\r\n\r\n    return this;\r\n  }\r\n\r\n  setSize(width, height) {\r\n    if (width !== undefined) {\r\n      if (typeof width == \"number\")\r\n        this.style[\"width\"] = this.div.style[\"width\"] = ~~width + \"px\";\r\n      else\r\n        this.style[\"width\"] = this.div.style[\"width\"] = width;\r\n    }\r\n\r\n    if (height !== undefined) {\r\n      if (typeof height == \"number\")\r\n        this.style[\"height\"] = this.div.style[\"height\"] = ~~height + \"px\";\r\n      else\r\n        this.style[\"height\"] = this.div.style[\"height\"] = height;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  save() {\r\n  }\r\n\r\n  load() {\r\n  }\r\n\r\n  saveVisibility() {\r\n    localStorage[this.storagePrefix + \"_settings\"] = JSON.stringify(this);\r\n    return this;\r\n  }\r\n\r\n  loadVisibility() {\r\n    let key = this.storagePrefix + \"_settings\";\r\n    let ok = true;\r\n\r\n    if (key in localStorage) {\r\n      console.log(\"loading UI visibility state. . .\");\r\n\r\n      try {\r\n        this.loadJSON(JSON.parse(localStorage[key]));\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        ok = false;\r\n      }\r\n    }\r\n\r\n    return ok;\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = {\r\n      opened: !this.closed\r\n    };\r\n\r\n    return Object.assign(super.toJSON(), ret);\r\n  }\r\n\r\n  _ondestroy() {\r\n    this._forEachChildWidget((n) => {\r\n      n._ondestroy();\r\n    });\r\n\r\n    super._ondestroy();\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    //console.error(\"ui.js:Container.loadJSON: implement me!\");\r\n\r\n    return this;\r\n  }\r\n\r\n  redrawCurves() {\r\n    throw new Error(\"Implement me (properly!)\");\r\n\r\n    if (this.closed)\r\n      return;\r\n\r\n    for (let cw of this.curve_widgets) {\r\n      cw.draw();\r\n    }\r\n  }\r\n\r\n  listen() {\r\n    window.setInterval(() => {\r\n      this.update();\r\n    }, 150);\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  appendChild(child) {\r\n    if (child instanceof ui_base.UIBase) {\r\n      child.ctx = this.ctx;\r\n      child.parentWidget = this;\r\n      this.shadow.appendChild(child);\r\n\r\n      if (child.onadd) {\r\n        child.onadd();\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    return super.appendChild(child);\r\n  }\r\n\r\n  clear(trigger_on_destroy = true) {\r\n    for (let child of this.children) {\r\n      if (child instanceof ui_base.UIBase) {\r\n        child.remove(trigger_on_destroy);\r\n      }\r\n    }\r\n  }\r\n\r\n  removeChild(child, trigger_on_destroy = true) {\r\n    let ret = super.removeChild(child);\r\n\r\n    if (child.on_remove) {\r\n      child.on_remove();\r\n    }\r\n\r\n    if (trigger_on_destroy && child.on_destroy) {\r\n      child.on_destroy();\r\n    }\r\n\r\n    child.parentWidget = undefined;\r\n\r\n    return ret;\r\n  }\r\n\r\n  prepend(child) {\r\n    if (child instanceof UIBase) {\r\n      this._prepend(child);\r\n    } else {\r\n      super.prepend(child);\r\n    }\r\n  }\r\n\r\n  //*\r\n  _prepend(child) {\r\n    return this._add(child, true);\r\n  }//*/\r\n\r\n  add(child) {\r\n    return this._add(child);\r\n  }\r\n\r\n  insert(i, ch) {\r\n    ch.parentWidget = this;\r\n    ch.ctx = this;\r\n\r\n    if (i >= this.shadow.childNodes.length) {\r\n      this.add(ch);\r\n    } else {\r\n      this.shadow.insertBefore(ch, util.list(this.children)[i]);\r\n    }\r\n\r\n    if (ch.onadd) {\r\n      ch.onadd();\r\n    }\r\n  }\r\n\r\n  _add(child, prepend = false) {\r\n    //paranoia check for if we accidentally got a DOM NodeList\r\n    if (child instanceof NodeList) {\r\n      throw new Error(\"eek!\");\r\n    }\r\n\r\n    child.ctx = this.ctx;\r\n    child.parentWidget = this;\r\n    child._useDataPathUndo = this._useDataPathUndo;\r\n\r\n    if (!child._themeOverride && this._themeOverride) {\r\n      child.overrideTheme(this._themeOverride);\r\n    }\r\n\r\n    if (prepend) {\r\n      this.shadow.prepend(child);\r\n    } else {\r\n      this.shadow.appendChild(child);\r\n    }\r\n\r\n    /*\r\n    if (child._ctx) {\r\n      child._init();\r\n    }//*/\r\n\r\n    if (child.onadd)\r\n      child.onadd();\r\n\r\n    return child;\r\n  }\r\n\r\n  //TODO: make sure this works on Electron?\r\n  dynamicMenu(title, list, packflag = 0) {\r\n    //actually, .menu works for now\r\n    return this.menu(title, list, packflag);\r\n  }\r\n\r\n  /**example usage:\r\n\r\n   .menu([\r\n   \"some_tool_path.tool()|CustomLabel\",\r\n   ui_widgets.Menu.SEP,\r\n   \"some_tool_path.another_tool()\",\r\n   [\"Name\", () => {console.log(\"do something\")}]\r\n   ])\r\n\r\n   **/\r\n  menu(title, list, packflag = 0) {\r\n    let dbox = UIBase.createElement(\"dropbox-x\");\r\n\r\n    dbox._name = title;\r\n    dbox.setAttribute(\"simple\", true);\r\n    dbox.setAttribute(\"name\", title);\r\n\r\n    if (list instanceof HTMLElement && list.constructor.name === \"Menu\") {\r\n      dbox._build_menu = function () {\r\n        if (this._menu !== undefined && this._menu.parentNode !== undefined) {\r\n          this._menu.remove();\r\n        }\r\n\r\n        this._menu = createMenu(this.ctx, title, list);\r\n        return this._menu;\r\n      }\r\n    } else if (list) {\r\n      dbox.template = list;\r\n    }\r\n\r\n    this._container_inherit(dbox, packflag);\r\n\r\n    this._add(dbox);\r\n    return dbox;\r\n  }\r\n\r\n  toolPanel(path_or_cls, args = {}) {\r\n    let tdef;\r\n    let cls;\r\n\r\n    if (typeof path_or_cls === \"string\") {\r\n      cls = this.ctx.api.parseToolPath(path_or_cls);\r\n    } else {\r\n      cls = path_or_cls;\r\n    }\r\n\r\n    tdef = cls._getFinalToolDef();\r\n\r\n    let packflag = args.packflag || 0;\r\n    let label = args.label || tdef.uiname;\r\n    let createCb = args.createCb || args.create_cb;\r\n    let container = args.container || this.panel(label);\r\n    let defaultsPath = args.defaultsPath || \"toolDefaults\";\r\n\r\n    if (defaultsPath.length > 0 && !defaultsPath.endsWith(\".\")) {\r\n      defaultsPath += \".\";\r\n    }\r\n\r\n    let path = defaultsPath + tdef.toolpath;\r\n\r\n    container.useIcons(false);\r\n\r\n    let inputs = tdef.inputs || {};\r\n    for (let k in inputs) {\r\n      let prop = inputs[k];\r\n\r\n      if (prop.flag & PropFlags.PRIVATE) {\r\n        continue;\r\n      }\r\n\r\n      let apiname = prop.apiname || k;\r\n      let path2 = path + \".\" + apiname;\r\n\r\n      container.prop(path2);\r\n    }\r\n\r\n    container.tool(path_or_cls, packflag, createCb, label);\r\n\r\n    return container;\r\n  }\r\n\r\n  tool(path_or_cls, packflag_or_args = {}, createCb = undefined, label = undefined) {\r\n    let cls;\r\n    let packflag;\r\n\r\n    if (typeof packflag_or_args === \"object\") {\r\n      let args = packflag_or_args;\r\n\r\n      packflag = args.packflag;\r\n      createCb = args.createCb;\r\n      label = args.label;\r\n    } else {\r\n      packflag = packflag_or_args || 0;\r\n    }\r\n\r\n    if (typeof path_or_cls == \"string\") {\r\n      if (path_or_cls.search(/\\|/) >= 0) {\r\n        path_or_cls = path_or_cls.split(\"|\");\r\n\r\n        if (label === undefined && path_or_cls.length > 1) {\r\n          label = path_or_cls[1].trim();\r\n        }\r\n\r\n        path_or_cls = path_or_cls[0].trim();\r\n      }\r\n\r\n      if (this.ctx === undefined) {\r\n        console.warn(\"this.ctx was undefined in tool()\");\r\n        return;\r\n      }\r\n\r\n      cls = this.ctx.api.parseToolPath(path_or_cls);\r\n\r\n      if (cls === undefined) {\r\n        console.warn(\"Unknown tool for toolpath \\\"\" + path_or_cls + \"\\\"\");\r\n        return;\r\n      }\r\n    } else {\r\n      cls = path_or_cls;\r\n    }\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n    let hotkey;\r\n\r\n    if (createCb === undefined) {\r\n      createCb = (cls) => {\r\n        return this.ctx.api.createTool(this.ctx, path_or_cls);\r\n      }\r\n    }\r\n\r\n    let cb = () => {\r\n      console.log(\"tool run\");\r\n\r\n      let toolob = createCb(cls);\r\n      this.ctx.api.execTool(this.ctx, toolob);\r\n    }\r\n\r\n    let def = typeof path_or_cls === \"string\" ? this.ctx.api.getToolDef(path_or_cls) : cls.tooldef();\r\n    let tooltip = def.description === undefined ? def.uiname : def.description;\r\n\r\n    //is there a hotkey hardcoded in the class?\r\n    if (def.hotkey !== undefined) {\r\n      tooltip += \"\\n\\t\" + def.hotkey;\r\n      hotkey = def.hotkey;\r\n    } else { //if not, use getToolPathHotkey api\r\n      let path = path_or_cls;\r\n\r\n      if (typeof path != \"string\") {\r\n        path = def.toolpath;\r\n      }\r\n\r\n      let hotkey = this.ctx.api.getToolPathHotkey(this.ctx, path);\r\n      if (hotkey) {\r\n        tooltip += \"\\n\\tHotkey: \" + hotkey;\r\n      }\r\n    }\r\n\r\n    let ret;\r\n\r\n    if (def.icon !== undefined && (packflag & PackFlags.USE_ICONS)) {\r\n      label = label === undefined ? tooltip : label;\r\n\r\n      ret = this.iconbutton(def.icon, label, cb);\r\n\r\n      ret.iconsheet = iconSheetFromPackFlag(packflag);\r\n      ret.packflag |= packflag;\r\n    } else {\r\n      label = label === undefined ? def.uiname : label;\r\n\r\n      ret = this.button(label, cb);\r\n      ret.description = tooltip;\r\n      ret.packflag |= packflag;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  //supports number types\r\n  textbox(inpath, text, cb = undefined, packflag = 0) {\r\n    let path;\r\n\r\n    if (inpath) {\r\n      path = this._joinPrefix(inpath);\r\n    }\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let ret = UIBase.createElement(\"textbox-x\");\r\n\r\n    if (path !== undefined) {\r\n      ret.setAttribute(\"datapath\", path);\r\n    }\r\n\r\n    ret.ctx = this.ctx;\r\n    ret.parentWidget = this;\r\n    ret._init();\r\n    this._add(ret);\r\n\r\n    ret.setCSS();\r\n    ret.update();\r\n\r\n    ret.packflag |= packflag;\r\n    ret.onchange = cb;\r\n    ret.text = text;\r\n\r\n    return ret;\r\n  }\r\n\r\n  pathlabel(inpath, label = \"\", packflag = 0) {\r\n    let path;\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    if (inpath) {\r\n      path = this._joinPrefix(inpath);\r\n    }\r\n\r\n    let ret = UIBase.createElement(\"label-x\");\r\n\r\n    ret.text = label;\r\n    ret.packflag = packflag;\r\n    ret.setAttribute(\"datapath\", path);\r\n\r\n    this._add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  label(text) {\r\n    let ret = UIBase.createElement(\"label-x\");\r\n    ret.text = text;\r\n\r\n    this._add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * makes a button for a help picker tool\r\n   * to view tooltips on mobile devices\r\n   * */\r\n  helppicker() {\r\n    let ret = this.iconbutton(ui_base.Icons.HELP, \"Help Picker\", () => {\r\n      this.getScreen().hintPickerTool();\r\n    })\r\n\r\n    if (util.isMobile()) {\r\n      //ret.iconsheet = 2;\r\n      //XXX look up in mobile theme properly\r\n    }\r\n\r\n    if (ret.ctx) {\r\n      ret._init();\r\n      ret.setCSS();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  iconbutton(icon, description, cb, thisvar, packflag = 0) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let ret = UIBase.createElement(\"iconbutton-x\")\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    ret.setAttribute(\"icon\", icon);\r\n    ret.description = description;\r\n    ret.icon = icon;\r\n\r\n    ret.iconsheet = iconSheetFromPackFlag(packflag);\r\n\r\n    ret.onclick = cb;\r\n\r\n    this._add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  button(label, cb, thisvar, id, packflag = 0) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let ret = UIBase.createElement(\"button-x\")\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    ret.setAttribute(\"name\", label);\r\n    ret.setAttribute(\"buttonid\", id); //XXX no longer used?\r\n    ret.onclick = cb;\r\n\r\n    this._add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  _joinPrefix(path, prefix = this.dataPrefix.trim()) {\r\n    if (path === undefined) {\r\n      return undefined;\r\n    }\r\n\r\n    path = path.trim();\r\n    if (path[0] === \"/\") {\r\n      return path;\r\n    }\r\n\r\n    if (prefix.length > 0 && path.length > 0 && !prefix.endsWith(\".\") && !path.startsWith(\".\")) {\r\n      path = \".\" + path;\r\n    }\r\n\r\n    return prefix + path;\r\n  }\r\n\r\n  colorbutton(inpath, packflag, mass_set_path = undefined) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    let ret = UIBase.createElement(\"color-picker-button-x\");\r\n\r\n    if (inpath !== undefined) {\r\n      inpath = this._joinPrefix(inpath);\r\n      ret.setAttribute(\"datapath\", inpath);\r\n    }\r\n\r\n    if (mass_set_path !== undefined) {\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n    }\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  noteframe(packflag = 0) {\r\n    let ret = UIBase.createElement(\"noteframe-x\");\r\n\r\n    ret.packflag |= (this.inherit_packflag & ~PackFlags.NO_UPDATE) | packflag;\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  curve1d(inpath, packflag = 0, mass_set_path = undefined) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    let ret = UIBase.createElement(\"curve-widget-x\");\r\n\r\n    ret.ctx = this.ctx;\r\n    ret.packflag |= packflag;\r\n\r\n    if (inpath) {\r\n      inpath = this._joinPrefix(inpath);\r\n      ret.setAttribute(\"datapath\", inpath);\r\n    }\r\n\r\n    if (mass_set_path)\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n\r\n    this.add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  vecpopup(inpath, packflag = 0, mass_set_path = undefined) {\r\n    let button = UIBase.createElement(\"vector-popup-button-x\");\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n    let name = \"vector\";\r\n\r\n    if (inpath) {\r\n      inpath = this._joinPrefix(inpath);\r\n\r\n      button.setAttribute(\"datapath\", inpath);\r\n      if (mass_set_path) {\r\n        button.setAttribute(\"mass_set_path\", mass_set_path);\r\n      }\r\n\r\n      let rdef = this.ctx.api.resolvePath(this.ctx, inpath);\r\n      if (rdef && rdef.prop) {\r\n        name = rdef.prop.uiname || rdef.prop.name;\r\n      }\r\n    }\r\n\r\n    button.setAttribute(\"name\", name);\r\n    button.packflag |= packflag;\r\n\r\n    this.add(button);\r\n    return button;\r\n  }\r\n\r\n  _getMassPath(ctx, inpath, mass_set_path) {\r\n    if (mass_set_path === undefined && this.massSetPrefix.length > 0) {\r\n      mass_set_path = ctx.api.getPropName(ctx, inpath);\r\n    }\r\n\r\n    if (mass_set_path === undefined) {\r\n      return undefined;\r\n    }\r\n\r\n    return this._joinPrefix(mass_set_path, this.massSetPrefix);\r\n  }\r\n\r\n  prop(inpath, packflag = 0, mass_set_path = undefined) {\r\n    if (!this.ctx) {\r\n      console.warn(this.id + \".ctx was undefined\");\r\n      let p = this.parentWidget;\r\n\r\n      while (p) {\r\n        if (p.ctx) {\r\n          console.warn(\"Fetched this.ctx from parent\");\r\n          this.ctx = p.ctx;\r\n          break;\r\n        }\r\n\r\n        p = p.parentWidget;\r\n      }\r\n\r\n      if (!this.ctx) {\r\n        throw new Error(\"ui.Container.prototype.prop(): this.ctx was undefined\");\r\n      }\r\n    }\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let rdef = this.ctx.api.resolvePath(this.ctx, this._joinPrefix(inpath), true);\r\n\r\n    if (rdef === undefined || rdef.prop === undefined) {\r\n      console.warn(\"Unknown property at path\", this._joinPrefix(inpath), this.ctx.api.resolvePath(this.ctx, this._joinPrefix(inpath), true));\r\n      return;\r\n    }\r\n    //slider(path, name, defaultval, min, max, step, is_int, do_redraw, callback, packflag=0) {\r\n    let prop = rdef.prop;\r\n\r\n    let useDataPathUndo = !(prop.flag & PropFlags.NO_UNDO);\r\n\r\n    //console.log(prop, PropTypes, PropSubTypes);\r\n\r\n    function makeUIName(name) {\r\n      if (typeof name === \"number\" && isNaN(name)) {\r\n        console.warn(\"Subkey error in data api\", inpath);\r\n        return \"\" + name;\r\n      }\r\n\r\n      name = \"\" + name;\r\n      name = name[0].toUpperCase() + name.slice(1, name.length).toLowerCase();\r\n      name = name.replace(/_/g, \" \");\r\n      return name;\r\n    }\r\n\r\n    if (prop.type === PropTypes.REPORT) {\r\n      return this.pathlabel(inpath, prop.uiname);\r\n    } else if (prop.type === PropTypes.STRING) {\r\n      let ret;\r\n\r\n      if (prop.flag & PropFlags.READ_ONLY) {\r\n        ret = this.pathlabel(inpath, prop.uiname);\r\n      } else if (prop.multiLine) {\r\n        ret = this.textarea(inpath, rdef.value, packflag, mass_set_path);\r\n        ret.useDataPathUndo = useDataPathUndo;\r\n      } else {\r\n        let strip = this.strip();\r\n\r\n        let uiname = prop.uiname !== undefined ? prop.uiname : ToolProperty.makeUIName(prop.apiname);\r\n\r\n        strip.label(prop.uiname);\r\n\r\n        ret = strip.textbox(inpath);\r\n        ret.useDataPathUndo = useDataPathUndo;\r\n\r\n        if (mass_set_path) {\r\n          ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n        }\r\n      }\r\n\r\n      ret.packflag |= packflag;\r\n      return ret;\r\n    } else if (prop.type === PropTypes.CURVE) {\r\n      let ret = this.curve1d(inpath, packflag, mass_set_path);\r\n      ret.useDataPathUndo = useDataPathUndo;\r\n      return ret;\r\n    } else if (prop.type === PropTypes.INT || prop.type === PropTypes.FLOAT) {\r\n      let ret;\r\n      if (packflag & PackFlags.SIMPLE_NUMSLIDERS) {\r\n        ret = this.simpleslider(inpath, {packflag: packflag});\r\n      } else {\r\n        ret = this.slider(inpath, {packflag: packflag});\r\n      }\r\n\r\n      ret.useDataPathUndo = useDataPathUndo;\r\n      ret.packflag |= packflag;\r\n\r\n      if (mass_set_path) {\r\n        ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n      }\r\n\r\n      return ret;\r\n    } else if (prop.type === PropTypes.BOOL) {\r\n      let ret = this.check(inpath, prop.uiname, packflag, mass_set_path);\r\n      ret.useDataPathUndo = useDataPathUndo;\r\n      return ret;\r\n    } else if (prop.type === PropTypes.ENUM) {\r\n      if (rdef.subkey !== undefined) {\r\n        let subkey = rdef.subkey;\r\n        let name = rdef.prop.ui_value_names[rdef.subkey];\r\n\r\n        if (name === undefined) {\r\n          name = makeUIName(rdef.subkey);\r\n        }\r\n\r\n        let check = this.check(inpath, name, packflag, mass_set_path);\r\n        let tooltip = rdef.prop.descriptions[subkey];\r\n\r\n        check.useDataPathUndo = useDataPathUndo;\r\n\r\n        check.description = tooltip === undefined ? rdef.prop.ui_value_names[subkey] : tooltip;\r\n        check.icon = rdef.prop.iconmap[rdef.subkey];\r\n\r\n        return check;\r\n      }\r\n\r\n      if (!(packflag & PackFlags.USE_ICONS) && !(prop.flag & (PropFlags.USE_ICONS | PropFlags.FORCE_ENUM_CHECKBOXES))) {\r\n        if (packflag & PackFlags.FORCE_PROP_LABELS) {\r\n          let strip = this.strip();\r\n          strip.label(prop.uiname);\r\n\r\n          return strip.listenum(inpath, {packflag, mass_set_path}).setUndo(useDataPathUndo);\r\n        } else {\r\n          return this.listenum(inpath, {packflag, mass_set_path}).setUndo(useDataPathUndo);\r\n        }\r\n\r\n      } else {\r\n        if (prop.flag & PropFlags.USE_ICONS) {\r\n          packflag |= PackFlags.USE_ICONS;\r\n        } else if (prop.flag & PropFlags.FORCE_ENUM_CHECKBOXES) {\r\n          packflag &= ~PackFlags.USE_ICONS;\r\n        }\r\n\r\n        if (packflag & PackFlags.FORCE_PROP_LABELS) {\r\n          let strip = this.strip();\r\n          strip.label(prop.uiname);\r\n\r\n          return strip.checkenum(inpath, undefined, packflag).setUndo(useDataPathUndo);\r\n        } else {\r\n          return this.checkenum(inpath, undefined, packflag).setUndo(useDataPathUndo);\r\n        }\r\n      }\r\n    } else if (prop.type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4)) {\r\n      if (rdef.subkey !== undefined) {\r\n        let ret;\r\n\r\n        if (packflag & PackFlags.SIMPLE_NUMSLIDERS)\r\n          ret = this.simpleslider(inpath, {packflag: packflag});\r\n        else\r\n          ret = this.slider(inpath, {packflag: packflag});\r\n\r\n        ret.packflag |= packflag;\r\n        return ret.setUndo(useDataPathUndo);\r\n      } else if (prop.subtype === PropSubTypes.COLOR) {\r\n        return this.colorbutton(inpath, packflag, mass_set_path).setUndo(useDataPathUndo);\r\n        //return this.colorPicker(inpath, packflag, mass_set_path);\r\n      } else {\r\n        let ret = UIBase.createElement(\"vector-panel-x\");\r\n\r\n        mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n        ret.packflag |= packflag | (this.inherit_packflag & ~PackFlags.NO_UPDATE);\r\n        ret.inherit_packflag |= packflag | (this.inherit_packflag & ~PackFlags.NO_UPDATE);\r\n\r\n        if (inpath) {\r\n          ret.setAttribute(\"datapath\", this._joinPrefix(inpath));\r\n        }\r\n\r\n        if (mass_set_path) {\r\n          ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n        }\r\n\r\n        this.add(ret);\r\n\r\n        return ret.setUndo(useDataPathUndo);\r\n      }\r\n    } else if (prop.type === PropTypes.FLAG) {\r\n      if (rdef.subkey !== undefined) {\r\n        let tooltip = rdef.prop.descriptions[rdef.subkey];\r\n        let name = rdef.prop.ui_value_names[rdef.subkey];\r\n\r\n        if (typeof rdef.subkey === \"number\") {\r\n          name = rdef.prop.keys[rdef.subkey];\r\n          if (name && name in rdef.prop.ui_value_names) {\r\n            name = rdef.prop.ui_value_names[name];\r\n          } else {\r\n            name = makeUIName(name ? name : \"(error)\");\r\n          }\r\n        }\r\n\r\n        if (name === undefined) {\r\n          name = \"(error)\";\r\n        }\r\n\r\n        let ret = this.check(inpath, name, packflag, mass_set_path);\r\n\r\n        ret.icon = rdef.prop.iconmap[rdef.subkey];\r\n\r\n        if (tooltip) {\r\n          ret.description = tooltip;\r\n        }\r\n\r\n        return ret.setUndo(useDataPathUndo);\r\n      } else {\r\n        let con = this;\r\n\r\n        if (packflag & PackFlags.FORCE_PROP_LABELS) {\r\n          con = this.strip();\r\n          con.label(prop.uiname);\r\n        }\r\n\r\n        if (packflag & PackFlags.PUT_FLAG_CHECKS_IN_COLUMNS) {\r\n          let i = 0;\r\n          let row = con.row();\r\n          let col1 = row.col();\r\n          let col2 = row.col();\r\n\r\n          for (let k in prop.values) {\r\n            let name = prop.ui_value_names[k];\r\n            let tooltip = prop.descriptions[k];\r\n\r\n            if (name === undefined) {\r\n              name = makeUIName(k);\r\n            }\r\n\r\n            let con2 = i & 1 ? col1 : col2;\r\n            let check = con2.check(`${inpath}[${k}]`, name, packflag, mass_set_path);\r\n\r\n            if (tooltip) {\r\n              check.description = tooltip;\r\n            }\r\n\r\n            check.setUndo(useDataPathUndo);\r\n\r\n            i++;\r\n          }\r\n\r\n          return row;\r\n        }\r\n\r\n        if (packflag & PackFlags.WRAP_CHECKBOXES) {\r\n          let isrow = this.style[\"flex-direction\"] === \"row\";\r\n          isrow = isrow || this.style[\"flex-direction\"] === \"row-reverse\";\r\n\r\n          let wrapChars;\r\n\r\n          let strip, con;\r\n\r\n          if (isrow) {\r\n            wrapChars = this.getDefault(\"checkRowWrapLimit\", undefined, 24);\r\n            strip = this.col().strip();\r\n            strip.packflag |= packflag;\r\n            strip.inherit_packflag |= packflag;\r\n\r\n            con = strip.row();\r\n          } else {\r\n            wrapChars = this.getDefault(\"checkColWrapLimit\", undefined, 5);\r\n            strip = this.row().strip();\r\n            strip.packflag |= packflag;\r\n            strip.inherit_packflag |= packflag;\r\n\r\n            con = strip.col();\r\n          }\r\n\r\n          let x = 0;\r\n          let y = 0;\r\n\r\n          for (let k in prop.values) {\r\n            let name = prop.ui_value_names[k];\r\n            let tooltip = prop.descriptions[k];\r\n\r\n            if (name === undefined) {\r\n              name = makeUIName(k);\r\n            }\r\n\r\n            let check = con.check(`${inpath}[${k}]`, name, packflag, mass_set_path);\r\n\r\n            if (tooltip) {\r\n              check.description = tooltip;\r\n            }\r\n\r\n            x += name.length;\r\n            y += 1;\r\n\r\n            if (isrow && x > wrapChars) {\r\n              x = 0;\r\n              con = strip.row();\r\n            } else if (!isrow && y > wrapChars) {\r\n              y = 0;\r\n              con = strip.col();\r\n            }\r\n          }\r\n\r\n          return strip;\r\n        }\r\n\r\n        if (con === this) {\r\n          con = this.strip();\r\n        }\r\n\r\n        let rebuild = () => {\r\n          con.clear();\r\n\r\n          for (let k in prop.values) {\r\n            let name = prop.ui_value_names[k];\r\n            let tooltip = prop.descriptions[k];\r\n\r\n            if (name === undefined) {\r\n              name = makeUIName(k);\r\n            }\r\n\r\n            let check = con.check(`${inpath}[${k}]`, name, packflag, mass_set_path);\r\n            check.useDataPathUndo = useDataPathUndo;\r\n\r\n            if (tooltip) {\r\n              check.description = tooltip;\r\n            }\r\n\r\n            check.setUndo(useDataPathUndo);\r\n          }\r\n        }\r\n\r\n        rebuild();\r\n        let last_hash = prop.calcHash();\r\n\r\n        con.update.after(() => {\r\n          let hash = prop.calcHash();\r\n\r\n          if (last_hash !== hash) {\r\n            last_hash = hash;\r\n            console.error(\"Property definition update\");\r\n            rebuild();\r\n          }\r\n        });\r\n\r\n        return con;\r\n      }\r\n    }\r\n  }\r\n\r\n  iconcheck(inpath, icon, name, mass_set_path) {\r\n    let ret = UIBase.createElement(\"iconcheck-x\");\r\n    ret.icon = icon;\r\n    ret.description = name;\r\n\r\n    if (inpath) {\r\n      ret.setAttribute(\"datapath\", inpath);\r\n    }\r\n\r\n    if (mass_set_path) {\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n    }\r\n\r\n    this.add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  check(inpath, name, packflag = 0, mass_set_path = undefined) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let path = inpath !== undefined ? this._joinPrefix(inpath) : undefined;\r\n\r\n    //let prop = this.ctx.getProp(path);\r\n    let ret;\r\n    if (packflag & PackFlags.USE_ICONS) {\r\n      ret = UIBase.createElement(\"iconcheck-x\");\r\n\r\n      ret.iconsheet = iconSheetFromPackFlag(packflag);\r\n    } else {\r\n      ret = UIBase.createElement(\"check-x\");\r\n    }\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    ret.packflag |= packflag;\r\n    ret.label = name;\r\n    ret.noMarginsOrPadding();\r\n\r\n    if (inpath) {\r\n      ret.setAttribute(\"datapath\", path);\r\n    }\r\n\r\n    if (mass_set_path) {\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n    }\r\n\r\n    this._add(ret);\r\n\r\n    //ret.update();\r\n\r\n    return ret;\r\n  }\r\n\r\n  /*\r\n  *\r\n  * new (optional) form: checkenum(inpath, args)\r\n  * */\r\n  checkenum(inpath, name, packflag, enummap, defaultval, callback, iconmap, mass_set_path) {\r\n    if (typeof name === \"object\" && name !== null) {\r\n      let args = name;\r\n\r\n      name = args.name;\r\n      packflag = args.packflag;\r\n      enummap = args.enummap;\r\n      defaultval = args.defaultval;\r\n      callback = args.callback;\r\n      iconmap = args.iconmap;\r\n      mass_set_path = args.mass_set_path;\r\n    }\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    packflag = packflag === undefined ? 0 : packflag;\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let path = this._joinPrefix(inpath);\r\n\r\n    let has_path = path !== undefined;\r\n    let prop;\r\n    let frame;\r\n\r\n    if (path !== undefined) {\r\n      prop = this.ctx.api.resolvePath(this.ctx, path, true);\r\n\r\n      if (prop !== undefined)\r\n        prop = prop.prop;\r\n    }\r\n\r\n    if (path !== undefined) {\r\n      if (prop === undefined) {\r\n        console.warn(\"Bad path in checkenum\", path);\r\n        return;\r\n      }\r\n\r\n      frame = this.strip();\r\n      frame.oneAxisPadding();\r\n\r\n      if (packflag & PackFlags.USE_ICONS) {\r\n        for (let key in prop.values) {\r\n          let check = frame.check(inpath + \"[\" + key + \"]\", \"\", packflag);\r\n\r\n          check.packflag |= PackFlags.HIDE_CHECK_MARKS;\r\n\r\n          check.icon = prop.iconmap[key];\r\n          check.drawCheck = false;\r\n\r\n          check.style[\"padding\"] = \"0px\";\r\n          check.style[\"margin\"] = \"0px\";\r\n\r\n          check.dom.style[\"padding\"] = \"0px\";\r\n          check.dom.style[\"margin\"] = \"0px\";\r\n\r\n          check.description = prop.descriptions[key];\r\n          //console.log(check.description, key, prop.keys[key], prop.descriptions, prop.keys);\r\n        }\r\n      } else {\r\n        if (name === undefined) {\r\n          name = prop.uiname;\r\n        }\r\n\r\n        frame.label(name).font = \"TitleText\";\r\n\r\n        let checks = {};\r\n\r\n        let ignorecb = false;\r\n\r\n        function makecb(key) {\r\n          return () => {\r\n            if (ignorecb) return;\r\n\r\n            ignorecb = true;\r\n            for (let k in checks) {\r\n              if (k !== key) {\r\n                checks[k].checked = false;\r\n              }\r\n            }\r\n            ignorecb = false;\r\n\r\n            if (callback) {\r\n              callback(key);\r\n            }\r\n          }\r\n        }\r\n\r\n        for (let key in prop.values) {\r\n          let check = frame.check(inpath + \" = \" + prop.values[key], prop.ui_value_names[key]);\r\n          checks[key] = check;\r\n\r\n          if (mass_set_path) {\r\n            check.setAttribute(\"mass_set_path\", mass_set_path);\r\n          }\r\n\r\n\r\n          check.description = prop.descriptions[prop.keys[key]];\r\n          if (!check.description) {\r\n            check.description = \"\" + prop.ui_value_names[key];\r\n          }\r\n          check.onchange = makecb(key);\r\n          //console.log(\"PATH\", path);\r\n        }\r\n      }\r\n    }\r\n\r\n    return frame;\r\n  }\r\n\r\n  checkenum_panel(inpath, name, packflag = 0, callback = undefined, mass_set_path = undefined, prop = undefined) {\r\n    packflag = packflag === undefined ? 0 : packflag;\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let path = this._joinPrefix(inpath);\r\n    let frame;\r\n\r\n    let has_path = path !== undefined;\r\n\r\n    if (path !== undefined && prop === undefined) {\r\n      prop = this.ctx.api.resolvePath(this.ctx, path, true);\r\n\r\n      if (prop !== undefined)\r\n        prop = prop.prop;\r\n    }\r\n\r\n    if (!name && prop) {\r\n      name = prop.uiname;\r\n    }\r\n\r\n    if (path !== undefined) {\r\n      if (prop === undefined) {\r\n        console.warn(\"Bad path in checkenum\", path);\r\n        return;\r\n      }\r\n\r\n      frame = this.panel(name, name, packflag);\r\n\r\n      frame.oneAxisPadding();\r\n      frame.setCSS.after(frame.background = this.getDefault(\"BoxSub2BG\"));\r\n\r\n      if (packflag & PackFlags.USE_ICONS) {\r\n        for (let key in prop.values) {\r\n          let check = frame.check(inpath + \" == \" + prop.values[key], \"\", packflag);\r\n\r\n          check.icon = prop.iconmap[key];\r\n          check.drawCheck = false;\r\n\r\n          check.style[\"padding\"] = \"0px\";\r\n          check.style[\"margin\"] = \"0px\";\r\n\r\n          check.dom.style[\"padding\"] = \"0px\";\r\n          check.dom.style[\"margin\"] = \"0px\";\r\n\r\n          check.description = prop.descriptions[key];\r\n          //console.log(check.description, key, prop.keys[key], prop.descriptions, prop.keys);\r\n        }\r\n      } else {\r\n        if (name === undefined) {\r\n          name = prop.uiname;\r\n        }\r\n\r\n        frame.label(name).font = \"TitleText\";\r\n\r\n        let checks = {};\r\n\r\n        let ignorecb = false;\r\n\r\n        function makecb(key) {\r\n          return () => {\r\n            if (ignorecb) return;\r\n\r\n            ignorecb = true;\r\n            for (let k in checks) {\r\n              if (k !== key) {\r\n                checks[k].checked = false;\r\n              }\r\n            }\r\n            ignorecb = false;\r\n\r\n            if (callback) {\r\n              callback(key);\r\n            }\r\n          }\r\n        }\r\n\r\n        for (let key in prop.values) {\r\n          let check = frame.check(inpath + \" = \" + prop.values[key], prop.ui_value_names[key]);\r\n          checks[key] = check;\r\n\r\n          if (mass_set_path) {\r\n            check.setAttribute(\"mass_set_path\", mass_set_path);\r\n          }\r\n\r\n\r\n          check.description = prop.descriptions[prop.keys[key]];\r\n          if (!check.description) {\r\n            check.description = \"\" + prop.ui_value_names[key];\r\n          }\r\n          check.onchange = makecb(key);\r\n          //console.log(\"PATH\", path);\r\n        }\r\n      }\r\n    }\r\n\r\n    return frame;\r\n  }\r\n\r\n  /*\r\n    enummap is an object that maps\r\n    ui names to keys, e.g.:\r\n\r\n    ui.listenum(\"color\", \"Color\", {\r\n      RED   : 0,\r\n      GREEN : 1,\r\n      BLUE  : 2\r\n    });\r\n\r\n    path can be undefined, in which case, use callback,\r\n    which gets the current enum as an argument\r\n\r\n    defaultval cannot be undefined\r\n  */\r\n  listenum(inpath, name, enumDef, defaultval, callback, iconmap, packflag = 0) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n    let mass_set_path;\r\n\r\n    if (name && typeof name === \"object\") {\r\n      let args = name;\r\n\r\n      name = args.name;\r\n      enumDef = args.enumDef;\r\n      defaultval = args.defaultval;\r\n      callback = args.callback;\r\n      iconmap = args.iconmap;\r\n      packflag = args.packflag || 0;\r\n      mass_set_path = args.mass_set_path;\r\n    }\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    let path;\r\n\r\n    if (inpath !== undefined) {\r\n      path = this._joinPrefix(inpath);\r\n    }\r\n\r\n    let ret = UIBase.createElement(\"dropbox-x\")\r\n    if (enumDef !== undefined) {\r\n      if (enumDef instanceof toolprop.EnumProperty) {\r\n        ret.prop = enumDef;\r\n      } else {\r\n        ret.prop = new toolprop.EnumProperty(defaultval, enumDef, path, name);\r\n      }\r\n\r\n      if (iconmap !== undefined) {\r\n        ret.prop.addIcons(iconmap)\r\n      }\r\n    } else {\r\n      let res = this.ctx.api.resolvePath(this.ctx, path, true);\r\n\r\n      if (res !== undefined) {\r\n        ret.prop = res.prop;\r\n\r\n        name = name === undefined ? res.prop.uiname : name;\r\n      }\r\n    }\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    if (path !== undefined) {\r\n      ret.setAttribute(\"datapath\", path);\r\n    }\r\n    if (mass_set_path !== undefined) {\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n    }\r\n\r\n    ret.setAttribute(\"name\", name);\r\n\r\n    if (defaultval) {\r\n      ret.setValue(defaultval);\r\n    }\r\n\r\n    ret.onchange = callback;\r\n    ret.onselect = callback;\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  getroot() {\r\n    let p = this;\r\n\r\n    while (p.parent !== undefined) {\r\n      p = p.parent;\r\n    }\r\n\r\n    return p;\r\n  }\r\n\r\n  simpleslider(inpath, name, defaultval, min, max, step, is_int, do_redraw, callback, packflag = 0) {\r\n    if (arguments.length === 2 || typeof name === \"object\") {\r\n      let args = Object.assign({}, name);\r\n\r\n      args.packflag = (args.packflag || 0) | PackFlags.SIMPLE_NUMSLIDERS;\r\n      return this.slider(inpath, args);\r\n      //new-style api call\r\n    } else {\r\n      return this.slider(inpath, name, defaultval, min, max, step, is_int, do_redraw, callback, packflag | PackFlags.SIMPLE_NUMSLIDERS);\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * usage: .slider(inpath, {\r\n   *  name : bleh,\r\n   *  defaultval : number,\r\n   *  etc...\r\n   * });\r\n   * */\r\n  slider(inpath, name, defaultval, min, max, step, is_int, do_redraw, callback, packflag = 0) {\r\n    if (arguments.length === 2 || typeof name === \"object\") {\r\n      //new-style api call\r\n\r\n      let args = name;\r\n\r\n      name = args.name;\r\n      defaultval = args.defaultval;\r\n      min = args.min;\r\n      max = args.max;\r\n      step = args.step;\r\n      is_int = args.is_int || args.isInt;\r\n      do_redraw = args.do_redraw;\r\n      callback = args.callback;\r\n      packflag = args.packflag || 0;\r\n    }\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n    let ret;\r\n\r\n    if (inpath) {\r\n      inpath = this._joinPrefix(inpath);\r\n\r\n      let rdef = this.ctx.api.resolvePath(this.ctx, inpath, true);\r\n      if (rdef && rdef.prop && (rdef.prop.flag & PropFlags.SIMPLE_SLIDER)) {\r\n        packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n      }\r\n      if (rdef && rdef.prop && (rdef.prop.flag & PropFlags.FORCE_ROLLER_SLIDER)) {\r\n        packflag |= PackFlags.FORCE_ROLLER_SLIDER;\r\n      }\r\n    }\r\n\r\n    let simple = (packflag & PackFlags.SIMPLE_NUMSLIDERS) || cconst.simpleNumSliders;\r\n    simple = simple && !(packflag & PackFlags.FORCE_ROLLER_SLIDER);\r\n\r\n    let extraTextBox = cconst.useNumSliderTextboxes && !(packflag & PackFlags.NO_NUMSLIDER_TEXTBOX);\r\n\r\n    if (extraTextBox) {\r\n      if (simple) {\r\n        ret = UIBase.createElement(\"numslider-simple-x\");\r\n      } else {\r\n        ret = UIBase.createElement(\"numslider-textbox-x\");\r\n      }\r\n    } else {\r\n      if (simple) {\r\n        ret = UIBase.createElement(\"numslider-simple-x\");\r\n      } else {\r\n        ret = UIBase.createElement(\"numslider-x\");\r\n      }\r\n    }\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    let decimals;\r\n\r\n    if (inpath) {\r\n      ret.setAttribute(\"datapath\", inpath);\r\n    }\r\n\r\n    if (name) {\r\n      ret.setAttribute(\"name\", name);\r\n    }\r\n\r\n    if (min !== undefined) {\r\n      ret.setAttribute(\"min\", min);\r\n    }\r\n    if (max !== undefined) {\r\n      ret.setAttribute(\"max\", max);\r\n    }\r\n\r\n    if (defaultval !== undefined) {\r\n      ret.setValue(defaultval);\r\n    }\r\n\r\n    if (is_int) {\r\n      ret.setAttribute(\"integer\", is_int);\r\n    }\r\n\r\n    if (decimals !== undefined) {\r\n      ret.decimalPlaces = decimals;\r\n    }\r\n\r\n    if (callback) {\r\n      ret.onchange = callback;\r\n    }\r\n\r\n    this._add(ret);\r\n\r\n    if (this.ctx) {\r\n      ret.setCSS();\r\n      ret.update();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  _container_inherit(elem, packflag = 0) {\r\n    //don't inherit NO_UPDATE\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    elem.packflag |= packflag;\r\n    elem.inherit_packflag |= packflag;\r\n    elem.dataPrefix = this.dataPrefix;\r\n    elem.massSetPrefix = this.massSetPrefix;\r\n  }\r\n\r\n  treeview() {\r\n    let ret = UIBase.createElement(\"tree-view-x\");\r\n    ret.ctx = this.ctx;\r\n    this.add(ret);\r\n\r\n    this._container_inherit(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  panel(name, id, packflag = 0, tooltip = undefined) {\r\n    id = id === undefined ? name : id;\r\n\r\n    let ret = UIBase.createElement(\"panelframe-x\");\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    if (tooltip) {\r\n      ret.setHeaderToolTip(tooltip);\r\n    }\r\n\r\n    ret.setAttribute(\"label\", name);\r\n    ret.setAttribute(\"id\", id);\r\n\r\n    this._add(ret);\r\n\r\n\r\n    if (this.ctx) {//check init was called\r\n      ret.ctx = this.ctx;\r\n      ret._init();\r\n      //ret.headerLabel = name;\r\n\r\n      ret.contents.ctx = ret.ctx;\r\n    }\r\n\r\n    ret.contents.dataPrefix = this.dataPrefix;\r\n    ret.contents.massSetPrefix = this.massSetPrefix;\r\n\r\n    return ret;\r\n  }\r\n\r\n  row(packflag = 0) {\r\n    let ret = UIBase.createElement(\"rowframe-x\");\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n\r\n    ret.ctx = this.ctx;\r\n\r\n    return ret;\r\n  }\r\n\r\n  listbox(packflag = 0) {\r\n    let ret = UIBase.createElement(\"listbox-x\");\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  table(packflag = 0) {\r\n    let ret = UIBase.createElement(\"tableframe-x\");\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  twocol(parentDepth = 1, packflag = 0) {\r\n    let ret = UIBase.createElement(\"two-column-x\");\r\n\r\n    ret.parentDepth = parentDepth;\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  col(packflag = 0) {\r\n    let ret = UIBase.createElement(\"colframe-x\");\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  colorPicker(inpath, packflag_or_args = 0, mass_set_path = undefined, themeOverride = undefined) {\r\n    let packflag;\r\n\r\n    if (typeof packflag_or_args === \"object\") {\r\n      let args = packflag_or_args;\r\n\r\n      packflag = args.packflag !== undefined ? args.packflag : 0;\r\n      mass_set_path = args.massSetPath;\r\n      themeOverride = args.themeOverride;\r\n    }\r\n\r\n    let path;\r\n\r\n    if (inpath) {\r\n      path = this._joinPrefix(inpath);\r\n    }\r\n\r\n    let ret = UIBase.createElement(\"colorpicker-x\");\r\n\r\n    if (themeOverride) {\r\n      ret.overrideClass(themeOverride);\r\n    }\r\n\r\n    packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    ret.ctx = this.ctx;\r\n    ret.parentWidget = this;\r\n    ret._init();\r\n    ret.packflag |= packflag;\r\n    ret.inherit_packflag |= packflag;\r\n    ret.constructor.setDefault(ret);\r\n\r\n    if (path !== undefined) {\r\n      ret.setAttribute(\"datapath\", path);\r\n    }\r\n\r\n    console.warn(\"mass_set_path\", mass_set_path);\r\n    if (mass_set_path) {\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n    }\r\n\r\n    //XXX\r\n    window.colorpicker = ret;\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  textarea(datapath = undefined, value = \"\", packflag = 0, mass_set_path = undefined) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, datapath, mass_set_path);\r\n\r\n    let ret = UIBase.createElement(\"rich-text-editor-x\");\r\n    ret.ctx = this.ctx;\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    if (value !== undefined) {\r\n      ret.value = value;\r\n    }\r\n\r\n    if (datapath)\r\n      ret.setAttribute(\"datapath\", datapath)\r\n    if (mass_set_path)\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path)\r\n\r\n    this.add(ret);\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   * html5 viewer\r\n   * */\r\n  viewer(datapath = undefined, value = \"\", packflag = 0, mass_set_path = undefined) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, datapath, mass_set_path);\r\n\r\n    let ret = UIBase.createElement(\"html-viewer-x\");\r\n    ret.ctx = this.ctx;\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    if (value !== undefined) {\r\n      ret.value = value;\r\n    }\r\n\r\n    if (datapath)\r\n      ret.setAttribute(\"datapath\", datapath)\r\n    if (mass_set_path)\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path)\r\n\r\n    this.add(ret);\r\n    return ret;\r\n  }\r\n\r\n  //\r\n  tabs(position = \"top\", packflag = 0) {\r\n\r\n    let ret = UIBase.createElement(\"tabcontainer-x\");\r\n\r\n    ret.constructor.setDefault(ret);\r\n    ret.setAttribute(\"bar_pos\", position);\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  asDialogFooter() {\r\n    this.style['margin-top'] = '15px';\r\n    this.style['justify-content'] = 'flex-end';\r\n\r\n    return this;\r\n  }\r\n\r\n};\r\n\r\nui_base.UIBase.internalRegister(Container, \"div\");\r\n\r\n\r\nexport class RowFrame extends Container {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: 'rowframe-x'\r\n    };\r\n  }\r\n\r\n  //try to set styling as early as possible\r\n  connectedCallback() {\r\n    super.connectedCallback();\r\n\r\n    this.style['display'] = 'flex';\r\n    this.style['flex-direction'] = this.reversed ? 'row-reverse' : 'row';\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style['display'] = 'flex';\r\n    this.style['flex-direction'] = this.reversed ? 'row-reverse' : 'row';\r\n\r\n    if (!this.style['align-items'] || this.style['align-items'] == '') {\r\n      this.style['align-items'] = 'center';\r\n    }\r\n\r\n    if (this.getDefault(\"slider-style\") === \"simple\") {\r\n      this.packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n      this.inherit_packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n    }\r\n  }\r\n\r\n  oneAxisMargin(m = this.getDefault('oneAxisMargin'), m2 = 0) {\r\n    this.style['margin-left'] = this.style['margin-right'] = m + 'px';\r\n    this.style['margin-top'] = this.style['margin-bottom'] = '' + m2 + 'px';\r\n\r\n    return this;\r\n  }\r\n\r\n  oneAxisPadding(m = this.getDefault('oneAxisPadding'), m2 = 0) {\r\n    this.style['padding-left'] = this.style['padding-right'] = '' + m + 'px';\r\n    this.style['padding-top'] = this.style['padding-bottom'] = '' + m2 + 'px';\r\n\r\n    return this;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(RowFrame);\r\n\r\nexport class ColumnFrame extends Container {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"colframe-x\"\r\n    };\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-direction\"] = \"column\";\r\n    this.style[\"justify-content\"] = \"right\";\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  oneAxisMargin(m = this.getDefault('oneAxisMargin'), m2 = 0) {\r\n    this.style['margin-top'] = this.style['margin-bottom'] = '' + m + 'px';\r\n    this.style['margin-left'] = this.style['margin-right'] = m2 + 'px';\r\n\r\n    return this;\r\n  }\r\n\r\n  oneAxisPadding(m = this.getDefault('oneAxisPadding'), m2 = 0) {\r\n    this.style['padding-top'] = this.style['padding-bottom'] = '' + m + 'px';\r\n    this.style['padding-left'] = this.style['padding-right'] = '' + m2 + 'px';\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ColumnFrame);\r\n\r\n\r\nexport class TwoColumnFrame extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this._colWidth = 256;\r\n    this.parentDepth = 1;\r\n  }\r\n\r\n  get colWidth() {\r\n    if (this.hasAttribute(\"colWidth\")) {\r\n      return parsepx(this.getAttribute(\"colWidth\"));\r\n    }\r\n\r\n    return this._colWidth;\r\n  }\r\n\r\n  set colWidth(v) {\r\n    if (this.hasAttribute(\"colWidth\")) {\r\n      this.setAttribute(\"colWidth\", \"\" + v);\r\n    } else {\r\n      this._colWidth = v;\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"two-column-x\"\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-direction\"] = \"column\";\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    let p = this;\r\n\r\n    for (let i = 0; i < this.parentDepth; i++) {\r\n      p = p.parentWidget ? p.parentWidget : p;\r\n    }\r\n\r\n    if (!p) {\r\n      return;\r\n    }\r\n\r\n    let r = p.getBoundingClientRect();\r\n\r\n    if (!r) {\r\n      return;\r\n    }\r\n\r\n    let style = r.width > this.colWidth*2.0 ? 'row' : 'column';\r\n\r\n    if (this.style[\"flex-direction\"] !== style) {\r\n      this.style[\"flex-direction\"] = style;\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(TwoColumnFrame);\r\n","import * as util from '../path-controller/util/util.js';\r\nimport * as ui from '../core/ui.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport {Icons, css2color, color2css} from '../core/ui_base.js';\r\n\r\nlet UIBase = ui_base.UIBase;\r\n\r\nexport class Note extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    let style = document.createElement(\"style\");\r\n\r\n    this._noteid = undefined;\r\n    this.height = 20;\r\n\r\n    this.showExclMark = true;\r\n\r\n    style.textContent = `\r\n    .notex {\r\n      display : flex;\r\n      flex-direction : row;\r\n      flex-wrap : nowrap;\r\n      height : {this.height}px;\r\n      padding : 0px;\r\n      margin : 0px;\r\n    }\r\n    `;\r\n\r\n    this.dom = document.createElement(\"div\");\r\n    this.dom.setAttribute(\"class\", \"notex\");\r\n    this.color = \"red\";\r\n\r\n    this.shadow.appendChild(style);\r\n    this.shadow.append(this.dom);\r\n    this.setLabel(\"\");\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"note-x\",\r\n      style  : 'notification',\r\n    }\r\n  }\r\n\r\n  setLabel(s) {\r\n    let color = this.color;\r\n    if (this.showExclMark && this.mark === undefined) {\r\n      this.mark = document.createElement(\"div\");\r\n      this.mark.style[\"display\"] = \"flex\";\r\n      this.mark.style[\"flex-direction\"] = \"row\";\r\n      this.mark.style[\"flex-wrap\"] = \"nowrap\";\r\n\r\n      //this.mark.style[\"width\"]\r\n      let sheet = 0;\r\n\r\n      let size = ui_base.iconmanager.getTileSize(sheet);\r\n\r\n      this.mark.style[\"width\"] = \"\" + size + \"px\";\r\n      this.mark.style[\"height\"] = \"\" + size + \"px\";\r\n\r\n      this.dom.appendChild(this.mark);\r\n\r\n      this.ntext = document.createElement(\"div\");\r\n      this.ntext.style[\"display\"] = \"inline-flex\";\r\n      this.ntext.style[\"flex-wrap\"] = \"nowrap\";\r\n\r\n      this.dom.appendChild(this.ntext);\r\n\r\n      ui_base.iconmanager.setCSS(Icons.NOTE_EXCL, this.mark, sheet);\r\n\r\n      //this.mark.style[\"margin\"] = this.ntext.style[\"margin\"] = \"0px\"\r\n      //this.mark.style[\"padding\"] = this.ntext.style[\"padding\"] = \"0px\"\r\n      //this.mark.style[\"background-color\"] = color;\r\n    } else if (!this.showExclMark && this.mark) {\r\n      this.mark.remove();\r\n      this.mark = undefined;\r\n    }\r\n\r\n    let ntext = this.ntext;\r\n    //mark.innerText = \"!\";\r\n    ntext.innerText = \" \" + s;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.setAttribute(\"class\", \"notex\");\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-wrap\"] = \"nowrap\";\r\n    this.style[\"flex-direction\"] = \"row\";\r\n    this.style[\"border-radius\"] = \"7px\";\r\n    this.style[\"padding\"] = \"2px\";\r\n\r\n    this.style[\"color\"] = this.getDefault(\"DefaultText\").color;\r\n    let clr = css2color(this.color);\r\n    clr = color2css([clr[0], clr[1], clr[2], 0.25]);\r\n\r\n    this.style[\"background-color\"] = clr;\r\n    this.setCSS();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS(false);\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(Note);\r\n\r\nexport class ProgBarNote extends Note {\r\n  constructor() {\r\n    super();\r\n\r\n    this._percent = 0.0;\r\n    this.barWidth = 100;\r\n\r\n    let bar = this.bar = document.createElement(\"div\");\r\n    bar.style[\"display\"] = \"flex\";\r\n    bar.style[\"flex-direction\"] = \"row\";\r\n    bar.style[\"width\"] = this.barWidth + \"px\";\r\n    bar.style[\"height\"] = this.height + \"px\";\r\n    bar.style[\"background-color\"] = this.getDefault(\"ProgressBarBG\");\r\n    bar.style[\"border-radius\"] = \"12px\";\r\n    bar.style[\"align-items\"] = \"center\";\r\n    bar.style[\"padding\"] = bar.style[\"margin\"] = \"0px\";\r\n\r\n    let bar2 = this.bar2 = document.createElement(\"div\");\r\n    let w = 50.0;\r\n\r\n    bar2.style[\"display\"] = \"flex\";\r\n    bar2.style[\"flex-direction\"] = \"row\";\r\n    bar2.style[\"height\"] = this.height + \"px\";\r\n    bar2.style[\"background-color\"] = this.getDefault(\"ProgressBar\");\r\n    bar2.style[\"border-radius\"] = \"12px\";\r\n    bar2.style[\"align-items\"] = \"center\";\r\n    bar2.style[\"padding\"] = bar2.style[\"margin\"] = \"0px\";\r\n\r\n    this.bar.appendChild(bar2);\r\n    this.dom.appendChild(this.bar);\r\n  }\r\n\r\n  get percent() {\r\n    return this._percent;\r\n  }\r\n\r\n  set percent(val) {\r\n    this._percent = val;\r\n    this.setCSS();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"note-progress-x\",\r\n      style  : 'notification',\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    let w = ~~(this.percent*this.barWidth + 0.5);\r\n\r\n    this.bar2.style[\"width\"] = w + \"px\";\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ProgBarNote);\r\n\r\nexport class NoteFrame extends ui.RowFrame {\r\n  constructor() {\r\n    super();\r\n    this._h = 20;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"noteframe-x\",\r\n      style  : 'noteframe',\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.noMarginsOrPadding();\r\n\r\n    noteframes.push(this);\r\n    this.background = this.getDefault(\"background-color\");\r\n    this.style['flex-grow'] = 'unset';\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.style[\"width\"] = \"min-contents\";\r\n    this.style[\"height\"] = this._h + \"px\";\r\n  }\r\n\r\n  _ondestroy() {\r\n    if (noteframes.indexOf(this) >= 0) {\r\n      noteframes.remove(this)\r\n    }\r\n\r\n    super._ondestroy();\r\n  }\r\n\r\n  progbarNote(msg, percent, color = \"rgba(255,0,0,0.2)\", timeout = 700, id = msg) {\r\n    let note;\r\n\r\n    for (let child of this.children) {\r\n      if (child._noteid === id) {\r\n        note = child;\r\n        break;\r\n      }\r\n    }\r\n\r\n    let f = (100.0*Math.min(percent, 1.0)).toFixed(1);\r\n\r\n    if (note === undefined) {\r\n      note = this.addNote(msg, color, -1, \"note-progress-x\");\r\n      note._noteid = id;\r\n    }\r\n\r\n    //note.setLabel(msg + \" \" + f + \"%\");\r\n    note.percent = percent;\r\n\r\n    if (percent >= 1.0) {\r\n      //note.setLabel(msg + \" \" + f + \"%\");\r\n\r\n      window.setTimeout(() => {\r\n        note.remove();\r\n      }, timeout);\r\n    }\r\n\r\n    return note;\r\n  }\r\n\r\n  addNote(msg, color = \"rgba(255,0,0,0.2)\", timeout = 1200, tagname = \"note-x\", showExclMark=true) {\r\n    //let note = UIBase.createElement(\"note-x\");\r\n\r\n    //note.ctx = this.ctx;\r\n    //note.background = \"red\";\r\n    //note.dom.innerText = msg;\r\n\r\n    //this._add(note);\r\n\r\n    let note = UIBase.createElement(tagname);\r\n\r\n    note.color = color;\r\n    note.setLabel(msg);\r\n\r\n    note.style[\"text-align\"] = \"center\";\r\n\r\n    note.style[\"font\"] = ui_base.getFont(note, \"DefaultText\");\r\n    note.style[\"color\"] = this.getDefault(\"DefaultText\").color;\r\n    note.showExclMark = showExclMark;\r\n\r\n    this.add(note);\r\n\r\n    this.noMarginsOrPadding();\r\n    note.noMarginsOrPadding();\r\n\r\n    //this.dom.style[\"position\"] = UIBase.PositionKey;\r\n    //this.style[\"position\"] = UIBase.PositionKey;\r\n    //note.style[\"position\"] = UIBase.PositionKey;\r\n\r\n    note.style[\"height\"] = this._h + \"px\";\r\n    note.height = this._h;\r\n\r\n    if (timeout !== -1) {\r\n      window.setTimeout(() => {\r\n        //console.log(\"remove!\");\r\n        note.remove();\r\n      }, timeout);\r\n    }\r\n\r\n    //this.appendChild(note);\r\n    return note;\r\n\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(NoteFrame);\r\n\r\nexport function getNoteFrames(screen) {\r\n  let ret = [];\r\n\r\n  let rec = (n) => {\r\n\r\n    if (n instanceof NoteFrame) {\r\n      ret.push(n);\r\n    }\r\n\r\n    if (n.childNodes !== undefined) {\r\n      for (let node of n.childNodes) {\r\n        rec(node);\r\n      }\r\n    }\r\n\r\n    if (n instanceof ui_base.UIBase && n.shadow !== undefined && n.shadow.childNodes) {\r\n      for (let node of n.shadow.childNodes) {\r\n        rec(node);\r\n      }\r\n    }\r\n  }\r\n\r\n  rec(screen);\r\n  return ret;\r\n}\r\n\r\nexport let noteframes = [];\r\n\r\nexport function sendNote(screen, msg, color, timeout = 3000, showExclMark=true) {\r\n  noteframes = getNoteFrames(screen);\r\n\r\n  for (let frame of noteframes) {\r\n    try {\r\n      frame.addNote(msg, color, timeout, undefined, showExclMark);\r\n    } catch (error) {\r\n      print_stack(error);\r\n      console.log(error.stack, error.message);\r\n      console.log(\"bad notification frame\");\r\n    }\r\n  }\r\n}\r\n\r\nwindow._sendNote = sendNote;\r\n\r\nexport function error(screen, msg, timeout) {\r\n  return sendNote(screen, msg, ui_base.color2css([1.0, 0.0, 0.0, 1.0]), timeout);\r\n}\r\n\r\nexport function warning(screen, msg, timeout) {\r\n  return sendNote(screen, msg, ui_base.color2css([0.78, 0.78, 0.2, 1.0]), timeout);\r\n}\r\n\r\nexport function message(screen, msg, timeout) {\r\n  return sendNote(screen, msg, ui_base.color2css([0.2, 0.9, 0.1, 1.0]), timeout, false);\r\n}\r\n\r\n\r\nexport function progbarNote(screen, msg, percent, color, timeout) {\r\n  noteframes = getNoteFrames(screen);\r\n\r\n  for (let frame of noteframes) {\r\n    try {\r\n      frame.progbarNote(msg, percent, color, timeout);\r\n    } catch (error) {\r\n      print_stack(error);\r\n      console.log(error.stack, error.message);\r\n      console.log(\"bad notification frame\");\r\n    }\r\n  }\r\n}\r\n","import * as ui_base from '../core/ui_base.js'\r\nimport * as util from '../path-controller/util/util.js';\r\nimport {ColumnFrame, RowFrame, Container} from \"../core/ui.js\";\r\nlet UIBase = ui_base.UIBase, Icons = ui_base.Icons;\r\nimport {TextBoxBase} from './ui_textbox.js';\r\nimport {keymap} from \"../path-controller/util/simple_events.js\";\r\n\r\nexport class RichEditor extends TextBoxBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._internalDisabled = false;\r\n    this._value = \"\";\r\n\r\n    this.textOnlyMode = false;\r\n\r\n    this.styletag = document.createElement(\"style\");\r\n    this.styletag.textContent = `\r\n      div.rich-text-editor-x {\r\n        width        :   100%;\r\n        height       :   100%;\r\n        min-height   :   150px;\r\n        overflow     :   scroll;\r\n        padding      :   5px;\r\n        white-space  :   pre-wrap;\r\n      }\r\n      \r\n      rich-text-editor-x {\r\n        display        : flex;\r\n        flex-direction : column;\r\n      }\r\n    `;\r\n\r\n    this.shadow.appendChild(this.styletag);\r\n\r\n    let controls = this.controls = UIBase.createElement(\"rowframe-x\");\r\n\r\n\r\n    let makeicon = (icon, description, cb) => {\r\n      icon = controls.iconbutton(icon, description, cb);\r\n      icon.iconsheet = 1; //use second smallest icon size\r\n      icon.overrideDefault(\"padding\", 3);\r\n\r\n      return icon;\r\n    };\r\n\r\n    makeicon(Icons.BOLD, \"Bold\", () => {\r\n      document.execCommand(\"bold\");\r\n    });\r\n    makeicon(Icons.ITALIC, \"Italic\", () => {\r\n      document.execCommand(\"italic\");\r\n    });\r\n    makeicon(Icons.UNDERLINE, \"Underline\", () => {\r\n      document.execCommand(\"underline\");\r\n    });\r\n    makeicon(Icons.STRIKETHRU, \"Strikethrough\", () => {\r\n      document.execCommand(\"strikeThrough\");\r\n    });\r\n\r\n    controls.background = this.getDefault(\"background-color\");\r\n\r\n    this.shadow.appendChild(controls);\r\n\r\n    this.textarea = document.createElement(\"div\");\r\n    this.textarea.contentEditable = true;\r\n    this.textarea.setAttribute(\"class\", \"rich-text-editor-x\");\r\n\r\n    this.textarea.style[\"font\"] = this.getDefault(\"DefaultText\").genCSS();\r\n    this.textarea.style[\"background-color\"] = this.getDefault(\"background-color\");\r\n    this.textarea.setAttribute(\"white-space\", \"pre-wrap\");\r\n\r\n    this.textarea.addEventListener(\"keydown\", (e) => {\r\n      if (e.keyCode === keymap[\"S\"] && e.shiftKey && (e.ctrlKey || e.commandKey)) {\r\n        this.toggleStrikeThru();\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n    });\r\n\r\n    this.textarea.addEventListener(\"focus\", (e) => {\r\n      this._focus = 1;\r\n      this.setCSS();\r\n    });\r\n    this.textarea.addEventListener(\"blur\", (e) => {\r\n      this._focus = 0;\r\n      this.setCSS();\r\n    });\r\n\r\n    document.execCommand(\"styleWithCSS\", true);\r\n\r\n    window.ta = this;\r\n\r\n    this.textarea.addEventListener(\"selectionchange\", (e) => {\r\n      console.log(\"sel1\");\r\n    });\r\n\r\n    document.addEventListener(\"selectionchange\", (e, b) => {\r\n      console.log(\"sel2\", document.getSelection().startNode, b);\r\n    });\r\n\r\n    this.textarea.addEventListener(\"input\", (e) => {\r\n      if (this.internalDisabled) {\r\n        return;\r\n      }\r\n\r\n      console.log(\"text input\", e);\r\n\r\n      let text;\r\n\r\n      if (this.textOnlyMode) {\r\n        text = this.textarea.innerText;\r\n      } else {\r\n        text = this.textarea.innerHTML;\r\n      }\r\n\r\n      if (this.textOnlyMode && text === this._value) {\r\n        //formatting changed?\r\n        console.log(\"detected formatting change\");\r\n        return;\r\n      }\r\n\r\n      //console.log(\"text changed\", ...arguments);\r\n      let sel = document.getSelection();\r\n      let range = sel.getRangeAt(0);\r\n      //console.log(range.startOffset, range.endOffset, range.startContainer);\r\n\r\n      let node = sel.anchorNode;\r\n      let off = sel.anchorOffset;\r\n\r\n      this._value = text;\r\n\r\n      //sel.collapse(node, off);\r\n\r\n      if (this.hasAttribute(\"datapath\")) {\r\n        let path = this.getAttribute(\"datapath\");\r\n        this.setPathValue(this.ctx, path, this.value);\r\n      }\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this._value);\r\n      }\r\n      if (this.oninput) {\r\n        this.oninput(this._value);\r\n      }\r\n\r\n      this.dispatchEvent(new InputEvent(this));\r\n      this.dispatchEvent(new CustomEvent('change'));\r\n    });\r\n\r\n    this.shadow.appendChild(this.textarea);\r\n  }\r\n\r\n  /**\r\n   * Only available in textOnlyMode.  Called when starting text formatting\r\n  */\r\n  formatStart() {\r\n  }\r\n\r\n  /**\r\n  * Only available in textOnlyMode.  Formats html-formated line.\r\n   *\r\n   * @param line : line to format\r\n   * @parem text : whole text\r\n  * */\r\n  formatLine(line, text) {\r\n    return line;\r\n  }\r\n\r\n  toggleStrikeThru() {\r\n    console.log(\"strike thru!\");\r\n    document.execCommand(\"strikeThrough\");\r\n  }\r\n  /**\r\n   * Only available in textOnlyMode.  Called when starting text formatting\r\n   */\r\n  formatEnd() {\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    window.rc = this;\r\n\r\n    document.execCommand(\"defaultParagraphSeparator\", false, \"div\");\r\n\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  get internalDisabled() {\r\n    return this._internalDisabled;\r\n  }\r\n\r\n  set internalDisabled(val) {\r\n    let changed = !!this._internalDisabled !== !!val;\r\n\r\n    if (changed || 1) {\r\n      this._internalDisabled = !!val;\r\n      super.internalDisabled = val;\r\n\r\n      this.textarea.internalDisabled = val;\r\n      this.textarea.contentEditable = !val;\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  set value(val) {\r\n    this._value = val;\r\n\r\n    if (this.textOnlyMode) {\r\n      let val2 = \"\";\r\n      for (let l of val.split(\"\\n\")) {\r\n        val2 += l + \"<br>\";\r\n      }\r\n      val = val2;\r\n    }\r\n\r\n    this.textarea.innerHTML = val;\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.controls.background = this.getDefault(\"background-color\");\r\n\r\n    if (this._focus) {\r\n      this.textarea.style[\"border\"] = `2px dashed ${this.getDefault('focus-border-color')}`;\r\n    } else {\r\n      this.textarea.style[\"border\"] = \"none\";\r\n    }\r\n\r\n    if (this.style[\"font\"]) {\r\n      this.textarea.style[\"font\"] = this.style[\"font\"];\r\n    } else {\r\n      this.textarea.style[\"font\"] = this.getDefault(\"DefaultText\").genCSS();\r\n    }\r\n\r\n    if (this.style[\"color\"]) {\r\n      this.textarea.style[\"color\"] = this.style[\"color\"];\r\n    }  else {\r\n      this.textarea.style[\"color\"] = this.getDefault(\"DefaultText\").color;\r\n    }\r\n\r\n\r\n    if (this.disabled) {\r\n      this.textarea.style[\"background-color\"] = this.getDefault(\"DisabledBG\");\r\n    } else {\r\n      this.textarea.style[\"background-color\"] = this.getDefault(\"background-color\");\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n    let prop = this.getPathMeta(this.ctx, path);\r\n\r\n    if (prop === undefined) {\r\n      console.warn(\"invalid datapath \" + path);\r\n\r\n      this.internalDisabled = true;\r\n      return;\r\n    }\r\n\r\n    this.internalDisabled = false;\r\n    let value = this.getPathValue(this.ctx, path);\r\n\r\n    if (value !== this._value) {\r\n      console.log(\"text change\");\r\n      this.value = value;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateDataPath();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"rich-text-editor-x\",\r\n    style   : \"richtext\",\r\n    modalKeyEvents : true\r\n  }}\r\n}\r\nUIBase.internalRegister(RichEditor);\r\n\r\nexport class RichViewer extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.contents = document.createElement(\"div\");\r\n    this.contents.style[\"padding\"] = \"10px\";\r\n    this.contents.style[\"margin\"] = \"10px\";\r\n    this.contents.style[\"overflow\"] = \"scroll\";\r\n\r\n    this.shadow.appendChild(this.contents);\r\n    this._value = \"\";\r\n  }\r\n\r\n  hideScrollBars() {\r\n    this.contents.style[\"overflow\"] = \"hidden\"\r\n  }\r\n\r\n  showScrollBars() {\r\n    this.contents.style[\"overflow\"] = \"scroll\"\r\n  }\r\n\r\n  //transforms text into final html form\r\n  //note that client code is allowed to override this directly\r\n  textTransform(text) {\r\n    return text;\r\n  }\r\n  set value(val) {\r\n    this._value = val;\r\n\r\n    this.contents.innerHTML = this.textTransform(val);\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n    let prop = this.getPathMeta(this.ctx, path);\r\n\r\n    if (prop === undefined) {\r\n      console.warn(\"invalid datapath \" + path);\r\n\r\n      this.internalDisabled = true;\r\n      return;\r\n    }\r\n\r\n    this.internalDisabled = false;\r\n    let value = this.getPathValue(this.ctx, path);\r\n\r\n    if (value !== this.value) {\r\n      this.value = value;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateDataPath();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"html-viewer-x\",\r\n    style   : \"html_viewer\"\r\n  }}\r\n}\r\nUIBase.internalRegister(RichViewer);\r\n","\"use strict\";\r\nimport './ui_richedit.js';\r\n\r\nimport * as util from '../util/util.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport {Vector2, Vector3, Vector4, Quat, Matrix4} from '../path-controller/util/vectormath.js';\r\nimport {RowFrame, ColumnFrame} from \"../core/ui.js\";\r\nimport {isNumber, PropFlags} from \"../path-controller/toolsys/toolprop.js\";\r\n\r\nimport './ui_widgets.js';\r\n\r\nlet keymap = events.keymap;\r\n\r\nimport {EnumProperty, PropTypes} from '../path-controller/toolsys/toolprop.js';\r\nimport {UIBase, PackFlags, IconSheets, parsepx} from '../core/ui_base.js';\r\n\r\nimport * as units from '../core/units.js';\r\nimport {ToolProperty} from '../path-controller/toolsys/toolprop.js';\r\nimport {Button} from \"./ui_button.js\";\r\n\r\nexport class VectorPopupButton extends Button {\r\n  constructor() {\r\n    super();\r\n\r\n    this.value = new Vector4();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"vector-popup-button-x\",\r\n    style : \"vecPopupButton\"\r\n  }}\r\n\r\n  _onpress(e) {\r\n    if (e.button && e.button !== 0) {\r\n      return;\r\n    }\r\n\r\n    let panel = UIBase.createElement(\"vector-panel-x\");\r\n    let screen = this.ctx.screen;\r\n\r\n    let popup = screen.popup(this, this);\r\n\r\n    popup.add(panel);\r\n    popup.button(\"ok\", () => {\r\n      popup.end();\r\n    })\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      panel.setAttribute(\"datapath\", this.getAttribute(\"datapath\"));\r\n    }\r\n    if (this.hasAttribute(\"mass_set_path\")) {\r\n      panel.setAttribute(\"mass_set_path\", this.getAttribute(\"mass_set_path\"));\r\n    }\r\n\r\n    popup.flushUpdate();\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let value = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (!value) {\r\n      this.internalDisabled = true;\r\n      return;\r\n    }\r\n\r\n    if (this.internalDisabled) {\r\n      this.internalDisabled = false;\r\n    }\r\n\r\n    if (this.value.length !== value.length) {\r\n      switch (value.length) {\r\n        case 2:\r\n          this.value = new Vector2();\r\n          break;\r\n        case 3:\r\n          this.value = new Vector3();\r\n          break;\r\n        case 4:\r\n          this.value = new Vector4();\r\n          break;\r\n      }\r\n    }\r\n\r\n    if (this.value.vectorDistance(value) > 0.0001) {\r\n      this.value.load(value);\r\n      console.log(\"updated vector popup button value\");\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n    this.updateDataPath();\r\n  }\r\n\r\n}\r\nUIBase.internalRegister(VectorPopupButton);\r\n\r\nexport class VectorPanel extends ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this.range = [-1e17, 1e17];\r\n\r\n    this.name = \"\";\r\n\r\n    this.axes = \"XYZW\";\r\n    this.value = new Vector3();\r\n    this.sliders = [];\r\n    this.hasUniformSlider = false;\r\n\r\n    this.packflag |= PackFlags.FORCE_ROLLER_SLIDER|PackFlags.NO_NUMSLIDER_TEXTBOX;\r\n\r\n    let makeParam = (key) => {\r\n      Object.defineProperty(this, key, {\r\n        get : function() {\r\n          return this._getNumParam(key);\r\n        },\r\n\r\n        set : function(val) {\r\n          this._setNumParam(key, val);\r\n        }\r\n      });\r\n    };\r\n\r\n    this.__range = [-1e17, 1e17];\r\n    this._range = new Array(2);\r\n\r\n    Object.defineProperty(this._range, 0, {\r\n      get : () => this.__range[0],\r\n      set : (val) => this.__range[0] = val\r\n    });\r\n    Object.defineProperty(this._range, 1, {\r\n      get : () => this.__range[1],\r\n      set : (val) => this.__range[1] = val\r\n    });\r\n\r\n    makeParam(\"isInt\");\r\n    makeParam(\"radix\");\r\n    makeParam(\"decimalPlaces\");\r\n    makeParam(\"baseUnit\");\r\n    makeParam(\"displayUnit\");\r\n    makeParam(\"step\");\r\n    makeParam(\"expRate\");\r\n    makeParam(\"stepIsRelative\");\r\n\r\n    window.vp = this;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this.rebuild();\r\n    this.setCSS();\r\n\r\n    this.background = this.getDefault(\"InnerPanelBG\");\r\n  }\r\n\r\n  _getNumParam(key) {\r\n    return this[\"_\"+key];\r\n  }\r\n\r\n  _setNumParam(key, val) {\r\n    if (key === \"range\") {\r\n      this.__range[0] = val[0];\r\n      this.__range[1] = val[1];\r\n\r\n      return;\r\n    }\r\n\r\n    this[\"_\"+key] = val;\r\n\r\n    for (let slider of this.sliders) {\r\n      slider[key] = val;\r\n    }\r\n  }\r\n\r\n  rebuild() {\r\n    this.clear();\r\n\r\n    if (this.name) {\r\n      this.label(this.name);\r\n    }\r\n\r\n    let frame, row;\r\n\r\n    if (this.hasUniformSlider) {\r\n      row = this.row();\r\n      frame = row.col();\r\n    } else {\r\n      frame = this;\r\n    }\r\n\r\n    this.sliders = [];\r\n\r\n    for (let i=0; i<this.value.length; i++) {\r\n      //inpath, name, defaultval, min, max, step, is_int, do_redraw, callback, packflag = 0) {\r\n\r\n      let slider = frame.slider(undefined, {\r\n        name       : this.axes[i],\r\n        defaultval : this.value[i],\r\n        min        : this.range[0],\r\n        max        : this.range[1],\r\n        step       : this.step || 0.001,\r\n        is_int     : this.isInt,\r\n        packflag   : this.packflag\r\n      });\r\n\r\n      //let slider = frame.slider(undefined, this.axes[i], this.value[i], this.range[0], this.range[1], 0.001, this.isInt);\r\n      slider.axis = i;\r\n      let this2 = this;\r\n\r\n      slider.baseUnit = this.baseUnit;\r\n      slider.displayUnit = this.displayUnit;\r\n      slider.isInt = this.isInt;\r\n      slider.range = this.__range;\r\n      slider.radix = this.radix;\r\n      slider.step = this.step;\r\n      slider.expRate = this.expRate;\r\n      slider.stepIsRelative= this.stepIsRelative;\r\n\r\n      if (this.stepIsRelative) {\r\n        slider.step = ToolProperty.calcRelativeStep(this.step, this.value[i]);\r\n      }\r\n\r\n      slider.onchange = function(e) {\r\n        this2.value[this.axis] = this.value;\r\n\r\n        if (this2.hasAttribute(\"datapath\")) {\r\n          this2.setPathValue(this2.ctx, this2.getAttribute(\"datapath\"), this2.value);\r\n        }\r\n\r\n        if (this2.uslider) {\r\n          this2.uslider.setValue(this2.uniformValue, false);\r\n        }\r\n\r\n        if (this2.onchange) {\r\n          this2.onchange(this2.value);\r\n        }\r\n      }\r\n\r\n      this.sliders.push(slider);\r\n    }\r\n\r\n    if (this.hasUniformSlider) {\r\n      let uslider = this.uslider = UIBase.createElement(\"numslider-x\");\r\n      row._prepend(uslider);\r\n\r\n      uslider.range = this.range;\r\n      uslider.baseUnit = this.baseUnit;\r\n      uslider.displayUnit = this.displayUnit;\r\n      uslider.expRate = this.expRate;\r\n      uslider.step = this.step;\r\n      uslider.expRate = this.expRate;\r\n      uslider.isInt = this.isInt;\r\n      uslider.radix = this.radix;\r\n      uslider.decimalPlaces = this.decimalPlaces;\r\n      uslider.stepIsRelative= this.stepIsRelative;\r\n\r\n      uslider.vertical = true;\r\n      uslider.setValue(this.uniformValue, false);\r\n\r\n      this.sliders.push(uslider);\r\n\r\n      uslider.onchange = () => {\r\n        this.uniformValue = uslider.value;\r\n      }\r\n    } else {\r\n      this.uslider = undefined;\r\n    }\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  get uniformValue() {\r\n    let sum = 0.0;\r\n\r\n    for (let i=0; i<this.value.length; i++) {\r\n      sum += isNaN(this.value[i]) ? 0.0 : this.value[i];\r\n    }\r\n\r\n    return sum / this.value.length;\r\n  }\r\n\r\n  set uniformValue(val) {\r\n    let old = this.uniformValue;\r\n    let doupdate = false;\r\n\r\n    if (old === 0.0 || val === 0.0) {\r\n      doupdate = this.value.dot(this.value) !== 0.0\r\n\r\n      this.value.zero();\r\n    } else {\r\n      let ratio = val / old;\r\n      for (let i = 0; i < this.value.length; i++) {\r\n        this.value[i] *= ratio;\r\n      }\r\n\r\n      doupdate = true;\r\n    }\r\n\r\n    if (doupdate) {\r\n      if (this.hasAttribute(\"datapath\")) {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this.value);\r\n      }\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.value);\r\n      }\r\n\r\n      for (let i=0; i<this.value.length; i++) {\r\n        this.sliders[i].setValue(this.value[i], false);\r\n        this.sliders[i]._redraw();\r\n      }\r\n\r\n      if (this.uslider) {\r\n        this.uslider.setValue(val, false);\r\n        this.uslider._redraw();\r\n      }\r\n    }\r\n  }\r\n\r\n  setValue(value) {\r\n    if (!value) {\r\n      return;\r\n    }\r\n\r\n    if (value.length !== this.value.length) {\r\n      switch (value.length) {\r\n        case 2:\r\n          this.value = new Vector2(value);\r\n          break;\r\n        case 3:\r\n          this.value = new Vector3(value);\r\n          break;\r\n        case 4:\r\n          this.value = new Vector4(value);\r\n          break;\r\n        default:\r\n          throw new Error(\"invalid vector size \" + value.length);\r\n      }\r\n\r\n      this.rebuild();\r\n    } else {\r\n      this.value.load(value);\r\n    }\r\n\r\n    if (this.onchange) {\r\n      this.onchange(this.value);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n\r\n    let val = this.getPathValue(this.ctx, path);\r\n    if (val === undefined) {\r\n      this.internalDisabled = true;\r\n      return;\r\n    }\r\n\r\n\r\n    let meta = this.getPathMeta(this.ctx, path);\r\n    let name = meta.uiname !== undefined ? meta.uiname : meta.name;\r\n    if (this.hasAttribute(\"name\")) {\r\n      name = this.getAttribute(\"name\");\r\n    }\r\n\r\n    if (name && name !== this.name) {\r\n      this.name = name;\r\n      this.rebuild();\r\n      return;\r\n    }\r\n\r\n    let loadNumParam = (k, do_rebuild=false) => {\r\n      if (meta && meta[k] !== undefined && this[k] === undefined) {\r\n        this[k] = meta[k];\r\n\r\n        if (this[k] !== meta[k] && do_rebuild) {\r\n          this.doOnce(this.rebuild);\r\n        }\r\n      }\r\n    }\r\n\r\n\r\n    loadNumParam(\"baseUnit\");\r\n    loadNumParam(\"displayUnit\");\r\n    loadNumParam(\"decimalPlaces\");\r\n    loadNumParam(\"isInt\");\r\n    loadNumParam(\"radix\");\r\n    loadNumParam(\"step\");\r\n    loadNumParam(\"expRate\");\r\n    loadNumParam(\"stepIsRelative\");\r\n\r\n    if (meta && meta.hasUniformSlider !== undefined && meta.hasUniformSlider !== this.hasUniformSlider) {\r\n      this.hasUniformSlider = meta.hasUniformSlider;\r\n      this.doOnce(this.rebuild);\r\n    }\r\n\r\n    if (meta && meta.range) {\r\n      let update = this.range[0] !== meta.range[0];\r\n      update= update || this.range[1] !== meta.range[1];\r\n\r\n      this.range[0] = meta.range[0];\r\n      this.range[1] = meta.range[1];\r\n\r\n      if (update) {\r\n        this.doOnce(this.rebuild);\r\n      }\r\n    }\r\n\r\n    this.internalDisabled = false;\r\n\r\n    let length = val.length;\r\n\r\n    if (meta && (meta.flag & PropFlags.USE_CUSTOM_GETSET)) {\r\n      let rdef = this.ctx.api.resolvePath(this.ctx, path);\r\n\r\n      meta.ctx = this.ctx;\r\n      meta.dataref = rdef.obj;\r\n      meta.datapath = path;\r\n\r\n      length = meta.getValue().length;\r\n\r\n      meta.dataref = undefined;\r\n    }\r\n\r\n    if (this.value.length !== length) {\r\n      switch (length) {\r\n        case 2:\r\n          val = new Vector2(val);\r\n          break;\r\n        case 3:\r\n          val = new Vector3(val);\r\n          break;\r\n        case 4:\r\n          val = new Vector4(val);\r\n          break;\r\n        default:\r\n          val = meta.getValue().copy().load(val);\r\n          break;\r\n      }\r\n\r\n      this.value = val;\r\n      this.rebuild();\r\n\r\n      for (let i=0; i<this.value.length; i++) {\r\n        this.sliders[i].setValue(val[i], false);\r\n        this.sliders[i]._redraw();\r\n      }\r\n    } else {\r\n      if (this.value.vectorDistance(val) > 0) {\r\n        this.value.load(val);\r\n\r\n        if (this.uslider) {\r\n          this.uslider.setValue(this.uniformValue, false);\r\n        }\r\n\r\n        for (let i=0; i<this.value.length; i++) {\r\n          this.sliders[i].setValue(val[i], false);\r\n          this.sliders[i]._redraw();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateDataPath();\r\n\r\n    if (this.stepIsRelative) {\r\n      for (let slider of this.sliders) {\r\n        slider.step = ToolProperty.calcRelativeStep(this.step, slider.value);\r\n      }\r\n    }\r\n\r\n    if (this.uslider) {\r\n      this.uslider.step = this.step;\r\n      if (this.stepIsRelative) {\r\n        this.uslider.step = ToolProperty.calcRelativeStep(this.step, this.uniformValue);\r\n      }\r\n\r\n    }\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"vector-panel-x\"\r\n  }}\r\n}\r\nUIBase.internalRegister(VectorPanel);\r\n\r\n\r\nexport class ToolTip extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.visibleToPick = false;\r\n    this.div = document.createElement(\"div\");\r\n\r\n    this.shadow.appendChild(this.div);\r\n    this._start_time = undefined;\r\n    this.timeout = undefined;\r\n  }\r\n\r\n  static show(message, screen, x, y) {\r\n    let ret = UIBase.createElement(this.define().tagname);\r\n\r\n    ret._start_time = util.time_ms();\r\n    ret.timeout = ret.getDefault(\"timeout\");\r\n\r\n    ret.text = message;\r\n    let size = ret._estimateSize();\r\n\r\n    let pad = 5;\r\n    size = [size[0] + pad, size[1] + pad];\r\n\r\n    console.log(size);\r\n    x = Math.min(Math.max(x, 0), screen.size[0] - size[0]);\r\n    y = Math.min(Math.max(y, 0), screen.size[1] - size[1]);\r\n\r\n    let dpi = UIBase.getDPI();\r\n\r\n    x += 10/dpi;\r\n    y += 15/dpi;\r\n\r\n    ret._popup = screen.popup(ret, x, y);\r\n    ret._popup.background = \"rgba(0,0,0,0)\";\r\n    ret._popup.style[\"border\"] = \"none\";\r\n    ret.div.style[\"padding\"] = \"15px\";\r\n\r\n    ret._popup.add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  end() {\r\n    this._popup.end();\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this.setCSS();\r\n  }\r\n\r\n  set text(val) {\r\n    this.div.innerHTML = val.replace(/[\\n]/g, \"<br>\\n\");\r\n  }\r\n\r\n  get text() {\r\n    return this.div.innerHTML;\r\n  }\r\n\r\n  _estimateSize() {\r\n    let text = this.div.textContent;\r\n    let block = ui_base.measureTextBlock(this, text, undefined, undefined, undefined, this.getDefault(\"ToolTipText\"));\r\n\r\n    return [block.width+50, block.height+30];\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    if (util.time_ms() - this._start_time > this.timeout) {\r\n      this.end();\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    let color = this.getDefault(\"background-color\");\r\n    let bcolor = this.getDefault(\"border-color\");\r\n\r\n    this.background = color;\r\n\r\n    let radius = this.getDefault(\"border-radius\", undefined, 5);\r\n    let bstyle = this.getDefault(\"border-style\", undefined, \"solid\");\r\n    let bwidth = this.getDefault(\"border-width\", undefined, 1);\r\n    let padding = this.getDefault(\"padding\", undefined, 15);\r\n\r\n    this.noMarginsOrPadding();\r\n\r\n    this.div.style[\"padding\"] = padding + \"px\";\r\n\r\n    this.div.style[\"background-color\"] = \"rgba(0,0,0,0)\";\r\n    this.div.style[\"border\"] = `${bwidth}px ${bstyle} ${bcolor}`;\r\n    this.div.style[\"border-radius\"] = radius + \"px\";\r\n    this.style[\"border-radius\"] = radius + \"px\";\r\n\r\n    let font = this.getDefault(\"ToolTipText\");\r\n    this.div.style[\"color\"] = font.color;\r\n    this.div.style[\"font\"] = font.genCSS();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"tool-tip-x\",\r\n    style   : \"tooltip\"\r\n  }}\r\n};\r\nUIBase.internalRegister(ToolTip);\r\n\r\nwindow._ToolTip = ToolTip;\r\n","\"use strict\";\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as simple_toolsys from '../path-controller/toolsys/toolsys.js';\r\nimport {ToolTip} from \"../widgets/ui_widgets2.js\";\r\n\r\n/*\r\nwhy am I using a toolstack here at all?  time to remove!\r\n*/\r\n\r\nlet toolstack_getter = function () {\r\n  throw new Error(\"must pass a toolstack getter to registerToolStackGetter\")\r\n}\r\n\r\nexport function registerToolStackGetter(func) {\r\n  toolstack_getter = func;\r\n}\r\n\r\nlet Vector2   = vectormath.Vector2,\r\n    Vector3   = vectormath.Vector3,\r\n    UndoFlags = simple_toolsys.UndoFlags,\r\n    ToolFlags = simple_toolsys.ToolFlags;\r\n\r\nimport {pushModalLight, popModalLight, keymap, pushPointerModal} from \"../util/simple_events.js\";\r\n\r\n//import {keymap} from './events';\r\n\r\nexport class ToolBase extends simple_toolsys.ToolOp {\r\n  constructor(screen) {\r\n    super();\r\n    this.screen = screen;\r\n    //super();\r\n\r\n    this._finished = false;\r\n  }\r\n\r\n  start(elem, pointerId) {\r\n    //toolstack_getter().execTool(this);\r\n    this.modalStart(undefined, elem, pointerId);\r\n  }\r\n\r\n  cancel() {\r\n    this.finish();\r\n  }\r\n\r\n  finish() {\r\n    this._finished = true;\r\n    this.popModal(this.screen);\r\n  }\r\n\r\n  popModal() {\r\n    this.overdraw.end();\r\n    popModalLight(this.modaldata);\r\n    this.modaldata = undefined;\r\n  }\r\n\r\n  modalStart(ctx, elem, pointerId) {\r\n    this.ctx = ctx;\r\n\r\n    if (this.modaldata !== undefined) {\r\n      console.log(\"Error, modaldata was not undefined\");\r\n      popModalLight(this.modaldata);\r\n    }\r\n\r\n    this.overdraw = ui_base.UIBase.createElement(\"overdraw-x\");\r\n    this.overdraw.start(this.screen);\r\n\r\n    let handlers = {};\r\n    let keys = Object.getOwnPropertyNames(this);\r\n    for (let k in this.__proto__) {\r\n      keys.push(k);\r\n    }\r\n    for (let k of Object.getOwnPropertyNames(this.__proto__)) {\r\n      keys.push(k);\r\n    }\r\n\r\n    for (let k in this) {\r\n      keys.push(k);\r\n    }\r\n\r\n    for (let k of keys) {\r\n      if (k.startsWith(\"on\")) {\r\n        handlers[k] = this[k].bind(this);\r\n      }\r\n    }\r\n\r\n    //window.setTimeout(() => {\r\n    if (pointerId !== undefined) {\r\n      handlers.on_pointerdown = handlers.on_mousedown;\r\n      handlers.on_pointermove = handlers.on_mousemove;\r\n      handlers.on_pointerup = handlers.on_mouseup;\r\n      handlers.on_pointercancel = handlers.on_mouseup;\r\n      handlers.on_pointerend = handlers.on_mouseup;\r\n\r\n      this.modaldata = pushPointerModal(handlers, elem, pointerId);\r\n    } else {\r\n      this.modaldata = pushModalLight(handlers);\r\n    }\r\n    //console.log(\"HANDLERS\", this.modaldata.handlers);\r\n\r\n    //}, 100);\r\n\r\n    //window.addEventListener(\"touchmove\", (e) => {\r\n    //  console.log(\"touchmove\");\r\n    //}, {passive : false});\r\n  }\r\n\r\n  on_mousemove(e) {\r\n  }\r\n\r\n  on_mouseup(e) {\r\n    this.finish();\r\n  }\r\n\r\n  on_keydown(e) {\r\n    console.log(\"s\", e.keyCode);\r\n\r\n    switch (e.keyCode) {\r\n      case keymap.Escape: //esc\r\n        this.cancel();\r\n        break;\r\n      case keymap.Space: //space\r\n      case keymap.Enter: //return\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\nexport class AreaResizeTool extends ToolBase {\r\n  constructor(screen, border, mpos) {\r\n    if (screen === undefined) screen = _appstate.screen; //XXX hackish!\r\n\r\n    super(screen);\r\n\r\n    this.start_mpos = new Vector2(mpos);\r\n\r\n    this.sarea = border.sareas[0];\r\n    if (!this.sarea || border.dead) {\r\n      console.log(border.dead, border);\r\n      throw new Error(\"border corruption\");\r\n    }\r\n\r\n    this.screen = screen;\r\n\r\n    this.side = this.sarea._side(border);\r\n  }\r\n\r\n  get border() {\r\n    return this.sarea._borders[this.side];\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Resize Area\",\r\n      toolpath   : \"screen.area.resize\",\r\n      icon       : ui_base.Icons.RESIZE,\r\n      description: \"change size of area\",\r\n      is_modal   : true,\r\n      undoflag   : UndoFlags.NO_UNDO,\r\n      flag       : 0,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n\r\n  getBorders() {\r\n    let horiz = this.border.horiz;\r\n\r\n    let ret = [];\r\n    let visit = new Set();\r\n\r\n    let rec = (v) => {\r\n      if (visit.has(v._id)) {\r\n        return;\r\n      }\r\n\r\n      visit.add(v._id);\r\n\r\n      for (let border of v.borders) {\r\n        if (border.horiz == horiz && !visit.has(border._id)) {\r\n          visit.add(border._id);\r\n          ret.push(border);\r\n\r\n          rec(border.otherVertex(v));\r\n        }\r\n      }\r\n    }\r\n\r\n    rec(this.border.v1);\r\n    rec(this.border.v2);\r\n\r\n    return ret;\r\n  }\r\n\r\n  on_mouseup(e) {\r\n    this.finish();\r\n  }\r\n\r\n  finish() {\r\n    super.finish();\r\n    this.screen.snapScreenVerts();\r\n    this.screen.regenBorders();\r\n    this.screen.snapScreenVerts();\r\n    this.screen.loadFromVerts();\r\n  }\r\n\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case keymap[\"Escape\"]:\r\n      case keymap[\"Enter\"]:\r\n      case keymap[\"Space\"]:\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n\r\n  on_mousemove(e) {\r\n    let mpos = new Vector2([e.x, e.y]);\r\n\r\n    mpos.sub(this.start_mpos);\r\n\r\n    let axis = this.border.horiz ? 1 : 0;\r\n\r\n    //console.log(this.border.horiz);\r\n\r\n    this.overdraw.clear();\r\n\r\n    let visit = new Set();\r\n    let borders = this.getBorders();\r\n\r\n    let color = cconst.DEBUG.screenborders ? \"rgba(1.0, 0.5, 0.0, 0.1)\" : \"rgba(1.0, 0.5, 0.0, 1.0)\";\r\n\r\n    let bad = false;\r\n\r\n    for (let border of borders) {\r\n      bad = bad || !this.screen.isBorderMovable(border);\r\n\r\n      border.oldv1 = new Vector2(border.v1);\r\n      border.oldv2 = new Vector2(border.v2);\r\n    }\r\n\r\n    if (bad) {\r\n      console.log(\"border is not movable\");\r\n      return;\r\n    }\r\n\r\n    let check = () => {\r\n      let count = 0;\r\n\r\n      for (let sarea of this.screen.sareas) {\r\n        if (sarea.size[0] < 15 || sarea.size[1] < 15) {\r\n          count++;\r\n        }\r\n      }\r\n\r\n      return count;\r\n    };\r\n\r\n    let badcount = check();\r\n\r\n\r\n    let snapMode = true;\r\n\r\n    let df = mpos[axis];\r\n    let border = this.border;\r\n\r\n    this.screen.moveBorder(border, df, false);\r\n\r\n    for (let border of borders) {\r\n      //if false, stead of forcing areas to fit within screen bounds\r\n      //in snapScreenVerts the screen bounds will be modified instead.\r\n\r\n      if (border.outer) {\r\n        snapMode = false;\r\n      }\r\n\r\n      this.overdraw.line(border.v1, border.v2, color);\r\n    }\r\n\r\n    this.start_mpos[0] = e.x;\r\n    this.start_mpos[1] = e.y;\r\n    this.screen.loadFromVerts();\r\n    this.screen.setCSS();\r\n\r\n    if (check() != badcount) {\r\n      console.log(\"bad\");\r\n\r\n      for (let border of borders) {\r\n        border.v1.load(border.oldv1);\r\n        border.v2.load(border.oldv2);\r\n      }\r\n    }\r\n\r\n\r\n    this.screen.snapScreenVerts(snapMode);\r\n    this.screen.loadFromVerts();\r\n    this.screen.solveAreaConstraints(snapMode);\r\n    this.screen.setCSS();\r\n    this.screen.updateDebugBoxes();\r\n    this.screen._fireResizeCB();\r\n  }\r\n}\r\n\r\n//controller.registerTool(AreaResizeTool);\r\n\r\nexport class SplitTool extends ToolBase {\r\n  constructor(screen) {\r\n    if (screen === undefined) screen = _appstate.screen; //XXX hackish!\r\n\r\n    super(screen);\r\n\r\n    this.done = false;\r\n    this.screen = screen;\r\n    this.ctx = screen.ctx;\r\n    this.sarea = undefined;\r\n    this.t = undefined;\r\n\r\n    this.started = false;\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Split Area\",\r\n      toolpath   : \"screen.area.split\",\r\n      icon       : ui_base.Icons.SMALL_PLUS,\r\n      description: \"split an area in two\",\r\n      is_modal   : true,\r\n      undoflag   : UndoFlags.NO_UNDO,\r\n      flag       : 0,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n\r\n  modalStart(ctx) {\r\n    if (this.started) {\r\n      console.trace(\"double call to modalStart()\");\r\n      return;\r\n    }\r\n\r\n    this.overdraw = ui_base.UIBase.createElement(\"overdraw-x\");\r\n    this.overdraw.start(this.screen);\r\n\r\n    super.modalStart(ctx);\r\n  }\r\n\r\n  cancel() {\r\n    return this.finish(true);\r\n  }\r\n\r\n  finish(canceled = false) {\r\n    if (this.done) {\r\n      return;\r\n    }\r\n\r\n    this.done = true;\r\n    this.overdraw.end();\r\n\r\n    this.popModal(this.screen);\r\n\r\n    if (canceled || !this.sarea) {\r\n      return;\r\n    }\r\n\r\n    let sarea = this.sarea, screen = this.screen;\r\n    let t = this.t;\r\n\r\n    screen.splitArea(sarea, t, this.horiz);\r\n    screen._internalRegenAll();\r\n  }\r\n\r\n  on_mousemove(e) {\r\n    let x = e.x, y = e.y;\r\n\r\n    let screen = this.screen;\r\n\r\n    let sarea = screen.findScreenArea(x, y);\r\n\r\n    this.overdraw.clear();\r\n\r\n    if (sarea !== undefined) {\r\n      //x -= sarea.pos[0];\r\n      //y -= sarea.pos[1];\r\n      x = (x - sarea.pos[0])/(sarea.size[0]);\r\n      y = (y - sarea.pos[1])/(sarea.size[1]);\r\n\r\n      let dx = 1.0 - Math.abs(x - 0.5);\r\n      let dy = 1.0 - Math.abs(y - 0.5);\r\n\r\n      this.sarea = sarea;\r\n      let horiz = this.horiz = dx < dy;\r\n\r\n      if (horiz) {\r\n        this.t = y;\r\n        this.overdraw.line([sarea.pos[0], e.y], [sarea.pos[0] + sarea.size[0], e.y]);\r\n      } else {\r\n        this.t = x;\r\n        this.overdraw.line([e.x, sarea.pos[1]], [e.x, sarea.pos[1] + sarea.size[1]]);\r\n      }\r\n    }\r\n    //console.warn(\"sarea:\", sarea);\r\n\r\n    //let sarea = this.\r\n    //console.log(e.x, e.y);\r\n    //this.overdraw.clear();\r\n    //this.overdraw.line([e.x, e.y-200], [e.x, e.y+200], \"grey\");\r\n  }\r\n\r\n  on_mousedown(e) {\r\n  }\r\n\r\n  on_mouseup(e) {\r\n    this.finish();\r\n\r\n    if (e.button) {\r\n      this.stopPropagation();\r\n      this.preventDefault();\r\n    }\r\n  }\r\n\r\n  on_keydown(e) {\r\n    console.log(\"s\", e.keyCode);\r\n\r\n    switch (e.keyCode) {\r\n      case keymap.Escape: //esc\r\n        this.cancel();\r\n        break;\r\n      case keymap.Space: //space\r\n      case keymap.Enter: //return\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\n\r\nexport class RemoveAreaTool extends ToolBase {\r\n  constructor(screen, border) {\r\n    if (screen === undefined) screen = _appstate.screen; //XXX hackish!\r\n\r\n    super(screen);\r\n\r\n    this.border = border;\r\n\r\n    this.done = false;\r\n    this.screen = screen;\r\n    this.ctx = screen.ctx;\r\n    this.sarea = undefined;\r\n    this.t = undefined;\r\n\r\n    this.started = false;\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Remove Area\",\r\n      toolpath   : \"screen.area.pick_remove\",\r\n      icon       : ui_base.Icons.SMALL_PLUS,\r\n      description: \"Collapse a window\",\r\n      is_modal   : true,\r\n      undoflag   : UndoFlags.NO_UNDO,\r\n      flag       : 0,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n\r\n  modalStart(ctx) {\r\n    if (this.started) {\r\n      console.trace(\"double call to modalStart()\");\r\n      return;\r\n    }\r\n\r\n    this.overdraw = ui_base.UIBase.createElement(\"overdraw-x\");\r\n    this.overdraw.start(this.screen);\r\n\r\n    super.modalStart(ctx);\r\n  }\r\n\r\n  cancel() {\r\n    return this.finish(true);\r\n  }\r\n\r\n  finish(canceled = false) {\r\n    if (this.done) {\r\n      return;\r\n    }\r\n\r\n    this.done = true;\r\n    this.overdraw.end();\r\n\r\n    this.popModal(this.screen);\r\n\r\n    if (canceled || !this.sarea) {\r\n      return;\r\n    }\r\n\r\n    let sarea = this.sarea, screen = this.screen;\r\n    let t = this.t;\r\n\r\n    if (sarea) {\r\n      screen.collapseArea(sarea, this.border);\r\n      screen._internalRegenAll();\r\n    }\r\n  }\r\n\r\n  on_mousemove(e) {\r\n    let x = e.x, y = e.y;\r\n\r\n    let screen = this.screen;\r\n\r\n    let sarea = screen.findScreenArea(x, y);\r\n\r\n    this.overdraw.clear();\r\n\r\n    if (sarea !== undefined) {\r\n      this.sarea = sarea;\r\n      this.overdraw.rect(sarea.pos, sarea.size, \"rgba(0,0,0,0.1)\");\r\n    }\r\n    //console.warn(\"sarea:\", sarea);\r\n\r\n    //let sarea = this.\r\n    //console.log(e.x, e.y);\r\n    //this.overdraw.clear();\r\n    //this.overdraw.line([e.x, e.y-200], [e.x, e.y+200], \"grey\");\r\n  }\r\n\r\n  on_mousedown(e) {\r\n  }\r\n\r\n  on_mouseup(e) {\r\n    this.finish();\r\n\r\n    if (e.button) {\r\n      this.stopPropagation();\r\n      this.preventDefault();\r\n    }\r\n  }\r\n\r\n  on_keydown(e) {\r\n    console.log(\"s\", e.keyCode);\r\n\r\n    switch (e.keyCode) {\r\n      case keymap.Escape: //esc\r\n        this.cancel();\r\n        break;\r\n      case keymap.Space: //space\r\n      case keymap.Enter: //return\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\n//controller.registerTool(SplitTool);\r\n\r\n\r\nexport class AreaDragTool extends ToolBase {\r\n  constructor(screen, sarea, mpos) {\r\n    if (screen === undefined) screen = _appstate.screen; //XXX hackish!\r\n\r\n    super(screen);\r\n\r\n    this.dropArea = false;\r\n    this.excludeAreas = new Set();\r\n    this.cursorbox = undefined;\r\n    this.boxes = [];\r\n    this.boxes.active = undefined;\r\n\r\n    this.sarea = sarea;\r\n    this.start_mpos = new Vector2(mpos);\r\n    this.screen = screen;\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Drag Area\",\r\n      toolpath   : \"screen.area.drag\",\r\n      icon       : ui_base.Icons.TRANSLATE,\r\n      description: \"move or duplicate area\",\r\n      is_modal   : true,\r\n      undoflag   : UndoFlags.NO_UNDO,\r\n      flag       : 0,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n\r\n  finish() {\r\n    super.finish();\r\n\r\n    this.screen.regenBorders();\r\n    this.screen.solveAreaConstraints();\r\n    this.screen.snapScreenVerts();\r\n    this.screen._recalcAABB();\r\n  }\r\n\r\n  getBoxRect(b) {\r\n    let sa = b.sarea;\r\n    let pos, size;\r\n\r\n    if (b.horiz == -1) {\r\n      //replacement mode\r\n      pos = sa.pos;\r\n      size = sa.size;\r\n    } else if (b.horiz) {\r\n      if (b.side == 'b') {\r\n        pos = [sa.pos[0], sa.pos[1] + sa.size[1]*b.t]\r\n        size = [sa.size[0], sa.size[1]*(1.0 - b.t)]\r\n      } else {\r\n        pos = [sa.pos[0], sa.pos[1]];\r\n        size = [sa.size[0], sa.size[1]*b.t]\r\n      }\r\n    } else {\r\n      if (b.side == 'r') {\r\n        pos = [sa.pos[0] + sa.size[0]*b.t, sa.pos[1]]\r\n        size = [sa.size[0]*(1.0 - b.t), sa.size[1]]\r\n      } else {\r\n        pos = [sa.pos[0], sa.pos[1]];\r\n        size = [sa.size[0]*b.t, sa.size[1]]\r\n      }\r\n    }\r\n\r\n    let color = \"rgba(100, 100, 100, 0.2)\";\r\n\r\n    let ret = this.overdraw.rect(pos, size, color);\r\n    ret.style[\"pointer-events\"] = \"none\";\r\n\r\n    return ret;\r\n  }\r\n\r\n  doSplit(b) {\r\n    if (this.sarea) {\r\n      return this.doSplitDrop(b);\r\n    }\r\n\r\n    let src = this.sarea, dst = b.sarea;\r\n    let screen = this.screen;\r\n\r\n    let t = b.t;\r\n\r\n    screen.splitArea(dst, t, b.horiz);\r\n\r\n    screen._internalRegenAll();\r\n  }\r\n\r\n  doSplitDrop(b) {\r\n    //first check if there was no change\r\n    if (b.horiz === -1 && b.sarea === this.sarea) {\r\n      return;\r\n    }\r\n\r\n    let can_rip = false;\r\n    let sa = this.sarea;\r\n    let screen = this.screen;\r\n\r\n    //rip conditions\r\n    can_rip = sa.size[0] === screen.size[0] || sa.size[1] === screen.size[1];\r\n    can_rip = can_rip || this.sarea.floating;\r\n    can_rip = can_rip && b.sarea !== sa;\r\n    can_rip = can_rip && (b.horiz === -1 || !screen.areasBorder(sa, b.sarea));\r\n\r\n    let expand = b.horiz === -1 && b.sarea !== sa && screen.areasBorder(b.sarea, sa);\r\n\r\n    can_rip = can_rip || expand;\r\n\r\n    console.log(\"can_rip:\", can_rip, expand);\r\n\r\n    if (can_rip) {\r\n      screen.removeArea(sa);\r\n      screen.snapScreenVerts();\r\n    }\r\n\r\n    if (b.horiz === -1) {\r\n      //replacement\r\n      let src = this.sarea, dst = b.sarea;\r\n\r\n      if (can_rip && src !== dst) {\r\n        let mm;\r\n\r\n        //handle case of one area \"consuming\" another\r\n        if (expand) {\r\n          mm = screen.minmaxArea(src);\r\n          screen.minmaxArea(dst, mm);\r\n        }\r\n\r\n        console.log(\"replacing. . .\", expand);\r\n\r\n        if (src.floating) {\r\n          let old = dst.editors;\r\n\r\n          dst.editors = [];\r\n          dst.editormap = {};\r\n\r\n          if (dst.area && !(dst.area.constructor.define().areaname in src.editormap)) {\r\n            dst.area.push_ctx_active();\r\n            dst.area.on_area_inactive();\r\n            dst.area.remove();\r\n            dst.area.pop_ctx_active();\r\n          }\r\n\r\n          for (let editor of old) {\r\n            let def = editor.constructor.define();\r\n\r\n            let bad = false;\r\n            //bad = !(def.areaname in src.editormap);\r\n\r\n            for (let editor2 of src.editors) {\r\n              if (editor.constructor === editor2.constructor) {\r\n                bad = true;\r\n                break;\r\n              }\r\n            }\r\n\r\n            if (!bad) {\r\n              dst.editors.push(editor);\r\n              dst.editormap[def.areaname] = editor;\r\n            }\r\n          }\r\n\r\n          for (let editor of src.editors) {\r\n            let def = editor.constructor.define();\r\n\r\n            dst.editormap[def.areaname] = editor;\r\n            dst.editors.push(editor);\r\n\r\n            if (editor.owning_sarea) {\r\n              editor.owning_sarea = dst;\r\n            }\r\n\r\n            if (editor.parentWidget) {\r\n              editor.parentWidget = dst;\r\n            }\r\n          }\r\n\r\n          if (cconst.useAreaTabSwitcher) {\r\n            for (let editor of dst.editors) {\r\n              if (editor.switcher) {\r\n                editor.switcher.flagUpdate();\r\n              }\r\n            }\r\n          }\r\n\r\n          dst.area = src.area;\r\n          dst.shadow.appendChild(src.area);\r\n\r\n          src.area = undefined;\r\n          src.editors = [];\r\n          src.editormap = {};\r\n\r\n          dst.on_resize(dst.size, dst.size);\r\n\r\n          dst.flushSetCSS();\r\n          dst.flushUpdate();\r\n\r\n          screen.removeArea(src);\r\n          screen.snapScreenVerts();\r\n\r\n          return;\r\n        } else {\r\n          screen.replaceArea(dst, src);\r\n        }\r\n\r\n        if (expand) {\r\n          console.log(\"\\nEXPANDING:\", src.size[0], src.size[1]);\r\n\r\n          src.pos[0] = mm.min[0];\r\n          src.pos[1] = mm.min[1];\r\n\r\n          src.size[0] = mm.max[0] - mm.min[0];\r\n          src.size[1] = mm.max[1] - mm.min[1];\r\n\r\n          src.loadFromPosSize();\r\n\r\n          screen._internalRegenAll();\r\n        }\r\n      } else {\r\n        //console.log(\"copying. . .\");\r\n        screen.replaceArea(dst, src.copy());\r\n        screen._internalRegenAll();\r\n      }\r\n    } else {\r\n      let src = this.sarea, dst = b.sarea;\r\n\r\n      let t = b.t;\r\n\r\n      let nsa = screen.splitArea(dst, t, b.horiz);\r\n\r\n      if (b.side === 'l' || b.side === 't') {\r\n        nsa = dst;\r\n      }\r\n\r\n      if (can_rip) {\r\n        //console.log(\"replacing\");\r\n        screen.replaceArea(nsa, src);\r\n      } else {\r\n        //console.log(\"copying\");\r\n        screen.replaceArea(nsa, src.copy());\r\n      }\r\n\r\n      screen._internalRegenAll();\r\n    }\r\n  }\r\n\r\n  makeBoxes(sa) {\r\n    let sz = util.isMobile() ? 100 : 40;\r\n    let cx = sa.pos[0] + sa.size[0]*0.5;\r\n    let cy = sa.pos[1] + sa.size[1]*0.5;\r\n\r\n    let color = this.color = \"rgba(200, 200, 200, 0.55)\";\r\n    let hcolor = this.hcolor = \"rgba(230, 230, 230, 0.75)\";\r\n    let idgen = 0;\r\n    let boxes = this.boxes;\r\n\r\n    let box = (x, y, sz, horiz, t, side) => {\r\n      //console.log(x, y, sz);\r\n\r\n      let b = this.overdraw.rect([x - sz[0]*0.5, y - sz[1]*0.5], sz, color);\r\n      b.style[\"border-radius\"] = \"14px\";\r\n\r\n      boxes.push(b);\r\n\r\n      b.sarea = sa;\r\n\r\n      let style = document.createElement(\"style\")\r\n      let cls = `mybox_${idgen++}`;\r\n\r\n      b.horiz = horiz;\r\n      b.t = t;\r\n      b.side = side;\r\n      b.setAttribute(\"class\", cls);\r\n      b.setAttribute(\"is_box\", true);\r\n\r\n      b.addEventListener(\"mousemove\", this.on_mousemove.bind(this));\r\n\r\n      let onclick = b.onclick = (e) => {\r\n        let type = e.type.toLowerCase();\r\n\r\n        if ((e.type === \"mousedown\" || e.type === \"mouseup\") && e.button !== 0) {\r\n          return; //another handler will cancel\r\n        }\r\n\r\n        console.log(\"split click\");\r\n\r\n        if (!this._finished) {\r\n          this.finish();\r\n          this.doSplit(b);\r\n\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n        }\r\n      }\r\n\r\n      b.addEventListener(\"click\", onclick);\r\n      b.addEventListener(\"mousedown\", onclick);\r\n      b.addEventListener(\"mouseup\", onclick);\r\n\r\n      b.addEventListener(\"mouseenter\", (e) => {\r\n        if (this.curbox !== undefined) {\r\n          if (this.curbox.rect) {\r\n            this.curbox.rect.remove()\r\n            this.curbox.rect = undefined;\r\n          }\r\n        }\r\n\r\n        if (b.rect !== undefined) {\r\n          b.rect.remove();\r\n          b.rect = undefined;\r\n        }\r\n\r\n        b.rect = this.getBoxRect(b);\r\n        this.curbox = b;\r\n\r\n        b.setColor(hcolor);\r\n        //b.style[\"background-color\"] = hcolor;\r\n      })\r\n\r\n      b.addEventListener(\"mouseleave\", (e) => {\r\n        if (b.rect) {\r\n          b.rect.remove();\r\n          b.rect = undefined;\r\n        }\r\n\r\n        if (this.curbox === b) {\r\n          this.curbox = undefined;\r\n        }\r\n\r\n        b.setColor(color);\r\n        //b.style[\"background-color\"] = color;\r\n      })\r\n\r\n      style.textContent = `\r\n        .${cls}:hover {\r\n          background-color : orange;\r\n          fill:orange;stroke-width:2\r\n        }\r\n      `\r\n      //console.log(style.textContent);\r\n      b.appendChild(style);\r\n      b.setAttribute(\"class\", cls);\r\n\r\n      return b;\r\n    }\r\n\r\n    let pad = 5;\r\n\r\n    if (this.sarea) {\r\n      box(cx, cy, [sz, sz], -1, -1, -1);\r\n    }\r\n\r\n    box(cx - sz*0.75 - pad, cy, [sz*0.5, sz], false, 0.5, 'l');\r\n    box(cx - sz*1.2 - pad, cy, [sz*0.25, sz], false, 0.3, 'l');\r\n\r\n    box(cx + sz*0.75 + pad, cy, [sz*0.5, sz], false, 0.5, 'r');\r\n    box(cx + sz*1.2 + pad, cy, [sz*0.25, sz], false, 0.7, 'r');\r\n\r\n    box(cx, cy - sz*0.75 - pad, [sz, sz*0.5], true, 0.5, 't');\r\n    box(cx, cy - sz*1.2 - pad, [sz, sz*0.25], true, 0.3, 't');\r\n\r\n    box(cx, cy + sz*0.75 + pad, [sz, sz*0.5], true, 0.5, 'b');\r\n    box(cx, cy + sz*1.2 + pad, [sz, sz*0.25], true, 0.7, 'b');\r\n  }\r\n\r\n  getActiveBox(x, y) {\r\n    for (let n of this.boxes) {\r\n      if (n.hasAttribute && n.hasAttribute(\"is_box\")) {\r\n        let rect = n.getClientRects()[0];\r\n\r\n        //console.log(rect.x, rect.y);\r\n        if (x >= rect.x && y >= rect.y && x < rect.x + rect.width && y < rect.y + rect.height) {\r\n          //console.log(\"found rect\");\r\n          return n;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  on_drag(e) {\r\n    this.on_mousemove(e);\r\n  }\r\n\r\n  on_dragend(e) {\r\n    this.on_mouseup(e);\r\n  }\r\n\r\n  on_mousemove(e) {\r\n    let wid = 55;\r\n    let color = \"rgb(200, 200, 200, 0.7)\";\r\n\r\n    //console.trace(\"mouse move!\", e.x, e.y, this.sarea);\r\n\r\n    /*\r\n     manually feed events to boxes so as to work right\r\n     with touch events; note that pushModalLight routes\r\n     touch to mouse events (if no touch handlers are present).\r\n     */\r\n    let n = this.getActiveBox(e.x, e.y);\r\n\r\n    if (n !== undefined) {\r\n      n.setColor(this.hcolor); //\"rgba(250, 250, 250, 0.75)\");\r\n    }\r\n    //console.log(\"mouse move\", n);\r\n\r\n    if (this.boxes.active !== undefined && this.boxes.active !== n) {\r\n      this.boxes.active.setColor(this.color);\r\n      this.boxes.active.dispatchEvent(new MouseEvent(\"mouseleave\", e));\r\n    }\r\n\r\n    if (n !== undefined) {\r\n      n.dispatchEvent(new MouseEvent(\"mouseenter\", e));\r\n    }\r\n\r\n    this.boxes.active = n;\r\n    /*\r\n    let rec = (n) => {\r\n      if (n.hasAttribute && n.hasAttribute(\"is_box\")) {\r\n        let rect = n.getClientRects()[0];\r\n\r\n        console.log(rect.x, rect.y);\r\n        if (x >= rect.x && x >= rect.y && x < rect.x+rect.width && y < rect.y+rect.height) {\r\n          console.log(\"found rect\");\r\n          n.dispatchEvent(\"mouseenter\", new MouseEvent(\"mouseenter\", e));\r\n        }\r\n      }\r\n      if (n === undefined || n.childNodes === undefined) {\r\n        return;\r\n      }\r\n\r\n      for (let n2 of n.childNodes) {\r\n        rec(n2);\r\n      }\r\n      if (n.shadow) {\r\n        for (let n2 of n.shadow.childNodes) {\r\n          rec(n2);\r\n        }\r\n      }\r\n    };\r\n\r\n    rec(this.overdraw);\r\n    //*/\r\n    if (this.sarea === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this.cursorbox === undefined) {\r\n      wid = 25;\r\n      this.cursorbox = this.overdraw.rect([e.x - wid*0.5, e.y - wid*0.5], [wid, wid], color);\r\n      this.cursorbox.style[\"pointer-events\"] = \"none\";\r\n    } else {\r\n      this.cursorbox.style[\"x\"] = (e.x - wid*0.5) + \"px\";\r\n      this.cursorbox.style[\"y\"] = (e.y - wid*0.5) + \"px\";\r\n    }\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    this.on_mouseup(e);\r\n  }\r\n\r\n  on_mouseup(e) {\r\n    console.log(\"e.button\", e.button, e, e.x, e.y, this.getActiveBox(e.x, e.y));\r\n\r\n    if (e.button) {\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n    } else {\r\n      let box = this.getActiveBox(e.x, e.y);\r\n\r\n      if (box !== undefined) {\r\n        box.onclick(e);\r\n      }\r\n    }\r\n\r\n    this.finish();\r\n  }\r\n\r\n  modalStart(ctx) {\r\n    super.modalStart(...arguments);\r\n\r\n    let screen = this.screen;\r\n\r\n    this.overdraw.clear();\r\n\r\n    if (this.sarea && !this.excludeAreas.has(this.sarea)) {\r\n      let sa = this.sarea;\r\n      let box = this.overdraw.rect(sa.pos, sa.size, \"rgba(100, 100, 100, 0.5)\");\r\n\r\n      box.style[\"pointer-events\"] = \"none\";\r\n    }\r\n\r\n    for (let sa of screen.sareas) {\r\n      if (this.excludeAreas.has(sa)) {\r\n        continue;\r\n      }\r\n\r\n      this.makeBoxes(sa);\r\n    }\r\n  }\r\n\r\n  on_keydown(e) {\r\n    switch (e.keyCode){\r\n      case keymap[\"Escape\"]:\r\n      case keymap[\"Enter\"]:\r\n      case keymap[\"Space\"]:\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\n\r\nexport class AreaMoveAttachTool extends AreaDragTool {\r\n  constructor(screen, sarea, mpos) {\r\n    super(screen, sarea, mpos);\r\n\r\n    this.excludeAreas = new Set([sarea]);\r\n\r\n    this.dropArea = true;\r\n    this.first = true;\r\n    this.sarea = sarea;\r\n    this.mpos = new Vector2(mpos);\r\n    this.start_mpos2 = new Vector2(mpos);\r\n    this.start_pos = new Vector2(sarea.pos);\r\n  }\r\n\r\n  on_mousemove(e) {\r\n    let dx = e.x - this.start_mpos2[0];\r\n    let dy = e.y - this.start_mpos2[1];\r\n\r\n    let sarea = this.sarea;\r\n\r\n    if (this.first) {\r\n      this.start_mpos2 = new Vector2([e.x, e.y]);\r\n      this.first = false;\r\n      return;\r\n    }\r\n\r\n\r\n    sarea.pos[0] = this.start_pos[0] + dx;\r\n    sarea.pos[1] = this.start_pos[1] + dy;\r\n\r\n    sarea.loadFromPosSize();\r\n\r\n    this.mpos.loadXY(e.x, e.y);\r\n    super.on_mousemove(e);\r\n  }\r\n\r\n  on_mouseup(e) {\r\n    super.on_mouseup(e);\r\n  }\r\n\r\n  on_mousedown(e) {\r\n    super.on_mousedown(e);\r\n  }\r\n\r\n  on_keydown(e) {\r\n    super.on_keydown(e);\r\n  }\r\n}\r\n\r\n//controller.registerTool(AreaDragTool);\r\n\r\nexport class ToolTipViewer extends ToolBase {\r\n  constructor(screen) {\r\n    super(screen);\r\n\r\n    this.tooltip = undefined;\r\n    this.element = undefined;\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Help Tool\",\r\n      toolpath   : \"screen.help_picker\",\r\n      icon       : ui_base.Icons.HELP,\r\n      description: \"view tooltips\",\r\n      is_modal   : true,\r\n      undoflag   : UndoFlags.NO_UNDO,\r\n      flag       : 0,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n\r\n  on_mousemove(e) {\r\n    this.pick(e);\r\n  }\r\n\r\n  on_mousedown(e) {\r\n    this.pick(e);\r\n  }\r\n\r\n  on_mouseup(e) {\r\n    this.finish();\r\n  }\r\n\r\n  finish() {\r\n    super.finish();\r\n  }\r\n\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case keymap.Escape:\r\n      case keymap.Enter:\r\n      case Keymap.Space:\r\n        if (this.tooltip) {\r\n          this.tooltip.end();\r\n        }\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n\r\n  pick(e) {\r\n    let x = e.x, y = e.y;\r\n\r\n    let ele = this.screen.pickElement(x, y);\r\n    console.log(ele ? ele.tagName : ele);\r\n\r\n    if (ele !== undefined && ele !== this.element && ele.title) {\r\n      if (this.tooltip) {\r\n        this.tooltip.end();\r\n      }\r\n\r\n      this.element = ele;\r\n      let tip = ele.title;\r\n\r\n      this.tooltip = ToolTip.show(tip, this.screen, x, y);\r\n    }\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n  }\r\n}\r\n\r\n","import nstructjs from '../path-controller/util/struct.js';\r\nimport * as ui_base from \"../core/ui_base.js\";\r\nimport * as FrameManager_ops from \"./FrameManager_ops.js\";\r\nimport cconst from \"../config/const.js\";\r\nimport {UIBase} from '../core/ui_base.js';\r\n\r\nimport {Vector2} from '../path-controller/util/vectormath.js';\r\nimport {createMenu, Menu} from '../widgets/ui_menu.js';\r\nimport {popModalLight, pushModalLight} from '../path-controller/util/simple_events.js';\r\n\r\nexport const AreaFlags = {\r\n  HIDDEN                : 1,\r\n  FLOATING              : 2,\r\n  INDEPENDENT           : 4, //area is indpendent of the screen mesh\r\n  NO_SWITCHER           : 8,\r\n  NO_HEADER_CONTEXT_MENU: 16,\r\n  NO_COLLAPSE           : 32,\r\n};\r\n\r\nexport let SnapLimit = 1;\r\n\r\nexport const BORDER_ZINDEX_BASE = 25\r\n\r\nexport function snap(c, snap_limit = SnapLimit) {\r\n  if (Array.isArray(c)) {\r\n    for (let i = 0; i < c.length; i++) {\r\n      c[i] = Math.floor(c[i]/snap_limit)*snap_limit;\r\n    }\r\n  } else {\r\n    c = Math.floor(c/snap_limit)*snap_limit;\r\n  }\r\n\r\n  return c;\r\n}\r\n\r\nexport function snapi(c, snap_limit = SnapLimit) {\r\n  //return snap(c, snap_limit);\r\n\r\n  if (Array.isArray(c)) {\r\n    for (let i = 0; i < c.length; i++) {\r\n      c[i] = Math.ceil(c[i]/snap_limit)*snap_limit;\r\n    }\r\n  } else {\r\n    c = Math.ceil(c/snap_limit)*snap_limit;\r\n  }\r\n\r\n  return c;\r\n}\r\n\r\nexport class ScreenVert extends Vector2 {\r\n  constructor(pos, id, added_id) {\r\n    super(pos);\r\n\r\n    this.added_id = added_id;\r\n    this.sareas = [];\r\n    this.borders = [];\r\n\r\n    this._id = id;\r\n  }\r\n\r\n  static hash(pos, added_id, limit) {\r\n    let x = snap(pos[0], limit);\r\n    let y = snap(pos[1], limit);\r\n\r\n    return \"\" + x + \":\" + y + \": + added_id\";\r\n  }\r\n\r\n  valueOf() {\r\n    return ScreenVert.hash(this, this.added_id);\r\n  }\r\n\r\n  [Symbol.keystr]() {\r\n    return ScreenVert.hash(this, this.added_id);\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n  }\r\n}\r\n\r\nScreenVert.STRUCT = `\r\npathux.ScreenVert {\r\n  0 : float;\r\n  1 : float;\r\n}\r\n`;\r\nnstructjs.register(ScreenVert);\r\n\r\nexport class ScreenHalfEdge {\r\n  constructor(border, sarea) {\r\n    this.sarea = sarea;\r\n    this.border = border;\r\n    this.side = sarea._side(border);\r\n  }\r\n\r\n  get v1() {\r\n    return this.border.v1;\r\n  }\r\n\r\n  get v2() {\r\n    return this.border.v2;\r\n  }\r\n\r\n  [Symbol.keystr]() {\r\n    return this.sarea._id + \":\" + this.border._id;\r\n  }\r\n\r\n}\r\n\r\nexport class ScreenBorder extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.visibleToPick = false;\r\n\r\n    this.screen = undefined;\r\n    this.v1 = undefined;\r\n    this.v2 = undefined;\r\n    this._id = undefined;\r\n\r\n    this._hash = undefined;\r\n\r\n    this.outer = undefined;\r\n\r\n    this.halfedges = []; //all bordering borders, including ones with nonshared verts\r\n    this.sareas = [];\r\n\r\n    this._innerstyle = document.createElement(\"style\");\r\n    this._style = undefined;\r\n\r\n    this.shadow.appendChild(this._innerstyle);\r\n\r\n    this.inner = document.createElement(\"div\");\r\n    //this.inner.innerText = \"sdfsdfsdf\";\r\n    this.shadow.appendChild(this.inner);\r\n\r\n    let call_menu = ScreenBorder.bindBorderMenu(this);\r\n\r\n    this.addEventListener(\"mousedown\", (e) => {\r\n      let ok = this.movable;\r\n\r\n      if (e.button === 2) {\r\n        call_menu(e);\r\n        return;\r\n      }\r\n\r\n      if (!ok) {\r\n        console.log(\"border is not movable\");\r\n        return;\r\n      }\r\n\r\n      console.log(\"area resize start!\");\r\n      let tool = new FrameManager_ops.AreaResizeTool(this.screen, this, [e.x, e.y]);\r\n\r\n      tool.start();\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }, {capture: true});\r\n  }\r\n\r\n  static bindBorderMenu(elem, usePickElement = false) {\r\n    let on_dblclick = (e) => {\r\n      if (usePickElement && elem.pickElement(e.x, e.y) !== elem) {\r\n        return;\r\n      }\r\n\r\n      let menu = [\r\n        [\"Split Area\", () => {\r\n          elem.ctx.screen.splitTool();\r\n        }],\r\n        Menu.SEP,\r\n        [\"Collapse Area\", () => {\r\n          elem.ctx.screen.removeAreaTool(elem instanceof ScreenBorder ? elem : undefined);\r\n        }],\r\n      ];\r\n\r\n      menu = createMenu(elem.ctx, \"\", menu);\r\n      //if (e.button === 2) {\r\n      menu.ignoreFirstClick = 2;\r\n      //}\r\n\r\n      elem.ctx.screen.popupMenu(menu, e.x - 15, e.y - 15);\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n\r\n    elem.addEventListener(\"contextmenu\", (e) => e.preventDefault());\r\n    elem.addEventListener(\"dblclick\", on_dblclick, {capture: true});\r\n\r\n    return on_dblclick;\r\n  }\r\n\r\n  getOtherSarea(sarea) {\r\n    console.log(this.halfedges, this.halfedges.length);\r\n\r\n    for (let he of this.halfedges) {\r\n      console.log(he);\r\n\r\n      let ok = he.sarea !== sarea;\r\n      ok = ok && he.sarea._verts.indexOf(this.v1) >= 0;\r\n      ok = ok && he.sarea._verts.indexOf(this.v2) >= 0;\r\n\r\n      if (ok) {\r\n        return he.sarea;\r\n      }\r\n    }\r\n  }\r\n\r\n  get locked() {\r\n    for (let sarea of this.sareas) {\r\n      let mask = 1<<sarea._borders.indexOf(this);\r\n      let lock = sarea.borderLock & mask;\r\n\r\n      if (lock || (sarea.flag & AreaFlags.NO_COLLAPSE)) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  get dead() {\r\n    return !this.parentNode;\r\n  }\r\n\r\n  get side() {\r\n    throw new Error(\"side accedd\");\r\n  }\r\n\r\n  set side(val) {\r\n    throw new Error(\"side accedd\");\r\n  }\r\n\r\n  get valence() {\r\n    let ret = 0; //this.sareas.length;\r\n    let horiz = this.horiz;\r\n\r\n    let visit = {};\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let sv = i ? this.v2 : this.v1;\r\n      //console.log(sv);\r\n\r\n      for (let sa of sv.borders) {\r\n        if (sa.horiz != this.horiz)\r\n          continue;\r\n        if (sa._id in visit)\r\n          continue;\r\n\r\n        visit[sa._id] = 1;\r\n\r\n        let a0x = Math.min(this.v1[0], this.v2[0]);\r\n        let a0y = Math.min(this.v1[1], this.v2[1]);\r\n        let a1x = Math.max(this.v1[0], this.v2[0]);\r\n        let a1y = Math.max(this.v1[1], this.v2[1]);\r\n\r\n        let b0x = Math.min(sa.v1[0], sa.v2[0]);\r\n        let b0y = Math.min(sa.v1[1], sa.v2[1]);\r\n        let b1x = Math.min(sa.v1[0], sa.v2[0]);\r\n        let b1y = Math.min(sa.v1[1], sa.v2[1]);\r\n\r\n        let ok;\r\n\r\n        let eps = 0.001;\r\n        if (horiz) {\r\n          ok = (a0y <= b1y + eps && a1y >= a0y - eps);\r\n        } else {\r\n          ok = (a0x <= b1x + eps && a1x >= a0x - eps);\r\n        }\r\n\r\n        if (ok) {\r\n          //console.log(\"found\");\r\n          ret += sa.sareas.length;\r\n        }\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  get horiz() {\r\n    let dx = this.v2[0] - this.v1[0];\r\n    let dy = this.v2[1] - this.v1[1];\r\n\r\n    return Math.abs(dx) > Math.abs(dy);\r\n  }\r\n\r\n  static hash(v1, v2) {\r\n    return Math.min(v1._id, v2._id) + \":\" + Math.max(v1._id, v2._id);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"screenborder-x\",\r\n      style  : \"screenborder\"\r\n    };\r\n  }\r\n\r\n  otherVertex(v) {\r\n    if (v === this.v1)\r\n      return this.v2;\r\n    else\r\n      return this.v1;\r\n  }\r\n\r\n  setCSS() {\r\n    this.style[\"pointer-events\"] = this.movable ? \"auto\" : \"none\";\r\n\r\n    if (this._style === undefined) {\r\n      this._style = document.createElement(\"style\");\r\n      this.appendChild(this._style);\r\n    }\r\n\r\n    let dpi = UIBase.getDPI();\r\n\r\n    let pad = this.getDefault(\"mouse-threshold\")/dpi;\r\n    let wid = this.getDefault(\"border-width\");\r\n\r\n    let v1 = this.v1, v2 = this.v2;\r\n    let vec = new Vector2(v2).sub(v1);\r\n\r\n    let x = Math.min(v1[0], v2[0]), y = Math.min(v1[1], v2[1]);\r\n    let w, h;\r\n    let cursor, bstyle;\r\n\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"display\"] = this.horiz ? \"row\" : \"column\";\r\n    this.style[\"justify-content\"] = \"center\";\r\n    this.style[\"align-items\"] = \"center\";\r\n\r\n    if (!this.horiz) {\r\n      this.style[\"padding-left\"] = this.style[\"padding-right\"] = pad + \"px\";\r\n      x -= wid*0.5 + pad;\r\n\r\n      w = wid*2;\r\n      h = Math.abs(vec[1]);\r\n\r\n      cursor = 'e-resize';\r\n      bstyle = \"border-left-style : solid;\\n    border-right-style : solid;\\n\";\r\n      bstyle = \"border-top-style : none;\\n    border-bottom-style : none;\\n\";\r\n    } else {\r\n      this.style[\"padding-top\"] = this.style[\"padding-bottom\"] = pad + \"px\";\r\n      y -= wid*0.5 + pad;\r\n\r\n      w = Math.abs(vec[0]);\r\n      h = wid;\r\n\r\n      cursor = 'n-resize';\r\n      bstyle = \"border-top-style : solid;\\n    border-bottom-style : solid;\\n\";\r\n    }\r\n\r\n\r\n    let color = this.getDefault(\"border-outer\");\r\n    let debug = cconst.DEBUG.screenborders;\r\n\r\n    if (debug) {\r\n      wid = 4;\r\n      let alpha = 1.0;\r\n      let c = this.sareas.length*75;\r\n\r\n      let r = 0, g = 0, b = 0;\r\n\r\n      if (this.movable) {\r\n        b = 255;\r\n      }\r\n      if (this.halfedges.length > 1) {\r\n        g = 255;\r\n      }\r\n      if (this.outer) {\r\n        r = 255;\r\n      }\r\n      color = `rgba(${r}, ${g}, ${b}, ${alpha})`;\r\n    }\r\n\r\n\r\n    let innerbuf = `\r\n        .screenborder_inner_${this._id} {\r\n          ${bstyle}\r\n          ${this.horiz ? 'height' : 'width'} : ${wid}px;\r\n          ${!this.horiz ? 'height' : 'width'} : 100%;\r\n          margin : 0px;\r\n          padding : 0px;\r\n          \r\n          background-color : ${this.getDefault(\"border-inner\")};\r\n          border-color : ${color};\r\n          border-width : ${wid*0.5}px;\r\n          border-style : ${debug && this.outer ? \"dashed\" : \"solid\"};\r\n          pointer-events : none;\r\n        }`;\r\n\r\n    let sbuf = `\r\n        .screenborder_${this._id} {\r\n        }\r\n    `;\r\n\r\n    let ok = this.movable;\r\n    if (!this.outer) {\r\n      for (let sarea of this.sareas) {\r\n        ok = ok || sarea.floating;\r\n      }\r\n    }\r\n\r\n    if (ok) {\r\n      sbuf += `\r\n        .screenborder_${this._id}:hover {\r\n          cursor : ${cursor};\r\n        }\r\n      `;\r\n    }\r\n\r\n    this._style.textContent = sbuf;\r\n    this._innerstyle.textContent = innerbuf;\r\n\r\n    this.setAttribute(\"class\", \"screenborder_\" + this._id);\r\n    this.inner.setAttribute(\"class\", \"screenborder_inner_\" + this._id);\r\n\r\n    this.style[\"position\"] = UIBase.PositionKey;\r\n    this.style[\"left\"] = x + \"px\";\r\n    this.style[\"top\"] = y + \"px\";\r\n    this.style[\"width\"] = w + \"px\";\r\n    this.style[\"height\"] = h + \"px\";\r\n    this.style[\"z-index\"] = \"\" + BORDER_ZINDEX_BASE;\r\n  }\r\n\r\n  valueOf() {\r\n    return ScreenBorder.hash(this.v1, this.v2);\r\n  }\r\n\r\n  [Symbol.keystr]() {\r\n    return ScreenBorder.hash(this.v1, this.v2);\r\n  }\r\n}\r\n\r\nui_base.UIBase.internalRegister(ScreenBorder);\r\n","let _ScreenArea = undefined;\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as ui from '../core/ui.js';\r\nimport * as ui_noteframe from '../widgets/ui_noteframe.js';\r\nimport {haveModal} from '../path-controller/util/simple_events.js';\r\nimport cconst from '../config/const.js';\r\n\r\nimport nstructjs from '../path-controller/util/struct.js';\r\n\r\nlet UIBase = ui_base.UIBase;\r\n\r\nimport {EnumProperty} from \"../path-controller/toolsys/toolprop.js\";\r\n\r\nlet Vector2 = vectormath.Vector2;\r\nlet Screen = undefined;\r\n\r\nimport {AreaFlags, BORDER_ZINDEX_BASE, ScreenBorder, snap, snapi} from './FrameManager_mesh.js';\r\n\r\nexport {AreaFlags};\r\n\r\nexport * from './area_wrangler.js';\r\nimport {getAreaIntName, setAreaTypes, contextWrangler, AreaWrangler, areaclasses} from './area_wrangler.js';\r\n\r\nexport {contextWrangler};\r\n\r\nwindow._contextWrangler = contextWrangler;\r\n\r\nexport const BorderMask = {\r\n  LEFT  : 1,\r\n  BOTTOM: 2,\r\n  RIGHT : 4,\r\n  TOP   : 8,\r\n  ALL   : 1 | 2 | 4 | 8\r\n};\r\n\r\nexport const BorderSides = {\r\n  LEFT  : 0,\r\n  BOTTOM: 1,\r\n  RIGHT : 2,\r\n  TOP   : 3\r\n};\r\n\r\n/**\r\n * Base class for all editors\r\n **/\r\nexport class Area extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    /**\r\n     * -----b4----\r\n     *\r\n     * b1       b3\r\n     *\r\n     * -----b2----\r\n     *\r\n     * */\r\n\r\n    let def = this.constructor.define();\r\n\r\n    //set bits in mask to keep\r\n    //borders from moving\r\n    this.borderLock = def.borderLock || 0;\r\n    this.flag = def.flag || 0;\r\n\r\n    this.inactive = true;\r\n    this.areaDragToolEnabled = true;\r\n\r\n    this.owning_sarea = undefined;\r\n    this._area_id = contextWrangler.idgen++;\r\n\r\n    this.pos = undefined; //set by screenarea parent\r\n    this.size = undefined; //set by screenarea parent\r\n    this.minSize = [5, 5];\r\n    this.maxSize = [undefined, undefined];\r\n\r\n    let appendChild = this.shadow.appendChild;\r\n    this.shadow.appendChild = (child) => {\r\n      appendChild.call(this.shadow, child);\r\n      if (child instanceof UIBase) {\r\n        child.parentWidget = this;\r\n      }\r\n    }\r\n\r\n    let prepend = this.shadow.prepend;\r\n    this.shadow.prepend = (child) => {\r\n      prepend.call(this.shadow, child);\r\n\r\n      if (child instanceof UIBase) {\r\n        child.parentWidget = this;\r\n      }\r\n    };\r\n  }\r\n\r\n  get floating() {\r\n    return ~~(this.flag & AreaFlags.FLOATING);\r\n  }\r\n\r\n  set floating(val) {\r\n    if (val) {\r\n      this.flag |= AreaFlags.FLOATING;\r\n    } else {\r\n      this.flag &= ~AreaFlags.FLOATING;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get active area as defined by push_ctx_active and pop_ctx_active.\r\n   *\r\n   * Type should be an Area subclass, if undefined the last accessed area\r\n   * will be returned.\r\n   * */\r\n  static getActiveArea(type) {\r\n    return contextWrangler.getLastArea(type);\r\n  }\r\n\r\n  static unregister(cls) {\r\n    let def = cls.define();\r\n\r\n    if (!def.areaname) {\r\n      throw new Error(\"Missing areaname key in define()\");\r\n    }\r\n\r\n    if (def.areaname in areaclasses) {\r\n      delete areaclasses[def.areaname];\r\n    }\r\n  }\r\n\r\n  /*\r\n  addEventListener(type, cb, options) {\r\n    let cb2 = (e) => {\r\n      let x, y;\r\n      let screen = this.getScreen();\r\n\r\n      if (!screen) {\r\n        console.warn(\"no screen!\");\r\n        return cb(elem);\r\n      }\r\n\r\n      if (type.startsWith(\"mouse\")) {\r\n        x = e.x; y = e.y;\r\n      } else if (type.startsWith(\"touch\") && e.touches && e.touches.length > 0) {\r\n        x = e.touches[0].pageX; y = e.touches[0].pageY;\r\n      } else if (type.startsWith(\"pointer\")) {\r\n        x = e.x; y = e.y;\r\n      } else {\r\n        if (screen) {\r\n          x = screen.mpos[0];\r\n          y = screen.mpos[1];\r\n        } else {\r\n          x = y = -100;\r\n        }\r\n      }\r\n\r\n      let elem = screen.pickElement(x, y);\r\n      console.log(elem ? elem.tagName : undefined);\r\n\r\n      if (elem === this || elem === this.owning_sarea) {\r\n        return cb(elem);\r\n      }\r\n    };\r\n\r\n    cb.__cb2 = cb2;\r\n    return super.addEventListener(type, cb2, options);\r\n  }\r\n\r\n  removeEventListener(type, cb, options) {\r\n    super.removeEventListener(type, cb.__cb2, options);\r\n  }\r\n  //*/\r\n\r\n  static register(cls) {\r\n    let def = cls.define();\r\n\r\n    if (!def.areaname) {\r\n      throw new Error(\"Missing areaname key in define()\");\r\n    }\r\n\r\n    areaclasses[def.areaname] = cls;\r\n\r\n    ui_base.UIBase.internalRegister(cls);\r\n  }\r\n\r\n  static makeAreasEnum() {\r\n    let areas = {};\r\n    let icons = {};\r\n    let i = 0;\r\n\r\n    for (let k in areaclasses) {\r\n      let cls = areaclasses[k];\r\n      let def = cls.define();\r\n\r\n      if (def.flag & AreaFlags.HIDDEN)\r\n        continue;\r\n\r\n      let uiname = def.uiname;\r\n\r\n      if (uiname === undefined) {\r\n        uiname = k.replace(\"_\", \" \").toLowerCase();\r\n        uiname = uiname[0].toUpperCase() + uiname.slice(1, uiname.length);\r\n      }\r\n\r\n      areas[uiname] = k;\r\n      icons[uiname] = def.icon !== undefined ? def.icon : -1;\r\n    }\r\n\r\n    let prop = new EnumProperty(undefined, areas);\r\n    prop.addIcons(icons);\r\n\r\n    return prop;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname : \"pathux-editor-x\", // tag name, e.g. editor-x\r\n      areaname: undefined, //api name for area type\r\n      flag    : 0, //see AreaFlags\r\n      uiname  : undefined,\r\n      icon    : undefined //icon representing area in MakeHeader's area switching menu. Integer.\r\n    };\r\n  }\r\n\r\n  static newSTRUCT() {\r\n    return UIBase.createElement(this.define().tagname);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"overflow\"] = \"hidden\";\r\n    this.noMarginsOrPadding();\r\n\r\n    let onover = (e) => {\r\n      //console.log(this._area_id, this.ctx.workspace._area_id);\r\n\r\n      //try to trigger correct entry in context area stacks\r\n      this.push_ctx_active();\r\n      this.pop_ctx_active();\r\n    };\r\n\r\n    //*\r\n    super.addEventListener(\"mouseover\", onover, {passive: true});\r\n    super.addEventListener(\"mousemove\", onover, {passive: true});\r\n    super.addEventListener(\"mousein\", onover, {passive: true});\r\n    super.addEventListener(\"mouseenter\", onover, {passive: true});\r\n    super.addEventListener(\"touchstart\", onover, {passive: true});\r\n    super.addEventListener(\"focusin\", onover, {passive: true});\r\n    super.addEventListener(\"focus\", onover, {passive: true});\r\n    //*/\r\n  }\r\n\r\n  _get_v_suffix() {\r\n    if (this.flag & AreaFlags.INDEPENDENT) {\r\n      return this._id;\r\n    } else {\r\n      return \"\";\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Return a list of keymaps used by this editor\r\n   * @returns {Array<KeyMap>}\r\n   */\r\n  getKeyMaps() {\r\n    return this.keymap !== undefined ? [this.keymap] : [];\r\n  }\r\n\r\n  on_fileload(isActiveEditor) {\r\n    contextWrangler.reset();\r\n  }\r\n\r\n  buildDataPath() {\r\n    let p = this;\r\n\r\n    let sarea = this.owning_sarea;\r\n\r\n    if (sarea === undefined || sarea.screen === undefined) {\r\n      console.warn(\"Area.buildDataPath(): Failed to build data path\");\r\n      return \"\";\r\n    }\r\n\r\n    let screen = sarea.screen;\r\n\r\n    let idx1 = screen.sareas.indexOf(sarea);\r\n    let idx2 = sarea.editors.indexOf(this);\r\n\r\n    if (idx1 < 0 || idx2 < 0) {\r\n      throw new Error(\"malformed area data\");\r\n    }\r\n\r\n    let ret = `screen.sareas[${idx1}].editors[${idx2}]`;\r\n    return ret;\r\n  }\r\n\r\n  saveData() {\r\n    return {\r\n      _area_id: this._area_id,\r\n      areaName: this.areaName\r\n    };\r\n  }\r\n\r\n  loadData(obj) {\r\n    let id = obj._area_id;\r\n\r\n    if (id !== undefined && id !== null) {\r\n      this._area_id = id;\r\n    }\r\n  }\r\n\r\n  draw() {\r\n  }\r\n\r\n  copy() {\r\n    console.warn(\"You might want to implement this, Area.prototype.copy based method called\");\r\n    let ret = UIBase.createElement(this.constructor.define().tagname);\r\n    return ret;\r\n  }\r\n\r\n  on_resize(size, oldsize) {\r\n    super.on_resize(size, oldsize);\r\n  }\r\n\r\n  on_area_focus() {\r\n\r\n  }\r\n\r\n  on_area_blur() {\r\n\r\n  }\r\n\r\n  /** called when editors are swapped with another editor type*/\r\n  on_area_active() {\r\n  }\r\n\r\n  /** called when editors are swapped with another editor type*/\r\n  on_area_inactive() {\r\n  }\r\n\r\n  /*\r\n  * This is needed so UI controls can know what their parent area is.\r\n  * For example, a slider with data path \"view2d.zoomfac\" needs to know where\r\n  * to find view2d.\r\n  *\r\n  * Typically this works by adding a field to a ContextOverlay:\r\n  *\r\n  * class ContextOverlay {\r\n  *   get view3d() {\r\n  *     return Area.getActiveArea(View3D);\r\n  *   }\r\n  * }\r\n  *\r\n  * Make sure to wrap event callbacks in push_ctx_active and pop_ctx_active.\r\n  * */\r\n  push_ctx_active(dontSetLastRef = false) {\r\n    contextWrangler.push(this.constructor, this, !dontSetLastRef);\r\n  }\r\n\r\n  /**\r\n   * see push_ctx_active\r\n   * */\r\n  pop_ctx_active(dontSetLastRef = false) {\r\n    contextWrangler.pop(this.constructor, this, !dontSetLastRef);\r\n  }\r\n\r\n  getScreen() {\r\n    //XXX\r\n    //return _appstate.screen;\r\n    throw new Error(\"replace me in Area.prototype\");\r\n  }\r\n\r\n  toJSON() {\r\n    return Object.assign(super.toJSON(), {\r\n      areaname: this.constructor.define().areaname,\r\n      _area_id: this._area_id\r\n    });\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n    this._area_id = obj._area_id;\r\n\r\n    return this;\r\n  }\r\n\r\n  getBarHeight() {\r\n    return this.header.getClientRects()[0].height;\r\n  }\r\n\r\n  makeAreaSwitcher(container) {\r\n    if (cconst.useAreaTabSwitcher) {\r\n      let ret = UIBase.createElement(\"area-docker-x\");\r\n      container.add(ret);\r\n      return ret;\r\n    }\r\n\r\n    let prop = Area.makeAreasEnum();\r\n\r\n    let dropbox = container.listenum(undefined, {\r\n      name    : this.constructor.define().uiname,\r\n      enumDef : prop,\r\n      callback: (id) => {\r\n        let cls = areaclasses[id];\r\n        this.owning_sarea.switch_editor(cls);\r\n      }\r\n    });\r\n\r\n    dropbox.update.after(() => {\r\n      let name = this.constructor.define().uiname;\r\n      let val = prop.values[name];\r\n\r\n      if (dropbox.value !== val && val in prop.keys) {\r\n        val = prop.keys[val];\r\n      }\r\n\r\n      if (dropbox.value !== val) {\r\n        dropbox.setValue(prop.values[name], true);\r\n      }\r\n    });\r\n\r\n    return dropbox;\r\n  }\r\n\r\n  makeHeader(container, add_note_area = true, make_draggable = true) {\r\n    let switcherRow;\r\n    let row;\r\n    let helpRow;\r\n\r\n    if (!(this.flag & AreaFlags.NO_SWITCHER) && cconst.useAreaTabSwitcher) {\r\n      let col = this.header = container.col();\r\n\r\n      switcherRow = helpRow = col.row();\r\n      row = col.row();\r\n    } else {\r\n      row = helpRow = this.header = container.row();\r\n    }\r\n\r\n    if (!(this.flag & AreaFlags.NO_HEADER_CONTEXT_MENU)) {\r\n      let callmenu = ScreenBorder.bindBorderMenu(this.header, true);\r\n\r\n      this.addEventListener(\"mousedown\", e => {\r\n        if (e.button !== 2 || this.header.pickElement(e.x, e.y) !== this.header) {\r\n          return;\r\n        }\r\n\r\n        callmenu(e);\r\n      });\r\n    }\r\n\r\n    this.header.remove();\r\n    container._prepend(this.header);\r\n\r\n    row.setCSS.after(() => row.background = this.getDefault(\"AreaHeaderBG\"));\r\n\r\n    let rh = ~~(16*this.getDPI());\r\n\r\n    //container.setSize(undefined, rh);\r\n    //row.setSize(undefined, rh);\r\n    //row.setSize(undefined, rh);\r\n\r\n    container.noMarginsOrPadding();\r\n    row.noMarginsOrPadding();\r\n\r\n    row.style[\"width\"] = \"100%\";\r\n    row.style[\"margin\"] = \"0px\";\r\n    row.style[\"padding\"] = \"0px\";\r\n\r\n    if (!(this.flag & AreaFlags.NO_SWITCHER)) {\r\n      if (this.switcher) {\r\n        //add back same switcher\r\n        switcherRow.add(this.switcher);\r\n      } else {\r\n        this.switcher = this.makeAreaSwitcher(cconst.useAreaTabSwitcher ? switcherRow : row);\r\n      }\r\n    }\r\n\r\n    if (util.isMobile() || cconst.addHelpPickers) {\r\n      if (this.helppicker) {\r\n        this.helppicker.remove();\r\n      }\r\n\r\n      this.helppicker = helpRow.helppicker();\r\n      this.helppicker.iconsheet = 0;\r\n    }\r\n\r\n    if (add_note_area) {\r\n      let notef = UIBase.createElement(\"noteframe-x\");\r\n      notef.ctx = this.ctx;\r\n      row._add(notef);\r\n    }\r\n\r\n    /* don't do normal dragging for tab switchers */\r\n    if (cconst.useAreaTabSwitcher) {\r\n      return row;\r\n    }\r\n\r\n    let eventdom = this.header;\r\n\r\n    let mdown = false;\r\n    let mpos = new Vector2();\r\n\r\n    let mpre = (e, pageX, pageY) => {\r\n      if (haveModal()) {\r\n        return;\r\n      }\r\n\r\n      pageX = pageX === undefined ? e.x : pageX;\r\n      pageY = pageY === undefined ? e.y : pageY;\r\n\r\n      let node = this.getScreen().pickElement(pageX, pageY);\r\n\r\n      /*\r\n      while (node) {\r\n        if (node === row) {\r\n          break;\r\n        }\r\n        node = node.parentWidget;\r\n      }//*/\r\n\r\n      //console.log(node === row, node ? node._id : undefined, row._id)\r\n\r\n      if (node !== row) {\r\n        return false;\r\n      }\r\n\r\n      return true;\r\n    }\r\n\r\n    eventdom.addEventListener(\"pointerout\", (e) => {\r\n      //console.log(\"pointerout\", e);\r\n      mdown = false;\r\n    });\r\n    eventdom.addEventListener(\"pointerleave\", (e) => {\r\n      mdown = false;\r\n      //console.log(\"pointerleave\", e);\r\n    });\r\n\r\n    eventdom.addEventListener(\"pointerdown\", (e) => {\r\n      //console.log(\"pointerdown\", e, mpre(e));\r\n\r\n      if (!mpre(e)) return;\r\n\r\n      mpos[0] = e.pageX;\r\n      mpos[1] = e.pageY;\r\n      mdown = true;\r\n    });\r\n\r\n    let last_time = util.time_ms();\r\n\r\n    let do_mousemove = (e, pageX, pageY) => {\r\n      if (haveModal() || !make_draggable) {\r\n        return;\r\n      }\r\n\r\n      let mdown2 = e.buttons !== 0 || (e.touches && e.touches.length > 0);\r\n      mdown2 = mdown2 && mdown;\r\n\r\n      //console.log(\"area drag?\", e, mdown2, e.pageX, e.pageY, mpre(e, pageX, pageY), e.was_touch);\r\n\r\n      //calls to pickElement in mpre are expensive\r\n      if (util.time_ms() - last_time < 250) {\r\n        return;\r\n      }\r\n\r\n      last_time = util.time_ms;\r\n\r\n      if (!mdown2 || !mpre(e, pageX, pageY)) return;\r\n\r\n\r\n      if (e.type === \"mousemove\" && e.was_touch) {\r\n        //okay how are patched events getting here?\r\n        //avoid double call. . .\r\n        return;\r\n      }\r\n\r\n      //console.log(mdown);\r\n      let dx = pageX - mpos[0];\r\n      let dy = pageY - mpos[1];\r\n\r\n      let dis = dx*dx + dy*dy;\r\n      let limit = 7;\r\n\r\n      if (dis > limit*limit) {\r\n        let sarea = this.owning_sarea;\r\n        if (sarea === undefined) {\r\n          console.warn(\"Error: missing sarea ref\");\r\n          return;\r\n        }\r\n\r\n        let screen = sarea.screen;\r\n        if (screen === undefined) {\r\n          console.log(\"Error: missing screen ref\");\r\n          return;\r\n        }\r\n\r\n        if (!this.areaDragToolEnabled) {\r\n          return;\r\n        }\r\n        mdown = false;\r\n        console.log(\"area drag tool!\", e.type, e);\r\n        screen.areaDragTool(this.owning_sarea);\r\n      }\r\n    };\r\n\r\n    //not working on mobile\r\n    //row.setAttribute(\"draggable\", true);\r\n    //row.draggable = true;\r\n    /*\r\n    eventdom.addEventListener(\"dragstart\", (e) => {\r\n      return;\r\n      console.log(\"drag start!\", e);\r\n      e.dataTransfer.setData(\"text/json\", \"SplitAreaDrag\");\r\n\r\n      let canvas = document.createElement(\"canvas\");\r\n      let g = canvas.g;\r\n\r\n      canvas.width = 32;\r\n      canvas.height = 32;\r\n\r\n      e.dataTransfer.setDragImage(canvas, 0, 0);\r\n\r\n      mdown = false;\r\n      console.log(\"area drag tool!\");\r\n      this.getScreen().areaDragTool(this.owning_sarea);\r\n    });\r\n\r\n    eventdom.addEventListener(\"drag\", (e) => {\r\n      console.log(\"drag!\", e);\r\n    });*/\r\n\r\n    eventdom.addEventListener(\"pointermove\", (e) => {\r\n      return do_mousemove(e, e.pageX, e.pageY);\r\n    }, false);\r\n    eventdom.addEventListener(\"pointerup\", (e) => {\r\n      console.log(\"pointerup\", e);\r\n      mdown = false;\r\n    }, false);\r\n    eventdom.addEventListener(\"pointercancel\", (e) => {\r\n      console.log(\"pointercancel\", e);\r\n      mdown = false;\r\n    }, false);\r\n\r\n    return row;\r\n  }\r\n\r\n  setCSS() {\r\n    if (this.size !== undefined) {\r\n      this.style[\"position\"] = UIBase.PositionKey;\r\n      //this.style[\"left\"] = this.pos[0] + \"px\";\r\n      //this.style[\"top\"] = this.pos[1] + \"px\";\r\n      this.style[\"width\"] = this.size[0] + \"px\";\r\n      this.style[\"height\"] = this.size[1] + \"px\";\r\n    }\r\n  }\r\n\r\n  update() {\r\n    //don't update non-active editors\r\n    if (this.owning_sarea === undefined || this !== this.owning_sarea.area) {\r\n      return;\r\n    }\r\n\r\n    super.update();\r\n\r\n    //see FrameManager.js, we use a single update\r\n    //function for everything now\r\n    //this._forEachChildWidget((n) => {\r\n    //  n.update();\r\n    //});\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n  }\r\n\r\n  _isDead() {\r\n    if (this.dead) {\r\n      return true;\r\n    }\r\n\r\n    let screen = this.getScreen();\r\n\r\n    if (screen === undefined)\r\n      return true;\r\n\r\n    if (screen.parentNode === undefined)\r\n      return true;\r\n  }\r\n\r\n  //called by owning ScreenArea on file load\r\n  afterSTRUCT() {\r\n    let f = () => {\r\n      if (this._isDead()) {\r\n        return;\r\n      }\r\n      if (!this.ctx) {\r\n        this.doOnce(f);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        ui_base.loadUIData(this, this.saved_uidata);\r\n        this.saved_uidata = undefined;\r\n      } catch (error) {\r\n        console.log(\"failed to load ui data\");\r\n        util.print_stack(error);\r\n      }\r\n    };\r\n\r\n    this.doOnce(f);\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n  }\r\n\r\n  _getSavedUIData() {\r\n    return ui_base.saveUIData(this, \"area\");\r\n  }\r\n}\r\n\r\nArea.STRUCT = `\r\npathux.Area { \r\n  flag : int;\r\n  saved_uidata : string | obj._getSavedUIData();\r\n}\r\n`\r\n\r\nnstructjs.register(Area, \"pathux.Area\");\r\nui_base.UIBase.internalRegister(Area);\r\n\r\nexport class ScreenArea extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._flag = undefined;\r\n\r\n    this.flag = 0; /** holds AreaFlags.FLOATING and AreaFlags.INDEPENDENT */\r\n\r\n    this._borders = [];\r\n    this._verts = [];\r\n    this.dead = false;\r\n\r\n    this._sarea_id = contextWrangler.idgen++;\r\n\r\n    this._pos = new Vector2();\r\n    this._size = new Vector2([512, 512]);\r\n\r\n    if (cconst.DEBUG.screenAreaPosSizeAccesses) {\r\n      let wrapVector = (name, axis) => {\r\n        Object.defineProperty(this[name], axis, {\r\n          get: function () {\r\n            return this[\"_\" + axis];\r\n          },\r\n\r\n          set: function (val) {\r\n            console.warn(`ScreenArea.${name}[${axis}] set:`, val);\r\n            this[\"_\" + axis] = val;\r\n          }\r\n        });\r\n      };\r\n\r\n      wrapVector(\"size\", 0);\r\n      wrapVector(\"size\", 1);\r\n      wrapVector(\"pos\", 0);\r\n      wrapVector(\"pos\", 1);\r\n    }\r\n\r\n    this.area = undefined;\r\n    this.editors = [];\r\n    this.editormap = {};\r\n\r\n    this.addEventListener(\"mouseover\", (e) => {\r\n      if (haveModal()) {\r\n        return;\r\n      }\r\n\r\n      //console.log(\"screen area mouseover\");\r\n      let screen = this.getScreen();\r\n      if (screen.sareas.active !== this && screen.sareas.active && screen.sareas.active.area) {\r\n        screen.sareas.active.area.on_area_blur();\r\n      }\r\n\r\n      if (this.area && screen.sareas.active !== this) {\r\n        this.area.on_area_focus();\r\n      }\r\n\r\n      screen.sareas.active = this;\r\n    });\r\n\r\n    //this.addEventListener(\"mouseleave\", (e) => {\r\n    //console.log(\"screen area mouseleave\");\r\n    //});\r\n  }\r\n\r\n  /*\r\n  saveData() {\r\n    return {\r\n      _sarea_id : this._sarea_id,\r\n      pos       : this.pos,\r\n      size      : this.size,\r\n    };\r\n  }\r\n  loadData(obj) {\r\n    super.loadData(obj);\r\n\r\n    let id = obj._sarea_id;\r\n    \r\n    let type = obj.areatype;\r\n    \r\n    if (id !== undefined && id !== null) {\r\n      this._sarea_id = id;\r\n    }\r\n    \r\n    for (let area of this.editors) {\r\n      if (area.areaType == type) {\r\n        console.log(\"             found saved area type\");\r\n        \r\n        this.switch_editor(area.constructor);\r\n      }\r\n    }\r\n    \r\n    this.pos.load(obj.pos);\r\n    this.size.load(obj.size);\r\n  }//*/\r\n\r\n  get floating() {\r\n    return this.flag & AreaFlags.FLOATING;\r\n  }\r\n\r\n  set floating(val) {\r\n    if (val) {\r\n      this.flag |= AreaFlags.FLOATING;\r\n    } else {\r\n      this.flag &= ~AreaFlags.FLOATING;\r\n    }\r\n  }\r\n\r\n  get flag() {\r\n    let flag = this._flag & (AreaFlags.FLOATING | AreaFlags.INDEPENDENT);\r\n\r\n    if (this.area) {\r\n      flag |= this.area.flag;\r\n    }\r\n\r\n    return flag;\r\n  }\r\n\r\n  set flag(v) {\r\n    this._flag &= ~(AreaFlags.FLOATING | AreaFlags.INDEPENDENT);\r\n    this._flag |= v & (AreaFlags.FLOATING | AreaFlags.INDEPENDENT);\r\n\r\n    if (this.area) {\r\n      this.area.flag |= v & ~(AreaFlags.FLOATING | AreaFlags.INDEPENDENT);\r\n    }\r\n  }\r\n\r\n  get borderLock() {\r\n    return this.area !== undefined ? this.area.borderLock : 0;\r\n  }\r\n\r\n  get minSize() {\r\n    return this.area !== undefined ? this.area.minSize : this.size;\r\n  }\r\n\r\n  get maxSize() {\r\n    return this.area !== undefined ? this.area.maxSize : this.size;\r\n  }\r\n\r\n  get pos() {\r\n    return this._pos;\r\n  }\r\n\r\n  set pos(val) {\r\n    if (cconst.DEBUG.screenAreaPosSizeAccesses) {\r\n      console.log(\"ScreenArea set pos\", val);\r\n    }\r\n    this._pos.load(val);\r\n  }\r\n\r\n  get size() {\r\n    return this._size;\r\n  }\r\n\r\n  set size(val) {\r\n    if (cconst.DEBUG.screenAreaPosSizeAccesses) {\r\n      console.log(\"ScreenArea set size\", val);\r\n    }\r\n    this._size.load(val);\r\n  }\r\n\r\n  static newSTRUCT() {\r\n    return UIBase.createElement(\"screenarea-x\");\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"screenarea-x\"\r\n    };\r\n  }\r\n\r\n  _get_v_suffix() {\r\n    return this.area ? this.area._get_v_suffix() : \"\";\r\n  }\r\n\r\n  bringToFront() {\r\n    let screen = this.getScreen();\r\n\r\n    HTMLElement.prototype.remove.call(this);\r\n    screen.sareas.remove(this);\r\n\r\n    screen.appendChild(this);\r\n\r\n    let zindex = BORDER_ZINDEX_BASE + 1;\r\n\r\n    if (screen.style[\"z-index\"]) {\r\n      zindex = parseInt(screen.style[\"z-index\"]) + 1;\r\n    }\r\n\r\n    for (let sarea of screen.sareas) {\r\n      let zindex = sarea.style[\"z-index\"];\r\n      if (sarea.style[\"z-index\"]) {\r\n        zindex = Math.max(zindex, parseInt(sarea.style[\"z-index\"]) + 1);\r\n      }\r\n    }\r\n\r\n    this.style[\"z-index\"] = zindex;\r\n  }\r\n\r\n  _side(border) {\r\n    let ret = this._borders.indexOf(border);\r\n    if (ret < 0) {\r\n      throw new Error(\"border not in screen area\");\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.noMarginsOrPadding();\r\n  }\r\n\r\n  draw() {\r\n    if (this.area && this.area.draw) {\r\n      this.area.push_ctx_active();\r\n      this.area.draw();\r\n      this.area.pop_ctx_active();\r\n    }\r\n  }\r\n\r\n  _isDead() {\r\n    if (this.dead) {\r\n      return true;\r\n    }\r\n\r\n    let screen = this.getScreen();\r\n\r\n    if (screen === undefined)\r\n      return true;\r\n\r\n    if (screen.parentNode === undefined)\r\n      return true;\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = {\r\n      editors  : this.editors,\r\n      _sarea_id: this._sarea_id,\r\n      area     : this.area.constructor.define().areaname,\r\n      pos      : this.pos,\r\n      size     : this.size\r\n    };\r\n\r\n    return Object.assign(super.toJSON(), ret);\r\n  }\r\n\r\n  on_keydown(e) {\r\n    if (this.area.on_keydown) {\r\n      this.area.push_ctx_active();\r\n      this.area.on_keydown(e);\r\n      this.area.pop_ctx_active();\r\n    }\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    if (obj === undefined) {\r\n      console.warn(\"undefined in loadJSON\");\r\n      return;\r\n    }\r\n\r\n    super.loadJSON(obj);\r\n\r\n    this.pos.load(obj.pos);\r\n    this.size.load(obj.size);\r\n\r\n    for (let editor of obj.editors) {\r\n      let areaname = editor.areaname;\r\n\r\n      //console.log(editor);\r\n\r\n      let tagname = areaclasses[areaname].define().tagname;\r\n      let area = UIBase.createElement(tagname);\r\n\r\n      area.owning_sarea = this;\r\n      this.editormap[areaname] = area;\r\n      this.editors.push(this.editormap[areaname]);\r\n\r\n      area.pos = new Vector2(obj.pos);\r\n      area.size = new Vector2(obj.size);\r\n      area.ctx = this.ctx;\r\n\r\n      area.inactive = true;\r\n      area.loadJSON(editor);\r\n      area.owning_sarea = undefined;\r\n\r\n      if (areaname === obj.area) {\r\n        this.area = area;\r\n      }\r\n    }\r\n\r\n    if (this.area !== undefined) {\r\n      this.area.ctx = this.ctx;\r\n      this.area.style[\"width\"] = \"100%\";\r\n      this.area.style[\"height\"] = \"100%\";\r\n      this.area.owning_sarea = this;\r\n      this.area.parentWidget = this;\r\n\r\n      this.area.pos = this.pos;\r\n      this.area.size = this.size;\r\n\r\n      this.area.inactive = false;\r\n      this.shadow.appendChild(this.area);\r\n      this.area.on_area_active();\r\n      this.area.onadd();\r\n    }\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  _ondestroy() {\r\n    super._ondestroy();\r\n\r\n    this.dead = true;\r\n\r\n    for (let editor of this.editors) {\r\n      if (editor === this.area) continue;\r\n\r\n      editor._ondestroy();\r\n    }\r\n  }\r\n\r\n  getScreen() {\r\n    if (this.screen !== undefined) {\r\n      return this.screen;\r\n    }\r\n\r\n    //try to walk up graph, if possible\r\n    let p = this.parentNode;\r\n    let _i = 0;\r\n\r\n    while (p && !(p instanceof Screen) && p !== p.parentNode) {\r\n      p = this.parentNode;\r\n\r\n      if (_i++ > 1000) {\r\n        console.warn(\"infinite loop detected in ScreenArea.prototype.getScreen()\");\r\n        return undefined;\r\n      }\r\n    }\r\n\r\n    return p && p instanceof Screen ? p : undefined;\r\n  }\r\n\r\n  copy(screen) {\r\n    let ret = UIBase.createElement(\"screenarea-x\");\r\n\r\n    ret.screen = screen;\r\n    ret.ctx = this.ctx;\r\n\r\n    ret.pos[0] = this.pos[0];\r\n    ret.pos[1] = this.pos[1];\r\n\r\n    ret.size[0] = this.size[0];\r\n    ret.size[1] = this.size[1];\r\n\r\n    for (let area of this.editors) {\r\n      let cpy = area.copy();\r\n\r\n      cpy.ctx = this.ctx;\r\n\r\n      cpy.parentWidget = ret;\r\n      ret.editors.push(cpy);\r\n      ret.editormap[cpy.constructor.define().areaname] = cpy;\r\n\r\n      if (area === this.area) {\r\n        ret.area = cpy;\r\n      }\r\n    }\r\n\r\n    //console.trace(\"RET.AREA\", this.area, ret.area);\r\n\r\n    ret.ctx = this.ctx;\r\n\r\n    if (ret.area !== undefined) {\r\n      ret.area.ctx = this.ctx;\r\n\r\n      ret.area.pos = ret.pos;\r\n      ret.area.size = ret.size;\r\n      ret.area.owning_sarea = ret;\r\n      ret.area.parentWidget = ret;\r\n\r\n      ret.shadow.appendChild(ret.area);\r\n      //ret.area.onadd();\r\n\r\n      if (ret.area._init_done) {\r\n        ret.area.push_ctx_active();\r\n        ret.area.on_area_active();\r\n        ret.area.pop_ctx_active();\r\n      } else {\r\n        ret.doOnce(() => {\r\n          if (this.dead) {\r\n            return;\r\n          }\r\n          ret._init();\r\n          ret.area._init();\r\n          ret.area.push_ctx_active();\r\n          ret.area.on_area_active();\r\n          ret.area.pop_ctx_active();\r\n        });\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  snapToScreenSize() {\r\n    let screen = this.getScreen();\r\n    let co = new Vector2();\r\n    let changed = 0;\r\n\r\n    for (let v of this._verts) {\r\n      co.load(v);\r\n\r\n      v[0] = Math.min(Math.max(v[0], 0), screen.size[0]);\r\n      v[1] = Math.min(Math.max(v[1], 0), screen.size[1]);\r\n\r\n      if (co.vectorDistance(v) > 0.1) {\r\n        changed = 1;\r\n      }\r\n    }\r\n\r\n    if (changed) {\r\n      this.loadFromVerts();\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Sets screen verts from pos/size\r\n   * */\r\n  loadFromPosSize() {\r\n    if (this.floating && this._verts.length > 0) {\r\n      let p = this.pos, s = this.size;\r\n\r\n      this._verts[0].loadXY(p[0], p[1]);\r\n      this._verts[1].loadXY(p[0], p[1] + s[1]);\r\n      this._verts[2].loadXY(p[0] + s[0], p[1] + s[1]);\r\n      this._verts[3].loadXY(p[0] + s[0], p[1]);\r\n\r\n      for (let border of this._borders) {\r\n        border.setCSS();\r\n      }\r\n\r\n      this.setCSS();\r\n      return;\r\n    }\r\n\r\n    let screen = this.getScreen();\r\n    if (!screen) return;\r\n\r\n    for (let b of this._borders) {\r\n      screen.freeBorder(b);\r\n    }\r\n\r\n    this.makeBorders(screen);\r\n    this.setCSS();\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Sets pos/size from screen verts\r\n   * */\r\n  loadFromVerts() {\r\n    if (this._verts.length == 0) {\r\n      return;\r\n    }\r\n\r\n    let min = new Vector2([1e17, 1e17]);\r\n    let max = new Vector2([-1e17, -1e17]);\r\n\r\n    for (let v of this._verts) {\r\n      min.min(v);\r\n      max.max(v);\r\n    }\r\n\r\n    this.pos[0] = min[0];\r\n    this.pos[1] = min[1];\r\n\r\n    this.size[0] = max[0] - min[0];\r\n    this.size[1] = max[1] - min[1];\r\n\r\n    this.setCSS();\r\n    return this;\r\n  }\r\n\r\n  on_resize(size, oldsize) {\r\n    super.on_resize(size, oldsize);\r\n\r\n    if (this.area !== undefined) {\r\n      this.area.on_resize(size, oldsize);\r\n    }\r\n  }\r\n\r\n  makeBorders(screen) {\r\n    this._borders.length = 0;\r\n    this._verts.length = 0;\r\n\r\n    let p = this.pos, s = this.size;\r\n\r\n    //s = snapi(new Vector2(s));\r\n\r\n    let vs = [\r\n      new Vector2([p[0], p[1]]),\r\n      new Vector2([p[0], p[1] + s[1]]),\r\n      new Vector2([p[0] + s[0], p[1] + s[1]]),\r\n      new Vector2([p[0] + s[0], p[1]])\r\n    ];\r\n\r\n    let floating = this.floating;\r\n\r\n    for (let i = 0; i < vs.length; i++) {\r\n      vs[i] = snap(vs[i]);\r\n      vs[i] = screen.getScreenVert(vs[i], i, floating);\r\n      this._verts.push(vs[i]);\r\n    }\r\n\r\n    for (let i = 0; i < vs.length; i++) {\r\n      let v1 = vs[i], v2 = vs[(i + 1)%vs.length];\r\n\r\n      let b = screen.getScreenBorder(this, v1, v2, i);\r\n\r\n\r\n      for (let j = 0; j < 2; j++) {\r\n        let v = j ? b.v2 : b.v1;\r\n\r\n        if (v.sareas.indexOf(this) < 0) {\r\n          v.sareas.push(this);\r\n        }\r\n      }\r\n\r\n      if (b.sareas.indexOf(this) < 0) {\r\n        b.sareas.push(this);\r\n      }\r\n\r\n      this._borders.push(b);\r\n\r\n      b.movable = screen.isBorderMovable(b);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  setCSS() {\r\n    this.style[\"position\"] = UIBase.PositionKey;\r\n\r\n    this.style[\"left\"] = this.pos[0] + \"px\";\r\n    this.style[\"top\"] = this.pos[1] + \"px\";\r\n\r\n    this.style[\"width\"] = this.size[0] + \"px\";\r\n    this.style[\"height\"] = this.size[1] + \"px\";\r\n\r\n    this.style[\"overflow\"] = \"hidden\";\r\n    this.style[\"contain\"] = \"layout\"; //ensure we have a new positioning stack\r\n\r\n    if (this.area !== undefined) {\r\n      this.area.setCSS();\r\n    }\r\n  }\r\n\r\n  appendChild(child) {\r\n    if (child instanceof Area) {\r\n      let def = child.constructor.define();\r\n      let existing = this.editormap[def.areaname];\r\n\r\n      if (existing && existing !== child) {\r\n        console.warn(\"Warning, replacing an exising editor instance\", child, existing);\r\n\r\n        if (this.area === existing) {\r\n          this.area = child;\r\n        }\r\n\r\n        existing.remove();\r\n        this.editormap[def.areaname] = child;\r\n      }\r\n\r\n      child.ctx = this.ctx;\r\n      child.pos = this.pos;\r\n      child.size = this.size;\r\n\r\n      if (this.editors.indexOf(child) < 0) {\r\n        this.editors.push(child);\r\n      }\r\n\r\n      child.owning_sarea = undefined;\r\n      if (this.area === undefined) {\r\n        this.area = child;\r\n      }\r\n    }\r\n\r\n    super.appendChild(child);\r\n\r\n    if (child instanceof ui_base.UIBase) {\r\n      child.parentWidget = this;\r\n      child.onadd();\r\n    }\r\n  }\r\n\r\n  switch_editor(cls) {\r\n    return this.switchEditor(cls);\r\n  }\r\n\r\n  switchEditor(cls) {\r\n    let def = cls.define();\r\n    let name = def.areaname;\r\n\r\n    //areaclasses[name]\r\n    if (!(name in this.editormap)) {\r\n      this.editormap[name] = UIBase.createElement(def.tagname);\r\n      this.editormap[name].ctx = this.ctx;\r\n      this.editormap[name].parentWidget = this;\r\n      this.editormap[name].owning_sarea = this;\r\n      this.editormap[name].inactive = false;\r\n\r\n      this.editors.push(this.editormap[name]);\r\n    }\r\n\r\n    //var finish = () => {\r\n    if (this.area) {\r\n      //break direct pos/size references for old active area\r\n      this.area.pos = new Vector2(this.area.pos);\r\n      this.area.size = new Vector2(this.area.size);\r\n\r\n      this.area.owning_sarea = undefined;\r\n      this.area.inactive = true;\r\n      this.area.push_ctx_active();\r\n      this.area._init(); //check that init was called\r\n      this.area.on_area_inactive();\r\n      this.area.pop_ctx_active();\r\n\r\n      this.area.remove();\r\n    } else {\r\n      this.area = undefined;\r\n    }\r\n\r\n    this.area = this.editormap[name];\r\n\r\n    this.area.inactive = false;\r\n    this.area.parentWidget = this;\r\n\r\n    //. . .and set references to pos/size\r\n    this.area.pos = this.pos;\r\n    this.area.size = this.size;\r\n    this.area.owning_sarea = this;\r\n    this.area.ctx = this.ctx;\r\n\r\n    this.area.packflag |= this.packflag;\r\n\r\n    this.shadow.appendChild(this.area);\r\n\r\n    this.area.style[\"width\"] = \"100%\";\r\n    this.area.style[\"height\"] = \"100%\";\r\n\r\n    //propegate new size\r\n    this.area.push_ctx_active();\r\n    this.area._init(); //check that init was called\r\n    this.area.on_resize(this.size, this.size);\r\n    this.area.pop_ctx_active();\r\n\r\n    this.area.push_ctx_active();\r\n    this.area.on_area_active();\r\n    this.area.pop_ctx_active();\r\n\r\n    this.regenTabOrder();\r\n    //}\r\n  }\r\n\r\n  _checkWrangler() {\r\n    if (this.ctx)\r\n      contextWrangler._checkWrangler(this.ctx);\r\n  }\r\n\r\n  update() {\r\n    this._checkWrangler();\r\n\r\n    super.update();\r\n\r\n    //flag client controller implementation that\r\n    //this area is active for its type\r\n    if (this.area !== undefined) {\r\n      this.area.owning_sarea = this;\r\n      this.area.parentWidget = this;\r\n      this.area.size = this.size;\r\n      this.area.pos = this.pos;\r\n\r\n      let screen = this.getScreen();\r\n      let oldsize = [this.size[0], this.size[1]];\r\n\r\n      let moved = screen ? screen.checkAreaConstraint(this, true) : 0;\r\n      //*\r\n      if (moved) {\r\n        if (cconst.DEBUG.areaConstraintSolver) {\r\n          console.log(\"screen constraint solve\", moved, this.area.minSize, this.area.maxSize, this.area.tagName, this.size);\r\n        }\r\n\r\n        screen.solveAreaConstraints();\r\n        screen.regenBorders();\r\n        this.on_resize(oldsize);\r\n      }//*/\r\n\r\n      this.area.push_ctx_active(true);\r\n    }\r\n\r\n    this._forEachChildWidget((n) => {\r\n      n.update();\r\n    });\r\n\r\n    if (this.area !== undefined) {\r\n      this.area.pop_ctx_active(true);\r\n    }\r\n  }\r\n\r\n  appendChild(ch) {\r\n    if (ch instanceof Area) {\r\n      this.editors.push(ch);\r\n      this.editormap[ch.constructor.define().areaname] = ch;\r\n    } else {\r\n      super.appendChild(ch);\r\n    }\r\n  }\r\n\r\n  removeChild(ch) {\r\n    if (ch instanceof Area) {\r\n      ch.owining_sarea = undefined;\r\n      ch.pos = undefined;\r\n      ch.size = undefined;\r\n\r\n      if (this.area === ch && this.editors.length > 1) {\r\n        let i = (this.editors.indexOf(ch) + 1)%this.editors.length;\r\n        this.switchEditor(this.editors[i].constructor);\r\n      } else if (this.area === ch) {\r\n        this.editors = [];\r\n        this.editormap = {};\r\n        this.area = undefined;\r\n\r\n        ch.remove();\r\n        return;\r\n      }\r\n\r\n      let areaname = ch.constructor.define().areaname;\r\n\r\n      this.editors.remove(ch);\r\n      delete this.editormap[areaname];\r\n\r\n      ch.parentWidget = undefined;\r\n    } else {\r\n      return super.removeChild(ch);\r\n    }\r\n  }\r\n\r\n  afterSTRUCT() {\r\n    for (let area of this.editors) {\r\n      area.pos = this.pos;\r\n      area.size = this.size;\r\n      area.owning_sarea = this;\r\n\r\n      area.push_ctx_active();\r\n      area._ctx = this.ctx;\r\n      area.afterSTRUCT();\r\n      area.pop_ctx_active();\r\n    }\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    this.pos = new Vector2(this.pos);\r\n    this.size = new Vector2(this.size);\r\n\r\n    //find active editor\r\n\r\n    let editors = [];\r\n\r\n    for (let area of this.editors) {\r\n      if (!area.constructor || !area.constructor.define || area.constructor === Area) {\r\n        //failed to load this area\r\n        continue;\r\n      }\r\n\r\n      /*\r\n      if (area.constructor === undefined || area.constructor.define === undefined) {\r\n        console.warn(\"Missing class for area\", area, \"maybe buggy loadSTRUCT()?\");\r\n        continue;\r\n      }\r\n      //*/\r\n\r\n      let areaname = area.constructor.define().areaname;\r\n\r\n      area.inactive = true;\r\n      area.owning_sarea = undefined;\r\n      this.editormap[areaname] = area;\r\n\r\n      if (areaname === this.area) {\r\n        this.area = area;\r\n      }\r\n\r\n      /*\r\n      * originally inactive areas weren't supposed to have\r\n      * a reference to their owning ScreenAreas.\r\n      *\r\n      * Unfortunately this will cause isDead() to return true,\r\n      * which might lead to nasty problems.\r\n      * */\r\n      area.parentWidget = this;\r\n\r\n      editors.push(area);\r\n    }\r\n    this.editors = editors;\r\n\r\n    if (typeof this.area !== \"object\") {\r\n      let area = this.editors[0];\r\n\r\n      console.warn(\"Failed to find active area!\", this.area);\r\n\r\n      if (typeof area !== \"object\") {\r\n        for (let k in areaclasses) {\r\n          area = areaclasses[k].define().tagname;\r\n          area = UIBase.createElement(area);\r\n          let areaname = area.constructor.define().areaname;\r\n\r\n          this.editors.push(area);\r\n          this.editormap[areaname] = area;\r\n\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (area) {\r\n        this.area = area;\r\n      }\r\n    }\r\n\r\n    if (this.area !== undefined) {\r\n      this.area.style[\"width\"] = \"100%\";\r\n      this.area.style[\"height\"] = \"100%\";\r\n      this.area.owning_sarea = this;\r\n      this.area.parentWidget = this;\r\n\r\n      this.area.pos = this.pos;\r\n      this.area.size = this.size;\r\n\r\n      this.area.inactive = false;\r\n      this.shadow.appendChild(this.area);\r\n\r\n      let f = () => {\r\n        if (this._isDead()) {\r\n          return;\r\n        }\r\n\r\n        if (!this.ctx && this.parentNode) {\r\n          console.log(\"waiting to start. . .\");\r\n          this.doOnce(f);\r\n          return;\r\n        }\r\n\r\n        this.area.ctx = this.ctx;\r\n        this.area._init(); //ensure init has been called already\r\n        this.area.on_area_active();\r\n        this.area.onadd();\r\n      };\r\n\r\n      this.doOnce(f);\r\n    }\r\n\r\n  }\r\n}\r\n\r\nScreenArea.STRUCT = `\r\npathux.ScreenArea { \r\n  pos      : vec2;\r\n  size     : vec2;\r\n  type     : string;\r\n  hidden   : bool;\r\n  editors  : array(abstract(pathux.Area));\r\n  area     : string | this.area ? this.area.constructor.define().areaname : \"\";\r\n}\r\n`;\r\n\r\nnstructjs.register(ScreenArea, \"pathux.ScreenArea\");\r\nui_base.UIBase.internalRegister(ScreenArea);\r\n\r\nui_base._setAreaClass(Area);\r\n\r\nexport function setScreenClass(cls) {\r\n  Screen = cls;\r\n}\r\n","import {Area} from '../screen/ScreenArea.js';\r\nimport * as nstructjs from '../path-controller/util/struct.js';\r\nimport {UIBase, theme, flagThemeUpdate, saveUIData, loadUIData} from '../core/ui_base.js';\r\nimport {Container} from '../core/ui.js';\r\nimport {validateCSSColor, color2css, css2color, CSSFont} from '../core/ui_theme.js';\r\n\r\nexport class ThemeEditor extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.categoryMap = {};\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"theme-editor-x\",\r\n      style  : \"theme-editor\"\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.build();\r\n  }\r\n\r\n  doFolder(catkey, obj, container = this, panel = undefined, path=undefined) {\r\n    let key = catkey.key;\r\n\r\n    if (!path) {\r\n      path = [key];\r\n    }\r\n\r\n    if (!panel) {\r\n      panel = container.panel(key, undefined, undefined, catkey.help);\r\n      panel.style[\"margin-left\"] = \"15px\";\r\n    }\r\n\r\n    let row2 = panel.row();\r\n    let textbox = row2.textbox(undefined, \"\");\r\n\r\n    let callback = (id) => {\r\n      console.log(\"ID\", id, obj, catkey);\r\n      console.log(textbox, textbox.text, textbox.value);\r\n\r\n      let propkey = (textbox.text || \"\").trim();\r\n\r\n      if (!propkey) {\r\n        console.error(\"Cannot have empty theme property name\");\r\n        return;\r\n      }\r\n\r\n      if (id === \"FLOAT\") {\r\n        obj[propkey] = 0.0;\r\n      } else if (id === \"SUBFOLDER\") {\r\n        obj[propkey] = {test : 0};\r\n      } else if (id === \"COLOR\") {\r\n        obj[propkey] = \"grey\";\r\n      } else if (id === \"FONT\") {\r\n        obj[propkey] = new CSSFont();\r\n      } else if (id === \"STRING\") {\r\n        obj[propkey] = \"\";\r\n      }\r\n\r\n      let uidata = saveUIData(panel, \"theme-panel\");\r\n\r\n      panel.clear();\r\n      this.doFolder(catkey, obj, container, panel, path);\r\n\r\n      loadUIData(panel, uidata);\r\n      panel.flushUpdate();\r\n      panel.flushSetCSS();\r\n\r\n      //doFolder(catkey, obj, container = this, panel=undefined) {\r\n      //this.build();\r\n      if (this.onchange) {\r\n        this.onchange(key, propkey, obj);\r\n      }\r\n    }\r\n\r\n    let menu = row2.menu(\"+\", [\r\n      {name: \"Float\", callback: () => callback(\"FLOAT\")},\r\n      {name: \"Color\", callback: () => callback(\"COLOR\")},\r\n      {name: \"Subfolder\", callback: () => callback(\"SUBFOLDER\")},\r\n      {name: \"Font\", callback: () => callback(\"FONT\")},\r\n      {name: \"String\", callback: () => callback(\"STRING\")},\r\n    ]);\r\n\r\n    let row = panel.row();\r\n    let col1 = row.col();\r\n    let col2 = row.col();\r\n\r\n    let do_onchange = (key, k, obj) => {\r\n      flagThemeUpdate();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(key, k, obj);\r\n      }\r\n\r\n      this.ctx.screen.completeSetCSS();\r\n      this.ctx.screen.completeUpdate();\r\n    };\r\n\r\n    let getpath = (path) => {\r\n      let obj = theme;\r\n\r\n      for (let i = 0; i < path.length; i++) {\r\n        obj = obj[path[i]];\r\n      }\r\n\r\n      return obj;\r\n    }\r\n\r\n    let ok = false;\r\n    let _i = 0;\r\n\r\n    let dokey = (k, v, path) => {\r\n      let col = _i%2 === 0 ? col1 : col2;\r\n\r\n      if (k.toLowerCase().search(\"flag\") >= 0) {\r\n        return; //don't do flags\r\n      }\r\n\r\n      if (typeof v === \"string\") {\r\n        let v2 = v.toLowerCase().trim();\r\n\r\n        let iscolor = validateCSSColor(v2);\r\n\r\n        if (iscolor) {\r\n          let cw = col.colorbutton();\r\n          ok = true;\r\n          _i++;\r\n\r\n          let color = css2color(v2);\r\n          if (color.length < 3) {\r\n            color = [color[0], color[1], color[2], 1.0];\r\n          }\r\n\r\n          try {\r\n            cw.setRGBA(color);\r\n          } catch (error) {\r\n            console.warn(\"Failed to set color \" + k, v2);\r\n          }\r\n\r\n          cw.onchange = () => {\r\n            console.log(\"setting '\" + k + \"' to \" + color2css(cw.rgba), key);\r\n            getpath(path)[k] = color2css(cw.rgba);\r\n\r\n            do_onchange(key, k);\r\n          }\r\n          cw.label = k;\r\n        } else {\r\n          col.label(k);\r\n\r\n          let box = col.textbox();\r\n          box.onchange = () => {\r\n            getpath(path)[k] = box.text;\r\n            do_onchange(key, k);\r\n          }\r\n          box.text = v;\r\n        }\r\n      } else if (typeof v === \"number\") {\r\n        let slider = col.slider(undefined, k, v, 0, 256, 0.01, false);\r\n\r\n        slider.baseUnit = slider.displayUnit = \"none\";\r\n\r\n        ok = true;\r\n        _i++;\r\n\r\n        slider.onchange = () => {\r\n          getpath(path)[k] = slider.value;\r\n\r\n          do_onchange(key, k);\r\n        }\r\n      } else if (typeof v === \"boolean\") {\r\n        let check = col.check(undefined, k);\r\n\r\n        check.value = getpath(path)[k];\r\n\r\n        check.onchange = () => {\r\n          getpath(path)[k] = !!check.value;\r\n          do_onchange(key, k);\r\n        }\r\n      } else if (typeof v === \"object\" && v instanceof CSSFont) {\r\n        let panel2 = col.panel(k);\r\n        ok = true;\r\n        _i++;\r\n\r\n        let textbox = (key) => {\r\n          panel2.label(key);\r\n          let tbox = panel2.textbox(undefined, v[key]);\r\n\r\n          tbox.width = tbox.getDefault(\"width\");\r\n\r\n          tbox.onchange = function () {\r\n            v[key] = this.text;\r\n            do_onchange(key, k);\r\n          }\r\n        }\r\n\r\n        textbox(\"font\");\r\n        textbox(\"variant\");\r\n        textbox(\"weight\");\r\n        textbox(\"style\");\r\n\r\n        let cw = panel2.colorbutton();\r\n        cw.label = \"color\";\r\n        cw.setRGBA(css2color(v.color));\r\n        cw.onchange = () => {\r\n          v.color = color2css(cw.rgba);\r\n          do_onchange(key, k);\r\n        }\r\n\r\n        let slider = panel2.slider(undefined, \"size\", v.size);\r\n        slider.onchange = () => {\r\n          v.size = slider.value;\r\n          do_onchange(key, k);\r\n        }\r\n        slider.setAttribute(\"min\", 1);\r\n        slider.setAttribute(\"max\", 100);\r\n\r\n        slider.baseUnit = slider.displayUnit = \"none\";\r\n\r\n        panel2.closed = true;\r\n      } else if (typeof v === \"object\") {\r\n        /*\r\n          let old = {\r\n            panel, row, col1, col2\r\n          };\r\n\r\n          let path2 = path.slice(0, path.length);\r\n          path2.push(k);\r\n\r\n          panel = panel.panel(k);\r\n          row = panel.row();\r\n          col1 = row.col();\r\n          col2 = row.col();\r\n          for (let k2 in v) {\r\n            let v2 = v[k2];\r\n\r\n            dokey(k2, v2, path2);\r\n          }\r\n\r\n          panel = old.panel;\r\n          row = old.row;\r\n          col1 = old.col1;\r\n          col2 = old.col2;\r\n        */\r\n\r\n        let catkey2 = Object.assign({}, catkey);\r\n        catkey2.key = k;\r\n\r\n        let path2 = path.concat(k);\r\n\r\n        this.doFolder(catkey2, v, panel, undefined, path2);\r\n      }\r\n    };\r\n\r\n    for (let k in obj) {\r\n      let v = obj[k];\r\n\r\n      dokey(k, v, path);\r\n    }\r\n\r\n    if (!ok) {\r\n      panel.remove();\r\n    } else {\r\n      panel.closed = true;\r\n    }\r\n\r\n  }\r\n\r\n  build() {\r\n    let uidata = saveUIData(this, \"theme\");\r\n\r\n    this.clear();\r\n\r\n    let categories = {};\r\n\r\n    for (let k of Object.keys(theme)) {\r\n      let catkey;\r\n\r\n      if (k in this.categoryMap) {\r\n        let cat = this.categoryMap[k];\r\n\r\n        if (typeof cat === \"string\") {\r\n          cat = {\r\n            category: cat,\r\n            help    : \"\",\r\n            key     : k\r\n          }\r\n        }\r\n\r\n        catkey = cat;\r\n      } else {\r\n        catkey = {category: k, help: '', key: k};\r\n      }\r\n\r\n      if (!catkey.key) {\r\n        catkey.key = k;\r\n      }\r\n\r\n      if (!(catkey.category in categories)) {\r\n        categories[catkey.category] = [];\r\n      }\r\n\r\n      categories[catkey.category].push(catkey);\r\n    }\r\n\r\n    function strcmp(a, b) {\r\n      a = a.trim().toLowerCase();\r\n      b = b.trim().toLowerCase();\r\n      return a < b ? -1 : (a === b ? 0 : 1);\r\n    }\r\n\r\n    let keys = Object.keys(categories);\r\n    keys.sort(strcmp);\r\n\r\n    for (let k of keys) {\r\n      let list = categories[k];\r\n      list.sort((a, b) => strcmp(a.key, b.key));\r\n\r\n      let panel = this;\r\n\r\n      if (list.length > 1) {\r\n        panel = this.panel(k);\r\n      }\r\n\r\n      for (let cat of list) {\r\n        let k2 = cat.key;\r\n        let v = theme[k2];\r\n\r\n        if (typeof v === \"object\") {\r\n          this.doFolder(cat, v, panel);\r\n        }\r\n      }\r\n\r\n      if (list.length > 1) {\r\n        panel.closed = true;\r\n      }\r\n    }\r\n\r\n    loadUIData(this, uidata);\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      this.flushSetCSS();\r\n      this.flushUpdate();\r\n    }\r\n\r\n    if (this.ctx && this.ctx.screen) {\r\n      /* Fix panel spacing bug. */\r\n      window.setTimeout(() => {\r\n        this.ctx.screen.completeSetCSS();\r\n      }, 100);\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ThemeEditor);\r\n","import {UIBase, drawText} from \"../core/ui_base.js\";\r\nimport {ValueButtonBase} from \"./ui_widgets.js\";\r\nimport cconst from '../config/const.js';\r\nimport * as ui_base from \"../core/ui_base.js\";\r\nimport * as units from \"../core/units.js\";\r\nimport {Vector2} from \"../path-controller/util/vectormath.js\";\r\nimport {ColumnFrame} from \"../core/ui.js\";\r\nimport * as util from \"../path-controller/util/util.js\";\r\nimport {\r\n  PropTypes, isNumber, PropSubTypes, PropFlags, NumberConstraints, IntProperty\r\n} from \"../path-controller/toolsys/toolprop.js\";\r\nimport {eventWasTouch} from \"../path-controller/util/simple_events.js\";\r\nimport {KeyMap, keymap} from \"../path-controller/util/simple_events.js\";\r\nimport {color2css, css2color} from \"../core/ui_theme.js\";\r\nimport {ThemeEditor} from \"./theme_editor.js\";\r\nimport {Unit} from '../core/units.js';\r\n\r\nexport const sliderDomAttributes = new Set([\r\n  \"min\", \"max\", \"integer\", \"displayUnit\", \"baseUnit\", \"labelOnTop\",\r\n  \"radix\", \"step\", \"expRate\", \"stepIsRelative\", \"decimalPlaces\",\r\n  \"slideSpeed\"\r\n]);\r\n\r\nfunction updateSliderFromDom(dom, slider = dom) {\r\n  slider.loadNumConstraints(undefined, dom);\r\n}\r\n\r\nexport const SliderDefaults = {\r\n  stepIsRelative: false,\r\n  expRate       : 1.0 + 1.0/3.0,\r\n  radix         : 10,\r\n  decimalPlaces : 4,\r\n  baseUnit      : \"none\",\r\n  displayUnit   : \"none\",\r\n  slideSpeed    : 1.0,\r\n  step          : 0.1,\r\n}\r\n\r\nexport function NumberSliderBase(cls = UIBase, skip = new Set(), defaults = SliderDefaults) {\r\n  skip = new Set(skip);\r\n\r\n  return class NumberSliderBase extends cls {\r\n    constructor() {\r\n      super();\r\n\r\n      for (let key of NumberConstraints) {\r\n        if (skip.has(key)) {\r\n          continue;\r\n        }\r\n\r\n        if (key in defaults) {\r\n          this[key] = defaults[key];\r\n        } else {\r\n          this[key] = undefined;\r\n        }\r\n      }\r\n    }\r\n\r\n    loadNumConstraints(prop, dom) {\r\n      return super.loadNumConstraints(prop, dom, this._redraw);\r\n    }\r\n  }\r\n}\r\n\r\n//use .setAttribute(\"linear\") to disable nonlinear sliding\r\nexport class NumSlider extends NumberSliderBase(ValueButtonBase) {\r\n  constructor() {\r\n    super();\r\n\r\n    this._highlight = undefined;\r\n    this._last_label = undefined;\r\n\r\n    this.mdown = false;\r\n    this.ma = undefined;\r\n\r\n    this.mpos = new Vector2();\r\n    this.start_mpos = new Vector2();\r\n\r\n    this._last_overarrow = false;\r\n\r\n    this._name = \"\";\r\n    this._value = 0.0;\r\n    this.expRate = SliderDefaults.expRate;\r\n\r\n    this.vertical = false;\r\n    this._last_disabled = false;\r\n\r\n    this.range = [-1e17, 1e17];\r\n    this.isInt = false;\r\n    this.editAsBaseUnit = undefined;\r\n\r\n    this._redraw();\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(val) {\r\n    this.setValue(val);\r\n  }\r\n\r\n  /** Current name label.  If set to null label will\r\n   * be pulled from the datapath api.*/\r\n  get name() {\r\n    return this.getAttribute(\"name\") || this._name;\r\n  }\r\n\r\n  /** Current name label.  If set to null label will\r\n   * be pulled from the datapath api.*/\r\n  set name(name) {\r\n    if (name === undefined || name === null) {\r\n      this.removeAttribute(\"name\");\r\n    } else {\r\n      this.setAttribute(\"name\", name);\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname          : \"numslider-x\",\r\n      style            : \"numslider\",\r\n      parentStyle      : \"button\",\r\n      havePickClipboard: true,\r\n    };\r\n  }\r\n\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (!prop) {\r\n      return;\r\n    }\r\n\r\n    let name;\r\n\r\n    if (this.hasAttribute(\"name\")) {\r\n      name = this.getAttribute(\"name\");\r\n    } else {\r\n      name = \"\" + prop.uiname;\r\n    }\r\n\r\n    //lazily load constraints, since there's so much\r\n    //accessing of DOM attributes\r\n    let updateConstraints = false;\r\n\r\n    if (name !== this._name) {\r\n      this._name = name;\r\n      this.setCSS();\r\n      updateConstraints = true;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (val !== this._value) {\r\n      updateConstraints = true;\r\n      /* Note that super.updateDataPath will update .value for us*/\r\n    }\r\n\r\n    if (updateConstraints) {\r\n      this.loadNumConstraints(prop);\r\n    }\r\n\r\n    super.updateDataPath();\r\n  }\r\n\r\n  update() {\r\n    if (!!this._last_disabled !== !!this.disabled) {\r\n      this._last_disabled = !!this.disabled;\r\n      this._redraw();\r\n      this.setCSS();\r\n    }\r\n\r\n    super.update(); //calls this.updateDataPath\r\n\r\n    updateSliderFromDom(this);\r\n  }\r\n\r\n  clipboardCopy() {\r\n    console.log(\"Copy\", \"\" + this.value);\r\n    cconst.setClipboardData(\"value\", \"text/plain\", \"\" + this.value);\r\n  }\r\n\r\n  clipboardPaste() {\r\n    let data = cconst.getClipboardData(\"text/plain\");\r\n    console.log(\"Paste\", data);\r\n\r\n    if (typeof data == \"object\") {\r\n      data = data.data;\r\n    }\r\n\r\n    let displayUnit = this.editAsBaseUnit ? undefined : this.displayUnit;\r\n    let val = units.parseValue(data, this.baseUnit, displayUnit);\r\n\r\n    if (typeof val === \"number\" && !isNaN(val)) {\r\n      this.setValue(val);\r\n    }\r\n  }\r\n\r\n  swapWithTextbox() {\r\n    let tbox = UIBase.createElement(\"textbox-x\");\r\n\r\n    if (this.modalRunning) {\r\n      this.popModal();\r\n    }\r\n\r\n    this.mdown = false;\r\n\r\n    tbox.ctx = this.ctx;\r\n    tbox._init();\r\n\r\n    tbox.decimalPlaces = this.decimalPlaces;\r\n    tbox.isInt = this.isInt;\r\n    tbox.editAsBaseUnit = this.editAsBaseUnit;\r\n\r\n    if (this.isInt && this.radix != 10) {\r\n      let text = this.value.toString(this.radix);\r\n      if (this.radix === 2)\r\n        text = \"0b\" + text;\r\n      else if (this.radix === 16)\r\n        text += \"h\";\r\n\r\n      tbox.text = text;\r\n    } else {\r\n      tbox.text = units.buildString(this.value, this.baseUnit, this.decimalPlaces, this.displayUnit);\r\n    }\r\n\r\n    this.parentNode.insertBefore(tbox, this);\r\n    //this.remove();\r\n    this.hidden = true;\r\n    //this.dom.hidden = true;\r\n\r\n    let finish = (ok) => {\r\n      tbox.remove();\r\n      this.hidden = false;\r\n\r\n      if (ok) {\r\n        let val = tbox.text.trim();\r\n\r\n        if (this.isInt && this.radix !== 10) {\r\n          val = parseInt(val);\r\n        } else {\r\n          let displayUnit = this.editAsBaseUnit ? undefined : this.displayUnit;\r\n\r\n          val = units.parseValue(val, this.baseUnit, displayUnit);\r\n        }\r\n\r\n        if (isNaN(val)) {\r\n          console.log(\"Text input error\", val, tbox.text.trim(), this.isInt);\r\n          this.flash(ui_base.ErrorColors.ERROR);\r\n        } else {\r\n          this.setValue(val);\r\n\r\n          if (this.onchange) {\r\n            this.onchange(this);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    tbox.onend = finish;\r\n    tbox.focus();\r\n    tbox.select();\r\n\r\n    //this.shadow.appendChild(tbox);\r\n    return;\r\n  }\r\n\r\n  bindEvents() {\r\n    let dir = this.range && this.range[0] > this.range[1] ? -1 : 1;\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Left\"]:\r\n        case keymap[\"Down\"]:\r\n          this.setValue(this.value - dir*5*this.step);\r\n          break;\r\n        case keymap[\"Up\"]:\r\n        case keymap[\"Right\"]:\r\n          this.setValue(this.value + dir*5*this.step);\r\n          break;\r\n      }\r\n    });\r\n\r\n    let onmousedown = (e) => {\r\n      e.preventDefault();\r\n\r\n      if (this.disabled) {\r\n        this.mdown = false;\r\n        e.stopPropagation();\r\n\r\n        return;\r\n      }\r\n\r\n      if (e.button) {\r\n        return;\r\n      }\r\n\r\n      this.mdown = true;\r\n\r\n      if (e.shiftKey) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        this.swapWithTextbox();\r\n      } else if (this.overArrow(e.x, e.y)) {\r\n        this._on_click(e);\r\n      } else {\r\n        this.dragStart(e);\r\n        e.stopPropagation();\r\n      }\r\n    }\r\n\r\n    this._on_click = (e) => {\r\n      this.setMpos(e);\r\n\r\n      if (this.disabled) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        return;\r\n      }\r\n\r\n      let step;\r\n\r\n      if (step = this.overArrow(e.x, e.y)) {\r\n        if (e.shiftKey) {\r\n          step *= 0.1;\r\n        }\r\n\r\n        this.setValue(this.value + step);\r\n      }\r\n    }\r\n\r\n    this.addEventListener(\"pointermove\", (e) => {\r\n      this.setMpos(e);\r\n\r\n      if (this.mdown && !this._modaldata && this.mpos.vectorDistance(this.start_mpos) > 13) {\r\n        this.dragStart(e);\r\n      }\r\n    });\r\n\r\n    this.addEventListener(\"dblclick\", (e) => {\r\n      this.setMpos(e);\r\n\r\n      this.mdown = false;\r\n\r\n      if (this.disabled || this.overArrow(e.x, e.y)) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        return;\r\n      }\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n\r\n      this.swapWithTextbox();\r\n    });\r\n\r\n    this.addEventListener(\"pointerdown\", (e) => {\r\n      this.setMpos(e);\r\n\r\n      if (this.disabled) return;\r\n      onmousedown(e);\r\n    }, {capture: true});\r\n\r\n    this.addEventListener(\"pointerup\", (e) => {\r\n      this.mdown = false;\r\n    })\r\n    /*\r\n    this.addEventListener(\"touchstart\", (e) => {\r\n      if (this.disabled) return;\r\n\r\n      e.x = e.touches[0].screenX;\r\n      e.y = e.touches[0].screenY;\r\n\r\n      this.dragStart(e);\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }, {passive : false});\r\n    //*/\r\n\r\n    //this.addEventListener(\"pointerup\", (e) => {\r\n    //  return onmouseup(e);\r\n    //});\r\n\r\n    this.addEventListener(\"pointerover\", (e) => {\r\n      this.setMpos(e);\r\n      if (this.disabled) return;\r\n\r\n      if (!this._highlight) {\r\n        this._highlight = true;\r\n        this._repos_canvas();\r\n        this._redraw();\r\n      }\r\n    })\r\n\r\n    this.addEventListener(\"blur\", (e) => {\r\n      this._highlight = false;\r\n      this.mdown = false;\r\n    });\r\n\r\n    this.addEventListener(\"pointerout\", (e) => {\r\n      this.setMpos(e);\r\n      if (this.disabled) return;\r\n\r\n      this._highlight = false;\r\n\r\n      this.dom._background = this.getDefault(\"background-color\");\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    })\r\n  }\r\n\r\n  overArrow(x, y) {\r\n    let r = this.getBoundingClientRect();\r\n    let rwidth, rx;\r\n\r\n    if (this.vertical) {\r\n      rwidth = r.height;\r\n      rx = r.y;\r\n      x = y;\r\n    } else {\r\n      rwidth = r.width;\r\n      rx = r.x;\r\n    }\r\n\r\n    x -= rx;\r\n    let sz = this._getArrowSize();\r\n\r\n    let szmargin = sz + cconst.numSliderArrowLimit;\r\n\r\n    let step = this.step || 0.01;\r\n\r\n    if (this.isInt) {\r\n      step = Math.max(step, 1);\r\n    }\r\n\r\n    if (isNaN(step)) {\r\n      console.error(\"NaN step size\", \"step:\", this.step, \"numslider:\", this._id);\r\n      this.flash(\"red\");\r\n      step = this.isInt ? 1 : 0.1;\r\n    }\r\n\r\n    if (x < szmargin) {\r\n      return -step;\r\n    } else if (x > rwidth - szmargin) {\r\n      return step;\r\n    }\r\n\r\n    return 0;\r\n  }\r\n\r\n  doRange() {\r\n    console.warn(\"Deprecated: NumSlider.prototype.doRange, use loadNumConstraints instead!\");\r\n    this.loadNumConstraints();\r\n  }\r\n\r\n  setValue(value, fire_onchange = true, setDataPath = true, checkConstraints = true) {\r\n    value = Math.min(Math.max(value, this.range[0]), this.range[1]);\r\n\r\n    this._value = value;\r\n\r\n    if (this.hasAttribute(\"integer\")) {\r\n      this.isInt = true;\r\n    }\r\n\r\n    if (this.isInt) {\r\n      this._value = Math.floor(this._value);\r\n    }\r\n\r\n    if (checkConstraints) {\r\n      this.loadNumConstraints();\r\n    }\r\n\r\n    if (setDataPath && this.ctx && this.hasAttribute(\"datapath\")) {\r\n      this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this._value);\r\n    }\r\n\r\n    if (fire_onchange && this.onchange) {\r\n      this.onchange(this.value);\r\n    }\r\n\r\n    this._redraw();\r\n  }\r\n\r\n  setMpos(e) {\r\n    this.mpos[0] = e.x;\r\n    this.mpos[1] = e.y;\r\n\r\n    if (!this.mdown) {\r\n      this.start_mpos[0] = e.x;\r\n      this.start_mpos[1] = e.y;\r\n    }\r\n\r\n    let over = this.overArrow(e.x, e.y);\r\n\r\n    if (over !== this._last_overarrow) {\r\n      this._last_overarrow = over;\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  dragStart(e) {\r\n    this.mdown = false;\r\n\r\n    if (this.disabled) return;\r\n\r\n    if (this.modalRunning) {\r\n      console.log(\"modal already running for numslider\", this);\r\n      return;\r\n    }\r\n\r\n    this.last_time = util.time_ms();\r\n\r\n    let last_background = this.dom._background;\r\n    let cancel;\r\n\r\n    this.ma = new util.MovingAvg(eventWasTouch(e) ? 8 : 2);\r\n\r\n    let startvalue = this.value;\r\n    let value = startvalue;\r\n\r\n    let startx = this.vertical ? e.y : e.x, starty = this.vertical ? e.x : e.y;\r\n    let sumdelta = 0;\r\n\r\n    this.dom._background = this.getDefault(\"BoxDepressed\");\r\n    let fire = () => {\r\n      if (this.onchange) {\r\n        this.onchange(this);\r\n      }\r\n    }\r\n\r\n    let handlers = {\r\n      on_keydown: (e) => {\r\n        switch (e.keyCode) {\r\n          case 27: //escape key\r\n            cancel(true);\r\n          case 13: //enter key\r\n            cancel(false);\r\n            break;\r\n        }\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      },\r\n\r\n      on_pointermove: (e) => {\r\n        if (this.disabled) return;\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        let x = this.ma.add(this.vertical ? e.y : e.x);\r\n        let dx = x - startx;\r\n        startx = x;\r\n\r\n        if (util.time_ms() - this.last_time < 35) {\r\n          return;\r\n        }\r\n        this.last_time = util.time_ms();\r\n\r\n        if (e.shiftKey) {\r\n          dx *= 0.1;\r\n        }\r\n\r\n        dx *= this.vertical ? -1 : 1;\r\n\r\n        sumdelta += Math.abs(dx);\r\n\r\n        value += dx*this.step*0.1*this.slideSpeed;\r\n\r\n        let dvalue = value - startvalue;\r\n        let dsign = Math.sign(dvalue);\r\n\r\n        let expRate = this.expRate;\r\n\r\n        //if (eventWasTouch(e)) {\r\n        //  expRate = (1 + expRate)*0.5;\r\n        //}\r\n\r\n        if (!this.hasAttribute(\"linear\")) {\r\n          dvalue = Math.pow(Math.abs(dvalue), expRate)*dsign;\r\n        }\r\n\r\n        this.value = startvalue + dvalue;\r\n\r\n        /*\r\n        if (e.shiftKey) {\r\n          dx *= 0.1;\r\n          this.value = startvalue2 + dx*0.1*this.step*this.slideSpeed;\r\n          startvalue3 = this.value;\r\n        } else {\r\n          startvalue2 = this.value;\r\n          this.value = startvalue3 + dx*0.1*this.step*this.slideSpeed;\r\n        }*/\r\n\r\n        this.updateWidth();\r\n        this._redraw();\r\n        fire();\r\n      },\r\n\r\n      on_pointerup: (e) => {\r\n        this.setMpos(e);\r\n\r\n        this.undoBreakPoint();\r\n        cancel(false);\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      },\r\n\r\n      on_pointerout: (e) => {\r\n        last_background = this.getDefault(\"background-color\");\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      },\r\n\r\n      on_pointerover: (e) => {\r\n        last_background = this.getDefault(\"BoxHighlight\");\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      },\r\n\r\n      on_pointerdown: (e) => {\r\n        this.popModal();\r\n      },\r\n    };\r\n\r\n    //events.pushModal(this.getScreen(), handlers);\r\n    this.pushModal(handlers);\r\n\r\n    cancel = (restore_value) => {\r\n      if (restore_value) {\r\n        this.value = startvalue;\r\n        this.updateWidth();\r\n        fire();\r\n      }\r\n\r\n      this.dom._background = last_background; //ui_base.getDefault(\"background-color\");\r\n      this._redraw();\r\n\r\n      this.popModal();\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    //do not call parent class implementation\r\n    let dpi = this.getDPI();\r\n\r\n    let ts = this.getDefault(\"DefaultText\").size*UIBase.getDPI();\r\n\r\n    let dd = this.isInt ? 5 : this.decimalPlaces + 8;\r\n\r\n    let label = this._genLabel();\r\n\r\n    let tw = ui_base.measureText(this, label, {\r\n      size: ts,\r\n      font: this.getDefault(\"DefaultText\")\r\n    }).width/dpi;\r\n\r\n    tw = Math.max(tw + this._getArrowSize()*0, this.getDefault(\"width\"));\r\n\r\n    tw += ts;\r\n    tw = ~~tw;\r\n\r\n    //tw = Math.max(tw, w);\r\n    if (this.vertical) {\r\n      this.style[\"width\"] = this.dom.style[\"width\"] = this.getDefault(\"height\") + \"px\";\r\n\r\n      this.style[\"height\"] = tw + \"px\";\r\n      this.dom.style[\"height\"] = tw + \"px\";\r\n    } else {\r\n      this.style[\"height\"] = this.dom.style[\"height\"] = this.getDefault(\"height\") + \"px\";\r\n\r\n      this.style[\"width\"] = tw + \"px\";\r\n      this.dom.style[\"width\"] = tw + \"px\";\r\n    }\r\n\r\n    this._repos_canvas();\r\n    this._redraw();\r\n  }\r\n\r\n  updateName(force) {\r\n    if (!this.hasAttribute(\"name\")) {\r\n      return;\r\n    }\r\n\r\n    let name = this.getAttribute(\"name\");\r\n\r\n    if (force || name !== this._name) {\r\n      this._name = name;\r\n      this.setCSS();\r\n    }\r\n\r\n    let label = this._genLabel();\r\n    if (label !== this._last_label) {\r\n      this._last_label = label;\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  _genLabel() {\r\n    let val = this.value;\r\n    let text;\r\n\r\n    if (val === undefined) {\r\n      text = \"error\";\r\n    } else {\r\n      val = val === undefined ? 0.0 : val;\r\n\r\n      if (this.isInt) {\r\n        val = Math.floor(val);\r\n      }\r\n\r\n      val = units.buildString(val, this.baseUnit, this.decimalPlaces, this.displayUnit);\r\n\r\n      text = val;\r\n      if (this._name) {\r\n        text = this._name + \": \" + text;\r\n      }\r\n    }\r\n\r\n    return text;\r\n  }\r\n\r\n  _redraw() {\r\n    let g = this.g;\r\n    let canvas = this.dom;\r\n\r\n    let dpi = this.getDPI();\r\n    let disabled = this.disabled;\r\n\r\n    let r = this.getDefault(\"border-radius\");\r\n    if (this.isInt) {\r\n      r *= 0.25;\r\n    }\r\n\r\n    let boxbg = this.getDefault(this._highlight ? \"BoxHighlight\" : \"background-color\");\r\n\r\n    ui_base.drawRoundBox(this, this.dom, this.g, undefined, undefined,\r\n      r, \"fill\", disabled ? this.getDefault(\"DisabledBG\") : boxbg);\r\n    ui_base.drawRoundBox(this, this.dom, this.g, undefined, undefined,\r\n      r, \"stroke\", disabled ? this.getDefault(\"DisabledBG\") : this.getDefault(\"border-color\"));\r\n\r\n    r *= dpi;\r\n    let pad = this.getDefault(\"padding\");\r\n    let ts = this.getDefault(\"DefaultText\").size;\r\n\r\n    let text = this._genLabel();\r\n\r\n    let tw = ui_base.measureText(this, text, this.dom, this.g).width;\r\n    let cx = ts + this._getArrowSize();\r\n    let cy = this.dom.height/2;\r\n\r\n    this.dom.font = undefined;\r\n\r\n    g.save();\r\n\r\n    let th = Math.PI*0.5;\r\n\r\n    if (this.vertical) {\r\n      g.rotate(th);\r\n\r\n      ui_base.drawText(this, cx, -ts*0.5, text, {\r\n        canvas: this.dom,\r\n        g     : this.g,\r\n        size  : ts\r\n      });\r\n      g.restore();\r\n    } else {\r\n      ui_base.drawText(this, cx, cy + ts/2, text, {\r\n        canvas: this.dom,\r\n        g     : this.g,\r\n        size  : ts\r\n      });\r\n    }\r\n\r\n    //}\r\n\r\n    let arrowcolor = this.getDefault(\"arrow-color\") || \"33%\";\r\n    arrowcolor = arrowcolor.trim();\r\n\r\n    if (arrowcolor.endsWith(\"%\")) {\r\n      arrowcolor = arrowcolor.slice(0, arrowcolor.length - 1).trim();\r\n      let perc = parseFloat(arrowcolor)/100.0;\r\n      let c = css2color(this.getDefault(\"arrow-color\"));\r\n\r\n      let f = 1.0 - (c[0] + c[1] + c[2])*perc;\r\n\r\n      f = ~~(f*255);\r\n      arrowcolor = `rgba(${f},${f},${f},0.95)`;\r\n\r\n    }\r\n\r\n    arrowcolor = css2color(arrowcolor);\r\n    let higharrow = css2color(this.getDefault(\"BoxHighlight\"));\r\n    higharrow.interp(arrowcolor, 0.5);\r\n\r\n    arrowcolor = color2css(arrowcolor);\r\n    higharrow = color2css(higharrow);\r\n\r\n    let over = this._highlight ? this.overArrow(this.mpos[0], this.mpos[1]) : 0;\r\n\r\n    let d = 7, w = canvas.width, h = canvas.height;\r\n    let sz = this._getArrowSize();\r\n\r\n    if (this.vertical) {\r\n      g.beginPath();\r\n      g.moveTo(w*0.5, d);\r\n      g.lineTo(w*0.5 + sz*0.5, d + sz);\r\n      g.lineTo(w*0.5 - sz*0.5, d + sz);\r\n\r\n      g.fillStyle = over < 0 ? higharrow : arrowcolor;\r\n      g.fill();\r\n\r\n      g.beginPath();\r\n      g.moveTo(w*0.5, h - d);\r\n      g.lineTo(w*0.5 + sz*0.5, h - sz - d);\r\n      g.lineTo(w*0.5 - sz*0.5, h - sz - d);\r\n\r\n      g.fillStyle = over > 0 ? higharrow : arrowcolor;\r\n      g.fill();\r\n    } else {\r\n      g.beginPath();\r\n      g.moveTo(d, h*0.5);\r\n      g.lineTo(d + sz, h*0.5 + sz*0.5);\r\n      g.lineTo(d + sz, h*0.5 - sz*0.5);\r\n\r\n      g.fillStyle = over < 0 ? higharrow : arrowcolor;\r\n      g.fill();\r\n\r\n      g.beginPath();\r\n      g.moveTo(w - d, h*0.5);\r\n      g.lineTo(w - sz - d, h*0.5 + sz*0.5);\r\n      g.lineTo(w - sz - d, h*0.5 - sz*0.5);\r\n\r\n      g.fillStyle = over > 0 ? higharrow : arrowcolor;\r\n      g.fill();\r\n    }\r\n\r\n    g.fill();\r\n  }\r\n\r\n  _getArrowSize() {\r\n    return UIBase.getDPI()*10;\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(NumSlider);\r\n\r\n\r\nexport class NumSliderSimpleBase extends NumberSliderBase(UIBase) {\r\n  constructor() {\r\n    super();\r\n\r\n    this.baseUnit = undefined;\r\n    this.displayUnit = undefined;\r\n    this.editAsBaseUnit = undefined;\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.g = this.canvas.getContext(\"2d\");\r\n\r\n    this.canvas.style[\"width\"] = this.getDefault(\"width\") + \"px\";\r\n    this.canvas.style[\"height\"] = this.getDefault(\"height\") + \"px\";\r\n    this.canvas.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.highlight = false;\r\n    this.isInt = false;\r\n\r\n    this.shadow.appendChild(this.canvas);\r\n    this.range = [0, 1];\r\n\r\n    /** if not undefined defines subrange of visible slider */\r\n    this.uiRange = undefined;\r\n\r\n    this.step = 0.1;\r\n    this._value = 0.5;\r\n    this.ma = undefined;\r\n    this._focus = false;\r\n\r\n    this.modal = undefined;\r\n\r\n    this._last_slider_key = '';\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(val) {\r\n    this.setValue(val);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname    : \"numslider-simple-base-x\",\r\n      style      : \"numslider_simple\",\r\n      parentStyle: \"button\"\r\n    }\r\n  }\r\n\r\n  setValue(val, fire_onchange = true, setDataPath = true) {\r\n    val = Math.min(Math.max(val, this.range[0]), this.range[1]);\r\n\r\n    if (this.isInt) {\r\n      val = Math.floor(val);\r\n    }\r\n\r\n    if (this._value !== val) {\r\n      this._value = val;\r\n      this._redraw();\r\n\r\n      if (this.onchange && fire_onchange) {\r\n        this.onchange(val);\r\n      }\r\n\r\n      if (setDataPath && this.getAttribute(\"datapath\")) {\r\n        let path = this.getAttribute(\"datapath\");\r\n        this.setPathValue(this.ctx, path, this._value);\r\n      }\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n\r\n    if (!path || path === \"null\" || path === \"undefined\") {\r\n      return;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, path);\r\n\r\n    if (this.isInt) {\r\n      val = Math.floor(val);\r\n    }\r\n\r\n    if (val !== this._value) {\r\n      let prop = this.getPathMeta(this.ctx, path);\r\n      if (!prop) {\r\n        return;\r\n      }\r\n\r\n      this.loadNumConstraints(prop);\r\n      this.setValue(val, true, false);\r\n    }\r\n  }\r\n\r\n  _setFromMouse(e) {\r\n    let rect = this.getClientRects()[0];\r\n    if (rect === undefined) {\r\n      return;\r\n    }\r\n\r\n    let x = e.x - rect.left;\r\n    let dpi = UIBase.getDPI();\r\n    let co = this._getButtonPos();\r\n\r\n    let val = this._invertButtonX(x*dpi);\r\n    this.value = val;\r\n  }\r\n\r\n  _startModal(e) {\r\n    if (this.disabled) {\r\n      return;\r\n    }\r\n\r\n    if (e !== undefined) {\r\n      this._setFromMouse(e);\r\n    }\r\n    let dom = window;\r\n    let evtargs = {capture: false};\r\n\r\n    if (this.modal) {\r\n      console.warn(\"Double call to _startModal!\");\r\n      return;\r\n    }\r\n\r\n    this.ma = new util.MovingAvg(eventWasTouch(e) ? 4 : 2);\r\n    let handlers;\r\n\r\n    let end = () => {\r\n      if (handlers === undefined) {\r\n        return;\r\n      }\r\n\r\n      this.popModal();\r\n      handlers = undefined;\r\n    };\r\n\r\n    handlers = {\r\n      pointermove: (e) => {\r\n        let x = e.x, y = e.y;\r\n\r\n        x = this.ma.add(x);\r\n\r\n        let e2 = new MouseEvent(e, {\r\n          x, y\r\n        });\r\n        this._setFromMouse(e);\r\n      },\r\n\r\n      pointerover : (e) => {\r\n      },\r\n      pointerout  : (e) => {\r\n      },\r\n      pointerleave: (e) => {\r\n      },\r\n      pointerenter: (e) => {\r\n      },\r\n      blur        : (e) => {\r\n      },\r\n      focus       : (e) => {\r\n      },\r\n\r\n      pointerup: (e) => {\r\n        this.undoBreakPoint();\r\n        end();\r\n      },\r\n\r\n      keydown: (e) => {\r\n        switch (e.keyCode) {\r\n          case keymap[\"Enter\"]:\r\n          case keymap[\"Space\"]:\r\n          case keymap[\"Escape\"]:\r\n            end();\r\n        }\r\n      }\r\n    };\r\n\r\n    function makefunc(f) {\r\n      return (e) => {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n\r\n        return f(e);\r\n      }\r\n    }\r\n\r\n    for (let k in handlers) {\r\n      handlers[k] = makefunc(handlers[k]);\r\n    }\r\n\r\n    this.pushModal(handlers);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    if (!this.hasAttribute(\"tab-index\")) {\r\n      this.setAttribute(\"tab-index\", 0);\r\n    }\r\n\r\n    this.updateSize();\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      let dt = this.range[1] > this.range[0] ? 1 : -1;\r\n\r\n      switch (e.keyCode) {\r\n        case keymap[\"Left\"]:\r\n        case keymap[\"Right\"]:\r\n          let fac = this.step;\r\n\r\n          if (e.shiftKey) {\r\n            fac *= 0.1;\r\n          }\r\n\r\n          if (this.isInt) {\r\n            fac = Math.max(fac, 1);\r\n          }\r\n\r\n          this.value += e.keyCode === keymap[\"Left\"] ? -dt*fac : dt*fac;\r\n\r\n          break;\r\n      }\r\n    });\r\n\r\n    this.addEventListener(\"focusin\", () => {\r\n      if (this.disabled) return;\r\n\r\n      this._focus = 1;\r\n      this._redraw();\r\n      this.focus();\r\n    });\r\n\r\n    this.addEventListener(\"pointerdown\", (e) => {\r\n      if (this.disabled) {\r\n        return;\r\n      }\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n      this._startModal(e);\r\n    });\r\n\r\n    this.addEventListener(\"pointerin\", (e) => {\r\n      this.setHighlight(e);\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"pointerout\", (e) => {\r\n      this.highlight = false;\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"pointerover\", (e) => {\r\n      this.setHighlight(e);\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"pointermove\", (e) => {\r\n      this.setHighlight(e);\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"pointerleave\", (e) => {\r\n      this.highlight = false;\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"blur\", (e) => {\r\n      this._focus = 0;\r\n      this.highlight = false;\r\n      this._redraw();\r\n    });\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  setHighlight(e) {\r\n    this.highlight = this.isOverButton(e) ? 2 : 1;\r\n  }\r\n\r\n  _redraw() {\r\n    let g = this.g, canvas = this.canvas;\r\n    let w = canvas.width, h = canvas.height;\r\n    let dpi = UIBase.getDPI();\r\n\r\n    let color = this.getDefault(\"background-color\");\r\n    let sh = ~~(this.getDefault(\"SlideHeight\")*dpi + 0.5);\r\n\r\n    g.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    g.fillStyle = color;\r\n\r\n    let y = (h - sh)*0.5;\r\n\r\n    let r = this.getDefault(\"border-radius\");\r\n\r\n    g.translate(0, y);\r\n    ui_base.drawRoundBox(this, this.canvas, g, w, sh, r, \"fill\", color, undefined, true);\r\n\r\n    let bcolor = this.getDefault('border-color');\r\n    ui_base.drawRoundBox(this, this.canvas, g, w, sh, r, \"stroke\", bcolor, undefined, true);\r\n    g.translate(0, -y);\r\n\r\n    if (this.highlight === 1) {\r\n      color = this.getDefault(\"BoxHighlight\");\r\n    } else {\r\n      color = this.getDefault(\"border-color\");\r\n    }\r\n\r\n    g.strokeStyle = color;\r\n    g.stroke();\r\n\r\n    let co = this._getButtonPos();\r\n\r\n    g.beginPath();\r\n\r\n    if (this.highlight === 2) {\r\n      color = this.getDefault(\"BoxHighlight\");\r\n    } else {\r\n      color = this.getDefault(\"border-color\");\r\n    }\r\n\r\n    g.arc(co[0], co[1], Math.abs(co[2]), -Math.PI, Math.PI);\r\n    g.fill();\r\n\r\n    g.strokeStyle = color;\r\n    g.stroke();\r\n\r\n    g.beginPath();\r\n    g.setLineDash([4, 4]);\r\n\r\n    if (this._focus) {\r\n      g.strokeStyle = this.getDefault(\"BoxHighlight\");\r\n      g.arc(co[0], co[1], co[2] - 4, -Math.PI, Math.PI);\r\n      g.stroke();\r\n    }\r\n\r\n    g.setLineDash([]);\r\n  }\r\n\r\n  isOverButton(e) {\r\n    let x = e.x, y = e.y;\r\n    let rect = this.getClientRects()[0];\r\n\r\n    if (!rect) {\r\n      return false;\r\n    }\r\n\r\n    x -= rect.left;\r\n    y -= rect.top;\r\n\r\n    let co = this._getButtonPos();\r\n\r\n    let dpi = UIBase.getDPI();\r\n    let dv = new Vector2([co[0]/dpi - x, co[1]/dpi - y]);\r\n    let dis = dv.vectorLength();\r\n\r\n    return dis < co[2]/dpi;\r\n  }\r\n\r\n  _invertButtonX(x) {\r\n    let w = this.canvas.width;\r\n    let dpi = UIBase.getDPI();\r\n    let sh = ~~(this.getDefault(\"SlideHeight\")*dpi + 0.5);\r\n    let boxw = this.canvas.height - 4;\r\n    let w2 = w - boxw;\r\n\r\n    let range = this.uiRange || this.range;\r\n\r\n    x = (x - boxw*0.5)/w2;\r\n    x = x*(range[1] - range[0]) + range[0];\r\n\r\n    return x;\r\n  }\r\n\r\n  _getButtonPos() {\r\n    let w = this.canvas.width;\r\n    let dpi = UIBase.getDPI();\r\n    let sh = ~~(this.getDefault(\"SlideHeight\")*dpi + 0.5);\r\n    let x = this._value;\r\n\r\n    let range = this.uiRange || this.range;\r\n\r\n    x = (x - range[0])/(range[1] - range[0]);\r\n\r\n    let boxw = this.canvas.height - 4;\r\n    let w2 = w - boxw;\r\n\r\n    x = x*w2 + boxw*0.5;\r\n\r\n    return [x, boxw*0.5, boxw*0.5];\r\n  }\r\n\r\n  setCSS() {\r\n    //UIBase.setCSS does annoying thing with background-color\r\n    //super.setCSS();\r\n\r\n    this.canvas.style[\"width\"] = \"min-contents\";\r\n    this.canvas.style[\"min-width\"] = this.getDefault(\"width\") + \"px\";\r\n    this.canvas.style[\"height\"] = this.getDefault(\"height\") + \"px\";\r\n\r\n    this.canvas.height = this.getDefault(\"height\")*UIBase.getDPI();\r\n\r\n    this.style[\"min-width\"] = this.getDefault(\"width\") + \"px\";\r\n    this._redraw();\r\n  }\r\n\r\n  updateSize() {\r\n    if (this.canvas === undefined) {\r\n      return;\r\n    }\r\n\r\n    let rect = this.getClientRects()[0];\r\n\r\n    if (rect === undefined) {\r\n      return;\r\n    }\r\n\r\n    let dpi = UIBase.getDPI();\r\n    let w = ~~(rect.width*dpi), h = ~~(rect.height*dpi);\r\n    let canvas = this.canvas;\r\n\r\n    if (w !== canvas.width || h !== canvas.height) {\r\n      this.canvas.width = w;\r\n      this.canvas.height = h;\r\n\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _ondestroy() {\r\n    if (this.modalRunning) {\r\n      this.popModal();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    let key = this.getDefault(\"width\") + this.getDefault(\"height\") + this.getDefault(\"SlideHeight\");\r\n    if (key !== this._last_slider_key) {\r\n      this._last_slider_key = key;\r\n\r\n      this.flushUpdate();\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n\r\n    if (this.getAttribute(\"tab-index\") !== this.tabIndex) {\r\n      this.tabIndex = this.getAttribute(\"tab-index\");\r\n    }\r\n\r\n    this.updateSize();\r\n    this.updateDataPath();\r\n    updateSliderFromDom(this);\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(NumSliderSimpleBase);\r\n\r\nexport class SliderWithTextbox extends ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this._value = 0;\r\n    this._name = undefined;\r\n    this._lock_textbox = false;\r\n    this._labelOnTop = undefined;\r\n\r\n    this._last_label_on_top = undefined;\r\n\r\n    this.container = this;\r\n\r\n    this.textbox = UIBase.createElement(\"textbox-x\");\r\n    this.textbox.width = 55;\r\n    this._numslider = undefined;\r\n\r\n    this.textbox.overrideDefault(\"width\", this.getDefault(\"TextBoxWidth\"));\r\n    this.textbox.setAttribute(\"class\", \"numslider_simple_textbox\");\r\n\r\n    this._last_value = undefined;\r\n  }\r\n\r\n  /**\r\n   * whether to put label on top or to the left of sliders\r\n   *\r\n   * If undefined value will be either this.getAtttribute(\"labelOnTop\"),\r\n   * if \"labelOnTop\" attribute exists, or it will be this.getDefault(\"labelOnTop\")\r\n   * (theme default)\r\n   **/\r\n  get labelOnTop() {\r\n    let ret = this._labelOnTop;\r\n\r\n    if (ret === undefined && this.hasAttribute(\"labelOnTop\")) {\r\n      let val = this.getAttribute(\"labelOnTop\");\r\n      if (typeof val === \"string\") {\r\n        val = val.toLowerCase();\r\n        ret = val === \"true\" || val === \"yes\";\r\n      } else {\r\n        ret = !!val;\r\n      }\r\n    }\r\n\r\n    if (ret === undefined) {\r\n      ret = this.getDefault(\"labelOnTop\");\r\n    }\r\n\r\n    return !!ret;\r\n  }\r\n\r\n  set labelOnTop(v) {\r\n    this._labelOnTop = v;\r\n  }\r\n\r\n  get numslider() {\r\n    return this._numslider;\r\n  }\r\n\r\n  //child classes set this in their constructors\r\n  set numslider(v) {\r\n    this._numslider = v;\r\n    this.textbox.range = this._numslider.range;\r\n  }\r\n\r\n  get editAsBaseUnit() {\r\n    return this.numslider.editAsBaseUnit;\r\n  }\r\n\r\n  set editAsBaseUnit(v) {\r\n    this.numslider.editAsBaseUnit = v;\r\n  }\r\n\r\n  get range() {\r\n    return this.numslider.range;\r\n  }\r\n\r\n  set range(v) {\r\n    this.numslider.range = v;\r\n  }\r\n\r\n  get step() {\r\n    return this.numslider.step;\r\n  }\r\n\r\n  set step(v) {\r\n    this.numslider.step = v;\r\n  }\r\n\r\n  get expRate() {\r\n    return this.numslider.expRate;\r\n  }\r\n\r\n  set expRate(v) {\r\n    this.numslider.expRate = v;\r\n  }\r\n\r\n  get decimalPlaces() {\r\n    return this.numslider.decimalPlaces;\r\n  }\r\n\r\n  set decimalPlaces(v) {\r\n    this.numslider.decimalPlaces = v;\r\n  }\r\n\r\n  get isInt() {\r\n    return this.numslider.isInt;\r\n  }\r\n\r\n  set isInt(v) {\r\n    this.numslider.isInt = v;\r\n  }\r\n\r\n  get slideSpeed() {\r\n    return this.numslider.slideSpeed;\r\n  }\r\n\r\n  set slideSpeed(v) {\r\n    this.numslider.slideSpeed = v;\r\n  }\r\n\r\n  get radix() {\r\n    return this.numslider.radix;\r\n  }\r\n\r\n  set radix(v) {\r\n    this.numslider.radix = v;\r\n  }\r\n\r\n  get stepIsRelative() {\r\n    return this.numslider.stepIsRelative;\r\n  }\r\n\r\n  set stepIsRelative(v) {\r\n    this.numslider.stepIsRelative = v;\r\n  }\r\n\r\n  get displayUnit() {\r\n    return this.numslider.displayUnit;\r\n  }\r\n\r\n  set displayUnit(val) {\r\n    let update = val !== this.displayUnit;\r\n\r\n    this.numslider.displayUnit = this.textbox.displayUnit = val;\r\n\r\n    if (update) {\r\n      //this.numslider._redraw();\r\n      this.updateTextBox();\r\n    }\r\n  }\r\n\r\n  get baseUnit() {\r\n    return this.textbox.baseUnit;\r\n  }\r\n\r\n  set baseUnit(val) {\r\n    let update = val !== this.baseUnit;\r\n\r\n    this.numslider.baseUnit = this.textbox.baseUnit = val;\r\n\r\n    if (update) {\r\n      //this.slider._redraw();\r\n      this.updateTextBox();\r\n    }\r\n  }\r\n\r\n  get realTimeTextBox() {\r\n    let ret = this.getAttribute(\"realtime\");\r\n\r\n    if (!ret) {\r\n      return false;\r\n    }\r\n\r\n    ret = ret.toLowerCase().trim();\r\n\r\n    return ret === 'true' || ret === 'on' || ret === 'yes';\r\n  }\r\n\r\n  set realTimeTextBox(val) {\r\n    this.setAttribute(\"realtime\", val ? \"true\" : \"false\");\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(val) {\r\n    this.setValue(val);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.rebuild();\r\n    window.setTimeout(() => this.updateTextBox(), 500);\r\n  }\r\n\r\n  rebuild() {\r\n    this._last_label_on_top = this.labelOnTop;\r\n\r\n    this.container.clear();\r\n\r\n    if (!this.labelOnTop) {\r\n      this.container = this.row();\r\n    } else {\r\n      this.container = this;\r\n    }\r\n\r\n    if (this.hasAttribute(\"name\")) {\r\n      this._name = this.hasAttribute(\"name\");\r\n    } else {\r\n      this._name = \"slider\";\r\n    }\r\n\r\n\r\n    this.l = this.container.label(this._name);\r\n    this.l.overrideClass(\"numslider_textbox\");\r\n    this.l.font = \"TitleText\";\r\n    this.l.style[\"display\"] = \"float\";\r\n    this.l.style[\"position\"] = \"relative\";\r\n\r\n    let strip = this.container.row();\r\n    //strip.style['justify-content'] = 'space-between';\r\n    strip.add(this.numslider);\r\n\r\n    let path = this.hasAttribute(\"datapath\") ? this.getAttribute(\"datapath\") : undefined;\r\n\r\n    let textbox = this.textbox;\r\n    this.textbox.overrideDefault(\"width\", this.getDefault(\"TextBoxWidth\"));\r\n\r\n    let apply_textbox = () => {\r\n      let text = textbox.text;\r\n\r\n      if (!units.isNumber(text)) {\r\n        textbox.flash(\"red\");\r\n        return;\r\n      } else {\r\n        textbox.flash(\"green\");\r\n\r\n        let displayUnit = this.editAsBaseUnit ? undefined : this.displayUnit;\r\n\r\n        let f = units.parseValue(text, this.baseUnit, displayUnit);\r\n\r\n        if (isNaN(f)) {\r\n          this.flash(\"red\");\r\n          return;\r\n        }\r\n\r\n        if (this.isInt) {\r\n          f = Math.floor(f);\r\n        }\r\n\r\n        this._lock_textbox = 1;\r\n        this.setValue(f);\r\n        this._lock_textbox = 0;\r\n\r\n      }\r\n    };\r\n\r\n    if (this.realTimeTextBox) {\r\n      textbox.onchange = apply_textbox;\r\n    }\r\n\r\n    textbox.onend = apply_textbox;\r\n\r\n    textbox.ctx = this.ctx;\r\n    textbox.packflag |= this.inherit_packflag;\r\n    textbox.overrideDefault(\"width\", this.getDefault(\"TextBoxWidth\"));\r\n\r\n    textbox.style[\"height\"] = (this.getDefault(\"height\") - 2) + \"px\";\r\n    textbox._init();\r\n\r\n    strip.add(textbox);\r\n\r\n    textbox.setCSS();\r\n    this.linkTextBox();\r\n\r\n    let in_onchange = 0;\r\n\r\n    this.numslider.onchange = (val) => {\r\n      this._value = this.numslider.value;\r\n      this.updateTextBox();\r\n\r\n      if (in_onchange) {\r\n        return;\r\n      }\r\n\r\n      if (this.onchange !== undefined) {\r\n        in_onchange++;\r\n        try {\r\n          if (this.onchange) {\r\n            this.onchange(this);\r\n          }\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n        }\r\n      }\r\n\r\n      in_onchange--;\r\n    }\r\n  }\r\n\r\n  updateTextBox() {\r\n    if (!this._init_done) {\r\n      return;\r\n    }\r\n\r\n    if (this._lock_textbox > 0)\r\n      return;\r\n\r\n    this.textbox.text = this.formatNumber(this._value);\r\n    this.textbox.update();\r\n\r\n    updateSliderFromDom(this, this.numslider);\r\n  }\r\n\r\n  linkTextBox() {\r\n    this.updateTextBox();\r\n\r\n    let onchange = this.numslider.onchange;\r\n    this.numslider.onchange = (e) => {\r\n      this._value = e.value;\r\n      this.updateTextBox();\r\n\r\n      onchange(e);\r\n    }\r\n  }\r\n\r\n  setValue(val, fire_onchange = true) {\r\n    this._value = val;\r\n    this.numslider.setValue(val, fire_onchange);\r\n    this.updateTextBox();\r\n  }\r\n\r\n  updateName() {\r\n    let name = this.getAttribute(\"name\");\r\n\r\n    if (!name && this.hasAttribute(\"datapath\")) {\r\n      let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n      if (prop) {\r\n        name = prop.uiname;\r\n      }\r\n    }\r\n\r\n    if (!name) {\r\n      name = \"[error]\";\r\n    }\r\n\r\n    if (name !== this._name) {\r\n      this._name = name;\r\n      this.l.text = name;\r\n    }\r\n  }\r\n\r\n  updateLabelOnTop() {\r\n    if (this.labelOnTop !== this._last_label_on_top) {\r\n      this._last_label_on_top = this.labelOnTop;\r\n      this.rebuild();\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.ctx || !this.getAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"))\r\n\r\n    if (!prop) {\r\n      return;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n    if (val !== this._last_value) {\r\n      this._last_value = this._value = val;\r\n      this.updateTextBox();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    this.updateLabelOnTop();\r\n    super.update();\r\n\r\n    this.updateDataPath();\r\n    let redraw = false;\r\n\r\n    updateSliderFromDom(this, this.numslider);\r\n    updateSliderFromDom(this, this.textbox);\r\n\r\n    if (redraw) {\r\n      this.setCSS();\r\n      this.numslider.setCSS();\r\n      this.numslider._redraw();\r\n    }\r\n\r\n    this.updateName();\r\n\r\n    this.numslider.description = this.description;\r\n    this.textbox.description = this.title; //get full, transformed toolip\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.numslider.setAttribute(\"datapath\", this.getAttribute(\"datapath\"));\r\n      this.textbox.setAttribute(\"datapath\", this.getAttribute(\"datapath\"));\r\n    }\r\n\r\n    if (this.hasAttribute(\"mass_set_path\")) {\r\n      this.numslider.setAttribute(\"mass_set_path\", this.getAttribute(\"mass_set_path\"))\r\n      this.textbox.setAttribute(\"mass_set_path\", this.getAttribute(\"mass_set_path\"));\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n    this.textbox.setCSS();\r\n    //textbox.style[\"margin\"] = \"5px\";\r\n\r\n  }\r\n}\r\n\r\nexport class NumSliderSimple extends SliderWithTextbox {\r\n  constructor() {\r\n    super();\r\n\r\n    this.numslider = UIBase.createElement(\"numslider-simple-base-x\");\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"numslider-simple-x\",\r\n      style  : \"numslider_simple\"\r\n    }\r\n  }\r\n\r\n  _redraw() {\r\n    this.numslider._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(NumSliderSimple);\r\n\r\nexport class NumSliderWithTextBox extends SliderWithTextbox {\r\n  constructor() {\r\n    super();\r\n\r\n    this.numslider = UIBase.createElement(\"numslider-x\");\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"numslider-textbox-x\",\r\n      style  : \"numslider_textbox\"\r\n    }\r\n  }\r\n\r\n  _redraw() {\r\n    this.numslider._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(NumSliderWithTextBox);\r\n\r\n","//stores xml sources\r\nimport {isNumber} from '../path-controller/toolsys/toolprop.js';\r\n\r\nlet pagecache = new Map()\r\nimport {PackFlags, UIBase} from '../core/ui_base.js';\r\nimport {sliderDomAttributes} from '../widgets/ui_numsliders.js';\r\nimport * as util from '../util/util.js';\r\nimport {Menu} from '../widgets/ui_menu.js';\r\nimport {Icons} from '../core/ui_base.js';\r\nimport {Container} from '../core/ui.js';\r\n\r\nexport var domTransferAttrs = new Set([\"id\", \"title\", \"tab-index\"]);\r\nexport var domEventAttrs = new Set([\"click\", \"mousedown\", \"mouseup\", \"mousemove\", \"keydown\", \"keypress\"]);\r\n\r\nexport function parseXML(xml) {\r\n  let parser = new DOMParser()\r\n  xml = `<root>${xml}</root>`;\r\n  return parser.parseFromString(xml.trim(), \"application/xml\");\r\n}\r\n\r\nlet num_re = /[0-9]+$/;\r\n\r\nfunction getIconFlag(elem) {\r\n  if (!elem.hasAttribute(\"useIcons\")) {\r\n    return 0;\r\n  }\r\n\r\n  let attr = elem.getAttribute(\"useIcons\");\r\n\r\n  if (typeof attr === \"string\") {\r\n    attr = attr.toLowerCase().trim();\r\n  }\r\n\r\n  if (attr === \"false\" || attr === \"no\") {\r\n    return 0;\r\n  }\r\n\r\n  if (attr === \"true\" || attr === \"yes\") {\r\n    return PackFlags.USE_ICONS;\r\n  } else if (attr === \"small\") {\r\n    return PackFlags.SMALL_ICON | PackFlags.USE_ICONS;\r\n  } else if (attr === \"large\") {\r\n    return PackFlags.LARGE_ICON | PackFlags.USE_ICONS;\r\n  } else {\r\n    let isnum = typeof attr === \"number\";\r\n    let sheet = attr;\r\n\r\n    if (typeof sheet === \"string\" && sheet.search(num_re) === 0) {\r\n      sheet = parseInt(sheet);\r\n      isnum = true;\r\n    }\r\n\r\n    if (!isnum) {\r\n      return PackFlags.USE_ICONS;\r\n    }\r\n\r\n    let flag = PackFlags.USE_ICONS | PackFlags.CUSTOM_ICON_SHEET;\r\n    flag |= ((sheet - 1)<<PackFlags.CUSTOM_ICON_SHEET_START);\r\n\r\n    return flag;\r\n  }\r\n\r\n  return 0;\r\n}\r\n\r\nfunction getPackFlag(elem) {\r\n  let packflag = getIconFlag(elem);\r\n\r\n  if (elem.hasAttribute(\"drawChecks\")) {\r\n    if (!getbool(elem, \"drawChecks\")) {\r\n      packflag |= PackFlags.HIDE_CHECK_MARKS;\r\n    } else {\r\n      packflag &= ~PackFlags.HIDE_CHECK_MARKS;\r\n    }\r\n  }\r\n\r\n  if (getbool(elem, \"simpleSlider\")) {\r\n    packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n  }\r\n  if (getbool(elem, \"rollarSlider\")) {\r\n    packflag |= PackFlags.FORCE_ROLLER_SLIDER;\r\n  }\r\n\r\n  return packflag;\r\n}\r\n\r\nfunction myParseFloat(s) {\r\n  s = '' + s;\r\n  s = s.trim().toLowerCase();\r\n\r\n  if (s.endsWith(\"px\")) {\r\n    s = s.slice(0, s.length - 2);\r\n  }\r\n\r\n  return parseFloat(s);\r\n}\r\n\r\nfunction getbool(elem, attr) {\r\n  let ret = elem.getAttribute(attr);\r\n  if (!ret) {\r\n    return false;\r\n  }\r\n\r\n  ret = ret.toLowerCase();\r\n  return ret === \"1\" || ret === \"true\" || ret === \"yes\";\r\n}\r\n\r\nfunction getfloat(elem, attr, defaultval) {\r\n  if (!elem.hasAttribute(attr)) {\r\n    return defaultval;\r\n  }\r\n\r\n  return myParseFloat(elem.getAttribute(attr));\r\n}\r\n\r\n/*\r\n**\r\n*\r\n* a customHandler can be a callback, or the string \"default\", e.g.\r\n*\r\n* xmlpage.customHandlers[\"homegig-element-x\"] = \"default\".\r\n*\r\n* The default case simply suppresses the warning that would otherwise\r\n* be printed to the console.\r\n* */\r\nexport const customHandlers = {};\r\n\r\nclass Handler {\r\n  constructor(ctx, container) {\r\n    this.container = container;\r\n    this.stack = [];\r\n    this.ctx = ctx;\r\n    this.codefuncs = {};\r\n\r\n    this.templateVars = {};\r\n\r\n    let attrs = util.list(sliderDomAttributes);\r\n\r\n    //note that useIcons, showLabel and sliderMode are PackFlag bits and are inherited through that system\r\n\r\n    this.inheritDomAttrs = {};\r\n    this.inheritDomAttrKeys = new Set(attrs);\r\n  }\r\n\r\n  push() {\r\n    this.stack.push(this.container);\r\n    this.stack.push(new Set(this.inheritDomAttrKeys));\r\n    this.stack.push(Object.assign({}, this.inheritDomAttrs));\r\n  }\r\n\r\n  pop() {\r\n    this.inheritDomAttrs = this.stack.pop();\r\n    this.inheritDomAttrKeys = this.stack.pop();\r\n    this.container = this.stack.pop();\r\n  }\r\n\r\n  handle(elem) {\r\n    if (elem.constructor === XMLDocument || elem.nodeName === 'root') {\r\n      for (let child of elem.childNodes) {\r\n        this.handle(child);\r\n      }\r\n\r\n      window.tree = elem\r\n      return;\r\n    } else if (elem.constructor === Text || elem.constructor === Comment) {\r\n      return;\r\n    }\r\n\r\n    let tagname = \"\" + elem.tagName;\r\n\r\n    if (tagname in customHandlers) {\r\n      customHandlers[tagname](this, elem);\r\n    } else if (this[tagname]) {\r\n      this[tagname](elem);\r\n    } else {\r\n      let elem2 = UIBase.createElement(tagname.toLowerCase());\r\n\r\n      window.__elem = elem;\r\n      //transfer DOM attributes\r\n      for (let k of elem.getAttributeNames()) {\r\n        elem2.setAttribute(k, elem.getAttribute(k));\r\n      }\r\n\r\n      if (elem2 instanceof UIBase) {\r\n        if (!elem2.hasAttribute(\"datapath\") && elem2.hasAttribute(\"path\")) {\r\n          elem2.setAttribute(\"datapath\", elem2.getAttribute(\"path\"));\r\n        }\r\n\r\n        if (elem2.hasAttribute(\"datapath\")) {\r\n          let path = elem2.getAttribute(\"datapath\");\r\n          path = this.container._joinPrefix(path);\r\n          elem2.setAttribute(\"datapath\", path);\r\n        }\r\n\r\n        if (elem2.hasAttribute(\"massSetPath\") || this.container.massSetPrefix) {\r\n          let massSetPath = \"\";\r\n\r\n          if (elem2.hasAttribute(\"massSetPath\")) {\r\n            massSetPath = elem2.getAttribute(\"massSetPath\");\r\n          }\r\n\r\n          let path = elem2.getAttribute(\"datapath\");\r\n\r\n          path = this.container._getMassPath(this.container.ctx, path, massSetPath);\r\n          elem2.setAttribute(\"massSetPath\", path);\r\n          elem2.setAttribute(\"mass_set_path\", path);\r\n        }\r\n\r\n        this.container.add(elem2);\r\n        this._style(elem, elem2);\r\n\r\n        if (elem2 instanceof Container) {\r\n          this.push();\r\n\r\n          this.container = elem2;\r\n          this._container(elem, elem2, true);\r\n          this.visit(elem);\r\n\r\n          this.pop();\r\n\r\n          return;\r\n        }\r\n      } else {\r\n        console.warn(\"Unknown element \" + elem.tagName + \" (\" + elem.constructor.name + \")\");\r\n        let elem2 = document.createElement(elem.tagName.toLowerCase());\r\n\r\n        for (let attr of elem.getAttributeNames()) {\r\n          elem2.setAttribute(attr, elem.getAttribute(attr));\r\n        }\r\n\r\n        this._basic(elem, elem2);\r\n\r\n        this.container.shadow.appendChild(elem2);\r\n\r\n        if (!(elem2 instanceof UIBase)) {\r\n          elem2.pathux_ctx = this.container.ctx;\r\n        } else {\r\n          elem2.ctx = this.container.ctx;\r\n        }\r\n      }\r\n\r\n      this.visit(elem);\r\n    }\r\n  }\r\n\r\n  _style(elem, elem2) {\r\n    let style = {};\r\n\r\n    //try to handle class attribute, at least somewhat\r\n\r\n    if (elem.hasAttribute(\"class\")) {\r\n      elem2.setAttribute(\"class\", elem.getAttribute(\"class\"));\r\n\r\n      let cls = elem2.getAttribute(\"class\").trim();\r\n      let keys = [\r\n        cls,\r\n        (elem2.tagName.toLowerCase() + \".\" + cls).trim(),\r\n        \"#\" + elem.getAttribute(\"id\").trim()\r\n      ];\r\n\r\n      for (let sheet of document.styleSheets) {\r\n        for (let rule of sheet.rules) {\r\n          for (let k of keys) {\r\n            if (rule.selectorText.trim() === k) {\r\n              for (let k2 of rule.styleMap.keys()) {\r\n                let val = rule.style[k2]\r\n\r\n                style[k2] = val;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (elem.hasAttribute(\"style\")) {\r\n      let stylecode = elem.getAttribute(\"style\");\r\n\r\n      stylecode = stylecode.split(\";\");\r\n\r\n      for (let row of stylecode) {\r\n        row = row.trim();\r\n\r\n        let i = row.search(/\\:/);\r\n        if (i >= 0) {\r\n          let key = row.slice(0, i).trim();\r\n          let val = row.slice(i + 1, row.length).trim();\r\n\r\n          style[key] = val;\r\n        }\r\n      }\r\n    }\r\n\r\n    let keys = Object.keys(style);\r\n    if (keys.length === 0) {\r\n      return;\r\n    }\r\n\r\n    function setStyle() {\r\n      for (let k of keys) {\r\n        elem2.style[k] = style[k];\r\n      }\r\n    }\r\n\r\n    if (elem2 instanceof UIBase) {\r\n      elem2.setCSS.after(() => {\r\n        setStyle();\r\n      });\r\n    }\r\n\r\n    setStyle();\r\n  }\r\n\r\n  visit(node) {\r\n    for (let child of node.childNodes) {\r\n      this.handle(child)\r\n    }\r\n  }\r\n\r\n  _getattr(elem, k) {\r\n    let val = elem.getAttribute(k);\r\n\r\n    if (!val) {\r\n      return val;\r\n    }\r\n\r\n    if (val.startsWith(\"##\")) {\r\n      val = val.slice(2, val.length).trim();\r\n\r\n      if (!(val in this.templateVars)) {\r\n        console.error(`unknown template variable '${val}'`);\r\n        val = '';\r\n      } else {\r\n        val = this.templateVars[val];\r\n      }\r\n    }\r\n\r\n    return val;\r\n  }\r\n\r\n  _basic(elem, elem2) {\r\n    this._style(elem, elem2);\r\n\r\n    for (let k of elem.getAttributeNames()) {\r\n      if (k.startsWith(\"custom\")) {\r\n        elem2.setAttribute(k, this._getattr(elem, k));\r\n      }\r\n    }\r\n\r\n    let codeattrs = [];\r\n\r\n    for (let k of elem.getAttributeNames()) {\r\n      let val = \"\"+elem.getAttribute(k);\r\n\r\n      if (val.startsWith('ng[')) {\r\n        val = val.slice(3, val.endsWith(\"]\") ? val.length-1 : val.length);\r\n\r\n        codeattrs.push([k, \"ng\", val]);\r\n      }\r\n    }\r\n\r\n    for (let k of domEventAttrs) {\r\n      let k2 = 'on' + k;\r\n\r\n      if (elem.hasAttribute(k2)) {\r\n        codeattrs.push([k, \"dom\", elem.getAttribute(k2)]);\r\n      }\r\n    }\r\n\r\n    for (let [k, eventType, id] of codeattrs) {\r\n      if (!(id in this.codefuncs)) {\r\n        console.error(\"Unknown code fragment \" + id);\r\n        continue;\r\n      }\r\n\r\n      if (eventType === \"dom\") {\r\n        //click events usually don't go through normal\r\n        //dom event system\r\n        if (k === 'click') {\r\n          let onclick = elem2.onclick;\r\n          let func = this.codefuncs[id];\r\n\r\n          elem2.onclick = function () {\r\n            if (onclick) {\r\n              onclick.apply(this, arguments);\r\n            }\r\n\r\n            return func.apply(this, arguments);\r\n          }\r\n        } else {\r\n          elem2.addEventListener(k, this.codefuncs[id]);\r\n        }\r\n      } else if (eventType === \"ng\") {\r\n        elem2.addEventListener(k, this.codefuncs[id]);\r\n      }\r\n    }\r\n\r\n\r\n    for (let k of domTransferAttrs) {\r\n      if (elem.hasAttribute(k)) {\r\n        elem2.setAttribute(k, elem.getAttribute(k));\r\n      }\r\n    }\r\n\r\n    for (let k in this.inheritDomAttrs) {\r\n      if (!elem.hasAttribute(k)) {\r\n        elem.setAttribute(k, this.inheritDomAttrs[k]);\r\n      }\r\n    }\r\n\r\n    for (let k of sliderDomAttributes) {\r\n      if (elem.hasAttribute(k)) {\r\n        elem2.setAttribute(k, elem.getAttribute(k));\r\n      }\r\n    }\r\n\r\n    if (!(elem2 instanceof UIBase)) {\r\n      return;\r\n    }\r\n\r\n    if (elem.hasAttribute(\"theme-class\")) {\r\n      elem2.overrideClass(elem.getAttribute(\"theme-class\"));\r\n\r\n      if (elem2._init_done) {\r\n        elem2.setCSS();\r\n        elem2.flushUpdate();\r\n      }\r\n    }\r\n\r\n    if (elem.hasAttribute(\"useIcons\") && typeof elem2.useIcons === \"function\") {\r\n      let val = elem.getAttribute(\"useIcons\").trim().toLowerCase();\r\n\r\n      if (val === \"small\" || val === \"true\" || val === \"yes\") {\r\n        val = true;\r\n      } else if (val === \"large\") {\r\n        val = 1;\r\n      } else if (val === \"false\" || val === \"no\") {\r\n        val = false;\r\n      } else {\r\n        val = parseInt(val) - 1;\r\n      }\r\n\r\n      elem2.useIcons(val);\r\n    }\r\n\r\n    if (elem.hasAttribute(\"sliderTextBox\")) {\r\n      let textbox = getbool(elem, \"sliderTextBox\");\r\n\r\n      if (textbox) {\r\n        elem2.packflag &= ~PackFlags.NO_NUMSLIDER_TEXTBOX;\r\n        elem2.inherit_packflag &= ~PackFlags.NO_NUMSLIDER_TEXTBOX;\r\n      } else {\r\n        elem2.packflag |= PackFlags.NO_NUMSLIDER_TEXTBOX;\r\n        elem2.inherit_packflag |= PackFlags.NO_NUMSLIDER_TEXTBOX;\r\n      }\r\n\r\n      //console.error(\"textBox\", textbox, elem2, elem.getAttribute(\"sliderTextBox\"), elem2.packflag);\r\n    }\r\n\r\n    if (elem.hasAttribute(\"sliderMode\")) {\r\n      let sliderMode = elem.getAttribute(\"sliderMode\");\r\n\r\n      if (sliderMode === \"slider\") {\r\n        elem2.packflag &= ~PackFlags.FORCE_ROLLER_SLIDER;\r\n        elem2.inherit_packflag &= ~PackFlags.FORCE_ROLLER_SLIDER;\r\n\r\n        elem2.packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n        elem2.inherit_packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n      } else if (sliderMode === \"roller\") {\r\n        elem2.packflag &= ~PackFlags.SIMPLE_NUMSLIDERS;\r\n        elem2.packflag |= PackFlags.FORCE_ROLLER_SLIDER;\r\n\r\n        elem2.inherit_packflag &= ~PackFlags.SIMPLE_NUMSLIDERS;\r\n        elem2.inherit_packflag |= PackFlags.FORCE_ROLLER_SLIDER;\r\n      }\r\n\r\n      //console.error(\"sliderMode\", sliderMode, elem2, elem2.packflag & (PackFlags.SIMPLE_NUMSLIDERS | PackFlags.FORCE_ROLLER_SLIDER));\r\n    }\r\n\r\n    if (elem.hasAttribute(\"showLabel\")) {\r\n      let state = getbool(elem, \"showLabel\");\r\n\r\n      if (state) {\r\n        elem2.packflag |= PackFlags.FORCE_PROP_LABELS;\r\n        elem2.inherit_packflag |= PackFlags.FORCE_PROP_LABELS;\r\n      } else {\r\n        elem2.packflag &= ~PackFlags.FORCE_PROP_LABELS;\r\n        elem2.inherit_packflag &= ~PackFlags.FORCE_PROP_LABELS;\r\n      }\r\n    }\r\n\r\n    function doBox(key) {\r\n      if (elem.hasAttribute(key)) {\r\n        let val = elem.getAttribute(key).toLowerCase().trim();\r\n\r\n        if (val.endsWith(\"px\")) {\r\n          val = val.slice(0, val.length - 2).trim();\r\n        }\r\n\r\n        if (val.endsWith(\"%\")) {\r\n          //eek! don't support at all?\r\n          //or use aspect overlay?\r\n\r\n          console.warn(`Relative styling of '${key}' may be unstable for this element`, elem);\r\n\r\n          elem.setCSS.after(function () {\r\n            this.style[key] = val;\r\n          });\r\n        } else {\r\n          val = parseFloat(val);\r\n\r\n          if (isNaN(val) || typeof val !== \"number\") {\r\n            console.error(`Invalid style ${key}:${elem.getAttribute(key)}`);\r\n            return;\r\n          }\r\n\r\n          elem2.overrideDefault(key, val);\r\n          elem2.setCSS();\r\n          elem2.style[key] = \"\" + val + \"px\";\r\n        }\r\n      }\r\n    }\r\n\r\n    doBox(\"width\");\r\n    doBox(\"height\");\r\n    doBox(\"margin\");\r\n    doBox(\"padding\");\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let key = i ? \"margin\" : \"padding\";\r\n\r\n      doBox(key + \"-bottom\");\r\n      doBox(key + \"-top\");\r\n      doBox(key + \"-left\");\r\n      doBox(key + \"-right\");\r\n    }\r\n  }\r\n\r\n  _handlePathPrefix(elem, con) {\r\n    if (elem.hasAttribute(\"path\")) {\r\n      let prefix = con.dataPrefix;\r\n      let path = elem.getAttribute(\"path\").trim();\r\n\r\n      if (prefix.length > 0) {\r\n        prefix += \".\";\r\n      }\r\n\r\n      prefix += path;\r\n      con.dataPrefix = prefix;\r\n    }\r\n\r\n    if (elem.hasAttribute(\"massSetPath\")) {\r\n      let prefix = con.massSetPrefix;\r\n      let path = elem.getAttribute(\"massSetPath\").trim();\r\n\r\n      if (prefix.length > 0) {\r\n        prefix += \".\";\r\n      }\r\n\r\n      prefix += path;\r\n      con.massSetPrefix = prefix;\r\n    }\r\n  }\r\n\r\n  _container(elem, con, ignorePathPrefix=false) {\r\n    for (let k of this.inheritDomAttrKeys) {\r\n      if (elem.hasAttribute(k)) {\r\n        this.inheritDomAttrs[k] = elem.getAttribute(k);\r\n      }\r\n    }\r\n\r\n    let packflag = getPackFlag(elem);\r\n\r\n    con.packflag |= packflag;\r\n    con.inherit_packflag |= packflag;\r\n\r\n    this._basic(elem, con);\r\n\r\n    if (!ignorePathPrefix) {\r\n      this._handlePathPrefix(elem, con);\r\n    }\r\n  }\r\n  noteframe(elem) {\r\n    let ret = this.container.noteframe();\r\n\r\n    if (ret) {\r\n      this._basic(elem, ret);\r\n    }\r\n  }\r\n\r\n  cell(elem) {\r\n    this.push();\r\n    this.container = this.container.cell();\r\n    this._container(elem, this.container);\r\n    this.visit(elem);\r\n    this.pop();\r\n  }\r\n\r\n  table(elem) {\r\n    this.push();\r\n    this.container = this.container.table();\r\n    this._container(elem, this.container);\r\n    this.visit(elem);\r\n    this.pop();\r\n  }\r\n\r\n  panel(elem) {\r\n    let title = \"\" + elem.getAttribute(\"label\")\r\n    let closed = getbool(elem, \"closed\")\r\n\r\n    this.push()\r\n    this.container = this.container.panel(title);\r\n    this.container.closed = closed;\r\n\r\n    this._container(elem, this.container);\r\n\r\n    this.visit(elem)\r\n\r\n    this.pop();\r\n  }\r\n\r\n  pathlabel(elem) {\r\n    this._prop(elem, \"pathlabel\")\r\n  }\r\n\r\n  /**\r\n   handle a code element, which are wrapped in functions\r\n   */\r\n  code(elem) {\r\n    window._codelem = elem;\r\n\r\n    let buf = '';\r\n\r\n    for (let elem2 of elem.childNodes) {\r\n      if (elem2.nodeName === \"#text\") {\r\n        buf += elem2.textContent + '\\n';\r\n      }\r\n    }\r\n\r\n    var func, $scope = this.templateScope;\r\n\r\n    buf = `\r\nfunc = function() {\r\n  ${buf};\r\n}\r\n    `;\r\n\r\n    eval(buf);\r\n\r\n    let id = \"\" + elem.getAttribute(\"id\");\r\n\r\n    this.codefuncs[id] = func;\r\n  }\r\n\r\n  textbox(elem) {\r\n    if (elem.hasAttribute(\"path\")) {\r\n      this._prop(elem, 'textbox');\r\n    } else {\r\n      //let elem2 = this.container.textbox();\r\n      //this._basic(elem, elem2);\r\n    }\r\n  }\r\n\r\n  label(elem) {\r\n    let elem2 = this.container.label(elem.innerHTML);\r\n    this._basic(elem, elem2);\r\n  }\r\n\r\n  colorfield(elem) {\r\n    this._prop(elem, \"colorfield\");\r\n  }\r\n\r\n  /** simpleSliders=true enables simple sliders */\r\n  prop(elem) {\r\n    this._prop(elem, \"prop\")\r\n  }\r\n\r\n  _prop(elem, key) {\r\n    let packflag = getPackFlag(elem);\r\n    let path = elem.getAttribute(\"path\");\r\n\r\n    let elem2;\r\n    if (key === 'pathlabel') {\r\n      elem2 = this.container.pathlabel(path, elem.innerHTML, packflag);\r\n    } else if (key === 'textbox') {\r\n      elem2 = this.container.textbox(path, undefined, undefined, packflag);\r\n\r\n      elem2.update();\r\n\r\n      //make textboxes non-modal by default\r\n      if (elem.hasAttribute(\"modal\")) {\r\n        elem2.setAttribute(\"modal\", elem.getAttribute(\"modal\"));\r\n      }\r\n\r\n      if (elem.hasAttribute(\"realtime\")) {\r\n        elem2.setAttribute(\"realtime\", elem.getAttribute(\"realtime\"));\r\n      }\r\n    } else if (key === \"colorfield\") {\r\n      elem2 = this.container.colorPicker(path, {\r\n        packflag,\r\n        themeOverride: elem.hasAttribute(\"theme-class\") ? elem.getAttribute(\"theme-class\") : undefined\r\n      });\r\n    } else {\r\n      elem2 = this.container[key](path, packflag);\r\n    }\r\n\r\n    if (!elem2) {\r\n      elem2 = document.createElement(\"span\");\r\n      elem2.innerHTML = \"error\";\r\n      this.container.shadow.appendChild(elem2);\r\n    } else {\r\n      this._basic(elem, elem2);\r\n\r\n      if (elem.hasAttribute(\"massSetPath\") || this.container.massSetPrefix) {\r\n        let mpath = elem.getAttribute(\"massSetPath\");\r\n        if (!mpath) {\r\n          mpath = elem.getAttribute(\"path\");\r\n        }\r\n\r\n        mpath = this.container._getMassPath(this.container.ctx, path, mpath);\r\n\r\n        elem2.setAttribute(\"mass_set_path\", mpath);\r\n      }\r\n    }\r\n  }\r\n\r\n  strip(elem) {\r\n    this.push();\r\n\r\n    let dir;\r\n    if (elem.hasAttribute(\"mode\")) {\r\n      dir = elem.getAttribute(\"mode\").toLowerCase().trim();\r\n      dir = dir === \"horizontal\";\r\n    }\r\n\r\n    let margin1 = getfloat(elem, \"margin1\", undefined);\r\n    let margin2 = getfloat(elem, \"margin2\", undefined);\r\n\r\n    this.container = this.container.strip(undefined, margin1, margin2, dir);\r\n    this._container(elem, this.container);\r\n    this.visit(elem);\r\n\r\n    this.pop();\r\n  }\r\n\r\n  column(elem) {\r\n    this.push();\r\n    this.container = this.container.col();\r\n    this._container(elem, this.container);\r\n    this.visit(elem);\r\n    this.pop();\r\n  }\r\n\r\n  row(elem) {\r\n    this.push();\r\n    this.container = this.container.row();\r\n    this._container(elem, this.container);\r\n    this.visit(elem);\r\n    this.pop();\r\n  }\r\n\r\n  toolPanel(elem) {\r\n    this.tool(elem, \"toolPanel\");\r\n  }\r\n\r\n  tool(elem, key = \"tool\") {\r\n    let path = elem.getAttribute(\"path\");\r\n    let packflag = getPackFlag(elem);\r\n\r\n    let noIcons = false, iconflags;\r\n\r\n    if (getbool(elem, \"useIcons\")) {\r\n      packflag |= PackFlags.USE_ICONS;\r\n    } else if (elem.hasAttribute(\"useIcons\")) {\r\n      packflag &= ~PackFlags.USE_ICONS;\r\n      noIcons = true;\r\n    }\r\n\r\n    let label = (\"\" + elem.textContent).trim()\r\n    if (label.length > 0) {\r\n      path += \"|\" + label;\r\n    }\r\n\r\n    if (noIcons) {\r\n      iconflags = this.container.useIcons(false);\r\n    }\r\n\r\n    let elem2 = this.container[key](path, packflag);\r\n\r\n    if (elem2) {\r\n      this._basic(elem, elem2);\r\n    } else {\r\n      elem2 = document.createElement(\"strip\")\r\n      elem2.innerHTML = \"error\"\r\n      this.container.shadow.appendChild(elem2);\r\n      this._basic(elem, elem2);\r\n    }\r\n\r\n    if (noIcons) {\r\n      this.container.inherit_packflag |= iconflags;\r\n      this.container.packflag |= iconflags;\r\n    }\r\n  }\r\n\r\n  dropbox(elem) {\r\n    return this.menu(elem, true);\r\n  }\r\n\r\n  menu(elem, isDropBox = false) {\r\n    let packflag = getPackFlag(elem);\r\n    let title = elem.getAttribute(\"name\")\r\n\r\n    let list = [];\r\n\r\n    for (let child of elem.childNodes) {\r\n      if (child.tagName === \"tool\") {\r\n        let path = child.getAttribute(\"path\");\r\n        let label = child.innerHTML.trim();\r\n\r\n        if (label.length > 0) {\r\n          path += \"|\" + label;\r\n        }\r\n\r\n        list.push(path);\r\n      } else if (child.tagName === \"sep\") {\r\n        list.push(Menu.SEP);\r\n      } else if (child.tagName === \"item\") {\r\n        let id, icon, hotkey, description;\r\n\r\n        if (child.hasAttribute(\"id\")) {\r\n          id = child.getAttribute(\"id\");\r\n        }\r\n\r\n        if (child.hasAttribute(\"icon\")) {\r\n          icon = child.getAttribute(\"icon\").toUpperCase().trim();\r\n          icon = Icons[icon];\r\n        }\r\n\r\n        if (child.hasAttribute(\"hotkey\")) {\r\n          hotkey = child.getAttribute(\"hotkey\");\r\n        }\r\n\r\n        if (child.hasAttribute(\"description\")) {\r\n          description = child.getAttribute(\"description\");\r\n        }\r\n\r\n        list.push({\r\n          name: child.innerHTML.trim(),\r\n          id, icon, hotkey, description\r\n        });\r\n      }\r\n    }\r\n\r\n    let ret = this.container.menu(title, list, packflag);\r\n    if (isDropBox) {\r\n      ret.removeAttribute(\"simple\");\r\n    }\r\n\r\n    if (elem.hasAttribute(\"id\")) {\r\n      ret.setAttribute(\"id\", elem.getAttribute(\"id\"));\r\n    }\r\n\r\n    this._basic(elem, ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  button(elem) {\r\n    let title = elem.innerHTML.trim();\r\n\r\n    let ret = this.container.button(title);\r\n\r\n    if (elem.hasAttribute(\"id\")) {\r\n      ret.setAttribute(\"id\", elem.getAttribute(\"id\"));\r\n    }\r\n\r\n    this._basic(elem, ret);\r\n  }\r\n\r\n  iconbutton(elem) {\r\n    let title = elem.innerHTML.trim();\r\n\r\n    let icon = elem.getAttribute(\"icon\");\r\n    if (icon) {\r\n      icon = UIBase.getIconEnum()[icon];\r\n    }\r\n    let ret = this.container.iconbutton(icon, title);\r\n\r\n    if (elem.hasAttribute(\"id\")) {\r\n      ret.setAttribute(\"id\", elem.getAttribute(\"id\"));\r\n    }\r\n\r\n    this._basic(elem, ret);\r\n  }\r\n\r\n  tab(elem) {\r\n    this.push();\r\n\r\n    let title = \"\" + elem.getAttribute(\"label\");\r\n\r\n    let tabs = this.container;\r\n\r\n    this.container = this.container.tab(title);\r\n\r\n    if (elem.hasAttribute(\"overflow\")) {\r\n      this.container.setAttribute(\"overflow\", elem.getAttribute(\"overflow\"));\r\n    }\r\n\r\n    if (elem.hasAttribute(\"overflow-y\")) {\r\n      this.container.setAttribute(\"overflow-y\", elem.getAttribute(\"overflow-y\"));\r\n    }\r\n\r\n    this._container(elem, this.container)\r\n    this.visit(elem);\r\n\r\n    this.pop();\r\n  }\r\n\r\n  tabs(elem) {\r\n    let pos = elem.getAttribute(\"pos\") || \"left\"\r\n\r\n    this.push();\r\n\r\n    let tabs = this.container.tabs(pos)\r\n    this.container = tabs;\r\n\r\n    if (elem.hasAttribute(\"movable-tabs\")) {\r\n      tabs.setAttribute(\"movable-tabs\", elem.getAttribute(\"movable-tabs\"));\r\n    }\r\n\r\n    this._container(elem, tabs);\r\n    this.visit(elem);\r\n\r\n    this.pop();\r\n  }\r\n}\r\n\r\nexport function initPage(ctx, xml, parentContainer = undefined, templateVars = {}, templateScope = {}) {\r\n  let tree = parseXML(xml);\r\n  let container = UIBase.createElement(\"container-x\");\r\n\r\n  container.ctx = ctx;\r\n  if (ctx) {\r\n    container._init();\r\n  }\r\n\r\n  if (parentContainer) {\r\n    parentContainer.add(container);\r\n  }\r\n\r\n  let handler = new Handler(ctx, container);\r\n\r\n  handler.templateVars = Object.assign({}, templateVars);\r\n  handler.templateScope = templateScope;\r\n\r\n  handler.handle(tree);\r\n\r\n  return container;\r\n\r\n}\r\n\r\nexport function loadPage(ctx, url, parentContainer_or_args = undefined, loadSourceOnly = false,\r\n                         modifySourceCB, templateVars, templateScope) {\r\n  let source;\r\n  let parentContainer;\r\n\r\n  if (parentContainer_or_args !== undefined && !(parentContainer_or_args instanceof HTMLElement)) {\r\n    let args = parentContainer_or_args;\r\n\r\n    parentContainer = args.parentContainer;\r\n    loadSourceOnly = args.loadSourceOnly;\r\n    modifySourceCB = args.modifySourceCB;\r\n    templateVars = args.templateVars;\r\n    templateScope = args.templateScope;\r\n  } else {\r\n    parentContainer = parentContainer_or_args;\r\n  }\r\n\r\n  if (pagecache.has(url)) {\r\n    source = pagecache.get(url);\r\n\r\n    if (modifySourceCB) {\r\n      source = modifySourceCB(source);\r\n    }\r\n\r\n    return new Promise((accept, reject) => {\r\n      if (loadSourceOnly) {\r\n        accept(source);\r\n      } else {\r\n        accept(initPage(ctx, source, parentContainer, templateVars, templateScope));\r\n      }\r\n    });\r\n  } else {\r\n    return new Promise((accept, reject) => {\r\n      fetch(url).then(res => res.text()).then(data => {\r\n        pagecache.set(url, data);\r\n\r\n        if (modifySourceCB) {\r\n          data = modifySourceCB(data);\r\n        }\r\n\r\n        if (loadSourceOnly) {\r\n          accept(data);\r\n        } else {\r\n          accept(initPage(ctx, data, parentContainer, templateVars, templateScope));\r\n        }\r\n      });\r\n    });\r\n  }\r\n}\r\n","import {CurveConstructors} from \"./curve1d_base.js\";\r\nimport {EnumProperty} from \"../toolsys/toolprop.js\";\r\n\r\nexport function makeGenEnum() {\r\n  let enumdef = {};\r\n  let uinames = {};\r\n  let icons = {};\r\n\r\n  for (let cls of CurveConstructors) {\r\n    let def = cls.define();\r\n\r\n    let uiname = def.uiname;\r\n    uiname = uiname === undefined ? def.name : uiname;\r\n\r\n    enumdef[def.name] = cls.name;\r\n    uinames[def.name] = uiname;\r\n    icons[def.name] = def.icon !== undefined ? def.icon : -1;\r\n  }\r\n\r\n  //return enumdef;\r\n  return new EnumProperty(undefined, enumdef).addUINames(uinames).addIcons(icons);\r\n}\r\n","import {Curve1DProperty} from \"../path-controller/toolsys/toolprop.js\";\r\nimport {UIBase, Icons} from '../core/ui_base.js';\r\nimport {ColumnFrame, RowFrame} from \"../core/ui.js\";\r\nimport * as util from '../path-controller/util/util.js';\r\nimport {Vector2, Vector3} from \"../path-controller/util/vectormath.js\";\r\nimport {Curve1D,  mySafeJSONStringify} from \"../path-controller/curve/curve1d.js\";\r\nimport {makeGenEnum} from '../path-controller/curve/curve1d_utils.js';\r\n\r\nexport class Curve1DWidget extends ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this.useDataPathUndo = false;\r\n\r\n    this._on_draw = this._on_draw.bind(this);\r\n    this.drawTransform = [1.0, [0, 0]];\r\n\r\n    this._value = new Curve1D();\r\n    this._value.on(\"draw\", this._on_draw);\r\n\r\n    this._value._on_change = (msg) => {\r\n      if (this.onchange) {\r\n        this.onchange(this._value);\r\n      }\r\n\r\n      if (this.hasAttribute(\"datapath\")) {\r\n        let path = this.getAttribute(\"datapath\");\r\n        if (this._value !== undefined) {\r\n          let val = this.getPathValue(this.ctx, path);\r\n\r\n          if (val) {\r\n            val.load(this._value);\r\n            this.setPathValue(this.ctx, path, val);\r\n          } else {\r\n            val = this._value.copy();\r\n            this.setPathValue(this.ctx, path, val);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    this._gen_type = undefined;\r\n    this._lastGen = undefined;\r\n\r\n    this._last_dpi = undefined;\r\n    this.canvas = document.createElement(\"canvas\");\r\n\r\n    this.g = this.canvas.getContext(\"2d\");\r\n    this.canvas.g = this.g;\r\n\r\n    window.cw = this;\r\n    this.shadow.appendChild(this.canvas);\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  _on_draw(e) {\r\n    let curve = e.data;\r\n\r\n    //console.log(\"draw\");\r\n    this._redraw();\r\n  }\r\n\r\n  set value(val) {\r\n    this._value.load(val);\r\n    this.update();\r\n    this._redraw();\r\n  }\r\n\r\n  _on_change() {\r\n    if (this.onchange) {\r\n      this.onchange(this);\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.useDataPathUndo = false;\r\n    let row = this.row();\r\n\r\n    let prop = makeGenEnum();\r\n\r\n    prop.setValue(this.value.generatorType);\r\n\r\n    this.dropbox = row.listenum(undefined, \"Type\", prop, this.value.generatorType, (id) => {\r\n      console.warn(\"SELECT\", id, prop.keys[id]);\r\n\r\n      this.value.setGenerator(id);\r\n      this.value._on_change(\"curve type change\");\r\n    });\r\n    this.dropbox._init();\r\n\r\n    row.iconbutton(Icons.ZOOM_OUT, \"Zoom Out\", () => {\r\n      let curve = this._value;\r\n      if (!curve) return;\r\n      //if (isNaN(curve.uiZoom))\r\n      //  curve.uiZoom = 1.0;\r\n\r\n      curve.uiZoom *= 0.9;\r\n      if (this.getAttribute(\"datapath\")) {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), curve);\r\n      }\r\n\r\n      this._redraw();\r\n    }).iconsheet = 0;\r\n    row.iconbutton(Icons.ZOOM_IN, \"Zoom In\", () => {\r\n      let curve = this._value;\r\n      if (!curve) return;\r\n      //if (isNaN(curve.uiZoom))\r\n      //  curve.uiZoom = 1.0;\r\n\r\n      curve.uiZoom *= 1.1;\r\n      if (this.getAttribute(\"datapath\")) {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), curve);\r\n      }\r\n\r\n      this._redraw();\r\n\r\n    }).iconsheet = 0;\r\n\r\n    this.container = this.col();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.style[\"width\"] = \"min-contents\";\r\n    this.style[\"height\"] = \"min-contents\";\r\n    this.updateSize();\r\n  }\r\n\r\n  updateSize() {\r\n    let dpi = UIBase.getDPI();\r\n    let w = ~~(this.getDefault(\"CanvasWidth\")*dpi);\r\n    let h = ~~(this.getDefault(\"CanvasHeight\")*dpi);\r\n\r\n    let bad = w !== this.canvas.width || h !== this.canvas.height;\r\n    bad = bad || dpi !== this._last_dpi;\r\n\r\n    if (!bad) {\r\n      return;\r\n    }\r\n\r\n    this._last_dpi = dpi;\r\n    this.canvas.width = w;\r\n    this.canvas.height = h;\r\n\r\n    this.canvas.style[\"width\"] = (w/dpi) + \"px\";\r\n    this.canvas.style[\"height\"] = (h/dpi) + \"px\";\r\n\r\n    this._redraw();\r\n  }\r\n\r\n  _redraw() {\r\n    //forcibly clear canvas, works better then clearRect\r\n    this.canvas.width = this.canvas.width;\r\n    this.canvas.height = this.canvas.height;\r\n\r\n    let canvas = this.canvas, g = this.g;\r\n\r\n    //g.clearRect(0, 0, canvas.width, canvas.height);\r\n    g.beginPath();\r\n    g.rect(0, 0, canvas.width, canvas.height);\r\n    g.fillStyle = this.getDefault(\"CanvasBG\");\r\n    g.fill();\r\n\r\n    g.save();\r\n\r\n    let zoom = this._value.uiZoom;\r\n    let scale = Math.max(canvas.width, canvas.height);\r\n\r\n    g.lineWidth /= scale;\r\n\r\n\r\n    this.drawTransform[0] = scale*zoom;\r\n    this.drawTransform[1][0] =  0.0;\r\n    this.drawTransform[1][1] = -1.0;\r\n\r\n    this.drawTransform[1][0] -= 0.5 - 0.5/zoom;\r\n    this.drawTransform[1][1] += 0.5 - 0.5/zoom;\r\n\r\n    //g.scale(scale, scale);\r\n\r\n    g.scale(this.drawTransform[0], -this.drawTransform[0]);\r\n    g.translate(this.drawTransform[1][0], this.drawTransform[1][1]);\r\n\r\n    g.lineWidth /= zoom;\r\n\r\n    this._value.draw(this.canvas, this.g, this.drawTransform);\r\n    g.restore();\r\n  }\r\n\r\n  rebuild() {\r\n    let ctx = this.ctx;\r\n    if (ctx === undefined || this.container === undefined) {\r\n      return;\r\n    }\r\n\r\n\r\n    this._gen_type = this.value.generatorType;\r\n    let col = this.container;\r\n\r\n    if (this._lastGen !== undefined) {\r\n      this._lastGen.killGUI(col, this.canvas);\r\n    }\r\n\r\n    let onchange = this.dropbox.onchange;\r\n    this.dropbox.onchange = undefined\r\n    this.dropbox.setValue(this.value.generatorType);\r\n    this.dropbox.onchange = onchange;\r\n\r\n    col.clear();\r\n\r\n    let gen = this.value.generators.active;\r\n    gen.makeGUI(col, this.canvas);\r\n\r\n    this._lastGen = gen;\r\n\r\n    this._redraw();\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n    let val = this.getPathValue(this.ctx, path);\r\n\r\n    if (this._lastu === undefined) {\r\n      this._lastu = 0;\r\n    }\r\n\r\n    if (val && !val.equals(this._value) && util.time_ms() - this._lastu > 200) {\r\n      this._lastu = util.time_ms();\r\n\r\n      this._value.load(val);\r\n      this.update();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  updateGenUI() {\r\n    let bad = this._lastGen !== this.value.generators.active;\r\n    \r\n    if (bad) {\r\n      this.rebuild();\r\n      this._redraw();\r\n    }\r\n  }\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateDataPath();\r\n    this.updateSize();\r\n    this.updateGenUI();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"curve-widget-x\",\r\n    style   : \"curvewidget\"\r\n  }}\r\n}\r\nUIBase.internalRegister(Curve1DWidget);\r\n","//bind module to global var to get at it in console.\r\n//\r\n//note that require has an api for handling circular\r\n//module refs, in such cases do not use these vars.\r\n\r\nimport {CSSFont} from \"../core/ui_base.js\";\r\n\r\nvar _ui = undefined;\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as ui_widgets from './ui_widgets.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport '../path-controller/util/html5_fileapi.js';\r\nimport {ColumnFrame, RowFrame, Container} from \"../core/ui.js\";\r\n\r\nlet PropFlags = toolprop.PropFlags;\r\nlet PropSubTypes = toolprop.PropSubTypes;\r\n\r\nlet EnumProperty = toolprop.EnumProperty;\r\n\r\nlet Vector2   = vectormath.Vector2,\r\n    UIBase    = ui_base.UIBase,\r\n    PackFlags = ui_base.PackFlags,\r\n    PropTypes = toolprop.PropTypes;\r\n\r\n\r\n//methods to forward to this.contents\r\nlet forward_keys = new Set([\r\n  \"row\", \"col\", \"strip\", \"noteframe\", \"helppicker\", \"vecpopup\",\r\n  \"tabs\", \"table\", \"menu\", \"listbox\", \"panel\",\r\n  \"pathlabel\", \"label\", \"listenum\", \"check\", \"iconcheck\",\r\n  \"button\", \"iconbutton\", \"colorPicker\", \"twocol\",\r\n  \"treeview\", \"slider\", \"simpleslider\", \"curve1d\",\r\n  \"noteframe\", \"vecpopup\",\r\n  \"prop\", \"tool\", \"toolPanel\", \"textbox\", \"dynamicMenu\",\r\n  \"add\", \"prepend\", \"useIcons\", \"noMarginsOrPadding\", \"wrap\"\r\n]);\r\n\r\nexport class PanelFrame extends ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this.titleframe = super.row();\r\n\r\n    this.contents = super.col();\r\n    this.contents._remove = this.contents.remove;\r\n    this.contents.remove = () => {\r\n      this.remove();\r\n    };\r\n\r\n    this._panel = this; //compatibility alias\r\n\r\n    this.contents._panel = this;\r\n    this.iconcheck = UIBase.createElement(\"iconcheck-x\");\r\n    this.iconcheck.noEmboss = true;\r\n\r\n    Object.defineProperty(this.contents, \"closed\", {\r\n      get: () => {\r\n        return this.closed;\r\n      },\r\n\r\n      set: (v) => {\r\n        this.closed = v;\r\n      }\r\n    })\r\n\r\n    Object.defineProperty(this.contents, \"title\", {\r\n      get: () => this.titleframe.getAttribute(\"title\"),\r\n      set: (v) => this.setHeaderToolTip(v)\r\n    });\r\n\r\n    this.packflag = this.inherit_packflag = 0;\r\n\r\n    this._closed = false;\r\n\r\n    this.makeHeader();\r\n  }\r\n\r\n  get inherit_packflag() {\r\n    if (!this.contents) return;\r\n    return this.contents.inherit_packflag;\r\n  }\r\n\r\n  set inherit_packflag(val) {\r\n    if (!this.contents) return;\r\n    this.contents.inherit_packflag = val;\r\n  }\r\n\r\n  get packflag() {\r\n    if (!this.contents) return;\r\n    return this.contents.packflag;\r\n  }\r\n\r\n  set packflag(val) {\r\n    if (!this.contents) return;\r\n    this.contents.packflag = val;\r\n  }\r\n\r\n  appendChild(child) {\r\n    return this.contents.shadow.appendChild(child);\r\n  }\r\n\r\n  get headerLabel() {\r\n    return this.__label.text;\r\n  }\r\n\r\n  set headerLabel(v) {\r\n    this.__label.text = v;\r\n    this.__label._updateFont();\r\n\r\n    if (this.hasAttribute(\"label\")) {\r\n      this.setAttribute(\"label\", v);\r\n    }\r\n\r\n    if (this.ctx) {\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  get dataPrefix() {\r\n    return this.contents ? this.contents.dataPrefix : \"\";\r\n  }\r\n\r\n  set dataPrefix(v) {\r\n    if (this.contents) {\r\n      this.contents.dataPrefix = v;\r\n    }\r\n  }\r\n\r\n  get closed() {\r\n    return this._closed;\r\n  }\r\n\r\n  set closed(val) {\r\n    let update = !!val !== !!this.closed;\r\n    this._closed = val;\r\n\r\n    //console.log(\"closed set\", update);\r\n    if (update) {\r\n      this._updateClosed(true);\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname            : \"panelframe-x\",\r\n      style              : \"panel\",\r\n      subclassChecksTheme: true\r\n    };\r\n  }\r\n\r\n  setHeaderToolTip(tooltip) {\r\n    this.titleframe.setAttribute(\"title\", tooltip);\r\n\r\n    this.titleframe._forEachChildWidget((child) => {\r\n      child.setAttribute(\"title\", tooltip);\r\n    });\r\n  }\r\n\r\n  saveData() {\r\n    let ret = {\r\n      closed: this._closed\r\n    };\r\n\r\n    return Object.assign(super.saveData(), ret);\r\n  }\r\n\r\n  loadData(obj) {\r\n    if (!(\"closed\" in obj)) {\r\n      this.closed = obj._closed;\r\n    } else {\r\n      this.closed = obj.closed;\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this.contents.clear();\r\n    return this;\r\n  }\r\n\r\n  makeHeader() {\r\n    let row = this.titleframe;\r\n\r\n    let iconcheck = this.iconcheck;\r\n\r\n    if (!iconcheck) {\r\n      return;\r\n    }\r\n\r\n    iconcheck.overrideDefault(\"padding\", 0);\r\n\r\n    iconcheck.noMarginsOrPadding();\r\n\r\n    iconcheck.overrideDefault(\"highlight\", {\r\n      \"background-color\" : iconcheck.getSubDefault(\"highlight\", \"background-color\")\r\n    });\r\n\r\n    iconcheck.overrideDefault(\"background-color\", \"rgba(0,0,0,0)\");\r\n    iconcheck.overrideDefault(\"BoxDepressed\", \"rgba(0,0,0,0)\");\r\n    iconcheck.overrideDefault(\"border-color\", \"rgba(0,0,0,0)\");\r\n\r\n    iconcheck.ctx = this.ctx;\r\n    iconcheck._icon_pressed = ui_base.Icons.UI_EXPAND;\r\n    iconcheck._icon = ui_base.Icons.UI_COLLAPSE;\r\n    iconcheck.drawCheck = false;\r\n    iconcheck.iconsheet = ui_base.IconSheets.SMALL;\r\n    iconcheck.checked = this._closed;\r\n\r\n    this.iconcheck.onchange = (e) => {\r\n      this.closed = this.iconcheck.checked;\r\n    };\r\n\r\n    row._add(iconcheck);\r\n\r\n    //stupid css, let's just hackishly put \" \" to create spacing2\r\n\r\n    let onclick = (e) => {\r\n      iconcheck.checked = !iconcheck.checked;\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n    };\r\n\r\n    let label = this.__label = row.label(this.getAttribute(\"label\"));\r\n\r\n    this.__label.font = \"TitleText\";\r\n\r\n    label._updateFont();\r\n\r\n    label.noMarginsOrPadding();\r\n    label.addEventListener(\"mousedown\", onclick);\r\n    label.addEventListener(\"touchdown\", onclick);\r\n\r\n    let bs = this.getDefault(\"border-style\");\r\n\r\n    row.background = this.getDefault(\"TitleBackground\");\r\n    row.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n    row.style[\"border\"] = `${this.getDefault(\"border-width\")}px ${bs} ${this.getDefault(\"border-color\")}`;\r\n\r\n    row.style[\"padding-right\"] = \"20px\";\r\n    row.style[\"padding-left\"] = \"5px\";\r\n    row.style[\"padding-top\"] = this.getDefault(\"padding-top\") + \"px\";\r\n    row.style[\"padding-bottom\"] = this.getDefault(\"padding-bottom\") + \"px\";\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.background = this.getDefault(\"background-color\");\r\n    this.style[\"width\"] = \"100%\";\r\n\r\n    this.contents.ctx = this.ctx;\r\n    if (!this._closed) {\r\n      super.add(this.contents);\r\n      this.contents.flushUpdate();\r\n    }\r\n\r\n    this.contents.dataPrefix = this.dataPrefix;\r\n\r\n    //con.style[\"margin-left\"] = \"5px\";\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    if (!this.titleframe || !this.__label) {\r\n      return;\r\n    }\r\n\r\n    let getDefault = (key, defval) => {\r\n      let val = this.getDefault(key);\r\n      return val !== undefined ? val : defval;\r\n    };\r\n\r\n    let bs = this.getDefault(\"border-style\");\r\n\r\n    let header_radius = this.getDefault(\"HeaderRadius\");\r\n    if (header_radius === undefined) {\r\n      header_radius = this.getDefault(\"border-radius\");\r\n    }\r\n\r\n    let boxmargin = getDefault(\"padding\", 0);\r\n\r\n    let paddingleft = getDefault(\"padding-left\", 0);\r\n    let paddingright = getDefault(\"padding-right\", 0);\r\n\r\n    paddingleft += boxmargin;\r\n    paddingright += boxmargin;\r\n\r\n    this.titleframe.background = this.getDefault(\"TitleBackground\");\r\n    this.titleframe.style[\"border-radius\"] = header_radius + \"px\";\r\n    this.titleframe.style[\"border\"] = `${this.getDefault(\"border-width\")}px ${bs} ${this.getDefault(\"TitleBorder\")}`;\r\n    this.style[\"border\"] = `${this.getDefault(\"border-width\")}px ${bs} ${this.getDefault(\"border-color\")}`;\r\n    this.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n\r\n    this.titleframe.style[\"padding-top\"] = this.getDefault(\"padding-top\") + \"px\";\r\n    this.titleframe.style[\"padding-bottom\"] = this.getDefault(\"padding-bottom\") + \"px\";\r\n    this.titleframe.style[\"padding-left\"] = paddingleft + \"px\";\r\n    this.titleframe.style[\"padding-right\"] = paddingright + \"px\";\r\n    this.titleframe.style[\"margin-bottom\"] = \"0px\";\r\n    this.titleframe.style[\"margin-top\"] = \"0px\";\r\n\r\n    this.__label.style[\"border\"] = \"unset\";\r\n    this.__label.style[\"border-radius\"] = \"unset\";\r\n\r\n    let bg = this.getDefault(\"background-color\");\r\n\r\n    this.background = bg;\r\n    this.contents.background = bg;\r\n    this.contents.parentWidget = this;\r\n    this.contents.style[\"background-color\"] = bg;\r\n    this.style[\"background-color\"] = bg;\r\n\r\n    let margintop, marginbottom;\r\n\r\n    if (this._closed) {\r\n      margintop = getDefault('margin-top-closed', 0);\r\n      marginbottom = getDefault('margin-bottom-closed', 5);\r\n    } else {\r\n      margintop = getDefault('margin-top', 0);\r\n      marginbottom = getDefault('margin-bottom', 0);\r\n    }\r\n\r\n    let marginleft = getDefault('margin-left', 0);\r\n    let marginright = getDefault('margin-right', 0);\r\n\r\n    this.style['margin-left'] = marginleft + \"px\";\r\n    this.style['margin-right'] = marginright + \"px\";\r\n\r\n    this.style['margin-top'] = margintop + \"px\";\r\n    this.style['margin-bottom'] = marginbottom + \"px\";\r\n\r\n    //this.style[\"padding-left\"] = paddingleft + \"px\";\r\n    //this.style[\"padding-right\"] = paddingright + \"px\";\r\n\r\n    this.__label._updateFont();\r\n  }\r\n\r\n  on_disabled() {\r\n    super.on_disabled();\r\n\r\n    this.__label._updateFont();\r\n    this.setCSS();\r\n  }\r\n\r\n  on_enabled() {\r\n    super.on_enabled();\r\n\r\n    this.__label.setCSS();\r\n    this.__label.style[\"color\"] = this.style[\"color\"];\r\n    this.setCSS();\r\n  }\r\n\r\n  update() {\r\n    let text = this.getAttribute(\"label\");\r\n\r\n    let update = text !== this.__label.text;\r\n\r\n    if (this.checkThemeUpdate()) {\r\n      update = true;\r\n      this._setVisible(this.closed, true);\r\n      this.setCSS();\r\n      this.flushSetCSS();\r\n    }\r\n\r\n    if (update) {\r\n      this.headerLabel = this.getAttribute(\"label\")\r\n\r\n      this.__label._updateFont();\r\n      this.setCSS();\r\n    }\r\n\r\n    super.update();\r\n  }\r\n\r\n  _onchange(isClosed) {\r\n    if (this.onchange) {\r\n      this.onchange(isClosed);\r\n    }\r\n\r\n    if (this.contents.onchange) {\r\n      this.contents.onchange(isClosed);\r\n    }\r\n  }\r\n\r\n  //catch setAttribute so we can detect label update\r\n  //even if close and updates disabled\r\n  setAttribute(key, value) {\r\n    let ret = super.setAttribute(key, value);\r\n\r\n    if (this.ctx) {\r\n      this.update();\r\n      this.flushUpdate();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  get noUpdateClosedContents() {\r\n    if (!this.hasAttribute(\"update-closed-contents\")) {\r\n      return false;\r\n    }\r\n\r\n    let ret = this.getAttribute(\"update-closed-contents\");\r\n    return ret === \"true\" || ret === \"on\";\r\n  }\r\n\r\n  set noUpdateClosedContents(v) {\r\n    this.setAttribute(\"update-closed-contents\", v ? \"true\" : \"false\");\r\n  }\r\n\r\n  _setVisible(isClosed, changed) {\r\n    changed = changed || !!isClosed !== !!this._closed;\r\n\r\n    this._state = isClosed;\r\n\r\n    if (isClosed) {\r\n      this.contents.style.display = \"none\";\r\n\r\n      //this.contents._remove();\r\n      //this.contents.hide(true);\r\n      if (!this.noUpdateClosedContents) {\r\n        this.contents.packflag |= PackFlags.NO_UPDATE;\r\n      }\r\n    } else {\r\n      //this.contents.hide(false);\r\n      this.contents.style.display = \"flex\";\r\n      this.contents.packflag &= ~PackFlags.NO_UPDATE;\r\n      this.contents.flushUpdate();\r\n    }\r\n\r\n    this.contents.hidden = isClosed;\r\n\r\n    if (this.parentWidget) {\r\n      this.parentWidget.flushUpdate();\r\n    } else {\r\n      this.flushUpdate();\r\n    }\r\n\r\n    if (changed) {\r\n      this._onchange(isClosed);\r\n    }\r\n\r\n    /*\r\n    for (let c of this.shadow.childNodes) {\r\n      if (c !== this.titleframe) {\r\n        c.hidden = state;\r\n      }\r\n    }*/\r\n  }\r\n\r\n  _updateClosed(changed) {\r\n    this._setVisible(this._closed, changed);\r\n\r\n    if (this.iconcheck) {\r\n      this.iconcheck.checked = this._closed;\r\n    }\r\n  }\r\n}\r\n\r\n\r\nlet makeForward = (k) => {\r\n  return function() {\r\n    return this.contents[k](...arguments);\r\n  }\r\n};\r\n\r\nfor (let k of forward_keys) {\r\n  PanelFrame.prototype[k] = makeForward(k);\r\n}\r\n\r\nUIBase.internalRegister(PanelFrame);\r\n","\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as ui from '../core/ui.js';\r\nimport {PropTypes} from '../path-controller/toolsys/toolprop.js';\r\nimport {keymap} from '../path-controller/util/simple_events.js';\r\nimport cconst from '../config/const.js';\r\nimport {color2web, web2color, validateWebColor} from \"../core/ui_base.js\";\r\n\r\nlet Vector2 = vectormath.Vector2,\r\n    Vector3 = vectormath.Vector3,\r\n    Vector4 = vectormath.Vector4,\r\n    Matrix4 = vectormath.Matrix4;\r\n\r\nexport {rgb_to_hsv, hsv_to_rgb} from \"../path-controller/util/colorutils.js\";\r\nimport {rgb_to_hsv, hsv_to_rgb, cmyk_to_rgb, rgb_to_cmyk} from \"../path-controller/util/colorutils.js\";\r\nimport {contextWrangler} from '../screen/area_wrangler.js';\r\n\r\nlet UIBase     = ui_base.UIBase,\r\n    PackFlags  = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nlet UPW = 1.25, VPW = 0.75;\r\n\r\n//*\r\nlet sample_rets = new util.cachering(() => [0, 0], 64);\r\n\r\nexport function inv_sample(u, v) {\r\n  let ret = sample_rets.next();\r\n\r\n  ret[0] = Math.pow(u, UPW);\r\n  ret[1] = Math.pow(v, VPW);\r\n\r\n  return ret;\r\n}\r\n\r\nexport function sample(u, v) {\r\n  let ret = sample_rets.next();\r\n\r\n  ret[0] = Math.pow(u, 1.0/UPW);\r\n  ret[1] = Math.pow(v, 1.0/VPW);\r\n\r\n  return ret;\r\n}\r\n\r\n//*/\r\n\r\n/* shared methods for clipboard handling */\r\nfunction colorClipboardCopy() {\r\n  let rgba = this.getRGBA();\r\n\r\n  let r = rgba[0]*255;\r\n  let g = rgba[1]*255;\r\n  let b = rgba[2]*255;\r\n  let a = rgba[3];\r\n\r\n  let data = `rgba(${r.toFixed(4)}, ${g.toFixed(4)}, ${b.toFixed(4)}, ${a.toFixed(4)})`;\r\n  //cconst.setClipboardData(\"color\", \"text/css\", data);\r\n\r\n  cconst.setClipboardData(\"color\", \"text/plain\", data);\r\n}\r\n\r\nfunction colorClipboardPaste() {\r\n  let data = cconst.getClipboardData(\"text/plain\");\r\n\r\n  if (!data || !validateCSSColor(\"\" + data.data)) {// || data.mime !== \"text/css\") {\r\n    return;\r\n  }\r\n\r\n  let color;\r\n\r\n  try {\r\n    color = css2color(data.data);\r\n  } catch (error) {\r\n    //not a color\r\n    console.log(error.stack);\r\n    console.log(error.message);\r\n  }\r\n\r\n  if (color) {\r\n    if (color.length < 4) {\r\n      color.push(1.0);\r\n    }\r\n\r\n    this.setRGBA(color);\r\n  }\r\n}\r\n\r\nlet fieldrand = new util.MersenneRandom(0);\r\n\r\nlet huefields = {};\r\n\r\nexport function getHueField(width, height, dpi) {\r\n  let key = width + \":\" + height + \":\" + dpi.toFixed(4);\r\n\r\n  if (key in huefields) {\r\n    return huefields[key];\r\n  }\r\n\r\n  let field = new ImageData(width, height);\r\n  let idata = field.data;\r\n\r\n  for (let i = 0; i < width*height; i++) {\r\n    let ix = i%width, iy = ~~(i/width);\r\n    let idx = i*4;\r\n\r\n    let rgb = hsv_to_rgb(ix/width, 1, 1);\r\n\r\n    idata[idx] = rgb[0]*255;\r\n    idata[idx + 1] = rgb[1]*255;\r\n    idata[idx + 2] = rgb[2]*255;\r\n    idata[idx + 3] = 255;\r\n  }\r\n\r\n  //*\r\n  let canvas = document.createElement(\"canvas\");\r\n  canvas.width = field.width;\r\n  canvas.height = field.height;\r\n  let g = canvas.getContext(\"2d\");\r\n  g.putImageData(field, 0, 0);\r\n  field = canvas;\r\n  //*/\r\n\r\n  huefields[key] = field;\r\n  return field;\r\n}\r\n\r\nlet fields = {};\r\n\r\nexport function getFieldImage(fieldsize, width, height, hsva) {\r\n  fieldrand.seed(0);\r\n\r\n  /* render field at half res and upscale via canvas2d */\r\n  let width2 = width>>1;\r\n  let height2 = height>>1;\r\n  let fieldsize2 = fieldsize>>1;\r\n\r\n  let hue = hsva[0];\r\n  let hue_rgb = hsv_to_rgb(hue, 1.0, 1.0);\r\n  let key = fieldsize + \":\" + width2 + \":\" + height2 + \":\" + hue.toFixed(5);\r\n\r\n  if (key in fields)\r\n    return fields[key];\r\n\r\n  let size2 = fieldsize2;\r\n  let valpow = 0.75;\r\n\r\n  let image = {\r\n    width : width,\r\n    height: height,\r\n    image : new ImageData(fieldsize2, fieldsize2),\r\n\r\n    x2sat: (x) => {\r\n      return Math.min(Math.max(x/width, 0), 1);\r\n    },\r\n    y2val: (y) => {\r\n      y = 1.0 - Math.min(Math.max(y/height, 0), 1);\r\n\r\n      return y === 0.0 ? 0.0 : y**valpow;\r\n    },\r\n    sat2x: (s) => {\r\n      return s*width;\r\n    },\r\n    val2y: (v) => {\r\n      if (v === 0)\r\n        return height;\r\n\r\n      v = v**(1.0/valpow);\r\n      return (1.0 - v)*height;\r\n    }\r\n  };\r\n\r\n  image.params = {\r\n    box: {\r\n      x     : 0,\r\n      y     : 0,\r\n      width : width,\r\n      height: height\r\n    }\r\n  };\r\n\r\n  let idata = image.image.data;\r\n  for (let i = 0; i < idata.length; i += 4) {\r\n    let i2 = i/4;\r\n    let x = i2%size2, y = ~~(i2/size2);\r\n\r\n    let v = 1.0 - (y/size2);\r\n    let s = (x/size2);\r\n\r\n    let rgb = hsv_to_rgb(hsva[0], s, v**valpow);\r\n\r\n    idata[i] = rgb[0]*255;\r\n    idata[i + 1] = rgb[1]*255;\r\n    idata[i + 2] = rgb[2]*255;\r\n    idata[i + 3] = 255;\r\n  }\r\n\r\n  //*\r\n  let image2 = document.createElement(\"canvas\");\r\n  image2.width = size2;\r\n  image2.height = size2;\r\n  let g = image2.getContext(\"2d\");\r\n  g.putImageData(image.image, 0, 0);\r\n  //*/\r\n  image.canvas = image2;\r\n  image.scale = width/size2;\r\n\r\n  fields[key] = image;\r\n  return image;\r\n}\r\n\r\n\r\nlet _update_temp = new Vector4();\r\n\r\nexport class SimpleBox {\r\n  constructor(pos = [0, 0], size = [1, 1]) {\r\n    this.pos = new Vector2(pos);\r\n    this.size = new Vector2(size);\r\n    this.r = 0;\r\n  }\r\n}\r\n\r\nexport class HueField extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.g = this.canvas.getContext(\"2d\");\r\n    this.shadow.appendChild(this.canvas);\r\n\r\n    let setFromXY = (x, y) => {\r\n      let dpi = this.getDPI();\r\n      let pad = this._getPad();\r\n\r\n      let w = this.canvas.width/dpi - pad*2.0;\r\n      x -= pad;\r\n\r\n      let h = x/w;\r\n      h = Math.min(Math.max(h, 0.0), 1.0);\r\n\r\n      this.hsva[0] = h;\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.hsva);\r\n      }\r\n\r\n      this._redraw();\r\n    };\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Left\"]:\r\n        case keymap[\"Right\"]:\r\n          let sign = e.keyCode === keymap[\"Left\"] ? -1 : 1;\r\n\r\n          this.hsva[0] = Math.min(Math.max(this.hsva[0] + 0.05*sign, 0.0), 1.0);\r\n          this._redraw();\r\n\r\n          if (this.onchange) {\r\n            this.onchange();\r\n          }\r\n          break;\r\n      }\r\n    });\r\n\r\n    this.addEventListener(\"mousedown\", (e) => {\r\n      if (this.modalRunning) {\r\n        return;\r\n      }\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n\r\n      let rect = this.canvas.getClientRects()[0];\r\n      let x = e.clientX - rect.x, y = e.clientY - rect.y;\r\n\r\n      setFromXY(x, y);\r\n\r\n      this.pushModal({\r\n        on_mousemove: (e) => {\r\n          let rect = this.canvas.getClientRects()[0];\r\n          let x = e.clientX - rect.x, y = e.clientY - rect.y;\r\n\r\n          setFromXY(x, y);\r\n        },\r\n        on_mousedown: (e) => {\r\n          this.popModal();\r\n        },\r\n        on_mouseup  : (e) => {\r\n          this.popModal();\r\n        },\r\n        on_keydown  : (e) => {\r\n          if (e.keyCode === keymap[\"Enter\"] || e.keyCode === keymap[\"Escape\"] || e.keyCode === keymap[\"Space\"]) {\r\n            this.popModal();\r\n          }\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n\r\n  static define() {\r\n    return {\r\n      tagname          : \"huefield-x\",\r\n      style            : \"colorfield\",\r\n      havePickClipboard: true\r\n    };\r\n  }\r\n\r\n  getRGBA() {\r\n    let rgb = hsv_to_rgb(this.hsva[0], this.hsva[1], this.hsva[2]);\r\n    return new Vector4().loadXYZW(rgb[0], rgb[1], rgb[2], this.hsva[3]);\r\n  }\r\n\r\n  setRGBA(rgba) {\r\n    let hsv = rgb_to_hsv(rgba[0], rgba[1], rgba[2]);\r\n    this.hsva.loadXYZW(hsv[0], hsv[1], hsv[2], rgba[3]);\r\n\r\n    this._redraw();\r\n\r\n    if (this.onchange) {\r\n      this.onchange(this.hsva);\r\n    }\r\n  }\r\n\r\n  clipboardCopy() {\r\n    colorClipboardCopy.apply(this, arguments);\r\n  }\r\n\r\n  clipboardPaste() {\r\n    colorClipboardPaste.apply(this, arguments);\r\n  }\r\n\r\n  _getPad() {\r\n    return Math.max(this.getDefault(\"circleSize\"), 15);\r\n  }\r\n\r\n  _redraw() {\r\n    let g = this.g, canvas = this.canvas;\r\n    let dpi = this.getDPI();\r\n\r\n    let w = this.getDefault(\"width\");\r\n    let h = this.getDefault(\"hueHeight\");\r\n\r\n    canvas.width = ~~(w*dpi);\r\n    canvas.height = ~~(h*dpi);\r\n\r\n    canvas.style[\"width\"] = w + \"px\";\r\n    canvas.style[\"height\"] = h + \"px\";\r\n\r\n    /* create horizontal padding to make selection of\r\n     *  endpoint hue easier */\r\n\r\n    let rselector = ~~(this._getPad()*dpi); //~~(this.getDefault(\"circleSize\")*dpi);\r\n    let r_circle = this.getDefault(\"circleSize\")*dpi;\r\n\r\n    let w2 = canvas.width, h2 = canvas.height;\r\n\r\n    w2 -= rselector*2.0;\r\n\r\n    //g.drawImage(getHueField(w2, h2, dpi), 0, 0, w2, h2, rselector*2, 0, w2, h2);\r\n    g.drawImage(getHueField(w2, h2, dpi), 0, 0, w2, h2, rselector, 0, w2, h2);\r\n\r\n    let x = this.hsva[0]*w2 + rselector;\r\n    let y = canvas.height*0.5;\r\n\r\n    g.beginPath();\r\n    g.arc(x, y, r_circle, -Math.PI, Math.PI);\r\n    g.closePath();\r\n\r\n    g.strokeStyle = \"white\";\r\n    g.lineWidth = 3*dpi;\r\n    g.stroke();\r\n\r\n    g.strokeStyle = \"grey\";\r\n    g.lineWidth = 1*dpi;\r\n    g.stroke();\r\n\r\n    if (this.disabled) {\r\n      g.beginPath();\r\n      g.fillStyle = \"rgba(25,25,25,0.75)\"\r\n      g.rect(0, 0, this.canvas.width, this.canvas.height);\r\n      g.fill();\r\n    }\r\n  }\r\n\r\n  on_disabled() {\r\n    this._redraw();\r\n  }\r\n\r\n  on_enabled() {\r\n    this._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(HueField);\r\n\r\nexport class SatValField extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.hsva = [0, 0, 0, 1];\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.g = this.canvas.getContext(\"2d\");\r\n    this.shadow.appendChild(this.canvas);\r\n\r\n    this.onchange = undefined;\r\n\r\n    let setFromXY = (x, y) => {\r\n      let field = this._getField();\r\n      let r = ~~(this.getDefault(\"circleSize\")*this.getDPI());\r\n\r\n      let sat = field.x2sat(x - r);\r\n      let val = field.y2val(y - r);\r\n\r\n      this.hsva[1] = sat;\r\n      this.hsva[2] = val;\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.hsva);\r\n      }\r\n\r\n      this._redraw();\r\n    };\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Left\"]:\r\n        case keymap[\"Right\"]: {\r\n          let sign = e.keyCode === keymap[\"Left\"] ? -1 : 1;\r\n\r\n          this.hsva[1] = Math.min(Math.max(this.hsva[1] + 0.05*sign, 0.0), 1.0);\r\n          this._redraw();\r\n\r\n          if (this.onchange) {\r\n            this.onchange(this.hsva);\r\n          }\r\n\r\n          break;\r\n        }\r\n\r\n        case keymap[\"Up\"]:\r\n        case keymap[\"Down\"]: {\r\n          let sign = e.keyCode === keymap[\"Down\"] ? -1 : 1;\r\n\r\n          this.hsva[2] = Math.min(Math.max(this.hsva[2] + 0.05*sign, 0.0), 1.0);\r\n          this._redraw();\r\n\r\n          if (this.onchange) {\r\n            this.onchange(this.hsva);\r\n          }\r\n          break;\r\n        }\r\n      }\r\n    });\r\n\r\n    this.canvas.addEventListener(\"mousedown\", (e) => {\r\n      if (this.modalRunning) {\r\n        return;\r\n      }\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n\r\n      let rect = this.canvas.getClientRects()[0];\r\n      let x = e.clientX - rect.x, y = e.clientY - rect.y;\r\n\r\n      setFromXY(x, y);\r\n\r\n      this.pushModal({\r\n        on_pointermove(e) {\r\n          this.on_mousemove(e);\r\n        },\r\n        on_mousemove: (e) => {\r\n          let rect = this.canvas.getClientRects()[0];\r\n          if (rect === undefined) {\r\n            return;\r\n          }\r\n\r\n          let x = e.clientX - rect.x, y = e.clientY - rect.y;\r\n\r\n          setFromXY(x, y);\r\n        },\r\n        on_mousedown: (e) => {\r\n          this.popModal();\r\n        },\r\n        on_mouseup  : (e) => {\r\n          this.popModal();\r\n        },\r\n        on_keydown  : (e) => {\r\n          if (e.keyCode === keymap[\"Enter\"] || e.keyCode === keymap[\"Escape\"] || e.keyCode === keymap[\"Space\"]) {\r\n            this.popModal();\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    this.canvas.addEventListener(\"touchstart\", (e) => {\r\n      if (this.modalRunning) {\r\n        return;\r\n      }\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n\r\n      let rect = this.canvas.getClientRects()[0];\r\n      let x = e.touches[0].clientX - rect.x, y = e.touches[0].clientY - rect.y;\r\n\r\n      setFromXY(x, y);\r\n\r\n      this.pushModal({\r\n        on_mousemove  : (e) => {\r\n          let rect = this.canvas.getClientRects()[0];\r\n          let x, y;\r\n\r\n          if (e.touches && e.touches.length) {\r\n            x = e.touches[0].clientX - rect.x;\r\n            y = e.touches[0].clientY - rect.y;\r\n          } else {\r\n            x = e.x;\r\n            y = e.y;\r\n          }\r\n\r\n          setFromXY(x, y);\r\n        },\r\n        on_touchmove  : (e) => {\r\n          let rect = this.canvas.getClientRects()[0];\r\n          let x = e.touches[0].clientX - rect.x, y = e.touches[0].clientY - rect.y;\r\n\r\n          setFromXY(x, y);\r\n        },\r\n        on_mousedown  : (e) => {\r\n          this.popModal();\r\n        },\r\n        on_touchcancel: (e) => {\r\n          this.popModal();\r\n        },\r\n        on_touchend   : (e) => {\r\n          this.popModal();\r\n        },\r\n        on_mouseup    : (e) => {\r\n          this.popModal();\r\n        },\r\n        on_keydown    : (e) => {\r\n          if (e.keyCode === keymap[\"Enter\"] || e.keyCode === keymap[\"Escape\"] || e.keyCode === keymap[\"Space\"]) {\r\n            this.popModal();\r\n          }\r\n        }\r\n      });\r\n    })\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname          : \"satvalfield-x\",\r\n      style            : \"colorfield\",\r\n      havePickClipboard: true\r\n    };\r\n  }\r\n\r\n  getRGBA() {\r\n    let rgb = hsv_to_rgb(this.hsva[0], this.hsva[1], this.hsva[2]);\r\n    return new Vector4().loadXYZW(rgb[0], rgb[1], rgb[2], this.hsva[3]);\r\n  }\r\n\r\n  setRGBA(rgba) {\r\n    let hsv = rgb_to_hsv(rgba[0], rgba[1], rgba[2]);\r\n    this.hsva.loadXYZW(hsv[0], hsv[1], hsv[2], rgba[3]);\r\n\r\n    this.update(true);\r\n    this._redraw();\r\n\r\n    if (this.onchange) {\r\n      this.onchange(this.hsva);\r\n    }\r\n  }\r\n\r\n  clipboardCopy() {\r\n    colorClipboardCopy.apply(this, arguments);\r\n  }\r\n\r\n  clipboardPaste() {\r\n    colorClipboardPaste.apply(this, arguments);\r\n  }\r\n\r\n  _getField() {\r\n    let dpi = this.getDPI();\r\n    let canvas = this.canvas;\r\n    let r = this.getDefault(\"circleSize\");\r\n    let w = this.getDefault(\"width\");\r\n    let h = this.getDefault(\"height\");\r\n\r\n    //r = ~~(r*dpi);\r\n\r\n    return getFieldImage(this.getDefault(\"fieldSize\"), w - r*2, h - r*2, this.hsva);\r\n  }\r\n\r\n  update(force_update = false) {\r\n    super.update();\r\n\r\n    if (force_update) {\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _redraw() {\r\n    let g = this.g, canvas = this.canvas;\r\n    let dpi = this.getDPI();\r\n\r\n    let w = this.getDefault(\"width\");\r\n    let h = this.getDefault(\"height\");\r\n\r\n    canvas.width = ~~(w*dpi);\r\n    canvas.height = ~~(h*dpi);\r\n\r\n    canvas.style[\"width\"] = w + \"px\";\r\n    canvas.style[\"height\"] = h + \"px\";\r\n    //SatValField\r\n\r\n    let rselector = ~~(this.getDefault(\"circleSize\")*dpi);\r\n\r\n    let field = this._getField()\r\n    let image = field.canvas;\r\n\r\n    g.globalAlpha = 1.0;\r\n    g.beginPath();\r\n    g.rect(0, 0, canvas.width, canvas.height);\r\n    g.fillStyle = \"rgb(200, 200, 200)\";\r\n    g.fill();\r\n\r\n    g.beginPath();\r\n\r\n    let steps = 17;\r\n    let dx = canvas.width/steps;\r\n    let dy = canvas.height/steps;\r\n\r\n    for (let i = 0; i < steps*steps; i++) {\r\n      let x = (i%steps)*dx, y = (~~(i/steps))*dy;\r\n\r\n      if (i%2 === 0) {\r\n        continue;\r\n      }\r\n      g.rect(x, y, dx, dy);\r\n    }\r\n\r\n    g.fillStyle = \"rgb(110, 110, 110)\";\r\n    g.fill();\r\n\r\n    g.globalAlpha = this.hsva[3];\r\n    g.drawImage(image, 0, 0, image.width, image.height, rselector, rselector, canvas.width - rselector*2, canvas.height - rselector*2);\r\n\r\n    let hsva = this.hsva;\r\n\r\n    let x = field.sat2x(hsva[1])*dpi + rselector;\r\n    let y = field.val2y(hsva[2])*dpi + rselector;\r\n    let r = rselector;\r\n\r\n    g.beginPath();\r\n    g.arc(x, y, r, -Math.PI, Math.PI);\r\n    g.closePath();\r\n\r\n    g.strokeStyle = \"white\";\r\n    g.lineWidth = 3*dpi;\r\n    g.stroke();\r\n\r\n    g.strokeStyle = \"grey\";\r\n    g.lineWidth = 1*dpi;\r\n    g.stroke();\r\n\r\n    if (this.disabled) {\r\n      g.beginPath();\r\n      g.fillStyle = \"rgba(25,25,25,0.75)\";\r\n      g.rect(0, 0, this.canvas.width, this.canvas.height);\r\n      g.fill();\r\n    }\r\n  }\r\n\r\n  on_disabled() {\r\n    this._redraw();\r\n  }\r\n\r\n  on_enabled() {\r\n    this._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(SatValField);\r\n\r\nexport class ColorField extends ui.ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this.hsva = new Vector4([0.05, 0.6, 0.15, 1.0]);\r\n    this.rgba = new Vector4([0, 0, 0, 0]);\r\n\r\n    this._recalcRGBA();\r\n\r\n    this._lastThemeStyle = this.constructor.define().style;\r\n\r\n    /*\r\n    this.hbox = new SimpleBox();\r\n    this.svbox = new SimpleBox();\r\n    //*/\r\n\r\n    this._last_dpi = undefined;\r\n\r\n    let satvalfield = this.satvalfield = UIBase.createElement(\"satvalfield-x\");\r\n    satvalfield.hsva = this.hsva;\r\n\r\n    let huefield = this.huefield = UIBase.createElement(\"huefield-x\");\r\n    huefield.hsva = this.hsva;\r\n\r\n    huefield.onchange = (e) => {\r\n      this.satvalfield._redraw();\r\n      this._recalcRGBA();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.rgba);\r\n      }\r\n    };\r\n\r\n    satvalfield.onchange = (e) => {\r\n      this._recalcRGBA();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.rgba);\r\n      }\r\n    };\r\n\r\n    this._add(satvalfield);\r\n    this._add(huefield);\r\n    //this.shadow.appendChild(canvas);\r\n    //this.shadow.appendChild(huecanvas);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"colorfield-x\",\r\n      style  : \"colorfield\"\r\n    };\r\n  }\r\n\r\n  setCMYK(c, m, y, k) {\r\n    let rgb = cmyk_to_rgb(c, m, y, k);\r\n    let hsv = rgb_to_hsv(rgb[0], rgb[1], rgb[2]);\r\n\r\n    this.setHSVA(hsv[0], hsv[1], hsv[2], this.hsva[3]);\r\n  }\r\n\r\n  getCMYK() {\r\n    let rgb = hsv_to_rgb(this.hsva[0], this.hsva[1], this.hsva[2]);\r\n    return rgb_to_cmyk(rgb[0], rgb[1], rgb[2]);\r\n  }\r\n\r\n  setHSVA(h, s, v, a = 1.0, fire_onchange = true) {\r\n    this.hsva[0] = h;\r\n    this.hsva[1] = s;\r\n    this.hsva[2] = v;\r\n    this.hsva[3] = a;\r\n\r\n    this._recalcRGBA();\r\n    this.update(true);\r\n\r\n    if (this.onchange && fire_onchange) {\r\n      this.onchange(this.hsva, this.rgba);\r\n    }\r\n  }\r\n\r\n  _recalcRGBA() {\r\n    let ret = hsv_to_rgb(this.hsva[0], this.hsva[1], this.hsva[2]);\r\n\r\n    this.rgba[0] = ret[0];\r\n    this.rgba[1] = ret[1];\r\n    this.rgba[2] = ret[2];\r\n    this.rgba[3] = this.hsva[3];\r\n\r\n    return this;\r\n  }\r\n\r\n  updateDPI(force_update = false, _in_update = false) {\r\n    let dpi = this.getDPI();\r\n\r\n    let update = force_update;\r\n    update = update || dpi != this._last_dpi;\r\n\r\n    if (update) {\r\n      this._last_dpi = dpi;\r\n\r\n      if (!_in_update)\r\n        this._redraw();\r\n\r\n      return true;\r\n    }\r\n  }\r\n\r\n  getRGBA() {\r\n    let rgb = hsv_to_rgb(this.hsva[0], this.hsva[1], this.hsva[2]);\r\n    return new Vector4().loadXYZW(rgb[0], rgb[1], rgb[2], this.hsva[3]);\r\n  }\r\n\r\n  setRGBA(r, g, b, a = 1.0, fire_onchange = true) {\r\n    if (typeof r === \"object\") {\r\n      g = r[1];\r\n      b = r[2];\r\n      a = r[3];\r\n      r = r[0];\r\n    }\r\n\r\n    let hsv = rgb_to_hsv(r, g, b);\r\n\r\n    this.hsva[0] = hsv[0];\r\n    this.hsva[1] = hsv[1];\r\n    this.hsva[2] = hsv[2];\r\n    this.hsva[3] = a;\r\n\r\n    this._recalcRGBA();\r\n    this.update(true);\r\n\r\n    if (this.onchange && fire_onchange) {\r\n      this.onchange(this.hsva, this.rgba);\r\n    }\r\n  }\r\n\r\n  updateThemeOverride() {\r\n    let theme = this.getStyleClass();\r\n    if (theme === this._lastThemeStyle) {\r\n      return false;\r\n    }\r\n\r\n    this._lastThemeStyle = theme;\r\n    this.huefield.overrideClass(theme);\r\n    this.satvalfield.overrideClass(theme);\r\n\r\n    for (let i=0; i<3; i++) {\r\n      this.flushSetCSS();\r\n      this.flushUpdate();\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  update(force_update = false) {\r\n    super.update();\r\n\r\n    this.updateThemeOverride();\r\n\r\n    let redraw = this.updateDPI(force_update, true);\r\n    redraw = redraw || force_update;\r\n\r\n    if (redraw) {\r\n      this.satvalfield.update(true);\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.style[\"flex-grow\"] = this.getDefault(\"flex-grow\");\r\n  }\r\n\r\n  _redraw() {\r\n    this.satvalfield._redraw();\r\n    this.huefield._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ColorField);\r\n\r\nexport class ColorPicker extends ui.ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this._lastThemeStyle = this.constructor.define().style;\r\n  }\r\n\r\n  //*\r\n  get hsva() {\r\n    return this.field.hsva;\r\n  }\r\n\r\n  get rgba() {\r\n    return this.field.rgba;\r\n  }//*/\r\n\r\n  set description(val) {\r\n    //do not allow setting description of the colorpicker container\r\n  }\r\n\r\n  static setDefault(node) {\r\n    let tabs, colorsPanel = node;\r\n\r\n    if (node.getClassDefault(\"usePanels\")) {\r\n      let panel = colorsPanel = node.panel(\"Color\");\r\n      tabs = panel.tabs();\r\n      panel.closed = true;\r\n\r\n      panel.style[\"flex-grow\"] = \"unset\";\r\n\r\n      /* force compactness */\r\n      panel.titleframe.style[\"flex-grow\"] = \"unset\";\r\n      //panel.titleframe.style[\"align-items\"] = \"unset\";\r\n    } else {\r\n      tabs = node.tabs();\r\n    }\r\n\r\n    node.cssText = node.textbox();\r\n    node.cssText.onchange = (val) => {\r\n      let ok = validateWebColor(val);\r\n      if (!ok) {\r\n        node.cssText.flash(\"red\");\r\n        return;\r\n      } else {\r\n        node.cssText.flash(\"green\");\r\n      }\r\n\r\n      val = val.trim();\r\n\r\n      let color = web2color(val);\r\n\r\n      node._no_update_textbox = true;\r\n      node.field.setRGBA(color[0], color[1], color[2], color[3]);\r\n      node._setSliders();\r\n\r\n      node._no_update_textbox = false;\r\n    };\r\n\r\n    //tabs.overrideDefault(\"background-color\", node.getDefault(\"background-color\"));\r\n\r\n    let tab = tabs.tab(\"HSV\");\r\n\r\n    node.h = tab.slider(undefined, \"Hue\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let hsva = node.hsva;\r\n      node.setHSVA(e.value, hsva[1], hsva[2], hsva[3]);\r\n    });\r\n\r\n    node.s = tab.slider(undefined, \"Saturation\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let hsva = node.hsva;\r\n      node.setHSVA(hsva[0], e.value, hsva[2], hsva[3]);\r\n    });\r\n    node.v = tab.slider(undefined, \"Value\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let hsva = node.hsva;\r\n      node.setHSVA(hsva[0], hsva[1], e.value, hsva[3]);\r\n    });\r\n    node.a = tab.slider(undefined, \"Alpha\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let hsva = node.hsva;\r\n      node.setHSVA(hsva[0], hsva[1], hsva[2], e.value);\r\n    });\r\n\r\n    node.h.baseUnit = node.h.displayUnit = \"none\";\r\n    node.s.baseUnit = node.s.displayUnit = \"none\";\r\n    node.v.baseUnit = node.v.displayUnit = \"none\";\r\n    node.a.baseUnit = node.a.displayUnit = \"none\";\r\n\r\n    tab = tabs.tab(\"RGB\");\r\n\r\n    node.r = tab.slider(undefined, \"R\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let rgba = node.rgba;\r\n      node.setRGBA(e.value, rgba[1], rgba[2], rgba[3]);\r\n    });\r\n    node.g = tab.slider(undefined, \"G\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let rgba = node.rgba;\r\n      node.setRGBA(rgba[0], e.value, rgba[2], rgba[3]);\r\n    });\r\n    node.b = tab.slider(undefined, \"B\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let rgba = node.rgba;\r\n      node.setRGBA(rgba[0], rgba[1], e.value, rgba[3]);\r\n    });\r\n    node.a2 = tab.slider(undefined, \"Alpha\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let rgba = node.rgba;\r\n      node.setRGBA(rgba[0], rgba[1], rgba[2], e.value);\r\n    });\r\n\r\n    node.r.baseUnit = node.r.displayUnit = \"none\";\r\n    node.g.baseUnit = node.g.displayUnit = \"none\";\r\n    node.b.baseUnit = node.b.displayUnit = \"none\";\r\n    node.a2.baseUnit = node.a2.displayUnit = \"none\";\r\n\r\n    if (!node.getDefault(\"noCMYK\")) {\r\n      tab = tabs.tab(\"CMYK\")\r\n      let cmyk = node.getCMYK();\r\n\r\n      let makeCMYKSlider = (label, idx) => {\r\n        let slider = tab.slider(undefined, {\r\n          name      : label,\r\n          min       : 0.0,\r\n          max       : 1.0,\r\n          is_int    : false,\r\n          defaultval: cmyk[idx],\r\n          callback  : (e) => {\r\n            let cmyk = node.getCMYK();\r\n            cmyk[idx] = e.value;\r\n            node.setCMYK(cmyk[0], cmyk[1], cmyk[2], cmyk[3]);\r\n          },\r\n          step      : 0.001\r\n        });\r\n\r\n        slider.baseUnit = slider.displayUnit = \"none\";\r\n\r\n        return slider;\r\n      }\r\n\r\n      node.cmyk = [\r\n        makeCMYKSlider(\"C\", 0),\r\n        makeCMYKSlider(\"M\", 1),\r\n        makeCMYKSlider(\"Y\", 2),\r\n        makeCMYKSlider(\"K\", 3),\r\n      ];\r\n    }\r\n\r\n    node._setSliders();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname            : \"colorpicker-x\",\r\n      style              : \"colorfield\",\r\n      havePickClipboard  : true,\r\n      copyForAllChildren : true,\r\n      pasteForAllChildren: true,\r\n    };\r\n  }\r\n\r\n  clipboardCopy() {\r\n    colorClipboardCopy.apply(this, arguments);\r\n  }\r\n\r\n  clipboardPaste() {\r\n    colorClipboardPaste.apply(this, arguments);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.field = UIBase.createElement(\"colorfield-x\");\r\n    this.field.setAttribute(\"class\", \"colorpicker\");\r\n\r\n    this.field.packflag |= this.inherit_packflag;\r\n    this.field.packflag |= this.packflag;\r\n\r\n    this.field.onchange = () => {\r\n      this._setDataPath();\r\n      this._setSliders();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.field.rgba);\r\n      }\r\n    };\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n      .colorpicker {\r\n        background-color : ${this.getDefault(\"background-color\")};\r\n      }\r\n    `;\r\n\r\n    this._style = style;\r\n\r\n    let cb = this.colorbox = document.createElement(\"div\");\r\n    cb.style[\"width\"] = \"100%\";\r\n    cb.style[\"height\"] = this.getDefault(\"colorBoxHeight\") + \"px\";\r\n    cb.style[\"background-color\"] = \"black\";\r\n\r\n    this.shadow.appendChild(style);\r\n    this.field.ctx = this.ctx;\r\n\r\n    this.add(this.colorbox);\r\n    this.add(this.field);\r\n\r\n    this.style[\"width\"] = this.getDefault(\"width\") + \"px\";\r\n  }\r\n\r\n  updateColorBox() {\r\n    let r = this.field.rgba[0], g = this.field.rgba[1], b = this.field.rgba[2];\r\n    //let a = this.field.rgba[3];\r\n\r\n    r = ~~(r*255);\r\n    g = ~~(g*255);\r\n    b = ~~(b*255);\r\n\r\n    let css = `rgb(${r},${g},${b})`;\r\n    this.colorbox.style[\"background-color\"] = css;\r\n  }\r\n\r\n  _setSliders() {\r\n    if (this.h === undefined) {\r\n      //setDefault() wasn't called\r\n      console.warn(\"colorpicker ERROR\");\r\n      return;\r\n    }\r\n\r\n    let hsva = this.field.hsva;\r\n    this.h.setValue(hsva[0], false);\r\n    this.s.setValue(hsva[1], false);\r\n    this.v.setValue(hsva[2], false);\r\n    this.a.setValue(hsva[3], false);\r\n\r\n    let rgba = this.field.rgba;\r\n\r\n    this.r.setValue(rgba[0], false);\r\n    this.g.setValue(rgba[1], false);\r\n    this.b.setValue(rgba[2], false);\r\n    this.a2.setValue(rgba[3], false);\r\n\r\n    if (this.cmyk) {\r\n      let cmyk = this.field.getCMYK();\r\n\r\n      for (let i = 0; i < 4; i++) {\r\n        this.cmyk[i].setValue(cmyk[i], false);\r\n      }\r\n    }\r\n\r\n    this.updateColorBox();\r\n\r\n    if (!this._no_update_textbox) {\r\n      this.cssText.text = color2web(this.field.rgba);\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (val === undefined) {\r\n      //console.warn(\"Bad datapath\", this.getAttribute(\"datapath\"));\r\n      this.internalDisabled = true;\r\n      return;\r\n    }\r\n\r\n    this.internalDisabled = false;\r\n\r\n    _update_temp.load(val);\r\n\r\n    if (prop.type === PropTypes.VEC3) {\r\n      _update_temp[3] = 1.0;\r\n    }\r\n\r\n    if (_update_temp.vectorDistance(this.field.rgba) > 0.01) {\r\n      this.field.setRGBA(_update_temp[0], _update_temp[1], _update_temp[2], _update_temp[3], false);\r\n      this._setSliders();\r\n      this.field.update(true);\r\n    }\r\n  }\r\n\r\n  updateThemeOverride() {\r\n    let theme = this.getStyleClass();\r\n    if (theme === this._lastThemeStyle) {\r\n      return false;\r\n    }\r\n\r\n    this._lastThemeStyle = theme;\r\n    this.field.overrideClass(theme);\r\n\r\n    this.flushSetCSS();\r\n    this.flushUpdate();\r\n\r\n    return true;\r\n  }\r\n\r\n  update() {\r\n    this.updateThemeOverride();\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n\r\n    super.update();\r\n  }\r\n\r\n  _setDataPath() {\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n      if (prop === undefined) {\r\n        console.warn(\"Bad data path for color field:\", this.getAttribute(\"datapath\"));\r\n      }\r\n\r\n      let val = this.field.rgba;\r\n      if (prop !== undefined && prop.type === PropTypes.VEC3) {\r\n        val = new Vector3();\r\n        val.load(this.field.rgba);\r\n      }\r\n\r\n      this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), val);\r\n    }\r\n  }\r\n\r\n  getCMYK() {\r\n    return this.field.getCMYK();\r\n  }\r\n\r\n  setCMYK(c, m, y, k) {\r\n    this.field.setCMYK(c, m, y, k);\r\n    this._setSliders();\r\n    this._setDataPath();\r\n  }\r\n\r\n  setHSVA(h, s, v, a) {\r\n    this.field.setHSVA(h, s, v, a);\r\n    this._setSliders();\r\n    this._setDataPath();\r\n  }\r\n\r\n  getRGBA() {\r\n    return this.field.getRGBA();\r\n  }\r\n\r\n  setRGBA(r, g, b, a) {\r\n    this.field.setRGBA(r, g, b, a)\r\n    this._setSliders();\r\n    this._setDataPath();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ColorPicker);\r\n\r\n\r\nexport class ColorPickerButton extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._highlight = false;\r\n    this._depress = false;\r\n    this._label = \"error\";\r\n\r\n    this.customLabel = undefined;\r\n\r\n    this.rgba = new Vector4([1, 1, 1, 1]);\r\n\r\n    this.labelDom = document.createElement(\"span\");\r\n    this.labelDom.textContent = this._label;\r\n    this.dom = document.createElement(\"canvas\");\r\n    this.g = this.dom.getContext(\"2d\");\r\n\r\n    this.shadow.appendChild(this.labelDom);\r\n    this.shadow.appendChild(this.dom);\r\n  }\r\n\r\n  get label() {\r\n    return this._label;\r\n  }\r\n\r\n  set label(val) {\r\n    this._label = val;\r\n    this.labelDom.textContent = val;\r\n  }\r\n\r\n  get font() {\r\n    return this._font;\r\n  }\r\n\r\n  set font(val) {\r\n    this._font = val;\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  get noLabel() {\r\n    let ret = \"\" + this.getAttribute(\"no-label\");\r\n    ret = ret.toLowerCase();\r\n\r\n    return ret === \"true\" || ret === \"yes\" || ret === \"on\";\r\n  }\r\n\r\n  set noLabel(v) {\r\n    if (this.labelDom) {\r\n      this.labelDom.hidden = true; //will be deleted later\r\n    }\r\n\r\n    this.setAttribute(\"no-label\", v ? \"true\" : \"false\");\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname          : \"color-picker-button-x\",\r\n      style            : \"colorpickerbutton\",\r\n      havePickClipboard: true\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this._font = \"DefaultText\"; //this.getDefault(\"defaultFont\");\r\n\r\n    let enter = (e) => {\r\n      this._highlight = true;\r\n      this._redraw();\r\n    }\r\n\r\n    let leave = (e) => {\r\n      this._highlight = false;\r\n      this._redraw();\r\n    }\r\n\r\n    this.addEventListener(\"pointerover\", enter, {capture: true, passive: true});\r\n    this.addEventListener(\"pointerout\", leave, {capture: true, passive: true});\r\n    this.addEventListener(\"focus\", leave, {capture: true, passive: true});\r\n\r\n\r\n    this.addEventListener(\"mousedown\", (e) => {\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n\r\n      this.click(e);\r\n    });\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  clipboardCopy() {\r\n    colorClipboardCopy.apply(this, arguments);\r\n  }\r\n\r\n  clipboardPaste() {\r\n    colorClipboardPaste.apply(this, arguments);\r\n  }\r\n\r\n  getRGBA() {\r\n    return this.rgba;\r\n  }\r\n\r\n  click(e) {\r\n    this.abortToolTips(4000);\r\n    console.warn(\"CLICK COLORPICKER\");\r\n    this.blur();\r\n\r\n    if (this.onclick) {\r\n      this.onclick(e);\r\n    }\r\n\r\n    let colorpicker = this.ctx.screen.popup(this, this);\r\n    let ctx = contextWrangler.makeSafeContext(this.ctx);\r\n\r\n    colorpicker.ctx = ctx;\r\n    colorpicker.useDataPathUndo = this.useDataPathUndo;\r\n\r\n    let path = this.hasAttribute(\"datapath\") ? this.getAttribute(\"datapath\") : undefined;\r\n\r\n    let widget = colorpicker.colorPicker(path, undefined, this.getAttribute(\"mass_set_path\"));\r\n\r\n    widget.ctx = ctx;\r\n    widget._init();\r\n    widget.setRGBA(this.rgba[0], this.rgba[1], this.rgba[2], this.rgba[3]);\r\n\r\n    widget.style[\"padding\"] = \"20px\";\r\n\r\n    let onchange = () => {\r\n      this.rgba.load(widget.rgba);\r\n      this.redraw();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this);\r\n      }\r\n    }\r\n\r\n    widget.onchange = onchange;\r\n\r\n    colorpicker.style[\"background-color\"] = widget.getDefault(\"background-color\");\r\n    //colorpicker.style[\"border-radius\"] = \"25px\";\r\n    colorpicker.style[\"border-width\"] = widget.getDefault(\"border-width\");\r\n  }\r\n\r\n  setRGBA(val) {\r\n    let a = this.rgba[3];\r\n\r\n    let old = new Vector4(this.rgba);\r\n\r\n    this.rgba.load(val);\r\n\r\n    if (val.length < 4) {\r\n      this.rgba[3] = a;\r\n    }\r\n\r\n    if (this.rgba.vectorDistance(old) < 0.001) {\r\n      return;\r\n    }\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this.rgba);\r\n    }\r\n\r\n    if (this.onchange) {\r\n      this.onchange();\r\n    }\r\n\r\n    this._redraw();\r\n    return this;\r\n  }\r\n\r\n  on_disabled() {\r\n    this.setCSS();\r\n    this._redraw();\r\n  }\r\n\r\n  _redraw() {\r\n    let canvas = this.dom, g = this.g;\r\n\r\n    g.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    if (this.disabled) {\r\n      let color = \"rgb(55, 55, 55)\";\r\n\r\n      g.save();\r\n\r\n      ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"fill\", color);\r\n      ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"clip\");\r\n      let steps = 5;\r\n      let dt = canvas.width/steps, t = 0;\r\n\r\n      g.beginPath();\r\n      g.lineWidth = 2;\r\n      g.strokeStyle = \"black\";\r\n\r\n      for (let i = 0; i < steps; i++, t += dt) {\r\n        g.moveTo(t, 0);\r\n        g.lineTo(t + dt, canvas.height);\r\n        g.moveTo(t + dt, 0);\r\n        g.lineTo(t, canvas.height);\r\n      }\r\n\r\n      g.stroke();\r\n      g.restore();\r\n      return;\r\n    }\r\n\r\n    //do checker pattern for alpha\r\n    g.save();\r\n\r\n    let grid1 = \"rgb(100, 100, 100)\";\r\n    let grid2 = \"rgb(175, 175, 175)\";\r\n\r\n    ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"clip\");\r\n    ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"fill\", grid1);\r\n\r\n    let cellsize = 10;\r\n    let totx = Math.ceil(canvas.width/cellsize), toty = Math.ceil(canvas.height/cellsize);\r\n\r\n    ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"clip\", undefined, undefined, true);\r\n    g.clip();\r\n\r\n    g.beginPath();\r\n    for (let x = 0; x < totx; x++) {\r\n      for (let y = 0; y < toty; y++) {\r\n        if ((x + y) & 1) {\r\n          continue;\r\n        }\r\n\r\n        g.rect(x*cellsize, y*cellsize, cellsize, cellsize);\r\n      }\r\n    }\r\n\r\n    g.fillStyle = grid2;\r\n    g.fill();\r\n\r\n    //g.fillStyle = \"orange\";\r\n    //g.beginPath();\r\n    //g.rect(0, 0, canvas.width, canvas.height);\r\n    //g.fill();\r\n\r\n    let color = color2css(this.rgba);\r\n    ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"fill\", color, undefined, true);\r\n    //drawRoundBox(elem, canvas, g, width, height, r=undefined, op=\"fill\", color=undefined, pad=undefined) {\r\n\r\n    if (this._highlight) {\r\n      //let color = \"rgba(200, 200, 255, 0.5)\";\r\n      let color = this.getDefault(\"BoxHighlight\");\r\n      ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"fill\", color);\r\n    }\r\n\r\n    g.restore();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    let w = this.getDefault(\"width\");\r\n    let h = this.getDefault(\"height\");\r\n    let dpi = this.getDPI();\r\n\r\n    this.style[\"width\"] = \"min-contents\" + \"px\";\r\n    this.style[\"height\"] = h + \"px\";\r\n\r\n    this.style[\"flex-direction\"] = \"row\";\r\n    this.style[\"display\"] = \"flex\";\r\n\r\n    this.labelDom.style[\"color\"] = this.getDefault(this._font).color;\r\n    this.labelDom.style[\"font\"] = ui_base.getFont(this, undefined, this._font, false);\r\n\r\n    let canvas = this.dom;\r\n\r\n    canvas.style[\"width\"] = w + \"px\";\r\n    canvas.style[\"height\"] = h + \"px\";\r\n    canvas.width = ~~(w*dpi);\r\n    canvas.height = ~~(h*dpi);\r\n\r\n    this.style[\"background-color\"] = \"rgba(0,0,0,0)\";\r\n    this._redraw();\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!(this.hasAttribute(\"datapath\"))) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n    let prop = this.getPathMeta(this.ctx, path);\r\n\r\n    if ((prop === undefined || prop.data === undefined) && cconst.DEBUG.verboseDataPath) {\r\n      console.log(\"bad path\", path);\r\n      return;\r\n    } else if (prop === undefined) {\r\n      let redraw = !this.disabled;\r\n\r\n      this.internalDisabled = true;\r\n\r\n      if (redraw) {\r\n        this._redraw();\r\n      }\r\n      return;\r\n    }\r\n\r\n    let redraw = this.disabled;\r\n\r\n    this.internalDisabled = false;\r\n\r\n    if (this.customLabel === undefined && prop.uiname !== this._label) {\r\n      this.label = prop.uiname;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, path);\r\n\r\n    if (val === undefined) {\r\n      redraw = redraw || this.disabled !== true;\r\n\r\n      this.internalDisabled = true;\r\n\r\n      if (redraw) {\r\n        this._redraw();\r\n      }\r\n\r\n    } else {\r\n      this.internalDisabled = false;\r\n\r\n      let dis;\r\n\r\n      if (val.length === 3) {\r\n        dis = Vector3.prototype.vectorDistance.call(val, this.rgba);\r\n      } else {\r\n        dis = this.rgba.vectorDistance(val);\r\n      }\r\n\r\n      if (dis > 0.0001) {\r\n        if (prop.type === PropTypes.VEC3) {\r\n          this.rgba.load(val);\r\n          this.rgba[3] = 1.0;\r\n        } else {\r\n          this.rgba.load(val);\r\n        }\r\n\r\n        redraw = true;\r\n      }\r\n\r\n      if (redraw) {\r\n        this._redraw();\r\n      }\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    if (this.noLabel && this.labelDom.isConnected) {\r\n      this.labelDom.remove();\r\n    }\r\n\r\n    if (this.customLabel !== undefined && this.customLabel !== this._label) {\r\n      this.label = this.customLabel;\r\n    }\r\n\r\n    for (let i = 0; i < this.rgba.length; i++) {\r\n      if (this.rgba[i] === undefined) {\r\n        console.warn(\"corrupted color or alpha detected\", this.rgba);\r\n        this.rgba[i] = 1.0;\r\n      }\r\n    }\r\n\r\n    let key = \"\" + this.rgba[0].toFixed(4) + \" \" + this.rgba[1].toFixed(4) + \" \" + this.rgba[2].toFixed(4) + \" \" + this.rgba[3].toFixed(4);\r\n    key += this.disabled;\r\n\r\n    if (key !== this._last_key) {\r\n      this._last_key = key;\r\n      this.redraw();\r\n    }\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n  }\r\n\r\n  redraw() {\r\n    this._redraw();\r\n  }\r\n};\r\nUIBase.internalRegister(ColorPickerButton);\r\n","\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as ui from '../core/ui.js';\r\nimport {loadUIData, saveUIData} from '../core/ui_base.js';\r\n\r\nlet UIBase      = ui_base.UIBase,\r\n    PackFlags   = ui_base.PackFlags,\r\n    IconSheets  = ui_base.IconSheets,\r\n    iconmanager = ui_base.iconmanager;\r\n\r\nexport let tab_idgen = 1;\r\nlet debug = false;\r\nlet Vector2 = vectormath.Vector2;\r\n\r\nfunction getpx(css) {\r\n  return parseFloat(css.trim().replace(\"px\", \"\"))\r\n}\r\n\r\nlet FAKE_TAB_ID = Symbol(\"fake_tab_id\");\r\n\r\n\r\nclass TabDragEvent extends PointerEvent {\r\n}\r\n\r\n\r\n/* subclass HTMLElement so tabs can be used as the .target\r\n*  member of events*/\r\nexport class TabItem extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.name = name;\r\n    this.icon = undefined;\r\n    this.tooltip = \"\";\r\n    this.movable = true;\r\n    this.tbar = undefined;\r\n\r\n    this.ontabclick = null;\r\n    this.ontabdragstart = null;\r\n    this.ontabdragmove = null;\r\n    this.ontabdragend = null;\r\n\r\n    let helper = (key) => {\r\n      let key2 = \"on\" + key;\r\n\r\n      this.addEventListener(key, (e) => {\r\n        if (this[key2]) {\r\n          return this[key2](e);\r\n        }\r\n      });\r\n    }\r\n\r\n    helper(\"tabclick\");\r\n    helper(\"tabdragstart\");\r\n    helper(\"tabdragmove\");\r\n    helper(\"tabdragend\");\r\n\r\n    this.dom = undefined;\r\n    this.extra = undefined;\r\n    this.extraSize = undefined;\r\n\r\n    this.size = new Vector2();\r\n    this.pos = new Vector2();\r\n\r\n    this.abssize = new Vector2();\r\n    this.abspos = new Vector2();\r\n\r\n    this.addEventListener(\"pointerdown\", (e) => {\r\n      this.parentWidget.on_pointerdown(e);\r\n    });\r\n\r\n    this.addEventListener(\"pointermove\", (e) => {\r\n      this.parentWidget.on_pointermove(e);\r\n    });\r\n\r\n    this.addEventListener(\"pointerup\", (e) => {\r\n      this.parentWidget.on_pointerup(e);\r\n    });\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"tab-item-x\"\r\n    }\r\n  }\r\n\r\n  sendEvent(type, forwardEvent) {\r\n    let cls;\r\n\r\n    if (type === \"tabdragstart\" || type === \"tabdragend\") {\r\n      cls = TabDragEvent;\r\n    } else if (forwardEvent && forwardEvent instanceof Event) {\r\n      cls = forwardEvent.constructor;\r\n    } else {\r\n      cls = PointerEvent;\r\n    }\r\n\r\n    let e2 = {};\r\n\r\n    if (forwardEvent) {\r\n      for (let k in forwardEvent) {\r\n        if (k === \"defaultPrevented\" || k === \"cancelBubble\") {\r\n          continue;\r\n        }\r\n\r\n        e2[k] = forwardEvent[k];\r\n      }\r\n    }\r\n\r\n    e2.target = this;\r\n\r\n    e2 = new cls(type, e2);\r\n\r\n    this.dispatchEvent(e2);\r\n    return e2;\r\n  }\r\n\r\n  getClientRects() {\r\n    let r = this.tbar.getClientRects()[0];\r\n\r\n    let s = this.abssize, p = this.abspos;\r\n\r\n    s.load(this.size);\r\n    p.load(this.pos);\r\n\r\n    if (r) {\r\n      p[0] += r.x;\r\n      p[1] += r.y;\r\n    }\r\n\r\n    return [{\r\n      x  : p[0], y: p[1], width: s[0], height: s[1], left: p[0],\r\n      top: p[1], right: p[0] + s[0], bottom: p[1] + s[1]\r\n    }];\r\n  }\r\n\r\n  setCSS() {\r\n    let dpi = UIBase.getDPI();\r\n    let x = this.pos[0]/dpi;\r\n    let y = this.pos[1]/dpi;\r\n    let w = this.size[0]/dpi;\r\n    let h = this.size[1]/dpi;\r\n\r\n    this.style[\"background-color\"] = \"transparent\";\r\n\r\n    this.style[\"margin\"] = this.style[\"padding\"] = \"0px\";\r\n    this.style[\"position\"] = \"absolute\";\r\n    this.style[\"pointer-events\"] = \"auto\";\r\n\r\n    this.style[\"left\"] = x + \"px\";\r\n    this.style[\"top\"] = y + \"px\";\r\n    this.style[\"width\"] = w + \"px\";\r\n    this.style[\"height\"] = h + \"px\";\r\n  }\r\n}\r\nUIBase.internalRegister(TabItem);\r\n\r\nexport class ModalTabMove extends events.EventHandler {\r\n  constructor(tab, tbar, dom) {\r\n    super();\r\n\r\n    this.dom = dom;\r\n    this.tab = tab;\r\n    this.tbar = tbar;\r\n    this.first = true;\r\n\r\n    this.droptarget = undefined;\r\n    this.start_mpos = new Vector2();\r\n    this.mpos = undefined;\r\n\r\n    this.dragtab = undefined;\r\n    this.dragstate = false;\r\n    this.finished = false;\r\n  }\r\n\r\n  finish() {\r\n    if (debug) if (debug) console.log(\"finish\");\r\n\r\n    if (this.finished) {\r\n      return;\r\n    }\r\n\r\n    this.finished = true;\r\n\r\n    if (this.tbar.tool === this) {\r\n      this.tbar.tool = undefined;\r\n    }\r\n\r\n    this.popModal(this.dom);\r\n    this.tbar.update(true);\r\n  }\r\n\r\n  popModal() {\r\n    if (this.dragcanvas !== undefined) {\r\n      this.dragcanvas.remove();\r\n    }\r\n    let ret = super.popModal(...arguments);\r\n\r\n    this.tab.sendEvent(\"tabdragend\");\r\n\r\n    return ret;\r\n  }\r\n\r\n  on_pointerleave(e) {\r\n  }\r\n  on_pointerenter(e) {\r\n  }\r\n  on_pointerenter(e) {\r\n  }\r\n  on_pointerstart(e) {\r\n  }\r\n  on_pointerend(e) {\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    this.finish();\r\n  }\r\n\r\n  on_pointercancel(e) {\r\n    this.finish();\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    this.finish();\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    return this._on_move(e, e.x, e.y);\r\n  }\r\n\r\n  _dragstate(e, x, y) {\r\n    this.dragcanvas.style[\"left\"] = x + \"px\";\r\n    this.dragcanvas.style[\"top\"] = y + \"px\";\r\n\r\n    let ctx = this.tbar.ctx;\r\n    let screen = ctx.screen;\r\n    let elem = screen.pickElement(x, y);\r\n\r\n    let e2 = new DragEvent(\"dragenter\", this.dragevent);\r\n    if (elem !== this.droptarget) {\r\n      let e2 = new DragEvent(\"dragexit\", this.dragevent);\r\n      if (this.droptarget) {\r\n        this.droptarget.dispatchEvent(e2);\r\n      }\r\n\r\n      e2 = new DragEvent(\"dragover\", this.dragevent);\r\n      this.droptarget = elem;\r\n      if (elem) {\r\n        elem.dispatchEvent(e2);\r\n      }\r\n    }\r\n    //console.log(elem);\r\n  }\r\n\r\n  _on_move(e, x, y) {\r\n    let r = this.tbar.getClientRects()[0];\r\n    let dpi = UIBase.getDPI();\r\n\r\n    if (r === undefined) {\r\n      //element was removed during/before move\r\n      this.finish();\r\n      return;\r\n    }\r\n\r\n    if (this.dragstate) {\r\n      this._dragstate(e, x, y);\r\n      return;\r\n    }\r\n\r\n    x -= r.x;\r\n    y -= r.y;\r\n\r\n    let dx, dy;\r\n\r\n    x *= dpi;\r\n    y *= dpi;\r\n\r\n    if (this.first) {\r\n      this.first = false;\r\n      this.start_mpos[0] = x;\r\n      this.start_mpos[1] = y;\r\n    }\r\n    if (this.mpos === undefined) {\r\n      this.mpos = [0, 0];\r\n      dx = dy = 0;\r\n    } else {\r\n      dx = x - this.mpos[0];\r\n      dy = y - this.mpos[1];\r\n    }\r\n\r\n    if (debug) console.log(x, y, dx, dy);\r\n\r\n    let tab = this.tab, tbar = this.tbar;\r\n    let axis = tbar.horiz ? 0 : 1;\r\n    let distx, disty;\r\n\r\n    if (tbar.horiz) {\r\n      tab.pos[0] += dx;\r\n      disty = Math.abs(y - this.start_mpos[1]);\r\n    } else {\r\n      tab.pos[1] += dy;\r\n      disty = Math.abs(x - this.start_mpos[0]);\r\n    }\r\n\r\n    let limit = 50;\r\n    let csize = tbar.horiz ? this.tbar.canvas.width : this.tbar.canvas.height;\r\n\r\n    let dragok = tab.pos[axis] + tab.size[axis] < -limit || tab.pos[axis] >= csize + limit;\r\n    dragok = dragok || disty > limit*1.5;\r\n    dragok = dragok && (this.tbar.draggable || this.tbar.getAttribute(\"draggable\"));\r\n\r\n    //console.log(dragok, disty, this.tbar.draggable);\r\n\r\n    if (dragok) {\r\n      this.dragstate = true;\r\n      this.dragevent = new DragEvent(\"dragstart\", {\r\n        dataTransfer: new DataTransfer()\r\n      });\r\n\r\n      this.dragtab = tab;\r\n      let g = this.tbar.g;\r\n      this.dragimg = g.getImageData(~~tab.pos[0], ~~tab.pos[1], ~~tab.size[0], ~~tab.size[1]);\r\n      this.dragcanvas = document.createElement(\"canvas\");\r\n      let g2 = this.drag_g = this.dragcanvas.getContext(\"2d\");\r\n\r\n      this.dragcanvas.visibleToPick = false;\r\n      this.dragcanvas.width = ~~tab.size[0];\r\n      this.dragcanvas.height = ~~tab.size[1];\r\n      this.dragcanvas.style[\"width\"] = (tab.size[0]/dpi) + \"px\";\r\n      this.dragcanvas.style[\"height\"] = (tab.size[1]/dpi) + \"px\";\r\n      this.dragcanvas.style[\"position\"] = UIBase.PositionKey;\r\n      this.dragcanvas.style[\"left\"] = e.x + \"px\";\r\n      this.dragcanvas.style[\"top\"] = e.y + \"px\";\r\n      this.dragcanvas.style[\"z-index\"] = \"500\";\r\n      document.body.appendChild(this.dragcanvas);\r\n      g2.putImageData(this.dragimg, 0, 0);\r\n\r\n\r\n      this.tbar.dispatchEvent(this.dragevent);\r\n\r\n      return;\r\n    }\r\n\r\n    let ti = tbar.tabs.indexOf(tab);\r\n    let next = ti < tbar.tabs.length - 1 ? tbar.tabs[ti + 1] : undefined;\r\n    let prev = ti > 0 ? tbar.tabs[ti - 1] : undefined;\r\n\r\n    if (next !== undefined && next.movable && tab.pos[axis] > next.pos[axis]) {\r\n      tbar.swapTabs(tab, next);\r\n    } else if (prev !== undefined && prev.movable && tab.pos[axis] < prev.pos[axis] + prev.size[axis]*0.5) {\r\n      tbar.swapTabs(tab, prev);\r\n    }\r\n\r\n    tbar.update(true);\r\n\r\n    this.mpos[0] = x;\r\n    this.mpos[1] = y;\r\n\r\n    let e2 = tab.sendEvent(\"tabdragmove\", e);\r\n\r\n    if (e2.defaultPrevented) {\r\n      this.finish();\r\n    }\r\n  }\r\n\r\n  on_keydown(e) {\r\n    if (debug) console.log(e.keyCode);\r\n\r\n    switch (e.keyCode) {\r\n      case 27: //escape\r\n      case 32: //space\r\n      case 13: //enter\r\n      case 9: //tab\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\nexport class TabBar extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    let style = document.createElement(\"style\");\r\n    let canvas = document.createElement(\"canvas\");\r\n\r\n    this.iconsheet = 0;\r\n    this.movableTabs = true;\r\n\r\n    this.tabFontScale = 1.0;\r\n\r\n    this.tabs = [];\r\n    this.tabs.active = undefined;\r\n    this.tabs.highlight = undefined;\r\n\r\n    this._last_style_key = undefined;\r\n\r\n    canvas.style[\"width\"] = \"145px\";\r\n    canvas.style[\"height\"] = \"45px\";\r\n\r\n    this.r = this.getDefault(\"TabBarRadius\", undefined, 8);\r\n\r\n    this.canvas = canvas;\r\n    this.g = canvas.getContext(\"2d\");\r\n\r\n    this.canvas.style[\"touch-action\"] = \"none\";\r\n\r\n    style.textContent = `\r\n    `;\r\n\r\n    this.shadow.appendChild(style);\r\n    this.shadow.appendChild(canvas);\r\n\r\n    this._last_dpi = undefined;\r\n    this._last_pos = undefined;\r\n\r\n    this.horiz = true;\r\n    this.onchange = null;\r\n    this.onselect = null; //onselect is like onchange, but fires even if tab hasn't changed\r\n\r\n    let mx, my;\r\n\r\n    this.canvas.addEventListener(\"pointermove\", (e) => {\r\n      this.on_pointermove(e);\r\n    }, false);\r\n\r\n\r\n    this.canvas.addEventListener(\"pointerdown\", (e) => {\r\n      this.on_pointerdown(e);\r\n    });\r\n  }\r\n\r\n  _doelement(e, mx, my){\r\n    for (let tab of this.tabs) {\r\n      let ok;\r\n\r\n      if (this.horiz) {\r\n        ok = mx >= tab.pos[0] && mx <= tab.pos[0] + tab.size[0];\r\n      } else {\r\n        ok = my >= tab.pos[1] && my <= tab.pos[1] + tab.size[1];\r\n      }\r\n\r\n      if (ok && this.tabs.highlight !== tab) {\r\n        this.tabs.highlight = tab;\r\n        this.update(true);\r\n      }\r\n    }\r\n  }\r\n\r\n  _domouse (e) {\r\n    let r = this.canvas.getClientRects()[0];\r\n\r\n    let mx = e.x - r.x;\r\n    let my = e.y - r.y;\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    mx *= dpi;\r\n    my *= dpi;\r\n\r\n    this._doelement(e, mx, my);\r\n\r\n    const is_mdown = e.type === \"mousedown\";\r\n    if (is_mdown && this.onselect && this._fireOnSelect().defaultPrevented) {\r\n      e.preventDefault();\r\n    }\r\n  }\r\n\r\n  _doclick (e) {\r\n    this._domouse(e);\r\n\r\n    if (e.defaultPrevented) {\r\n      return;\r\n    }\r\n\r\n    if (debug) console.log(\"mdown\");\r\n\r\n    if (e.button !== 0) {\r\n      return;\r\n    }\r\n\r\n    let ht = this.tabs.highlight;\r\n\r\n    let acte = {};\r\n    for (let k in e) {\r\n      if (k === \"defaultPrevented\" || k === \"cancelBubble\") {\r\n        continue;\r\n      }\r\n\r\n      acte[k] = e[k];\r\n    }\r\n\r\n    acte.target = ht;\r\n    acte.pointerId = e.pointerId;\r\n\r\n    acte = new PointerEvent(\"tabactive\", acte);\r\n\r\n    let e2 = ht.sendEvent(\"tabclick\", e);\r\n\r\n    if (e2.defaultPrevented) {\r\n      acte.preventDefault();\r\n    }\r\n\r\n    if (ht !== undefined && this.tool === undefined) {\r\n      this.setActive(ht, acte);\r\n\r\n      if (this.movableTabs && !acte.defaultPrevented) {\r\n        this._startMove(ht, e);\r\n      }\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    this._doclick(e);\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let r = this.canvas.getClientRects()[0];\r\n    this._domouse(e);\r\n\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n  }\r\n\r\n  on_pointerup(e) {\r\n\r\n  }\r\n\r\n\r\n  static setDefault(e) {\r\n    e.setAttribute(\"bar_pos\", \"top\");\r\n    e.updatePos(true);\r\n\r\n    return e;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"tabbar-x\",\r\n      style  : \"tabs\"\r\n    };\r\n  }\r\n\r\n  _ensureNoModal() {\r\n    if (this.tool) {\r\n      this.tool.finish();\r\n      this.tool = undefined;\r\n    }\r\n  }\r\n\r\n  get tool() {\r\n    return this._tool;\r\n  }\r\n\r\n  set tool(v) {\r\n    //console.warn(\"SET TOOL\", v, this._id);\r\n    this._tool = v;\r\n  }\r\n\r\n  _startMove(tab=this.tabs.active, event, pointerId=event ? event.pointerId : undefined, pointerElem=tab) {\r\n    if (this.movableTabs) {\r\n      let e2 = tab.sendEvent(\"tabdragstart\", event);\r\n\r\n      if (e2.defaultPrevented) {\r\n        return;\r\n      }\r\n\r\n      if (this.tool) {\r\n        this.tool.finish();\r\n      }\r\n\r\n      let edom = this.getScreen();\r\n      let tool = this.tool = new ModalTabMove(tab, this, edom);\r\n\r\n      if (event && pointerElem && pointerId !== undefined) {\r\n        tool.pushPointerModal(pointerElem, pointerId);\r\n      } else {\r\n        tool.pushModal(edom, false);\r\n      }\r\n    }\r\n  }\r\n\r\n  _fireOnSelect() {\r\n    let e = this._makeOnSelectEvt();\r\n\r\n    if (this.onselect) {\r\n      this.onselect(e);\r\n    }\r\n\r\n    return e;\r\n  }\r\n\r\n  _makeOnSelectEvt() {\r\n    return {\r\n      tab             : this.tabs.highlight,\r\n      defaultPrevented: false,\r\n      preventDefault() {\r\n        this.defaultPrevented = true;\r\n      }\r\n    }\r\n    /*\r\n      return new MouseEvent(\"mousedown\", {\r\n        target : [this.tabs.highlight],\r\n        tab : \"sdfdsf\"\r\n      });\r\n\r\n   */\r\n  }\r\n\r\n  getTab(name_or_id) {\r\n    for (let tab of this.tabs) {\r\n      if (tab.id === name_or_id || tab.name === name_or_id)\r\n        return tab;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  clear() {\r\n    for (let t of this.tabs) {\r\n      if (t.dom) {\r\n        t.dom.remove();\r\n      }\r\n\r\n      t.remove();\r\n    }\r\n\r\n    this.tabs = [];\r\n    this.setCSS();\r\n    this._redraw();\r\n  }\r\n\r\n  saveData() {\r\n    let taborder = [];\r\n\r\n    for (let tab of this.tabs) {\r\n      taborder.push(tab.name);\r\n    }\r\n\r\n    let act = this.tabs.active !== undefined ? this.tabs.active.name : \"null\";\r\n\r\n    return {\r\n      taborder: taborder,\r\n      active  : act\r\n    };\r\n  }\r\n\r\n  loadData(obj) {\r\n    if (!obj.taborder) {\r\n      return;\r\n    }\r\n\r\n    let tabs = this.tabs;\r\n    let active = undefined;\r\n    let ntabs = [];\r\n\r\n    ntabs.active = undefined;\r\n    ntabs.highlight = undefined;\r\n\r\n    for (let tname of obj.taborder) {\r\n      let tab = this.getTab(tname);\r\n\r\n      if (tab === undefined) {\r\n        continue;\r\n      }\r\n\r\n      if (tab.name === obj.active) {\r\n        active = tab;\r\n      }\r\n\r\n      ntabs.push(tab);\r\n    }\r\n\r\n    for (let tab of tabs) {\r\n      if (ntabs.indexOf(tab) < 0) {\r\n        ntabs.push(tab);\r\n      }\r\n    }\r\n\r\n    this.tabs = ntabs;\r\n\r\n    try {\r\n      if (active !== undefined) {\r\n        this.setActive(active);\r\n      } else if (this.tabs.length > 0) {\r\n        this.setActive(this.tabs[0]);\r\n      }\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n    }\r\n\r\n    this.update(true);\r\n\r\n    return this;\r\n  }\r\n\r\n  swapTabs(a, b) {\r\n    let tabs = this.tabs;\r\n\r\n    let ai = tabs.indexOf(a);\r\n    let bi = tabs.indexOf(b);\r\n\r\n    tabs[ai] = b;\r\n    tabs[bi] = a;\r\n\r\n    this.update(true);\r\n  }\r\n\r\n  addIconTab(icon, id, tooltip, movable = true) {\r\n    let tab = this.addTab(\"\", id, tooltip, movable);\r\n    tab.icon = icon;\r\n\r\n    return tab;\r\n  }\r\n\r\n  addTab(name, id, tooltip = \"\", movable) {\r\n    let tab = UIBase.createElement(\"tab-item-x\", true);\r\n\r\n    this.shadow.appendChild(tab);\r\n    tab.parentWidget = this;\r\n\r\n\r\n    tab.name = name;\r\n    tab.id = id;\r\n    tab.tooltip = tooltip;\r\n    tab.movable = movable;\r\n    tab.tbar = this;\r\n\r\n    this.tabs.push(tab);\r\n    this.update(true);\r\n\r\n    if (this.tabs.length === 1) {\r\n      this.setActive(this.tabs[0]);\r\n    }\r\n\r\n    return tab;\r\n  }\r\n\r\n  updatePos(force_update = false) {\r\n    let pos = this.getAttribute(\"bar_pos\");\r\n\r\n    if (pos !== this._last_pos || force_update) {\r\n      this._last_pos = pos;\r\n\r\n      this.horiz = pos === \"top\" || pos === \"bottom\";\r\n      if (debug) console.log(\"tab bar position update\", this.horiz);\r\n\r\n      if (this.horiz) {\r\n        this.style[\"width\"] = \"100%\";\r\n        delete this.style[\"height\"];\r\n      } else {\r\n        this.style[\"height\"] = \"100%\";\r\n        delete this.style[\"width\"];\r\n      }\r\n\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  updateDPI(force_update = false) {\r\n    let dpi = this.getDPI();\r\n\r\n    if (dpi !== this._last_dpi) {\r\n      if (debug) console.log(\"DPI update!\");\r\n      this._last_dpi = dpi;\r\n\r\n      this.updateCanvas(true);\r\n    }\r\n  }\r\n\r\n  updateCanvas(force_update = false) {\r\n    let canvas = this.canvas;\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let rwidth = getpx(this.canvas.style[\"width\"]);\r\n    let rheight = getpx(this.canvas.style[\"height\"]);\r\n\r\n    let width = ~~(rwidth*dpi);\r\n    let height = ~~(rheight*dpi);\r\n\r\n    let update = force_update;\r\n    update = update || canvas.width !== width || canvas.height !== height;\r\n\r\n    if (update) {\r\n      canvas.width = width;\r\n      canvas.height = height;\r\n\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _getFont(tsize) {\r\n    let font = this.getDefault(\"TabText\");\r\n\r\n    if (this.tabFontScale !== 1.0) {\r\n      font = font.copy();\r\n      font.size *= this.tabFontScale;\r\n    }\r\n\r\n    return font;\r\n  }\r\n\r\n  _layout() {\r\n    if ((!this.ctx || !this.ctx.screen) && !this.isDead()) {\r\n      this.doOnce(this._layout);\r\n    }\r\n\r\n    let g = this.g;\r\n\r\n    if (debug) console.log(\"tab layout\");\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let font = this._getFont();\r\n    let tsize = (font.size*dpi);\r\n\r\n    g.font = font.genCSS(tsize);\r\n\r\n    let axis = this.horiz ? 0 : 1;\r\n\r\n    let pad = 4*dpi + Math.ceil(tsize*0.25);\r\n    let x = pad;\r\n    let y = 0;\r\n\r\n    let h = tsize + Math.ceil(tsize*0.5);\r\n    let iconsize = iconmanager.getTileSize(this.iconsheet);\r\n    let have_icons = false;\r\n\r\n    for (let tab of this.tabs) {\r\n      if (tab.icon !== undefined) {\r\n        have_icons = true;\r\n        h = Math.max(h, iconsize + 4);\r\n        break;\r\n      }\r\n    }\r\n\r\n    let r1 = this.parentWidget ? this.parentWidget.getClientRects()[0] : undefined;\r\n    let r2 = this.canvas.getClientRects()[0];\r\n\r\n    let rx = 0, ry = 0;\r\n    if (r1 && r2) {\r\n      rx = r2.x;//r2.x - r1.x;\r\n      ry = r2.y; //r2.y - r1.y;\r\n    }\r\n\r\n    let ti = -1;\r\n\r\n    let makeTabWatcher = (tab) => {\r\n      if (tab.watcher) {\r\n        clearInterval(tab.watcher.timer);\r\n      }\r\n\r\n      let watcher = () => {\r\n        let dead = this.tabs.indexOf(tab) < 0;\r\n        dead = dead || this.isDead();\r\n\r\n        if (dead) {\r\n          if (tab.dom)\r\n            tab.dom.remove();\r\n          tab.dom = undefined;\r\n\r\n          if (tab.watcher.timer)\r\n            clearInterval(tab.watcher.timer);\r\n        }\r\n      };\r\n\r\n      tab.watcher = watcher;\r\n      tab.watcher.timer = window.setInterval(watcher, 750);\r\n\r\n      return tab.watcher.timer;\r\n    };\r\n\r\n    let haveTabDom = false;\r\n    for (let tab of this.tabs) {\r\n      if (tab.extra) {\r\n        haveTabDom = true;\r\n      }\r\n    }\r\n\r\n    if (haveTabDom && this.ctx && this.ctx.screen && !this._size_cb) {\r\n      this._size_cb = () => {\r\n        if (this.isDead()) {\r\n          this.ctx.screen.removeEventListener(\"resize\", this._size_cb);\r\n          this._size_cb = undefined;\r\n          return;\r\n        }\r\n        if (!this.ctx) return;\r\n\r\n        this._layout();\r\n        this._redraw();\r\n      };\r\n\r\n      this.ctx.screen.addEventListener(\"resize\", this._size_cb);\r\n    }\r\n\r\n    for (let tab of this.tabs) {\r\n      ti++;\r\n\r\n      if (tab.extra && !tab.dom) {\r\n\r\n        tab.dom = document.createElement(\"div\");\r\n        tab.dom.style[\"margin\"] = tab.dom.style[\"padding\"] = \"0px\";\r\n\r\n        let z = this.calcZ();\r\n        tab.dom.style[\"z-index\"] = z + 1 + ti;\r\n\r\n        document.body.appendChild(tab.dom);\r\n        tab.dom.style[\"position\"] = UIBase.PositionKey;\r\n        tab.dom.style[\"display\"] = \"flex\";\r\n        tab.dom.style[\"flex-direction\"] = this.horiz ? \"row\" : \"column\";\r\n\r\n        tab.dom.style[\"pointer-events\"] = \"none\";\r\n\r\n        if (!this.horiz) {\r\n          tab.dom.style[\"width\"] = (tab.size[0]/dpi) + \"px\";\r\n          tab.dom.style[\"height\"] = (tab.size[1]/dpi) + \"px\";\r\n          tab.dom.style[\"left\"] = (rx + tab.pos[0]/dpi) + \"px\";\r\n          tab.dom.style[\"top\"] = (ry + tab.pos[1]/dpi) + \"px\";\r\n        } else {\r\n          tab.dom.style[\"width\"] = (tab.size[0]/dpi) + \"px\";\r\n          tab.dom.style[\"height\"] = (tab.size[1]/dpi) + \"px\";\r\n          tab.dom.style[\"left\"] = (rx + tab.pos[0]/dpi) + \"px\";\r\n          tab.dom.style[\"top\"] = (ry + tab.pos[1]/dpi) + \"px\";\r\n        }\r\n\r\n        let font = this._getFont();\r\n        tab.dom.style[\"font\"] = font.genCSS();\r\n        tab.dom.style[\"color\"] = font.color;\r\n\r\n        tab.dom.appendChild(tab.extra);\r\n\r\n        //tab.dom.style[\"background-color\"] = \"red\";\r\n\r\n        makeTabWatcher(tab);\r\n      }\r\n\r\n      let w = g.measureText(tab.name).width;\r\n\r\n      if (tab.extra) {\r\n        w += tab.extraSize || tab.extra.getClientRects()[0].width;\r\n\r\n      }\r\n\r\n      if (tab.icon !== undefined) {\r\n        w += iconsize;\r\n      }\r\n\r\n      //don't interfere with tab dragging\r\n      let bad = this.tool !== undefined && tab === this.tabs.active;\r\n\r\n      if (!bad) {\r\n        tab.pos[axis] = x;\r\n        tab.pos[axis ^ 1] = y;\r\n      }\r\n\r\n      //tab.size = [0, 0];\r\n      tab.size[axis] = w + pad*2;\r\n      tab.size[axis ^ 1] = h;\r\n\r\n      x += w + pad*2;\r\n    }\r\n\r\n    x = (~~(x + pad))/dpi;\r\n    h = (~~h)/dpi;\r\n\r\n\r\n    if (this.horiz) {\r\n      this.canvas.style[\"width\"] = x + \"px\";\r\n      this.canvas.style[\"height\"] = h + \"px\";\r\n    } else {\r\n      this.canvas.style[\"height\"] = x + \"px\";\r\n      this.canvas.style[\"width\"] = h + \"px\";\r\n    }\r\n\r\n    for (let tab of this.tabs) {\r\n      tab.setCSS();\r\n    }\r\n\r\n    //this.canvas.width = x;\r\n  }\r\n\r\n  /** tab is a TabItem instance */\r\n  setActive(tab, event) {\r\n    if (tab.noSwitch) {\r\n      return;\r\n    }\r\n\r\n    let update = tab !== this.tabs.active;\r\n    this.tabs.active = tab;\r\n\r\n    if (update) {\r\n      if (this.onchange)\r\n        this.onchange(tab, event);\r\n\r\n      this.update(true);\r\n    }\r\n  }\r\n\r\n  _redraw() {\r\n    let g = this.g;\r\n\r\n    let activecolor = this.getDefault(\"TabActive\") || \"rgba(0,0,0,0)\";\r\n\r\n    if (debug) console.log(\"tab draw\");\r\n\r\n    g.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n\r\n    let dpi = this.getDPI();\r\n    let font = this._getFont();\r\n\r\n    let tsize = font.size;\r\n    let iconsize = iconmanager.getTileSize(this.iconsheet);\r\n\r\n    tsize = (tsize*dpi);\r\n    g.font = font.genCSS(tsize);\r\n\r\n    g.lineWidth = 2;\r\n    g.strokeStyle = this.getDefault(\"TabStrokeStyle1\");\r\n\r\n    let r = this.r*dpi;\r\n    this._layout();\r\n    let tab;\r\n\r\n    let ti = -1;\r\n    for (tab of this.tabs) {\r\n      ti++;\r\n\r\n      if (tab === this.tabs.active)\r\n        continue;\r\n\r\n      let x = tab.pos[0], y = tab.pos[1];\r\n      let w = tab.size[0], h = tab.size[1];\r\n      //let tw = g.measureText(tab.name).width;\r\n      let tw = ui_base.measureText(this, tab.name, this.canvas, g, tsize, font).width;\r\n\r\n      let x2 = x + (tab.size[this.horiz ^ 1] - tw)*0.5;\r\n      let y2 = y + tsize;\r\n\r\n      if (tab === this.tabs.highlight) {\r\n        let p = 2;\r\n\r\n        g.beginPath();\r\n        g.rect(x + p, y + p, w - p*2, h - p*2);\r\n        g.fillStyle = this.getDefault(\"TabHighlight\");\r\n        g.fill();\r\n      }\r\n\r\n      g.fillStyle = this.getDefault(\"TabText\").color;\r\n\r\n      if (!this.horiz) {\r\n        let x3 = 0, y3 = y2;\r\n\r\n        g.save();\r\n        g.translate(x3, y3);\r\n        g.rotate(Math.PI/2);\r\n        g.translate(x3 - tsize, -y3 - tsize*0.5);\r\n      }\r\n\r\n      if (tab.icon !== undefined) {\r\n        iconmanager.canvasDraw(this, this.canvas, g, tab.icon, x, y, this.iconsheet);\r\n        x2 += iconsize + 4;\r\n      }\r\n\r\n      g.fillText(tab.name, x2, y2);\r\n\r\n      if (!this.horiz) {\r\n        g.restore();\r\n      }\r\n\r\n      let prev = this.tabs[Math.max(ti - 1 + this.tabs.length, 0)];\r\n      let next = this.tabs[Math.min(ti + 1, this.tabs.length - 1)];\r\n\r\n      if (tab !== this.tabs[this.tabs.length - 1] && prev !== this.tabs.active && next !== this.tabs.active) {\r\n        g.beginPath();\r\n        if (this.horiz) {\r\n          g.moveTo(x + w, h - 5);\r\n          g.lineTo(x + w, 5);\r\n        } else {\r\n          g.moveTo(w - 5, y + h);\r\n          g.lineTo(5, y + h);\r\n        }\r\n        g.strokeStyle = this.getDefault(\"TabStrokeStyle1\");\r\n        g.stroke();\r\n      }\r\n    }\r\n\r\n    let th = tsize;\r\n\r\n    //draw active tab\r\n    tab = this.tabs.active;\r\n    if (tab) {\r\n      let x = tab.pos[0], y = tab.pos[1];\r\n      let w = tab.size[0], h = tab.size[1];\r\n      //let tw = g.measureText(tab.name).width;\r\n      let tw = ui_base.measureText(this, tab.name, this.canvas, g, tsize, font).width;\r\n\r\n      if (this.horiz) {\r\n        h += 2;\r\n      } else {\r\n        w += 2;\r\n      }\r\n\r\n      let x2 = x + (tab.size[this.horiz ^ 1] - tw)*0.5;\r\n      let y2 = y + tsize;\r\n\r\n      if (tab === this.tabs.active) {\r\n        /*\r\n        let x = !this.horiz ? tab.y : tab.x;\r\n        let y = !this.horiz ? tab.x : tab.y;\r\n        let w = !this.horiz ? tab.size[1] : tab.size[0];\r\n        let h = !this.horiz ? tab.size[0] : tab.size[1];\r\n\r\n        if (!this.horiz) {\r\n          //g.save();\r\n          //g.translate(0, y);\r\n          //g.rotate(Math.PI/16);\r\n          //g.translate(0, -y);\r\n        }//*/\r\n\r\n        g.beginPath();\r\n        //g.lineWidth *= 5;\r\n        let ypad = 2;\r\n\r\n        g.strokeStyle = this.getDefault(\"TabStrokeStyle2\");\r\n        g.fillStyle = activecolor;\r\n        let r2 = r*1.5;\r\n\r\n        if (this.horiz) {\r\n          g.moveTo(x - r, h);\r\n          g.quadraticCurveTo(x, h, x, h - r);\r\n          g.lineTo(x, r2);\r\n          g.quadraticCurveTo(x, ypad, x + r2, ypad)\r\n          g.lineTo(x + w - r2, ypad);\r\n          g.quadraticCurveTo(x + w, 0, x + w, r2);\r\n          g.lineTo(x + w, h - r2);\r\n          g.quadraticCurveTo(x + w, h, x + w + r, h);\r\n\r\n          g.stroke()\r\n          //\r\n          g.closePath()\r\n        } else {\r\n          g.moveTo(w, y - r);\r\n          g.quadraticCurveTo(w, y, w - r, y);\r\n          ///*\r\n          g.lineTo(r2, y);\r\n          g.quadraticCurveTo(ypad, y, ypad, y + r2);\r\n          g.lineTo(ypad, y + h - r2);\r\n          g.quadraticCurveTo(0, y + h, r2, y + h);\r\n          g.lineTo(w - r2, y + h);\r\n          g.quadraticCurveTo(w, y + h, w, y + h + r);\r\n          //*/\r\n          g.stroke()\r\n          //\r\n          g.closePath()\r\n        }\r\n\r\n        let cw = this.horiz ? this.canvas.width : this.canvas.height;\r\n\r\n        let worig = g.lineWidth;\r\n\r\n        g.lineWidth *= 0.5;\r\n\r\n        g.fill();\r\n        //g.stroke();\r\n\r\n        g.lineWidth = worig;\r\n\r\n        if (!this.horiz) {\r\n          let x3 = 0, y3 = y2;\r\n\r\n          g.save();\r\n          g.translate(x3, y3);\r\n          g.rotate(Math.PI/2);\r\n          g.translate(-x3 - tsize, -y3 - tsize*0.5);\r\n        }\r\n\r\n        g.fillStyle = this.getDefault(\"TabText\").color;\r\n\r\n        //y2 += tsize*0.3;\r\n        g.fillText(tab.name, x2, y2);\r\n\r\n        if (!this.horiz) {\r\n          g.restore();\r\n        }\r\n\r\n        if (!this.horiz) {\r\n          //g.restore();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  removeTab(tab) {\r\n    this.tabs.remove(tab);\r\n    if (tab === this.tabs.active) {\r\n      this.tabs.active = this.tabs[0];\r\n    }\r\n\r\n    this._layout();\r\n    this._redraw();\r\n    this.setCSS();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS(false);\r\n\r\n    /* create a no stacking context */\r\n    this.style[\"contain\"] = \"layout\";\r\n\r\n    this.r = this.getDefault(\"TabBarRadius\", undefined, 8);\r\n\r\n    let r = this.r !== undefined ? this.r : 3;\r\n\r\n    this.style[\"touch-action\"] = \"none\";\r\n\r\n    this.canvas.style[\"background-color\"] = this.getDefault(\"TabInactive\");\r\n    this.canvas.style[\"border-radius\"] = r + \"px\";\r\n    //this.style[\"background-color\"] = this.getDefault(\"TabInactive\");\r\n  }\r\n\r\n  updateStyle() {\r\n    let key = \"\" + this.getDefault(\"background-color\");\r\n    key += this.getDefault(\"TabActive\");\r\n    key += this.getDefault(\"TabInactive\");\r\n    key += this.getDefault(\"TabBarRadius\");\r\n    key += this.getDefault(\"TabStrokeStyle1\");\r\n    key += this.getDefault(\"TabStrokeStyle2\");\r\n    key += this.getDefault(\"TabHighlight\");\r\n    key += JSON.stringify(this.getDefault(\"TabText\"));\r\n    key += this.tabFontScale;\r\n\r\n    if (key !== this._last_style_key) {\r\n      this._last_style_key = key;\r\n\r\n      this._layout();\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  update(force_update = false) {\r\n    let rect = this.getClientRects()[0];\r\n    if (rect) {\r\n      let key = Math.floor(rect.x*4.0) + \":\" + Math.floor(rect.y*4.0);\r\n      if (key !== this._last_p_key) {\r\n        this._last_p_key = key;\r\n\r\n        //console.log(\"tab bar autobuild\");\r\n        this._layout();\r\n      }\r\n    }\r\n    super.update();\r\n\r\n    this.updateStyle();\r\n    this.updatePos(force_update);\r\n    this.updateDPI(force_update);\r\n    this.updateCanvas(force_update);\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(TabBar);\r\n\r\nexport class TabContainer extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._last_style_key = \"\";\r\n\r\n    this.dataPrefix = \"\";\r\n\r\n    this.inherit_packflag = 0;\r\n    this.packflag = 0;\r\n\r\n    this.tabFontScale = 1.0;\r\n\r\n    this.tbar = UIBase.createElement(\"tabbar-x\");\r\n    this.tbar.parentWidget = this;\r\n    this.tbar.setAttribute(\"class\", \"_tbar_\" + this._id);\r\n    this.tbar.constructor.setDefault(this.tbar);\r\n    this.tbar.tabFontScale = this.tabFontScale;\r\n\r\n    this._remakeStyle();\r\n\r\n    this.tabs = {};\r\n\r\n    this._last_horiz = undefined;\r\n    this._last_bar_pos = undefined;\r\n    this._tab = undefined;\r\n\r\n    let div = document.createElement(\"div\");\r\n    div.setAttribute(\"class\", `_tab_${this._id}`);\r\n    div.appendChild(this.tbar);\r\n    this.shadow.appendChild(div);\r\n\r\n    this.tbar.parentWidget = this;\r\n\r\n    this.tbar.onselect = (e) => {\r\n      if (this.onselect) {\r\n        this.onselect(e);\r\n      }\r\n    };\r\n\r\n    this.tbar.onchange = (tab, event) => {\r\n      if (this._tab) {\r\n        HTMLElement.prototype.remove.call(this._tab);\r\n      }\r\n\r\n      this._tab = this.tabs[tab.id];\r\n      //this._tab = document.createElement(\"div\");\r\n      //this._tab.innerText = \"SDfdsfsdyay\";\r\n\r\n      this._tab.parentWidget = this;\r\n\r\n      //ensure we get full update convergence when switching\r\n      //tabs\r\n      for (let i = 0; i < 2; i++) {\r\n        this._tab.flushUpdate();\r\n      }\r\n\r\n      let div = document.createElement(\"div\");\r\n\r\n      this.tbar.setCSS.once(() => div.style[\"background-color\"] = this.getDefault(\"background-color\"), div);\r\n\r\n      div.setAttribute(\"class\", `_tab_${this._id}`);\r\n      div.appendChild(this._tab);\r\n\r\n      //XXX why is this necassary?\r\n      //this._tab.style[\"margin-left\"] = \"40px\";\r\n      this.shadow.appendChild(div);\r\n\r\n      if (this.onchange) {\r\n        this.onchange(tab, event);\r\n      }\r\n    }\r\n  }\r\n\r\n  get movableTabs() {\r\n    let attr;\r\n\r\n    if (!this.hasAttribute(\"movable-tabs\")) {\r\n      attr = this.getDefault(\"movable-tabs\");\r\n\r\n      if (attr === undefined || attr === null) {\r\n        attr = \"true\";\r\n      }\r\n\r\n      if (typeof attr === \"boolean\" || typeof attr === \"number\") {\r\n        attr = attr ? \"true\" : \"false\";\r\n      }\r\n    } else {\r\n      attr = \"\" + this.getAttribute(\"movable-tabs\");\r\n    }\r\n\r\n    attr = attr.toLowerCase();\r\n\r\n    return attr === \"true\";\r\n  }\r\n\r\n  set movableTabs(val) {\r\n    val = !!val;\r\n\r\n    this.setAttribute(\"movable-tabs\", val ? \"true\" : \"false\");\r\n    this.tbar.movableTabs = this.movableTabs;\r\n  }\r\n\r\n  get hideScrollBars() {\r\n    let attr = (\"\" + this.getAttribute(\"hide-scrollbars\")).toLowerCase();\r\n    return attr === \"true\" || attr === \"yes\";\r\n  }\r\n\r\n  set hideScrollBars(val) {\r\n    val = !!val;\r\n\r\n    this.setAttribute(\"hide-scrollbars\", \"\" + val);\r\n  }\r\n\r\n  static setDefault(e) {\r\n    e.setAttribute(\"bar_pos\", \"top\");\r\n\r\n    return e;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"tabcontainer-x\",\r\n      style  : \"tabs\"\r\n    };\r\n  }\r\n\r\n  _startMove(tab=this.tbar.tabs.active, event) {\r\n    return this.tbar._startMove(tab, event);\r\n  }\r\n\r\n  _ensureNoModal() {\r\n    return this.tbar._ensureNoModal();\r\n  }\r\n\r\n  saveData() {\r\n    let json = super.saveData() || {};\r\n    json.tabs = {};\r\n\r\n    for (let k in this.tabs) {\r\n      let tab = this.tabs[k];\r\n\r\n      if (k === this.tbar.tabs.active.id) {\r\n        //no need to save active tab here\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        json.tabs[tab.id] = JSON.parse(saveUIData(tab, \"tab\"));\r\n      } catch (error) {\r\n        console.error(\"Failed to save tab UI layout\", tab.id);\r\n      }\r\n    }\r\n\r\n    return json;\r\n  }\r\n\r\n  loadData(json) {\r\n    if (!json.tabs) {\r\n      return;\r\n    }\r\n\r\n    for (let k in json.tabs) {\r\n      if (!(k in this.tabs)) {\r\n        continue;\r\n      }\r\n\r\n      let uidata = JSON.stringify(json.tabs[k]);\r\n      loadUIData(this.tabs[k], uidata);\r\n    }\r\n  }\r\n\r\n  enableDrag() {\r\n    this.tbar.draggable = this.draggable = true;\r\n    this.tbar.addEventListener(\"dragstart\", (e) => {\r\n      this.dispatchEvent(new DragEvent(\"dragstart\", e));\r\n    });\r\n    this.tbar.addEventListener(\"dragover\", (e) => {\r\n      this.dispatchEvent(new DragEvent(\"dragover\", e));\r\n    });\r\n    this.tbar.addEventListener(\"dragexit\", (e) => {\r\n      this.dispatchEvent(new DragEvent(\"dragexit\", e));\r\n    });\r\n    /*\r\n    let doms = [this, this.tbar, this.tbar.canvas];\r\n    for (let dom of doms) {\r\n      dom.setAttribute(\"draggable\", \"true\");\r\n      dom.draggable = true;\r\n\r\n      dom.addEventListener(\"dragstart\", (e) => {\r\n        console.log(\"drag start\", e);\r\n      });\r\n\r\n      dom.addEventListener(\"drag\", (e) => {\r\n        console.log(\"drag\", e);\r\n      });\r\n    }*/\r\n  }\r\n\r\n  clear() {\r\n    this.tbar.clear();\r\n    if (this._tab !== undefined) {\r\n      HTMLElement.prototype.remove.call(this._tab);\r\n      this._tab = undefined;\r\n    }\r\n\r\n    this.tabs = {};\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.background = this.getDefault(\"background-color\");\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.background = this.getDefault(\"background-color\");\r\n    this._remakeStyle();\r\n  }\r\n\r\n  _remakeStyle() {\r\n    let horiz = this.tbar.horiz;\r\n    let display = \"flex\";\r\n    let flexDir = !horiz ? \"row\" : \"column\";\r\n    let bgcolor = this.__background; //this.getDefault(\"background-color\");\r\n\r\n    //display = \"inline\" //XXX\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n      ._tab_${this._id} {\r\n        display : ${display};\r\n        flex-direction : ${flexDir};\r\n        margin : 0px;\r\n        padding : 0px;\r\n        align-self : flex-start;\r\n        ${!horiz ? \"vertical-align : top;\" : \"\"}\r\n      }\r\n      \r\n      ._tbar_${this._id} {\r\n        list-style-type : none;\r\n        align-self : flex-start;\r\n        background-color : ${bgcolor};\r\n        flex-direction : ${flexDir};\r\n        ${!horiz ? \"vertical-align : top;\" : \"\"}\r\n      }\r\n    `;\r\n\r\n    if (this._style)\r\n      this._style.remove();\r\n    this._style = style;\r\n\r\n    this.shadow.prepend(style);\r\n  }\r\n\r\n  icontab(icon, id, tooltip) {\r\n    let t = this.tab(\"\", id, tooltip);\r\n    t._tab.icon = icon;\r\n\r\n    return t;\r\n  }\r\n\r\n  removeTab(tab) {\r\n    let tab2 = tab._tab;\r\n    this.tbar.removeTab(tab2);\r\n    tab.remove();\r\n  }\r\n\r\n  tab(name, id = undefined, tooltip = undefined, movable = true) {\r\n    if (id === undefined) {\r\n      id = tab_idgen++;\r\n    }\r\n\r\n    let col = UIBase.createElement(\"colframe-x\");\r\n\r\n    this.tabs[id] = col;\r\n\r\n    col.dataPrefix = this.dataPrefix;\r\n\r\n    col.ctx = this.ctx;\r\n    col._tab = this.tbar.addTab(name, id, tooltip, movable);\r\n\r\n    col.inherit_packflag |= this.inherit_packflag;\r\n    col.packflag |= this.packflag;\r\n\r\n    //let cls = this.tbar.horiz ? ui.ColumnFrame : ui.RowFrame;\r\n\r\n    col.parentWidget = this;\r\n\r\n    if (col.ctx) {\r\n      col._init();\r\n    }\r\n\r\n    col.setCSS();\r\n\r\n    if (this._tab === undefined) {\r\n      this.setActive(col);\r\n    }\r\n\r\n    col.noSwitch = function () {\r\n      this._tab.noSwitch = true;\r\n      return this;\r\n    }\r\n\r\n    function defineTabEvent(key) {\r\n      key = \"on\" + key;\r\n\r\n      Object.defineProperty(col, key, {\r\n        get() {\r\n          return this._tab[key];\r\n        },\r\n        set(v) {\r\n          this._tab[key] = v;\r\n        }\r\n      });\r\n    }\r\n\r\n    defineTabEvent(\"tabclick\");\r\n    defineTabEvent(\"tabdragmove\");\r\n    defineTabEvent(\"tabdragstart\");\r\n    defineTabEvent(\"tabdragend\");\r\n\r\n    return col;\r\n  }\r\n\r\n  setActive(tab) {\r\n    if (typeof tab === \"string\") {\r\n      tab = this.getTab(tab);\r\n    }\r\n\r\n    if (!tab) {\r\n      return;\r\n    }\r\n\r\n    if (tab._tab !== this.tbar.tabs.active) {\r\n      this.tbar.setActive(tab._tab);\r\n    }\r\n  }\r\n\r\n  getTabCount() {\r\n    return this.tbar.tabs.length;\r\n  }\r\n\r\n  moveTab(tab, i) {\r\n    tab = tab._tab;\r\n\r\n    let tab2 = this.tbar.tabs[i];\r\n\r\n    if (tab !== tab2) {\r\n      this.tbar.swapTabs(tab, tab2);\r\n    }\r\n\r\n    this.tbar.setCSS();\r\n    this.tbar._layout();\r\n    this.tbar._redraw();\r\n  }\r\n\r\n  getTab(name_or_id) {\r\n    if (name_or_id in this.tabs) {\r\n      return this.tabs[name_or_id];\r\n    }\r\n\r\n    for (let k in this.tabs) {\r\n      let t = this.tabs[k];\r\n\r\n      if (t.name === name_or_id) {\r\n        return t;\r\n      }\r\n    }\r\n\r\n    throw new Error(\"Unknown tab \" + name_or_id);\r\n  }\r\n\r\n  updateBarPos() {\r\n    let barpos = this.getAttribute(\"bar_pos\");\r\n\r\n    if (barpos !== this._last_bar_pos) {\r\n      this.horiz = barpos === \"top\" || barpos === \"bottom\";\r\n      this._last_bar_pos = barpos;\r\n\r\n      this.tbar.setAttribute(\"bar_pos\", barpos);\r\n      this.tbar.update(true);\r\n      this.update();\r\n    }\r\n  }\r\n\r\n  updateHoriz() {\r\n    let horiz = this.tbar.horiz;\r\n\r\n    if (this._last_horiz !== horiz) {\r\n      this._last_horiz = horiz;\r\n      this._remakeStyle();\r\n    }\r\n  }\r\n\r\n  updateStyle() {\r\n    let key = \"\" + this.getDefault(\"background-color\");\r\n\r\n    if (key !== this._last_style_key) {\r\n      this._last_style_key = key;\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  getActive() {\r\n    return this.tbar.tabs.active;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.tbar.movableTabs = this.movableTabs;\r\n\r\n    if (this._tab !== undefined) {\r\n      this._tab.update();\r\n    }\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-direction\"] = !this.horiz ? \"row\" : \"column\";\r\n\r\n    this.tbar.tabFontScale = this.tabFontScale;\r\n\r\n    this.updateStyle();\r\n    this.updateHoriz();\r\n    this.updateBarPos();\r\n    this.tbar.update();\r\n\r\n    let act = this.tbar.tabs.active;\r\n\r\n    if (act && !this.hideScrollBars) {\r\n      let container = this.tabs[act.id];\r\n\r\n      //propegate overflow-y to tab container as a whole\r\n\r\n      if (container.hasAttribute(\"overflow-y\") && this.style[\"overflow-y\"] !== container.getAttribute(\"overflow-y\")) {\r\n        this.style[\"overflow-y\"] = container.getAttribute(\"overflow-y\");\r\n        //container.style[\"overflow-y\"] = \"unset\";\r\n      } else if (!container.hasAttribute(\"overflow-y\")) {\r\n        this.style[\"overflow-y\"] = this.getDefault(\"overflow-y\") || \"unset\";\r\n      }\r\n\r\n      if (container.hasAttribute(\"overflow\") && this.style[\"overflow\"] !== container.getAttribute(\"overflow\")) {\r\n        this.style[\"overflow\"] = container.getAttribute(\"overflow\");\r\n        //container.style[\"overflow-y\"] = \"unset\";\r\n      } else if (!container.hasAttribute(\"overflow\")) {\r\n        this.style[\"overflow\"] = this.getDefault(\"overflow\") || \"unset\";\r\n      }\r\n    } else if (this.hideScrollBars) {\r\n      this.style[\"overflow\"] = this.style[\"overflow-y\"] = \"unset\";\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(TabContainer);\r\n","//bind module to global var to get at it in console.\r\n//\r\n//note that require has an api for handling circular\r\n//module refs, in such cases do not use these vars.\r\n\r\nimport {Container} from \"../core/ui.js\";\r\n\r\nvar _ui = undefined;\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_curvewidget from './ui_curvewidget.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as ui_widgets from './ui_widgets.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\n\r\nlet PropFlags = toolprop.PropFlags;\r\nlet PropSubTypes = toolprop.PropSubTypes;\r\n\r\nlet EnumProperty = toolprop.EnumProperty;\r\n\r\nlet Vector2 = vectormath.Vector2,\r\n  UIBase = ui_base.UIBase,\r\n  PackFlags = ui_base.PackFlags,\r\n  PropTypes = toolprop.PropTypes;\r\n\r\n\r\nconst list = util.list;\r\n\r\nexport class TableRow extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.dom.remove();\r\n    this.dom = document.createElement(\"tr\");\r\n\r\n    //kind of dumb, but this.dom doesn't live within this element itself, bleh\r\n    //this.shadow.appendChild(this.dom);\r\n    this.dom.setAttribute(\"class\", \"containerx\");\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"tablerow-x\"\r\n  };}\r\n\r\n  _add(child) {\r\n    child.ctx = this.ctx;\r\n    child.parentWidget = this;\r\n\r\n    let td = document.createElement(\"td\");\r\n    td.appendChild(child);\r\n\r\n    this.dom.appendChild(td);\r\n    child.onadd();\r\n  }\r\n};\r\nUIBase.internalRegister(TableRow);\r\n\r\nexport class TableFrame extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.dom = document.createElement(\"table\");\r\n    this.shadow.appendChild(this.dom);\r\n    this.dom.setAttribute(\"class\", \"containerx\");\r\n\r\n    //this.dom.style[\"display\"] = \"block\";\r\n  }\r\n\r\n  update() {\r\n    this.style[\"display\"] = \"inline-block\";\r\n    super.update();\r\n  }\r\n\r\n  _add(child) {\r\n    child.ctx = this.ctx;\r\n    child.parentWidget = this;\r\n    this.dom.appendChild(child);\r\n    child.onadd();\r\n  }\r\n\r\n  add(child) {\r\n    this._add(child);\r\n  }\r\n\r\n  row() {\r\n    let tr = document.createElement(\"tr\");\r\n    let cls = \"table-tr\";\r\n\r\n    tr.setAttribute(\"class\", cls);\r\n    this.dom.appendChild(tr);\r\n    let this2 = this;\r\n\r\n    function maketd() {\r\n      let td = document.createElement(\"td\");\r\n      tr.appendChild(td);\r\n\r\n      td.style[\"margin\"] = tr.style[\"margin\"];\r\n      td.style[\"padding\"] = tr.style[\"padding\"];\r\n\r\n      let container = UIBase.createElement(\"rowframe-x\");\r\n\r\n      container.ctx = this2.ctx;\r\n      container.parentWidget = this2;\r\n      container.setAttribute(\"class\", cls);\r\n\r\n      td.setAttribute(\"class\", cls);\r\n      td.appendChild(container);\r\n\r\n      return container;\r\n    }\r\n\r\n    //hrm wish I could subclass html elements easier\r\n    let ret = {\r\n      _tr : tr,\r\n\r\n      style : tr.style,\r\n\r\n      focus : function(args) {\r\n        tr.focus(args);\r\n      },\r\n\r\n      blur : function(args) {\r\n        tr.blur(args);\r\n      },\r\n\r\n      remove : () => {\r\n        tr.remove();\r\n      },\r\n\r\n      addEventListener : function(type, cb, arg) {\r\n        tr.addEventListener(type, cb, arg);\r\n      },\r\n\r\n      removeEventListener : function(type, cb, arg) {\r\n        tr.removeEventListener(type, cb, arg);\r\n      },\r\n\r\n      setAttribute : function(attr, val) {\r\n        if (attr == \"class\") {\r\n          cls = val;\r\n        }\r\n\r\n        tr.setAttribute(attr, val);\r\n      },\r\n\r\n      scrollTo : function() {\r\n        return this._tr.scrollTo(...arguments);\r\n      },\r\n\r\n      scrollIntoView : function() {\r\n        return this._tr.scrollIntoView(...arguments);\r\n      },\r\n\r\n      clear : function() {\r\n        for (let node of list(tr.childNodes)) {\r\n          tr.removeChild(node);\r\n        }\r\n      }\r\n    };\r\n\r\n    function makefunc(f) {\r\n      ret[f] = function() {\r\n        let container = maketd();\r\n\r\n        container.background = tr.style[\"background-color\"]; //\"rgba(0,0,0,0)\";\r\n        return container[f].apply(container, arguments);\r\n      }\r\n    }\r\n\r\n    let _bg = \"\";\r\n\r\n    //need to implement proper proxy here!\r\n    Object.defineProperty(ret, \"tabIndex\", {\r\n      set : function(f) {\r\n        tr.tabIndex = f;\r\n      },\r\n\r\n      get : function(f) {\r\n        return tr.tabIndex;\r\n      }\r\n    });\r\n\r\n    Object.defineProperty(ret, \"background\", {\r\n      set : function(bg) {\r\n        _bg = bg;\r\n        tr.style[\"background-color\"] = bg;\r\n\r\n        for (let node of tr.childNodes) {\r\n          if (node.childNodes.length > 0) {\r\n            node.childNodes[0].background = bg;\r\n            node.style[\"background-color\"] = bg;\r\n          }\r\n        }\r\n      }, get : function() {\r\n        return _bg;\r\n      }\r\n    });\r\n\r\n    /*\r\n    Object.defineProperty(ret, \"class\", {\r\n      set(bg) {\r\n        tr.class = bg;\r\n      }\r\n    });//*/\r\n\r\n    ret.cell = () => {\r\n      let container = maketd();\r\n      container.background = tr.style[\"background-color\"];\r\n      return container;\r\n    };\r\n    \r\n    //makefunc(\"cell\");\r\n    makefunc(\"label\");\r\n    makefunc(\"tool\");\r\n    makefunc(\"prop\");\r\n    makefunc(\"pathlabel\");\r\n    makefunc(\"button\");\r\n    makefunc(\"iconbutton\");\r\n    makefunc(\"textbox\");\r\n    makefunc(\"col\");\r\n    makefunc(\"row\");\r\n    makefunc(\"table\");\r\n    makefunc(\"listenum\");\r\n    makefunc(\"check\");\r\n\r\n    return ret;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  clear() {\r\n    super.clear();\r\n    for (let child of list(this.dom.childNodes)) {\r\n      child.remove();\r\n    }\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"tableframe-x\"\r\n  };}\r\n}\r\nUIBase.internalRegister(TableFrame);\r\n\r\n","\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as simple_toolsys from '../path-controller/toolsys/toolsys.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\n\r\nimport {TableFrame} from './ui_table.js';\r\nimport {Container, ColumnFrame, RowFrame} from '../core/ui.js';\r\nimport {keymap} from '../path-controller/util/events.js';\r\n\r\nlet EnumProperty = toolprop.EnumProperty,\r\n    PropTypes    = toolprop.PropTypes;\r\n\r\nlet UIBase     = ui_base.UIBase,\r\n    PackFlags  = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nfunction getpx(css) {\r\n  return parseFloat(css.trim().replace(\"px\", \"\"))\r\n}\r\n\r\nclass ListItem extends RowFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    let highlight = () => {\r\n      //console.log(\"listitem mouseover\");\r\n      this.highlight = true;\r\n      this.setBackground();\r\n    };\r\n\r\n    let unhighlight = () => {\r\n      //console.log(\"listitem mouseleave\");\r\n      this.highlight = false;\r\n      this.setBackground();\r\n    };\r\n\r\n    this.addEventListener(\"mouseover\", highlight);\r\n    this.addEventListener(\"mousein\", highlight);\r\n\r\n    this.addEventListener(\"mouseleave\", unhighlight);\r\n    this.addEventListener(\"mouseout\", unhighlight);\r\n    this.addEventListener(\"blur\", unhighlight);\r\n\r\n    this.addEventListener(\"click\", (e) => {\r\n      //console.log(\"click!\");\r\n      if (this.onclick) {\r\n        this.onclick();\r\n      }\r\n    });\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n      .listitem {\r\n        -moz-user-focus: normal;\r\n        moz-user-focus: normal;\r\n        user-focus: normal;\r\n      }\r\n    `;\r\n\r\n    this.shadowRoot.prepend(style);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"listitem-x\",\r\n      style  : \"listbox\"\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.setAttribute(\"class\", \"listitem\");\r\n\r\n    this.style[\"width\"] = \"100%\";\r\n    this.style[\"height\"] = this.getDefault(\"ItemHeight\") + \"px\";\r\n    this.style[\"flex-grow\"] = \"unset\";\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  setBackground() {\r\n    if (this.highlight && this.is_active) {\r\n      this.background = this.getDefault(\"ListActiveHighlight\");\r\n    } else if (this.highlight) {\r\n      this.background = this.getDefault(\"ListHighlight\");\r\n    } else if (this.is_active) {\r\n      this.background = this.getDefault(\"ListActive\");\r\n    } else {\r\n      this.background = this.getDefault(\"background-color\");\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.setBackground();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ListItem);\r\n\r\nclass ListBox extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.items = [];\r\n    this.idmap = {};\r\n    this.items.active = undefined;\r\n    this.highlight = false;\r\n    this.is_active = false;\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n      .listbox {\r\n        -moz-user-focus: normal;\r\n        moz-user-focus: normal;\r\n        user-focus: normal;\r\n      }\r\n    `;\r\n    this.shadow.prepend(style);\r\n\r\n    this.onkeydown = (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Up\"]:\r\n        case keymap[\"Down\"]:\r\n          if (this.items.length == 0)\r\n            return;\r\n\r\n          if (this.items.active === undefined) {\r\n            this.setActive(this.items[0]);\r\n            return;\r\n          }\r\n\r\n          let i = this.items.indexOf(this.items.active);\r\n          let dir = e.keyCode == keymap[\"Up\"] ? -1 : 1;\r\n\r\n          i = Math.max(Math.min(i + dir, this.items.length - 1), 0);\r\n          this.setActive(this.items[i]);\r\n\r\n          break;\r\n      }\r\n    };\r\n\r\n    //this.addEventListener(\"keydown\", on_keydown);\r\n\r\n    //this._table =  this.table();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"listbox-x\",\r\n      style  : \"listbox\"\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.setCSS();\r\n\r\n    this.style[\"width\"] = this.getDefault(\"width\") + \"px\";\r\n    this.style[\"height\"] = this.getDefault(\"height\") + \"px\";\r\n    this.style[\"overflow\"] = \"scroll\";\r\n\r\n    //this.setAttribute(\"class\", \"listbox\");\r\n    //this.setAttribute(\"tabindex\", 0);\r\n    //this.tabIndex = 0;\r\n  }\r\n\r\n  addItem(name, id) {\r\n    let item = UIBase.createElement(\"listitem-x\");\r\n\r\n    item._id = id === undefined ? this.items.length : id;\r\n    this.idmap[item._id] = item;\r\n\r\n    //item.addEventListener(\"keydown\", this.onkeydown);\r\n    this.tabIndex = 1;\r\n    this.setAttribute(\"tabindex\", 1);\r\n\r\n    this.add(item);\r\n    this.items.push(item);\r\n\r\n    item.label(name);\r\n    let this2 = this;\r\n\r\n    item.onclick = function () {\r\n      this2.setActive(this);\r\n      this.setBackground();\r\n    };\r\n\r\n    return item;\r\n  }\r\n\r\n  removeItem(item) {\r\n    if (typeof item == \"number\") {\r\n      item = this.idmap[item];\r\n    }\r\n\r\n    item.remove();\r\n    delete this.idmap[item._id];\r\n    this.items.remove(item);\r\n  }\r\n\r\n  setActive(item) {\r\n    if (typeof item == \"number\") {\r\n      item = this.idmap[item];\r\n    }\r\n\r\n    //console.log(\"set active!\");\r\n\r\n    if (item === this.items.active) {\r\n      return;\r\n    }\r\n\r\n    if (this.items.active !== undefined) {\r\n      this.items.active.highlight = false;\r\n      this.items.active.is_active = false;\r\n      this.items.active.setBackground();\r\n    }\r\n\r\n    this.items.active = item;\r\n\r\n    if (item) {\r\n      item.is_active = true;\r\n\r\n      item.setBackground();\r\n      item.scrollIntoViewIfNeeded();\r\n    }\r\n\r\n    if (this.onchange) {\r\n      this.onchange(item ? item._id : undefined, item);\r\n    }\r\n  }\r\n\r\n  clear() {\r\n\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ListBox);\r\n","import {UIBase} from '../core/ui_base.js';\r\nimport * as util from '../path-controller/util/util.js';\r\nimport {keymap} from '../path-controller/util/simple_events.js';\r\n\r\nexport class ProgressCircle extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.g = this.canvas.getContext(\"2d\");\r\n\r\n    this.shadow.appendChild(this.canvas);\r\n    this.size = 150;\r\n    this.animreq = undefined;\r\n    this._value = 0.0;\r\n    this.startTime = util.time_ms();\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this.flagRedraw();\r\n    this.update();\r\n\r\n    //enable keyboard focus\r\n    this.tabIndex = 0;\r\n    this.setAttribute(\"tab-index\", 0);\r\n    this.setAttribute(\"tabindex\", 0);\r\n\r\n    let onkey = (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Escape\"]:\r\n          if (this.oncancel) {\r\n            this.oncancel(this);\r\n          }\r\n          break;\r\n      }\r\n    }\r\n\r\n    this.addEventListener(\"keydown\", onkey);\r\n    this.canvas.addEventListener(\"keydown\", onkey);\r\n  }\r\n\r\n  flagRedraw() {\r\n    if (this.animreq !== undefined) {\r\n      return;\r\n    }\r\n\r\n    this.animreq = requestAnimationFrame(() => {\r\n      this.animreq = undefined;\r\n      this.draw();\r\n    })\r\n  }\r\n\r\n  draw() {\r\n    let c = this.canvas, g = this.g;\r\n\r\n    let clr1 = \"rgb(68,69,83)\";\r\n    let clr2 = \"rgb(141,154,196)\";\r\n    let clr3 = \"rgb(214,110,54)\";\r\n\r\n    let t = (util.time_ms() - this.startTime) / 1000.0;\r\n\r\n    g.save();\r\n    g.clearRect(0, 0, c.width, c.height);\r\n\r\n    g.lineWidth /= c.width*0.5;\r\n    g.scale(c.width, c.height);\r\n    g.translate(0.5, 0.5);\r\n\r\n    g.fillStyle = clr2;\r\n    g.strokeStyle = clr1;\r\n\r\n    g.beginPath();\r\n    g.moveTo(0, 0);\r\n    g.arc(0, 0, 0.45, Math.PI, -Math.PI);\r\n    //g.closePath()\r\n\r\n    g.moveTo(0, 0);\r\n    g.arc(0, 0, 0.2, Math.PI, -Math.PI);\r\n    //g.closePath()\r\n\r\n    g.clip(\"evenodd\");\r\n\r\n    g.beginPath();\r\n    g.arc(0, 0, 0.45, -Math.PI, Math.PI);\r\n    g.fill();\r\n    g.stroke();\r\n\r\n    g.beginPath();\r\n    g.arc(0, 0, 0.2, Math.PI, -Math.PI);\r\n    g.stroke();\r\n\r\n    g.beginPath();\r\n\r\n    let th = this._value*Math.PI*2.0;\r\n\r\n    let steps = 12;\r\n    let dth = (Math.PI*2.0) / steps;\r\n    let lwid = g.lineWidth;\r\n    g.lineWidth *= 3;\r\n\r\n    for (let i=0; i<steps; i++) {\r\n      let th1 = i * dth;\r\n      th1 += t;\r\n\r\n      let r1 = 0.2;\r\n      let r2 = 0.45;\r\n      let th2 = th1 + dth*0.5;\r\n\r\n      g.beginPath();\r\n      g.moveTo(Math.cos(th1)*r1, Math.sin(th1)*r1);\r\n      g.lineTo(Math.cos(th2)*r2, Math.sin(th2)*r2);\r\n      g.strokeStyle = \"rgba(255,255,255,0.5)\";\r\n      g.stroke();\r\n    }\r\n\r\n    g.lineWidth = lwid;\r\n\r\n    g.beginPath();\r\n    g.moveTo(0, 0);\r\n    g.arc(0, 0, 0.4, Math.PI, -Math.PI);\r\n    //g.closePath()\r\n\r\n    g.clip(\"evenodd\");\r\n\r\n    g.beginPath();\r\n    g.fillStyle = clr3;\r\n    g.moveTo(0, 0);\r\n    g.arc(0, 0, 0.45, 0, th);\r\n    g.lineTo(0, 0);\r\n    g.fill();\r\n\r\n    g.strokeStyle = \"rgb(141,154,196)\";\r\n    g.stroke();\r\n\r\n    g.restore();\r\n  }\r\n\r\n  set value(percent) {\r\n    this._value = percent;\r\n    this.flagRedraw();\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  startTimer() {\r\n    if (this.timer !== undefined) {\r\n      return;\r\n    }\r\n\r\n    this.focus();\r\n\r\n    window.setInterval(() => {\r\n      if (!this.isConnected) {\r\n        this.endTimer();\r\n        return;\r\n      }\r\n\r\n      this.flagRedraw();\r\n    }, 50);\r\n  }\r\n\r\n  endTimer() {\r\n    if (this.timer !== undefined) {\r\n      window.clearInterval(this.timer);\r\n    }\r\n    this.timer = undefined;\r\n  }\r\n\r\n  update() {\r\n    if (!this.isConnected && this.timer) {\r\n      this.endTimer();\r\n    }\r\n\r\n    let size = ~~(this.size*UIBase.getDPI());\r\n\r\n    if (size !== this.canvas.width) {\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    let c = this.canvas;\r\n\r\n    let size = ~~(this.size*UIBase.getDPI());\r\n\r\n    if (c.width !== size) {\r\n      c.width = c.height = size;\r\n\r\n      size /= UIBase.getDPI();\r\n      c.style[\"width\"] = size + \"px\";\r\n      c.style[\"height\"] = size + \"px\";\r\n\r\n      c.style[\"display\"] = \"flex\";\r\n\r\n      this.style[\"width\"] = size + \"px\";\r\n      this.style[\"height\"] = size + \"px\";\r\n\r\n      //forcibly redraw in this case, do not queue with flagRedraw\r\n      this.draw();\r\n    }\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"align-items\"] = \"center\";\r\n    this.style[\"justify-content\"] = \"center\";\r\n    this.style[\"width\"] = \"100%\";\r\n    this.style[\"height\"] = \"100%\";\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname : \"progress-circle-x\"\r\n    }\r\n  }\r\n}\r\nUIBase.register(ProgressCircle);\r\n","import {PackFlags, UIBase} from \"../core/ui_base.js\";\r\nimport {ColumnFrame} from \"../core/ui.js\";\r\nimport {PropTypes, PropFlags} from \"../path-controller/toolsys/toolprop.js\";\r\n\r\nimport {UndoFlags, ToolFlags} from \"../path-controller/toolsys/toolsys.js\";\r\nimport {DataPath, DataTypes} from \"../path-controller/controller/controller.js\";\r\n\r\nimport {ToolProperty} from '../path-controller/toolsys/toolprop.js';\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport cconst from '../config/const.js';\r\n\r\nconst LastKey = Symbol(\"LastToolPanelId\");\r\nlet tool_idgen = 0;\r\n\r\nexport function getLastToolStruct(ctx) {\r\n  let ret = ctx.state._last_tool;\r\n\r\n  if (!ret) {\r\n    ret = ctx.toolstack.head;\r\n  } else {\r\n    let msg = \"Passing the last tool to last-tool-panel via appstate._last_tool is deprecated;\";\r\n    msg += \"\\nctx.toolstack.head is now used instead.\";\r\n\r\n    console.warn(msg);\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n/*\r\n*\r\n* This panel shows the most recently executed ToolOp's\r\n* settings.  It assumes that recent toolops are accessible\r\n* in ctx.last_tool.\r\n* */\r\nexport class LastToolPanel extends ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this._tool_id = undefined;\r\n    this.useDataPathUndo = false;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.useDataPathUndo = false;\r\n    this.rebuild();\r\n  }\r\n\r\n  /** client code can subclass and override this method */\r\n  getToolStackHead(ctx) {\r\n    //don't process the root toolop\r\n    let bad = ctx.toolstack.length === 0 || ctx.toolstack.cur >= ctx.toolstack.length;\r\n    bad = bad || ctx.toolstack.cur < 0;\r\n    bad = bad || ctx.toolstack[ctx.toolstack.cur].undoflag & UndoFlags.IS_UNDO_ROOT;\r\n\r\n    if (bad) {\r\n      return undefined;\r\n    }\r\n\r\n    return ctx.toolstack[ctx.toolstack.cur];\r\n  }\r\n\r\n  rebuild() {\r\n    let ctx = this.ctx;\r\n    if (ctx === undefined) {\r\n      this._tool_id = -1; //wait for .ctx\r\n      return;\r\n    }\r\n\r\n    this.clear();\r\n\r\n    this.label(\"Recent Command Settings\");\r\n\r\n    let tool = this.getToolStackHead(ctx);\r\n\r\n    if (!tool) {\r\n      this.setCSS();\r\n      return;\r\n    }\r\n\r\n    let def = tool.constructor.tooldef();\r\n    let name = def.uiname !== undefined ? def.uiname : def.name;\r\n\r\n    let panel = this.panel(def.uiname);\r\n\r\n    this.buildTool(ctx, tool, panel);\r\n    this.flushUpdate();\r\n  }\r\n\r\n  /** client code can subclass and override this method */\r\n  buildTool(ctx, tool, panel) {\r\n    let fakecls = {};\r\n    fakecls.constructor = fakecls;\r\n\r\n    //in theory it shouldn't matter if multiple last tool panels\r\n    //override _last_tool, since they all access the same data\r\n    this.ctx.state._last_tool = fakecls;\r\n    let lastkey = tool[LastKey];\r\n\r\n    let getTool = () => {\r\n      let tool = this.ctx.toolstack[this.ctx.toolstack.cur];\r\n      if (!tool || tool[LastKey] !== lastkey) {\r\n        return undefined;\r\n      }\r\n\r\n      return tool;\r\n    };\r\n\r\n    if (tool.flag & ToolFlags.PRIVATE) {\r\n      return;\r\n    }\r\n\r\n    let st = this.ctx.api.mapStruct(fakecls, true);\r\n    let paths = [];\r\n\r\n    function defineProp(k, key) {\r\n      Object.defineProperty(fakecls, key, {\r\n        get : function() {\r\n          let tool = getTool();\r\n          if (tool) {\r\n            if (!tool.inputs[k]) {\r\n              console.error(\"Missing property \" + k, tool);\r\n            }\r\n            return tool.inputs[k].getValue();\r\n          }\r\n        },\r\n\r\n        set : function(val) {\r\n          let tool = getTool();\r\n          if (tool) {\r\n            tool.inputs[k].setValue(val);\r\n            tool.saveDefaultInputs();\r\n\r\n            ctx.toolstack.rerun(tool);\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    for (let k in tool.inputs) {\r\n      let prop = tool.inputs[k];\r\n\r\n      if (prop.flag & (PropFlags.PRIVATE|PropFlags.READ_ONLY)) {\r\n        continue;\r\n      }\r\n\r\n      let uiname = prop.uiname;\r\n      if (!uiname) {\r\n        uiname = ToolProperty.makeUIName(k);\r\n      }\r\n\r\n      prop.uiname = uiname;\r\n      let apikey = k.replace(/[\\t ]/g, \"_\");\r\n\r\n      let dpath = new DataPath(apikey, apikey, prop, DataTypes.PROP);\r\n      st.add(dpath);\r\n\r\n      paths.push(dpath);\r\n\r\n      defineProp(k, apikey);\r\n    }\r\n\r\n    panel.useDataPathUndo = false;\r\n\r\n    for (let dpath of paths) {\r\n      let path = \"last_tool.\" + dpath.path;\r\n\r\n      panel.label(dpath.data.uiname);\r\n      let ret = panel.prop(path, PackFlags.FORCE_ROLLER_SLIDER);\r\n\r\n      if (ret) {\r\n        ret.useDataPathUndo = false;\r\n      }\r\n    }\r\n    this.setCSS();\r\n\r\n    //console.log(\"Building last tool settings\");\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n    let ctx = this.ctx;\r\n\r\n    if (!ctx) {\r\n      return;\r\n    }\r\n\r\n    let tool = this.getToolStackHead(ctx);\r\n\r\n    if (tool && (!(LastKey in tool) || tool[LastKey] !== this._tool_id)) {\r\n      tool[LastKey] = tool_idgen++;\r\n      this._tool_id = tool[LastKey];\r\n\r\n      this.rebuild();\r\n    }\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"last-tool-panel-x\"\r\n  }}\r\n}\r\nUIBase.internalRegister(LastToolPanel);\r\n","import {Vector2} from \"./vectormath.js\";\r\nimport * as math from './math.js';\r\nimport * as util from './util.js';\r\n\r\nexport class Constraint {\r\n  constructor(name, func, klst, params, k=1.0) {\r\n    this.glst = [];\r\n    this.klst = klst;\r\n    this.k = k;\r\n    this.params = params;\r\n    this.name = name;\r\n\r\n    for (let ks of klst) {\r\n      this.glst.push(new Float64Array(ks.length));\r\n    }\r\n\r\n    this.df = 0.0005;\r\n    this.threshold = 0.0001;\r\n    this.func = func;\r\n\r\n    this.funcDv = null;\r\n  }\r\n\r\n  evaluate(no_dvs=false) {\r\n    let r1 = this.func(this.params);\r\n\r\n    if (this.funcDv) {\r\n      this.funcDv(this.params, this.glst);\r\n      return r1;\r\n    }\r\n\r\n    if (Math.abs(r1) < this.threshold)\r\n      return 0.0;\r\n\r\n    let df = this.df;\r\n\r\n    if (no_dvs)\r\n      return r1;\r\n\r\n    for (let i=0; i<this.klst.length; i++) {\r\n      let gs = this.glst[i];\r\n      let ks = this.klst[i];\r\n\r\n      for (let j=0; j<ks.length; j++) {\r\n        let orig = ks[j];\r\n        ks[j] += df;\r\n        let r2 = this.func(this.params);\r\n        ks[j] = orig;\r\n\r\n        gs[j] = (r2 - r1) / df;\r\n      }\r\n    }\r\n\r\n    return r1;\r\n  }\r\n}\r\n\r\nexport class Solver {\r\n  constructor() {\r\n    this.constraints = [];\r\n    this.gk = 0.99;\r\n    this.simple = false;\r\n    this.randCons = false;\r\n\r\n    /** stop when average constraint error falls below this */\r\n    this.threshold = 0.01;\r\n  }\r\n\r\n  add(con) {\r\n    this.constraints.push(con);\r\n  }\r\n\r\n  solveStep(gk=this.gk) {\r\n    let err = 0.0;\r\n\r\n    let cons = this.constraints;\r\n    for (let ci=0; ci<cons.length; ci++ ){\r\n      let ri = ci;\r\n      if (this.randCons) {\r\n        ri = ~~(Math.random()*this.constraints.length*0.99999);\r\n      }\r\n\r\n      let con = cons[ri];\r\n\r\n      let r1 = con.evaluate();\r\n\r\n      if (r1 === 0.0)\r\n        continue;\r\n\r\n      err += Math.abs(r1);\r\n      let totgs = 0.0;\r\n\r\n      for (let i=0; i<con.klst.length; i++) {\r\n        let ks = con.klst[i], gs = con.glst[i];\r\n        for (let j=0; j<ks.length; j++) {\r\n          totgs += gs[j]*gs[j];\r\n        }\r\n      }\r\n\r\n      if (totgs === 0.0)  {\r\n        continue;\r\n      }\r\n\r\n      r1 /= totgs;\r\n\r\n      for (let i=0; i<con.klst.length; i++) {\r\n        let ks = con.klst[i], gs = con.glst[i];\r\n        for (let j=0; j<ks.length; j++) {\r\n          ks[j] += -r1*gs[j]*con.k*gk;\r\n        }\r\n      }\r\n    }\r\n\r\n    return err;\r\n  }\r\n\r\n  solveStepSimple(gk=this.gk) {\r\n    let err = 0.0;\r\n\r\n    let cons = this.constraints;\r\n    for (let ci=0; ci<cons.length; ci++ ){\r\n      let ri = ci;\r\n      if (this.randCons) {\r\n        ri = ~~(Math.random()*this.constraints.length*0.99999);\r\n      }\r\n\r\n      let con = cons[ri];\r\n\r\n      let r1 = con.evaluate();\r\n\r\n      if (r1 === 0.0)\r\n        continue;\r\n\r\n      err += Math.abs(r1);\r\n      let totgs = 0.0;\r\n\r\n      for (let i=0; i<con.klst.length; i++) {\r\n        let ks = con.klst[i], gs = con.glst[i];\r\n        for (let j=0; j<ks.length; j++) {\r\n          totgs += gs[j]*gs[j];\r\n        }\r\n      }\r\n\r\n      if (totgs === 0.0)  {\r\n        continue;\r\n      }\r\n\r\n      totgs = 0.0001 / Math.sqrt(totgs);\r\n\r\n      for (let i=0; i<con.klst.length; i++) {\r\n        let ks = con.klst[i], gs = con.glst[i];\r\n        for (let j=0; j<ks.length; j++) {\r\n          ks[j] += -totgs*gs[j]*con.k*gk;\r\n        }\r\n      }\r\n    }\r\n\r\n    return err;\r\n  }\r\n\r\n  solve(steps, gk=this.gk, printError=false) {\r\n    let err = 0.0;\r\n\r\n    for (let i=0; i<steps; i++) {\r\n      if (this.simple) {\r\n        err = this.solveStepSimple(gk);\r\n      } else {\r\n        err = this.solveStep(gk);\r\n      }\r\n\r\n\r\n      if (printError) {\r\n        console.warn(\"average error:\", (err/this.constraints.length).toFixed(4));\r\n      }\r\n      if (err < this.threshold / this.constraints.length) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return err;\r\n  }\r\n}\r\n","\"use strict\";\r\n\r\nimport {Vector2} from \"./vectormath.js\";\r\nimport * as math from './math.js';\r\nimport * as util from './util.js';\r\n\r\nimport {Constraint, Solver} from './solver.js';\r\n\r\nlet idgen = 0;\r\n\r\nexport class PackNodeVertex extends Vector2 {\r\n  constructor(node, co) {\r\n    super(co);\r\n\r\n    this.node = node;\r\n    this._id = idgen++;\r\n    this.edges = [];\r\n    this._absPos = new Vector2();\r\n  }\r\n\r\n  get absPos() {\r\n    this._absPos.load(this).add(this.node.pos);\r\n    return this._absPos;\r\n  }\r\n\r\n  [Symbol.keystr]() {\r\n    return this._id;\r\n  }\r\n}\r\n\r\nexport class PackNode {\r\n  constructor() {\r\n    this.pos = new Vector2();\r\n    this.vel = new Vector2();\r\n    this.oldpos = new Vector2();\r\n    this._id = idgen++;\r\n    this.size = new Vector2();\r\n    this.verts = [];\r\n  }\r\n\r\n  [Symbol.keystr]() {\r\n    return this._id;\r\n  }\r\n}\r\n\r\nfunction copyGraph(nodes) {\r\n  let ret = [];\r\n  let idmap = {};\r\n\r\n  for (let n of nodes) {\r\n    let n2 = new PackNode();\r\n    n2._id = n._id;\r\n    n2.pos.load(n.pos);\r\n    n2.vel.load(n.vel);\r\n    n2.size.load(n.size);\r\n\r\n    n2.verts = [];\r\n    idmap[n2._id] = n2;\r\n\r\n    for (let v of n.verts) {\r\n      let v2 = new PackNodeVertex(n2, v);\r\n      v2._id = v._id;\r\n      idmap[v2._id] = v2;\r\n\r\n      n2.verts.push(v2);\r\n    }\r\n\r\n    ret.push(n2);\r\n  }\r\n\r\n  for (let n of nodes) {\r\n    for (let v of n.verts) {\r\n      let v2 = idmap[v._id];\r\n\r\n      for (let v3 of v.edges) {\r\n        v2.edges.push(idmap[v3._id]);\r\n      }\r\n    }\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nfunction getCenter(nodes) {\r\n  let cent = new Vector2();\r\n\r\n  for (let n of nodes) {\r\n    cent.add(n.pos);\r\n  }\r\n\r\n  if (nodes.length === 0)\r\n    return cent;\r\n\r\n  cent.mulScalar(1.0 / nodes.length);\r\n\r\n  return cent;\r\n}\r\n\r\nfunction loadGraph(nodes, copy) {\r\n  let idmap = {};\r\n\r\n  for (let i=0; i<nodes.length; i++) {\r\n    nodes[i].pos.load(copy[i].pos);\r\n    nodes[i].oldpos.load(copy[i].oldpos);\r\n    nodes[i].vel.load(copy[i].vel);\r\n  }\r\n}\r\n\r\nexport function graphGetIslands(nodes) {\r\n  let islands = [];\r\n  let visit1 = new util.set();\r\n\r\n  let rec = (n, island) => {\r\n    island.push(n);\r\n    visit1.add(n);\r\n\r\n    for (let v of n.verts) {\r\n      for (let e of v.edges) {\r\n        let n2 = e.node;\r\n        if (n2 !== n && !visit1.has(n2)) {\r\n          rec(n2, island);\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  for (let n of nodes) {\r\n    if (visit1.has(n)) {\r\n      continue;\r\n    }\r\n\r\n    let island = [];\r\n    islands.push(island);\r\n    rec(n, island);\r\n  }\r\n\r\n  return islands;\r\n}\r\n\r\nexport function graphPack(nodes, margin_or_args=15, steps=10, updateCb=undefined) {\r\n  let margin = margin_or_args;\r\n  let speed = 1.0;\r\n\r\n  if (typeof margin === \"object\") {\r\n    let args = margin;\r\n\r\n    margin = args.margin ?? 15;\r\n    steps = args.steps ?? 10;\r\n    updateCb = args.updateCb;\r\n    speed = args.speed ?? 1.0;\r\n  }\r\n\r\n  let orignodes = nodes;\r\n  nodes = copyGraph(nodes);\r\n\r\n  let decay = 1.0;\r\n  let decayi = 0;\r\n\r\n\r\n  let min = new Vector2().addScalar(1e17);\r\n  let max = new Vector2().addScalar(-1e17);\r\n\r\n  let tmp = new Vector2();\r\n  for (let n of nodes) {\r\n    min.min(n.pos);\r\n    tmp.load(n.pos).add(n.size);\r\n    max.max(tmp);\r\n  }\r\n\r\n  let size = new Vector2(max).sub(min);\r\n\r\n  for (let n of nodes) {\r\n    n.pos[0] += (Math.random()-0.5)*5.0/size[0]*speed;\r\n    n.pos[1] += (Math.random()-0.5)*5.0/size[1]*speed;\r\n  }\r\n\r\n  let nodemap = {};\r\n  for (let n of nodes) {\r\n    n.vel.zero();\r\n    nodemap[n._id] = n;\r\n    for (let v of n.verts) {\r\n      nodemap[v._id] = v;\r\n    }\r\n  }\r\n\r\n  let visit = new util.set();\r\n  let verts = new util.set();\r\n  let isect = [];\r\n\r\n  let disableEdges = false;\r\n\r\n  function edge_c(params) {\r\n    let [v1, v2, restlen] = params;\r\n\r\n    if (disableEdges) return 0;\r\n\r\n    return Math.abs(v1.absPos.vectorDistance(v2.absPos) - restlen);\r\n  }\r\n\r\n  let p1 = new Vector2();\r\n  let p2 = new Vector2();\r\n  let s1 = new Vector2();\r\n  let s2 = new Vector2();\r\n\r\n  function loadBoxes(n1, n2, margin1=margin) {\r\n    p1.load(n1.pos);\r\n    p2.load(n2.pos);\r\n    s1.load(n1.size);\r\n    s2.load(n2.size);\r\n\r\n    p1.subScalar(margin1);\r\n    p2.subScalar(margin1);\r\n    s1.addScalar(margin1*2.0);\r\n    s2.addScalar(margin1*2.0);\r\n  }\r\n\r\n  let disableArea = false;\r\n\r\n  function area_c(params) {\r\n    let [n1, n2] = params;\r\n\r\n    if (disableArea)\r\n      return 0.0;\r\n\r\n    loadBoxes(n1, n2);\r\n\r\n    let a1 = n1.size[0]*n1.size[1];\r\n    let a2 = n2.size[0]*n2.size[1];\r\n\r\n    return math.aabb_overlap_area(p1, s1, p2, s2);\r\n    return (math.aabb_overlap_area(p1, s1, p2, s2) / (a1+a2));\r\n  }\r\n\r\n  let lasterr, besterr, best;\r\n  let err;\r\n\r\n  let islands = graphGetIslands(nodes);\r\n  let fakeVerts = [];\r\n  for (let island of islands) {\r\n    let n = island[0];\r\n    let fv = new PackNodeVertex(n);\r\n    fakeVerts.push(fv);\r\n  }\r\n\r\n  let solveStep1 = (gk=1.0) => {\r\n    let solver = new Solver();\r\n\r\n    isect.length = 0;\r\n    visit = new util.set();\r\n\r\n    if (fakeVerts.length > 1) {\r\n      for (let i=1; i<fakeVerts.length; i++) {\r\n        let v1 = fakeVerts[0];\r\n        let v2 = fakeVerts[i];\r\n\r\n        let rlen = 1.0;\r\n\r\n        let con = new Constraint(\"edge_c\", edge_c, [v1.node.pos, v2.node.pos], [v1, v2, rlen]);\r\n        con.k = 0.25;\r\n        solver.add(con);\r\n      }\r\n    }\r\n\r\n    for (let n1 of nodes) {\r\n      for (let v of n1.verts) {\r\n        verts.add(v);\r\n        for (let v2 of v.edges) {\r\n          //hueristic to avoid adding same constraint twice\r\n          if (v2._id < v._id) continue;\r\n\r\n          let rlen = n1.size.vectorLength()*0.0;\r\n\r\n          let con = new Constraint(\"edge_c\", edge_c, [v.node.pos, v2.node.pos], [v, v2, rlen]);\r\n          con.k = 1.0;\r\n          solver.add(con);\r\n        }\r\n      }\r\n\r\n      for (let n2 of nodes) {\r\n        if (n1 === n2) continue;\r\n        let key = Math.min(n1._id, n2._id) + \":\" + Math.max(n1._id, n2._id);\r\n        if (visit.has(key)) continue;\r\n\r\n        loadBoxes(n1, n2);\r\n        let area = math.aabb_overlap_area(p1, s1, p2, s2);\r\n\r\n        if (area > 0.01) {\r\n          let size = decay*(n1.size.vectorLength() + n2.size.vectorLength())*speed;\r\n          //*\r\n          n1.pos[0] += (Math.random() - 0.5)*size;\r\n          n1.pos[1] += (Math.random() - 0.5)*size;\r\n          n2.pos[0] += (Math.random() - 0.5)*size;\r\n          n2.pos[1] += (Math.random() - 0.5)*size;\r\n          //*/\r\n\r\n          isect.push([n1, n2]);\r\n          visit.add(key);\r\n        }\r\n      }\r\n\r\n      for (let [n1, n2] of isect) {\r\n        let con = new Constraint(\"area_c\", area_c, [n1.pos, n2.pos], [n1, n2]);\r\n        solver.add(con);\r\n        con.k = 1.0;\r\n      }\r\n    }\r\n\r\n    return solver;\r\n  };\r\n\r\n  let i = 1;\r\n  let solveStep = (gk=0.5) => {\r\n    let solver = solveStep1();\r\n\r\n    if (i % 40 === 0.0) {\r\n      let c1 = getCenter(nodes);\r\n\r\n      let rfac = 1000.0;\r\n\r\n      if (best) loadGraph(nodes, best);\r\n\r\n      for (let n of nodes) {\r\n        n.pos[0] += (Math.random() - 0.5) * rfac * speed;\r\n        n.pos[1] += (Math.random() - 0.5) * rfac * speed;\r\n        n.vel.zero();\r\n      }\r\n\r\n      let c2 = getCenter(nodes);\r\n      c1.sub(c2);\r\n\r\n      for (let n of nodes) {\r\n        n.pos.add(c1);\r\n      }\r\n    }\r\n\r\n    let err = 1e17;\r\n\r\n    for (let n of nodes) {\r\n      n.oldpos.load(n.pos);\r\n      n.pos.addFac(n.vel, 0.5);\r\n    }\r\n\r\n    disableEdges = false;\r\n    disableArea = true;\r\n    solver.solve(1, gk);\r\n\r\n    //solve so boxes don't overlap\r\n    disableEdges = true;\r\n    disableArea = false;\r\n\r\n    for (let j=0; j<10; j++) {\r\n      solver = solveStep1();\r\n      err = solver.solve(10, gk*speed);\r\n    }\r\n\r\n    for (let n of nodes) {\r\n      n.vel.load(n.pos).sub(n.oldpos);\r\n    }\r\n\r\n    //get error from edge constraints\r\n\r\n    disableEdges = false;\r\n    disableArea = true;\r\n\r\n    err = 0.0;\r\n    for (let con of solver.constraints) {\r\n      err += con.evaluate(true);\r\n    }\r\n\r\n    disableEdges = false;\r\n    disableArea = false;\r\n\r\n    /*\r\n    loadGraph(orignodes, nodes);\r\n    if (updateCb) {\r\n      updateCb();\r\n    }//*/\r\n\r\n    lasterr = err;\r\n\r\n    let add = Math.random()*besterr*Math.exp(-i*0.1);\r\n\r\n    if (besterr === undefined || err < besterr+add) {\r\n      best = copyGraph(nodes);\r\n      besterr = err;\r\n    }\r\n\r\n    i++;\r\n\r\n    return err;\r\n  };\r\n\r\n\r\n  for (let j=0; j<steps; j++) {\r\n    solveStep();\r\n\r\n    decayi++;\r\n    decay = Math.exp(-decayi*0.1);\r\n  }\r\n\r\n  min.zero().addScalar(1e17);\r\n  max.zero().addScalar(-1e17);\r\n\r\n  for (let node of (best ? best : nodes)) {\r\n    min.min(node.pos);\r\n    p2.load(node.pos).add(node.size);\r\n    max.max(p2);\r\n  }\r\n\r\n  for (let node of (best ? best : nodes)) {\r\n    node.pos.sub(min);\r\n  }\r\n\r\n  loadGraph(orignodes, best ? best : nodes);\r\n\r\n  if (updateCb) {\r\n    if (nodes._timer !== undefined) {\r\n      window.clearInterval(nodes._timer);\r\n    }\r\n\r\n    nodes._timer = window.setInterval(() => {\r\n      let time = util.time_ms();\r\n\r\n      while (util.time_ms() - time < 50) {\r\n        let err = solveStep();\r\n      }\r\n\r\n      if (cconst.DEBUG.boxPacker) {\r\n        console.log(\"err\", (besterr / nodes.length).toFixed(2), (lasterr / nodes.length).toFixed(2), \"isects\", isect.length);\r\n      }\r\n\r\n      if (best) loadGraph(orignodes, best);\r\n\r\n      if (updateCb() === false) {\r\n        clearInterval(nodes._timer);\r\n        return;\r\n      }\r\n    }, 100);\r\n\r\n    let timer = nodes._timer;\r\n\r\n    return {\r\n      stop : () => {\r\n        if (best) loadGraph(nodes, best);\r\n\r\n        window.clearInterval(timer);\r\n        nodes._timer = undefined;\r\n      }\r\n    }\r\n  }\r\n}\r\n","/**\r\n see doc_src/context.md\r\n */\r\n\r\nimport * as util from '../util/util.js';\r\n\r\nimport cconst from '../config/config.js';\r\n\r\nlet notifier = undefined;\r\n\r\nexport function setNotifier(cls) {\r\n  notifier = cls;\r\n}\r\n\r\nexport const ContextFlags = {\r\n  IS_VIEW : 1\r\n};\r\n\r\nclass InheritFlag {\r\n  constructor(data) {\r\n    this.data = data;\r\n  }\r\n}\r\n\r\nlet __idgen = 1;\r\n\r\nif (Symbol.ContextID === undefined) {\r\n  Symbol.ContextID = Symbol(\"ContextID\");\r\n}\r\n\r\nif (Symbol.CachedDef === undefined) {\r\n  Symbol.CachedDef = Symbol(\"CachedDef\");\r\n}\r\n\r\nconst _ret_tmp = [undefined];\r\n\r\nexport const OverlayClasses = [];\r\n\r\nexport function makeDerivedOverlay(parent) {\r\n  return class ContextOverlay extends parent {\r\n    constructor(appstate) {\r\n      super(appstate);\r\n\r\n      this.ctx = undefined; //owning context\r\n      this._state = appstate;\r\n    }\r\n\r\n    get state() {\r\n      return this._state;\r\n    }\r\n\r\n    set state(state) {\r\n      this._state = state;\r\n    }\r\n\r\n    /*\r\n    Ugly hack, ui_lasttool.js saves\r\n    a DataStruct wrapping the most recently executed ToolOp\r\n    in this.state._last_tool.\r\n    */\r\n    get last_tool() {\r\n      return this.state._last_tool;\r\n    }\r\n\r\n\r\n    onRemove(have_new_file = false) {\r\n    }\r\n\r\n    copy() {\r\n      return new this.constructor(this._state);\r\n    }\r\n\r\n    validate() {\r\n      throw new Error(\"Implement me!\");\r\n    }\r\n\r\n\r\n    //base classes override this\r\n    static contextDefine() {\r\n      throw new Error(\"implement me!\");\r\n      return {\r\n        name: \"\",\r\n        flag: 0\r\n      }\r\n    }\r\n\r\n    //don't override this\r\n    static resolveDef() {\r\n      if (this.hasOwnProperty(Symbol.CachedDef)) {\r\n        return this[Symbol.CachedDef];\r\n      }\r\n\r\n      let def2 = Symbol.CachedDef = {};\r\n\r\n      let def = this.contextDefine();\r\n\r\n      if (def === undefined) {\r\n        def = {};\r\n      }\r\n\r\n      for (let k in def) {\r\n        def2[k] = def[k];\r\n      }\r\n\r\n      if (!(\"flag\") in def) {\r\n        def2.flag = Context.inherit(0);\r\n      }\r\n\r\n      let parents = [];\r\n      let p = util.getClassParent(this);\r\n\r\n      while (p && p !== ContextOverlay) {\r\n        parents.push(p);\r\n        p = util.getClassParent(p);\r\n      }\r\n\r\n      if (def2.flag instanceof InheritFlag) {\r\n        let flag = def2.flag.data;\r\n        for (let p of parents) {\r\n          let def = p.contextDefine();\r\n\r\n          if (!def.flag) {\r\n            continue;\r\n          } else if (def.flag instanceof InheritFlag) {\r\n            flag |= def.flag.data;\r\n          } else {\r\n            flag |= def.flag;\r\n            //don't go past non-inheritable parents\r\n            break;\r\n          }\r\n        }\r\n\r\n        def2.flag = flag;\r\n      }\r\n\r\n      return def2;\r\n    }\r\n  };\r\n}\r\n\r\nexport const ContextOverlay = makeDerivedOverlay(Object);\r\n\r\nexport const excludedKeys = new Set([\"onRemove\", \"reset\", \"toString\", \"_fix\",\r\n                                     \"valueOf\", \"copy\", \"next\", \"save\", \"load\", \"clear\", \"hasOwnProperty\",\r\n                                     \"toLocaleString\", \"constructor\", \"propertyIsEnumerable\", \"isPrototypeOf\",\r\n                                     \"state\", \"saveProperty\", \"loadProperty\", \"getOwningOverlay\", \"_props\"]);\r\n\r\nexport class LockedContext {\r\n  constructor(ctx, noWarnings) {\r\n    this.props = {};\r\n\r\n    this.state = ctx.state;\r\n    this.api = ctx.api;\r\n    this.toolstack = ctx.toolstack;\r\n\r\n    this.noWarnings = noWarnings;\r\n\r\n    this.load(ctx);\r\n  }\r\n\r\n  toLocked() {\r\n    //just return itself\r\n    return this;\r\n  }\r\n\r\n  error() {\r\n    return this.ctx.error(...arguments);\r\n  }\r\n  warning() {\r\n    return this.ctx.warning(...arguments);\r\n  }\r\n  message() {\r\n    return this.ctx.message(...arguments);\r\n  }\r\n  progbar() {\r\n    return this.ctx.progbar(...arguments);\r\n  }\r\n\r\n  load(ctx) {\r\n    //let keys = util.getAllKeys(ctx);\r\n    let keys = ctx._props;\r\n\r\n    function wrapget(name) {\r\n      return function(ctx2, data) {\r\n        return ctx.loadProperty(ctx2, name, data);\r\n      }\r\n    }\r\n\r\n    for (let k of keys) {\r\n      let v;\r\n      if (k === \"state\" || k === \"toolstack\" || k === \"api\") {\r\n        continue;\r\n      }\r\n\r\n      if (typeof k === \"string\" && (k.endsWith(\"_save\") || k.endsWith(\"_load\"))) {\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        v = ctx[k];\r\n      } catch (error) {\r\n        if (cconst.DEBUG.contextSystem) {\r\n          console.warn(\"failed to look up property in context: \", k);\r\n        }\r\n        continue;\r\n      }\r\n\r\n      let data, getter;\r\n      let overlay = ctx.getOwningOverlay(k);\r\n\r\n      if (overlay === undefined) {\r\n        //property must no longer be used?\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        if (typeof k === \"string\" && (overlay[k + \"_save\"] && overlay[k + \"_load\"])) {\r\n          data = overlay[k + \"_save\"]();\r\n          getter = overlay[k + \"_load\"];\r\n        } else {\r\n          data = ctx.saveProperty(k);\r\n          getter = wrapget(k);\r\n        }\r\n      } catch (error) {\r\n        //util.print_stack(error);\r\n        console.warn(\"Failed to save context property\", k);\r\n        continue;\r\n      }\r\n\r\n      this.props[k] = {\r\n        data : data,\r\n        get  : getter\r\n      };\r\n    }\r\n\r\n    let defineProp = (name) => {\r\n      Object.defineProperty(this, name, {\r\n        get : function() {\r\n          let def = this.props[name];\r\n          return def.get(this.ctx, def.data)\r\n        }\r\n      })\r\n    };\r\n\r\n    for (let k in this.props) {\r\n      defineProp(k);\r\n    }\r\n\r\n    this.ctx = ctx;\r\n  }\r\n\r\n  setContext(ctx) {\r\n    this.ctx = ctx;\r\n\r\n    this.state = ctx.state;\r\n    this.api = ctx.api;\r\n    this.toolstack = ctx.toolstack;\r\n  }\r\n}\r\n\r\nlet next_key = {};\r\nlet idgen = 1;\r\n\r\nexport class Context {\r\n  constructor(appstate) {\r\n    this.state = appstate;\r\n\r\n    this._props = new Set();\r\n    this._stack = [];\r\n    this._inside_map = {};\r\n  }\r\n\r\n  /** chrome's debug console corrupts this._inside_map,\r\n   this method fixes it*/\r\n  _fix() {\r\n    this._inside_map = {};\r\n  }\r\n\r\n  fix() {\r\n    this._fix();\r\n  }\r\n\r\n  error(message, timeout=1500) {\r\n    let state = this.state;\r\n\r\n    console.warn(message);\r\n\r\n    if (state && state.screen) {\r\n      return notifier.error(state.screen, message, timeout);\r\n    }\r\n  }\r\n\r\n  warning(message, timeout=1500) {\r\n    let state = this.state;\r\n\r\n    console.warn(message);\r\n\r\n    if (state && state.screen) {\r\n      return notifier.warning(state.screen, message, timeout);\r\n    }\r\n  }\r\n\r\n  message(msg, timeout=1500) {\r\n    let state = this.state;\r\n\r\n    console.warn(msg);\r\n\r\n    if (state && state.screen) {\r\n      return notifier.message(state.screen, msg, timeout);\r\n    }\r\n  }\r\n\r\n  progbar(msg, perc=0.0, timeout=1500, id=msg) {\r\n    let state = this.state;\r\n\r\n    if (state && state.screen) {\r\n      //progbarNote(screen, msg, percent, color, timeout) {\r\n      return notifier.progbarNote(state.screen, msg, perc, \"green\", timeout, id);\r\n    }\r\n  }\r\n\r\n  validateOverlays() {\r\n    let stack = this._stack;\r\n    let stack2 = [];\r\n\r\n    for (let i=0; i<stack.length; i++) {\r\n      if (stack[i].validate()) {\r\n        stack2.push(stack[i]);\r\n      }\r\n    }\r\n\r\n    this._stack = stack2;\r\n  }\r\n\r\n  hasOverlay(cls) {\r\n    return this.getOverlay(cls) !== undefined;\r\n  }\r\n\r\n  getOverlay(cls) {\r\n    for (let overlay of this._stack) {\r\n      if (overlay.constructor === cls) {\r\n        return overlay;\r\n      }\r\n    }\r\n  }\r\n\r\n  clear(have_new_file=false) {\r\n    for (let overlay of this._stack) {\r\n      overlay.onRemove(have_new_file);\r\n    }\r\n\r\n    this._stack = [];\r\n  }\r\n\r\n  //this is implemented by child classes\r\n  //it should load the same default overlays as in constructor\r\n  reset(have_new_file=false) {\r\n    this.clear(have_new_file);\r\n  }\r\n\r\n  //returns a new context with overriden properties\r\n  //unlike pushOverlay, overrides can be a simple object\r\n  override(overrides) {\r\n    if (overrides.copy === undefined) {\r\n      overrides.copy = function() {\r\n        return Object.assign({}, this);\r\n      }\r\n    }\r\n\r\n    let ctx = this.copy();\r\n    ctx.pushOverlay(overrides);\r\n    return ctx;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new this.constructor(this.state);\r\n\r\n    for (let item of this._stack) {\r\n      ret.pushOverlay(item.copy());\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   Used by overlay property getters.  If returned,\r\n   the next overlay in the struct will have its getter used.\r\n\r\n   Example:\r\n\r\n   class overlay {\r\n      get scene() {\r\n        if (some_reason) {\r\n          return Context.super();\r\n        }\r\n\r\n        return something_else;\r\n      }\r\n    }\r\n   */\r\n  static super() {\r\n    return next_key;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * saves a property into some kind of non-object-reference form\r\n   *\r\n   * */\r\n  saveProperty(key) {\r\n    //console.warn(\"Missing saveProperty implementation in Context; passing through values...\", key)\r\n    return this[key];\r\n  }\r\n\r\n  /**\r\n   *\r\n   * lookup property based on saved data\r\n   *\r\n   * */\r\n  loadProperty(ctx, key, data) {\r\n    //console.warn(\"Missing loadProperty implementation in Context; passing through values...\", key)\r\n    return data;\r\n  }\r\n\r\n  getOwningOverlay(name, _val_out) {\r\n    let inside_map = this._inside_map;\r\n    let stack = this._stack;\r\n\r\n    if (cconst.DEBUG.contextSystem) {\r\n      console.log(name, inside_map);\r\n    }\r\n\r\n    for (let i=stack.length-1; i >= 0; i--) {\r\n      let overlay = stack[i];\r\n      let ret = next_key;\r\n\r\n      if (overlay[Symbol.ContextID] === undefined) {\r\n        throw new Error(\"context corruption\");\r\n      }\r\n\r\n      let ikey = overlay[Symbol.ContextID];\r\n\r\n      if (cconst.DEBUG.contextSystem) {\r\n        console.log(ikey, overlay);\r\n      }\r\n\r\n      //prevent infinite recursion\r\n      if (inside_map[ikey]) {\r\n        continue;\r\n      }\r\n\r\n      if (overlay.__allKeys.has(name)) {\r\n        if (cconst.DEBUG.contextSystem) {\r\n          console.log(\"getting value\");\r\n        }\r\n\r\n        //Chrome's console messes this up\r\n\r\n        inside_map[ikey] = 1;\r\n\r\n        try {\r\n          ret = overlay[name];\r\n        } catch (error) {\r\n\r\n          inside_map[ikey] = 0;\r\n          throw error;\r\n        }\r\n\r\n        inside_map[ikey] = 0;\r\n      }\r\n\r\n      if (ret !== next_key) {\r\n        if (_val_out !== undefined) {\r\n          _val_out[0] = ret;\r\n        }\r\n        return overlay;\r\n      }\r\n    }\r\n\r\n    if (_val_out !== undefined) {\r\n      _val_out[0] = undefined;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  ensureProperty(name) {\r\n    if (this.hasOwnProperty(name)) {\r\n      return;\r\n    }\r\n\r\n    this._props.add(name);\r\n\r\n    Object.defineProperty(this, name, {\r\n      get : function() {\r\n        let ret = _ret_tmp;\r\n        _ret_tmp[0] = undefined;\r\n\r\n        this.getOwningOverlay(name, ret);\r\n        return ret[0];\r\n      }, set : function() {\r\n        throw new Error(\"Cannot set ctx properties\")\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Returns a new context that doesn't\r\n   * contain any direct object references\r\n   * except for .state .datalib and .api, but\r\n   * instead uses those three to look up references\r\n   * on property access.\r\n   * */\r\n  toLocked() {\r\n    return new LockedContext(this);\r\n  }\r\n\r\n  pushOverlay(overlay) {\r\n    if (!overlay.hasOwnProperty(Symbol.ContextID)) {\r\n      overlay[Symbol.ContextID] = idgen++;\r\n    }\r\n\r\n    let keys = new Set();\r\n    for (let key of util.getAllKeys(overlay)) {\r\n      if (!excludedKeys.has(key) && !(typeof key === \"string\" && key[0] === \"_\")) {\r\n        keys.add(key);\r\n      }\r\n    }\r\n\r\n    overlay.ctx = this;\r\n\r\n    if (overlay.__allKeys === undefined) {\r\n      overlay.__allKeys = keys;\r\n    }\r\n\r\n    for (let k of keys) {\r\n      let bad = typeof k === \"symbol\" || excludedKeys.has(k);\r\n      bad = bad || (typeof k === \"string\" && k[0] === \"_\");\r\n      bad = bad || (typeof k === \"string\" && k.endsWith(\"_save\"));\r\n      bad = bad || (typeof k === \"string\" && k.endsWith(\"_load\"));\r\n\r\n      if (bad) {\r\n        continue;\r\n      }\r\n\r\n      this.ensureProperty(k);\r\n    }\r\n\r\n    if (this._stack.indexOf(overlay) >= 0) {\r\n      console.warn(\"Overlay already added once\");\r\n      if (this._stack[this._stack.length-1] === overlay) {\r\n        console.warn(\"  Definitely an error, overlay is already at top of stack\");\r\n        return;\r\n      }\r\n    }\r\n\r\n    this._stack.push(overlay);\r\n  }\r\n\r\n  popOverlay(overlay) {\r\n    if (overlay !== this._stack[this._stack.length-1]) {\r\n      console.warn(\"Context.popOverlay called in error\", overlay);\r\n      return;\r\n    }\r\n\r\n    overlay.onRemove();\r\n    this._stack.pop();\r\n  }\r\n\r\n  removeOverlay(overlay) {\r\n    if (this._stack.indexOf(overlay) < 0) {\r\n      console.warn(\"Context.removeOverlay called in error\", overlay);\r\n      return;\r\n    }\r\n\r\n    overlay.onRemove();\r\n    this._stack.remove(overlay);\r\n  }\r\n\r\n  static inherit(data) {\r\n    return new InheritFlag(data);\r\n  }\r\n\r\n  static register(cls) {\r\n    if (cls[Symbol.ContextID]) {\r\n      console.warn(\"Tried to register same class twice:\", cls);\r\n      return;\r\n    }\r\n\r\n    cls[Symbol.ContextID] = __idgen++;\r\n    OverlayClasses.push(cls);\r\n  }\r\n}\r\n\r\nexport function test() {\r\n  function testInheritance() {\r\n    class Test0 extends ContextOverlay {\r\n      static contextDefine() {\r\n        return {\r\n          flag: 1\r\n        }\r\n      }\r\n    }\r\n\r\n    class Test1 extends Test0 {\r\n      static contextDefine() {\r\n        return {\r\n          flag: 2\r\n        }\r\n      }\r\n    }\r\n\r\n    class Test2 extends Test1 {\r\n      static contextDefine() {\r\n        return {\r\n          flag: Context.inherit(4)\r\n        }\r\n      }\r\n    }\r\n\r\n    class Test3 extends Test2 {\r\n      static contextDefine() {\r\n        return {\r\n          flag: Context.inherit(8)\r\n        }\r\n      }\r\n    }\r\n\r\n    class Test4 extends Test3 {\r\n      static contextDefine() {\r\n        return {\r\n          flag: Context.inherit(16)\r\n        }\r\n      }\r\n    }\r\n\r\n    return Test4.resolveDef().flag === 30;\r\n  }\r\n\r\n  return testInheritance();\r\n}\r\n\r\nif (!test()) {\r\n  throw new Error(\"Context test failed\");\r\n}\r\n","export const mimeMap = {\r\n  \".js\"  : \"application/javascript\",\r\n  \".json\": \"text/json\",\r\n  \".html\": \"text/html\",\r\n  \".txt\" : \"text/plain\",\r\n  \".jpg\" : \"image/jpeg\",\r\n  \".png\" : \"image/png\",\r\n  \".tiff\": \"image/tiff\",\r\n  \".gif\" : \"image/gif\",\r\n  \".bmp\" : \"image/bitmap\",\r\n  \".tga\" : \"image/targa\",\r\n  \".svg\" : \"image/svg+xml\",\r\n  \".xml\" : \"text/xml\",\r\n  \".webp\": \"image/webp\",\r\n  \"svg\"  : \"image/svg+xml\",\r\n  \"txt\"  : \"text/plain\",\r\n  \"html\" : \"text/html\",\r\n  \"css\"  : \"text/css\",\r\n  \"ts\"   : \"application/typescript\",\r\n  \"py\"   : \"application/python\",\r\n  \"c\"    : \"application/c\",\r\n  \"cpp\"  : \"application/cpp\",\r\n  \"cc\"   : \"application/cpp\",\r\n  \"h\"    : \"application/c\",\r\n  \"hh\"   : \"application/cpp\",\r\n  \"hpp\"  : \"application/cpp\",\r\n  \"sh\"   : \"application/bash\",\r\n  \"mjs\"  : \"application/javascript\",\r\n  \"cjs\"  : \"application/javascript\",\r\n  \"gif\"  : \"image/gif\"\r\n};\r\n\r\nexport var textMimes = new Set([\r\n  \"application/javascript\", \"application/x-javscript\",\r\n  \"image/svg+xml\", \"application/xml\"\r\n]);\r\n\r\nexport function isMimeText(mime) {\r\n  if (!mime) {\r\n    return false;\r\n  }\r\n\r\n  if (mime.startsWith(\"text\")) {\r\n    return true;\r\n  }\r\n\r\n  return textMimes.has(mime);\r\n}\r\n\r\nexport function getExtension(path) {\r\n  if (!path) {\r\n    return \"\";\r\n  }\r\n\r\n  let i = path.length;\r\n  while (i > 0 && path[i] !== \".\") {\r\n    i--;\r\n  }\r\n\r\n  return path.slice(i, path.length).trim().toLowerCase();\r\n}\r\n\r\nexport function getMime(path) {\r\n  let ext = getExtension(path);\r\n  if (ext in mimeMap) {\r\n    return mimeMap[ext];\r\n  }\r\n\r\n  return \"application/x-octet-stream\";\r\n}\r\n\r\nexport class PlatformAPI {\r\n  static writeFile(data, handle, mime) {\r\n    throw new Error(\"implement me\");\r\n    //returns a promise\r\n  }\r\n\r\n  static resolveURL(path, base = location.href) {\r\n    base = base.trim();\r\n\r\n    if (path.startsWith(\"./\")) {\r\n      path = path.slice(2, path.length).trim();\r\n    }\r\n\r\n    while (path.startsWith(\"/\")) {\r\n      path = path.slice(1, path.length).trim();\r\n    }\r\n\r\n    while (base.endsWith(\"/\")) {\r\n      base = base.slice(0, base.length - 1).trim();\r\n    }\r\n\r\n    let exts = [\"html\", \"txt\", \"js\", \"php\", \"cgi\"]\r\n    for (let ext of exts) {\r\n      ext = \".\" + ext;\r\n      if (base.endsWith(ext)) {\r\n        let i = base.length - 1;\r\n        while (i > 0 && base[i] !== \"/\") {\r\n          i--;\r\n        }\r\n\r\n        base = base.slice(0, i).trim();\r\n      }\r\n    }\r\n\r\n    while (base.endsWith(\"/\")) {\r\n      base = base.slice(0, base.length - 1).trim();\r\n    }\r\n\r\n    path = (base + \"/\" + path).split(\"/\")\r\n    let path2 = [];\r\n\r\n    for (let i = 0; i < path.length; i++) {\r\n      if (path[i] === \"..\") {\r\n        path2.pop();\r\n      } else {\r\n        path2.push(path[i]);\r\n      }\r\n    }\r\n\r\n    return path2.join(\"/\");\r\n  }\r\n\r\n  //returns a promise that resolves to a FilePath that can be used for re-saving.\r\n  static showOpenDialog(title, args = new FileDialogArgs()) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  //returns a promise\r\n  static showSaveDialog(title, savedata_cb, args = new FileDialogArgs()) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  //returns a promise.  if mime is a text type, a string will be fed to the promise,\r\n  //otherwise it will be an ArrayBuffer\r\n  static readFile(path, mime) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n}\r\n\r\nexport class FileDialogArgs {\r\n  constructor() {\r\n    this.multi = false; //allow selecting multiple files\r\n    this.addToRecentList = false; //update recent file list\r\n\r\n    /* example for filters:\r\n    [{\r\n      name : \"Images\",\r\n      mime : \"image/png\"\r\n      extensions : \"[\"png\", \"jpg\"]\r\n    }]\r\n    * */\r\n    this.filters = []\r\n  }\r\n}\r\n\r\n/*a file path, some platforms may not return real payhs*/\r\nexport class FilePath {\r\n  constructor(data, filename = \"unnamed\") {\r\n    this.data = data;\r\n    this.filename = filename;\r\n  }\r\n}\r\n","let promise;\r\n\r\nif (window.haveElectron) {\r\n  promise = import('./electron/electron_api.js');\r\n} else {\r\n  promise = import('./web/web_api.js');\r\n}\r\n\r\nexport var platform;\r\n\r\npromise.then((module) => {\r\n  platform = module.platform;\r\n  promise = undefined;\r\n});\r\n\r\nexport function getPlatformAsync() {\r\n  if (promise) {\r\n    return new Promise((accept, reject) => {\r\n      promise.then(mod => {\r\n        accept(mod.platform);\r\n      });\r\n    });\r\n  }\r\n\r\n  return new Promise((accept, reject) => {\r\n    accept(platform);\r\n  })\r\n}\r\n","\"use strict\";\r\n\r\nfunction getElectronVersion() {\r\n  let key = navigator.userAgent;\r\n  let i = key.search(\"Electron\");\r\n  key = key.slice(i + 9, key.length);\r\n\r\n  i = key.search(/[ \\t]/);\r\n  if (i >= 0) {\r\n    key = key.slice(0, i);\r\n  }\r\n\r\n  key = key.trim();\r\n  key = key.split(\".\").map(f => parseInt(f));\r\n\r\n  return key;\r\n}\r\n\r\n/*\r\n* wrap require to keep angular from auto-importing\r\n* this api in browsers\r\n* */\r\nfunction getElectron() {\r\n  return require('electron');\r\n}\r\n\r\nfunction myRequire(mod) {\r\n  return globalThis.require(mod);\r\n}\r\n\r\nimport {Menu, DropBox} from '../../widgets/ui_menu.js';\r\nimport {getIconManager} from \"../../core/ui_base.js\";\r\nimport cconst from \"../../config/const.js\";\r\nimport * as util from '../../util/util.js';\r\n\r\nimport {FileDialogArgs, FilePath} from '../platform_base.js';\r\n\r\nfunction getFilename(path) {\r\n  let filename = path.replace(/\\\\/g, \"/\");\r\n  let i = filename.length - 1;\r\n  while (i >= 0 && filename[i] !== \"/\") {\r\n    i--;\r\n  }\r\n\r\n  if (filename[i] === \"/\") {\r\n    i++;\r\n  }\r\n\r\n  if (i > 0) {\r\n    filename = filename.slice(i, filename.length).trim();\r\n  }\r\n\r\n  return filename;\r\n}\r\n\r\nlet _menu_init = false;\r\nlet _init = false;\r\n\r\nimport {mimeMap} from '../platform_base.js';\r\n\r\nlet electron_menu_idgen = 1;\r\nlet ipcRenderer;\r\n\r\nexport class ElectronMenu extends Array {\r\n  constructor(args = {}) {\r\n    super();\r\n\r\n    this._ipcId = electron_menu_idgen++;\r\n\r\n    for (let k in args) {\r\n      this[k] = args[k];\r\n    }\r\n  }\r\n\r\n  insert(i, item) {\r\n    this.length++;\r\n\r\n    let j = this.length-1;\r\n    while (j > i) {\r\n      this[j] = this[j-1];\r\n      j--;\r\n    }\r\n    this[i] = item;\r\n\r\n    return this;\r\n  }\r\n\r\n  static setApplicationMenu(menu) {\r\n    initElectronIpc();\r\n\r\n    ipcRenderer.invoke(\"set-menu-bar\", menu);\r\n  }\r\n\r\n  closePopup() {\r\n    ipcRenderer.invoke(\"close-menu\", this._ipcId);\r\n  }\r\n\r\n  append(item) {\r\n    this.push(item);\r\n  }\r\n\r\n  popup(args) {\r\n    let {x, y, callback} = args;\r\n\r\n    callback = wrapRemoteCallback(\"popup_menu_click\", callback);\r\n\r\n    const {ipcRenderer} = require('electron')\r\n    ipcRenderer.invoke(\"popup-menu\", this, x, y, callback);\r\n  }\r\n}\r\n\r\nlet callbacks = {};\r\nlet keybase = 1;\r\n\r\nexport function wrapRemoteCallback(key, callback) {\r\n  key = \"remote_\" + key + (keybase++);\r\n  callbacks[key] = callback;\r\n\r\n  return key;\r\n}\r\n\r\nlet ipcInit = false;\r\n\r\nfunction initElectronIpc() {\r\n  if (ipcInit) {\r\n    return;\r\n  }\r\n\r\n  ipcInit = true;\r\n  ipcRenderer = require('electron').ipcRenderer;\r\n\r\n  ipcRenderer.on('invoke-menu-callback', (event, key, args) => {\r\n    //console.error(\"Electron menu callback\", key, args);\r\n    callbacks[key].apply(undefined, args);\r\n  });\r\n}\r\n\r\n\r\nexport class ElectronMenuItem {\r\n  constructor(args) {\r\n    for (let k in args) {\r\n      this[k] = args[k];\r\n    }\r\n\r\n    if (this.click) {\r\n      this.click = wrapRemoteCallback(\"menu_click\", this.click);\r\n    }\r\n  }\r\n}\r\n\r\nfunction patchDropBox() {\r\n  initElectronIpc();\r\n\r\n  //haveElectron = false;\r\n  //return;\r\n  DropBox.prototype._onpress = function _onpress(e) {\r\n    if (this._menu !== undefined) {\r\n      this._menu.close();\r\n      this._menu = undefined;\r\n      this._pressed = false;\r\n      this._redraw();\r\n      return;\r\n    }\r\n\r\n    this._build_menu();\r\n\r\n    let emenu = buildElectronMenu(this._menu);\r\n\r\n    this._menu.close = () => {\r\n      emenu.closePopup(); //getCurrentWindow);\r\n    };\r\n\r\n    //console.log(\"menu dropbox click\", this._menu);\r\n\r\n    if (this._menu === undefined) {\r\n      return;\r\n    }\r\n\r\n    this._menu._dropbox = this;\r\n    this.dom._background = this.getDefault(\"BoxDepressed\");\r\n    this._background = this.getDefault(\"BoxDepressed\");\r\n    this._redraw();\r\n    this._pressed = true;\r\n    this.setCSS();\r\n\r\n    let onclose = this._menu.onclose;\r\n    this._menu.onclose = () => {\r\n      this._pressed = false;\r\n      this._redraw();\r\n\r\n      let menu = this._menu;\r\n      if (menu) {\r\n        this._menu = undefined;\r\n        menu._dropbox = undefined;\r\n      }\r\n\r\n      if (onclose) {\r\n        onclose.call(menu);\r\n      }\r\n    }\r\n\r\n    let menu = this._menu;\r\n    let screen = this.getScreen();\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let x = e.x, y = e.y;\r\n    let rects = this.dom.getClientRects();\r\n\r\n    x = rects[0].x;\r\n    y = rects[0].y + Math.ceil(rects[0].height);\r\n\r\n    x = ~~x;\r\n    y = ~~y;\r\n\r\n    emenu.popup({\r\n      x       : x,\r\n      y       : y,\r\n      callback: () => {\r\n\r\n        if (this._menu) {\r\n          this._menu.onclose();\r\n        }\r\n      }\r\n    })\r\n  };\r\n}\r\n\r\nlet on_tick = () => {\r\n  let nativeTheme = getElectron().remote.nativeTheme;\r\n\r\n  let mode = nativeTheme.shouldUseDarkColors ? \"dark\" : \"light\";\r\n\r\n  if (mode !== cconst.colorSchemeType) {\r\n    nativeTheme.themeSource = cconst.colorSchemeType;\r\n  }\r\n}\r\n\r\nexport function checkInit() {\r\n  if (window.haveElectron && !_init) {\r\n    _init = true;\r\n\r\n\r\n    patchDropBox();\r\n    setInterval(on_tick, 350);\r\n  }\r\n}\r\n\r\nexport let iconcache = {};\r\n\r\nfunction makeIconKey(icon, iconsheet, invertColors) {\r\n  return \"\" + icon + \":\" + iconsheet + \":\" + invertColors;\r\n}\r\n\r\nexport function getNativeIcon(icon, iconsheet = 0, invertColors = false, size = 16) {\r\n  //let key = makeIconKey(icon, iconsheet, invertColors);\r\n  //if (key in iconcache) {\r\n  //  return iconcache[key];\r\n  //}\r\n\r\n  let icongen;\r\n\r\n  try {\r\n    icongen = myRequire(\"./icogen.js\");\r\n  } catch (error) {\r\n    icongen = myRequire(\"./icogen.cjs\");\r\n  }\r\n\r\n\r\n  window.icongen = icongen;\r\n  let nativeImage = getElectron().nativeImage;\r\n\r\n  let manager = getIconManager();\r\n  let sheet = manager.findSheet(iconsheet);\r\n  let images = [];\r\n\r\n  let sizes = icongen.GetRequiredICOImageSizes();\r\n\r\n  //for (let size of sizes) {\r\n  if (1) {\r\n    let iconsheet = manager.findClosestSheet(size);\r\n    let tilesize = manager.getTileSize(iconsheet);\r\n\r\n    let canvas = document.createElement(\"canvas\");\r\n    let g = canvas.getContext(\"2d\");\r\n\r\n    canvas.width = canvas.height = size;\r\n\r\n    if (invertColors) {\r\n      g.filter = \"invert(100%)\";\r\n    }\r\n\r\n    let scale = size/tilesize;\r\n    g.scale(scale, scale);\r\n\r\n    manager.canvasDraw({getDPI: () => 1.0}, canvas, g, icon, 0, 0, iconsheet);\r\n\r\n    let header = \"data:image/png;base64,\";\r\n    let data = canvas.toDataURL();\r\n\r\n    data = data.slice(header.length, data.length);\r\n    data = Buffer.from(data, \"base64\");\r\n\r\n    myRequire(\"fs\").writeFileSync(\"./myicon2.png\", data);\r\n\r\n    images.push(data);\r\n  }\r\n  //}\r\n\r\n  //let ico = icongen.GenerateICO(images);\r\n  //icon = nativeImage.createFromBuffer(ico);\r\n  //icon = nativeImage.createFromBitmap(ico);\r\n  //myRequire(\"fs\").writeFileSync(\"myicon2.ico\", ico);\r\n  return \"myicon2.png\"\r\n  return icon;\r\n  return undefined\r\n\r\n  window._icon = icon;\r\n  return icon;\r\n}\r\n\r\nlet map = {\r\n  CTRL   : \"Control\",\r\n  ALT    : \"Alt\",\r\n  SHIFT  : \"Shift\",\r\n  COMMAND: \"Command\"\r\n};\r\n\r\nexport function buildElectronHotkey(hk) {\r\n  hk = hk.trim().replace(/[ \\t-]+/g, \"+\");\r\n  for (let k in map) {\r\n    hk = hk.replace(k, map[k]);\r\n  }\r\n\r\n  return hk;\r\n}\r\n\r\nexport function buildElectronMenu(menu) {\r\n  let electron = getElectron().remote;\r\n\r\n  initElectronIpc();\r\n\r\n  //let ElectronMenu = electron.Menu;\r\n  //let ElectronMenuItem = electron.MenuItem;\r\n\r\n  let emenu = new ElectronMenu();\r\n\r\n  let buildItem = (item) => {\r\n    if (item._isMenu) {\r\n      let menu2 = item._menu;\r\n\r\n      return new ElectronMenuItem({\r\n        submenu: buildElectronMenu(item._menu),\r\n        label  : menu2.getAttribute(\"title\")\r\n      });\r\n    }\r\n\r\n\r\n    let hotkey = item.hotkey;\r\n    let icon = item.icon;\r\n    let label = \"\" + item.label;\r\n\r\n    if (hotkey && typeof hotkey !== \"string\") {\r\n      hotkey = buildElectronHotkey(hotkey);\r\n    } else {\r\n      hotkey = \"\" + hotkey;\r\n    }\r\n\r\n    if (icon < 0) {\r\n      icon = undefined;\r\n    }\r\n\r\n    let args = {\r\n      id                 : \"\" + item._id,\r\n      label              : label,\r\n      accelerator        : hotkey,\r\n      icon               : icon ? getNativeIcon(icon) : undefined,\r\n      click              : function () {\r\n        menu.onselect(item._id);\r\n      },\r\n      registerAccelerator: false\r\n    };\r\n\r\n    return new ElectronMenuItem(args);\r\n  }\r\n\r\n  for (let item of menu.items) {\r\n    //buildItem(item);\r\n    emenu.append(buildItem(item));\r\n\r\n  }\r\n\r\n  return emenu;\r\n}\r\n\r\nexport function initMenuBar(menuEditor, override = false) {\r\n  checkInit();\r\n\r\n  if (!window.haveElectron) {\r\n    return;\r\n  }\r\n\r\n  if (_menu_init && !override) {\r\n    return;\r\n  }\r\n\r\n  _menu_init = true;\r\n\r\n  let electron = getElectron().remote;\r\n\r\n  //let win = electron.getCurrentWindow();\r\n\r\n  let menu = new ElectronMenu();\r\n\r\n  let _roles = new Set([\"undo\", \"redo\", \"cut\", \"copy\", \"paste\", \"delete\", \"about\",\r\n                        \"quit\", \"open\", \"save\", \"load\", \"paste\", \"cut\", \"zoom\"]);\r\n  let roles = {};\r\n  for (let k of _roles) {\r\n    roles[k] = k;\r\n  }\r\n\r\n  roles = Object.assign(roles, {\r\n    \"select all\": \"selectAll\",\r\n    \"file\"      : \"fileMenu\",\r\n    \"edit\"      : \"editMenu\",\r\n    \"view\"      : \"viewMenu\",\r\n    \"app\"       : \"appMenu\",\r\n    \"help\"      : \"help\",\r\n    \"zoom in\"   : \"zoomIn\",\r\n    \"zoom out\"  : \"zoomOut\"\r\n  });\r\n\r\n  /*\r\n  let item = new MenuItem({\r\n    label : \"Label\",\r\n    tooltip : \"Tooltip\",\r\n    icon : getNativeIcon(0),\r\n    accelerator : \"Control+Z\",\r\n    checked : true,\r\n    id : 0,\r\n    role : undefined,\r\n    click : (arg) => {\r\n      console.log(\"menu click!\", arg)\r\n    },\r\n    submenu : undefined,\r\n    role :  undo, redo, cut, copy, paste, pasteAndMatchStyle, delete, selectAll, reload,\r\n            forceReload, toggleDevTools, resetZoom, zoomIn, zoomOut, togglefullscreen, window,\r\n             minimize, close, help, about, services, hide, hideOthers, unhide, quit, startSpeaking,\r\n             stopSpeaking, close, minimize, zoom, front, appMenu, fileMenu, editMenu, viewMenu, recentDocuments,\r\n              toggleTabBar, selectNextTab, selectPreviousTab, mergeAllWindows, clearRecentDocuments, moveTabToNewWindow\r\n               or windowMenu - Define the action of the menu item, when specified the click property will be ignored.\r\n                See roles.\r\n\r\n  });//*/\r\n\r\n\r\n  let header = menuEditor.header;\r\n  for (let dbox of header.traverse(DropBox)) {\r\n    dbox._build_menu();\r\n    dbox.update();\r\n\r\n    dbox._build_menu();\r\n    let menu2 = dbox._menu;\r\n    menu2.ctx = dbox.ctx;\r\n    menu2._init();\r\n    menu2.update();\r\n\r\n    let title = dbox._genLabel();\r\n    let args = {\r\n      label  : title,\r\n      tooltip: dbox.description,\r\n      submenu: buildElectronMenu(menu2)\r\n    };\r\n\r\n    menu.insert(0, new ElectronMenuItem(args));\r\n  }\r\n\r\n\r\n  ElectronMenu.setApplicationMenu(menu);\r\n  //win.setMenu(menu);\r\n}\r\n\r\nimport {PlatformAPI, isMimeText} from '../platform_base.js';\r\n\r\nexport class platform extends PlatformAPI {\r\n  static showOpenDialog(title, args = new FileDialogArgs()) {\r\n    const {dialog} = require('electron').remote\r\n\r\n    console.log(args.filters);\r\n\r\n    let eargs = {\r\n      defaultPath: args.defaultPath,\r\n      filters    : this._sanitizeFilters(args.filters ?? []),\r\n      properties : [\r\n        \"openFile\", \"showHiddenFiles\", \"createDirectory\"\r\n      ]\r\n    }\r\n\r\n    if (args.multi) {\r\n      eargs.properties.push(\"multiSelections\");\r\n    }\r\n\r\n    if (!args.addToRecentList) {\r\n      eargs.properties.push(\"dontAddToRecent\");\r\n    }\r\n\r\n    initElectronIpc();\r\n\r\n    return new Promise((accept, reject) => {\r\n      ipcRenderer.invoke('show-open-dialog', eargs, wrapRemoteCallback(\"open-dialog\", (ret) => {\r\n        if (ret.canceled || ret.cancelled) {\r\n          reject(\"cancel\");\r\n        } else {\r\n          accept(ret.filePaths.map(f => new FilePath(f, getFilename(f))));\r\n        }\r\n      }), wrapRemoteCallback(\"show-open-dialog\", (error) => {\r\n        reject(error);\r\n      }));\r\n    });\r\n  }\r\n\r\n  static _sanitizeFilters(filters) {\r\n    let filters2 = [];\r\n\r\n    for (let filter of filters) {\r\n      if (Array.isArray(filter)) {\r\n        let ext = filter[0];\r\n\r\n        filter = {extensions: filter};\r\n\r\n        ext = ext.replace(/\\./g, \"\").trim().toLowerCase();\r\n        if (ext in mimeMap) {\r\n          filter.mime = mimeMap[ext];\r\n        }\r\n\r\n        filter.name = ext;\r\n      }\r\n\r\n      console.log(filter.extensions);\r\n      filter.extensions = filter.extensions.map(f => f.startsWith(\".\") ? f.slice(1, f.length) : f);\r\n\r\n      filters2.push(filter);\r\n    }\r\n\r\n    return filters2;\r\n  }\r\n\r\n  static showSaveDialog(title, filedata_cb, args = new FileDialogArgs()) {\r\n    const {dialog} = require('electron').remote\r\n\r\n    console.log(args.filters);\r\n\r\n    let eargs = {\r\n      defaultPath: args.defaultPath,\r\n      filters    : this._sanitizeFilters(args.filters ?? []),\r\n      properties : [\r\n        \"openFile\", \"showHiddenFiles\", \"createDirectory\"\r\n      ]\r\n    }\r\n\r\n    if (args.multi) {\r\n      eargs.properties.push(\"multiSelections\");\r\n    }\r\n\r\n    if (!args.addToRecentList) {\r\n      eargs.properties.push(\"dontAddToRecent\");\r\n    }\r\n\r\n    return new Promise((accept, reject) => {\r\n      initElectronIpc();\r\n\r\n      let onthen = (ret) => {\r\n        if (ret.canceled) {\r\n          reject(\"cancel\");\r\n        } else {\r\n          let path = ret.filePath;\r\n          let filedata = filedata_cb();\r\n\r\n          if (filedata instanceof ArrayBuffer) {\r\n            filedata = new Uint8Array(filedata);\r\n          }\r\n\r\n          require('fs').writeFileSync(path, filedata);\r\n          console.log(\"saved file\", filedata);\r\n\r\n          accept(new FilePath(path, getFilename(path)));\r\n        }\r\n      }\r\n\r\n      let oncatch = (error) => {\r\n        reject(error);\r\n      }\r\n\r\n      ipcRenderer.invoke('show-save-dialog', eargs, wrapRemoteCallback('dialog', onthen), wrapRemoteCallback('dialog', oncatch));\r\n\r\n    });\r\n  }\r\n\r\n  static readFile(path, mime) {\r\n    return new Promise((accept, reject) => {\r\n      let fs = require('fs');\r\n\r\n      if (isMimeText(mime)) {\r\n        accept(fs.readFileSync(path.data, \"utf8\"));\r\n      } else {\r\n        accept(fs.readFileSync(path.data).buffer);\r\n      }\r\n    });\r\n  }\r\n\r\n  static writeFile(data, handle, mime) {\r\n    return new Promise((accept, reject) => {\r\n      let fs = require('fs');\r\n\r\n      fs.writeFileSync(handle.data, data);\r\n      accept(handle);\r\n    });\r\n  }\r\n}\r\n","\"use strict\";\r\nexport const SVG_URL = 'http://www.w3.org/2000/svg';\r\n\r\nimport * as util from './util.js';\r\nimport * as vectormath from './vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as ui from '../core/ui.js';\r\nimport * as math from './math.js';\r\n\r\nconst Vector2 = vectormath.Vector2;\r\n\r\nexport class CanvasOverdraw extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.shadow.appendChild(this.canvas);\r\n    this.g = this.canvas.getContext(\"2d\");\r\n\r\n    this.screen = undefined;\r\n    this.shapes = [];\r\n    this.otherChildren = []; //non-svg elements\r\n    this.font = undefined;\r\n\r\n    let style = document.createElement(\"style\")\r\n    style.textContent = `\r\n      .overdrawx {\r\n        pointer-events : none;\r\n      }\r\n    `;\r\n\r\n    this.shadow.appendChild(style);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname : 'screen-overdraw-canvas-x'\r\n    }\r\n  }\r\n\r\n  startNode(node, screen) {\r\n    if (screen) {\r\n      this.screen = screen;\r\n      this.ctx = screen.ctx;\r\n    }\r\n\r\n    if (!this.parentNode) {\r\n      node.appendChild(this);\r\n    }\r\n\r\n    this.style[\"display\"] = \"float\";\r\n    this.style[\"z-index\"] = this.zindex_base;\r\n\r\n    this.style[\"position\"] = \"absolute\";\r\n    this.style[\"left\"] = \"0px\";\r\n    this.style[\"top\"] = \"0px\";\r\n\r\n    this.style[\"width\"] = \"100%\" //screen.size[0] + \"px\";\r\n    this.style[\"height\"] = \"100%\" //screen.size[1] + \"px\";\r\n\r\n    this.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.svg = document.createElementNS(SVG_URL, \"svg\");\r\n    this.svg.style[\"width\"] = \"100%\";\r\n    this.svg.style[\"height\"] = \"100%\";\r\n\r\n    this.svg.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.shadow.appendChild(this.svg);\r\n    //this.style[\"background-color\"] = \"green\";\r\n  }\r\n\r\n  start(screen) {\r\n    this.screen = screen;\r\n    this.ctx = screen.ctx;\r\n\r\n    screen.parentNode.appendChild(this);\r\n\r\n    this.style[\"display\"] = \"float\";\r\n    this.style[\"z-index\"] = this.zindex_base;\r\n\r\n    this.style[\"position\"] = \"absolute\";\r\n    this.style[\"left\"] = \"0px\";\r\n    this.style[\"top\"] = \"0px\";\r\n\r\n    this.style[\"width\"] = screen.size[0] + \"px\";\r\n    this.style[\"height\"] = screen.size[1] + \"px\";\r\n\r\n    this.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.svg = document.createElementNS(SVG_URL, \"svg\");\r\n    this.svg.style[\"width\"] = \"100%\";\r\n    this.svg.style[\"height\"] = \"100%\";\r\n\r\n    this.shadow.appendChild(this.svg);\r\n\r\n    //this.style[\"background-color\"] = \"green\";\r\n  }\r\n}\r\n\r\nexport class Overdraw extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.visibleToPick = false;\r\n\r\n    this.screen = undefined;\r\n    this.shapes = [];\r\n    this.otherChildren = []; //non-svg elements\r\n    this.font = undefined;\r\n\r\n    let style = document.createElement(\"style\")\r\n    style.textContent = `\r\n      .overdrawx {\r\n        pointer-events : none;\r\n      }\r\n    `;\r\n\r\n    this.shadow.appendChild(style);\r\n\r\n    this.zindex_base = 1000;\r\n  }\r\n\r\n  startNode(node, screen) {\r\n    if (screen) {\r\n      this.screen = screen;\r\n      this.ctx = screen.ctx;\r\n    }\r\n\r\n    if (!this.parentNode) {\r\n      node.appendChild(this);\r\n    }\r\n\r\n    this.style[\"z-index\"] = this.zindex_base;\r\n\r\n    this.style[\"position\"] = \"relative\";\r\n    //this.style[\"left\"] = \"0px\";\r\n    //this.style[\"top\"] = \"0px\";\r\n    this.style[\"margin\"] = this.style[\"padding\"] = \"0px\";\r\n\r\n    this.style[\"width\"] = \"100%\" //screen.size[0] + \"px\";\r\n    this.style[\"height\"] = \"100%\" //screen.size[1] + \"px\";\r\n\r\n    this.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.svg = document.createElementNS(SVG_URL, \"svg\");\r\n    this.svg.style[\"width\"] = \"100%\";\r\n    this.svg.style[\"height\"] = \"100%\";\r\n\r\n    this.svg.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.shadow.appendChild(this.svg);\r\n    //this.style[\"background-color\"] = \"green\";\r\n  }\r\n\r\n  start(screen) {\r\n    this.screen = screen;\r\n    this.ctx = screen.ctx;\r\n\r\n    screen.parentNode.appendChild(this);\r\n\r\n    this.style[\"display\"] = \"float\";\r\n    this.style[\"z-index\"] = this.zindex_base;\r\n\r\n    this.style[\"position\"] = \"absolute\";\r\n    this.style[\"left\"] = \"0px\";\r\n    this.style[\"top\"] = \"0px\";\r\n\r\n    this.style[\"width\"] = screen.size[0] + \"px\";\r\n    this.style[\"height\"] = screen.size[1] + \"px\";\r\n\r\n    this.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.svg = document.createElementNS(SVG_URL, \"svg\");\r\n    this.svg.style[\"width\"] = \"100%\";\r\n    this.svg.style[\"height\"] = \"100%\";\r\n\r\n    this.shadow.appendChild(this.svg);\r\n\r\n    //this.style[\"background-color\"] = \"green\";\r\n  }\r\n\r\n  clear() {\r\n    for (let child of util.list(this.svg.childNodes)) {\r\n      child.remove();\r\n    }\r\n\r\n    for (let child of this.otherChildren) {\r\n      child.remove();\r\n    }\r\n\r\n    this.otherChildren.length = 0;\r\n  }\r\n\r\n  drawTextBubbles(texts, cos, colors) {\r\n    let boxes = [];\r\n    let elems = [];\r\n\r\n    let cent = new Vector2();\r\n\r\n    for (let i=0; i<texts.length; i++) {\r\n      let co = cos[i];\r\n      let text = texts[i];\r\n      let color;\r\n\r\n      if (colors !== undefined) {\r\n        color = colors[i];\r\n      }\r\n\r\n      cent.add(co);\r\n      let box = this.text(texts[i], co[0], co[1], {color : color});\r\n\r\n      boxes.push(box);\r\n      let font = box.style[\"font\"];\r\n      let pat = /[0-9]+px/;\r\n      let size = font.match(pat)[0];\r\n\r\n      //console.log(\"size\", size);\r\n\r\n      if (size === undefined) {\r\n        size = this.getDefault(\"DefaultText\").size;\r\n      } else {\r\n        size = ui_base.parsepx(size);\r\n      }\r\n\r\n      //console.log(size);\r\n      let tsize = ui_base.measureTextBlock(this, text, undefined, undefined, size, font);\r\n\r\n      box.minsize = [\r\n        ~~tsize.width,\r\n        ~~tsize.height\r\n      ];\r\n\r\n      let pad = ui_base.parsepx(box.style[\"padding\"]);\r\n\r\n      box.minsize[0] += pad*2;\r\n      box.minsize[1] += pad*2;\r\n\r\n      let x = ui_base.parsepx(box.style[\"left\"]);\r\n      let y = ui_base.parsepx(box.style[\"top\"]);\r\n\r\n      box.grads = new Array(4);\r\n      box.params = [x, y, box.minsize[0], box.minsize[1]];\r\n      box.startpos = new Vector2([x, y]);\r\n\r\n      box.setCSS = function() {\r\n        this.style[\"padding\"] = \"0px\";\r\n        this.style[\"margin\"] = \"0px\";\r\n        this.style[\"left\"] = ~~this.params[0] + \"px\";\r\n        this.style[\"top\"] = ~~this.params[1] + \"px\";\r\n        this.style[\"width\"] = ~~this.params[2] + \"px\";\r\n        this.style[\"height\"] = ~~this.params[3] + \"px\";\r\n      };\r\n\r\n      box.setCSS();\r\n      //console.log(box.params);\r\n      elems.push(box);\r\n    }\r\n\r\n    if (boxes.length === 0) {\r\n      return;\r\n    }\r\n\r\n    cent.mulScalar(1.0 / boxes.length);\r\n\r\n    function error() {\r\n      let p1 = [0, 0], p2 = [0, 0];\r\n      let s1 = [0, 0], s2 = [0, 0];\r\n\r\n      let ret = 0.0;\r\n\r\n      for (let box1 of boxes) {\r\n        for (let box2 of boxes) {\r\n          if (box2 === box1) {\r\n            continue;\r\n          }\r\n\r\n          s1[0] = box1.params[2];\r\n          s1[1] = box1.params[3];\r\n          s2[0] = box2.params[2];\r\n          s2[1] = box2.params[3];\r\n\r\n          let overlap = math.aabb_overlap_area(box1.params, s1, box2.params, s2);\r\n          ret += overlap;\r\n        }\r\n\r\n        ret += box1.startpos.vectorDistance(box1.params)*0.25;\r\n      }\r\n\r\n      return ret;\r\n    }\r\n\r\n    function solve() {\r\n      //console.log(\"ERROR\", error());\r\n      let r1 = error();\r\n      if (r1 === 0.0) {\r\n        return;\r\n      }\r\n\r\n      let df = 0.0001;\r\n      let totgs = 0.0;\r\n\r\n      for (let box of boxes) {\r\n        for (let i=0; i<box.params.length; i++) {\r\n          let orig = box.params[i];\r\n          box.params[i] += df;\r\n          let r2 = error();\r\n          box.params[i] = orig;\r\n\r\n          box.grads[i] = (r2 - r1) / df;\r\n          totgs += box.grads[i]**2;\r\n        }\r\n      }\r\n\r\n      if (totgs === 0.0) {\r\n        return;\r\n      }\r\n\r\n      r1 /= totgs;\r\n      let k = 0.4;\r\n\r\n      for (let box of boxes) {\r\n        for (let i = 0; i < box.params.length; i++) {\r\n          box.params[i] += -r1*box.grads[i]*k;\r\n        }\r\n\r\n        box.params[2] = Math.max(box.params[2], box.minsize[0]);\r\n        box.params[3] = Math.max(box.params[3], box.minsize[1]);\r\n\r\n        box.setCSS();\r\n      }\r\n    }\r\n\r\n    for (let i=0; i<15; i++) {\r\n      solve();\r\n    }\r\n\r\n    for (let box of boxes) {\r\n      elems.push(this.line(box.startpos, box.params));\r\n    }\r\n\r\n    return elems;\r\n  }\r\n\r\n  text(text, x, y, args={}) {\r\n    args = Object.assign({}, args);\r\n\r\n    if (args.font === undefined) {\r\n      if (this.font !== undefined)\r\n        args.font = this.font;\r\n      else\r\n        args.font = this.getDefault(\"DefaultText\").genCSS();\r\n    }\r\n\r\n    if (!args[\"background-color\"]) {\r\n      args[\"background-color\"] = \"rgba(75, 75, 75, 0.75)\";\r\n    }\r\n\r\n    args.color = args.color ? args.color : \"white\";\r\n    if (typeof args.color === \"object\") {\r\n      args.color = ui_base.color2css(args.color);\r\n    }\r\n\r\n    args[\"padding\"] = args[\"padding\"] === undefined ? \"5px\" : args[\"padding\"];\r\n    args[\"border-color\"] = args[\"border-color\"] ? args[\"border-color\"] : \"grey\";\r\n    args[\"border-radius\"] = args[\"border-radius\"] ? args[\"border-radius\"] : \"25px\";\r\n    args[\"border-width\"] = args[\"border-width\"] !== undefined ? args[\"border-width\"] : \"2px\";\r\n\r\n    if (typeof args[\"border-width\"] === \"number\") {\r\n      args[\"border-width\"] = \"\" + args[\"border-width\"] + \"px\";\r\n    }\r\n    if (typeof args[\"border-radius\"] === \"number\") {\r\n      args[\"border-radius\"] = \"\" + args[\"border-radius\"] + \"px\";\r\n    }\r\n\r\n    //not sure I need SVG for this. . .\r\n    let box = document.createElement(\"div\")\r\n\r\n    box.setAttribute(\"class\", \"overdrawx\");\r\n\r\n    box.style[\"position\"] = \"fixed\";\r\n    box.style[\"width\"] = \"min-contents\";\r\n    box.style[\"height\"] = \"min-contents\";\r\n    box.style[\"border-width\"] = args[\"border-width\"]\r\n    box.style[\"border-radius\"] = \"25px\";\r\n    box.style[\"pointer-events\"] = \"none\";\r\n    box.style[\"z-index\"] = this.zindex_base + 1;\r\n    box.style[\"background-color\"] = args[\"background-color\"];\r\n    box.style[\"padding\"] = args[\"padding\"];\r\n\r\n    box.style[\"left\"] = x + \"px\";\r\n    box.style[\"top\"] = y + \"px\";\r\n\r\n    box.style[\"display\"] = \"flex\";\r\n    box.style[\"justify-content\"] = \"center\";\r\n    box.style[\"align-items\"] = \"center\";\r\n\r\n    box.innerText = text;\r\n    box.style[\"font\"] = args.font;\r\n    box.style[\"color\"] = args.color;\r\n\r\n    this.otherChildren.push(box);\r\n    this.shadow.appendChild(box);\r\n\r\n    return box;\r\n  }\r\n\r\n  circle(p, r, stroke=\"black\", fill=\"none\") {\r\n    let circle = document.createElementNS(SVG_URL, \"circle\");\r\n    circle.setAttribute(\"cx\", p[0]);\r\n    circle.setAttribute(\"cy\", p[1]);\r\n    circle.setAttribute(\"r\", r);\r\n\r\n    if (fill) {\r\n      circle.setAttribute(\"style\", `stroke:${stroke};stroke-width:2;fill:${fill}`);\r\n    } else {\r\n      circle.setAttribute(\"style\", `stroke:${stroke};stroke-width:2`);\r\n    }\r\n\r\n    this.svg.appendChild(circle);\r\n\r\n    return circle;\r\n  }\r\n\r\n  line(v1, v2, color=\"black\") {\r\n    let line = document.createElementNS(SVG_URL, \"line\");\r\n    line.setAttribute(\"x1\", v1[0]);\r\n    line.setAttribute(\"y1\", v1[1]);\r\n    line.setAttribute(\"x2\", v2[0]);\r\n    line.setAttribute(\"y2\", v2[1]);\r\n    line.setAttribute(\"style\", `stroke:${color};stroke-width:2`);\r\n\r\n    this.svg.appendChild(line);\r\n    return line;\r\n  }\r\n\r\n  rect(p, size, color=\"black\") {\r\n    let line = document.createElementNS(SVG_URL, \"rect\");\r\n    line.setAttribute(\"x\", p[0]);\r\n    line.setAttribute(\"y\", p[1]);\r\n    line.setAttribute(\"width\", size[0]);\r\n    line.setAttribute(\"height\", size[1]);\r\n    line.setAttribute(\"style\", `fill:${color};stroke-width:2`);\r\n\r\n    line.setColor = (color) => {\r\n      line.setAttribute(\"style\", `fill:${color};stroke-width:2`);\r\n    };\r\n\r\n    this.svg.appendChild(line);\r\n    return line;\r\n  }\r\n\r\n  end() {\r\n    this.clear();\r\n    this.remove();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"overdraw-x\",\r\n    style   : \"overdraw\"\r\n  };}\r\n}\r\n\r\nui_base.UIBase.internalRegister(Overdraw);\r\n","import '../util/ScreenOverdraw.js';\r\nimport {UIBase, Icons} from '../core/ui_base.js';\r\nimport {Container} from '../core/ui.js';\r\nimport {pushModalLight, popModalLight, keymap} from '../path-controller/util/simple_events.js';\r\nimport {parsepx} from '../core/ui_theme.js';\r\nimport {Vector2} from '../path-controller/util/vectormath.js';\r\nimport * as math from '../path-controller/util/math.js';\r\n\r\nexport class TreeItem extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.treeParent = undefined;\r\n    this.treeChildren = [];\r\n    this.treeView = undefined;\r\n    this.treeDepth = 0;\r\n\r\n    this.header = this.row();\r\n\r\n    this._icon1 = this.header.iconbutton(Icons.TREE_COLLAPSE);\r\n    this._icon1.iconsheet = 0;\r\n    this._icon1.drawButtonBG = false;\r\n\r\n    this._icon2 = undefined;\r\n\r\n    this._icon1.onclick = () => {\r\n      if (this.opened) {\r\n        this.close();\r\n      }  else {\r\n        this.open();\r\n      }\r\n    }\r\n\r\n    this.opened = true;\r\n\r\n    this._label = this.header.label(\"unlabeled\");\r\n    this._labelText = \"unlabeled\";\r\n  }\r\n\r\n  set icon(id) {\r\n    if (this._icon2) {\r\n      this._icon2 = id;\r\n    } else {\r\n      this._icon2 = UIBase.createElement(\"icon-label-x\");\r\n      this._icon2.icon = id;\r\n      this._icon2.iconsheet = 0;\r\n\r\n\r\n      this.header.insert(1, this._icon2);\r\n    }\r\n  }\r\n\r\n  get icon() {\r\n    if (this._icon2)\r\n      return this._icon2.icon;\r\n    else\r\n      return -1;\r\n  }\r\n\r\n  open() {\r\n    this._icon1.icon = Icons.TREE_COLLAPSE;\r\n    this.opened = true;\r\n    this.treeView._open(this);\r\n  }\r\n\r\n  close() {\r\n    this._icon1.icon = Icons.TREE_EXPAND;\r\n    this.opened = false;\r\n    this.treeView._close(this);\r\n  }\r\n\r\n  set text(b) {\r\n    if (typeof b === \"string\") {\r\n      this._label.text = b;\r\n      this._labelText = b;\r\n    } else if (b instanceof HTMLElement) {\r\n      this._label.remove();\r\n      this.header.add(b);\r\n\r\n      this._label = b;\r\n      this._labelText = b;\r\n    }\r\n  }\r\n\r\n  get text() {\r\n    return this._labelText;\r\n  }\r\n\r\n\r\n  item(name, args={}) {\r\n    args.treeParent = this;\r\n    return this.parentWidget.item(name, args);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"tree-item-x\",\r\n    style   : \"treeview\"\r\n  }}\r\n}\r\nUIBase.internalRegister(TreeItem);\r\n\r\nexport class TreeView extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.items = [];\r\n    this.strokes = [];\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-direction\"] = \"column\";\r\n\r\n    //this.shadow.appendChild(this.overdraw);\r\n\r\n    this.overdraw = UIBase.createElement(\"overdraw-x\");\r\n    console.log(this.overdraw.startNode);\r\n    this.overdraw.startNode(this);\r\n\r\n    this.style[\"margin\"] = this.style[\"padding\"] = \"0px\";\r\n\r\n    this.updateOverdraw();\r\n  }\r\n\r\n  _forAllChildren(item, cb) {\r\n    let visit = (n) => {\r\n      cb(n);\r\n\r\n      for (let c of n.treeChildren) {\r\n        visit(c);\r\n      }\r\n    }\r\n\r\n    for (let c of item.treeChildren) {\r\n      visit(c);\r\n    }\r\n  }\r\n\r\n  _open(item) {\r\n    this._forAllChildren(item, (c) => {\r\n      if (c.opened) {\r\n        c.unhide();\r\n      }\r\n    })\r\n\r\n    this._makeStrokes();\r\n  }\r\n\r\n  _close(item) {\r\n    this._forAllChildren(item, (c) => {\r\n      c.hide();\r\n    })\r\n\r\n    this._makeStrokes();\r\n  }\r\n\r\n  _makeStrokes() {\r\n    if (!this.overdraw) {\r\n      //this.doOnce(this._makeStrokes);\r\n      return;\r\n    }\r\n\r\n    for (let elem of this.strokes) {\r\n      elem.remove();\r\n    }\r\n    this.strokes.length = 0;\r\n\r\n    let hidden = (item) => {\r\n      return item.hidden;\r\n      let p = item;\r\n\r\n      while (p) {\r\n        if (!p.opened)\r\n          return true;\r\n        p = p.treeParent;\r\n      }\r\n\r\n      return false;\r\n    }\r\n\r\n    let items = this.items;\r\n    if (items.length == 0) {\r\n      return;\r\n    }\r\n\r\n    this.overdraw.clear();\r\n\r\n    let next = (i) => {\r\n      i++;\r\n\r\n      while (i < items.length && hidden(items[i])) {\r\n        i++;\r\n        continue;\r\n      }\r\n\r\n      return i;\r\n    }\r\n\r\n    let i = 0;\r\n    if (hidden(items[i]))\r\n      i = next(i);\r\n\r\n    let origin = this.overdraw.getBoundingClientRect();\r\n    let overdraw = this.overdraw;\r\n\r\n    let line = function(x1, y1, x2, y2) {\r\n      let ox = origin.x, oy = origin.y;\r\n\r\n      x1 -= ox; y1 -= oy;\r\n      x2 -= ox; y2 -= oy;\r\n\r\n      overdraw.line([x1, y1], [x2, y2]);\r\n    }\r\n\r\n    console.log(\"making lines\", i);\r\n\r\n    let indent = this.getDefault(\"itemIndent\");\r\n    let rowh = this.getDefault(\"rowHeight\");\r\n\r\n    let getx = (depth) => {\r\n      return (depth+2.2)*indent + origin.x;\r\n    }\r\n\r\n    this.overdraw.style[\"z-index\"] = \"0\";\r\n\r\n    let prev = undefined;\r\n\r\n    for (; i<items.length; i = next(i)) {\r\n      let item = this.items[i];\r\n      let item2 = next(i);\r\n      item2 = item2 < items.length ? items[item2] : undefined;\r\n\r\n      let r = item._icon1.getBoundingClientRect();\r\n\r\n      if (!r) continue;\r\n\r\n      let x1 = getx(item.treeDepth);\r\n      let y1 = origin.y + (i+1)*rowh - rowh*0.25;\r\n\r\n\r\n      if (item2 && item2.treeDepth > item.treeDepth) {//} && (!prev || prev.treeDepth !== item.treeDepth)) {\r\n        let y2 = y1 + rowh*0.75;\r\n\r\n        line(x1, y1, x1, y2)\r\n        line(x1, y2, getx(item2.treeDepth)-3, y2);\r\n\r\n      } else if (item2 && item2.treeDepth === item.treeDepth) {\r\n        line(x1, y1, x1, y1+rowh*0.5)\r\n      }\r\n\r\n      prev = item;\r\n    }\r\n  }\r\n\r\n  updateOverdraw() {\r\n    let mm = new math.MinMax(2);\r\n    let ok = false;\r\n\r\n    for (let item of this.items) {\r\n      if (item.hidden) {\r\n        //continue;\r\n      }\r\n\r\n      for (let r of item.getClientRects()) {\r\n        //console.log(r.y);\r\n        mm.minmax([r.x, r.y]);\r\n        mm.minmax([r.x+r.width, r.y+r.height]);\r\n        ok = true;\r\n      }\r\n    }\r\n\r\n    if (!ok) {\r\n      return;\r\n    }\r\n\r\n    let r = this.getClientRects()[0];\r\n    if (!r) return;\r\n\r\n    let x = r.left;\r\n    let y = r.top;// - r.y;\r\n\r\n    let od = this.overdraw;\r\n    let w = mm.max[0] - mm.min[0];\r\n    let h = mm.max[1] - mm.min[1];\r\n\r\n    od.style[\"margin\"] = \"0px\";\r\n    od.style[\"padding\"] = \"0px\";\r\n    od.svg.style[\"margin\"] = \"0px\";\r\n\r\n    od.style[\"position\"] = UIBase.PositionKey;\r\n\r\n    od.style[\"width\"] = (r.width-1) + \"px\";\r\n    od.style[\"height\"] = (r.height-1) + \"px\";\r\n\r\n    od.style[\"left\"] = x + \"px\";\r\n    od.style[\"top\"] =  y + \"px\";\r\n\r\n    //od.style[\"background-color\"] = \"rgba(50, 50, 50, 0.25)\";\r\n    //od.svg.style[\"background-color\"] = \"rgba(50, 50, 50, 0.25)\";\r\n\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateOverdraw();\r\n  }\r\n\r\n  item(name, args={icon : undefined}) {\r\n    let ret = UIBase.createElement(\"tree-item-x\");\r\n    this.add(ret);\r\n    ret._init();\r\n\r\n    ret.text = name;\r\n\r\n    if (args.icon) {\r\n      ret.icon = args.icon;\r\n    }\r\n\r\n    ret.treeParent = args.treeParent;\r\n    ret.treeView = this;\r\n\r\n    //ret.style[\"margin-bottom\"] = ret.style[\"margin-top\"] = \"0px\";\r\n    //ret.style[\"padding-bottom\"] = ret.style[\"padding-top\"] = \"0px\";\r\n    ret.style[\"max-height\"] = this.getDefault(\"rowHeight\") + \"px\";\r\n\r\n    if (ret.treeParent) {\r\n      ret.treeParent.treeChildren.push(ret);\r\n      ret.treeDepth = ret.treeParent.treeDepth + 1;\r\n    }\r\n\r\n    let p = ret.treeParent;\r\n    let i = 1;\r\n    while (p) {\r\n      p = p.treeParent;\r\n      i++;\r\n    }\r\n\r\n    ret.style[\"margin-left\"] = (i*this.getDefault(\"itemIndent\")) + \"px\";\r\n    this.items.push(ret);\r\n\r\n    this.doOnce(() => {\r\n      this._makeStrokes();\r\n    });\r\n\r\n    return ret;\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"tree-view-x\",\r\n    style   : \"treeview\"\r\n  }}\r\n}\r\nUIBase.internalRegister(TreeView);\r\n\r\n","import {UIBase, Icons} from '../core/ui_base.js';\r\nimport {Container} from '../core/ui.js';\r\nimport {pushModalLight, popModalLight, keymap} from '../path-controller/util/simple_events.js';\r\nimport {parsepx} from '../core/ui_theme.js';\r\n\r\nfunction startDrag(box) {\r\n  if (box._modal) {\r\n    popModalLight(box._modal);\r\n    box._modal = undefined;\r\n    return;\r\n  }\r\n\r\n  let first = true;\r\n  let lastx = 0;\r\n  let lasty = 0;\r\n\r\n  let handlers = {\r\n    on_mousemove(e) {\r\n      let x = e.x, y = e.y;\r\n\r\n      if (first) {\r\n        lastx = x;\r\n        lasty = y;\r\n        first = false;\r\n\r\n        return;\r\n      }\r\n\r\n      let dx = x - lastx;\r\n      let dy = y - lasty;\r\n\r\n      let hx = parsepx(box.style[\"left\"]);\r\n      let hy = parsepx(box.style[\"top\"]);\r\n\r\n      hx += dx;\r\n      hy += dy;\r\n\r\n      console.log(hx, hy);\r\n\r\n      box.style[\"left\"] = hx + \"px\";\r\n      box.style[\"top\"] = hy + \"px\";\r\n\r\n      lastx = x;\r\n      lasty = y;\r\n    },\r\n\r\n    end() {\r\n      if (box._modal) {\r\n        popModalLight(box._modal);\r\n        box._modal = undefined;\r\n      }\r\n    },\r\n\r\n    on_mouseup(e) {\r\n      this.end();\r\n    },\r\n\r\n    on_keydown(e) {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Escape\"]:\r\n        case keymap[\"Return\"]:\r\n          this.end();\r\n          break;\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  box._modal = pushModalLight(handlers);\r\n}\r\n\r\nexport class DragBox extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this._done = false;\r\n    this.header = UIBase.createElement(\"rowframe-x\");\r\n    this.contents = UIBase.createElement(\"container-x\");\r\n\r\n    this.header.style[\"border-radius\"] = \"20px\";\r\n\r\n    this.header.parentWidget = this;\r\n    this.contents.parentWidget = this;\r\n\r\n    this.shadow.appendChild(this.header);\r\n    this.shadow.appendChild(this.contents);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    let header = this.header;\r\n\r\n    header.ctx = this.ctx;\r\n    this.contents.ctx = this.ctx;\r\n    header._init();\r\n    this.contents._init();\r\n\r\n    this.style[\"min-width\"] = \"350px\";\r\n    header.style[\"height\"] = \"35px\";\r\n\r\n    let icon = header.iconbutton(Icons.DELETE, \"Hide\", () => {\r\n      this.end();\r\n    });\r\n    icon.iconsheet = 0; //use small icons\r\n\r\n    this.addEventListener(\"mousedown\", (e) => {\r\n      console.log(\"start drag\");\r\n      startDrag(this);\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n\r\n    }, {capture : false})\r\n\r\n    header.background = this.getDefault(\"background-color\");\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  add() {\r\n    return this.contents.add(...arguments);\r\n  }\r\n\r\n  prepend(n) {\r\n    return this.contents.prepend(n);\r\n  }\r\n\r\n  appendChild(n) {\r\n    return this.contents.appendChild(n);\r\n  }\r\n  col() {\r\n    return this.contents.col(...arguments);\r\n  }\r\n\r\n  row() {\r\n    return this.contents.row(...arguments);\r\n  }\r\n\r\n  strip() {\r\n    return this.contents.strip(...arguments);\r\n  }\r\n  button() {\r\n    return this.contents.button(...arguments);\r\n  }\r\n  iconbutton() {\r\n    return this.contents.iconbutton(...arguments);\r\n  }\r\n  iconcheck() {\r\n    return this.contents.iconcheck(...arguments);\r\n  }\r\n  tool() {\r\n    return this.contents.tool(...arguments);\r\n  }\r\n  menu() {\r\n    return this.contents.menu(...arguments);\r\n  }\r\n  prop() {\r\n    return this.contents.prop(...arguments);\r\n  }\r\n  listenum() {\r\n    return this.contents.listenum(...arguments);\r\n  }\r\n  check() {\r\n    return this.contents.check(...arguments);\r\n  }\r\n  iconenum() {\r\n    return this.contents.iconenum(...arguments);\r\n  }\r\n  slider() {\r\n    return this.contents.slider(...arguments);\r\n  }\r\n  simpleslider() {\r\n    return this.contents.simpleslider(...arguments);\r\n  }\r\n  curve() {\r\n    return this.contents.curve(...arguments);\r\n  }\r\n  textbox() {\r\n    return this.contents.textbox(...arguments);\r\n  }\r\n  textarea() {\r\n    return this.contents.textarea(...arguments);\r\n  }\r\n  viewer() {\r\n    return this.contents.viewer(...arguments);\r\n  }\r\n  panel() {\r\n    return this.contents.panel(...arguments);\r\n  }\r\n  tabs() {\r\n    return this.contents.tabs(...arguments);\r\n  }\r\n  table() {\r\n    return this.contents.table(...arguments);\r\n  }\r\n\r\n\r\n  end() {\r\n    if (this._done) {\r\n      return;\r\n    }\r\n    this.remove();\r\n\r\n    if (this._onend) {\r\n      this._onend();\r\n    }\r\n\r\n    if (this.onend) {\r\n      this.onend();\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.background = this.getDefault(\"background-color\");\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"drag-box-x\",\r\n    style   : \"panel\"\r\n  }}\r\n}\r\nUIBase.internalRegister(DragBox);\r\n","import {UIBase, saveUIData, loadUIData} from '../core/ui_base.js';\r\n\r\nimport * as util from \"../path-controller/util/util.js\"\r\nimport cconst from \"../config/const.js\";\r\nimport * as nstructjs from \"../path-controller/util/struct.js\";\r\n\r\nimport {Vector2} from '../path-controller/util/vectormath.js';\r\nimport {Container} from \"../core/ui.js\";\r\nimport {Area} from \"./ScreenArea.js\";\r\nimport {Icons} from \"../core/ui_base.js\";\r\n\r\nimport {startMenu} from \"../widgets/ui_menu.js\";\r\nimport {getAreaIntName, setAreaTypes, AreaWrangler, areaclasses} from './area_wrangler.js';\r\n\r\nlet ignore = 0;\r\n\r\nfunction dockerdebug() {\r\n  if (cconst.DEBUG.areadocker) {\r\n    console.warn(...arguments);\r\n  }\r\n}\r\n\r\nwindow.testSnapScreenVerts = function (arg) {\r\n  let screen = CTX.screen;\r\n\r\n  screen.unlisten();\r\n  screen.on_resize([screen.size[0] - 75, screen.size[1]], screen.size);\r\n  screen.on_resize = screen.updateSize = () => {\r\n  };\r\n\r\n  let p = CTX.propsbar;\r\n  p.pos[0] += 50;\r\n  p.owning_sarea.loadFromPosSize();\r\n  screen.regenBorders();\r\n\r\n  screen.size[0] = window.innerWidth - 5;\r\n\r\n  screen.snapScreenVerts(arg);\r\n}\r\n\r\nexport class AreaDocker extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this._last_update_key = undefined;\r\n    this.mpos = new Vector2();\r\n    this.needsRebuild = true;\r\n    this.ignoreChange = 0;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"area-docker-x\",\r\n      style  : \"areadocker\"\r\n    }\r\n  }\r\n\r\n  rebuild() {\r\n    if (!this.parentWidget) {\r\n      return;\r\n    }\r\n\r\n    let sarea = this.getArea().parentWidget;\r\n    if (!sarea) {\r\n      this.needsRebuild = true;\r\n      return;\r\n    }\r\n\r\n    this.needsRebuild = false;\r\n    this.ignoreChange++;\r\n\r\n    dockerdebug(\"Rebuild\", this.getArea());\r\n\r\n    let uidata = sarea.switcherData = saveUIData(this, \"switcherTabs\");\r\n\r\n    this.clear();\r\n\r\n    let tabs = this.tbar = this.tabs()\r\n    tabs.onchange = this.tab_onchange.bind(this);\r\n\r\n    let tab;\r\n\r\n    dockerdebug(sarea._id, sarea.area ? sarea.area._id : \"(no active area)\", sarea.editors)\r\n\r\n    sarea.switcherData = uidata;\r\n\r\n    for (let editor of sarea.editors) {\r\n      let def = editor.constructor.define();\r\n      let name = def.uiname;\r\n\r\n      if (!name) {\r\n        name = def.areaname || def.tagname.replace(/-x/, '');\r\n        name = ToolProperty.makeUIName(name);\r\n      }\r\n\r\n      let tab = tabs.tab(name, editor._id);\r\n\r\n      let start_mpos = new Vector2();\r\n      let mpos = new Vector2();\r\n\r\n      tab._tab.addEventListener(\"tabdragstart\", (e) => {\r\n        if (e.x !== 0 && e.y !== 0) {\r\n          start_mpos.loadXY(e.x, e.y);\r\n          this.mpos.loadXY(e.x, e.y);\r\n        } else {\r\n          start_mpos.load(this.mpos);\r\n        }\r\n\r\n        dockerdebug(\"tab drag start!\", start_mpos, e);\r\n      });\r\n      tab._tab.addEventListener(\"tabdragmove\", (e) => {\r\n        this.mpos.loadXY(e.x, e.y);\r\n\r\n        let rect = this.tbar.tbar.canvas.getBoundingClientRect();\r\n\r\n        let x = e.x, y = e.y;\r\n\r\n        let m = 8;\r\n        if (x < rect.x - m || x > rect.x + rect.width + m || y < rect.y - m || y >= rect.y + rect.height + m) {\r\n          dockerdebug(\"tab detach!\");\r\n          e.preventDefault(); //end dragging\r\n          this.detach(e);\r\n        }\r\n      });\r\n      tab._tab.addEventListener(\"tabdragend\", (e) => {\r\n\r\n        this.mpos.loadXY(e.x, e.y);\r\n        dockerdebug(\"tab drag end!\", e);\r\n      });\r\n    }\r\n\r\n    tab = this.tbar.icontab(Icons.SMALL_PLUS, \"add\", \"Add Editor\", false).noSwitch();\r\n    dockerdebug(\"Add Menu Tab\", tab);\r\n\r\n    let icon = this.addicon = tab._tab;\r\n\r\n    icon.ontabclick = e => this.on_addclick(e);\r\n    icon.setAttribute(\"menu-button\", \"true\");\r\n    icon.setAttribute(\"simple\", \"true\");\r\n\r\n    this.loadTabData(uidata);\r\n\r\n    this.ignoreChange--;\r\n  }\r\n\r\n  detach(event) {\r\n    this.tbar._ensureNoModal();\r\n\r\n    let area = this.getArea();\r\n    let sarea = this.ctx.screen.floatArea(area);\r\n\r\n    sarea.size.min([300, 300]);\r\n    sarea.loadFromPosSize();\r\n\r\n    let mpos = event ? new Vector2([event.x, event.y]) : this.mpos;\r\n\r\n    dockerdebug(\"EVENT\", event);\r\n\r\n    if (event && event instanceof PointerEvent) {\r\n      this.ctx.screen.moveAttachTool(sarea, mpos, document.body, event.pointerId);\r\n    } else {\r\n      this.ctx.screen.moveAttachTool(sarea, mpos);\r\n    }\r\n  }\r\n\r\n  loadTabData(uidata) {\r\n    this.ignoreChange++;\r\n    loadUIData(this, uidata);\r\n    this.ignoreChange--;\r\n  }\r\n\r\n  on_addclick(e) {\r\n    let mpos = new Vector2([e.x, e.y]);\r\n\r\n    if (this.addicon.menu && !this.addicon.menu.closed) {\r\n      this.addicon.menu.close();\r\n    } else {\r\n      this.addTabMenu(e.target, mpos);\r\n    }\r\n  }\r\n\r\n  tab_onchange(tab, event) {\r\n    if (this.ignoreChange) {\r\n      return;\r\n    }\r\n\r\n    dockerdebug(\"EVENT\", event);\r\n\r\n    if (event && (!(event instanceof PointerEvent) || event.pointerType === \"mouse\")) {\r\n      //event.preventDefault(); //prevent tab dragging\r\n    }\r\n\r\n    this.select(tab.id, event);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"touch-action\"] = \"none\";\r\n\r\n    this.addEventListener(\"pointermove\", (e) => {\r\n      this.mpos.loadXY(e.x, e.y);\r\n    });\r\n\r\n    this.rebuild();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n  }\r\n\r\n  getArea() {\r\n    let p = this.parentWidget;\r\n    let lastp = p;\r\n\r\n    let name = UIBase.getInternalName(\"screenarea-x\");\r\n    while (p && p.tagName.toLowerCase() !== name) {\r\n      lastp = p;\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    return lastp\r\n  }\r\n\r\n  flagUpdate() {\r\n    this.needsRebuild = true;\r\n    return this;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    let active = this.tbar.getActive();\r\n    let area = this.getArea();\r\n\r\n    let key = this.parentWidget._id;\r\n    for (let area2 of area.parentWidget.editors) {\r\n      key += area2._id + \":\";\r\n    }\r\n\r\n    if (key !== this._last_update_key) {\r\n      this._last_update_key = key;\r\n      this.needsRebuild = true;\r\n    }\r\n\r\n    if (this.needsRebuild) {\r\n      this.rebuild();\r\n      return;\r\n    }\r\n\r\n    if (this.addicon) {\r\n      let tabs = this.tbar.tbar.tabs;\r\n      let idx = tabs.indexOf(this.addicon);\r\n      if (idx !== tabs.length - 1) {\r\n        this.tbar.tbar.swapTabs(this.addicon, tabs[tabs.length - 1]);\r\n\r\n      }\r\n    }\r\n\r\n    if (!active || active._id !== area._id) {\r\n      this.ignoreChange++;\r\n\r\n      try {\r\n        this.tbar.setActive(area._id);\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        this.needsRebuild = true;\r\n      }\r\n\r\n      this.ignoreChange--;\r\n    }\r\n\r\n    window.tabs = this.tbar;\r\n\r\n    this.ignoreChange = 0;\r\n  }\r\n\r\n  select(areaId, event) {\r\n    dockerdebug(\"Tab Select!\", areaId);\r\n\r\n    this.ignoreChange++;\r\n\r\n    let area = this.getArea();\r\n    let sarea = area.parentWidget;\r\n\r\n    let uidata = saveUIData(this.tbar, \"switcherTabs\");\r\n    let newarea;\r\n\r\n    for (let area2 of sarea.editors) {\r\n      if (area2._id === areaId) {\r\n        newarea = area2;\r\n        sarea.switchEditor(area2.constructor);\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (newarea === area || !newarea.switcher) {\r\n      return;\r\n    }\r\n\r\n    //this.ctx.screen.completeSetCSS();\r\n    //this.ctx.screen.completeUpdate();\r\n    sarea.flushSetCSS();\r\n    sarea.flushUpdate();\r\n\r\n    newarea = sarea.area;\r\n\r\n    /* unswap switchers to avoid a bug in Chrome where\r\n    *  touch-action appears to not be respected due to our\r\n    *  swapping elements */\r\n\r\n    let parentw = area.switcher.parentWidget;\r\n    let newparentw = newarea.switcher.parentWidget;\r\n\r\n    let parent = area.switcher.parentNode;\r\n    let newparent = newarea.switcher.parentNode;\r\n\r\n    area.switcher = newarea.switcher;\r\n    newarea.switcher = this;\r\n\r\n    HTMLElement.prototype.remove.call(area.switcher);\r\n    HTMLElement.prototype.remove.call(newarea.switcher);\r\n\r\n    if (parent instanceof UIBase) {\r\n      parent.shadow.appendChild(area.switcher);\r\n    } else {\r\n      parent.appendChild(area.switcher);\r\n    }\r\n\r\n    if (newparent instanceof UIBase) {\r\n      newparent.shadow.prepend(newarea.switcher);\r\n    } else {\r\n      newparent.prepend(newarea.switcher);\r\n    }\r\n\r\n    area.switcher.parentWidget = parentw;\r\n    newarea.switcher.parentWidget = newparentw;\r\n\r\n    area.switcher.tbar._ensureNoModal();\r\n    newarea.switcher.tbar._ensureNoModal();\r\n\r\n    newarea.switcher.loadTabData(uidata);\r\n    area.switcher.loadTabData(uidata);\r\n\r\n    newarea.switcher.setCSS();\r\n    newarea.switcher.update();\r\n\r\n    if (event && (event instanceof PointerEvent || event instanceof MouseEvent || event instanceof TouchEvent)) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n      newarea.switcher.tbar._startMove(undefined, event);\r\n    }\r\n\r\n    //console.log(this._id);\r\n\r\n    sarea.switcherData = uidata;\r\n    this.ignoreChange--;\r\n  }\r\n\r\n  addTabMenu(tab, mpos) {\r\n    let rect = tab.getClientRects()[0];\r\n\r\n    dockerdebug(tab, tab.getClientRects());\r\n\r\n    if (!mpos) {\r\n      mpos = this.ctx.screen.mpos;\r\n    }\r\n\r\n    let menu = UIBase.createElement(\"menu-x\");\r\n\r\n    menu.closeOnMouseUp = false;\r\n    menu.ctx = this.ctx;\r\n    menu._init();\r\n\r\n    let prop = Area.makeAreasEnum();\r\n    let sarea = this.getArea().parentWidget;\r\n\r\n    if (!sarea) {\r\n      return;\r\n    }\r\n\r\n    for (let k in Object.assign({}, prop.values)) {\r\n      let ok = true;\r\n      for (let area of sarea.editors) {\r\n        if (area.constructor.define().uiname === k) {\r\n          ok = false;\r\n        }\r\n      }\r\n\r\n      if (!ok) {\r\n        continue;\r\n      }\r\n\r\n      let icon = prop.iconmap[k];\r\n      menu.addItemExtra(k, prop.values[k], undefined, icon);\r\n    }\r\n\r\n    if (!rect) {\r\n      console.warn(\"no rect!\");\r\n      return;\r\n    }\r\n\r\n    dockerdebug(mpos[0], mpos[1], rect.x, rect.y);\r\n\r\n    menu.onselect = (val) => {\r\n      dockerdebug(\"menu select\", val, this.getArea().parentWidget);\r\n\r\n      this.addicon.menu = undefined;\r\n\r\n      let sarea = this.getArea().parentWidget;\r\n      if (sarea) {\r\n        let cls = areaclasses[val];\r\n\r\n        this.ignoreChange++;\r\n        let area, ud;\r\n\r\n        try {\r\n          let uidata = saveUIData(this.tbar, \"switcherTabs\");\r\n          sarea.switchEditor(cls);\r\n\r\n          dockerdebug(\"switching\", cls);\r\n          area = sarea.area;\r\n          area._init();\r\n\r\n          if (area.switcher) {\r\n            area.switcher.rebuild();\r\n            area.switcher.loadTabData(uidata);\r\n            sarea.switcherData = uidata;\r\n          }\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n          throw error;\r\n        } finally {\r\n          this.ignoreChange = Math.max(this.ignoreChange - 1, 0);\r\n        }\r\n\r\n        dockerdebug(\"AREA\", area.switcher, area);\r\n\r\n        if (area.switcher) {\r\n          this.ignoreChange++;\r\n\r\n          try {\r\n            area.parentWidget = sarea;\r\n            area.owning_sarea = sarea;\r\n            area.switcher.parentWidget = area;\r\n            area.switcher.ctx = area.ctx;\r\n            area.switcher._init();\r\n            area.switcher.update();\r\n\r\n            dockerdebug(\"loading data\", ud);\r\n            area.switcher.loadTabData(ud);\r\n\r\n            area.switcher.rebuild(); //make sure plus tab is at end\r\n            area.flushUpdate();\r\n          } catch (error) {\r\n            throw error;\r\n          } finally {\r\n            this.ignoreChange = Math.max(this.ignoreChange - 1, 0);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    this.addicon.menu = menu;\r\n\r\n    startMenu(menu, mpos[0] - 35, rect.y + rect.height, false, 0);\r\n    return menu;\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(AreaDocker);\r\n","import {ToolTipViewer} from \"./FrameManager_ops.js\";\r\n\r\nlet _FrameManager = undefined;\r\nimport '../widgets/dragbox.js';\r\nimport '../widgets/ui_widgets2.js';\r\nimport '../widgets/ui_panel.js';\r\nimport '../widgets/ui_treeview.js';\r\n\r\nimport {DataPathError, nstructjs} from '../path-controller/controller.js';\r\n\r\nimport '../util/ScreenOverdraw.js';\r\nimport cconst from '../config/const.js';\r\nimport {haveModal, pushModalLight, popModalLight, _setScreenClass} from '../path-controller/util/simple_events.js';\r\nimport * as util from '../path-controller/util/util.js';\r\nimport '../widgets/ui_curvewidget.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as ScreenArea from './ScreenArea.js';\r\nimport * as FrameManager_ops from './FrameManager_ops.js';\r\nimport * as math from '../path-controller/util/math.js';\r\nimport * as ui_menu from '../widgets/ui_menu.js';\r\nimport '../path-controller/util/struct.js';\r\nimport {KeyMap, HotKey} from '../path-controller/util/simple_events.js';\r\nimport {keymap} from \"../path-controller/util/simple_events.js\";\r\n\r\nimport {AreaDocker} from './AreaDocker.js';\r\n\r\nimport {snap, snapi, ScreenBorder, ScreenVert, ScreenHalfEdge, SnapLimit} from \"./FrameManager_mesh.js\";\r\n\r\nexport {ScreenBorder, ScreenVert, ScreenHalfEdge} from \"./FrameManager_mesh.js\";\r\nimport {theme, PackFlags} from '../core/ui_base.js';\r\nimport * as FrameManager_mesh from './FrameManager_mesh.js';\r\nimport {makePopupArea} from \"../widgets/ui_dialog.js\";\r\n\r\nlet Area = ScreenArea.Area;\r\n\r\nimport '../widgets/ui_widgets.js';\r\nimport '../widgets/ui_tabs.js';\r\nimport '../widgets/ui_colorpicker2.js';\r\nimport '../widgets/ui_noteframe.js';\r\nimport '../widgets/ui_listbox.js';\r\nimport '../widgets/ui_table.js';\r\nimport {AreaFlags, setScreenClass} from \"./ScreenArea.js\";\r\nimport {checkForTextBox} from '../widgets/ui_textbox.js';\r\nimport {startMenu} from '../widgets/ui_menu.js';\r\n\r\nfunction list(iter) {\r\n  let ret = [];\r\n\r\n  for (let item of iter) {\r\n    ret.push(item);\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nui_menu.startMenuEventWrangling();\r\n\r\nlet _events_started = false;\r\n\r\nexport function registerToolStackGetter(func) {\r\n  FrameManager_ops.registerToolStackGetter(func);\r\n}\r\n\r\nlet Vector2         = vectormath.Vector2,\r\n    UIBase          = ui_base.UIBase,\r\n    styleScrollBars = ui_base.styleScrollBars;\r\n\r\nlet update_stack = new Array(8192);\r\nupdate_stack.cur = 0;\r\n\r\nlet screen_idgen = 0;\r\n\r\nexport function purgeUpdateStack() {\r\n  for (let i = 0; i < update_stack.length; i++) {\r\n    update_stack[i] = undefined;\r\n  }\r\n}\r\n\r\n/**\r\n * Base class for app workspaces\r\n *\r\n attributes:\r\n\r\n inherit-scale : don't resize to fit whole screen, use cssbox scaling\r\n\r\n */\r\nexport class Screen extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.snapLimit = 1;\r\n    this.fullScreen = true;\r\n\r\n    //all widget shadow DOMs reference this style tag,\r\n    //or rather they copy it\r\n    this.globalCSS = document.createElement(\"style\");\r\n    this.shadow.prepend(this.globalCSS);\r\n\r\n    this._do_updateSize = true;\r\n    this._resize_callbacks = [];\r\n\r\n    this.allBordersMovable = cconst.DEBUG.allBordersMovable;\r\n    this.needsBorderRegen = true;\r\n\r\n    this._popup_safe = 0;\r\n\r\n    //if true, will test all areas for keymaps on keypress,\r\n    //not just the active one\r\n    this.testAllKeyMaps = false;\r\n\r\n    this.needsTabRecalc = true;\r\n    this._screen_id = screen_idgen++;\r\n\r\n    this._popups = [];\r\n\r\n    this._ctx = undefined;\r\n\r\n    this.keymap = new KeyMap();\r\n\r\n    this.size = new Vector2([window.innerWidth, window.innerHeight]);\r\n    this.pos = new Vector2();\r\n    this.oldpos = new Vector2();\r\n\r\n    this.idgen = 0;\r\n    this.sareas = [];\r\n    this.sareas.active = undefined;\r\n    this.mpos = [0, 0];\r\n\r\n    this.screenborders = [];\r\n    this.screenverts = [];\r\n    this._vertmap = {};\r\n    this._edgemap = {};\r\n    this._idmap = {};\r\n\r\n    //effective bounds of screen\r\n    this._aabb = [new Vector2(), new Vector2()];\r\n\r\n    let on_mousemove = (e, x, y) => {\r\n      //let elem = this.pickElement(x, y, 1, 1, ScreenArea.ScreenArea);\r\n      let dragging = e.type === \"mousemove\" || e.type === \"touchmove\" || e.type === \"pointermove\";\r\n      dragging = dragging && (e.buttons || (e.touches && e.touches.length > 0));\r\n\r\n      /*\r\n      make sure active area is up to date.\r\n      but don't call pickElement too often as it's slow\r\n      */\r\n      if (!dragging && Math.random() > 0.9) {\r\n        let elem = this.pickElement(x, y, {\r\n          sx        : 1,\r\n          sy        : 1,\r\n          nodeclass : ScreenArea.ScreenArea,\r\n          mouseEvent: e\r\n        });\r\n\r\n        if (0) {\r\n          let elem2 = this.pickElement(x, y, 1, 1);\r\n          console.log(\"\" + this.sareas.active, elem2 ? elem2.tagName : undefined, elem !== undefined);\r\n        }\r\n\r\n        if (elem !== undefined) {\r\n          if (elem.area) {\r\n            //make sure context area stacks are up to date\r\n            elem.area.push_ctx_active();\r\n            elem.area.pop_ctx_active();\r\n          }\r\n\r\n          this.sareas.active = elem;\r\n        }\r\n      }\r\n\r\n      this.mpos[0] = x;\r\n      this.mpos[1] = y;\r\n    }\r\n    this.shadow.addEventListener(\"mousemove\", (e) => {\r\n      return on_mousemove(e, e.x, e.y);\r\n    }, {passive: true});\r\n\r\n    /*UIBase forwards touch events already\r\n    this.shadow.addEventListener(\"touchmove\", (e) => {\r\n      if (e.touches.length === 0) {\r\n        return;\r\n      }\r\n\r\n      return on_mousemove(e, e.touches[0].pageX, e.touches[0].pagesY);\r\n    }, {passive : true});\r\n    */\r\n  }\r\n\r\n  get borders() {\r\n    let this2 = this;\r\n\r\n    return (function* () {\r\n      for (let k in this2._edgemap) {\r\n        yield this2._edgemap[k];\r\n      }\r\n    })();\r\n  }\r\n\r\n  get listening() {\r\n    return this.listen_timer !== undefined;\r\n  }\r\n\r\n  get ctx() {\r\n    return this._ctx;\r\n  }\r\n\r\n  set ctx(val) {\r\n    this._ctx = val;\r\n\r\n    //fully recurse tree\r\n    let rec = (n) => {\r\n      if (n instanceof UIBase) {\r\n        n.ctx = val;\r\n      }\r\n\r\n      for (let n2 of n.childNodes) {\r\n        rec(n2);\r\n      }\r\n\r\n      if (n.shadow) {\r\n        for (let n2 of n.shadow.childNodes) {\r\n          rec(n2);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let n of this.childNodes) {\r\n      rec(n);\r\n    }\r\n\r\n    for (let n of this.shadow.childNodes) {\r\n      rec(n);\r\n    }\r\n  }\r\n\r\n  static fromJSON(obj, schedule_resize = false) {\r\n    let ret = UIBase.createElement(this.define().tagname);\r\n    return ret.loadJSON(obj, schedule_resize);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"pathux-screen-x\"\r\n    };\r\n  }\r\n\r\n  static newSTRUCT() {\r\n    return UIBase.createElement(this.define().tagname);\r\n  }\r\n\r\n  setPosSize(x, y, w, h) {\r\n    this.pos[0] = x;\r\n    this.pos[1] = y;\r\n    this.size[0] = w;\r\n    this.size[1] = h;\r\n\r\n    this.setCSS();\r\n    this._internalRegenAll();\r\n  }\r\n\r\n  setSize(w, h) {\r\n    this.size[0] = w;\r\n    this.size[1] = h;\r\n\r\n    this.setCSS();\r\n    this._internalRegenAll();\r\n  }\r\n\r\n  setPos(x, y) {\r\n    this.pos[0] = x;\r\n    this.pos[1] = y;\r\n\r\n    this.setCSS();\r\n    this._internalRegenAll();\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    if (this.hasAttribute(\"listen\")) {\r\n      this.listen();\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {*} style May be a string, a CSSStyleSheet instance, or a style tag\r\n   * @returns Promise fulfilled when style has been merged\r\n   */\r\n  mergeGlobalCSS(style) {\r\n    return new Promise((accept, reject) => {\r\n      let sheet;\r\n\r\n      let finish = () => {\r\n        let sheet2 = this.globalCSS.sheet;\r\n        if (!sheet2) {\r\n          this.doOnce(finish);\r\n          return;\r\n        }\r\n\r\n        let map = {};\r\n        for (let rule of sheet2.rules) {\r\n          map[rule.selectorText] = rule;\r\n        }\r\n\r\n        for (let rule of sheet.rules) {\r\n          let k = rule.selectorText;\r\n          if (k in map) {\r\n            let rule2 = map[k];\r\n\r\n            if (!rule.styleMap) { //handle firefox\r\n              for (let k in rule.style) {\r\n                let desc = Object.getOwnPropertyDescriptor(rule.style, k);\r\n\r\n                if (!desc || !desc.writable) {\r\n                  continue;\r\n                }\r\n                let v = rule.style[k];\r\n\r\n                if (v) {\r\n                  rule2.style[k] = rule.style[k];\r\n                }\r\n              }\r\n              continue;\r\n            }\r\n            for (let [key, val] of list(rule.styleMap.entries())) {\r\n              if (1 || rule2.styleMap.has(key)) {\r\n                //rule2.styleMap.delete(key);\r\n                let sval = \"\";\r\n\r\n                if (Array.isArray(val)) {\r\n                  for (let item of val) {\r\n                    sval += \" \" + val;\r\n                  }\r\n                  sval = sval.trim();\r\n                } else {\r\n                  sval = (\"\" + val).trim();\r\n                }\r\n\r\n                rule2.style[key] = sval;\r\n                rule2.styleMap.set(key, val);\r\n              } else {\r\n                rule2.styleMap.append(key, val);\r\n              }\r\n            }\r\n          } else {\r\n            sheet2.insertRule(rule.cssText);\r\n          }\r\n        }\r\n      }\r\n\r\n      if (typeof style === \"string\") {\r\n        try { //stupid firefox\r\n          sheet = new CSSStyleSheet();\r\n        } catch (error) {\r\n          sheet = undefined;\r\n        }\r\n\r\n        if (sheet && sheet.replaceSync) {\r\n          sheet.replaceSync(style);\r\n          finish();\r\n        } else {\r\n          let tag = document.createElement(\"style\");\r\n          tag.textContent = style;\r\n          document.body.appendChild(tag);\r\n\r\n          let cb = () => {\r\n            if (!tag.sheet) {\r\n              this.doOnce(cb);\r\n              return;\r\n            }\r\n\r\n            sheet = tag.sheet;\r\n            finish();\r\n            tag.remove();\r\n          };\r\n\r\n          this.doOnce(cb)\r\n        }\r\n      } else if (!(style instanceof CSSStyleSheet)) {\r\n        sheet = style.sheet;\r\n        finish();\r\n      } else {\r\n        sheet = style;\r\n        finish();\r\n      }\r\n    });\r\n  }\r\n\r\n  newScreenArea() {\r\n    let ret = UIBase.createElement(\"screenarea-x\");\r\n    ret.ctx = this.ctx;\r\n\r\n    if (ret.ctx) {\r\n      ret.init();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  copy() {\r\n    let ret = UIBase.createElement(this.constructor.define().tagname);\r\n    ret.ctx = this.ctx;\r\n    ret._init();\r\n\r\n    for (let sarea of this.sareas) {\r\n      let sarea2 = sarea.copy(ret);\r\n\r\n      sarea2._ctx = this.ctx;\r\n      sarea2.screen = ret;\r\n      sarea2.parentWidget = ret;\r\n\r\n      ret.appendChild(sarea2);\r\n    }\r\n\r\n    for (let sarea of ret.sareas) {\r\n      sarea.ctx = this.ctx;\r\n      sarea.area.ctx = this.ctx;\r\n\r\n      sarea.area.push_ctx_active();\r\n      sarea._init();\r\n      sarea.area._init();\r\n      sarea.area.pop_ctx_active();\r\n\r\n      for (let area of sarea.editors) {\r\n        area.ctx = this.ctx;\r\n\r\n        area.push_ctx_active();\r\n        area._init();\r\n        area.pop_ctx_active();\r\n      }\r\n    }\r\n\r\n    ret.update();\r\n    ret.regenBorders();\r\n    ret.setCSS();\r\n\r\n    return ret;\r\n  }\r\n\r\n  findScreenArea(x, y) {\r\n    for (let i = this.sareas.length - 1; i >= 0; i--) {\r\n      let sarea = this.sareas[i];\r\n\r\n      let ok = x >= sarea.pos[0] && x <= sarea.pos[0] + sarea.size[0];\r\n      ok = ok && (y >= sarea.pos[1] && y <= sarea.pos[1] + sarea.size[1]);\r\n\r\n      if (ok) {\r\n        return sarea;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param x\r\n   * @param y\r\n   * @param args arguments : {sx, sy, nodeclass, excluded_classes}\r\n   */\r\n  pickElement(x, y, args, sy, nodeclass, excluded_classes) {\r\n    let sx;\r\n    let clip;\r\n\r\n    if (typeof args === \"object\") {\r\n      sx = args.sx;\r\n      sy = args.sy;\r\n      nodeclass = args.nodeclass;\r\n      excluded_classes = args.excluded_classes;\r\n      clip = args.clip;\r\n    } else {\r\n      sx = args;\r\n\r\n      args = {\r\n        sx              : sx,\r\n        sy              : sy,\r\n        nodeclass       : nodeclass,\r\n        excluded_classes: excluded_classes\r\n      };\r\n    }\r\n\r\n    if (!this.ctx) {\r\n      console.warn(\"no ctx in screen\");\r\n      return;\r\n    }\r\n\r\n    let ret;\r\n\r\n    for (let i = this._popups.length - 1; i >= 0; i--) {\r\n      let popup = this._popups[i];\r\n\r\n      ret = ret || popup.pickElement(x, y, args);\r\n    }\r\n\r\n    ret = ret || super.pickElement(x, y, args);\r\n\r\n    return ret;\r\n  }\r\n\r\n  _enterPopupSafe() {\r\n    if (this._popup_safe === undefined) {\r\n      this._popup_safe = 0;\r\n    }\r\n\r\n    this._popup_safe++;\r\n  }\r\n\r\n  * _allAreas() {\r\n    for (let sarea of this.sareas) {\r\n      for (let area of sarea.editors) {\r\n        yield [area, area._area_id, sarea];\r\n      }\r\n    }\r\n  }\r\n\r\n  _exitPopupSafe() {\r\n    this._popup_safe = Math.max(this._popup_safe - 1, 0);\r\n  }\r\n\r\n  popupMenu(menu, x, y) {\r\n    startMenu(menu, x, y);\r\n\r\n    for (let i = 0; i < 3; i++) {\r\n      menu.flushSetCSS();\r\n      menu.flushUpdate();\r\n    }\r\n\r\n    return menu;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param popupDelay : if non-zero, wait for popup to layout for popupDelay miliseconds,\r\n   *                     then move the popup so it's fully inside the window (if it's outsize).\r\n   *\r\n   * */\r\n  popup(owning_node, elem_or_x, y, closeOnMouseOut = true, popupDelay = 5) {\r\n    let ret = this._popup(...arguments);\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      ret.flushUpdate();\r\n      ret.flushSetCSS();\r\n    }\r\n\r\n    if (popupDelay === 0) {\r\n      return ret;\r\n    }\r\n\r\n    let z = ret.style[\"z-index\"];\r\n\r\n    ret.style[\"z-index\"] = \"-10\";\r\n\r\n    let cb = () => {\r\n      let rect = ret.getClientRects()[0];\r\n      let size = this.size;\r\n\r\n      if (!rect) {\r\n        this.doOnce(cb);\r\n        return;\r\n      }\r\n\r\n      //console.log(\"rect\", rect);\r\n\r\n      if (rect.bottom > size[1]) {\r\n        ret.style[\"top\"] = (size[1] - rect.height - 10) + \"px\";\r\n      } else if (rect.top < 0) {\r\n        ret.style[\"top\"] = \"10px\";\r\n      }\r\n      if (rect.right > size[0]) {\r\n        ret.style[\"left\"] = (size[0] - rect.width - 10) + \"px\";\r\n      } else if (rect.left < 0) {\r\n        ret.style[\"left\"] = \"10px\";\r\n      }\r\n\r\n\r\n      ret.style[\"z-index\"] = z;\r\n\r\n      ret.flushUpdate();\r\n      ret.flushSetCSS();\r\n    }\r\n\r\n    setTimeout(cb, popupDelay);\r\n    //this.doOnce(cb);\r\n\r\n    return ret;\r\n  }\r\n\r\n  draggablePopup(x, y) {\r\n    let ret = UIBase.createElement(\"drag-box-x\");\r\n    ret.ctx = this.ctx;\r\n    ret.parentWidget = this;\r\n    ret._init();\r\n\r\n    this._popups.push(ret);\r\n\r\n    ret._onend = () => {\r\n      if (this._popups.indexOf(ret) >= 0) {\r\n        this._popups.remove(ret);\r\n      }\r\n    }\r\n\r\n    ret.style[\"z-index\"] = 205;\r\n    ret.style[\"position\"] = UIBase.PositionKey;\r\n    ret.style[\"left\"] = x + \"px\";\r\n    ret.style[\"top\"] = y + \"px\";\r\n\r\n    document.body.appendChild(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  /** makes a popup at x,y and returns a new container-x for it */\r\n  _popup(owning_node, elem_or_x, y, closeOnMouseOut = true) {\r\n    let x;\r\n\r\n    let sarea = this.sareas.active;\r\n\r\n    let w = owning_node;\r\n    while (w) {\r\n      if (w instanceof ScreenArea.ScreenArea) {\r\n        sarea = w;\r\n        break;\r\n      }\r\n      w = w.parentWidget;\r\n    }\r\n\r\n    if (typeof elem_or_x === \"object\") {\r\n      let r = elem_or_x.getClientRects()[0];\r\n\r\n      x = r.x;\r\n      y = r.y;\r\n    } else {\r\n      x = elem_or_x;\r\n    }\r\n\r\n    x += window.scrollX;\r\n    y += window.scrollY;\r\n\r\n    let container = UIBase.createElement(\"container-x\");\r\n\r\n    container.ctx = this.ctx;\r\n    container._init();\r\n\r\n    let remove = container.remove;\r\n    container.remove = () => {\r\n      if (this._popups.indexOf(container) >= 0) {\r\n        this._popups.remove(container);\r\n      }\r\n\r\n      return remove.apply(container, arguments);\r\n    };\r\n\r\n    container.overrideClass(\"popup\");\r\n\r\n    container.background = container.getDefault(\"background-color\");\r\n    container.style[\"border-radius\"] = container.getDefault(\"border-radius\") + \"px\";\r\n    container.style[\"border-color\"] = container.getDefault(\"border-color\");\r\n    container.style[\"border-style\"] = container.getDefault(\"border-style\");\r\n    container.style[\"border-width\"] = container.getDefault(\"border-width\") + \"px\";\r\n    container.style[\"box-shadow\"] = container.getDefault(\"box-shadow\");\r\n\r\n    container.style[\"position\"] = UIBase.PositionKey;\r\n    container.style[\"z-index\"] = \"2205\";\r\n    container.style[\"left\"] = x + \"px\";\r\n    container.style[\"top\"] = y + \"px\";\r\n    container.style[\"margin\"] = \"0px\";\r\n\r\n    container.parentWidget = this;\r\n\r\n    let mm = new math.MinMax(2);\r\n    let p = new Vector2();\r\n\r\n    let _update = container.update;\r\n    container.update.after(() => {\r\n      container.style[\"z-index\"] = \"2205\";\r\n    });\r\n\r\n    /*causes weird bugs\r\n    container.update = () => {\r\n      _update.call(container);\r\n\r\n      let rects = container.getClientRects();\r\n      mm.reset();\r\n\r\n      for (let r of rects) {\r\n        p[0] = r.x;\r\n        p[1] = r.y;\r\n        mm.minmax(p);\r\n\r\n        p[0] += r.width;\r\n        p[1] += r.height;\r\n        mm.minmax(p);\r\n      }\r\n\r\n      let x = mm.min[0], y = mm.min[1];\r\n\r\n      x = Math.min(x, this.size[0]-(mm.max[0]-mm.min[0]));\r\n      y = Math.min(y, this.size[1]-(mm.max[1]-mm.min[1]));\r\n\r\n      container.style[\"left\"] = x + \"px\";\r\n      container.style[\"top\"] = y + \"px\";\r\n    }//*/\r\n\r\n    document.body.appendChild(container);\r\n    //this.shadow.appendChild(container);\r\n    this.setCSS();\r\n\r\n    this._popups.push(container);\r\n\r\n    let touchpick, mousepick, keydown;\r\n\r\n    let done = false;\r\n    let end = () => {\r\n      if (this._popup_safe) {\r\n        return;\r\n      }\r\n\r\n      if (done) return;\r\n\r\n      //this.ctx.screen.removeEventListener(\"touchstart\", touchpick, true);\r\n      //this.ctx.screen.removeEventListener(\"touchmove\", touchpick, true);\r\n      this.ctx.screen.removeEventListener(\"mousedown\", mousepick, true);\r\n      this.ctx.screen.removeEventListener(\"mousemove\", mousepick, {passive: true});\r\n      this.ctx.screen.removeEventListener(\"mouseup\", mousepick, true);\r\n      window.removeEventListener(\"keydown\", keydown);\r\n\r\n      done = true;\r\n      container.remove();\r\n    };\r\n\r\n    container.end = end;\r\n\r\n    let _remove = container.remove;\r\n    container.remove = function () {\r\n      if (arguments.length == 0) {\r\n        end();\r\n      }\r\n      _remove.apply(this, arguments);\r\n    };\r\n\r\n    container._ondestroy = () => {\r\n      end();\r\n    };\r\n\r\n    let bad_time = util.time_ms();\r\n    let last_pick_time = util.time_ms();\r\n\r\n    mousepick = (e, x, y, do_timeout = true) => {\r\n      if (!container.isConnected) {\r\n        end();\r\n        return;\r\n      }\r\n\r\n      if (sarea && sarea.area) {\r\n        sarea.area.push_ctx_active();\r\n        sarea.area.pop_ctx_active();\r\n      }\r\n      //console.log(\"=======================================================popup touch start\");\r\n      //console.log(e);\r\n\r\n      if (util.time_ms() - last_pick_time < 350) {\r\n        return;\r\n      }\r\n      last_pick_time = util.time_ms();\r\n\r\n      x = x === undefined ? e.x : x;\r\n      y = y === undefined ? e.y : y;\r\n\r\n      //let elem = this.pickElement(x, y, 2, 2, undefined, [ScreenBorder]);\r\n      let elem = this.pickElement(x, y, {\r\n        sx              : 2,\r\n        sy              : 2,\r\n        excluded_classes: [ScreenBorder],\r\n        mouseEvent      : e\r\n      });\r\n\r\n      let startelem = elem;\r\n\r\n      if (elem === undefined) {\r\n        if (closeOnMouseOut) {\r\n          end();\r\n        }\r\n        return;\r\n      }\r\n\r\n      let ok = false;\r\n      let elem2 = elem;\r\n\r\n      while (elem) {\r\n        if (elem === container) {\r\n          ok = true;\r\n          break;\r\n        }\r\n        elem = elem.parentWidget;\r\n      }\r\n\r\n      if (!ok) {\r\n        do_timeout = !do_timeout || (util.time_ms() - bad_time > 100);\r\n\r\n        if (closeOnMouseOut && do_timeout) {\r\n          end();\r\n        }\r\n      } else {\r\n        bad_time = util.time_ms();\r\n      }\r\n    };\r\n\r\n    touchpick = (e) => {\r\n      let x = e.touches[0].pageX, y = e.touches[0].pageY;\r\n\r\n      return mousepick(e, x, y, false);\r\n    };\r\n\r\n    keydown = (e) => {\r\n      if (!container.isConnected) {\r\n        window.removeEventListener(\"keydown\", keydown);\r\n        return;\r\n      }\r\n\r\n      switch (e.keyCode) {\r\n        case keymap[\"Escape\"]:\r\n          end();\r\n          break;\r\n      }\r\n    };\r\n\r\n    //this.ctx.screen.addEventListener(\"touchstart\", touchpick, true);\r\n    //this.ctx.screen.addEventListener(\"touchmove\", touchpick, true);\r\n    this.ctx.screen.addEventListener(\"mousedown\", mousepick, true);\r\n    this.ctx.screen.addEventListener(\"mousemove\", mousepick, {passive: true});\r\n    this.ctx.screen.addEventListener(\"mouseup\", mousepick, true);\r\n    window.addEventListener(\"keydown\", keydown);\r\n\r\n    /*\r\n    container.addEventListener(\"mouseleave\", (e) => {\r\n      console.log(\"popup mouse leave\");\r\n      if (closeOnMouseOut)\r\n        end();\r\n    });\r\n    container.addEventListener(\"mouseout\", (e) => {\r\n      console.log(\"popup mouse out\");\r\n      if (closeOnMouseOut)\r\n        end();\r\n    });\r\n    //*/\r\n\r\n    this.calcTabOrder();\r\n\r\n    return container;\r\n  }\r\n\r\n  _recalcAABB(save = true) {\r\n    let mm = new math.MinMax(2);\r\n\r\n    for (let v of this.screenverts) {\r\n      mm.minmax(v);\r\n    }\r\n\r\n    if (save) {\r\n      this._aabb[0].load(mm.min);\r\n      this._aabb[1].load(mm.max);\r\n    }\r\n\r\n    return [new Vector2(mm.min), new Vector2(mm.max)];\r\n  }\r\n\r\n  //XXX look at if this is referenced anywhere\r\n  load() {\r\n  }\r\n\r\n  //XXX look at if this is referenced anywhere\r\n  save() {\r\n  }\r\n\r\n  popupArea(area_class) {\r\n    return makePopupArea(area_class, this);\r\n  }\r\n\r\n  remove(trigger_destroy = true) {\r\n    this.unlisten();\r\n\r\n    if (trigger_destroy) {\r\n      return super.remove();\r\n    } else {\r\n      HTMLElement.prototype.remove.call(this);\r\n    }\r\n  }\r\n\r\n  unlisten() {\r\n    if (this.listen_timer !== undefined) {\r\n      window.clearInterval(this.listen_timer);\r\n      this.listen_timer = undefined;\r\n    }\r\n  }\r\n\r\n  checkCSSSize() {\r\n    let w = this.style.width.toLowerCase().trim();\r\n    let h = this.style.height.toLowerCase().trim();\r\n\r\n    if (w.endsWith(\"px\") && h.endsWith(\"px\")) {\r\n      w = parseFloat(w.slice(0, w.length - 2).trim());\r\n      h = parseFloat(h.slice(0, h.length - 2).trim());\r\n\r\n      if (w !== this.size[0] || h !== this.size[1]) {\r\n        this.on_resize([this.size[0], this.size[1]], [w, h]);\r\n        this.size[0] = w;\r\n        this.size[1] = h;\r\n      }\r\n    }\r\n  }\r\n\r\n  getBoolAttribute(attr, defaultval = false) {\r\n    if (!this.hasAttribute(attr)) {\r\n      return defaultval;\r\n    }\r\n\r\n    let ret = this.getAttribute(attr);\r\n\r\n    if (typeof ret === \"number\") {\r\n      return !!ret;\r\n    } else if (typeof ret === \"string\") {\r\n      ret = ret.toLowerCase().trim();\r\n      ret = ret === \"true\" || ret === \"1\" || ret === \"yes\";\r\n    }\r\n\r\n    return !!ret;\r\n  }\r\n\r\n  updateSize() {\r\n    if (this.getBoolAttribute(\"inherit-scale\") || !this.fullScreen || !cconst.autoSizeUpdate) {\r\n      this.checkCSSSize();\r\n      return;\r\n    }\r\n\r\n    let width = window.innerWidth;\r\n    let height = window.innerHeight;\r\n\r\n    let ratio = window.outerHeight/window.innerHeight;\r\n    let scale = visualViewport.scale;\r\n\r\n    let pad = 4;\r\n    width = visualViewport.width*scale - pad;\r\n    height = visualViewport.height*scale - pad;\r\n\r\n    let ox = visualViewport.offsetLeft;\r\n    let oy = visualViewport.offsetTop;\r\n\r\n    if (cconst.DEBUG.customWindowSize) {\r\n      let s = cconst.DEBUG.customWindowSize;\r\n      width = s.width;\r\n      height = s.height;\r\n      ox = 0;\r\n      oy = 0;\r\n      window._DEBUG = cconst.DEBUG;\r\n    }\r\n\r\n    let key = this._calcSizeKey(width, height, ox, oy, devicePixelRatio, scale);\r\n\r\n    /* CSS IS EVIL! WHY DOES BODY HAVE A MARGIN? */\r\n    document.body.style.margin = document.body.style.padding = \"0px\";\r\n    document.body.style[\"transform-origin\"] = \"top left\";\r\n    document.body.style[\"transform\"] = `translate(${ox}px,${oy}px) scale(${1.0/scale})`;\r\n\r\n    //document.body.style[\"transform\"] = `scale(${1.0 / scale}, ${1.0 / scale})`; // translate(${ox*scale2}px, ${oy*scale2}px)`;\r\n\r\n    if (key !== this._last_ckey1) {\r\n      //console.log(\"resizing\", key, this._last_ckey1);\r\n      this._last_ckey1 = key;\r\n\r\n      this.on_resize(this.size, [width, height], false);\r\n      this.on_resize(this.size, this.size, false);\r\n\r\n      let scale = visualViewport.scale;\r\n\r\n\r\n      this.regenBorders();\r\n\r\n      this.setCSS();\r\n      this.completeUpdate();\r\n    }\r\n  }\r\n\r\n  listen(args = {updateSize: true}) {\r\n    ui_menu.setWranglerScreen(this);\r\n\r\n    let ctx = this.ctx;\r\n    startEvents(() => ctx.screen);\r\n\r\n    if (this.listen_timer !== undefined) {\r\n      return; //already listening\r\n    }\r\n\r\n    this._do_updateSize = args.updateSize !== undefined ? args.updateSize : true;\r\n\r\n    this.listen_timer = window.setInterval(() => {\r\n      if (this.isDead()) {\r\n        console.log(\"dead screen\");\r\n        this.unlisten();\r\n        return;\r\n      }\r\n\r\n      this.update();\r\n    }, 150);\r\n  }\r\n\r\n  _calcSizeKey(w, h, x, y, dpi, scale) {\r\n    if (arguments.length !== 6) {\r\n      throw new Error(\"eek\");\r\n    }\r\n\r\n    let s = \"\";\r\n    for (let i = 0; i < arguments.length; i++) {\r\n      s += arguments[i].toFixed(0) + \":\";\r\n    }\r\n\r\n    return s;\r\n  }\r\n\r\n  _ondestroy() {\r\n    if (ui_menu.getWranglerScreen() === this) {\r\n      //ui_menu.setWranglerScreen(undefined);\r\n    }\r\n\r\n    this.unlisten();\r\n\r\n    //unlike other ondestroy functions, this one physically dismantles the DOM tree\r\n    let recurse = (n, second_pass, parent) => {\r\n      if (n.__pass === second_pass) {\r\n        console.warn(\"CYCLE IN DOM TREE!\", n, parent);\r\n        return;\r\n      }\r\n\r\n      n.__pass = second_pass;\r\n\r\n      n._forEachChildWidget(n2 => {\r\n        if (n === n2)\r\n          return;\r\n        recurse(n2, second_pass, n);\r\n\r\n        try {\r\n          if (!second_pass && !n2.__destroyed) {\r\n            n2.__destroyed = true;\r\n            n2._ondestroy();\r\n          }\r\n        } catch (error) {\r\n          print_stack(error);\r\n          console.log(\"failed to exectue an ondestroy callback\");\r\n        }\r\n\r\n        n2.__destroyed = true;\r\n\r\n        try {\r\n          if (second_pass) {\r\n            n2.remove();\r\n          }\r\n        } catch (error) {\r\n          print_stack(error);\r\n          console.log(\"failed to remove element after ondestroy callback\");\r\n        }\r\n      });\r\n    };\r\n\r\n    let id = ~~(Math.random()*1024*1024);\r\n\r\n    recurse(this, id);\r\n    recurse(this, id + 1);\r\n  }\r\n\r\n  destroy() {\r\n    this._ondestroy();\r\n  }\r\n\r\n  clear() {\r\n    this._ondestroy();\r\n\r\n    this.sareas = [];\r\n    this.sareas.active = undefined;\r\n\r\n    for (let child of list(this.childNodes)) {\r\n      child.remove();\r\n    }\r\n    for (let child of list(this.shadow.childNodes)) {\r\n      child.remove();\r\n    }\r\n  }\r\n\r\n  _test_save() {\r\n    let obj = JSON.parse(JSON.stringify(this));\r\n    console.log(JSON.stringify(this));\r\n\r\n    this.loadJSON(obj);\r\n  }\r\n\r\n  loadJSON(obj, schedule_resize = false) {\r\n    this.clear();\r\n    super.loadJSON();\r\n\r\n    for (let sarea of obj.sareas) {\r\n      let sarea2 = UIBase.createElement(\"screenarea-x\");\r\n\r\n      sarea2.ctx = this.ctx;\r\n      sarea2.screen = this;\r\n\r\n      this.appendChild(sarea2);\r\n\r\n      sarea2.loadJSON(sarea);\r\n    }\r\n\r\n    this.regenBorders();\r\n    this.setCSS();\r\n\r\n    if (schedule_resize) {\r\n      window.setTimeout(() => {\r\n        this.on_resize(this.size, [window.innerWidth, window.innerHeight]);\r\n      }, 50);\r\n    }\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = {\r\n      sareas: this.sareas\r\n    };\r\n\r\n    ret.size = this.size;\r\n    ret.idgen = this.idgen;\r\n\r\n    return Object.assign(super.toJSON(), ret);\r\n  }\r\n\r\n  getHotKey(toolpath) {\r\n    let test = (keymap) => {\r\n      for (let hk of keymap) {\r\n        if (typeof hk.action != \"string\")\r\n          continue;\r\n\r\n        if (hk.action.trim().startsWith(toolpath.trim())) {\r\n          return hk;\r\n        }\r\n      }\r\n    };\r\n\r\n    let ret = test(this.keymap);\r\n    if (ret)\r\n      return ret;\r\n\r\n    if (this.sareas.active && this.sareas.active.keymap) {\r\n      let area = this.sareas.active.area;\r\n\r\n      for (let keymap of area.getKeyMaps()) {\r\n        ret = test(keymap);\r\n\r\n        if (ret)\r\n          return ret;\r\n      }\r\n    }\r\n\r\n    if (ret === undefined) {\r\n      //just to be safe, check all areas in case the\r\n      //context is confused as to which area is currently \"active\"\r\n\r\n      for (let sarea of this.sareas) {\r\n        let area = sarea.area;\r\n\r\n        for (let keymap of area.getKeyMaps()) {\r\n          ret = test(keymap);\r\n\r\n          if (ret) {\r\n            return ret;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  addEventListener(type, cb, options) {\r\n    if (type === \"resize\") {\r\n      this._resize_callbacks.push(cb);\r\n    } else {\r\n      return super.addEventListener(type, cb, options);\r\n    }\r\n  }\r\n\r\n  removeEventListener(type, cb, options) {\r\n    if (type === \"resize\") {\r\n      if (this._resize_callbacks.indexOf(cb) >= 0)\r\n        this._resize_callbacks.remove(cb);\r\n    } else {\r\n      return super.removeEventListener(type, cb, options);\r\n    }\r\n  }\r\n\r\n  execKeyMap(e) {\r\n    let handled = false;\r\n\r\n    if (window.DEBUG && window.DEBUG.keymap) {\r\n      console.warn(\"execKeyMap called\", e.keyCode, document.activeElement.tagName);\r\n    }\r\n\r\n    if (this.sareas.active) {\r\n      let area = this.sareas.active.area;\r\n\r\n      if (!area) {\r\n        return;\r\n      }\r\n\r\n      area.push_ctx_active();\r\n\r\n      for (let keymap of area.getKeyMaps()) {\r\n        if (keymap === undefined) {\r\n          continue;\r\n        }\r\n\r\n        if (keymap.handle(area.ctx, e)) {\r\n          handled = true;\r\n          break;\r\n        }\r\n      }\r\n\r\n      area.pop_ctx_active();\r\n    }\r\n\r\n    handled = handled || this.keymap.handle(this.ctx, e);\r\n\r\n    if (!handled && this.testAllKeyMaps) {\r\n      for (let sarea of this.sareas) {\r\n        if (handled) {\r\n          break;\r\n        }\r\n\r\n        sarea.area.push_ctx_active();\r\n\r\n        for (let keymap of sarea.area.getKeyMaps()) {\r\n          if (keymap.handle(sarea.area.ctx, e)) {\r\n            handled = true;\r\n            break;\r\n          }\r\n        }\r\n\r\n        sarea.area.pop_ctx_active();\r\n      }\r\n    }\r\n\r\n    return handled;\r\n  }\r\n\r\n  calcTabOrder() {\r\n    let nodes = [];\r\n    let visit = {};\r\n\r\n    let rec = (n) => {\r\n      let bad = n.tabIndex < 0 || n.tabIndex === undefined || n.tabIndex === null;\r\n      bad = bad || !(n instanceof UIBase);\r\n\r\n      if (n._id in visit || n.hidden) {\r\n        return;\r\n      }\r\n\r\n      visit[n._id] = 1;\r\n\r\n      if (!bad) {\r\n        n.__pos = n.getClientRects()[0];\r\n        if (n.__pos) {\r\n          nodes.push(n);\r\n        }\r\n      }\r\n\r\n      n._forEachChildWidget((n2) => {\r\n        rec(n2);\r\n      });\r\n    };\r\n\r\n    for (let sarea of this.sareas) {\r\n      rec(sarea);\r\n    }\r\n\r\n    for (let popup of this._popups) {\r\n      rec(popup);\r\n    }\r\n\r\n    //console.log(\"nodes2\", nodes2);\r\n    for (let i = 0; i < nodes.length; i++) {\r\n      let n = nodes[i];\r\n\r\n      n.tabIndex = i + 1;\r\n      //console.log(n.tabIndex);\r\n    }\r\n  }\r\n\r\n  drawUpdate() {\r\n    if (window.redraw_all !== undefined) {\r\n      window.redraw_all();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    let move = [];\r\n    for (let child of this.childNodes) {\r\n      if (child instanceof ScreenArea) {\r\n        move.push(child);\r\n      }\r\n    }\r\n\r\n    for (let child of move) {\r\n      console.warn(\"moved screen area to shadow\");\r\n\r\n      HTMLElement.prototype.remove.call(child);\r\n      this.shadow.appendChild(child);\r\n    }\r\n\r\n    if (this._do_updateSize) {\r\n      this.updateSize();\r\n    }\r\n\r\n    if (this.needsTabRecalc) {\r\n      this.needsTabRecalc = false;\r\n      this.calcTabOrder();\r\n    }\r\n\r\n    outer: for (let sarea of this.sareas) {\r\n      for (let b of sarea._borders) {\r\n        let movable = this.isBorderMovable(b);\r\n\r\n        if (movable !== b.movable) {\r\n          console.log(\"detected change in movable borders\");\r\n          this.regenBorders();\r\n          break outer;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (this._update_gen) {\r\n      let ret;\r\n\r\n      /*\r\n      if (cconst.DEBUG.debugUIUpdatePerf) {\r\n          for (ret = this._update_gen.next(); !ret.done; ret = this._update_gen.next()) {}\r\n\r\n        this._update_gen = this.update_intern();\r\n        return;\r\n      }\r\n      //*/\r\n\r\n      try {\r\n        ret = this._update_gen.next();\r\n      } catch (error) {\r\n        if (!(error instanceof DataPathError)) {\r\n          util.print_stack(error);\r\n          console.log(\"error in update_intern tasklet\");\r\n        }\r\n        return;\r\n      }\r\n\r\n      if (ret !== undefined && ret.done) {\r\n        this._update_gen = undefined;\r\n      }\r\n    } else {\r\n      this._update_gen = this.update_intern();\r\n    }\r\n  }\r\n\r\n  purgeUpdateStack() {\r\n    this._update_gen = undefined;\r\n    purgeUpdateStack();\r\n  }\r\n\r\n  completeSetCSS() {\r\n    let rec = (n) => {\r\n      n.setCSS();\r\n\r\n      if (n.packflag & PackFlags.NO_UPDATE) {\r\n        return;\r\n      }\r\n\r\n      n._forEachChildWidget((c) => {\r\n        rec(c);\r\n      })\r\n    }\r\n\r\n    rec(this);\r\n  }\r\n\r\n  completeUpdate() {\r\n    for (let step of this.update_intern()) {\r\n    }\r\n  }\r\n\r\n  updateScrollStyling() {\r\n    let s = theme.scrollbars;\r\n\r\n    if (!s || !s.color) return;\r\n\r\n    let key = \"\" + s.color + \":\" + s.color2 + \":\" + s.border + \":\" + s.contrast + \":\" + s.width;\r\n\r\n    if (key !== this._last_scrollstyle_key) {\r\n      this._last_scrollstyle_key = key;\r\n\r\n      //console.log(\"updating scrollbar styling\");\r\n\r\n      this.mergeGlobalCSS(styleScrollBars(s.color, s.color2, s.contrast, s.width, s.border, \"*\"));\r\n    }\r\n  }\r\n\r\n  //XXX race condition warning\r\n  update_intern() {\r\n    this.updateScrollStyling();\r\n\r\n    let popups = this._popups;\r\n\r\n    let cssText = \"\";\r\n    let sheet = this.globalCSS.sheet;\r\n    if (sheet) {\r\n      for (let rule of sheet.rules) {\r\n        cssText += rule.cssText + \"\\n\";\r\n      }\r\n\r\n      window.cssText = cssText\r\n    }\r\n    let cssTextHash = util.strhash(cssText);\r\n\r\n    if (this.needsBorderRegen) {\r\n      this.needsBorderRegen = false;\r\n      this.regenBorders();\r\n    }\r\n\r\n    super.update();\r\n    let this2 = this;\r\n\r\n    //ensure each area has proper ctx set\r\n    for (let sarea of this.sareas) {\r\n      if (!sarea.ctx) {\r\n        sarea.ctx = this.ctx;\r\n      }\r\n    }\r\n\r\n    return (function* () {\r\n      let stack = update_stack;\r\n      stack.cur = 0;\r\n\r\n      let lastn = this2;\r\n\r\n      function push(n) {\r\n        stack[stack.cur++] = n;\r\n      }\r\n\r\n      function pop(n) {\r\n        if (stack.cur < 0) {\r\n          throw new Error(\"Screen.update(): stack overflow!\");\r\n        }\r\n\r\n        return stack[--stack.cur];\r\n      }\r\n\r\n      let ctx = this2.ctx;\r\n\r\n      let SCOPE_POP = Symbol(\"pop\");\r\n      let AREA_CTX_POP = Symbol(\"pop2\");\r\n\r\n      let scopestack = [];\r\n      let areastack = [];\r\n\r\n      let t = util.time_ms();\r\n      push(this2);\r\n\r\n      for (let p of popups) {\r\n        push(p);\r\n      }\r\n\r\n      while (stack.cur > 0) {\r\n        let n = pop();\r\n\r\n        if (n === undefined) {\r\n          //console.log(\"eek!\", stack.length);\r\n          continue;\r\n        } else if (n === SCOPE_POP) {\r\n          scopestack.pop();\r\n          continue;\r\n        } else if (n === AREA_CTX_POP) {\r\n          //console.log(\"POP\", areastack[areastack.length-1].constructor.name);\r\n          areastack.pop().pop_ctx_active(ctx, true);\r\n          continue;\r\n        }\r\n\r\n        if (n instanceof Area) {\r\n          //console.log(\"PUSH\", n.constructor.name);\r\n          areastack.push(n);\r\n          n.push_ctx_active(ctx, true);\r\n          push(AREA_CTX_POP);\r\n        }\r\n\r\n        if (!n.hidden && n !== this2 && n instanceof UIBase) {\r\n          if (!n._ctx) {\r\n            n._ctx = ctx;\r\n          }\r\n\r\n          if (n._screenStyleUpdateHash !== cssTextHash) {\r\n            n._screenStyleTag.textContent = cssText;\r\n            n._screenStyleUpdateHash = cssTextHash;\r\n          }\r\n\r\n          if (scopestack.length > 0 && scopestack[scopestack.length - 1]) {\r\n            n.parentWidget = scopestack[scopestack.length - 1];\r\n\r\n            //if (n.parentWidget && n._useDataPathUndo === undefined && n.parentWidget._useDataPathUndo !== undefined) {\r\n            //  n._useDataPathUndo = n.parentWidget._useDataPathUndo;\r\n            //}\r\n          }\r\n\r\n          n.update();\r\n        }\r\n\r\n        if (util.time_ms() - t > 20) {\r\n          yield;\r\n          t = util.time_ms();\r\n        }\r\n\r\n        for (let n2 of n.childNodes) {\r\n          if (!(n2 instanceof UIBase) || !(n2.packflag & PackFlags.NO_UPDATE)) {\r\n            push(n2);\r\n          }\r\n        }\r\n\r\n        if (n.shadow === undefined) {\r\n          continue;\r\n        }\r\n\r\n        for (let n2 of n.shadow.childNodes) {\r\n          if (!(n2 instanceof UIBase) || !(n2.packflag & PackFlags.NO_UPDATE)) {\r\n            push(n2);\r\n          }\r\n        }\r\n\r\n        if (n instanceof UIBase) {\r\n          if (!(n.packflag & PackFlags.NO_UPDATE)) {\r\n            scopestack.push(n);\r\n            push(SCOPE_POP);\r\n          }\r\n        }\r\n      }\r\n    })();\r\n  }\r\n\r\n  //load pos/size from screenverts\r\n  loadFromVerts() {\r\n    let old = [0, 0];\r\n    for (let sarea of this.sareas) {\r\n      old[0] = sarea.size[0];\r\n      old[1] = sarea.size[1];\r\n\r\n      sarea.loadFromVerts();\r\n      sarea.on_resize(old);\r\n      sarea.setCSS();\r\n    }\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  /** merges sarea into the screen area opposite to sarea*/\r\n  collapseArea(sarea, border) {\r\n    let sarea2;\r\n\r\n    if (!border) {\r\n      for (let b of sarea._borders) {\r\n        let sarea2 = b.getOtherSarea(sarea);\r\n\r\n        if (sarea2 && !b.locked) {\r\n          border = b;\r\n          break;\r\n        }\r\n      }\r\n    } else if (border.locked) {\r\n      console.warn(\"Cannot remove screen border\");\r\n    }\r\n\r\n    console.warn(\"SAREA2\", border, sarea2, sarea2 !== sarea);\r\n\r\n    if (border) {\r\n      sarea2 = border.getOtherSarea(sarea);\r\n\r\n      if (!sarea2) {\r\n        console.error(\"Error merging sarea\");\r\n        return;\r\n      }\r\n\r\n      let size1 = new Vector2(sarea.pos).add(sarea.size);\r\n      let size2 = new Vector2(sarea2.pos).add(sarea2.size);\r\n\r\n      sarea2.pos.min(sarea.pos);\r\n      sarea2.size.load(size1).max(size2).sub(sarea2.pos);\r\n\r\n      sarea2.loadFromPosSize();\r\n    }\r\n\r\n    this.sareas.remove(sarea);\r\n    sarea.remove();\r\n\r\n    this.regenScreenMesh();\r\n    this._internalRegenAll();\r\n\r\n    return this;\r\n  }\r\n\r\n  splitArea(sarea, t = 0.5, horiz = true) {\r\n    let w = sarea.size[0], h = sarea.size[1];\r\n    let x = sarea.pos[0], y = sarea.size[1];\r\n    let s1, s2;\r\n\r\n    if (!horiz) {\r\n      s1 = sarea;\r\n      if (s1.ctx === undefined) {\r\n        s1.ctx = this.ctx;\r\n      }\r\n      s2 = s1.copy(this);\r\n\r\n      s1.size[0] *= t;\r\n      s2.size[0] *= (1.0 - t);\r\n\r\n      s2.pos[0] += w*t;\r\n    } else {\r\n      s1 = sarea;\r\n      if (s1.ctx === undefined) {\r\n        s1.ctx = this.ctx;\r\n      }\r\n      s2 = s1.copy(this);\r\n\r\n      s1.size[1] *= t;\r\n      s2.size[1] *= (1.0 - t);\r\n\r\n      s2.pos[1] += h*t;\r\n    }\r\n\r\n    s2.ctx = this.ctx;\r\n    this.appendChild(s2);\r\n\r\n    s1.on_resize(s1.size);\r\n    s2.on_resize(s2.size);\r\n\r\n    this.regenBorders();\r\n    this.solveAreaConstraints();\r\n\r\n    s1.setCSS();\r\n    s2.setCSS();\r\n\r\n    this.setCSS();\r\n\r\n    //XXX not sure if this is right place to do this or really necassary\r\n    if (s2.area !== undefined)\r\n      s2.area.onadd();\r\n\r\n    return s2;\r\n  }\r\n\r\n  setCSS() {\r\n    if (!this.getBoolAttribute(\"inherit-scale\")) {\r\n      this.style[\"width\"] = this.size[0] + \"px\";\r\n      this.style[\"height\"] = this.size[1] + \"px\";\r\n    }\r\n\r\n    this.style[\"overflow\"] = \"hidden\";\r\n\r\n    //call setCSS on borders\r\n    for (let key in this._edgemap) {\r\n      let b = this._edgemap[key];\r\n\r\n      b.setCSS();\r\n    }\r\n  }\r\n\r\n  regenScreenMesh(snapLimit = SnapLimit) {\r\n    this.snapLimit = snapLimit;\r\n\r\n    this.regenBorders();\r\n  }\r\n\r\n  regenBorders_stage2() {\r\n    for (let b of this.screenborders) {\r\n      b.halfedges = []\r\n    }\r\n\r\n    function hashHalfEdge(border, sarea) {\r\n      return border._id + \":\" + sarea._id;\r\n    }\r\n\r\n    function has_he(border, border2, sarea) {\r\n      for (let he of border.halfedges) {\r\n        if (border2 === he.border && sarea === he.sarea) {\r\n          return true;\r\n        }\r\n      }\r\n\r\n      return false;\r\n    }\r\n\r\n    for (let b1 of this.screenborders) {\r\n      for (let sarea of b1.sareas) {\r\n        let he = new ScreenHalfEdge(b1, sarea);\r\n        b1.halfedges.push(he);\r\n      }\r\n\r\n      let axis = b1.horiz ? 1 : 0;\r\n\r\n      let min = Math.min(b1.v1[axis], b1.v2[axis]);\r\n      let max = Math.max(b1.v1[axis], b1.v2[axis]);\r\n\r\n      for (let b2 of this.walkBorderLine(b1)) {\r\n        if (b1 === b2) {\r\n          continue;\r\n        }\r\n\r\n        let ok = b2.v1[axis] >= min && b2.v1[axis] <= max;\r\n        ok = ok || (b2.v2[axis] >= min && b2.v2[axis] <= max);\r\n\r\n        for (let sarea of b2.sareas) {\r\n          let ok2 = ok && !has_he(b2, b1, sarea);\r\n          if (ok2) {\r\n            let he2 = new ScreenHalfEdge(b2, sarea);\r\n            b1.halfedges.push(he2);\r\n          }\r\n        }\r\n\r\n      }\r\n    }\r\n\r\n\r\n    for (let b of this.screenborders) {\r\n      let movable = true;\r\n\r\n      for (let sarea of b.sareas) {\r\n        movable = movable && this.isBorderMovable(b);\r\n      }\r\n\r\n      b.movable = movable;\r\n    }\r\n  }\r\n\r\n  hasBorder(b) {\r\n    return b._id in this._idmap;\r\n  }\r\n\r\n  killScreenVertex(v) {\r\n    this.screenverts.remove(v);\r\n\r\n    delete this._edgemap[ScreenVert.hash(v, undefined, this.snapLimit)];\r\n    delete this._idmap[v._id];\r\n\r\n    return this;\r\n  }\r\n\r\n  freeBorder(b, sarea) {\r\n    if (b.sareas.indexOf(sarea) >= 0) {\r\n      b.sareas.remove(sarea);\r\n    }\r\n\r\n    let dels = [];\r\n\r\n    for (let he of b.halfedges) {\r\n      if (he.sarea === sarea) {\r\n        dels.push([b, he]);\r\n      }\r\n\r\n      for (let he2 of he.border.halfedges) {\r\n        if (he2 === he)\r\n          continue;\r\n\r\n        if (he2.sarea === sarea) {\r\n          dels.push([he.border, he2]);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let d of dels) {\r\n      if (d[0].halfedges.indexOf(d[1]) < 0) {\r\n        console.warn(\"Double remove detected; use util.set?\");\r\n        continue;\r\n      }\r\n\r\n      d[0].halfedges.remove(d[1]);\r\n    }\r\n\r\n    if (b.sareas.length === 0) {\r\n      this.killBorder(b);\r\n    }\r\n  }\r\n\r\n  killBorder(b) {\r\n    console.log(\"killing border\", b._id, b);\r\n\r\n    if (this.screenborders.indexOf(b) < 0) {\r\n      console.log(\"unknown border\", b);\r\n      b.remove();\r\n      return;\r\n    }\r\n\r\n    this.screenborders.remove(b);\r\n\r\n    let del = [];\r\n\r\n    for (let he of b.halfedges) {\r\n      if (he === he2)\r\n        continue;\r\n\r\n      for (let he2 of he.border.halfedges) {\r\n        if (he2.border === b) {\r\n          del.push([he.border, he2]);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let d of del) {\r\n      d[0].halfedges.remove(d[1]);\r\n    }\r\n\r\n    delete this._edgemap[ScreenBorder.hash(b.v1, b.v2)];\r\n    delete this._idmap[b._id];\r\n\r\n    b.v1.borders.remove(b);\r\n    b.v2.borders.remove(b);\r\n\r\n    if (b.v1.borders.length === 0) {\r\n      this.killScreenVertex(b.v1);\r\n    }\r\n    if (b.v2.borders.length === 0) {\r\n      this.killScreenVertex(b.v2);\r\n    }\r\n\r\n    b.remove();\r\n\r\n    return this;\r\n  }\r\n\r\n  //XXX rename to regenScreenMesh\r\n  regenBorders() {\r\n\r\n    for (let b of this.screenborders) {\r\n      b.remove();\r\n      HTMLElement.prototype.remove.call(b);\r\n    }\r\n\r\n    this._idmap = {};\r\n    this.screenborders = [];\r\n    this._edgemap = {};\r\n    this._vertmap = {};\r\n    this.screenverts = []\r\n\r\n    for (let sarea of this.sareas) {\r\n      if (sarea.hidden) continue;\r\n\r\n      sarea.makeBorders(this);\r\n    }\r\n\r\n    for (let key in this._edgemap) {\r\n      let b = this._edgemap[key];\r\n\r\n      b.setCSS();\r\n    }\r\n\r\n    this.regenBorders_stage2();\r\n    this._recalcAABB();\r\n\r\n    for (let b of this.screenborders) {\r\n      b.outer = this.isBorderOuter(b);\r\n      b.movable = this.isBorderMovable(b);\r\n      b.setCSS();\r\n    }\r\n\r\n    this.updateDebugBoxes();\r\n  }\r\n\r\n  _get_debug_overlay() {\r\n    if (!this._debug_overlay) {\r\n      this._debug_overlay = UIBase.createElement(\"overdraw-x\");\r\n      let s = this._debug_overlay;\r\n\r\n      s.startNode(this, this);\r\n    }\r\n\r\n    return this._debug_overlay;\r\n  }\r\n\r\n  updateDebugBoxes() {\r\n    if (cconst.DEBUG.screenborders) {\r\n      let overlay = this._get_debug_overlay();\r\n      overlay.clear();\r\n\r\n      for (let b of this.screenborders) {\r\n        overlay.line(b.v1, b.v2, \"red\");\r\n      }\r\n      let del = [];\r\n      for (let child of document.body.childNodes) {\r\n        if (child.getAttribute && child.getAttribute(\"class\") === \"__debug\") {\r\n          del.push(child);\r\n        }\r\n      }\r\n      for (let n of del) {\r\n        n.remove();\r\n      }\r\n\r\n      let box = (x, y, s, text, color = \"red\") => {\r\n        x -= s*0.5;\r\n        y -= s*0.5;\r\n\r\n        x = Math.min(Math.max(x, 0.0), this.size[0] - s);\r\n        y = Math.min(Math.max(y, 0.0), this.size[1] - s);\r\n\r\n        let ret = UIBase.createElement(\"div\");\r\n        ret.setAttribute(\"class\", \"__debug\");\r\n\r\n\r\n        ret.style[\"position\"] = UIBase.PositionKey;\r\n        ret.style[\"left\"] = x + \"px\";\r\n        ret.style[\"top\"] = y + \"px\";\r\n        ret.style[\"height\"] = s + \"px\";\r\n        ret.style[\"width\"] = s + \"px\";//\"200px\";\r\n        ret.style[\"z-index\"] = \"1000\";\r\n        ret.style[\"pointer-events\"] = \"none\";\r\n        ret.style[\"padding\"] = ret.style[\"margin\"] = \"0px\";\r\n        ret.style['display'] = \"float\";\r\n        ret.style[\"background-color\"] = color;\r\n        document.body.appendChild(ret);\r\n\r\n        let colors = [\r\n          \"orange\",\r\n          \"black\",\r\n          \"white\",\r\n        ];\r\n\r\n        for (let i = 2; i >= 0; i--) {\r\n          ret = UIBase.createElement(\"div\");\r\n\r\n          ret.setAttribute(\"class\", \"__debug\");\r\n\r\n          ret.style[\"position\"] = UIBase.PositionKey;\r\n          ret.style[\"left\"] = x + \"px\";\r\n          ret.style[\"top\"] = y + \"px\";\r\n          ret.style[\"height\"] = s + \"px\";\r\n          ret.style[\"width\"] = \"250px\";//\"200px\";\r\n          ret.style[\"z-index\"] = \"\" + (1005 - i - 1);\r\n          ret.style[\"pointer-events\"] = \"none\";\r\n          ret.style[\"color\"] = colors[i];\r\n\r\n          let w = (i)*2;\r\n          ret.style[\"-webkit-text-stroke-width\"] = w + \"px\";\r\n          ret.style[\"-webkit-text-stroke-color\"] = colors[i];\r\n          ret.style[\"text-stroke-width\"] = w + \"px\";\r\n          ret.style[\"text-stroke-color\"] = colors[i];\r\n\r\n          ret.style[\"padding\"] = ret.style[\"margin\"] = \"0px\";\r\n          ret.style['display'] = \"float\";\r\n          ret.style[\"background-color\"] = \"rgba(0,0,0,0)\";\r\n          ret.innerText = \"\" + text;\r\n          document.body.appendChild(ret);\r\n        }\r\n\r\n      };\r\n\r\n      for (let v of this.screenverts) {\r\n        box(v[0], v[1], 10*v.borders.length, \"\" + v.borders.length, \"rgba(255,0,0,0.5)\");\r\n      }\r\n\r\n      for (let b of this.screenborders) {\r\n        for (let he of b.halfedges) {\r\n          let txt = `${he.side}, ${b.sareas.length}, ${b.halfedges.length}`;\r\n          let p = new Vector2(b.v1).add(b.v2).mulScalar(0.5);\r\n          let size = 10*b.halfedges.length;\r\n\r\n          let wadd = 25 + size*0.5;\r\n          let axis = b.horiz & 1;\r\n\r\n          if (p[axis] > he.sarea.pos[axis]) {\r\n            p[axis] -= wadd;\r\n          } else {\r\n            p[axis] += wadd;\r\n          }\r\n          box(p[0], p[1], size, txt, \"rgba(155,255,75,0.5)\")\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  checkAreaConstraint(sarea, checkOnly = false) {\r\n    let min = sarea.minSize, max = sarea.maxSize;\r\n    let vs = sarea._verts;\r\n    let chg = 0.0;\r\n    let mask = 0;\r\n\r\n    let moveBorder = (sidea, sideb, dh) => {\r\n      let b1 = sarea._borders[sidea];\r\n      let b2 = sarea._borders[sideb];\r\n      let bad = 0;\r\n\r\n      for (let i = 0; i < 2; i++) {\r\n        let b = i ? b2 : b1;\r\n        let bad2 = sarea.borderLock & (1<<sidea);\r\n\r\n        bad2 = bad2 || !b.movable;\r\n        bad2 = bad2 || this.isBorderOuter(b);\r\n\r\n        if (bad2)\r\n          bad |= 1<<i;\r\n      }\r\n\r\n      if (bad === 0) {\r\n        this.moveBorder(b1, dh*0.5);\r\n        this.moveBorder(b2, -dh*0.5);\r\n      } else if (bad === 1) {\r\n        this.moveBorder(b2, -dh);\r\n      } else if (bad === 2) {\r\n        this.moveBorder(b1, dh);\r\n      } else if (bad === 3) {\r\n        //both borders are bad, yet we need to move anyway. . .\r\n        //console.warn(\"got case of two borders being bad\");\r\n\r\n        if (!this.isBorderOuter(b1)) {\r\n          this.moveBorder(b1, dh);\r\n        } else if (!this.isBorderOuter(b2)) {\r\n          this.moveBorder(b2, -dh);\r\n        } else {\r\n          this.moveBorder(b1, dh*0.5);\r\n          this.moveBorder(b2, -dh*0.5);\r\n        }\r\n      }\r\n    };\r\n\r\n    if (max[0] !== undefined && sarea.size[0] > max[0]) {\r\n      let dh = (sarea.size[0] - max[0]);\r\n      chg += Math.abs(dh);\r\n      mask |= 1;\r\n\r\n      moveBorder(0, 2, dh);\r\n    }\r\n\r\n    if (min[0] !== undefined && sarea.size[0] < min[0]) {\r\n      let dh = (min[0] - sarea.size[0]);\r\n      chg += Math.abs(dh);\r\n      mask |= 2;\r\n\r\n      moveBorder(2, 0, dh);\r\n    }\r\n\r\n\r\n    if (max[1] !== undefined && sarea.size[1] > max[1]) {\r\n      let dh = (sarea.size[1] - max[1]);\r\n      chg += Math.abs(dh);\r\n      mask |= 4;\r\n\r\n      moveBorder(3, 1, dh);\r\n    }\r\n\r\n    if (min[1] !== undefined && sarea.size[1] < min[1]) {\r\n      let dh = (min[1] - sarea.size[1]);\r\n      chg += Math.abs(dh);\r\n      mask |= 8;\r\n\r\n      moveBorder(1, 3, dh);\r\n    }\r\n\r\n    if (sarea.pos[0] + sarea.size[0] > this.size[0]) {\r\n      mask |= 16;\r\n      let dh = ((this.size[0] - sarea.size[0]) - sarea.pos[0]);\r\n\r\n      chg += Math.abs(dh);\r\n\r\n      if (sarea.floating) {\r\n        sarea.pos[0] = this.size[0] - sarea.size[0];\r\n        sarea.loadFromPosSize();\r\n      } else {\r\n        this.moveBorder(sarea._borders[0], dh);\r\n        this.moveBorder(sarea._borders[2], dh);\r\n      }\r\n    }\r\n\r\n    if (chg === 0.0) {\r\n      return false;\r\n    }\r\n\r\n    return mask;\r\n  }\r\n\r\n  walkBorderLine(b) {\r\n    let visit = new util.set();\r\n    let ret = [b];\r\n    visit.add(b);\r\n\r\n    let rec = (b, v) => {\r\n      for (let b2 of v.borders) {\r\n        if (b2 === b) {\r\n          continue;\r\n        }\r\n\r\n        if (b2.horiz === b.horiz && !visit.has(b2)) {\r\n          visit.add(b2);\r\n          ret.push(b2);\r\n          rec(b2, b2.otherVertex(v));\r\n        }\r\n      }\r\n    }\r\n\r\n    rec(b, b.v1);\r\n    let ret2 = ret;\r\n    ret = [];\r\n\r\n    rec(b, b.v2);\r\n    ret2.reverse();\r\n\r\n    return ret2.concat(ret);\r\n  }\r\n\r\n  moveBorderWithoutVerts(halfedge, df) {\r\n    let side = halfedge.side;\r\n    let sarea = halfedge.sarea;\r\n\r\n    switch (side) {\r\n      case 0:\r\n        sarea.pos[0] += df;\r\n        sarea.size[0] -= df;\r\n        break;\r\n      case 1:\r\n        sarea.size[1] += df;\r\n        break;\r\n      case 2:\r\n        sarea.size[0] += df;\r\n        break;\r\n      case 3:\r\n        sarea.pos[1] += df;\r\n        sarea.size[1] -= df;\r\n        break;\r\n    }\r\n  }\r\n\r\n  moveBorder(b, df, strict = true) {\r\n    return this.moveBorderSimple(b, df, strict);\r\n  }\r\n\r\n  moveBorderSimple(b, df, strict = true) {\r\n    let axis = b.horiz & 1;\r\n    let axis2 = axis ^ 1;\r\n\r\n    let min = Math.min(b.v1[axis2], b.v2[axis2]);\r\n    let max = Math.max(b.v1[axis2], b.v2[axis2]);\r\n\r\n    let test = (v) => {\r\n      return v[axis2] >= min && v[axis2] <= max;\r\n    };\r\n\r\n    let vs = new util.set();\r\n\r\n    for (let b2 of this.walkBorderLine(b)) {\r\n      if (strict && !test(b2.v1) && !test(b2.v2)) {\r\n        return false;\r\n      }\r\n\r\n      vs.add(b2.v1);\r\n      vs.add(b2.v2);\r\n    }\r\n\r\n    for (let v of vs) {\r\n      v[axis] += df;\r\n    }\r\n\r\n    for (let v of vs) {\r\n      for (let b of v.borders) {\r\n        for (let sarea of b.sareas) {\r\n          sarea.loadFromVerts();\r\n        }\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  moveBorderUnused(b, df, strict = true) {\r\n    if (!b) {\r\n      console.warn(\"missing border\");\r\n      return false;\r\n    }\r\n\r\n    let axis = b.horiz & 1;\r\n\r\n    let vs = new util.set();\r\n\r\n    let visit = new util.set();\r\n\r\n    let axis2 = axis ^ 1;\r\n\r\n    let min = Math.min(b.v1[axis2], b.v2[axis2]);\r\n    let max = Math.max(b.v1[axis2], b.v2[axis2]);\r\n\r\n    let test = (v) => {\r\n      return v[axis2] >= min && v[axis2] <= max;\r\n    };\r\n\r\n    let first = true;\r\n    let found = false;\r\n    let halfedges = new util.set();\r\n    let borders = new util.set();\r\n\r\n    for (let b2 of this.walkBorderLine(b)) {\r\n      /*\r\n      if (first) {\r\n        first = false;\r\n        df = Math.max(Math.abs(df), FrameManager_mesh.SnapLimit) * Math.sign(df);\r\n      }\r\n      found = true;\r\n      for (let sarea of b2.sareas) {\r\n        halfedges.add(new ScreenHalfEdge(b2, sarea))\r\n      }\r\n      vs.add(b2.v1);\r\n      vs.add(b2.v2);\r\n      continue;\r\n      //*/\r\n\r\n      if (!strict) {\r\n        vs.add(b2.v1);\r\n        vs.add(b2.v2);\r\n        continue;\r\n      }\r\n\r\n\r\n      let t1 = test(b2.v1), t2 = test(b2.v2);\r\n\r\n      if (!t1 || !t2) {\r\n        found = true;\r\n\r\n        if (first) {\r\n          first = false;\r\n          df = Math.max(Math.abs(df), FrameManager_mesh.SnapLimit)*Math.sign(df);\r\n        }\r\n      }\r\n      if (!t1 && !t2) {\r\n        continue;\r\n      }\r\n\r\n      borders.add(b2);\r\n\r\n      //make dummy half edges to keep track of border/sarea pairs\r\n      //and especailly what the border side is\r\n      for (let sarea of b2.sareas) {\r\n        halfedges.add(new ScreenHalfEdge(b2, sarea))\r\n      }\r\n\r\n      vs.add(b2.v1);\r\n      vs.add(b2.v2);\r\n    }\r\n\r\n    for (let b2 of this.walkBorderLine(b)) {\r\n      if (borders.has(b2)) {\r\n        continue;\r\n      }\r\n\r\n      for (let he of b2.halfedges) {\r\n        borders.remove(he.border);\r\n        if (halfedges.has(he)) {\r\n          halfedges.remove(he);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let v of vs) {\r\n      let ok = v[axis2] >= min && v[axis2] <= max;\r\n\r\n      if (!ok && strict) {\r\n        //   return false;\r\n      }\r\n    }\r\n\r\n    if (!found || !strict) {\r\n      for (let v of vs) {\r\n        v[axis] += df;\r\n      }\r\n    } else {\r\n      let borders = new util.set();\r\n\r\n      for (let he of halfedges) {\r\n        borders.add(he.border);\r\n        this.moveBorderWithoutVerts(he, df);\r\n      }\r\n\r\n      for (let he of halfedges) {\r\n        he.sarea.loadFromPosSize();\r\n      }\r\n\r\n      for (let b of borders) {\r\n        let sareas = b.sareas.slice(0, b.sareas.length);\r\n\r\n        this.killBorder(b);\r\n        for (let sarea of sareas) {\r\n          sarea.loadFromPosSize();\r\n        }\r\n      }\r\n\r\n      return halfedges.length > 0;\r\n    }\r\n\r\n\r\n    for (let sarea of b.sareas) {\r\n      sarea.loadFromVerts();\r\n    }\r\n\r\n    for (let he of b.halfedges) {\r\n      he.sarea.loadFromVerts();\r\n\r\n      for (let sarea of he.border.sareas) {\r\n        sarea.loadFromVerts();\r\n        for (let b2 of sarea._borders) {\r\n          b2.setCSS();\r\n        }\r\n      }\r\n    }\r\n\r\n    b.setCSS();\r\n\r\n    return true;\r\n  }\r\n\r\n  solveAreaConstraints(snapArgument = true) {\r\n    let repeat = false;\r\n    let found = false;\r\n\r\n    let time = util.time_ms();\r\n\r\n    for (let i = 0; i < 10; i++) {\r\n      repeat = false;\r\n\r\n      for (let sarea of this.sareas) {\r\n        if (sarea.hidden) continue;\r\n\r\n        repeat = repeat || this.checkAreaConstraint(sarea);\r\n      }\r\n\r\n      found = found || repeat;\r\n\r\n      if (repeat) {\r\n        for (let sarea of this.sareas) {\r\n          sarea.loadFromVerts();\r\n        }\r\n\r\n        this.snapScreenVerts(snapArgument);\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (found) {\r\n      this.snapScreenVerts(snapArgument);\r\n      if (cconst.DEBUG.areaConstraintSolver) {\r\n        time = util.time_ms() - time;\r\n\r\n        console.log(`enforced area constraint ${time.toFixed(2)}ms`);\r\n      }\r\n      this._recalcAABB();\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  snapScreenVerts(fitToSize = true) {\r\n    let this2 = this;\r\n\r\n    function* screenverts() {\r\n      for (let v of this2.screenverts) {\r\n        let ok = 0;\r\n\r\n        for (let sarea of v.sareas) {\r\n          if (!(sarea.flag & AreaFlags.INDEPENDENT)) {\r\n            ok = 1;\r\n          }\r\n        }\r\n\r\n        if (ok) {\r\n          yield v;\r\n        }\r\n      }\r\n    }\r\n\r\n    let mm = new math.MinMax(2);\r\n    for (let v of screenverts()) {\r\n      mm.minmax(v);\r\n    }\r\n\r\n    let min = mm.min, max = mm.max;\r\n\r\n    //snap(min);\r\n    //snapi(max);\r\n\r\n    if (fitToSize) {\r\n      //fit entire screen to, well, the entire screen (size)\r\n      let vec = new Vector2(max).sub(min);\r\n      let sz = new Vector2(this.size);\r\n\r\n      sz.div(vec);\r\n\r\n      for (let v of screenverts()) {\r\n        v.sub(min).mul(sz);\r\n        //snap(v.sub(min).mul(sz));//.add(this.pos);\r\n      }\r\n\r\n      for (let v of screenverts()) {\r\n        v[0] += this.pos[0];\r\n        v[1] += this.pos[1];\r\n      }\r\n\r\n      //this.pos.zero();\r\n    } else {\r\n      for (let v of screenverts()) {\r\n        //snap(v);\r\n      }\r\n\r\n      [min, max] = this._recalcAABB();\r\n\r\n      //snap(min);\r\n      //snapi(max);\r\n\r\n      this.size.load(max).sub(min);\r\n      //this.pos.zero();\r\n      //this.pos.load(min);\r\n    }\r\n\r\n    let found = 1;\r\n\r\n    for (let sarea of this.sareas) {\r\n      if (sarea.hidden) continue;\r\n\r\n      let old = new Vector2(sarea.size);\r\n      let oldpos = new Vector2(sarea.pos);\r\n\r\n      sarea.loadFromVerts();\r\n\r\n      found = found || old.vectorDistance(sarea.size) > 1;\r\n      found = found || oldpos.vectorDistance(sarea.pos) > 1;\r\n\r\n      sarea.on_resize(old);\r\n    }\r\n\r\n    if (found) {\r\n      //this.regenBorders();\r\n      this._recalcAABB();\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  on_resize(oldsize, newsize = this.size, _set_key = true) {\r\n    //console.warn(\"resizing\");\r\n\r\n    if (_set_key) {\r\n      this._last_ckey1 = this._calcSizeKey(newsize[0], newsize[1], this.pos[0], this.pos[1], devicePixelRatio, visualViewport.scale);\r\n    }\r\n\r\n    let ratio = [newsize[0]/oldsize[0], newsize[1]/oldsize[1]];\r\n\r\n    let offx = this.pos[0] - this.oldpos[0];\r\n    let offy = this.pos[1] - this.oldpos[1];\r\n\r\n    this.oldpos.load(this.pos);\r\n\r\n    //console.log(\"resize!\", ratio);\r\n\r\n    for (let v of this.screenverts) {\r\n      v[0] *= ratio[0];\r\n      v[1] *= ratio[1];\r\n      v[0] += offx;\r\n      v[1] += offy;\r\n    }\r\n\r\n    let min = [1e17, 1e17], max = [-1e17, -1e17];\r\n    let olds = [];\r\n\r\n    for (let sarea of this.sareas) {\r\n      olds.push([sarea.size[0], sarea.size[1]]);\r\n\r\n      sarea.loadFromVerts();\r\n    }\r\n\r\n    this.size[0] = newsize[0];\r\n    this.size[1] = newsize[1];\r\n\r\n    this.snapScreenVerts();\r\n    this.solveAreaConstraints();\r\n    this._recalcAABB();\r\n\r\n\r\n    let i = 0;\r\n    for (let sarea of this.sareas) {\r\n      sarea.on_resize(sarea.size, olds[i]);\r\n      sarea.setCSS();\r\n      i++;\r\n    }\r\n\r\n    this.regenBorders();\r\n    this.setCSS();\r\n    this.calcTabOrder();\r\n\r\n    this._fireResizeCB(oldsize);\r\n  }\r\n\r\n  _fireResizeCB(oldsize = this.size) {\r\n    for (let cb of this._resize_callbacks) {\r\n      cb(oldsize);\r\n    }\r\n  }\r\n\r\n  getScreenVert(pos, added_id = \"\", floating = false) {\r\n    let key = ScreenVert.hash(pos, added_id, this.snapLimit);\r\n\r\n    if (floating || !(key in this._vertmap)) {\r\n      let v = new ScreenVert(pos, this.idgen++, added_id);\r\n\r\n      this._vertmap[key] = v;\r\n      this._idmap[v._id] = v;\r\n\r\n      this.screenverts.push(v);\r\n    }\r\n\r\n    return this._vertmap[key];\r\n  }\r\n\r\n  isBorderOuter(border) {\r\n    let sides = 0;\r\n\r\n    for (let he of border.halfedges) {\r\n      sides |= 1<<he.side;\r\n    }\r\n\r\n    let bits = 0;\r\n    for (let i = 0; i < 4; i++) {\r\n      bits += (sides & (1<<i)) ? 1 : 0;\r\n    }\r\n\r\n    let ret = bits < 2;\r\n    let floating = false;\r\n\r\n    for (let sarea of border.sareas) {\r\n      floating = floating || sarea.floating;\r\n    }\r\n\r\n    if (floating) {\r\n      //check if border is on screen limits\r\n      let axis = border.horiz ? 1 : 0;\r\n\r\n      ret = Math.abs(border.v1[axis] - this.pos[axis]) < 4;\r\n      ret = ret || Math.abs(border.v1[axis] - this.pos[axis] - this.size[axis]) < 4;\r\n    }\r\n\r\n    border.outer = ret;\r\n    return ret;\r\n  }\r\n\r\n  isBorderMovable(b, limit = 5) {\r\n    if (this.allBordersMovable)\r\n      return true;\r\n\r\n    for (let he of b.halfedges) {\r\n      if (he.sarea.borderLock & (1<<he.side)) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    let ok = !this.isBorderOuter(b);\r\n\r\n    for (let sarea of b.sareas) {\r\n      if (sarea.floating) {\r\n        ok = true;\r\n        break;\r\n      }\r\n    }\r\n\r\n    return ok;\r\n  }\r\n\r\n  getScreenBorder(sarea, v1, v2, side) {\r\n    let suffix = sarea._get_v_suffix();\r\n\r\n    if (!(v1 instanceof ScreenVert)) {\r\n      v1 = this.getScreenVert(v1, suffix);\r\n    }\r\n\r\n    if (!(v2 instanceof ScreenVert)) {\r\n      v2 = this.getScreenVert(v2, suffix);\r\n    }\r\n\r\n    let hash = ScreenBorder.hash(v1, v2);\r\n\r\n    if (!(hash in this._edgemap)) {\r\n      let sb = this._edgemap[hash] = UIBase.createElement(\"screenborder-x\");\r\n\r\n      sb._hash = hash;\r\n      sb.screen = this;\r\n      sb.v1 = v1;\r\n      sb.v2 = v2;\r\n      sb._id = this.idgen++;\r\n\r\n      v1.borders.push(sb);\r\n      v2.borders.push(sb);\r\n\r\n      sb.ctx = this.ctx;\r\n\r\n      this.screenborders.push(sb);\r\n      this.appendChild(sb);\r\n\r\n      sb.setCSS();\r\n\r\n      this._edgemap[hash] = sb;\r\n      this._idmap[sb._id] = sb;\r\n    }\r\n\r\n    return this._edgemap[hash];\r\n  }\r\n\r\n  minmaxArea(sarea, mm = undefined) {\r\n    if (mm === undefined) {\r\n      mm = new math.MinMax(2);\r\n    }\r\n\r\n    for (let b of sarea._borders) {\r\n      mm.minmax(b.v1);\r\n      mm.minmax(b.v2);\r\n    }\r\n\r\n    return mm;\r\n  }\r\n\r\n  //does sarea1 border sarea2?\r\n  areasBorder(sarea1, sarea2) {\r\n    for (let b of sarea1._borders) {\r\n      for (let sa of b.sareas) {\r\n        if (sa === sarea2)\r\n          return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  //regenerates borders, sets css and calls this.update\r\n\r\n  replaceArea(dst, src) {\r\n    if (dst === src)\r\n      return;\r\n\r\n    src.pos[0] = dst.pos[0];\r\n    src.pos[1] = dst.pos[1];\r\n    src.size[0] = dst.size[0];\r\n    src.size[1] = dst.size[1];\r\n\r\n    src.floating = dst.floating;\r\n    src._borders = dst._borders;\r\n    src._verts = dst._verts;\r\n\r\n    if (this.sareas.indexOf(src) < 0) {\r\n      this.sareas.push(src);\r\n      this.shadow.appendChild(src);\r\n    }\r\n\r\n    if (this.sareas.active === dst) {\r\n      this.sareas.active = src;\r\n    }\r\n\r\n    //this.sareas.remove(dst);\r\n    //dst.remove();\r\n\r\n    this.sareas.remove(dst);\r\n    dst.remove();\r\n\r\n    this.regenScreenMesh();\r\n    this.snapScreenVerts();\r\n    this._updateAll();\r\n  }\r\n\r\n  _internalRegenAll() {\r\n    this.snapScreenVerts();\r\n    this._recalcAABB();\r\n    this.calcTabOrder();\r\n    this.setCSS();\r\n\r\n    this.completeUpdate();\r\n    this.completeSetCSS();\r\n    this.completeUpdate();\r\n  }\r\n\r\n  _updateAll() {\r\n    for (let sarea of this.sareas) {\r\n      sarea.setCSS();\r\n    }\r\n    this.setCSS();\r\n    this.update();\r\n  }\r\n\r\n  removeArea(sarea) {\r\n    if (this.sareas.indexOf(sarea) < 0) {\r\n      console.warn(sarea, \"<- Warning: tried to remove unknown area\");\r\n      return;\r\n    }\r\n\r\n    this.sareas.remove(sarea);\r\n    sarea.remove();\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      this.snapScreenVerts();\r\n      this.regenScreenMesh();\r\n    }\r\n\r\n    this._updateAll();\r\n    this.drawUpdate();\r\n  }\r\n\r\n  appendChild(child) {\r\n    /*\r\n    if (child instanceof UIBase) {\r\n      if (child._useDataPathUndo === undefined) {\r\n        child.useDataPathUndo = this.useDataPathUndo;\r\n      }\r\n    }*/\r\n\r\n    if (child instanceof ScreenArea.ScreenArea) {\r\n      child.screen = this;\r\n      child.ctx = this.ctx;\r\n      child.parentWidget = this;\r\n\r\n      this.sareas.push(child);\r\n\r\n      if (child.size.dot(child.size) === 0) {\r\n        child.size[0] = this.size[0];\r\n        child.size[1] = this.size[1];\r\n      }\r\n\r\n      if (!child._has_evts) {\r\n        child._has_evts = true;\r\n\r\n        let onfocus = (e) => {\r\n          this.sareas.active = child;\r\n        }\r\n\r\n        let onblur = (e) => {\r\n          //XXX this is causing bugs\r\n\r\n          //if (this.sareas.active === child) {\r\n          //  this.sareas.active = undefined;\r\n          //}\r\n        }\r\n\r\n        child.addEventListener(\"focus\", onfocus);\r\n        child.addEventListener(\"mouseenter\", onfocus);\r\n        child.addEventListener(\"blur\", onblur);\r\n        child.addEventListener(\"mouseleave\", onblur);\r\n      }\r\n\r\n      this.regenBorders();\r\n      child.setCSS();\r\n      this.drawUpdate();\r\n      child._init();\r\n    }\r\n\r\n    return this.shadow.appendChild(child);\r\n    //return super.appendChild(child);\r\n  }\r\n\r\n  add(child) {\r\n    return this.appendChild(child);\r\n  }\r\n\r\n  hintPickerTool() {\r\n    (new FrameManager_ops.ToolTipViewer(this)).start();\r\n  }\r\n\r\n  removeAreaTool(border) {\r\n    let tool = new FrameManager_ops.RemoveAreaTool(this, border);\r\n    //let tool = new FrameManager_ops.AreaDragTool(this, undefined, this.mpos);\r\n    tool.start();\r\n  }\r\n\r\n  moveAttachTool(sarea, mpos = this.mpos, elem, pointerId) {\r\n    let tool = new FrameManager_ops.AreaMoveAttachTool(this, sarea, mpos);\r\n    tool.start(elem, pointerId);\r\n  }\r\n\r\n  splitTool() {\r\n    let tool = new FrameManager_ops.SplitTool(this);\r\n    //let tool = new FrameManager_ops.AreaDragTool(this, undefined, this.mpos);\r\n    tool.start();\r\n  }\r\n\r\n  areaDragTool(sarea = this.sareas.active) {\r\n    if (sarea === undefined) {\r\n      console.warn(\"no active screen area\");\r\n      return;\r\n    }\r\n\r\n    let mpos = this.mpos;\r\n    let tool = new FrameManager_ops.AreaDragTool(this, this.sareas.active, mpos);\r\n\r\n    tool.start();\r\n  }\r\n\r\n  makeBorders() {\r\n    for (let sarea of this.sareas) {\r\n      sarea.makeBorders(this);\r\n    }\r\n  }\r\n\r\n  cleanupBorders() {\r\n    let del = new Set();\r\n\r\n    for (let b of this.screenborders) {\r\n      if (b.halfedges.length === 0) {\r\n        del.add(b);\r\n      }\r\n    }\r\n\r\n    for (let b of del) {\r\n      delete this._edgemap[b._hash];\r\n      HTMLElement.prototype.remove.call(b);\r\n    }\r\n  }\r\n\r\n  mergeBlankAreas() {\r\n    for (let b of this.screenborders) {\r\n      if (b.locked) {\r\n        continue;\r\n      }\r\n\r\n      let blank, sarea;\r\n\r\n      for (let he of b.halfedges) {\r\n        if (!he.sarea.area) {\r\n          blank = he.sarea;\r\n          sarea = b.getOtherSarea(blank);\r\n\r\n          let axis = b.horiz ^ 1;\r\n\r\n          if (blank && sarea && blank.size[axis] !== sarea.size[axis]) {\r\n            blank = sarea = undefined;\r\n          }\r\n\r\n          if (blank && sarea) {\r\n            break;\r\n          } else {\r\n            blank = undefined;\r\n            sarea = undefined;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (blank && sarea && blank !== sarea) {\r\n        this.collapseArea(blank, b);\r\n      }\r\n    }\r\n\r\n    this.cleanupBorders();\r\n  }\r\n\r\n  floatArea(area) {\r\n    let sarea = area.parentWidget;\r\n\r\n    /* already floating? */\r\n    if (sarea.floating) {\r\n      return sarea;\r\n    }\r\n\r\n    sarea.editors.remove(area);\r\n    delete sarea.editormap[area.constructor.define().areaname];\r\n    sarea.area = undefined;\r\n\r\n    HTMLElement.prototype.remove.call(area);\r\n\r\n    let sarea2 = UIBase.createElement(\"screenarea-x\", true);\r\n    sarea2.floating = true;\r\n\r\n    sarea2.pos = new Vector2(sarea.pos);\r\n    sarea2.pos.addScalar(5);\r\n\r\n    sarea2.size = new Vector2(sarea.size);\r\n\r\n    sarea2.editors.push(area);\r\n    sarea2.editormap[area.constructor.define().areaname] = area;\r\n\r\n    sarea2.shadow.appendChild(area);\r\n    sarea2.area = area;\r\n\r\n    area.push_ctx_active();\r\n    area.pop_ctx_active();\r\n\r\n    area.pos = sarea2.pos;\r\n    area.size = sarea2.size;\r\n    area.parentWidget = sarea2;\r\n    area.owning_sarea = sarea2;\r\n\r\n    sarea.flushSetCSS();\r\n    sarea.flushUpdate();\r\n\r\n    sarea2.flushSetCSS();\r\n    sarea2.flushUpdate();\r\n\r\n    this.appendChild(sarea2);\r\n\r\n    if (sarea.editors.length > 0) {\r\n      let area2 = sarea.editors[0];\r\n      sarea.switch_editor(area2.constructor);\r\n\r\n      sarea.flushSetCSS();\r\n      sarea.flushUpdate();\r\n    }\r\n\r\n    sarea2.loadFromPosSize();\r\n    sarea2.bringToFront();\r\n\r\n    this.mergeBlankAreas();\r\n    this.cleanupBorders();\r\n\r\n    return sarea2;\r\n  }\r\n\r\n  on_keydown(e) {\r\n    if (checkForTextBox(this, this.mpos[0], this.mpos[1])) {\r\n      console.log(\"textbox detected\");\r\n      return;\r\n    }\r\n\r\n    if (!haveModal() && this.execKeyMap(e)) {\r\n      e.preventDefault();\r\n      return;\r\n    }\r\n\r\n    if (!haveModal() && this.sareas.active !== undefined && this.sareas.active.on_keydown) {\r\n      let area = this.sareas.active;\r\n      return this.sareas.active.on_keydown(e);\r\n    }\r\n  }\r\n\r\n  on_keyup(e) {\r\n    if (!haveModal() && this.sareas.active !== undefined && this.sareas.active.on_keyup) {\r\n      return this.sareas.active.on_keyup(e);\r\n    }\r\n  }\r\n\r\n  on_keypress(e) {\r\n    if (!haveModal() && this.sareas.active !== undefined && this.sareas.active.on_keypress) {\r\n      return this.sareas.active.on_keypress(e);\r\n    }\r\n  }\r\n\r\n  draw() {\r\n    for (let sarea of this.sareas) {\r\n      sarea.draw();\r\n    }\r\n  }\r\n\r\n  afterSTRUCT() {\r\n    for (let sarea of this.sareas) {\r\n      sarea._ctx = this.ctx;\r\n      sarea.afterSTRUCT();\r\n    }\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    this.clear();\r\n\r\n    reader(this);\r\n\r\n    //handle old files that might have saved as simple arrays\r\n    this.size = new Vector2(this.size);\r\n\r\n    let sareas = this.sareas;\r\n    this.sareas = [];\r\n\r\n    /*\r\n    let push = this.sareas.push;\r\n\r\n    this.sareas.push = function(item) {\r\n      console.error(\"this.sareas.push\", item);\r\n      push.call(this, item);\r\n    }\r\n    */\r\n\r\n    for (let sarea of sareas) {\r\n      sarea.screen = this;\r\n      sarea.parentWidget = this;\r\n\r\n      this.appendChild(sarea);\r\n    }\r\n\r\n    this.regenBorders();\r\n    this.setCSS();\r\n\r\n    this.doOnce(() => {\r\n      this.loadUIData(this.uidata);\r\n      this.uidata = undefined;\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  test_struct(appstate = _appstate) {\r\n    let data = [];\r\n    //let scripts = nstructjs.write_scripts();\r\n    nstructjs.manager.write_object(data, this);\r\n    data = new DataView(new Uint8Array(data).buffer);\r\n\r\n    let screen2 = nstructjs.manager.read_object(data, this.constructor);\r\n    screen2.ctx = this.ctx;\r\n\r\n    for (let sarea of screen2.sareas) {\r\n      sarea.screen = screen2;\r\n      sarea.ctx = this.ctx;\r\n      sarea.area.ctx = this.ctx;\r\n    }\r\n\r\n    let parent = this.parentElement;\r\n    this.remove();\r\n\r\n    appstate.screen = screen2;\r\n\r\n    parent.appendChild(screen2);\r\n\r\n    //for (let \r\n    screen2.regenBorders();\r\n    screen2.update();\r\n    screen2.listen();\r\n\r\n    screen2.doOnce(() => {\r\n      screen2.on_resize(screen2.size, [window.innerWidth, window.innerHeight]);\r\n    });\r\n\r\n    console.log(data)\r\n    return screen2;\r\n  }\r\n\r\n  saveUIData() {\r\n    try {\r\n      return ui_base.saveUIData(this, \"screen\");\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n      console.log(\"Failed to save UI state data\");\r\n    }\r\n  }\r\n\r\n  loadUIData(str) {\r\n    try {\r\n      ui_base.loadUIData(this, str);\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n      console.log(\"Failed to load UI state data\");\r\n    }\r\n  }\r\n}\r\n\r\nScreen.STRUCT = `\r\npathux.Screen { \r\n  size  : vec2;\r\n  pos   : vec2;\r\n  sareas : array(pathux.ScreenArea);\r\n  idgen : int;\r\n  uidata : string | obj.saveUIData();\r\n}\r\n`;\r\n\r\nnstructjs.register(Screen);\r\nui_base.UIBase.internalRegister(Screen);\r\n\r\nScreenArea.setScreenClass(Screen);\r\n_setScreenClass(Screen);\r\n\r\nlet get_screen_cb;\r\nlet _on_keydown;\r\n\r\nlet start_cbs = [];\r\nlet stop_cbs = [];\r\nlet keyboardDom = window;\r\n\r\nlet key_event_opts = undefined;\r\n\r\nexport function startEvents(getScreenFunc) {\r\n  get_screen_cb = getScreenFunc;\r\n\r\n  if (_events_started) {\r\n    return;\r\n  }\r\n\r\n  _events_started = true;\r\n\r\n  _on_keydown = (e) => {\r\n    let screen = get_screen_cb();\r\n\r\n    return screen.on_keydown(e);\r\n  };\r\n\r\n  window.addEventListener(\"keydown\", _on_keydown, key_event_opts);\r\n\r\n  for (let cb of start_cbs) {\r\n    cb();\r\n  }\r\n}\r\n\r\nexport function stopEvents() {\r\n  window.removeEventListener(\"keydown\", _on_keydown, key_event_opts);\r\n  _on_keydown = undefined;\r\n  _events_started = false;\r\n\r\n  for (let cb of stop_cbs) {\r\n    try {\r\n      cb();\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n    }\r\n  }\r\n\r\n  return get_screen_cb;\r\n}\r\n\r\nexport function setKeyboardDom(dom) {\r\n  let started = _events_started;\r\n  if (started) {\r\n    stopEvents();\r\n  }\r\n\r\n  keyboardDom = dom;\r\n\r\n  if (started) {\r\n    startEvents(get_screen_cb);\r\n  }\r\n}\r\n\r\n/** Sets options passed to addEventListener() for on_keydown hotkey handler */\r\nexport function setKeyboardOpts(opts) {\r\n  key_event_opts = opts;\r\n}\r\n\r\nexport function _onEventsStart(cb) {\r\n  start_cbs.push(cb);\r\n}\r\n\r\nexport function _onEventsStop(cb) {\r\n  stop_cbs.push(cb);\r\n}\r\n\r\n/*\r\ndocument.addEventListener(\"touchstart\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"touchmove\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"scroll\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"resize\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"pointerdown\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"pointerstart\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"pointermove\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\n*/\r\n","import {AreaFlags} from \"../screen/ScreenArea.js\";\r\nimport {keymap} from \"../path-controller/util/simple_events.js\";\r\n\r\nexport function makePopupArea(area_class, screen, args={}) {\r\n  let sarea = UIBase.createElement(\"screenarea-x\");\r\n\r\n  let width = args.width || (screen.size[0]*0.7);\r\n  let height = args.height || (screen.size[1]*0.7);\r\n  let addEscapeKeyHandler = args.addEscapeKeyHandler !== undefined ? args.addEscapeKeyHandler : true;\r\n\r\n  sarea.ctx = screen.ctx;\r\n  sarea.size[0] = width;\r\n  sarea.size[1] = height;\r\n  sarea.pos[0] = 100;\r\n  sarea.pos[1] = 100;\r\n\r\n  sarea.pos[0] = Math.min(sarea.pos[0], screen.size[0] - sarea.size[0] - 2);\r\n  sarea.pos[1] = Math.min(sarea.pos[1], screen.size[1] - sarea.size[1] - 2);\r\n\r\n  sarea.switch_editor(area_class);\r\n\r\n  sarea.overrideClass(\"popup\");\r\n  sarea.style[\"background-color\"] = sarea.getDefault(\"background-color\");\r\n  sarea.style[\"border-radius\"] = sarea.getDefault(\"border-radius\") + \"px\";\r\n  sarea.style[\"border-color\"] = sarea.getDefault(\"border-color\");\r\n  sarea.style[\"border-style\"] = sarea.getDefault(\"border-style\");\r\n  sarea.style[\"border-width\"] = sarea.getDefault(\"border-width\") + \"px\";\r\n\r\n  sarea.flag |= AreaFlags.FLOATING | AreaFlags.INDEPENDENT;\r\n\r\n  screen.appendChild(sarea);\r\n  sarea.setCSS();\r\n\r\n  if (addEscapeKeyHandler) {\r\n    sarea.on_keydown = (e) => {\r\n      if (e.keyCode === keymap.Escape) {\r\n        screen.removeArea(sarea);\r\n      }\r\n    }\r\n  }\r\n\r\n  sarea.bringToFront();\r\n\r\n  return sarea;\r\n}","import {Area, contextWrangler} from '../screen/ScreenArea.js';\r\nimport {nstructjs} from '../path-controller/controller.js';\r\nimport {UIBase} from '../core/ui_base.js';\r\nimport {Container} from '../core/ui.js';\r\nimport {parsepx} from '../core/ui_base.js';\r\nimport {Icons} from '../core/ui_base.js';\r\nimport * as util from '../util/util.js';\r\n\r\nlet sidebar_hash = new util.HashDigest();\r\n\r\nexport class SideBar extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.header = this.row();\r\n    this.header.style[\"height\"] = \"45px\";\r\n\r\n    this._last_resize_key = undefined;\r\n\r\n    this._closed = false;\r\n\r\n    this.closeIcon = this.header.iconbutton(Icons.RIGHT_ARROW, \"Close/Open sidebar\", () => {\r\n      console.log(\"click!\");\r\n      this.closed = !this._closed;\r\n    });\r\n\r\n    this._openWidth = undefined;\r\n    this.needsSetCSS = true;\r\n    this.tabbar = this.tabs(\"left\");\r\n    //this.tabbar.style[\"flex-grow\"] = \"8\";\r\n  }\r\n\r\n  saveData() {\r\n    return {\r\n      closed : this.closed\r\n    }\r\n  }\r\n\r\n  loadData(obj) {\r\n    this.closed = obj.closed;\r\n  }\r\n\r\n  set closed(val) {\r\n    if (!!this._closed === !!val) {\r\n      return;\r\n    }\r\n\r\n    if (this._openWidth === undefined && !this._closed && val) {\r\n      this._openWidth = this.width;\r\n    }\r\n\r\n    console.log(\"animate!\");\r\n    let w = val ? 50 : this._openWidth;\r\n    this.animate().goto(\"width\", w, 500);\r\n\r\n\r\n    if (val) {\r\n      this.closeIcon.icon = Icons.LEFT_ARROW;\r\n    } else {\r\n      this.closeIcon.icon = Icons.RIGHT_ARROW;\r\n    }\r\n\r\n    this._closed = val;\r\n  }\r\n\r\n  get closed() {\r\n    return this._closed;\r\n  }\r\n\r\n  get width() {\r\n    return parsepx(\"\" + this.getAttribute(\"width\"));\r\n  }\r\n\r\n  set width(val) {\r\n    this.setAttribute(\"width\", \"\" + val + \"px\");\r\n    this.update();\r\n  }\r\n\r\n  get height() {\r\n    return parsepx(\"\" + this.getAttribute(\"height\"));\r\n  }\r\n\r\n  set height(val) {\r\n    this.setAttribute(\"height\", \"\" + val + \"px\");\r\n    this.update();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"sidebar-base-x\",\r\n      style  : \"sidebar\"\r\n    }\r\n  }\r\n\r\n  tab(name) {\r\n    return this.tabbar.tab(name);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    let closed = this._closed;\r\n    this._closed = false;\r\n\r\n    if (!this.getAttribute(\"width\")) {\r\n      this.width = 300;\r\n    }\r\n    if (!this.getAttribute(\"height\")) {\r\n      this.height = 700;\r\n    }\r\n\r\n    this.setCSS();\r\n\r\n    if (closed) {\r\n      this.closed = true;\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    if (!this.parentWidget) {\r\n      return;\r\n    }\r\n\r\n    let editor = this.parentWidget;\r\n\r\n    //happens when editors are inactive\r\n    if (!editor.pos || !editor.size) {\r\n      return;\r\n    }\r\n\r\n    this.needsSetCSS = false;\r\n\r\n    let w = this.width, h = this.height;\r\n\r\n    w = isNaN(w) ? 500 : w;\r\n    h = isNaN(h) ? 500 : h;\r\n\r\n    h = Math.min(h, editor.size[1]-25);\r\n\r\n    this.style[\"position\"] = \"absolute\";\r\n    this.style[\"width\"] = w + \"px\";\r\n    this.style[\"height\"] = h + \"px\";\r\n    this.style[\"z-index\"] = \"100\";\r\n    this.style[\"overflow\"] = \"scroll\";\r\n\r\n    this.style[\"background-color\"] = this.getDefault(\"AreaHeaderBG\");\r\n\r\n    this.tabbar.style[\"height\"] = (h - 45) + \"px\";\r\n    this.style[\"left\"] = (editor.size[0] - w) + \"px\";\r\n  }\r\n\r\n  update() {\r\n    sidebar_hash.reset();\r\n    sidebar_hash.add(this.width);\r\n    sidebar_hash.add(this.height);\r\n\r\n    let key = sidebar_hash.get();\r\n    if (key !== this._last_resize_key) {\r\n      this._last_resize_key = key;\r\n      this.needsSetCSS = true;\r\n    }\r\n\r\n    if (this.needsSetCSS) {\r\n      this.setCSS();\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.register(SideBar);\r\n\r\nexport class Editor extends Area {\r\n  constructor() {\r\n    super();\r\n\r\n    this.container = UIBase.createElement(\"container-x\");\r\n    this.container.parentWidget = this;\r\n    this.shadow.appendChild(this.container);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      areaname: \"areaname\",\r\n      tagname : \"tagname-x\"\r\n    }\r\n  }\r\n\r\n  static defineAPI(api, strct) {\r\n    return strct;\r\n  }\r\n\r\n  /** \\param makeMenuBar function(ctx, container, menuBarEditor)\r\n   *\r\n   * example:\r\n   *\r\n   * function makeMenuBar(ctx, container, menuBarEditor) {\r\n   *\r\n   *  container.menu(\"File\", [\r\n   *    \"app.new()\",\r\n   *    simple.Menu.SEP,\r\n   *    \"app.save()\",\r\n   *    \"app.save(forceDialog=true)|Save As\",\r\n   *    \"app.open\"\r\n   *  ]);\r\n   * }\r\n   * */\r\n  static registerAppMenu(makeMenuBar) {\r\n    if (this !== Editor) {\r\n      throw new Error(\"must call registerAppMenu from simple.Editor base class\");\r\n    }\r\n\r\n    this.makeMenuBar = makeMenuBar;\r\n  }\r\n\r\n  static register(cls) {\r\n    if (!cls.hasOwnProperty(\"define\")) {\r\n      throw new Error(\"missing define() method\");\r\n    }\r\n\r\n    if (!cls.hasOwnProperty(\"STRUCT\")) {\r\n      cls.STRUCT = nstructjs.inherit(cls, this) + `\\n}`;\r\n    }\r\n\r\n    super.register(cls);\r\n    nstructjs.register(cls);\r\n  }\r\n\r\n  makeSideBar() {\r\n    if (this.sidebar) {\r\n      this.sidebar.remove();\r\n    }\r\n\r\n    let sidebar = this.sidebar = UIBase.createElement(\"sidebar-base-x\");\r\n    sidebar.parentWidget = this;\r\n    sidebar.ctx = this.ctx;\r\n    this.shadow.appendChild(sidebar);\r\n\r\n    if (this.ctx) {\r\n      sidebar._init();\r\n\r\n      this.sidebar.flushSetCSS();\r\n      this.sidebar.flushUpdate();\r\n    }\r\n\r\n\r\n    return this.sidebar;\r\n  }\r\n\r\n  on_resize(size, oldsize) {\r\n    super.on_resize(size, oldsize);\r\n\r\n    if (this.sidebar) {\r\n      if (this.ctx && this.pos) {\r\n        this.sidebar.setCSS();\r\n      } else {\r\n        this.sidebar.needsSetCSS = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  static findEditor(cls) {\r\n    return contextWrangler.getLastArea(cls);\r\n  }\r\n  \r\n  getScreen() {\r\n    return this.ctx.screen;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.makeHeader(this.container);\r\n  }\r\n\r\n  /** creates default header and puts it in this.header */\r\n  makeHeader(container, add_note_area = true, make_draggable = true) {\r\n    return super.makeHeader(container, add_note_area, make_draggable);\r\n  }\r\n\r\n  /** called regularly */\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  /** */\r\n  setCSS() {\r\n    super.setCSS();\r\n  }\r\n}\r\n\r\n","let text = `<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\r\n<svg\r\n   xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\r\n   xmlns:cc=\"http://creativecommons.org/ns#\"\r\n   xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"\r\n   xmlns:svg=\"http://www.w3.org/2000/svg\"\r\n   xmlns=\"http://www.w3.org/2000/svg\"\r\n   xmlns:xlink=\"http://www.w3.org/1999/xlink\"\r\n   xmlns:sodipodi=\"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\"\r\n   xmlns:inkscape=\"http://www.inkscape.org/namespaces/inkscape\"\r\n   width=\"512\"\r\n   height=\"512\"\r\n   id=\"svg16099\"\r\n   version=\"1.1\"\r\n   inkscape:version=\"1.0 (4035a4fb49, 2020-05-01)\"\r\n   sodipodi:docname=\"iconsheet.svg\"\r\n   inkscape:export-filename=\"C:\\dev\\allshape\\src\\datafiles\\iconsheet16.png\"\r\n   inkscape:export-xdpi=\"45\"\r\n   inkscape:export-ydpi=\"45\">\r\n  <defs\r\n     id=\"defs16101\">\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1587\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1307\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1303\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1299\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1295\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1291\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1231\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1186\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1182\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4974\"\r\n       is_visible=\"true\" />\r\n    <linearGradient\r\n       id=\"linearGradient5481\">\r\n      <stop\r\n         id=\"stop4865\"\r\n         offset=\"0\"\r\n         style=\"stop-color:#e66700;stop-opacity:1;\" />\r\n      <stop\r\n         style=\"stop-color:#f47712;stop-opacity:1;\"\r\n         offset=\"0.52777779\"\r\n         id=\"stop4867\" />\r\n      <stop\r\n         id=\"stop4869\"\r\n         offset=\"1\"\r\n         style=\"stop-color:#f8bb8a;stop-opacity:1;\" />\r\n    </linearGradient>\r\n    <linearGradient\r\n       id=\"linearGradient17116-6\">\r\n      <stop\r\n         id=\"stop4860\"\r\n         offset=\"0\"\r\n         style=\"stop-color:#b3a500;stop-opacity:1;\" />\r\n      <stop\r\n         id=\"stop4862\"\r\n         offset=\"1\"\r\n         style=\"stop-color:#eaa500;stop-opacity:1;\" />\r\n    </linearGradient>\r\n    <linearGradient\r\n       id=\"linearGradient17116\">\r\n      <stop\r\n         id=\"stop4853\"\r\n         offset=\"0\"\r\n         style=\"stop-color:#b3a500;stop-opacity:1;\" />\r\n      <stop\r\n         id=\"stop4855\"\r\n         offset=\"1\"\r\n         style=\"stop-color:#eaa500;stop-opacity:1;\" />\r\n    </linearGradient>\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4290\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4286\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4122\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4118\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4194\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect3225\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect5012\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect5008\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4108\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect3264\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect5465\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4613\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4609\"\r\n       is_visible=\"true\" />\r\n    <linearGradient\r\n       id=\"linearGradient5609\">\r\n      <stop\r\n         id=\"stop5611\"\r\n         offset=\"0\"\r\n         style=\"stop-color:#0089e6;stop-opacity:1;\" />\r\n      <stop\r\n         style=\"stop-color:#1280f4;stop-opacity:1;\"\r\n         offset=\"0.52777779\"\r\n         id=\"stop5613\" />\r\n      <stop\r\n         id=\"stop5615\"\r\n         offset=\"1\"\r\n         style=\"stop-color:#d4eefc;stop-opacity:1;\" />\r\n    </linearGradient>\r\n    <linearGradient\r\n       id=\"linearGradient5481-8\">\r\n      <stop\r\n         style=\"stop-color:#ffc700;stop-opacity:1\"\r\n         offset=\"0\"\r\n         id=\"stop5483\" />\r\n      <stop\r\n         id=\"stop5491\"\r\n         offset=\"0.52777779\"\r\n         style=\"stop-color:#ffc700;stop-opacity:1\" />\r\n      <stop\r\n         style=\"stop-color:#ffa41c;stop-opacity:1\"\r\n         offset=\"1\"\r\n         id=\"stop5485\" />\r\n    </linearGradient>\r\n    <inkscape:perspective\r\n       sodipodi:type=\"inkscape:persp3d\"\r\n       inkscape:vp_x=\"-108.10967 : 516.24314 : 1\"\r\n       inkscape:vp_y=\"0 : 323.31882 : 0\"\r\n       inkscape:vp_z=\"57.429562 : 516.24314 : 1\"\r\n       inkscape:persp3d-origin=\"-25.340056 : 488.65327 : 1\"\r\n       id=\"perspective18342\" />\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0.0\"\r\n       refX=\"0.0\"\r\n       id=\"Arrow2Send\"\r\n       style=\"overflow:visible;\">\r\n      <path\r\n         id=\"path17173\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.62500000;stroke-linejoin:round;\"\r\n         d=\"M 8.7185878,4.0337352 L -2.2072895,0.016013256 L 8.7185884,-4.0017078 C 6.9730900,-1.6296469 6.9831476,1.6157441 8.7185878,4.0337352 z \"\r\n         transform=\"scale(0.3) rotate(180) translate(-2.3,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Mend\"\r\n       orient=\"auto\"\r\n       refY=\"0.0\"\r\n       refX=\"0.0\"\r\n       id=\"Arrow2Mend\"\r\n       style=\"overflow:visible;\">\r\n      <path\r\n         id=\"path17167\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.62500000;stroke-linejoin:round;\"\r\n         d=\"M 8.7185878,4.0337352 L -2.2072895,0.016013256 L 8.7185884,-4.0017078 C 6.9730900,-1.6296469 6.9831476,1.6157441 8.7185878,4.0337352 z \"\r\n         transform=\"scale(0.6) rotate(180) translate(0,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow1Send\"\r\n       orient=\"auto\"\r\n       refY=\"0.0\"\r\n       refX=\"0.0\"\r\n       id=\"Arrow1Send\"\r\n       style=\"overflow:visible;\">\r\n      <path\r\n         id=\"path17155\"\r\n         d=\"M 0.0,0.0 L 5.0,-5.0 L -12.5,0.0 L 5.0,5.0 L 0.0,0.0 z \"\r\n         style=\"fill-rule:evenodd;stroke:#000000;stroke-width:1.0pt;\"\r\n         transform=\"scale(0.2) rotate(180) translate(6,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Lend\"\r\n       orient=\"auto\"\r\n       refY=\"0.0\"\r\n       refX=\"0.0\"\r\n       id=\"Arrow2Lend\"\r\n       style=\"overflow:visible;\">\r\n      <path\r\n         id=\"path17161\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.62500000;stroke-linejoin:round;\"\r\n         d=\"M 8.7185878,4.0337352 L -2.2072895,0.016013256 L 8.7185884,-4.0017078 C 6.9730900,-1.6296469 6.9831476,1.6157441 8.7185878,4.0337352 z \"\r\n         transform=\"scale(1.1) rotate(180) translate(1,0)\" />\r\n    </marker>\r\n    <linearGradient\r\n       id=\"linearGradient17126\">\r\n      <stop\r\n         style=\"stop-color:#008080;stop-opacity:1;\"\r\n         offset=\"0\"\r\n         id=\"stop17128\" />\r\n      <stop\r\n         style=\"stop-color:#00b3b3;stop-opacity:1;\"\r\n         offset=\"1\"\r\n         id=\"stop17130\" />\r\n    </linearGradient>\r\n    <linearGradient\r\n       id=\"linearGradient17116-6-9\">\r\n      <stop\r\n         style=\"stop-color:#b3a500;stop-opacity:1;\"\r\n         offset=\"0\"\r\n         id=\"stop17118\" />\r\n      <stop\r\n         style=\"stop-color:#eaa500;stop-opacity:1;\"\r\n         offset=\"1\"\r\n         id=\"stop17120\" />\r\n    </linearGradient>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-2\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-2\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-6\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-8\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-7\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-6\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-8\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-9\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-79\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-5\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-3\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-1\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-33\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-4\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-1\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-3\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <linearGradient\r\n       inkscape:collect=\"always\"\r\n       xlink:href=\"#linearGradient5481-5\"\r\n       id=\"linearGradient5489-4\"\r\n       x1=\"355.89935\"\r\n       y1=\"17.125025\"\r\n       x2=\"380.47559\"\r\n       y2=\"17.125025\"\r\n       gradientUnits=\"userSpaceOnUse\" />\r\n    <linearGradient\r\n       id=\"linearGradient5481-5\">\r\n      <stop\r\n         style=\"stop-color:#e66700;stop-opacity:1;\"\r\n         offset=\"0\"\r\n         id=\"stop5483-2\" />\r\n      <stop\r\n         id=\"stop5491-9\"\r\n         offset=\"0.52777779\"\r\n         style=\"stop-color:#f47712;stop-opacity:1;\" />\r\n      <stop\r\n         style=\"stop-color:#f8bb8a;stop-opacity:1;\"\r\n         offset=\"1\"\r\n         id=\"stop5485-9\" />\r\n    </linearGradient>\r\n    <linearGradient\r\n       y2=\"17.125025\"\r\n       x2=\"380.47559\"\r\n       y1=\"17.125025\"\r\n       x1=\"355.89935\"\r\n       gradientUnits=\"userSpaceOnUse\"\r\n       id=\"linearGradient5588\"\r\n       xlink:href=\"#linearGradient5609\"\r\n       inkscape:collect=\"always\"\r\n       gradientTransform=\"matrix(1.2151103,0,0,1.1804992,-207.06775,536.98221)\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4108-1\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4108-4\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4108-9\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect3225-1\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect3225-4\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4122-2\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4122-7\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1587-6\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4194-5\"\r\n       is_visible=\"true\" />\r\n  </defs>\r\n  <sodipodi:namedview\r\n     id=\"base\"\r\n     pagecolor=\"#9c9c9c\"\r\n     bordercolor=\"#666666\"\r\n     borderopacity=\"1.0\"\r\n     inkscape:pageopacity=\"0\"\r\n     inkscape:pageshadow=\"2\"\r\n     inkscape:zoom=\"3.8325453\"\r\n     inkscape:cx=\"144.17961\"\r\n     inkscape:cy=\"49.96269\"\r\n     inkscape:document-units=\"px\"\r\n     inkscape:current-layer=\"layer1\"\r\n     showgrid=\"true\"\r\n     inkscape:window-width=\"1606\"\r\n     inkscape:window-height=\"962\"\r\n     inkscape:window-x=\"177\"\r\n     inkscape:window-y=\"71\"\r\n     inkscape:window-maximized=\"0\"\r\n     inkscape:snap-global=\"false\"\r\n     inkscape:pagecheckerboard=\"true\"\r\n     inkscape:document-rotation=\"0\">\r\n    <inkscape:grid\r\n       type=\"xygrid\"\r\n       id=\"grid16107\"\r\n       empspacing=\"1\"\r\n       visible=\"true\"\r\n       enabled=\"true\"\r\n       snapvisiblegridlinesonly=\"false\"\r\n       spacingx=\"32\"\r\n       spacingy=\"32\"\r\n       dotted=\"false\"\r\n       originx=\"0\"\r\n       originy=\"0\" />\r\n  </sodipodi:namedview>\r\n  <metadata\r\n     id=\"metadata16104\">\r\n    <rdf:RDF>\r\n      <cc:Work\r\n         rdf:about=\"\">\r\n        <dc:format>image/svg+xml</dc:format>\r\n        <dc:type\r\n           rdf:resource=\"http://purl.org/dc/dcmitype/StillImage\" />\r\n        <dc:title />\r\n      </cc:Work>\r\n    </rdf:RDF>\r\n  </metadata>\r\n  <g\r\n     inkscape:label=\"Layer 1\"\r\n     inkscape:groupmode=\"layer\"\r\n     id=\"layer1\"\r\n     transform=\"translate(0,-540.36218)\">\r\n    <ellipse\r\n       style=\"opacity:0.79203539;fill:url(#linearGradient5588);fill-opacity:1;stroke:#3c3c3c;stroke-width:1.1393038;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1\"\r\n       id=\"path3171-8\"\r\n       cx=\"240.32063\"\r\n       cy=\"557.19836\"\r\n       rx=\"14.353489\"\r\n       ry=\"14.165989\" />\r\n    <flowRoot\r\n       xml:space=\"preserve\"\r\n       id=\"flowRoot5564\"\r\n       style=\"font-style:normal;font-weight:normal;line-height:0.01%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none\"\r\n       transform=\"matrix(0.64571833,0,0,0.61432912,8.6966653,558.72048)\"><flowRegion\r\n         id=\"flowRegion5566\"\r\n         style=\"font-family:sans-serif\"><rect\r\n           id=\"rect5568\"\r\n           width=\"78.749992\"\r\n           height=\"72.5\"\r\n           x=\"346.24997\"\r\n           y=\"-21.999973\"\r\n           style=\"font-family:sans-serif\" /></flowRegion><flowPara\r\n         id=\"flowPara5570\"\r\n         style=\"font-weight:bold;font-size:40px;line-height:1.25;font-family:sans-serif;-inkscape-font-specification:'Sans Bold'\">?</flowPara></flowRoot>\r\n    <path\r\n       style=\"fill:none;stroke:#ec6900;stroke-width:4.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;marker-mid:none;marker-end:none\"\r\n       d=\"m 187.1235,559.26606 c -3.71166,-5.87882 -12.04056,-10.0009 -18.86169,0.34701\"\r\n       id=\"path4144-1\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\" />\r\n    <path\r\n       style=\"fill:#ec6900;fill-opacity:1;stroke:none;stroke-width:0.001;stroke-miterlimit:4;stroke-dasharray:none\"\r\n       d=\"m 170.01417,560.40163 2.05175,2.63036 -9.89352,4.33226 2.83717,-13.08504 z\"\r\n       id=\"path5370-7\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <path\r\n       style=\"fill:none;stroke:#1f9000;stroke-width:4.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;marker-mid:none;marker-end:none\"\r\n       d=\"m 197.1805,559.70121 c 3.69186,-5.88365 11.97631,-10.00911 18.76103,0.3473\"\r\n       id=\"path4144-1-9\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\" />\r\n    <path\r\n       style=\"fill:#1f9000;fill-opacity:1;stroke:none\"\r\n       d=\"m 213.95021,560.59037 -2.0408,2.63252 9.84072,4.33582 -2.82203,-13.09579 z\"\r\n       id=\"path5370-7-4\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <rect\r\n       style=\"fill:#000000;fill-opacity:1;stroke:none\"\r\n       id=\"rect3224\"\r\n       width=\"23.641272\"\r\n       height=\"8.4057856\"\r\n       x=\"487.73776\"\r\n       y=\"552.41565\" />\r\n    <path\r\n       style=\"fill:none;stroke:#000000;stroke-width:5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"M 498.18023,567.81152 484.7754,556.20378 498.93081,545.77569\"\r\n       id=\"path4074\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccc\" />\r\n    <path\r\n       style=\"fill:#000000;fill-opacity:1;stroke:none\"\r\n       d=\"m 17.866009,585.82436 -0.09,-4.53232 -14.5167501,7.49748 14.5683701,7.84238 z\"\r\n       id=\"path5370-5-0-6-5\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <path\r\n       style=\"fill:#000000;fill-opacity:1;stroke:none\"\r\n       d=\"m 46.366429,592.31275 0.0109,4.6129 14.90287,-7.37024 -14.68289,-8.23782 z\"\r\n       id=\"path5370-5-1-2\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <rect\r\n       style=\"opacity:0.94690265;fill:#000000;fill-opacity:1;stroke:none\"\r\n       id=\"rect5558-3-3\"\r\n       width=\"10.726034\"\r\n       height=\"5.6689787\"\r\n       x=\"-3.0812507\"\r\n       y=\"587.85645\"\r\n       transform=\"matrix(1,0,0.06880209,0.99763033,0,0)\" />\r\n    <rect\r\n       style=\"opacity:0.94690265;fill:#000000;fill-opacity:1;stroke:none\"\r\n       id=\"rect5558-1\"\r\n       width=\"10.540748\"\r\n       height=\"5.5710502\"\r\n       x=\"-22.93788\"\r\n       y=\"587.9295\"\r\n       transform=\"matrix(1,0,0.06880209,0.99763033,0,0)\" />\r\n    <path\r\n       style=\"fill:#2e2e2e;fill-opacity:1;stroke:none;stroke-width:0.685581\"\r\n       d=\"m 71.46269,592.27473 0.01481,6.27371 20.268436,-10.02379 -19.969263,-11.20374 z\"\r\n       id=\"path5370-5-1-2-1\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <path\r\n       style=\"fill:#2e2e2e;fill-opacity:1;stroke:none;stroke-width:0.685581\"\r\n       d=\"m 108.87703,578.56977 -6.27262,0.11779 10.35514,20.10117 10.87444,-20.15049 z\"\r\n       id=\"path5370-5-1-2-1-7\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <path\r\n       style=\"fill:#000000;fill-opacity:1;stroke:#363636;stroke-width:2.23946524;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 69.769603,567.95981 5.60449,-5.39601\"\r\n       id=\"path5452-5-5-1-7\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\"\r\n       inkscape:transform-center-x=\"3.061478\"\r\n       inkscape:transform-center-y=\"-0.63275351\" />\r\n    <path\r\n       style=\"fill:#000000;fill-opacity:1;stroke:#363636;stroke-width:2.23946524;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 75.172083,567.8747 -5.47097,-5.53134\"\r\n       id=\"path5452-5-5-1-7-4\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\"\r\n       inkscape:transform-center-x=\"3.196728\"\r\n       inkscape:transform-center-y=\"-0.78552851\" />\r\n    <path\r\n       style=\"fill:#ffe87e;fill-opacity:1;stroke:#a58000;stroke-width:1.02573335px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 36.512525,599.08328 -0.0847,-15.30469 14.76623,-0.079 1.13455,-5.3121 h 6.7663 l 0.52197,5.56549 h 2.38874 l -0.0349,15.41642 z\"\r\n       id=\"path4607\"\r\n       inkscape:path-effect=\"#path-effect4609\"\r\n       inkscape:original-d=\"m 36.512525,599.08328 -0.0847,-15.30469 14.76623,-0.079 1.13455,-5.3121 h 6.7663 l 0.52197,5.56549 h 2.38874 l -0.0349,15.41642 z\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccccccccc\"\r\n       transform=\"translate(-33.065965,-31.819347)\" />\r\n    <path\r\n       style=\"fill:#dfc449;fill-opacity:1;stroke:#a58000;stroke-width:1.04236829px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 38.651325,583.64804 2.27904,-5.34039 8.11475,0.19058 1.53729,4.93611 z\"\r\n       id=\"path5463\"\r\n       inkscape:path-effect=\"#path-effect5465\"\r\n       inkscape:original-d=\"m 38.651325,583.64804 2.27904,-5.34039 8.11475,0.19058 1.53729,4.93611 z\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccccc\"\r\n       transform=\"translate(-33.065965,-31.819347)\" />\r\n    <path\r\n       style=\"fill:#d7f0fb;fill-opacity:1;stroke:#4f4f4f;stroke-width:1.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;stroke-miterlimit:4;stroke-dasharray:none\"\r\n       d=\"m 71.789265,599.90744 0.17512,-24.69199 h 15.41061 l 4.378,4.90337 0.17513,19.96374 z\"\r\n       id=\"path3262\"\r\n       inkscape:path-effect=\"#path-effect3264\"\r\n       inkscape:original-d=\"m 71.789265,599.90744 0.17512,-24.69199 h 15.41061 l 4.378,4.90337 0.17513,19.96374 z\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cccccc\"\r\n       transform=\"translate(-33.561281,-31.819347)\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 73.190225,596.58015 16.81157,-0.35024\"\r\n       id=\"path4106\"\r\n       inkscape:path-effect=\"#path-effect4108\"\r\n       inkscape:original-d=\"m 73.190225,596.58015 16.81157,-0.35024\"\r\n       inkscape:connector-curvature=\"0\"\r\n       transform=\"translate(-33.561281,-31.819347)\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 73.540465,591.50166 16.81157,-0.35024\"\r\n       id=\"path4106-7\"\r\n       inkscape:path-effect=\"#path-effect4108-1\"\r\n       inkscape:original-d=\"m 73.540465,591.50166 16.81157,-0.35024\"\r\n       inkscape:connector-curvature=\"0\"\r\n       transform=\"translate(-33.561281,-31.819347)\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 73.365345,586.59829 16.81157,-0.35024\"\r\n       id=\"path4106-0\"\r\n       inkscape:path-effect=\"#path-effect4108-4\"\r\n       inkscape:original-d=\"m 73.365345,586.59829 16.81157,-0.35024\"\r\n       inkscape:connector-curvature=\"0\"\r\n       transform=\"translate(-33.561281,-31.819347)\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 73.365345,582.22027 16.81157,-0.35024\"\r\n       id=\"path4106-4\"\r\n       inkscape:path-effect=\"#path-effect4108-9\"\r\n       inkscape:original-d=\"m 73.365345,582.22027 16.81157,-0.35024\"\r\n       inkscape:connector-curvature=\"0\"\r\n       transform=\"translate(-33.561281,-31.819347)\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#f1f1f1;stroke-width:4.65793133;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 103.19489,558.19446 16.18158,0.0627\"\r\n       id=\"path5452-5-5-1-7-7\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\"\r\n       inkscape:transform-center-x=\"3.6534509\"\r\n       inkscape:transform-center-y=\"-5.3788766\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#f4f4f4;stroke-width:4.65793133;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 111.38254,565.89244 -0.15492,-16.18101\"\r\n       id=\"path5452-5-5-1-7-4-4\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\"\r\n       inkscape:transform-center-x=\"3.6340509\"\r\n       inkscape:transform-center-y=\"-5.8027516\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#f1f1f1;stroke-width:4.54087734;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 135.53124,558.66024 15.77493,0.0612\"\r\n       id=\"path5452-5-5-1-7-7-1\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\"\r\n       inkscape:transform-center-x=\"3.561639\"\r\n       inkscape:transform-center-y=\"-5.2436726\" />\r\n    <path\r\n       style=\"fill:#bfbfbf;fill-opacity:1;stroke:#ffffff;stroke-width:1.39999998;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 273.79736,565.92624 4.84986,4.15066 7.44379,-12.0346 -3.26109,-1.20718 -4.82074,8.91974 -2.46038,-2.39761 z\"\r\n       id=\"path1157\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccccccc\" />\r\n    <path\r\n       style=\"fill:#ff9d00;fill-opacity:1;stroke:#808080;stroke-width:0.78749156px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 306.19903,566.65065 4.84985,4.15066 7.4438,-12.0346 -3.26109,-1.20718 -4.82075,8.91974 -2.46037,-2.39761 z\"\r\n       id=\"path1157-6\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccccccc\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:4.85740042;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 419.41366,537.85807 12.87326,7.64338 12.79438,-7.33068\"\r\n       id=\"path1585\"\r\n       inkscape:connector-curvature=\"0\"\r\n       inkscape:path-effect=\"#path-effect1587\"\r\n       inkscape:original-d=\"m 419.41366,537.85807 12.87326,7.64338 c 4.40656,-2.37267 3.01422,-8.5404 12.79438,-7.33068\"\r\n       sodipodi:nodetypes=\"ccc\"\r\n       transform=\"matrix(0.82348572,0,0,0.82348572,75.604975,111.95505)\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:4.85740042;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 419.41366,537.85807 12.87326,7.64338 12.79438,-7.33068\"\r\n       id=\"path1585-6\"\r\n       inkscape:connector-curvature=\"0\"\r\n       inkscape:path-effect=\"#path-effect1587-6\"\r\n       inkscape:original-d=\"m 419.41366,537.85807 12.87326,7.64338 c 4.40656,-2.37267 3.01422,-8.5404 12.79438,-7.33068\"\r\n       sodipodi:nodetypes=\"ccc\"\r\n       transform=\"matrix(-0.82326686,0.01898429,-0.01898429,-0.82326686,829.82733,995.45395)\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#ffffff;stroke-width:1.4972775px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 325.7796,560.88703 9.22114,7.89176 14.15308,-22.88169 -6.20039,-2.29524 -9.16581,16.95932 -4.67796,-4.55863 z\"\r\n       id=\"path1157-6-7\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccccccc\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:none\"\r\n       d=\"m 338.27455,603.35315 -4.55847,-12.13972 -4.42325,4.14941 0.29119,-21.42993 14.0532,13.84869 -5.29334,1.40046 4.98485,11.66133 z\"\r\n       id=\"path4192-0\"\r\n       inkscape:path-effect=\"#path-effect4194-5\"\r\n       inkscape:original-d=\"m 338.27455,603.35315 -4.55847,-12.13972 -4.42325,4.14941 0.29119,-21.42993 14.0532,13.84869 -5.29334,1.40046 c 11.73953,18.68506 2.52594,6.89719 4.98485,11.66133 z\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cccccccc\"\r\n       transform=\"rotate(-9.319008,159.52768,371.93318)\" />\r\n    <text\r\n       xml:space=\"preserve\"\r\n       style=\"font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:17.712px;line-height:0%;font-family:'MV Boli';-inkscape-font-specification:'MV Boli';letter-spacing:0px;word-spacing:0px;fill:#ffdc00;fill-opacity:1;stroke:none;stroke-width:1.476\"\r\n       x=\"179.14906\"\r\n       y=\"751.84772\"\r\n       id=\"text3255-0\"\r\n       transform=\"matrix(1.2141217,-0.1513943,0.23126622,0.79480305,0,0)\"><tspan\r\n         sodipodi:role=\"line\"\r\n         id=\"tspan3257-0\"\r\n         x=\"179.14906\"\r\n         y=\"751.84772\"\r\n         style=\"font-size:44.4154px;line-height:1.25;stroke-width:1.476\">!</tspan></text>\r\n    <text\r\n       xml:space=\"preserve\"\r\n       style=\"font-style:normal;font-weight:normal;font-size:32.4516px;line-height:1.25;font-family:sans-serif;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.81129\"\r\n       x=\"131.62856\"\r\n       y=\"599.63672\"\r\n       id=\"text1309\"><tspan\r\n         sodipodi:role=\"line\"\r\n         id=\"tspan1307\"\r\n         x=\"131.62856\"\r\n         y=\"599.63672\"\r\n         style=\"font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:sans-serif;-inkscape-font-specification:'sans-serif Bold';stroke-width:0.81129\">B</tspan></text>\r\n    <text\r\n       id=\"text1309-2\"\r\n       y=\"658.43152\"\r\n       x=\"153.61592\"\r\n       style=\"font-style:normal;font-weight:normal;font-size:41.6588px;line-height:1.25;font-family:sans-serif;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.04147\"\r\n       xml:space=\"preserve\"\r\n       transform=\"scale(1.0962314,0.91221617)\"><tspan\r\n         style=\"font-style:italic;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:serif;-inkscape-font-specification:'serif Bold Italic';stroke-width:1.04147\"\r\n         y=\"658.43152\"\r\n         x=\"153.61592\"\r\n         id=\"tspan1307-4\"\r\n         sodipodi:role=\"line\">i</tspan></text>\r\n    <text\r\n       xml:space=\"preserve\"\r\n       style=\"font-style:normal;font-weight:normal;font-size:38.431px;line-height:1.25;font-family:sans-serif;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.960773\"\r\n       x=\"264.23669\"\r\n       y=\"522.23657\"\r\n       id=\"text1309-0-9\"\r\n       transform=\"scale(0.87011438,1.1492742)\"><tspan\r\n         sodipodi:role=\"line\"\r\n         id=\"tspan1307-3-4\"\r\n         x=\"264.23669\"\r\n         y=\"522.23657\"\r\n         style=\"font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:sans-serif;-inkscape-font-specification:'sans-serif Bold';stroke-width:0.960773\"><tspan\r\n           style=\"font-weight:normal;stroke-width:0.960773\"\r\n           id=\"tspan1365\">s</tspan></tspan></text>\r\n    <text\r\n       xml:space=\"preserve\"\r\n       style=\"font-style:normal;font-weight:normal;font-size:31.7797px;line-height:1.25;font-family:sans-serif;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.794494\"\r\n       x=\"195.07664\"\r\n       y=\"596.5979\"\r\n       id=\"text1309-0-2\"\r\n       transform=\"scale(0.99519471,1.0048285)\"><tspan\r\n         sodipodi:role=\"line\"\r\n         id=\"tspan1307-3-1\"\r\n         x=\"195.07664\"\r\n         y=\"596.5979\"\r\n         style=\"font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:sans-serif;-inkscape-font-specification:'sans-serif Bold';stroke-width:0.794494\">U</tspan></text>\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:3.47724;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 194.05959,600.03363 25.702,0.14808\"\r\n       id=\"path1375\" />\r\n    <path\r\n       id=\"path1375-2\"\r\n       d=\"m 227.04774,587.38832 25.63991,0.14772\"\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:3.46884;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       inkscape:transform-center-x=\"1.1856386\"\r\n       inkscape:transform-center-y=\"-0.33875464\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#484848;stroke-width:1.623;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 262.93706,592.38036 0.0134,5.70131 18.41916,-9.10923 -18.14729,-10.18151 z\"\r\n       id=\"path5370-5-1-2-1-4\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <path\r\n       inkscape:connector-curvature=\"0\"\r\n       id=\"path5370-5-1-2-1-4-0\"\r\n       d=\"m 301.44451,581.20782 -5.70129,0.0197 9.12976,18.40899 10.16128,-18.15862 z\"\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#484848;stroke-width:1.623;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\" />\r\n    <ellipse\r\n       style=\"fill:none;stroke:#242424;stroke-width:2.80047;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:20;stroke-opacity:1\"\r\n       id=\"path1040\"\r\n       ry=\"8.7032747\"\r\n       rx=\"8.4312963\"\r\n       cy=\"583.49023\"\r\n       cx=\"331.71524\" />\r\n    <path\r\n       style=\"fill:none;stroke:#242424;stroke-width:6;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 336.4644,589.47097 10.10632,10.66173\"\r\n       id=\"path1042\"\r\n       sodipodi:nodetypes=\"cc\" />\r\n    <path\r\n       style=\"fill:none;stroke:#242424;stroke-width:2.17621;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 325.36075,583.26941 12.63506,0.34484\"\r\n       id=\"path1044\" />\r\n    <ellipse\r\n       cx=\"364.00839\"\r\n       cy=\"584.36328\"\r\n       rx=\"9.6165609\"\r\n       ry=\"9.9267731\"\r\n       id=\"path1040-0\"\r\n       style=\"fill:none;stroke:#242424;stroke-width:3.19416;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:20;stroke-opacity:1\" />\r\n    <path\r\n       sodipodi:nodetypes=\"cc\"\r\n       id=\"path1042-6\"\r\n       d=\"m 369.73697,590.7899 10.89694,10.89694\"\r\n       style=\"fill:none;stroke:#242424;stroke-width:6;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\" />\r\n    <path\r\n       id=\"path1044-4\"\r\n       d=\"m 357.64269,584.09303 12.63506,0.34484\"\r\n       style=\"fill:none;stroke:#242424;stroke-width:2.17621;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\" />\r\n    <path\r\n       style=\"fill:none;stroke:#242424;stroke-width:2.17621;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 363.94156,590.78154 0.20796,-12.63806\"\r\n       id=\"path1044-4-9\" />\r\n  </g>\r\n</svg>\r\n`.trim();\r\n\r\ntext = btoa(text);\r\nexport let iconSvg = `data:image/svg+xml;base64,` + text;","\"use strict\";\r\n\r\nimport {iconSvg} from './iconsheet.js';\r\n\r\nexport const Icons = {\r\n  FOLDER        : 0, //file folder\r\n  FILE          : 1,\r\n  TINY_X        : 2, //'x' in bottom left corner\r\n  SMALL_PLUS    : 3,\r\n  SMALL_MINUS   : 4,\r\n  UNDO          : 5,\r\n  REDO          : 6,\r\n  HELP          : 7,\r\n  ENUM_UNCHECKED: 8, //overlaid on icon checkboxes when unchecked\r\n  ENUM_CHECKED  : 9, //overlaid on icon checkboxes when checked\r\n  LARGE_CHECK   : 10, //default check mark for non-icon checkboxes\r\n  CURSOR_ARROW  : 11,\r\n  NOTE_EXCL     : 12, //notification exclamation mark\r\n  SCROLL_DOWN   : 13,\r\n  SCROLL_UP     : 14,\r\n  BACKSPACE     : 15,\r\n  LEFT_ARROW    : 16,\r\n  RIGHT_ARROW   : 17,\r\n  UI_EXPAND     : 18, //triangle\r\n  UI_COLLAPSE   : 19, //triangle\r\n  BOLD          : 20,\r\n  ITALIC        : 21,\r\n  UNDERLINE     : 22,\r\n  STRIKETHRU    : 23,\r\n  TREE_EXPAND   : 24,\r\n  TREE_COLLAPSE : 25,\r\n  ZOOM_OUT      : 26,\r\n  ZOOM_IN       : 27\r\n};\r\n\r\nexport function loadDefaultIconSheet() {\r\n  let iconSheet = document.createElement(\"img\");\r\n  iconSheet.src = iconSvg;\r\n\r\n  return iconSheet;\r\n}\r\n\r\n\r\n","import nstructjs from '../path-controller/util/struct.js';\r\n\r\nimport {UIBase} from '../core/ui_base.js';\r\n\r\nexport class FileHeader {\r\n  constructor(version, magic, flags) {\r\n    this.magic = magic;\r\n    this.flags = flags;\r\n    this.version_major = version ? version[0] : 0;\r\n    this.version_minor = version ? version[1] : 0;\r\n    this.version_micro = version ? version[2] : 0;\r\n    this.schema = nstructjs.write_scripts();\r\n  }\r\n}\r\n\r\nFileHeader.STRUCT = `\r\nsimple.FileHeader {\r\n  magic         : static_string[4];\r\n  version_major : short;\r\n  version_minor : short;\r\n  version_micro : short;\r\n  flags         : short;\r\n  schema        : string; \r\n}\r\n`;\r\nnstructjs.register(FileHeader);\r\n\r\nexport class FileFull extends FileHeader {\r\n  constructor(version, magic, flags) {\r\n    super(version, magic, flags);\r\n    this.objects = [];\r\n  }\r\n}\r\n\r\nFileFull.STRUCT = nstructjs.inherit(FileFull, FileHeader) + `\r\n  objects : array(abstract(Object));\r\n  screen  : abstract(Object);\r\n}\r\n`;\r\nnstructjs.register(FileFull);\r\n\r\n\r\nexport class FileArgs {\r\n  constructor(args = {}) {\r\n    this.ext = args.ext || \".data\";\r\n    this.magic = args.magic || \"STRT\";\r\n    this.doScreen = args.doScreen !== undefined ? args.doScreen : true;\r\n    this.resetOnLoad = args.resetOnLoad !== undefined ? args.resetOnLoad : true;\r\n    this.useJSON = args.useJSON !== undefined ? args.useJSON : false;\r\n    this.version = args.version !== undefined ? args.version : 0;\r\n    this.fileFlags = args.fileFlags !== undefined ? args.fileFlags : 0;\r\n    this.fromFileOp = false; /* SimpleSaveOp and SimpleOpenOp set this to true */\r\n  }\r\n}\r\n\r\nexport class EmptyStruct {\r\n\r\n}\r\nEmptyStruct.STRUCT = `\r\nEmptyStruct {\r\n}\r\n`;\r\nnstructjs.register(EmptyStruct);\r\n\r\nexport function saveFile(appstate, args, objects) {\r\n  if (args.useJSON === undefined) {\r\n    args.useJSON = appstate.saveFilesInJSON;\r\n  }\r\n\r\n  args = new FileArgs(args);\r\n\r\n  let version = args.version;\r\n  if (typeof version === \"number\") {\r\n    if (version === Math.floor(version)) {\r\n      version = [version, 0, 0];\r\n    } else {\r\n      let major = ~~version;\r\n      let minor = ~~(Math.fract(version)*10.0);\r\n      let micro = (Math.fract(version) - minor) * 100.0;\r\n\r\n      version = [major, minor, micro];\r\n    }\r\n  }\r\n\r\n  let file = new FileFull(version, args.magic, args.fileFlags);\r\n\r\n  if (args.doScreen) {\r\n    file.screen = appstate.screen;\r\n  } else {\r\n    file.screen = new EmptyStruct();\r\n  }\r\n\r\n  for (let ob of objects) {\r\n    file.objects.push(ob);\r\n  }\r\n\r\n  if (args.useJSON) {\r\n    return nstructjs.writeJSON(file);\r\n  } else {\r\n    let data = [];\r\n    nstructjs.writeObject(data, file);\r\n    return (new Uint8Array(data)).buffer;\r\n  }\r\n}\r\n\r\nexport function loadFile(appstate, args, data) {\r\n  let header;\r\n\r\n  if (args.useJSON === undefined) {\r\n    args.useJSON = appstate.saveFilesInJSON;\r\n  }\r\n\r\n  args = new FileArgs(args);\r\n\r\n  if (!args.useJSON) {\r\n    if (data instanceof Array) {\r\n      data = (new Uint8Array(data)).buffer;\r\n    }\r\n\r\n    if (data instanceof Uint8Array) {\r\n      data = data.buffer;\r\n    }\r\n\r\n    if (data instanceof ArrayBuffer) {\r\n      data = new DataView(data);\r\n    }\r\n\r\n    header = nstructjs.readObject(data, FileHeader);\r\n  } else {\r\n    if (typeof data === \"string\") {\r\n      data = JSON.parse(data);\r\n    }\r\n\r\n    header = nstructjs.readJSON(data, FileHeader);\r\n  }\r\n\r\n  if (header.magic !== args.magic) {\r\n    throw new Error(\"invalid file\");\r\n  }\r\n\r\n  let istruct = new nstructjs.STRUCT();\r\n  istruct.parse_structs(header.schema);\r\n\r\n  let ret;\r\n\r\n  if (!args.useJSON) {\r\n    ret = istruct.readObject(data, FileFull);\r\n  } else {\r\n    ret = istruct.readJSON(data, FileFull);\r\n  }\r\n\r\n  if (args.resetOnLoad) {\r\n    appstate.reset();\r\n  }\r\n\r\n  if (args.doScreen) {\r\n    if (appstate.screen) {\r\n      appstate.screen.unlisten();\r\n      appstate.screen.remove();\r\n    }\r\n\r\n    ret.screen.ctx = appstate.ctx;\r\n\r\n    if (!(ret.screen instanceof appstate.screenClass)) {\r\n      let screen = UIBase.createElement(appstate.screenClass.define().tagname);\r\n      screen.ctx = appstate.ctx;\r\n\r\n      for (let sarea of ret.screen.sareas) {\r\n        screen.appendChild(sarea);\r\n\r\n        sarea.area.afterSTRUCT();\r\n        sarea.area.on_fileload();\r\n      }\r\n\r\n      ret.screen = screen;\r\n    }\r\n\r\n    appstate.screen = ret.screen;\r\n\r\n    document.body.appendChild(appstate.screen);\r\n    appstate.screen.listen();\r\n  }\r\n\r\n  return ret;\r\n}","import {Editor} from './editor.js';\r\nimport {UIBase} from '../core/ui_base.js';\r\nimport {nstructjs} from '../path-controller/controller.js';\r\nimport {AreaFlags} from '../screen/ScreenArea.js';\r\n\r\n/** see ./editor.js:Editor.registerAppMenu */\r\n\r\nexport class MenuBarEditor extends Editor {\r\n  constructor() {\r\n    super();\r\n\r\n    this.updateHeight();\r\n    this.borderLock = 1 | 2 | 4 | 8;\r\n    this.areaDragToolEnabled = false;\r\n\r\n    this._height = 25;\r\n\r\n    this.needsRebuild = false;\r\n  }\r\n\r\n  get height() {\r\n    return this._height;\r\n  }\r\n\r\n  set height(v) {\r\n    this._height = v;\r\n    this.updateHeight();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname : \"simple-menu-editor-x\",\r\n      areaname: \"menu\",\r\n      uiname  : \"Menu Bar\",\r\n      icon    : -1,\r\n      //hide in editor list\r\n      flag    : AreaFlags.HIDDEN | AreaFlags.NO_HEADER_CONTEXT_MENU | AreaFlags.NO_COLLAPSE | AreaFlags.NO_SWITCHER\r\n    }\r\n  }\r\n\r\n  updateHeight(force = false) {\r\n    if (!this.header)\r\n      return;\r\n\r\n    if (window.haveElectron) {\r\n      this.maxSize[1] = this.minSize[1] = 1;\r\n      electron_api.initMenuBar(this);\r\n      return;\r\n    }\r\n\r\n    if (this._height === undefined) {\r\n      let rect = this.header.getClientRects()[0];\r\n\r\n      if (rect) {\r\n        this._height = rect.height;\r\n      }\r\n    }\r\n\r\n    let update = force || this._height !== this.minSize[1];\r\n    this.minSize[1] = this.maxSize[1] = this._height;\r\n\r\n    if (update && this.ctx && this.getScreen()) {\r\n      this.getScreen().solveAreaConstraints();\r\n    }\r\n  }\r\n\r\n  makeMenuBar(container) {\r\n    if (Editor.makeMenuBar) {\r\n      Editor.makeMenuBar(this.ctx, container, this);\r\n    }\r\n  }\r\n\r\n  flagRebuild() {\r\n    this.needsRebuild = true;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.background = this.getDefault(\"AreaHeaderBG\");\r\n\r\n    this.menuRow = this.header.row();\r\n    this.makeMenuBar(this.menuRow);\r\n\r\n    this.doOnce(() => {\r\n      if (window.haveElectron) {\r\n        this.height = 1;\r\n        electron_api.initMenuBar(this);\r\n      }\r\n    });\r\n\r\n    this.updateHeight(true);\r\n    this.flushUpdate();\r\n  }\r\n\r\n  rebuild() {\r\n    this.needsRebuild = false;\r\n\r\n    this.menuRow.clear();\r\n    this.makeMenuBar(this.menuRow);\r\n    this.flushUpdate();\r\n  }\r\n\r\n  update() {\r\n    if (this.needsRebuild) {\r\n      this.rebuild();\r\n    }\r\n  }\r\n}\r\n\r\nMenuBarEditor.STRUCT = nstructjs.inherit(MenuBarEditor, Editor, \"MenuBarEditor\") + `\r\n}\r\n`;\r\n\r\nexport function registerMenuBarEditor() {\r\n  Editor.register(MenuBarEditor);\r\n}\r\n","import * as platform from '../platforms/platform.js';\r\n\r\nimport {ToolOp, UndoFlags} from '../path-controller/toolsys/toolsys.js';\r\nimport {ToolProperty, BoolProperty, StringProperty} from '../path-controller/toolsys/toolprop.js';\r\n\r\nimport {sendNote, error, warning, message} from '../widgets/ui_noteframe.js';\r\n\r\nexport class SimpleAppNewOp extends ToolOp {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : \"New\",\r\n      toolpath: \"app.new\",\r\n      inputs  : {},\r\n      undoflag: UndoFlags.NO_UNDO\r\n    }\r\n  }\r\n\r\n  exec(ctx) {\r\n    _appstate.createNewFile();\r\n  }\r\n}\r\n\r\nexport class SimpleAppSaveOp extends ToolOp {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : \"Save\",\r\n      toolpath: \"app.save\",\r\n      inputs  : {\r\n        forceDialog: new BoolProperty()\r\n      },\r\n      undoflag: UndoFlags.NO_UNDO\r\n    }\r\n  }\r\n\r\n  exec(ctx) {\r\n    let ext = _appstate.fileExt;\r\n    let useJSON = _appstate.startArgs.saveFilesInJSON;\r\n\r\n    _appstate.saveFile({\r\n      doScreen  : true,\r\n      useJSON,\r\n      fromFileOp: true\r\n    }).then(data => {\r\n\r\n      function save() {\r\n        return data;\r\n      }\r\n\r\n      platform.platform.showSaveDialog(\"Save As\", save, {\r\n        multi          : false,\r\n        addToRecentList: true,\r\n        filters        : [{\r\n          name      : \"File\",\r\n          mime      : useJSON ? \"text/json\" : \"application/x-octet-stream\",\r\n          extensions: [\".\" + ext.toLowerCase()]\r\n        }]\r\n      }).then(path => {\r\n        _appstate.currentFileRef = path;\r\n        message(\"File saved\");\r\n      }).catch(err => {\r\n        if (typeof err === \"object\" && err.message) {\r\n          err = err.message;\r\n        }\r\n\r\n        error(\"Failed to save file \" + err);\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\nexport class SimpleAppOpenOp extends ToolOp {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : \"Open\",\r\n      toolpath: \"app.open\",\r\n      inputs  : {\r\n        forceDialog: new BoolProperty()\r\n      },\r\n      undoflag: UndoFlags.NO_UNDO\r\n    }\r\n  }\r\n\r\n  exec(ctx) {\r\n    let ext = _appstate.fileExt;\r\n    let useJSON = _appstate.startArgs.saveFilesInJSON;\r\n    let mime = useJSON ? \"text/json\" : \"application/x-octet-stream\";\r\n\r\n    platform.platform.showOpenDialog(\"Open File\", {\r\n      multi          : false,\r\n      addToRecentList: true,\r\n      filters        : [{\r\n        name      : \"File\",\r\n        mime,\r\n        extensions: [\".\" + ext.toLowerCase()]\r\n      }]\r\n    }).then(paths => {\r\n      for (let path of paths) {\r\n        platform.platform.readFile(path, mime).then(data => {\r\n          console.log(\"got data!\", data);\r\n\r\n          _appstate.loadFile(data, {useJSON, doScreen: true, fromFileOp: true})\r\n            .catch(err => {\r\n              error(\"File error: \" + err.message);\r\n            });\r\n        });\r\n      }\r\n    }).catch(error => {\r\n      ctx.error(error.message);\r\n    })\r\n  }\r\n}\r\n\r\nexport function register() {\r\n  ToolOp.register(SimpleAppSaveOp);\r\n  ToolOp.register(SimpleAppOpenOp);\r\n  ToolOp.register(SimpleAppNewOp);\r\n}\r\n","import nstructjs from '../path-controller/util/struct.js';\r\nimport {Context, ContextOverlay, makeDerivedOverlay} from '../path-controller/controller/context.js';\r\n\r\nexport const DataModelClasses = [];\r\nimport {ToolStack} from '../path-controller/toolsys/toolsys.js';\r\nimport {DataAPI} from '../path-controller/controller/controller.js';\r\nimport {Screen} from '../screen/FrameManager.js';\r\nimport {areaclasses} from '../screen/area_wrangler.js';\r\nimport * as util from '../util/util.js';\r\nimport {Editor} from './editor.js';\r\n\r\nimport {Vector2} from '../path-controller/util/vectormath.js';\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nexport class DataModel {\r\n  static defineAPI(api, strct) {\r\n    return strct;\r\n  }\r\n\r\n  static register(cls) {\r\n    if (!cls.hasOwnProperty(\"defineAPI\")) {\r\n      //  throw new Error(cls.name + \"is missing a defineAPI method\");\r\n    }\r\n\r\n    DataModelClasses.push(cls);\r\n\r\n    if (cls.hasOwnProperty(\"STRUCT\")) {\r\n      nstructjs.register(cls);\r\n    }\r\n  }\r\n}\r\n\r\nclass EmptyContextClass extends Context {\r\n  static defineAPI(api, strct) {\r\n  }\r\n}\r\n\r\nimport * as ui_noteframe from '../widgets/ui_noteframe.js';\r\n\r\n/**\r\n * Extend the client-provided context class\r\n * with a few standard methods and properties\r\n *\r\n * */\r\nfunction GetContextClass(ctxClass) {\r\n  let ok = 0;\r\n  let cls = ctxClass;\r\n  while (cls) {\r\n    if (cls === Context) {\r\n      ok = 1;\r\n    } else if (cls === ContextOverlay) {\r\n      ok = 2;\r\n    }\r\n\r\n    cls = cls.__proto__;\r\n  }\r\n\r\n  if (ok === 1) {\r\n    return ctxClass;\r\n  }\r\n\r\n  let OverlayDerived;\r\n\r\n  if (ok === 2) {\r\n    OverlayDerived = ctxClass;\r\n  } else {\r\n    OverlayDerived = makeDerivedOverlay(ctxClass);\r\n  }\r\n\r\n  class Overlay extends OverlayDerived {\r\n    constructor(state) {\r\n      super(state);\r\n    }\r\n\r\n    get screen() {\r\n      return this.state.screen;\r\n    }\r\n\r\n    get api() {\r\n      return this.state.api;\r\n    }\r\n\r\n    get toolstack() {\r\n      return this.state.toolstack;\r\n    }\r\n\r\n    message(msg, timeout = 2500) {\r\n      return ui_noteframe.message(this.screen, msg, timeout);\r\n    }\r\n\r\n    error(msg, timeout = 2500) {\r\n      return ui_noteframe.error(this.screen, msg, timeout);\r\n    }\r\n\r\n    warning(msg, timeout = 2500) {\r\n      return ui_noteframe.warning(this.screen, msg, timeout);\r\n    }\r\n\r\n    progressBar(msg, percent, color, timeout = 1000) {\r\n      return ui_noteframe.progbarNote(this.screen, msg, percent, color, timeout);\r\n    }\r\n  }\r\n\r\n  Context.register(Overlay);\r\n\r\n  return class ContextDerived extends Context {\r\n    constructor(state) {\r\n      super(state);\r\n\r\n      this.pushOverlay(new Overlay(state))\r\n    }\r\n\r\n    static defineAPI(api, st) {\r\n      return Overlay.defineAPI(api, st);\r\n    }\r\n  }\r\n}\r\n\r\nexport function makeAPI(ctxClass) {\r\n  let api = new DataAPI();\r\n\r\n  for (let cls of DataModelClasses) {\r\n    if (cls.defineAPI) {\r\n      cls.defineAPI(api, api.mapStruct(cls, true));\r\n    }\r\n  }\r\n\r\n  for (let k in areaclasses) {\r\n    areaclasses[k].defineAPI(api, api.mapStruct(areaclasses[k], true));\r\n  }\r\n\r\n  if (ctxClass.defineAPI) {\r\n    ctxClass.defineAPI(api, api.mapStruct(ctxClass, true));\r\n  } else {\r\n    throw new Error(\"Context class should have a defineAPI static method\");\r\n  }\r\n\r\n  api.rootContextStruct = api.mapStruct(ctxClass, api.mapStruct(ctxClass, true));\r\n\r\n  return api;\r\n}\r\n\r\nimport {Icons, loadDefaultIconSheet} from './icons.js';\r\nimport {IconManager, setIconManager, setIconMap, setTheme, UIBase} from '../core/ui_base.js';\r\nimport {FileArgs, loadFile, saveFile} from './file.js';\r\nimport {HotKey, KeyMap} from '../path-controller/util/simple_events.js';\r\nimport {initSplineTemplates} from '../path-controller/curve/curve1d_bspline.js';\r\nimport {MenuBarEditor, registerMenuBarEditor} from './menubar.js';\r\nimport {register} from './app_ops.js';\r\n\r\nexport class StartArgs {\r\n  constructor() {\r\n    this.singlePage = true;\r\n\r\n    this.icons = Icons;\r\n    this.iconsheet = undefined; //will default to loadDefaultIconSheet();\r\n    this.iconSizes = [16, 24, 32, 48];\r\n    this.iconTileSize = 32;\r\n    this.iconsPerRow = 16;\r\n    this.theme = undefined; //see scripts/core/theme.js\r\n\r\n    this.registerSaveOpenOps = true;\r\n\r\n    this.autoLoadSplineTemplates = true;\r\n    this.showPathsInToolTips = true;\r\n    this.enableThemeAutoUpdate = false;\r\n    this.addHelpPickers = false;\r\n    this.useNumSliderTextboxes = true;\r\n    this.numSliderArrowLimit = cconst.numSliderArrowLimit;\r\n    this.simpleNumSliders = cconst.simpleNumSliders;\r\n  }\r\n}\r\n\r\nexport class SimpleScreen extends Screen {\r\n  constructor() {\r\n    super();\r\n\r\n    this.keymap = new KeyMap([\r\n      new HotKey(\"Z\", [\"CTRL\"], () => {\r\n        this.ctx.toolstack.undo(this.ctx);\r\n      }),\r\n      new HotKey(\"Z\", [\"CTRL\", \"SHIFT\"], () => {\r\n        this.ctx.toolstack.redo(this.ctx);\r\n      }),\r\n    ])\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"simple-screen-x\"\r\n    }\r\n  }\r\n\r\n  init() {\r\n    if (this.ctx.state.startArgs.registerSaveOpenOps) {\r\n      this.keymap.add(new HotKey(\"S\", [\"CTRL\"], \"app.save()\"));\r\n      this.keymap.add(new HotKey(\"O\", [\"CTRL\"], \"app.open()\"));\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.style[\"position\"] = UIBase.PositionKey;\r\n    this.style[\"left\"] = this.pos[0] + \"px\";\r\n    this.style[\"top\"] = this.pos[1] + \"px\";\r\n  }\r\n}\r\n\r\nUIBase.register(SimpleScreen);\r\n\r\nexport class AppState {\r\n  /** ctxClass is the context class.  It can be either a simple class\r\n   *  or a subclass of the more complex path.ux Context class.  Note that\r\n   *  using Context will avoid subtle undo stack errors caused by the context\r\n   *  changing after a tool is run (this is why Context has a serialization\r\n   *  mechanism).\r\n   *\r\n   *  Path.ux will actually subclass ctxClass and add a few standard methods\r\n   *  and properties, see GetContextClass.*/\r\n  constructor(ctxClass, screenClass = SimpleScreen) {\r\n    this._ctxClass = ctxClass;\r\n\r\n    ctxClass = GetContextClass(ctxClass);\r\n\r\n    this.startArgs = undefined;\r\n    this.currentFileRef = undefined; //current file path/ref\r\n\r\n    this.ctx = new ctxClass(this);\r\n    this.ctx._state = this;\r\n    this.toolstack = new ToolStack();\r\n    this.api = makeAPI(ctxClass);\r\n    this.screenClass = screenClass;\r\n    this.screen = undefined;\r\n\r\n    this.fileMagic = \"STRT\";\r\n    this.fileVersion = [0, 0, 1];\r\n    this._fileExt = \"data\";\r\n    this._fileExtSet = false;\r\n    this.saveFilesInJSON = false; /* save files in nstructjs-json */\r\n\r\n    this.defaultEditorClass = undefined; //if undefined, the first non-menubar editor will be used\r\n  }\r\n\r\n\r\n  get fileExt() {\r\n    return this._fileExt;\r\n  }\r\n\r\n  set fileExt(ext) {\r\n    this._fileExt = ext;\r\n    this._fileExtSet = true;\r\n  }\r\n\r\n  /** resets the undo stack */\r\n  reset() {\r\n    this.toolstack.reset();\r\n  }\r\n\r\n  /** Create a new file. See this.makeScreen() if you wish\r\n   *  to create a new screen at this time, and this.reset()\r\n   *  if you wish to reset the undo stack*/\r\n  createNewFile() {\r\n    console.warn(\"appstate.createNewFile: implement me, using default hack\");\r\n    let state = new this.constructor(this.ctx._ctxClass);\r\n\r\n    state.api = this.api;\r\n    state.ctx = this.ctx;\r\n    state.startArgs = this.startArgs;\r\n    state.saveFilesInJSON = this.saveFilesInJSON;\r\n\r\n    state.toolstack = this.toolstack;\r\n    state.toolstack.reset();\r\n\r\n    this.screen.unlisten();\r\n    this.screen.remove();\r\n\r\n    for (let k in state) {\r\n      this[k] = state[k];\r\n    }\r\n\r\n    this.makeScreen();\r\n  }\r\n\r\n  saveFileSync(objects, args = {}) {\r\n    args = new FileArgs(Object.assign({\r\n      magic  : this.fileMagic,\r\n      version: this.fileVersion,\r\n      ext    : this.fileExt\r\n    }, args));\r\n\r\n    return saveFile(this, args, objects);\r\n  }\r\n\r\n  /** Serialize the application state. Takes\r\n   *  a list of objects to save (with nstructjs);\r\n   *  Subclasses should override this, like so:\r\n   *\r\n   *  saveFile(args={}) {\r\n   *    let objects = app state;\r\n   *    return super.saveFile(objects, args);\r\n   *  }\r\n   **/\r\n  saveFile(objects, args = {}) {\r\n    args = new FileArgs(Object.assign({\r\n      magic  : this.fileMagic,\r\n      version: this.fileVersion,\r\n      ext    : this.fileExt\r\n    }, args));\r\n\r\n    return new Promise((accept, reject) => {\r\n      accept(this.saveFileSync(objects, args));\r\n    });\r\n  }\r\n\r\n  loadFileSync(data, args = {}) {\r\n    args = new FileArgs(Object.assign({\r\n      magic  : this.fileMagic,\r\n      version: this.fileVersion,\r\n      ext    : this.fileExt\r\n    }, args));\r\n\r\n    let ret = loadFile(this, args, data);\r\n\r\n    if (args.doScreen) {\r\n      try {\r\n        this.ensureMenuBar();\r\n      } catch (error) {\r\n        console.error(error.stack);\r\n        console.error(error.message);\r\n        console.error(\"Failed to add menu bar\");\r\n      }\r\n\r\n      this.screen.completeSetCSS();\r\n      this.screen.completeUpdate();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   *  Loads a new file. The default behavior is a\r\n   *  complete state reset (you can control this\r\n   *  with args.reset_toolstack, args.reset_context\r\n   *  and args.doScreen).\r\n   *\r\n   *  As the base class cannot know just what to do\r\n   *  with the loaded data (the objects parameter\r\n   *  passed to saveFile) it is recommended you\r\n   *  override this function like so:\r\n   *\r\n   *  loadFile(data, args) {\r\n   *    return super.loadFile(data, args).then(fileData) => {\r\n   *      // load fileData.objects into appropriate properties\r\n   *      // this is the same objects array originally passed\r\n   *      // to this.saveFile\r\n   *      this.data = fileData.objects;\r\n   *    });\r\n   *  }\r\n   *\r\n   *  @param {ArrayBuffer|JSON|DataView} data\r\n   *  @param {FileArgs} args\r\n   *  */\r\n  loadFile(data, args = {}) {\r\n    return new Promise((accept, reject) => {\r\n      accept(this.loadFileSync(data, args));\r\n    });\r\n  }\r\n\r\n  ensureMenuBar() {\r\n    let screen = this.screen;\r\n    let ok = false;\r\n\r\n    for (let sarea of screen.sareas) {\r\n      if (sarea.area instanceof MenuBarEditor) {\r\n        ok = true;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (ok) {\r\n      return;\r\n    }\r\n\r\n    if (!Editor.makeMenuBar) {\r\n      /* don't make menu bar if Editor.registerAppMenu hasn't been called */\r\n      return;\r\n    }\r\n\r\n    /* ensure screen size is up to date */\r\n    screen.update();\r\n\r\n    let sarea = UIBase.createElement(\"screenarea-x\");\r\n\r\n    screen.appendChild(sarea);\r\n\r\n    let h = 55;\r\n    let min = new Vector2().addScalar(1e17);\r\n    let max = new Vector2().addScalar(-1e17);\r\n    let tmp = new Vector2();\r\n\r\n    for (let sarea2 of screen.sareas) {\r\n      if (sarea2 === sarea) {\r\n        continue;\r\n      }\r\n\r\n      min.min(sarea2.pos);\r\n      tmp.load(sarea2.pos).add(sarea2.size);\r\n      max.max(tmp);\r\n    }\r\n\r\n    let scale = (max[1] - min[1] - h)/(max[1] - min[1]);\r\n\r\n    for (let sarea2 of screen.sareas) {\r\n      if (sarea2 === sarea) {\r\n        continue;\r\n      }\r\n\r\n      sarea2.pos[1] *= scale;\r\n      sarea2.size[1] *= scale;\r\n      sarea2.pos[1] += h;\r\n    }\r\n\r\n    sarea.pos.zero();\r\n    sarea.size[0] = screen.size[0];\r\n    sarea.size[1] = h;\r\n\r\n    screen.regenScreenMesh();\r\n    screen.snapScreenVerts();\r\n\r\n    sarea.switch_editor(MenuBarEditor);\r\n\r\n    screen.solveAreaConstraints();\r\n\r\n    screen.completeSetCSS();\r\n    screen.completeUpdate();\r\n  }\r\n\r\n  makeScreen() {\r\n    if (this.screen) {\r\n      this.screen.unlisten();\r\n      this.screen.remove();\r\n    }\r\n\r\n    let screen = this.screen = UIBase.createElement(this.screenClass.define().tagname);\r\n    let sarea = UIBase.createElement(\"screenarea-x\");\r\n\r\n    screen.ctx = this.ctx;\r\n    sarea.ctx = this.ctx;\r\n\r\n    document.body.appendChild(screen);\r\n\r\n    let cls = this.defaultEditorClass;\r\n\r\n    if (!cls) {\r\n      for (let k in areaclasses) {\r\n        cls = areaclasses[k];\r\n\r\n        if (cls !== MenuBarEditor) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    sarea.switch_editor(cls);\r\n    screen.appendChild(sarea);\r\n\r\n    screen._init();\r\n    screen.listen();\r\n    screen.update();\r\n    screen.completeSetCSS();\r\n    screen.completeUpdate();\r\n\r\n    if (Editor.makeMenuBar) {\r\n      this.ensureMenuBar();\r\n    }\r\n  }\r\n\r\n  start(args = new StartArgs()) {\r\n    let args2 = new StartArgs();\r\n\r\n    let methodsCheck = [\r\n      \"saveFile\", \"createNewFile\", \"loadFile\"\r\n    ];\r\n\r\n    for (let method of methodsCheck) {\r\n      let m1 = AppState.prototype[method];\r\n      let m2 = this[method];\r\n\r\n      if (m1 === m2) {\r\n        console.warn(`Warning: it is recommended to override .${method} when subclassing simple.AppState`);\r\n      }\r\n    }\r\n\r\n    document.body.style[\"touch-action\"] = \"none\";\r\n\r\n    registerMenuBarEditor();\r\n\r\n    for (let k in args2) {\r\n      if (args[k] === undefined) {\r\n        args[k] = args2[k];\r\n      }\r\n    }\r\n\r\n    if (args.registerSaveOpenOps) {\r\n      register();\r\n    }\r\n\r\n    if (!args.iconsheet) {\r\n      args.iconsheet = loadDefaultIconSheet();\r\n    }\r\n\r\n    this.startArgs = args;\r\n\r\n    cconst.loadConstants(args);\r\n\r\n    if (args.autoLoadSplineTemplates) {\r\n      initSplineTemplates();\r\n    }\r\n\r\n    let sizes = [];\r\n    let images = [];\r\n\r\n    for (let size of args.iconSizes) {\r\n      sizes.push([args.iconTileSize, size]);\r\n      images.push(args.iconsheet);\r\n    }\r\n\r\n    window.iconsheet = args.iconsheet;\r\n\r\n\r\n    let iconManager = new IconManager(images, sizes, args.iconsPerRow);\r\n    setIconManager(iconManager);\r\n    setIconMap(args.icons);\r\n\r\n    if (args.theme) {\r\n      setTheme(args.theme);\r\n    }\r\n\r\n    document.body.style[\"margin\"] = \"0px\";\r\n    document.body.style[\"padding\"] = \"0px\";\r\n\r\n    if (args.singlePage) {\r\n      document.body.style[\"overflow\"] = \"hidden\";\r\n    }\r\n\r\n    this.makeScreen();\r\n\r\n    Object.defineProperty(window, \"C\", {\r\n      get() {\r\n        return this._appstate.ctx;\r\n      }\r\n    });\r\n\r\n    nstructjs.validateStructs();\r\n\r\n    if (this.saveFilesInJSON && !this._fileExtSet) {\r\n      this._fileExt = \"json\";\r\n    }\r\n\r\n    if (this._fileExt.startsWith(\".\")) {\r\n      this._fileExt = this._fileExt.slice(1, this._fileExt.length).trim();\r\n    }\r\n  }\r\n}\r\n","\r\nexport class SimpleContext {\r\n  constructor() {\r\n\r\n  }\r\n\r\n  static getContextClass() {\r\n    let props = {};\r\n\r\n    let rec = (cls) => {\r\n      let prototype = cls.prototype;\r\n\r\n      if (cls.__proto__ !== Object.__proto__) {\r\n        rec(cls);\r\n      }\r\n\r\n      for (let k in cls) {\r\n        let descr = Object.getOwnPropertyDescriptor(prototype, k);\r\n\r\n        if (descr) {\r\n          props[k] = descr;\r\n        }\r\n      }\r\n    }\r\n\r\n    console.log(props);\r\n\r\n    for (let k in props) {\r\n      if (k.search(\"_save\") >= 0 || k.search(\"_load\") >= 0) {\r\n        continue;\r\n      }\r\n\r\n    }\r\n  }\r\n}","import {PlatformAPI, isMimeText} from '../platform_base.js';\r\nimport {saveFile, loadFile} from '../../path-controller/util/html5_fileapi.js';\r\n\r\nimport {FileDialogArgs, FilePath} from '../platform_base.js';\r\n\r\nimport {mimeMap} from '../platform_base.js';\r\n\r\nexport function getWebFilters(filters=[]) {\r\n  let types = [];\r\n\r\n  for (let item of filters) {\r\n    let mime = item.mime;\r\n    let exts = [];\r\n\r\n    for (let ext of item.extensions) {\r\n      ext = \".\" + ext;\r\n      if (ext.toLowerCase() in mimeMap) {\r\n        mime = mime !== undefined ? mime : mimeMap[ext.toLowerCase()];\r\n      }\r\n\r\n      exts.push(ext);\r\n    }\r\n\r\n    if (!mime) {\r\n      mime = \"application/x-octet-stream\";\r\n    }\r\n\r\n    types.push({\r\n      description: item.name,\r\n      accept     : {\r\n        [mime]: exts\r\n      }\r\n    });\r\n  }\r\n\r\n  return types;\r\n}\r\n\r\nexport class platform extends PlatformAPI {\r\n  //returns a promise\r\n  static showOpenDialog(title, args = new FileDialogArgs()) {\r\n    let types = getWebFilters(args.filters);\r\n\r\n    return new Promise((accept, reject) => {\r\n      try {\r\n        window.showOpenFilePicker({\r\n          multiple: args.multi,\r\n          types\r\n        }).then(arg => {\r\n          let paths = [];\r\n\r\n          for (let file of arg) {\r\n            paths.push(new FilePath(file, file.name));\r\n          }\r\n\r\n          accept(paths);\r\n        });\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n    });\r\n    /*\r\n    let exts = [];\r\n\r\n    for (let list of args.filters) {\r\n      for (let ext of list.extensions) {\r\n        exts.push(ext);\r\n      }\r\n    }\r\n\r\n    return new Promise((accept, reject) => {\r\n      loadFile(args.defaultPath, exts).then((file) => {\r\n        accept([new FilePath(file)]);\r\n      });\r\n    });*/\r\n  }\r\n\r\n  static writeFile(data, handle, mime) {\r\n    handle = handle.data;\r\n\r\n    return handle.createWritable().then((file) => {\r\n      file.write(data);\r\n      file.close();\r\n    });\r\n  }\r\n\r\n  static showSaveDialog(title, savedata_cb, args = new FileDialogArgs()) {\r\n    if (!window.showSaveFilePicker) {\r\n      return this.showSaveDialog_old(...arguments);\r\n    }\r\n\r\n    let types = getWebFilters(args.filters);\r\n\r\n    return new Promise((accept, reject) => {\r\n      let fname;\r\n      let saveHandle;\r\n\r\n      try {\r\n        saveHandle = window.showSaveFilePicker({types});\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n\r\n      let handle;\r\n\r\n      saveHandle.then((handle1) => {\r\n        handle = handle1;\r\n\r\n        fname = handle.name;\r\n        console.log(\"saveHandle\", handle);\r\n        return handle.createWritable();\r\n      }).then((file) => {\r\n        let savedata = savedata_cb();\r\n\r\n        if (savedata instanceof Uint8Array || savedata instanceof DataView) {\r\n          savedata = savedata.buffer;\r\n        }\r\n\r\n        file.write(savedata);\r\n        file.close();\r\n\r\n        let path = new FilePath(handle, fname);\r\n        accept(path);\r\n      });\r\n    });\r\n  }\r\n\r\n  //returns a promise\r\n  static showSaveDialog_old(title, savedata, args = new FileDialogArgs()) {\r\n\r\n    let exts = [];\r\n\r\n    for (let list of args.filters) {\r\n      if (!Array.isArray(list) && list.filters) {\r\n        list = list.filters;\r\n      }\r\n\r\n      for (let ext of list) {\r\n        exts.push(ext);\r\n      }\r\n    }\r\n\r\n    return new Promise((accept, reject) => {\r\n      saveFile(savedata);\r\n\r\n      window.setTimeout(() => {\r\n        accept(\"undefined\");\r\n      });\r\n    });\r\n  }\r\n\r\n  //path is a FilePath instance, for web this is the actual file data\r\n  static readFile(path, mime = \"\") {\r\n    if (mime === \"\") {\r\n      mime = path.filename;\r\n      let i = mime.length-1;\r\n\r\n      while (i > 0 && mime[i] !== \".\") {\r\n        i--;\r\n      }\r\n\r\n      mime = mime.slice(i, mime.length).trim().toLowerCase();\r\n      if (mime in mimeMap) {\r\n        mime = mimeMap[mime];\r\n      }\r\n    }\r\n\r\n    return new Promise((accept, reject) => {\r\n      path.data.getFile().then((file) => {\r\n        console.log(\"file!\", file);\r\n\r\n        let promise;\r\n\r\n        if (isMimeText(mime)) {\r\n          promise = file.text();\r\n        } else {\r\n          promise = file.arrayBuffer();\r\n        }\r\n\r\n        promise.then(data => {\r\n          accept(data);\r\n        });\r\n      });\r\n    });\r\n\r\n    return new Promise((accept, reject) => {\r\n      let data = path.data;\r\n\r\n      if (isMimeText(mime)) {\r\n        let s = '';\r\n        data = new Uint8Array(data);\r\n\r\n        for (let i = 0; i < data.length; i++) {\r\n          s += String.fromCharCode(data[i]);\r\n        }\r\n\r\n        data = s;\r\n      }\r\n\r\n      accept(data);\r\n    });\r\n  }\r\n}\r\n","import './path-controller/util/polyfill.js';\r\n\r\nexport * from './xmlpage/xmlpage.js';\r\n\r\nexport * from './core/ui_base.js';\r\nexport * from './core/ui.js';\r\nexport * from './widgets/ui_widgets.js';\r\nexport * from './widgets/ui_widgets2.js';\r\nexport * from './core/ui_theme.js';\r\nexport * from './core/units.js';\r\nexport * from './widgets/ui_button.js';\r\nexport * from './widgets/ui_richedit.js';\r\nexport * from './widgets/ui_curvewidget.js';\r\nexport * from './widgets/ui_panel.js';\r\nexport * from './widgets/ui_colorpicker2.js';\r\nexport * from './widgets/ui_tabs.js';\r\nexport * from './widgets/ui_listbox.js';\r\nexport * from './widgets/ui_menu.js';\r\nexport * from './widgets/ui_progress.js';\r\nexport * from './widgets/ui_table.js';\r\nexport * from './widgets/ui_noteframe.js';\r\nexport * from './widgets/ui_numsliders.js';\r\nexport * from './widgets/ui_lasttool.js';\r\nexport * from './widgets/ui_textbox.js';\r\nexport * from './path-controller/util/graphpack.js';\r\n//export * from './docbrowser/docbrowser.js';\r\n\r\nexport * from './path-controller/util/html5_fileapi.js';\r\nexport * from './path-controller/controller.js';\r\n\r\nimport * as controller from './path-controller/controller.js';\r\n\r\nexport {controller};\r\n\r\nimport * as ui_noteframe from './widgets/ui_noteframe.js';\r\n\r\ncontroller.setNotifier(ui_noteframe);\r\n\r\nexport {\r\n  PlatformAPI, getMime, isMimeText, mimeMap, textMimes, FileDialogArgs, FilePath\r\n} from './platforms/platform_base.js';\r\n\r\nimport * as platform from './platforms/platform.js';\r\n\r\nexport {platform};\r\n\r\nimport * as electron_api from './platforms/electron/electron_api.js';\r\n\r\nexport {electron_api};\r\n\r\nexport * from './widgets/theme_editor.js';\r\nexport * from './widgets/ui_treeview.js';\r\n\r\nexport * from './screen/FrameManager.js';\r\nexport * from './screen/ScreenArea.js';\r\nexport * from './util/ScreenOverdraw.js';\r\n\r\nimport cconst from './config/const.js';\r\n\r\nexport {cconst};\r\n\r\nimport * as simple from './simple/simple.js';\r\n\r\nexport {simple};\r\n"],"names":["window","global","visitgen","destroyAllCSS","visit","n","__visit","tagName","textContents","style","k","error","childNodes","c","document","head","body","sheet","styleSheets","i","rules","length","removeRule","eventDebugModule","start","debugEventLists","debugEventList","this","_addEventListener","EventTarget","prototype","addEventListener","_removeEventListener","removeEventListener","_dispatchEvent","dispatchEvent","onadd","onrem","ondispatch","add","type","data","push","a","arguments","event","thisvar","line","filename","replace","filepath","location","origin","ownerpath","apply","cb","args","pruneConnected","list","e","Node","isConnected","undefined","_debug_event_listeners","_disable_all_listeners","console","warn","EventSource","visualViewport","width","innerWidth","height","innerHeight","offsetLeft","offsetTop","pageLeft","pageTop","scale","Array","set","array","src","dst","count","RangeError","len","Math","min","Object","defineProperty","enumerable","configurable","Float64Array","Float32Array","Uint8Array","Uint8ClampedArray","Int32Array","Int16Array","Int8Array","reject","func","filter","item","Symbol","iterator","keystr","fract","f","floor","tent","abs","sign","pop_i","idx","Error","remove","suppress_error","indexOf","trace","String","contains","substr","search","Number","Boolean","key","colormap","black","red","green","yellow","blue","magenta","cyan","white","reset","grey","orange","pink","brown","lightred","peach","termColorMap","termColor","s","toString","termPrint","re1a","re1b","re2","endtag","tok","value","tokdef","s2","tokens","mintk","mini","minslice","mintype","ok","tk","slice","match","chunk","t","cur","stack","out","pop","print_lines","ld","lineno","col","printColors","token","buf","lines","split","istart","max","iend","color","l","colstr","constructor","val","lexpos","lexer","parser","name","regexpr","example","re","startsWith","endsWith","trim","PUTIL_ParseError","msg","super","errfunc","lexdata","colmap","printTokens","linestart","linemap","tokints","statestack","states","__main__","statedata","logger","log","add_state","tok_int","push_state","state","pop_state","input","str","peeked_tokens","safepos","peek","next","peeknext","at_end","ignore_peek","shift","ts","tlen","results","res","exec","index","theres","max_res","def","parse","err_on_unconsumed","ret","estr","optional","expect","test_parser","basic_types","Set","reserved_tokens","has","toUpperCase","js","rt","lex","p_Type","p","toLowerCase","arraytype","itername","iname","p_Array","p_Field","field","get","st","fields","p_Struct","JSON","stringify","struct_parseutil","freeze","__proto__","NStruct","id","StructEnum","INT","FLOAT","DOUBLE","STRING","STATIC_STRING","STRUCT","TSTRUCT","ARRAY","ITER","SHORT","BYTE","BOOL","ITERKEYS","UINT","USHORT","STATIC_ARRAY","SIGNED_BYTE","ValueTypes","StructTypes","int","uint","ushort","float","double","string","static_string","struct","abstract","iter","short","byte","bool","iterkeys","sbyte","StructTypeMap","gen_tabstr","stripComments","strlit","strs","mode","escape","StructParser","forEach","parser$1","p_Iter","p_IterKeys","size","p_StaticArray","num","maxlength","p_Static_String","jsonKeyword","p_Abstract","tname","DATAREF","p_DataRef","p_ID_or_num","check","struct_parse","struct_parser","struct_typesystem","STRUCT_ENDIAN","setBinaryEndian","temp_dataview","DataView","ArrayBuffer","uint8_view","buffer","unpack_context","pack_byte","pack_sbyte","pack_bytes","bytes","pack_int","setInt32","pack_uint","setUint32","pack_ushort","setUint16","pack_float","setFloat32","pack_double","setFloat64","pack_short","setInt16","encode_utf8","arr","charCodeAt","uc","decode_utf8","sum","j","fromCharCode","test_utf8","truncate_utf8","maxlen","last_codepoint","last2","incode","_static_sbuf_ss","pack_static_string","_static_sbuf","pack_string","unpack_bytes","dview","uctx","unpack_byte","getUint8","unpack_sbyte","getInt8","unpack_int","getInt32","unpack_uint","getUint32","unpack_ushort","getUint16","unpack_float","getFloat32","unpack_double","getFloat64","unpack_short","getInt16","_static_arr_us","unpack_string","slen","_static_arr_uss","unpack_static_string","done","struct_binpack","warninglvl","debug","_static_envcode_null","packer_debug","packer_debug_start","packer_debug_end","packdebug_tablevel","_get_pack_debug","cachering","tot","static","cls","gen_tabstr$1","setWarningMode2","isNaN","setDebugMode2","tab","funcname","StructFieldTypes","StructFieldTypeMap","packNull","manager","toJSON","obj","fromJSON","instance","validateJSON","_abstractKey","unpack_field","define","unpack","fakeFields","fmt_type","format","do_pack","typeid","pack","_ws_env","StructFieldType","StructIntField","register","StructFloatField","StructDoubleField","StructStringField","StructStaticStringField","StructStructField","stt","get_struct","write_struct","validateJSONIntern","readJSON","writeJSON","dest","cls2","get_struct_cls","read_object","field2","StructTStructField","keywords","structName","parentcls","struct_ids","get_struct_id","struct_cls","StructArrayField","d","type2","env","val2","_env_call","fakeField","process","exit","json","StructIterField","starti","call","StructShortField","StructByteField","StructSignedByteField","StructBoolField","StructIterKeysField","StructUintField","StructUshortField","StructStaticArrayField","_sintern2","structEval","eval","setStructEval","_struct_eval","TokSymbol","buildJSONParser","nfloat3","nfloatexp","numre","RegExp","numreTest","tests","test","char","parseFloat","tokinfo","p_Start","throwError","first","p_Object","jsonParser","nGlobal","printContext","l2","globalThis","globals","self","DEBUG","updateDEBUG","keys","sintern2","struct_eval","warninglvl$1","truncateDollarSign","JSONError","setTruncateDollarSign","v","_truncateDollarSign","unmangle","_static_envcode_null$1","packer_debug$1","packer_debug_start$1","packer_debug_end$1","gen_tabstr$2","update_debug_data","setWarningMode","setDebugMode","_ws_env$1","haveCodeGen","define_empty_class","scls","create","loadSTRUCT","reader","newSTRUCT","idgen","allowOverriding","structs","compiled_code","null_natives","define_null_native","jsonUseColors","jsonBuf","child","parent","code","fmt_struct","bad","fromSTRUCT","obj2","concat","getOwnPropertySymbols","internal_only","no_helper_js","keyword","nameKeyword","script","load","new","after","from","validateStructs","onerror","getType","formatStruct","parse_structs","defined_classes","struct2","clsmap","dummy","registerGraph","srcSTRUCT","recStruct","recArray","add_class","st2","unregister","inherit","isRegistered","hasOwnProperty","envcode","fullcode","code2","err","use_helper_js","useHelperJS","thestruct","t1","tinyeval","write_object","readObject","cls_or_struct_id","writeObject","json2","isArray","assign","objInstance","this2","was_run","flen","unpackInto","makeLoader","useInternalParser","useColors","consoleLogger","jsonLogger","message","keyTestJson","f2","StructClass","deriveStructManager","NewSTRUCT","write_scripts","nManager","include_code","nl","buf2","i2","nbtoa","natob","versionToInt","mul","versionCoerce","major","minor","micro","setClassKeyword","btoa","Buffer","atob","ver_pat","ver","parseInt","versionLessThan","b","FileParams","magic","ext","blocktypes","version","Block","type_magic","FileeError","FileHelper","params","fp","unpack_ctx","read","dataview","FileError","scripts","blocks","dviewlen","byteLength","bdata","datalen","bstruct","block","doVersions","old","write","data2","writeBase64","makeBlock","readBase64","base64","struct_filehelper","truncateDollarSign$1","setEndian","validateJSON$1","getEndian","setAllowOverriding","__uctx","class_or_struct_id","impl","phones","iPhone","BlackBerry","HTC","Nexus","Dell","Motorola","Samsung","LG","Sony","Asus","NokiaLumia","Micromax","Palm","Vertu","Pantech","Fly","Wiko","iMobile","SimValley","Wolfgang","Alcatel","Nintendo","Amoi","INQ","OnePlus","GenericPhone","tablets","iPad","NexusTablet","GoogleTablet","SamsungTablet","Kindle","SurfaceTablet","HPTablet","AsusTablet","BlackBerryTablet","HTCtablet","MotorolaTablet","NookTablet","AcerTablet","ToshibaTablet","LGTablet","FujitsuTablet","PrestigioTablet","LenovoTablet","DellTablet","YarvikTablet","MedionTablet","ArnovaTablet","IntensoTablet","IRUTablet","MegafonTablet","EbodaTablet","AllViewTablet","ArchosTablet","AinolTablet","NokiaLumiaTablet","SonyTablet","PhilipsTablet","CubeTablet","CobyTablet","MIDTablet","MSITablet","SMiTTablet","RockChipTablet","FlyTablet","bqTablet","HuaweiTablet","NecTablet","PantechTablet","BronchoTablet","VersusTablet","ZyncTablet","PositivoTablet","NabiTablet","KoboTablet","DanewTablet","TexetTablet","PlaystationTablet","TrekstorTablet","PyleAudioTablet","AdvanTablet","DanyTechTablet","GalapadTablet","MicromaxTablet","KarbonnTablet","AllFineTablet","PROSCANTablet","YONESTablet","ChangJiaTablet","GUTablet","PointOfViewTablet","OvermaxTablet","HCLTablet","DPSTablet","VistureTablet","CrestaTablet","MediatekTablet","ConcordeTablet","GoCleverTablet","ModecomTablet","VoninoTablet","ECSTablet","StorexTablet","VodafoneTablet","EssentielBTablet","RossMoorTablet","iMobileTablet","TolinoTablet","AudioSonicTablet","AMPETablet","SkkTablet","TecnoTablet","JXDTablet","iJoyTablet","FX2Tablet","XoroTablet","ViewsonicTablet","VerizonTablet","OdysTablet","CaptivaTablet","IconbitTablet","TeclastTablet","OndaTablet","JaytechTablet","BlaupunktTablet","DigmaTablet","EvolioTablet","LavaTablet","AocTablet","MpmanTablet","CelkonTablet","WolderTablet","MediacomTablet","MiTablet","NibiruTablet","NexoTablet","LeaderTablet","UbislateTablet","PocketBookTablet","KocasoTablet","HisenseTablet","Hudl","TelstraTablet","GenericTablet","oss","AndroidOS","BlackBerryOS","PalmOS","SymbianOS","WindowsMobileOS","WindowsPhoneOS","iOS","iPadOS","MeeGoOS","MaemoOS","JavaOS","webOS","badaOS","BREWOS","uas","Chrome","Dolfin","Opera","Skyfire","Edge","IE","Firefox","Bolt","TeaShark","Blazer","Safari","WeChat","UCBrowser","baiduboxapp","baidubrowser","DiigoBrowser","Mercury","ObigoBrowser","NetFront","GenericBrowser","PaleMoon","props","Mobile","Build","Version","VendorID","iPod","Coast","Fennec","NokiaBrowser","MQQBrowser","MicroMessenger","SamsungBrowser","Iron","Tizen","Webkit","Gecko","Trident","Presto","Goanna","Android","BREW","Java","Symbian","utils","Bot","MobileBot","DesktopMode","TV","WebKit","Console","Watch","fullPattern","shortPattern","tabletPattern","hasOwnProp","equalIC","containsIC","valueLC","convertPropsToRegExp","object","MobileDetect","userAgent","maxPhoneWidth","ua","prepareUserAgent","_cache","FALLBACK_PHONE","FALLBACK_TABLET","FALLBACK_MOBILE","values","verPos","mobileDetectRules","substring","oss0","findMatch","findMatches","result","getVersionStr","propertyName","patterns","getVersion","prepareVersionNo","NaN","numbers","join","isMobileFallback","detectMobileBrowsers","isTabletFallback","prepareDetectionCache","cache","mobile","phone","tablet","phoneSized","isPhoneSized","mobileGrade","$isMobile","os","is","detectOS","getDeviceSmallerSide","screen","userAgents","versionStr","pattern","grade","_impl","module","exports","factory","amd","keyStrBase64","keyStrUriSafe","baseReverseDic","getBaseValue","alphabet","character","charAt","getInput","lzstring","compressToBase64","_compress","decompressFromBase64","_decompress","compressToUTF16","decompressFromUTF16","compressed","compressToUint8Array","uncompressed","compress","TotalLen","current_value","decompressFromUint8Array","decompress","compressToEncodedURIComponent","decompressFromEncodedURIComponent","bitsPerChar","getCharFromInt","ii","context_dictionary","context_dictionaryToCreate","context_c","context_wc","context_w","context_enlargeIn","context_dictSize","context_numBits","context_data","context_data_val","context_data_position","pow","resetValue","getNextValue","w","bits","resb","maxpower","power","dictionary","enlargeIn","dictSize","numBits","entry","position","f64tmp","u16tmp","Uint16Array","isDenormal","_isDenormal","teal","gray","MovingAvg","used","sample","timers","mdetect","mret","pollTimer","interval","time_ms","isMobile","navigator","SmartConsoleContext","random","sqrt","r","g","__console","timeInterval","timeIntervalAll","_last","last","_data","_data_length","maxCache","hash","dohash","h","WeakSet","recurse","strhash","getAllKeys","clearCache","_getData","time","_check","SmartConsole","contexts","context","tm","EmptySlot","getClassParent","iterable","searchItem","getOwnPropertyDescriptors","proto","formatNumberUI","isInt","decimals","Infinity","toFixed","performance","now","Date","getMilliseconds","color2css","merge","obja","objb","debug_cacherings","_cacherings","_clear_all_cacherings","kill_all","copy","Reflect","ownKeys","ch","_nonvector_cacherings","_stale_cacherings","sort","gen","isprivate","private","SetIter","items","freelist","equals","setb","clear","map","reduce","initial","delete","ignore_existence","HashIter","_items","_hash_null","hashtable","_keys","key2","IDGenInternalIDGen","IDGen","__cur","_debug","_internalID","isFinite","_cur","max_cur","get_callstack","print_stack","fetch_file","path","url","req","XMLHttpRequest","Promise","accept","open","onreadystatechange","status","readyState","response","statusText","send","_int32","x","nstructjs","MersenneRandom","seed","mt","Uint32Array","extract_number","nrandom","fill","twist","y","_mt","smallstr_hashes","hashsizes","FTAKEN","FKEY","FVAL","FTOT","FastHash","cursize","resize","table","probe","valueOf","_i","test_fasthash","ImageReader","load_image","doaccept","createElement","promise","files","FileReader","onload","target","image","Image","canvas","getContext","drawImage","idata","getImageData","readAsDataURL","click","then","digestcache","HashDigest","hashjoin","_test_hash2","fromConstructor","NullItem","MapIter","ownermap","finish","itercur","_list","return","iterstack","validateId","_test_map","m","item2","UndefinedTag","IDMap","iteritem","_test_idmap","HW","HELEM","HTOT","heaplog","MinHeapQueue","iterw","heap","end","witer","depth","ceil","swap","n1","n2","testHeapQueue","list1","Queue","initialSize","queue","enqueue","qlen","clearData","dequeue","_testQueue","steps","samples","ArrayPool","pools","Map","pool","DivLogger","elemId","maxLines","elem","update","getElementById","innerHTML","description","k2","PendingTimeoutPromises","TimeoutPromise","callback","timeout","silent","accept2","_accept2","bind","reject2","_reject2","rejected","_promise","_accept","_reject","catch","wrapPromise","finally","setInterval","EulerOrders","XYZ","XZY","YXZ","YZX","ZXY","ZYX","makeCompiledVectormathCode","es6exports","doExports","classes","Vector2","Vector3","Vector4","lens","Quat","modecode","nstructjscode","indent","pad","zero","internal_matrix","Matrix4","sin","cos","asin","exp","acos","atan2","atan","PI","E","DOT_NORM_SNAP_LIMIT","M_SQRT2","FLT_EPSILON","basic_funcs","negate","combine","interp","addFac","sub","div","mulScalar","divScalar","addScalar","subScalar","minScalar","maxScalar","clamp","bounded_acos","fac","pi","make_norm_safe_dot","_dot","dot","getBaseVector","BaseVector","vec","vectorsize","vectorDotDistance","vectorDistance","vectorDistanceSqr","line2","init_swizzle","Function","vectorLength","swapAxes","axis1","axis2","normalize","F64BaseVector","F32BaseVector","myclamp","toCSS","loadXYZW","z","loadXYZ","mulVecQuat","q","t0","t2","multVecMatrix","matrix","$matrix","m41","m11","m21","m31","m42","m12","m22","m32","m43","m13","m23","m33","m44","m14","m24","m34","cross","preNormalizedAngle","v2","th","_v3nd_n1_normalizedDot","_v3nd_n2_normalizedDot","_v3nd4_n1_normalizedDot4","_v3nd4_n2_normalizedDot4","preventExtensions","v1","v3","v4","$_v3nd4_n1_normalizedDot4","$_v3nd4_n2_normalizedDot4","center","$_v3nd4_n1_normalizedDot3","$_v3nd4_n2_normalizedDot3","loadXY","loadJSON","initVector3","normalizedDot","$_v3nd_n1_normalizedDot","$_v3nd_n2_normalizedDot","ignore_w","isPersp","rot2d","A","axis","initVector2","co","w2","vectorLengthSqr","_quat_vs3_temps","util.cachering","makeUnitQuat","isZero","mulQuat","qt","conjugate","dotWithQuat","q2","invert","conjugate_qt","mulscalar","nq2","mulScalarWithFactor","angle","si","last3","toMatrix","q0","q1","q3","qda","qdb","qdc","qaa","qab","qac","qbb","qbc","qcc","matrixToQuat","wmat","mat","temp_mats","r1","r2","r3","tr","axisAngleToQuat","nor","phi","rotationBetweenVecs","quatInterp","quat2","omega","sinom","sc1","sc2","quat","cosom","lookat_cache_vs3","lookat_cache_vs4","makenormalcache","lookat_cache_ms","euler_rotate_mats","preMultTemp","clone","addToHashDigest","m1","m2","loadColumn","have4","copyColumnTo","copyColumn","makeIdentity","getAsArray","getAsFloat32Array","setUniform","ctx","loc","transpose","setUniformArray","setUniformWebGLArray","uniformMatrix4fv","tmp","determinant","_determinant4x4","det","_makeAdjoint","translate","multiply","preTranslate","preMultiply","preScale","euler_rotate_order","order","xmat","ymat","zmat","euler_rotate","dec","rotate","sinA","cosA","sinA2","x2","y2","z2","flat","clearTranslation","set_w_to_one","setTranslation","resetW","makeNormalMatrix","normal","up","mm","mm2","divide","divisor","ortho","left","right","bottom","top","near","far","tx","ty","tz","frustum","B","C","D","orthographic","aspect","zscale","perspective","fovy","zNear","zFar","tan","lookat","pos","zvec","yvec","xvec","makeRotationOnly","l1","l3","alignAxis","inputs","transformMatrix","getValue","mat2","rot","decompose","axes","getAsVecs","axis3","loadFromVecs","_translate","_rotate","_scale","_skew","_perspective","rmat","_determinant2x2","_determinant3x3","a1","a2","a3","b1","b2","b3","c1","c2","c3","d1","d2","d3","a4","b4","c4","d4","__mat","testmat","PropTypes","ENUM","FLAG","VEC2","VEC3","VEC4","MATRIX4","QUAT","PROPLIST","STRSET","CURVE","FLOAT_ARRAY","REPORT","PropSubTypes","COLOR","PropFlags","SELECT","PRIVATE","LABEL","USE_ICONS","USE_CUSTOM_GETSET","SAVE_LAST_VALUE","READ_ONLY","SIMPLE_SLIDER","FORCE_ROLLER_SLIDER","USE_BASE_UNDO","EDIT_AS_BASE_UNIT","NO_UNDO","USE_CUSTOM_PROP_GETTER","FORCE_ENUM_CHECKBOXES","NO_DEFAULT","ToolPropertyIF","subtype","apiname","uiname","flag","icon","copyTo","_fire","arg1","arg2","on","off","setValue","setStep","step","setRange","setUnit","unit","setUIRange","setIcon","StringPropertyIF","NumPropertyIF","IntPropertyIF","setRadix","radix","FloatPropertyIF","setDecimalPlaces","EnumPropertyIF","valid_values","ui_value_names","iconmap","uin","addIcons","FlagPropertyIF","Vec2PropertyIF","Vec3PropertyIF","Vec4PropertyIF","ListPropertyIF","prop","StringSetPropertyIF","definition","destructive","soft_fail","addUINames","addDescriptions","Curve1DPropertyIF","curve","FLT_EPSILONE","myfloor","normString","myToFixed","Units","Unit","unitDefine","MeterUnit","InchUnit","foot_re","FootUnit","parts","vft","vin","square_foot_re","SquareFootUnit","MileUnit","DegreeUnit","RadianUnit","setBaseUnit","baseUnit","setMetric","isMetric","_getBaseUnit","numre1","numre2","hexre1","hexre2","binre","expre","intre","isnumber","parseValueIntern","base","getUnit","validate","toInternal","fromInternal","parseValue","displayUnit","isNumber","PixelUnit","convert","unita","unitb","buildString","decimalPlaces","_parseValueTest","_buildStringTest","config","doubleClickTime","autoLoadSplineTemplates","doubleClickHoldTime","setConfig","modalstack","singleMouseCBs","Screen","ContextAreaClass","debugDomEvents","cbsymbol","thsymbol","init","et","getkey","options","singletonMouseEvents","ddd","testSingleMouseUpEvent","singleMouseEvent","_mpos","doSingleCbs","touches","pageX","pageY","copyEvent","util.print_stack","capture","isLeftClick","button","DoubleClickHandler","down","dblEvent","start_mpos","_on_mouseup","_on_mousemove","mdown","mpos","devicePixelRatio","mousedown","isMouseDown","cpy","util.time_ms","cconst","ondblclick","abort","buttons","pathDebugEvent","extra","__prevdef","preventDefault","__stopprop","stopPropagation","eventWasTouch","sourceCapabilities","firesTouchEvents","was_touch","TouchEvent","PointerEvent","pointerType","getOwnPropertyNames","original","_setScreenClass","findScreen","rec","_setModalAreaClass","pushPointerModal","pointerId","autoStopPropagation","pushModalLight","handlers","last_mpos","touchmap","touchstart","touchmove","touchend","touchcancel","handleAreaContext","sarea","findScreenArea","area","push_ctx_active","pop_ctx_active","make_default_touchhandler","domEvents","e2","clientX","clientY","screenX","screenY","make_handler","found","handler","settings","passive","make_pointer","pointer","setPointerCapture","popModalLight","lock","modalEvents","unlock","releasePointerCapture","haveModal","_findScreen","_haveModal","keymap_latin_1","Space","Escape","Enter","Return","Up","Down","Left","Right","Num0","Num1","Num2","Num3","Num4","Num5","Num6","Num7","Num8","Num9","Home","End","Delete","Backspace","Insert","PageUp","PageDown","Tab","NumPlus","NumMinus","Shift","Ctrl","Control","Alt","keymap_latin_1_rev","keymap","reverse_keymap","HotKey","modifiers","action","mods","api","execTool","KeyMap","hotkeys","pathid","hk","handle","util.set","shiftKey","altKey","ctrlKey","commandKey","keyCode","EventDispatcher","_cbs","_fireEvent","stop","copyMouseEvent","_orig","exclude","DomEventTypes","on_mousemove","on_mousedown","on_mouseup","on_touchstart","on_touchcancel","on_touchmove","on_touchend","on_mousewheel","on_keydown","on_keyup","on_pointerdown","on_pointermove","on_pointercancel","on_pointerup","getDom","dom","eventtype","modalStack","isModalHead","owner","EventHandler","_modalstate","simple_events.pushPointerModal","pushModal","_is_root","simple_events.pushModalLight","popModal","simple_events.popModalLight","CurveConstructors","CURVE_VERSION","CurveFlags","TangentModes","SMOOTH","BREAK","getCurve","throw_on_error","_udigest","util.HashDigest","CurveTypeData","typeName","hasGUI","calcHashKey","digest","redraw","makeGUI","container","killGUI","evaluate","integrate","s1","quadSteps","ds","derivative","df","derivative2","inverse","best","mid","y1","ymid","onActive","draw_transform","onInactive","destroy","_on_change","draw","evalHermiteTable","genHermiteTable","lastdv1","lastf3","eps","dt","f3","dv1","j2","vectormath.Vector2","SplineTemplates","CONSTANT","LINEAR","SHARP","SQRT","SMOOTHER","SHARPER","SPHERE","REVERSE_LINEAR","GUASSIAN","templates","SplineTemplateIcons","RecalcFlags","BASIS","FULL","ALL","FULL_BASIS","mySafeJSONStringify","mySafeJSONParse","bin_cache","_bin_cache","eval2_rets","bez3","bez4","binomial","bin","Curve1DPoint","rco","sco","startco","eid","tangent","seal","deg","splineCache","BSplineCache","curves","maxCurves","limit","cache_w","curve2","_last_cache_key","updateKnots","regen_basis","regen_hermite","_remove","_splineCache","BSplineCurve","_last_update_key","fastmode","points","interpolating","range","_ps","hermite","recalc","basis_tables","eidgen","util.IDGen","uidata","p2","p1","no_update","_sortPoints","hightlight","basis","_basis","empty","_evaluate","f4","solve_interpolating","_evaluate2","error1","orig","totgs","ps","safe_inv","bas","kn","knn","knn1","ki","start_t","ret1","ret2","f1","totbasis","sumx","sumy","_wrapTouchEvent","isTouch","loadTemplate","templ","drawTransform","transpoints","transforming","draw_trans","bstrip","row","strip","makebutton","iconbutton","iconsheet","customIcon","fullUpdate","Icons","getIconEnum","TINY_X","slider","simpleslider","checked","onchange","panel","xmin","xmax","ymin","ymax","closed","start_transform","transform_mpos","do_highlight","highlight","minp","mindis","limitsqr","dx","dy","dis","do_transform","getClientRects","dpi","trans","end_transform","_save_hook","save","lineWidth","beginPath","fillStyle","rect","restore","makeSplineTemplateIcons","moveTo","lineTo","ls","lineCap","strokeStyle","stroke","toDataURL","img","splineTemplatesLoaded","initSplineTemplates","_SplineTemplateIcons","setTimeout","feq","EquationCurve","equation","_last_equation","textbox","label","gui","updateTextBox","text","_haserror","cosh","sinh","cbrt","GuassianCurve","offset","deviation","hslider","oslider","dslider","Ease","linear","none","amount","getPowIn","getPowOut","getPowInOut","quadIn","quadOut","quadInOut","cubicIn","cubicOut","cubicInOut","quartIn","quartOut","quartInOut","quintIn","quintOut","quintInOut","sineIn","sineOut","sineInOut","getBackIn","backIn","getBackOut","backOut","getBackInOut","backInOut","circIn","circOut","circInOut","bounceIn","bounceOut","bounceInOut","getElasticIn","amplitude","period","pi2","elasticIn","getElasticOut","elasticOut","getElasticInOut","elasticInOut","ParamKey","BOOL_FLAG","SimpleCurveBase","defaultval","_saveParams","pdef","pair","BounceCurve","decay","freq","phase","ElasticCurve","_func","_last_hash","EaseCurve","mode_in","mode_out","amp","RandCurve","util.MersenneRandom","_seed","in_mode","Curve1D","uiZoom","generators","VERSION","setGenerator","generatorType","active","_fastmode","gen1","gen2","buf1","active_generator","localeCompare","getGenerator","switchGenerator","sz","overlay_curvefunc","_active","NumberConstraintsBase","IntegerConstraints","util.list","FloatConstrinats","NumberConstraints","setPropTypes","types","customPropertyTypes","PropClasses","customPropTypeBase","wordmap","sel","unsel","defaultRadix","defaultDecimalPlaces","OnceTag","ToolProperty","PROP_TYPE_ID","wasSet","icon2","callbacks","lastc","ischar","upper","lower","subst","word","logBase","report","util.termColor","setDescription","setUIName","calcMemSize","strlen","saveLastValue","clearEventCallbacks","once","cb2","uiRange","getStep","stepIsRelative","calcRelativeStep","setRelativeStep","noUnits","setDisplayUnit","setFlag","setIcon2","FloatArrayProperty","StringProperty","multiLine","internalRegister","NumProperty","_NumberPropertyBase","slideSpeed","expRate","ui_range","setSlideSpeed","setExpRate","IntProperty","ReportProperty","BoolProperty","FloatProperty","EnumKeyPair","key_is_int","val_is_int","EnumProperty","string_or_int","descriptions","makeUIName","iconmap2","calcHash","updateDefinition","enumdef_or_prop","enumdef","addIcons2","api_update","_loadMap","_saveMap","_values","_ui_value_names","_iconmap","_iconmap2","_descriptions","data_is_int","_is_data_int","FlagProperty","bitmask","VecPropertyBase","hasUniformSlider","uniformSlider","Vec2Property","Vec3Property","isColor","Vec4Property","QuatProperty","Mat4Property","ListProperty","psize","prop1","prop2","getListItem","setListItem","StringSetProperty","Curve1DProperty","ClassIdSymbol","ScreenClass","setScreenClass","getAreaIntName","AreaTypes","TEST_CANVAS_EDITOR","setAreaTypes","areaclasses","theWrangler","AreaWrangler","stacks","lasts","lastArea","locked","_last_screen_id","makeSafeContext","wrangler","Proxy","contextWrangler","stack1","_checkWrangler","_id","findInstance","pushLastRef","updateLastRef","getLastArea","dtvtmps","quad_co_rets2","quad_bilinear","u","quad_uv_2d","u1","u2","v2x","v2y","v3x","v3y","v4x","v4y","C1","C2","ClosestModes","CLOSEST","START","END","ENDPOINTS","advs","AbstractCurve","curvature","ClosestCurveRets","cvrets","cvarrays","util.ArrayPool","cvtmp","closestPoint","poly_normal_tmps","pncent","normal_poly","vs","normal_tri","normal_quad","cent","barycentric_v2_rets","calc_proj_refs","dihedral_v3_sqr","bx","by","bz","cx","cy","cz","dz","tet_area_tmps","tet_volume","calc_projection_axes","no","ax","ay","az","_avtmps","inrect_3d","aabb_isect_line_3d","inside","closest_point_on_line","aabb_isect_cylinder_3d","radius","barycentric_v2","_linedis2","v1x","v1y","v1z","v2z","closest_p_tri_rets","uv","dist","cpt_v1","cpt_v2","cpt_v3","cpt_v4","cpt_v5","cpt_v6","cpt_p","cpt_n","cpt_mat","cpt_mat2","cpt_b","closest_point_on_quad","uvw","closest_point_on_tri","ax1","ax2","op","ax3","dist_to_tri_v3_old","planedis","p3","pp","tmp2","linedis3d","point_in_tri","dist_to_tri_v3","_dt3s_n","dist_to_tri_v3_sqr","nx","ny","nz","feps","bx2","by2","cx2","cy2","x1","z1","s3","mask","lx","ly","lz","tri_area_temps","tri_area","aabb_overlap_area","pos1","size1","pos2","size2","aabb_isect_2d","aabb_isect_3d","aabb_intersect_vs","aabb_intersect_rets","aabb_intersect_2d","test_aabb_intersect_2d","setAttribute","appendChild","clearRect","timer","_timer","clearInterval","rate","aabb_intersect_vs3","aabb_intersect_3d","min1","max1","min2","max2","aabb_union","aabb_union_2d","init_prototype","$_mh","$_swapt","COLINEAR","LINECROSS","COLINEAR_ISECT","_cross_vec1","_cross_vec2","SQRT2","FEPS_DATA","F16","F32","F64","FEPS","FLOAT_MIN","FLOAT_MAX","Matrix4UI","_static_grp_points4","_static_grp_points8","get_rect_points","cs","get_rect_lines","$vs_simple_tri_aabb_isect","simple_tri_aabb_isect","isect","MinMax","totaxis","_min","_max","_static_mr_co","_static_mr_cs","minmax_rect","minmax","winding_axis","up_axis","xaxis","yaxis","x3","winding","zero_z","tol","inrect_2d","$smin_aabb_isect_line_2d","$ssize_aabb_isect_line_2d","$sv1_aabb_isect_line_2d","$ps_aabb_isect_line_2d","$l1_aabb_isect_line_2d","$smax_aabb_isect_line_2d","$sv2_aabb_isect_line_2d","$l2_aabb_isect_line_2d","aabb_isect_line_2d","line_line_cross","expand_rect2d","margin","expand_line","colinear","_llc_l1","_llc_l2","_llc_l3","_llc_l4","lli_v1","lli_v2","lli_v3","lli_v4","_zero_cn","_tmps_cn","_rets_cn","corner_normal","vec1","vec2","line_line_isect","test_segment","xa1","xa2","ya1","ya2","xb1","xb2","yb1","yb2","w1","w3","w4","_asi_v1","_asi_v2","_asi_v3","_asi_v4","_asi_v5","_asi_v6","point_in_aabb_2d","_asi2d_v1","_asi2d_v2","_asi2d_v3","_asi2d_v4","_asi2d_v5","_asi2d_v6","aabb_sphere_isect_2d","mvec","dist_to_line_2d","point_in_aabb","asi_rect","aabb_sphere_isect_vs","aabb_sphere_isect","i3","aabb_sphere_dist","convex_quad","$e1_normal_tri","$e3_normal_tri","$e2_normal_tri","isNum","_normal_tri_rets","y3","z3","$n2_normal_quad","_q1","_q2","_q3","normal_quad_old","_len","_li_vi","line_isect","calc_t","vi","dt2l_v1","dt2l_v2","dt2l_v3","dt2l_v4","dt2l_v5","clip","closest_co_out","t_out","dt3l_v1","dt3l_v2","dt3l_v3","dt3l_v4","dt3l_v5","dist_to_line_sqr","px","py","pz","len2","dist_to_line","_cplw_vs4","_cplw_vs3","_cplw_vs2","wclip","znear","clip_line_w","_v1","_v2","zfar","doclip1","doclip","dozclip","_closest_point_on_line_cache","_closest_point_rets","_closest_tmps","_circ_from_line_tan_vs","_circ_from_line_tan_ret","circ_from_line_tan","_circ_from_line_tan2d_vs","_circ_from_line_tan2d_ret","circ_from_line_tan_2d","tanx1","tany1","div2","midx","midy","_gtc_e1","_gtc_e2","_gtc_e3","_gtc_p1","_gtc_p2","_gtc_v1","_gtc_v2","_gtc_p12","_gtc_p22","_get_tri_circ_ret","get_tri_circ","e1","e3","gen_circle","stfeps","verts","make_vert","make_edge","makeCircleMesh","gl","mesh","Mesh","verts1","verts2","make_face_complex","minmax_verts","__iter_v","__get_iter","__ival_v","unproject","ipers","iview","newvec","project","pers","view","_sh_minv","_sh_maxv","_sh_start","_sh_end","static_cent_gbw","get_boundary_winding","divideScalar","totw","round","PlaneOps","reset_axis","orig1","orig2","_isrp_ret","isect_ray_plane_rets","isect_ray_plane","planeorigin","planenormal","rayorigin","raynormal","po","pn","ro","rn","_old_isect_ray_plane","mesh_find_tangent","viewvec","offvec","projmat","selected","vset","eset","__iter_e","edges","__ival_e","other_vert","tanav","evec","co2","Mat4Stack","update_func","set_internal_matrix","identity","loadIdentity","tril_rets","lreport","trilinear_v3","boxverts","a1x","a1y","a1z","b1x","b1y","b1z","c1x","c1y","c1z","d1x","d1y","d1z","a2x","a2y","a2z","b2x","b2y","b2z","c2x","c2y","c2z","d2x","d2y","d2z","tril_co_rets","tril_co_tmps","tril_mat_1","tril_mat_2","wtable","pih_tmps","boxfaces_table","boxfaces_tmp","boxfacenormals_tmp","point_in_hex","boxfacecents","boxfacenormals","boxverts_tmp","trilinear_co","t3","du","dv","dw","bv","trilinear_co2","grad","totg","axis_error","angle_tri_v3_rets","angle_tri_v3_vs","tri_angles","th1","th2","th3","_clipdata","mime","_clipboards","clipboard","blob","Response","getClipboardData","desiredMimes","setClipboardData","ClipboardItem","Blob","colorSchemeType","docManualPath","useNumSliderTextboxes","numSliderArrowLimit","simpleNumSliders","menusCanPopupAbove","menu_close_time","paranoidEvents","screenborders","areaContextPushes","allBordersMovable","doOnce","areaConstraintSolver","datapaths","domEventAddRemove","debugUIUpdatePerf","screenAreaPosSizeAccesses","buttonEvents","addHelpPickers","useAreaTabSwitcher","autoSizeUpdate","showPathsInToolTips","enableThemeAutoUpdate","useNativeToolTips","loadConstants","ctrlconfig","ctrlconfig.setConfig","cfg","innerText","compatMap","BoxMargin","BoxBG","BoxRadius","background","defaultWidth","defaultHeight","DefaultWidth","DefaultHeight","BoxBorder","BoxLineWidth","BoxSubBG","BoxSub2BG","DefaultPanelBG","InnerPanelBG","Background","numslider_width","numslider_height","ColorSchemeTypes","LIGHT","DARK","parsepx","css","alpha_override","css2color_rets","basic_colors","purple","color2web","tostr","css2color","part","web2color","validate_pat","validateWebColor","validate_rgba","validate_rgb","validateCSSColor","rgba","theme","invertTheme","inverted","bg","CSSFont","iscolor","setColorSchemeType","_digest","_size","font","weight","variant","calcHashUpdate","util.isMobile","mobileTextSizeMultiplier","genCSS","genKey","exportTheme","theme1","addVarDecl","sortkeys","writekey","maxwid","_exportTheme","Task","taskcb","task","AnimManager","tasks","timeOut","dead","onend","AbstractCommand","cbs","end_cbs","animator","WaitCommand","ms","GoToCommand","startValue","SetCommand","Command","Animator","method","on_tick","commands","_done","wait","goto","timeMs","cmd","while","donecb","lexlen","PUTLParseError","print_tokens","print_debug","peek_i","getTraceBack","file","userdata","DataFlags","USE_FULL_UNDO","DataTypes","DYNAMIC_STRUCT","PROP","propCacheRings","getTempProp","getClass","DataPathError","getVecClass","proptype","isVecProperty","toolprop_abstract.Vec2PropertyIF","toolprop_abstract.Vec3PropertyIF","toolprop_abstract.Vec4PropertyIF","toolprop.Vec2Property","toolprop.Vec3Property","toolprop.Vec4Property","DataPath","noUndo","setProp","readOnly","read_only","customPropCallback","propGetter","customGetSet","_getValue","_setValue","getSet","dataref","datapath","customSet","customGet","simpleSlider","rollerSlider","editAsBaseUnit","uiNameGetter","ui_name_get","speed","relativeStep","fullSaveUndo","icons","icons2","description_map","uiNames","uinames","StructFlags","ListIface","getStruct","getKey","getActive","setActive","getIter","ToolOpIface","toolpath","is_modal","outputs","DataAPIClass","setImplementationClass","registerTool","ToolClasses","setContextClass","_ToolClasses","ToolFlags","UndoFlags","IS_UNDO_ROOT","UNDO_BARRIER","HAS_UNDO_DATA","InheritFlag","slots","defaultUndoHandlers","undoPre","undo","setDefaultUndoHandlers","ToolPropertyCache","pathmap","accessors","userSetMap","dstruct","_buildAccessors","tdef","_getFinalToolDef","partial","pathk","mapStruct","dpath","_getAccessor","tooldef","useDefault","getPropKey","ToolMacro","SavedToolDefaults","ToolOp","events.EventHandler","_overdraw","__memsize","undoflag","getSlots","lastp","slots2","dinputs","doutputs","hasDefault","getDefault","drawlines","getInputs","tool","_regWithNstructjs","toolop","canRun","onUndoDestroy","calcUndoMem","loadDefaults","force","toolprop","saveDefaultInputs","genToolString","modalEnd","redo","_was_redo","execPre","execPost","exec_pre","resetTempGeom","modal_ctx","dl","getOverdraw","makeTempLine","node","modalStart","modalRunning","toolCancel","was_cancelled","_on_cancel","outs","ins","_save_inputs","PropKey","_save_outputs","MacroLink","sourcetool_idx","srckey","srcprops","desttool_idx","dstkey","dstprops","source","sourceProps","destProps","sourcePropKey","destPropKey","MacroClasses","_MacroClasses","macroidgen","tools","curtool","has_modal","connects","connectLinks","_macro_class","_getTypeClass","ready","__tooldef","_macroTypeId","connect","srctool","srcoutput","dsttool","dstinput","connectCB","i1","_do_connections","on_modal_end","ToolStack","memLimit","enforceMemLimit","_undo_branch","limitMemory","maxmem","setRestrictedToolContext","toolctx","execOrRedo","compareInputs","Equals","rerun","tctx","toLocked","execCtx","modal_running","rewind","replay","onStep","_stack","_save","buildToolSysAPI","registerWithNStructjs","rootCtxStruct","datastruct","_testToolStackIO","_appstate","toolstack","ToolPaths","initToolPaths_run","buildParser","valid_datatypes","STRLIT","NUMBER","Parser","parseToolPath","check_tool_exists","initToolPaths","startstr","toolclass","testToolParser","ModelInterface","prefix","getToolDef","getToolPathHotkey","createTool","constructor_argument","pushReportContext","popReportContext","massSetProp","mass_set_path","resolveMassSetPaths","resolvePath","ignoreExistence","rootStruct","subkey","use_range","ival","getDescription","rdef","validPath","getPropName","DataPathSetOp","propType","_undo","dataPath","flagBit","useFlagBit","hadError","massSetPath","destType","value2","hashThis","__ctx","paths","parseutil.PUTLParseError","parseutil.tokdef","parseutil.lexer","pathParser","parseutil.parser","parserStack","tool_classes","tool_idgen","toolkey","ToolID","lt","lastmsg","lcount","reportstack","pushReportName","util.console","popReportName","DataList","getLength","DataStruct","members","inheritFlag","dynamicStruct","default_struct","existing_struct","getter","setter","color3","vec3","toolprop.PropSubTypes","color4","vec4","arrayList","structdef","color3List","vectorList","color4List","pstruct","toolprop.BoolProperty","toolprop.FloatProperty","textblock","toolprop.StringProperty","toolprop.ReportProperty","toolprop.IntProperty","curve1d","toolprop.Curve1DProperty","enum","toolprop.EnumProperty","funcs","flags","toolprop.ToolProperty","toolprop.FlagProperty","fromToolProp","_map_struct_idgen","_map_structs","_debug__map_structs","_dummypath","DummyIntProperty","CLS_API_KEY","CLS_API_KEY_CUSTOM","DataAPI","rootContextStruct","getStructs","setRoot","sdef","hasStruct","mergeStructs","inheritStruct","auto_create_parent","_addClass","mapStructCustom","auto_create","suffix","applyFilter","$","inpath","resolvePath_intern","newprop","datactx","lastobj2","lastkey","lastdpath","lastobj","p_key","dynstructobj","act","actkey","fakeprop","val1","bitfield","resolvePathOld2","splitchars","parent1","parent2","arg","retpath","_path","resolvePathold","_stripToolUIName","uiNameOut","getToolPathHotkey_intern","searchKeymap","sareas","getActiveArea","getKeyMaps","parseToolArgs","tpath","invoke","initSimpleController","dpt","getDataPathToolOp","setDataPathToolOp","rgb_to_hsv_rets","rgb_to_hsv","computedH","computedS","computedV","minRGB","maxRGB","hsv_to_rgb_rets","hsv_to_rgb","RgbF_Create","rgb_to_cmyk_rets","cmyk_to_rgb_rets","cmyk_to_rgb","rgb_to_cmyk","M","Y","var_K","K","DefaultTheme","AreaHeaderBG","BasePackFlag","BoxDepressed","BoxHighlight","DefaultText","LabelText","TitleText","oneAxisPadding","padding","disabled","pressed","checkbox","CheckSide","colorfield","circleSize","colorBoxHeight","fieldSize","hueHeight","colorpickerbutton","curvewidget","CanvasBG","CanvasHeight","CanvasWidth","dropbox","dropTextBG","depressed","iconcheck","drawCheck","listbox","ListActive","ListHighlight","menu","MenuBG","MenuBorder","MenuHighlight","MenuSeparator","border","MenuSpacing","MenuText","notification","ProgressBarBG","ProgressBar","numslider","numslider_simple","SlideHeight","TextBoxWidth","labelOnTop","numslider_textbox","TextBoxHeight","HeaderBorderRadius","HeaderRadius","TitleBackground","TitleBorder","richtext","screenborder","scrollbars","color2","contrast","sidebar","tabs","TabActive","TabBarRadius","TabHighlight","TabInactive","TabStrokeStyle1","TabStrokeStyle2","TabText","tooltip","ToolTipText","treeview","itemIndent","rowHeight","vecPopupButton","setIconMap","FOLDER","FILE","SMALL_PLUS","SMALL_MINUS","UNDO","REDO","HELP","UNCHECKED","CHECKED","LARGE_CHECK","CURSOR_ARROW","NOTE_EXCL","SCROLL_DOWN","SCROLL_UP","BACKSPACE","LEFT_ARROW","RIGHT_ARROW","UI_EXPAND","UI_COLLAPSE","BOLD","ITALIC","UNDERLINE","STRIKETHRU","TREE_EXPAND","TREE_COLLAPSE","ZOOM_OUT","ZOOM_IN","ENUM_CHECKED","ENUM_UNCHECKED","UIBase","_setUIBase","uibase","AspectKeys","_ui_base","TextBox","initAspectClass","blacklist","validProperty","descr","getOwnPropertyDescriptor","__aspect_methods","AfterAspect","clearAspectCallbacks","chain","chain2","root","_method","isDead","_method_bound","_checkbind","before","_setTextboxClass","ElementClasses","__cconst","vectormath.Vector4","Area","_setAreaClass","ErrorColors","WARNING","ERROR","OK","__theme","registered_has_happened","tagPrefix","EventCBSymbol","calcElemCBKey","setTagPrefix","getTagPrefix","class_idgen","setTheme","theme2","k3","_last_report","IsMobile","marginPaddingCSSKeys","_IconManager","tilesize","number_of_horizontal_tiles","drawsize","tilex","customIcons","onReady","util.TimeoutPromise","canvasDraw","getDPI","setCSS","fitsize","getCSS","ratio","blobUrl","CustomIcon","baseImage","images","regenIcons","doSheet","toBlob","URL","createObjectURL","iconsheets","IconManager","sizes","horizontal_tile_count","customIconIDMap","mobileSizeMultiplier","isReady","addCustomIcon","maxid","manager2","findSheet","findClosestSheet","sheets","minsheet","goal","getTileSize","getRealSize","iconmanager","_iconmanager","IconSheets","SMALL","LARGE","XLARGE","iconSheetFromPackFlag","PackFlags","CUSTOM_ICON_SHEET","CUSTOM_ICON_SHEET_START","SMALL_ICON","getIconManager","setIconManager","IconSheetsOverride","makeIconDiv","icontest","vectormath.Matrix4","dpistack","UIFlags","internalElementNames","externalElementNames","INHERIT_WIDTH","INHERIT_HEIGHT","VERTICAL","LARGE_ICON","FORCE_PROP_LABELS","PUT_FLAG_CHECKS_IN_COLUMNS","WRAP_CHECKBOXES","STRIP_HORIZ","STRIP_VERT","STRIP","SIMPLE_NUMSLIDERS","HIDE_CHECK_MARKS","NO_NUMSLIDER_TEXTBOX","NO_UPDATE","_mobile_theme_patterns","_idgen","styleScrollBars","selector","inv","_testSetScrollbars","CTX","mergeGlobalCSS","calcThemeKey","_themeUpdateKey","flagThemeUpdate","_flagThemeUpdate","setTimeoutQueue","haveTimeout","_mc","timeout_cb","internalSetTimeout","HTMLElement","_modalstack","_tool_tip_abort_delay","_tooltip_ref","_textBoxEvents","_themeOverride","_checkTheme","_last_theme_update_key","_client_disabled_set","_useNativeToolTips","_useNativeToolTips_set","_has_own_tooltips","_tooltip_timer","pathUndoGen","_lastPathUndoGen","_useDataPathUndo","_active_animations","_screenStyleTag","_screenStyleUpdateHash","shadow","attachShadow","__cbs","_appendChild","parentWidget","_wasAddedToNodeAtSomeTime","visibleToPick","_override_class","tagname","default_overrides","my_default_overrides","class_default_overrides","_last_description","_description_final","_modaldata","packflag","_internalDisabled","__disabledState","_disdata","_ctx","_description","textContent","_getFont","_init_done","do_touch","MouseEvent","havePickClipboard","_clipboardHotkeyInit","_parentWidget","useDataPathUndo","hasAttribute","getAttribute","title","__background","overrideDefault","__updateDisable","internalDisabled","_forEachChildWidget","_reportCtxName","element","customElements","internal","setUndo","hide","sethide","hidden","contents","unhide","findArea","_cb2","connectedCallback","noMarginsOrPadding","regenTabOrder","getScreen","needsTabRecalc","noMargins","noPadding","getTotalRect","doaabb","rs","parseNumber","units.parseValue","formatNumber","units.buildString","setBoxCSS","getSubDefault","genBoxCSS","boxcode","setBG","zoom","getZoom","transform","transform2","flushSetCSS","_init","replaceChild","newnode","swapWith","parentNode","getPos","tmp1","insertBefore","ptmp","traverse","type_or_set","is_set","_clipboard_over","_last_clipboard_keyevt","_clipboard_keystart","_clipboard_events","_clipboard_keydown","_clipboard_keyend","internal_mode","is_copy","is_paste","pickElement","checkTree","pasteForAllChildren","copyForAllChildren","clipboardCopy","clipboardPaste","tabIndex","_ondestroy","ondestroy","trigger_on_destroy","on_remove","removeChild","flushUpdate","checkInit","getWinWidth","getWinHeight","calcZ","marginy","nodeclass","excluded_classes","marginx","mouseEvent","isMouseMove","sx","sy","scrollX","scrollY","elementFromPoint","lastelem","reverse","getBoundingClientRect","clip2","math.aabb_intersect_2d","defaults","on_disabled","on_enabled","changed","pointerElem","_areaWrangler","bindFunc","handlers2","_flash_focus","focus","flash","rect_element","timems","autoFocus","csscolor","_flashtimer","_flashcolor","tick","PositionKey","_enterPopupSafe","_exitPopupSafe","on_resize","newsize","getPathValue","undoBreakPoint","setPathValueUndo","loadNumConstraints","onModifiedCallback","modified","getPathMeta","loadAttr","propkey","domkey","thiskey","oldmin","oldmax","oldint","oldedit","setPathValue","getPathDescription","_doOnce","_doOnce_reqs","zindex","positionKey","_ensureChildrenCtx","checkThemeUpdate","abortToolTips","delayMs","stop_timer","updateToolTipHandlers","start_timer","reset_timer","start_events","reset_events","stop_events","bind_handler","etype","lists","updateToolTips","_ToolTip","show","subclassChecksTheme","saveData","loadData","localOnly","overrideClass","overrideClassDefault","_doMobileDefault","hasClassDefault","backupkey","checkForMobile","getDefault_intern","getClassDefault","getStyleClass","parentStyle","overrideTheme","getStyle","animate","_extra_handlers","DOMMatrix","update_trans","background_get","background_set","dx_get","dx_set","dy_get","dy_set","pixkeys","makePixHandler","proxy","receiver","anim","abortAnimations","drawRoundBox2","drawRoundBox","no_clear","_background","quadraticCurveTo","closePath","_getFont_new","do_dpi","getFont","_ensureFont","get_measure_canvas","measureTextBlock","measureText","HTMLCanvasElement","drawText","fillText","PIDX","PSHADOW","PTOT","saveUIData","ni","is_shadow","path2","_ui_version","loadUIData","_saveUIData","_loadUIData","aspect._setUIBase","events.keymap","toolprop.PropTypes","ui_base.UIBase","ui_base.PackFlags","ui_base.IconSheets","ui_base.parsepx","ButtonEventBase","_auto_depress","_highlight","_pressed","bindEvents","depress","_redraw","onclick","_onpress","onpress","captured","blur","_focus","Button","_pressedTime","_pressedTimeout","_last_name","_last_disabled","__pressed","updateDisabled","OldButton","_last_but_update_key","_name","_namePad","_leftPad","_rightPad","_last_w","_last_h","_last_dpi","_lastw","_lasth","_last_bg","updateName","updateWidth","old_bindEvents","_repos_canvas","updateDefaultSize","_calcUpdateKey","updateDPI","tw","ui_base.measureText","_genLabel","updateBorders","lwid","w_add","h2","_getSubKey","draw_text","ui_base.drawRoundBox","lw","_draw_text","ui_base.drawText","TextBoxBase","modalKeyEvents","_width","_had_error","_change","oninput","isModal","_startModal","_modal","_endModal","realtime","keydown","on_keypress","_updatePathVal","updateDataPath","is_num","is_int","select","_prop_update","units.isNumber","ui_base.ErrorColors","checkForTextBox","draggable","nodes","ui_base._setTextboxClass","IconLabel","_icon","ui_base.iconmanager","ValueButtonBase","_value","Check","_checked","span","mup","mover","mleave","_label","prepend","_updatekey","csize","ui_base.Icons","ui_base.getIconManager","updatekey","IconButton","_customIcon","_draw_pressed","_icon_pressed","drawButtonBG","_extraIcon","extraDom","_last_iconsheet","domImage","_on_press","_on_depress","loadstyle","addpx","high","unhigh","_getsize","IconCheck","_drawCheck","updateDrawCheck","_updatePressed","noEmboss","Check1","saveFile","exts","loadFile","readAsArrayBuffer","_testLoadFile","_testSaveFile","createFile","getpx","debugmenu","Menu","parentMenu","_was_clicked","autoSearchMode","_ignoreFocusEvents","closeOnMouseUp","_submenu","ignoreFirstClick","itemindex","started","activeItem","menustyle","buildStyle","maxx","maxy","_isMenu","onselect","close","menuWrangler","popMenu","onclose","_popup","_select","dir","hasSearchBox","scrollIntoView","selectPrev","selectNext","start_fancy","startFancy","pushMenu","dom2","sbox","dokey","addItemExtra","hotkey","icon_div","ui_base.makeIconDiv","ui_base.getFont","hwid","twid","hotkey_span","addItem","li","_menu","onfocus","_getBorderStyle","pad1","boxShadow","sepcss","itemRadius","seperator","bar","calcSize","SEP","DropBox","lockTimer","_template","_searchMenuMode","_last_datapath","searchMenuMode","template","setDefault","wasError","_last_dbox_key","_build_menu_template","createMenu","_build_menu","_dropbox","valmap","enummap","uimap","desr","uk","callProp","_convertVal","rects","rheight","haveElectron","con","popup","ui_base.drawRoundBox2","setLabelOnly","MenuWrangler","menustack","lastPickElemTime","_closetimer","closereq","closetimer","spawnreq","endMenus","searchKeyDown","previousElementSibling","nextElementSibling","findMenu","menu2","closetime","startTimer","stopTimer","_menuWrangler","wrangerStarted","startMenuEventWrangling","setWranglerScreen","getWranglerScreen","doItem","id2","cbfunc","startMenu","safetyDelay","_startMenuEventWrangling","_ui","toolprop.PropFlags","Label","_lastText","_font","fontDefaultName","_updateFont","_enabled_font","_last_font","Container","dataPrefix","massSetPrefix","inherit_packflag","styletag","reversed","_prefixstack","_mass_prefixstack","children","changePathPrefix","newprefix","_joinPrefix","pushMassSetPrefix","pushDataPrefix","popDataPrefix","popMassSetPrefix","scrollTop","scrollLeft","scrollTo","useIcons","enabled_or_sheet","enabled","previous","wrap","rest","themeClass","margin1","margin2","horiz","RowFrame","bradius","bline","bstyle","bcolor","oneAxisMargin","axisPadding","otherPadding","setMargin","setPadding","setSize","saveVisibility","localStorage","storagePrefix","loadVisibility","opened","redrawCurves","listen","on_destroy","_prepend","_add","insert","NodeList","dynamicMenu","dbox","_container_inherit","toolPanel","path_or_cls","createCb","create_cb","defaultsPath","packflag_or_args","toolob","pathlabel","helppicker","hintPickerTool","colorbutton","_getMassPath","noteframe","vecpopup","textarea","checkenum","listenum","col1","col2","wrapChars","isrow","rebuild","last_hash","frame","checks","ignorecb","makecb","checkenum_panel","enumDef","getroot","do_redraw","simple","setHeaderToolTip","twocol","parentDepth","colorPicker","themeOverride","colorpicker","viewer","asDialogFooter","ColumnFrame","TwoColumnFrame","_colWidth","colWidth","Note","_noteid","showExclMark","append","setLabel","mark","ntext","clr","ProgBarNote","_percent","barWidth","bar2","percent","NoteFrame","ui.RowFrame","_h","noteframes","progbarNote","note","addNote","getNoteFrames","sendNote","ui_base.color2css","warning","_sendNote","RichEditor","textOnlyMode","controls","makeicon","execCommand","contentEditable","toggleStrikeThru","ta","getSelection","startNode","getRangeAt","anchorNode","anchorOffset","InputEvent","CustomEvent","formatStart","formatLine","formatEnd","rc","RichViewer","hideScrollBars","showScrollBars","textTransform","VectorPopupButton","VectorPanel","sliders","makeParam","_getNumParam","_setNumParam","__range","_range","vp","uslider","uniformValue","vertical","doupdate","meta","loadNumParam","do_rebuild","ToolTip","_start_time","_estimateSize","ui_base.measureTextBlock","bwidth","toolstack_getter","registerToolStackGetter","vectormath.Vector3","simple_toolsys.UndoFlags","simple_toolsys.ToolFlags","ToolBase","simple_toolsys.ToolOp","_finished","cancel","overdraw","modaldata","on_pointerend","AreaResizeTool","side","_side","_borders","RESIZE","getBorders","borders","otherVertex","snapScreenVerts","regenBorders","loadFromVerts","isBorderMovable","oldv1","oldv2","badcount","snapMode","moveBorder","outer","solveAreaConstraints","updateDebugBoxes","_fireResizeCB","SplitTool","canceled","splitArea","_internalRegenAll","RemoveAreaTool","collapseArea","AreaDragTool","dropArea","excludeAreas","cursorbox","boxes","TRANSLATE","_recalcAABB","getBoxRect","sa","doSplit","doSplitDrop","can_rip","floating","areasBorder","expand","removeArea","minmaxArea","editors","editormap","areaname","on_area_inactive","editor","editor2","owning_sarea","switcher","flagUpdate","replaceArea","loadFromPosSize","nsa","makeBoxes","hcolor","box","curbox","setColor","getActiveBox","on_drag","on_dragend","wid","AreaMoveAttachTool","start_mpos2","start_pos","ToolTipViewer","pick","Keymap","ele","tip","AreaFlags","HIDDEN","FLOATING","INDEPENDENT","NO_SWITCHER","NO_HEADER_CONTEXT_MENU","NO_COLLAPSE","SnapLimit","BORDER_ZINDEX_BASE","snap","snap_limit","snapi","ScreenVert","added_id","ScreenHalfEdge","ScreenBorder","_hash","halfedges","_innerstyle","_style","inner","call_menu","bindBorderMenu","movable","FrameManager_ops.AreaResizeTool","usePickElement","on_dblclick","splitTool","removeAreaTool","popupMenu","getOtherSarea","he","_verts","borderLock","valence","sv","a0x","a0y","cursor","alpha","innerbuf","sbuf","_ScreenArea","_contextWrangler","BorderMask","LEFT","BOTTOM","RIGHT","TOP","BorderSides","inactive","areaDragToolEnabled","_area_id","minSize","maxSize","areas","onover","_get_v_suffix","on_fileload","isActiveEditor","buildDataPath","idx1","idx2","areaName","oldsize","on_area_focus","on_area_blur","on_area_active","dontSetLastRef","getBarHeight","header","makeAreaSwitcher","makeAreasEnum","switch_editor","makeHeader","add_note_area","make_draggable","switcherRow","helpRow","callmenu","notef","eventdom","mpre","last_time","do_mousemove","mdown2","areaDragTool","_isDead","afterSTRUCT","ui_base.loadUIData","saved_uidata","_getSavedUIData","ui_base.saveUIData","ScreenArea","_flag","_sarea_id","_pos","wrapVector","bringToFront","snapToScreenSize","freeBorder","makeBorders","getScreenVert","getScreenBorder","existing","switchEditor","moved","checkAreaConstraint","owining_sarea","ui_base._setAreaClass","ThemeEditor","categoryMap","build","doFolder","catkey","help","row2","do_onchange","completeSetCSS","completeUpdate","getpath","cw","setRGBA","panel2","tbox","catkey2","categories","cat","category","strcmp","sliderDomAttributes","updateSliderFromDom","SliderDefaults","NumberSliderBase","skip","NumSlider","_last_label","ma","_last_overarrow","removeAttribute","updateConstraints","swapWithTextbox","onmousedown","overArrow","_on_click","dragStart","setMpos","rwidth","rx","szmargin","_getArrowSize","doRange","fire_onchange","setDataPath","checkConstraints","over","last_background","util.MovingAvg","startvalue","startx","sumdelta","fire","dvalue","dsign","on_pointerout","on_pointerover","restore_value","boxbg","arrowcolor","perc","higharrow","NumSliderSimpleBase","modal","_last_slider_key","_setFromMouse","_getButtonPos","_invertButtonX","makefunc","pointermove","pointerover","pointerout","pointerleave","pointerenter","pointerup","updateSize","setHighlight","isOverButton","sh","arc","setLineDash","boxw","SliderWithTextbox","_lock_textbox","_labelOnTop","_last_label_on_top","_numslider","_last_value","realTimeTextBox","apply_textbox","linkTextBox","in_onchange","updateLabelOnTop","NumSliderSimple","NumSliderWithTextBox","pagecache","domTransferAttrs","domEventAttrs","parseXML","xml","DOMParser","parseFromString","num_re","getIconFlag","attr","isnum","getPackFlag","getbool","myParseFloat","getfloat","customHandlers","Handler","codefuncs","templateVars","attrs","inheritDomAttrs","inheritDomAttrKeys","XMLDocument","nodeName","tree","Text","Comment","elem2","__elem","getAttributeNames","_container","_basic","pathux_ctx","rule","selectorText","styleMap","stylecode","setStyle","_getattr","codeattrs","eventType","sliderMode","doBox","_handlePathPrefix","ignorePathPrefix","cell","_prop","_codelem","$scope","templateScope","mpath","column","iconflags","noIcons","isDropBox","initPage","parentContainer","loadPage","parentContainer_or_args","loadSourceOnly","modifySourceCB","fetch","makeGenEnum","Curve1DWidget","_on_draw","_gen_type","_lastGen","_lastu","updateGenUI","forward_keys","PanelFrame","titleframe","_panel","_closed","headerLabel","__label","_updateClosed","bs","defval","header_radius","boxmargin","paddingleft","paddingright","margintop","marginbottom","marginleft","marginright","_setVisible","_onchange","isClosed","noUpdateClosedContents","_state","display","makeForward","UPW","VPW","sample_rets","inv_sample","colorClipboardCopy","getRGBA","colorClipboardPaste","fieldrand","huefields","getHueField","ImageData","rgb","putImageData","getFieldImage","fieldsize","hsva","width2","height2","fieldsize2","hue","valpow","x2sat","y2val","sat2x","val2y","image2","_update_temp","SimpleBox","HueField","setFromXY","_getPad","hsv","rselector","r_circle","SatValField","_getField","sat","force_update","globalAlpha","ColorField","ui.ColumnFrame","_recalcRGBA","_lastThemeStyle","satvalfield","huefield","setCMYK","setHSVA","getCMYK","_in_update","updateThemeOverride","ColorPicker","colorsPanel","cssText","_no_update_textbox","_setSliders","cmyk","makeCMYKSlider","_setDataPath","colorbox","updateColorBox","ColorPickerButton","_depress","customLabel","labelDom","noLabel","leave","widget","cellsize","totx","toty","verboseDataPath","_last_key","tab_idgen","FAKE_TAB_ID","TabDragEvent","TabItem","tbar","ontabclick","ontabdragstart","ontabdragmove","ontabdragend","helper","extraSize","abssize","abspos","sendEvent","forwardEvent","Event","ModalTabMove","droptarget","dragtab","dragstate","finished","dragcanvas","on_pointerleave","on_pointerenter","on_pointerstart","_on_move","_dragstate","DragEvent","dragevent","disty","dragok","dataTransfer","DataTransfer","dragimg","g2","drag_g","ti","prev","swapTabs","defaultPrevented","TabBar","movableTabs","tabFontScale","_last_style_key","_last_pos","_doelement","mx","my","_domouse","_fireOnSelect","_doclick","ht","acte","_startMove","updatePos","_ensureNoModal","_tool","edom","_makeOnSelectEvt","getTab","name_or_id","taborder","ntabs","ai","bi","addIconTab","addTab","updateCanvas","tsize","_layout","iconsize","have_icons","ry","makeTabWatcher","watcher","haveTabDom","_size_cb","noSwitch","activecolor","ypad","worig","removeTab","updateStyle","_last_p_key","TabContainer","_remakeStyle","_last_horiz","_last_bar_pos","_tab","enableDrag","flexDir","bgcolor","icontab","tab2","defineTabEvent","getTabCount","moveTab","updateBarPos","barpos","updateHoriz","TableRow","td","TableFrame","maketd","_tr","_bg","ListItem","setBackground","unhighlight","shadowRoot","is_active","ListBox","idmap","onkeydown","removeItem","scrollIntoViewIfNeeded","ProgressCircle","animreq","startTime","flagRedraw","onkey","oncancel","requestAnimationFrame","dth","endTimer","LastKey","getLastToolStruct","_last_tool","LastToolPanel","_tool_id","getToolStackHead","buildTool","fakecls","getTool","defineProp","apikey","Constraint","klst","glst","ks","threshold","funcDv","no_dvs","gs","Solver","constraints","gk","randCons","solveStep","cons","ci","ri","solveStepSimple","solve","printError","notifier","PackNodeVertex","_absPos","absPos","PackNode","vel","oldpos","copyGraph","getCenter","loadGraph","graphGetIslands","islands","visit1","island","graphPack","margin_or_args","updateCb","orignodes","decayi","nodemap","disableEdges","edge_c","restlen","loadBoxes","lasterr","besterr","disableArea","area_c","math.aabb_overlap_area","fakeVerts","fv","solveStep1","solver","rlen","rfac","boxPacker","setNotifier","ContextFlags","IS_VIEW","__idgen","ContextID","CachedDef","_ret_tmp","OverlayClasses","makeDerivedOverlay","ContextOverlay","appstate","last_tool","onRemove","have_new_file","def2","contextDefine","Context","parents","util.getClassParent","excludedKeys","LockedContext","noWarnings","progbar","_props","wrapget","ctx2","loadProperty","contextSystem","overlay","getOwningOverlay","saveProperty","setContext","next_key","_inside_map","_fix","fix","validateOverlays","stack2","hasOverlay","getOverlay","override","overrides","pushOverlay","_val_out","inside_map","ikey","__allKeys","ensureProperty","util.getAllKeys","popOverlay","removeOverlay","Test0","Test1","Test2","Test3","resolveDef","testInheritance","mimeMap","svg","txt","html","cpp","cc","hh","hpp","mjs","cjs","gif","textMimes","isMimeText","getExtension","getMime","PlatformAPI","href","FileDialogArgs","savedata_cb","multi","addToRecentList","filters","FilePath","platform","getPlatformAsync","mod","resolve","electron_api$1","web_api","getElectronVersion","getElectron","require","myRequire","getFilename","_menu_init","electron_menu_idgen","ipcRenderer","ElectronMenu","_ipcId","initElectronIpc","closePopup","wrapRemoteCallback","keybase","ipcInit","ElectronMenuItem","patchDropBox","emenu","buildElectronMenu","nativeTheme","remote","shouldUseDarkColors","themeSource","iconcache","makeIconKey","invertColors","getNativeIcon","icongen","nativeImage","GetRequiredICOImageSizes","writeFileSync","CTRL","ALT","SHIFT","COMMAND","buildElectronHotkey","buildItem","submenu","accelerator","registerAccelerator","initMenuBar","menuEditor","_roles","roles","edit","app","setApplicationMenu","dialog","eargs","defaultPath","_sanitizeFilters","properties","cancelled","filePaths","filters2","extensions","filedata_cb","filePath","filedata","fs","readFileSync","SVG_URL","CanvasOverdraw","shapes","otherChildren","zindex_base","createElementNS","Overdraw","drawTextBubbles","texts","colors","elems","pat","minsize","grads","startpos","box1","box2","circle","TreeItem","treeParent","treeChildren","treeView","treeDepth","_icon1","_icon2","_labelText","_open","_close","TreeView","strokes","updateOverdraw","_forAllChildren","_makeStrokes","ox","oy","rowh","getx","math.MinMax","od","startDrag","lastx","lasty","hx","hy","DragBox","DELETE","iconenum","_onend","ignore","_FrameManager","dockerdebug","areadocker","testSnapScreenVerts","unlisten","propsbar","AreaDocker","needsRebuild","ignoreChange","getArea","switcherData","tab_onchange","detach","addicon","on_addclick","loadTabData","floatArea","moveAttachTool","addTabMenu","getInternalName","area2","areaId","newarea","parentw","newparentw","newparent","ud","makePopupArea","area_class","addEscapeKeyHandler","ScreenArea.Area","ui_menu.startMenuEventWrangling","_events_started","FrameManager_ops.registerToolStackGetter","ui_base.styleScrollBars","update_stack","screen_idgen","get_screen_cb","_on_keydown","purgeUpdateStack","snapLimit","fullScreen","globalCSS","_do_updateSize","_resize_callbacks","needsBorderRegen","_popup_safe","testAllKeyMaps","_screen_id","_popups","screenverts","_vertmap","_edgemap","_idmap","_aabb","dragging","ScreenArea.ScreenArea","listening","listen_timer","schedule_resize","setPosSize","setPos","sheet2","rule2","desc","writable","entries","sval","insertRule","CSSStyleSheet","replaceSync","tag","newScreenArea","sarea2","_allAreas","owning_node","elem_or_x","closeOnMouseOut","popupDelay","draggablePopup","touchpick","mousepick","bad_time","last_pick_time","do_timeout","calcTabOrder","popupArea","trigger_destroy","checkCSSSize","getBoolAttribute","outerHeight","customWindowSize","_DEBUG","_calcSizeKey","_last_ckey1","ui_menu.setWranglerScreen","startEvents","ui_menu.getWranglerScreen","second_pass","__pass","__destroyed","_test_save","getHotKey","execKeyMap","handled","activeElement","__pos","drawUpdate","redraw_all","move","_update_gen","update_intern","updateScrollStyling","_last_scrollstyle_key","popups","cssTextHash","util.strhash","SCOPE_POP","AREA_CTX_POP","scopestack","areastack","regenScreenMesh","regenBorders_stage2","has_he","border2","walkBorderLine","he2","hasBorder","killScreenVertex","dels","killBorder","del","isBorderOuter","_get_debug_overlay","_debug_overlay","wadd","checkOnly","chg","sidea","sideb","dh","bad2","moveBorderWithoutVerts","halfedge","strict","moveBorderSimple","moveBorderUnused","FrameManager_mesh.SnapLimit","snapArgument","repeat","fitToSize","_set_key","offx","offy","olds","sides","sb","sarea1","_updateAll","_has_evts","onblur","FrameManager_ops.ToolTipViewer","FrameManager_ops.RemoveAreaTool","FrameManager_ops.AreaMoveAttachTool","FrameManager_ops.SplitTool","FrameManager_ops.AreaDragTool","cleanupBorders","mergeBlankAreas","blank","test_struct","screen2","parentElement","ScreenArea.setScreenClass","start_cbs","stop_cbs","keyboardDom","key_event_opts","getScreenFunc","stopEvents","setKeyboardDom","setKeyboardOpts","opts","_onEventsStart","_onEventsStop","sidebar_hash","SideBar","_last_resize_key","closeIcon","_openWidth","needsSetCSS","tabbar","Editor","strct","makeMenuBar","makeSideBar","iconSvg","loadDefaultIconSheet","iconSheet","FileHeader","version_major","version_minor","version_micro","schema","FileFull","objects","FileArgs","doScreen","resetOnLoad","useJSON","fileFlags","fromFileOp","EmptyStruct","saveFilesInJSON","ob","istruct","screenClass","MenuBarEditor","updateHeight","_height","electron_api","flagRebuild","menuRow","registerMenuBarEditor","SimpleAppNewOp","createNewFile","SimpleAppSaveOp","forceDialog","fileExt","startArgs","platform.platform","showSaveDialog","currentFileRef","SimpleAppOpenOp","showOpenDialog","readFile","DataModelClasses","DataModel","EmptyContextClass","GetContextClass","ctxClass","OverlayDerived","Overlay","ui_noteframe.message","ui_noteframe.error","ui_noteframe.warning","progressBar","ui_noteframe.progbarNote","defineAPI","makeAPI","StartArgs","singlePage","iconSizes","iconTileSize","iconsPerRow","registerSaveOpenOps","SimpleScreen","AppState","_ctxClass","fileMagic","fileVersion","_fileExt","_fileExtSet","defaultEditorClass","makeScreen","saveFileSync","loadFileSync","ensureMenuBar","args2","methodsCheck","SimpleContext","getWebFilters","controller.setNotifier","ui_noteframe","showOpenFilePicker","multiple","createWritable","showSaveFilePicker","showSaveDialog_old","fname","saveHandle","handle1","savedata","getFile","arrayBuffer"],"mappings":"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"}