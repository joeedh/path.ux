{"version":3,"file":"pathux.min.js","sources":["../scripts/path-controller/util/polyfill.js","../scripts/path-controller/util/nstructjs_es6.js","../scripts/path-controller/util/mobile-detect.cjs","../scripts/path-controller/extern/lz-string/lz-string.js","../scripts/path-controller/util/util.js","../scripts/path-controller/util/vectormath.js","../scripts/path-controller/toolsys/toolprop_abstract.js","../scripts/path-controller/units/units.js","../scripts/path-controller/toolsys/toolprop.js","../scripts/path-controller/config/config.js","../scripts/path-controller/util/simple_events.js","../scripts/core/ui_consts.js","../scripts/screen/area_wrangler.js","../scripts/path-controller/util/math.js","../scripts/config/const.js","../scripts/core/ui_theme.js","../scripts/path-controller/util/events.js","../scripts/path-controller/curve/curve1d_base.js","../scripts/path-controller/controller/controller_base.js","../scripts/path-controller/controller/context.js","../scripts/path-controller/toolsys/toolsys.js","../scripts/path-controller/curve/curve1d_bspline.js","../scripts/path-controller/curve/curve1d.js","../scripts/core/anim.js","../scripts/path-controller/util/parseutil.js","../scripts/path-controller/toolsys/toolpath.js","../scripts/path-controller/controller/controller_abstract.js","../scripts/path-controller/controller/controller_ops.js","../scripts/path-controller/curve/curve1d_basic.js","../scripts/path-controller/curve/ease.js","../scripts/path-controller/curve/curve1d_anim.js","../scripts/path-controller/curve/curve1d_toolprop.js","../scripts/path-controller/controller/controller.js","../scripts/path-controller/util/colorutils.js","../scripts/core/theme.js","../scripts/icon_enum.js","../scripts/core/aspect.js","../scripts/path-controller/dag/eventdag.js","../scripts/core/ui_base.js","../scripts/widgets/ui_button.js","../scripts/widgets/ui_textbox.js","../scripts/widgets/ui_widgets.js","../scripts/path-controller/util/html5_fileapi.js","../scripts/path-controller/util/solver.js","../scripts/path-controller/util/graphpack.js","../scripts/widgets/ui_menu.js","../scripts/core/ui.js","../scripts/widgets/ui_noteframe.js","../scripts/widgets/ui_richedit.js","../scripts/widgets/ui_widgets2.js","../scripts/screen/FrameManager_ops.js","../scripts/screen/FrameManager_mesh.js","../scripts/screen/ScreenArea.js","../scripts/widgets/theme_editor.js","../scripts/widgets/ui_numsliders.js","../scripts/xmlpage/xmlpage.js","../scripts/path-controller/curve/curve1d_utils.js","../scripts/widgets/ui_curvewidget.js","../scripts/widgets/ui_panel.js","../scripts/widgets/ui_colorpicker2.js","../scripts/widgets/ui_tabs.js","../scripts/widgets/ui_table.js","../scripts/widgets/ui_listbox.js","../scripts/widgets/ui_progress.js","../scripts/widgets/ui_lasttool.js","../scripts/platforms/platform_base.js","../scripts/platforms/platform.js","../scripts/platforms/electron/electron_api.js","../scripts/util/ScreenOverdraw.js","../scripts/widgets/ui_treeview.js","../scripts/widgets/dragbox.js","../scripts/screen/AreaDocker.js","../scripts/screen/FrameManager.js","../scripts/widgets/ui_dialog.js","../scripts/simple/editor.js","../scripts/simple/iconsheet.js","../scripts/simple/icons.js","../scripts/simple/file.js","../scripts/simple/menubar.js","../scripts/simple/app_ops.js","../scripts/simple/app.js","../scripts/simple/context_class.js","../scripts/platforms/web/web_api.js","../scripts/pathux.js"],"sourcesContent":["if (typeof window === \"undefined\" && typeof global !== \"undefined\") {\r\n  global.window = global;\r\n} else if (typeof window === \"undefined\" && typeof globalThis !== \"undefined\") {\r\n  globalThis.window = globalThis;\r\n} else if (typeof window === \"undefined\" && typeof self !== \"undefined\") {\r\n  self.window = self;\r\n}\r\n\r\n(function () {\r\n  let visitgen = 0;\r\n\r\n  window.destroyAllCSS = function () {\r\n    visitgen++;\r\n\r\n    let visit = (n) => {\r\n      if (n.__visit === visitgen) {\r\n        return;\r\n      }\r\n\r\n      n.__visit = visitgen;\r\n      if (n.tagName === \"STYLE\") {\r\n        n.textContents = '';\r\n      }\r\n\r\n      if (n.style) {\r\n        for (let k in n.style) {\r\n          try {\r\n            n.style[k] = \"\";\r\n          } catch (error) {\r\n\r\n          }\r\n        }\r\n      }\r\n\r\n      if (!n.childNodes) {\r\n        return;\r\n      }\r\n\r\n      for (let c of n.childNodes) {\r\n        visit(c);\r\n      }\r\n    }\r\n\r\n    visit(document.head);\r\n    visit(document.body);\r\n\r\n    for (let sheet of document.styleSheets) {\r\n      for (let i = 0; i < sheet.rules.length; i++) {\r\n        sheet.removeRule(sheet.rules[0]);\r\n      }\r\n    }\r\n  }\r\n})();\r\n\r\nwindow.eventDebugModule = (function () {\r\n  \"use strict\";\r\n\r\n  return {\r\n    start() {\r\n      window.debugEventLists = {}\r\n      window.debugEventList = [];\r\n\r\n      this._addEventListener = EventTarget.prototype.addEventListener;\r\n      this._removeEventListener = EventTarget.prototype.removeEventListener;\r\n      this._dispatchEvent = EventTarget.prototype.dispatchEvent;\r\n\r\n      EventTarget.prototype.addEventListener = this.onadd;\r\n      EventTarget.prototype.removeEventListener = this.onrem;\r\n      EventTarget.prototype.dispatchEvent = this.ondispatch;\r\n    },\r\n\r\n    add(type, data) {\r\n      if (!(type in debugEventLists)) {\r\n        debugEventLists[type] = [];\r\n      }\r\n\r\n      debugEventLists[type].push(data);\r\n    },\r\n\r\n    ondispatch() {\r\n      let a = arguments;\r\n\r\n      eventDebugModule.add(\"Dispatch\", {\r\n        event    : a[0],\r\n        thisvar  : a[4],\r\n        line     : a[5],\r\n        filename : a[6].replace(/\\\\/g, \"/\"),\r\n        filepath : location.origin + a[6].replace(/\\\\/g, \"/\") + \":\" + a[5],\r\n        ownerpath: a[7]\r\n      });\r\n\r\n      return eventDebugModule._dispatchEvent.apply(this, arguments);\r\n    },\r\n\r\n    onadd() {\r\n      let a = arguments;\r\n\r\n      eventDebugModule.add(\"Add\", {\r\n        type     : a[0],\r\n        cb       : a[1],\r\n        args     : a[2],\r\n        thisvar  : a[4],\r\n        line     : a[5],\r\n        filename : a[6].replace(/\\\\/g, \"/\"),\r\n        filepath : location.origin + a[6].replace(/\\\\/g, \"/\") + \":\" + a[5],\r\n        ownerpath: a[7]\r\n      });\r\n\r\n\r\n      return eventDebugModule._addEventListener.apply(this, arguments);\r\n    },\r\n\r\n    pruneConnected() {\r\n      for (let k in debugEventLists) {\r\n        let list = debugEventLists[k];\r\n\r\n        for (let i = 0; i < list.length; i++) {\r\n          let e = list[i];\r\n\r\n          if (!e.thisvar || !(e.thisvar instanceof Node)) {\r\n            continue;\r\n          }\r\n\r\n          if (!e.thisvar.isConnected) {\r\n            list[i] = list[list.length - 1];\r\n            list[list.length - 1] = undefined;\r\n            list.length--;\r\n            i--;\r\n          }\r\n        }\r\n      }\r\n    },\r\n\r\n\r\n    onrem() {\r\n      let a = arguments;\r\n\r\n      eventDebugModule.add(\"Rem\", {\r\n        type     : a[0],\r\n        cb       : a[1],\r\n        args     : a[2],\r\n        thisvar  : a[4],\r\n        line     : a[5],\r\n        filename : a[6].replace(/\\\\/g, \"/\"),\r\n        filepath : location.origin + a[6].replace(/\\\\/g, \"/\") + \":\" + a[5],\r\n        ownerpath: a[7]\r\n      });\r\n\r\n\r\n      return eventDebugModule._removeEventListener.apply(this, arguments);\r\n    }\r\n  }\r\n})();\r\n\r\nif (typeof _debug_event_listeners !== \"undefined\" && _debug_event_listeners) {\r\n  eventDebugModule.start();\r\n}\r\n\r\n/*\r\nif (navigator.userAgent.toLowerCase().search(\"chrome\") >= 0) {\r\n  console.warn(\"Patching Google Chrome scrollbar bug\");\r\n\r\n  let cb = (e) => {\r\n    if (e.touches.length == 1) {\r\n      let e2 = Object.create(e);\r\n      e2.pageX = e.touches[0].pageX;\r\n      e2.pageY = e.touches[0].pageY;\r\n      e2.x = e2.screenX = e2.pageX;\r\n      e2.y = e2.screenY = e2.pageY;\r\n      e2.button = 0;\r\n      e2.buttons = 1;\r\n\r\n      let type;\r\n      if (e.type === \"touchstart\")\r\n        type = \"mousedown\";\r\n      else \r\n        type = \"mousemove\";\r\n\r\n      console.log(e2);\r\n        //console.log(e.target);\r\n      e2 = new MouseEvent(type, e);\r\n      e.target.dispatchEvent(e2);\r\n    }\r\n  };\r\n\r\n  window.addEventListener(\"touchstart\", (e) => cb(e));\r\n  window.addEventListener(\"touchmove\", (e) => cb(e));\r\n\r\n  document.addEventListener(\"touchstart\", (e) => cb(e));\r\n  document.addEventListener(\"touchmove\", (e) => cb(e));\r\n}\r\n//*/\r\n\r\nif (window._disable_all_listeners) {\r\n  console.warn(\"Disabling all event listeners\");\r\n  EventTarget.prototype.addEventListener = () => {\r\n  };\r\n  EventSource.prototype.addEventListener = () => {\r\n  };\r\n}\r\n\r\nif (typeof visualViewport === \"undefined\") {\r\n  (function () {\r\n    class MyVisualViewport {\r\n      get width() {\r\n        return window.innerWidth;\r\n      }\r\n\r\n      get height() {\r\n        return window.innerHeight;\r\n      }\r\n\r\n      get offsetLeft() {\r\n        return 0;\r\n      }\r\n\r\n      get offsetTop() {\r\n        return 0;\r\n      }\r\n\r\n      get pageLeft() {\r\n        return 0;\r\n      }\r\n\r\n      get pageTop() {\r\n        return 0;\r\n      }\r\n\r\n      get scale() {\r\n        return 1.0;\r\n      }\r\n    }\r\n\r\n    window.visualViewport = new MyVisualViewport();\r\n  })();\r\n}\r\n\r\nif (Array.prototype.set === undefined) {\r\n  /**\r\n   * A version of TypedArray.prototype.set for Array\r\n   * Unliked typed array version the array will be\r\n   * resized if the source array range extends past\r\n   * the array length.\r\n   *\r\n   * array.set(array) array.set(array, src_offset) array.set(array, src_offset, count)\r\n   * array.set(array, src_offset, dest_offset, count\r\n   * @param array\r\n   */\r\n  Array.prototype.set = function set(array) {\r\n    if (arguments.length === 0) {\r\n      //WASM somehow manages to call this\r\n      return;\r\n    }\r\n\r\n    let src, dst, count;\r\n\r\n    if (arguments.length === 0) {\r\n      src = 0;\r\n      dst = 0;\r\n      count = array.length;\r\n    } else if (arguments.length === 1) {\r\n      count = array.length;\r\n      src = arguments[1];\r\n      dst = 0;\r\n    } else if (arguments.length === 2) {\r\n      src = arguments[1];\r\n      count = arguments[2];\r\n    } else if (arguments.length === 3) {\r\n      src = arguments[1];\r\n      dst = arguments[2];\r\n      count = arguments[3];\r\n    }\r\n\r\n    src = src === undefined ? 0 : src;\r\n    dst = dst === undefined ? 0 : dst;\r\n    count = count === undefined ? array.length : count;\r\n\r\n    if (count < 0) {\r\n      throw new RangeError(\"Count must be >= zero\");\r\n    }\r\n\r\n    let len = Math.min(src + count, array.length) - src;\r\n\r\n    if (dst + len > this.length) {\r\n      this.length = dst + len;\r\n    }\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      this[dst + i] = array[src + i];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  Object.defineProperty(Array.prototype, \"set\", {\r\n    enumerable  : false,\r\n    configurable: true,\r\n  });\r\n\r\n  if (Float64Array.prototype.set === undefined) {\r\n    Float64Array.prototype.set = Array.prototype.set;\r\n    Float32Array.prototype.set = Array.prototype.set;\r\n    Uint8Array.prototype.set = Array.prototype.set;\r\n    Uint8ClampedArray.prototype.set = Array.prototype.set;\r\n    Int32Array.prototype.set = Array.prototype.set;\r\n    Int16Array.prototype.set = Array.prototype.set;\r\n    Int8Array.prototype.set = Array.prototype.set;\r\n  }\r\n}\r\n\r\nif (Array.prototype.reject === undefined) {\r\n  Array.prototype.reject = function reject(func) {\r\n    return this.filter((item) => !func(item));\r\n  }\r\n\r\n  Object.defineProperty(Array.prototype, \"reject\", {\r\n    enumerable  : false,\r\n    configurable: true,\r\n  });\r\n}\r\n\r\nif (window.Symbol == undefined) { //eek!\r\n  window.Symbol = {\r\n    iterator: \"$__iterator__$\",\r\n    keystr  : \"$__keystr__$\"\r\n  }\r\n} else if (Symbol.keystr === undefined) {\r\n  Symbol.keystr = Symbol(\"keystr\");\r\n}\r\n\r\n/* use util.list\r\nwindow.list = function list(iter) {\r\n  var ret = [];\r\n\r\n  if (typeof iter == \"string\") {\r\n    iter = new String();\r\n  }\r\n\r\n  if (Symbol.iterator in iter) {\r\n    for (var item of iter) {\r\n      ret.push(item);\r\n    }\r\n  } else {\r\n    iter.forEach(function (item) {\r\n      ret.push(item);\r\n    }, this);\r\n  }\r\n\r\n  return ret;\r\n};*/\r\n\r\n//XXX surely browser vendors have fixed this by now. . .\r\n/*Override array iterator to not allocate too much*/\r\n\r\n/*\r\nfunction ArrayIter(array) {\r\n  this.array = array;\r\n  this.i = 0;\r\n  this.ret = {done : false, value : undefined};\r\n}\r\n\r\nArrayIter.prototype[Symbol.iterator] = function() {\r\n  return this;\r\n}\r\n\r\nArrayIter.prototype.next = function() {\r\n  var ret = this.ret;\r\n  \r\n  if (this.i >= this.array.length) {\r\n    ret.done = true;\r\n    ret.value = undefined;\r\n    return ret;\r\n  }\r\n  \r\n  ret.value = this.array[this.i++];\r\n  return ret;\r\n};//*/\r\n\r\n\r\n//Array.prototype[Symbol.iterator] = function() {\r\n//  return new ArrayIter(this);\r\n//}\r\n\r\nif (Math.fract === undefined) {\r\n  Math.fract = function fract(f) {\r\n    return f - Math.floor(f);\r\n  };\r\n}\r\n\r\nif (Math.tent === undefined) {\r\n  Math.tent = function tent(f) {\r\n    return 1.0 - Math.abs(Math.fract(f) - 0.5)*2.0;\r\n  };\r\n}\r\n\r\nif (Math.sign === undefined) {\r\n  Math.sign = function sign(f) {\r\n    return (f > 0.0)*2.0 - 1.0;\r\n  };\r\n}\r\n\r\nif (Array.prototype.pop_i === undefined) {\r\n  Array.prototype.pop_i = function (idx) {\r\n    if (idx < 0 || idx >= this.length) {\r\n      throw new Error(\"Index out of range\");\r\n    }\r\n\r\n    while (idx < this.length) {\r\n      this[idx] = this[idx + 1];\r\n      idx++;\r\n    }\r\n\r\n    this.length -= 1;\r\n  }\r\n\r\n  Object.defineProperty(Array.prototype, \"pop_i\", {\r\n    enumerable  : false,\r\n    configurable: true,\r\n  });\r\n}\r\n\r\nif (Array.prototype.remove === undefined) {\r\n  Array.prototype.remove = function (item, suppress_error) {\r\n    var i = this.indexOf(item);\r\n\r\n    if (i < 0) {\r\n      if (suppress_error)\r\n        console.trace(\"Warning: item not in array\", item);\r\n      else\r\n        throw new Error(\"Error: item not in array \" + item);\r\n\r\n      return;\r\n    }\r\n\r\n    this.pop_i(i);\r\n  }\r\n\r\n  Object.defineProperty(Array.prototype, \"remove\", {\r\n    enumerable  : false,\r\n    configurable: true,\r\n  });\r\n}\r\n\r\nif (String.prototype.contains === undefined) {\r\n  String.prototype.contains = function (substr) {\r\n    return String.search(substr) >= 0;\r\n  }\r\n}\r\n\r\nString.prototype[Symbol.keystr] = function () {\r\n  return this;\r\n};\r\n\r\nNumber.prototype[Symbol.keystr] = Boolean.prototype[Symbol.keystr] = function () {\r\n  return \"\" + this;\r\n};\r\n\r\nArray.prototype[Symbol.keystr] = function () {\r\n  let key = \"\";\r\n  for (let item of this) {\r\n    key += item[Symbol.keystr]() + \":\";\r\n  }\r\n\r\n  return key;\r\n};\r\n","let colormap = {\r\n  \"black\"   : 30,\r\n  \"red\"     : 31,\r\n  \"green\"   : 32,\r\n  \"yellow\"  : 33,\r\n  \"blue\"    : 34,\r\n  \"magenta\" : 35,\r\n  \"cyan\"    : 36,\r\n  \"white\"   : 37,\r\n  \"reset\"   : 0,\r\n  \"grey\"    : 2,\r\n  \"orange\"  : 202,\r\n  \"pink\"    : 198,\r\n  \"brown\"   : 314,\r\n  \"lightred\": 91,\r\n  \"peach\"   : 210\r\n};\r\n\r\nfunction tab(n, chr = ' ') {\r\n  let t = '';\r\n\r\n  for (let i = 0; i < n; i++) {\r\n    t += chr;\r\n  }\r\n\r\n  return t;\r\n}\r\n\r\nlet termColorMap = {};\r\nfor (let k in colormap) {\r\n  termColorMap[k] = colormap[k];\r\n  termColorMap[colormap[k]] = k;\r\n}\r\n\r\nfunction termColor(s, c) {\r\n  if (typeof s === \"symbol\") {\r\n    s = s.toString();\r\n  } else {\r\n    s = \"\" + s;\r\n  }\r\n\r\n  if (c in colormap)\r\n    c = colormap[c];\r\n\r\n  if (c > 107) {\r\n    let s2 = '\\u001b[38;5;' + c + \"m\";\r\n    return s2 + s + '\\u001b[0m'\r\n  }\r\n\r\n  return '\\u001b[' + c + 'm' + s + '\\u001b[0m'\r\n};\r\n\r\nfunction termPrint() {\r\n  //let console = window.console;\r\n\r\n  let s = '';\r\n  for (let i = 0; i < arguments.length; i++) {\r\n    if (i > 0) {\r\n      s += ' ';\r\n    }\r\n    s += arguments[i];\r\n  }\r\n\r\n  let re1a = /\\u001b\\[[1-9][0-9]?m/;\r\n  let re1b = /\\u001b\\[[1-9][0-9];[0-9][0-9]?;[0-9]+m/;\r\n  let re2 = /\\u001b\\[0m/;\r\n\r\n  let endtag = '\\u001b[0m';\r\n\r\n  function tok(s, type) {\r\n    return {\r\n      type : type,\r\n      value: s\r\n    }\r\n  }\r\n\r\n  let tokdef = [\r\n    [re1a, \"start\"],\r\n    [re1b, \"start\"],\r\n    [re2, \"end\"]\r\n  ];\r\n\r\n  let s2 = s;\r\n\r\n  let i = 0;\r\n  let tokens = [];\r\n\r\n  while (s2.length > 0) {\r\n    let ok = false;\r\n\r\n    let mintk = undefined, mini = undefined;\r\n    let minslice = undefined, mintype = undefined;\r\n\r\n    for (let tk of tokdef) {\r\n      let i = s2.search(tk[0]);\r\n\r\n      if (i >= 0 && (mini === undefined || i < mini)) {\r\n        minslice = s2.slice(i, s2.length).match(tk[0])[0];\r\n        mini = i;\r\n        mintype = tk[1];\r\n        mintk = tk;\r\n        ok = true;\r\n      }\r\n    }\r\n\r\n    if (!ok) {\r\n      break;\r\n    }\r\n\r\n    if (mini > 0) {\r\n      let chunk = s2.slice(0, mini);\r\n      tokens.push(tok(chunk, \"chunk\"));\r\n    }\r\n\r\n    s2 = s2.slice(mini+minslice.length, s2.length);\r\n    let t = tok(minslice, mintype);\r\n\r\n    tokens.push(t);\r\n  }\r\n\r\n  if (s2.length > 0) {\r\n    tokens.push(tok(s2, \"chunk\"));\r\n  }\r\n\r\n  let stack = [];\r\n  let cur;\r\n\r\n  let out = '';\r\n\r\n  for (let t of tokens) {\r\n    if (t.type === \"chunk\") {\r\n      out += t.value;\r\n    } else if (t.type === \"start\") {\r\n      stack.push(cur);\r\n      cur = t.value;\r\n\r\n      out += t.value;\r\n    } else if (t.type === \"end\") {\r\n      cur = stack.pop();\r\n      if (cur) {\r\n        out += cur;\r\n      } else {\r\n        out += endtag;\r\n      }\r\n    }\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\nfunction list(iter) {\r\n  let ret = [];\r\n\r\n  for (let item of iter) {\r\n    ret.push(item);\r\n  }\r\n\r\n  return ret;\r\n}\n\nvar util = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  tab: tab,\n  termColorMap: termColorMap,\n  termColor: termColor,\n  termPrint: termPrint,\n  list: list\n});\n\n\"use strict\";\r\n\r\nfunction print_lines(ld, lineno, col, printColors, token) {\r\n  let buf = '';\r\n  let lines = ld.split(\"\\n\");\r\n  let istart = Math.max(lineno - 5, 0);\r\n  let iend = Math.min(lineno + 3, lines.length);\r\n\r\n  let color = printColors ? (c) => c : termColor;\r\n\r\n  for (let i = istart; i < iend; i++) {\r\n    let l = \"\" + (i + 1);\r\n    while (l.length < 3) {\r\n      l = \" \" + l;\r\n    }\r\n\r\n    l += `: ${lines[i]}\\n`;\r\n\r\n    if (i === lineno && token && token.value.length === 1) {\r\n      l = l.slice(0, col + 5) + color(l[col + 5], \"yellow\") + l.slice(col + 6, l.length);\r\n    }\r\n    buf += l;\r\n    if (i === lineno) {\r\n      let colstr = '     ';\r\n      for (let i = 0; i < col; i++) {\r\n        colstr += ' ';\r\n      }\r\n      colstr += color(\"^\", \"red\");\r\n\r\n      buf += colstr + \"\\n\";\r\n    }\r\n  }\r\n\r\n  buf = \"------------------\\n\" + buf + \"\\n==================\\n\";\r\n  return buf;\r\n}\r\n\r\nclass token {\r\n  constructor(type, val, lexpos, lineno, lexer, parser, col) {\r\n    this.type = type;\r\n    this.value = val;\r\n    this.lexpos = lexpos;\r\n    this.lineno = lineno;\r\n    this.col = col;\r\n    this.lexer = lexer;\r\n    this.parser = parser;\r\n  }\r\n\r\n  toString() {\r\n    if (this.value !== undefined)\r\n      return \"token(type=\" + this.type + \", value='\" + this.value + \"')\";\r\n    else\r\n      return \"token(type=\" + this.type + \")\";\r\n  }\r\n}\r\n\r\nclass tokdef {\r\n  constructor(name, regexpr, func, example) {\r\n    this.name = name;\r\n    this.re = regexpr;\r\n    this.func = func;\r\n    this.example = example;\r\n\r\n    if (example === undefined && regexpr) {\r\n      let s = \"\" + regexpr;\r\n      if (s.startsWith(\"/\") && s.endsWith(\"/\")) {\r\n        s = s.slice(1, s.length - 1);\r\n      }\r\n\r\n      if (s.startsWith(\"\\\\\")) {\r\n        s = s.slice(1, s.length);\r\n      }\r\n      s = s.trim();\r\n\r\n      if (s.length === 1) {\r\n        this.example = s;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nclass PUTIL_ParseError extends Error {\r\n  constructor(msg) {\r\n    super();\r\n  }\r\n}\r\n\r\nclass lexer {\r\n  constructor(tokdef, errfunc) {\r\n    this.tokdef = tokdef;\r\n    this.tokens = new Array();\r\n    this.lexpos = 0;\r\n    this.lexdata = \"\";\r\n    this.colmap = undefined;\r\n    this.lineno = 0;\r\n    this.printTokens = false;\r\n    this.linestart = 0;\r\n    this.errfunc = errfunc;\r\n    this.linemap = undefined;\r\n    this.tokints = {};\r\n    for (let i = 0; i < tokdef.length; i++) {\r\n      this.tokints[tokdef[i].name] = i;\r\n    }\r\n    this.statestack = [[\"__main__\", 0]];\r\n    this.states = {\"__main__\": [tokdef, errfunc]};\r\n    this.statedata = 0;\r\n\r\n    this.logger = function () {\r\n      console.log(...arguments);\r\n    };\r\n  }\r\n\r\n  add_state(name, tokdef, errfunc) {\r\n    if (errfunc === undefined) {\r\n      errfunc = function (lexer) {\r\n        return true;\r\n      };\r\n    }\r\n    this.states[name] = [tokdef, errfunc];\r\n  }\r\n\r\n  tok_int(name) {\r\n  }\r\n\r\n  push_state(state, statedata) {\r\n    this.statestack.push([state, statedata]);\r\n    state = this.states[state];\r\n    this.statedata = statedata;\r\n    this.tokdef = state[0];\r\n    this.errfunc = state[1];\r\n  }\r\n\r\n  pop_state() {\r\n    let item = this.statestack[this.statestack.length - 1];\r\n    let state = this.states[item[0]];\r\n    this.tokdef = state[0];\r\n    this.errfunc = state[1];\r\n    this.statedata = item[1];\r\n  }\r\n\r\n  input(str) {\r\n    let linemap = this.linemap = new Array(str.length);\r\n    let lineno = 0;\r\n    let col = 0;\r\n    let colmap = this.colmap = new Array(str.length);\r\n\r\n    for (let i = 0; i < str.length; i++, col++) {\r\n      let c = str[i];\r\n\r\n      linemap[i] = lineno;\r\n      colmap[i] = col;\r\n\r\n      if (c === \"\\n\") {\r\n        lineno++;\r\n        col = 0;\r\n      }\r\n    }\r\n\r\n    while (this.statestack.length > 1) {\r\n      this.pop_state();\r\n    }\r\n    this.lexdata = str;\r\n    this.lexpos = 0;\r\n    this.lineno = 0;\r\n    this.tokens = new Array();\r\n    this.peeked_tokens = [];\r\n  }\r\n\r\n  error() {\r\n    if (this.errfunc !== undefined && !this.errfunc(this))\r\n      return;\r\n\r\n    let safepos = Math.min(this.lexpos, this.lexdata.length - 1);\r\n    let line = this.linemap[safepos];\r\n    let col = this.colmap[safepos];\r\n\r\n    let s = print_lines(this.lexdata, line, col, true);\r\n\r\n    this.logger(\"  \" + s);\r\n    this.logger(\"Syntax error near line \" + (this.lineno + 1));\r\n\r\n    let next = Math.min(this.lexpos + 8, this.lexdata.length);\r\n\r\n    throw new PUTIL_ParseError(\"Parse error\");\r\n  }\r\n\r\n  peek() {\r\n    let tok = this.next(true);\r\n    if (tok === undefined)\r\n      return undefined;\r\n    this.peeked_tokens.push(tok);\r\n    return tok;\r\n  }\r\n\r\n  peeknext() {\r\n    if (this.peeked_tokens.length > 0) {\r\n      return this.peeked_tokens[0];\r\n    }\r\n\r\n    return this.peek();\r\n  }\r\n\r\n  at_end() {\r\n    return this.lexpos >= this.lexdata.length && this.peeked_tokens.length === 0;\r\n  }\r\n\r\n  //ignore_peek is optional, false\r\n  next(ignore_peek) {\r\n    if (!ignore_peek && this.peeked_tokens.length > 0) {\r\n      let tok = this.peeked_tokens[0];\r\n      this.peeked_tokens.shift();\r\n\r\n      if (!ignore_peek && this.printTokens) {\r\n        this.logger(\"\" + tok);\r\n      }\r\n\r\n      return tok;\r\n    }\r\n\r\n    if (this.lexpos >= this.lexdata.length)\r\n      return undefined;\r\n\r\n    let ts = this.tokdef;\r\n    let tlen = ts.length;\r\n    let lexdata = this.lexdata.slice(this.lexpos, this.lexdata.length);\r\n    let results = [];\r\n\r\n    for (var i = 0; i < tlen; i++) {\r\n      let t = ts[i];\r\n      if (t.re === undefined)\r\n        continue;\r\n      let res = t.re.exec(lexdata);\r\n      if (res !== null && res !== undefined && res.index === 0) {\r\n        results.push([t, res]);\r\n      }\r\n    }\r\n\r\n    let max_res = 0;\r\n    let theres = undefined;\r\n    for (var i = 0; i < results.length; i++) {\r\n      let res = results[i];\r\n      if (res[1][0].length > max_res) {\r\n        theres = res;\r\n        max_res = res[1][0].length;\r\n      }\r\n    }\r\n\r\n    if (theres === undefined) {\r\n      this.error();\r\n      return;\r\n    }\r\n\r\n    let def = theres[0];\r\n    let col = this.colmap[Math.min(this.lexpos, this.lexdata.length - 1)];\r\n\r\n    if (this.lexpos < this.lexdata.length) {\r\n      this.lineno = this.linemap[this.lexpos];\r\n    }\r\n\r\n    let tok = new token(def.name, theres[1][0], this.lexpos, this.lineno, this, undefined, col);\r\n    this.lexpos += tok.value.length;\r\n\r\n    if (def.func) {\r\n      tok = def.func(tok);\r\n      if (tok === undefined) {\r\n        return this.next();\r\n      }\r\n    }\r\n\r\n    if (!ignore_peek && this.printTokens) {\r\n      this.logger(\"\" + tok);\r\n    }\r\n    return tok;\r\n  }\r\n}\r\n\r\nclass parser {\r\n  constructor(lexer, errfunc) {\r\n    this.lexer = lexer;\r\n    this.errfunc = errfunc;\r\n    this.start = undefined;\r\n\r\n    this.logger = function () {\r\n      console.log(...arguments);\r\n    };\r\n  }\r\n\r\n  parse(data, err_on_unconsumed) {\r\n    if (err_on_unconsumed === undefined)\r\n      err_on_unconsumed = true;\r\n\r\n    if (data !== undefined)\r\n      this.lexer.input(data);\r\n\r\n    let ret = this.start(this);\r\n\r\n    if (err_on_unconsumed && !this.lexer.at_end() && this.lexer.next() !== undefined) {\r\n      this.error(undefined, \"parser did not consume entire input\");\r\n    }\r\n    return ret;\r\n  }\r\n\r\n  input(data) {\r\n    this.lexer.input(data);\r\n  }\r\n\r\n  error(token, msg) {\r\n    let estr;\r\n\r\n    if (msg === undefined)\r\n      msg = \"\";\r\n    if (token === undefined)\r\n      estr = \"Parse error at end of input: \" + msg;\r\n    else\r\n      estr = `Parse error at line ${token.lineno + 1}:${token.col + 1}: ${msg}`;\r\n\r\n    let buf = \"\";\r\n    let ld = this.lexer.lexdata;\r\n    let lineno = token ? token.lineno : this.lexer.linemap[this.lexer.linemap.length - 1];\r\n    let col = token ? token.col : 0;\r\n\r\n    ld = ld.replace(/\\r/g, '');\r\n\r\n    this.logger(print_lines(ld, lineno, col, true, token));\r\n    this.logger(estr);\r\n\r\n    if (this.errfunc && !this.errfunc(token)) {\r\n      return;\r\n    }\r\n    throw new PUTIL_ParseError(estr);\r\n  }\r\n\r\n  peek() {\r\n    let tok = this.lexer.peek();\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n    return tok;\r\n  }\r\n\r\n  peeknext() {\r\n    let tok = this.lexer.peeknext();\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n    return tok;\r\n  }\r\n\r\n  next() {\r\n    let tok = this.lexer.next();\r\n\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n    return tok;\r\n  }\r\n\r\n  optional(type) {\r\n    let tok = this.peeknext();\r\n    if (tok === undefined)\r\n      return false;\r\n    if (tok.type === type) {\r\n      this.next();\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  at_end() {\r\n    return this.lexer.at_end();\r\n  }\r\n\r\n  expect(type, msg) {\r\n    let tok = this.next();\r\n\r\n    if (msg === undefined) {\r\n      msg = type;\r\n\r\n      for (let tk of this.lexer.tokdef) {\r\n        if (tk.name === type && tk.example) {\r\n          msg = tk.example;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (tok === undefined || tok.type !== type) {\r\n      this.error(tok, \"Expected \" + msg);\r\n    }\r\n    return tok.value;\r\n  }\r\n}\r\n\r\nfunction test_parser() {\r\n  let basic_types = new Set([\"int\", \"float\", \"double\", \"vec2\", \"vec3\", \"vec4\", \"mat4\", \"string\"]);\r\n  let reserved_tokens = new Set([\"int\", \"float\", \"double\", \"vec2\", \"vec3\", \"vec4\", \"mat4\", \"string\", \"static_string\",\r\n                                 \"array\"]);\r\n\r\n  function tk(name, re, func) {\r\n    return new tokdef(name, re, func);\r\n  }\r\n\r\n  let tokens = [tk(\"ID\", /[a-zA-Z]+[a-zA-Z0-9_]*/, function (t) {\r\n    if (reserved_tokens.has(t.value)) {\r\n      t.type = t.value.toUpperCase();\r\n    }\r\n    return t;\r\n  }), tk(\"OPEN\", /\\{/), tk(\"CLOSE\", /}/), tk(\"COLON\", /:/), tk(\"JSCRIPT\", /\\|/, function (t) {\r\n    let js = \"\";\r\n    let lexer = t.lexer;\r\n    while (lexer.lexpos < lexer.lexdata.length) {\r\n      let c = lexer.lexdata[lexer.lexpos];\r\n      if (c === \"\\n\")\r\n        break;\r\n      js += c;\r\n      lexer.lexpos++;\r\n    }\r\n    if (js.endsWith(\";\")) {\r\n      js = js.slice(0, js.length - 1);\r\n      lexer.lexpos--;\r\n    }\r\n    t.value = js;\r\n    return t;\r\n  }), tk(\"LPARAM\", /\\(/), tk(\"RPARAM\", /\\)/), tk(\"COMMA\", /,/), tk(\"NUM\", /[0-9]/), tk(\"SEMI\", /;/),\r\n                tk(\"NEWLINE\", /\\n/, function (t) {\r\n                  t.lexer.lineno += 1;\r\n                }), tk(\"SPACE\", / |\\t/, function (t) {\r\n    })];\r\n\r\n  for (let rt of reserved_tokens) {\r\n    tokens.push(tk(rt.toUpperCase()));\r\n  }\r\n\r\n  let a = `\r\n  Loop {\r\n    eid : int;\r\n    flag : int;\r\n    index : int;\r\n    type : int;\r\n\r\n    co : vec3;\r\n    no : vec3;\r\n    loop : int | eid(loop);\r\n    edges : array(e, int) | e.eid;\r\n\r\n    loops :, array(Loop);\r\n  }\r\n  `;\r\n\r\n\r\n  function errfunc(lexer) {\r\n    return true;\r\n  }\r\n\r\n  let lex = new lexer(tokens, errfunc);\r\n  console.log(\"Testing lexical scanner...\");\r\n  lex.input(a);\r\n  let token;\r\n  while (token = lex.next()) {\r\n    console.log(token.toString());\r\n  }\r\n  let parse = new parser(lex);\r\n  parse.input(a);\r\n\r\n  function p_Array(p) {\r\n    p.expect(\"ARRAY\");\r\n    p.expect(\"LPARAM\");\r\n    let arraytype = p_Type(p);\r\n    let itername = \"\";\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = arraytype;\r\n      arraytype = p_Type(p);\r\n    }\r\n    p.expect(\"RPARAM\");\r\n    return {type: \"array\", data: {type: arraytype, iname: itername}}\r\n  }\r\n\r\n  function p_Type(p) {\r\n    let tok = p.peek();\r\n    if (tok.type === \"ID\") {\r\n      p.next();\r\n      return {type: \"struct\", data: \"\\\"\" + tok.value + \"\\\"\"}\r\n    } else if (basic_types.has(tok.type.toLowerCase())) {\r\n      p.next();\r\n      return {type: tok.type.toLowerCase()}\r\n    } else if (tok.type === \"ARRAY\") {\r\n      return p_Array(p);\r\n    } else {\r\n      p.error(tok, \"invalid type \" + tok.type);\r\n    }\r\n  }\r\n\r\n  function p_Field(p) {\r\n    let field = {};\r\n    console.log(\"-----\", p.peek().type);\r\n    field.name = p.expect(\"ID\", \"struct field name\");\r\n    p.expect(\"COLON\");\r\n    field.type = p_Type(p);\r\n    field.set = undefined;\r\n    field.get = undefined;\r\n    let tok = p.peek();\r\n    if (tok.type === \"JSCRIPT\") {\r\n      field.get = tok.value;\r\n      p.next();\r\n    }\r\n    tok = p.peek();\r\n    if (tok.type === \"JSCRIPT\") {\r\n      field.set = tok.value;\r\n      p.next();\r\n    }\r\n    p.expect(\"SEMI\");\r\n    return field;\r\n  }\r\n\r\n  function p_Struct(p) {\r\n    let st = {};\r\n    st.name = p.expect(\"ID\", \"struct name\");\r\n    st.fields = [];\r\n    p.expect(\"OPEN\");\r\n    while (1) {\r\n      if (p.at_end()) {\r\n        p.error(undefined);\r\n      } else if (p.optional(\"CLOSE\")) {\r\n        break;\r\n      } else {\r\n        st.fields.push(p_Field(p));\r\n      }\r\n    }\r\n    return st;\r\n  }\r\n\r\n  let ret = p_Struct(parse);\r\n  console.log(JSON.stringify(ret));\r\n}\r\n\r\n//test_parser();\n\nvar struct_parseutil = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  token: token,\n  tokdef: tokdef,\n  PUTIL_ParseError: PUTIL_ParseError,\n  lexer: lexer,\n  parser: parser\n});\n\n\"use strict\";\r\n\r\nclass NStruct {\r\n  constructor(name) {\r\n    this.fields = [];\r\n    this.id = -1;\r\n    this.name = name;\r\n  }\r\n}\r\n\r\n//the discontinuous id's are to make sure\r\n//the version I originally wrote (which had a few application-specific types)\r\n//and this one do not become totally incompatible.\r\nconst StructEnum = {\r\n  INT          : 0,\r\n  FLOAT        : 1,\r\n  DOUBLE       : 2,\r\n  STRING       : 7,\r\n  STATIC_STRING: 8, //fixed-length string\r\n  STRUCT       : 9,\r\n  TSTRUCT      : 10,\r\n  ARRAY        : 11,\r\n  ITER         : 12,\r\n  SHORT        : 13,\r\n  BYTE         : 14,\r\n  BOOL         : 15,\r\n  ITERKEYS     : 16,\r\n  UINT         : 17,\r\n  USHORT       : 18,\r\n  STATIC_ARRAY : 19,\r\n  SIGNED_BYTE  : 20,\r\n  OPTIONAL     : 21,\r\n};\r\n\r\nconst ArrayTypes = new Set([\r\n  StructEnum.STATIC_ARRAY, StructEnum.ARRAY, StructEnum.ITERKEYS, StructEnum.ITER\r\n]);\r\n\r\nconst ValueTypes = new Set([\r\n  StructEnum.INT,\r\n  StructEnum.FLOAT,\r\n  StructEnum.DOUBLE,\r\n  StructEnum.STRING,\r\n  StructEnum.STATIC_STRING,\r\n  StructEnum.SHORT,\r\n  StructEnum.BYTE,\r\n  StructEnum.BOOL,\r\n  StructEnum.UINT,\r\n  StructEnum.USHORT,\r\n  StructEnum.SIGNED_BYTE\r\n]);\r\n\r\nlet StructTypes = {\r\n  \"int\"          : StructEnum.INT,\r\n  \"uint\"         : StructEnum.UINT,\r\n  \"ushort\"       : StructEnum.USHORT,\r\n  \"float\"        : StructEnum.FLOAT,\r\n  \"double\"       : StructEnum.DOUBLE,\r\n  \"string\"       : StructEnum.STRING,\r\n  \"static_string\": StructEnum.STATIC_STRING,\r\n  \"struct\"       : StructEnum.STRUCT,\r\n  \"abstract\"     : StructEnum.TSTRUCT,\r\n  \"array\"        : StructEnum.ARRAY,\r\n  \"iter\"         : StructEnum.ITER,\r\n  \"short\"        : StructEnum.SHORT,\r\n  \"byte\"         : StructEnum.BYTE,\r\n  \"bool\"         : StructEnum.BOOL,\r\n  \"iterkeys\"     : StructEnum.ITERKEYS,\r\n  \"sbyte\"        : StructEnum.SIGNED_BYTE,\r\n  \"optional\"     : StructEnum.OPTIONAL,\r\n};\r\n\r\nlet StructTypeMap = {};\r\n\r\nfor (let k in StructTypes) {\r\n  StructTypeMap[StructTypes[k]] = k;\r\n}\r\n\r\nfunction gen_tabstr$2(t) {\r\n  let s = \"\";\r\n  for (let i = 0; i < t; i++) {\r\n    s += \"  \";\r\n  }\r\n  return s;\r\n}\r\n\r\nfunction stripComments(buf) {\r\n  let s = '';\r\n\r\n  const MAIN = 0, COMMENT = 1, STR = 2;\r\n\r\n  let p, n;\r\n  let strs = new Set([\"'\", '\"', \"`\"]);\r\n  let mode = MAIN;\r\n  let strlit;\r\n  let escape = false;\r\n\r\n  for (let i = 0; i < buf.length; i++) {\r\n    let p = i > 0 ? buf[i - 1] : undefined;\r\n    let c = buf[i];\r\n    let n = i < buf.length - 1 ? buf[i + 1] : undefined;\r\n\r\n    switch (mode) {\r\n      case MAIN:\r\n        if (c === \"/\" && n === \"/\") {\r\n          mode = COMMENT;\r\n          continue;\r\n        }\r\n\r\n        if (strs.has(c)) {\r\n          strlit = c;\r\n          mode = STR;\r\n        }\r\n\r\n        s += c;\r\n\r\n        break;\r\n      case COMMENT:\r\n        if (n === \"\\n\") {\r\n          mode = MAIN;\r\n        }\r\n        break;\r\n      case STR:\r\n        if (c === strlit && !escape) {\r\n          mode = MAIN;\r\n        }\r\n\r\n        s += c;\r\n        break;\r\n    }\r\n\r\n    if (c === \"\\\\\") {\r\n      escape ^= true;\r\n    } else {\r\n      escape = false;\r\n    }\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nfunction StructParser() {\r\n  let basic_types = new Set([\r\n    \"int\", \"float\", \"double\", \"string\", \"short\", \"byte\", \"sbyte\", \"bool\", \"uint\", \"ushort\"\r\n  ]);\r\n\r\n  let reserved_tokens = new Set([\r\n    \"int\", \"float\", \"double\", \"string\", \"static_string\", \"array\",\r\n    \"iter\", \"abstract\", \"short\", \"byte\", \"sbyte\", \"bool\", \"iterkeys\", \"uint\", \"ushort\",\r\n    \"static_array\", \"optional\"\r\n  ]);\r\n\r\n  function tk(name, re, func) {\r\n    return new tokdef(name, re, func);\r\n  }\r\n\r\n  let tokens = [\r\n    tk(\"ID\", /[a-zA-Z_$]+[a-zA-Z0-9_\\.$]*/, function (t) {\r\n\r\n      if (reserved_tokens.has(t.value)) {\r\n        t.type = t.value.toUpperCase();\r\n      }\r\n      return t;\r\n    }, \"identifier\"),\r\n    tk(\"OPEN\", /\\{/),\r\n    tk(\"EQUALS\", /=/),\r\n    tk(\"CLOSE\", /}/),\r\n    tk(\"STRLIT\", /\\\"[^\"]*\\\"/, t => {\r\n      t.value = t.value.slice(1, t.value.length - 1);\r\n      return t;\r\n    }),\r\n    tk(\"STRLIT\", /\\'[^']*\\'/, t => {\r\n      t.value = t.value.slice(1, t.value.length - 1);\r\n      return t;\r\n    }),\r\n    tk(\"COLON\", /:/),\r\n    tk(\"OPT_COLON\", /\\?:/),\r\n    tk(\"SOPEN\", /\\[/),\r\n    tk(\"SCLOSE\", /\\]/),\r\n    tk(\"JSCRIPT\", /\\|/, function (t) {\r\n      let js = \"\";\r\n      let lexer = t.lexer;\r\n      let p;\r\n\r\n      while (lexer.lexpos < lexer.lexdata.length) {\r\n        let c = lexer.lexdata[lexer.lexpos];\r\n        if (c === \"\\n\")\r\n          break;\r\n\r\n        if (c === \"/\" && p === \"/\") {\r\n          js = js.slice(0, js.length - 1);\r\n          lexer.lexpos--;\r\n\r\n          break;\r\n        }\r\n\r\n        js += c;\r\n        lexer.lexpos++;\r\n        p = c;\r\n      }\r\n\r\n      while (js.trim().endsWith(\";\")) {\r\n        js = js.slice(0, js.length - 1);\r\n        lexer.lexpos--;\r\n      }\r\n      t.value = js.trim();\r\n      return t;\r\n    }),\r\n    tk(\"COMMENT\", /\\/\\/.*[\\n\\r]/),\r\n    tk(\"LPARAM\", /\\(/),\r\n    tk(\"RPARAM\", /\\)/),\r\n    tk(\"COMMA\", /,/),\r\n    tk(\"NUM\", /[0-9]+/, undefined, \"number\"),\r\n    tk(\"SEMI\", /;/),\r\n    tk(\"NEWLINE\", /\\n/, function (t) {\r\n      t.lexer.lineno += 1;\r\n    }, \"newline\"),\r\n    tk(\"SPACE\", / |\\t/, function (t) {\r\n    }, \"whitespace\")\r\n  ];\r\n\r\n  reserved_tokens.forEach(function (rt) {\r\n    tokens.push(tk(rt.toUpperCase()));\r\n  });\r\n\r\n  function errfunc(lexer) {\r\n    return true;\r\n  }\r\n\r\n  class Lexer extends lexer {\r\n    input(str) {\r\n      //str = stripComments(str);\r\n      return super.input(str);\r\n    }\r\n  }\r\n\r\n  let lex = new Lexer(tokens, errfunc);\r\n  let parser$1 = new parser(lex);\r\n\r\n  function p_Static_String(p) {\r\n    p.expect(\"STATIC_STRING\");\r\n    p.expect(\"SOPEN\");\r\n    let num = p.expect(\"NUM\");\r\n    p.expect(\"SCLOSE\");\r\n    return {type: StructEnum.STATIC_STRING, data: {maxlength: num}}\r\n  }\r\n\r\n  function p_DataRef(p) {\r\n    p.expect(\"DATAREF\");\r\n    p.expect(\"LPARAM\");\r\n    let tname = p.expect(\"ID\");\r\n    p.expect(\"RPARAM\");\r\n    return {type: StructEnum.DATAREF, data: tname}\r\n  }\r\n\r\n  function p_Array(p) {\r\n    p.expect(\"ARRAY\");\r\n    p.expect(\"LPARAM\");\r\n    let arraytype = p_Type(p);\r\n\r\n    let itername = \"\";\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = arraytype.data.replace(/\"/g, \"\");\r\n      arraytype = p_Type(p);\r\n    }\r\n\r\n    p.expect(\"RPARAM\");\r\n    return {type: StructEnum.ARRAY, data: {type: arraytype, iname: itername}}\r\n  }\r\n\r\n  function p_Iter(p) {\r\n    p.expect(\"ITER\");\r\n    p.expect(\"LPARAM\");\r\n\r\n    let arraytype = p_Type(p);\r\n    let itername = \"\";\r\n\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = arraytype.data.replace(/\"/g, \"\");\r\n      arraytype = p_Type(p);\r\n    }\r\n\r\n    p.expect(\"RPARAM\");\r\n    return {type: StructEnum.ITER, data: {type: arraytype, iname: itername}}\r\n  }\r\n\r\n  function p_StaticArray(p) {\r\n    p.expect(\"STATIC_ARRAY\");\r\n    p.expect(\"SOPEN\");\r\n    let arraytype = p_Type(p);\r\n    let itername = \"\";\r\n\r\n    p.expect(\"COMMA\");\r\n    let size = p.expect(\"NUM\");\r\n\r\n    if (size < 0 || Math.abs(size - Math.floor(size)) > 0.000001) {\r\n      console.log(Math.abs(size - Math.floor(size)));\r\n      p.error(\"Expected an integer\");\r\n    }\r\n\r\n    size = Math.floor(size);\r\n\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = p_Type(p).data;\r\n    }\r\n\r\n    p.expect(\"SCLOSE\");\r\n    return {type: StructEnum.STATIC_ARRAY, data: {type: arraytype, size: size, iname: itername}}\r\n  }\r\n\r\n  function p_IterKeys(p) {\r\n    p.expect(\"ITERKEYS\");\r\n    p.expect(\"LPARAM\");\r\n\r\n    let arraytype = p_Type(p);\r\n    let itername = \"\";\r\n\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = arraytype.data.replace(/\"/g, \"\");\r\n      arraytype = p_Type(p);\r\n    }\r\n\r\n    p.expect(\"RPARAM\");\r\n    return {type: StructEnum.ITERKEYS, data: {type: arraytype, iname: itername}}\r\n  }\r\n\r\n  function p_Abstract(p) {\r\n    p.expect(\"ABSTRACT\");\r\n    p.expect(\"LPARAM\");\r\n    let type = p.expect(\"ID\");\r\n\r\n    let jsonKeyword = \"_structName\";\r\n\r\n    if (p.optional(\"COMMA\")) {\r\n      jsonKeyword = p.expect(\"STRLIT\");\r\n    }\r\n\r\n    p.expect(\"RPARAM\");\r\n\r\n    return {\r\n      type: StructEnum.TSTRUCT,\r\n      data: type,\r\n      jsonKeyword\r\n    }\r\n  }\r\n\r\n  function p_Optional(p) {\r\n    p.expect(\"OPTIONAL\");\r\n    p.expect(\"LPARAM\");\r\n    const type = p_Type(p);\r\n    p.expect(\"RPARAM\");\r\n\r\n    return {\r\n      type: StructEnum.OPTIONAL,\r\n      data: type\r\n    }\r\n  }\r\n\r\n  function p_Type(p) {\r\n    let tok = p.peeknext();\r\n\r\n    if (tok.type === \"ID\") {\r\n      p.next();\r\n      return {type: StructEnum.STRUCT, data: tok.value}\r\n    } else if (basic_types.has(tok.type.toLowerCase())) {\r\n      p.next();\r\n      return {type: StructTypes[tok.type.toLowerCase()]}\r\n    } else if (tok.type === \"ARRAY\") {\r\n      return p_Array(p);\r\n    } else if (tok.type === \"ITER\") {\r\n      return p_Iter(p);\r\n    } else if (tok.type === \"ITERKEYS\") {\r\n      return p_IterKeys(p);\r\n    } else if (tok.type === \"STATIC_ARRAY\") {\r\n      return p_StaticArray(p);\r\n    } else if (tok.type === \"STATIC_STRING\") {\r\n      return p_Static_String(p);\r\n    } else if (tok.type === \"ABSTRACT\") {\r\n      return p_Abstract(p);\r\n    } else if (tok.type === \"DATAREF\") {\r\n      return p_DataRef(p);\r\n    } else if (tok.type === \"OPTIONAL\") {\r\n      return p_Optional(p);\r\n    } else {\r\n      p.error(tok, \"invalid type \" + tok.type);\r\n    }\r\n  }\r\n\r\n  function p_ID_or_num(p) {\r\n    let t = p.peeknext();\r\n\r\n    if (t.type === \"NUM\") {\r\n      p.next();\r\n      return t.value;\r\n    } else {\r\n      return p.expect(\"ID\", \"struct field name\");\r\n    }\r\n  }\r\n\r\n  function p_Field(p) {\r\n    let field = {};\r\n\r\n    field.name = p_ID_or_num(p);\r\n    let is_opt = false;\r\n\r\n    if (p.peeknext().type === \"OPT_COLON\") {\r\n      p.expect(\"OPT_COLON\");\r\n      is_opt = true;\r\n    } else {\r\n      p.expect(\"COLON\");\r\n    }\r\n\r\n    field.type = p_Type(p);\r\n    if (is_opt) {\r\n      field.type = {\r\n        type:  StructEnum.OPTIONAL,\r\n        data: field.type\r\n      };\r\n    }\r\n    field.set = undefined;\r\n    field.get = undefined;\r\n\r\n    let check = 0;\r\n\r\n    let tok = p.peeknext();\r\n\r\n    if (tok && tok.type === \"JSCRIPT\") {\r\n      field.get = tok.value;\r\n      check = 1;\r\n\r\n      p.next();\r\n      tok = p.peeknext();\r\n    }\r\n\r\n    if (tok && tok.type === \"JSCRIPT\") {\r\n      check = 1;\r\n      field.set = tok.value;\r\n\r\n      p.next();\r\n    }\r\n\r\n    p.expect(\"SEMI\");\r\n\r\n    tok = p.peeknext();\r\n\r\n    if (tok && tok.type === \"COMMENT\") {\r\n      field.comment = tok.value;\r\n      p.next();\r\n    } else {\r\n      field.comment = \"\";\r\n    }\r\n\r\n    return field;\r\n  }\r\n\r\n  function p_Struct(p) {\r\n    let name = p.expect(\"ID\", \"struct name\");\r\n\r\n    let st = new NStruct(name);\r\n\r\n    let tok = p.peeknext();\r\n    let id = -1;\r\n\r\n    if (tok.type === \"ID\" && tok.value === \"id\") {\r\n      p.next();\r\n      p.expect(\"EQUALS\");\r\n      st.id = p.expect(\"NUM\");\r\n    }\r\n\r\n    p.expect(\"OPEN\");\r\n    while (1) {\r\n      if (p.at_end()) {\r\n        p.error(undefined);\r\n      } else if (p.optional(\"CLOSE\")) {\r\n        break;\r\n      } else {\r\n        st.fields.push(p_Field(p));\r\n      }\r\n    }\r\n\r\n    return st;\r\n  }\r\n\r\n  parser$1.start = p_Struct;\r\n  return parser$1;\r\n}\r\n\r\nconst struct_parse = StructParser();\n\nvar struct_parser = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  NStruct: NStruct,\n  StructEnum: StructEnum,\n  ArrayTypes: ArrayTypes,\n  ValueTypes: ValueTypes,\n  StructTypes: StructTypes,\n  StructTypeMap: StructTypeMap,\n  stripComments: stripComments,\n  struct_parse: struct_parse\n});\n\n/** dead file */\n\nvar struct_typesystem = /*#__PURE__*/Object.freeze({\n  __proto__: null\n});\n\n\"use strict\";\r\n\r\nvar STRUCT_ENDIAN = true; //little endian\r\n\r\nfunction setBinaryEndian(mode) {\r\n  STRUCT_ENDIAN = !!mode;\r\n}\r\n\r\nlet temp_dataview = new DataView(new ArrayBuffer(16));\r\nlet uint8_view = new Uint8Array(temp_dataview.buffer);\r\n\r\nclass unpack_context {\r\n  constructor() {\r\n    this.i = 0;\r\n  }\r\n}\r\n\r\nfunction pack_byte(array, val) {\r\n  array.push(val);\r\n}\r\n\r\nfunction pack_sbyte(array, val) {\r\n  if (val < 0) {\r\n    val = 256 + val;\r\n  }\r\n\r\n  array.push(val);\r\n}\r\n\r\nfunction pack_bytes(array, bytes) {\r\n  for (let i = 0; i < bytes.length; i++) {\r\n    array.push(bytes[i]);\r\n  }\r\n}\r\n\r\nfunction pack_int(array, val) {\r\n  temp_dataview.setInt32(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n  array.push(uint8_view[2]);\r\n  array.push(uint8_view[3]);\r\n}\r\n\r\nfunction pack_uint(array, val) {\r\n  temp_dataview.setUint32(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n  array.push(uint8_view[2]);\r\n  array.push(uint8_view[3]);\r\n}\r\n\r\nfunction pack_ushort(array, val) {\r\n  temp_dataview.setUint16(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n}\r\n\r\nfunction pack_float(array, val) {\r\n  temp_dataview.setFloat32(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n  array.push(uint8_view[2]);\r\n  array.push(uint8_view[3]);\r\n}\r\n\r\nfunction pack_double(array, val) {\r\n  temp_dataview.setFloat64(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n  array.push(uint8_view[2]);\r\n  array.push(uint8_view[3]);\r\n  array.push(uint8_view[4]);\r\n  array.push(uint8_view[5]);\r\n  array.push(uint8_view[6]);\r\n  array.push(uint8_view[7]);\r\n}\r\n\r\nfunction pack_short(array, val) {\r\n  temp_dataview.setInt16(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n}\r\n\r\nfunction encode_utf8(arr, str) {\r\n  for (let i = 0; i < str.length; i++) {\r\n    let c = str.charCodeAt(i);\r\n\r\n    while (c !== 0) {\r\n      let uc = c & 127;\r\n      c = c >> 7;\r\n\r\n      if (c !== 0)\r\n        uc |= 128;\r\n\r\n      arr.push(uc);\r\n    }\r\n  }\r\n}\r\n\r\nfunction decode_utf8(arr) {\r\n  let str = \"\";\r\n  let i = 0;\r\n\r\n  while (i < arr.length) {\r\n    let c = arr[i];\r\n    let sum = c & 127;\r\n    let j = 0;\r\n    let lasti = i;\r\n\r\n    while (i < arr.length && (c & 128)) {\r\n      j += 7;\r\n      i++;\r\n      c = arr[i];\r\n\r\n      c = (c & 127) << j;\r\n      sum |= c;\r\n    }\r\n\r\n    if (sum === 0) break;\r\n\r\n    str += String.fromCharCode(sum);\r\n    i++;\r\n  }\r\n\r\n  return str;\r\n}\r\n\r\nfunction test_utf8() {\r\n  let s = \"a\" + String.fromCharCode(8800) + \"b\";\r\n  let arr = [];\r\n\r\n  encode_utf8(arr, s);\r\n  let s2 = decode_utf8(arr);\r\n\r\n  if (s !== s2) {\r\n    throw new Error(\"UTF-8 encoding/decoding test failed\");\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction truncate_utf8(arr, maxlen) {\r\n  let len = Math.min(arr.length, maxlen);\r\n\r\n  let last_codepoint = 0;\r\n  let last2 = 0;\r\n\r\n  let incode = false;\r\n  let i = 0;\r\n  let code = 0;\r\n  while (i < len) {\r\n    incode = arr[i] & 128;\r\n\r\n    if (!incode) {\r\n      last2 = last_codepoint + 1;\r\n      last_codepoint = i + 1;\r\n    }\r\n\r\n    i++;\r\n  }\r\n\r\n  if (last_codepoint < maxlen)\r\n    arr.length = last_codepoint;\r\n  else\r\n    arr.length = last2;\r\n\r\n  return arr;\r\n}\r\n\r\nlet _static_sbuf_ss = new Array(2048);\r\n\r\nfunction pack_static_string(data, str, length) {\r\n  if (length === undefined)\r\n    throw new Error(\"'length' paremter is not optional for pack_static_string()\");\r\n\r\n  let arr = length < 2048 ? _static_sbuf_ss : new Array();\r\n  arr.length = 0;\r\n\r\n  encode_utf8(arr, str);\r\n  truncate_utf8(arr, length);\r\n\r\n  for (let i = 0; i < length; i++) {\r\n    if (i >= arr.length) {\r\n      data.push(0);\r\n    } else {\r\n      data.push(arr[i]);\r\n    }\r\n  }\r\n}\r\n\r\nlet _static_sbuf = new Array(32);\r\n\r\n/*strings are packed as 32-bit unicode codepoints*/\r\nfunction pack_string(data, str) {\r\n  _static_sbuf.length = 0;\r\n  encode_utf8(_static_sbuf, str);\r\n\r\n  pack_int(data, _static_sbuf.length);\r\n\r\n  for (let i = 0; i < _static_sbuf.length; i++) {\r\n    data.push(_static_sbuf[i]);\r\n  }\r\n}\r\n\r\nfunction unpack_bytes(dview, uctx, len) {\r\n  let ret = new DataView(dview.buffer.slice(uctx.i, uctx.i + len));\r\n  uctx.i += len;\r\n\r\n  return ret;\r\n}\r\n\r\nfunction unpack_byte(dview, uctx) {\r\n  return dview.getUint8(uctx.i++);\r\n}\r\n\r\nfunction unpack_sbyte(dview, uctx) {\r\n  return dview.getInt8(uctx.i++);\r\n}\r\n\r\nfunction unpack_int(dview, uctx) {\r\n  uctx.i += 4;\r\n  return dview.getInt32(uctx.i - 4, STRUCT_ENDIAN);\r\n}\r\n\r\nfunction unpack_uint(dview, uctx) {\r\n  uctx.i += 4;\r\n  return dview.getUint32(uctx.i - 4, STRUCT_ENDIAN);\r\n}\r\n\r\nfunction unpack_ushort(dview, uctx) {\r\n  uctx.i += 2;\r\n  return dview.getUint16(uctx.i - 2, STRUCT_ENDIAN);\r\n}\r\n\r\nfunction unpack_float(dview, uctx) {\r\n  uctx.i += 4;\r\n  return dview.getFloat32(uctx.i - 4, STRUCT_ENDIAN);\r\n}\r\n\r\nfunction unpack_double(dview, uctx) {\r\n  uctx.i += 8;\r\n  return dview.getFloat64(uctx.i - 8, STRUCT_ENDIAN);\r\n}\r\n\r\nfunction unpack_short(dview, uctx) {\r\n  uctx.i += 2;\r\n  return dview.getInt16(uctx.i - 2, STRUCT_ENDIAN);\r\n}\r\n\r\nlet _static_arr_us = new Array(32);\r\n\r\nfunction unpack_string(data, uctx) {\r\n  let slen = unpack_int(data, uctx);\r\n\r\n  if (!slen) {\r\n    return \"\";\r\n  }\r\n\r\n  let str = \"\";\r\n  let arr = slen < 2048 ? _static_arr_us : new Array(slen);\r\n\r\n  arr.length = slen;\r\n  for (let i = 0; i < slen; i++) {\r\n    arr[i] = unpack_byte(data, uctx);\r\n  }\r\n\r\n  return decode_utf8(arr);\r\n}\r\n\r\nlet _static_arr_uss = new Array(2048);\r\n\r\nfunction unpack_static_string(data, uctx, length) {\r\n  let str = \"\";\r\n\r\n  if (length === undefined)\r\n    throw new Error(\"'length' cannot be undefined in unpack_static_string()\");\r\n\r\n  let arr = length < 2048 ? _static_arr_uss : new Array(length);\r\n  arr.length = 0;\r\n\r\n  let done = false;\r\n  for (let i = 0; i < length; i++) {\r\n    let c = unpack_byte(data, uctx);\r\n\r\n    if (c === 0) {\r\n      done = true;\r\n    }\r\n\r\n    if (!done && c !== 0) {\r\n      arr.push(c);\r\n      //arr.length++;\r\n    }\r\n  }\r\n\r\n  truncate_utf8(arr, length);\r\n  return decode_utf8(arr);\r\n}\n\nvar struct_binpack = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  get STRUCT_ENDIAN () { return STRUCT_ENDIAN; },\n  setBinaryEndian: setBinaryEndian,\n  temp_dataview: temp_dataview,\n  uint8_view: uint8_view,\n  unpack_context: unpack_context,\n  pack_byte: pack_byte,\n  pack_sbyte: pack_sbyte,\n  pack_bytes: pack_bytes,\n  pack_int: pack_int,\n  pack_uint: pack_uint,\n  pack_ushort: pack_ushort,\n  pack_float: pack_float,\n  pack_double: pack_double,\n  pack_short: pack_short,\n  encode_utf8: encode_utf8,\n  decode_utf8: decode_utf8,\n  test_utf8: test_utf8,\n  pack_static_string: pack_static_string,\n  pack_string: pack_string,\n  unpack_bytes: unpack_bytes,\n  unpack_byte: unpack_byte,\n  unpack_sbyte: unpack_sbyte,\n  unpack_int: unpack_int,\n  unpack_uint: unpack_uint,\n  unpack_ushort: unpack_ushort,\n  unpack_float: unpack_float,\n  unpack_double: unpack_double,\n  unpack_short: unpack_short,\n  unpack_string: unpack_string,\n  unpack_static_string: unpack_static_string\n});\n\nlet warninglvl$1 = 2;\r\nlet debug = 0;\r\n\r\nlet _static_envcode_null$1 = \"\";\r\nlet packer_debug$1, packer_debug_start$1, packer_debug_end$1;\r\nlet packdebug_tablevel = 0;\r\n\r\nfunction _get_pack_debug() {\r\n  return {\r\n    packer_debug: packer_debug$1, packer_debug_start: packer_debug_start$1, packer_debug_end: packer_debug_end$1,\r\n    debug, warninglvl: warninglvl$1\r\n  }\r\n}\r\n\r\nclass cachering extends Array {\r\n  constructor(cb, tot) {\r\n    super();\r\n    this.length = tot;\r\n    this.cur = 0;\r\n\r\n    for (let i = 0; i < tot; i++) {\r\n      this[i] = cb();\r\n    }\r\n  }\r\n\r\n  static fromConstructor(cls, tot) {\r\n    return new cachering(() => new cls(), tot);\r\n  }\r\n\r\n  next() {\r\n    let ret = this[this.cur];\r\n\r\n    this.cur = (this.cur + 1)%this.length;\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nfunction gen_tabstr$1(tot) {\r\n  let ret = \"\";\r\n\r\n  for (let i = 0; i < tot; i++) {\r\n    ret += \" \";\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nfunction setWarningMode2(t) {\r\n  if (typeof t !== \"number\" || isNaN(t)) {\r\n    throw new Error(\"Expected a single number (>= 0) argument to setWarningMode\");\r\n  }\r\n\r\n  warninglvl$1 = t;\r\n}\r\n\r\nfunction setDebugMode2(t) {\r\n  debug = t;\r\n\r\n  if (debug) {\r\n    packer_debug$1 = function () {\r\n      let tab = gen_tabstr$1(packdebug_tablevel);\r\n\r\n      if (arguments.length > 0) {\r\n        console.warn(tab, ...arguments);\r\n      } else {\r\n        console.warn(\"Warning: undefined msg\");\r\n      }\r\n    };\r\n    packer_debug_start$1 = function (funcname) {\r\n      packer_debug$1(\"Start \" + funcname);\r\n      packdebug_tablevel++;\r\n    };\r\n\r\n    packer_debug_end$1 = function (funcname) {\r\n      packdebug_tablevel--;\r\n\r\n      if (funcname) {\r\n        packer_debug$1(\"Leave \" + funcname);\r\n      }\r\n    };\r\n  } else {\r\n    packer_debug$1 = function () {\r\n    };\r\n    packer_debug_start$1 = function () {\r\n    };\r\n    packer_debug_end$1 = function () {\r\n    };\r\n  }\r\n}\r\n\r\nsetDebugMode2(debug);\r\n\r\nconst StructFieldTypes = [];\r\nconst StructFieldTypeMap = {};\r\n\r\nfunction packNull(manager, data, field, type) {\r\n  StructFieldTypeMap[type.type].packNull(manager, data, field, type);\r\n}\r\n\r\nfunction toJSON(manager, val, obj, field, type) {\r\n  return StructFieldTypeMap[type.type].toJSON(manager, val, obj, field, type);\r\n}\r\n\r\nfunction fromJSON(manager, val, obj, field, type, instance) {\r\n  return StructFieldTypeMap[type.type].fromJSON(manager, val, obj, field, type, instance);\r\n}\r\n\r\nfunction formatJSON$1(manager, val, obj, field, type, instance, tlvl = 0) {\r\n  return StructFieldTypeMap[type.type].formatJSON(manager, val, obj, field, type, instance, tlvl);\r\n}\r\n\r\nfunction validateJSON$1(manager, val, obj, field, type, instance, _abstractKey) {\r\n  return StructFieldTypeMap[type.type].validateJSON(manager, val, obj, field, type, instance, _abstractKey);\r\n}\r\n\r\n\r\nfunction unpack_field(manager, data, type, uctx) {\r\n  let name;\r\n\r\n  if (debug) {\r\n    name = StructFieldTypeMap[type.type].define().name;\r\n    packer_debug_start$1(\"R \" + name);\r\n  }\r\n\r\n  let ret = StructFieldTypeMap[type.type].unpack(manager, data, type, uctx);\r\n\r\n  if (debug) {\r\n    packer_debug_end$1();\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nlet fakeFields = new cachering(() => {\r\n  return {type: undefined, get: undefined, set: undefined}\r\n}, 256);\r\n\r\nfunction fmt_type(type) {\r\n  return StructFieldTypeMap[type.type].format(type);\r\n}\r\n\r\nfunction do_pack(manager, data, val, obj, field, type) {\r\n  let name;\r\n\r\n  if (debug) {\r\n    name = StructFieldTypeMap[type.type].define().name;\r\n    packer_debug_start$1(\"W \" + name);\r\n  }\r\n\r\n  let typeid = type;\r\n  if (typeof typeid !== \"number\") {\r\n    typeid = typeid.type;\r\n  }\r\n\r\n  let ret = StructFieldTypeMap[typeid].pack(manager, data, val, obj, field, type);\r\n\r\n  if (debug) {\r\n    packer_debug_end$1();\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nlet _ws_env$1 = [[undefined, undefined]];\r\n\r\nclass StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    this.pack(manager, data, 0, 0, field, type);\r\n  }\r\n\r\n  static format(type) {\r\n    return this.define().name;\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    return val;\r\n  }\r\n\r\n  static fromJSON(manager, val, obj, field, type, instance) {\r\n    return val;\r\n  }\r\n\r\n  static formatJSON(manager, val, obj, field, type, instance, tlvl) {\r\n    return JSON.stringify(val);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance, _abstractKey) {\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   return false to override default\r\n   helper js for packing\r\n   */\r\n  static useHelperJS(field) {\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   Define field class info.\r\n\r\n   Example:\r\n   <pre>\r\n   static define() {return {\r\n    type : StructEnum.INT,\r\n    name : \"int\"\r\n  }}\r\n   </pre>\r\n   */\r\n  static define() {\r\n    return {\r\n      type: -1,\r\n      name: \"(error)\"\r\n    }\r\n  }\r\n\r\n  /**\r\n   Register field packer/unpacker class.  Will throw an error if define() method is bad.\r\n   */\r\n  static register(cls) {\r\n    if (StructFieldTypes.indexOf(cls) >= 0) {\r\n      throw new Error(\"class already registered\");\r\n    }\r\n\r\n    if (cls.define === StructFieldType.define) {\r\n      throw new Error(\"you forgot to make a define() static method\");\r\n    }\r\n\r\n    if (cls.define().type === undefined) {\r\n      throw new Error(\"cls.define().type was undefined!\");\r\n    }\r\n\r\n    if (cls.define().type in StructFieldTypeMap) {\r\n      throw new Error(\"type \" + cls.define().type + \" is used by another StructFieldType subclass\");\r\n    }\r\n\r\n    StructFieldTypes.push(cls);\r\n    StructFieldTypeMap[cls.define().type] = cls;\r\n  }\r\n}\r\n\r\nclass StructIntField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_int(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_int(data, uctx);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (typeof val !== \"number\" || val !== Math.floor(val)) {\r\n      return \"\" + val + \" is not an integer\";\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.INT,\r\n      name: \"int\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructIntField);\r\n\r\nclass StructFloatField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_float(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_float(data, uctx);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance, _abstractKey) {\r\n    if (typeof val !== \"number\") {\r\n      return \"Not a float: \" + val;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.FLOAT,\r\n      name: \"float\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructFloatField);\r\n\r\nclass StructDoubleField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_double(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_double(data, uctx);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (typeof val !== \"number\") {\r\n      return \"Not a double: \" + val;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.DOUBLE,\r\n      name: \"double\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructDoubleField);\r\n\r\nclass StructStringField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    val = !val ? \"\" : val;\r\n\r\n    pack_string(data, val);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (typeof val !== \"string\") {\r\n      return \"Not a string: \" + val;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    this.pack(manager, data, \"\", 0, field, type);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_string(data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.STRING,\r\n      name: \"string\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructStringField);\r\n\r\nclass StructStaticStringField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    val = !val ? \"\" : val;\r\n\r\n    pack_static_string(data, val, type.data.maxlength);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (typeof val !== \"string\") {\r\n      return \"Not a string: \" + val;\r\n    }\r\n\r\n\r\n    if (val.length > type.data.maxlength) {\r\n      return \"String is too big; limit is \" + type.data.maxlength + \"; string:\" + val;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static format(type) {\r\n    return `static_string[${type.data.maxlength}]`;\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    this.pack(manager, data, \"\", 0, field, type);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_static_string(data, uctx, type.data.maxlength);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.STATIC_STRING,\r\n      name: \"static_string\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructStaticStringField);\r\n\r\nclass StructStructField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    packer_debug$1(\"struct\", stt.name);\r\n\r\n    manager.write_struct(data, val, stt);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance, _abstractKey) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    if (!val) {\r\n      return \"Expected \" + stt.name + \" object\";\r\n    }\r\n\r\n    return manager.validateJSONIntern(val, stt, _abstractKey);\r\n  }\r\n\r\n  static format(type) {\r\n    return type.data;\r\n  }\r\n\r\n  static fromJSON(manager, val, obj, field, type, instance) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    return manager.readJSON(val, stt, instance);\r\n  }\r\n\r\n  static formatJSON(manager, val, obj, field, type, instance, tlvl) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    return manager.formatJSON_intern(val, stt, field, tlvl);\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    let stt = manager.get_struct(type.data);\r\n    return manager.writeJSON(val, stt);\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, dest) {\r\n    let cls2 = manager.get_struct_cls(type.data);\r\n\r\n    packer_debug$1(\"struct\", cls2 ? cls2.name : \"(error)\");\r\n    return manager.read_object(data, cls2, uctx, dest);\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    packer_debug$1(\"struct\", type);\r\n\r\n    for (let field2 of stt.fields) {\r\n      let type2 = field2.type;\r\n\r\n      packNull(manager, data, field2, type2);\r\n    }\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let cls2 = manager.get_struct_cls(type.data);\r\n    packer_debug$1(\"struct\", cls2 ? cls2.name : \"(error)\");\r\n\r\n    return manager.read_object(data, cls2, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.STRUCT,\r\n      name: \"struct\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructStructField);\r\n\r\nclass StructTStructField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    let cls = manager.get_struct_cls(type.data);\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    const keywords = manager.constructor.keywords;\r\n\r\n    //make sure inheritance is correct\r\n    if (val.constructor.structName !== type.data && (val instanceof cls)) {\r\n      //if (DEBUG.Struct) {\r\n      //    console.log(val.constructor.structName+\" inherits from \"+cls.structName);\r\n      //}\r\n      stt = manager.get_struct(val.constructor.structName);\r\n    } else if (val.constructor.structName === type.data) {\r\n      stt = manager.get_struct(type.data);\r\n    } else {\r\n      console.trace();\r\n      throw new Error(\"Bad struct \" + val.constructor.structName + \" passed to write_struct\");\r\n    }\r\n\r\n    packer_debug$1(\"int \" + stt.id);\r\n\r\n    pack_int(data, stt.id);\r\n    manager.write_struct(data, val, stt);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance, _abstractKey) {\r\n    let key = type.jsonKeyword;\r\n\r\n    if (typeof val !== \"object\") {\r\n      return typeof val + \" is not an object\";\r\n    }\r\n\r\n    let stt = manager.get_struct(val[key]);\r\n    let cls = manager.get_struct_cls(stt.name);\r\n    let parentcls = manager.get_struct_cls(type.data);\r\n\r\n    let ok = false;\r\n\r\n    do {\r\n      if (cls === parentcls) {\r\n        ok = true;\r\n        break;\r\n      }\r\n\r\n      cls = cls.prototype.__proto__.constructor;\r\n    } while (cls && cls !== Object);\r\n\r\n    if (!ok) {\r\n      return stt.name + \" is not a child class off \" + type.data;\r\n    }\r\n\r\n    return manager.validateJSONIntern(val, stt, type.jsonKeyword);\r\n  }\r\n\r\n\r\n  static fromJSON(manager, val, obj, field, type, instance) {\r\n    let key = type.jsonKeyword;\r\n\r\n    let stt = manager.get_struct(val[key]);\r\n\r\n    return manager.readJSON(val, stt, instance);\r\n  }\r\n\r\n  static formatJSON(manager, val, obj, field, type, instance, tlvl) {\r\n    let key = type.jsonKeyword;\r\n\r\n    let stt = manager.get_struct(val[key]);\r\n\r\n    return manager.formatJSON_intern(val, stt, field, tlvl);\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    const keywords = manager.constructor.keywords;\r\n\r\n    let stt = manager.get_struct(val.constructor.structName);\r\n    let ret = manager.writeJSON(val, stt);\r\n\r\n    ret[type.jsonKeyword] = \"\" + stt.name;\r\n\r\n    return ret;\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    pack_int(data, stt.id);\r\n    packNull(manager, data, field, {type: StructEnum.STRUCT, data: type.data});\r\n  }\r\n\r\n  static format(type) {\r\n    return \"abstract(\" + type.data + \")\";\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, dest) {\r\n    let id = unpack_int(data, uctx);\r\n\r\n    packer_debug$1(\"-int \" + id);\r\n    if (!(id in manager.struct_ids)) {\r\n      packer_debug$1(\"tstruct id: \" + id);\r\n      console.trace();\r\n      console.log(id);\r\n      console.log(manager.struct_ids);\r\n      throw new Error(\"Unknown struct type \" + id + \".\");\r\n    }\r\n\r\n    let cls2 = manager.get_struct_id(id);\r\n\r\n    packer_debug$1(\"struct name: \" + cls2.name);\r\n\r\n    cls2 = manager.struct_cls[cls2.name];\r\n\r\n    return manager.read_object(data, cls2, uctx, dest);\r\n    //packer_debug(\"ret\", ret);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let id = unpack_int(data, uctx);\r\n\r\n    packer_debug$1(\"-int \" + id);\r\n    if (!(id in manager.struct_ids)) {\r\n      packer_debug$1(\"tstruct id: \" + id);\r\n      console.trace();\r\n      console.log(id);\r\n      console.log(manager.struct_ids);\r\n      throw new Error(\"Unknown struct type \" + id + \".\");\r\n    }\r\n\r\n    let cls2 = manager.get_struct_id(id);\r\n\r\n    packer_debug$1(\"struct name: \" + cls2.name);\r\n    cls2 = manager.struct_cls[cls2.name];\r\n\r\n    return manager.read_object(data, cls2, uctx);\r\n    //packer_debug(\"ret\", ret);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.TSTRUCT,\r\n      name: \"tstruct\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructTStructField);\r\n\r\n/** out is just a [string], an array of dimen 1 whose sole entry is the output string. */\r\nfunction formatArrayJson(manager, val, obj, field, type, type2, instance, tlvl, array = val) {\r\n  if (array === undefined || array === null || typeof array !== \"object\" || !array[Symbol.iterator]) {\r\n    console.log(obj);\r\n    console.log(array);\r\n    throw new Error(`Expected an array for ${field.name}`);\r\n  }\r\n\r\n  if (ValueTypes.has(type2.type)) {\r\n    return JSON.stringify(array);\r\n  }\r\n\r\n  let s = '[';\r\n  if (manager.formatCtx.addComments && field.comment.trim()) {\r\n    s += \" \" + field.comment.trim();\r\n  }\r\n\r\n  s += \"\\n\";\r\n\r\n  for (let i = 0; i < array.length; i++) {\r\n    let item = array[i];\r\n\r\n    s += tab(tlvl + 1) + formatJSON$1(manager, item, val, field, type2, instance, tlvl + 1) + \",\\n\";\r\n  }\r\n\r\n  s += tab(tlvl) + \"]\";\r\n\r\n  return s;\r\n}\r\n\r\nclass StructArrayField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    if (val === undefined) {\r\n      console.trace();\r\n      console.log(\"Undefined array fed to struct struct packer!\");\r\n      console.log(\"Field: \", field);\r\n      console.log(\"Type: \", type);\r\n      console.log(\"\");\r\n      packer_debug$1(\"int 0\");\r\n      pack_int(data, 0);\r\n      return;\r\n    }\r\n\r\n    packer_debug$1(\"int \" + val.length);\r\n    pack_int(data, val.length);\r\n\r\n    let d = type.data;\r\n\r\n    let itername = d.iname;\r\n    let type2 = d.type;\r\n\r\n    let env = _ws_env$1;\r\n    for (let i = 0; i < val.length; i++) {\r\n      let val2 = val[i];\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n      }\r\n\r\n      //XXX not sure I really need this fakeField stub here. . .\r\n      let fakeField = fakeFields.next();\r\n      fakeField.type = type2;\r\n      do_pack(manager, data, val2, obj, fakeField, type2);\r\n    }\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    pack_int(data, 0);\r\n  }\r\n\r\n  static format(type) {\r\n    if (type.data.iname !== \"\" && type.data.iname !== undefined) {\r\n      return \"array(\" + type.data.iname + \", \" + fmt_type(type.data.type) + \")\";\r\n    } else {\r\n      return \"array(\" + fmt_type(type.data.type) + \")\";\r\n    }\r\n  }\r\n\r\n  static useHelperJS(field) {\r\n    return !field.type.data.iname;\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance, _abstractKey) {\r\n    if (!val) {\r\n      return \"not an array: \" + val;\r\n    }\r\n\r\n    for (let i = 0; i < val.length; i++) {\r\n      let ret = validateJSON$1(manager, val[i], val, field, type.data.type, undefined, _abstractKey);\r\n\r\n      if (typeof ret === \"string\" || !ret) {\r\n        return ret;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static fromJSON(manager, val, obj, field, type, instance) {\r\n    let ret = instance || [];\r\n\r\n    ret.length = 0;\r\n\r\n    for (let i = 0; i < val.length; i++) {\r\n      let val2 = fromJSON(manager, val[i], val, field, type.data.type, undefined);\r\n\r\n      if (val2 === undefined) {\r\n        console.log(val2);\r\n        console.error(\"eeek\");\r\n        process.exit();\r\n      }\r\n\r\n      ret.push(val2);\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  static formatJSON(manager, val, obj, field, type, instance, tlvl) {\r\n    //export function formatArrayJson(manager, val, obj, field, type, type2, instance, tlvl, array=val) {\r\n\r\n    return formatArrayJson(manager, val, obj, field, type, type.data.type, instance, tlvl);\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    val = val || [];\r\n    let json = [];\r\n\r\n    let itername = type.data.iname;\r\n\r\n    for (let i = 0; i < val.length; i++) {\r\n      let val2 = val[i];\r\n      let env = _ws_env$1;\r\n\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n\r\n        //console.log(\"VAL2\", val2, toJSON(manager, val2, val, field, type.data.type));\r\n      }\r\n\r\n      json.push(toJSON(manager, val2, val, field, type.data.type));\r\n    }\r\n\r\n    return json;\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, dest) {\r\n    let len = unpack_int(data, uctx);\r\n    dest.length = 0;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      dest.push(unpack_field(manager, data, type.data.type, uctx));\r\n    }\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let len = unpack_int(data, uctx);\r\n    packer_debug$1(\"-int \" + len);\r\n\r\n    let arr = new Array(len);\r\n    for (let i = 0; i < len; i++) {\r\n      arr[i] = unpack_field(manager, data, type.data.type, uctx);\r\n    }\r\n\r\n    return arr;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.ARRAY,\r\n      name: \"array\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructArrayField);\r\n\r\nclass StructIterField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    //this was originally implemented to use ES6 iterators.\r\n    function forEach(cb, thisvar) {\r\n      if (val && val[Symbol.iterator]) {\r\n        for (let item of val) {\r\n          cb.call(thisvar, item);\r\n        }\r\n      } else if (val && val.forEach) {\r\n        val.forEach(function (item) {\r\n          cb.call(thisvar, item);\r\n        });\r\n      } else {\r\n        console.trace();\r\n        console.log(\"Undefined iterable list fed to struct struct packer!\", val);\r\n        console.log(\"Field: \", field);\r\n        console.log(\"Type: \", type);\r\n        console.log(\"\");\r\n      }\r\n    }\r\n\r\n    /* save space for length */\r\n    let starti = data.length;\r\n    data.length += 4;\r\n\r\n    let d = type.data, itername = d.iname, type2 = d.type;\r\n    let env = _ws_env$1;\r\n\r\n    let i = 0;\r\n    forEach(function (val2) {\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n      }\r\n\r\n      //XXX not sure I really need this fakeField stub here. . .\r\n      let fakeField = fakeFields.next();\r\n      fakeField.type = type2;\r\n      do_pack(manager, data, val2, obj, fakeField, type2);\r\n\r\n      i++;\r\n    }, this);\r\n\r\n    /* write length */\r\n    temp_dataview.setInt32(0, i, STRUCT_ENDIAN);\r\n\r\n    data[starti++] = uint8_view[0];\r\n    data[starti++] = uint8_view[1];\r\n    data[starti++] = uint8_view[2];\r\n    data[starti++] = uint8_view[3];\r\n  }\r\n\r\n  static formatJSON(manager, val, obj, field, type, instance, tlvl) {\r\n    return formatArrayJson(manager, val, obj, field, type, type.data.type, instance, tlvl, list(val));\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    return StructArrayField.validateJSON(...arguments);\r\n  }\r\n\r\n  static fromJSON() {\r\n    return StructArrayField.fromJSON(...arguments);\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    val = val || [];\r\n    let json = [];\r\n\r\n    let itername = type.data.iname;\r\n\r\n    for (let val2 of val) {\r\n      let env = _ws_env$1;\r\n\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n\r\n        //console.log(\"VAL2\", val2, toJSON(manager, val2, val, field, type.data.type));\r\n      }\r\n\r\n      json.push(toJSON(manager, val2, val, field, type.data.type));\r\n    }\r\n\r\n    return json;\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    pack_int(data, 0);\r\n  }\r\n\r\n  static useHelperJS(field) {\r\n    return !field.type.data.iname;\r\n  }\r\n\r\n  static format(type) {\r\n    if (type.data.iname !== \"\" && type.data.iname !== undefined) {\r\n      return \"iter(\" + type.data.iname + \", \" + fmt_type(type.data.type) + \")\";\r\n    } else {\r\n      return \"iter(\" + fmt_type(type.data.type) + \")\";\r\n    }\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, arr) {\r\n    let len = unpack_int(data, uctx);\r\n    packer_debug$1(\"-int \" + len);\r\n\r\n    arr.length = 0;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      arr.push(unpack_field(manager, data, type.data.type, uctx));\r\n    }\r\n\r\n    return arr;\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let len = unpack_int(data, uctx);\r\n    packer_debug$1(\"-int \" + len);\r\n\r\n    let arr = new Array(len);\r\n    for (let i = 0; i < len; i++) {\r\n      arr[i] = unpack_field(manager, data, type.data.type, uctx);\r\n    }\r\n\r\n    return arr;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.ITER,\r\n      name: \"iter\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructIterField);\r\n\r\nclass StructShortField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_short(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_short(data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.SHORT,\r\n      name: \"short\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructShortField);\r\n\r\nclass StructByteField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_byte(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_byte(data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.BYTE,\r\n      name: \"byte\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructByteField);\r\n\r\nclass StructSignedByteField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_sbyte(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_sbyte(data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.SIGNED_BYTE,\r\n      name: \"sbyte\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructSignedByteField);\r\n\r\nclass StructBoolField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_byte(data, !!val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return !!unpack_byte(data, uctx);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (val === 0 || val === 1 || val === true || val === false || val === \"true\" || val === \"false\") {\r\n      return true;\r\n    }\r\n\r\n    return \"\" + val + \" is not a bool\";\r\n  }\r\n\r\n  static fromJSON(manager, val, obj, field, type, instance) {\r\n    if (val === \"false\") {\r\n      val = false;\r\n    }\r\n\r\n    return !!val;\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    return !!val;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.BOOL,\r\n      name: \"bool\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructBoolField);\r\n\r\nclass StructIterKeysField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    //this was originally implemented to use ES6 iterators.\r\n    if ((typeof val !== \"object\" && typeof val !== \"function\") || val === null) {\r\n      console.warn(\"Bad object fed to iterkeys in struct packer!\", val);\r\n      console.log(\"Field: \", field);\r\n      console.log(\"Type: \", type);\r\n      console.log(\"\");\r\n\r\n      pack_int(data, 0);\r\n      return;\r\n    }\r\n\r\n    let len = 0.0;\r\n    for (let k in val) {\r\n      len++;\r\n    }\r\n\r\n    packer_debug$1(\"int \" + len);\r\n    pack_int(data, len);\r\n\r\n    let d = type.data, itername = d.iname, type2 = d.type;\r\n    let env = _ws_env$1;\r\n\r\n    let i = 0;\r\n    for (let val2 in val) {\r\n      if (i >= len) {\r\n        if (warninglvl$1 > 0) {\r\n          console.warn(\"Warning: object keys magically replaced during iteration\", val, i);\r\n        }\r\n        return;\r\n      }\r\n\r\n      if (itername && itername.trim().length > 0 && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n      } else {\r\n        val2 = val[val2]; //fetch value\r\n      }\r\n\r\n      let f2 = {type: type2, get: undefined, set: undefined};\r\n      do_pack(manager, data, val2, obj, f2, type2);\r\n\r\n      i++;\r\n    }\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    return StructArrayField.validateJSON(...arguments);\r\n  }\r\n\r\n  static fromJSON() {\r\n    return StructArrayField.fromJSON(...arguments);\r\n  }\r\n\r\n  static formatJSON(manager, val, obj, field, type, instance, tlvl) {\r\n    return formatArrayJson(manager, val, obj, field, type, type.data.type, instance, tlvl, list(val));\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    val = val || [];\r\n    let json = [];\r\n\r\n    let itername = type.data.iname;\r\n\r\n    for (let k in val) {\r\n      let val2 = val[k];\r\n      let env = _ws_env$1;\r\n\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n\r\n        //console.log(\"VAL2\", val2, toJSON(manager, val2, val, field, type.data.type));\r\n      }\r\n\r\n      json.push(toJSON(manager, val2, val, field, type.data.type));\r\n    }\r\n\r\n    return json;\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    pack_int(data, 0);\r\n  }\r\n\r\n  static useHelperJS(field) {\r\n    return !field.type.data.iname;\r\n  }\r\n\r\n  static format(type) {\r\n    if (type.data.iname !== \"\" && type.data.iname !== undefined) {\r\n      return \"iterkeys(\" + type.data.iname + \", \" + fmt_type(type.data.type) + \")\";\r\n    } else {\r\n      return \"iterkeys(\" + fmt_type(type.data.type) + \")\";\r\n    }\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, arr) {\r\n    let len = unpack_int(data, uctx);\r\n    packer_debug$1(\"-int \" + len);\r\n\r\n    arr.length = 0;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      arr.push(unpack_field(manager, data, type.data.type, uctx));\r\n    }\r\n\r\n    return arr;\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let len = unpack_int(data, uctx);\r\n    packer_debug$1(\"-int \" + len);\r\n\r\n    let arr = new Array(len);\r\n    for (let i = 0; i < len; i++) {\r\n      arr[i] = unpack_field(manager, data, type.data.type, uctx);\r\n    }\r\n\r\n    return arr;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.ITERKEYS,\r\n      name: \"iterkeys\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructIterKeysField);\r\n\r\nclass StructUintField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_uint(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_uint(data, uctx);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (typeof val !== \"number\" || val !== Math.floor(val)) {\r\n      return \"\" + val + \" is not an integer\";\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.UINT,\r\n      name: \"uint\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructUintField);\r\n\r\n\r\nclass StructUshortField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_ushort(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_ushort(data, uctx);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (typeof val !== \"number\" || val !== Math.floor(val)) {\r\n      return \"\" + val + \" is not an integer\";\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.USHORT,\r\n      name: \"ushort\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructUshortField);\r\n\r\n//let writeEmpty = writeEmpty = function writeEmpty(stt) {\r\n//}\r\n\r\nclass StructStaticArrayField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    if (type.data.size === undefined) {\r\n      throw new Error(\"type.data.size was undefined\");\r\n    }\r\n\r\n    let itername = type.data.iname;\r\n\r\n    if (val === undefined || !val.length) {\r\n      this.packNull(manager, data, field, type);\r\n      return;\r\n    }\r\n\r\n    for (let i = 0; i < type.data.size; i++) {\r\n      let i2 = Math.min(i, Math.min(val.length - 1, type.data.size));\r\n      let val2 = val[i2];\r\n\r\n      //*\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        let env = _ws_env$1;\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n      }\r\n\r\n      do_pack(manager, data, val2, val, field, type.data.type);\r\n    }\r\n  }\r\n\r\n  static useHelperJS(field) {\r\n    return !field.type.data.iname;\r\n  }\r\n\r\n  static validateJSON() {\r\n    return StructArrayField.validateJSON(...arguments);\r\n  }\r\n\r\n  static fromJSON() {\r\n    return StructArrayField.fromJSON(...arguments);\r\n  }\r\n\r\n  static formatJSON(manager, val, obj, field, type, instance, tlvl) {\r\n    return formatArrayJson(manager, val, obj, field, type, type.data.type, instance, tlvl, list(val));\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    let size = type.data.size;\r\n    for (let i = 0; i < size; i++) {\r\n      packNull(manager, data, field, type.data.type);\r\n    }\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    return StructArrayField.toJSON(...arguments);\r\n  }\r\n\r\n  static format(type) {\r\n    let type2 = StructFieldTypeMap[type.data.type.type].format(type.data.type);\r\n\r\n    let ret = `static_array[${type2}, ${type.data.size}`;\r\n\r\n    if (type.data.iname) {\r\n      ret += `, ${type.data.iname}`;\r\n    }\r\n    ret += `]`;\r\n\r\n    return ret;\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, ret) {\r\n    packer_debug$1(\"-size: \" + type.data.size);\r\n\r\n    ret.length = 0;\r\n\r\n    for (let i = 0; i < type.data.size; i++) {\r\n      ret.push(unpack_field(manager, data, type.data.type, uctx));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    packer_debug$1(\"-size: \" + type.data.size);\r\n\r\n    let ret = [];\r\n\r\n    for (let i = 0; i < type.data.size; i++) {\r\n      ret.push(unpack_field(manager, data, type.data.type, uctx));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.STATIC_ARRAY,\r\n      name: \"static_array\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructStaticArrayField);\r\n\r\nclass StructOptionalField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_int(data, val !== undefined && val !== null ? 1 : 0);\r\n    if (val !== undefined && val !== null) {\r\n      const fakeField = {...field};\r\n      fakeField.type = type.data;\r\n      do_pack(manager, data, val, obj, fakeField, type.data);\r\n    }\r\n  }\r\n\r\n  static fakeField(field, type) {\r\n    return {...field, type: type.data}\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance, _abstractKey) {\r\n    const fakeField = this.fakeField(field, type); \r\n    return val !== undefined && val !== null ? validateJSON$1(manager, val, obj, fakeField, type.data, undefined, _abstractKey) : true;\r\n  }\r\n\r\n\r\n  static fromJSON(manager, val, obj, field, type, instance) {\r\n    const fakeField = this.fakeField(field, type); \r\n    return val !== undefined && val !== null ? fromJSON(manager, val, obj, fakeField, type.data, undefined) : undefined;\r\n  }\r\n\r\n  static formatJSON(manager, val, obj, field, type, instance, tlvl) {\r\n    if (val !== undefined && val !== null) {\r\n      const fakeField = this.fakeField(field, type);   \r\n      return formatJSON$1(manager, item, val, fakeField, type.data, instance, tlvl + 1) \r\n    }\r\n    return 'null';\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    const fakeField = this.fakeField(field, type);\r\n    return val !== undefined && val !== null ? toJSON(manager, val, obj, fakeField, type.data) : null\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    pack_int(data, 0);\r\n  }\r\n\r\n  static format(type) {\r\n    return \"optional(\" + fmt_type(type.data) + \")\";\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, dest) {\r\n    let exists = unpack_int(data, uctx);\r\n\r\n    packer_debug$1(\"-int \" + id);\r\n    packer_debug$1(\"optional exists: \" + exists);\r\n\r\n    if (!exists) {\r\n      return\r\n    }\r\n\r\n    unpack_field(manager, data, type.data, uctx);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let exists = unpack_int(data, uctx);\r\n  \r\n    if (!exists) {\r\n      return undefined\r\n    }\r\n\r\n    return unpack_field(manager, data, type.data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.OPTIONAL,\r\n      name: \"optional\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructOptionalField);\n\nvar _sintern2 = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  _get_pack_debug: _get_pack_debug,\n  setWarningMode2: setWarningMode2,\n  setDebugMode2: setDebugMode2,\n  StructFieldTypes: StructFieldTypes,\n  StructFieldTypeMap: StructFieldTypeMap,\n  packNull: packNull,\n  toJSON: toJSON,\n  fromJSON: fromJSON,\n  formatJSON: formatJSON$1,\n  validateJSON: validateJSON$1,\n  do_pack: do_pack,\n  StructFieldType: StructFieldType,\n  formatArrayJson: formatArrayJson\n});\n\nvar structEval = eval;\r\n\r\nfunction setStructEval(val) {\r\n  structEval = val;\r\n}\n\nvar _struct_eval = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  get structEval () { return structEval; },\n  setStructEval: setStructEval\n});\n\nconst TokSymbol = Symbol(\"token-info\");\r\n\r\nfunction buildJSONParser() {\r\n  let tk = (name, re, func, example) => new tokdef(name, re, func, example);\r\n\r\n  let parse;\r\n\r\n  let nint = \"[+-]?[0-9]+\";\r\n  let nhex = \"[+-]?0x[0-9a-fA-F]+\";\r\n  let nfloat1 = \"[+-]?[0-9]+\\\\.[0-9]*\";\r\n  let nfloat2 = \"[+-]?[0-9]*\\\\.[0-9]+\";\r\n  let nfloat3 = \"[+-]?[0-9]+\\\\.[0-9]+\";\r\n  let nfloatexp = \"[+-]?[0-9]+\\\\.[0-9]+[eE][+-]?[0-9]+\";\r\n\r\n  let nfloat = `(${nfloat1})|(${nfloat2})|(${nfloatexp})`;\r\n  let num = `(${nint})|(${nfloat})|(${nhex})`;\r\n  let numre = new RegExp(num);\r\n\r\n  let numreTest = new RegExp(`(${num})$`);\r\n\r\n  //nfloat3 has to be its own regexp, the parser\r\n  //always chooses the token handler that parses the most input,\r\n  //and we don't want the partial 0. and .0 handles to split\r\n  //e.g. 3.5 into 3 and 0.5\r\n  nfloat3 = new RegExp(nfloat3);\r\n  nfloatexp = new RegExp(nfloatexp);\r\n\r\n  let tests = [\"1.234234\", \".23432\", \"-234.\", \"1e-17\", \"-0x23423ff\", \"+23423\", \"-4.263256414560601e-14\"];\r\n  for (let test of tests) {\r\n    if (!numreTest.test(test)) {\r\n      console.error(\"Error! Number regexp failed:\", test);\r\n    }\r\n  }\r\n\r\n  let tokens = [\r\n    tk(\"BOOL\", /true|false/),\r\n    tk(\"WS\", /[ \\r\\t\\n]/, t => undefined), //drop token\r\n    tk(\"STRLIT\", /[\"']/, t => {\r\n      let lex = t.lexer;\r\n      let char = t.value;\r\n      let i = lex.lexpos;\r\n      let lexdata = lex.lexdata;\r\n\r\n      let escape = 0;\r\n      t.value = \"\";\r\n      let prev;\r\n\r\n      while (i < lexdata.length) {\r\n        let c = lexdata[i];\r\n\r\n        t.value += c;\r\n\r\n        if (c === \"\\\\\") {\r\n          escape ^= true;\r\n        } else if (!escape && c === char) {\r\n          break;\r\n        } else {\r\n          escape = false;\r\n        }\r\n\r\n        i++;\r\n      }\r\n\r\n      lex.lexpos = i + 1;\r\n\r\n      if (t.value.length > 0) {\r\n        t.value = t.value.slice(0, t.value.length - 1);\r\n      }\r\n\r\n      return t;\r\n    }),\r\n    tk(\"LSBRACKET\", /\\[/),\r\n    tk(\"RSBRACKET\", /]/),\r\n    tk(\"LBRACE\", /{/),\r\n    tk(\"RBRACE\", /}/),\r\n    tk(\"NULL\", /null/),\r\n    tk(\"COMMA\", /,/),\r\n    tk(\"COLON\", /:/),\r\n    tk(\"NUM\", numre, t => (t.value = parseFloat(t.value), t)),\r\n    tk(\"NUM\", nfloat3, t => (t.value = parseFloat(t.value), t)),\r\n    tk(\"NUM\", nfloatexp, t => (t.value = parseFloat(t.value), t)),\r\n  ];\r\n\r\n  function tokinfo(t) {\r\n    return {\r\n      lexpos: t.lexpos,\r\n      lineno: t.lineno,\r\n      col   : t.col,\r\n      fields: {},\r\n    };\r\n  }\r\n\r\n  function p_Array(p) {\r\n    p.expect(\"LSBRACKET\");\r\n    let t = p.peeknext();\r\n    let first = true;\r\n\r\n    let ret = [];\r\n\r\n    ret[TokSymbol] = tokinfo(t);\r\n\r\n    while (t && t.type !== \"RSBRACKET\") {\r\n      if (!first) {\r\n        p.expect(\"COMMA\");\r\n      }\r\n\r\n      ret[TokSymbol].fields[ret.length] = tokinfo(t);\r\n      ret.push(p_Start(p));\r\n\r\n      first = false;\r\n      t = p.peeknext();\r\n    }\r\n    p.expect(\"RSBRACKET\");\r\n\r\n    return ret;\r\n  }\r\n\r\n  function p_Object(p) {\r\n    p.expect(\"LBRACE\");\r\n\r\n    let obj = {};\r\n\r\n    let first = true;\r\n    let t = p.peeknext();\r\n\r\n    obj[TokSymbol] = tokinfo(t);\r\n    while (t && t.type !== \"RBRACE\") {\r\n      if (!first) {\r\n        p.expect(\"COMMA\");\r\n      }\r\n\r\n      let key = p.expect(\"STRLIT\");\r\n      p.expect(\"COLON\");\r\n\r\n      let val = p_Start(p, true);\r\n\r\n      obj[key] = val;\r\n      first = false;\r\n\r\n      t = p.peeknext();\r\n      obj[TokSymbol].fields[key] = tokinfo(t);\r\n    }\r\n\r\n    p.expect(\"RBRACE\");\r\n\r\n    return obj;\r\n  }\r\n\r\n  function p_Start(p, throwError = true) {\r\n    let t = p.peeknext();\r\n    if (t.type === \"LSBRACKET\") {\r\n      return p_Array(p);\r\n    } else if (t.type === \"LBRACE\") {\r\n      return p_Object(p);\r\n    } else if (t.type === \"STRLIT\" || t.type === \"NUM\" || t.type === \"NULL\" || t.type === \"BOOL\") {\r\n      return p.next().value;\r\n    } else {\r\n      p.error(t, \"Unknown token\");\r\n    }\r\n  }\r\n\r\n  function p_Error(token, msg) {\r\n    throw new PUTIL_ParseError(\"Parse Error\");\r\n  }\r\n\r\n  let lex = new lexer(tokens);\r\n  lex.linestart = 0;\r\n  parse = new parser(lex, p_Error);\r\n  parse.start = p_Start;\r\n  //lex.printTokens = true;\r\n\r\n  return parse;\r\n}\r\n\r\nvar jsonParser = buildJSONParser();\r\n\r\n/*\r\nbuildJSONParser().parse(`\r\n{\r\n                \"alteredX\": -110.95731659202336,\r\n                \"alteredY\": -359.9154922611667,\r\n                \"alteredZ\": -4.263256414560601e-14\r\n}\r\n`.trim()) //*/\r\n\r\nfunction printContext(buf, tokinfo, printColors=true) {\r\n  let lines = buf.split(\"\\n\");\r\n\r\n  if (!tokinfo) {\r\n    return '';\r\n  }\r\n\r\n  let lineno = tokinfo.lineno;\r\n  let col = tokinfo.col;\r\n\r\n  let istart = Math.max(lineno-50, 0);\r\n  let iend = Math.min(lineno+2, lines.length-1);\r\n\r\n  let s = '';\r\n\r\n  if (printColors) {\r\n    s += termColor(\"  /* pretty-printed json */\\n\", \"blue\");\r\n  } else {\r\n    s += \"/* pretty-printed json */\\n\";\r\n  }\r\n\r\n  for (let i=istart; i<iend; i++) {\r\n    let l = lines[i];\r\n\r\n    let idx = \"\" + i;\r\n    while (idx.length < 3) {\r\n      idx = \" \" + idx;\r\n    }\r\n\r\n    if (i === lineno && printColors) {\r\n      s += termColor(`${idx}: ${l}\\n`, \"yellow\");\r\n    } else {\r\n      s += `${idx}: ${l}\\n`;\r\n    }\r\n\r\n    if (i === lineno) {\r\n      let l2 = '';\r\n      for (let j=0; j<col+5; j++) {\r\n        l2 += \" \";\r\n      }\r\n\r\n      s += l2 + \"^\\n\";\r\n    }\r\n  }\r\n\r\n  return s;\r\n}\n\nvar nGlobal;\r\n\r\nif (typeof globalThis !== \"undefined\") {\r\n  nGlobal = globalThis;\r\n} else if (typeof window !== \"undefined\") {\r\n  nGlobal = window;\r\n} else if (typeof global !== \"undefined\") {\r\n  nGlobal = global;\r\n} else if (typeof globals !== \"undefined\") {\r\n  nGlobal = globals;\r\n} else if (typeof self !== \"undefined\") {\r\n  nGlobal = self;\r\n}\r\n\r\nconst DEBUG = {};\r\n\r\nfunction updateDEBUG() {\r\n  for (let k in Object.keys(DEBUG)) {\r\n    delete DEBUG[k];\r\n  }\r\n\r\n  if (typeof nGlobal.DEBUG === \"object\") {\r\n    for (let k in nGlobal.DEBUG) {\r\n      DEBUG[k] = nGlobal.DEBUG[k];\r\n    }\r\n  }\r\n}\n\n\"use strict\";\r\n\r\n//needed to avoid a rollup bug in configurable mode\r\nvar sintern2 = _sintern2;\r\nvar struct_eval = _struct_eval;\r\n\r\nlet warninglvl = 2;\r\n\r\nvar truncateDollarSign$1 = true;\r\nvar manager;\r\n\r\nclass JSONError extends Error {};\r\n\r\nfunction printCodeLines(code) {\r\n  let lines = code.split(String.fromCharCode(10));\r\n  let buf = '';\r\n\r\n  for (let i = 0; i < lines.length; i++) {\r\n    let line = \"\" + (i + 1) + \":\";\r\n\r\n    while (line.length < 3) {\r\n      line += \" \";\r\n    }\r\n\r\n    line += \" \" + lines[i];\r\n    buf += line + String.fromCharCode(10);\r\n  }\r\n\r\n  return buf;\r\n}\r\n\r\nfunction printEvalError(code) {\r\n  console.log(\"== CODE ==\");\r\n  console.log(printCodeLines(code));\r\n\r\n  /* Node suppresses the real error line number in error.stack for some reason.\r\n   * Get it by retriggering the error for real.\r\n   */\r\n  eval(code);\r\n}\r\n\r\nfunction setTruncateDollarSign(v) {\r\n  truncateDollarSign$1 = !!v;\r\n}\r\n\r\nfunction _truncateDollarSign(s) {\r\n  let i = s.search(\"$\");\r\n\r\n  if (i > 0) {\r\n    return s.slice(0, i).trim();\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nfunction unmangle(name) {\r\n  if (truncateDollarSign$1) {\r\n    return _truncateDollarSign(name);\r\n  } else {\r\n    return name;\r\n  }\r\n}\r\n\r\nlet _static_envcode_null = \"\";\r\n\r\n//truncate webpack-mangled names\r\n\r\nfunction gen_tabstr(tot) {\r\n  let ret = \"\";\r\n\r\n  for (let i = 0; i < tot; i++) {\r\n    ret += \" \";\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nlet packer_debug, packer_debug_start, packer_debug_end;\r\n\r\nfunction update_debug_data() {\r\n  let ret = _get_pack_debug();\r\n\r\n  packer_debug = ret.packer_debug;\r\n  packer_debug_start = ret.packer_debug_start;\r\n  packer_debug_end = ret.packer_debug_end;\r\n  warninglvl = ret.warninglvl;\r\n}\r\n\r\nupdate_debug_data();\r\n\r\nfunction setWarningMode(t) {\r\n  sintern2.setWarningMode2(t);\r\n\r\n  if (typeof t !== \"number\" || isNaN(t)) {\r\n    throw new Error(\"Expected a single number (>= 0) argument to setWarningMode\");\r\n  }\r\n\r\n  warninglvl = t;\r\n}\r\n\r\nfunction setDebugMode(t) {\r\n  sintern2.setDebugMode2(t);\r\n  update_debug_data();\r\n}\r\n\r\nlet _ws_env = [[undefined, undefined]];\r\n\r\nfunction define_empty_class(scls, name) {\r\n  let cls = function () {\r\n  };\r\n\r\n  cls.prototype = Object.create(Object.prototype);\r\n  cls.constructor = cls.prototype.constructor = cls;\r\n\r\n  let keywords = scls.keywords;\r\n\r\n  cls.STRUCT = name + \" {\\n  }\\n\";\r\n  cls.structName = name;\r\n\r\n  cls.prototype.loadSTRUCT = function (reader) {\r\n    reader(this);\r\n  };\r\n\r\n  cls.newSTRUCT = function () {\r\n    return new this();\r\n  };\r\n\r\n  return cls;\r\n}\r\n\r\nlet haveCodeGen;\r\n\r\n//$KEYWORD_CONFIG_START\r\n\r\nclass STRUCT {\r\n  constructor() {\r\n    this.idgen = 0;\r\n    this.allowOverriding = true;\r\n\r\n    this.structs = {};\r\n    this.struct_cls = {};\r\n    this.struct_ids = {};\r\n\r\n    this.compiled_code = {};\r\n    this.null_natives = {};\r\n\r\n    this.define_null_native(\"Object\", Object);\r\n\r\n    this.jsonUseColors = true;\r\n    this.jsonBuf = '';\r\n    this.formatCtx = {};\r\n  }\r\n\r\n  static inherit(child, parent, structName = child.name) {\r\n    const keywords = this.keywords;\r\n\r\n    if (!parent.STRUCT) {\r\n      return structName + \"{\\n\";\r\n    }\r\n\r\n    let stt = struct_parse.parse(parent.STRUCT);\r\n    let code = structName + \"{\\n\";\r\n    code += STRUCT.fmt_struct(stt, true, false, true);\r\n    return code;\r\n  }\r\n\r\n  /** invoke loadSTRUCT methods on parent objects.  note that\r\n   reader() is only called once.  it is called however.*/\r\n  static Super(obj, reader) {\r\n    if (warninglvl > 0) {\r\n      console.warn(\"deprecated\");\r\n    }\r\n\r\n    reader(obj);\r\n\r\n    function reader2(obj) {\r\n    }\r\n\r\n    let cls = obj.constructor;\r\n    let bad = cls === undefined || cls.prototype === undefined || cls.prototype.__proto__ === undefined;\r\n\r\n    if (bad) {\r\n      return;\r\n    }\r\n\r\n    let parent = cls.prototype.__proto__.constructor;\r\n    bad = bad || parent === undefined;\r\n\r\n    if (!bad && parent.prototype.loadSTRUCT && parent.prototype.loadSTRUCT !== obj.loadSTRUCT) { //parent.prototype.hasOwnProperty(\"loadSTRUCT\")) {\r\n      parent.prototype.loadSTRUCT.call(obj, reader2);\r\n    }\r\n  }\r\n\r\n  /** deprecated.  used with old fromSTRUCT interface. */\r\n  static chain_fromSTRUCT(cls, reader) {\r\n    if (warninglvl > 0) {\r\n      console.warn(\"Using deprecated (and evil) chain_fromSTRUCT method, eek!\");\r\n    }\r\n\r\n    let proto = cls.prototype;\r\n    let parent = cls.prototype.prototype.constructor;\r\n\r\n    let obj = parent.fromSTRUCT(reader);\r\n    let obj2 = new cls();\r\n\r\n    let keys = Object.keys(obj).concat(Object.getOwnPropertySymbols(obj));\r\n    //let keys=Object.keys(proto);\r\n\r\n    for (let i = 0; i < keys.length; i++) {\r\n      let k = keys[i];\r\n\r\n      try {\r\n        obj2[k] = obj[k];\r\n      } catch (error) {\r\n        if (warninglvl > 0) {\r\n          console.warn(\"  failed to set property\", k);\r\n        }\r\n      }\r\n      //let k=keys[i];\r\n      //if (k==\"__proto__\")\r\n      // continue;\r\n      //obj[k] = proto[k];\r\n    }\r\n\r\n    /*\r\n    if (proto.toString !== Object.prototype.toString)\r\n      obj2.toString = proto.toString;\r\n    //*/\r\n\r\n    return obj2;\r\n  }\r\n\r\n  //defined_classes is an array of class constructors\r\n  //with STRUCT scripts, *OR* another STRUCT instance\r\n  //\r\n\r\n  static formatStruct(stt, internal_only, no_helper_js) {\r\n    return this.fmt_struct(stt, internal_only, no_helper_js);\r\n  }\r\n\r\n  static fmt_struct(stt, internal_only, no_helper_js, addComments) {\r\n    if (internal_only === undefined)\r\n      internal_only = false;\r\n    if (no_helper_js === undefined)\r\n      no_helper_js = false;\r\n\r\n    let s = \"\";\r\n    if (!internal_only) {\r\n      s += stt.name;\r\n      if (stt.id !== -1)\r\n        s += \" id=\" + stt.id;\r\n      s += \" {\\n\";\r\n    }\r\n    let tab = \"  \";\r\n\r\n    function fmt_type(type) {\r\n      return StructFieldTypeMap[type.type].format(type);\r\n\r\n      if (type.type === StructEnum.ARRAY || type.type === StructEnum.ITER || type.type === StructEnum.ITERKEYS) {\r\n        if (type.data.iname !== \"\" && type.data.iname !== undefined) {\r\n          return \"array(\" + type.data.iname + \", \" + fmt_type(type.data.type) + \")\";\r\n        } else {\r\n          return \"array(\" + fmt_type(type.data.type) + \")\";\r\n        }\r\n      } else if (type.type === StructEnum.STATIC_STRING) {\r\n        return \"static_string[\" + type.data.maxlength + \"]\";\r\n      } else if (type.type === StructEnum.STRUCT) {\r\n        return type.data;\r\n      } else if (type.type === StructEnum.TSTRUCT) {\r\n        return \"abstract(\" + type.data + \")\";\r\n      } else {\r\n        return StructTypeMap[type.type];\r\n      }\r\n    }\r\n\r\n    let fields = stt.fields;\r\n    for (let i = 0; i < fields.length; i++) {\r\n      let f = fields[i];\r\n      s += tab + f.name + \" : \" + fmt_type(f.type);\r\n      if (!no_helper_js && f.get !== undefined) {\r\n        s += \" | \" + f.get.trim();\r\n      }\r\n      s += \";\";\r\n\r\n      if (addComments && f.comment.trim()) {\r\n        s += f.comment.trim();\r\n      }\r\n\r\n      s += \"\\n\";\r\n    }\r\n    if (!internal_only)\r\n      s += \"}\";\r\n    return s;\r\n  }\r\n\r\n  static setClassKeyword(keyword, nameKeyword = undefined) {\r\n    if (!nameKeyword) {\r\n      nameKeyword = keyword.toLowerCase() + \"Name\";\r\n    }\r\n\r\n    this.keywords = {\r\n      script: keyword,\r\n      name  : nameKeyword,\r\n      load  : \"load\" + keyword,\r\n      new   : \"new\" + keyword,\r\n      after : \"after\" + keyword,\r\n      from  : \"from\" + keyword\r\n    };\r\n  }\r\n\r\n  define_null_native(name, cls) {\r\n    const keywords = this.constructor.keywords;\r\n    let obj = define_empty_class(this.constructor, name);\r\n\r\n    let stt = struct_parse.parse(obj.STRUCT);\r\n\r\n    stt.id = this.idgen++;\r\n\r\n    this.structs[name] = stt;\r\n    this.struct_cls[name] = cls;\r\n    this.struct_ids[stt.id] = stt;\r\n\r\n    this.null_natives[name] = 1;\r\n  }\r\n\r\n  validateStructs(onerror) {\r\n    function getType(type) {\r\n      switch (type.type) {\r\n        case StructEnum.ITERKEYS:\r\n        case StructEnum.ITER:\r\n        case StructEnum.STATIC_ARRAY:\r\n        case StructEnum.ARRAY:\r\n          return getType(type.data.type);\r\n        case StructEnum.TSTRUCT:\r\n          return type;\r\n        case StructEnum.STRUCT:\r\n        default:\r\n          return type;\r\n      }\r\n    }\r\n\r\n    function formatType(type) {\r\n      let ret = {};\r\n\r\n      ret.type = type.type;\r\n\r\n      if (typeof ret.type === \"number\") {\r\n        for (let k in StructEnum) {\r\n          if (StructEnum[k] === ret.type) {\r\n            ret.type = k;\r\n            break;\r\n          }\r\n        }\r\n      } else if (typeof ret.type === \"object\") {\r\n        ret.type = formatType(ret.type);\r\n      }\r\n\r\n      if (typeof type.data === \"object\") {\r\n        ret.data = formatType(type.data);\r\n      } else {\r\n        ret.data = type.data;\r\n      }\r\n\r\n      return ret;\r\n    }\r\n\r\n    function throwError(stt, field, msg) {\r\n      let buf = STRUCT.formatStruct(stt);\r\n\r\n      console.error(buf + \"\\n\\n\" + msg);\r\n\r\n      if (onerror) {\r\n        onerror(msg, stt, field);\r\n      } else {\r\n        throw new Error(msg);\r\n      }\r\n    }\r\n\r\n    for (let k in this.structs) {\r\n      let stt = this.structs[k];\r\n\r\n      for (let field of stt.fields) {\r\n        if (field.name === \"this\") {\r\n          let type = field.type.type;\r\n\r\n          if (ValueTypes.has(type)) {\r\n            throwError(stt, field, \"'this' cannot be used with value types\");\r\n          }\r\n        }\r\n\r\n        let type = getType(field.type);\r\n\r\n        if (type.type !== StructEnum.STRUCT && type.type !== StructEnum.TSTRUCT) {\r\n          continue;\r\n        }\r\n\r\n        if (!(type.data in this.structs)) {\r\n          let msg = stt.name + \":\" + field.name + \": Unknown struct \" + type.data + \".\";\r\n          throwError(stt, field, msg);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  forEach(func, thisvar) {\r\n    for (let k in this.structs) {\r\n      let stt = this.structs[k];\r\n\r\n      if (thisvar !== undefined)\r\n        func.call(thisvar, stt);\r\n      else\r\n        func(stt);\r\n    }\r\n  }\r\n\r\n  //defaults to structjs.manager\r\n  parse_structs(buf, defined_classes) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    if (defined_classes === undefined) {\r\n      defined_classes = manager;\r\n    }\r\n\r\n    if (defined_classes instanceof STRUCT) {\r\n      let struct2 = defined_classes;\r\n      defined_classes = [];\r\n\r\n      for (let k in struct2.struct_cls) {\r\n        defined_classes.push(struct2.struct_cls[k]);\r\n      }\r\n    }\r\n\r\n    if (defined_classes === undefined) {\r\n      defined_classes = [];\r\n\r\n      for (let k in manager.struct_cls) {\r\n        defined_classes.push(manager.struct_cls[k]);\r\n      }\r\n    }\r\n\r\n    let clsmap = {};\r\n\r\n    for (let i = 0; i < defined_classes.length; i++) {\r\n      let cls = defined_classes[i];\r\n\r\n      if (!cls.structName && cls.STRUCT) {\r\n        let stt = struct_parse.parse(cls.STRUCT.trim());\r\n        cls.structName = stt.name;\r\n      } else if (!cls.structName && cls.name !== \"Object\") {\r\n        if (warninglvl > 0)\r\n          console.log(\"Warning, bad class in registered class list\", unmangle(cls.name), cls);\r\n        continue;\r\n      }\r\n\r\n      clsmap[cls.structName] = defined_classes[i];\r\n    }\r\n\r\n    struct_parse.input(buf);\r\n\r\n    while (!struct_parse.at_end()) {\r\n      let stt = struct_parse.parse(undefined, false);\r\n\r\n      if (!(stt.name in clsmap)) {\r\n        if (!(stt.name in this.null_natives))\r\n          if (warninglvl > 0)\r\n            console.log(\"WARNING: struct \" + stt.name + \" is missing from class list.\");\r\n\r\n        let dummy = define_empty_class(this.constructor, stt.name);\r\n\r\n        dummy.STRUCT = STRUCT.fmt_struct(stt);\r\n        dummy.structName = stt.name;\r\n\r\n        dummy.prototype.structName = dummy.name;\r\n\r\n        this.struct_cls[dummy.structName] = dummy;\r\n        this.structs[dummy.structName] = stt;\r\n\r\n        if (stt.id !== -1)\r\n          this.struct_ids[stt.id] = stt;\r\n      } else {\r\n        this.struct_cls[stt.name] = clsmap[stt.name];\r\n        this.structs[stt.name] = stt;\r\n\r\n        if (stt.id !== -1)\r\n          this.struct_ids[stt.id] = stt;\r\n      }\r\n\r\n      let tok = struct_parse.peek();\r\n      while (tok && (tok.value === \"\\n\" || tok.value === \"\\r\" || tok.value === \"\\t\" || tok.value === \" \")) {\r\n        tok = struct_parse.peek();\r\n      }\r\n    }\r\n  }\r\n\r\n  /** adds all structs referenced by cls inside of srcSTRUCT\r\n   *  to this */\r\n  registerGraph(srcSTRUCT, cls) {\r\n    if (!cls.structName) {\r\n      console.warn(\"class was not in srcSTRUCT\");\r\n      return this.register(cls);\r\n    }\r\n\r\n    let recStruct;\r\n\r\n    let recArray = (t) => {\r\n      switch (t.type) {\r\n        case StructEnum.ARRAY:\r\n          return recArray(t.data.type);\r\n        case StructEnum.ITERKEYS:\r\n          return recArray(t.data.type);\r\n        case StructEnum.STATIC_ARRAY:\r\n          return recArray(t.data.type);\r\n        case StructEnum.ITER:\r\n          return recArray(t.data.type);\r\n        case StructEnum.STRUCT:\r\n        case StructEnum.TSTRUCT: {\r\n          let st = srcSTRUCT.structs[t.data];\r\n          let cls = srcSTRUCT.struct_cls[st.name];\r\n\r\n          return recStruct(st, cls);\r\n        }\r\n      }\r\n    };\r\n\r\n    recStruct = (st, cls) => {\r\n      if (!(cls.structName in this.structs)) {\r\n        this.add_class(cls, cls.structName);\r\n      }\r\n\r\n      for (let f of st.fields) {\r\n        if (f.type.type === StructEnum.STRUCT || f.type.type === StructEnum.TSTRUCT) {\r\n          let st2 = srcSTRUCT.structs[f.type.data];\r\n          let cls2 = srcSTRUCT.struct_cls[st2.name];\r\n\r\n          recStruct(st2, cls2);\r\n        } else if (f.type.type === StructEnum.ARRAY) {\r\n          recArray(f.type);\r\n        } else if (f.type.type === StructEnum.ITER) {\r\n          recArray(f.type);\r\n        } else if (f.type.type === StructEnum.ITERKEYS) {\r\n          recArray(f.type);\r\n        } else if (f.type.type === StructEnum.STATIC_ARRAY) {\r\n          recArray(f.type);\r\n        }\r\n      }\r\n    };\r\n\r\n    let st = srcSTRUCT.structs[cls.structName];\r\n    recStruct(st, cls);\r\n  }\r\n\r\n  mergeScripts(child, parent) {\r\n    let stc = struct_parse.parse(child.trim());\r\n    let stp = struct_parse.parse(parent.trim());\r\n\r\n    let fieldset = new Set();\r\n\r\n    for (let f of stc.fields) {\r\n      fieldset.add(f.name);\r\n    }\r\n\r\n    let fields = [];\r\n    for (let f of stp.fields) {\r\n      if (!fieldset.has(f.name)) {\r\n        fields.push(f);\r\n      }\r\n    }\r\n\r\n    stc.fields = fields.concat(stc.fields);\r\n    return STRUCT.fmt_struct(stc, false, false);\r\n  }\r\n\r\n  inlineRegister(cls, structScript) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    let p = cls.__proto__;\r\n    while (p && p !== Object) {\r\n      if (p.hasOwnProperty(keywords.script)) {\r\n        structScript = this.mergeScripts(structScript, p.STRUCT);\r\n        break\r\n      }\r\n      p = p.__proto__;\r\n    }\r\n\r\n    cls.STRUCT = structScript;\r\n    this.register(cls);\r\n    return structScript;\r\n  }\r\n\r\n  register(cls, structName) {\r\n    return this.add_class(cls, structName);\r\n  }\r\n\r\n  unregister(cls) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    if (!cls || !cls.structName || !(cls.structName in this.struct_cls)) {\r\n      console.warn(\"Class not registered with nstructjs\", cls);\r\n      return;\r\n    }\r\n\r\n\r\n    let st = this.structs[cls.structName];\r\n\r\n    delete this.structs[cls.structName];\r\n    delete this.struct_cls[cls.structName];\r\n    delete this.struct_ids[st.id];\r\n  }\r\n\r\n  add_class(cls, structName) {\r\n    //do not register Object\r\n    if (cls === Object) {\r\n      return;\r\n    }\r\n\r\n    const keywords = this.constructor.keywords;\r\n    if (cls.STRUCT) {\r\n      let bad = false;\r\n\r\n      let p = cls;\r\n      while (p) {\r\n        p = p.__proto__;\r\n\r\n        if (p && p.STRUCT && p.STRUCT === cls.STRUCT) {\r\n          bad = true;\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (bad) {\r\n        if (warninglvl > 0) {\r\n          console.warn(\"Generating \" + keywords.script + \" script for derived class \" + unmangle(cls.name));\r\n        }\r\n\r\n        if (!structName) {\r\n          structName = unmangle(cls.name);\r\n        }\r\n\r\n        cls.STRUCT = STRUCT.inherit(cls, p) + \"\\n}\";\r\n      }\r\n    }\r\n\r\n    if (!cls.STRUCT) {\r\n      throw new Error(\"class \" + unmangle(cls.name) + \" has no \" + keywords.script + \" script\");\r\n    }\r\n\r\n    let stt = struct_parse.parse(cls.STRUCT);\r\n\r\n    stt.name = unmangle(stt.name);\r\n\r\n    cls.structName = stt.name;\r\n\r\n    //create default newSTRUCT\r\n    if (cls.newSTRUCT === undefined) {\r\n      cls.newSTRUCT = function () {\r\n        return new this();\r\n      };\r\n    }\r\n\r\n    if (structName !== undefined) {\r\n      stt.name = cls.structName = structName;\r\n    } else if (cls.structName === undefined) {\r\n      cls.structName = stt.name;\r\n    } else {\r\n      stt.name = cls.structName;\r\n    }\r\n\r\n    if (cls.structName in this.structs) {\r\n      if (warninglvl > 0) {\r\n        console.warn(\"Struct \" + unmangle(cls.structName) + \" is already registered\", cls);\r\n      }\r\n\r\n      if (!this.allowOverriding) {\r\n        throw new Error(\"Struct \" + unmangle(cls.structName) + \" is already registered\");\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    if (stt.id === -1)\r\n      stt.id = this.idgen++;\r\n\r\n    this.structs[cls.structName] = stt;\r\n    this.struct_cls[cls.structName] = cls;\r\n    this.struct_ids[stt.id] = stt;\r\n  }\r\n\r\n  isRegistered(cls) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    if (!cls.hasOwnProperty(\"structName\")) {\r\n      return false;\r\n    }\r\n\r\n    return cls === this.struct_cls[cls.structName];\r\n  }\r\n\r\n  get_struct_id(id) {\r\n    return this.struct_ids[id];\r\n  }\r\n\r\n  get_struct(name) {\r\n    if (!(name in this.structs)) {\r\n      console.warn(\"Unknown struct\", name);\r\n      throw new Error(\"Unknown struct \" + name);\r\n    }\r\n    return this.structs[name];\r\n  }\r\n\r\n  get_struct_cls(name) {\r\n    if (!(name in this.struct_cls)) {\r\n      console.trace();\r\n      throw new Error(\"Unknown struct \" + name);\r\n    }\r\n    return this.struct_cls[name];\r\n  }\r\n\r\n  _env_call(code, obj, env) {\r\n    let envcode = _static_envcode_null;\r\n    if (env !== undefined) {\r\n      envcode = \"\";\r\n      for (let i = 0; i < env.length; i++) {\r\n        envcode = \"let \" + env[i][0] + \" = env[\" + i.toString() + \"][1];\\n\" + envcode;\r\n      }\r\n    }\r\n    let fullcode = \"\";\r\n    if (envcode !== _static_envcode_null)\r\n      fullcode = envcode + code;\r\n    else\r\n      fullcode = code;\r\n    let func;\r\n\r\n    //fullcode = fullcode.replace(/\\bthis\\b/, \"obj\");\r\n\r\n    if (!(fullcode in this.compiled_code)) {\r\n      let code2 = \"func = function(obj, env) { \" + envcode + \"return \" + code + \"}\";\r\n      try {\r\n        func = struct_eval.structEval(code2);\r\n      } catch (err) {\r\n        console.warn(err.stack);\r\n\r\n        console.warn(code2);\r\n        console.warn(\" \");\r\n        throw err;\r\n      }\r\n      this.compiled_code[fullcode] = func;\r\n    } else {\r\n      func = this.compiled_code[fullcode];\r\n    }\r\n    try {\r\n      return func.call(obj, obj, env);\r\n    } catch (err) {\r\n      console.warn(err.stack);\r\n\r\n      let code2 = \"func = function(obj, env) { \" + envcode + \"return \" + code + \"}\";\r\n      console.warn(code2);\r\n      console.warn(\" \");\r\n      throw err;\r\n    }\r\n  }\r\n\r\n  write_struct(data, obj, stt) {\r\n    function use_helper_js(field) {\r\n      let type = field.type.type;\r\n      let cls = StructFieldTypeMap[type];\r\n      return cls.useHelperJS(field);\r\n    }\r\n\r\n    let fields = stt.fields;\r\n    let thestruct = this;\r\n    for (let i = 0; i < fields.length; i++) {\r\n      let f = fields[i];\r\n      let t1 = f.type;\r\n      let t2 = t1.type;\r\n\r\n      if (use_helper_js(f)) {\r\n        let val;\r\n        let type = t2;\r\n        if (f.get !== undefined) {\r\n          val = thestruct._env_call(f.get, obj);\r\n        } else {\r\n          val = f.name === \"this\" ? obj : obj[f.name];\r\n        }\r\n\r\n        if (DEBUG.tinyeval) {\r\n          console.log(\"\\n\\n\\n\", f.get, \"Helper JS Ret\", val, \"\\n\\n\\n\");\r\n        }\r\n\r\n        sintern2.do_pack(this, data, val, obj, f, t1);\r\n      } else {\r\n        let val = f.name === \"this\" ? obj : obj[f.name];\r\n        sintern2.do_pack(this, data, val, obj, f, t1);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   @param data : array to write data into,\r\n   @param obj  : structable object\r\n   */\r\n  write_object(data, obj) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    let cls = obj.constructor.structName;\r\n    let stt = this.get_struct(cls);\r\n\r\n    if (data === undefined) {\r\n      data = [];\r\n    }\r\n\r\n    this.write_struct(data, obj, stt);\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   Read an object from binary data\r\n\r\n   @param data : DataView or Uint8Array instance\r\n   @param cls_or_struct_id : Structable class\r\n   @param uctx : internal parameter\r\n   @return {cls_or_struct_id} Instance of cls_or_struct_id\r\n   */\r\n  readObject(data, cls_or_struct_id, uctx) {\r\n    if (data instanceof Uint8Array || data instanceof Uint8ClampedArray) {\r\n      data = new DataView(data.buffer);\r\n    } else if (data instanceof Array) {\r\n      data = new DataView(new Uint8Array(data).buffer);\r\n    }\r\n\r\n    return this.read_object(data, cls_or_struct_id, uctx);\r\n  }\r\n\r\n  /**\r\n   @param data array to write data into,\r\n   @param obj structable object\r\n   */\r\n  writeObject(data, obj) {\r\n    return this.write_object(data, obj);\r\n  }\r\n\r\n  writeJSON(obj, stt = undefined) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    let cls = obj.constructor;\r\n    stt = stt || this.get_struct(cls.structName);\r\n\r\n    function use_helper_js(field) {\r\n      let type = field.type.type;\r\n      let cls = StructFieldTypeMap[type];\r\n      return cls.useHelperJS(field);\r\n    }\r\n\r\n    let toJSON = sintern2.toJSON;\r\n\r\n    let fields = stt.fields;\r\n    let thestruct = this;\r\n    let json = {};\r\n\r\n    for (let i = 0; i < fields.length; i++) {\r\n      let f = fields[i];\r\n      let val;\r\n      let t1 = f.type;\r\n\r\n      let json2;\r\n\r\n      if (use_helper_js(f)) {\r\n        if (f.get !== undefined) {\r\n          val = thestruct._env_call(f.get, obj);\r\n        } else {\r\n          val = f.name === \"this\" ? obj : obj[f.name];\r\n        }\r\n\r\n        if (DEBUG.tinyeval) {\r\n          console.log(\"\\n\\n\\n\", f.get, \"Helper JS Ret\", val, \"\\n\\n\\n\");\r\n        }\r\n\r\n        json2 = toJSON(this, val, obj, f, t1);\r\n      } else {\r\n        val = f.name === \"this\" ? obj : obj[f.name];\r\n        json2 = toJSON(this, val, obj, f, t1);\r\n      }\r\n\r\n      if (f.name !== 'this') {\r\n        json[f.name] = json2;\r\n      } else { //f.name was 'this'?\r\n        let isArray = Array.isArray(json2);\r\n        isArray = isArray || f.type.type === StructTypes.ARRAY;\r\n        isArray = isArray || f.type.type === StructTypes.STATIC_ARRAY;\r\n\r\n        if (isArray) {\r\n          json.length = json2.length;\r\n\r\n          for (let i = 0; i < json2.length; i++) {\r\n            json[i] = json2[i];\r\n          }\r\n        } else {\r\n          Object.assign(json, json2);\r\n        }\r\n      }\r\n    }\r\n\r\n    return json;\r\n  }\r\n\r\n  /**\r\n   @param data : DataView or Uint8Array instance\r\n   @param cls_or_struct_id : Structable class\r\n   @param uctx : internal parameter\r\n   */\r\n  read_object(data, cls_or_struct_id, uctx, objInstance) {\r\n    const keywords = this.constructor.keywords;\r\n    let cls, stt;\r\n\r\n    if (data instanceof Array) {\r\n      data = new DataView(new Uint8Array(data).buffer);\r\n    }\r\n\r\n    if (typeof cls_or_struct_id === \"number\") {\r\n      cls = this.struct_cls[this.struct_ids[cls_or_struct_id].name];\r\n    } else {\r\n      cls = cls_or_struct_id;\r\n    }\r\n\r\n    if (cls === undefined) {\r\n      throw new Error(\"bad cls_or_struct_id \" + cls_or_struct_id);\r\n    }\r\n\r\n    stt = this.structs[cls.structName];\r\n\r\n    if (uctx === undefined) {\r\n      uctx = new unpack_context();\r\n\r\n      packer_debug(\"\\n\\n=Begin reading \" + cls.structName + \"=\");\r\n    }\r\n    let thestruct = this;\r\n\r\n    let this2 = this;\r\n\r\n    function unpack_field(type) {\r\n      return StructFieldTypeMap[type.type].unpack(this2, data, type, uctx);\r\n    }\r\n\r\n    function unpack_into(type, dest) {\r\n      return StructFieldTypeMap[type.type].unpackInto(this2, data, type, uctx, dest);\r\n    }\r\n\r\n    let was_run = false;\r\n\r\n    function makeLoader(stt) {\r\n      return function load(obj) {\r\n        if (was_run) {\r\n          return;\r\n        }\r\n\r\n        was_run = true;\r\n\r\n        let fields = stt.fields;\r\n        let flen = fields.length;\r\n\r\n        for (let i = 0; i < flen; i++) {\r\n          let f = fields[i];\r\n\r\n          if (f.name === 'this') {\r\n            //load data into obj directly\r\n            unpack_into(f.type, obj);\r\n          } else {\r\n            obj[f.name] = unpack_field(f.type);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    let load = makeLoader(stt);\r\n\r\n    if (cls.prototype.loadSTRUCT !== undefined) {\r\n      let obj = objInstance;\r\n\r\n      if (!obj && cls.newSTRUCT !== undefined) {\r\n        obj = cls.newSTRUCT(load);\r\n      } else if (!obj) {\r\n        obj = new cls();\r\n      }\r\n\r\n      obj.loadSTRUCT(load);\r\n\r\n      if (!was_run) {\r\n        console.warn(\"\" + cls.structName + \".prototype.loadSTRUCT() did not execute its loader callback!\");\r\n        load(obj);\r\n      }\r\n\r\n      return obj;\r\n    } else if (cls.fromSTRUCT !== undefined) {\r\n      if (warninglvl > 1) {\r\n        console.warn(\"Warning: class \" + unmangle(cls.name) + \" is using deprecated fromSTRUCT interface; use newSTRUCT/loadSTRUCT instead\");\r\n      }\r\n\r\n      return cls.fromSTRUCT(load);\r\n    } else { //default case, make new instance and then call load() on it\r\n      let obj = objInstance;\r\n\r\n      if (!obj && cls.newSTRUCT !== undefined) {\r\n        obj = cls.newSTRUCT(load);\r\n      } else if (!obj) {\r\n        obj = new cls();\r\n      }\r\n\r\n      load(obj);\r\n\r\n      return obj;\r\n    }\r\n  }\r\n\r\n  validateJSON(json, cls_or_struct_id, useInternalParser = true, useColors = true, consoleLogger = function () {\r\n    console.log(...arguments);\r\n  }, _abstractKey                                        = \"_structName\") {\r\n    if (cls_or_struct_id === undefined) {\r\n      throw new Error(this.constructor.name + \".prototype.validateJSON: Expected at least two arguments\");\r\n    }\r\n\r\n    try {\r\n      json = JSON.stringify(json, undefined, 2);\r\n\r\n      this.jsonBuf = json;\r\n      this.jsonUseColors = useColors;\r\n      this.jsonLogger = consoleLogger;\r\n\r\n      //add token annotations\r\n      jsonParser.logger = this.jsonLogger;\r\n\r\n      if (useInternalParser) {\r\n        json = jsonParser.parse(json);\r\n      } else {\r\n        json = JSON.parse(json);\r\n      }\r\n\r\n      this.validateJSONIntern(json, cls_or_struct_id, _abstractKey);\r\n\r\n    } catch (error) {\r\n      if (!(error instanceof JSONError)) {\r\n        console.error(error.stack);\r\n      }\r\n\r\n      this.jsonLogger(error.message);\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  validateJSONIntern(json, cls_or_struct_id, _abstractKey = \"_structName\") {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    let cls, stt;\r\n\r\n    if (typeof cls_or_struct_id === \"number\") {\r\n      cls = this.struct_cls[this.struct_ids[cls_or_struct_id].name];\r\n    } else if (cls_or_struct_id instanceof NStruct) {\r\n      cls = this.get_struct_cls(cls_or_struct_id.name);\r\n    } else {\r\n      cls = cls_or_struct_id;\r\n    }\r\n\r\n    if (cls === undefined) {\r\n      throw new Error(\"bad cls_or_struct_id \" + cls_or_struct_id);\r\n    }\r\n\r\n    stt = this.structs[cls.structName];\r\n\r\n    if (stt === undefined) {\r\n      throw new Error(\"unknown class \" + cls);\r\n    }\r\n\r\n    let fields = stt.fields;\r\n    let flen = fields.length;\r\n\r\n    let keys = new Set();\r\n    keys.add(_abstractKey);\r\n\r\n    let keyTestJson = json;\r\n\r\n    for (let i = 0; i < flen; i++) {\r\n      let f = fields[i];\r\n\r\n      let val;\r\n\r\n      let tokinfo;\r\n\r\n      if (f.name === 'this') {\r\n        val = json;\r\n        keyTestJson = {\r\n          \"this\": json\r\n        };\r\n\r\n        keys.add(\"this\");\r\n        tokinfo = json[TokSymbol];\r\n      } else {\r\n        val = json[f.name];\r\n        keys.add(f.name);\r\n\r\n        tokinfo = json[TokSymbol] ? json[TokSymbol].fields[f.name] : undefined;\r\n        if (!tokinfo) {\r\n          let f2 = fields[Math.max(i - 1, 0)];\r\n          tokinfo = TokSymbol[TokSymbol] ? json[TokSymbol].fields[f2.name] : undefined;\r\n        }\r\n\r\n        if (!tokinfo) {\r\n          tokinfo = json[TokSymbol];\r\n        }\r\n      }\r\n\r\n      if (val === undefined) {\r\n        //console.warn(\"nstructjs.readJSON: Missing field \" + f.name + \" in struct \" + stt.name);\r\n        //continue;\r\n      }\r\n\r\n      let instance = f.name === 'this' ? val : json;\r\n\r\n      let ret = sintern2.validateJSON(this, val, json, f, f.type, instance, _abstractKey);\r\n\r\n      if (!ret || typeof ret === \"string\") {\r\n        let msg = typeof ret === \"string\" ? \": \" + ret : \"\";\r\n\r\n        if (tokinfo) {\r\n          this.jsonLogger(printContext(this.jsonBuf, tokinfo, this.jsonUseColors));\r\n        }\r\n\r\n        //console.error(cls.STRUCT);\r\n\r\n        if (val === undefined) {\r\n          throw new JSONError(stt.name + \": Missing json field \" + f.name + msg);\r\n        } else {\r\n          throw new JSONError(stt.name + \": Invalid json field \" + f.name + msg);\r\n        }\r\n\r\n        return false;\r\n      }\r\n    }\r\n\r\n    for (let k in keyTestJson) {\r\n      if (typeof json[k] === \"symbol\") {\r\n        //ignore symbols\r\n        continue;\r\n      }\r\n\r\n      if (!keys.has(k)) {\r\n        this.jsonLogger(cls.STRUCT);\r\n        throw new JSONError(stt.name + \": Unknown json field \" + k);\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  readJSON(json, cls_or_struct_id, objInstance = undefined) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    let cls, stt;\r\n\r\n    if (typeof cls_or_struct_id === \"number\") {\r\n      cls = this.struct_cls[this.struct_ids[cls_or_struct_id].name];\r\n    } else if (cls_or_struct_id instanceof NStruct) {\r\n      cls = this.get_struct_cls(cls_or_struct_id.name);\r\n    } else {\r\n      cls = cls_or_struct_id;\r\n    }\r\n\r\n    if (cls === undefined) {\r\n      throw new Error(\"bad cls_or_struct_id \" + cls_or_struct_id);\r\n    }\r\n\r\n    stt = this.structs[cls.structName];\r\n\r\n    packer_debug(\"\\n\\n=Begin reading \" + cls.structName + \"=\");\r\n    let thestruct = this;\r\n    let this2 = this;\r\n    let was_run = false;\r\n    let fromJSON = sintern2.fromJSON;\r\n\r\n    function makeLoader(stt) {\r\n      return function load(obj) {\r\n        if (was_run) {\r\n          return;\r\n        }\r\n\r\n        was_run = true;\r\n\r\n        let fields = stt.fields;\r\n        let flen = fields.length;\r\n\r\n        for (let i = 0; i < flen; i++) {\r\n          let f = fields[i];\r\n\r\n          let val;\r\n\r\n          if (f.name === 'this') {\r\n            val = json;\r\n          } else {\r\n            val = json[f.name];\r\n          }\r\n\r\n          if (val === undefined) {\r\n            if (warninglvl > 1) {\r\n              console.warn(\"nstructjs.readJSON: Missing field \" + f.name + \" in struct \" + stt.name);\r\n            }\r\n            continue;\r\n          }\r\n\r\n          let instance = f.name === 'this' ? obj : objInstance;\r\n\r\n          let ret = fromJSON(this2, val, obj, f, f.type, instance);\r\n\r\n          if (f.name !== 'this') {\r\n            obj[f.name] = ret;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    let load = makeLoader(stt);\r\n\r\n    if (cls.prototype.loadSTRUCT !== undefined) {\r\n      let obj = objInstance;\r\n\r\n      if (!obj && cls.newSTRUCT !== undefined) {\r\n        obj = cls.newSTRUCT(load);\r\n      } else if (!obj) {\r\n        obj = new cls();\r\n      }\r\n\r\n      obj.loadSTRUCT(load);\r\n      return obj;\r\n    } else if (cls.fromSTRUCT !== undefined) {\r\n      if (warninglvl > 1) {\r\n        console.warn(\"Warning: class \" + unmangle(cls.name) + \" is using deprecated fromSTRUCT interface; use newSTRUCT/loadSTRUCT instead\");\r\n      }\r\n      return cls.fromSTRUCT(load);\r\n    } else { //default case, make new instance and then call load() on it\r\n      let obj = objInstance;\r\n\r\n      if (!obj && cls.newSTRUCT !== undefined) {\r\n        obj = cls.newSTRUCT(load);\r\n      } else if (!obj) {\r\n        obj = new cls();\r\n      }\r\n\r\n      load(obj);\r\n\r\n      return obj;\r\n    }\r\n  }\r\n\r\n  formatJSON_intern(json, stt, field, tlvl = 0) {\r\n    const keywords = this.constructor.keywords;\r\n    const addComments = this.formatCtx.addComments;\r\n\r\n    let s = '{';\r\n\r\n    if (addComments && field && field.comment.trim()) {\r\n      s += \" \" + field.comment.trim();\r\n    }\r\n\r\n    s += \"\\n\";\r\n\r\n    for (let f of stt.fields) {\r\n      let value = json[f.name];\r\n\r\n      s += tab(tlvl + 1) + f.name + \": \";\r\n\r\n      s += sintern2.formatJSON(this, value, json, f, f.type, undefined, tlvl + 1);\r\n      s += \",\";\r\n\r\n      let basetype = f.type.type;\r\n\r\n      if (ArrayTypes.has(basetype)) {\r\n        basetype = f.type.data.type.type;\r\n      }\r\n\r\n      const addComment = ValueTypes.has(basetype) && addComments && f.comment.trim();\r\n\r\n      if (addComment) {\r\n        s += \" \" + f.comment.trim();\r\n      }\r\n\r\n      s += \"\\n\";\r\n    }\r\n\r\n    s += tab(tlvl) + \"}\";\r\n    return s;\r\n  }\r\n\r\n  formatJSON(json, cls, addComments = true, validate = true) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    let s = '';\r\n\r\n    if (validate) {\r\n      this.validateJSON(json, cls);\r\n    }\r\n\r\n    let stt = this.structs[cls.structName];\r\n\r\n    this.formatCtx = {\r\n      addComments,\r\n      validate\r\n    };\r\n\r\n    return this.formatJSON_intern(json, stt);\r\n  }\r\n};\r\n//$KEYWORD_CONFIG_END\r\n\r\nif (haveCodeGen) {\r\n  var StructClass;\r\n\r\n  try {\r\n    eval(code);\r\n  } catch (error) {\r\n    printEvalError(code);\r\n  }\r\n\r\n  StructClass.keywords = {\r\n    name  : \"structName\",\r\n    script: \"STRUCT\",\r\n    load  : \"loadSTRUCT\",\r\n    from  : \"fromSTRUCT\",\r\n    new   : \"newSTRUCT\",\r\n  };\r\n\r\n  STRUCT = StructClass;\r\n}\r\n\r\nSTRUCT.setClassKeyword(\"STRUCT\");\r\n\r\nfunction deriveStructManager(keywords = {\r\n  script: \"STRUCT\",\r\n  name  : undefined, //script.toLowerCase + \"Name\"\r\n  load  : undefined, //\"load\" + script\r\n  new   : undefined, //\"new\" + script\r\n  from  : undefined, //\"from\" + script\r\n}) {\r\n\r\n  if (!keywords.name) {\r\n    keywords.name = keywords.script.toLowerCase() + \"Name\";\r\n  }\r\n\r\n  if (!keywords.load) {\r\n    keywords.load = \"load\" + keywords.script;\r\n  }\r\n\r\n  if (!keywords.new) {\r\n    keywords.new = \"new\" + keywords.script;\r\n  }\r\n\r\n  if (!keywords.from) {\r\n    keywords.from = \"from\" + keywords.script;\r\n  }\r\n\r\n  if (!haveCodeGen) {\r\n    class NewSTRUCT extends STRUCT {\r\n\r\n    }\r\n\r\n    NewSTRUCT.keywords = keywords;\r\n    return NewSTRUCT;\r\n  } else {\r\n    var StructClass;\r\n    var _json_parser = jsonParser;\r\n    var _util = util;\r\n\r\n    let code2 = code;\r\n    code2 = code2.replace(/\\[keywords.script\\]/g, \".\" + keywords.script);\r\n    code2 = code2.replace(/\\[keywords.name\\]/g, \".\" + keywords.name);\r\n    code2 = code2.replace(/\\bjsonParser\\b/g, \"_json_parser\");\r\n    code2 = code2.replace(/\\butil\\b/g, \"_util\");\r\n\r\n    //console.log(\"\\n\\n\");\r\n    //console.log(printCodeLines(code2));\r\n    //console.log(\"\\n\\n\");\r\n\r\n    try {\r\n      eval(code2);\r\n    } catch (error) {\r\n      printEvalError(code2);\r\n    }\r\n\r\n    StructClass.keywords = keywords;\r\n    return StructClass;\r\n  }\r\n}\r\n\r\n//main struct script manager\r\nmanager = new STRUCT();\r\n\r\n/**\r\n * Write all defined structs out to a string.\r\n *\r\n * @param nManager STRUCT instance, defaults to nstructjs.manager\r\n * @param include_code include save code snippets\r\n * */\r\nfunction write_scripts(nManager = manager, include_code = false) {\r\n  let buf = \"\";\r\n\r\n  /* prevent code generation bugs in configurable mode */\r\n  let nl = String.fromCharCode(10);\r\n  let tab = String.fromCharCode(9);\r\n\r\n  nManager.forEach(function (stt) {\r\n    buf += STRUCT.fmt_struct(stt, false, !include_code) + nl;\r\n  });\r\n\r\n  let buf2 = buf;\r\n  buf = \"\";\r\n\r\n  for (let i = 0; i < buf2.length; i++) {\r\n    let c = buf2[i];\r\n    if (c === nl) {\r\n      buf += nl;\r\n      let i2 = i;\r\n      while (i < buf2.length && (buf2[i] === \" \" || buf2[i] === tab || buf2[i] === nl)) {\r\n        i++;\r\n      }\r\n      if (i !== i2)\r\n        i--;\r\n    } else {\r\n      buf += c;\r\n    }\r\n  }\r\n\r\n  return buf;\r\n}\n\n\"use strict\";\r\n\r\nlet nbtoa, natob;\r\n\r\nif (typeof btoa === \"undefined\") {\r\n  nbtoa = function btoa(str) {\r\n    let buffer = new Buffer(\"\" + str, 'binary');\r\n    return buffer.toString('base64');\r\n  };\r\n\r\n  natob = function atob(str) {\r\n    return new Buffer(str, 'base64').toString('binary');\r\n  };\r\n} else {\r\n  natob = atob;\r\n  nbtoa = btoa;\r\n}\r\n\r\n/*\r\nfile format:\r\n  magic signature              : 4 bytes\r\n  file version major           : 2 bytes\r\n  file version minor           : 1 bytes\r\n  file version micro           : 1 bytes\r\n  length of struct scripts     : 4 bytes\r\n  struct scripts for this file : ...\r\n  \r\n  block:\r\n    magic signature for block              : 4 bytes\r\n    length of data  (not including header) : 4 bytes\r\n    id of struct type                      : 4 bytes\r\n    \r\n    data                                   : ...\r\n*/\r\n\r\nfunction versionToInt(v) {\r\n  v = versionCoerce(v);\r\n  let mul = 64;\r\n  return ~~(v.major*mul*mul*mul + v.minor*mul*mul + v.micro*mul);\r\n}\r\n\r\nlet ver_pat = /[0-9]+\\.[0-9]+\\.[0-9]+$/;\r\n\r\nfunction versionCoerce(v) {\r\n  if (!v) {\r\n    throw new Error(\"empty version: \" + v);\r\n  }\r\n\r\n  if (typeof v === \"string\") {\r\n    if (!ver_pat.exec(v)) {\r\n      throw new Error(\"invalid version string \" + v);\r\n    }\r\n\r\n    let ver = v.split(\".\");\r\n    return {\r\n      major : parseInt(ver[0]),\r\n      minor : parseInt(ver[1]),\r\n      micro : parseInt(ver[2])\r\n    }\r\n  } else if (Array.isArray(v)) {\r\n    return {\r\n      major : v[0],\r\n      minor : v[1],\r\n      micro : v[2]\r\n    }\r\n  } else if (typeof v === \"object\") {\r\n    let test = (k) => k in v && typeof v[k] === \"number\";\r\n\r\n    if (!test(\"major\") || !test(\"minor\") || !test(\"micro\")) {\r\n      throw new Error(\"invalid version object: \" + v);\r\n    }\r\n\r\n    return v;\r\n  } else {\r\n    throw new Error(\"invalid version \" + v);\r\n  }\r\n}\r\n\r\nfunction versionLessThan(a, b) {\r\n  return versionToInt(a) < versionToInt(b);\r\n}\r\n\r\nclass FileParams {\r\n  constructor() {\r\n    this.magic = \"STRT\";\r\n    this.ext = \".bin\";\r\n    this.blocktypes = [\"DATA\"];\r\n\r\n    this.version = {\r\n      major: 0,\r\n      minor: 0,\r\n      micro: 1\r\n    };\r\n  }\r\n}\r\n\r\n//used to define blocks\r\nclass Block {\r\n  constructor(type_magic, data) {\r\n    this.type = type_magic;\r\n    this.data = data;\r\n  }\r\n}\r\n\r\nclass FileeError extends Error {\r\n}\r\n\r\nclass FileHelper {\r\n  //params can be FileParams instance, or object literal\r\n  //(it will convert to FileParams)\r\n  constructor(params) {\r\n    if (params === undefined) {\r\n      params = new FileParams();\r\n    } else {\r\n      let fp = new FileParams();\r\n\r\n      for (let k in params) {\r\n        fp[k] = params[k];\r\n      }\r\n      params = fp;\r\n    }\r\n\r\n    this.version = params.version;\r\n    this.blocktypes = params.blocktypes;\r\n    this.magic = params.magic;\r\n    this.ext = params.ext;\r\n    this.struct = undefined;\r\n    this.unpack_ctx = undefined;\r\n  }\r\n\r\n  read(dataview) {\r\n    this.unpack_ctx = new unpack_context();\r\n\r\n    let magic = unpack_static_string(dataview, this.unpack_ctx, 4);\r\n\r\n    if (magic !== this.magic) {\r\n      throw new FileError(\"corrupted file\");\r\n    }\r\n\r\n    this.version = {};\r\n    this.version.major = unpack_short(dataview, this.unpack_ctx);\r\n    this.version.minor = unpack_byte(dataview, this.unpack_ctx);\r\n    this.version.micro = unpack_byte(dataview, this.unpack_ctx);\r\n\r\n    let struct = this.struct = new STRUCT();\r\n\r\n    let scripts = unpack_string(dataview, this.unpack_ctx);\r\n    this.struct.parse_structs(scripts, manager);\r\n\r\n    let blocks = [];\r\n    let dviewlen = dataview.buffer.byteLength;\r\n\r\n    while (this.unpack_ctx.i < dviewlen) {\r\n      //console.log(\"reading block. . .\", this.unpack_ctx.i, dviewlen);\r\n\r\n      let type = unpack_static_string(dataview, this.unpack_ctx, 4);\r\n      let datalen = unpack_int(dataview, this.unpack_ctx);\r\n      let bstruct = unpack_int(dataview, this.unpack_ctx);\r\n      let bdata;\r\n\r\n      //console.log(type, datalen, bstruct);\r\n\r\n      if (bstruct === -2) { //string data, e.g. JSON\r\n        bdata = unpack_static_string(dataview, this.unpack_ctx, datalen);\r\n      } else {\r\n        bdata = unpack_bytes(dataview, this.unpack_ctx, datalen);\r\n        bdata = struct.read_object(bdata, bstruct, new unpack_context());\r\n      }\r\n\r\n      let block = new Block();\r\n      block.type = type;\r\n      block.data = bdata;\r\n\r\n      blocks.push(block);\r\n    }\r\n\r\n    this.blocks = blocks;\r\n    return blocks;\r\n  }\r\n\r\n  doVersions(old) {\r\n    let blocks = this.blocks;\r\n\r\n    if (versionLessThan(old, \"0.0.1\")) {\r\n      //do something\r\n    }\r\n  }\r\n\r\n  write(blocks) {\r\n    this.struct = manager;\r\n    this.blocks = blocks;\r\n\r\n    let data = [];\r\n\r\n    pack_static_string(data, this.magic, 4);\r\n    pack_short(data, this.version.major);\r\n    pack_byte(data, this.version.minor & 255);\r\n    pack_byte(data, this.version.micro & 255);\r\n\r\n    let scripts = write_scripts();\r\n    pack_string(data, scripts);\r\n\r\n    let struct = this.struct;\r\n\r\n    for (let block of blocks) {\r\n      if (typeof block.data === \"string\") { //string data, e.g. JSON\r\n        pack_static_string(data, block.type, 4);\r\n        pack_int(data, block.data.length);\r\n        pack_int(data, -2); //flag as string data\r\n        pack_static_string(data, block.data, block.data.length);\r\n        continue;\r\n      }\r\n\r\n      let structName = block.data.constructor.structName;\r\n      if (structName === undefined || !(structName in struct.structs)) {\r\n        throw new Error(\"Non-STRUCTable object \" + block.data);\r\n      }\r\n\r\n      let data2 = [];\r\n      let stt = struct.structs[structName];\r\n\r\n      struct.write_object(data2, block.data);\r\n\r\n      pack_static_string(data, block.type, 4);\r\n      pack_int(data, data2.length);\r\n      pack_int(data, stt.id);\r\n\r\n      pack_bytes(data, data2);\r\n    }\r\n\r\n    return new DataView(new Uint8Array(data).buffer);\r\n  }\r\n\r\n  writeBase64(blocks) {\r\n    let dataview = this.write(blocks);\r\n\r\n    let str = \"\";\r\n    let bytes = new Uint8Array(dataview.buffer);\r\n\r\n    for (let i = 0; i < bytes.length; i++) {\r\n      str += String.fromCharCode(bytes[i]);\r\n    }\r\n\r\n    return nbtoa(str);\r\n  }\r\n\r\n  makeBlock(type, data) {\r\n    return new Block(type, data);\r\n  }\r\n\r\n  readBase64(base64) {\r\n    let data = natob(base64);\r\n    let data2 = new Uint8Array(data.length);\r\n\r\n    for (let i = 0; i < data.length; i++) {\r\n      data2[i] = data.charCodeAt(i);\r\n    }\r\n\r\n    return this.read(new DataView(data2.buffer));\r\n  }\r\n}\n\nvar struct_filehelper = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  versionToInt: versionToInt,\n  versionCoerce: versionCoerce,\n  versionLessThan: versionLessThan,\n  FileParams: FileParams,\n  Block: Block,\n  FileeError: FileeError,\n  FileHelper: FileHelper\n});\n\n/** truncate webpack mangled names. defaults to true\r\n *  so Mesh$1 turns into Mesh */\r\nfunction truncateDollarSign(value = true) {\r\n  setTruncateDollarSign(value);\r\n}\r\n\r\nfunction validateStructs(onerror) {\r\n  return manager.validateStructs(onerror);\r\n}\r\n\r\n/**\r\n true means little endian, false means big endian\r\n */\r\nfunction setEndian(mode) {\r\n  let ret = STRUCT_ENDIAN;\r\n\r\n  setBinaryEndian(mode);\r\n\r\n  return ret;\r\n}\r\n\r\nfunction consoleLogger() {\r\n  console.log(...arguments);\r\n}\r\n\r\n/** Validate json\r\n *\r\n * @param json\r\n * @param cls\r\n * @param useInternalParser If true (the default) an internal parser will be used that generates nicer error messages\r\n * @param printColors\r\n * @param logger\r\n * @returns {*}\r\n */\r\nfunction validateJSON(json, cls, useInternalParser, printColors = true, logger = consoleLogger) {\r\n  return manager.validateJSON(json, cls, useInternalParser, printColors, logger);\r\n}\r\n\r\nfunction getEndian() {\r\n  return STRUCT_ENDIAN;\r\n}\r\n\r\nfunction setAllowOverriding(t) {\r\n  return manager.allowOverriding = !!t;\r\n}\r\n\r\nfunction isRegistered(cls) {\r\n  return manager.isRegistered(cls);\r\n}\r\n\r\n/** Register a class inline.\r\n *\r\n * Note: No need to use nstructjs.inherit,\r\n * inheritance is handled for you.  Unlike\r\n * nstructjs.inherit fields can be properly\r\n * overridden in the child class without\r\n * being written twice.\r\n *\r\n * class Test {\r\n *  test = 0;\r\n *\r\n *  static STRUCT = nstructjs.inlineRegister(this, `\r\n *  namespace.Test {\r\n *    test : int;\r\n *  }\r\n *  `);\r\n * }\r\n **/\r\nfunction inlineRegister(cls, structScript) {\r\n  return manager.inlineRegister(cls, structScript);\r\n}\r\n\r\n/** Register a class with nstructjs **/\r\nfunction register(cls, structName) {\r\n  return manager.register(cls, structName);\r\n}\r\n\r\nfunction unregister(cls) {\r\n  manager.unregister(cls);\r\n}\r\n\r\nfunction inherit(child, parent, structName = child.name) {\r\n\r\n  return STRUCT.inherit(...arguments);\r\n}\r\n\r\n/**\r\n @param data : DataView\r\n */\r\nfunction readObject(data, cls, __uctx = undefined) {\r\n  return manager.readObject(data, cls, __uctx);\r\n}\r\n\r\n/**\r\n @param data : Array instance to write bytes to\r\n */\r\nfunction writeObject(data, obj) {\r\n  return manager.writeObject(data, obj);\r\n}\r\n\r\nfunction writeJSON(obj) {\r\n  return manager.writeJSON(obj);\r\n}\r\n\r\nfunction formatJSON(json, cls, addComments = true, validate = true) {\r\n  return manager.formatJSON(json, cls, addComments, validate);\r\n}\r\n\r\nfunction readJSON(json, class_or_struct_id) {\r\n  return manager.readJSON(json, class_or_struct_id);\r\n}\n\nexport { JSONError, STRUCT, _truncateDollarSign, struct_binpack as binpack, consoleLogger, deriveStructManager, struct_filehelper as filehelper, formatJSON, getEndian, inherit, inlineRegister, isRegistered, manager, struct_parser as parser, struct_parseutil as parseutil, readJSON, readObject, register, setAllowOverriding, setDebugMode, setEndian, setTruncateDollarSign, setWarningMode, truncateDollarSign, struct_typesystem as typesystem, unpack_context, unregister, validateJSON, validateStructs, writeJSON, writeObject, write_scripts };\n","// THIS FILE IS GENERATED - DO NOT EDIT!\r\n/*!mobile-detect v1.4.4 2019-09-21*/\r\n/*global module:false, define:false*/\r\n/*jshint latedef:false*/\r\n/*!@license Copyright 2013, Heinrich Goebl, License: MIT, see https://github.com/hgoebl/mobile-detect.js*/\r\n(function (define, undefined) {\r\ndefine(function () {\r\n    'use strict';\r\n\r\n    var impl = {};\r\n\r\n    impl.mobileDetectRules = {\r\n    \"phones\": {\r\n        \"iPhone\": \"\\\\biPhone\\\\b|\\\\biPod\\\\b\",\r\n        \"BlackBerry\": \"BlackBerry|\\\\bBB10\\\\b|rim[0-9]+|\\\\b(BBA100|BBB100|BBD100|BBE100|BBF100|STH100)\\\\b-[0-9]+\",\r\n        \"HTC\": \"HTC|HTC.*(Sensation|Evo|Vision|Explorer|6800|8100|8900|A7272|S510e|C110e|Legend|Desire|T8282)|APX515CKT|Qtek9090|APA9292KT|HD_mini|Sensation.*Z710e|PG86100|Z715e|Desire.*(A8181|HD)|ADR6200|ADR6400L|ADR6425|001HT|Inspire 4G|Android.*\\\\bEVO\\\\b|T-Mobile G1|Z520m|Android [0-9.]+; Pixel\",\r\n        \"Nexus\": \"Nexus One|Nexus S|Galaxy.*Nexus|Android.*Nexus.*Mobile|Nexus 4|Nexus 5|Nexus 6\",\r\n        \"Dell\": \"Dell[;]? (Streak|Aero|Venue|Venue Pro|Flash|Smoke|Mini 3iX)|XCD28|XCD35|\\\\b001DL\\\\b|\\\\b101DL\\\\b|\\\\bGS01\\\\b\",\r\n        \"Motorola\": \"Motorola|DROIDX|DROID BIONIC|\\\\bDroid\\\\b.*Build|Android.*Xoom|HRI39|MOT-|A1260|A1680|A555|A853|A855|A953|A955|A956|Motorola.*ELECTRIFY|Motorola.*i1|i867|i940|MB200|MB300|MB501|MB502|MB508|MB511|MB520|MB525|MB526|MB611|MB612|MB632|MB810|MB855|MB860|MB861|MB865|MB870|ME501|ME502|ME511|ME525|ME600|ME632|ME722|ME811|ME860|ME863|ME865|MT620|MT710|MT716|MT720|MT810|MT870|MT917|Motorola.*TITANIUM|WX435|WX445|XT300|XT301|XT311|XT316|XT317|XT319|XT320|XT390|XT502|XT530|XT531|XT532|XT535|XT603|XT610|XT611|XT615|XT681|XT701|XT702|XT711|XT720|XT800|XT806|XT860|XT862|XT875|XT882|XT883|XT894|XT901|XT907|XT909|XT910|XT912|XT928|XT926|XT915|XT919|XT925|XT1021|\\\\bMoto E\\\\b|XT1068|XT1092|XT1052\",\r\n        \"Samsung\": \"\\\\bSamsung\\\\b|SM-G950F|SM-G955F|SM-G9250|GT-19300|SGH-I337|BGT-S5230|GT-B2100|GT-B2700|GT-B2710|GT-B3210|GT-B3310|GT-B3410|GT-B3730|GT-B3740|GT-B5510|GT-B5512|GT-B5722|GT-B6520|GT-B7300|GT-B7320|GT-B7330|GT-B7350|GT-B7510|GT-B7722|GT-B7800|GT-C3010|GT-C3011|GT-C3060|GT-C3200|GT-C3212|GT-C3212I|GT-C3262|GT-C3222|GT-C3300|GT-C3300K|GT-C3303|GT-C3303K|GT-C3310|GT-C3322|GT-C3330|GT-C3350|GT-C3500|GT-C3510|GT-C3530|GT-C3630|GT-C3780|GT-C5010|GT-C5212|GT-C6620|GT-C6625|GT-C6712|GT-E1050|GT-E1070|GT-E1075|GT-E1080|GT-E1081|GT-E1085|GT-E1087|GT-E1100|GT-E1107|GT-E1110|GT-E1120|GT-E1125|GT-E1130|GT-E1160|GT-E1170|GT-E1175|GT-E1180|GT-E1182|GT-E1200|GT-E1210|GT-E1225|GT-E1230|GT-E1390|GT-E2100|GT-E2120|GT-E2121|GT-E2152|GT-E2220|GT-E2222|GT-E2230|GT-E2232|GT-E2250|GT-E2370|GT-E2550|GT-E2652|GT-E3210|GT-E3213|GT-I5500|GT-I5503|GT-I5700|GT-I5800|GT-I5801|GT-I6410|GT-I6420|GT-I7110|GT-I7410|GT-I7500|GT-I8000|GT-I8150|GT-I8160|GT-I8190|GT-I8320|GT-I8330|GT-I8350|GT-I8530|GT-I8700|GT-I8703|GT-I8910|GT-I9000|GT-I9001|GT-I9003|GT-I9010|GT-I9020|GT-I9023|GT-I9070|GT-I9082|GT-I9100|GT-I9103|GT-I9220|GT-I9250|GT-I9300|GT-I9305|GT-I9500|GT-I9505|GT-M3510|GT-M5650|GT-M7500|GT-M7600|GT-M7603|GT-M8800|GT-M8910|GT-N7000|GT-S3110|GT-S3310|GT-S3350|GT-S3353|GT-S3370|GT-S3650|GT-S3653|GT-S3770|GT-S3850|GT-S5210|GT-S5220|GT-S5229|GT-S5230|GT-S5233|GT-S5250|GT-S5253|GT-S5260|GT-S5263|GT-S5270|GT-S5300|GT-S5330|GT-S5350|GT-S5360|GT-S5363|GT-S5369|GT-S5380|GT-S5380D|GT-S5560|GT-S5570|GT-S5600|GT-S5603|GT-S5610|GT-S5620|GT-S5660|GT-S5670|GT-S5690|GT-S5750|GT-S5780|GT-S5830|GT-S5839|GT-S6102|GT-S6500|GT-S7070|GT-S7200|GT-S7220|GT-S7230|GT-S7233|GT-S7250|GT-S7500|GT-S7530|GT-S7550|GT-S7562|GT-S7710|GT-S8000|GT-S8003|GT-S8500|GT-S8530|GT-S8600|SCH-A310|SCH-A530|SCH-A570|SCH-A610|SCH-A630|SCH-A650|SCH-A790|SCH-A795|SCH-A850|SCH-A870|SCH-A890|SCH-A930|SCH-A950|SCH-A970|SCH-A990|SCH-I100|SCH-I110|SCH-I400|SCH-I405|SCH-I500|SCH-I510|SCH-I515|SCH-I600|SCH-I730|SCH-I760|SCH-I770|SCH-I830|SCH-I910|SCH-I920|SCH-I959|SCH-LC11|SCH-N150|SCH-N300|SCH-R100|SCH-R300|SCH-R351|SCH-R400|SCH-R410|SCH-T300|SCH-U310|SCH-U320|SCH-U350|SCH-U360|SCH-U365|SCH-U370|SCH-U380|SCH-U410|SCH-U430|SCH-U450|SCH-U460|SCH-U470|SCH-U490|SCH-U540|SCH-U550|SCH-U620|SCH-U640|SCH-U650|SCH-U660|SCH-U700|SCH-U740|SCH-U750|SCH-U810|SCH-U820|SCH-U900|SCH-U940|SCH-U960|SCS-26UC|SGH-A107|SGH-A117|SGH-A127|SGH-A137|SGH-A157|SGH-A167|SGH-A177|SGH-A187|SGH-A197|SGH-A227|SGH-A237|SGH-A257|SGH-A437|SGH-A517|SGH-A597|SGH-A637|SGH-A657|SGH-A667|SGH-A687|SGH-A697|SGH-A707|SGH-A717|SGH-A727|SGH-A737|SGH-A747|SGH-A767|SGH-A777|SGH-A797|SGH-A817|SGH-A827|SGH-A837|SGH-A847|SGH-A867|SGH-A877|SGH-A887|SGH-A897|SGH-A927|SGH-B100|SGH-B130|SGH-B200|SGH-B220|SGH-C100|SGH-C110|SGH-C120|SGH-C130|SGH-C140|SGH-C160|SGH-C170|SGH-C180|SGH-C200|SGH-C207|SGH-C210|SGH-C225|SGH-C230|SGH-C417|SGH-C450|SGH-D307|SGH-D347|SGH-D357|SGH-D407|SGH-D415|SGH-D780|SGH-D807|SGH-D980|SGH-E105|SGH-E200|SGH-E315|SGH-E316|SGH-E317|SGH-E335|SGH-E590|SGH-E635|SGH-E715|SGH-E890|SGH-F300|SGH-F480|SGH-I200|SGH-I300|SGH-I320|SGH-I550|SGH-I577|SGH-I600|SGH-I607|SGH-I617|SGH-I627|SGH-I637|SGH-I677|SGH-I700|SGH-I717|SGH-I727|SGH-i747M|SGH-I777|SGH-I780|SGH-I827|SGH-I847|SGH-I857|SGH-I896|SGH-I897|SGH-I900|SGH-I907|SGH-I917|SGH-I927|SGH-I937|SGH-I997|SGH-J150|SGH-J200|SGH-L170|SGH-L700|SGH-M110|SGH-M150|SGH-M200|SGH-N105|SGH-N500|SGH-N600|SGH-N620|SGH-N625|SGH-N700|SGH-N710|SGH-P107|SGH-P207|SGH-P300|SGH-P310|SGH-P520|SGH-P735|SGH-P777|SGH-Q105|SGH-R210|SGH-R220|SGH-R225|SGH-S105|SGH-S307|SGH-T109|SGH-T119|SGH-T139|SGH-T209|SGH-T219|SGH-T229|SGH-T239|SGH-T249|SGH-T259|SGH-T309|SGH-T319|SGH-T329|SGH-T339|SGH-T349|SGH-T359|SGH-T369|SGH-T379|SGH-T409|SGH-T429|SGH-T439|SGH-T459|SGH-T469|SGH-T479|SGH-T499|SGH-T509|SGH-T519|SGH-T539|SGH-T559|SGH-T589|SGH-T609|SGH-T619|SGH-T629|SGH-T639|SGH-T659|SGH-T669|SGH-T679|SGH-T709|SGH-T719|SGH-T729|SGH-T739|SGH-T746|SGH-T749|SGH-T759|SGH-T769|SGH-T809|SGH-T819|SGH-T839|SGH-T919|SGH-T929|SGH-T939|SGH-T959|SGH-T989|SGH-U100|SGH-U200|SGH-U800|SGH-V205|SGH-V206|SGH-X100|SGH-X105|SGH-X120|SGH-X140|SGH-X426|SGH-X427|SGH-X475|SGH-X495|SGH-X497|SGH-X507|SGH-X600|SGH-X610|SGH-X620|SGH-X630|SGH-X700|SGH-X820|SGH-X890|SGH-Z130|SGH-Z150|SGH-Z170|SGH-ZX10|SGH-ZX20|SHW-M110|SPH-A120|SPH-A400|SPH-A420|SPH-A460|SPH-A500|SPH-A560|SPH-A600|SPH-A620|SPH-A660|SPH-A700|SPH-A740|SPH-A760|SPH-A790|SPH-A800|SPH-A820|SPH-A840|SPH-A880|SPH-A900|SPH-A940|SPH-A960|SPH-D600|SPH-D700|SPH-D710|SPH-D720|SPH-I300|SPH-I325|SPH-I330|SPH-I350|SPH-I500|SPH-I600|SPH-I700|SPH-L700|SPH-M100|SPH-M220|SPH-M240|SPH-M300|SPH-M305|SPH-M320|SPH-M330|SPH-M350|SPH-M360|SPH-M370|SPH-M380|SPH-M510|SPH-M540|SPH-M550|SPH-M560|SPH-M570|SPH-M580|SPH-M610|SPH-M620|SPH-M630|SPH-M800|SPH-M810|SPH-M850|SPH-M900|SPH-M910|SPH-M920|SPH-M930|SPH-N100|SPH-N200|SPH-N240|SPH-N300|SPH-N400|SPH-Z400|SWC-E100|SCH-i909|GT-N7100|GT-N7105|SCH-I535|SM-N900A|SGH-I317|SGH-T999L|GT-S5360B|GT-I8262|GT-S6802|GT-S6312|GT-S6310|GT-S5312|GT-S5310|GT-I9105|GT-I8510|GT-S6790N|SM-G7105|SM-N9005|GT-S5301|GT-I9295|GT-I9195|SM-C101|GT-S7392|GT-S7560|GT-B7610|GT-I5510|GT-S7582|GT-S7530E|GT-I8750|SM-G9006V|SM-G9008V|SM-G9009D|SM-G900A|SM-G900D|SM-G900F|SM-G900H|SM-G900I|SM-G900J|SM-G900K|SM-G900L|SM-G900M|SM-G900P|SM-G900R4|SM-G900S|SM-G900T|SM-G900V|SM-G900W8|SHV-E160K|SCH-P709|SCH-P729|SM-T2558|GT-I9205|SM-G9350|SM-J120F|SM-G920F|SM-G920V|SM-G930F|SM-N910C|SM-A310F|GT-I9190|SM-J500FN|SM-G903F|SM-J330F\",\r\n        \"LG\": \"\\\\bLG\\\\b;|LG[- ]?(C800|C900|E400|E610|E900|E-900|F160|F180K|F180L|F180S|730|855|L160|LS740|LS840|LS970|LU6200|MS690|MS695|MS770|MS840|MS870|MS910|P500|P700|P705|VM696|AS680|AS695|AX840|C729|E970|GS505|272|C395|E739BK|E960|L55C|L75C|LS696|LS860|P769BK|P350|P500|P509|P870|UN272|US730|VS840|VS950|LN272|LN510|LS670|LS855|LW690|MN270|MN510|P509|P769|P930|UN200|UN270|UN510|UN610|US670|US740|US760|UX265|UX840|VN271|VN530|VS660|VS700|VS740|VS750|VS910|VS920|VS930|VX9200|VX11000|AX840A|LW770|P506|P925|P999|E612|D955|D802|MS323|M257)|LM-G710\",\r\n        \"Sony\": \"SonyST|SonyLT|SonyEricsson|SonyEricssonLT15iv|LT18i|E10i|LT28h|LT26w|SonyEricssonMT27i|C5303|C6902|C6903|C6906|C6943|D2533\",\r\n        \"Asus\": \"Asus.*Galaxy|PadFone.*Mobile\",\r\n        \"NokiaLumia\": \"Lumia [0-9]{3,4}\",\r\n        \"Micromax\": \"Micromax.*\\\\b(A210|A92|A88|A72|A111|A110Q|A115|A116|A110|A90S|A26|A51|A35|A54|A25|A27|A89|A68|A65|A57|A90)\\\\b\",\r\n        \"Palm\": \"PalmSource|Palm\",\r\n        \"Vertu\": \"Vertu|Vertu.*Ltd|Vertu.*Ascent|Vertu.*Ayxta|Vertu.*Constellation(F|Quest)?|Vertu.*Monika|Vertu.*Signature\",\r\n        \"Pantech\": \"PANTECH|IM-A850S|IM-A840S|IM-A830L|IM-A830K|IM-A830S|IM-A820L|IM-A810K|IM-A810S|IM-A800S|IM-T100K|IM-A725L|IM-A780L|IM-A775C|IM-A770K|IM-A760S|IM-A750K|IM-A740S|IM-A730S|IM-A720L|IM-A710K|IM-A690L|IM-A690S|IM-A650S|IM-A630K|IM-A600S|VEGA PTL21|PT003|P8010|ADR910L|P6030|P6020|P9070|P4100|P9060|P5000|CDM8992|TXT8045|ADR8995|IS11PT|P2030|P6010|P8000|PT002|IS06|CDM8999|P9050|PT001|TXT8040|P2020|P9020|P2000|P7040|P7000|C790\",\r\n        \"Fly\": \"IQ230|IQ444|IQ450|IQ440|IQ442|IQ441|IQ245|IQ256|IQ236|IQ255|IQ235|IQ245|IQ275|IQ240|IQ285|IQ280|IQ270|IQ260|IQ250\",\r\n        \"Wiko\": \"KITE 4G|HIGHWAY|GETAWAY|STAIRWAY|DARKSIDE|DARKFULL|DARKNIGHT|DARKMOON|SLIDE|WAX 4G|RAINBOW|BLOOM|SUNSET|GOA(?!nna)|LENNY|BARRY|IGGY|OZZY|CINK FIVE|CINK PEAX|CINK PEAX 2|CINK SLIM|CINK SLIM 2|CINK +|CINK KING|CINK PEAX|CINK SLIM|SUBLIM\",\r\n        \"iMobile\": \"i-mobile (IQ|i-STYLE|idea|ZAA|Hitz)\",\r\n        \"SimValley\": \"\\\\b(SP-80|XT-930|SX-340|XT-930|SX-310|SP-360|SP60|SPT-800|SP-120|SPT-800|SP-140|SPX-5|SPX-8|SP-100|SPX-8|SPX-12)\\\\b\",\r\n        \"Wolfgang\": \"AT-B24D|AT-AS50HD|AT-AS40W|AT-AS55HD|AT-AS45q2|AT-B26D|AT-AS50Q\",\r\n        \"Alcatel\": \"Alcatel\",\r\n        \"Nintendo\": \"Nintendo (3DS|Switch)\",\r\n        \"Amoi\": \"Amoi\",\r\n        \"INQ\": \"INQ\",\r\n        \"OnePlus\": \"ONEPLUS\",\r\n        \"GenericPhone\": \"Tapatalk|PDA;|SAGEM|\\\\bmmp\\\\b|pocket|\\\\bpsp\\\\b|symbian|Smartphone|smartfon|treo|up.browser|up.link|vodafone|\\\\bwap\\\\b|nokia|Series40|Series60|S60|SonyEricsson|N900|MAUI.*WAP.*Browser\"\r\n    },\r\n    \"tablets\": {\r\n        \"iPad\": \"iPad|iPad.*Mobile\",\r\n        \"NexusTablet\": \"Android.*Nexus[\\\\s]+(7|9|10)\",\r\n        \"GoogleTablet\": \"Android.*Pixel C\",\r\n        \"SamsungTablet\": \"SAMSUNG.*Tablet|Galaxy.*Tab|SC-01C|GT-P1000|GT-P1003|GT-P1010|GT-P3105|GT-P6210|GT-P6800|GT-P6810|GT-P7100|GT-P7300|GT-P7310|GT-P7500|GT-P7510|SCH-I800|SCH-I815|SCH-I905|SGH-I957|SGH-I987|SGH-T849|SGH-T859|SGH-T869|SPH-P100|GT-P3100|GT-P3108|GT-P3110|GT-P5100|GT-P5110|GT-P6200|GT-P7320|GT-P7511|GT-N8000|GT-P8510|SGH-I497|SPH-P500|SGH-T779|SCH-I705|SCH-I915|GT-N8013|GT-P3113|GT-P5113|GT-P8110|GT-N8010|GT-N8005|GT-N8020|GT-P1013|GT-P6201|GT-P7501|GT-N5100|GT-N5105|GT-N5110|SHV-E140K|SHV-E140L|SHV-E140S|SHV-E150S|SHV-E230K|SHV-E230L|SHV-E230S|SHW-M180K|SHW-M180L|SHW-M180S|SHW-M180W|SHW-M300W|SHW-M305W|SHW-M380K|SHW-M380S|SHW-M380W|SHW-M430W|SHW-M480K|SHW-M480S|SHW-M480W|SHW-M485W|SHW-M486W|SHW-M500W|GT-I9228|SCH-P739|SCH-I925|GT-I9200|GT-P5200|GT-P5210|GT-P5210X|SM-T311|SM-T310|SM-T310X|SM-T210|SM-T210R|SM-T211|SM-P600|SM-P601|SM-P605|SM-P900|SM-P901|SM-T217|SM-T217A|SM-T217S|SM-P6000|SM-T3100|SGH-I467|XE500|SM-T110|GT-P5220|GT-I9200X|GT-N5110X|GT-N5120|SM-P905|SM-T111|SM-T2105|SM-T315|SM-T320|SM-T320X|SM-T321|SM-T520|SM-T525|SM-T530NU|SM-T230NU|SM-T330NU|SM-T900|XE500T1C|SM-P605V|SM-P905V|SM-T337V|SM-T537V|SM-T707V|SM-T807V|SM-P600X|SM-P900X|SM-T210X|SM-T230|SM-T230X|SM-T325|GT-P7503|SM-T531|SM-T330|SM-T530|SM-T705|SM-T705C|SM-T535|SM-T331|SM-T800|SM-T700|SM-T537|SM-T807|SM-P907A|SM-T337A|SM-T537A|SM-T707A|SM-T807A|SM-T237|SM-T807P|SM-P607T|SM-T217T|SM-T337T|SM-T807T|SM-T116NQ|SM-T116BU|SM-P550|SM-T350|SM-T550|SM-T9000|SM-P9000|SM-T705Y|SM-T805|GT-P3113|SM-T710|SM-T810|SM-T815|SM-T360|SM-T533|SM-T113|SM-T335|SM-T715|SM-T560|SM-T670|SM-T677|SM-T377|SM-T567|SM-T357T|SM-T555|SM-T561|SM-T713|SM-T719|SM-T813|SM-T819|SM-T580|SM-T355Y?|SM-T280|SM-T817A|SM-T820|SM-W700|SM-P580|SM-T587|SM-P350|SM-P555M|SM-P355M|SM-T113NU|SM-T815Y|SM-T585|SM-T285|SM-T825|SM-W708|SM-T835|SM-T830|SM-T837V|SM-T720|SM-T510|SM-T387V\",\r\n        \"Kindle\": \"Kindle|Silk.*Accelerated|Android.*\\\\b(KFOT|KFTT|KFJWI|KFJWA|KFOTE|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|WFJWAE|KFSAWA|KFSAWI|KFASWI|KFARWI|KFFOWI|KFGIWI|KFMEWI)\\\\b|Android.*Silk\\/[0-9.]+ like Chrome\\/[0-9.]+ (?!Mobile)\",\r\n        \"SurfaceTablet\": \"Windows NT [0-9.]+; ARM;.*(Tablet|ARMBJS)\",\r\n        \"HPTablet\": \"HP Slate (7|8|10)|HP ElitePad 900|hp-tablet|EliteBook.*Touch|HP 8|Slate 21|HP SlateBook 10\",\r\n        \"AsusTablet\": \"^.*PadFone((?!Mobile).)*$|Transformer|TF101|TF101G|TF300T|TF300TG|TF300TL|TF700T|TF700KL|TF701T|TF810C|ME171|ME301T|ME302C|ME371MG|ME370T|ME372MG|ME172V|ME173X|ME400C|Slider SL101|\\\\bK00F\\\\b|\\\\bK00C\\\\b|\\\\bK00E\\\\b|\\\\bK00L\\\\b|TX201LA|ME176C|ME102A|\\\\bM80TA\\\\b|ME372CL|ME560CG|ME372CG|ME302KL| K010 | K011 | K017 | K01E |ME572C|ME103K|ME170C|ME171C|\\\\bME70C\\\\b|ME581C|ME581CL|ME8510C|ME181C|P01Y|PO1MA|P01Z|\\\\bP027\\\\b|\\\\bP024\\\\b|\\\\bP00C\\\\b\",\r\n        \"BlackBerryTablet\": \"PlayBook|RIM Tablet\",\r\n        \"HTCtablet\": \"HTC_Flyer_P512|HTC Flyer|HTC Jetstream|HTC-P715a|HTC EVO View 4G|PG41200|PG09410\",\r\n        \"MotorolaTablet\": \"xoom|sholest|MZ615|MZ605|MZ505|MZ601|MZ602|MZ603|MZ604|MZ606|MZ607|MZ608|MZ609|MZ615|MZ616|MZ617\",\r\n        \"NookTablet\": \"Android.*Nook|NookColor|nook browser|BNRV200|BNRV200A|BNTV250|BNTV250A|BNTV400|BNTV600|LogicPD Zoom2\",\r\n        \"AcerTablet\": \"Android.*; \\\\b(A100|A101|A110|A200|A210|A211|A500|A501|A510|A511|A700|A701|W500|W500P|W501|W501P|W510|W511|W700|G100|G100W|B1-A71|B1-710|B1-711|A1-810|A1-811|A1-830)\\\\b|W3-810|\\\\bA3-A10\\\\b|\\\\bA3-A11\\\\b|\\\\bA3-A20\\\\b|\\\\bA3-A30\",\r\n        \"ToshibaTablet\": \"Android.*(AT100|AT105|AT200|AT205|AT270|AT275|AT300|AT305|AT1S5|AT500|AT570|AT700|AT830)|TOSHIBA.*FOLIO\",\r\n        \"LGTablet\": \"\\\\bL-06C|LG-V909|LG-V900|LG-V700|LG-V510|LG-V500|LG-V410|LG-V400|LG-VK810\\\\b\",\r\n        \"FujitsuTablet\": \"Android.*\\\\b(F-01D|F-02F|F-05E|F-10D|M532|Q572)\\\\b\",\r\n        \"PrestigioTablet\": \"PMP3170B|PMP3270B|PMP3470B|PMP7170B|PMP3370B|PMP3570C|PMP5870C|PMP3670B|PMP5570C|PMP5770D|PMP3970B|PMP3870C|PMP5580C|PMP5880D|PMP5780D|PMP5588C|PMP7280C|PMP7280C3G|PMP7280|PMP7880D|PMP5597D|PMP5597|PMP7100D|PER3464|PER3274|PER3574|PER3884|PER5274|PER5474|PMP5097CPRO|PMP5097|PMP7380D|PMP5297C|PMP5297C_QUAD|PMP812E|PMP812E3G|PMP812F|PMP810E|PMP880TD|PMT3017|PMT3037|PMT3047|PMT3057|PMT7008|PMT5887|PMT5001|PMT5002\",\r\n        \"LenovoTablet\": \"Lenovo TAB|Idea(Tab|Pad)( A1|A10| K1|)|ThinkPad([ ]+)?Tablet|YT3-850M|YT3-X90L|YT3-X90F|YT3-X90X|Lenovo.*(S2109|S2110|S5000|S6000|K3011|A3000|A3500|A1000|A2107|A2109|A1107|A5500|A7600|B6000|B8000|B8080)(-|)(FL|F|HV|H|)|TB-X103F|TB-X304X|TB-X304F|TB-X304L|TB-X505F|TB-X505L|TB-X505X|TB-X605F|TB-X605L|TB-8703F|TB-8703X|TB-8703N|TB-8704N|TB-8704F|TB-8704X|TB-8704V|TB-7304F|TB-7304I|TB-7304X|Tab2A7-10F|Tab2A7-20F|TB2-X30L|YT3-X50L|YT3-X50F|YT3-X50M|YT-X705F|YT-X703F|YT-X703L|YT-X705L|YT-X705X|TB2-X30F|TB2-X30L|TB2-X30M|A2107A-F|A2107A-H|TB3-730F|TB3-730M|TB3-730X|TB-7504F|TB-7504X\",\r\n        \"DellTablet\": \"Venue 11|Venue 8|Venue 7|Dell Streak 10|Dell Streak 7\",\r\n        \"YarvikTablet\": \"Android.*\\\\b(TAB210|TAB211|TAB224|TAB250|TAB260|TAB264|TAB310|TAB360|TAB364|TAB410|TAB411|TAB420|TAB424|TAB450|TAB460|TAB461|TAB464|TAB465|TAB467|TAB468|TAB07-100|TAB07-101|TAB07-150|TAB07-151|TAB07-152|TAB07-200|TAB07-201-3G|TAB07-210|TAB07-211|TAB07-212|TAB07-214|TAB07-220|TAB07-400|TAB07-485|TAB08-150|TAB08-200|TAB08-201-3G|TAB08-201-30|TAB09-100|TAB09-211|TAB09-410|TAB10-150|TAB10-201|TAB10-211|TAB10-400|TAB10-410|TAB13-201|TAB274EUK|TAB275EUK|TAB374EUK|TAB462EUK|TAB474EUK|TAB9-200)\\\\b\",\r\n        \"MedionTablet\": \"Android.*\\\\bOYO\\\\b|LIFE.*(P9212|P9514|P9516|S9512)|LIFETAB\",\r\n        \"ArnovaTablet\": \"97G4|AN10G2|AN7bG3|AN7fG3|AN8G3|AN8cG3|AN7G3|AN9G3|AN7dG3|AN7dG3ST|AN7dG3ChildPad|AN10bG3|AN10bG3DT|AN9G2\",\r\n        \"IntensoTablet\": \"INM8002KP|INM1010FP|INM805ND|Intenso Tab|TAB1004\",\r\n        \"IRUTablet\": \"M702pro\",\r\n        \"MegafonTablet\": \"MegaFon V9|\\\\bZTE V9\\\\b|Android.*\\\\bMT7A\\\\b\",\r\n        \"EbodaTablet\": \"E-Boda (Supreme|Impresspeed|Izzycomm|Essential)\",\r\n        \"AllViewTablet\": \"Allview.*(Viva|Alldro|City|Speed|All TV|Frenzy|Quasar|Shine|TX1|AX1|AX2)\",\r\n        \"ArchosTablet\": \"\\\\b(101G9|80G9|A101IT)\\\\b|Qilive 97R|Archos5|\\\\bARCHOS (70|79|80|90|97|101|FAMILYPAD|)(b|c|)(G10| Cobalt| TITANIUM(HD|)| Xenon| Neon|XSK| 2| XS 2| PLATINUM| CARBON|GAMEPAD)\\\\b\",\r\n        \"AinolTablet\": \"NOVO7|NOVO8|NOVO10|Novo7Aurora|Novo7Basic|NOVO7PALADIN|novo9-Spark\",\r\n        \"NokiaLumiaTablet\": \"Lumia 2520\",\r\n        \"SonyTablet\": \"Sony.*Tablet|Xperia Tablet|Sony Tablet S|SO-03E|SGPT12|SGPT13|SGPT114|SGPT121|SGPT122|SGPT123|SGPT111|SGPT112|SGPT113|SGPT131|SGPT132|SGPT133|SGPT211|SGPT212|SGPT213|SGP311|SGP312|SGP321|EBRD1101|EBRD1102|EBRD1201|SGP351|SGP341|SGP511|SGP512|SGP521|SGP541|SGP551|SGP621|SGP641|SGP612|SOT31|SGP771|SGP611|SGP612|SGP712\",\r\n        \"PhilipsTablet\": \"\\\\b(PI2010|PI3000|PI3100|PI3105|PI3110|PI3205|PI3210|PI3900|PI4010|PI7000|PI7100)\\\\b\",\r\n        \"CubeTablet\": \"Android.*(K8GT|U9GT|U10GT|U16GT|U17GT|U18GT|U19GT|U20GT|U23GT|U30GT)|CUBE U8GT\",\r\n        \"CobyTablet\": \"MID1042|MID1045|MID1125|MID1126|MID7012|MID7014|MID7015|MID7034|MID7035|MID7036|MID7042|MID7048|MID7127|MID8042|MID8048|MID8127|MID9042|MID9740|MID9742|MID7022|MID7010\",\r\n        \"MIDTablet\": \"M9701|M9000|M9100|M806|M1052|M806|T703|MID701|MID713|MID710|MID727|MID760|MID830|MID728|MID933|MID125|MID810|MID732|MID120|MID930|MID800|MID731|MID900|MID100|MID820|MID735|MID980|MID130|MID833|MID737|MID960|MID135|MID860|MID736|MID140|MID930|MID835|MID733|MID4X10\",\r\n        \"MSITablet\": \"MSI \\\\b(Primo 73K|Primo 73L|Primo 81L|Primo 77|Primo 93|Primo 75|Primo 76|Primo 73|Primo 81|Primo 91|Primo 90|Enjoy 71|Enjoy 7|Enjoy 10)\\\\b\",\r\n        \"SMiTTablet\": \"Android.*(\\\\bMID\\\\b|MID-560|MTV-T1200|MTV-PND531|MTV-P1101|MTV-PND530)\",\r\n        \"RockChipTablet\": \"Android.*(RK2818|RK2808A|RK2918|RK3066)|RK2738|RK2808A\",\r\n        \"FlyTablet\": \"IQ310|Fly Vision\",\r\n        \"bqTablet\": \"Android.*(bq)?.*\\\\b(Elcano|Curie|Edison|Maxwell|Kepler|Pascal|Tesla|Hypatia|Platon|Newton|Livingstone|Cervantes|Avant|Aquaris ([E|M]10|M8))\\\\b|Maxwell.*Lite|Maxwell.*Plus\",\r\n        \"HuaweiTablet\": \"MediaPad|MediaPad 7 Youth|IDEOS S7|S7-201c|S7-202u|S7-101|S7-103|S7-104|S7-105|S7-106|S7-201|S7-Slim|M2-A01L|BAH-L09|BAH-W09|AGS-L09|CMR-AL19\",\r\n        \"NecTablet\": \"\\\\bN-06D|\\\\bN-08D\",\r\n        \"PantechTablet\": \"Pantech.*P4100\",\r\n        \"BronchoTablet\": \"Broncho.*(N701|N708|N802|a710)\",\r\n        \"VersusTablet\": \"TOUCHPAD.*[78910]|\\\\bTOUCHTAB\\\\b\",\r\n        \"ZyncTablet\": \"z1000|Z99 2G|z930|z990|z909|Z919|z900\",\r\n        \"PositivoTablet\": \"TB07STA|TB10STA|TB07FTA|TB10FTA\",\r\n        \"NabiTablet\": \"Android.*\\\\bNabi\",\r\n        \"KoboTablet\": \"Kobo Touch|\\\\bK080\\\\b|\\\\bVox\\\\b Build|\\\\bArc\\\\b Build\",\r\n        \"DanewTablet\": \"DSlide.*\\\\b(700|701R|702|703R|704|802|970|971|972|973|974|1010|1012)\\\\b\",\r\n        \"TexetTablet\": \"NaviPad|TB-772A|TM-7045|TM-7055|TM-9750|TM-7016|TM-7024|TM-7026|TM-7041|TM-7043|TM-7047|TM-8041|TM-9741|TM-9747|TM-9748|TM-9751|TM-7022|TM-7021|TM-7020|TM-7011|TM-7010|TM-7023|TM-7025|TM-7037W|TM-7038W|TM-7027W|TM-9720|TM-9725|TM-9737W|TM-1020|TM-9738W|TM-9740|TM-9743W|TB-807A|TB-771A|TB-727A|TB-725A|TB-719A|TB-823A|TB-805A|TB-723A|TB-715A|TB-707A|TB-705A|TB-709A|TB-711A|TB-890HD|TB-880HD|TB-790HD|TB-780HD|TB-770HD|TB-721HD|TB-710HD|TB-434HD|TB-860HD|TB-840HD|TB-760HD|TB-750HD|TB-740HD|TB-730HD|TB-722HD|TB-720HD|TB-700HD|TB-500HD|TB-470HD|TB-431HD|TB-430HD|TB-506|TB-504|TB-446|TB-436|TB-416|TB-146SE|TB-126SE\",\r\n        \"PlaystationTablet\": \"Playstation.*(Portable|Vita)\",\r\n        \"TrekstorTablet\": \"ST10416-1|VT10416-1|ST70408-1|ST702xx-1|ST702xx-2|ST80208|ST97216|ST70104-2|VT10416-2|ST10216-2A|SurfTab\",\r\n        \"PyleAudioTablet\": \"\\\\b(PTBL10CEU|PTBL10C|PTBL72BC|PTBL72BCEU|PTBL7CEU|PTBL7C|PTBL92BC|PTBL92BCEU|PTBL9CEU|PTBL9CUK|PTBL9C)\\\\b\",\r\n        \"AdvanTablet\": \"Android.* \\\\b(E3A|T3X|T5C|T5B|T3E|T3C|T3B|T1J|T1F|T2A|T1H|T1i|E1C|T1-E|T5-A|T4|E1-B|T2Ci|T1-B|T1-D|O1-A|E1-A|T1-A|T3A|T4i)\\\\b \",\r\n        \"DanyTechTablet\": \"Genius Tab G3|Genius Tab S2|Genius Tab Q3|Genius Tab G4|Genius Tab Q4|Genius Tab G-II|Genius TAB GII|Genius TAB GIII|Genius Tab S1\",\r\n        \"GalapadTablet\": \"Android.*\\\\bG1\\\\b(?!\\\\))\",\r\n        \"MicromaxTablet\": \"Funbook|Micromax.*\\\\b(P250|P560|P360|P362|P600|P300|P350|P500|P275)\\\\b\",\r\n        \"KarbonnTablet\": \"Android.*\\\\b(A39|A37|A34|ST8|ST10|ST7|Smart Tab3|Smart Tab2)\\\\b\",\r\n        \"AllFineTablet\": \"Fine7 Genius|Fine7 Shine|Fine7 Air|Fine8 Style|Fine9 More|Fine10 Joy|Fine11 Wide\",\r\n        \"PROSCANTablet\": \"\\\\b(PEM63|PLT1023G|PLT1041|PLT1044|PLT1044G|PLT1091|PLT4311|PLT4311PL|PLT4315|PLT7030|PLT7033|PLT7033D|PLT7035|PLT7035D|PLT7044K|PLT7045K|PLT7045KB|PLT7071KG|PLT7072|PLT7223G|PLT7225G|PLT7777G|PLT7810K|PLT7849G|PLT7851G|PLT7852G|PLT8015|PLT8031|PLT8034|PLT8036|PLT8080K|PLT8082|PLT8088|PLT8223G|PLT8234G|PLT8235G|PLT8816K|PLT9011|PLT9045K|PLT9233G|PLT9735|PLT9760G|PLT9770G)\\\\b\",\r\n        \"YONESTablet\": \"BQ1078|BC1003|BC1077|RK9702|BC9730|BC9001|IT9001|BC7008|BC7010|BC708|BC728|BC7012|BC7030|BC7027|BC7026\",\r\n        \"ChangJiaTablet\": \"TPC7102|TPC7103|TPC7105|TPC7106|TPC7107|TPC7201|TPC7203|TPC7205|TPC7210|TPC7708|TPC7709|TPC7712|TPC7110|TPC8101|TPC8103|TPC8105|TPC8106|TPC8203|TPC8205|TPC8503|TPC9106|TPC9701|TPC97101|TPC97103|TPC97105|TPC97106|TPC97111|TPC97113|TPC97203|TPC97603|TPC97809|TPC97205|TPC10101|TPC10103|TPC10106|TPC10111|TPC10203|TPC10205|TPC10503\",\r\n        \"GUTablet\": \"TX-A1301|TX-M9002|Q702|kf026\",\r\n        \"PointOfViewTablet\": \"TAB-P506|TAB-navi-7-3G-M|TAB-P517|TAB-P-527|TAB-P701|TAB-P703|TAB-P721|TAB-P731N|TAB-P741|TAB-P825|TAB-P905|TAB-P925|TAB-PR945|TAB-PL1015|TAB-P1025|TAB-PI1045|TAB-P1325|TAB-PROTAB[0-9]+|TAB-PROTAB25|TAB-PROTAB26|TAB-PROTAB27|TAB-PROTAB26XL|TAB-PROTAB2-IPS9|TAB-PROTAB30-IPS9|TAB-PROTAB25XXL|TAB-PROTAB26-IPS10|TAB-PROTAB30-IPS10\",\r\n        \"OvermaxTablet\": \"OV-(SteelCore|NewBase|Basecore|Baseone|Exellen|Quattor|EduTab|Solution|ACTION|BasicTab|TeddyTab|MagicTab|Stream|TB-08|TB-09)|Qualcore 1027\",\r\n        \"HCLTablet\": \"HCL.*Tablet|Connect-3G-2.0|Connect-2G-2.0|ME Tablet U1|ME Tablet U2|ME Tablet G1|ME Tablet X1|ME Tablet Y2|ME Tablet Sync\",\r\n        \"DPSTablet\": \"DPS Dream 9|DPS Dual 7\",\r\n        \"VistureTablet\": \"V97 HD|i75 3G|Visture V4( HD)?|Visture V5( HD)?|Visture V10\",\r\n        \"CrestaTablet\": \"CTP(-)?810|CTP(-)?818|CTP(-)?828|CTP(-)?838|CTP(-)?888|CTP(-)?978|CTP(-)?980|CTP(-)?987|CTP(-)?988|CTP(-)?989\",\r\n        \"MediatekTablet\": \"\\\\bMT8125|MT8389|MT8135|MT8377\\\\b\",\r\n        \"ConcordeTablet\": \"Concorde([ ]+)?Tab|ConCorde ReadMan\",\r\n        \"GoCleverTablet\": \"GOCLEVER TAB|A7GOCLEVER|M1042|M7841|M742|R1042BK|R1041|TAB A975|TAB A7842|TAB A741|TAB A741L|TAB M723G|TAB M721|TAB A1021|TAB I921|TAB R721|TAB I720|TAB T76|TAB R70|TAB R76.2|TAB R106|TAB R83.2|TAB M813G|TAB I721|GCTA722|TAB I70|TAB I71|TAB S73|TAB R73|TAB R74|TAB R93|TAB R75|TAB R76.1|TAB A73|TAB A93|TAB A93.2|TAB T72|TAB R83|TAB R974|TAB R973|TAB A101|TAB A103|TAB A104|TAB A104.2|R105BK|M713G|A972BK|TAB A971|TAB R974.2|TAB R104|TAB R83.3|TAB A1042\",\r\n        \"ModecomTablet\": \"FreeTAB 9000|FreeTAB 7.4|FreeTAB 7004|FreeTAB 7800|FreeTAB 2096|FreeTAB 7.5|FreeTAB 1014|FreeTAB 1001 |FreeTAB 8001|FreeTAB 9706|FreeTAB 9702|FreeTAB 7003|FreeTAB 7002|FreeTAB 1002|FreeTAB 7801|FreeTAB 1331|FreeTAB 1004|FreeTAB 8002|FreeTAB 8014|FreeTAB 9704|FreeTAB 1003\",\r\n        \"VoninoTablet\": \"\\\\b(Argus[ _]?S|Diamond[ _]?79HD|Emerald[ _]?78E|Luna[ _]?70C|Onyx[ _]?S|Onyx[ _]?Z|Orin[ _]?HD|Orin[ _]?S|Otis[ _]?S|SpeedStar[ _]?S|Magnet[ _]?M9|Primus[ _]?94[ _]?3G|Primus[ _]?94HD|Primus[ _]?QS|Android.*\\\\bQ8\\\\b|Sirius[ _]?EVO[ _]?QS|Sirius[ _]?QS|Spirit[ _]?S)\\\\b\",\r\n        \"ECSTablet\": \"V07OT2|TM105A|S10OT1|TR10CS1\",\r\n        \"StorexTablet\": \"eZee[_']?(Tab|Go)[0-9]+|TabLC7|Looney Tunes Tab\",\r\n        \"VodafoneTablet\": \"SmartTab([ ]+)?[0-9]+|SmartTabII10|SmartTabII7|VF-1497|VFD 1400\",\r\n        \"EssentielBTablet\": \"Smart[ ']?TAB[ ]+?[0-9]+|Family[ ']?TAB2\",\r\n        \"RossMoorTablet\": \"RM-790|RM-997|RMD-878G|RMD-974R|RMT-705A|RMT-701|RME-601|RMT-501|RMT-711\",\r\n        \"iMobileTablet\": \"i-mobile i-note\",\r\n        \"TolinoTablet\": \"tolino tab [0-9.]+|tolino shine\",\r\n        \"AudioSonicTablet\": \"\\\\bC-22Q|T7-QC|T-17B|T-17P\\\\b\",\r\n        \"AMPETablet\": \"Android.* A78 \",\r\n        \"SkkTablet\": \"Android.* (SKYPAD|PHOENIX|CYCLOPS)\",\r\n        \"TecnoTablet\": \"TECNO P9|TECNO DP8D\",\r\n        \"JXDTablet\": \"Android.* \\\\b(F3000|A3300|JXD5000|JXD3000|JXD2000|JXD300B|JXD300|S5800|S7800|S602b|S5110b|S7300|S5300|S602|S603|S5100|S5110|S601|S7100a|P3000F|P3000s|P101|P200s|P1000m|P200m|P9100|P1000s|S6600b|S908|P1000|P300|S18|S6600|S9100)\\\\b\",\r\n        \"iJoyTablet\": \"Tablet (Spirit 7|Essentia|Galatea|Fusion|Onix 7|Landa|Titan|Scooby|Deox|Stella|Themis|Argon|Unique 7|Sygnus|Hexen|Finity 7|Cream|Cream X2|Jade|Neon 7|Neron 7|Kandy|Scape|Saphyr 7|Rebel|Biox|Rebel|Rebel 8GB|Myst|Draco 7|Myst|Tab7-004|Myst|Tadeo Jones|Tablet Boing|Arrow|Draco Dual Cam|Aurix|Mint|Amity|Revolution|Finity 9|Neon 9|T9w|Amity 4GB Dual Cam|Stone 4GB|Stone 8GB|Andromeda|Silken|X2|Andromeda II|Halley|Flame|Saphyr 9,7|Touch 8|Planet|Triton|Unique 10|Hexen 10|Memphis 4GB|Memphis 8GB|Onix 10)\",\r\n        \"FX2Tablet\": \"FX2 PAD7|FX2 PAD10\",\r\n        \"XoroTablet\": \"KidsPAD 701|PAD[ ]?712|PAD[ ]?714|PAD[ ]?716|PAD[ ]?717|PAD[ ]?718|PAD[ ]?720|PAD[ ]?721|PAD[ ]?722|PAD[ ]?790|PAD[ ]?792|PAD[ ]?900|PAD[ ]?9715D|PAD[ ]?9716DR|PAD[ ]?9718DR|PAD[ ]?9719QR|PAD[ ]?9720QR|TelePAD1030|Telepad1032|TelePAD730|TelePAD731|TelePAD732|TelePAD735Q|TelePAD830|TelePAD9730|TelePAD795|MegaPAD 1331|MegaPAD 1851|MegaPAD 2151\",\r\n        \"ViewsonicTablet\": \"ViewPad 10pi|ViewPad 10e|ViewPad 10s|ViewPad E72|ViewPad7|ViewPad E100|ViewPad 7e|ViewSonic VB733|VB100a\",\r\n        \"VerizonTablet\": \"QTAQZ3|QTAIR7|QTAQTZ3|QTASUN1|QTASUN2|QTAXIA1\",\r\n        \"OdysTablet\": \"LOOX|XENO10|ODYS[ -](Space|EVO|Xpress|NOON)|\\\\bXELIO\\\\b|Xelio10Pro|XELIO7PHONETAB|XELIO10EXTREME|XELIOPT2|NEO_QUAD10\",\r\n        \"CaptivaTablet\": \"CAPTIVA PAD\",\r\n        \"IconbitTablet\": \"NetTAB|NT-3702|NT-3702S|NT-3702S|NT-3603P|NT-3603P|NT-0704S|NT-0704S|NT-3805C|NT-3805C|NT-0806C|NT-0806C|NT-0909T|NT-0909T|NT-0907S|NT-0907S|NT-0902S|NT-0902S\",\r\n        \"TeclastTablet\": \"T98 4G|\\\\bP80\\\\b|\\\\bX90HD\\\\b|X98 Air|X98 Air 3G|\\\\bX89\\\\b|P80 3G|\\\\bX80h\\\\b|P98 Air|\\\\bX89HD\\\\b|P98 3G|\\\\bP90HD\\\\b|P89 3G|X98 3G|\\\\bP70h\\\\b|P79HD 3G|G18d 3G|\\\\bP79HD\\\\b|\\\\bP89s\\\\b|\\\\bA88\\\\b|\\\\bP10HD\\\\b|\\\\bP19HD\\\\b|G18 3G|\\\\bP78HD\\\\b|\\\\bA78\\\\b|\\\\bP75\\\\b|G17s 3G|G17h 3G|\\\\bP85t\\\\b|\\\\bP90\\\\b|\\\\bP11\\\\b|\\\\bP98t\\\\b|\\\\bP98HD\\\\b|\\\\bG18d\\\\b|\\\\bP85s\\\\b|\\\\bP11HD\\\\b|\\\\bP88s\\\\b|\\\\bA80HD\\\\b|\\\\bA80se\\\\b|\\\\bA10h\\\\b|\\\\bP89\\\\b|\\\\bP78s\\\\b|\\\\bG18\\\\b|\\\\bP85\\\\b|\\\\bA70h\\\\b|\\\\bA70\\\\b|\\\\bG17\\\\b|\\\\bP18\\\\b|\\\\bA80s\\\\b|\\\\bA11s\\\\b|\\\\bP88HD\\\\b|\\\\bA80h\\\\b|\\\\bP76s\\\\b|\\\\bP76h\\\\b|\\\\bP98\\\\b|\\\\bA10HD\\\\b|\\\\bP78\\\\b|\\\\bP88\\\\b|\\\\bA11\\\\b|\\\\bA10t\\\\b|\\\\bP76a\\\\b|\\\\bP76t\\\\b|\\\\bP76e\\\\b|\\\\bP85HD\\\\b|\\\\bP85a\\\\b|\\\\bP86\\\\b|\\\\bP75HD\\\\b|\\\\bP76v\\\\b|\\\\bA12\\\\b|\\\\bP75a\\\\b|\\\\bA15\\\\b|\\\\bP76Ti\\\\b|\\\\bP81HD\\\\b|\\\\bA10\\\\b|\\\\bT760VE\\\\b|\\\\bT720HD\\\\b|\\\\bP76\\\\b|\\\\bP73\\\\b|\\\\bP71\\\\b|\\\\bP72\\\\b|\\\\bT720SE\\\\b|\\\\bC520Ti\\\\b|\\\\bT760\\\\b|\\\\bT720VE\\\\b|T720-3GE|T720-WiFi\",\r\n        \"OndaTablet\": \"\\\\b(V975i|Vi30|VX530|V701|Vi60|V701s|Vi50|V801s|V719|Vx610w|VX610W|V819i|Vi10|VX580W|Vi10|V711s|V813|V811|V820w|V820|Vi20|V711|VI30W|V712|V891w|V972|V819w|V820w|Vi60|V820w|V711|V813s|V801|V819|V975s|V801|V819|V819|V818|V811|V712|V975m|V101w|V961w|V812|V818|V971|V971s|V919|V989|V116w|V102w|V973|Vi40)\\\\b[\\\\s]+|V10 \\\\b4G\\\\b\",\r\n        \"JaytechTablet\": \"TPC-PA762\",\r\n        \"BlaupunktTablet\": \"Endeavour 800NG|Endeavour 1010\",\r\n        \"DigmaTablet\": \"\\\\b(iDx10|iDx9|iDx8|iDx7|iDxD7|iDxD8|iDsQ8|iDsQ7|iDsQ8|iDsD10|iDnD7|3TS804H|iDsQ11|iDj7|iDs10)\\\\b\",\r\n        \"EvolioTablet\": \"ARIA_Mini_wifi|Aria[ _]Mini|Evolio X10|Evolio X7|Evolio X8|\\\\bEvotab\\\\b|\\\\bNeura\\\\b\",\r\n        \"LavaTablet\": \"QPAD E704|\\\\bIvoryS\\\\b|E-TAB IVORY|\\\\bE-TAB\\\\b\",\r\n        \"AocTablet\": \"MW0811|MW0812|MW0922|MTK8382|MW1031|MW0831|MW0821|MW0931|MW0712\",\r\n        \"MpmanTablet\": \"MP11 OCTA|MP10 OCTA|MPQC1114|MPQC1004|MPQC994|MPQC974|MPQC973|MPQC804|MPQC784|MPQC780|\\\\bMPG7\\\\b|MPDCG75|MPDCG71|MPDC1006|MP101DC|MPDC9000|MPDC905|MPDC706HD|MPDC706|MPDC705|MPDC110|MPDC100|MPDC99|MPDC97|MPDC88|MPDC8|MPDC77|MP709|MID701|MID711|MID170|MPDC703|MPQC1010\",\r\n        \"CelkonTablet\": \"CT695|CT888|CT[\\\\s]?910|CT7 Tab|CT9 Tab|CT3 Tab|CT2 Tab|CT1 Tab|C820|C720|\\\\bCT-1\\\\b\",\r\n        \"WolderTablet\": \"miTab \\\\b(DIAMOND|SPACE|BROOKLYN|NEO|FLY|MANHATTAN|FUNK|EVOLUTION|SKY|GOCAR|IRON|GENIUS|POP|MINT|EPSILON|BROADWAY|JUMP|HOP|LEGEND|NEW AGE|LINE|ADVANCE|FEEL|FOLLOW|LIKE|LINK|LIVE|THINK|FREEDOM|CHICAGO|CLEVELAND|BALTIMORE-GH|IOWA|BOSTON|SEATTLE|PHOENIX|DALLAS|IN 101|MasterChef)\\\\b\",\r\n        \"MediacomTablet\": \"M-MPI10C3G|M-SP10EG|M-SP10EGP|M-SP10HXAH|M-SP7HXAH|M-SP10HXBH|M-SP8HXAH|M-SP8MXA\",\r\n        \"MiTablet\": \"\\\\bMI PAD\\\\b|\\\\bHM NOTE 1W\\\\b\",\r\n        \"NibiruTablet\": \"Nibiru M1|Nibiru Jupiter One\",\r\n        \"NexoTablet\": \"NEXO NOVA|NEXO 10|NEXO AVIO|NEXO FREE|NEXO GO|NEXO EVO|NEXO 3G|NEXO SMART|NEXO KIDDO|NEXO MOBI\",\r\n        \"LeaderTablet\": \"TBLT10Q|TBLT10I|TBL-10WDKB|TBL-10WDKBO2013|TBL-W230V2|TBL-W450|TBL-W500|SV572|TBLT7I|TBA-AC7-8G|TBLT79|TBL-8W16|TBL-10W32|TBL-10WKB|TBL-W100\",\r\n        \"UbislateTablet\": \"UbiSlate[\\\\s]?7C\",\r\n        \"PocketBookTablet\": \"Pocketbook\",\r\n        \"KocasoTablet\": \"\\\\b(TB-1207)\\\\b\",\r\n        \"HisenseTablet\": \"\\\\b(F5281|E2371)\\\\b\",\r\n        \"Hudl\": \"Hudl HT7S3|Hudl 2\",\r\n        \"TelstraTablet\": \"T-Hub2\",\r\n        \"GenericTablet\": \"Android.*\\\\b97D\\\\b|Tablet(?!.*PC)|BNTV250A|MID-WCDMA|LogicPD Zoom2|\\\\bA7EB\\\\b|CatNova8|A1_07|CT704|CT1002|\\\\bM721\\\\b|rk30sdk|\\\\bEVOTAB\\\\b|M758A|ET904|ALUMIUM10|Smartfren Tab|Endeavour 1010|Tablet-PC-4|Tagi Tab|\\\\bM6pro\\\\b|CT1020W|arc 10HD|\\\\bTP750\\\\b|\\\\bQTAQZ3\\\\b|WVT101|TM1088|KT107\"\r\n    },\r\n    \"oss\": {\r\n        \"AndroidOS\": \"Android\",\r\n        \"BlackBerryOS\": \"blackberry|\\\\bBB10\\\\b|rim tablet os\",\r\n        \"PalmOS\": \"PalmOS|avantgo|blazer|elaine|hiptop|palm|plucker|xiino\",\r\n        \"SymbianOS\": \"Symbian|SymbOS|Series60|Series40|SYB-[0-9]+|\\\\bS60\\\\b\",\r\n        \"WindowsMobileOS\": \"Windows CE.*(PPC|Smartphone|Mobile|[0-9]{3}x[0-9]{3})|Windows Mobile|Windows Phone [0-9.]+|WCE;\",\r\n        \"WindowsPhoneOS\": \"Windows Phone 10.0|Windows Phone 8.1|Windows Phone 8.0|Windows Phone OS|XBLWP7|ZuneWP7|Windows NT 6.[23]; ARM;\",\r\n        \"iOS\": \"\\\\biPhone.*Mobile|\\\\biPod|\\\\biPad|AppleCoreMedia\",\r\n        \"iPadOS\": \"CPU OS 13\",\r\n        \"MeeGoOS\": \"MeeGo\",\r\n        \"MaemoOS\": \"Maemo\",\r\n        \"JavaOS\": \"J2ME\\/|\\\\bMIDP\\\\b|\\\\bCLDC\\\\b\",\r\n        \"webOS\": \"webOS|hpwOS\",\r\n        \"badaOS\": \"\\\\bBada\\\\b\",\r\n        \"BREWOS\": \"BREW\"\r\n    },\r\n    \"uas\": {\r\n        \"Chrome\": \"\\\\bCrMo\\\\b|CriOS|Android.*Chrome\\/[.0-9]* (Mobile)?\",\r\n        \"Dolfin\": \"\\\\bDolfin\\\\b\",\r\n        \"Opera\": \"Opera.*Mini|Opera.*Mobi|Android.*Opera|Mobile.*OPR\\/[0-9.]+$|Coast\\/[0-9.]+\",\r\n        \"Skyfire\": \"Skyfire\",\r\n        \"Edge\": \"Mobile Safari\\/[.0-9]* Edge\",\r\n        \"IE\": \"IEMobile|MSIEMobile\",\r\n        \"Firefox\": \"fennec|firefox.*maemo|(Mobile|Tablet).*Firefox|Firefox.*Mobile|FxiOS\",\r\n        \"Bolt\": \"bolt\",\r\n        \"TeaShark\": \"teashark\",\r\n        \"Blazer\": \"Blazer\",\r\n        \"Safari\": \"Version.*Mobile.*Safari|Safari.*Mobile|MobileSafari\",\r\n        \"WeChat\": \"\\\\bMicroMessenger\\\\b\",\r\n        \"UCBrowser\": \"UC.*Browser|UCWEB\",\r\n        \"baiduboxapp\": \"baiduboxapp\",\r\n        \"baidubrowser\": \"baidubrowser\",\r\n        \"DiigoBrowser\": \"DiigoBrowser\",\r\n        \"Mercury\": \"\\\\bMercury\\\\b\",\r\n        \"ObigoBrowser\": \"Obigo\",\r\n        \"NetFront\": \"NF-Browser\",\r\n        \"GenericBrowser\": \"NokiaBrowser|OviBrowser|OneBrowser|TwonkyBeamBrowser|SEMC.*Browser|FlyFlow|Minimo|NetFront|Novarra-Vision|MQQBrowser|MicroMessenger\",\r\n        \"PaleMoon\": \"Android.*PaleMoon|Mobile.*PaleMoon\"\r\n    },\r\n    \"props\": {\r\n        \"Mobile\": \"Mobile\\/[VER]\",\r\n        \"Build\": \"Build\\/[VER]\",\r\n        \"Version\": \"Version\\/[VER]\",\r\n        \"VendorID\": \"VendorID\\/[VER]\",\r\n        \"iPad\": \"iPad.*CPU[a-z ]+[VER]\",\r\n        \"iPhone\": \"iPhone.*CPU[a-z ]+[VER]\",\r\n        \"iPod\": \"iPod.*CPU[a-z ]+[VER]\",\r\n        \"Kindle\": \"Kindle\\/[VER]\",\r\n        \"Chrome\": [\r\n            \"Chrome\\/[VER]\",\r\n            \"CriOS\\/[VER]\",\r\n            \"CrMo\\/[VER]\"\r\n        ],\r\n        \"Coast\": [\r\n            \"Coast\\/[VER]\"\r\n        ],\r\n        \"Dolfin\": \"Dolfin\\/[VER]\",\r\n        \"Firefox\": [\r\n            \"Firefox\\/[VER]\",\r\n            \"FxiOS\\/[VER]\"\r\n        ],\r\n        \"Fennec\": \"Fennec\\/[VER]\",\r\n        \"Edge\": \"Edge\\/[VER]\",\r\n        \"IE\": [\r\n            \"IEMobile\\/[VER];\",\r\n            \"IEMobile [VER]\",\r\n            \"MSIE [VER];\",\r\n            \"Trident\\/[0-9.]+;.*rv:[VER]\"\r\n        ],\r\n        \"NetFront\": \"NetFront\\/[VER]\",\r\n        \"NokiaBrowser\": \"NokiaBrowser\\/[VER]\",\r\n        \"Opera\": [\r\n            \" OPR\\/[VER]\",\r\n            \"Opera Mini\\/[VER]\",\r\n            \"Version\\/[VER]\"\r\n        ],\r\n        \"Opera Mini\": \"Opera Mini\\/[VER]\",\r\n        \"Opera Mobi\": \"Version\\/[VER]\",\r\n        \"UCBrowser\": [\r\n            \"UCWEB[VER]\",\r\n            \"UC.*Browser\\/[VER]\"\r\n        ],\r\n        \"MQQBrowser\": \"MQQBrowser\\/[VER]\",\r\n        \"MicroMessenger\": \"MicroMessenger\\/[VER]\",\r\n        \"baiduboxapp\": \"baiduboxapp\\/[VER]\",\r\n        \"baidubrowser\": \"baidubrowser\\/[VER]\",\r\n        \"SamsungBrowser\": \"SamsungBrowser\\/[VER]\",\r\n        \"Iron\": \"Iron\\/[VER]\",\r\n        \"Safari\": [\r\n            \"Version\\/[VER]\",\r\n            \"Safari\\/[VER]\"\r\n        ],\r\n        \"Skyfire\": \"Skyfire\\/[VER]\",\r\n        \"Tizen\": \"Tizen\\/[VER]\",\r\n        \"Webkit\": \"webkit[ \\/][VER]\",\r\n        \"PaleMoon\": \"PaleMoon\\/[VER]\",\r\n        \"Gecko\": \"Gecko\\/[VER]\",\r\n        \"Trident\": \"Trident\\/[VER]\",\r\n        \"Presto\": \"Presto\\/[VER]\",\r\n        \"Goanna\": \"Goanna\\/[VER]\",\r\n        \"iOS\": \" \\\\bi?OS\\\\b [VER][ ;]{1}\",\r\n        \"Android\": \"Android [VER]\",\r\n        \"BlackBerry\": [\r\n            \"BlackBerry[\\\\w]+\\/[VER]\",\r\n            \"BlackBerry.*Version\\/[VER]\",\r\n            \"Version\\/[VER]\"\r\n        ],\r\n        \"BREW\": \"BREW [VER]\",\r\n        \"Java\": \"Java\\/[VER]\",\r\n        \"Windows Phone OS\": [\r\n            \"Windows Phone OS [VER]\",\r\n            \"Windows Phone [VER]\"\r\n        ],\r\n        \"Windows Phone\": \"Windows Phone [VER]\",\r\n        \"Windows CE\": \"Windows CE\\/[VER]\",\r\n        \"Windows NT\": \"Windows NT [VER]\",\r\n        \"Symbian\": [\r\n            \"SymbianOS\\/[VER]\",\r\n            \"Symbian\\/[VER]\"\r\n        ],\r\n        \"webOS\": [\r\n            \"webOS\\/[VER]\",\r\n            \"hpwOS\\/[VER];\"\r\n        ]\r\n    },\r\n    \"utils\": {\r\n        \"Bot\": \"Googlebot|facebookexternalhit|Google-AMPHTML|s~amp-validator|AdsBot-Google|Google Keyword Suggestion|Facebot|YandexBot|YandexMobileBot|bingbot|ia_archiver|AhrefsBot|Ezooms|GSLFbot|WBSearchBot|Twitterbot|TweetmemeBot|Twikle|PaperLiBot|Wotbox|UnwindFetchor|Exabot|MJ12bot|YandexImages|TurnitinBot|Pingdom|contentkingapp\",\r\n        \"MobileBot\": \"Googlebot-Mobile|AdsBot-Google-Mobile|YahooSeeker\\/M1A1-R2D2\",\r\n        \"DesktopMode\": \"WPDesktop\",\r\n        \"TV\": \"SonyDTV|HbbTV\",\r\n        \"WebKit\": \"(webkit)[ \\/]([\\\\w.]+)\",\r\n        \"Console\": \"\\\\b(Nintendo|Nintendo WiiU|Nintendo 3DS|Nintendo Switch|PLAYSTATION|Xbox)\\\\b\",\r\n        \"Watch\": \"SM-V700\"\r\n    }\r\n};\r\n\r\n    // following patterns come from http://detectmobilebrowsers.com/\r\n    impl.detectMobileBrowsers = {\r\n        fullPattern: /(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i,\r\n        shortPattern: /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i,\r\n        tabletPattern: /android|ipad|playbook|silk/i\r\n    };\r\n\r\n    var hasOwnProp = Object.prototype.hasOwnProperty,\r\n        isArray;\r\n\r\n    impl.FALLBACK_PHONE = 'UnknownPhone';\r\n    impl.FALLBACK_TABLET = 'UnknownTablet';\r\n    impl.FALLBACK_MOBILE = 'UnknownMobile';\r\n\r\n    isArray = ('isArray' in Array) ?\r\n        Array.isArray : function (value) { return Object.prototype.toString.call(value) === '[object Array]'; };\r\n\r\n    function equalIC(a, b) {\r\n        return a != null && b != null && a.toLowerCase() === b.toLowerCase();\r\n    }\r\n\r\n    function containsIC(array, value) {\r\n        var valueLC, i, len = array.length;\r\n        if (!len || !value) {\r\n            return false;\r\n        }\r\n        valueLC = value.toLowerCase();\r\n        for (i = 0; i < len; ++i) {\r\n            if (valueLC === array[i].toLowerCase()) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function convertPropsToRegExp(object) {\r\n        for (var key in object) {\r\n            if (hasOwnProp.call(object, key)) {\r\n                object[key] = new RegExp(object[key], 'i');\r\n            }\r\n        }\r\n    }\r\n\r\n    function prepareUserAgent(userAgent) {\r\n        return (userAgent || '').substr(0, 500); // mitigate vulnerable to ReDoS\r\n    }\r\n\r\n    (function init() {\r\n        var key, values, value, i, len, verPos, mobileDetectRules = impl.mobileDetectRules;\r\n        for (key in mobileDetectRules.props) {\r\n            if (hasOwnProp.call(mobileDetectRules.props, key)) {\r\n                values = mobileDetectRules.props[key];\r\n                if (!isArray(values)) {\r\n                    values = [values];\r\n                }\r\n                len = values.length;\r\n                for (i = 0; i < len; ++i) {\r\n                    value = values[i];\r\n                    verPos = value.indexOf('[VER]');\r\n                    if (verPos >= 0) {\r\n                        value = value.substring(0, verPos) + '([\\\\w._\\\\+]+)' + value.substring(verPos + 5);\r\n                    }\r\n                    values[i] = new RegExp(value, 'i');\r\n                }\r\n                mobileDetectRules.props[key] = values;\r\n            }\r\n        }\r\n        convertPropsToRegExp(mobileDetectRules.oss);\r\n        convertPropsToRegExp(mobileDetectRules.phones);\r\n        convertPropsToRegExp(mobileDetectRules.tablets);\r\n        convertPropsToRegExp(mobileDetectRules.uas);\r\n        convertPropsToRegExp(mobileDetectRules.utils);\r\n\r\n        // copy some patterns to oss0 which are tested first (see issue#15)\r\n        mobileDetectRules.oss0 = {\r\n            WindowsPhoneOS: mobileDetectRules.oss.WindowsPhoneOS,\r\n            WindowsMobileOS: mobileDetectRules.oss.WindowsMobileOS\r\n        };\r\n    }());\r\n\r\n    /**\r\n     * Test userAgent string against a set of rules and find the first matched key.\r\n     * @param {Object} rules (key is String, value is RegExp)\r\n     * @param {String} userAgent the navigator.userAgent (or HTTP-Header 'User-Agent').\r\n     * @returns {String|null} the matched key if found, otherwise <tt>null</tt>\r\n     * @private\r\n     */\r\n    impl.findMatch = function(rules, userAgent) {\r\n        for (var key in rules) {\r\n            if (hasOwnProp.call(rules, key)) {\r\n                if (rules[key].test(userAgent)) {\r\n                    return key;\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * Test userAgent string against a set of rules and return an array of matched keys.\r\n     * @param {Object} rules (key is String, value is RegExp)\r\n     * @param {String} userAgent the navigator.userAgent (or HTTP-Header 'User-Agent').\r\n     * @returns {Array} an array of matched keys, may be empty when there is no match, but not <tt>null</tt>\r\n     * @private\r\n     */\r\n    impl.findMatches = function(rules, userAgent) {\r\n        var result = [];\r\n        for (var key in rules) {\r\n            if (hasOwnProp.call(rules, key)) {\r\n                if (rules[key].test(userAgent)) {\r\n                    result.push(key);\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n\r\n    /**\r\n     * Check the version of the given property in the User-Agent.\r\n     *\r\n     * @param {String} propertyName\r\n     * @param {String} userAgent\r\n     * @return {String} version or <tt>null</tt> if version not found\r\n     * @private\r\n     */\r\n    impl.getVersionStr = function (propertyName, userAgent) {\r\n        var props = impl.mobileDetectRules.props, patterns, i, len, match;\r\n        if (hasOwnProp.call(props, propertyName)) {\r\n            patterns = props[propertyName];\r\n            len = patterns.length;\r\n            for (i = 0; i < len; ++i) {\r\n                match = patterns[i].exec(userAgent);\r\n                if (match !== null) {\r\n                    return match[1];\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * Check the version of the given property in the User-Agent.\r\n     * Will return a float number. (eg. 2_0 will return 2.0, 4.3.1 will return 4.31)\r\n     *\r\n     * @param {String} propertyName\r\n     * @param {String} userAgent\r\n     * @return {Number} version or <tt>NaN</tt> if version not found\r\n     * @private\r\n     */\r\n    impl.getVersion = function (propertyName, userAgent) {\r\n        var version = impl.getVersionStr(propertyName, userAgent);\r\n        return version ? impl.prepareVersionNo(version) : NaN;\r\n    };\r\n\r\n    /**\r\n     * Prepare the version number.\r\n     *\r\n     * @param {String} version\r\n     * @return {Number} the version number as a floating number\r\n     * @private\r\n     */\r\n    impl.prepareVersionNo = function (version) {\r\n        var numbers;\r\n\r\n        numbers = version.split(/[a-z._ \\/\\-]/i);\r\n        if (numbers.length === 1) {\r\n            version = numbers[0];\r\n        }\r\n        if (numbers.length > 1) {\r\n            version = numbers[0] + '.';\r\n            numbers.shift();\r\n            version += numbers.join('');\r\n        }\r\n        return Number(version);\r\n    };\r\n\r\n    impl.isMobileFallback = function (userAgent) {\r\n        return impl.detectMobileBrowsers.fullPattern.test(userAgent) ||\r\n            impl.detectMobileBrowsers.shortPattern.test(userAgent.substr(0,4));\r\n    };\r\n\r\n    impl.isTabletFallback = function (userAgent) {\r\n        return impl.detectMobileBrowsers.tabletPattern.test(userAgent);\r\n    };\r\n\r\n    impl.prepareDetectionCache = function (cache, userAgent, maxPhoneWidth) {\r\n        if (cache.mobile !== undefined) {\r\n            return;\r\n        }\r\n        var phone, tablet, phoneSized;\r\n\r\n        // first check for stronger tablet rules, then phone (see issue#5)\r\n        tablet = impl.findMatch(impl.mobileDetectRules.tablets, userAgent);\r\n        if (tablet) {\r\n            cache.mobile = cache.tablet = tablet;\r\n            cache.phone = null;\r\n            return; // unambiguously identified as tablet\r\n        }\r\n\r\n        phone = impl.findMatch(impl.mobileDetectRules.phones, userAgent);\r\n        if (phone) {\r\n            cache.mobile = cache.phone = phone;\r\n            cache.tablet = null;\r\n            return; // unambiguously identified as phone\r\n        }\r\n\r\n        // our rules haven't found a match -> try more general fallback rules\r\n        if (impl.isMobileFallback(userAgent)) {\r\n            phoneSized = MobileDetect.isPhoneSized(maxPhoneWidth);\r\n            if (phoneSized === undefined) {\r\n                cache.mobile = impl.FALLBACK_MOBILE;\r\n                cache.tablet = cache.phone = null;\r\n            } else if (phoneSized) {\r\n                cache.mobile = cache.phone = impl.FALLBACK_PHONE;\r\n                cache.tablet = null;\r\n            } else {\r\n                cache.mobile = cache.tablet = impl.FALLBACK_TABLET;\r\n                cache.phone = null;\r\n            }\r\n        } else if (impl.isTabletFallback(userAgent)) {\r\n            cache.mobile = cache.tablet = impl.FALLBACK_TABLET;\r\n            cache.phone = null;\r\n        } else {\r\n            // not mobile at all!\r\n            cache.mobile = cache.tablet = cache.phone = null;\r\n        }\r\n    };\r\n\r\n    // t is a reference to a MobileDetect instance\r\n    impl.mobileGrade = function (t) {\r\n        // impl note:\r\n        // To keep in sync w/ Mobile_Detect.php easily, the following code is tightly aligned to the PHP version.\r\n        // When changes are made in Mobile_Detect.php, copy this method and replace:\r\n        //     $this-> / t.\r\n        //     self::MOBILE_GRADE_(.) / '$1'\r\n        //     , self::VERSION_TYPE_FLOAT / (nothing)\r\n        //     isIOS() / os('iOS')\r\n        //     [reg] / (nothing)   <-- jsdelivr complaining about unescaped unicode character U+00AE\r\n        var $isMobile = t.mobile() !== null;\r\n\r\n        if (\r\n            // Apple iOS 3.2-5.1 - Tested on the original iPad (4.3 / 5.0), iPad 2 (4.3), iPad 3 (5.1), original iPhone (3.1), iPhone 3 (3.2), 3GS (4.3), 4 (4.3 / 5.0), and 4S (5.1)\r\n            t.os('iOS') && t.version('iPad')>=4.3 ||\r\n            t.os('iOS') && t.version('iPhone')>=3.1 ||\r\n            t.os('iOS') && t.version('iPod')>=3.1 ||\r\n\r\n            // Android 2.1-2.3 - Tested on the HTC Incredible (2.2), original Droid (2.2), HTC Aria (2.1), Google Nexus S (2.3). Functional on 1.5 & 1.6 but performance may be sluggish, tested on Google G1 (1.5)\r\n            // Android 3.1 (Honeycomb)  - Tested on the Samsung Galaxy Tab 10.1 and Motorola XOOM\r\n            // Android 4.0 (ICS)  - Tested on a Galaxy Nexus. Note: transition performance can be poor on upgraded devices\r\n            // Android 4.1 (Jelly Bean)  - Tested on a Galaxy Nexus and Galaxy 7\r\n            ( t.version('Android')>2.1 && t.is('Webkit') ) ||\r\n\r\n            // Windows Phone 7-7.5 - Tested on the HTC Surround (7.0) HTC Trophy (7.5), LG-E900 (7.5), Nokia Lumia 800\r\n            t.version('Windows Phone OS')>=7.0 ||\r\n\r\n            // Blackberry 7 - Tested on BlackBerry Torch 9810\r\n            // Blackberry 6.0 - Tested on the Torch 9800 and Style 9670\r\n            t.is('BlackBerry') && t.version('BlackBerry')>=6.0 ||\r\n            // Blackberry Playbook (1.0-2.0) - Tested on PlayBook\r\n            t.match('Playbook.*Tablet') ||\r\n\r\n            // Palm WebOS (1.4-2.0) - Tested on the Palm Pixi (1.4), Pre (1.4), Pre 2 (2.0)\r\n            ( t.version('webOS')>=1.4 && t.match('Palm|Pre|Pixi') ) ||\r\n            // Palm WebOS 3.0  - Tested on HP TouchPad\r\n            t.match('hp.*TouchPad') ||\r\n\r\n            // Firefox Mobile (12 Beta) - Tested on Android 2.3 device\r\n            ( t.is('Firefox') && t.version('Firefox')>=12 ) ||\r\n\r\n            // Chrome for Android - Tested on Android 4.0, 4.1 device\r\n            ( t.is('Chrome') && t.is('AndroidOS') && t.version('Android')>=4.0 ) ||\r\n\r\n            // Skyfire 4.1 - Tested on Android 2.3 device\r\n            ( t.is('Skyfire') && t.version('Skyfire')>=4.1 && t.is('AndroidOS') && t.version('Android')>=2.3 ) ||\r\n\r\n            // Opera Mobile 11.5-12: Tested on Android 2.3\r\n            ( t.is('Opera') && t.version('Opera Mobi')>11 && t.is('AndroidOS') ) ||\r\n\r\n            // Meego 1.2 - Tested on Nokia 950 and N9\r\n            t.is('MeeGoOS') ||\r\n\r\n            // Tizen (pre-release) - Tested on early hardware\r\n            t.is('Tizen') ||\r\n\r\n            // Samsung Bada 2.0 - Tested on a Samsung Wave 3, Dolphin browser\r\n            // @todo: more tests here!\r\n            t.is('Dolfin') && t.version('Bada')>=2.0 ||\r\n\r\n            // UC Browser - Tested on Android 2.3 device\r\n            ( (t.is('UC Browser') || t.is('Dolfin')) && t.version('Android')>=2.3 ) ||\r\n\r\n            // Kindle 3 and Fire  - Tested on the built-in WebKit browser for each\r\n            ( t.match('Kindle Fire') ||\r\n                t.is('Kindle') && t.version('Kindle')>=3.0 ) ||\r\n\r\n            // Nook Color 1.4.1 - Tested on original Nook Color, not Nook Tablet\r\n            t.is('AndroidOS') && t.is('NookTablet') ||\r\n\r\n            // Chrome Desktop 11-21 - Tested on OS X 10.7 and Windows 7\r\n            t.version('Chrome')>=11 && !$isMobile ||\r\n\r\n            // Safari Desktop 4-5 - Tested on OS X 10.7 and Windows 7\r\n            t.version('Safari')>=5.0 && !$isMobile ||\r\n\r\n            // Firefox Desktop 4-13 - Tested on OS X 10.7 and Windows 7\r\n            t.version('Firefox')>=4.0 && !$isMobile ||\r\n\r\n            // Internet Explorer 7-9 - Tested on Windows XP, Vista and 7\r\n            t.version('MSIE')>=7.0 && !$isMobile ||\r\n\r\n            // Opera Desktop 10-12 - Tested on OS X 10.7 and Windows 7\r\n            // @reference: http://my.opera.com/community/openweb/idopera/\r\n            t.version('Opera')>=10 && !$isMobile\r\n\r\n            ){\r\n            return 'A';\r\n        }\r\n\r\n        if (\r\n            t.os('iOS') && t.version('iPad')<4.3 ||\r\n            t.os('iOS') && t.version('iPhone')<3.1 ||\r\n            t.os('iOS') && t.version('iPod')<3.1 ||\r\n\r\n            // Blackberry 5.0: Tested on the Storm 2 9550, Bold 9770\r\n            t.is('Blackberry') && t.version('BlackBerry')>=5 && t.version('BlackBerry')<6 ||\r\n\r\n            //Opera Mini (5.0-6.5) - Tested on iOS 3.2/4.3 and Android 2.3\r\n            ( t.version('Opera Mini')>=5.0 && t.version('Opera Mini')<=6.5 &&\r\n                (t.version('Android')>=2.3 || t.is('iOS')) ) ||\r\n\r\n            // Nokia Symbian^3 - Tested on Nokia N8 (Symbian^3), C7 (Symbian^3), also works on N97 (Symbian^1)\r\n            t.match('NokiaN8|NokiaC7|N97.*Series60|Symbian/3') ||\r\n\r\n            // @todo: report this (tested on Nokia N71)\r\n            t.version('Opera Mobi')>=11 && t.is('SymbianOS')\r\n            ){\r\n            return 'B';\r\n        }\r\n\r\n        if (\r\n        // Blackberry 4.x - Tested on the Curve 8330\r\n            t.version('BlackBerry')<5.0 ||\r\n            // Windows Mobile - Tested on the HTC Leo (WinMo 5.2)\r\n            t.match('MSIEMobile|Windows CE.*Mobile') || t.version('Windows Mobile')<=5.2\r\n\r\n            ){\r\n            return 'C';\r\n        }\r\n\r\n        //All older smartphone platforms and featurephones - Any device that doesn't support media queries\r\n        //will receive the basic, C grade experience.\r\n        return 'C';\r\n    };\r\n\r\n    impl.detectOS = function (ua) {\r\n        return impl.findMatch(impl.mobileDetectRules.oss0, ua) ||\r\n            impl.findMatch(impl.mobileDetectRules.oss, ua);\r\n    };\r\n\r\n    impl.getDeviceSmallerSide = function () {\r\n        return window.screen.width < window.screen.height ?\r\n            window.screen.width :\r\n            window.screen.height;\r\n    };\r\n\r\n    /**\r\n     * Constructor for MobileDetect object.\r\n     * <br>\r\n     * Such an object will keep a reference to the given user-agent string and cache most of the detect queries.<br>\r\n     * <div style=\"background-color: #d9edf7; border: 1px solid #bce8f1; color: #3a87ad; padding: 14px; border-radius: 2px; margin-top: 20px\">\r\n     *     <strong>Find information how to download and install:</strong>\r\n     *     <a href=\"https://github.com/hgoebl/mobile-detect.js/\">github.com/hgoebl/mobile-detect.js/</a>\r\n     * </div>\r\n     *\r\n     * @example <pre>\r\n     *     var md = new MobileDetect(window.navigator.userAgent);\r\n     *     if (md.mobile()) {\r\n     *         location.href = (md.mobileGrade() === 'A') ? '/mobile/' : '/lynx/';\r\n     *     }\r\n     * </pre>\r\n     *\r\n     * @param {string} userAgent typically taken from window.navigator.userAgent or http_header['User-Agent']\r\n     * @param {number} [maxPhoneWidth=600] <strong>only for browsers</strong> specify a value for the maximum\r\n     *        width of smallest device side (in logical \"CSS\" pixels) until a device detected as mobile will be handled\r\n     *        as phone.\r\n     *        This is only used in cases where the device cannot be classified as phone or tablet.<br>\r\n     *        See <a href=\"http://developer.android.com/guide/practices/screens_support.html\">Declaring Tablet Layouts\r\n     *        for Android</a>.<br>\r\n     *        If you provide a value < 0, then this \"fuzzy\" check is disabled.\r\n     * @constructor\r\n     * @global\r\n     */\r\n    function MobileDetect(userAgent, maxPhoneWidth) {\r\n        this.ua = prepareUserAgent(userAgent);\r\n        this._cache = {};\r\n        //600dp is typical 7\" tablet minimum width\r\n        this.maxPhoneWidth = maxPhoneWidth || 600;\r\n    }\r\n\r\n    MobileDetect.prototype = {\r\n        constructor: MobileDetect,\r\n\r\n        /**\r\n         * Returns the detected phone or tablet type or <tt>null</tt> if it is not a mobile device.\r\n         * <br>\r\n         * For a list of possible return values see {@link MobileDetect#phone} and {@link MobileDetect#tablet}.<br>\r\n         * <br>\r\n         * If the device is not detected by the regular expressions from Mobile-Detect, a test is made against\r\n         * the patterns of <a href=\"http://detectmobilebrowsers.com/\">detectmobilebrowsers.com</a>. If this test\r\n         * is positive, a value of <code>UnknownPhone</code>, <code>UnknownTablet</code> or\r\n         * <code>UnknownMobile</code> is returned.<br>\r\n         * When used in browser, the decision whether phone or tablet is made based on <code>screen.width/height</code>.<br>\r\n         * <br>\r\n         * When used server-side (node.js), there is no way to tell the difference between <code>UnknownTablet</code>\r\n         * and <code>UnknownMobile</code>, so you will get <code>UnknownMobile</code> here.<br>\r\n         * Be aware that since v1.0.0 in this special case you will get <code>UnknownMobile</code> only for:\r\n         * {@link MobileDetect#mobile}, not for {@link MobileDetect#phone} and {@link MobileDetect#tablet}.\r\n         * In versions before v1.0.0 all 3 methods returned <code>UnknownMobile</code> which was tedious to use.\r\n         * <br>\r\n         * In most cases you will use the return value just as a boolean.\r\n         *\r\n         * @returns {String} the key for the phone family or tablet family, e.g. \"Nexus\".\r\n         * @function MobileDetect#mobile\r\n         */\r\n        mobile: function () {\r\n            impl.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth);\r\n            return this._cache.mobile;\r\n        },\r\n\r\n        /**\r\n         * Returns the detected phone type/family string or <tt>null</tt>.\r\n         * <br>\r\n         * The returned tablet (family or producer) is one of following keys:<br>\r\n         * <br><tt>iPhone, BlackBerry, HTC, Nexus, Dell, Motorola, Samsung, LG, Sony, Asus,\r\n         * NokiaLumia, Micromax, Palm, Vertu, Pantech, Fly, Wiko, iMobile, SimValley,\r\n         * Wolfgang, Alcatel, Nintendo, Amoi, INQ, OnePlus, GenericPhone</tt><br>\r\n         * <br>\r\n         * If the device is not detected by the regular expressions from Mobile-Detect, a test is made against\r\n         * the patterns of <a href=\"http://detectmobilebrowsers.com/\">detectmobilebrowsers.com</a>. If this test\r\n         * is positive, a value of <code>UnknownPhone</code> or <code>UnknownMobile</code> is returned.<br>\r\n         * When used in browser, the decision whether phone or tablet is made based on <code>screen.width/height</code>.<br>\r\n         * <br>\r\n         * When used server-side (node.js), there is no way to tell the difference between <code>UnknownTablet</code>\r\n         * and <code>UnknownMobile</code>, so you will get <code>null</code> here, while {@link MobileDetect#mobile}\r\n         * will return <code>UnknownMobile</code>.<br>\r\n         * Be aware that since v1.0.0 in this special case you will get <code>UnknownMobile</code> only for:\r\n         * {@link MobileDetect#mobile}, not for {@link MobileDetect#phone} and {@link MobileDetect#tablet}.\r\n         * In versions before v1.0.0 all 3 methods returned <code>UnknownMobile</code> which was tedious to use.\r\n         * <br>\r\n         * In most cases you will use the return value just as a boolean.\r\n         *\r\n         * @returns {String} the key of the phone family or producer, e.g. \"iPhone\"\r\n         * @function MobileDetect#phone\r\n         */\r\n        phone: function () {\r\n            impl.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth);\r\n            return this._cache.phone;\r\n        },\r\n\r\n        /**\r\n         * Returns the detected tablet type/family string or <tt>null</tt>.\r\n         * <br>\r\n         * The returned tablet (family or producer) is one of following keys:<br>\r\n         * <br><tt>iPad, NexusTablet, GoogleTablet, SamsungTablet, Kindle, SurfaceTablet,\r\n         * HPTablet, AsusTablet, BlackBerryTablet, HTCtablet, MotorolaTablet, NookTablet,\r\n         * AcerTablet, ToshibaTablet, LGTablet, FujitsuTablet, PrestigioTablet,\r\n         * LenovoTablet, DellTablet, YarvikTablet, MedionTablet, ArnovaTablet,\r\n         * IntensoTablet, IRUTablet, MegafonTablet, EbodaTablet, AllViewTablet,\r\n         * ArchosTablet, AinolTablet, NokiaLumiaTablet, SonyTablet, PhilipsTablet,\r\n         * CubeTablet, CobyTablet, MIDTablet, MSITablet, SMiTTablet, RockChipTablet,\r\n         * FlyTablet, bqTablet, HuaweiTablet, NecTablet, PantechTablet, BronchoTablet,\r\n         * VersusTablet, ZyncTablet, PositivoTablet, NabiTablet, KoboTablet, DanewTablet,\r\n         * TexetTablet, PlaystationTablet, TrekstorTablet, PyleAudioTablet, AdvanTablet,\r\n         * DanyTechTablet, GalapadTablet, MicromaxTablet, KarbonnTablet, AllFineTablet,\r\n         * PROSCANTablet, YONESTablet, ChangJiaTablet, GUTablet, PointOfViewTablet,\r\n         * OvermaxTablet, HCLTablet, DPSTablet, VistureTablet, CrestaTablet,\r\n         * MediatekTablet, ConcordeTablet, GoCleverTablet, ModecomTablet, VoninoTablet,\r\n         * ECSTablet, StorexTablet, VodafoneTablet, EssentielBTablet, RossMoorTablet,\r\n         * iMobileTablet, TolinoTablet, AudioSonicTablet, AMPETablet, SkkTablet,\r\n         * TecnoTablet, JXDTablet, iJoyTablet, FX2Tablet, XoroTablet, ViewsonicTablet,\r\n         * VerizonTablet, OdysTablet, CaptivaTablet, IconbitTablet, TeclastTablet,\r\n         * OndaTablet, JaytechTablet, BlaupunktTablet, DigmaTablet, EvolioTablet,\r\n         * LavaTablet, AocTablet, MpmanTablet, CelkonTablet, WolderTablet, MediacomTablet,\r\n         * MiTablet, NibiruTablet, NexoTablet, LeaderTablet, UbislateTablet,\r\n         * PocketBookTablet, KocasoTablet, HisenseTablet, Hudl, TelstraTablet,\r\n         * GenericTablet</tt><br>\r\n         * <br>\r\n         * If the device is not detected by the regular expressions from Mobile-Detect, a test is made against\r\n         * the patterns of <a href=\"http://detectmobilebrowsers.com/\">detectmobilebrowsers.com</a>. If this test\r\n         * is positive, a value of <code>UnknownTablet</code> or <code>UnknownMobile</code> is returned.<br>\r\n         * When used in browser, the decision whether phone or tablet is made based on <code>screen.width/height</code>.<br>\r\n         * <br>\r\n         * When used server-side (node.js), there is no way to tell the difference between <code>UnknownTablet</code>\r\n         * and <code>UnknownMobile</code>, so you will get <code>null</code> here, while {@link MobileDetect#mobile}\r\n         * will return <code>UnknownMobile</code>.<br>\r\n         * Be aware that since v1.0.0 in this special case you will get <code>UnknownMobile</code> only for:\r\n         * {@link MobileDetect#mobile}, not for {@link MobileDetect#phone} and {@link MobileDetect#tablet}.\r\n         * In versions before v1.0.0 all 3 methods returned <code>UnknownMobile</code> which was tedious to use.\r\n         * <br>\r\n         * In most cases you will use the return value just as a boolean.\r\n         *\r\n         * @returns {String} the key of the tablet family or producer, e.g. \"SamsungTablet\"\r\n         * @function MobileDetect#tablet\r\n         */\r\n        tablet: function () {\r\n            impl.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth);\r\n            return this._cache.tablet;\r\n        },\r\n\r\n        /**\r\n         * Returns the (first) detected user-agent string or <tt>null</tt>.\r\n         * <br>\r\n         * The returned user-agent is one of following keys:<br>\r\n         * <br><tt>Chrome, Dolfin, Opera, Skyfire, Edge, IE, Firefox, Bolt, TeaShark, Blazer,\r\n         * Safari, WeChat, UCBrowser, baiduboxapp, baidubrowser, DiigoBrowser, Mercury,\r\n         * ObigoBrowser, NetFront, GenericBrowser, PaleMoon</tt><br>\r\n         * <br>\r\n         * In most cases calling {@link MobileDetect#userAgent} will be sufficient. But there are rare\r\n         * cases where a mobile device pretends to be more than one particular browser. You can get the\r\n         * list of all matches with {@link MobileDetect#userAgents} or check for a particular value by\r\n         * providing one of the defined keys as first argument to {@link MobileDetect#is}.\r\n         *\r\n         * @returns {String} the key for the detected user-agent or <tt>null</tt>\r\n         * @function MobileDetect#userAgent\r\n         */\r\n        userAgent: function () {\r\n            if (this._cache.userAgent === undefined) {\r\n                this._cache.userAgent = impl.findMatch(impl.mobileDetectRules.uas, this.ua);\r\n            }\r\n            return this._cache.userAgent;\r\n        },\r\n\r\n        /**\r\n         * Returns all detected user-agent strings.\r\n         * <br>\r\n         * The array is empty or contains one or more of following keys:<br>\r\n         * <br><tt>Chrome, Dolfin, Opera, Skyfire, Edge, IE, Firefox, Bolt, TeaShark, Blazer,\r\n         * Safari, WeChat, UCBrowser, baiduboxapp, baidubrowser, DiigoBrowser, Mercury,\r\n         * ObigoBrowser, NetFront, GenericBrowser, PaleMoon</tt><br>\r\n         * <br>\r\n         * In most cases calling {@link MobileDetect#userAgent} will be sufficient. But there are rare\r\n         * cases where a mobile device pretends to be more than one particular browser. You can get the\r\n         * list of all matches with {@link MobileDetect#userAgents} or check for a particular value by\r\n         * providing one of the defined keys as first argument to {@link MobileDetect#is}.\r\n         *\r\n         * @returns {Array} the array of detected user-agent keys or <tt>[]</tt>\r\n         * @function MobileDetect#userAgents\r\n         */\r\n        userAgents: function () {\r\n            if (this._cache.userAgents === undefined) {\r\n                this._cache.userAgents = impl.findMatches(impl.mobileDetectRules.uas, this.ua);\r\n            }\r\n            return this._cache.userAgents;\r\n        },\r\n\r\n        /**\r\n         * Returns the detected operating system string or <tt>null</tt>.\r\n         * <br>\r\n         * The operating system is one of following keys:<br>\r\n         * <br><tt>AndroidOS, BlackBerryOS, PalmOS, SymbianOS, WindowsMobileOS, WindowsPhoneOS,\r\n         * iOS, iPadOS, MeeGoOS, MaemoOS, JavaOS, webOS, badaOS, BREWOS</tt><br>\r\n         *\r\n         * @returns {String} the key for the detected operating system.\r\n         * @function MobileDetect#os\r\n         */\r\n        os: function () {\r\n            if (this._cache.os === undefined) {\r\n                this._cache.os = impl.detectOS(this.ua);\r\n            }\r\n            return this._cache.os;\r\n        },\r\n\r\n        /**\r\n         * Get the version (as Number) of the given property in the User-Agent.\r\n         * <br>\r\n         * Will return a float number. (eg. 2_0 will return 2.0, 4.3.1 will return 4.31)\r\n         *\r\n         * @param {String} key a key defining a thing which has a version.<br>\r\n         *        You can use one of following keys:<br>\r\n         * <br><tt>Mobile, Build, Version, VendorID, iPad, iPhone, iPod, Kindle, Chrome, Coast,\r\n         * Dolfin, Firefox, Fennec, Edge, IE, NetFront, NokiaBrowser, Opera, Opera Mini,\r\n         * Opera Mobi, UCBrowser, MQQBrowser, MicroMessenger, baiduboxapp, baidubrowser,\r\n         * SamsungBrowser, Iron, Safari, Skyfire, Tizen, Webkit, PaleMoon, Gecko, Trident,\r\n         * Presto, Goanna, iOS, Android, BlackBerry, BREW, Java, Windows Phone OS, Windows\r\n         * Phone, Windows CE, Windows NT, Symbian, webOS</tt><br>\r\n         *\r\n         * @returns {Number} the version as float or <tt>NaN</tt> if User-Agent doesn't contain this version.\r\n         *          Be careful when comparing this value with '==' operator!\r\n         * @function MobileDetect#version\r\n         */\r\n        version: function (key) {\r\n            return impl.getVersion(key, this.ua);\r\n        },\r\n\r\n        /**\r\n         * Get the version (as String) of the given property in the User-Agent.\r\n         * <br>\r\n         *\r\n         * @param {String} key a key defining a thing which has a version.<br>\r\n         *        You can use one of following keys:<br>\r\n         * <br><tt>Mobile, Build, Version, VendorID, iPad, iPhone, iPod, Kindle, Chrome, Coast,\r\n         * Dolfin, Firefox, Fennec, Edge, IE, NetFront, NokiaBrowser, Opera, Opera Mini,\r\n         * Opera Mobi, UCBrowser, MQQBrowser, MicroMessenger, baiduboxapp, baidubrowser,\r\n         * SamsungBrowser, Iron, Safari, Skyfire, Tizen, Webkit, PaleMoon, Gecko, Trident,\r\n         * Presto, Goanna, iOS, Android, BlackBerry, BREW, Java, Windows Phone OS, Windows\r\n         * Phone, Windows CE, Windows NT, Symbian, webOS</tt><br>\r\n         *\r\n         * @returns {String} the \"raw\" version as String or <tt>null</tt> if User-Agent doesn't contain this version.\r\n         *\r\n         * @function MobileDetect#versionStr\r\n         */\r\n        versionStr: function (key) {\r\n            return impl.getVersionStr(key, this.ua);\r\n        },\r\n\r\n        /**\r\n         * Global test key against userAgent, os, phone, tablet and some other properties of userAgent string.\r\n         *\r\n         * @param {String} key the key (case-insensitive) of a userAgent, an operating system, phone or\r\n         *        tablet family.<br>\r\n         *        For a complete list of possible values, see {@link MobileDetect#userAgent},\r\n         *        {@link MobileDetect#os}, {@link MobileDetect#phone}, {@link MobileDetect#tablet}.<br>\r\n         *        Additionally you have following keys:<br>\r\n         * <br><tt>Bot, MobileBot, DesktopMode, TV, WebKit, Console, Watch</tt><br>\r\n         *\r\n         * @returns {boolean} <tt>true</tt> when the given key is one of the defined keys of userAgent, os, phone,\r\n         *                    tablet or one of the listed additional keys, otherwise <tt>false</tt>\r\n         * @function MobileDetect#is\r\n         */\r\n        is: function (key) {\r\n            return containsIC(this.userAgents(), key) ||\r\n                   equalIC(key, this.os()) ||\r\n                   equalIC(key, this.phone()) ||\r\n                   equalIC(key, this.tablet()) ||\r\n                   containsIC(impl.findMatches(impl.mobileDetectRules.utils, this.ua), key);\r\n        },\r\n\r\n        /**\r\n         * Do a quick test against navigator::userAgent.\r\n         *\r\n         * @param {String|RegExp} pattern the pattern, either as String or RegExp\r\n         *                        (a string will be converted to a case-insensitive RegExp).\r\n         * @returns {boolean} <tt>true</tt> when the pattern matches, otherwise <tt>false</tt>\r\n         * @function MobileDetect#match\r\n         */\r\n        match: function (pattern) {\r\n            if (!(pattern instanceof RegExp)) {\r\n                pattern = new RegExp(pattern, 'i');\r\n            }\r\n            return pattern.test(this.ua);\r\n        },\r\n\r\n        /**\r\n         * Checks whether the mobile device can be considered as phone regarding <code>screen.width</code>.\r\n         * <br>\r\n         * Obviously this method makes sense in browser environments only (not for Node.js)!\r\n         * @param {number} [maxPhoneWidth] the maximum logical pixels (aka. CSS-pixels) to be considered as phone.<br>\r\n         *        The argument is optional and if not present or falsy, the value of the constructor is taken.\r\n         * @returns {boolean|undefined} <code>undefined</code> if screen size wasn't detectable, else <code>true</code>\r\n         *          when screen.width is less or equal to maxPhoneWidth, otherwise <code>false</code>.<br>\r\n         *          Will always return <code>undefined</code> server-side.\r\n         */\r\n        isPhoneSized: function (maxPhoneWidth) {\r\n            return MobileDetect.isPhoneSized(maxPhoneWidth || this.maxPhoneWidth);\r\n        },\r\n\r\n        /**\r\n         * Returns the mobile grade ('A', 'B', 'C').\r\n         *\r\n         * @returns {String} one of the mobile grades ('A', 'B', 'C').\r\n         * @function MobileDetect#mobileGrade\r\n         */\r\n        mobileGrade: function () {\r\n            if (this._cache.grade === undefined) {\r\n                this._cache.grade = impl.mobileGrade(this);\r\n            }\r\n            return this._cache.grade;\r\n        }\r\n    };\r\n\r\n    // environment-dependent\r\n    if (typeof window !== 'undefined' && window.screen) {\r\n        MobileDetect.isPhoneSized = function (maxPhoneWidth) {\r\n            return maxPhoneWidth < 0 ? undefined : impl.getDeviceSmallerSide() <= maxPhoneWidth;\r\n        };\r\n    } else {\r\n        MobileDetect.isPhoneSized = function () {};\r\n    }\r\n\r\n    // should not be replaced by a completely new object - just overwrite existing methods\r\n    MobileDetect._impl = impl;\r\n    \r\n    MobileDetect.version = '1.4.4 2019-09-21';\r\n\r\n    return MobileDetect;\r\n}); // end of call of define()\r\n})((function (undefined) {\r\n    if (typeof module !== 'undefined' && module.exports) {\r\n        return function (factory) { module.exports = factory(); };\r\n    } else if (typeof define === 'function' && define.amd) {\r\n        return define;\r\n    } else if (typeof window !== 'undefined') {\r\n        return function (factory) { window.MobileDetect = factory(); };\r\n    } else {\r\n        // please file a bug if you get this error!\r\n        throw new Error('unknown environment');\r\n    }\r\n})());","// Copyright (c) 2013 Pieroxy <pieroxy@pieroxy.net>\r\n// This work is free. You can redistribute it and/or modify it\r\n// under the terms of the WTFPL, Version 2\r\n// For more information see LICENSE.txt or http://www.wtfpl.net/\r\n//\r\n// For more information, the home page:\r\n// http://pieroxy.net/blog/pages/lz-string/testing.html\r\n//\r\n// LZ-based compression algorithm, version 1.4.4\r\n\r\n// private property\r\nlet f = String.fromCharCode;\r\nlet keyStrBase64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\r\nlet keyStrUriSafe = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$\";\r\nlet baseReverseDic = {};\r\n\r\nfunction getBaseValue(alphabet, character) {\r\n  if (!baseReverseDic[alphabet]) {\r\n    baseReverseDic[alphabet] = {};\r\n    for (let i = 0; i < alphabet.length; i++) {\r\n      baseReverseDic[alphabet][alphabet.charAt(i)] = i;\r\n    }\r\n  }\r\n  return baseReverseDic[alphabet][character];\r\n}\r\n\r\nfunction getInput(input) {\r\n  if (input === null) {\r\n    return '';\r\n  } else if (input === '') {\r\n    return null;\r\n  }\r\n\r\n  if (typeof input === \"string\") {\r\n    return input;\r\n  }\r\n\r\n  if (input instanceof ArrayBuffer) {\r\n    input = new Uint8Array(input);\r\n  }\r\n\r\n  let s = '';\r\n  for (let i = 0; i < input.length; i++) {\r\n    s += String.fromCharCode(input[i]);\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nexport default {\r\n  compressToBase64: function (input) {\r\n    input = getInput(input);\r\n\r\n    if (!input) return \"\";\r\n\r\n    let res = this._compress(input, 6, function (a) {\r\n      return keyStrBase64.charAt(a);\r\n    });\r\n    switch (res.length%4) { // To produce valid Base64\r\n      default: // When could this happen ?\r\n      case 0 :\r\n        return res;\r\n      case 1 :\r\n        return res + \"===\";\r\n      case 2 :\r\n        return res + \"==\";\r\n      case 3 :\r\n        return res + \"=\";\r\n    }\r\n  },\r\n\r\n  decompressFromBase64: function (input) {\r\n    if (input === null) return \"\";\r\n    if (input === \"\") return null;\r\n\r\n    input = getInput(input);\r\n    return this._decompress(input.length, 32, function (index) {\r\n      return getBaseValue(keyStrBase64, input.charAt(index));\r\n    });\r\n  },\r\n\r\n  compressToUTF16: function (input) {\r\n    if (input === null) return \"\";\r\n\r\n    input = getInput(input);\r\n    return this._compress(input, 15, function (a) {\r\n      return f(a + 32);\r\n    }) + \" \";\r\n  },\r\n\r\n  decompressFromUTF16: function (compressed) {\r\n    if (compressed === null) return \"\";\r\n    if (compressed === \"\") return null;\r\n\r\n    compressed = getInput(compressed);\r\n    return this._decompress(compressed.length, 16384, function (index) {\r\n      return compressed.charCodeAt(index) - 32;\r\n    });\r\n  },\r\n\r\n  //compress into uint8array (UCS-2 big endian format)\r\n  compressToUint8Array: function (uncompressed) {\r\n    uncompressed = getInput(uncompressed);\r\n\r\n    let compressed = this.compress(uncompressed);\r\n    let buf = new Uint8Array(compressed.length*2); // 2 bytes per character\r\n\r\n    for (let i = 0, TotalLen = compressed.length; i < TotalLen; i++) {\r\n      let current_value = compressed.charCodeAt(i);\r\n      buf[i*2] = current_value>>>8;\r\n      buf[i*2 + 1] = current_value%256;\r\n    }\r\n    return buf;\r\n  },\r\n\r\n  //decompress from uint8array (UCS-2 big endian format)\r\n  decompressFromUint8Array: function (compressed) {\r\n    if (compressed === null || compressed === undefined) {\r\n      return this.decompress(compressed);\r\n    } else {\r\n      compressed = getInput(compressed);\r\n\r\n      let buf = new Array(compressed.length/2); // 2 bytes per character\r\n      for (let i = 0, TotalLen = buf.length; i < TotalLen; i++) {\r\n        buf[i] = compressed[i*2]*256 + compressed[i*2 + 1];\r\n      }\r\n\r\n      let result = [];\r\n      buf.forEach(function (c) {\r\n        result.push(f(c));\r\n      });\r\n      return this.decompress(result.join(''));\r\n\r\n    }\r\n\r\n  },\r\n\r\n\r\n  //compress into a string that is already URI encoded\r\n  compressToEncodedURIComponent: function (input) {\r\n    if (input === null) return \"\";\r\n    return this._compress(input, 6, function (a) {\r\n      return keyStrUriSafe.charAt(a);\r\n    });\r\n  },\r\n\r\n  //decompress from an output of compressToEncodedURIComponent\r\n  decompressFromEncodedURIComponent: function (input) {\r\n    if (input === null) return \"\";\r\n    if (input === \"\") return null;\r\n    input = input.replace(/ /g, \"+\");\r\n    return this._decompress(input.length, 32, function (index) {\r\n      return getBaseValue(keyStrUriSafe, input.charAt(index));\r\n    });\r\n  },\r\n\r\n  compress : function (uncompressed) {\r\n    return this._compress(uncompressed, 16, function (a) {\r\n      return f(a);\r\n    });\r\n  },\r\n\r\n  _compress: function (uncompressed, bitsPerChar, getCharFromInt) {\r\n    uncompressed = getInput(uncompressed);\r\n\r\n    if (uncompressed === null) return \"\";\r\n    let i, value, context_dictionary = {}, context_dictionaryToCreate = {}, context_c = \"\", context_wc = \"\",\r\n        context_w                                                                                      = \"\", context_enlargeIn = 2, // Compensate for the first entry which should not count\r\n        context_dictSize                                                                               = 3, context_numBits = 2, context_data                                        = [], context_data_val = 0,\r\n        context_data_position                                                                          = 0, ii;\r\n\r\n    for (ii = 0; ii < uncompressed.length; ii += 1) {\r\n      context_c = uncompressed.charAt(ii);\r\n      if (!Object.prototype.hasOwnProperty.call(context_dictionary, context_c)) {\r\n        context_dictionary[context_c] = context_dictSize++;\r\n        context_dictionaryToCreate[context_c] = true;\r\n      }\r\n\r\n      context_wc = context_w + context_c;\r\n      if (Object.prototype.hasOwnProperty.call(context_dictionary, context_wc)) {\r\n        context_w = context_wc;\r\n      } else {\r\n        if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate, context_w)) {\r\n          if (context_w.charCodeAt(0) < 256) {\r\n            for (i = 0; i < context_numBits; i++) {\r\n              context_data_val = (context_data_val<<1);\r\n              if (context_data_position === bitsPerChar - 1) {\r\n                context_data_position = 0;\r\n                context_data.push(getCharFromInt(context_data_val));\r\n                context_data_val = 0;\r\n              } else {\r\n                context_data_position++;\r\n              }\r\n            }\r\n            value = context_w.charCodeAt(0);\r\n            for (i = 0; i < 8; i++) {\r\n              context_data_val = (context_data_val<<1) | (value & 1);\r\n              if (context_data_position === bitsPerChar - 1) {\r\n                context_data_position = 0;\r\n                context_data.push(getCharFromInt(context_data_val));\r\n                context_data_val = 0;\r\n              } else {\r\n                context_data_position++;\r\n              }\r\n              value = value>>1;\r\n            }\r\n          } else {\r\n            value = 1;\r\n            for (i = 0; i < context_numBits; i++) {\r\n              context_data_val = (context_data_val<<1) | value;\r\n              if (context_data_position == bitsPerChar - 1) {\r\n                context_data_position = 0;\r\n                context_data.push(getCharFromInt(context_data_val));\r\n                context_data_val = 0;\r\n              } else {\r\n                context_data_position++;\r\n              }\r\n              value = 0;\r\n            }\r\n            value = context_w.charCodeAt(0);\r\n            for (i = 0; i < 16; i++) {\r\n              context_data_val = (context_data_val<<1) | (value & 1);\r\n              if (context_data_position === bitsPerChar - 1) {\r\n                context_data_position = 0;\r\n                context_data.push(getCharFromInt(context_data_val));\r\n                context_data_val = 0;\r\n              } else {\r\n                context_data_position++;\r\n              }\r\n              value = value>>1;\r\n            }\r\n          }\r\n          context_enlargeIn--;\r\n          if (context_enlargeIn === 0) {\r\n            context_enlargeIn = Math.pow(2, context_numBits);\r\n            context_numBits++;\r\n          }\r\n          delete context_dictionaryToCreate[context_w];\r\n        } else {\r\n          value = context_dictionary[context_w];\r\n          for (i = 0; i < context_numBits; i++) {\r\n            context_data_val = (context_data_val<<1) | (value & 1);\r\n            if (context_data_position === bitsPerChar - 1) {\r\n              context_data_position = 0;\r\n              context_data.push(getCharFromInt(context_data_val));\r\n              context_data_val = 0;\r\n            } else {\r\n              context_data_position++;\r\n            }\r\n            value = value>>1;\r\n          }\r\n\r\n\r\n        }\r\n        context_enlargeIn--;\r\n        if (context_enlargeIn === 0) {\r\n          context_enlargeIn = Math.pow(2, context_numBits);\r\n          context_numBits++;\r\n        }\r\n        // Add wc to the dictionary.\r\n        context_dictionary[context_wc] = context_dictSize++;\r\n        context_w = String(context_c);\r\n      }\r\n    }\r\n\r\n    // Output the code for w.\r\n    if (context_w !== \"\") {\r\n      if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate, context_w)) {\r\n        if (context_w.charCodeAt(0) < 256) {\r\n          for (i = 0; i < context_numBits; i++) {\r\n            context_data_val = (context_data_val<<1);\r\n            if (context_data_position === bitsPerChar - 1) {\r\n              context_data_position = 0;\r\n              context_data.push(getCharFromInt(context_data_val));\r\n              context_data_val = 0;\r\n            } else {\r\n              context_data_position++;\r\n            }\r\n          }\r\n          value = context_w.charCodeAt(0);\r\n          for (i = 0; i < 8; i++) {\r\n            context_data_val = (context_data_val<<1) | (value & 1);\r\n            if (context_data_position === bitsPerChar - 1) {\r\n              context_data_position = 0;\r\n              context_data.push(getCharFromInt(context_data_val));\r\n              context_data_val = 0;\r\n            } else {\r\n              context_data_position++;\r\n            }\r\n            value = value>>1;\r\n          }\r\n        } else {\r\n          value = 1;\r\n          for (i = 0; i < context_numBits; i++) {\r\n            context_data_val = (context_data_val<<1) | value;\r\n            if (context_data_position === bitsPerChar - 1) {\r\n              context_data_position = 0;\r\n              context_data.push(getCharFromInt(context_data_val));\r\n              context_data_val = 0;\r\n            } else {\r\n              context_data_position++;\r\n            }\r\n            value = 0;\r\n          }\r\n          value = context_w.charCodeAt(0);\r\n          for (i = 0; i < 16; i++) {\r\n            context_data_val = (context_data_val<<1) | (value & 1);\r\n            if (context_data_position === bitsPerChar - 1) {\r\n              context_data_position = 0;\r\n              context_data.push(getCharFromInt(context_data_val));\r\n              context_data_val = 0;\r\n            } else {\r\n              context_data_position++;\r\n            }\r\n            value = value>>1;\r\n          }\r\n        }\r\n        context_enlargeIn--;\r\n        if (context_enlargeIn === 0) {\r\n          context_enlargeIn = Math.pow(2, context_numBits);\r\n          context_numBits++;\r\n        }\r\n        delete context_dictionaryToCreate[context_w];\r\n      } else {\r\n        value = context_dictionary[context_w];\r\n        for (i = 0; i < context_numBits; i++) {\r\n          context_data_val = (context_data_val<<1) | (value & 1);\r\n          if (context_data_position === bitsPerChar - 1) {\r\n            context_data_position = 0;\r\n            context_data.push(getCharFromInt(context_data_val));\r\n            context_data_val = 0;\r\n          } else {\r\n            context_data_position++;\r\n          }\r\n          value = value>>1;\r\n        }\r\n\r\n\r\n      }\r\n      context_enlargeIn--;\r\n      if (context_enlargeIn === 0) {\r\n        context_enlargeIn = Math.pow(2, context_numBits);\r\n        context_numBits++;\r\n      }\r\n    }\r\n\r\n    // Mark the end of the stream\r\n    value = 2;\r\n    for (i = 0; i < context_numBits; i++) {\r\n      context_data_val = (context_data_val<<1) | (value & 1);\r\n      if (context_data_position === bitsPerChar - 1) {\r\n        context_data_position = 0;\r\n        context_data.push(getCharFromInt(context_data_val));\r\n        context_data_val = 0;\r\n      } else {\r\n        context_data_position++;\r\n      }\r\n      value = value>>1;\r\n    }\r\n\r\n    // Flush the last char\r\n    while (true) {\r\n      context_data_val = (context_data_val<<1);\r\n      if (context_data_position === bitsPerChar - 1) {\r\n        context_data.push(getCharFromInt(context_data_val));\r\n        break;\r\n      } else context_data_position++;\r\n    }\r\n    return context_data.join('');\r\n  },\r\n\r\n  decompress: function (compressed) {\r\n    if (compressed === null) return \"\";\r\n    if (compressed === \"\") return null;\r\n\r\n    compressed = getInput(compressed);\r\n\r\n    return this._decompress(compressed.length, 32768, function (index) {\r\n      return compressed.charCodeAt(index);\r\n    });\r\n  },\r\n\r\n  _decompress: function (length, resetValue, getNextValue) {\r\n    let dictionary = [], next, enlargeIn = 4, dictSize = 4, numBits = 3, entry = \"\", result = [], i, w,\r\n        bits, resb,\r\n        maxpower, power, c, data                                                            = {val: getNextValue(0), position: resetValue, index: 1};\r\n\r\n    for (i = 0; i < 3; i += 1) {\r\n      dictionary[i] = i;\r\n    }\r\n\r\n    bits = 0;\r\n    maxpower = Math.pow(2, 2);\r\n    power = 1;\r\n    while (power !== maxpower) {\r\n      resb = data.val & data.position;\r\n      data.position >>= 1;\r\n      if (data.position === 0) {\r\n        data.position = resetValue;\r\n        data.val = getNextValue(data.index++);\r\n      }\r\n      bits |= (resb > 0 ? 1 : 0)*power;\r\n      power <<= 1;\r\n    }\r\n\r\n    switch (next = bits) {\r\n      case 0:\r\n        bits = 0;\r\n        maxpower = Math.pow(2, 8);\r\n        power = 1;\r\n        while (power !== maxpower) {\r\n          resb = data.val & data.position;\r\n          data.position >>= 1;\r\n          if (data.position === 0) {\r\n            data.position = resetValue;\r\n            data.val = getNextValue(data.index++);\r\n          }\r\n          bits |= (resb > 0 ? 1 : 0)*power;\r\n          power <<= 1;\r\n        }\r\n        c = f(bits);\r\n        break;\r\n      case 1:\r\n        bits = 0;\r\n        maxpower = Math.pow(2, 16);\r\n        power = 1;\r\n        while (power !== maxpower) {\r\n          resb = data.val & data.position;\r\n          data.position >>= 1;\r\n          if (data.position === 0) {\r\n            data.position = resetValue;\r\n            data.val = getNextValue(data.index++);\r\n          }\r\n          bits |= (resb > 0 ? 1 : 0)*power;\r\n          power <<= 1;\r\n        }\r\n        c = f(bits);\r\n        break;\r\n      case 2:\r\n        return \"\";\r\n    }\r\n    dictionary[3] = c;\r\n    w = c;\r\n    result.push(c);\r\n    while (true) {\r\n      if (data.index > length) {\r\n        return \"\";\r\n      }\r\n\r\n      bits = 0;\r\n      maxpower = Math.pow(2, numBits);\r\n      power = 1;\r\n      while (power !== maxpower) {\r\n        resb = data.val & data.position;\r\n        data.position >>= 1;\r\n        if (data.position === 0) {\r\n          data.position = resetValue;\r\n          data.val = getNextValue(data.index++);\r\n        }\r\n        bits |= (resb > 0 ? 1 : 0)*power;\r\n        power <<= 1;\r\n      }\r\n\r\n      switch (c = bits) {\r\n        case 0:\r\n          bits = 0;\r\n          maxpower = Math.pow(2, 8);\r\n          power = 1;\r\n          while (power !== maxpower) {\r\n            resb = data.val & data.position;\r\n            data.position >>= 1;\r\n            if (data.position === 0) {\r\n              data.position = resetValue;\r\n              data.val = getNextValue(data.index++);\r\n            }\r\n            bits |= (resb > 0 ? 1 : 0)*power;\r\n            power <<= 1;\r\n          }\r\n\r\n          dictionary[dictSize++] = f(bits);\r\n          c = dictSize - 1;\r\n          enlargeIn--;\r\n          break;\r\n        case 1:\r\n          bits = 0;\r\n          maxpower = Math.pow(2, 16);\r\n          power = 1;\r\n          while (power !== maxpower) {\r\n            resb = data.val & data.position;\r\n            data.position >>= 1;\r\n            if (data.position === 0) {\r\n              data.position = resetValue;\r\n              data.val = getNextValue(data.index++);\r\n            }\r\n            bits |= (resb > 0 ? 1 : 0)*power;\r\n            power <<= 1;\r\n          }\r\n          dictionary[dictSize++] = f(bits);\r\n          c = dictSize - 1;\r\n          enlargeIn--;\r\n          break;\r\n        case 2:\r\n          return result.join('');\r\n      }\r\n\r\n      if (enlargeIn === 0) {\r\n        enlargeIn = Math.pow(2, numBits);\r\n        numBits++;\r\n      }\r\n\r\n      if (dictionary[c]) {\r\n        entry = dictionary[c];\r\n      } else {\r\n        if (c === dictSize) {\r\n          entry = w + w.charAt(0);\r\n        } else {\r\n          return null;\r\n        }\r\n      }\r\n      result.push(entry);\r\n\r\n      // Add w+entry[0] to the dictionary.\r\n      dictionary[dictSize++] = w + entry.charAt(0);\r\n      enlargeIn--;\r\n\r\n      w = entry;\r\n\r\n      if (enlargeIn === 0) {\r\n        enlargeIn = Math.pow(2, numBits);\r\n        numBits++;\r\n      }\r\n\r\n    }\r\n  }\r\n};\r\n","import './polyfill.js';\r\nimport './struct.js';\r\nimport './mobile-detect.cjs';\r\nimport nstructjs from './struct.js';\r\n\r\nlet f64tmp = new Float64Array(1);\r\nlet u16tmp = new Uint16Array(f64tmp.buffer);\r\n\r\nexport function isDenormal(f) {\r\n  f64tmp[0] = f;\r\n\r\n  let a = u16tmp[0], b = u16tmp[1], c = u16tmp[2], d = u16tmp[3];\r\n\r\n  //zero? check both positive and negative zero\r\n  if (a === 0 && b === 0 && c === 0 && (d === 0 || d === 32768)) {\r\n    return false;\r\n  }\r\n\r\n  let test = d & ~(1<<15);\r\n  test = test>>4;\r\n\r\n  //window.console.log(u16tmp[0], u16tmp[1], u16tmp[2], u16tmp[3], \"|\", test);\r\n\r\n  return test === 0;\r\n}\r\n\r\nglobalThis._isDenormal = isDenormal;\r\n\r\n\r\nlet colormap = {\r\n  \"black\"   : 30,\r\n  \"red\"     : 31,\r\n  \"green\"   : 32,\r\n  \"yellow\"  : 33,\r\n  \"blue\"    : 34,\r\n  \"magenta\" : 35,\r\n  \"cyan\"    : 36,\r\n  \"teal\"    : 36,\r\n  \"white\"   : 37,\r\n  \"reset\"   : 0,\r\n  \"grey\"    : 2,\r\n  \"gray\"    : 2,\r\n  \"orange\"  : 202,\r\n  \"pink\"    : 198,\r\n  \"brown\"   : 314,\r\n  \"lightred\": 91,\r\n  \"peach\"   : 210\r\n}\r\n\r\nexport let termColorMap = {};\r\nfor (let k in colormap) {\r\n  termColorMap[k] = colormap[k];\r\n  termColorMap[colormap[k]] = k;\r\n}\r\n\r\nexport function termColor(s, c, d = 0) {\r\n  if (typeof s === \"symbol\") {\r\n    s = s.toString();\r\n  } else {\r\n    s = \"\" + s;\r\n  }\r\n\r\n  if (c in colormap)\r\n    c = colormap[c]\r\n\r\n  if (c > 107) {\r\n    let s2 = '\\u001b[38;5;' + c + \"m\"\r\n    return s2 + s + '\\u001b[39m'\r\n  }\r\n\r\n  return '\\u001b[' + c + 'm' + s + '\\u001b[39m';\r\n};\r\n\r\nexport function termPrint() {\r\n  //let console = window.console;\r\n\r\n  let s = '';\r\n  for (let i = 0; i < arguments.length; i++) {\r\n    if (i > 0) {\r\n      s += ' ';\r\n    }\r\n    s += arguments[i];\r\n  }\r\n\r\n  let re1a = /\\u001b\\[[1-9][0-9]?m/;\r\n  let re1b = /\\u001b\\[[1-9][0-9];[0-9][0-9]?;[0-9]+m/\r\n  let re2 = /\\u001b\\[39m/;\r\n\r\n  let endtag = '\\u001b[39m';\r\n\r\n  function tok(s, type) {\r\n    return {\r\n      type : type,\r\n      value: s\r\n    }\r\n  }\r\n\r\n  let tokdef = [\r\n    [re1a, \"start\"],\r\n    [re1b, \"start\"],\r\n    [re2, \"end\"]\r\n  ];\r\n\r\n  let s2 = s;\r\n\r\n  let i = 0;\r\n  let tokens = [];\r\n\r\n  while (s2.length > 0) {\r\n    let ok = false;\r\n\r\n    let mintk = undefined, mini = undefined;\r\n    let minslice = undefined, mintype = undefined;\r\n\r\n    for (let tk of tokdef) {\r\n      let i = s2.search(tk[0]);\r\n\r\n      if (i >= 0 && (mini === undefined || i < mini)) {\r\n        minslice = s2.slice(i, s2.length).match(tk[0])[0];\r\n        mini = i;\r\n        mintype = tk[1];\r\n        mintk = tk;\r\n        ok = true;\r\n      }\r\n    }\r\n\r\n    if (!ok) {\r\n      break;\r\n    }\r\n\r\n    if (mini > 0) {\r\n      let chunk = s2.slice(0, mini);\r\n      tokens.push(tok(chunk, \"chunk\"));\r\n    }\r\n\r\n    s2 = s2.slice(mini + minslice.length, s2.length);\r\n    let t = tok(minslice, mintype);\r\n\r\n    tokens.push(t);\r\n  }\r\n\r\n  if (s2.length > 0) {\r\n    tokens.push(tok(s2, \"chunk\"));\r\n  }\r\n\r\n  let stack = [];\r\n  let cur;\r\n\r\n  let out = '';\r\n\r\n  for (let t of tokens) {\r\n    if (t.type === \"chunk\") {\r\n      out += t.value;\r\n    } else if (t.type === \"start\") {\r\n      stack.push(cur);\r\n      cur = t.value;\r\n\r\n      out += t.value;\r\n    } else if (t.type === \"end\") {\r\n      cur = stack.pop();\r\n      if (cur) {\r\n        out += cur;\r\n      } else {\r\n        out += endtag;\r\n      }\r\n    }\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\nglobalThis.termColor = termColor;\r\n\r\nexport class MovingAvg extends Array {\r\n  constructor(size = 64) {\r\n    super();\r\n\r\n    this.length = size;\r\n    this.cur = 0;\r\n    this.used = 0;\r\n    this.sum = 0;\r\n  }\r\n\r\n  reset() {\r\n    this.cur = this.used = this.sum = 0.0;\r\n\r\n    return this;\r\n  }\r\n\r\n  add(val) {\r\n    if (this.used < this.length) {\r\n      this[this.cur] = val;\r\n      this.used++;\r\n    } else {\r\n      this.sum -= this[this.cur];\r\n      this[this.cur] = val;\r\n    }\r\n\r\n    this.sum += val;\r\n    this.cur = (this.cur + 1)%this.length;\r\n\r\n    return this.sample();\r\n  }\r\n\r\n  sample() {\r\n    return this.used ? this.sum/this.used : 0.0;\r\n  }\r\n}\r\n\r\nexport let timers = {};\r\n\r\nexport function pollTimer(id, interval) {\r\n  if (!(id in timers)) {\r\n    timers[id] = time_ms();\r\n  }\r\n\r\n  if (time_ms() - timers[id] >= interval) {\r\n    timers[id] = time_ms();\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nlet mdetect = undefined;\r\nlet mret = undefined;\r\n\r\nexport function isMobile() {\r\n  if (!window.MobileDetect) {\r\n    return;\r\n  }\r\n\r\n  if (mret === undefined) {\r\n    mdetect = new MobileDetect(navigator.userAgent);\r\n    let ret = mdetect.mobile();\r\n\r\n    if (typeof ret === \"string\") {\r\n      ret = ret.toLowerCase();\r\n    }\r\n\r\n    mret = ret;\r\n  }\r\n\r\n  return mret;\r\n}\r\n\r\nexport class SmartConsoleContext {\r\n  constructor(name, console) {\r\n    this.name = name;\r\n\r\n    let c = [random(), random(), random()];\r\n    let sum = Math.sqrt(c[0]*c[0] + c[1]*c[1] + c[2]*c[2]);\r\n    sum = 255/sum;\r\n\r\n    let r = ~~(c[0]*sum);\r\n    let g = ~~(c[1]*sum);\r\n    let b = ~~(c[2]*sum);\r\n\r\n    this.color = `rgb(${r},${g},${b})`;\r\n    this.__console = console;\r\n\r\n    //minimum time between prints of same message\r\n    this.timeInterval = 375;\r\n\r\n    //minimum time in general\r\n    this.timeIntervalAll = 245;\r\n\r\n    this._last = 0;\r\n    this.last = 0;\r\n    this.last2 = 0;\r\n    this._data = {};\r\n    this._data_length = 0;\r\n    this.maxCache = 256;\r\n  }\r\n\r\n\r\n  hash(args) {\r\n    let sum = 0;\r\n    let mul = (1<<19) - 1, off = (1<<27) - 1;\r\n    let i = 0;\r\n\r\n    function dohash(h) {\r\n      h = (h*mul + off + i*mul*0.25) & mul;\r\n\r\n      i++;\r\n      sum = sum ^ h;\r\n    }\r\n\r\n    let visit = new WeakSet();\r\n\r\n    let recurse = (n) => {\r\n      if (typeof n === \"string\") {\r\n        dohash(strhash(n));\r\n      } else if (typeof n === \"undefined\" || n === null) {\r\n        dohash(0);\r\n      } else if (typeof n === \"object\") {\r\n        if (visit.has(n)) {\r\n          return;\r\n        }\r\n\r\n        visit.add(n);\r\n\r\n        let keys = getAllKeys(n);\r\n\r\n        for (let k of keys) {\r\n          let v;\r\n\r\n          if (typeof k !== \"string\") {\r\n            continue;\r\n          }\r\n\r\n          try {\r\n            v = n[k];\r\n          } catch (error) {\r\n            continue;\r\n          }\r\n\r\n          recurse(v);\r\n        }\r\n      } else if (typeof n === \"function\") {\r\n        dohash(strhash(\"\" + n.name));\r\n      }\r\n    };\r\n\r\n    //let str = \"\";\r\n\r\n    for (let i = 0; i < args.length; i++) {\r\n      recurse(args[i]);\r\n      //str += args[i] + \" \";\r\n    }\r\n\r\n    //window.console.log(\"HASH\", sum, str);\r\n    return sum;\r\n  }\r\n\r\n  clearCache() {\r\n    this._data_length = 0;\r\n    this._data = {};\r\n    return this;\r\n  }\r\n\r\n  _getData(args) {\r\n    let key = this.hash(args);\r\n\r\n    if (!(key in this._data)) {\r\n      if (this._data_length > this.maxCache) {\r\n        this.clearCache();\r\n      }\r\n\r\n      this._data[key] = {\r\n        time : 0,\r\n        count: 0\r\n      };\r\n\r\n      this._data_length++;\r\n    }\r\n\r\n    return this._data[key];\r\n  }\r\n\r\n  _check(args) {\r\n    if (this.timeIntervalAll > 0 && time_ms() - this.last2 < this.timeIntervalAll) {\r\n      return false;\r\n    }\r\n\r\n    this.last2 = time_ms();\r\n\r\n    return true;\r\n    /*\r\n    this.last2 = time_ms();\r\n\r\n    let d = this._getData(args);\r\n    let last = this.last;\r\n\r\n    this.last = d;\r\n\r\n    if (d !== last) {\r\n      d.count = 0;\r\n      d.time = time_ms();\r\n      return true;\r\n    }\r\n\r\n    if (time_ms() - d.time > this.timeInterval) {\r\n      d.time = time_ms();\r\n      return true;\r\n    }\r\n\r\n    return false;*/\r\n  }\r\n\r\n  log() {\r\n    if (this._check(arguments)) {\r\n      window.console.log(\"%c\", \"color:\" + this.color, ...arguments);\r\n    }\r\n  }\r\n\r\n  warn() {\r\n    if (this._check(arguments)) {\r\n      window.console.log(\"%c\" + this.name, \"color : \" + this.color, ...arguments);\r\n    }\r\n  }\r\n\r\n  trace() {\r\n    if (this._check(arguments)) {\r\n      window.console.trace(...arguments);\r\n    }\r\n  }\r\n\r\n  error() {\r\n    if (this._check(arguments)) {\r\n      window.console.error(...arguments);\r\n    }\r\n  }\r\n}\r\n\r\nexport class SmartConsole {\r\n  constructor() {\r\n    this.contexts = {};\r\n  }\r\n\r\n  context(name) {\r\n    if (!(name in this.contexts)) {\r\n      this.contexts[name] = new SmartConsoleContext(name, this);\r\n    }\r\n\r\n    return this.contexts[name];\r\n  }\r\n\r\n  log() {\r\n    let c = this.context(\"default\");\r\n    return c.log(...arguments);\r\n  }\r\n\r\n  warn() {\r\n    let c = this.context(\"default\");\r\n    return c.warn(...arguments);\r\n  }\r\n\r\n  trace() {\r\n    let c = this.context(\"default\");\r\n    return c.trace(...arguments);\r\n  }\r\n\r\n  error() {\r\n    let c = this.context(\"default\");\r\n    return c.error(...arguments);\r\n  }\r\n}\r\n\r\nexport const console = new SmartConsole();\r\n\r\nglobalThis.tm = 0.0;\r\n\r\nlet EmptySlot = {};\r\n\r\nexport function getClassParent(cls) {\r\n  let p = cls.prototype;\r\n\r\n  if (p) p = p.__proto__;\r\n  if (p) p = p.constructor\r\n  ;\r\n  return p;\r\n}\r\n\r\n//make global for debugging purposes in console\r\n//window._getClassParent = getClassParent;\r\n\r\nexport function list(iterable) {\r\n  let ret = [];\r\n\r\n  for (let item of iterable) {\r\n    ret.push(item);\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n\r\n/** Count items in list; if searchItem is not undefined then a count\r\n *  of the number of times searchItem occurs will be returned.*/\r\nexport function count(iterable, searchItem = undefined) {\r\n  let count = 0;\r\n\r\n  if (searchItem !== undefined) {\r\n    for (let item of iterable) {\r\n      if (item === searchItem) {\r\n        count++;\r\n      }\r\n    }\r\n  } else {\r\n    for (let item of iterable) {\r\n      count++;\r\n    }\r\n  }\r\n\r\n  return count;\r\n}\r\n\r\n/*\r\n* returns all object keys, including\r\n* inherited ones\r\n* */\r\nexport function getAllKeys(obj) {\r\n  let keys = new Set();\r\n\r\n  if (typeof obj !== \"object\" && typeof obj !== \"function\") {\r\n    throw new Error(\"must pass an object ot getAllKeys; object was: \" + obj);\r\n  }\r\n\r\n  let p;\r\n\r\n  while (p && p !== Object) {\r\n    for (let k in Object.getOwnPropertyDescriptors(obj)) {\r\n      if (k === \"__proto__\")\r\n        continue;\r\n\r\n      keys.add(k);\r\n    }\r\n\r\n    for (let k of Object.getOwnPropertySymbols(obj)) {\r\n      keys.add(k);\r\n    }\r\n\r\n    p = p.__proto__;\r\n  }\r\n\r\n  let cls = obj.constructor;\r\n  if (!cls)\r\n    return keys;\r\n\r\n  while (cls) {\r\n    let proto = cls.prototype;\r\n    if (!proto) {\r\n      cls = getClassParent(cls);\r\n      continue;\r\n    }\r\n\r\n    for (let k in proto) {\r\n      keys.add(k);\r\n    }\r\n\r\n    for (let k in Object.getOwnPropertyDescriptors(proto)) {\r\n      keys.add(k);\r\n    }\r\n\r\n    cls = getClassParent(cls);\r\n  }\r\n\r\n  return keys;\r\n}\r\n\r\n//globalThis._getAllKeys = getAllKeys;\r\n\r\nexport function btoa(buf) {\r\n  if (buf instanceof ArrayBuffer) {\r\n    buf = new Uint8Array(buf);\r\n  }\r\n\r\n  if (typeof buf === \"string\" || buf instanceof String) {\r\n    return window.btoa(buf);\r\n  }\r\n\r\n  let ret = \"\";\r\n  for (let i = 0; i < buf.length; i++) {\r\n    ret += String.fromCharCode(buf[i]);\r\n  }\r\n\r\n  return btoa(ret);\r\n};\r\n\r\nexport function formatNumberUI(val, isInt = false, decimals = 5) {\r\n  if (val === undefined || val === null) {\r\n    val = \"0\";\r\n  } else if (isNaN(val)) {\r\n    val = \"NaN\";\r\n  } else if (val === -Infinity) {\r\n    val = \"-\" + String.fromCharCode(0x221E);\r\n  } else if (val === Infinity) {\r\n    val = \"+\" + String.fromCharCode(0x221E);\r\n  } else if (!isInt) {\r\n    val = val.toFixed(decimals);\r\n  } else {\r\n    val = \"\" + Math.floor(val);\r\n  }\r\n\r\n  return val;\r\n}\r\n\r\n//window.formatNumberUI = formatNumberUI;\r\n\r\nexport function atob(buf) {\r\n  let data = window.atob(buf);\r\n  let ret = [];\r\n\r\n  for (let i = 0; i < data.length; i++) {\r\n    ret.push(data.charCodeAt(i));\r\n  }\r\n\r\n  return new Uint8Array(ret);\r\n}\r\n\r\nexport function time_ms() {\r\n  if (window.performance)\r\n    return window.performance.now();\r\n  else\r\n    return new Date().getMilliseconds();\r\n}\r\n\r\nexport function color2css(c) {\r\n  let ret = c.length === 3 ? \"rgb(\" : \"rgba(\";\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    if (i > 0)\r\n      ret += \",\";\r\n\r\n    ret += ~~(c[i]*255);\r\n  }\r\n\r\n  if (c.length === 4)\r\n    ret += \",\" + c[3];\r\n  ret += \")\";\r\n\r\n  return ret;\r\n}\r\n\r\nexport function merge(obja, objb) {\r\n  return Object.assign({}, obja, objb);\r\n  /*\r\n  let ret = {};\r\n\r\n  for (let k in obja) {\r\n    ret[k] = obja[k];\r\n  }\r\n\r\n  for (let k in objb) {\r\n    ret[k] = objb[k];\r\n  }\r\n\r\n  return ret;\r\n  //*/\r\n};\r\n\r\nconst debug_cacherings = false;\r\n\r\nif (debug_cacherings) {\r\n  window._cacherings = [];\r\n\r\n  window._clear_all_cacherings = function (kill_all = false) {\r\n    function copy(obj) {\r\n      if (typeof obj.copy === \"function\") {\r\n        return obj.copy();\r\n      } else if (obj.constructor === Object) {\r\n        let ret = {};\r\n\r\n        for (let k of Reflect.ownKeys(obj)) {\r\n          let v;\r\n\r\n          try {\r\n            v = obj[k];\r\n          } catch (error) {\r\n            continue;\r\n          }\r\n\r\n          if (typeof v !== \"object\") {\r\n            ret[k] = v;\r\n          } else {\r\n            ret[k] = copy(v);\r\n          }\r\n        }\r\n\r\n        return ret;\r\n      } else {\r\n        return new obj.constructor();\r\n      }\r\n    }\r\n\r\n    for (let ch of window._cacherings) {\r\n      let obj = ch[0];\r\n      let len = ch.length;\r\n\r\n      ch.length = 0;\r\n      ch.cur = 0;\r\n\r\n      if (kill_all) {\r\n        continue;\r\n      }\r\n\r\n      for (let i = 0; i < len; i++) {\r\n        ch.push(copy(obj));\r\n      }\r\n    }\r\n  }\r\n\r\n  window._nonvector_cacherings = function () {\r\n    for (let ch of window._cacherings) {\r\n      if (ch.length === 0) {\r\n        continue;\r\n      }\r\n\r\n      let name = ch[0].constructor.name;\r\n      let ok = !name.startsWith(\"Vector\") && !name.startsWith(\"Quat\");\r\n      ok = ok && !name.startsWith(\"TriEditor\");\r\n      ok = ok && !name.startsWith(\"QuadEditor\");\r\n      ok = ok && !name.startsWith(\"PointEditor\");\r\n      ok = ok && !name.startsWith(\"LineEditor\");\r\n\r\n      if (ok) {\r\n        console.log(name, ch);\r\n      }\r\n    }\r\n  }\r\n\r\n  window._stale_cacherings = function () {\r\n    let ret = _cacherings.concat([]);\r\n\r\n    ret.sort((a, b) => a.gen - b.gen);\r\n    return ret;\r\n  }\r\n}\r\n\r\nexport class cachering extends Array {\r\n  constructor(func, size, isprivate = false) {\r\n    super()\r\n\r\n    this.private = isprivate;\r\n    this.cur = 0;\r\n\r\n    if (!isprivate && debug_cacherings) {\r\n      this.gen = 0;\r\n      window._cacherings.push(this);\r\n    }\r\n\r\n    for (let i = 0; i < size; i++) {\r\n      this.push(func());\r\n    }\r\n  }\r\n\r\n  static fromConstructor(cls, size, isprivate = false) {\r\n    let func = function () {\r\n      return new cls();\r\n    }\r\n\r\n    return new cachering(func, size, isprivate);\r\n  }\r\n\r\n  next() {\r\n    if (debug_cacherings) {\r\n      this.gen++;\r\n    }\r\n\r\n    let ret = this[this.cur];\r\n    this.cur = (this.cur + 1)%this.length;\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nexport class SetIter {\r\n  constructor(set) {\r\n    this.set = set;\r\n    this.i = 0;\r\n    this.ret = {done: false, value: undefined};\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return this;\r\n  }\r\n\r\n  next() {\r\n    let ret = this.ret;\r\n\r\n    while (this.i < this.set.items.length && this.set.items[this.i] === EmptySlot) {\r\n      this.i++;\r\n    }\r\n\r\n    if (this.i >= this.set.items.length) {\r\n      ret.done = true;\r\n      ret.value = undefined;\r\n\r\n      return ret;\r\n    }\r\n\r\n\r\n    ret.value = this.set.items[this.i++];\r\n    return ret;\r\n  }\r\n}\r\n\r\n/**\r\n Set\r\n\r\n Stores objects in a set; each object is converted to a value via\r\n a [Symbol.keystr] method, and if that value already exists in the set\r\n then the object is not added.\r\n\r\n\r\n * */\r\nexport class set {\r\n  constructor(input) {\r\n    this.items = [];\r\n    this.keys = {};\r\n    this.freelist = [];\r\n\r\n    this.length = 0;\r\n\r\n    if (typeof input === \"string\") {\r\n      input = new String(input);\r\n    }\r\n\r\n    if (input !== undefined) {\r\n      if (Symbol.iterator in input) {\r\n        for (let item of input) {\r\n          this.add(item);\r\n        }\r\n      } else if (\"forEach\" in input) {\r\n        input.forEach(function (item) {\r\n          this.add(item);\r\n        }, this);\r\n      } else if (input instanceof Array) {\r\n        for (let i = 0; i < input.length; i++) {\r\n          this.add(input[i]);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  get size() {\r\n    return this.length;\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return new SetIter(this);\r\n  }\r\n\r\n  equals(setb) {\r\n    for (let item of this) {\r\n      if (!setb.has(item)) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    for (let item of setb) {\r\n      if (!this.has(item)) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  clear() {\r\n    this.items.length = 0;\r\n    this.keys = {};\r\n    this.freelist.length = 0;\r\n    this.length = 0;\r\n\r\n    return this;\r\n  }\r\n\r\n  filter(f, thisvar) {\r\n    let i = 0;\r\n    let ret = new set();\r\n\r\n    for (let item of this) {\r\n      if (f.call(thisvar, item, i++, this)) {\r\n        ret.add(item);\r\n      }\r\n    }\r\n\r\n    return ret;\r\n\r\n  }\r\n\r\n  map(f, thisvar) {\r\n    let ret = new set();\r\n\r\n    let i = 0;\r\n\r\n    for (let item of this) {\r\n      ret.add(f.call(thisvar, item, i++, this));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  reduce(f, initial) {\r\n    if (initial === undefined) {\r\n      for (let item of this) {\r\n        initial = item;\r\n        break;\r\n      }\r\n    }\r\n\r\n    let i = 0;\r\n    for (let item of this) {\r\n      initial = f(initial, item, i++, this);\r\n    }\r\n\r\n    return initial;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new set();\r\n    for (let item of this) {\r\n      ret.add(item);\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  add(item) {\r\n    let key = item[Symbol.keystr]();\r\n\r\n    if (key in this.keys) return;\r\n\r\n    if (this.freelist.length > 0) {\r\n      let i = this.freelist.pop();\r\n\r\n      this.keys[key] = i;\r\n      this.items[i] = item;\r\n    } else {\r\n      let i = this.items.length;\r\n\r\n      this.keys[key] = i;\r\n      this.items.push(item);\r\n    }\r\n\r\n    this.length++;\r\n  }\r\n\r\n  delete(item, ignore_existence = true) {\r\n    this.remove(item, ignore_existence);\r\n  }\r\n\r\n  remove(item, ignore_existence) {\r\n    let key = item[Symbol.keystr]();\r\n\r\n    if (!(key in this.keys)) {\r\n      if (!ignore_existence) {\r\n        console.warn(\"Warning, item\", item, \"is not in set\");\r\n      }\r\n      return;\r\n    }\r\n\r\n    let i = this.keys[key];\r\n    this.freelist.push(i);\r\n    this.items[i] = EmptySlot;\r\n\r\n    delete this.keys[key];\r\n\r\n    this.length--;\r\n  }\r\n\r\n  has(item) {\r\n    return item[Symbol.keystr]() in this.keys;\r\n  }\r\n\r\n  forEach(func, thisvar) {\r\n    for (let i = 0; i < this.items.length; i++) {\r\n      let item = this.items[i];\r\n\r\n      if (item === EmptySlot)\r\n        continue;\r\n\r\n      thisvar !== undefined ? func.call(thisvar, item) : func(item);\r\n    }\r\n  }\r\n}\r\n\r\nexport class HashIter {\r\n  constructor(hash) {\r\n    this.hash = hash;\r\n    this.i = 0;\r\n    this.ret = {done: false, value: undefined};\r\n  }\r\n\r\n  next() {\r\n    let items = this.hash._items;\r\n\r\n    if (this.i >= items.length) {\r\n      this.ret.done = true;\r\n      this.ret.value = undefined;\r\n\r\n      return this.ret;\r\n    }\r\n\r\n    do {\r\n      this.i += 2;\r\n    } while (this.i < items.length && items[i] === _hash_null);\r\n\r\n    return this.ret;\r\n  }\r\n}\r\n\r\nlet _hash_null = {};\r\n\r\nexport class hashtable {\r\n  constructor() {\r\n    this._items = [];\r\n    this._keys = {};\r\n    this.length = 0;\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return new HashIter(this);\r\n  }\r\n\r\n  set(key, val) {\r\n    let key2 = key[Symbol.keystr]();\r\n\r\n    let i;\r\n    if (!(key2 in this._keys)) {\r\n      i = this._items.length;\r\n\r\n      try {\r\n        this._items.push(0);\r\n        this._items.push(0);\r\n      } catch (error) {\r\n        console.log(\":::\", this._items.length, key, key2, val)\r\n        throw error;\r\n      }\r\n\r\n      this._keys[key2] = i;\r\n      this.length++;\r\n    } else {\r\n      i = this._keys[key2];\r\n    }\r\n\r\n    this._items[i] = key;\r\n    this._items[i + 1] = val;\r\n  }\r\n\r\n  remove(key) {\r\n    let key2 = key[Symbol.keystr]();\r\n\r\n    if (!(key2 in this._keys)) {\r\n      console.warn(\"Warning, key not in hashtable:\", key, key2);\r\n      return;\r\n    }\r\n\r\n    let i = this._keys[key2];\r\n\r\n    this._items[i] = _hash_null;\r\n    this._items[i + 1] = _hash_null;\r\n\r\n    delete this._keys[key2];\r\n    this.length--;\r\n  }\r\n\r\n  has(key) {\r\n    let key2 = key[Symbol.keystr]();\r\n\r\n    return key2 in this._keys;\r\n  }\r\n\r\n  get(key) {\r\n    let key2 = key[Symbol.keystr]();\r\n\r\n    if (!(key2 in this._keys)) {\r\n      console.warn(\"Warning, item not in hash\", key, key2);\r\n      return undefined;\r\n    }\r\n\r\n    return this._items[this._keys[key2] + 1];\r\n  }\r\n\r\n  add(key, val) {\r\n    return this.set(key, val);\r\n  }\r\n\r\n  keys() {\r\n    let ret = [];\r\n\r\n    for (let i = 0; i < this._items.length; i += 2) {\r\n      let key = this._items[i];\r\n\r\n      if (key !== _hash_null) {\r\n        ret.push(key);\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  values() {\r\n    let ret = [];\r\n\r\n    for (let i = 0; i < this._items.length; i += 2) {\r\n      let item = this._items[i + 1];\r\n\r\n      if (item !== _hash_null) {\r\n        ret.push(item);\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  forEach(cb, thisvar) {\r\n    if (thisvar === undefined)\r\n      thisvar = self;\r\n\r\n    for (let k in this._keys) {\r\n      let i = this._keys[k];\r\n\r\n      cb.call(thisvar, k, this._items[i]);\r\n    }\r\n  }\r\n}\r\n\r\nlet IDGenInternalIDGen = 0;\r\n\r\nexport class IDGen {\r\n  constructor() {\r\n    this.__cur = 1;\r\n\r\n    this._debug = false;\r\n    this._internalID = IDGenInternalIDGen++;\r\n  }\r\n\r\n  /*\r\n  get _cur() {\r\n    return this.__cur;\r\n  }\r\n\r\n  set _cur(v) {\r\n    if (this._debug && pollTimer(\"_idgen_debug\", 450)) {\r\n      window.console.warn(\"_cur access\", v);\r\n    }\r\n\r\n    this.__cur = v;\r\n  }\r\n\r\n  // */\r\n\r\n  get cur() {\r\n    return this.__cur;\r\n  }\r\n\r\n  set cur(v) {\r\n    if (isNaN(v) || !isFinite(v)) {\r\n      throw new Error(\"NaN error in util.IDGen\");\r\n    }\r\n\r\n    this.__cur = v;\r\n  }\r\n\r\n  get _cur() {\r\n    return this.cur;\r\n  }\r\n\r\n  set _cur(v) {\r\n    window.console.warn(\"Deprecated use of IDGen._cur\");\r\n    this.cur = v;\r\n  }\r\n\r\n  static fromJSON(obj) {\r\n    let ret = new IDGen();\r\n\r\n    ret.cur = obj.cur === undefined ? obj._cur : obj.cur;\r\n\r\n    return ret;\r\n  }\r\n\r\n  next() {\r\n    return this.cur++;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new IDGen();\r\n    ret.cur = this.cur;\r\n\r\n    return ret;\r\n  }\r\n\r\n  max_cur(id) {\r\n    this.cur = Math.max(this.cur, id + 1);\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      cur: this.cur\r\n    };\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n  }\r\n}\r\n\r\nIDGen.STRUCT = `\r\nIDGen {\r\n  cur : int;\r\n}\r\n`;\r\nnstructjs.register(IDGen);\r\n\r\n\r\nfunction get_callstack(err) {\r\n  return (\"\" + err.stack).split(\"\\n\");\r\n}\r\n\r\nexport function print_stack(err) {\r\n  if (!err) {\r\n    window.console.trace();\r\n  } else {\r\n    window.console.log(err.stack);\r\n  }\r\n}\r\n\r\n\r\nglobalThis.get_callstack = get_callstack;\r\nglobalThis.print_stack = print_stack;\r\n\r\nexport function fetch_file(path) {\r\n  let url = location.origin + \"/\" + path\r\n\r\n  let req = new XMLHttpRequest(\r\n  );\r\n\r\n  return new Promise(function (accept, reject) {\r\n    req.open(\"GET\", url)\r\n    req.onreadystatechange = function (e) {\r\n      if (req.status === 200 && req.readyState === 4) {\r\n        accept(req.response);\r\n      } else if (req.status >= 400) {\r\n        reject(req.status, req.statusText);\r\n      }\r\n    }\r\n    req.send();\r\n  });\r\n}\r\n\r\n//from:https://en.wikipedia.org/wiki/Mersenne_Twister\r\nfunction _int32(x) {\r\n  // Get the 31 least significant bits.\r\n  return ~~(((1<<30) - 1) & (~~x))\r\n}\r\n\r\nexport class MersenneRandom {\r\n  constructor(seed) {\r\n    // Initialize the index to 0\r\n    this.index = 624;\r\n    this.mt = new Uint32Array(624);\r\n\r\n    this.seed(seed);\r\n  }\r\n\r\n  random() {\r\n    return this.extract_number()/(1<<30);\r\n  }\r\n\r\n  /** normal-ish distribution */\r\n  nrandom(n = 3) {\r\n    let ret = 0.0;\r\n\r\n    for (let i = 0; i < n; i++) {\r\n      ret += this.random();\r\n    }\r\n\r\n    return ret/n;\r\n  }\r\n\r\n  seed(seed) {\r\n    seed = ~~(seed*8192);\r\n\r\n    // Initialize the index to 0\r\n    this.index = 624;\r\n    this.mt.fill(0, 0, this.mt.length);\r\n\r\n    this.mt[0] = seed;  // Initialize the initial state to the seed\r\n\r\n    for (let i = 1; i < 624; i++) {\r\n      this.mt[i] = _int32(\r\n        1812433253*(this.mt[i - 1] ^ this.mt[i - 1]>>30) + i);\r\n    }\r\n  }\r\n\r\n  extract_number() {\r\n    if (this.index >= 624)\r\n      this.twist();\r\n\r\n    let y = this.mt[this.index];\r\n\r\n    // Right shift by 11 bits\r\n    y = y ^ y>>11;\r\n    // Shift y left by 7 and take the bitwise and of 2636928640\r\n    y = y ^ y<<7 & 2636928640;\r\n    // Shift y left by 15 and take the bitwise and of y and 4022730752\r\n    y = y ^ y<<15 & 4022730752;\r\n    // Right shift by 18 bits\r\n    y = y ^ y>>18;\r\n\r\n    this.index = this.index + 1;\r\n\r\n    return _int32(y);\r\n  }\r\n\r\n  twist() {\r\n    for (let i = 0; i < 624; i++) {\r\n      // Get the most significant bit and add it to the less significant\r\n      // bits of the next number\r\n      let y = _int32((this.mt[i] & 0x80000000) +\r\n        (this.mt[(i + 1)%624] & 0x7fffffff));\r\n      this.mt[i] = this.mt[(i + 397)%624] ^ y>>1;\r\n\r\n      if (y%2 !== 0)\r\n        this.mt[i] = this.mt[i] ^ 0x9908b0df;\r\n    }\r\n\r\n    this.index = 0;\r\n  }\r\n}\r\n\r\nlet _mt = new MersenneRandom(0);\r\n\r\nexport function random() {\r\n  return _mt.extract_number()/(1<<30);\r\n}\r\n\r\nexport function seed(n) {\r\n//  console.trace(\"seed called\");\r\n  _mt.seed(n);\r\n}\r\n\r\nlet smallstr_hashes = {};\r\n\r\n\r\nconst MAXINT = Math.pow(2, 31) - 1;\r\n\r\nexport function strhash(str) {\r\n  if (str.length <= 64) {\r\n    let hash = smallstr_hashes[str];\r\n\r\n    if (hash !== undefined) {\r\n      return hash;\r\n    }\r\n  }\r\n\r\n  let hash = 0;\r\n\r\n  for (let i = 0; i < str.length; i++) {\r\n    let ch = str.charCodeAt(i);\r\n\r\n    hash = hash < 0 ? -hash : hash;\r\n\r\n    hash ^= (ch*1103515245 + 12345) & MAXINT;\r\n  }\r\n\r\n  if (str.length <= 64) {\r\n    smallstr_hashes[str] = hash;\r\n  }\r\n\r\n  return hash;\r\n}\r\n\r\nlet hashsizes = [\r\n  /*2, 5, 11, 19, 37, 67, 127, */223, 383, 653, 1117, 1901, 3251,\r\n                                 5527, 9397, 15991, 27191, 46229, 78593, 133631, 227177, 38619,\r\n                                 656587, 1116209, 1897561, 3225883, 5484019, 9322861, 15848867,\r\n                                 26943089, 45803279, 77865577, 132371489, 225031553\r\n];\r\n\r\nlet FTAKEN = 0, FKEY = 1, FVAL = 2, FTOT = 3;\r\n\r\nexport class FastHash extends Array {\r\n  constructor() {\r\n    super();\r\n\r\n    this.cursize = 0;\r\n    this.size = hashsizes[this.cursize];\r\n    this.used = 0;\r\n\r\n    this.length = this.size*FTOT;\r\n    this.fill(0, 0, this.length);\r\n  }\r\n\r\n  resize(size) {\r\n    let table = this.slice(0, this.length);\r\n\r\n    this.length = size*FTOT;\r\n    this.size = size;\r\n    this.fill(0, 0, this.length);\r\n\r\n    for (let i = 0; i < table.length; i += FTOT) {\r\n      if (!table[i + FTAKEN]) continue;\r\n\r\n      let key = table[i + FKEY], val = table[i + FVAL];\r\n      this.set(key, val);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  get(key) {\r\n    let hash = typeof key === \"string\" ? strhash(key) : key;\r\n    hash = typeof hash === \"object\" ? hash.valueOf() : hash;\r\n\r\n    let probe = 0;\r\n\r\n    let h = (hash + probe)%this.size;\r\n\r\n    let _i = 0;\r\n    while (_i++ < 50000 && this[h*FTOT + FTAKEN]) {\r\n      if (this[h*FTOT + FKEY] === key) {\r\n        return this[h*FTOT + FVAL];\r\n      }\r\n\r\n      probe = (probe + 1)*2;\r\n      h = (hash + probe)%this.size;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  has(key) {\r\n    let hash = typeof key === \"string\" ? strhash(key) : key;\r\n    hash = typeof hash === \"object\" ? hash.valueOf() : hash;\r\n\r\n    let probe = 0;\r\n\r\n    let h = (hash + probe)%this.size;\r\n\r\n    let _i = 0;\r\n    while (_i++ < 50000 && this[h*FTOT + FTAKEN]) {\r\n      if (this[h*FTOT + FKEY] === key) {\r\n        return true;\r\n      }\r\n\r\n      probe = (probe + 1)*2;\r\n      h = (hash + probe)%this.size;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  set(key, val) {\r\n    let hash = typeof key === \"string\" ? strhash(key) : key;\r\n    hash = typeof hash === \"object\" ? hash.valueOf() : hash;\r\n\r\n    if (this.used > this.size/3) {\r\n      this.resize(hashsizes[this.cursize++]);\r\n    }\r\n\r\n    let probe = 0;\r\n\r\n    let h = (hash + probe)%this.size;\r\n\r\n    let _i = 0;\r\n    while (_i++ < 50000 && this[h*FTOT + FTAKEN]) {\r\n      if (this[h*FTOT + FKEY] === key) {\r\n        this[h*FTOT + FVAL] = val;\r\n        return;\r\n      }\r\n\r\n      probe = (probe + 1)*2;\r\n      h = (hash + probe)%this.size;\r\n    }\r\n\r\n    this[h*FTOT + FTAKEN] = 1;\r\n    this[h*FTOT + FKEY] = key;\r\n    this[h*FTOT + FVAL] = val;\r\n\r\n    this.used++;\r\n  }\r\n}\r\n\r\nexport function test_fasthash() {\r\n  let h = new FastHash();\r\n  console.log(\"bleh hash:\", strhash(\"bleh\"));\r\n\r\n  h.set(\"bleh\", 1);\r\n  h.set(\"bleh\", 2);\r\n  h.set(\"bleh\", 3);\r\n\r\n  console.log(h);\r\n\r\n  return h;\r\n};\r\n\r\nexport class ImageReader {\r\n  load_image() {\r\n    let input = document.createElement(\"input\");\r\n    input.type = \"file\";\r\n\r\n    let doaccept;\r\n\r\n    let promise = new Promise((accept, reject) => {\r\n      doaccept = accept;\r\n    });\r\n\r\n    input.addEventListener(\"change\", function (e) {\r\n      let files = this.files;\r\n      console.log(\"got file\", e, files)\r\n\r\n      if (files.length === 0) return;\r\n\r\n      let reader = new FileReader();\r\n      let this2 = this;\r\n\r\n      reader.onload = (e) => {\r\n        let data = e.target.result;\r\n        let image = new Image();\r\n\r\n        image.src = data;\r\n        image.onload = (e) => {\r\n          console.log(\"got image\", image.width, image.height);\r\n\r\n          let canvas = document.createElement(\"canvas\");\r\n          let g = canvas.getContext(\"2d\");\r\n\r\n          canvas.width = image.width;\r\n          canvas.height = image.height;\r\n\r\n          g.drawImage(image, 0, 0);\r\n          let idata = g.getImageData(0, 0, image.width, image.height);\r\n\r\n          doaccept(idata);\r\n        }\r\n      };\r\n\r\n      reader.readAsDataURL(files[0]);\r\n    });\r\n\r\n    input.click();\r\n    return promise;\r\n  }\r\n\r\n  example() {\r\n    this.load_image().then((idata) => {\r\n      console.log(idata);\r\n    });\r\n  }\r\n};\r\n\r\nlet digestcache;\r\n\r\n/** NOT CRYPTOGRAPHIC */\r\nexport class HashDigest {\r\n  constructor() {\r\n    this.i = 0;\r\n    this.hash = 0;\r\n  }\r\n\r\n  static cachedDigest() {\r\n    return digestcache.next().reset();\r\n  }\r\n\r\n  reset() {\r\n    this.i = 0;\r\n    this.hash = 0;\r\n\r\n    return this;\r\n  }\r\n\r\n  get() {\r\n    return this.hash;\r\n  }\r\n\r\n  add(v) {\r\n    if (typeof v === \"string\") {\r\n      v = strhash(v);\r\n    }\r\n\r\n    if (typeof v === \"object\" && Array.isArray(v)) {\r\n      for (let i = 0; i < v.length; i++) {\r\n        this.add(v[i]);\r\n      }\r\n\r\n      return this;\r\n    }\r\n\r\n    if (v >= -5 && v <= 5) {\r\n      v *= 32;\r\n    }\r\n\r\n    //try to deal with subdecimal floating point error\r\n\r\n    let f = Math.fract(v)*(1024*512);\r\n    f = (~~f)/(1024*512);\r\n    v = Math.floor(v) + f;\r\n\r\n    //glibc linear congruel generator\r\n    this.i = ((this.i + (~~v))*1103515245 + 12345) & ((1<<29) - 1);\r\n    //according to wikipedia only the top 16 bits are random\r\n    //this.i = this.i>>16;\r\n\r\n    let v2 = (v*1024*1024) & ((1<<29) - 1)\r\n    v = v | v2;\r\n\r\n    v = ~~v;\r\n\r\n    this.hash ^= v ^ this.i;\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nwindow._test_hash2 = () => {\r\n  let h = new HashDigest();\r\n\r\n  let tests = [\r\n    [0, 0, 0, 0],\r\n    [0, 0, 0],\r\n    [0, 0],\r\n    [0],\r\n    [1],\r\n    [2],\r\n    [3],\r\n    [strhash(\"yay\")],\r\n    [strhash(\"yay\"), strhash(\"yay\")],\r\n    [strhash(\"yay\"), strhash(\"yay\"), strhash(\"yay\")]\r\n  ]\r\n\r\n  for (let test of tests) {\r\n    let h = new HashDigest();\r\n    for (let f of test) {\r\n      h.add(f);\r\n    }\r\n\r\n    window.console.log(h.get());\r\n  }\r\n  for (let i = 0; i < 50; i++) {\r\n    h.add(0);\r\n    //window.console.log(h.i/((1<<30)-1), h.hash);\r\n  }\r\n}\r\n\r\ndigestcache = cachering.fromConstructor(HashDigest, 512);\r\n\r\n//globalThis._HashDigest = HashDigest;\r\n\r\nexport function hashjoin(hash, val) {\r\n  let sum = 0;\r\n  let mul = (1<<19) - 1, off = (1<<27) - 1;\r\n  let i = 0;\r\n\r\n  h = (h*mul + off + i*mul*0.25) & mul;\r\n}\r\n\r\nlet NullItem = {};\r\n\r\nexport class MapIter {\r\n  constructor(ownermap) {\r\n    this.ret = {done: true, value: undefined};\r\n    this.value = new Array(2);\r\n    this.i = 0;\r\n    this.map = ownermap;\r\n    this.done = true;\r\n  }\r\n\r\n  finish() {\r\n    if (!this.done) {\r\n      this.done = true;\r\n      this.map.itercur--;\r\n    }\r\n  }\r\n\r\n  next() {\r\n    let ret = this.ret;\r\n    let i = this.i;\r\n    let map = this.map, list = map._list;\r\n    //window.console.log(this)\r\n\r\n    while (i < list.length && list[i] === NullItem) {\r\n      i += 2;\r\n    }\r\n\r\n    //window.console.log(\"  --\", i, list[i], list[i+1]);\r\n\r\n    if (i >= list.length) {\r\n      ret.done = true;\r\n      ret.value = undefined;\r\n\r\n      this.finish();\r\n      return ret;\r\n    }\r\n\r\n    this.i = i + 2;\r\n\r\n    ret.value = this.value;\r\n    ret.value[0] = list[i];\r\n    ret.value[1] = list[i + 1];\r\n    ret.done = false;\r\n\r\n    return ret;\r\n  }\r\n\r\n  return() {\r\n    this.finish();\r\n\r\n    return this.ret;\r\n  }\r\n\r\n  reset() {\r\n    this.i = 0;\r\n    this.value[0] = undefined;\r\n    this.value[1] = undefined;\r\n    this.done = false;\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nexport class map {\r\n  constructor() {\r\n    this._items = {};\r\n    this._list = [];\r\n\r\n    this.size = 0;\r\n\r\n    this.iterstack = new Array(8);\r\n    this.itercur = 0;\r\n    for (let i = 0; i < this.iterstack.length; i++) {\r\n      this.iterstack[i] = new MapIter(this);\r\n    }\r\n\r\n    this.freelist = [];\r\n  }\r\n\r\n  has(key) {\r\n    return key[Symbol.keystr]() in this._items;\r\n  }\r\n\r\n  set(key, v) {\r\n    let k = key[Symbol.keystr]();\r\n\r\n    let i = this._items[k];\r\n\r\n    if (i === undefined) {\r\n      if (this.freelist.length > 0) {\r\n        i = this.freelist.pop();\r\n      } else {\r\n        i = this._list.length;\r\n        this._list.length += 2;\r\n      }\r\n\r\n      this.size++;\r\n    }\r\n\r\n    this._list[i] = key;\r\n    this._list[i + 1] = v;\r\n\r\n    this._items[k] = i;\r\n  }\r\n\r\n  keys() {\r\n    let this2 = this;\r\n    return (function* () {\r\n      for (let [key, val] of this2) {\r\n        yield key;\r\n      }\r\n    })()\r\n  }\r\n\r\n  values() {\r\n    let this2 = this;\r\n    return (function* () {\r\n      for (let [key, val] of this2) {\r\n        yield val;\r\n      }\r\n    })()\r\n  }\r\n\r\n  get(k) {\r\n    k = k[Symbol.keystr]();\r\n\r\n    let i = this._items[k];\r\n    if (i !== undefined) {\r\n      return this._list[i + 1];\r\n    }\r\n  }\r\n\r\n  delete(k) {\r\n    k = k[Symbol.keystr]();\r\n\r\n    if (!(k in this._items)) {\r\n      return false;\r\n    }\r\n\r\n    let i = this._items[k];\r\n\r\n    this.freelist.push(i);\r\n\r\n    this._list[i] = NullItem;\r\n    this._list[i + 1] = NullItem;\r\n\r\n    delete this._items[k];\r\n    this.size--;\r\n\r\n    return true;\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    let ret = this.iterstack[this.itercur].reset();\r\n    this.itercur++;\r\n\r\n    if (this.itercur === this.iterstack.length) {\r\n      this.iterstack.push(new MapIter(this));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n}\r\n\r\nglobalThis._test_map = function () {\r\n  let m = new map();\r\n\r\n  m.set(\"1\", 2);\r\n  m.set(11, 3);\r\n  m.set(\"5\", 4);\r\n  m.set(\"3\", 5);\r\n  m.set(\"3\", 6);\r\n  m.delete(\"3\");\r\n\r\n  for (let [key, item] of m) {\r\n    for (let [key2, item2] of m) {\r\n      window.console.log(key, item, key2, item2);\r\n    }\r\n    break;\r\n  }\r\n\r\n  console.log(\"itercur\", m.itercur);\r\n\r\n  return m;\r\n}\r\n\r\nfunction validateId(id) {\r\n  let bad = typeof id !== \"number\";\r\n  bad = bad || id !== ~~id;\r\n  bad = bad || isNaN(id);\r\n\r\n  if (bad) {\r\n    throw new Error(\"bad number \" + id);\r\n  }\r\n\r\n  return bad;\r\n}\r\n\r\nlet UndefinedTag = {};\r\n\r\nexport class IDMap extends Array {\r\n  constructor() {\r\n    super();\r\n\r\n    this._keys = new Set();\r\n    this.size = 0;\r\n  }\r\n\r\n  has(id) {\r\n    validateId(id);\r\n\r\n    if (id < 0 || id >= this.length) {\r\n      return false;\r\n    }\r\n\r\n    return this[id] !== undefined;\r\n  }\r\n\r\n  set(id, val) {\r\n    validateId(id);\r\n\r\n    if (id < 0) {\r\n      console.warn(\"got -1 id in IDMap\");\r\n      return;\r\n    }\r\n\r\n    if (id >= this.length) {\r\n      this.length = id + 1;\r\n    }\r\n\r\n    if (val === undefined) {\r\n      val = UndefinedTag;\r\n    }\r\n\r\n    let ret = false;\r\n\r\n    if (this[id] === undefined) {\r\n      this.size++;\r\n      this._keys.add(id);\r\n      ret = true;\r\n    }\r\n\r\n    this[id] = val;\r\n    return ret;\r\n  }\r\n\r\n  /* we allow -1, which always returns undefined*/\r\n  get(id) {\r\n    validateId(id);\r\n\r\n    if (id === -1) {\r\n      return undefined;\r\n    } else if (id < 0) {\r\n      console.warn(\"id was negative\");\r\n      return undefined;\r\n    }\r\n\r\n    let ret = id < this.length ? this[id] : undefined;\r\n    ret = ret === UndefinedTag ? undefined : ret;\r\n\r\n    return ret;\r\n  }\r\n\r\n  delete(id) {\r\n    if (!this.has(id)) {\r\n      return false;\r\n    }\r\n\r\n    this._keys.remove(id);\r\n    this[id] = undefined;\r\n    this.size--;\r\n\r\n    return true;\r\n  }\r\n\r\n  keys() {\r\n    let this2 = this;\r\n    return (function* () {\r\n      for (let id of this2._keys) {\r\n        yield id;\r\n      }\r\n    })();\r\n  }\r\n\r\n  values() {\r\n    let this2 = this;\r\n    return (function* () {\r\n      for (let id of this2._keys) {\r\n        yield this2[id];\r\n      }\r\n    })();\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    let this2 = this;\r\n    let iteritem = [0, 0];\r\n\r\n    return (function* () {\r\n      for (let id of this2._keys) {\r\n        iteritem[0] = id;\r\n        iteritem[1] = this2[id];\r\n\r\n        if (iteritem[1] === UndefinedTag) {\r\n          iteritem[1] = undefined;\r\n        }\r\n\r\n        yield iteritem;\r\n      }\r\n    })();\r\n  }\r\n}\r\n\r\nglobalThis._test_idmap = function () {\r\n  let map = new IDMap();\r\n\r\n  for (let i = 0; i < 5; i++) {\r\n    let id = ~~(Math.random()*55);\r\n\r\n    map.set(id, \"yay\" + i);\r\n  }\r\n\r\n  for (let [key, val] of map) {\r\n    window.console.log(key, val, map.has(key), map.get(key));\r\n  }\r\n\r\n  return map;\r\n}\r\n\r\nlet HW = 0, HELEM = 1, HTOT = 2;\r\n\r\nfunction heaplog() {\r\n  //window.console.log(...arguments);\r\n}\r\n\r\nexport class MinHeapQueue {\r\n  constructor(iter, iterw = iter) {\r\n    this.heap = [];\r\n    this.freelist = [];\r\n    this.length = 0;\r\n    this.end = 0;\r\n\r\n    if (iter) {\r\n      let witer = iterw[Symbol.iterator]();\r\n\r\n      for (let item of iter) {\r\n        let w = witer.next().value;\r\n        this.push(item, w);\r\n      }\r\n    }\r\n  }\r\n\r\n  push(e, w) {\r\n    if (typeof w !== \"number\") {\r\n      throw new Error(\"w must be a number\");\r\n    }\r\n\r\n    if (isNaN(w)) {\r\n      throw new Error(\"NaN\");\r\n    }\r\n\r\n    this.length++;\r\n    let depth = Math.ceil(Math.log(this.length)/Math.log(2.0));\r\n    let tot = Math.pow(2, depth) + 1;\r\n\r\n    heaplog(depth, tot);\r\n\r\n    if (this.heap.length < tot*HTOT) {\r\n      let start = this.heap.length/HTOT;\r\n\r\n      for (let i = start; i < tot; i++) {\r\n        this.freelist.push(i*HTOT);\r\n      }\r\n    }\r\n\r\n    let heap = this.heap;\r\n    heap.length = tot*HTOT;\r\n\r\n    let n = this.freelist.pop();\r\n\r\n    heaplog(\"freelist\", this.freelist);\r\n    this.end = Math.max(this.end, n);\r\n\r\n    heap[n] = w;\r\n    heap[n + 1] = e;\r\n\r\n    while (n > 0) {\r\n      n /= HTOT;\r\n\r\n      let p = (n - 1)>>1;\r\n      n *= HTOT;\r\n      p *= HTOT;\r\n\r\n      if (heap[p] === undefined || heap[p] > w) {\r\n        if (n === this.end) {\r\n          this.end = p;\r\n        }\r\n\r\n        heap[n] = heap[p];\r\n        heap[n + 1] = heap[p + 1];\r\n\r\n        heap[p] = w;\r\n        heap[p + 1] = e;\r\n\r\n        n = p;\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  pop() {\r\n    if (this.length === 0) {\r\n      return undefined;\r\n      //throw new Error(\"heap is empty\");\r\n    }\r\n\r\n    let heap = this.heap;\r\n\r\n    if (this.end === 0) {\r\n      let ret = heap[1];\r\n      this.freelist.push(0);\r\n      heap[0] = undefined;\r\n\r\n      this.length = 0;\r\n\r\n      return ret;\r\n    }\r\n\r\n    let ret = heap[1];\r\n\r\n    let end = this.end;\r\n\r\n    function swap(n1, n2) {\r\n      let t = heap[n1];\r\n      heap[n1] = heap[n2];\r\n      heap[n2] = t;\r\n\r\n      t = heap[n1 + 1];\r\n      heap[n1 + 1] = heap[n2 + 1];\r\n      heap[n2 + 1] = t;\r\n    }\r\n\r\n    heaplog(\"end\", end);\r\n    heaplog(heap.concat([]));\r\n\r\n    heap[0] = heap[end];\r\n    heap[1] = heap[end + 1];\r\n    heap[end] = undefined;\r\n    heap[end + 1] = undefined;\r\n\r\n    let n = 0;\r\n    while (n < heap.length) {\r\n      n /= HTOT;\r\n\r\n      let n1 = n*2 + 1;\r\n      let n2 = n*2 + 2;\r\n\r\n      n1 = ~~(n1*HTOT);\r\n      n2 = ~~(n2*HTOT);\r\n      n = ~~(n*HTOT);\r\n\r\n      heaplog(\"  \", heap[n], heap[n1], heap[n2]);\r\n\r\n      if (heap[n1] !== undefined && heap[n2] !== undefined) {\r\n        if (heap[n1] > heap[n2]) {\r\n          let t = n1;\r\n          n1 = n2;\r\n          n2 = t;\r\n        }\r\n\r\n        if (heap[n] > heap[n1]) {\r\n          swap(n, n1);\r\n          n = n1;\r\n        } else if (heap[n] > heap[n2]) {\r\n          swap(n, n2);\r\n          n = n2;\r\n        } else {\r\n          break;\r\n        }\r\n      } else if (heap[n1] !== undefined) {\r\n        if (heap[n] > heap[n1]) {\r\n          swap(n, n1);\r\n          n = n1;\r\n        } else {\r\n          break;\r\n        }\r\n      } else if (heap[n2] !== undefined) {\r\n        if (heap[n] > heap[n2]) {\r\n          swap(n, n2);\r\n          n = n2;\r\n        } else {\r\n          break;\r\n        }\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n\r\n    this.freelist.push(this.end);\r\n\r\n    heap[this.end] = undefined;\r\n    heap[this.end + 1] = undefined;\r\n\r\n    while (this.end > 0 && heap[this.end] === undefined) {\r\n      this.end -= HTOT;\r\n    }\r\n\r\n    this.length--;\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nglobalThis.testHeapQueue = function (list1 = [1, 8, -3, 11, 33]) {\r\n  let h = new MinHeapQueue(list1);\r\n\r\n  window.console.log(h.heap.concat([]));\r\n\r\n  let list = [];\r\n  let len = h.length;\r\n\r\n  for (let i = 0; i < len; i++) {\r\n    list.push(h.pop());\r\n  }\r\n\r\n  window.console.log(h.heap.concat([]));\r\n\r\n  return list;\r\n}\r\n\r\nexport class Queue {\r\n  constructor(n = 32) {\r\n    n = Math.max(n, 8);\r\n\r\n    this.initialSize = n;\r\n\r\n    this.queue = new Array(n);\r\n    this.a = 0;\r\n    this.b = 0;\r\n    this.length = 0;\r\n  }\r\n\r\n  enqueue(item) {\r\n    let qlen = this.queue.length;\r\n\r\n    let b = this.b;\r\n\r\n    this.queue[b] = item;\r\n    this.b = (this.b + 1)%qlen;\r\n\r\n    if (this.length >= qlen || this.a === this.b) {\r\n      let newsize = qlen<<1;\r\n      let queue = new Array(newsize);\r\n\r\n      for (let i = 0; i < qlen; i++) {\r\n        let i2 = (i + this.a)%qlen;\r\n\r\n        queue[i] = this.queue[i2];\r\n      }\r\n\r\n      this.a = 0;\r\n      this.b = qlen;\r\n      this.queue = queue;\r\n    }\r\n\r\n    this.length++;\r\n  }\r\n\r\n  clear(clearData = true) {\r\n    this.queue.length = this.initialSize;\r\n\r\n    if (clearData) {\r\n      for (let i = 0; i < this.queue.length; i++) {\r\n        this.queue[i] = undefined;\r\n      }\r\n    }\r\n\r\n    this.a = this.b = 0;\r\n    this.length = 0;\r\n\r\n    return this;\r\n  }\r\n\r\n  dequeue() {\r\n    if (this.length === 0) {\r\n      return undefined;\r\n    }\r\n    this.length--;\r\n\r\n    let ret = this.queue[this.a];\r\n\r\n    this.queue[this.a] = undefined;\r\n\r\n    this.a = (this.a + 1)%this.queue.length;\r\n    return ret;\r\n  }\r\n}\r\n\r\nglobalThis._testQueue = function (steps = 15, samples = 15) {\r\n  let queue = new Queue(3);\r\n\r\n  for (let i = 0; i < steps; i++) {\r\n    let list = [];\r\n\r\n    for (let j = 0; j < samples; j++) {\r\n      let item = {f: Math.random()};\r\n      list.push(item);\r\n\r\n      queue.enqueue(item);\r\n    }\r\n\r\n    let j = 0;\r\n\r\n    while (queue.length > 0) {\r\n      let item = queue.dequeue();\r\n\r\n      if (item !== list[j]) {\r\n        console.log(item, list);\r\n        throw new Error(\"got wrong item\", item);\r\n      }\r\n\r\n      j++;\r\n\r\n      if (j > 10000) {\r\n        console.error(\"Infinite loop error\");\r\n        break;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n\r\nexport class ArrayPool {\r\n  constructor() {\r\n    this.pools = new Map();\r\n    this.map = new Array(1024);\r\n  }\r\n\r\n  get(n, clear = false) {\r\n    let pool;\r\n\r\n    if (n < 1024) {\r\n      pool = this.map[n];\r\n    } else {\r\n      pool = this.pools.get(n);\r\n    }\r\n\r\n    if (!pool) {\r\n      let tot;\r\n\r\n      if (n > 512) {\r\n        tot = 32;\r\n      } else if (n > 256) {\r\n        tot = 64;\r\n      } else if (n > 128) {\r\n        tot = 256;\r\n      } else if (n > 64) {\r\n        tot = 512;\r\n      } else {\r\n        tot = 1024;\r\n      }\r\n\r\n      pool = new cachering(() => new Array(n), tot);\r\n      if (n < 1024) {\r\n        this.map[n] = pool;\r\n      }\r\n      this.pools.set(n, pool);\r\n\r\n      return this.get(n, clear);\r\n    }\r\n\r\n    let ret = pool.next();\r\n    if (ret.length !== n) {\r\n      console.warn(\"Array length was set\", n, ret);\r\n      ret.length = n;\r\n    }\r\n\r\n    if (clear) {\r\n      for (let i = 0; i < n; i++) {\r\n        ret[i] = undefined;\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\n/** jsFiddle-friendly */\r\nexport class DivLogger {\r\n  constructor(elemId, maxLines = 16) {\r\n    this.elemId = elemId;\r\n    this.elem = undefined;\r\n    this.lines = new Array();\r\n    this.maxLines = maxLines;\r\n  }\r\n\r\n  push(line) {\r\n    if (this.lines.length > this.maxLines) {\r\n      this.lines.shift();\r\n      this.lines.push(line);\r\n    } else {\r\n      this.lines.push(line);\r\n    }\r\n\r\n    this.update();\r\n  }\r\n\r\n  update() {\r\n    let buf = this.lines.join(`<br>`);\r\n    buf = buf.replace(/[ \\t]/g, \"&nbsp;\");\r\n\r\n    if (!this.elem) {\r\n      this.elem = document.getElementById(this.elemId);\r\n    }\r\n\r\n    this.elem.innerHTML = buf;\r\n  }\r\n\r\n  toString(obj, depth = 0) {\r\n    let s = '';\r\n\r\n    let tab = '';\r\n    for (let i = 0; i < depth; i++) {\r\n      tab += '$TAB';\r\n    }\r\n\r\n    if (typeof obj === \"symbol\") {\r\n      return `[${obj.description}]`;\r\n    }\r\n\r\n    const DEPTH_LIMIT = 1;\r\n    const CHAR_LIMIT = 100;\r\n\r\n    if (typeof obj === \"object\" && Array.isArray(obj)) {\r\n      s = \"[$NL\";\r\n      for (let i = 0; i < obj.length; i++) {\r\n        let v = obj[i];\r\n\r\n        if (depth >= DEPTH_LIMIT) {\r\n          v = typeof v;\r\n        } else {\r\n          v = this.toString(v, depth + 1);\r\n        }\r\n\r\n        s += tab + \"$TAB\";\r\n        s += v + (i !== obj.length - 1 ? \",\" : \"\") + \"$NL\";\r\n      }\r\n\r\n      let keys = Reflect.ownKeys(obj);\r\n      for (let i = 0; i < keys.length; i++) {\r\n        let k = keys[i];\r\n        let n;\r\n\r\n        let k2 = this.toString(k);\r\n\r\n        if (typeof k !== \"symbol\" && !isNaN(n = parseInt(k))) {\r\n          if (n >= 0 && n < obj.length) {\r\n            continue;\r\n          }\r\n        }\r\n\r\n        let v;\r\n        try {\r\n          v = obj[k];\r\n        } catch (error) {\r\n          v = \"(error)\";\r\n        }\r\n\r\n        s += tab + `$TAB${k2} : ${v}`;\r\n\r\n        if (i < keys.length - 1) {\r\n          s += \",\";\r\n        }\r\n\r\n        if (!s.endsWith(\"$NL\") && !s.endsWith(\"\\n\")) {\r\n          s += \"$NL\";\r\n        }\r\n      }\r\n      s += \"$TAB]$NL\";\r\n\r\n      if (s.length < CHAR_LIMIT) {\r\n        s = s.replace(/\\$NL/g, \"\");\r\n        s = s.replace(/(\\$TAB)+/g, \" \");\r\n      } else {\r\n        s = s.replace(/\\$NL/g, \"\\n\");\r\n        s = s.replace(/\\$TAB/g, \"  \");\r\n      }\r\n    } else if (typeof obj === \"object\") {\r\n      s = '{$NL';\r\n\r\n      let keys = Reflect.ownKeys(obj);\r\n      for (let i = 0; i < keys.length; i++) {\r\n        let k = keys[i];\r\n        let k2 = this.toString(k);\r\n\r\n        let v;\r\n        try {\r\n          v = obj[k];\r\n        } catch (error) {\r\n          v = '(error)';\r\n        }\r\n\r\n        if (depth >= DEPTH_LIMIT) {\r\n          v = typeof v;\r\n        } else {\r\n          v = this.toString(v, depth + 1);\r\n        }\r\n\r\n        s += tab + `$TAB${k2} : ${v}`;\r\n\r\n        if (i < keys.length - 1) {\r\n          s += \",\";\r\n        }\r\n\r\n        if (!s.endsWith(\"$NL\") && !s.endsWith(\"\\n\")) {\r\n          s += \"$NL\";\r\n        }\r\n      }\r\n      s += tab + \"}$NL\";\r\n\r\n      if (s.length < CHAR_LIMIT) {\r\n        s = s.replace(/\\$NL/g, \"\");\r\n        s = s.replace(/(\\$TAB)+/g, \" \");\r\n      } else {\r\n        s = s.replace(/\\$NL/g, \"\\n\");\r\n        s = s.replace(/\\$TAB/g, \"  \");\r\n      }\r\n    } else if (typeof obj === \"undefined\") {\r\n      s = 'undefined';\r\n    } else if (typeof obj === \"function\") {\r\n      s = 'function ' + obj.name;\r\n    } else {\r\n      s = \"\" + obj;\r\n    }\r\n\r\n    return s;\r\n  }\r\n}\r\n\r\nexport const PendingTimeoutPromises = new Set();\r\n\r\nexport class TimeoutPromise {\r\n  constructor(callback, timeout = 3000, silent = false) {\r\n    if (!callback) {\r\n      return;\r\n    }\r\n\r\n    this.silent = silent;\r\n    this.timeout = timeout;\r\n\r\n    let accept2 = this._accept2.bind(this);\r\n    let reject2 = this._reject2.bind(this);\r\n\r\n    this.time = time_ms();\r\n\r\n    this.rejected = false;\r\n\r\n    this._promise = new Promise((accept, reject) => {\r\n      this._accept = accept;\r\n      this._reject = reject;\r\n\r\n      callback(accept2, reject2);\r\n    });\r\n\r\n    PendingTimeoutPromises.add(this);\r\n  }\r\n\r\n  _accept2(val) {\r\n    if (this.bad) {\r\n      if (!this.silent) {\r\n        this._reject(new Error(\"Timeout\"));\r\n      }\r\n    } else {\r\n      return this._accept(val);\r\n    }\r\n  }\r\n\r\n  static wrapPromise(promise, timeout = 3000, callback) {\r\n    let p = new TimeoutPromise();\r\n\r\n    p._promise = promise;\r\n\r\n    p._accept = callback;\r\n    p._reject = function (error) {\r\n      throw error;\r\n    }\r\n\r\n    p.then(val => {\r\n      p._accept2(val);\r\n    }).catch(error => {\r\n      p._reject2(error);\r\n    });\r\n\r\n    return p;\r\n  }\r\n\r\n  _reject2(error) {\r\n    this._reject(error);\r\n  }\r\n\r\n  then(callback) {\r\n    let cb = (val) => {\r\n      let ret = callback(val);\r\n\r\n      if (ret instanceof Promise) {\r\n        ret = TimeoutPromise.wrapPromise(ret, this.timeout, callback);\r\n      }\r\n\r\n      return ret;\r\n    }\r\n\r\n    this._promise.then(cb);\r\n    return this;\r\n  }\r\n\r\n  catch(callback) {\r\n    this._promise.catch(callback);\r\n    return this;\r\n  }\r\n\r\n  finally(callback) {\r\n    this._promise.catch(callback);\r\n    return this;\r\n  }\r\n\r\n  get bad() {\r\n    return time_ms() - this.time > this.timeout;\r\n  }\r\n}\r\n\r\nwindow.setInterval(() => {\r\n  let bad = [];\r\n\r\n  for (let promise of PendingTimeoutPromises) {\r\n    if (promise.bad) {\r\n      bad.push(promise);\r\n    }\r\n  }\r\n\r\n  for (let promise of bad) {\r\n    PendingTimeoutPromises.delete(promise);\r\n  }\r\n\r\n  for (let promise of bad) {\r\n    try {\r\n      promise._reject(new Error(\"Timeout\"));\r\n    } catch (error) {\r\n      print_stack(error);\r\n    }\r\n  }\r\n}, 250);\r\n\r\nimport lzstring from '../extern/lz-string/lz-string.js';\r\n\r\nexport function compress(data) {\r\n  return lzstring.compressToUint8Array(data);\r\n}\r\n\r\nexport function decompress(data) {\r\n  if (data instanceof DataView) {\r\n    data = data.buffer;\r\n  }\r\n\r\n  if (data instanceof ArrayBuffer) {\r\n    data = new Uint8Array(data);\r\n  }\r\n\r\n  return lzstring.decompressFromUint8Array(data);\r\n}\r\n\r\n/* Returns 'undefined' as type type.  Breaks the typescript\r\n   type system, is meant only for object pool systems.\r\n */\r\nexport function undefinedForGC() {\r\n  return undefined;\r\n}\r\n","import * as util from './util.js';\r\nimport nstructjs from './struct.js';\r\n\r\nexport const EulerOrders = {\r\n  XYZ: 0,\r\n  XZY: 1,\r\n  YXZ: 2,\r\n  YZX: 3,\r\n  ZXY: 4,\r\n  ZYX: 5\r\n};\r\n\r\n/**\r\n * @param mode one of 'es', 'commonjs', 'rjs'\r\n */\r\nwindow.makeCompiledVectormathCode = function (mode = \"es\") {\r\n  let s = \"\";\r\n  let es6exports = mode === \"es\";\r\n\r\n  function doExports(name) {\r\n    if (es6exports) {\r\n      return \"export\";\r\n    } else {\r\n      return `let ${name} = exports.${name} =`;\r\n    }\r\n  }\r\n\r\n  let classes = [Vector2, Vector3, Vector4, a];\r\n  let lens = {\r\n    Vector2: 2,\r\n    Vector3: 3,\r\n    Vector4: 4,\r\n    Quat   : 4\r\n  };\r\n\r\n  let modecode = \"\";\r\n\r\n  let nstructjscode = `\r\n  let g = typeof window !== \"undefined\" ? window : \"undefined\";\r\n  \r\n  g = g || (typeof global !== \"undefined\" ? global : \"undefined\");\r\n  g = g || (typeof self !== \"undefined\" ? self : \"undefined\");\r\n  g = g || (typeof globals !== \"undefined\" ? globals : \"undefined\");\r\n\r\n  if (typeof nstructjs === \"undefined\") {\r\n    //add nstructjs stub\r\n    g.nstructjs = {\r\n      register : function() {}\r\n    }\r\n  }\r\n  `\r\n\r\n  if (mode !== \"rjs\") {\r\n    if (mode === \"commonjs\") {\r\n      modecode = `if (typeof module !== \"undefined\" && typeof exports === \"undefined\") {\r\n      if (module.exports === undefined) {\r\n        module.exports = {};\r\n      }\r\n      \r\n      g.exports = module.exports;\r\n    } else if (typeof module === \"undefined\") {\r\n      g.exports = g.vectormath = {};\r\n    }\\n`;\r\n    }\r\n\r\n    s += `{\r\n      ${nstructjscode}\r\n    ${modecode}\r\n  }`;\r\n  }\r\n\r\n  s += `\r\nclass cachering extends Array {\r\n  constructor(func, size) {\r\n    super()\r\n\r\n    this.cur = 0;\r\n\r\n    for (let i=0; i<size; i++) {\r\n      this.push(func());\r\n    }\r\n  }\r\n\r\n  static fromConstructor(cls, size) {\r\n    let func = function() {\r\n      return new cls();\r\n    }\r\n\r\n    return new cachering(func, size);\r\n  }\r\n\r\n  next() {\r\n    let ret = this[this.cur];\r\n    this.cur = (this.cur+1)%this.length;\r\n\r\n    return ret;\r\n  }\r\n}\r\n`;\r\n  s += `\r\n\r\nlet M_SQRT2 = Math.sqrt(2.0);\r\nlet FLT_EPSILON = 2.22e-16;  \r\nlet sin=Math.sin, cos=Math.cos, abs=Math.abs, log=Math.log,\r\n    asin=Math.asin, exp=Math.exp, acos=Math.acos, fract=Math.fract,\r\n    sign=Math.sign, tent=Math.tent, atan2=Math.atan2, atan=Math.atan,\r\n    pow=Math.pow, sqrt=Math.sqrt, floor=Math.floor, ceil=Math.ceil,\r\n    min=Math.min, max=Math.max, PI=Math.PI, E=2.718281828459045;\r\n\r\nlet DOT_NORM_SNAP_LIMIT = 0.00000000001;\r\n\r\n${doExports(\"BaseVector\")} class BaseVector extends Array {\r\n  constructor() {\r\n    super();\r\n    \r\n    this.vec = undefined; //for compatibility with old files\r\n  }\r\n\r\n  copy() {\r\n    return new this.constructor(this);\r\n  }\r\n\r\n  load(data) {\r\n    throw new Error(\"Implement me!\");\r\n  }\r\n  \r\n  vectorLength() {\r\n    return sqrt(this.dot(this));\r\n  }\r\n  \r\n  normalize() {\r\n    let l = this.vectorLength();\r\n    if (l > 0.00000001) {\r\n      this.mulScalar(1.0/l);\r\n    }\r\n    \r\n    return this;\r\n  }\r\n}\r\n  \r\n`;\r\n\r\n  function indent(s, pad = \"  \") {\r\n    let l = s.split(\"\\n\");\r\n    let s2 = \"\";\r\n\r\n    for (let l2 of l) {\r\n      s2 += pad + l2 + \"\\n\";\r\n    }\r\n\r\n    return s2;\r\n  }\r\n\r\n  let i = 0;\r\n  for (let cls of classes) {\r\n    s += doExports(cls.name) + \" class \" + cls.name + \" extends BaseVector {\\n\";\r\n\r\n    let keys = Reflect.ownKeys(cls.prototype);\r\n\r\n    for (let k of keys) {\r\n      let v = cls.prototype[k];\r\n\r\n      if (typeof v !== \"function\") {\r\n        continue;\r\n      }\r\n\r\n      if (typeof k === \"symbol\") {\r\n        k = \"  [\" + k.toString() + \"]\";\r\n      }\r\n\r\n      v = (\"\" + v).trim();\r\n      if (v.startsWith(\"function(\") || v.startsWith(\"function (\")) {\r\n        v = k + v.slice(8, v.length).trim();\r\n      } else if (v.startsWith(\"function\")) {\r\n        v = v.slice(8, v.length).trim();\r\n      }\r\n\r\n      if (v.endsWith(\";}\")) {\r\n        v = v.slice(0, v.length - 1) + \"\\n  }\\n\";\r\n      }\r\n\r\n      let zero = \"\";\r\n      let l = lens[cls.name];\r\n\r\n      for (let j = 0; j < l; j++) {\r\n        if (j > 0) {\r\n          zero += \" = \";\r\n        }\r\n        zero += `this[${j}]`;\r\n      }\r\n\r\n      zero += \" = 0.0\";\r\n\r\n      if (k === \"constructor\") {\r\n        s += `  constructor(data) {\r\n    super(${l});\r\n        \r\n    this.vec = undefined; //for compatibility with old files\r\n    \r\n    if (arguments.length > 1) {\r\n      throw new Error(\"unexpected argument\");\r\n    }\r\n\r\n    //this.length = ${l};\r\n    ${zero};\r\n\r\n    if (data !== undefined) {\r\n      this.load(data);\r\n    }\r\n  }\r\n`;\r\n      } else {\r\n        s += indent(v);\r\n      }\r\n\r\n      s += \"\\n\";\r\n      i++;\r\n    }\r\n    s += \"}\\n\\n\"\r\n\r\n    s += `${cls.name}.STRUCT = \\`${cls.STRUCT}\\`;\\n`;\r\n    s += `nstructjs.register(${cls.name});\\n\\n`;\r\n  }\r\n\r\n  s += \"\\n\\n\" + (\"\" + internal_matrix).trim() + \"\\n\";\r\n  s += \"\\n\" + doExports(\"Matrix4\") + Matrix4;\r\n\r\n  s += `\\n  Matrix4.STRUCT = \\`${Matrix4.STRUCT}\\`;\\n`;\r\n  s += \"nstructjs.register(Matrix4)\\n\";\r\n\r\n  s += `\r\n  let _quat_vs3_temps = cachering.fromConstructor(Vector3, 64);\r\n  let _v3nd4_n1_normalizedDot4 = new Vector3();\r\n  let _v3nd4_n2_normalizedDot4 = new Vector3();\r\n  let _v3nd_n1_normalizedDot = new Vector3();\r\n  let _v3nd_n2_normalizedDot = new Vector3();\r\n\r\n  let $_v3nd4_n1_normalizedDot4 = new Vector3();\r\n  let $_v3nd4_n2_normalizedDot4 = new Vector3();\r\n  let $_v3nd_n1_normalizedDot = new Vector3();\r\n  let $_v3nd_n2_normalizedDot = new Vector3();\r\n\r\n  let lookat_cache_vs3 = cachering.fromConstructor(Vector3, 64);\r\n  let lookat_cache_vs4 = cachering.fromConstructor(Vector4, 64);\r\n\r\n  let makenormalcache = cachering.fromConstructor(Vector3, 64);\r\n`;\r\n\r\n  if (mode === \"rjs\") {\r\n    s = `define([], function() {\r\n  \"use strict\";\r\n\r\n  let exports = {};\r\n\r\n  {\r\n    ${nstructjscode}\r\n  }\r\n  ${indent(s)}\r\n\r\n  return exports;\r\n});\r\n`;\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nlet sin                                                          = Math.sin, cos = Math.cos, abs = Math.abs, log = Math.log,\r\n    asin                                                         = Math.asin, exp = Math.exp, acos = Math.acos, fract    = Math.fract,\r\n    sign = Math.sign, tent = Math.tent, atan2 = Math.atan2, atan = Math.atan,\r\n    pow                                                          = Math.pow, sqrt = Math.sqrt, floor                      = Math.floor, ceil   = Math.ceil,\r\n    min                                                          = Math.min, max                                          = Math.max, PI = Math.PI, E = 2.718281828459045;\r\n\r\nlet DOT_NORM_SNAP_LIMIT = 0.00000000001;\r\nlet M_SQRT2 = Math.sqrt(2.0);\r\nlet FLT_EPSILON = 2.22e-16;\r\n\r\nlet basic_funcs = {\r\n  equals: [[\"b\"], \"this[X] === b[X]\", \"&&\"],\r\n  /*dot is made manually so it's safe for acos\r\n  dot     : [[\"b\"], \"this[X]*b[X]\", \"+\"],\r\n   */\r\n  zero     : [[], \"0.0;\"],\r\n  negate   : [[], \"-this[X];\"],\r\n  combine  : [[\"b\", \"u\", \"v\"], \"this[X]*u + this[X]*v;\"],\r\n  interp   : [[\"b\", \"t\"], \"this[X] + (b[X] - this[X])*t;\"],\r\n  add      : [[\"b\"], \"this[X] + b[X];\"],\r\n  addFac   : [[\"b\", \"F\"], \"this[X] + b[X]*F;\"],\r\n  fract    : [[], \"Math.fract(this[X]);\"],\r\n  sub      : [[\"b\"], \"this[X] - b[X];\"],\r\n  mul      : [[\"b\"], \"this[X] * b[X];\"],\r\n  div      : [[\"b\"], \"this[X] / b[X];\"],\r\n  mulScalar: [[\"b\"], \"this[X] * b;\"],\r\n  divScalar: [[\"b\"], \"this[X] / b;\"],\r\n  addScalar: [[\"b\"], \"this[X] + b;\"],\r\n  subScalar: [[\"b\"], \"this[X] - b;\"],\r\n  minScalar: [[\"b\"], \"Math.min(this[X], b);\"],\r\n  maxScalar: [[\"b\"], \"Math.max(this[X], b);\"],\r\n  ceil     : [[], \"Math.ceil(this[X])\"],\r\n  floor    : [[], \"Math.floor(this[X])\"],\r\n  abs      : [[], \"Math.abs(this[X])\"],\r\n  min      : [[\"b\"], \"Math.min(this[X], b[X])\"],\r\n  max      : [[\"b\"], \"Math.max(this[X], b[X])\"],\r\n  clamp    : [[\"MIN\", \"MAX\"], \"min(max(this[X], MAX), MIN)\"],\r\n};\r\n\r\nfunction bounded_acos(fac) {\r\n  if (fac <= -1.0)\r\n    return Math.pi;\r\n  else if (fac >= 1.0)\r\n    return 0.0;\r\n  else\r\n    return Math.acos(fac);\r\n}\r\n\r\nfunction make_norm_safe_dot(cls) {\r\n  let _dot = cls.prototype.dot;\r\n\r\n  cls.prototype._dot = _dot;\r\n  cls.prototype.dot = function (b) {\r\n    let ret = _dot.call(this, b);\r\n\r\n    if (ret >= 1.0 - DOT_NORM_SNAP_LIMIT && ret <= 1.0 + DOT_NORM_SNAP_LIMIT)\r\n      return 1.0;\r\n    if (ret >= -1.0 - DOT_NORM_SNAP_LIMIT && ret <= -1.0 + DOT_NORM_SNAP_LIMIT)\r\n      return -1.0;\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nfunction getBaseVector(parent) {\r\n  return class BaseVector extends parent {\r\n    constructor() {\r\n      super(...arguments);\r\n\r\n      this.vec = undefined; //for compatibility with old nstructjs-saved files\r\n\r\n      //this.xyzw = this.init_swizzle(4);\r\n      //this.xyz = this.init_swizzle(3);\r\n      //this.xy = this.init_swizzle(2);\r\n    }\r\n\r\n    static inherit(cls, vectorsize) {\r\n      make_norm_safe_dot(cls);\r\n\r\n      var f;\r\n\r\n      let vectorDotDistance = \"f = function vectorDotDistance(b) {\\n\";\r\n      for (let i = 0; i < vectorsize; i++) {\r\n        vectorDotDistance += \"  let d\" + i + \" = this[\" + i + \"]-b[\" + i + \"];\\n\\n  \";\r\n      }\r\n\r\n      vectorDotDistance += \"  return \"\r\n      for (let i = 0; i < vectorsize; i++) {\r\n        if (i > 0)\r\n          vectorDotDistance += \" + \";\r\n        vectorDotDistance += \"d\" + i + \"*d\" + i;\r\n      }\r\n      vectorDotDistance += \";\\n\"\r\n      vectorDotDistance += \"};\";\r\n      cls.prototype.vectorDotDistance = eval(vectorDotDistance);\r\n\r\n      f = undefined\r\n      let vectorDistance = \"f = function vectorDistance(b) {\\n\";\r\n      for (let i = 0; i < vectorsize; i++) {\r\n        vectorDistance += `  let d${i} = this[${i}] - (b[${i}]||0);\\n\\n  `;\r\n        //vectorDistance += \"  let d\"+i+\" = this[\"+i+\"]-(b[\"+i+\"]||0);\\n\\n  \";\r\n      }\r\n\r\n      vectorDistance += \"  return Math.sqrt(\"\r\n      for (let i = 0; i < vectorsize; i++) {\r\n        if (i > 0)\r\n          vectorDistance += \" + \";\r\n        vectorDistance += \"d\" + i + \"*d\" + i;\r\n      }\r\n      vectorDistance += \");\\n\"\r\n      vectorDistance += \"};\";\r\n      cls.prototype.vectorDistance = eval(vectorDistance);\r\n\r\n      let vectorDistanceSqr = \"f = function vectorDistanceSqr(b) {\\n\";\r\n      for (let i = 0; i < vectorsize; i++) {\r\n        vectorDistanceSqr += `  let d${i} = this[${i}] - (b[${i}]||0);\\n\\n  `;\r\n        //vectorDistanceSqr += \"  let d\"+i+\" = this[\"+i+\"]-(b[\"+i+\"]||0);\\n\\n  \";\r\n      }\r\n\r\n      vectorDistanceSqr += \"  return (\"\r\n      for (let i = 0; i < vectorsize; i++) {\r\n        if (i > 0)\r\n          vectorDistanceSqr += \" + \";\r\n        vectorDistanceSqr += \"d\" + i + \"*d\" + i;\r\n      }\r\n      vectorDistanceSqr += \");\\n\"\r\n      vectorDistanceSqr += \"};\";\r\n      cls.prototype.vectorDistanceSqr = eval(vectorDistanceSqr);\r\n\r\n\r\n      for (let k in basic_funcs) {\r\n        let func = basic_funcs[k];\r\n        let args = func[0];\r\n        let line = func[1];\r\n        var f;\r\n\r\n        let code = \"f = function \" + k + \"(\"\r\n        for (let i = 0; i < args.length; i++) {\r\n          if (i > 0)\r\n            code += \", \";\r\n\r\n          line = line.replace(args[i], args[i].toLowerCase());\r\n          code += args[i].toLowerCase();\r\n        }\r\n        code += \") {\\n\";\r\n\r\n        if (func.length > 2) {\r\n          //make summation\r\n          code += \"  return \";\r\n\r\n          for (let i = 0; i < vectorsize; i++) {\r\n            if (i > 0)\r\n              code += func[2];\r\n\r\n            code += \"(\" + line.replace(/X/g, \"\" + i) + \")\";\r\n          }\r\n          code += \";\\n\";\r\n        } else {\r\n          for (let i = 0; i < vectorsize; i++) {\r\n            let line2 = line.replace(/X/g, \"\" + i);\r\n            code += \"  this[\" + i + \"] = \" + line2 + \";\\n\";\r\n          }\r\n          code += \"  return this;\\n\"\r\n        }\r\n\r\n        code += \"}\\n\";\r\n\r\n        //console.log(code);\r\n        f = eval(code);\r\n\r\n        cls.prototype[k] = f;\r\n        //console.log(k, f);\r\n      }\r\n    }\r\n\r\n    copy() {\r\n      return new this.constructor(this);\r\n    }\r\n\r\n    load(data) {\r\n      throw new Error(\"Implement me!\");\r\n    }\r\n\r\n    init_swizzle(size) {\r\n      let ret = {};\r\n      let cls = size === 4 ? Vector4 : (size === 3 ? Vector3 : Vector2);\r\n\r\n      for (let k in cls.prototype) {\r\n        let v = cls.prototype[k];\r\n        if (typeof v !== \"function\" && !(v instanceof Function))\r\n          continue;\r\n\r\n        ret[k] = v.bind(this);\r\n      }\r\n\r\n      return ret;\r\n    }\r\n\r\n    vectorLength() {\r\n      return sqrt(this.dot(this));\r\n    }\r\n\r\n    swapAxes(axis1, axis2) {\r\n      let t = this[axis1];\r\n      this[axis1] = this[axis2];\r\n      this[axis2] = t;\r\n\r\n      return this;\r\n    }\r\n\r\n    sinterp(v2, t) {\r\n      let l1 = this.vectorLength();\r\n      let l2 = v2.vectorLength();\r\n\r\n      //XXX this seems horribly incorrect.\r\n      return this.interp(v2, t).normalize().mulScalar(l1 + (l2 - l1)*t);\r\n    }\r\n\r\n    perpSwap(axis1 = 0, axis2 = 1, sign = 1) {\r\n      let tmp = this[axis1];\r\n\r\n      this[axis1] = this[axis2]*sign;\r\n      this[axis2] = -tmp*sign;\r\n\r\n      return this;\r\n    }\r\n\r\n    normalize() {\r\n      /*\r\n      for (let i=0; i<this.length; i++) {\r\n        if (util.isDenormal(this[i])) {\r\n          console.error(\"Denormal error\", i, this[i]);\r\n          this[i] = 0.0;\r\n        }\r\n      }\r\n      //*/\r\n\r\n      let l = this.vectorLength();\r\n\r\n      /*\r\n      if (util.isDenormal(l)) {\r\n        console.error(\"Denormal error\", l);\r\n      }\r\n      //*/\r\n\r\n      if (l > 0.00000001) {\r\n        this.mulScalar(1.0/l);\r\n      }\r\n\r\n      return this;\r\n    }\r\n  }\r\n}\r\n\r\nexport const BaseVector = getBaseVector(Array);\r\nexport const F64BaseVector = getBaseVector(Float64Array);\r\nexport const F32BaseVector = getBaseVector(Float32Array);\r\nexport const I32BaseVector = getBaseVector(Int32Array);\r\nexport const I16BaseVector = getBaseVector(Int16Array);\r\nexport const I8BaseVector = getBaseVector(Int8Array);\r\nexport const UI32BaseVector = getBaseVector(Uint32Array);\r\nexport const UI16BaseVector = getBaseVector(Uint16Array);\r\nexport const UI8BaseVector = getBaseVector(Uint8Array);\r\n\r\n\r\nfunction myclamp(f, a, b) {\r\n  return Math.min(Math.max(f, a), b);\r\n}\r\n\r\nexport function makeVector4(BaseVector, structName = 'vec4', structType = 'float') {\r\n  let temp1, temp2, temp3, temp4;\r\n\r\n  const Vector4 = class Vector4 extends BaseVector {\r\n    static STRUCT = nstructjs.inlineRegister(this, `\r\n    ${structName} {\r\n      0 : ${structType};\r\n      1 : ${structType};\r\n      2 : ${structType};\r\n      3 : ${structType};\r\n    }`);\r\n\r\n    constructor(data) {\r\n      super(4);\r\n\r\n      if (arguments.length > 1) {\r\n        throw new Error(\"unexpected argument\");\r\n      }\r\n\r\n      this[0] = this[1] = this[2] = this[3] = 0.0;\r\n\r\n      if (data !== undefined) {\r\n        this.load(data);\r\n      }\r\n    }\r\n\r\n    toCSS() {\r\n      let r = ~~(this[0]*255);\r\n      let g = ~~(this[1]*255);\r\n      let b = ~~(this[2]*255);\r\n      let a = this[3];\r\n      return `rgba(${r},${g},${b},${a})`\r\n    }\r\n\r\n    loadXYZW(x, y, z, w) {\r\n      this[0] = x;\r\n      this[1] = y;\r\n      this[2] = z;\r\n      this[3] = w;\r\n\r\n      return this;\r\n    }\r\n\r\n    loadXYZ(x, y, z) {\r\n      this[0] = x;\r\n      this[1] = y;\r\n      this[2] = z;\r\n\r\n      return this;\r\n    }\r\n\r\n    static normalizedDot4(v1, v2, v3, v4) {\r\n      temp1.load(v2).sub(v1).normalize()\r\n      temp2.load(v4).sub(v3).normalize();\r\n\r\n      return temp1.dot(temp2);\r\n\r\n    }\r\n\r\n    static normalizedDot3(v1, center, v2) {\r\n      temp1.load(v1).sub(center).normalize();\r\n      temp2.load(v2).sub(center).normalize();\r\n\r\n      return temp1.dot(temp2);\r\n    }\r\n\r\n    load(data) {\r\n      if (data === undefined)\r\n        return this;\r\n\r\n      this[0] = data[0];\r\n      this[1] = data[1];\r\n      this[2] = data[2];\r\n      this[3] = data[3];\r\n\r\n      return this;\r\n    }\r\n\r\n    dot(b) {\r\n      return this[0]*b[0] + this[1]*b[1] + this[2]*b[2] + this[3]*b[3];\r\n    }\r\n\r\n    mulVecQuat(q) {\r\n      let t0 = -q[1]*this[0] - q[2]*this[1] - q[3]*this[2];\r\n      let t1 = q[0]*this[0] + q[2]*this[2] - q[3]*this[1];\r\n      let t2 = q[0]*this[1] + q[3]*this[0] - q[1]*this[2];\r\n\r\n      this[2] = q[0]*this[2] + q[1]*this[1] - q[2]*this[0];\r\n      this[0] = t1;\r\n      this[1] = t2;\r\n\r\n      t1 = t0* -q[1] + this[0]*q[0] - this[1]*q[3] + this[2]*q[2];\r\n      t2 = t0* -q[2] + this[1]*q[0] - this[2]*q[1] + this[0]*q[3];\r\n\r\n      this[2] = t0* -q[3] + this[2]*q[0] - this[0]*q[2] + this[1]*q[1];\r\n      this[0] = t1;\r\n      this[1] = t2;\r\n\r\n      return this;\r\n    }\r\n\r\n    multVecMatrix(matrix) {\r\n      let x = this[0];\r\n      let y = this[1];\r\n      let z = this[2];\r\n      let w = this[3];\r\n\r\n      this[0] = w*matrix.$matrix.m41 + x*matrix.$matrix.m11 + y*matrix.$matrix.m21 + z*matrix.$matrix.m31;\r\n      this[1] = w*matrix.$matrix.m42 + x*matrix.$matrix.m12 + y*matrix.$matrix.m22 + z*matrix.$matrix.m32;\r\n      this[2] = w*matrix.$matrix.m43 + x*matrix.$matrix.m13 + y*matrix.$matrix.m23 + z*matrix.$matrix.m33;\r\n      this[3] = w*matrix.$matrix.m44 + x*matrix.$matrix.m14 + y*matrix.$matrix.m24 + z*matrix.$matrix.m34;\r\n\r\n      return this[3];\r\n    }\r\n\r\n    cross(v) {\r\n      let x = this[1]*v[2] - this[2]*v[1];\r\n      let y = this[2]*v[0] - this[0]*v[2];\r\n      let z = this[0]*v[1] - this[1]*v[0];\r\n\r\n      this[0] = x;\r\n      this[1] = y;\r\n      this[2] = z;\r\n\r\n      return this;\r\n    }\r\n\r\n    preNormalizedAngle(v2) {\r\n      let th = this.dot(v2)*0.99999;\r\n      return Math.acos(th);\r\n    }\r\n\r\n    loadSTRUCT(reader) {\r\n      reader(this);\r\n\r\n      if (typeof this.vec !== \"undefined\") {\r\n        this.load(this.vec);\r\n        this.vec = undefined;\r\n      }\r\n    }\r\n  };\r\n\r\n  temp1 = new Vector4();\r\n  temp2 = new Vector4();\r\n  temp3 = new Vector4();\r\n  temp4 = new Vector4();\r\n\r\n  return Vector4;\r\n}\r\n\r\nexport const Vector4 = makeVector4(BaseVector);\r\n\r\nlet _v3nd_n1_normalizedDot, _v3nd_n2_normalizedDot;\r\nlet _v3nd4_n1_normalizedDot4, _v3nd4_n2_normalizedDot4;\r\n\r\nexport function makeVector3(BaseVector, structName = 'vec3', structType = 'float', customConstructorCode = undefined) {\r\n  var Vector3;\r\n  var bundlehelper = [nstructjs];\r\n\r\n  const constructorCode = customConstructorCode ?? `\r\n    constructor(data) {\r\n      super(3);\r\n\r\n      if (arguments.length > 1) {\r\n        throw new Error(\"unexpected argument\");\r\n      }\r\n\r\n      this[0] = this[1] = this[2] = 0.0;\r\n\r\n      if (data !== undefined) {\r\n        this.load(data);\r\n      }\r\n\r\n      if (this.constructor === Vector3) {\r\n        Object.preventExtensions(this);\r\n      }\r\n    }\r\n  `;\r\n\r\n  const code = `\r\n  let temp1, temp2, temp3, temp4;\r\n  Vector3 = class Vector3 extends BaseVector {\r\n    static STRUCT = bundlehelper[0].inlineRegister(this, \\`\r\n    ${structName} {\r\n      0 : ${structType};\r\n      1 : ${structType};\r\n      2 : ${structType};\r\n    }\\`);\r\n\r\n    ${constructorCode}\r\n\r\n    static normalizedDot4(v1, v2, v3, v4) {\r\n      temp1.load(v2).sub(v1).normalize()\r\n      temp2.load(v4).sub(v3).normalize();\r\n\r\n      return temp1.dot(temp2);\r\n\r\n    }\r\n\r\n    static normalizedDot3(v1, center, v2) {\r\n      temp1.load(v1).sub(center).normalize();\r\n      temp2.load(v2).sub(center).normalize();\r\n\r\n      return temp1.dot(temp2);\r\n    }\r\n\r\n    toCSS() {\r\n      let r = ~~(this[0]*255);\r\n      let g = ~~(this[1]*255);\r\n      let b = ~~(this[2]*255);\r\n      return \\`rgb(\\${r},\\${g},\\${b})\\`\r\n    }\r\n\r\n    loadXYZ(x, y, z) {\r\n      this[0] = x;\r\n      this[1] = y;\r\n      this[2] = z;\r\n\r\n      return this;\r\n    }\r\n\r\n    loadXY(x, y) {\r\n      this[0] = x;\r\n      this[1] = y;\r\n\r\n      return this;\r\n    }\r\n\r\n    toJSON() {\r\n      return [this[0], this[1], this[2]];\r\n    }\r\n\r\n    loadJSON(obj) {\r\n      return this.load(obj);\r\n    }\r\n\r\n    initVector3() {\r\n      this.length = 3;\r\n      this[0] = this[1] = this[2] = 0;\r\n      return this;\r\n    }\r\n\r\n    load(data) {\r\n      if (data === undefined)\r\n        return this;\r\n\r\n      //if (isNaN(data[0]) || isNaN(data[1]) || isNaN(data[2])) {\r\n      //  throw new Error(\"NaN\");\r\n      //}\r\n\r\n      this[0] = data[0];\r\n      this[1] = data[1];\r\n      this[2] = data[2];\r\n\r\n      return this;\r\n    }\r\n\r\n    dot(b) {\r\n      return this[0]*b[0] + this[1]*b[1] + this[2]*b[2];\r\n    }\r\n\r\n    normalizedDot(v) {\r\n      $_v3nd_n1_normalizedDot.load(this);\r\n      $_v3nd_n2_normalizedDot.load(v);\r\n      $_v3nd_n1_normalizedDot.normalize();\r\n      $_v3nd_n2_normalizedDot.normalize();\r\n      return $_v3nd_n1_normalizedDot.dot($_v3nd_n2_normalizedDot);\r\n    }\r\n\r\n    mulVecQuat(q) {\r\n      let t0 = -q[1]*this[0] - q[2]*this[1] - q[3]*this[2];\r\n      let t1 = q[0]*this[0] + q[2]*this[2] - q[3]*this[1];\r\n      let t2 = q[0]*this[1] + q[3]*this[0] - q[1]*this[2];\r\n\r\n      this[2] = q[0]*this[2] + q[1]*this[1] - q[2]*this[0];\r\n      this[0] = t1;\r\n      this[1] = t2;\r\n\r\n      t1 = t0* -q[1] + this[0]*q[0] - this[1]*q[3] + this[2]*q[2];\r\n      t2 = t0* -q[2] + this[1]*q[0] - this[2]*q[1] + this[0]*q[3];\r\n\r\n      this[2] = t0* -q[3] + this[2]*q[0] - this[0]*q[2] + this[1]*q[1];\r\n      this[0] = t1;\r\n      this[1] = t2;\r\n\r\n      return this;\r\n    }\r\n\r\n    multVecMatrix(matrix, ignore_w) {\r\n      if (ignore_w === undefined) {\r\n        ignore_w = false;\r\n      }\r\n      let x = this[0];\r\n      let y = this[1];\r\n      let z = this[2];\r\n      this[0] = matrix.$matrix.m41 + x*matrix.$matrix.m11 + y*matrix.$matrix.m21 + z*matrix.$matrix.m31;\r\n      this[1] = matrix.$matrix.m42 + x*matrix.$matrix.m12 + y*matrix.$matrix.m22 + z*matrix.$matrix.m32;\r\n      this[2] = matrix.$matrix.m43 + x*matrix.$matrix.m13 + y*matrix.$matrix.m23 + z*matrix.$matrix.m33;\r\n      let w = matrix.$matrix.m44 + x*matrix.$matrix.m14 + y*matrix.$matrix.m24 + z*matrix.$matrix.m34;\r\n\r\n      if (!ignore_w && w !== 1 && w !== 0 && matrix.isPersp) {\r\n        this[0] /= w;\r\n        this[1] /= w;\r\n        this[2] /= w;\r\n      }\r\n      return w;\r\n    }\r\n\r\n    cross(v) {\r\n      let x = this[1]*v[2] - this[2]*v[1];\r\n      let y = this[2]*v[0] - this[0]*v[2];\r\n      let z = this[0]*v[1] - this[1]*v[0];\r\n\r\n      this[0] = x;\r\n      this[1] = y;\r\n      this[2] = z;\r\n\r\n      return this;\r\n    }\r\n\r\n    //axis is optional, 0\r\n    rot2d(A, axis = 0) {\r\n      let x = this[0];\r\n      let y = this[1];\r\n\r\n      if (axis === 1) {\r\n        this[0] = x*Math.cos(A) + y*Math.sin(A);\r\n        this[1] = y*Math.cos(A) - x*Math.sin(A);\r\n      } else {\r\n        this[0] = x*Math.cos(A) - y*Math.sin(A);\r\n        this[1] = y*Math.cos(A) + x*Math.sin(A);\r\n      }\r\n\r\n      return this;\r\n    }\r\n\r\n    preNormalizedAngle(v2) {\r\n      let th = this.dot(v2)*0.99999;\r\n      return Math.acos(th);\r\n    }\r\n\r\n    loadSTRUCT(reader) {\r\n      reader(this);\r\n\r\n      if (typeof this.vec !== \"undefined\") {\r\n        this.load(this.vec);\r\n        this.vec = undefined;\r\n      }\r\n    }\r\n  }\r\n\r\n  temp1 = new Vector3();\r\n  temp2 = new Vector3();\r\n  temp3 = new Vector3();\r\n  temp4 = new Vector3();\r\n  `;\r\n\r\n  eval(code);\r\n  return Vector3;\r\n}\r\n\r\nexport const Vector3 = makeVector3(F64BaseVector);\r\n\r\nexport function makeVector2(BaseVector, structName = 'vec2', structType = 'float') {\r\n  let temp1, temp2, temp3, temp4;\r\n\r\n  const Vector2 = class Vector2 extends BaseVector {\r\n    static STRUCT = nstructjs.inlineRegister(this, `\r\n    ${structName} {\r\n      0 : ${structType};\r\n      1 : ${structType};\r\n    }`);\r\n\r\n    constructor(data) {\r\n      super(2);\r\n\r\n      if (arguments.length > 1) {\r\n        throw new Error(\"unexpected argument\");\r\n      }\r\n\r\n      this[0] = this[1] = 0.0;\r\n\r\n      if (data !== undefined) {\r\n        this.load(data);\r\n      }\r\n    }\r\n\r\n    initVector2(co) {\r\n      this.length = 2;\r\n\r\n      if (co !== undefined) {\r\n        this[0] = co[0];\r\n        this[1] = co[1];\r\n      } else {\r\n        this[0] = this[1] = 0.0;\r\n      }\r\n\r\n      return this;\r\n    }\r\n\r\n    static normalizedDot4(v1, v2, v3, v4) {\r\n      temp1.load(v2).sub(v1).normalize()\r\n      temp2.load(v4).sub(v3).normalize();\r\n\r\n      return temp1.dot(temp2);\r\n    }\r\n\r\n    static normalizedDot3(v1, center, v2) {\r\n      temp1.load(v1).sub(center).normalize();\r\n      temp2.load(v2).sub(center).normalize();\r\n\r\n      return temp1.dot(temp2);\r\n    }\r\n\r\n    toJSON() {\r\n      return [this[0], this[1]];\r\n    }\r\n\r\n    loadJSON(obj) {\r\n      return this.load(obj);\r\n    }\r\n\r\n    loadXY(x, y) {\r\n      this[0] = x;\r\n      this[1] = y;\r\n\r\n      return this;\r\n    }\r\n\r\n    load(data) {\r\n      if (data === undefined)\r\n        return this;\r\n\r\n      this[0] = data[0];\r\n      this[1] = data[1];\r\n\r\n      return this;\r\n    }\r\n\r\n    //axis is optional, 0\r\n    rot2d(A, axis) {\r\n      let x = this[0];\r\n      let y = this[1];\r\n\r\n      if (axis === 1) {\r\n        this[0] = x*Math.cos(A) + y*Math.sin(A);\r\n        this[1] = y*Math.cos(A) - x*Math.sin(A);\r\n      } else {\r\n        this[0] = x*Math.cos(A) - y*Math.sin(A);\r\n        this[1] = y*Math.cos(A) + x*Math.sin(A);\r\n      }\r\n\r\n      return this;\r\n    }\r\n\r\n    dot(b) {\r\n      return this[0]*b[0] + this[1]*b[1];\r\n    }\r\n\r\n    multVecMatrix(matrix) {\r\n      let x = this[0];\r\n      let y = this[1];\r\n\r\n      let w = 1.0;\r\n\r\n      this[0] = w*matrix.$matrix.m41 + x*matrix.$matrix.m11 + y*matrix.$matrix.m21;\r\n      this[1] = w*matrix.$matrix.m42 + x*matrix.$matrix.m12 + y*matrix.$matrix.m22;\r\n\r\n      if (matrix.isPersp) {\r\n        let w2 = w*matrix.$matrix.m44 + x*matrix.$matrix.m14 + y*matrix.$matrix.m24;\r\n\r\n        if (w2 !== 0.0) {\r\n          this[0] /= w2;\r\n          this[1] /= w2;\r\n        }\r\n      }\r\n\r\n      return this;\r\n    }\r\n\r\n    mulVecQuat(q) {\r\n      let t0 = -q[1]*this[0] - q[2]*this[1];\r\n      let t1 = q[0]*this[0] - q[3]*this[1];\r\n      let t2 = q[0]*this[1] + q[3]*this[0];\r\n\r\n      let z = q[1]*this[1] - q[2]*this[0];\r\n      this[0] = t1;\r\n      this[1] = t2;\r\n\r\n      t1 = t0* -q[1] + this[0]*q[0] - this[1]*q[3] + z*q[2];\r\n      t2 = t0* -q[2] + this[1]*q[0] - z*q[1] + this[0]*q[3];\r\n\r\n      this[0] = t1;\r\n      this[1] = t2;\r\n\r\n      return this;\r\n    }\r\n\r\n    vectorLengthSqr() {\r\n      return this.dot(this);\r\n    }\r\n\r\n    loadSTRUCT(reader) {\r\n      reader(this);\r\n\r\n      if (typeof this.vec !== undefined) {\r\n        this.load(this.vec);\r\n        this.vec = undefined;\r\n      }\r\n    }\r\n  };\r\n\r\n  temp1 = new Vector2();\r\n  temp2 = new Vector2();\r\n  temp3 = new Vector2();\r\n  temp4 = new Vector2();\r\n\r\n  return Vector2;\r\n}\r\n\r\nexport const Vector2 = makeVector2(BaseVector)\r\n\r\nlet _quat_vs3_temps = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport class Quat extends Vector4 {\r\n  makeUnitQuat() {\r\n    this[0] = 1.0;\r\n    this[1] = this[2] = this[3] = 0.0;\r\n  }\r\n\r\n  isZero() {\r\n    return (this[0] === 0 && this[1] === 0 && this[2] === 0 && this[3] === 0);\r\n  }\r\n\r\n  mulQuat(qt) {\r\n    let a = this[0]*qt[0] - this[1]*qt[1] - this[2]*qt[2] - this[3]*qt[3];\r\n    let b = this[0]*qt[1] + this[1]*qt[0] + this[2]*qt[3] - this[3]*qt[2];\r\n    let c = this[0]*qt[2] + this[2]*qt[0] + this[3]*qt[1] - this[1]*qt[3];\r\n    this[3] = this[0]*qt[3] + this[3]*qt[0] + this[1]*qt[2] - this[2]*qt[1];\r\n    this[0] = a;\r\n    this[1] = b;\r\n    this[2] = c;\r\n  }\r\n\r\n  conjugate() {\r\n    this[1] = -this[1];\r\n    this[2] = -this[2];\r\n    this[3] = -this[3];\r\n  }\r\n\r\n  dotWithQuat(q2) {\r\n    return this[0]*q2[0] + this[1]*q2[1] + this[2]*q2[2] + this[3]*q2[3];\r\n  }\r\n\r\n  invert() {\r\n    let f = this.dot(this);\r\n\r\n    if (f === 0.0)\r\n      return;\r\n\r\n    conjugate_qt(q);\r\n    this.mulscalar(1.0/f);\r\n  }\r\n\r\n  sub(q2) {\r\n    let nq2 = new Quat();\r\n\r\n    nq2[0] = -q2[0];\r\n    nq2[1] = q2[1];\r\n    nq2[2] = q2[2];\r\n    nq2[3] = q2[3];\r\n\r\n    this.mul(nq2);\r\n  }\r\n\r\n  mulScalarWithFactor(fac) {\r\n    let angle = fac*bounded_acos(this[0]);\r\n    let co = Math.cos(angle);\r\n    let si = Math.sin(angle);\r\n\r\n    this[0] = co;\r\n\r\n    let last3 = Vector3([this[1], this[2], this[3]]);\r\n    last3.normalize();\r\n    last3.mulScalar(si);\r\n    this[1] = last3[0];\r\n    this[2] = last3[1];\r\n    this[3] = last3[2];\r\n    return this;\r\n  }\r\n\r\n  toMatrix(m) {\r\n    if (m === undefined) {\r\n      m = new Matrix4();\r\n    }\r\n\r\n    let q0 = M_SQRT2*this[0];\r\n    let q1 = M_SQRT2*this[1];\r\n    let q2 = M_SQRT2*this[2];\r\n    let q3 = M_SQRT2*this[3];\r\n    let qda = q0*q1;\r\n    let qdb = q0*q2;\r\n    let qdc = q0*q3;\r\n    let qaa = q1*q1;\r\n    let qab = q1*q2;\r\n    let qac = q1*q3;\r\n    let qbb = q2*q2;\r\n    let qbc = q2*q3;\r\n    let qcc = q3*q3;\r\n    m.$matrix.m11 = (1.0 - qbb - qcc);\r\n    m.$matrix.m12 = (qdc + qab);\r\n    m.$matrix.m13 = (-qdb + qac);\r\n    m.$matrix.m14 = 0.0;\r\n    m.$matrix.m21 = (-qdc + qab);\r\n    m.$matrix.m22 = (1.0 - qaa - qcc);\r\n    m.$matrix.m23 = (qda + qbc);\r\n    m.$matrix.m24 = 0.0;\r\n    m.$matrix.m31 = (qdb + qac);\r\n    m.$matrix.m32 = (-qda + qbc);\r\n    m.$matrix.m33 = (1.0 - qaa - qbb);\r\n    m.$matrix.m34 = 0.0;\r\n    m.$matrix.m41 = m.$matrix.m42 = m.$matrix.m43 = 0.0;\r\n    m.$matrix.m44 = 1.0;\r\n\r\n    return m;\r\n  }\r\n\r\n  matrixToQuat(wmat) {\r\n    let mat = temp_mats.next();\r\n    mat.load(wmat);\r\n\r\n    mat.$matrix.m41 = mat.$matrix.m42 = mat.$matrix.m43 = 0;\r\n    mat.$matrix.m44 = 1.0;\r\n\r\n    let r1 = new Vector3([mat.$matrix.m11, mat.$matrix.m12, mat.$matrix.m13]);\r\n    let r2 = new Vector3([mat.$matrix.m21, mat.$matrix.m22, mat.$matrix.m23]);\r\n    let r3 = new Vector3([mat.$matrix.m31, mat.$matrix.m32, mat.$matrix.m33]);\r\n\r\n    r1.normalize();\r\n    r2.normalize();\r\n    r3.normalize();\r\n\r\n    mat.$matrix.m11 = r1[0];\r\n    mat.$matrix.m12 = r1[1];\r\n    mat.$matrix.m13 = r1[2];\r\n    mat.$matrix.m21 = r2[0];\r\n    mat.$matrix.m22 = r2[1];\r\n    mat.$matrix.m23 = r2[2];\r\n    mat.$matrix.m31 = r3[0];\r\n    mat.$matrix.m32 = r3[1];\r\n    mat.$matrix.m33 = r3[2];\r\n    let tr = 0.25*(1.0 + mat.$matrix.m11 + mat.$matrix.m22 + mat.$matrix.m33);\r\n    let s = 0;\r\n    if (tr > FLT_EPSILON) {\r\n      s = Math.sqrt(tr);\r\n      this[0] = s;\r\n      s = 1.0/(4.0*s);\r\n      this[1] = ((mat.$matrix.m23 - mat.$matrix.m32)*s);\r\n      this[2] = ((mat.$matrix.m31 - mat.$matrix.m13)*s);\r\n      this[3] = ((mat.$matrix.m12 - mat.$matrix.m21)*s);\r\n    } else {\r\n      if (mat.$matrix.m11 > mat.$matrix.m22 && mat.$matrix.m11 > mat.$matrix.m33) {\r\n        s = 2.0*Math.sqrt(1.0 + mat.$matrix.m11 - mat.$matrix.m22 - mat.$matrix.m33);\r\n        this[1] = (0.25*s);\r\n        s = 1.0/s;\r\n        this[0] = ((mat.$matrix.m32 - mat.$matrix.m23)*s);\r\n        this[2] = ((mat.$matrix.m21 + mat.$matrix.m12)*s);\r\n        this[3] = ((mat.$matrix.m31 + mat.$matrix.m13)*s);\r\n      } else if (mat.$matrix.m22 > mat.$matrix.m33) {\r\n        s = 2.0*Math.sqrt(1.0 + mat.$matrix.m22 - mat.$matrix.m11 - mat.$matrix.m33);\r\n        this[2] = (0.25*s);\r\n        s = 1.0/s;\r\n        this[0] = ((mat.$matrix.m31 - mat.$matrix.m13)*s);\r\n        this[1] = ((mat.$matrix.m21 + mat.$matrix.m12)*s);\r\n        this[3] = ((mat.$matrix.m32 + mat.$matrix.m23)*s);\r\n      } else {\r\n        s = 2.0*Math.sqrt(1.0 + mat.$matrix.m33 - mat.$matrix.m11 - mat.$matrix.m22);\r\n        this[3] = (0.25*s);\r\n        s = 1.0/s;\r\n        this[0] = ((mat.$matrix.m21 - mat.$matrix.m12)*s);\r\n        this[1] = ((mat.$matrix.m31 + mat.$matrix.m13)*s);\r\n        this[2] = ((mat.$matrix.m32 + mat.$matrix.m23)*s);\r\n      }\r\n    }\r\n    this.normalize();\r\n  }\r\n\r\n  normalize() {\r\n    let len = Math.sqrt(this.dot(this));\r\n\r\n    if (len !== 0.0) {\r\n      this.mulScalar(1.0/len);\r\n    } else {\r\n      this[1] = 1.0;\r\n      this[0] = this[2] = this[3] = 0.0;\r\n    }\r\n    return this;\r\n  }\r\n\r\n  axisAngleToQuat(axis, angle) {\r\n    let nor = _quat_vs3_temps.next().load(axis);\r\n    nor.normalize();\r\n\r\n    if (nor.dot(nor) !== 0.0) {\r\n      let phi = angle/2.0;\r\n      let si = Math.sin(phi);\r\n      this[0] = Math.cos(phi);\r\n      this[1] = nor[0]*si;\r\n      this[2] = nor[1]*si;\r\n      this[3] = nor[2]*si;\r\n    } else {\r\n      this.makeUnitQuat();\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  rotationBetweenVecs(v1, v2, fac = 1.0) {\r\n    v1 = new Vector3(v1);\r\n    v2 = new Vector3(v2);\r\n    v1.normalize();\r\n    v2.normalize();\r\n\r\n    if (Math.abs(v1.dot(v2)) > 0.9999) {\r\n      this.makeUnitQuat();\r\n      return this;\r\n    }\r\n\r\n    let axis = new Vector3(v1);\r\n    axis.cross(v2);\r\n\r\n    let angle = v1.preNormalizedAngle(v2)*fac;\r\n\r\n    this.axisAngleToQuat(axis, angle);\r\n\r\n    return this;\r\n  }\r\n\r\n  quatInterp(quat2, t) {\r\n    let quat = new Quat();\r\n    let cosom = this[0]*quat2[0] + this[1]*quat2[1] + this[2]*quat2[2] + this[3]*quat2[3];\r\n    if (cosom < 0.0) {\r\n      cosom = -cosom;\r\n      quat[0] = -this[0];\r\n      quat[1] = -this[1];\r\n      quat[2] = -this[2];\r\n      quat[3] = -this[3];\r\n    } else {\r\n      quat[0] = this[0];\r\n      quat[1] = this[1];\r\n      quat[2] = this[2];\r\n      quat[3] = this[3];\r\n    }\r\n\r\n    let omega, sinom, sc1, sc2;\r\n    if ((1.0 - cosom) > 0.0001) {\r\n      omega = Math.acos(cosom);\r\n      sinom = Math.sin(omega);\r\n      sc1 = Math.sin((1.0 - t)*omega)/sinom;\r\n      sc2 = Math.sin(t*omega)/sinom;\r\n    } else {\r\n      sc1 = 1.0 - t;\r\n      sc2 = t;\r\n    }\r\n    this[0] = sc1*quat[0] + sc2*quat2[0];\r\n    this[1] = sc1*quat[1] + sc2*quat2[1];\r\n    this[2] = sc1*quat[2] + sc2*quat2[2];\r\n    this[3] = sc1*quat[3] + sc2*quat2[3];\r\n\r\n    return this;\r\n  }\r\n};\r\n\r\nQuat.STRUCT = nstructjs.inherit(Quat, Vector4, 'quat') + `\r\n}\r\n`;\r\nnstructjs.register(Quat);\r\n\r\n_v3nd4_n1_normalizedDot4 = new Vector3();\r\n_v3nd4_n2_normalizedDot4 = new Vector3();\r\n_v3nd_n1_normalizedDot = new Vector3();\r\n_v3nd_n2_normalizedDot = new Vector3();\r\n\r\nBaseVector.inherit(Vector4, 4);\r\nF64BaseVector.inherit(Vector3, 3);\r\nBaseVector.inherit(Vector2, 2);\r\n\r\nlet lookat_cache_vs3;\r\nlet lookat_cache_vs4;\r\nlet lookat_cache_ms;\r\nlet euler_rotate_mats;\r\nlet makenormalcache;\r\nlet temp_mats;\r\n\r\nlet preMultTemp;\r\n\r\nlookat_cache_vs3 = util.cachering.fromConstructor(Vector3, 64);\r\nlookat_cache_vs4 = util.cachering.fromConstructor(Vector4, 64);\r\n\r\nmakenormalcache = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nlet $_v3nd_n1_normalizedDot = new Vector3();\r\nlet $_v3nd_n2_normalizedDot = new Vector3();\r\nlet $_v3nd4_n1_normalizedDot4 = new Vector3();\r\nlet $_v3nd4_n2_normalizedDot4 = new Vector3();\r\nlet $_v3nd4_n1_normalizedDot3 = new Vector3();\r\nlet $_v3nd4_n2_normalizedDot3 = new Vector3();\r\n\r\nclass internal_matrix {\r\n  constructor() {\r\n    this.m11 = 1.0;\r\n    this.m12 = 0.0;\r\n    this.m13 = 0.0;\r\n    this.m14 = 0.0;\r\n    this.m21 = 0.0;\r\n    this.m22 = 1.0;\r\n    this.m23 = 0.0;\r\n    this.m24 = 0.0;\r\n    this.m31 = 0.0;\r\n    this.m32 = 0.0;\r\n    this.m33 = 1.0;\r\n    this.m34 = 0.0;\r\n    this.m41 = 0.0;\r\n    this.m42 = 0.0;\r\n    this.m43 = 0.0;\r\n    this.m44 = 1.0;\r\n  }\r\n}\r\n\r\n/** Incredibly old matrix class. */\r\nexport class Matrix4 {\r\n  constructor(m) {\r\n    this.$matrix = new internal_matrix();\r\n    this.isPersp = false;\r\n\r\n    if (typeof m === 'object') {\r\n      if (\"length\" in m && m.length >= 16) {\r\n        this.load(m);\r\n      } else if (m instanceof Matrix4) {\r\n        this.load(m);\r\n      }\r\n    }\r\n  }\r\n\r\n  static fromJSON() {\r\n    let mat = new Matrix4();\r\n    mat.load(json.items);\r\n    mat.isPersp = json.isPersp;\r\n    return mat;\r\n  }\r\n\r\n  copy() {\r\n    return this.clone();\r\n  }\r\n\r\n  clone() {\r\n    return new Matrix4(this);\r\n  }\r\n\r\n  addToHashDigest(hash) {\r\n    let m = this.$matrix;\r\n\r\n    hash.add(m.m11);\r\n    hash.add(m.m12);\r\n    hash.add(m.m13);\r\n    hash.add(m.m14);\r\n\r\n    hash.add(m.m21);\r\n    hash.add(m.m22);\r\n    hash.add(m.m23);\r\n    hash.add(m.m24);\r\n\r\n    hash.add(m.m31);\r\n    hash.add(m.m32);\r\n    hash.add(m.m33);\r\n    hash.add(m.m34);\r\n\r\n    hash.add(m.m41);\r\n    hash.add(m.m42);\r\n    hash.add(m.m43);\r\n    hash.add(m.m44);\r\n\r\n    return this;\r\n  }\r\n\r\n  equals(m) {\r\n    let m1 = this.$matrix;\r\n    let m2 = m.$matrix;\r\n\r\n    let ok = 1;\r\n\r\n    ok = ok && m1.m11 === m2.m11;\r\n    ok = ok && m1.m12 === m2.m12;\r\n    ok = ok && m1.m13 === m2.m13;\r\n    ok = ok && m1.m14 === m2.m14;\r\n\r\n    ok = ok && m1.m21 === m2.m21;\r\n    ok = ok && m1.m22 === m2.m22;\r\n    ok = ok && m1.m23 === m2.m23;\r\n    ok = ok && m1.m24 === m2.m24;\r\n\r\n    ok = ok && m1.m31 === m2.m31;\r\n    ok = ok && m1.m32 === m2.m32;\r\n    ok = ok && m1.m33 === m2.m33;\r\n    ok = ok && m1.m34 === m2.m34;\r\n\r\n    ok = ok && m1.m41 === m2.m41;\r\n    ok = ok && m1.m42 === m2.m42;\r\n    ok = ok && m1.m43 === m2.m43;\r\n    ok = ok && m1.m44 === m2.m44;\r\n\r\n    return ok;\r\n  }\r\n\r\n  loadColumn(i, vec) {\r\n    let m = this.$matrix;\r\n    let have4 = vec.length > 3;\r\n\r\n    switch (i) {\r\n      case 0:\r\n        m.m11 = vec[0];\r\n        m.m21 = vec[1];\r\n        m.m31 = vec[2];\r\n        if (have4) {\r\n          m.m41 = vec[3];\r\n        }\r\n        break;\r\n      case 1:\r\n        m.m12 = vec[0];\r\n        m.m22 = vec[1];\r\n        m.m32 = vec[2];\r\n        if (have4) {\r\n          m.m42 = vec[3];\r\n        }\r\n        break;\r\n      case 2:\r\n        m.m13 = vec[0];\r\n        m.m23 = vec[1];\r\n        m.m33 = vec[2];\r\n        if (have4) {\r\n          m.m43 = vec[3];\r\n        }\r\n        break;\r\n      case 3:\r\n        m.m14 = vec[0];\r\n        m.m24 = vec[1];\r\n        m.m34 = vec[2];\r\n        if (have4) {\r\n          m.m44 = vec[3];\r\n        }\r\n        break;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  copyColumnTo(i, vec) {\r\n    let m = this.$matrix;\r\n    let have4 = vec.length > 3;\r\n\r\n    switch (i) {\r\n      case 0:\r\n        vec[0] = m.m11;\r\n        vec[1] = m.m21;\r\n        vec[2] = m.m31;\r\n        if (have4) {\r\n          vec[3] = m.m41;\r\n        }\r\n        break;\r\n      case 1:\r\n        vec[0] = m.m12;\r\n        vec[1] = m.m22;\r\n        vec[2] = m.m32;\r\n        if (have4) {\r\n          vec[3] = m.m42;\r\n        }\r\n        break;\r\n      case 2:\r\n        vec[0] = m.m13;\r\n        vec[1] = m.m23;\r\n        vec[2] = m.m33;\r\n        if (have4) {\r\n          vec[3] = m.m43;\r\n        }\r\n        break;\r\n      case 3:\r\n        vec[0] = m.m14;\r\n        vec[1] = m.m24;\r\n        vec[2] = m.m34;\r\n        if (have4) {\r\n          vec[3] = m.m44;\r\n        }\r\n        break;\r\n    }\r\n\r\n    return vec;\r\n  }\r\n\r\n  copyColumn(i) {\r\n    return this.copyColumnTo(i, new Vector3());\r\n  }\r\n\r\n  load() {\r\n    if (arguments.length === 1 && typeof arguments[0] === 'object') {\r\n      let matrix;\r\n      if (arguments[0] instanceof Matrix4) {\r\n        matrix = arguments[0].$matrix;\r\n        this.isPersp = arguments[0].isPersp;\r\n        this.$matrix.m11 = matrix.m11;\r\n        this.$matrix.m12 = matrix.m12;\r\n        this.$matrix.m13 = matrix.m13;\r\n        this.$matrix.m14 = matrix.m14;\r\n        this.$matrix.m21 = matrix.m21;\r\n        this.$matrix.m22 = matrix.m22;\r\n        this.$matrix.m23 = matrix.m23;\r\n        this.$matrix.m24 = matrix.m24;\r\n        this.$matrix.m31 = matrix.m31;\r\n        this.$matrix.m32 = matrix.m32;\r\n        this.$matrix.m33 = matrix.m33;\r\n        this.$matrix.m34 = matrix.m34;\r\n        this.$matrix.m41 = matrix.m41;\r\n        this.$matrix.m42 = matrix.m42;\r\n        this.$matrix.m43 = matrix.m43;\r\n        this.$matrix.m44 = matrix.m44;\r\n        return this;\r\n      } else\r\n        matrix = arguments[0];\r\n      if (\"length\" in matrix && matrix.length >= 16) {\r\n        this.$matrix.m11 = matrix[0];\r\n        this.$matrix.m12 = matrix[1];\r\n        this.$matrix.m13 = matrix[2];\r\n        this.$matrix.m14 = matrix[3];\r\n        this.$matrix.m21 = matrix[4];\r\n        this.$matrix.m22 = matrix[5];\r\n        this.$matrix.m23 = matrix[6];\r\n        this.$matrix.m24 = matrix[7];\r\n        this.$matrix.m31 = matrix[8];\r\n        this.$matrix.m32 = matrix[9];\r\n        this.$matrix.m33 = matrix[10];\r\n        this.$matrix.m34 = matrix[11];\r\n        this.$matrix.m41 = matrix[12];\r\n        this.$matrix.m42 = matrix[13];\r\n        this.$matrix.m43 = matrix[14];\r\n        this.$matrix.m44 = matrix[15];\r\n        return this;\r\n      }\r\n    }\r\n\r\n    this.makeIdentity();\r\n\r\n    return this;\r\n  }\r\n\r\n  toJSON() {\r\n    return {isPersp: this.isPersp, items: this.getAsArray()}\r\n  }\r\n\r\n  getAsArray() {\r\n    return [this.$matrix.m11, this.$matrix.m12, this.$matrix.m13, this.$matrix.m14, this.$matrix.m21, this.$matrix.m22,\r\n            this.$matrix.m23, this.$matrix.m24, this.$matrix.m31, this.$matrix.m32, this.$matrix.m33, this.$matrix.m34,\r\n            this.$matrix.m41, this.$matrix.m42, this.$matrix.m43, this.$matrix.m44];\r\n  }\r\n\r\n  getAsFloat32Array() {\r\n    return new Float32Array(this.getAsArray());\r\n  }\r\n\r\n  setUniform(ctx, loc, transpose) {\r\n    if (Matrix4.setUniformArray === undefined) {\r\n      Matrix4.setUniformWebGLArray = new Float32Array(16);\r\n      Matrix4.setUniformArray = new Array(16);\r\n    }\r\n\r\n    Matrix4.setUniformArray[0] = this.$matrix.m11;\r\n    Matrix4.setUniformArray[1] = this.$matrix.m12;\r\n    Matrix4.setUniformArray[2] = this.$matrix.m13;\r\n    Matrix4.setUniformArray[3] = this.$matrix.m14;\r\n    Matrix4.setUniformArray[4] = this.$matrix.m21;\r\n    Matrix4.setUniformArray[5] = this.$matrix.m22;\r\n    Matrix4.setUniformArray[6] = this.$matrix.m23;\r\n    Matrix4.setUniformArray[7] = this.$matrix.m24;\r\n    Matrix4.setUniformArray[8] = this.$matrix.m31;\r\n    Matrix4.setUniformArray[9] = this.$matrix.m32;\r\n    Matrix4.setUniformArray[10] = this.$matrix.m33;\r\n    Matrix4.setUniformArray[11] = this.$matrix.m34;\r\n    Matrix4.setUniformArray[12] = this.$matrix.m41;\r\n    Matrix4.setUniformArray[13] = this.$matrix.m42;\r\n    Matrix4.setUniformArray[14] = this.$matrix.m43;\r\n    Matrix4.setUniformArray[15] = this.$matrix.m44;\r\n\r\n    Matrix4.setUniformWebGLArray.set(Matrix4.setUniformArray);\r\n\r\n    ctx.uniformMatrix4fv(loc, transpose, Matrix4.setUniformWebGLArray);\r\n\r\n    return this;\r\n  }\r\n\r\n  makeIdentity() {\r\n    this.$matrix.m11 = 1;\r\n    this.$matrix.m12 = 0;\r\n    this.$matrix.m13 = 0;\r\n    this.$matrix.m14 = 0;\r\n    this.$matrix.m21 = 0;\r\n    this.$matrix.m22 = 1;\r\n    this.$matrix.m23 = 0;\r\n    this.$matrix.m24 = 0;\r\n    this.$matrix.m31 = 0;\r\n    this.$matrix.m32 = 0;\r\n    this.$matrix.m33 = 1;\r\n    this.$matrix.m34 = 0;\r\n    this.$matrix.m41 = 0;\r\n    this.$matrix.m42 = 0;\r\n    this.$matrix.m43 = 0;\r\n    this.$matrix.m44 = 1;\r\n\r\n    //drop isPersp\r\n    this.isPersp = false;\r\n\r\n    return this;\r\n  }\r\n\r\n  transpose() {\r\n    let tmp = this.$matrix.m12;\r\n    this.$matrix.m12 = this.$matrix.m21;\r\n    this.$matrix.m21 = tmp;\r\n    tmp = this.$matrix.m13;\r\n    this.$matrix.m13 = this.$matrix.m31;\r\n    this.$matrix.m31 = tmp;\r\n    tmp = this.$matrix.m14;\r\n    this.$matrix.m14 = this.$matrix.m41;\r\n    this.$matrix.m41 = tmp;\r\n    tmp = this.$matrix.m23;\r\n    this.$matrix.m23 = this.$matrix.m32;\r\n    this.$matrix.m32 = tmp;\r\n    tmp = this.$matrix.m24;\r\n    this.$matrix.m24 = this.$matrix.m42;\r\n    this.$matrix.m42 = tmp;\r\n    tmp = this.$matrix.m34;\r\n    this.$matrix.m34 = this.$matrix.m43;\r\n    this.$matrix.m43 = tmp;\r\n\r\n    return this;\r\n  }\r\n\r\n  determinant() {\r\n    return this._determinant4x4();\r\n  }\r\n\r\n  invert() {\r\n    let det = this._determinant4x4();\r\n\r\n    if (Math.abs(det) < 1e-08)\r\n      return null;\r\n\r\n    this._makeAdjoint();\r\n\r\n    this.$matrix.m11 /= det;\r\n    this.$matrix.m12 /= det;\r\n    this.$matrix.m13 /= det;\r\n    this.$matrix.m14 /= det;\r\n    this.$matrix.m21 /= det;\r\n    this.$matrix.m22 /= det;\r\n    this.$matrix.m23 /= det;\r\n    this.$matrix.m24 /= det;\r\n    this.$matrix.m31 /= det;\r\n    this.$matrix.m32 /= det;\r\n    this.$matrix.m33 /= det;\r\n    this.$matrix.m34 /= det;\r\n    this.$matrix.m41 /= det;\r\n    this.$matrix.m42 /= det;\r\n    this.$matrix.m43 /= det;\r\n    this.$matrix.m44 /= det;\r\n\r\n    return this;\r\n  }\r\n\r\n  translate(x, y, z) {\r\n    if (typeof x === 'object' && \"length\" in x) {\r\n      let t = x;\r\n\r\n      x = t[0];\r\n      y = t[1];\r\n      z = t[2];\r\n    }\r\n\r\n    x = x === undefined ? 0 : x;\r\n    y = y === undefined ? 0 : y;\r\n    z = z === undefined ? 0 : z;\r\n\r\n    let matrix = temp_mats.next().makeIdentity();\r\n\r\n    matrix.$matrix.m41 = x;\r\n    matrix.$matrix.m42 = y;\r\n    matrix.$matrix.m43 = z;\r\n\r\n    this.multiply(matrix);\r\n    return this;\r\n  }\r\n\r\n  preTranslate(x, y, z) {\r\n    if (typeof x === 'object' && \"length\" in x) {\r\n      let t = x;\r\n\r\n      x = t[0];\r\n      y = t[1];\r\n      z = t[2];\r\n    }\r\n\r\n    x = x === undefined ? 0 : x;\r\n    y = y === undefined ? 0 : y;\r\n    z = z === undefined ? 0 : z;\r\n\r\n    let matrix = temp_mats.next().makeIdentity();\r\n\r\n    matrix.$matrix.m41 = x;\r\n    matrix.$matrix.m42 = y;\r\n    matrix.$matrix.m43 = z;\r\n\r\n    this.preMultiply(matrix);\r\n    return this;\r\n  }\r\n\r\n  scale(x, y, z, w = 1.0) {\r\n    if (typeof x === 'object' && \"length\" in x) {\r\n      let t = x;\r\n      x = t[0];\r\n      y = t[1];\r\n      z = t[2];\r\n    } else {\r\n      if (x === undefined)\r\n        x = 1;\r\n\r\n      if (z === undefined) {\r\n        if (y === undefined) {\r\n          y = x;\r\n          z = x;\r\n        } else {\r\n          z = x;\r\n        }\r\n      } else if (y === undefined) {\r\n        y = x;\r\n      }\r\n    }\r\n\r\n\r\n    let matrix = temp_mats.next().makeIdentity();\r\n    matrix.$matrix.m11 = x;\r\n    matrix.$matrix.m22 = y;\r\n    matrix.$matrix.m33 = z;\r\n    matrix.$matrix.m44 = w;\r\n    this.multiply(matrix);\r\n    return this\r\n  }\r\n\r\n  preScale(x, y, z, w = 1.0) {\r\n    let mat = temp_mats.next().makeIdentity();\r\n    mat.scale(x, y, z, w);\r\n\r\n    this.preMultiply(mat);\r\n    return this\r\n  }\r\n\r\n  /*\r\n  on factor;\r\n  off period;\r\n\r\n  c1 := cx; comment: cos(thx);\r\n  s1 := sx; comment: sin(thx);\r\n\r\n  c2 := cy; comment: cos(thy);\r\n  s2 := sy; comment: sin(thy);\r\n\r\n  c3 := cz; comment: cos(thz);\r\n  s3 := sz; comment: sin(thz);\r\n\r\n  cx := cos(thx);\r\n  sx := sin(thx);\r\n  cy := cos(thy);\r\n  sy := sin(thy);\r\n  cz := cos(thz);\r\n  sz := sin(thz);\r\n\r\n  imat := mat((1, 0, 0, 0),\r\n              (0, 1, 0, 0),\r\n              (0, 0, 1, 0),\r\n              (0, 0, 0, 1));\r\n\r\n  xmat :=mat((1,  0,  0,  0),\r\n             (0, c1, -s1, 0),\r\n             (0, s1,  c1, 0),\r\n             (0,  0,  0,  0));\r\n\r\n  ymat :=mat((c2, 0, s2, 0),\r\n             (0,  1,  0,  0),\r\n             (-s2, 0,  c2, 0),\r\n             (0,  0,  0,  0));\r\n\r\n  zmat :=mat(( c3, -s3, 0, 0),\r\n             (s3, c3, 0, 0),\r\n             ( 0,  0,  1, 0),\r\n             ( 0,  0,  0, 0));\r\n\r\n  mmat := mat((m11, m21, m31, 0),\r\n              (m12, m22, m32, 0),\r\n              (m13, m23, m33, 0),\r\n              (0,   0,   0,   0));\r\n\r\n  fmat := zmat * ymat * xmat;\r\n\r\n  f1 := m11**2 + m12**2 + m13**2 - 1.0;\r\n  f2 := m21**2 + m22**2 + m23**2 - 1.0;\r\n  f3 := m31**2 + m32**2 + m33**2 - 1.0;\r\n\r\n  tmat := fmat * mmat;\r\n  f1 := tmat(1, 1) - 1.0;\r\n  f2 := tmat(2, 2) - 1.0;\r\n  f3 := tmat(3, 3) - 1.0;\r\n\r\n  operator myasin;\r\n\r\n  fthy := asin(mmat(3, 1));\r\n  f1 := mmat(3,1)**2 + mmat(2,1)**2 + mmat(1,1)**2 = 1.0;\r\n\r\n  fmat2 := sub(thy=fthy, fmat);\r\n\r\n  fmat3 := fmat2 * (tp mmat);\r\n  ffz := solve(fmat2(1, 1) - m11, thz);\r\n  ffx := solve(fmat2(3, 3) - m33, thx);\r\n\r\n  fthz := part(ffz, 1, 2);\r\n  fthx := part(ffx, 1, 2);\r\n\r\n  sub(thx=fthx, thy=fthy, thz=fthz, fmat);\r\n\r\n(cos(thy)*cos(thz),         cos(thx)*sin(thz)-cos(thz)*sin(thx)*sin(thy),  -(cos(thx)*cos(thz)*sin(thy)+sin(thx)*sin(thz)), 0),\r\n\r\n(-cos(thy)*sin(thz),        cos(thx)*cos(thz) + sin(thx)*sin(thy)*sin(thz),  cos(thx)*sin(thy)*sin(thz)-cos(thz)*sin(thx), 0),\r\n\r\n(sin(thy),                  cos(thy)*sin(thx),                               cos(thx)*cos(thy),  0),\r\n\r\n    (0,0,0,1))\r\n\r\n  */\r\n\r\n  euler_rotate_order(x, y, z, order = EulerOrders.XYZ) {\r\n    if (y === undefined) {\r\n      y = 0.0;\r\n    }\r\n    if (z === undefined) {\r\n      z = 0.0;\r\n    }\r\n\r\n    x = -x;\r\n    y = -y;\r\n    z = -z;\r\n\r\n    let xmat = euler_rotate_mats.next().makeIdentity();\r\n\r\n    let m = xmat.$matrix;\r\n\r\n    let c = Math.cos(x), s = Math.sin(x);\r\n\r\n    m.m22 = c;\r\n    m.m23 = s;\r\n    m.m32 = -s;\r\n    m.m33 = c;\r\n\r\n    let ymat = euler_rotate_mats.next().makeIdentity();\r\n    c = Math.cos(y);\r\n    s = Math.sin(y);\r\n    m = ymat.$matrix;\r\n\r\n    m.m11 = c;\r\n    m.m13 = -s;\r\n    m.m31 = s;\r\n    m.m33 = c;\r\n\r\n    let zmat = euler_rotate_mats.next().makeIdentity();\r\n    c = Math.cos(z);\r\n    s = Math.sin(z);\r\n    m = zmat.$matrix;\r\n\r\n    m.m11 = c;\r\n    m.m12 = s;\r\n    m.m21 = -s;\r\n    m.m22 = c;\r\n\r\n    let a, b;\r\n\r\n    switch (order) {\r\n      case EulerOrders.XYZ:\r\n        a = xmat;\r\n        b = ymat;\r\n        c = zmat;\r\n        break;\r\n      case EulerOrders.XZY:\r\n        a = xmat;\r\n        b = zmat;\r\n        c = ymat;\r\n        break;\r\n      case EulerOrders.YXZ:\r\n        a = ymat;\r\n        b = xmat;\r\n        c = zmat;\r\n        break;\r\n      case EulerOrders.YZX:\r\n        a = ymat;\r\n        b = zmat;\r\n        c = xmat;\r\n        break;\r\n      case EulerOrders.ZXY:\r\n        a = zmat;\r\n        b = xmat;\r\n        c = ymat;\r\n        break;\r\n      case EulerOrders.ZYX:\r\n        a = zmat;\r\n        b = ymat;\r\n        c = xmat;\r\n        break;\r\n    }\r\n\r\n    b.preMultiply(c);\r\n    b.multiply(a);\r\n\r\n    this.preMultiply(b);\r\n\r\n    return this;\r\n  }\r\n\r\n  euler_rotate(x, y, z) {\r\n    if (y === undefined) {\r\n      y = 0.0;\r\n    }\r\n    if (z === undefined) {\r\n      z = 0.0;\r\n    }\r\n    window.Matrix4 = Matrix4;\r\n\r\n    let xmat = euler_rotate_mats.next().makeIdentity();\r\n    let m = xmat.$matrix;\r\n\r\n    let c = Math.cos(x), s = Math.sin(x);\r\n\r\n    m.m22 = c;\r\n    m.m23 = s;\r\n    m.m32 = -s;\r\n    m.m33 = c;\r\n\r\n    let ymat = euler_rotate_mats.next().makeIdentity();\r\n    c = Math.cos(y);\r\n    s = Math.sin(y);\r\n    m = ymat.$matrix;\r\n\r\n    m.m11 = c;\r\n    m.m13 = -s;\r\n    m.m31 = s;\r\n    m.m33 = c;\r\n\r\n    ymat.multiply(xmat);\r\n\r\n    let zmat = euler_rotate_mats.next().makeIdentity();\r\n    c = Math.cos(z);\r\n    s = Math.sin(z);\r\n    m = zmat.$matrix;\r\n\r\n    m.m11 = c;\r\n    m.m12 = s;\r\n    m.m21 = -s;\r\n    m.m22 = c;\r\n\r\n    zmat.multiply(ymat);\r\n\r\n    //console.log(\"\"+ymat);\r\n    //this.multiply(zmat);\r\n    this.preMultiply(zmat);\r\n\r\n    return this;\r\n  }\r\n\r\n  toString() {\r\n    let s = \"\"\r\n    let m = this.$matrix;\r\n\r\n    function dec(d) {\r\n      let ret = d.toFixed(3);\r\n\r\n      if (ret[0] !== \"-\") //make room for negative signs\r\n        ret = \" \" + ret\r\n      return ret\r\n    }\r\n\r\n    s = dec(m.m11) + \", \" + dec(m.m12) + \", \" + dec(m.m13) + \", \" + dec(m.m14) + \"\\n\";\r\n    s += dec(m.m21) + \", \" + dec(m.m22) + \", \" + dec(m.m23) + \", \" + dec(m.m24) + \"\\n\";\r\n    s += dec(m.m31) + \", \" + dec(m.m32) + \", \" + dec(m.m33) + \", \" + dec(m.m34) + \"\\n\";\r\n    s += dec(m.m41) + \", \" + dec(m.m42) + \", \" + dec(m.m43) + \", \" + dec(m.m44) + \"\\n\";\r\n\r\n    return s\r\n  }\r\n\r\n  rotate(angle, x, y, z) {\r\n    if (typeof x === 'object' && \"length\" in x) {\r\n      let t = x;\r\n      x = t[0];\r\n      y = t[1];\r\n      z = t[2];\r\n    } else {\r\n      if (arguments.length === 1) {\r\n        x = y = 0;\r\n        z = 1;\r\n      } else if (arguments.length === 3) {\r\n        this.rotate(angle, 1, 0, 0);\r\n        this.rotate(x, 0, 1, 0);\r\n        this.rotate(y, 0, 0, 1);\r\n        return;\r\n      }\r\n    }\r\n\r\n    angle /= 2;\r\n    let sinA = Math.sin(angle);\r\n    let cosA = Math.cos(angle);\r\n    let sinA2 = sinA*sinA;\r\n    let len = Math.sqrt(x*x + y*y + z*z);\r\n\r\n    if (len === 0) {\r\n      x = 0;\r\n      y = 0;\r\n      z = 1;\r\n    } else if (len !== 1) {\r\n      x /= len;\r\n      y /= len;\r\n      z /= len;\r\n    }\r\n\r\n    let mat = temp_mats.next().makeIdentity();\r\n\r\n    if (x === 1 && y === 0 && z === 0) {\r\n      mat.$matrix.m11 = 1;\r\n      mat.$matrix.m12 = 0;\r\n      mat.$matrix.m13 = 0;\r\n      mat.$matrix.m21 = 0;\r\n      mat.$matrix.m22 = 1 - 2*sinA2;\r\n      mat.$matrix.m23 = 2*sinA*cosA;\r\n      mat.$matrix.m31 = 0;\r\n      mat.$matrix.m32 = -2*sinA*cosA;\r\n      mat.$matrix.m33 = 1 - 2*sinA2;\r\n      mat.$matrix.m14 = mat.$matrix.m24 = mat.$matrix.m34 = 0;\r\n      mat.$matrix.m41 = mat.$matrix.m42 = mat.$matrix.m43 = 0;\r\n      mat.$matrix.m44 = 1;\r\n    } else if (x === 0 && y === 1 && z === 0) {\r\n      mat.$matrix.m11 = 1 - 2*sinA2;\r\n      mat.$matrix.m12 = 0;\r\n      mat.$matrix.m13 = -2*sinA*cosA;\r\n      mat.$matrix.m21 = 0;\r\n      mat.$matrix.m22 = 1;\r\n      mat.$matrix.m23 = 0;\r\n      mat.$matrix.m31 = 2*sinA*cosA;\r\n      mat.$matrix.m32 = 0;\r\n      mat.$matrix.m33 = 1 - 2*sinA2;\r\n      mat.$matrix.m14 = mat.$matrix.m24 = mat.$matrix.m34 = 0;\r\n      mat.$matrix.m41 = mat.$matrix.m42 = mat.$matrix.m43 = 0;\r\n      mat.$matrix.m44 = 1;\r\n    } else if (x === 0 && y === 0 && z === 1) {\r\n      mat.$matrix.m11 = 1 - 2*sinA2;\r\n      mat.$matrix.m12 = 2*sinA*cosA;\r\n      mat.$matrix.m13 = 0;\r\n      mat.$matrix.m21 = -2*sinA*cosA;\r\n      mat.$matrix.m22 = 1 - 2*sinA2;\r\n      mat.$matrix.m23 = 0;\r\n      mat.$matrix.m31 = 0;\r\n      mat.$matrix.m32 = 0;\r\n      mat.$matrix.m33 = 1;\r\n      mat.$matrix.m14 = mat.$matrix.m24 = mat.$matrix.m34 = 0;\r\n      mat.$matrix.m41 = mat.$matrix.m42 = mat.$matrix.m43 = 0;\r\n      mat.$matrix.m44 = 1;\r\n    } else {\r\n      let x2 = x*x;\r\n      let y2 = y*y;\r\n      let z2 = z*z;\r\n      mat.$matrix.m11 = 1 - 2*(y2 + z2)*sinA2;\r\n      mat.$matrix.m12 = 2*(x*y*sinA2 + z*sinA*cosA);\r\n      mat.$matrix.m13 = 2*(x*z*sinA2 - y*sinA*cosA);\r\n      mat.$matrix.m21 = 2*(y*x*sinA2 - z*sinA*cosA);\r\n      mat.$matrix.m22 = 1 - 2*(z2 + x2)*sinA2;\r\n      mat.$matrix.m23 = 2*(y*z*sinA2 + x*sinA*cosA);\r\n      mat.$matrix.m31 = 2*(z*x*sinA2 + y*sinA*cosA);\r\n      mat.$matrix.m32 = 2*(z*y*sinA2 - x*sinA*cosA);\r\n      mat.$matrix.m33 = 1 - 2*(x2 + y2)*sinA2;\r\n      mat.$matrix.m14 = mat.$matrix.m24 = mat.$matrix.m34 = 0;\r\n      mat.$matrix.m41 = mat.$matrix.m42 = mat.$matrix.m43 = 0;\r\n      mat.$matrix.m44 = 1;\r\n    }\r\n    this.multiply(mat);\r\n\r\n    return this;\r\n  }\r\n\r\n  normalize() {\r\n    let m = this.$matrix;\r\n\r\n    let v1 = new Vector4([m.m11, m.m12, m.m13, m.m14]);\r\n    let v2 = new Vector4([m.m21, m.m22, m.m23, m.m24]);\r\n    let v3 = new Vector4([m.m31, m.m32, m.m33, m.m34]);\r\n    let v4 = new Vector4([m.m41, m.m42, m.m43, m.m44]);\r\n\r\n    v1.normalize();\r\n    v2.normalize();\r\n    v3.normalize();\r\n\r\n    let flat = new Array().concat(v1).concat(v2).concat(v3).concat(v4);\r\n    this.load(flat);\r\n\r\n    return this;\r\n  }\r\n\r\n  clearTranslation(set_w_to_one = false) {\r\n    let m = this.$matrix;\r\n\r\n    m.m41 = m.m42 = m.m43 = 0.0;\r\n\r\n    if (set_w_to_one) {\r\n      m.m44 = 1.0;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  setTranslation(x, y, z, resetW = true) {\r\n    if (typeof x === \"object\") {\r\n      y = x[1];\r\n      z = x[2];\r\n      x = x[0];\r\n    }\r\n\r\n    let m = this.$matrix;\r\n\r\n    m.m41 = x;\r\n    m.m42 = y;\r\n    m.m43 = z;\r\n\r\n    if (resetW) {\r\n      m.m44 = 1.0;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  //this is really like the lookAt method, isn't it.\r\n  makeNormalMatrix(normal, up = undefined) {\r\n    if (normal === undefined) {\r\n      throw new Error(\"normal cannot be undefined\");\r\n    }\r\n\r\n    let n = makenormalcache.next().load(normal).normalize();\r\n\r\n    if (up === undefined) {\r\n      up = makenormalcache.next().zero();\r\n\r\n      if (Math.abs(n[2]) > 0.95) {\r\n        up[1] = 1.0;\r\n      } else {\r\n        up[2] = 1.0;\r\n      }\r\n    }\r\n\r\n    up = makenormalcache.next().load(up);\r\n\r\n    up.normalize();\r\n\r\n    if (up.dot(normal) > 0.99) {\r\n      this.makeIdentity();\r\n      return this;\r\n    } else if (up.dot(normal) < -0.99) {\r\n      this.makeIdentity();\r\n      this.scale(1.0, 1.0, -1.0);\r\n      return this;\r\n    }\r\n\r\n    let x = makenormalcache.next();\r\n    let y = makenormalcache.next();\r\n\r\n    x.load(n).cross(up).normalize();\r\n    y.load(x).cross(n).normalize();\r\n    //y.negate();\r\n\r\n    this.makeIdentity();\r\n    let m = this.$matrix;\r\n\r\n    m.m11 = x[0];\r\n    m.m12 = x[1];\r\n    m.m13 = x[2];\r\n\r\n    m.m21 = y[0];\r\n    m.m22 = y[1];\r\n    m.m23 = y[2];\r\n\r\n    m.m31 = n[0];\r\n    m.m32 = n[1];\r\n    m.m33 = n[2];\r\n    m.m44 = 1.0;\r\n\r\n    return this;\r\n  }\r\n\r\n  preMultiply(mat) {\r\n    preMultTemp.load(mat);\r\n    preMultTemp.multiply(this);\r\n\r\n    this.load(preMultTemp);\r\n\r\n    return this;\r\n  }\r\n\r\n  multiply(mat) {\r\n    let mm = this.$matrix;\r\n    let mm2 = mat.$matrix;\r\n\r\n    let m11 = (mm2.m11*mm.m11 + mm2.m12*mm.m21 + mm2.m13*mm.m31 + mm2.m14*mm.m41);\r\n    let m12 = (mm2.m11*mm.m12 + mm2.m12*mm.m22 + mm2.m13*mm.m32 + mm2.m14*mm.m42);\r\n    let m13 = (mm2.m11*mm.m13 + mm2.m12*mm.m23 + mm2.m13*mm.m33 + mm2.m14*mm.m43);\r\n    let m14 = (mm2.m11*mm.m14 + mm2.m12*mm.m24 + mm2.m13*mm.m34 + mm2.m14*mm.m44);\r\n    let m21 = (mm2.m21*mm.m11 + mm2.m22*mm.m21 + mm2.m23*mm.m31 + mm2.m24*mm.m41);\r\n    let m22 = (mm2.m21*mm.m12 + mm2.m22*mm.m22 + mm2.m23*mm.m32 + mm2.m24*mm.m42);\r\n    let m23 = (mm2.m21*mm.m13 + mm2.m22*mm.m23 + mm2.m23*mm.m33 + mm2.m24*mm.m43);\r\n    let m24 = (mm2.m21*mm.m14 + mm2.m22*mm.m24 + mm2.m23*mm.m34 + mm2.m24*mm.m44);\r\n    let m31 = (mm2.m31*mm.m11 + mm2.m32*mm.m21 + mm2.m33*mm.m31 + mm2.m34*mm.m41);\r\n    let m32 = (mm2.m31*mm.m12 + mm2.m32*mm.m22 + mm2.m33*mm.m32 + mm2.m34*mm.m42);\r\n    let m33 = (mm2.m31*mm.m13 + mm2.m32*mm.m23 + mm2.m33*mm.m33 + mm2.m34*mm.m43);\r\n    let m34 = (mm2.m31*mm.m14 + mm2.m32*mm.m24 + mm2.m33*mm.m34 + mm2.m34*mm.m44);\r\n    let m41 = (mm2.m41*mm.m11 + mm2.m42*mm.m21 + mm2.m43*mm.m31 + mm2.m44*mm.m41);\r\n    let m42 = (mm2.m41*mm.m12 + mm2.m42*mm.m22 + mm2.m43*mm.m32 + mm2.m44*mm.m42);\r\n    let m43 = (mm2.m41*mm.m13 + mm2.m42*mm.m23 + mm2.m43*mm.m33 + mm2.m44*mm.m43);\r\n    let m44 = (mm2.m41*mm.m14 + mm2.m42*mm.m24 + mm2.m43*mm.m34 + mm2.m44*mm.m44);\r\n\r\n    mm.m11 = m11;\r\n    mm.m12 = m12;\r\n    mm.m13 = m13;\r\n    mm.m14 = m14;\r\n    mm.m21 = m21;\r\n    mm.m22 = m22;\r\n    mm.m23 = m23;\r\n    mm.m24 = m24;\r\n    mm.m31 = m31;\r\n    mm.m32 = m32;\r\n    mm.m33 = m33;\r\n    mm.m34 = m34;\r\n    mm.m41 = m41;\r\n    mm.m42 = m42;\r\n    mm.m43 = m43;\r\n    mm.m44 = m44;\r\n\r\n    return this;\r\n  }\r\n\r\n  divide(divisor) {\r\n    this.$matrix.m11 /= divisor;\r\n    this.$matrix.m12 /= divisor;\r\n    this.$matrix.m13 /= divisor;\r\n    this.$matrix.m14 /= divisor;\r\n    this.$matrix.m21 /= divisor;\r\n    this.$matrix.m22 /= divisor;\r\n    this.$matrix.m23 /= divisor;\r\n    this.$matrix.m24 /= divisor;\r\n    this.$matrix.m31 /= divisor;\r\n    this.$matrix.m32 /= divisor;\r\n    this.$matrix.m33 /= divisor;\r\n    this.$matrix.m34 /= divisor;\r\n    this.$matrix.m41 /= divisor;\r\n    this.$matrix.m42 /= divisor;\r\n    this.$matrix.m43 /= divisor;\r\n    this.$matrix.m44 /= divisor;\r\n\r\n    return this;\r\n  }\r\n\r\n  ortho(left, right, bottom, top, near, far) {\r\n    console.warn(\"Matrix4.ortho() is deprecated, use .orthographic() instead\");\r\n\r\n    let tx = (left + right)/(left - right);\r\n    let ty = (top + bottom)/(top - bottom);\r\n    let tz = (far + near)/(far - near);\r\n    let matrix = temp_mats.next().makeIdentity();\r\n\r\n    matrix.$matrix.m11 = 2/(left - right);\r\n    matrix.$matrix.m12 = 0;\r\n    matrix.$matrix.m13 = 0;\r\n    matrix.$matrix.m14 = 0;\r\n    matrix.$matrix.m21 = 0;\r\n    matrix.$matrix.m22 = 2/(top - bottom);\r\n    matrix.$matrix.m23 = 0;\r\n    matrix.$matrix.m24 = 0;\r\n    matrix.$matrix.m31 = 0;\r\n    matrix.$matrix.m32 = 0;\r\n    matrix.$matrix.m33 = -2/(far - near);\r\n    matrix.$matrix.m34 = 0;\r\n    matrix.$matrix.m41 = tx;\r\n    matrix.$matrix.m42 = ty;\r\n    matrix.$matrix.m43 = tz;\r\n    matrix.$matrix.m44 = 1;\r\n\r\n    this.multiply(matrix);\r\n\r\n    return this;\r\n  }\r\n\r\n  frustum(left, right, bottom, top, near, far) {\r\n    let matrix = temp_mats.next().makeIdentity();\r\n\r\n    let A = (right + left)/(right - left);\r\n    let B = (top + bottom)/(top - bottom);\r\n    let C = -(far + near)/(far - near);\r\n    let D = -(2*far*near)/(far - near);\r\n\r\n    matrix.$matrix.m11 = (2*near)/(right - left);\r\n    matrix.$matrix.m12 = 0;\r\n    matrix.$matrix.m13 = 0;\r\n    matrix.$matrix.m14 = 0;\r\n    matrix.$matrix.m21 = 0;\r\n    matrix.$matrix.m22 = 2*near/(top - bottom);\r\n    matrix.$matrix.m23 = 0;\r\n    matrix.$matrix.m24 = 0;\r\n    matrix.$matrix.m31 = A;\r\n    matrix.$matrix.m32 = B;\r\n    matrix.$matrix.m33 = C;\r\n    matrix.$matrix.m34 = -1;\r\n    matrix.$matrix.m41 = 0;\r\n    matrix.$matrix.m42 = 0;\r\n    matrix.$matrix.m43 = D;\r\n    matrix.$matrix.m44 = 0;\r\n\r\n    this.isPersp = true;\r\n    this.multiply(matrix);\r\n\r\n    return this;\r\n  }\r\n\r\n  orthographic(scale, aspect, near, far) {\r\n    let mat = temp_mats.next().makeIdentity();\r\n\r\n    let zscale = far - near;\r\n\r\n    mat.scale(2.0/aspect, 2.0, -1.0/scale/zscale, 1.0/scale);\r\n    mat.translate(0.0, 0.0, 0.5*zscale - near);\r\n\r\n    this.isPersp = true; //we still make use of auto homogenous divide in BaseVector.multVecMatrix\r\n    this.multiply(mat);\r\n\r\n    return mat;\r\n  }\r\n\r\n  perspective(fovy, aspect, zNear, zFar) {\r\n    let top = Math.tan(fovy*Math.PI/360)*zNear;\r\n    let bottom = -top;\r\n    let left = aspect*bottom;\r\n    let right = aspect*top;\r\n\r\n    this.frustum(left, right, bottom, top, zNear, zFar);\r\n\r\n    return this;\r\n  }\r\n\r\n  lookat(pos, target, up) {\r\n    let matrix = lookat_cache_ms.next();\r\n    matrix.makeIdentity();\r\n\r\n    let vec = lookat_cache_vs3.next().load(pos).sub(target);\r\n    let len = vec.vectorLength();\r\n    vec.normalize();\r\n\r\n    let zvec = vec;\r\n    let yvec = lookat_cache_vs3.next().load(up).normalize();\r\n    let xvec = lookat_cache_vs3.next().load(yvec).cross(zvec).normalize();\r\n\r\n    let mm = matrix.$matrix;\r\n\r\n    mm.m11 = xvec[0];\r\n    mm.m12 = yvec[0];\r\n    mm.m13 = zvec[0];\r\n    mm.m14 = 0;\r\n    mm.m21 = xvec[1];\r\n    mm.m22 = yvec[1];\r\n    mm.m23 = zvec[1];\r\n    mm.m24 = 0;\r\n    mm.m31 = xvec[2];\r\n    mm.m32 = yvec[2];\r\n    mm.m33 = zvec[2];\r\n\r\n    //*\r\n    mm.m11 = xvec[0];\r\n    mm.m12 = xvec[1];\r\n    mm.m13 = xvec[2];\r\n    mm.m14 = 0;\r\n    mm.m21 = yvec[0];\r\n    mm.m22 = yvec[1];\r\n    mm.m23 = yvec[2];\r\n    mm.m24 = 0;\r\n    mm.m31 = zvec[0];\r\n    mm.m32 = zvec[1];\r\n    mm.m33 = zvec[2];\r\n    mm.m34 = 0;\r\n    mm.m41 = pos[0];\r\n    mm.m42 = pos[1];\r\n    mm.m43 = pos[2];\r\n    mm.m44 = 1;\r\n    //*/\r\n\r\n    this.multiply(matrix);\r\n\r\n\r\n    return this;\r\n  }\r\n\r\n  makeRotationOnly() {\r\n    let m = this.$matrix;\r\n\r\n    m.m41 = m.m42 = m.m43 = 0.0;\r\n    m.m44 = 1.0;\r\n\r\n    let l1 = Math.sqrt(m.m11*m.m11 + m.m12*m.m12 + m.m13*m.m13);\r\n    let l2 = Math.sqrt(m.m21*m.m21 + m.m22*m.m22 + m.m23*m.m23);\r\n    let l3 = Math.sqrt(m.m31*m.m31 + m.m32*m.m32 + m.m33*m.m33);\r\n\r\n    if (l1) {\r\n      m.m11 /= l1;\r\n      m.m12 /= l1;\r\n      m.m13 /= l1;\r\n    }\r\n\r\n    if (l2) {\r\n      m.m21 /= l2;\r\n      m.m22 /= l2;\r\n      m.m23 /= l2;\r\n    }\r\n\r\n    if (l3) {\r\n      m.m31 /= l3;\r\n      m.m32 /= l3;\r\n      m.m33 /= l3;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  alignAxis(axis, vec) {\r\n    vec = new Vector3(vec);\r\n    vec.normalize();\r\n\r\n    let mat = this.inputs.transformMatrix.getValue();\r\n    let m = mat.$matrix;\r\n\r\n    let mat2 = new Matrix4(mat);\r\n    let loc = new Vector3(), scale = new Vector3(), rot = new Vector3();\r\n\r\n    //we don't use rot\r\n    mat2.decompose(loc, rot, scale);\r\n\r\n    mat2.makeRotationOnly();\r\n    let axes = mat2.getAsVecs();\r\n\r\n    let axis2 = (axis + 1)%3;\r\n    let axis3 = (axis + 2)%3;\r\n\r\n    axes[axis].load(vec)\r\n    axes[axis2].cross(axes[axis]).cross(axes[axis])\r\n    axes[axis3].load(axes[axis]).cross(axes[axis2])\r\n\r\n    axes[0][3] = 1.0;\r\n    axes[1][3] = 1.0;\r\n    axes[2][3] = 1.0;\r\n\r\n    axes[0].normalize();\r\n    axes[1].normalize();\r\n    axes[2].normalize();\r\n\r\n    this.loadFromVecs(axes);\r\n    this.scale(scale[0], scale[1], scale[2]);\r\n\r\n    m.m41 = loc[0];\r\n    m.m42 = loc[1];\r\n    m.m43 = loc[2];\r\n\r\n    return this;\r\n  }\r\n\r\n  decompose(_translate, _rotate, _scale, _skew, _perspective, order = EulerOrders.XYZ) {\r\n    if (this.$matrix.m44 === 0)\r\n      return false;\r\n\r\n    let mat = temp_mats.next().load(this);\r\n    let m = mat.$matrix;\r\n\r\n    let t = _translate, r = _rotate, s = _scale;\r\n    if (t) {\r\n      t[0] = m.m41;\r\n      t[1] = m.m42;\r\n      t[2] = m.m43;\r\n    }\r\n\r\n    let l1 = Math.sqrt(m.m11*m.m11 + m.m12*m.m12 + m.m13*m.m13);\r\n    let l2 = Math.sqrt(m.m21*m.m21 + m.m22*m.m22 + m.m23*m.m23);\r\n    let l3 = Math.sqrt(m.m31*m.m31 + m.m32*m.m32 + m.m33*m.m33);\r\n\r\n    if (l1) {\r\n      m.m11 /= l1;\r\n      m.m12 /= l1;\r\n      m.m13 /= l1;\r\n    }\r\n    if (l2) {\r\n      m.m21 /= l2;\r\n      m.m22 /= l2;\r\n      m.m23 /= l2;\r\n    }\r\n    if (l3) {\r\n      m.m31 /= l3;\r\n      m.m32 /= l3;\r\n      m.m33 /= l3;\r\n    }\r\n\r\n    if (s) {\r\n      s[0] = l1;\r\n      s[1] = l2;\r\n      s[2] = l3;\r\n    }\r\n\r\n    if (r) { //THREE.js code\r\n      let clamp = myclamp;\r\n\r\n      let rmat = temp_mats.next().load(this);\r\n      rmat.normalize();\r\n\r\n      m = rmat.$matrix;\r\n\r\n      // assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n      let m11 = m.m11, m12 = m.m12, m13 = m.m13, m14 = m.m14;\r\n      let m21 = m.m21, m22 = m.m22, m23 = m.m23, m24 = m.m24;\r\n      let m31 = m.m31, m32 = m.m32, m33 = m.m33, m34 = m.m34;\r\n      //let m41 = m.m41, m42 = m.m42, m43 = m.m43, m44 = m.m44;\r\n\r\n      if (order === EulerOrders.XYZ) {\r\n\r\n        r[1] = Math.asin(clamp(m13, -1, 1));\r\n\r\n        if (Math.abs(m13) < 0.9999999) {\r\n\r\n          r[0] = Math.atan2(-m23, m33);\r\n          r[2] = Math.atan2(-m12, m11);\r\n\r\n        } else {\r\n\r\n          r[0] = Math.atan2(m32, m22);\r\n          r[2] = 0;\r\n\r\n        }\r\n\r\n      } else if (order === EulerOrders.YXZ) {\r\n\r\n        r[0] = Math.asin(-clamp(m23, -1, 1));\r\n\r\n        if (Math.abs(m23) < 0.9999999) {\r\n\r\n          r[1] = Math.atan2(m13, m33);\r\n          r[2] = Math.atan2(m21, m22);\r\n\r\n        } else {\r\n\r\n          r[1] = Math.atan2(-m31, m11);\r\n          r[2] = 0;\r\n\r\n        }\r\n\r\n      } else if (order === EulerOrders.ZXY) {\r\n\r\n        r[0] = Math.asin(clamp(m32, -1, 1));\r\n\r\n        if (Math.abs(m32) < 0.9999999) {\r\n\r\n          r[1] = Math.atan2(-m31, m33);\r\n          r[2] = Math.atan2(-m12, m22);\r\n\r\n        } else {\r\n\r\n          r[1] = 0;\r\n          r[2] = Math.atan2(m21, m11);\r\n\r\n        }\r\n\r\n      } else if (order === EulerOrders.ZYX) {\r\n\r\n        r[1] = Math.asin(-clamp(m31, -1, 1));\r\n\r\n        if (Math.abs(m31) < 0.9999999) {\r\n\r\n          r[0] = Math.atan2(m32, m33);\r\n          r[2] = Math.atan2(m21, m11);\r\n\r\n        } else {\r\n\r\n          r[0] = 0;\r\n          r[2] = Math.atan2(-m12, m22);\r\n\r\n        }\r\n\r\n      } else if (order === EulerOrders.YZX) {\r\n\r\n        r[2] = Math.asin(clamp(m21, -1, 1));\r\n\r\n        if (Math.abs(m21) < 0.9999999) {\r\n\r\n          r[0] = Math.atan2(-m23, m22);\r\n          r[1] = Math.atan2(-m31, m11);\r\n\r\n        } else {\r\n\r\n          r[0] = 0;\r\n          r[1] = Math.atan2(m13, m33);\r\n\r\n        }\r\n\r\n      } else if (order === EulerOrders.XZY) {\r\n\r\n        r[2] = Math.asin(-clamp(m12, -1, 1));\r\n\r\n        if (Math.abs(m12) < 0.9999999) {\r\n\r\n          r[0] = Math.atan2(m32, m22);\r\n          r[1] = Math.atan2(m13, m11);\r\n\r\n        } else {\r\n\r\n          r[0] = Math.atan2(-m23, m33);\r\n          r[1] = 0;\r\n\r\n        }\r\n\r\n      } else {\r\n        console.warn('unsupported euler order:', order);\r\n      }\r\n      //r[0] = Math.atan2(m.m23, m.m33);\r\n      //r[1] = Math.atan2(-m.m13, Math.sqrt(m.m23*m.m23 + m.m33*m.m33));\r\n      //r[2] = Math.atan2(m.m12, m.m11);\r\n    }\r\n  }\r\n\r\n  _determinant2x2(a, b, c, d) {\r\n    return a*d - b*c;\r\n  }\r\n\r\n  _determinant3x3(a1, a2, a3, b1, b2, b3, c1, c2, c3) {\r\n    return a1*this._determinant2x2(b2, b3, c2, c3) - b1*this._determinant2x2(a2, a3, c2, c3) + c1*this._determinant2x2(a2, a3, b2, b3);\r\n  }\r\n\r\n  _determinant4x4() {\r\n    let a1 = this.$matrix.m11;\r\n    let b1 = this.$matrix.m12;\r\n    let c1 = this.$matrix.m13;\r\n    let d1 = this.$matrix.m14;\r\n    let a2 = this.$matrix.m21;\r\n    let b2 = this.$matrix.m22;\r\n    let c2 = this.$matrix.m23;\r\n    let d2 = this.$matrix.m24;\r\n    let a3 = this.$matrix.m31;\r\n    let b3 = this.$matrix.m32;\r\n    let c3 = this.$matrix.m33;\r\n    let d3 = this.$matrix.m34;\r\n    let a4 = this.$matrix.m41;\r\n    let b4 = this.$matrix.m42;\r\n    let c4 = this.$matrix.m43;\r\n    let d4 = this.$matrix.m44;\r\n    return a1*this._determinant3x3(b2, b3, b4, c2, c3, c4, d2, d3, d4) - b1*this._determinant3x3(a2, a3, a4, c2, c3, c4, d2, d3, d4) + c1*this._determinant3x3(a2, a3, a4, b2, b3, b4, d2, d3, d4) - d1*this._determinant3x3(a2, a3, a4, b2, b3, b4, c2, c3, c4);\r\n  }\r\n\r\n  _makeAdjoint() {\r\n    let a1 = this.$matrix.m11;\r\n    let b1 = this.$matrix.m12;\r\n    let c1 = this.$matrix.m13;\r\n    let d1 = this.$matrix.m14;\r\n    let a2 = this.$matrix.m21;\r\n    let b2 = this.$matrix.m22;\r\n    let c2 = this.$matrix.m23;\r\n    let d2 = this.$matrix.m24;\r\n    let a3 = this.$matrix.m31;\r\n    let b3 = this.$matrix.m32;\r\n    let c3 = this.$matrix.m33;\r\n    let d3 = this.$matrix.m34;\r\n    let a4 = this.$matrix.m41;\r\n    let b4 = this.$matrix.m42;\r\n    let c4 = this.$matrix.m43;\r\n    let d4 = this.$matrix.m44;\r\n\r\n    this.$matrix.m11 = this._determinant3x3(b2, b3, b4, c2, c3, c4, d2, d3, d4);\r\n    this.$matrix.m21 = -this._determinant3x3(a2, a3, a4, c2, c3, c4, d2, d3, d4);\r\n    this.$matrix.m31 = this._determinant3x3(a2, a3, a4, b2, b3, b4, d2, d3, d4);\r\n    this.$matrix.m41 = -this._determinant3x3(a2, a3, a4, b2, b3, b4, c2, c3, c4);\r\n    this.$matrix.m12 = -this._determinant3x3(b1, b3, b4, c1, c3, c4, d1, d3, d4);\r\n    this.$matrix.m22 = this._determinant3x3(a1, a3, a4, c1, c3, c4, d1, d3, d4);\r\n    this.$matrix.m32 = -this._determinant3x3(a1, a3, a4, b1, b3, b4, d1, d3, d4);\r\n    this.$matrix.m42 = this._determinant3x3(a1, a3, a4, b1, b3, b4, c1, c3, c4);\r\n    this.$matrix.m13 = this._determinant3x3(b1, b2, b4, c1, c2, c4, d1, d2, d4);\r\n    this.$matrix.m23 = -this._determinant3x3(a1, a2, a4, c1, c2, c4, d1, d2, d4);\r\n    this.$matrix.m33 = this._determinant3x3(a1, a2, a4, b1, b2, b4, d1, d2, d4);\r\n    this.$matrix.m43 = -this._determinant3x3(a1, a2, a4, b1, b2, b4, c1, c2, c4);\r\n    this.$matrix.m14 = -this._determinant3x3(b1, b2, b3, c1, c2, c3, d1, d2, d3);\r\n    this.$matrix.m24 = this._determinant3x3(a1, a2, a3, c1, c2, c3, d1, d2, d3);\r\n    this.$matrix.m34 = -this._determinant3x3(a1, a2, a3, b1, b2, b3, d1, d2, d3);\r\n    this.$matrix.m44 = this._determinant3x3(a1, a2, a3, b1, b2, b3, c1, c2, c3);\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    this.load(this.mat);\r\n    this.__mat = this.mat;\r\n    //delete this.mat;\r\n  }\r\n}\r\n\r\nMatrix4.STRUCT = `\r\nmat4 {\r\n  mat      : array(float) | this.getAsArray();\r\n  isPersp  : int          | this.isPersp;\r\n}\r\n`;\r\nnstructjs.register(Matrix4);\r\n\r\npreMultTemp = new Matrix4();\r\n\r\nwindow.testmat = (x = 0, y = 0, z = Math.PI*0.5) => {\r\n  let m1 = new Matrix4();\r\n  m1.euler_rotate(x, y, z);\r\n  //m1.scale(2.0, 0.5, 3.0);\r\n\r\n  let t = [0, 0, 0], r = [0, 0, 0], s = [0, 0, 0]\r\n\r\n  m1.decompose(t, r, s);\r\n\r\n  window.console.log(\"\\n\");\r\n  window.console.log(t);\r\n  window.console.log(r);\r\n  window.console.log(s);\r\n\r\n\r\n  let mat = m1.clone();\r\n  mat.transpose();\r\n  mat.multiply(m1);\r\n\r\n  console.log(mat.toString());\r\n  return r;\r\n}\r\n\r\nlookat_cache_ms = util.cachering.fromConstructor(Matrix4, 64);\r\neuler_rotate_mats = util.cachering.fromConstructor(Matrix4, 64);\r\ntemp_mats = util.cachering.fromConstructor(Matrix4, 64);\r\n","\"use strict\";\r\n\r\n/*\r\nthis file is a skeleton that defines the contract\r\nthat any tool property library must implement to interface with path.ux.\r\n*/\r\n\r\n//maps prop type names to integers\r\nimport * as util from \"../util/util.js\";\r\n\r\nexport let PropTypes = {\r\n  INT        : 1,\r\n  STRING     : 2,\r\n  BOOL       : 4,\r\n  ENUM       : 8,\r\n  FLAG       : 16,\r\n  FLOAT      : 32,\r\n  VEC2       : 64,\r\n  VEC3       : 128,\r\n  VEC4       : 256,\r\n  MATRIX4    : 512,\r\n  QUAT       : 1024,\r\n  PROPLIST   : 4096,\r\n  STRSET     : 8192,\r\n  CURVE      : 8192<<1,\r\n  FLOAT_ARRAY: 8192<<2,\r\n  REPORT     : 8192<<3\r\n  //ITER : 8192<<1\r\n};\r\n\r\nexport const PropSubTypes = {\r\n  COLOR: 1\r\n};\r\n\r\n//flags\r\nexport const PropFlags = {\r\n  SELECT                : 1,\r\n  PRIVATE               : 2,\r\n  LABEL                 : 4,\r\n  USE_ICONS             : 64, /* Implies FORCE_ENUM_CHECKBOXES (for enum/flag properties). */\r\n  USE_CUSTOM_GETSET     : 128, //used by controller.js interface\r\n  SAVE_LAST_VALUE       : 256,\r\n  READ_ONLY             : 512,\r\n  SIMPLE_SLIDER         : 1<<10,\r\n  FORCE_ROLLER_SLIDER   : 1<<11,\r\n  USE_BASE_UNDO         : 1<<12, //internal to simple_controller.js\r\n  EDIT_AS_BASE_UNIT     : 1<<13, //user textbox input should be interpreted in display unit\r\n  NO_UNDO               : 1<<14,\r\n  USE_CUSTOM_PROP_GETTER: 1<<15, //hrm, not sure I need this\r\n  FORCE_ENUM_CHECKBOXES : 1<<16,/* Use a strip of checkboxes, also applies to flag properties. */\r\n  NO_DEFAULT            : 1<<17,\r\n};\r\n\r\nexport class ToolPropertyIF {\r\n  constructor(type, subtype, apiname, uiname, description, flag, icon) {\r\n    this.data = undefined;\r\n\r\n    this.type = type;\r\n    this.subtype = subtype;\r\n\r\n    this.apiname = apiname;\r\n    this.uiname = uiname;\r\n    this.description = description;\r\n    this.flag = flag;\r\n    this.icon = icon;\r\n  }\r\n\r\n  equals(b) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  copyTo(b) {\r\n\r\n  }\r\n\r\n  copy() {\r\n\r\n  }\r\n\r\n  _fire(type, arg1, arg2) {\r\n  }\r\n\r\n  on(type, cb) {\r\n  }\r\n\r\n  off(type, cb) {\r\n  }\r\n\r\n  getValue() {\r\n  }\r\n\r\n  setValue(val) {\r\n  }\r\n\r\n  setStep(step) {\r\n  }\r\n\r\n  setRange(min, max) {\r\n  }\r\n\r\n  setUnit(unit) {\r\n  }\r\n\r\n  //some clients have seperate ui range\r\n  setUIRange(min, max) {\r\n  }\r\n\r\n  setIcon(icon) {\r\n  }\r\n}\r\n\r\nexport class StringPropertyIF extends ToolPropertyIF {\r\n  constructor() {\r\n    super(PropTypes.STRING);\r\n  }\r\n}\r\n\r\nexport class NumPropertyIF extends ToolPropertyIF {\r\n};\r\n\r\nexport class IntPropertyIF extends ToolPropertyIF {\r\n  constructor() {\r\n    super(PropTypes.INT);\r\n  }\r\n\r\n  setRadix(radix) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n}\r\n\r\nexport class FloatPropertyIF extends ToolPropertyIF {\r\n  constructor() {\r\n    super(PropTypes.FLOAT);\r\n  }\r\n\r\n  setDecimalPlaces(n) {\r\n  }\r\n}\r\n\r\nexport class EnumPropertyIF extends ToolPropertyIF {\r\n  constructor(value, valid_values) {\r\n    super(PropTypes.ENUM);\r\n\r\n    this.values = {}\r\n    this.keys = {};\r\n    this.ui_value_names = {};\r\n    this.iconmap = {};\r\n\r\n    if (valid_values === undefined) return this;\r\n\r\n    if (valid_values instanceof Array || valid_values instanceof String) {\r\n      for (var i = 0; i < valid_values.length; i++) {\r\n        this.values[valid_values[i]] = valid_values[i];\r\n        this.keys[valid_values[i]] = valid_values[i];\r\n      }\r\n    } else {\r\n      for (var k in valid_values) {\r\n        this.values[k] = valid_values[k];\r\n        this.keys[valid_values[k]] = k;\r\n      }\r\n    }\r\n\r\n    for (var k in this.values) {\r\n      var uin = k[0].toUpperCase() + k.slice(1, k.length);\r\n\r\n      uin = uin.replace(/\\_/g, \" \");\r\n      this.ui_value_names[k] = uin;\r\n    }\r\n  }\r\n\r\n  addIcons(iconmap) {\r\n    if (this.iconmap === undefined) {\r\n      this.iconmap = {};\r\n    }\r\n    for (var k in iconmap) {\r\n      this.iconmap[k] = iconmap[k];\r\n    }\r\n  }\r\n}\r\n\r\nexport class FlagPropertyIF extends EnumPropertyIF {\r\n  constructor(valid_values) {\r\n    super(PropTypes.FLAG);\r\n  }\r\n}\r\n\r\nexport class Vec2PropertyIF extends ToolPropertyIF {\r\n  constructor(valid_values) {\r\n    super(PropTypes.VEC2);\r\n  }\r\n}\r\n\r\nexport class Vec3PropertyIF extends ToolPropertyIF {\r\n  constructor(valid_values) {\r\n    super(PropTypes.VEC3);\r\n  }\r\n}\r\n\r\nexport class Vec4PropertyIF extends ToolPropertyIF {\r\n  constructor(valid_values) {\r\n    super(PropTypes.VEC4);\r\n  }\r\n}\r\n\r\n/**\r\n * List of other tool props (all of one type)\r\n */\r\nexport class ListPropertyIF extends ToolPropertyIF {\r\n  /*\r\n  * Prop must be a ToolProperty subclass instance\r\n  * */\r\n  constructor(prop) {\r\n    super(PropTypes.PROPLIST);\r\n\r\n    this.prop = prop;\r\n  }\r\n\r\n  get length() {\r\n  }\r\n\r\n  set length(val) {\r\n  }\r\n\r\n  copyTo(b) {\r\n  }\r\n\r\n  copy() {\r\n  }\r\n\r\n  /**\r\n   * clear list\r\n   * */\r\n  clear() {\r\n\r\n  }\r\n\r\n  push(item = this.prop.copy()) {\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n  }\r\n}\r\n\r\n//like FlagsProperty but uses strings\r\nexport class StringSetPropertyIF extends ToolPropertyIF {\r\n  constructor(value = undefined, definition = []) {\r\n    super(PropTypes.STRSET);\r\n  }\r\n\r\n  /*\r\n  * Values can be a string, undefined/null, or a list/set/object-literal of strings.\r\n  * If destructive is true, then existing set will be cleared.\r\n  * */\r\n  setValue(values, destructive = true, soft_fail = true) {\r\n  }\r\n\r\n  getValue() {\r\n  }\r\n\r\n  addIcons(iconmap) {\r\n  }\r\n\r\n\r\n  addUINames(map) {\r\n  }\r\n\r\n  addDescriptions(map) {\r\n  }\r\n\r\n  copyTo(b) {\r\n  }\r\n\r\n  copy() {\r\n  }\r\n}\r\n\r\nexport class Curve1DPropertyIF extends ToolPropertyIF {\r\n  constructor(curve, uiname) {\r\n    super(PropTypes.CURVE);\r\n\r\n    this.data = curve;\r\n  }\r\n\r\n  getValue() {\r\n    return this.curve;\r\n  }\r\n\r\n  setValue(curve) {\r\n    if (curve === undefined) {\r\n      return;\r\n    }\r\n\r\n    let json = JSON.parse(JSON.stringify(curve));\r\n    this.data.load(json);\r\n  }\r\n\r\n  copyTo(b) {\r\n    b.setValue(this.data);\r\n  }\r\n}\r\n\r\n","/**\r\n * Unit system.\r\n *\r\n * Provides an API to convert units,\r\n * e.g. `convert(0.5, \"foot\", \"meter\")`\r\n *\r\n * Path.ux widgets typically have `baseUnit`\r\n * and `displayUnit` properties. `baseUnit`\r\n * is the unit of the real stored value,\r\n * while `displayUnit` is what he user sees\r\n * and edits.\r\n *\r\n * Units:\r\n * # none           No unit\r\n * # meter          Meter       (distance)\r\n * # inch           Inch        (distance)\r\n * # foot           Foot        (distance)\r\n * # square_foot    Square Feet (area)\r\n * # mile           Mile        (distance)\r\n * # degree         Degrees     (angle)\r\n * # radian         Radians     (angle)\r\n * # pixel          Pixel       (distance)\r\n * # percent        Percent\r\n *\r\n */\r\n\r\n/*\r\nall units convert to meters\r\n*/\r\n\r\nconst FLT_EPSILONE = 1.192092895507812e-07;\r\n\r\nfunction myfloor(f) {\r\n  return Math.floor(f + FLT_EPSILONE*2.0);\r\n}\r\n\r\nfunction normString(s) {\r\n  //remove all whitespace\r\n  s = s.replace(/ /g, \"\").replace(/\\t/g, \"\");\r\n  return s.toLowerCase();\r\n}\r\n\r\nfunction myToFixed(f, decimals) {\r\n  if (typeof f !== \"number\") {\r\n    return \"(error)\";\r\n  }\r\n\r\n  f = f.toFixed(decimals);\r\n  while (f.endsWith(\"0\") && f.search(/\\./) >= 0) {\r\n    f = f.slice(0, f.length - 1);\r\n  }\r\n\r\n  if (f.endsWith(\".\")) {\r\n    f = f.slice(0, f.length - 1);\r\n  }\r\n\r\n  if (f.length === 0)\r\n    f = \"0\";\r\n\r\n  return f.trim();\r\n}\r\n\r\nexport const Units = [];\r\n\r\nexport class Unit {\r\n  static getUnit(name) {\r\n    if (name === \"none\" || name === undefined) {\r\n      return undefined;\r\n    }\r\n\r\n    for (let cls of Units) {\r\n      if (cls.unitDefine().name === name) {\r\n        return cls;\r\n      }\r\n    }\r\n\r\n    throw new Error(\"Unknown unit \" + name);\r\n  }\r\n\r\n  static register(cls) {\r\n    Units.push(cls);\r\n  }\r\n\r\n  //subclassed static methods start here\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"\",\r\n      uiname : \"\",\r\n      type   : \"\", //e.g. distance\r\n      icon   : -1,\r\n      pattern: undefined //a re literal to validate strings\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n\r\n  }\r\n\r\n  static validate(string) {\r\n    string = normString(string);\r\n    let def = this.unitDefine();\r\n\r\n    let m = string.match(def.pattern);\r\n    if (!m)\r\n      return false;\r\n\r\n    return m[0] === string;\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n\r\n  }\r\n\r\n  static fromInternal(value) {\r\n\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n\r\n  }\r\n}\r\n\r\nexport class MeterUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"meter\",\r\n      uiname : \"Meter\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d*)?m$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    if (string.endsWith(\"m\")) {\r\n      string = string.slice(0, string.length - 1);\r\n    }\r\n\r\n    return parseFloat(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n    return \"\" + myToFixed(value, decimals) + \" m\";\r\n  }\r\n}\r\n\r\nUnit.register(MeterUnit);\r\n\r\nexport class InchUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"inch\",\r\n      uiname : \"Inch\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d*)?(in|inch)$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = string.toLowerCase();\r\n    let i = string.indexOf(\"i\");\r\n\r\n    if (i >= 0) {\r\n      string = string.slice(0, i);\r\n    }\r\n\r\n    return parseInt(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value*0.0254;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value/0.0254;\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n    return \"\" + myToFixed(value, decimals) + \"in\";\r\n  }\r\n}\r\n\r\nUnit.register(InchUnit);\r\n\r\nlet foot_re = /((-?\\d+(\\.\\d*)?ft)(-?\\d+(\\.\\d*)?(in|inch))?)|(-?\\d+(\\.\\d*)?(in|inch))$/\r\n\r\nexport class FootUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"foot\",\r\n      uiname : \"Foot\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: foot_re\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    let i = string.search(\"ft\");\r\n    let parts = [];\r\n    let vft = 0.0, vin = 0.0;\r\n\r\n    if (i >= 0) {\r\n      parts = string.split(\"ft\");\r\n      let j = parts[1].search(\"in\");\r\n\r\n      if (j >= 0) {\r\n        parts = [parts[0]].concat(parts[1].split(\"in\"));\r\n        vin = parseFloat(parts[1]);\r\n      }\r\n\r\n      vft = parseFloat(parts[0]);\r\n    } else {\r\n      string = string.replace(/in/g, \"\");\r\n      vin = parseFloat(string);\r\n    }\r\n\r\n    return vin/12.0 + vft;\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value*0.3048;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value/0.3048;\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n    let vft = myfloor(value);\r\n    let vin = ((value + FLT_EPSILONE*2)*12)%12;\r\n\r\n    if (vft === 0.0) {\r\n      return myToFixed(vin, decimals) + \" in\";\r\n    }\r\n\r\n    let s = \"\" + vft + \" ft\";\r\n    if (vin !== 0.0) {\r\n      s += \" \" + myToFixed(vin, decimals) + \" in\";\r\n    }\r\n\r\n    return s;\r\n  }\r\n}\r\n\r\nUnit.register(FootUnit);\r\n\r\n\r\nlet square_foot_re = /((-?\\d+(\\.\\d*)?ft(\\u00b2)?)(-?\\d+(\\.\\d*)?(in|inch)(\\u00b2)?)?)|(-?\\d+(\\.\\d*)?(in|inch)(\\u00b2)?)$/\r\n\r\nexport class SquareFootUnit extends FootUnit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"square_foot\",\r\n      uiname : \"Square Feet\",\r\n      type   : \"area\",\r\n      icon   : -1,\r\n      pattern: square_foot_re\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = string.replace(/\\u00b2/g, \"\");\r\n    return super.parse(string);\r\n  }\r\n\r\n\r\n  static buildString(value, decimals = 2) {\r\n    let vft = myfloor(value);\r\n    let vin = ((value + FLT_EPSILONE*2)*12)%12;\r\n\r\n    if (vft === 0.0) {\r\n      return myToFixed(vin, decimals) + \" in\\u00b2\";\r\n    }\r\n\r\n    let s = \"\" + vft + \" ft\\u00b2\";\r\n    if (vin !== 0.0) {\r\n      s += \" \" + myToFixed(vin, decimals) + \" in\\u00b2\";\r\n    }\r\n\r\n    return s;\r\n  }\r\n}\r\n\r\nUnit.register(SquareFootUnit);\r\n\r\n\r\nexport class MileUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"mile\",\r\n      uiname : \"Mile\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d+)?miles$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    string = string.replace(/miles/, \"\");\r\n    return parseFloat(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value*1609.34;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value/1609.34;\r\n  }\r\n\r\n  static buildString(value, decimals = 3) {\r\n    return \"\" + myToFixed(value, decimals) + \" miles\";\r\n  }\r\n}\r\n\r\nUnit.register(MileUnit);\r\n\r\nexport class DegreeUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"degree\",\r\n      uiname : \"Degrees\",\r\n      type   : \"angle\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d+)?(\\u00B0|degree|deg|d|degree|degrees)$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    if (string.search(\"d\") >= 0) {\r\n      string = string.slice(0, string.search(\"d\")).trim();\r\n    } else if (string.search(\"\\u00B0\") >= 0) {\r\n      string = string.slice(0, string.search(\"\\u00B0\")).trim();\r\n    }\r\n\r\n    return parseFloat(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value/180.0*Math.PI;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value*180.0/Math.PI;\r\n  }\r\n\r\n  static buildString(value, decimals = 3) {\r\n    return \"\" + myToFixed(value, decimals) + \" \\u00B0\";\r\n  }\r\n};\r\nUnit.register(DegreeUnit);\r\n\r\nexport class RadianUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"radian\",\r\n      uiname : \"Radians\",\r\n      type   : \"angle\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d+)?(r|rad|radian|radians)$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    if (string.search(\"r\") >= 0) {\r\n      string = string.slice(0, string.search(\"r\")).trim();\r\n    }\r\n\r\n    return parseFloat(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static buildString(value, decimals = 3) {\r\n    return \"\" + myToFixed(value, decimals) + \" r\";\r\n  }\r\n};\r\n\r\nUnit.register(RadianUnit);\r\n\r\nexport function setBaseUnit(unit) {\r\n  Unit.baseUnit = unit;\r\n}\r\n\r\nwindow._getBaseUnit = () => Unit.baseUnit;\r\n\r\nexport function setMetric(val) {\r\n  Unit.isMetric = val;\r\n}\r\n\r\nUnit.isMetric = true;\r\nUnit.baseUnit = \"meter\";\r\n\r\nlet numre1 = /[+\\-]?[0-9]+(\\.[0-9]*)?$/\r\nlet numre2 = /[+\\-]?[0-9]?(\\.[0-9]*)+$/\r\nlet hexre1 = /[+\\-]?[0-9a-fA-F]+h$/\r\nlet hexre2 = /[+\\-]?0x[0-9a-fA-F]+$/\r\nlet binre = /[+\\-]?0b[01]+$/\r\nlet expre = /[+\\-]?[0-9]+(\\.[0-9]*)?[eE]\\-?[0-9]+$/\r\nlet intre = /[+\\-]?[0-9]+$/\r\n\r\nfunction isnumber(s) {\r\n  s = (\"\" + s).trim();\r\n\r\n  function test(re) {\r\n    return s.search(re) === 0;\r\n  }\r\n\r\n  return test(intre) || test(numre1) || test(numre2) || test(hexre1) || test(hexre2) || test(binre) || test(expre);\r\n}\r\n\r\n\r\nexport function parseValueIntern(string, baseUnit = undefined) {\r\n  string = string.trim();\r\n  if (string[0] === \".\") {\r\n    string = \"0\" + string;\r\n  }\r\n\r\n  if (typeof baseUnit === \"string\") {\r\n    let base = Unit.getUnit(baseUnit);\r\n\r\n    if (base === undefined && baseUnit !== \"none\") {\r\n      console.warn(\"Unknown unit \" + baseUnit);\r\n      return NaN;\r\n    }\r\n\r\n    baseUnit = base;\r\n  }\r\n\r\n  //unannotated string?\r\n  if (isnumber(string)) {\r\n    //assume base unit\r\n    let f = parseFloat(string);\r\n\r\n    return f;\r\n  }\r\n\r\n  if (baseUnit === undefined) {\r\n    console.warn(\"No base unit in units.js:parseValueIntern\");\r\n  }\r\n\r\n  for (let unit of Units) {\r\n    let def = unit.unitDefine();\r\n\r\n    if (unit.validate(string)) {\r\n      console.log(unit);\r\n      let value = unit.parse(string);\r\n\r\n      if (baseUnit) {\r\n        value = unit.toInternal(value);\r\n        return baseUnit.fromInternal(value);\r\n      } else {\r\n        return value;\r\n      }\r\n    }\r\n  }\r\n\r\n  return NaN;\r\n}\r\n\r\n/* if displayUnit is undefined, final value will be converted from displayUnit to baseUnit */\r\nexport function parseValue(string, baseUnit = undefined, displayUnit = undefined) {\r\n  displayUnit = Unit.getUnit(displayUnit);\r\n  baseUnit = Unit.getUnit(baseUnit);\r\n\r\n  let f = parseValueIntern(string, displayUnit || baseUnit);\r\n\r\n  if (displayUnit) {\r\n    f = displayUnit.toInternal(f);\r\n  }\r\n\r\n  if (baseUnit) {\r\n    f = baseUnit.fromInternal(f);\r\n  }\r\n\r\n  return f;\r\n}\r\n\r\nexport function isNumber(string) {\r\n  if (isnumber(string)) {\r\n    return true;\r\n  }\r\n\r\n  for (let unit of Units) {\r\n    let def = unit.unitDefine();\r\n\r\n    if (unit.validate(string)) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nexport class PixelUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"pixel\",\r\n      uiname : \"Pixel\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d*)?px$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    if (string.endsWith(\"px\")) {\r\n      string = string.slice(0, string.length - 2).trim();\r\n    }\r\n\r\n    return parseFloat(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n    return \"\" + myToFixed(value, decimals) + \"px\";\r\n  }\r\n}\r\n\r\nUnit.register(PixelUnit);\r\n\r\nexport class PercentUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"percent\",\r\n      uiname : \"Percent\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: /[0-9]+(\\.[0-9]+)?[ \\t]*%/\r\n    }\r\n  }\r\n\r\n  static toInternal(value) {\r\n    return value/100.0;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value*100.0;\r\n  }\r\n\r\n  static parse(string) {\r\n    return parseFloat(string.replace(/%/g, \"\"));\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n    return (value).toFixed(decimals) + \"%\";\r\n  }\r\n}\r\n\r\nUnit.register(PercentUnit);\r\n\r\n\r\nexport function convert(value, unita, unitb) {\r\n  /* Note: getUnit throws on invalid units *except* for\r\n   *       'none' where it returns undefined.\r\n   */\r\n\r\n  if (typeof unita === \"string\") {\r\n    unita = Unit.getUnit(unita);\r\n  }\r\n\r\n  if (typeof unitb === \"string\") {\r\n    unitb = Unit.getUnit(unitb);\r\n  }\r\n\r\n  if (unita && unitb) {\r\n    return unitb.fromInternal(unita.toInternal(value));\r\n  } else if (unitb) {\r\n    return unitb.fromInternal(value); /* unita was 'none' */\r\n  } else if (unita) {\r\n    return unita.toInternal(value);\r\n  } else {\r\n    return value;\r\n  }\r\n}\r\n\r\nwindow.unitConvert = convert;\r\n\r\n/**\r\n *\r\n * @param value Value (note: is not converted to internal unit)\r\n * @param unit: Unit to use, should be a string referencing unit type, see unitDefine().name\r\n * @returns {*}\r\n */\r\nexport function buildString(value, baseUnit = Unit.baseUnit, decimalPlaces = 3, displayUnit = Unit.baseUnit) {\r\n  if (typeof baseUnit === \"string\" && baseUnit !== \"none\") {\r\n    baseUnit = Unit.getUnit(baseUnit);\r\n  }\r\n  if (typeof displayUnit === \"string\" && displayUnit !== \"none\") {\r\n    displayUnit = Unit.getUnit(displayUnit);\r\n  }\r\n\r\n\r\n  if (displayUnit !== baseUnit) {\r\n    value = convert(value, baseUnit, displayUnit);\r\n  }\r\n\r\n  if (displayUnit !== \"none\") {\r\n    return displayUnit.buildString(value, decimalPlaces);\r\n  } else {\r\n    return myToFixed(value, decimalPlaces);\r\n  }\r\n}\r\n\r\nwindow._parseValueTest = parseValue;\r\nwindow._buildStringTest = buildString;\r\n","import * as util from \"../util/util.js\";\r\nimport { Vector2, Vector3, Vector4, Quat, Matrix4 } from \"../util/vectormath.js\";\r\nimport { ToolPropertyIF, PropTypes, PropFlags } from \"./toolprop_abstract.js\";\r\nimport nstructjs from \"../util/struct.js\";\r\n\r\nexport { PropTypes, PropFlags } from \"./toolprop_abstract.js\";\r\n\r\nexport const NumberConstraintsBase = new Set([\r\n  \"range\",\r\n  \"expRate\",\r\n  \"step\",\r\n  \"uiRange\",\r\n  \"baseUnit\",\r\n  \"displayUnit\",\r\n  \"stepIsRelative\",\r\n  \"slideSpeed\",\r\n  \"sliderDisplayExp\",\r\n]);\r\n\r\nexport const IntegerConstraints = new Set([\"radix\"].concat(util.list(NumberConstraintsBase)));\r\n\r\nexport const FloatConstrinats = new Set([\"decimalPlaces\"].concat(util.list(NumberConstraintsBase)));\r\n\r\nexport const NumberConstraints = new Set(util.list(IntegerConstraints).concat(util.list(FloatConstrinats)));\r\n\r\nexport const PropSubTypes = {\r\n  COLOR: 1,\r\n};\r\n\r\nlet first = (iter) => {\r\n  if (iter === undefined) {\r\n    return undefined;\r\n  }\r\n\r\n  if (!(Symbol.iterator in iter)) {\r\n    for (let item in iter) {\r\n      return item;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  for (let item of iter) {\r\n    return item;\r\n  }\r\n};\r\n\r\n//set PropTypes to custom type integers\r\nexport function setPropTypes(types) {\r\n  for (let k in types) {\r\n    PropTypes[k] = types[k];\r\n  }\r\n}\r\n\r\nexport let customPropertyTypes = [];\r\nexport let PropClasses = {};\r\n\r\nlet customPropTypeBase = 17;\r\n\r\nlet wordmap = {\r\n  sel  : \"select\",\r\n  unsel: \"deselect\",\r\n  eid  : \"id\",\r\n  props: \"properties\",\r\n  res  : \"resource\",\r\n};\r\n\r\nexport var defaultRadix = 10;\r\nexport var defaultDecimalPlaces = 4;\r\n\r\nclass OnceTag {\r\n  constructor(cb) {\r\n    this.cb = cb;\r\n  }\r\n}\r\n\r\nexport class ToolProperty extends ToolPropertyIF {\r\n  constructor(type, subtype, apiname, uiname = \"\", description = \"\", flag = 0, icon = -1) {\r\n    super();\r\n\r\n    this.data = undefined;\r\n\r\n    if (type === undefined) {\r\n      type = this.constructor.PROP_TYPE_ID;\r\n    }\r\n\r\n    this.type = type;\r\n    this.subtype = subtype;\r\n\r\n    //is false if this property still has its default value,\r\n    //i.e. it hasn't been set by the user or anyone else\r\n    this.wasSet = false;\r\n\r\n    this.apiname = apiname;\r\n    this.uiname = uiname !== undefined ? uiname : apiname;\r\n    this.description = description;\r\n    this.flag = flag | PropFlags.SAVE_LAST_VALUE;\r\n    this.icon = icon;\r\n    this.icon2 = icon; //another icon, e.g. unchecked state\r\n\r\n    //remember to update NumberConstraintsBase et al when adding new number\r\n    //constraints\r\n\r\n    this.decimalPlaces = defaultDecimalPlaces;\r\n    this.radix = defaultRadix;\r\n    this.step = 0.05;\r\n\r\n    this.callbacks = {};\r\n  }\r\n\r\n  static internalRegister(cls) {\r\n    PropClasses[new cls().type] = cls;\r\n  }\r\n\r\n  static getClass(type) {\r\n    return PropClasses[type];\r\n  }\r\n\r\n  static setDefaultRadix(n) {\r\n    defaultRadix = n;\r\n  }\r\n\r\n  static setDefaultDecimalPlaces(n) {\r\n    defaultDecimalPlaces = n;\r\n  }\r\n\r\n  static makeUIName(name) {\r\n    let parts = [\"\"];\r\n    let lastc = undefined;\r\n\r\n    let ischar = (c) => {\r\n      c = c.charCodeAt(0);\r\n\r\n      let upper = c >= \"A\".charCodeAt(0);\r\n      upper = upper && c <= \"Z\".charCodeAt(0);\r\n\r\n      let lower = c >= \"a\".charCodeAt(0);\r\n      lower = lower && c <= \"z\".charCodeAt(0);\r\n\r\n      return upper || lower;\r\n    };\r\n\r\n    for (let i = 0; i < name.length; i++) {\r\n      let c = name[i];\r\n\r\n      if (c === \"_\" || c === \"-\" || c === \"$\") {\r\n        lastc = c;\r\n        c = \" \";\r\n        parts.push(\"\");\r\n        continue;\r\n      }\r\n\r\n      if (i > 0 && c === c.toUpperCase() && lastc !== lastc.toUpperCase()) {\r\n        if (ischar(c) && ischar(lastc)) {\r\n          parts.push(\"\");\r\n        }\r\n      }\r\n\r\n      parts[parts.length - 1] += c;\r\n      lastc = c;\r\n    }\r\n\r\n    let subst = (word) => {\r\n      if (word in wordmap) {\r\n        return wordmap[word];\r\n      } else {\r\n        return word;\r\n      }\r\n    };\r\n\r\n    parts = parts\r\n      .filter((f) => f.trim().length > 0)\r\n      .map((f) => subst(f))\r\n      .map((f) => f[0].toUpperCase() + f.slice(1, f.length).toLowerCase())\r\n      .join(\" \")\r\n      .trim();\r\n    return parts;\r\n  }\r\n\r\n  static register(cls) {\r\n    cls.PROP_TYPE_ID = 1 << customPropTypeBase;\r\n    PropTypes[cls.name] = cls.PROP_TYPE_ID;\r\n\r\n    customPropTypeBase++;\r\n    customPropertyTypes.push(cls);\r\n\r\n    PropClasses[new cls().type] = cls;\r\n\r\n    return cls.PROP_TYPE_ID;\r\n  }\r\n\r\n  static calcRelativeStep(step, value, logBase = 1.5) {\r\n    value = Math.log(Math.abs(value) + 1.0) / Math.log(logBase);\r\n    value = Math.max(value, step);\r\n\r\n    this.report(util.termColor(\"STEP\", \"red\"), value);\r\n    return value;\r\n  }\r\n\r\n  setDescription(s) {\r\n    this.description = s;\r\n    return this;\r\n  }\r\n\r\n  setUIName(s) {\r\n    this.uiname = s;\r\n    return this;\r\n  }\r\n\r\n  calcMemSize() {\r\n    function strlen(s) {\r\n      //length of string plus an assumed member pointer\r\n      return s !== undefined ? s.length + 8 : 8;\r\n    }\r\n\r\n    let tot = 0;\r\n\r\n    tot += strlen(this.apiname) + strlen(this.uiname);\r\n    tot += strlen(this.description);\r\n\r\n    tot += 11 * 8; //assumed member pointers\r\n    for (let k in this.callbacks) {\r\n      tot += 24;\r\n    }\r\n\r\n    return tot;\r\n  }\r\n\r\n  equals(b) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  private() {\r\n    this.flag |= PropFlags.PRIVATE;\r\n    this.flag &= ~PropFlags.SAVE_LAST_VALUE;\r\n    return this;\r\n  }\r\n\r\n  /** Save property in last value cache.  Now set by default,\r\n   *  to disable use .ignoreLastValue().\r\n   */\r\n  saveLastValue() {\r\n    this.flag |= PropFlags.SAVE_LAST_VALUE;\r\n    return this;\r\n  }\r\n\r\n  ignoreLastValue() {\r\n    this.flag &= ~PropFlags.SAVE_LAST_VALUE;\r\n    return this;\r\n  }\r\n\r\n  report() {\r\n    console.warn(...arguments);\r\n  }\r\n\r\n  _fire(type, arg1, arg2) {\r\n    if (this.callbacks[type] === undefined) {\r\n      return;\r\n    }\r\n\r\n    let stack = this.callbacks[type];\r\n    stack = stack.concat([]); //copy\r\n\r\n    for (let i = 0; i < stack.length; i++) {\r\n      let cb = stack[i];\r\n\r\n      if (cb instanceof OnceTag) {\r\n        let j = i;\r\n\r\n        //remove callback;\r\n        while (j < stack.length - 1) {\r\n          stack[j] = stack[j + 1];\r\n          j++;\r\n        }\r\n\r\n        stack[j] = undefined;\r\n        stack.length--;\r\n\r\n        i--;\r\n\r\n        cb.cb.call(this, arg1, arg2);\r\n      } else {\r\n        cb.call(this, arg1, arg2);\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  clearEventCallbacks() {\r\n    this.callbacks = {};\r\n    return this;\r\n  }\r\n\r\n  once(type, cb) {\r\n    if (this.callbacks[type] === undefined) {\r\n      this.callbacks[type] = [];\r\n    }\r\n\r\n    //check if cb is already in callback list inside a OnceTag\r\n    for (let cb2 of this.callbacks[type]) {\r\n      if (cb2 instanceof OnceTag && cb2.cb === cb) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    cb = new OnceTag(cb);\r\n\r\n    this.callbacks[type].push(cb);\r\n\r\n    return this;\r\n  }\r\n\r\n  on(type, cb) {\r\n    if (this.callbacks[type] === undefined) {\r\n      this.callbacks[type] = [];\r\n    }\r\n\r\n    this.callbacks[type].push(cb);\r\n    return this;\r\n  }\r\n\r\n  off(type, cb) {\r\n    this.callbacks[type].remove(cb);\r\n    return this;\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      type       : this.type,\r\n      subtype    : this.subtype,\r\n      apiname    : this.apiname,\r\n      uiname     : this.uiname,\r\n      description: this.description,\r\n      flag       : this.flag,\r\n      icon       : this.icon,\r\n      data       : this.data,\r\n      range      : this.range,\r\n      uiRange    : this.uiRange,\r\n      step       : this.step,\r\n    };\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    this.type = obj.type;\r\n    this.subtype = obj.subtype;\r\n    this.apiname = obj.apiname;\r\n    this.uiname = obj.uiname;\r\n    this.description = obj.description;\r\n    this.flag = obj.flag;\r\n    this.icon = obj.icon;\r\n    this.data = obj.data;\r\n\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  setValue(val) {\r\n    if (this.constructor === ToolProperty) {\r\n      throw new Error(\"implement me!\");\r\n    }\r\n\r\n    this.wasSet = true;\r\n\r\n    this._fire(\"change\", val);\r\n  }\r\n\r\n  copyTo(b) {\r\n    b.apiname = this.apiname;\r\n\r\n    b.uiname = this.uiname;\r\n    b.description = this.description;\r\n    b.icon = this.icon;\r\n    b.icon2 = this.icon2;\r\n\r\n    b.baseUnit = this.baseUnit;\r\n    b.subtype = this.subtype;\r\n    b.displayUnit = this.displayUnit;\r\n\r\n    b.flag = this.flag;\r\n\r\n    for (let k in this.callbacks) {\r\n      b.callbacks[k] = this.callbacks[k];\r\n    }\r\n  }\r\n\r\n  copy() {\r\n    //default copy method\r\n    let ret = new this.constructor();\r\n\r\n    this.copyTo(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  setStep(step) {\r\n    this.step = step;\r\n    return this;\r\n  }\r\n\r\n  getStep(value = 1.0) {\r\n    if (this.stepIsRelative) {\r\n      return ToolProperty.calcRelativeStep(this.step, value);\r\n    } else {\r\n      return this.step;\r\n    }\r\n  }\r\n\r\n  setRelativeStep(step) {\r\n    this.step = step;\r\n    this.stepIsRelative = true;\r\n  }\r\n\r\n  setRange(min, max) {\r\n    if (min === undefined || max === undefined) {\r\n      throw new Error(\"min and/or max cannot be undefined\");\r\n    }\r\n\r\n    this.range = [min, max];\r\n    return this;\r\n  }\r\n\r\n  noUnits() {\r\n    this.baseUnit = this.displayUnit = \"none\";\r\n    return this;\r\n  }\r\n\r\n  setBaseUnit(unit) {\r\n    this.baseUnit = unit;\r\n    return this;\r\n  }\r\n\r\n  setDisplayUnit(unit) {\r\n    this.displayUnit = unit;\r\n    return this;\r\n  }\r\n\r\n  setUnit(unit) {\r\n    this.baseUnit = this.displayUnit = unit;\r\n    return this;\r\n  }\r\n\r\n  setFlag(f, combine = false) {\r\n    this.flag = combine ? this.flag | f : f;\r\n    return this;\r\n  }\r\n\r\n  setUIRange(min, max) {\r\n    if (min === undefined || max === undefined) {\r\n      throw new Error(\"min and/or max cannot be undefined\");\r\n    }\r\n\r\n    this.uiRange = [min, max];\r\n    return this;\r\n  }\r\n\r\n  setIcon(icon) {\r\n    this.icon = icon;\r\n\r\n    return this;\r\n  }\r\n\r\n  setIcon2(icon) {\r\n    this.icon2 = icon;\r\n\r\n    return this;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    if (this.uiRange[0] === -1e17 && this.uiRange[1] === 1e17) {\r\n      this.uiRange = undefined;\r\n    }\r\n\r\n    if (this.baseUnit === \"undefined\") {\r\n      this.baseUnit = undefined;\r\n    }\r\n\r\n    if (this.displayUnit === \"undefined\") {\r\n      this.displayUnit = undefined;\r\n    }\r\n  }\r\n}\r\n\r\nToolProperty.STRUCT = `\r\nToolProperty { \r\n  apiname        : string | \"\"+this.apiname;\r\n  type           : int;\r\n  flag           : int;\r\n  subtype        : int;\r\n  icon           : int;\r\n  icon2          : int;\r\n  baseUnit       : string | \"\"+this.baseUnit;\r\n  displayUnit    : string | \"\"+this.displayUnit;\r\n  range          : array(float) | this.range ? this.range : [-1e17, 1e17];\r\n  uiRange        : array(float) | this.uiRange ? this.uiRange : [-1e17, 1e17];\r\n  description    : string;\r\n  stepIsRelative : bool;\r\n  step           : float;\r\n  expRate        : float;\r\n  radix          : float;\r\n  decimalPlaces  : int;\r\n  uiname         : string | this.uiname || this.apiname || \"\";\r\n  wasSet         : bool;\r\n}\r\n`;\r\nnstructjs.register(ToolProperty);\r\n\r\nwindow.ToolProperty = ToolProperty;\r\n\r\nexport class FloatArrayProperty extends ToolProperty {\r\n  constructor(value, apiname, uiname, description, flag, icon) {\r\n    super(PropTypes.FLOAT_ARRAY, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.value = [];\r\n\r\n    if (value !== undefined) {\r\n      this.setValue(value);\r\n    }\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return this.value[Symbol.iterator]();\r\n  }\r\n\r\n  setValue(value) {\r\n    super.setValue();\r\n\r\n    if (value === undefined) {\r\n      throw new Error(\"value was undefined in FloatArrayProperty's setValue method\");\r\n    }\r\n\r\n    this.value.length = 0;\r\n\r\n    for (let item of value) {\r\n      if (typeof item !== \"number\" && typeof item !== \"boolean\") {\r\n        console.log(value);\r\n        throw new Error(\"bad item for FloatArrayProperty \" + item);\r\n      }\r\n\r\n      this.value.push(item);\r\n    }\r\n  }\r\n\r\n  push(item) {\r\n    if (typeof item !== \"number\" && typeof item !== \"boolean\") {\r\n      console.log(value);\r\n      throw new Error(\"bad item for FloatArrayProperty \" + item);\r\n    }\r\n\r\n    this.value.push(item);\r\n  }\r\n\r\n  getValue() {\r\n    return this.value;\r\n  }\r\n\r\n  clear() {\r\n    this.value.length = 0;\r\n    return this;\r\n  }\r\n}\r\n\r\nFloatArrayProperty.STRUCT =\r\n  nstructjs.inherit(FloatArrayProperty, ToolProperty) +\r\n  `\r\n  value : array(float);\r\n}`;\r\nnstructjs.register(FloatArrayProperty);\r\n\r\nexport class StringProperty extends ToolProperty {\r\n  constructor(value, apiname, uiname, description, flag, icon) {\r\n    super(PropTypes.STRING, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.multiLine = false;\r\n\r\n    if (value) {\r\n      this.setValue(value);\r\n    } else {\r\n      this.setValue(\"\");\r\n    }\r\n\r\n    this.wasSet = false;\r\n  }\r\n\r\n  calcMemSize() {\r\n    return super.calcMemSize() + (this.data !== undefined ? this.data.length * 4 : 0) + 8;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data === b.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n\r\n    b.data = this.data;\r\n    b.multiLine = this.multiLine;\r\n\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  setValue(val) {\r\n    //fire events\r\n    super.setValue(val);\r\n    this.data = val;\r\n  }\r\n}\r\n\r\nStringProperty.STRUCT =\r\n  nstructjs.inherit(StringProperty, ToolProperty) +\r\n  `\r\n  data : string;\r\n}\r\n`;\r\nnstructjs.register(StringProperty);\r\nToolProperty.internalRegister(StringProperty);\r\n\r\n/*\r\nlet num_res = [\r\n  /([0-9]+)/,\r\n  /((0x)?[0-9a-fA-F]+(h?))/,\r\n  /([0-9]+\\.[0-9]*)/,\r\n  /([0-9]*\\.[0-9]+)/,\r\n  /(\\.[0-9]+)/\r\n];\r\n//num_re = /([0-9]+\\.[0-9]*)|([0-9]*\\.[0-9]+)/\r\n*/\r\n\r\nexport { isNumber } from \"../../core/units.js\";\r\n/*\r\nexport function isNumber(f) {\r\n  if (f === \"NaN\" || (typeof f == \"number\" && isNaN(f))) {\r\n    return false;\r\n  }\r\n\r\n  f = (\"\" + f).trim();\r\n\r\n  let ok = false;\r\n\r\n  for (let re of num_res) {\r\n    let ret = f.match(re)\r\n    if (!ret) {\r\n      ok = false;\r\n      continue;\r\n    }\r\n\r\n    ok = ret[0].length === f.length;\r\n    if (ok) {\r\n      break;\r\n    }\r\n  }\r\n\r\n  return ok;\r\n}*/\r\n\r\n//window.isNumber = isNumber;\r\n\r\nexport class NumProperty extends ToolProperty {\r\n  constructor(type, value, apiname, uiname, description, flag, icon) {\r\n    super(type, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.data = 0;\r\n    this.range = [0, 0];\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data == b.data;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n  }\r\n}\r\nNumProperty.STRUCT =\r\n  nstructjs.inherit(NumProperty, ToolProperty) +\r\n  `\r\n  range : array(float);\r\n  data  : float;\r\n}\r\n`;\r\n\r\nexport class _NumberPropertyBase extends ToolProperty {\r\n  constructor(type, value, apiname, uiname, description, flag, icon) {\r\n    super(type, null, apiname, uiname, description, flag, icon);\r\n\r\n    this.data = 0.0;\r\n\r\n    //remember to update NumberConstraintsBase et al when adding new number\r\n    //constraints\r\n\r\n    /** Display simple sliders with exponent divisions, don't\r\n     * confuse with expRate which affects rollar\r\n     * slider speed.\r\n     */\r\n    this.sliderDisplayExp = 1.0;\r\n\r\n    /** controls roller slider rate */\r\n    this.slideSpeed = 1.0;\r\n\r\n    /** exponential rate, used by roller sliders */\r\n    this.expRate = 1.33;\r\n    this.step = 0.1;\r\n\r\n    this.stepIsRelative = false;\r\n\r\n    this.range = [-1e17, 1e17];\r\n\r\n    /** if undefined this.range will be used */\r\n    this.uiRange = undefined;\r\n\r\n    if (value !== undefined && value !== null) {\r\n      this.setValue(value);\r\n      this.wasSet = false;\r\n    }\r\n  }\r\n\r\n  get ui_range() {\r\n    this.report(\"NumberProperty.ui_range is deprecated\");\r\n    return this.uiRange;\r\n  }\r\n\r\n  set ui_range(val) {\r\n    this.report(\"NumberProperty.ui_range is deprecated\");\r\n    this.uiRange = val;\r\n  }\r\n\r\n  calcMemSize() {\r\n    return super.calcMemSize() + 8 * 8;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data === b.data;\r\n  }\r\n\r\n  toJSON() {\r\n    let json = super.toJSON();\r\n\r\n    json.data = this.data;\r\n    json.expRate = this.expRate;\r\n\r\n    return json;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n\r\n    b.displayUnit = this.displayUnit;\r\n    b.baseUnit = this.baseUnit;\r\n    b.expRate = this.expRate;\r\n    b.step = this.step;\r\n    b.range = this.range ? [this.range[0], this.range[1]] : undefined;\r\n    b.uiRange = this.uiRange ? [this.uiRange[0], this.uiRange[1]] : undefined;\r\n    b.slideSpeed = this.slideSpeed;\r\n    b.sliderDisplayExp = this.sliderDisplayExp;\r\n\r\n    b.data = this.data;\r\n  }\r\n\r\n  setSliderDisplayExp(f) {\r\n    this.sliderDisplayExp = f;\r\n    return this;\r\n  }\r\n\r\n  setSlideSpeed(f) {\r\n    this.slideSpeed = f;\r\n\r\n    return this;\r\n  }\r\n\r\n  /*\r\n   * non-linear exponent for number sliders\r\n   * in roll mode\r\n   * */\r\n  setExpRate(exp) {\r\n    this.expRate = exp;\r\n  }\r\n\r\n  setValue(val) {\r\n    if (val === undefined || val === null) {\r\n      return;\r\n    }\r\n\r\n    if (typeof val !== \"number\") {\r\n      throw new Error(\"Invalid number \" + val);\r\n    }\r\n\r\n    this.data = val;\r\n\r\n    super.setValue(val);\r\n    return this;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    let get = (key) => {\r\n      if (key in obj) {\r\n        this[key] = obj[key];\r\n      }\r\n    };\r\n\r\n    get(\"range\");\r\n    get(\"step\");\r\n    get(\"expRate\");\r\n    get(\"ui_range\");\r\n\r\n    return this;\r\n  }\r\n}\r\n_NumberPropertyBase.STRUCT =\r\n  nstructjs.inherit(_NumberPropertyBase, ToolProperty) +\r\n  `\r\n  range            : array(float);\r\n  expRate          : float;\r\n  data             : float;\r\n  step             : float;\r\n  slideSpeed       : float;\r\n  sliderDisplayExp : float;\r\n}\r\n`;\r\nnstructjs.register(_NumberPropertyBase);\r\n\r\nexport class IntProperty extends _NumberPropertyBase {\r\n  constructor(value, apiname, uiname, description, flag, icon) {\r\n    super(PropTypes.INT, value, apiname, uiname, description, flag, icon);\r\n\r\n    //remember to update NumberConstraintsBase et al when adding new number\r\n    //constraints\r\n\r\n    /* Integer properties don't use default unit. */\r\n    this.baseUnit = this.displayUnit = \"none\";\r\n\r\n    this.radix = 10;\r\n  }\r\n\r\n  setValue(val) {\r\n    super.setValue(Math.floor(val));\r\n    return this;\r\n  }\r\n\r\n  setRadix(radix) {\r\n    this.radix = radix;\r\n  }\r\n\r\n  toJSON() {\r\n    let json = super.toJSON();\r\n\r\n    json.data = this.data;\r\n    json.radix = this.radix;\r\n\r\n    return json;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    this.data = obj.data || this.data;\r\n    this.radix = obj.radix || this.radix;\r\n\r\n    return this;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n  }\r\n}\r\n\r\nIntProperty.STRUCT =\r\n  nstructjs.inherit(IntProperty, _NumberPropertyBase) +\r\n  `\r\n  data : int;\r\n}`;\r\nnstructjs.register(IntProperty);\r\n\r\nToolProperty.internalRegister(IntProperty);\r\n\r\nexport class ReportProperty extends StringProperty {\r\n  constructor(value, apiname, uiname, description, flag, icon) {\r\n    super(value, apiname, uiname, description, flag, icon);\r\n\r\n    this.type = PropTypes.REPORT;\r\n  }\r\n}\r\n\r\nReportProperty.STRUCT =\r\n  nstructjs.inherit(ReportProperty, StringProperty) +\r\n  `\r\n}\r\n`;\r\nnstructjs.register(ReportProperty);\r\nToolProperty.internalRegister(ReportProperty);\r\n\r\nexport class BoolProperty extends ToolProperty {\r\n  constructor(value, apiname, uiname, description, flag, icon) {\r\n    super(PropTypes.BOOL, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.data = !!value;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data == b.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n    b.data = this.data;\r\n\r\n    return this;\r\n  }\r\n\r\n  setValue(val) {\r\n    this.data = !!val;\r\n    super.setValue(val);\r\n\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = super.toJSON();\r\n\r\n    return ret;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nToolProperty.internalRegister(BoolProperty);\r\nBoolProperty.STRUCT =\r\n  nstructjs.inherit(BoolProperty, ToolProperty) +\r\n  `\r\n  data : bool;\r\n}\r\n`;\r\nnstructjs.register(BoolProperty);\r\n\r\nexport class FloatProperty extends _NumberPropertyBase {\r\n  constructor(value, apiname, uiname, description, flag, icon) {\r\n    super(PropTypes.FLOAT, value, apiname, uiname, description, flag, icon);\r\n\r\n    //remember to update NumberConstraintsBase et al when adding new number\r\n    //constraints\r\n\r\n    this.decimalPlaces = 4;\r\n  }\r\n\r\n  setDecimalPlaces(n) {\r\n    this.decimalPlaces = n;\r\n    return this;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n    b.data = this.data;\r\n    return this;\r\n  }\r\n\r\n  setValue(val) {\r\n    this.data = val;\r\n\r\n    //fire events\r\n    super.setValue(val);\r\n\r\n    return this;\r\n  }\r\n\r\n  toJSON() {\r\n    let json = super.toJSON();\r\n\r\n    json.data = this.data;\r\n    json.decimalPlaces = this.decimalPlaces;\r\n\r\n    return json;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    this.data = obj.data || this.data;\r\n    this.decimalPlaces = obj.decimalPlaces || this.decimalPlaces;\r\n\r\n    return this;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n  }\r\n}\r\n\r\nToolProperty.internalRegister(FloatProperty);\r\nFloatProperty.STRUCT =\r\n  nstructjs.inherit(FloatProperty, _NumberPropertyBase) +\r\n  `\r\n  decimalPlaces : int;\r\n  data          : float;\r\n}\r\n`;\r\nnstructjs.register(FloatProperty);\r\n\r\nexport class EnumKeyPair {\r\n  constructor(key, val) {\r\n    this.key = \"\" + key;\r\n    this.val = \"\" + val;\r\n    this.key_is_int = typeof key === \"number\" || typeof key === \"boolean\";\r\n    this.val_is_int = typeof val === \"number\" || typeof val === \"boolean\";\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    if (this.val_is_int) {\r\n      this.val = parseInt(this.val);\r\n    }\r\n\r\n    if (this.key_is_int) {\r\n      this.key = parseInt(this.key);\r\n    }\r\n  }\r\n}\r\n\r\nEnumKeyPair.STRUCT = `\r\nEnumKeyPair {\r\n  key        : string;\r\n  val        : string;\r\n  key_is_int : bool;\r\n  val_is_int : bool; \r\n}\r\n`;\r\nnstructjs.register(EnumKeyPair);\r\n\r\nexport class EnumProperty extends ToolProperty {\r\n  constructor(string_or_int, valid_values, apiname, uiname, description, flag, icon) {\r\n    super(PropTypes.ENUM, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.dynamicMetaCB = undefined;\r\n    this.values = {};\r\n    this.keys = {};\r\n    this.ui_value_names = {};\r\n    this.descriptions = {};\r\n\r\n    if (valid_values === undefined) return this;\r\n\r\n    if (valid_values instanceof Array || valid_values instanceof String) {\r\n      for (var i = 0; i < valid_values.length; i++) {\r\n        this.values[valid_values[i]] = valid_values[i];\r\n        this.keys[valid_values[i]] = valid_values[i];\r\n      }\r\n    } else {\r\n      for (var k in valid_values) {\r\n        this.values[k] = valid_values[k];\r\n        this.keys[valid_values[k]] = k;\r\n      }\r\n    }\r\n\r\n    if (string_or_int === undefined) {\r\n      this.data = first(valid_values);\r\n    } else {\r\n      this.setValue(string_or_int);\r\n    }\r\n\r\n    for (var k in this.values) {\r\n      let uin = k.replace(/[_-]/g, \" \").trim();\r\n      uin = uin.split(\" \");\r\n\r\n      let uiname = ToolProperty.makeUIName(k);\r\n\r\n      this.ui_value_names[k] = uiname;\r\n      this.descriptions[k] = uiname;\r\n    }\r\n\r\n    this.iconmap = {};\r\n    this.iconmap2 = {};\r\n\r\n    this.wasSet = false;\r\n  }\r\n\r\n  /**\r\n   * Provide a callback to update the enum or flags property dynamically\r\n   * Callback should call enumProp.updateDefinition to update the property.\r\n   *\r\n   * @param metaCB: (enumProp: EnumProperty|FlagsProperty) => void\r\n   */\r\n  dynamicMeta(metaCB) {\r\n    this.on(\"meta\", metaCB);\r\n    return this;\r\n  }\r\n\r\n  checkMeta() {\r\n    this._fire(\"meta\", this);\r\n  }\r\n\r\n  calcHash(digest = new util.HashDigest()) {\r\n    this.checkMeta();\r\n    for (let key in this.keys) {\r\n      digest.add(key);\r\n      digest.add(this.keys[key]);\r\n    }\r\n\r\n    return digest.get();\r\n  }\r\n\r\n  updateDefinition(enumdef_or_prop) {\r\n    let descriptions = this.descriptions;\r\n    let ui_value_names = this.ui_value_names;\r\n\r\n    this.values = {};\r\n    this.keys = {};\r\n    this.ui_value_names = {};\r\n    this.descriptions = {};\r\n\r\n    let enumdef;\r\n\r\n    if (enumdef_or_prop instanceof EnumProperty) {\r\n      enumdef = enumdef_or_prop.values;\r\n    } else {\r\n      enumdef = enumdef_or_prop;\r\n    }\r\n\r\n    for (let k in enumdef) {\r\n      let v = enumdef[k];\r\n\r\n      this.values[k] = v;\r\n      this.keys[v] = k;\r\n    }\r\n\r\n    if (enumdef_or_prop instanceof EnumProperty) {\r\n      let prop = enumdef_or_prop;\r\n      this.iconmap = Object.assign({}, prop.iconmap);\r\n      this.iconmap2 = Object.assign({}, prop.iconmap2);\r\n\r\n      this.ui_value_names = Object.assign({}, prop.ui_value_names);\r\n      this.descriptions = Object.assign({}, prop.descriptions);\r\n    } else {\r\n      for (let k in this.values) {\r\n        if (k in ui_value_names) {\r\n          this.ui_value_names[k] = ui_value_names[k];\r\n        } else {\r\n          this.ui_value_names[k] = ToolProperty.makeUIName(k);\r\n        }\r\n\r\n        if (k in descriptions) {\r\n          this.descriptions[k] = descriptions[k];\r\n        } else {\r\n          this.descriptions[k] = ToolProperty.makeUIName(k);\r\n        }\r\n      }\r\n    }\r\n\r\n    this._fire(\"metaChange\", this);\r\n\r\n    return this;\r\n  }\r\n\r\n  calcMemSize() {\r\n    this.checkMeta();\r\n    let tot = super.calcMemSize();\r\n\r\n    for (let k in this.values) {\r\n      tot += (k.length * 4 + 16) * 4;\r\n    }\r\n\r\n    if (this.descriptions) {\r\n      for (let k in this.descriptions) {\r\n        tot += (k.length + this.descriptions[k].length) * 4;\r\n      }\r\n    }\r\n\r\n    return tot + 64;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.getValue() === b.getValue();\r\n  }\r\n\r\n  addUINames(map) {\r\n    for (let k in map) {\r\n      this.ui_value_names[k] = map[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addDescriptions(map) {\r\n    for (let k in map) {\r\n      this.descriptions[k] = map[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addIcons2(iconmap2) {\r\n    if (this.iconmap2 === undefined) {\r\n      this.iconmap2 = {};\r\n    }\r\n\r\n    for (let k in iconmap2) {\r\n      this.iconmap2[k] = iconmap2[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addIcons(iconmap) {\r\n    if (this.iconmap === undefined) {\r\n      this.iconmap = {};\r\n    }\r\n    for (let k in iconmap) {\r\n      this.iconmap[k] = iconmap[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  copyTo(p) {\r\n    super.copyTo(p);\r\n\r\n    p.data = this.data;\r\n\r\n    // copy meta event handlers\r\n    p.callbacks.meta = Array.from(this.callbacks.meta ?? []);\r\n\r\n    p.keys = Object.assign({}, this.keys);\r\n    p.values = Object.assign({}, this.values);\r\n    p.ui_value_names = this.ui_value_names;\r\n    p.update = this.update;\r\n    p.api_update = this.api_update;\r\n\r\n    p.iconmap = this.iconmap;\r\n    p.iconmap2 = this.iconmap2;\r\n    p.descriptions = this.descriptions;\r\n\r\n    return p;\r\n  }\r\n\r\n  copy() {\r\n    var p = new this.constructor(\"dummy\", { \"dummy\": 0 }, this.apiname, this.uiname, this.description, this.flag);\r\n\r\n    this.copyTo(p);\r\n    return p;\r\n  }\r\n\r\n  getValue() {\r\n    if (this.data in this.values) return this.values[this.data];\r\n    else return this.data;\r\n  }\r\n\r\n  setValue(val) {\r\n    this.checkMeta();\r\n    if (!(val in this.values) && val in this.keys) val = this.keys[val];\r\n\r\n    if (!(val in this.values)) {\r\n      this.report(\"Invalid value for enum!\", val, this.values);\r\n      return;\r\n    }\r\n\r\n    this.data = val;\r\n\r\n    //fire events\r\n    super.setValue(val);\r\n    return this;\r\n  }\r\n\r\n  _loadMap(obj) {\r\n    if (!obj) {\r\n      return {};\r\n    }\r\n\r\n    let ret = {};\r\n    for (let k of obj) {\r\n      ret[k.key] = k.val;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  _saveMap(obj) {\r\n    obj = obj === undefined ? {} : obj;\r\n    let ret = [];\r\n\r\n    for (let k in obj) {\r\n      ret.push(new EnumKeyPair(k, obj[k]));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n\r\n    this.keys = this._loadMap(this._keys);\r\n    this.values = this._loadMap(this._values);\r\n    this.ui_value_names = this._loadMap(this._ui_value_names);\r\n    this.iconmap = this._loadMap(this._iconmap);\r\n    this.iconmap2 = this._loadMap(this._iconmap2);\r\n    this.descriptions = this._loadMap(this._descriptions);\r\n\r\n    if (this.data_is_int) {\r\n      this.data = parseInt(this.data);\r\n      delete this.data_is_int;\r\n    } else if (this.data in this.keys) {\r\n      this.data = this.keys[this.data];\r\n    }\r\n  }\r\n\r\n  _is_data_int() {\r\n    return typeof this.data === \"number\";\r\n  }\r\n}\r\n\r\nToolProperty.internalRegister(EnumProperty);\r\nEnumProperty.STRUCT =\r\n  nstructjs.inherit(EnumProperty, ToolProperty) +\r\n  `\r\n  data            : string             | \"\"+this.data;\r\n  data_is_int     : bool               | this._is_data_int();\r\n  _keys           : array(EnumKeyPair) | this._saveMap(this.keys) ;\r\n  _values         : array(EnumKeyPair) | this._saveMap(this.values) ;\r\n  _ui_value_names : array(EnumKeyPair) | this._saveMap(this.ui_value_names) ;\r\n  _iconmap        : array(EnumKeyPair) | this._saveMap(this.iconmap) ;\r\n  _iconmap2       : array(EnumKeyPair) | this._saveMap(this.iconmap2) ;\r\n  _descriptions   : array(EnumKeyPair) | this._saveMap(this.descriptions) ;  \r\n}\r\n`;\r\nnstructjs.register(EnumProperty);\r\n\r\nexport class FlagProperty extends EnumProperty {\r\n  constructor(string_or_int, valid_values, apiname, uiname, description, flag, icon) {\r\n    super(string_or_int, valid_values, apiname, uiname, description, flag, icon);\r\n\r\n    this.type = PropTypes.FLAG;\r\n    this.wasSet = false;\r\n  }\r\n\r\n  setValue(bitmask) {\r\n    this.checkMeta();\r\n    this.data = bitmask;\r\n\r\n    //do not trigger EnumProperty's setValue\r\n    ToolProperty.prototype.setValue.call(this, bitmask);\r\n    return this;\r\n  }\r\n}\r\n\r\nToolProperty.internalRegister(FlagProperty);\r\nFlagProperty.STRUCT =\r\n  nstructjs.inherit(FlagProperty, EnumProperty) +\r\n  `\r\n}\r\n`;\r\nnstructjs.register(FlagProperty);\r\n\r\nexport class VecPropertyBase extends FloatProperty {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(undefined, apiname, uiname, description);\r\n\r\n    this.hasUniformSlider = false;\r\n  }\r\n\r\n  calcMemSize() {\r\n    return super.calcMemSize() + this.data.length * 8;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data.vectorDistance(b.data) < 0.00001;\r\n  }\r\n\r\n  uniformSlider(state = true) {\r\n    this.hasUniformSlider = state;\r\n    return this;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n    b.hasUniformSlider = this.hasUniformSlider;\r\n  }\r\n}\r\n\r\nVecPropertyBase.STRUCT =\r\n  nstructjs.inherit(VecPropertyBase, FloatProperty) +\r\n  `\r\n  hasUniformSlider : bool | this.hasUniformSlider || false;\r\n}\r\n`;\r\n\r\nexport class Vec2Property extends FloatProperty {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(undefined, apiname, uiname, description);\r\n\r\n    this.type = PropTypes.VEC2;\r\n    this.data = new Vector2(data);\r\n  }\r\n\r\n  setValue(v) {\r\n    this.data.load(v);\r\n\r\n    //do not trigger parent classes's setValue\r\n    ToolProperty.prototype.setValue.call(this, v);\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    let data = b.data;\r\n    super.copyTo(b);\r\n\r\n    b.data = data;\r\n    b.data.load(this.data);\r\n  }\r\n}\r\n\r\nVec2Property.STRUCT =\r\n  nstructjs.inherit(Vec2Property, VecPropertyBase) +\r\n  `\r\n  data : vec2;\r\n}\r\n`;\r\nnstructjs.register(Vec2Property);\r\n\r\nToolProperty.internalRegister(Vec2Property);\r\n\r\nexport class Vec3Property extends VecPropertyBase {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(undefined, apiname, uiname, description);\r\n\r\n    this.type = PropTypes.VEC3;\r\n    this.data = new Vector3(data);\r\n  }\r\n\r\n  isColor() {\r\n    this.subtype = PropSubTypes.COLOR;\r\n    return this;\r\n  }\r\n\r\n  setValue(v) {\r\n    this.data.load(v);\r\n\r\n    //do not trigger parent classes's setValue\r\n    ToolProperty.prototype.setValue.call(this, v);\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    let data = b.data;\r\n    super.copyTo(b);\r\n\r\n    b.data = data;\r\n    b.data.load(this.data);\r\n  }\r\n}\r\n\r\nVec3Property.STRUCT =\r\n  nstructjs.inherit(Vec3Property, VecPropertyBase) +\r\n  `\r\n  data : vec3;\r\n}\r\n`;\r\nnstructjs.register(Vec3Property);\r\nToolProperty.internalRegister(Vec3Property);\r\n\r\nexport class Vec4Property extends FloatProperty {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(undefined, apiname, uiname, description);\r\n\r\n    this.type = PropTypes.VEC4;\r\n    this.data = new Vector4(data);\r\n  }\r\n\r\n  setValue(v, w = 1.0) {\r\n    this.data.load(v);\r\n\r\n    //do not trigger parent classes's setValue\r\n    ToolProperty.prototype.setValue.call(this, v);\r\n\r\n    if (v.length < 3) {\r\n      this.data[2] = 0.0;\r\n    }\r\n    if (v.length < 4) {\r\n      this.data[3] = w;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  isColor() {\r\n    this.subtype = PropSubTypes.COLOR;\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    let data = b.data;\r\n    super.copyTo(b);\r\n\r\n    b.data = data;\r\n    b.data.load(this.data);\r\n  }\r\n}\r\n\r\nVec4Property.STRUCT =\r\n  nstructjs.inherit(Vec4Property, VecPropertyBase) +\r\n  `\r\n  data : vec4;\r\n}\r\n`;\r\nnstructjs.register(Vec4Property);\r\nToolProperty.internalRegister(Vec4Property);\r\n\r\nexport class QuatProperty extends ToolProperty {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(PropTypes.QUAT, undefined, apiname, uiname, description);\r\n    this.data = new Quat(data);\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data.vectorDistance(b.data) < 0.00001;\r\n  }\r\n\r\n  setValue(v) {\r\n    this.data.load(v);\r\n    super.setValue(v);\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    let data = b.data;\r\n    super.copyTo(b);\r\n\r\n    b.data = data;\r\n    b.data.load(this.data);\r\n  }\r\n}\r\n\r\nQuatProperty.STRUCT =\r\n  nstructjs.inherit(QuatProperty, VecPropertyBase) +\r\n  `\r\n  data : vec4;\r\n}\r\n`;\r\nnstructjs.register(QuatProperty);\r\n\r\nToolProperty.internalRegister(QuatProperty);\r\n\r\nexport class Mat4Property extends ToolProperty {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(PropTypes.MATRIX4, undefined, apiname, uiname, description);\r\n    this.data = new Matrix4(data);\r\n  }\r\n\r\n  calcMemSize() {\r\n    return super.calcMemSize() + 16 * 8 + 32;\r\n  }\r\n\r\n  equals(b) {\r\n    let m1 = this.data.$matrix;\r\n    let m2 = b.data.$matrix;\r\n\r\n    for (let i = 1; i <= 4; i++) {\r\n      for (let j = 1; j <= 4; j++) {\r\n        let key = `m${i}${j}`;\r\n\r\n        if (Math.abs(m1[key] - m2[key]) > 0.00001) {\r\n          return false;\r\n        }\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  setValue(v) {\r\n    this.data.load(v);\r\n    super.setValue(v);\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    let data = b.data;\r\n    super.copyTo(b);\r\n    b.data = data;\r\n\r\n    b.data.load(this.data);\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n  }\r\n}\r\n\r\nMat4Property.STRUCT =\r\n  nstructjs.inherit(Mat4Property, FloatProperty) +\r\n  `\r\n  data           : mat4;\r\n}\r\n`;\r\nnstructjs.register(Mat4Property);\r\nToolProperty.internalRegister(Mat4Property);\r\n\r\n/**\r\n * List of other tool props (all of one type)\r\n */\r\nexport class ListProperty extends ToolProperty {\r\n  /*\r\n   * Prop must be a ToolProperty subclass instance\r\n   * */\r\n  constructor(prop, list = [], uiname = \"\") {\r\n    super(PropTypes.PROPLIST);\r\n\r\n    this.uiname = uiname;\r\n    this.flag &= ~PropFlags.SAVE_LAST_VALUE;\r\n\r\n    if (typeof prop == \"number\") {\r\n      prop = PropClasses[prop];\r\n\r\n      if (prop !== undefined) {\r\n        prop = new prop();\r\n      }\r\n    } else if (prop !== undefined) {\r\n      if (prop instanceof ToolProperty) {\r\n        prop = prop.copy();\r\n      } else {\r\n        prop = new prop();\r\n      }\r\n    }\r\n\r\n    this.prop = prop;\r\n    this.value = [];\r\n\r\n    if (list) {\r\n      for (let val of list) {\r\n        this.push(val);\r\n      }\r\n    }\r\n\r\n    this.wasSet = false;\r\n  }\r\n\r\n  get length() {\r\n    return this.value.length;\r\n  }\r\n\r\n  set length(val) {\r\n    this.value.length = val;\r\n  }\r\n\r\n  splice(i, deleteCount, ...newItems) {\r\n    const deletedItems = this.value.splice(i, deleteCount, ...newItems);\r\n    this.length = this.value.length;\r\n    return deletedItems;\r\n  }\r\n\r\n  calcMemSize() {\r\n    let tot = super.calcMemSize();\r\n\r\n    let psize = this.prop ? this.prop.calcMemSize() + 8 : 8;\r\n    if (!this.prop && this.value.length > 0) {\r\n      psize = this.value[0].calcMemSize();\r\n    }\r\n\r\n    tot += psize * this.value.length + 8;\r\n    tot += 16;\r\n\r\n    return tot;\r\n  }\r\n\r\n  equals(b) {\r\n    let l1 = this.value ? this.value.length : 0;\r\n    let l2 = b.value ? b.value.length : 0;\r\n\r\n    if (l1 !== l2) {\r\n      return false;\r\n    }\r\n\r\n    for (let i = 0; i < l1; i++) {\r\n      let prop1 = this.value[i];\r\n      let prop2 = b.value[i];\r\n\r\n      let bad = prop1.constructor !== prop2.constructor;\r\n      bad = bad || !prop1.equals(prop2);\r\n\r\n      if (bad) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n\r\n    b.prop = this.prop.copy();\r\n    b.value.length = [];\r\n\r\n    for (let prop of this.value) {\r\n      b.value.push(prop.copy());\r\n    }\r\n\r\n    return b;\r\n  }\r\n\r\n  copy() {\r\n    return this.copyTo(new ListProperty(this.prop.copy()));\r\n  }\r\n\r\n  push(item = undefined) {\r\n    if (item === undefined) {\r\n      item = this.prop.copy();\r\n    }\r\n\r\n    if (!(item instanceof ToolProperty)) {\r\n      let prop = this.prop.copy();\r\n      prop.setValue(item);\r\n      item = prop;\r\n    }\r\n\r\n    this.value.push(item);\r\n    return item;\r\n  }\r\n\r\n  clear() {\r\n    this.value.length = 0;\r\n    return this;\r\n  }\r\n\r\n  getListItem(i) {\r\n    if (i < 0) {\r\n      i += this.length;\r\n    }\r\n    return this.value[i].getValue();\r\n  }\r\n\r\n  setListItem(i, val) {\r\n    if (i < 0) {\r\n      i += this.length;\r\n    }\r\n    this.value[i].setValue(val);\r\n  }\r\n\r\n  setValue(value) {\r\n    this.clear();\r\n\r\n    for (let item of value) {\r\n      let prop = this.push();\r\n\r\n      if (typeof item !== \"object\") {\r\n        prop.setValue(item);\r\n      } else if (item instanceof prop.constructor) {\r\n        item.copyTo(prop);\r\n      } else {\r\n        this.report(item);\r\n        throw new Error(\"invalid value \" + item);\r\n      }\r\n    }\r\n\r\n    super.setValue(value);\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.value;\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    let list = this.value;\r\n\r\n    return (function* () {\r\n      for (let item of list) {\r\n        yield item.getValue();\r\n      }\r\n    })();\r\n  }\r\n}\r\n\r\nListProperty.STRUCT =\r\n  nstructjs.inherit(ListProperty, ToolProperty) +\r\n  `\r\n  prop  : abstract(ToolProperty);\r\n  value : array(abstract(ToolProperty));\r\n}`;\r\nnstructjs.register(ListProperty);\r\n\r\nToolProperty.internalRegister(ListProperty);\r\n\r\n//like FlagsProperty but uses strings\r\nexport class StringSetProperty extends ToolProperty {\r\n  constructor(value = undefined, definition = []) {\r\n    super(PropTypes.STRSET);\r\n\r\n    let values = [];\r\n\r\n    this.value = new util.set();\r\n\r\n    let def = definition;\r\n    if (Array.isArray(def) || def instanceof util.set || def instanceof Set) {\r\n      for (let item of def) {\r\n        values.push(item);\r\n      }\r\n    } else if (typeof def === \"object\") {\r\n      for (let k in def) {\r\n        values.push(k);\r\n      }\r\n    } else if (typeof def === \"string\") {\r\n      values.push(def);\r\n    }\r\n\r\n    this.values = {};\r\n    this.ui_value_names = {};\r\n    this.descriptions = {};\r\n    this.iconmap = {};\r\n    this.iconmap2 = {};\r\n\r\n    for (let v of values) {\r\n      this.values[v] = v;\r\n\r\n      let uiname = ToolProperty.makeUIName(v);\r\n      this.ui_value_names[v] = uiname;\r\n    }\r\n\r\n    if (value !== undefined) {\r\n      this.setValue(value);\r\n    }\r\n\r\n    this.wasSet = false;\r\n  }\r\n\r\n  calcMemSize() {\r\n    let tot = super.calcMemSize();\r\n\r\n    for (let k in this.values) {\r\n      tot += (k.length + 16) * 5;\r\n    }\r\n\r\n    if (this.descriptions) {\r\n      for (let k in this.descriptions) {\r\n        tot += (k.length + this.descriptions[k].length + 8) * 4;\r\n      }\r\n    }\r\n\r\n    return tot + 64;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.value.equals(b.value);\r\n  }\r\n\r\n  /*\r\n   * Values can be a string, undefined/null, or a list/set/object-literal of strings.\r\n   * If destructive is true, then existing set will be cleared.\r\n   * */\r\n  setValue(values, destructive = true, soft_fail = true) {\r\n    let bad = typeof values !== \"string\";\r\n    bad = bad && typeof values !== \"object\";\r\n    bad = bad && values !== undefined && values !== null;\r\n\r\n    if (bad) {\r\n      if (soft_fail) {\r\n        this.report(\"Invalid argument to StringSetProperty.prototype.setValue() \" + values);\r\n        return;\r\n      } else {\r\n        throw new Error(\"Invalid argument to StringSetProperty.prototype.setValue() \" + values);\r\n      }\r\n    }\r\n\r\n    //handle undefined/null\r\n    if (!values) {\r\n      this.value.clear();\r\n    } else if (typeof values === \"string\") {\r\n      if (destructive) this.value.clear();\r\n\r\n      if (!(values in this.values)) {\r\n        if (soft_fail) {\r\n          this.report(`\"${values}\" is not in this StringSetProperty`);\r\n          return;\r\n        } else {\r\n          throw new Error(`\"${values}\" is not in this StringSetProperty`);\r\n        }\r\n      }\r\n\r\n      this.value.add(values);\r\n    } else {\r\n      let data = [];\r\n\r\n      if (Array.isArray(values) || values instanceof util.set || values instanceof Set) {\r\n        for (let item of values) {\r\n          data.push(item);\r\n        }\r\n      } else {\r\n        //object literal?\r\n        for (let k in values) {\r\n          data.push(k);\r\n        }\r\n      }\r\n\r\n      for (let item of data) {\r\n        if (!(item in this.values)) {\r\n          if (soft_fail) {\r\n            this.report(`\"${item}\" is not in this StringSetProperty`);\r\n            continue;\r\n          } else {\r\n            throw new Error(`\"${item}\" is not in this StringSetProperty`);\r\n          }\r\n        }\r\n\r\n        this.value.add(item);\r\n      }\r\n    }\r\n\r\n    super.setValue();\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.value;\r\n  }\r\n\r\n  addIcons2(iconmap2) {\r\n    if (iconmap2 === undefined) return;\r\n\r\n    for (let k in iconmap2) {\r\n      this.iconmap2[k] = iconmap2[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addIcons(iconmap) {\r\n    if (iconmap === undefined) return;\r\n\r\n    for (let k in iconmap) {\r\n      this.iconmap[k] = iconmap[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addUINames(map) {\r\n    for (let k in map) {\r\n      this.ui_value_names[k] = map[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addDescriptions(map) {\r\n    for (let k in map) {\r\n      this.descriptions[k] = map[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n\r\n    for (let val of this.value) {\r\n      b.value.add(val);\r\n    }\r\n\r\n    b.values = {};\r\n    for (let k in this.values) {\r\n      b.values[k] = this.values[k];\r\n    }\r\n\r\n    b.ui_value_names = {};\r\n    for (let k in this.ui_value_names) {\r\n      b.ui_value_names[k] = this.ui_value_names[k];\r\n    }\r\n\r\n    b.iconmap = {};\r\n    b.iconmap2 = {};\r\n\r\n    for (let k in this.iconmap) {\r\n      b.iconmap[k] = this.iconmap[k];\r\n    }\r\n\r\n    for (let k in this.iconmap2) {\r\n      b.iconmap2[k] = this.iconmap2[k];\r\n    }\r\n\r\n    b.descriptions = {};\r\n    for (let k in this.descriptions) {\r\n      b.descriptions[k] = this.descriptions[k];\r\n    }\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    let values = this.values;\r\n    this.values = {};\r\n\r\n    for (let s of values) {\r\n      this.values[s] = s;\r\n    }\r\n\r\n    this.value = new util.set(this.value);\r\n  }\r\n}\r\n\r\nStringSetProperty.STRUCT =\r\n  nstructjs.inherit(StringSetProperty, ToolProperty) +\r\n  `\r\n  value  : iter(string);\r\n  values : iterkeys(string);  \r\n}`;\r\nnstructjs.register(StringSetProperty);\r\n\r\nToolProperty.internalRegister(StringSetProperty);\r\n","export let config = {\r\n    doubleClickTime: 500,\r\n\r\n    //auto load 1d bspline templates, can hurt startup time\r\n    autoLoadSplineTemplates: true,\r\n\r\n    //timeout for press-and-hold (touch) version of double clicking\r\n    doubleClickHoldTime: 750,\r\n    DEBUG: {}\r\n}\r\n\r\nexport function setConfig(obj) {\r\n    for (let k in obj) {\r\n        config[k] = obj[k]\r\n    }\r\n}\r\n\r\nexport default config\r\n","import * as util from \"./util.js\";\r\nimport cconst from '../config/config.js';\r\nimport {Vector2} from './vectormath.js';\r\n\r\nexport let modalstack = [];\r\nlet singleMouseCBs = {};\r\n\r\nfunction debugDomEvents() {\r\n  let cbsymbol = Symbol(\"event-callback\");\r\n  let thsymbol = Symbol(\"debug-info\");\r\n\r\n  let idgen = 0;\r\n\r\n  function init(et) {\r\n    if (!et[thsymbol]) {\r\n      et[thsymbol] = idgen++;\r\n    }\r\n  }\r\n\r\n  function getkey(et, type, options) {\r\n    init(et);\r\n    return \"\" + et[thsymbol] + \":\" + type + \":\" + JSON.stringify(options);\r\n  }\r\n\r\n  let addEventListener = EventTarget.prototype.addEventListener;\r\n  let removeEventListener = EventTarget.prototype.removeEventListener;\r\n\r\n  EventTarget.prototype.addEventListener = function (type, cb, options) {\r\n    init(this);\r\n\r\n    if (!cb[cbsymbol]) {\r\n      cb[cbsymbol] = new Set();\r\n    }\r\n\r\n    let key = getkey(this, type, options);\r\n    cb[cbsymbol].add(key);\r\n\r\n    return addEventListener.call(this, type, cb, options);\r\n  }\r\n\r\n  EventTarget.prototype.removeEventListener = function (type, cb, options) {\r\n    init(this);\r\n\r\n    if (!cb[cbsymbol]) {\r\n      console.error(\"Invalid callback in removeEventListener for\", type, this, cb);\r\n      return;\r\n    }\r\n\r\n    let key = getkey(this, type, options);\r\n\r\n    if (!cb[cbsymbol].has(key)) {\r\n      console.error(\"Callback not in removeEventListener;\", type, this, cb);\r\n      return;\r\n    }\r\n\r\n    cb[cbsymbol].delete(key);\r\n\r\n    return removeEventListener.call(this, type, cb, options);\r\n  }\r\n}\r\n\r\nfunction singletonMouseEvents() {\r\n  if (typeof document === 'undefined') {\r\n    // inside a worker?\r\n    return\r\n  }\r\n  \r\n  let keys = [\"mousedown\", \"mouseup\", \"mousemove\"];\r\n  for (let k of keys) {\r\n    singleMouseCBs[k] = new Set();\r\n  }\r\n\r\n  let ddd = -1.0;\r\n  window.testSingleMouseUpEvent = (type = \"mousedown\") => {\r\n    let id = ddd++;\r\n    singleMouseEvent(() => {\r\n      console.log(\"mouse event\", id);\r\n    }, type)\r\n  };\r\n\r\n  let _mpos = new Vector2();\r\n\r\n  function doSingleCbs(e, type) {\r\n    let list = singleMouseCBs[type];\r\n    singleMouseCBs[type] = new Set();\r\n\r\n    if (e.type !== \"touchend\" && e.type !== \"touchcancel\") {\r\n      _mpos[0] = e.touches && e.touches.length > 0 ? e.touches[0].pageX : e.x;\r\n      _mpos[1] = e.touches && e.touches.length > 0 ? e.touches[0].pageY : e.y;\r\n    }\r\n\r\n    if (e.touches) {\r\n      e = copyEvent(e);\r\n\r\n      e.type = type;\r\n      if (e.touches.length > 0) {\r\n        e.x = e.pageX = e.touches[0].pageX;\r\n        e.y = e.pageY = e.touches[0].pageY;\r\n      } else {\r\n        e.x = _mpos[0];\r\n        e.y = _mpos[1];\r\n      }\r\n    }\r\n\r\n    for (let cb of list) {\r\n      try {\r\n        cb(e);\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        console.warn(\"Error in event callback\");\r\n      }\r\n    }\r\n  }\r\n\r\n  window.addEventListener(\"mouseup\", (e) => {\r\n    doSingleCbs(e, \"mouseup\");\r\n  }, {capture: true});\r\n  window.addEventListener(\"touchcancel\", (e) => {\r\n    doSingleCbs(e, \"mouseup\");\r\n  }, {capture: true});\r\n  document.addEventListener(\"touchend\", (e) => {\r\n    doSingleCbs(e, \"mouseup\");\r\n  }, {capture: true});\r\n\r\n  document.addEventListener(\"mousedown\", (e) => {\r\n    doSingleCbs(e, \"mousedown\");\r\n  }, {capture: true});\r\n  document.addEventListener(\"touchstart\", (e) => {\r\n    doSingleCbs(e, \"mousedown\");\r\n  }, {capture: true});\r\n\r\n  document.addEventListener(\"mousemove\", (e) => {\r\n    doSingleCbs(e, \"mousemove\");\r\n  }, {capture: true});\r\n  document.addEventListener(\"touchmove\", (e) => {\r\n    doSingleCbs(e, \"mousemove\");\r\n  }, {capture: true});\r\n\r\n  return {\r\n    singleMouseEvent(cb, type) {\r\n      if (!(type in singleMouseCBs)) {\r\n        throw new Error(\"not a mouse event\");\r\n      }\r\n\r\n      singleMouseCBs[type].add(cb);\r\n    }\r\n  };\r\n}\r\n\r\nsingletonMouseEvents = singletonMouseEvents();\r\n\r\n/**\r\n * adds a mouse event callback that only gets called once\r\n * */\r\nexport function singleMouseEvent(cb, type) {\r\n  return singletonMouseEvents.singleMouseEvent(cb, type);\r\n}\r\n\r\n\r\n/*tests if either the left mouse button is down,\r\n* or a touch event has happened and e.touches.length == 1*/\r\nexport function isLeftClick(e) {\r\n  if (e.touches !== undefined) {\r\n    return e.touches.length === 1;\r\n  }\r\n\r\n  return e.button === 0;\r\n}\r\n\r\nexport class DoubleClickHandler {\r\n  constructor() {\r\n    this.down = 0;\r\n    this.last = 0;\r\n    this.dblEvent = undefined;\r\n\r\n    this.start_mpos = new Vector2();\r\n\r\n    this._on_mouseup = this._on_mouseup.bind(this);\r\n    this._on_mousemove = this._on_mousemove.bind(this);\r\n  }\r\n\r\n  _on_mouseup(e) {\r\n    //console.log(\"mup\", e);\r\n    this.mdown = false;\r\n  }\r\n\r\n  _on_mousemove(e) {\r\n    let mpos = new Vector2();\r\n    mpos[0] = e.x;\r\n    mpos[1] = e.y;\r\n\r\n    let dist = mpos.vectorDistance(this.start_mpos)*devicePixelRatio;\r\n\r\n    if (dist > 11) {\r\n      //console.log(\"cancel\", dist);\r\n      this.mdown = false;\r\n    }\r\n\r\n    if (this.mdown) {\r\n      singleMouseEvent(this._on_mousemove, \"mousemove\");\r\n    }\r\n\r\n    this.update();\r\n  }\r\n\r\n  mousedown(e) {\r\n    //console.log(\"mdown\", e.x, e.y);\r\n\r\n    if (!this.last) {\r\n      this.last = 0;\r\n    }\r\n    if (!this.down) {\r\n      this.down = 0;\r\n    }\r\n    if (!this.up) {\r\n      this.up = 0;\r\n    }\r\n\r\n    if (isMouseDown(e)) {\r\n      this.mdown = true;\r\n\r\n      let cpy = Object.assign({}, e);\r\n\r\n      this.start_mpos[0] = e.x;\r\n      this.start_mpos[1] = e.y;\r\n\r\n      singleMouseEvent(this._on_mousemove, \"mousemove\");\r\n\r\n      if (e.type.search(\"touch\") >= 0 && e.touches.length > 0) {\r\n        cpy.x = cpy.pageX = e.touches[0].pageX;\r\n        cpy.y = cpy.pageY = e.touches[1].pageY;\r\n      } else {\r\n        cpy.x = cpy.pageX = e.x;\r\n        cpy.y = cpy.pageY = e.y;\r\n      }\r\n\r\n      //stupid real MouseEvent class zeros .x/.y\r\n      //continue using hackish copyEvent for now...\r\n\r\n      this.dblEvent = copyEvent(e);\r\n      this.dblEvent.type = \"dblclick\";\r\n\r\n      this.last = this.down;\r\n      this.down = util.time_ms();\r\n\r\n      if (this.down - this.last < cconst.doubleClickTime) {\r\n        this.mdown = false;\r\n        this.ondblclick(this.dblEvent);\r\n\r\n        this.down = this.last = 0.0;\r\n      } else {\r\n        singleMouseEvent(this._on_mouseup, \"mouseup\");\r\n      }\r\n    } else {\r\n      this.mdown = false;\r\n    }\r\n  }\r\n\r\n  //you may override this\r\n  ondblclick(e) {\r\n\r\n  }\r\n\r\n  update() {\r\n    if (modalstack.length > 0) {\r\n      //cancel double click requests\r\n      this.mdown = false;\r\n    }\r\n\r\n    if (this.mdown && util.time_ms() - this.down > cconst.doubleClickHoldTime) {\r\n      this.mdown = false;\r\n      this.ondblclick(this.dblEvent);\r\n    }\r\n  }\r\n\r\n  abort() {\r\n    this.last = this.down = 0;\r\n  }\r\n}\r\n\r\nexport function isMouseDown(e) {\r\n  let mdown = 0;\r\n\r\n  if (e.touches !== undefined) {\r\n    mdown = e.touches.length > 0;\r\n  } else {\r\n    mdown = e.buttons;\r\n  }\r\n\r\n  mdown = mdown & 1;\r\n\r\n  return mdown;\r\n}\r\n\r\nexport function pathDebugEvent(e, extra) {\r\n  e.__prevdef = e.preventDefault;\r\n  e.__stopprop = e.stopPropagation;\r\n\r\n  e.preventDefault = function () {\r\n    console.warn(\"preventDefault\", extra);\r\n    return this.__prevdef();\r\n  };\r\n\r\n  e.stopPropagation = function () {\r\n    console.warn(\"stopPropagation\", extra);\r\n    return this.__stopprop();\r\n  }\r\n}\r\n\r\n/** Returns true if event came from a touchscreen or pen device */\r\nexport function eventWasTouch(e) {\r\n  let ret = e.sourceCapabilities && e.sourceCapabilities.firesTouchEvents;\r\n  ret = ret || e.was_touch;\r\n  ret = ret || e instanceof TouchEvent;\r\n  ret = ret || e.touches !== undefined;\r\n\r\n  if (e instanceof PointerEvent) {\r\n    ret = ret || (e.pointerType === \"pen\" || e.pointerType === \"touch\");\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nexport function copyEvent(e) {\r\n  let ret = {};\r\n  let keys = [];\r\n\r\n  for (let k in e) {\r\n    keys.push(k);\r\n  }\r\n\r\n  keys = keys.concat(Object.getOwnPropertySymbols(e));\r\n  keys = keys.concat(Object.getOwnPropertyNames(e));\r\n\r\n  for (let k of keys) {\r\n    let v;\r\n\r\n    try {\r\n      v = e[k];\r\n    } catch (error) {\r\n      console.warn(\"read error for event key\", k);\r\n      continue;\r\n    }\r\n\r\n    if (typeof v == \"function\") {\r\n      ret[k] = v.bind(e);\r\n    } else {\r\n      ret[k] = v;\r\n    }\r\n  }\r\n\r\n  ret.original = e;\r\n\r\n  return ret;\r\n}\r\n\r\nlet Screen;\r\n\r\nexport function _setScreenClass(cls) {\r\n  Screen = cls;\r\n}\r\n\r\nfunction findScreen() {\r\n  let rec = (n) => {\r\n    for (let n2 of n.childNodes) {\r\n      if (n2 && typeof n2 === \"object\" && n2 instanceof Screen) {\r\n        return n2;\r\n      }\r\n    }\r\n\r\n    for (let n2 of n.childNodes) {\r\n      let ret = rec(n2);\r\n      if (ret) {\r\n        return ret;\r\n      }\r\n    }\r\n  };\r\n\r\n  return rec(document.body);\r\n}\r\n\r\nwindow._findScreen = findScreen;\r\n\r\nlet ContextAreaClass;\r\n\r\nexport function _setModalAreaClass(cls) {\r\n  ContextAreaClass = cls;\r\n}\r\n\r\nexport function pushPointerModal(obj, elem, pointerId, autoStopPropagation = true) {\r\n  return pushModalLight(obj, autoStopPropagation, elem, pointerId);\r\n}\r\n\r\nexport function pushModalLight(obj, autoStopPropagation = true, elem, pointerId) {\r\n  let keys;\r\n\r\n  if (pointerId === undefined) {\r\n    keys = new Set([\r\n      \"keydown\", \"keyup\", \"mousedown\", \"mouseup\", \"touchstart\", \"touchend\",\r\n      \"touchcancel\", \"mousewheel\", \"mousemove\", \"mouseover\", \"mouseout\", \"mouseenter\",\r\n      \"mouseleave\", \"dragstart\", \"drag\", \"dragend\", \"dragexit\", \"dragleave\", \"dragover\",\r\n      \"dragenter\", \"drop\", \"pointerdown\", \"pointermove\", \"pointerup\", \"pointercancel\",\r\n      \"pointerstart\", \"pointerend\", \"pointerleave\", \"pointerexit\", \"pointerenter\",\r\n      \"pointerover\"\r\n    ]);\r\n  } else {\r\n    keys = new Set([\r\n      \"keydown\", \"keyup\", \"keypress\", \"mousewheel\"\r\n    ]);\r\n  }\r\n\r\n  let ret = {\r\n    keys     : keys,\r\n    handlers : {},\r\n    last_mpos: [0, 0]\r\n  };\r\n\r\n  let touchmap = {\r\n    \"touchstart\" : \"mousedown\",\r\n    \"touchmove\"  : \"mousemove\",\r\n    \"touchend\"   : \"mouseup\",\r\n    \"touchcancel\": \"mouseup\"\r\n  };\r\n\r\n  let mpos = [0, 0];\r\n\r\n  let screen = findScreen();\r\n  if (screen) {\r\n    mpos[0] = screen.mpos[0];\r\n    mpos[1] = screen.mpos[1];\r\n    screen = undefined;\r\n  }\r\n\r\n  function handleAreaContext() {\r\n    let screen = findScreen();\r\n    if (screen) {\r\n      let sarea = screen.findScreenArea(mpos[0], mpos[1]);\r\n      if (sarea && sarea.area) {\r\n        sarea.area.push_ctx_active();\r\n        sarea.area.pop_ctx_active();\r\n      }\r\n    }\r\n  }\r\n\r\n  function make_default_touchhandler(type, state) {\r\n    return function (e) {\r\n      if (cconst.DEBUG.domEvents) {\r\n        pathDebugEvent(e);\r\n      }\r\n\r\n      if (touchmap[type] in ret.handlers) {\r\n        let type2 = touchmap[type];\r\n\r\n        let e2 = copyEvent(e);\r\n\r\n        e2.was_touch = true;\r\n        e2.type = type2;\r\n        e2.button = type == \"touchcancel\" ? 1 : 0;\r\n        e2.touches = e.touches;\r\n\r\n        if (e.touches.length > 0) {\r\n          let t = e.touches[0];\r\n\r\n          mpos[0] = t.pageX;\r\n          mpos[1] = t.pageY;\r\n\r\n          e2.pageX = e2.x = t.pageX;\r\n          e2.pageY = e2.y = t.pageY;\r\n          e2.clientX = t.clientX;\r\n          e2.clientY = t.clientY;\r\n          e2.x = t.clientX;\r\n          e2.y = t.clientY;\r\n\r\n          ret.last_mpos[0] = e2.x;\r\n          ret.last_mpos[1] = e2.y;\r\n        } else {\r\n          e2.x = e2.clientX = e2.pageX = e2.screenX = ret.last_mpos[0];\r\n          e2.y = e2.clientY = e2.pageY = e2.screenY = ret.last_mpos[1];\r\n        }\r\n\r\n        e2.was_touch = true;\r\n\r\n        handleAreaContext();\r\n        //console.log(e2.x, e2.y);\r\n        ret.handlers[type2](e2);\r\n      }\r\n\r\n      if (autoStopPropagation) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n    }\r\n  }\r\n\r\n  function make_handler(type, key) {\r\n    return function (e) {\r\n      if (cconst.DEBUG.domEvents) {\r\n        pathDebugEvent(e);\r\n      }\r\n\r\n      if (typeof key !== \"string\") {\r\n        //console.warn(\"key was undefined\", key, type);\r\n        return;\r\n      }\r\n\r\n      if (key.startsWith(\"mouse\")) {\r\n        mpos[0] = e.pageX;\r\n        mpos[1] = e.pageY;\r\n      } else if (key.startsWith(\"pointer\")) {\r\n        mpos[0] = e.x;\r\n        mpos[1] = e.y;\r\n      }\r\n\r\n      handleAreaContext();\r\n\r\n      if (key !== undefined)\r\n        obj[key](e);\r\n\r\n      if (autoStopPropagation) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n    }\r\n  }\r\n\r\n  let found = {};\r\n\r\n  for (let k of keys) {\r\n    let key;\r\n\r\n    if (obj[k])\r\n      key = k;\r\n    else if (obj[\"on\" + k])\r\n      key = \"on\" + k;\r\n    else if (obj[\"on_\" + k])\r\n      key = \"on_\" + k;\r\n    else if (k in touchmap)\r\n      continue; //default touch event handlers will be done seperately\r\n    else\r\n      key = undefined; //make handler that still blocks events\r\n\r\n    //check we don't override other mouse pointer event handlers\r\n    if (key === undefined && k.search(\"pointer\") === 0) {\r\n      continue;\r\n    }\r\n\r\n    if (key !== undefined) {\r\n      found[k] = 1;\r\n    }\r\n\r\n    let handler = make_handler(k, key);\r\n    ret.handlers[k] = handler;\r\n\r\n    let settings = handler.settings = {passive: false, capture: true};\r\n    window.addEventListener(k, handler, settings);\r\n  }\r\n\r\n  for (let k in touchmap) {\r\n    if (!(k in found)) {\r\n      //console.log(\"making touch handler for\", '\"' + k + '\"', ret.handlers[k]);\r\n\r\n      ret.handlers[k] = make_default_touchhandler(k, ret);\r\n\r\n      let settings = ret.handlers[k].settings = {passive: false, capture: true};\r\n      window.addEventListener(k, ret.handlers[k], settings);\r\n    }\r\n  }\r\n\r\n  if (pointerId !== undefined) {\r\n    ret.pointer = {\r\n      elem, pointerId\r\n    };\r\n\r\n    function make_pointer(k) {\r\n      let k2 = \"on_\" + k;\r\n\r\n      ret.pointer[k] = function (e) {\r\n        if (obj[k2] !== undefined) {\r\n          obj[k2](e);\r\n        }\r\n\r\n        if (autoStopPropagation) {\r\n          e.stopPropagation();\r\n          e.preventDefault();\r\n        }\r\n      }\r\n    }\r\n\r\n    make_pointer(\"pointerdown\");\r\n    make_pointer(\"pointermove\");\r\n    make_pointer(\"pointerup\");\r\n    make_pointer(\"pointerstart\");\r\n    make_pointer(\"pointerend\");\r\n    make_pointer(\"pointerleave\");\r\n    make_pointer(\"pointerenter\");\r\n    make_pointer(\"pointerout\");\r\n    make_pointer(\"pointerover\");\r\n    make_pointer(\"pointerexit\");\r\n    make_pointer(\"pointercancel\");\r\n\r\n    for (let k in ret.pointer) {\r\n      if (k !== \"elem\" && k !== \"pointerId\") {\r\n        elem.addEventListener(k, ret.pointer[k]);\r\n      }\r\n    }\r\n\r\n    try {\r\n      elem.setPointerCapture(pointerId)\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n\r\n      console.log(\"attempting fallback\");\r\n\r\n      for (let k in ret.pointer) {\r\n        if (k !== \"elem\" && k !== \"pointerId\") {\r\n          elem.removeEventListener(k, ret.pointer[k]);\r\n        }\r\n      }\r\n\r\n      delete ret.pointer;\r\n\r\n      modalstack.push(ret);\r\n      popModalLight(ret);\r\n\r\n      for (let k in obj) {\r\n        if (k === \"pointercancel\" || k === \"pointerend\" || k === \"pointerstart\") {\r\n          continue;\r\n        }\r\n\r\n        if (k.startsWith(\"pointer\")) {\r\n          let k2 = k.replace(/pointer/, \"mouse\");\r\n          if (k2 in obj) {\r\n            console.warn(\"warning, existing mouse handler\", k2);\r\n            continue;\r\n          }\r\n\r\n          let v = obj[k];\r\n          obj[k] = undefined;\r\n\r\n          obj[k2] = v;\r\n        }\r\n      }\r\n\r\n      console.log(obj);\r\n\r\n      return pushModalLight(obj, autoStopPropagation);\r\n    }\r\n  }\r\n\r\n  modalstack.push(ret);\r\n  ContextAreaClass.lock();\r\n\r\n  if (cconst.DEBUG.modalEvents) {\r\n    console.warn(\"pushModalLight\", ret.pointer ? \"(pointer events)\" : \"\");\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n/* Trace all calls to EventTarget.prototype.[add/rem]EventListener */\r\nif (0) {\r\n  window._print_evt_debug = false;\r\n\r\n  function evtprint() {\r\n    if (window.window._print_evt_debug) {\r\n      console.warn(...arguments);\r\n    }\r\n  }\r\n\r\n  let addevent = EventTarget.prototype.addEventListener;\r\n  let remevent = EventTarget.prototype.removeEventListener;\r\n\r\n  const funckey = Symbol(\"eventfunc\");\r\n\r\n  EventTarget.prototype.addEventListener = function (name, func, args) {\r\n    //if (name.startsWith(\"key\")) {\r\n    evtprint(\"listener added\", name, func.name, args);\r\n    //}\r\n\r\n    let func2 = function (e) {\r\n      let proxy = new Proxy(e, {\r\n        get(target, p, receiver) {\r\n          if (p === \"preventDefault\") {\r\n            return function () {\r\n              evtprint(\"preventDefault\", name, arguments);\r\n              return e.preventDefault(...arguments);\r\n            }\r\n          } else if (p === \"stopPropagation\") {\r\n            return function () {\r\n              evtprint(\"stopPropagation\", name, arguments);\r\n              return e.preventDefault(...arguments);\r\n            }\r\n          }\r\n\r\n          return e[p];\r\n        }\r\n      });\r\n\r\n      return func.call(this, proxy);\r\n    }\r\n\r\n    func[funckey] = func2;\r\n\r\n    return addevent.call(this, name, func2, args);\r\n  }\r\n\r\n  EventTarget.prototype.removeEventListener = function (name, func, args) {\r\n    //if (name.startsWith(\"key\")) {\r\n    evtprint(\"listener removed\", name, func.name, args);\r\n    //}\r\n\r\n    func = func[funckey];\r\n\r\n    return remevent.call(this, name, func, args);\r\n  }\r\n}\r\n\r\nexport function popModalLight(state) {\r\n  if (state === undefined) {\r\n    console.warn(\"Bad call to popModalLight: state was undefined\");\r\n    return;\r\n  }\r\n\r\n  if (state !== modalstack[modalstack.length - 1]) {\r\n    if (modalstack.indexOf(state) < 0) {\r\n      console.warn(\"Error in popModalLight; modal handler not found\");\r\n      return;\r\n    } else {\r\n      console.warn(\"Error in popModalLight; called in wrong order\");\r\n    }\r\n  }\r\n\r\n  for (let k in state.handlers) {\r\n    //console.log(k);\r\n    window.removeEventListener(k, state.handlers[k], state.handlers[k].settings);\r\n  }\r\n\r\n  state.handlers = {};\r\n  modalstack.remove(state);\r\n  ContextAreaClass.unlock();\r\n\r\n  if (cconst.DEBUG.modalEvents) {\r\n    console.warn(\"popModalLight\", modalstack, state.pointer ? \"(pointer events)\" : \"\");\r\n  }\r\n\r\n  if (state.pointer) {\r\n    let elem = state.pointer.elem;\r\n\r\n    try {\r\n      elem.releasePointerCapture(state.pointer.pointerId);\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n    }\r\n\r\n    for (let k in state.pointer) {\r\n      if (k !== \"elem\" && k !== \"pointerId\") {\r\n        elem.removeEventListener(k, state.pointer[k]);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport function haveModal() {\r\n  return modalstack.length > 0;\r\n}\r\n\r\nwindow._haveModal = haveModal; //for debugging console\r\n\r\nexport var keymap_latin_1 = {\r\n  \"Space\" : 32,\r\n  \"Escape\": 27,\r\n  \"Enter\" : 13,\r\n  \"Return\": 13,\r\n  \"Up\"    : 38,\r\n  \"Down\"  : 40,\r\n  \"Left\"  : 37,\r\n  \"Right\" : 39,\r\n\r\n  \"Num0\"     : 96,\r\n  \"Num1\"     : 97,\r\n  \"Num2\"     : 98,\r\n  \"Num3\"     : 99,\r\n  \"Num4\"     : 100,\r\n  \"Num5\"     : 101,\r\n  \"Num6\"     : 102,\r\n  \"Num7\"     : 103,\r\n  \"Num8\"     : 104,\r\n  \"Num9\"     : 105,\r\n  \"Home\"     : 36,\r\n  \"End\"      : 35,\r\n  \"Delete\"   : 46,\r\n  \"Backspace\": 8,\r\n  \"Insert\"   : 45,\r\n  \"PageUp\"   : 33,\r\n  \"PageDown\" : 34,\r\n  \"Tab\"      : 9,\r\n  \"-\"        : 189,\r\n  \"=\"        : 187,\r\n  \".\"        : 190,\r\n  \"/\"        : 191,\r\n  \",\"        : 188,\r\n  \";\"        : 186,\r\n  \"'\"        : 222,\r\n  \"[\"        : 219,\r\n  \"]\"        : 221,\r\n  \"NumPlus\"  : 107,\r\n  \"NumMinus\" : 109,\r\n  \"Shift\"    : 16,\r\n  \"Ctrl\"     : 17,\r\n  \"Control\"  : 17,\r\n  \"Alt\"      : 18\r\n}\r\n\r\nfor (var i = 0; i < 26; i++) {\r\n  keymap_latin_1[String.fromCharCode(i + 65)] = i + 65\r\n}\r\nfor (var i = 0; i < 10; i++) {\r\n  keymap_latin_1[String.fromCharCode(i + 48)] = i + 48\r\n}\r\n\r\nfor (var k in keymap_latin_1) {\r\n  if (!(k in keymap_latin_1)) {\r\n    keymap_latin_1[keymap_latin_1[k]] = k;\r\n  }\r\n}\r\n\r\nvar keymap_latin_1_rev = {}\r\nfor (var k in keymap_latin_1) {\r\n  keymap_latin_1_rev[keymap_latin_1[k]] = k\r\n}\r\n\r\nexport var keymap = keymap_latin_1;\r\nexport var reverse_keymap = keymap_latin_1_rev;\r\n\r\nexport class HotKey {\r\n  /**action can be a callback or a toolpath string*/\r\n  constructor(key, modifiers, action, uiname) {\r\n    this.action = action;\r\n    this.mods = modifiers;\r\n    this.key = keymap[key];\r\n    this.uiname = uiname;\r\n  }\r\n\r\n  exec(ctx) {\r\n    if (typeof this.action == \"string\") {\r\n      ctx.api.execTool(ctx, this.action);\r\n    } else {\r\n      this.action(ctx);\r\n    }\r\n  }\r\n\r\n  buildString() {\r\n    let s = \"\";\r\n\r\n    for (let i = 0; i < this.mods.length; i++) {\r\n      if (i > 0) {\r\n        s += \" + \";\r\n      }\r\n\r\n      let k = this.mods[i].toLowerCase();\r\n      k = k[0].toUpperCase() + k.slice(1, k.length).toLowerCase();\r\n\r\n      s += k;\r\n    }\r\n\r\n    if (this.mods.length > 0) {\r\n      s += \"+\";\r\n    }\r\n\r\n    s += reverse_keymap[this.key];\r\n\r\n    return s.trim();\r\n  }\r\n}\r\n\r\nexport class KeyMap extends Array {\r\n  /**\r\n   *\r\n   * @param pathid{string} Id of keymap, used when patching hotkeys, when\r\n   *                       that is implemented\r\n   * */\r\n  constructor(hotkeys = [], pathid = \"undefined\") {\r\n    super();\r\n\r\n    this.pathid = pathid;\r\n\r\n    for (let hk of hotkeys) {\r\n      this.add(hk);\r\n    }\r\n  }\r\n\r\n  handle(ctx, e) {\r\n    let mods = new util.set();\r\n    if (e.shiftKey)\r\n      mods.add(\"shift\");\r\n    if (e.altKey)\r\n      mods.add(\"alt\");\r\n    if (e.ctrlKey) {\r\n      mods.add(\"ctrl\");\r\n    }\r\n    if (e.commandKey) {\r\n      mods.add(\"command\");\r\n    }\r\n\r\n    for (let hk of this) {\r\n      let ok = e.keyCode === hk.key;\r\n      if (!ok) continue;\r\n\r\n      let count = 0;\r\n      for (let m of hk.mods) {\r\n        m = m.toLowerCase().trim();\r\n\r\n        if (!mods.has(m)) {\r\n          ok = false;\r\n          break;\r\n        }\r\n\r\n        count++;\r\n      }\r\n\r\n      if (count !== mods.length) {\r\n        ok = false;\r\n      }\r\n\r\n      if (ok) {\r\n        try {\r\n          hk.exec(ctx);\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n          console.log(\"failed to execute a hotkey\", keymap[e.keyCode]);\r\n        }\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  add(hk) {\r\n    this.push(hk);\r\n  }\r\n\r\n  push(hk) {\r\n    super.push(hk);\r\n  }\r\n}\r\n\r\n","export const ClassIdSymbol = Symbol(\"pathux-class-id\");\r\n","//import * as nstructjs from './struct.js';\r\nimport {haveModal, _setModalAreaClass} from '../path-controller/util/simple_events.js';\r\nimport * as util from '../path-controller/util/util.js';\r\n\r\nimport '../path-controller/util/struct.js';\r\n\r\nlet ScreenClass = undefined;\r\n\r\nimport {ClassIdSymbol} from '../core/ui_consts.js';\r\n\r\n\r\nexport function setScreenClass(cls) {\r\n  ScreenClass = cls;\r\n}\r\n\r\nexport function getAreaIntName(name) {\r\n  let hash = 0;\r\n\r\n  for (let i = 0; i < name.length; i++) {\r\n    let c = name.charCodeAt(i);\r\n\r\n    if (i%2 === 0) {\r\n      hash += c<<8;\r\n      hash *= 13;\r\n      hash = hash & ((1<<15) - 1);\r\n    } else {\r\n      hash += c;\r\n    }\r\n  }\r\n\r\n  return hash;\r\n}\r\n\r\n//XXX get rid of me\r\nwindow.getAreaIntName = getAreaIntName;\r\n\r\n//XXX get rid of me\r\nexport var AreaTypes = {\r\n  TEST_CANVAS_EDITOR: 0\r\n};\r\n\r\n  export function setAreaTypes(def) {\r\n  for (let k in AreaTypes) {\r\n    delete AreaTypes[k];\r\n  }\r\n\r\n  for (let k in def) {\r\n    AreaTypes[k] = def[k];\r\n  }\r\n}\r\n\r\nexport let areaclasses = {};\r\n\r\n/*hackish! store ref an active wrangler so simple_event's modal\r\n* system can lock it!*/\r\nlet theWrangler = undefined;\r\n\r\nexport class AreaWrangler {\r\n  constructor() {\r\n    this.stacks = new Map();\r\n    this.lasts = new Map();\r\n    this.lastArea = undefined;\r\n    this.stack = [];\r\n    this.idgen = 0;\r\n    this.locked = 0;\r\n    this._last_screen_id = undefined;\r\n\r\n    theWrangler = this;\r\n  }\r\n\r\n  /*Yeek this is particularly evil, it creates a context\r\n  * that can be used by popups with the original context\r\n  * area stack intact of the elements that spawned them.*/\r\n  makeSafeContext(ctx) {\r\n    let wrangler = this.copy();\r\n    let this2 = this;\r\n\r\n    return new Proxy(ctx, {\r\n      get(target, key, rec) {\r\n        wrangler.copyTo(contextWrangler);\r\n        return target[key];\r\n      }\r\n    });\r\n  }\r\n\r\n  copyTo(ret) {\r\n    for (let [key, stack1] of this.stacks) {\r\n      ret.stack.set(key, util.list(stack1));\r\n    }\r\n\r\n    for (let [key, val] of this.lasts) {\r\n      ret.lasts.set(key, val);\r\n    }\r\n\r\n    ret.stack = util.list(this.stack);\r\n    ret.lastArea = this.lastArea;\r\n  }\r\n\r\n  copy(b) {\r\n    let ret = new AreaWrangler();\r\n    this.copyTo(ret);\r\n    return ret;\r\n  }\r\n\r\n  _checkWrangler(ctx) {\r\n    if (ctx === undefined) {\r\n      return true;\r\n    }\r\n\r\n    if (this._last_screen_id === undefined) {\r\n      this._last_screen_id = ctx.screen._id;\r\n      return true;\r\n    }\r\n\r\n    if (ctx.screen._id !== this._last_screen_id) {\r\n      this.reset();\r\n\r\n      this._last_screen_id = ctx.screen._id;\r\n      console.warn(\"contextWrangler detected a new screen; new file?\");\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  reset() {\r\n    theWrangler = this;\r\n    this.stacks = new Map();\r\n    this.lasts = new Map();\r\n    this.lastArea = undefined;\r\n    this.stack = [];\r\n    this.locked = 0;\r\n    this._last_screen_id = undefined;\r\n\r\n    return this;\r\n  }\r\n\r\n  static findInstance() {\r\n    return theWrangler;\r\n  }\r\n\r\n  static lock() {\r\n    return this.findInstance().lock();\r\n  }\r\n\r\n  static unlock() {\r\n    return this.findInstance().unlock();\r\n  }\r\n\r\n  lock() {\r\n    this.locked++;\r\n    return this;\r\n  }\r\n\r\n  unlock() {\r\n    this.locked = Math.max(this.locked - 1, 0);\r\n    return this;\r\n  }\r\n\r\n  push(type, area, pushLastRef = true) {\r\n    theWrangler = this;\r\n\r\n    if (haveModal() || this.locked) {\r\n      pushLastRef = false;\r\n    }\r\n\r\n    if (pushLastRef || !this.lasts.has(type[ClassIdSymbol])) {\r\n      this.lasts.set(type[ClassIdSymbol], area);\r\n      this.lastArea = area;\r\n    }\r\n\r\n    let stack = this.stacks.get(type[ClassIdSymbol]);\r\n    if (stack === undefined) {\r\n      stack = [];\r\n      this.stacks.set(type[ClassIdSymbol], stack);\r\n    }\r\n\r\n    let last = this.lasts.get(type[ClassIdSymbol]);\r\n\r\n    stack.push(last);\r\n    stack.push(area);\r\n\r\n    this.stack.push(area);\r\n  }\r\n\r\n  updateLastRef(type, area) {\r\n    theWrangler = this;\r\n\r\n    if ((this.locked || haveModal()) && this.lasts.has(type[ClassIdSymbol])) {\r\n      return;\r\n    }\r\n\r\n    this.lasts.set(type[ClassIdSymbol], area);\r\n    this.lastArea = area;\r\n  }\r\n\r\n  pop(type, area) {\r\n    let stack = this.stacks.get(type[ClassIdSymbol]);\r\n\r\n    if (stack === undefined) {\r\n      console.warn(\"pop_ctx_area called in error\");\r\n      //throw new Error(\"pop_ctx_area called in error\");\r\n      return;\r\n    }\r\n\r\n    if (stack.length > 0) {\r\n      stack.pop();\r\n      let last = stack.pop();\r\n\r\n      /* paranoia isConnected check to ensure stale elements don't\r\n       * pollute the lasts stack */\r\n      if (!this.locked && last && last.isConnected) {\r\n        this.lasts.set(type[ClassIdSymbol], last);\r\n      }\r\n    } else {\r\n      console.error(\"pop_ctx_area called in error\");\r\n    }\r\n\r\n    if (this.stack.length > 0) {\r\n      this.stack.pop();\r\n    }\r\n  }\r\n\r\n  getLastArea(type) {\r\n    //if (Math.random() > 0.9995) {\r\n      //console.warn(\"getLastArea!\", type, this.lasts.get(type[ClassIdSymbol]));\r\n    //}\r\n\r\n    if (type === undefined) {\r\n      if (this.stack.length > 0) {\r\n        return this.stack[this.stack.length - 1];\r\n      } else {\r\n        return this.lastArea;\r\n      }\r\n    } else {\r\n      if (this.stacks.has(type[ClassIdSymbol])) {\r\n        let stack = this.stacks.get(type[ClassIdSymbol]);\r\n\r\n        if (stack.length > 0) {\r\n          return stack[stack.length-1];\r\n        }\r\n      }\r\n\r\n      return this.lasts.get(type[ClassIdSymbol]);\r\n    }\r\n  }\r\n}\r\n_setModalAreaClass(AreaWrangler);\r\n\r\nexport let contextWrangler = new AreaWrangler();\r\n","\"use strict\";\r\n\r\n/**\r\n * Assorted geometry utility functions.\r\n *\r\n * This file was originally written in a modified form of ES6 way back in ~2010.\r\n * It was then transpiled to ES5 before being ported later to ES6.\r\n *\r\n * TODO: cleanup this file.\r\n */\r\n\r\nimport * as util from './util.js';\r\nimport * as vectormath from './vectormath.js';\r\n\r\nimport {Vector2, Vector3, Vector4, Matrix4, Quat} from './vectormath.js';\r\n\r\nlet dtvtmps = util.cachering.fromConstructor(Vector3, 32);\r\n\r\n\r\nlet quad_co_rets2 = util.cachering.fromConstructor(Vector2, 512);\r\n\r\nexport function quad_bilinear(v1, v2, v3, v4, u, v) {\r\n  return -((v1 - v2)*u - v1 - (u*v1 - u*v2 + u*v3 - u*v4 - v1 + v4)*v);\r\n}\r\n\r\n/*\r\n\r\n on factor;\r\n off period;\r\n\r\n a1 := v1 + (v2 - v1) * u;\r\n a2 := v4 + (v3 - v4) * u;\r\n bilin := a1 + (a2 - a1) * v;\r\n\r\n v1x := 0;\r\n v1y := 0;\r\n\r\n bx := sub(v1=v1x, v2=v2x, v3=v3x, v4=v4x, bilin);\r\n by := sub(v1=v1y, v2=v2y, v3=v3y, v4=v4y, bilin);\r\n\r\n f1 := bx - x;\r\n f2 := by - y;\r\n\r\n ff := solve({f1, f2}, {u, v});\r\n\r\n */\r\nfunction quad_uv_2d(p, v1, v2, v3, v4) {\r\n  let u, v;\r\n\r\n  let v2x = v2[0] - v1[0];\r\n  let v2y = v2[1] - v1[1];\r\n  let v3x = v3[0] - v1[0];\r\n  let v3y = v3[1] - v1[1];\r\n  let v4x = v4[0] - v1[0];\r\n  let v4y = v4[1] - v1[1];\r\n\r\n  let x = p[0] - v1[0];\r\n  let y = p[1] - v1[1];\r\n  let sqrt = Math.sqrt;\r\n\r\n  let A = 2*(((v4y + y)*x - 2*v4x*y)*\r\n      v3y + (v4x*y - v4y*x)*(v4y + y) - ((v4x - x)*v2y - v3x*y)*(v4y - y))*v2x - 2*(\r\n      (v4x*y - v4y*x)*(v4x + x) - (v4x - x)*v3y*x + ((2*v4y - y)*x - v4x*y)*v3x)*\r\n    v2y + (v4x*y - v4y*x + v3y*x - v3x*y)**2 + (v4x - x)**2*v2y**2 + (v4y - y)**2*\r\n    v2x**2;\r\n\r\n  let B = v4x*y - v4y*x + v3y*x - v3x*y;\r\n\r\n  let C1 = (2*(v3x - v4x)*v2y - 2*(v3y - v4y)*v2x);\r\n  let C2 = (2*(v3x*v4y - v3y*v4x + v2y*v4x) - 2*v2x*v4y);\r\n\r\n  let u1, u2;\r\n\r\n  if (A < 0.0) {\r\n    console.log(\"A was < 0\", A);\r\n    A = -A;\r\n    C1 = C2 = 0.0;\r\n  }\r\n\r\n  if (Math.abs(C1) < 0.00001) { //perfectly 90 degrees?\r\n    let dx = v2x;\r\n    let dy = v2y;\r\n\r\n    console.log(\"C1 bad\");\r\n\r\n    let l = Math.sqrt(dx*dx + dy*dy);\r\n    if (l > 0.000001) {\r\n      dx /= l*l;\r\n      dy /= l*l;\r\n    }\r\n\r\n    u1 = u2 = dx*x + dy*y;\r\n  } else {\r\n    u1 = (-(B + sqrt(A) - (v4y - y)*v2x) - (v4x - x)*v2y)/C1;\r\n    u2 = (-(B - sqrt(A) - (v4y - y)*v2x) - (v4x - x)*v2y)/C1;\r\n  }\r\n\r\n  if (Math.abs(C2) < 0.00001) { //perfectly 90 degrees?\r\n    let dx, dy;\r\n\r\n    dx = v3x - v2x;\r\n    dy = v3y - v2y;\r\n\r\n    console.log(\"C2 bad\");\r\n\r\n    let l = Math.sqrt(dx**2 + dy**2);\r\n    if (l > 0.00001) {\r\n      dx /= l*l;\r\n      dy /= l*l;\r\n    }\r\n\r\n    v1 = v2 = x*dx + y*dy;\r\n  } else {\r\n    v1 = (-(B - sqrt(A) + (v4y + y)*v2x) + (v4x + x)*v2y)/C2;\r\n    v2 = (-(B + sqrt(A) + (v4y + y)*v2x) + (v4x + x)*v2y)/C2;\r\n  }\r\n\r\n  let ret = quad_co_rets2.next();\r\n\r\n  let d1 = (u1 - 0.5)**2 + (v1 - 0.5)**2;\r\n  let d2 = (u2 - 0.5)**2 + (v2 - 0.5)**2;\r\n\r\n  if (d1 < d2) {\r\n    ret[0] = u1;\r\n    ret[1] = v1;\r\n  } else {\r\n    ret[0] = u2;\r\n    ret[1] = v2;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n\r\nexport const ClosestModes = {\r\n  CLOSEST  : 0,\r\n  START    : 1,\r\n  END      : 2,\r\n  ENDPOINTS: 3,\r\n  ALL      : 4\r\n};\r\n\r\nlet advs = util.cachering.fromConstructor(Vector4, 128);\r\n\r\nexport class AbstractCurve {\r\n  evaluate(t) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  derivative(t) {\r\n  }\r\n\r\n  curvature(t) {\r\n\r\n  }\r\n\r\n  normal(t) {\r\n\r\n  }\r\n\r\n  width(t) {\r\n\r\n  }\r\n}\r\n\r\nexport class ClosestCurveRets {\r\n  constructor() {\r\n    this.p = new Vector3();\r\n    this.t = 0;\r\n  }\r\n}\r\n\r\nlet cvrets = util.cachering.fromConstructor(ClosestCurveRets, 2048);\r\nlet cvarrays = new util.ArrayPool();\r\nlet cvtmp = new Array(1024);\r\n\r\nexport function closestPoint(p, curve, mode) {\r\n  let steps = 5;\r\n  let s = 0, ds = 1.0/steps;\r\n\r\n  let ri = 0;\r\n\r\n  for (let i = 0; i < steps; i++, s += ds) {\r\n    let c1 = curve.evaluate(s);\r\n    let c2 = curve.evaluate(s + ds);\r\n\r\n\r\n  }\r\n}\r\n\r\nlet poly_normal_tmps = util.cachering.fromConstructor(Vector3, 64);\r\nlet pncent = new Vector3();\r\n\r\nexport function normal_poly(vs) {\r\n  if (vs.length === 3) {\r\n    return poly_normal_tmps.next().load(normal_tri(vs[0], vs[1], vs[2]));\r\n  } else if (vs.length === 4) {\r\n    return poly_normal_tmps.next().load(normal_quad(vs[0], vs[1], vs[2], vs[3]));\r\n  }\r\n\r\n  if (vs.length === 0) {\r\n    return poly_normal_tmps.next().zero();\r\n  }\r\n\r\n  let cent = pncent.zero();\r\n  let tot = 0;\r\n\r\n  for (let v of vs) {\r\n    cent.add(v);\r\n    tot++;\r\n  }\r\n\r\n  cent.mulScalar(1.0/tot);\r\n  let n = poly_normal_tmps.next().zero();\r\n\r\n  for (let i = 0; i < vs.length; i++) {\r\n    let a = vs[i];\r\n    let b = vs[(i + 1)%vs.length];\r\n    let c = cent;\r\n\r\n    let n2 = normal_tri(a, b, c);\r\n    n.add(n2);\r\n  }\r\n\r\n  n.normalize();\r\n  return n;\r\n}\r\n\r\n/*\r\non factor;\r\noff period;\r\n\r\nf1 := u*v1x + v*v2x + (1.0-u-v)*v3x - px;\r\nf2 := u*v1y + v*v2y + (1.0-u-v)*v3y - py;\r\n\r\nff := solve({f1, f2}, {u, v});\r\n\r\non fort;\r\npart(ff, 1, 1);\r\npart(ff, 1, 2);\r\noff fort;\r\n\r\n*/\r\n\r\nlet barycentric_v2_rets = util.cachering.fromConstructor(Vector2, 2048);\r\nlet calc_proj_refs = new util.cachering(() => [0, 0], 64);\r\n\r\n/*\r\n  a b c d\r\n     b\r\n\r\n  a------c\r\n\r\n     d\r\n\r\n  on factor;\r\n  load_package avector;\r\n\r\n  ax := 0;\r\n  ay := 0;\r\n  az := 0;\r\n\r\n  a := avec(ax, ay, az);\r\n  b := avec(bx, by, bz);\r\n  c := avec(cx, cy, cz);\r\n  d := avec(dx, dy, dz);\r\n\r\n  n1 := d cross c;\r\n  n2 := c cross b;\r\n\r\n  n1 := n1 / (VMOD n1);\r\n  n2 := n2 / (VMOD n2);\r\n\r\n  d := n1 dot n2;\r\n  on fort;\r\n\r\n  d*d;\r\n\r\n  off fort;\r\n\r\n\r\n  */\r\n\r\n/**\r\n\r\n v2\r\n\r\n v1------v3\r\n\r\n v4\r\n\r\n */\r\nexport function dihedral_v3_sqr(v1, v2, v3, v4) {\r\n  let bx = v2[0] - v1[0];\r\n  let by = v2[1] - v1[1];\r\n  let bz = v2[2] - v1[2];\r\n\r\n  let cx = v3[0] - v1[0];\r\n  let cy = v3[1] - v1[1];\r\n  let cz = v3[2] - v1[2];\r\n\r\n  let dx = v4[0] - v1[0];\r\n  let dy = v4[1] - v1[1];\r\n  let dz = v4[2] - v1[2];\r\n\r\n\r\n  return ((bx*cz - bz*cx)*(cx*dz - cz*dx) + (by*cz - bz*cy)*(cy*dz - cz*dy) + (bx*cy - by*cx)*\r\n    (cx*dy - cy*dx))**2/(((bx*cz - bz*cx)**2 + (by*cz - bz*cy)**2\r\n    + (bx*cy - by*cx)**2)*((cx*dz - cz*dx)**2 + (cy*dz - cz*dy)**2 + (cx*dy - cy*dx)**2));\r\n}\r\n\r\nlet tet_area_tmps = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport function tet_volume(a, b, c, d) {\r\n  a = tet_area_tmps.next().load(a);\r\n  b = tet_area_tmps.next().load(b);\r\n  c = tet_area_tmps.next().load(c);\r\n  d = tet_area_tmps.next().load(d);\r\n\r\n  a.sub(d);\r\n  b.sub(d);\r\n  c.sub(d);\r\n\r\n  b.cross(c);\r\n  return a.dot(b)/6.0;\r\n}\r\n\r\nexport function calc_projection_axes(no) {\r\n  let ax = Math.abs(no[0]), ay = Math.abs(no[1]), az = Math.abs(no[2]);\r\n\r\n  let ret = calc_proj_refs.next();\r\n\r\n  if (ax > ay && ax > az) {\r\n    ret[0] = 1;\r\n    ret[1] = 2;\r\n  } else if (ay > az && ay > ax) {\r\n    ret[0] = 0;\r\n    ret[1] = 2;\r\n  } else {\r\n    ret[0] = 0;\r\n    ret[1] = 1;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nlet _avtmps = util.cachering.fromConstructor(Vector3, 128);\r\n\r\nfunction inrect_3d(p, min, max) {\r\n  let ok = p[0] >= min[0] && p[0] <= max[0];\r\n  ok = ok && p[1] >= min[1] && p[1] <= max[1];\r\n  ok = ok && p[2] >= min[2] && p[2] <= max[2];\r\n\r\n  return ok;\r\n}\r\n\r\nexport function aabb_isect_line_3d(v1, v2, min, max) {\r\n  let inside = inrect_3d(v1, min, max);\r\n  inside = inside || inrect_3d(v2, min, max);\r\n\r\n  if (inside) {\r\n    return true;\r\n  }\r\n\r\n  let cent = _avtmps.next().load(min).interp(max, 0.5);\r\n\r\n  let p = closest_point_on_line(cent, v1, v2, true);\r\n  if (!p) {\r\n    return false;\r\n  }\r\n\r\n  p = p[0];\r\n\r\n  return inrect_3d(p, min, max);\r\n}\r\n\r\nexport function aabb_isect_cylinder_3d(v1, v2, radius, min, max) {\r\n  let inside = inrect_3d(v1, min, max);\r\n  inside = inside || inrect_3d(v2, min, max);\r\n\r\n  if (inside) {\r\n    return true;\r\n  }\r\n\r\n  let cent = _avtmps.next().load(min).interp(max, 0.5);\r\n\r\n  let p = closest_point_on_line(cent, v1, v2, true);\r\n  if (!p) {\r\n    return false;\r\n  }\r\n\r\n  p = p[0];\r\n\r\n  let size = _avtmps.next().load(max).sub(min);\r\n\r\n  size.mulScalar(0.5);\r\n  size.addScalar(radius); //*(3**0.5));\r\n\r\n  p.sub(cent).abs();\r\n\r\n  return p[0] <= size[0] && p[1] <= size[1] && p[2] <= size[2];\r\n}\r\n\r\nexport function barycentric_v2(p, v1, v2, v3, axis1 = 0, axis2 = 1, out = undefined) {\r\n  let div = (v2[axis1]*v3[axis2] - v2[axis2]*v3[axis1] + (v2[axis2] - v3[axis2])*v1[axis1] - (v2[axis1] - v3[axis1])*v1[axis2]);\r\n\r\n  if (Math.abs(div) < 0.000001) {\r\n    div = 0.00001;\r\n  }\r\n\r\n  let u = (v2[axis1]*v3[axis2] - v2[axis2]*v3[axis1] + (v2[axis2] - v3[axis2])*p[axis1] - (v2[axis1] - v3[axis1])*p[axis2])/div;\r\n  let v = (-(v1[axis1]*v3[axis2] - v1[axis2]*v3[axis1] + (v1[axis2] - v3[axis2])*p[axis1]) + (v1[axis1] - v3[axis1])*p[axis2])/div;\r\n\r\n  if (!out) {\r\n    out = barycentric_v2_rets.next();\r\n  }\r\n\r\n  out[0] = u;\r\n  out[1] = v;\r\n\r\n  return out;\r\n}\r\n\r\n/*\r\n\r\non factor;\r\n\r\nload_package \"avector\";\r\n\r\npx := 0;\r\npy := 0;\r\npz := 0;\r\n\r\nv1 := avec(v1x, v1y, v1z);\r\nv2 := avec(v2x, v2y, v2z);\r\np := avec(px, py, pz);\r\n\r\nt1 := p - v1;\r\nt2 := v2 - v1;\r\n\r\nl1 := t2 / VMOD t2;\r\n\r\nt := dot(t1, t2);\r\n\r\np2 := v1 + t2*t;\r\n\r\non fort;\r\ndot(p2, p2);\r\noff fort;\r\n\r\n**/\r\n\r\nfunction _linedis2(co, v1, v2) {\r\n  let v1x = v1[0] - co[0];\r\n  let v1y = v1[1] - co[1];\r\n  let v1z = v1[2] - co[2];\r\n\r\n  let v2x = v2[0] - co[0];\r\n  let v2y = v2[1] - co[1];\r\n  let v2z = v2[2] - co[2];\r\n\r\n  let dis = (((v1y - v2y)*v1y + (v1z - v2z)*v1z + (v1x - v2x)*v1x)*(v1y - v2y) - v1y)**2 +\r\n    (((v1y - v2y)*v1y + (v1z - v2z)*v1z + (v1x - v2x)*v1x)*(v1z - v2z) - v1z)**2 +\r\n    (((v1y - v2y)*v1y + (v1z - v2z)*v1z + (v1x - v2x)*v1x)*(v1x - v2x) - v1x)**2;\r\n\r\n  return dis;\r\n}\r\n\r\nlet closest_p_tri_rets = new util.cachering(() => {\r\n  return {\r\n    co  : new Vector3(),\r\n    uv  : new Vector2(),\r\n    dist: 0\r\n  }\r\n}, 512);\r\n\r\nlet cpt_v1 = new Vector3();\r\nlet cpt_v2 = new Vector3();\r\nlet cpt_v3 = new Vector3();\r\nlet cpt_v4 = new Vector3();\r\nlet cpt_v5 = new Vector3();\r\nlet cpt_v6 = new Vector3();\r\nlet cpt_p = new Vector3();\r\nlet cpt_n = new Vector3();\r\nlet cpt_mat = new Matrix4();\r\nlet cpt_mat2 = new Matrix4();\r\nlet cpt_b = new Vector3();\r\n\r\nexport function closest_point_on_quad(p, v1, v2, v3, v4, n, uvw) {\r\n  let a = closest_point_on_tri(p, v1, v2, v3, n, uvw);\r\n  let b = closest_point_on_tri(p, v1, v3, v4, n, uvw);\r\n\r\n  return a.dist <= b.dist ? a : b;\r\n}\r\n\r\nexport function closest_point_on_tri(p, v1, v2, v3, n, uvw) {\r\n  let op = p;\r\n\r\n  if (uvw) {\r\n    uvw[0] = uvw[1] = 0.0;\r\n    if (uvw.length > 2) {\r\n      uvw[2] = 0.0;\r\n    }\r\n  }\r\n\r\n  v1 = cpt_v1.load(v1);\r\n  v2 = cpt_v2.load(v2);\r\n  v3 = cpt_v3.load(v3);\r\n  p = cpt_p.load(p);\r\n\r\n  if (n === undefined) {\r\n    n = cpt_n.load(normal_tri(v1, v2, v3));\r\n  }\r\n\r\n  v1.sub(p);\r\n  v2.sub(p);\r\n  v3.sub(p);\r\n  p.zero();\r\n\r\n\r\n  /*use least squares to solve for barycentric coordinates\r\n    then clip to triangle\r\n\r\n    we do this in 2d, as all solutions are coplanar anyway and that way we\r\n    can have one of the equations be \"u+v+w = 1\".\r\n    should investigate if this is really necassary.\r\n   */\r\n\r\n  let ax1, ax2;\r\n  let ax = Math.abs(n[0]), ay = Math.abs(n[1]), az = Math.abs(n[2]);\r\n  if (ax === 0.0 && ay === 0.0 && az === 0.0) {\r\n    console.log(\"eek1\", n, v1, v2, v3);\r\n    let ret = closest_p_tri_rets.next();\r\n\r\n    ret.dist = 1e17;\r\n    ret.co.zero();\r\n    ret.uv.zero();\r\n\r\n    return ret;\r\n  }\r\n\r\n  let ax3;\r\n  if (ax >= ay && ax >= az) {\r\n    ax1 = 1;\r\n    ax2 = 2;\r\n    ax3 = 0;\r\n  } else if (ay >= ax && ay >= az) {\r\n    ax1 = 0;\r\n    ax2 = 2;\r\n    ax3 = 1;\r\n  } else {\r\n    ax1 = 0;\r\n    ax2 = 1;\r\n    ax3 = 2;\r\n  }\r\n\r\n  let mat = cpt_mat;\r\n  let mat2 = cpt_mat2;\r\n  mat.makeIdentity();\r\n\r\n  let m = mat.$matrix;\r\n\r\n  m.m11 = v1[ax1];\r\n  m.m12 = v2[ax1];\r\n  m.m13 = v3[ax1];\r\n  m.m14 = 0.0;\r\n\r\n  m.m21 = v1[ax2];\r\n  m.m22 = v2[ax2];\r\n  m.m23 = v3[ax2];\r\n  m.m24 = 0.0;\r\n\r\n  /*\r\n  m.m31 = v1[ax3];\r\n  m.m32 = v2[ax3];\r\n  m.m33 = v3[ax3];\r\n  m.m34 = 0.0;\r\n  */\r\n\r\n  m.m31 = 1;\r\n  m.m32 = 1;\r\n  m.m33 = 1;\r\n  m.m34 = 0.0;\r\n\r\n  mat.transpose();\r\n\r\n  let b = cpt_b.zero();\r\n\r\n  b[0] = p[ax1];\r\n  b[1] = p[ax2];\r\n  //b[2] = p[ax3];\r\n  b[2] = 1.0;\r\n  b[3] = 0.0;\r\n\r\n  mat2.load(mat).transpose();\r\n\r\n  mat.preMultiply(mat2);\r\n\r\n  if (mat.invert() === null) {\r\n    console.log(\"eek2\", mat.determinant(), ax1, ax2, n);\r\n    let ret = closest_p_tri_rets.next();\r\n\r\n    ret.dist = 1e17;\r\n    ret.co.zero();\r\n    ret.uv.zero();\r\n\r\n    return ret;\r\n  }\r\n\r\n  mat.multiply(mat2);\r\n\r\n\r\n  b.multVecMatrix(mat);\r\n\r\n  let u = b[0];\r\n  let v = b[1];\r\n  let w = b[2];\r\n\r\n  for (let i = 0; i < 1; i++) {\r\n    u = Math.min(Math.max(u, 0.0), 1.0);\r\n    v = Math.min(Math.max(v, 0.0), 1.0);\r\n    w = Math.min(Math.max(w, 0.0), 1.0);\r\n\r\n    let tot = u + v + w;\r\n\r\n    if (tot !== 0.0) {\r\n      tot = 1.0/tot;\r\n      u *= tot;\r\n      v *= tot;\r\n      w *= tot;\r\n    }\r\n  }\r\n\r\n  if (uvw) {\r\n    uvw[0] = u;\r\n    uvw[1] = v;\r\n    if (uvw.length > 2) {\r\n      uvw[2] = w;\r\n    }\r\n  }\r\n\r\n  let x = v1[0]*u + v2[0]*v + v3[0]*w;\r\n  let y = v1[1]*u + v2[1]*v + v3[1]*w;\r\n  let z = v1[2]*u + v2[2]*v + v3[2]*w;\r\n\r\n  let ret = closest_p_tri_rets.next();\r\n\r\n  ret.co.loadXYZ(x, y, z);\r\n  ret.uv[0] = u;\r\n  ret.uv[1] = v;\r\n\r\n  ret.dist = ret.co.vectorLength();\r\n  ret.co.add(op);\r\n\r\n  return ret;\r\n}\r\n\r\nexport function dist_to_tri_v3_old(co, v1, v2, v3, no = undefined) {\r\n  if (!no) {\r\n    no = dtvtmps.next().load(normal_tri(v1, v2, v3));\r\n  }\r\n\r\n  let p = dtvtmps.next().load(co);\r\n  p.sub(v1);\r\n\r\n  let planedis = -p.dot(no);\r\n\r\n  let [axis, axis2] = calc_projection_axes(no);\r\n\r\n  let p1 = dtvtmps.next();\r\n  let p2 = dtvtmps.next();\r\n  let p3 = dtvtmps.next();\r\n\r\n  p1[0] = v1[axis];\r\n  p1[1] = v1[axis2];\r\n  p1[2] = 0.0;\r\n\r\n  p2[0] = v2[axis];\r\n  p2[1] = v2[axis2];\r\n  p2[2] = 0.0;\r\n\r\n  p3[0] = v3[axis];\r\n  p3[1] = v3[axis2];\r\n  p3[2] = 0.0;\r\n\r\n  let pp = dtvtmps.next();\r\n  pp[0] = co[axis];\r\n  pp[1] = co[axis2];\r\n  pp[2] = 0.0;\r\n\r\n  let dis = 1e17;\r\n\r\n  function linedis2d(a, b, c) {\r\n    let dx1 = a[0] - b[0];\r\n    let dy1 = a[1] - b[1];\r\n    let dx2 = c[0] - b[0];\r\n    let dy2 = c[1] - b[1];\r\n\r\n    let len = dx2*dx2 + dy2*dy2;\r\n    len = len > 0.000001 ? 1.0/len : 0.0;\r\n\r\n    dx2 *= len;\r\n    dy2 *= len;\r\n\r\n    return Math.abs(dx1*dy2 - dx2*dy1);\r\n  }\r\n\r\n  let tmp = dtvtmps.next();\r\n  let tmp2 = dtvtmps.next();\r\n\r\n  function linedis3d(a, b, c) {\r\n    tmp.load(a).sub(b);\r\n    tmp2.load(c).sub(b).normalize();\r\n\r\n    let t = tmp.dot(tmp2);\r\n    t = Math.min(Math.max(t, 0.0), b.vectorDistance(c));\r\n\r\n    tmp2.mulScalar(t).add(b);\r\n\r\n    return tmp2.vectorDistance(a);\r\n  }\r\n\r\n\r\n  /* are we above the triangle? if so use plane distance */\r\n  if (point_in_tri(pp, p1, p2, p3)) {\r\n    return Math.abs(planedis);\r\n  }\r\n\r\n  /* get distance to the closest edge */\r\n  dis = Math.min(dis, linedis3d(co, v1, v2));\r\n  dis = Math.min(dis, linedis3d(co, v2, v3));\r\n  dis = Math.min(dis, linedis3d(co, v3, v1));\r\n\r\n  if (0) {\r\n    let uv = barycentric_v2(pp, p1, p2, p3);\r\n\r\n    let w = 1.0 - uv[0] - uv[1];\r\n    uv[0] = Math.min(Math.max(uv[0], 0.0), 1.0);\r\n    uv[1] = Math.min(Math.max(uv[1], 0.0), 1.0);\r\n    w = Math.min(Math.max(w, 0.0), 1.0);\r\n\r\n    let sum = (uv[0] + uv[1] + w);\r\n    sum = sum !== 0.0 ? 1.0/sum : 0.0;\r\n\r\n    w *= sum;\r\n    uv[0] *= sum;\r\n    uv[1] *= sum;\r\n\r\n    pp.zero();\r\n\r\n    pp.addFac(v1, uv[0]);\r\n    pp.addFac(v2, uv[1]);\r\n    pp.addFac(v3, 1.0 - uv[0] - uv[1]);\r\n\r\n    dis = Math.min(dis, pp.vectorDistance(co));\r\n  }\r\n\r\n  return dis;\r\n}\r\n\r\n\r\nexport function dist_to_tri_v3(p, v1, v2, v3, n) {\r\n  return dist_to_tri_v3_old(p, v1, v2, v3, n);\r\n  //return Math.sqrt(Math.abs(dist_to_tri_v3_sqr(p, v1, v2, v3, n)));\r\n}\r\n\r\n\r\n/* reduce script\r\n\r\non factor;\r\n\r\nax := 0;\r\nay := 0;\r\n\r\ne1x := bx - ax;\r\ne1y := by - ay;\r\ne2x := cx - bx;\r\ne2y := cy - by;\r\ne3x := ax - cx;\r\ne3y := ay - cy;\r\n\r\nl1 := (e1x**2 + e1y**2)**0.5;\r\nl2 := (e2x**2 + e2y**2)**0.5;\r\nl3 := (e3x**2 + e3y**2)**0.5;\r\n\r\nload_package \"avector\";\r\n\r\ne1 := avec(e1x / l1, e1y / l1, 0.0);\r\ne2 := avec(e2x / l2, e2y / l2, 0.0);\r\ne3 := avec(e3x / l3, e3y / l3, 0.0);\r\n\r\nd1 := x1*e1[1] - y1*e1[0];\r\nd2 := x1*e2[1] - y1*e2[0];\r\nd3 := x1*e3[1] - y1*e3[0];\r\n\r\nd1 := d1**2;\r\nd2 := d2**2;\r\nd3 := d3**2;\r\n\r\non fort;\r\nd1;\r\nd2;\r\nd3;\r\noff fort;\r\n\r\n*/\r\n\r\nlet _dt3s_n = new Vector3();\r\n\r\nexport function dist_to_tri_v3_sqr(p, v1, v2, v3, n) {\r\n  if (n === undefined) {\r\n    n = _dt3s_n;\r\n    n.load(normal_tri(v1, v2, v3));\r\n  }\r\n\r\n  // find projection axis;\r\n  let axis1, axis2, axis3;\r\n  let nx = n[0] < 0.0 ? -n[0] : n[0];\r\n  let ny = n[1] < 0.0 ? -n[1] : n[1];\r\n  let nz = n[2] < 0.0 ? -n[2] : n[2];\r\n\r\n  const feps = 0.0000001;\r\n\r\n  if (nx > ny && nx > nz) {\r\n    axis1 = 1;\r\n    axis2 = 2;\r\n    axis3 = 0;\r\n  } else if (ny > nx && ny > nz) {\r\n    axis1 = 0;\r\n    axis2 = 2;\r\n    axis3 = 1;\r\n  } else {\r\n    axis1 = 0;\r\n    axis2 = 1;\r\n    axis3 = 2;\r\n  }\r\n\r\n  //n.load(normal_tri(v1, v2, v3));\r\n\r\n  let planedis = (p[0] - v1[0])*n[0] + (p[1] - v1[1])*n[1] + (p[2] - v1[2])*n[2];\r\n  planedis = planedis < 0.0 ? -planedis : planedis;\r\n\r\n  let ax = v1[axis1], ay = v1[axis2], az = v1[axis3];\r\n\r\n  let bx = v2[axis1] - ax, by = v2[axis2] - ay, bz = v2[axis3] - az;\r\n  let cx = v3[axis1] - ax, cy = v3[axis2] - ay, cz = v3[axis3] - az;\r\n\r\n  let bx2 = bx*bx, by2 = by*by, bz2 = bz*bz, cx2 = cx*cx, cy2 = cy*cy, cz2 = cz*cz;\r\n\r\n  let x1 = p[axis1] - ax;\r\n  let y1 = p[axis2] - ay;\r\n  let z1 = p[axis3] - az;\r\n\r\n  const testf = 0.0;\r\n\r\n  let l1 = Math.sqrt(bx**2 + by**2);\r\n  let l2 = Math.sqrt((cx - bx)**2 + (cy - by)**2);\r\n  let l3 = Math.sqrt(cx**2 + cy**2);\r\n\r\n  let s1 = x1*by - y1*bx < testf;\r\n  let s2 = (x1 - bx)*(cy - by) - (y1 - by)*(cx - bx) < testf;\r\n  let s3 = (x1* -cy + y1*cx) < testf;\r\n\r\n  /*\r\n    (x1-cx)*-cy - (y1-cy)*-cx\r\n   reduces to:\r\n     x1*-cy + y1*cx;\r\n   */\r\n\r\n  //console.log(axis1, axis2, axis3, n);\r\n  //console.log(s1, s2, s3);\r\n  //console.log(bx, by, cx, cy);\r\n\r\n  if (1 && n[axis3] < 0.0) {\r\n    s1 = !s1;\r\n    s2 = !s2;\r\n    s3 = !s3;\r\n    /*\r\n        bx = v3[axis1];\r\n        by = v3[axis2];\r\n        bz = v3[axis3];\r\n\r\n        cx = v2[axis1];\r\n        cy = v2[axis2];\r\n        cz = v2[axis3];\r\n\r\n        bx2 = bx*bx;\r\n        by2 = by*by;\r\n        bz2 = bz*bz;\r\n\r\n        cx2 = cx*cx;\r\n        cy2 = cy*cy;\r\n        cz2 = cz*cz;*/\r\n  }\r\n\r\n  let mask = (s1 & 1) | (s2<<1) | (s3<<2);\r\n  if (mask === 0 || mask === 7) {\r\n    return planedis*planedis;\r\n  }\r\n\r\n  let d1, d2, d3, div;\r\n\r\n\r\n  /*\r\n//\\  3|\r\n//  \\ |\r\n//    b\r\n//    | \\\r\n//  1 |   \\  2\r\n//    |  0  \\\r\n// ___a_______c___\r\n//  5 |   4      \\ 6\r\n*/\r\n\r\n  let dis = 0.0;\r\n  let lx, ly, lz;\r\n\r\n  lx = bx;\r\n  ly = by;\r\n  lz = bz;\r\n\r\n  nx = n[axis1];\r\n  ny = n[axis2];\r\n  nz = n[axis3];\r\n\r\n  switch (mask) {\r\n    case 1:\r\n      div = (bx2 + by2);\r\n\r\n      if (div > feps) {\r\n        d1 = (bx*y1 - by*x1);\r\n        d1 = (d1*d1)/div;\r\n\r\n        lx = -by;\r\n        ly = bx;\r\n        lz = bz;\r\n      } else {\r\n        d1 = x1*x1 + y1*y1;\r\n\r\n        lx = x1;\r\n        ly = y1;\r\n        lz = z1;\r\n      }\r\n\r\n      dis = d1;\r\n      break;\r\n    case 3:\r\n      lx = x1 - bx;\r\n      ly = y1 - by;\r\n      lz = z1 - bz;\r\n\r\n      dis = lx*lx + ly*ly;\r\n      return lx*lx + ly*ly + lz*lz;\r\n    case 2:\r\n      div = (bx - cx)**2 + (by - cy)**2;\r\n\r\n      if (div > feps) {\r\n        d2 = ((bx - cx)*y1 - (by - cy)*x1);\r\n        d2 = d2/div;\r\n\r\n        lx = (by - cy);\r\n        ly = (cx - bx);\r\n        lz = cz - bz;\r\n      } else {\r\n        d2 = (x1 - bx)*(x1 - bx) + (y1 - by)*(y1 - by);\r\n\r\n        lx = x1 - bx;\r\n        ly = y1 - by;\r\n        lz = z1 - bz;\r\n      }\r\n\r\n      dis = d2;\r\n      break;\r\n    case 6:\r\n      lx = x1 - cx;\r\n      ly = y1 - cy;\r\n      lz = z1 - cz;\r\n\r\n      return lx*lx + ly*ly + lz*lz;\r\n    case 4:\r\n      div = (cx2 + cy2);\r\n\r\n      if (div > feps) {\r\n        d3 = (cx*y1 - cy*x1);\r\n        d3 = (d3*d3)/div;\r\n\r\n        lx = cy;\r\n        ly = -cx;\r\n        lz = cz;\r\n      } else {\r\n        d3 = (x1 - cx)*(x1 - cx) + (y1 - cy)*(y1 - cy);\r\n\r\n        lx = x1 - cx;\r\n        ly = y1 - cy;\r\n        lz = z1 - cz;\r\n      }\r\n\r\n      dis = d3;\r\n      break;\r\n    case 5:\r\n      lx = x1;\r\n      ly = y1;\r\n      lz = z1;\r\n\r\n      return lx*lx + ly*ly + lz*lz;\r\n  }\r\n\r\n  //lx = p[axis1] - v1[axis1];\r\n  //ly = p[axis2] - v1[axis2];\r\n  {\r\n    let d = lx*nx + ly*ny + lz*nz;\r\n\r\n    d = -d;\r\n\r\n    lx += nx*d;\r\n    ly += ny*d;\r\n    lz += nz*d;\r\n\r\n    //dis = lx*lx + ly*ly;\r\n\r\n    if (0 && Math.random() > 0.999) {\r\n      console.log(\"d\", d.toFixed(6));\r\n      console.log(lx*nx + ly*ny + lz*nz);\r\n    }\r\n  }\r\n\r\n  let mul = ((lx**2 + ly**2)*nz**2 + (lx*nx + ly*ny)**2)/((lx**2 + ly**2)*nz**2);\r\n  //let mul = ((lx**2+ly**2)*nz**2+(lx*nx+ly*ny)**2)/((ly**2+lz**2+lx**2)*nz**2);\r\n\r\n  //mul = 1.0 / nz;\r\n  //mul *= mul;\r\n\r\n  if (Math.random() > 0.999) {\r\n    console.log(mul.toFixed(4));\r\n  }\r\n\r\n  //mul = 1.0;\r\n\r\n  if (0) {\r\n    let odis = dis;\r\n\r\n    dis = x1**2 + y1**2 + z1**2;\r\n\r\n    if (Math.random() > 0.999) {\r\n      console.log((dis/odis).toFixed(4), mul.toFixed(4));\r\n    }\r\n    mul = 1.0;\r\n  }\r\n\r\n  /*\r\n  on factor;\r\n\r\n  dx := sqrt(dis)*(lx / sqrt(lx**2 + ly**2));\r\n  dy := sqrt(dis)*(ly / sqrt(lx**2 + ly**2));\r\n  f2 := dx*nx + dy*ny + dz*nz;\r\n\r\n  fz := solve(f2, dz);\r\n  fz := part(fz, 1, 2);\r\n\r\n  dis2 := dx*dx + dy*dy + fz*fz;\r\n  fmul := dis2/dis;\r\n\r\n  on fort;\r\n  fmul;\r\n  off fort;\r\n\r\n\r\n  */\r\n\r\n  return dis*mul + planedis*planedis;\r\n}\r\n\r\nlet tri_area_temps = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport function tri_area(v1, v2, v3) {\r\n  let l1 = v1.vectorDistance(v2);\r\n  let l2 = v2.vectorDistance(v3);\r\n  let l3 = v3.vectorDistance(v1);\r\n\r\n  let s = (l1 + l2 + l3)/2.0;\r\n  s = s*(s - l1)*(s - l2)*(s - l3);\r\n  s = Math.max(s, 0); /* Numerical error can dip into negative numbers. */\r\n  return Math.sqrt(s);\r\n}\r\n\r\nexport function aabb_overlap_area(pos1, size1, pos2, size2) {\r\n  let r1 = 0.0, r2 = 0.0;\r\n\r\n  for (let i = 0; i < 2; i++) {\r\n    let a1 = pos1[i], a2 = pos2[i];\r\n    let b1 = pos1[i] + size1[i];\r\n    let b2 = pos2[i] + size2[i];\r\n\r\n    if (b1 >= a2 && b2 >= a1) {\r\n      let r = Math.abs(a2 - b1);\r\n      r = Math.min(r, Math.abs(a1 - b2));\r\n\r\n      if (i) {\r\n        r2 = r;\r\n      } else {\r\n        r1 = r;\r\n      }\r\n    }\r\n  }\r\n\r\n  return r1*r2;\r\n}\r\n\r\n/**\r\n * Returns true if two aabbs intersect\r\n * @param {*} pos1\r\n * @param {*} size1\r\n * @param {*} pos2\r\n * @param {*} size2\r\n */\r\n\r\nexport function aabb_isect_2d(pos1, size1, pos2, size2) {\r\n  let ret = 0;\r\n  for (let i = 0; i < 2; i++) {\r\n    let a = pos1[i];\r\n    let b = pos1[i] + size1[i];\r\n    let c = pos2[i];\r\n    let d = pos2[i] + size2[i];\r\n    if (b >= c && a <= d)\r\n      ret += 1;\r\n  }\r\n  return ret === 2;\r\n};\r\n\r\n\r\nexport function aabb_isect_3d(pos1, size1, pos2, size2) {\r\n  let ret = 0;\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    let a = pos1[i];\r\n    let b = pos1[i] + size1[i];\r\n\r\n    let c = pos2[i];\r\n    let d = pos2[i] + size2[i];\r\n\r\n    if (b >= c && a <= d)\r\n      ret += 1;\r\n  }\r\n  return ret === 3;\r\n}\r\n\r\n\r\nlet aabb_intersect_vs = util.cachering.fromConstructor(Vector2, 32);\r\nlet aabb_intersect_rets = new util.cachering(() => {\r\n  return {\r\n    pos : new Vector2(),\r\n    size: new Vector2()\r\n  }\r\n}, 512);\r\n\r\n/**\r\n * Returns aabb that's the intersection of two aabbs\r\n * @param {*} pos1\r\n * @param {*} size1\r\n * @param {*} pos2\r\n * @param {*} size2\r\n */\r\nexport function aabb_intersect_2d(pos1, size1, pos2, size2) {\r\n  let v1 = aabb_intersect_vs.next().load(pos1);\r\n  let v2 = aabb_intersect_vs.next().load(pos1).add(size1);\r\n  let v3 = aabb_intersect_vs.next().load(pos2);\r\n  let v4 = aabb_intersect_vs.next().load(pos2).add(size2);\r\n\r\n  let min = aabb_intersect_vs.next().zero();\r\n  let max = aabb_intersect_vs.next().zero();\r\n\r\n  let tot = 0;\r\n\r\n  for (let i = 0; i < 2; i++) {\r\n    if (v2[i] >= v3[i] && v1[i] <= v4[i]) {\r\n      tot++;\r\n\r\n      min[i] = Math.max(v3[i], v1[i]);\r\n      max[i] = Math.min(v2[i], v4[i]);\r\n    }\r\n  }\r\n\r\n  if (tot !== 2) {\r\n    return undefined;\r\n  }\r\n\r\n  let ret = aabb_intersect_rets.next();\r\n  ret.pos.load(min);\r\n  ret.size.load(max).sub(min);\r\n\r\n  return ret;\r\n}\r\n\r\nwindow.test_aabb_intersect_2d = function () {\r\n  let canvas = document.getElementById(\"test_canvas\");\r\n\r\n  if (!canvas) {\r\n    canvas = document.createElement(\"canvas\");\r\n    canvas.setAttribute(\"id\", \"test_canvas\");\r\n    canvas.g = canvas.getContext(\"2d\");\r\n\r\n    document.body.appendChild(canvas);\r\n  }\r\n\r\n  canvas.width = ~~(window.innerWidth*devicePixelRatio);\r\n  canvas.height = ~~(window.innerHeight*devicePixelRatio);\r\n  canvas.style.width = (canvas.width/devicePixelRatio) + \"px\";\r\n  canvas.style.height = (canvas.height/devicePixelRatio) + \"px\";\r\n  canvas.style.position = \"absolute\";\r\n  canvas.style[\"z-index\"] = \"1000\";\r\n\r\n  let g = canvas.g;\r\n  g.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n  let sz = 800;\r\n  let a1 = new Vector2([Math.random()*sz, Math.random()*sz]).floor();\r\n  let a2 = new Vector2([Math.random()*sz, Math.random()*sz]).floor();\r\n  let b1 = new Vector2([Math.random()*sz, Math.random()*sz]).floor();\r\n  let b2 = new Vector2([Math.random()*sz, Math.random()*sz]).floor();\r\n\r\n  let p1 = new Vector2();\r\n  let s1 = new Vector2();\r\n  let p2 = new Vector2();\r\n  let s2 = new Vector2();\r\n\r\n  p1.load(a1).min(a2);\r\n  s1.load(a1).max(a2);\r\n  p2.load(b1).min(b2);\r\n  s2.load(b1).max(b2);\r\n\r\n  s1.sub(p1);\r\n  s2.sub(p1);\r\n\r\n  console.log(p1, s1);\r\n  console.log(p2, s2);\r\n\r\n  g.beginPath();\r\n  g.rect(0, 0, canvas.width, canvas.height);\r\n  g.fillStyle = \"white\";\r\n  g.fill();\r\n\r\n  g.beginPath();\r\n  g.rect(p1[0], p1[1], s1[0], s1[1]);\r\n  g.fillStyle = \"rgba(255, 100, 75, 1.0)\";\r\n  g.fill();\r\n\r\n  g.beginPath();\r\n  g.rect(p2[0], p2[1], s2[0], s2[1]);\r\n  g.fillStyle = \"rgba(75, 100, 255, 1.0)\";\r\n  g.fill();\r\n\r\n  let ret = aabb_intersect_2d(p1, s1, p2, s2);\r\n\r\n  if (ret) {\r\n\r\n    g.beginPath();\r\n    g.rect(ret.pos[0], ret.pos[1], ret.size[0], ret.size[1]);\r\n    g.fillStyle = \"rgba(0, 0, 0, 1.0)\";\r\n    g.fill();\r\n  }\r\n\r\n  /*\r\n  window.setTimeout(() => {\r\n    canvas.remove();\r\n  }, 2000);\r\n  //*/\r\n\r\n  return {\r\n    end  : test_aabb_intersect_2d.end,\r\n    timer: test_aabb_intersect_2d.timer\r\n  };\r\n}\r\n\r\ntest_aabb_intersect_2d.stop = function stop() {\r\n  if (test_aabb_intersect_2d._timer) {\r\n    console.log(\"stopping timer\");\r\n\r\n    window.clearInterval(test_aabb_intersect_2d._timer);\r\n    test_aabb_intersect_2d._timer = undefined;\r\n  }\r\n}\r\n\r\ntest_aabb_intersect_2d.end = function end() {\r\n  test_aabb_intersect_2d.stop();\r\n\r\n  let canvas = document.getElementById(\"test_canvas\");\r\n  if (canvas) {\r\n    canvas.remove();\r\n  }\r\n}\r\ntest_aabb_intersect_2d.timer = function timer(rate = 500) {\r\n  if (test_aabb_intersect_2d._timer) {\r\n    window.clearInterval(test_aabb_intersect_2d._timer);\r\n    test_aabb_intersect_2d._timer = undefined;\r\n    console.log(\"stopping timer\");\r\n    return;\r\n  }\r\n\r\n  console.log(\"starting timer\");\r\n\r\n  test_aabb_intersect_2d._timer = window.setInterval(() => {\r\n    test_aabb_intersect_2d();\r\n  }, rate);\r\n};\r\n\r\nlet aabb_intersect_vs3 = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport function aabb_intersect_3d(min1, max1, min2, max2) {\r\n  let tot = 0;\r\n\r\n  for (let i = 0; i < 2; i++) {\r\n    if (max1[i] >= min2[i] && min1[i] <= max2[i]) {\r\n      tot++;\r\n    }\r\n  }\r\n\r\n  if (tot !== 3) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n/**\r\n * AABB union of a and b.\r\n * Result is in a.\r\n *\r\n * @param a List of two vectors\r\n * @param b List of two vectors\r\n * @returns a\r\n */\r\nexport function aabb_union(a, b) {\r\n  for (let i = 0; i < 2; i++) {\r\n    for (let j = 0; j < a[i].length; j++) {\r\n      a[i][j] = i ? Math.max(a[i][j], b[i][j]) : Math.min(a[i][j], b[i][j]);\r\n    }\r\n  }\r\n\r\n  return a;\r\n}\r\n\r\nexport function aabb_union_2d(pos1, size1, pos2, size2) {\r\n  let v1 = aabb_intersect_vs.next();\r\n  let v2 = aabb_intersect_vs.next();\r\n  let min = aabb_intersect_vs.next();\r\n  let max = aabb_intersect_vs.next();\r\n  v1.load(pos1).add(size1);\r\n  v2.load(pos2).add(size2);\r\n\r\n  min.load(v1).min(v2);\r\n  max.load(v1).max(v2);\r\n\r\n  max.sub(min);\r\n  let ret = aabb_intersect_rets.next();\r\n\r\n  ret.pos.load(min);\r\n  ret.pos.load(max);\r\n\r\n  return ret;\r\n}\r\n\r\n//XXX refactor to use es6 classes,\r\n//    or at last the class system in typesystem.js\r\nfunction init_prototype(cls, proto) {\r\n  for (let k in proto) {\r\n    cls.prototype[k] = proto[k];\r\n  }\r\n\r\n  return cls.prototype;\r\n}\r\n\r\nfunction inherit(cls, parent, proto) {\r\n  cls.prototype = Object.create(parent.prototype);\r\n\r\n  for (let k in proto) {\r\n    cls.prototype[k] = proto[k];\r\n  }\r\n\r\n  return cls.prototype;\r\n}\r\n\r\nlet set = util.set;\r\n\r\n//everything below here was compiled from es6 code  \r\n//variables starting with $ are function static local vars,\r\n//like in C.  don't use them outside their owning functions.\r\n//\r\n//except for $_mh and $_swapt.  they were used with a C macro\r\n//preprocessor.\r\nlet $_mh, $_swapt;\r\n\r\n//XXX destroy me\r\nexport const feps = 2.22e-16;\r\n\r\nexport const COLINEAR = 1;\r\nexport const LINECROSS = 2;\r\nexport const COLINEAR_ISECT = 3;\r\n\r\nlet _cross_vec1 = new Vector3();\r\nlet _cross_vec2 = new Vector3();\r\n\r\nexport const SQRT2 = Math.sqrt(2.0);\r\nexport const FEPS_DATA = {\r\n  F16: 1.11e-16,\r\n  F32: 5.96e-08,\r\n  F64: 4.88e-04\r\n};\r\n\r\n/*use 32 bit epsilon by default, since we're often working from\r\n  32-bit float data.  note that javascript uses 64-bit doubles \r\n  internally.*/\r\nexport const FEPS = FEPS_DATA.F32;\r\nexport const FLOAT_MIN = -1e+21;\r\nexport const FLOAT_MAX = 1e+22;\r\nexport const Matrix4UI = Matrix4;\r\n\r\n/*\r\nThis must be truly ancient code, possibly from\r\nallshape days.\r\n\r\nif (FLOAT_MIN != FLOAT_MIN || FLOAT_MAX != FLOAT_MAX) {\r\n  FLOAT_MIN = 1e-05;\r\n  FLOAT_MAX = 1000000.0;\r\n  console.log(\"Floating-point 16-bit system detected!\");\r\n}\r\n*/\r\n\r\nlet _static_grp_points4 = new Array(4);\r\nlet _static_grp_points8 = new Array(8);\r\n\r\nexport function get_rect_points(p, size) {\r\n  let cs;\r\n  if (p.length === 2) {\r\n    cs = _static_grp_points4;\r\n    cs[0] = p;\r\n    cs[1] = [p[0] + size[0], p[1]];\r\n    cs[2] = [p[0] + size[0], p[1] + size[1]];\r\n    cs[3] = [p[0], p[1] + size[1]];\r\n  } else if (p.length === 3) {\r\n    cs = _static_grp_points8;\r\n    cs[0] = p;\r\n    cs[1] = [p[0] + size[0], p[1], p[2]];\r\n    cs[2] = [p[0] + size[0], p[1] + size[1], p[2]];\r\n    cs[3] = [p[0], p[1] + size[0], p[2]];\r\n    cs[4] = [p[0], p[1], p[2] + size[2]];\r\n    cs[5] = [p[0] + size[0], p[1], p[2] + size[2]];\r\n    cs[6] = [p[0] + size[0], p[1] + size[1], p[2] + size[2]];\r\n    cs[7] = [p[0], p[1] + size[0], p[2] + size[2]];\r\n  } else {\r\n    throw \"get_rect_points has no implementation for \" + p.length + \"-dimensional data\";\r\n  }\r\n  return cs;\r\n};\r\n\r\nexport function get_rect_lines(p, size) {\r\n  let ps = get_rect_points(p, size);\r\n  if (p.length === 2) {\r\n    return [[ps[0], ps[1]], [ps[1], ps[2]], [ps[2], ps[3]], [ps[3], ps[0]]];\r\n  } else if (p.length === 3) {\r\n    let l1 = [[ps[0], ps[1]], [ps[1], ps[2]], [ps[2], ps[3]], [ps[3], ps[0]]];\r\n    let l2 = [[ps[4], ps[5]], [ps[5], ps[6]], [ps[6], ps[7]], [ps[7], ps[4]]];\r\n    l1.concat(l2);\r\n    l1.push([ps[0], ps[4]]);\r\n    l1.push([ps[1], ps[5]]);\r\n    l1.push([ps[2], ps[6]]);\r\n    l1.push([ps[3], ps[7]]);\r\n    return l1;\r\n  } else {\r\n    throw \"get_rect_points has no implementation for \" + p.length + \"-dimensional data\";\r\n  }\r\n};\r\n\r\nlet $vs_simple_tri_aabb_isect = [0, 0, 0];\r\n\r\nexport function simple_tri_aabb_isect(v1, v2, v3, min, max) {\r\n  $vs_simple_tri_aabb_isect[0] = v1;\r\n  $vs_simple_tri_aabb_isect[1] = v2;\r\n  $vs_simple_tri_aabb_isect[2] = v3;\r\n  for (let i = 0; i < 3; i++) {\r\n    let isect = true;\r\n    for (let j = 0; j < 3; j++) {\r\n      if ($vs_simple_tri_aabb_isect[j][i] < min[i] || $vs_simple_tri_aabb_isect[j][i] >= max[i])\r\n        isect = false;\r\n    }\r\n    if (isect)\r\n      return true;\r\n  }\r\n  return false;\r\n};\r\n\r\nexport class MinMax {\r\n  constructor(totaxis) {\r\n    if (totaxis === undefined) {\r\n      totaxis = 1;\r\n    }\r\n    this.totaxis = totaxis;\r\n    if (totaxis !== 1) {\r\n      let cls;\r\n\r\n      switch (totaxis) {\r\n        case 2:\r\n          cls = Vector2;\r\n          break;\r\n        case 3:\r\n          cls = Vector3;\r\n          break;\r\n        case 4:\r\n          cls = Vector4;\r\n          break;\r\n        default:\r\n          cls = Array;\r\n          break;\r\n      }\r\n\r\n      this._min = new cls(totaxis);\r\n      this._max = new cls(totaxis);\r\n      this.min = new cls(totaxis);\r\n      this.max = new cls(totaxis);\r\n    } else {\r\n      this.min = this.max = 0;\r\n      this._min = FLOAT_MAX;\r\n      this._max = FLOAT_MIN;\r\n    }\r\n    this.reset();\r\n    this._static_mr_co = new Array(this.totaxis);\r\n    this._static_mr_cs = new Array(this.totaxis*this.totaxis);\r\n  }\r\n\r\n  static fromSTRUCT(reader) {\r\n    let ret = new MinMax();\r\n    reader(ret);\r\n    return ret;\r\n  }\r\n\r\n  load(mm) {\r\n    if (this.totaxis === 1) {\r\n      this.min = mm.min;\r\n      this.max = mm.max;\r\n      this._min = mm.min;\r\n      this._max = mm.max;\r\n    } else {\r\n      this.min = new Vector3(mm.min);\r\n      this.max = new Vector3(mm.max);\r\n      this._min = new Vector3(mm._min);\r\n      this._max = new Vector3(mm._max);\r\n    }\r\n  }\r\n\r\n  reset() {\r\n    let totaxis = this.totaxis;\r\n    if (totaxis === 1) {\r\n      this.min = this.max = 0;\r\n      this._min = FLOAT_MAX;\r\n      this._max = FLOAT_MIN;\r\n    } else {\r\n      for (let i = 0; i < totaxis; i++) {\r\n        this._min[i] = FLOAT_MAX;\r\n        this._max[i] = FLOAT_MIN;\r\n        this.min[i] = 0;\r\n        this.max[i] = 0;\r\n      }\r\n    }\r\n  }\r\n\r\n  minmax_rect(p, size) {\r\n    let totaxis = this.totaxis;\r\n    let cs = this._static_mr_cs;\r\n    if (totaxis === 2) {\r\n      cs[0] = p;\r\n      cs[1] = [p[0] + size[0], p[1]];\r\n      cs[2] = [p[0] + size[0], p[1] + size[1]];\r\n      cs[3] = [p[0], p[1] + size[1]];\r\n    } else if (totaxis = 3) {\r\n      cs[0] = p;\r\n      cs[1] = [p[0] + size[0], p[1], p[2]];\r\n      cs[2] = [p[0] + size[0], p[1] + size[1], p[2]];\r\n      cs[3] = [p[0], p[1] + size[0], p[2]];\r\n      cs[4] = [p[0], p[1], p[2] + size[2]];\r\n      cs[5] = [p[0] + size[0], p[1], p[2] + size[2]];\r\n      cs[6] = [p[0] + size[0], p[1] + size[1], p[2] + size[2]];\r\n      cs[7] = [p[0], p[1] + size[0], p[2] + size[2]];\r\n    } else {\r\n      throw \"Minmax.minmax_rect has no implementation for \" + totaxis + \"-dimensional data\";\r\n    }\r\n    for (let i = 0; i < cs.length; i++) {\r\n      this.minmax(cs[i]);\r\n    }\r\n  }\r\n\r\n  minmax(p) {\r\n    let totaxis = this.totaxis;\r\n\r\n    if (totaxis === 1) {\r\n      this._min = this.min = Math.min(this._min, p);\r\n      this._max = this.max = Math.max(this._max, p);\r\n    } else if (totaxis === 2) {\r\n      this._min[0] = this.min[0] = Math.min(this._min[0], p[0]);\r\n      this._min[1] = this.min[1] = Math.min(this._min[1], p[1]);\r\n      this._max[0] = this.max[0] = Math.max(this._max[0], p[0]);\r\n      this._max[1] = this.max[1] = Math.max(this._max[1], p[1]);\r\n    } else if (totaxis === 3) {\r\n      this._min[0] = this.min[0] = Math.min(this._min[0], p[0]);\r\n      this._min[1] = this.min[1] = Math.min(this._min[1], p[1]);\r\n      this._min[2] = this.min[2] = Math.min(this._min[2], p[2]);\r\n      this._max[0] = this.max[0] = Math.max(this._max[0], p[0]);\r\n      this._max[1] = this.max[1] = Math.max(this._max[1], p[1]);\r\n      this._max[2] = this.max[2] = Math.max(this._max[2], p[2]);\r\n    } else {\r\n      for (let i = 0; i < totaxis; i++) {\r\n        this._min[i] = this.min[i] = Math.min(this._min[i], p[i]);\r\n        this._max[i] = this.max[i] = Math.max(this._max[i], p[i]);\r\n      }\r\n    }\r\n  }\r\n};\r\nMinMax.STRUCT = \"\\n  math.MinMax {\\n    min     : vec3;\\n    max     : vec3;\\n    _min    : vec3;\\n    _max    : vec3;\\n    totaxis : int;\\n  }\\n\";\r\n\r\nexport function winding_axis(a, b, c, up_axis) {\r\n  let xaxis = (up_axis + 1)%3;\r\n  let yaxis = (up_axis + 2)%3;\r\n\r\n  let x1 = a[xaxis], y1 = a[yaxis];\r\n  let x2 = b[xaxis], y2 = b[yaxis];\r\n  let x3 = c[xaxis], y3 = c[yaxis];\r\n\r\n  let dx1 = x1 - x2, dy1 = y1 - y2;\r\n  let dx2 = x3 - x2, dy2 = y3 - y2;\r\n\r\n  let f = dx1*dy2 - dy1*dx2;\r\n  return f >= 0.0;\r\n}\r\n\r\n/** returns false if clockwise */\r\nexport function winding(a, b, c, zero_z = false, tol = 0.0) {\r\n  let dx1 = b[0] - a[0];\r\n  let dy1 = b[1] - a[1];\r\n  let dx2 = c[0] - a[0];\r\n  let dy2 = c[1] - a[1];\r\n\r\n  return dx1*dy2 - dy1*dx2 > tol;\r\n}\r\n\r\nexport function inrect_2d(p, pos, size) {\r\n  if (p === undefined || pos === undefined || size === undefined) {\r\n    console.trace();\r\n    console.log(\"Bad paramters to inrect_2d()\");\r\n    console.log(\"p: \", p, \", pos: \", pos, \", size: \", size);\r\n    return false;\r\n  }\r\n  return p[0] >= pos[0] && p[0] <= pos[0] + size[0] && p[1] >= pos[1] && p[1] <= pos[1] + size[1];\r\n}\r\n\r\nlet $ps_aabb_isect_line_2d = [new Vector2(), new Vector2(), new Vector2(), new Vector2()];\r\n\r\nexport function aabb_isect_line_2d(v1, v2, min, max) {\r\n  if (point_in_aabb_2d(v1, min, max) || point_in_aabb(v2, min, max)) {\r\n    return true;\r\n  }\r\n\r\n  let lines = $ps_aabb_isect_line_2d;\r\n  lines[0][0] = min[0];\r\n  lines[0][1] = min[1];\r\n\r\n  lines[1][0] = min[0];\r\n  lines[1][1] = max[1];\r\n\r\n  lines[2][0] = max[0];\r\n  lines[2][1] = max[1];\r\n\r\n  lines[3][0] = max[0];\r\n  lines[3][1] = min[1];\r\n\r\n  for (let i = 0; i < 4; i++) {\r\n    if (line_line_cross(v1, v2, lines[i], lines[(i + 1)%4])) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n\r\nexport function expand_rect2d(pos, size, margin) {\r\n  pos[0] -= Math.floor(margin[0]);\r\n  pos[1] -= Math.floor(margin[1]);\r\n  size[0] += Math.floor(margin[0]*2.0);\r\n  size[1] += Math.floor(margin[1]*2.0);\r\n};\r\n\r\nexport function expand_line(l, margin) {\r\n  let c = new Vector3();\r\n  c.add(l[0]);\r\n  c.add(l[1]);\r\n  c.mulScalar(0.5);\r\n  l[0].sub(c);\r\n  l[1].sub(c);\r\n  let l1 = l[0].vectorLength();\r\n  let l2 = l[1].vectorLength();\r\n  l[0].normalize();\r\n  l[1].normalize();\r\n  l[0].mulScalar(margin + l1);\r\n  l[1].mulScalar(margin + l2);\r\n  l[0].add(c);\r\n  l[1].add(c);\r\n  return l;\r\n}\r\n\r\nexport function colinear(a, b, c, limit = 2.2e-16, distLimit = 0.00001**2) {\r\n  let t1 = _cross_vec1;\r\n  let t2 = _cross_vec2;\r\n\r\n  let axes = a.length;\r\n\r\n  for (let i = 0; i < axes; i++) {\r\n    t1[i] = b[i] - a[i];\r\n    t2[i] = c[i] - a[i];\r\n  }\r\n\r\n  for (let i = axes; i < 3; i++) {\r\n    t1[i] = t2[i] = 0.0;\r\n  }\r\n\r\n  if (t1.dot(t1) <= distLimit || t2.dot(t2) <= distLimit) {\r\n    return true;\r\n  }\r\n\r\n  t1.normalize();\r\n  t2.normalize();\r\n\r\n  t1.cross(t2);\r\n  return t1.dot(t1) <= limit;\r\n}\r\n\r\nexport function colinear2d(a, b, c, limit = 0.00001, precise = false) {\r\n  let dx1 = a[0] - b[0];\r\n  let dy1 = a[1] - b[1];\r\n  let dx2 = c[0] - b[0];\r\n  let dy2 = c[1] - b[1];\r\n\r\n  let det = Math.abs(dx1*dy2 - dy1*dx2);\r\n  if (precise) {\r\n    let len = (dx1**2 + dy1**2)**0.5 + (dx2**2 + dy2**2)**0.5;\r\n    if (len <= 0.00001) {\r\n      return true;\r\n    }\r\n\r\n    det /= len;\r\n  }\r\n\r\n  return det <= limit;\r\n}\r\n\r\nlet _llc_l1 = [new Vector3(), new Vector3()];\r\nlet _llc_l2 = [new Vector3(), new Vector3()];\r\nlet _llc_l3 = [new Vector3(), new Vector3()];\r\nlet _llc_l4 = [new Vector3(), new Vector3()];\r\n\r\nlet lli_v1 = new Vector3(), lli_v2 = new Vector3(), lli_v3 = new Vector3(), lli_v4 = new Vector3();\r\n\r\nlet _zero_cn = new Vector3();\r\nlet _tmps_cn = util.cachering.fromConstructor(Vector3, 64);\r\nlet _rets_cn = util.cachering.fromConstructor(Vector3, 64);\r\n\r\n//vec1, vec2 should both be normalized\r\nexport function corner_normal(vec1, vec2, width) {\r\n  let ret = _rets_cn.next().zero();\r\n\r\n  let vec = _tmps_cn.next().zero();\r\n  vec.load(vec1).add(vec2).normalize();\r\n\r\n  /*\r\n  ret.load(vec).mulScalar(width);\r\n  return ret;\r\n  */\r\n\r\n  //handle colinear case\r\n  if (Math.abs(vec1.normalizedDot(vec2)) > 0.9999) {\r\n    if (vec1.dot(vec2) > 0.0001) {\r\n      ret.load(vec1).add(vec2).normalize();\r\n    } else {\r\n      ret.load(vec1).normalize();\r\n    }\r\n\r\n    ret.mulScalar(width);\r\n\r\n    return ret;\r\n  } else { //XXX\r\n    //ret.load(vec).mulScalar(width);\r\n    //return ret;\r\n  }\r\n\r\n  vec1 = _tmps_cn.next().load(vec1).mulScalar(width);\r\n  vec2 = _tmps_cn.next().load(vec2).mulScalar(width);\r\n\r\n  let p1 = _tmps_cn.next().load(vec1);\r\n  let p2 = _tmps_cn.next().load(vec2);\r\n\r\n  vec1.addFac(vec1, 0.01);\r\n  vec2.addFac(vec2, 0.01);\r\n\r\n  let sc = 1.0;\r\n\r\n  p1[0] += vec1[1]*sc;\r\n  p1[1] += -vec1[0]*sc;\r\n\r\n  p2[0] += -vec2[1]*sc;\r\n  p2[1] += vec2[0]*sc;\r\n\r\n  let p = line_line_isect(vec1, p1, vec2, p2, false);\r\n\r\n  if (p === undefined || p === COLINEAR_ISECT || p.dot(p) < 0.000001) {\r\n    ret.load(vec1).add(vec2).normalize().mulScalar(width);\r\n  } else {\r\n    ret.load(p);\r\n\r\n    if (vec.dot(vec) > 0 && vec.dot(ret) < 0) {\r\n      ret.load(vec).mulScalar(width);\r\n    }\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n//test_segment is optional, true\r\nexport function line_line_isect(v1, v2, v3, v4, test_segment = true) {\r\n  if (test_segment && !line_line_cross(v1, v2, v3, v4)) {\r\n    return undefined;\r\n  }\r\n\r\n  /*\r\n  on factor;\r\n  off period;\r\n  \r\n  xa := xa1 + (xa2 - xa1)*t1;\r\n  xb := xb1 + (xb2 - xb1)*t2;\r\n  ya := ya1 + (ya2 - ya1)*t1;\r\n  yb := yb1 + (yb2 - yb1)*t2;\r\n  \r\n  f1 := xa - xb;\r\n  f2 := ya - yb;\r\n  \r\n  f := solve({f1, f2}, {t1, t2});\r\n  ft1 := part(f, 1, 1, 2);\r\n  ft2 := part(f, 1, 2, 2);\r\n  \r\n  */\r\n\r\n  let xa1 = v1[0], xa2 = v2[0], ya1 = v1[1], ya2 = v2[1];\r\n  let xb1 = v3[0], xb2 = v4[0], yb1 = v3[1], yb2 = v4[1];\r\n\r\n  let div = ((xa1 - xa2)*(yb1 - yb2) - (xb1 - xb2)*(ya1 - ya2));\r\n  if (Math.abs(div) < 0.00000001) { //parallel but intersecting lines.\r\n    return COLINEAR_ISECT;\r\n  } else { //intersection exists\r\n    let t1 = (-((ya1 - yb2)*xb1 - (yb1 - yb2)*xa1 - (ya1 - yb1)*xb2))/div;\r\n\r\n    return lli_v1.load(v1).interp(v2, t1);\r\n  }\r\n}\r\n\r\nexport function line_line_cross(a, b, c, d) {\r\n  /*\r\n  let limit=feps*1000;\r\n  if (Math.abs(l1[0].vectorDistance(l2[0])+l1[1].vectorDistance(l2[0])-l1[0].vectorDistance(l1[1]))<limit) {\r\n      return true;\r\n  }\r\n  if (Math.abs(l1[0].vectorDistance(l2[1])+l1[1].vectorDistance(l2[1])-l1[0].vectorDistance(l1[1]))<limit) {\r\n      return true;\r\n  }\r\n  if (Math.abs(l2[0].vectorDistance(l1[0])+l2[1].vectorDistance(l1[0])-l2[0].vectorDistance(l2[1]))<limit) {\r\n      return true;\r\n  }\r\n  if (Math.abs(l2[0].vectorDistance(l1[1])+l2[1].vectorDistance(l1[1])-l2[0].vectorDistance(l2[1]))<limit) {\r\n      return true;\r\n  }\r\n  //*/\r\n\r\n  let w1 = winding(a, b, c);\r\n  let w2 = winding(c, a, d);\r\n  let w3 = winding(a, b, d);\r\n  let w4 = winding(c, b, d);\r\n  return (w1 === w2) && (w3 === w4) && (w1 !== w3);\r\n};\r\n\r\nlet _asi_v1 = new Vector3();\r\nlet _asi_v2 = new Vector3();\r\nlet _asi_v3 = new Vector3();\r\nlet _asi_v4 = new Vector3();\r\nlet _asi_v5 = new Vector3();\r\nlet _asi_v6 = new Vector3();\r\n\r\nexport function point_in_aabb_2d(p, min, max) {\r\n  return p[0] >= min[0] && p[0] <= max[0] && p[1] >= min[1] && p[1] <= max[1];\r\n}\r\n\r\nlet _asi2d_v1 = new Vector2();\r\nlet _asi2d_v2 = new Vector2();\r\nlet _asi2d_v3 = new Vector2();\r\nlet _asi2d_v4 = new Vector2();\r\nlet _asi2d_v5 = new Vector2();\r\nlet _asi2d_v6 = new Vector2();\r\n\r\nexport function aabb_sphere_isect_2d(p, r, min, max) {\r\n  let v1 = _asi2d_v1, v2 = _asi2d_v2, v3 = _asi2d_v3, mvec = _asi2d_v4;\r\n  let v4 = _asi2d_v5;\r\n\r\n  p = _asi2d_v6.load(p);\r\n  v1.load(p);\r\n  v2.load(p);\r\n\r\n  min = _asi_v5.load(min);\r\n  max = _asi_v6.load(max);\r\n\r\n  mvec.load(max).sub(min).normalize().mulScalar(r + 0.0001);\r\n\r\n  v1.sub(mvec);\r\n  v2.add(mvec);\r\n  v3.load(p);\r\n\r\n  let ret = point_in_aabb_2d(v1, min, max) || point_in_aabb_2d(v2, min, max)\r\n    || point_in_aabb_2d(v3, min, max);\r\n\r\n  if (ret)\r\n    return ret;\r\n\r\n  /*\r\n  v1.load(min).add(max).mulScalar(0.5);\r\n  ret = ret || v1.vectorDistance(p) < r;\r\n  \r\n  v1.load(min);\r\n  ret = ret || v1.vectorDistance(p) < r;\r\n  \r\n  v1.load(max);\r\n  ret = ret || v1.vectorDistance(p) < r;\r\n  \r\n  v1[0] = min[0], v1[1] = max[1];\r\n  ret = ret || v1.vectorDistance(p) < r;\r\n  \r\n  v1[0] = max[0], v1[1] = min[1];\r\n  ret = ret || v1.vectorDistance(p) < r;\r\n  */\r\n  //*\r\n  v1.load(min);\r\n  v2[0] = min[0];\r\n  v2[1] = max[1];\r\n  ret = ret || dist_to_line_2d(p, v1, v2) < r;\r\n\r\n  v1.load(max);\r\n  v2[0] = max[0];\r\n  v2[1] = max[1];\r\n  ret = ret || dist_to_line_2d(p, v1, v2) < r;\r\n\r\n  v1.load(max);\r\n  v2[0] = max[0];\r\n  v2[1] = min[1];\r\n  ret = ret || dist_to_line_2d(p, v1, v2) < r;\r\n\r\n  v1.load(max);\r\n  v2[0] = min[0];\r\n  v2[1] = min[1];\r\n  ret = ret || dist_to_line_2d(p, v1, v2) < r;\r\n  //*/\r\n  return ret;\r\n};\r\n\r\nexport function point_in_aabb(p, min, max) {\r\n  return p[0] >= min[0] && p[0] <= max[0] && p[1] >= min[1] && p[1] <= max[1]\r\n    && p[2] >= min[2] && p[2] <= max[2];\r\n}\r\n\r\nlet asi_rect = new Array(8);\r\nfor (let i = 0; i < 8; i++) {\r\n  asi_rect[i] = new Vector3();\r\n}\r\n\r\nlet aabb_sphere_isect_vs = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport function aabb_sphere_isect(p, r, min, max) {\r\n  {\r\n    let p1 = aabb_sphere_isect_vs.next().load(p);\r\n    let min1 = aabb_sphere_isect_vs.next().load(min);\r\n    let max1 = aabb_sphere_isect_vs.next().load(max);\r\n    if (p.length === 2) {\r\n      p1[2] = 0.0;\r\n    }\r\n    if (min1.length === 2) {\r\n      min1[2] = 0.0;\r\n    }\r\n    if (max.length === 2) {\r\n      max1[2] = 0.0;\r\n    }\r\n\r\n    p = p1;\r\n    min = min1;\r\n    max = max1;\r\n  }\r\n\r\n  let cent = aabb_sphere_isect_vs.next().load(min).interp(max, 0.5);\r\n  p.sub(cent);\r\n  min.sub(cent);\r\n  max.sub(cent);\r\n\r\n  r *= r;\r\n\r\n  let isect = point_in_aabb(p, min, max);\r\n\r\n  if (isect) {\r\n    return true;\r\n  }\r\n\r\n  let rect = asi_rect;\r\n\r\n  rect[0].loadXYZ(min[0], min[1], min[2]);\r\n  rect[1].loadXYZ(min[0], max[1], min[2]);\r\n  rect[2].loadXYZ(max[0], max[1], min[2]);\r\n  rect[3].loadXYZ(max[0], min[1], min[2]);\r\n\r\n  rect[4].loadXYZ(min[0], min[1], max[2]);\r\n  rect[5].loadXYZ(min[0], max[1], max[2]);\r\n  rect[6].loadXYZ(max[0], max[1], max[2]);\r\n  rect[7].loadXYZ(max[0], min[1], max[2]);\r\n\r\n  for (let i = 0; i < 8; i++) {\r\n    if (p.vectorDistanceSqr(rect[i]) < r) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  let p2 = aabb_sphere_isect_vs.next().load(p);\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    p2.load(p);\r\n\r\n    let i2 = (i + 1)%3;\r\n    let i3 = (i + 2)%3;\r\n\r\n    p2[i] = p2[i] < 0.0 ? min[i] : max[i];\r\n\r\n    p2[i2] = Math.min(Math.max(p2[i2], min[i2]), max[i2]);\r\n    p2[i3] = Math.min(Math.max(p2[i3], min[i3]), max[i3]);\r\n\r\n    let isect = p2.vectorDistanceSqr(p) <= r;\r\n\r\n    if (isect) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n};\r\n\r\nexport function aabb_sphere_dist(p, min, max) {\r\n  {\r\n    let p1 = aabb_sphere_isect_vs.next().load(p);\r\n    let min1 = aabb_sphere_isect_vs.next().load(min);\r\n    let max1 = aabb_sphere_isect_vs.next().load(max);\r\n    if (p.length === 2) {\r\n      p1[2] = 0.0;\r\n    }\r\n    if (min1.length === 2) {\r\n      min1[2] = 0.0;\r\n    }\r\n    if (max.length === 2) {\r\n      max1[2] = 0.0;\r\n    }\r\n\r\n    p = p1;\r\n    min = min1;\r\n    max = max1;\r\n  }\r\n\r\n  let cent = aabb_sphere_isect_vs.next().load(min).interp(max, 0.5);\r\n  p.sub(cent);\r\n  min.sub(cent);\r\n  max.sub(cent);\r\n\r\n  let isect = point_in_aabb(p, min, max);\r\n\r\n  if (isect) {\r\n    return 0.0;\r\n  }\r\n\r\n  let rect = asi_rect;\r\n\r\n  rect[0].loadXYZ(min[0], min[1], min[2]);\r\n  rect[1].loadXYZ(min[0], max[1], min[2]);\r\n  rect[2].loadXYZ(max[0], max[1], min[2]);\r\n  rect[3].loadXYZ(max[0], min[1], min[2]);\r\n\r\n  rect[4].loadXYZ(min[0], min[1], max[2]);\r\n  rect[5].loadXYZ(min[0], max[1], max[2]);\r\n  rect[6].loadXYZ(max[0], max[1], max[2]);\r\n  rect[7].loadXYZ(max[0], min[1], max[2]);\r\n\r\n  let mindis;\r\n\r\n  for (let i = 0; i < 8; i++) {\r\n    let dis = p.vectorDistanceSqr(rect[i]);\r\n\r\n    if (mindis === undefined || dis < mindis) {\r\n      mindis = dis;\r\n    }\r\n  }\r\n\r\n  let p2 = aabb_sphere_isect_vs.next().load(p);\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    p2.load(p);\r\n\r\n    let i2 = (i + 1)%3;\r\n    let i3 = (i + 2)%3;\r\n\r\n    p2[i] = p2[i] < 0.0 ? min[i] : max[i];\r\n\r\n    p2[i2] = Math.min(Math.max(p2[i2], min[i2]), max[i2]);\r\n    p2[i3] = Math.min(Math.max(p2[i3], min[i3]), max[i3]);\r\n\r\n    let dis = p2.vectorDistanceSqr(p);\r\n    if (mindis === undefined || dis < mindis) {\r\n      mindis = dis;\r\n    }\r\n  }\r\n\r\n  return mindis === undefined ? 1e17 : mindis;\r\n};\r\n\r\nexport function point_in_tri(p, v1, v2, v3) {\r\n  let w1 = winding(p, v1, v2);\r\n  let w2 = winding(p, v2, v3);\r\n  let w3 = winding(p, v3, v1);\r\n  return w1 === w2 && w2 === w3;\r\n};\r\n\r\nexport function convex_quad(v1, v2, v3, v4) {\r\n  return line_line_cross([v1, v3], [v2, v4]);\r\n};\r\n\r\nlet $e1_normal_tri = new Vector3();\r\nlet $e3_normal_tri = new Vector3();\r\nlet $e2_normal_tri = new Vector3();\r\n\r\nexport function isNum(f) {\r\n  let ok = typeof f === \"number\";\r\n\r\n  ok = ok && !isNaN(f) && isFinite(f);\r\n\r\n  return ok;\r\n}\r\n\r\nconst _normal_tri_rets = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport function normal_tri(v1, v2, v3) {\r\n  let x1 = v2[0] - v1[0];\r\n  let y1 = v2[1] - v1[1];\r\n  let z1 = v2[2] - v1[2];\r\n  let x2 = v3[0] - v1[0];\r\n  let y2 = v3[1] - v1[1];\r\n  let z2 = v3[2] - v1[2];\r\n\r\n  if (!isNum(x1 + y1 + z1 + z2 + y2 + z2)) {\r\n    throw new Error(\"NaN in normal_tri\");\r\n  }\r\n\r\n  let x3, y3, z3;\r\n\r\n  x1 = v2[0] - v1[0];\r\n  y1 = v2[1] - v1[1];\r\n  z1 = v2[2] - v1[2];\r\n  x2 = v3[0] - v1[0];\r\n  y2 = v3[1] - v1[1];\r\n  z2 = v3[2] - v1[2];\r\n  x3 = y1*z2 - z1*y2;\r\n  y3 = z1*x2 - x1*z2;\r\n  z3 = x1*y2 - y1*x2;\r\n\r\n  let len = Math.sqrt((x3*x3 + y3*y3 + z3*z3));\r\n\r\n  if (len > 1e-05)\r\n    len = 1.0/len;\r\n\r\n  x3 *= len;\r\n  y3 *= len;\r\n  z3 *= len;\r\n\r\n  let n = _normal_tri_rets.next();\r\n\r\n  if (!isNum(x3 + y3 + z3)) {\r\n    throw new Error(\"NaN!\");\r\n  }\r\n\r\n  n[0] = x3;\r\n  n[1] = y3;\r\n  n[2] = z3;\r\n\r\n  return n;\r\n};\r\n\r\nlet $n2_normal_quad = new Vector3();\r\n\r\nlet _q1 = new Vector3(), _q2 = new Vector3(), _q3 = new Vector3();\r\n\r\nexport function normal_quad(v1, v2, v3, v4) {\r\n  _q1.load(normal_tri(v1, v2, v3));\r\n  _q2.load(normal_tri(v2, v3, v4));\r\n\r\n  _q1.add(_q2).normalize();\r\n  return _q1;\r\n}\r\n\r\nexport function normal_quad_old(v1, v2, v3, v4) {\r\n  let n = normal_tri(v1, v2, v3);\r\n  $n2_normal_quad[0] = n[0];\r\n  $n2_normal_quad[1] = n[1];\r\n  $n2_normal_quad[2] = n[2];\r\n  n = normal_tri(v1, v3, v4);\r\n  $n2_normal_quad[0] = $n2_normal_quad[0] + n[0];\r\n  $n2_normal_quad[1] = $n2_normal_quad[1] + n[1];\r\n  $n2_normal_quad[2] = $n2_normal_quad[2] + n[2];\r\n  let _len = Math.sqrt(($n2_normal_quad[0]*$n2_normal_quad[0] + $n2_normal_quad[1]*$n2_normal_quad[1] + $n2_normal_quad[2]*$n2_normal_quad[2]));\r\n  if (_len > 1e-05)\r\n    _len = 1.0/_len;\r\n  $n2_normal_quad[0] *= _len;\r\n  $n2_normal_quad[1] *= _len;\r\n  $n2_normal_quad[2] *= _len;\r\n  return $n2_normal_quad;\r\n};\r\n\r\nlet _li_vi = new Vector3();\r\n\r\n//calc_t is optional, false\r\nexport function line_isect(v1, v2, v3, v4, calc_t) {\r\n  if (calc_t === undefined) {\r\n    calc_t = false;\r\n  }\r\n  let div = (v2[0] - v1[0])*(v4[1] - v3[1]) - (v2[1] - v1[1])*(v4[0] - v3[0]);\r\n  if (div === 0.0)\r\n    return [new Vector3(), COLINEAR, 0.0];\r\n  let vi = _li_vi;\r\n  vi[0] = 0;\r\n  vi[1] = 0;\r\n  vi[2] = 0;\r\n  vi[0] = ((v3[0] - v4[0])*(v1[0]*v2[1] - v1[1]*v2[0]) - (v1[0] - v2[0])*(v3[0]*v4[1] - v3[1]*v4[0]))/div;\r\n  vi[1] = ((v3[1] - v4[1])*(v1[0]*v2[1] - v1[1]*v2[0]) - (v1[1] - v2[1])*(v3[0]*v4[1] - v3[1]*v4[0]))/div;\r\n  if (calc_t || v1.length === 3) {\r\n    let n1 = new Vector2(v2).sub(v1);\r\n    let n2 = new Vector2(vi).sub(v1);\r\n    let t = n2.vectorLength()/n1.vectorLength();\r\n    n1.normalize();\r\n    n2.normalize();\r\n    if (n1.dot(n2) < 0.0) {\r\n      t = -t;\r\n    }\r\n    if (v1.length === 3) {\r\n      vi[2] = v1[2] + (v2[2] - v1[2])*t;\r\n    }\r\n    return [vi, LINECROSS, t];\r\n  }\r\n  return [vi, LINECROSS];\r\n};\r\n\r\nlet dt2l_v1 = new Vector2();\r\nlet dt2l_v2 = new Vector2();\r\nlet dt2l_v3 = new Vector2();\r\nlet dt2l_v4 = new Vector2();\r\nlet dt2l_v5 = new Vector2();\r\n\r\nexport function dist_to_line_2d(p, v1, v2, clip = true, closest_co_out = undefined, t_out = undefined) {\r\n  v1 = dt2l_v4.load(v1);\r\n  v2 = dt2l_v5.load(v2);\r\n\r\n  let n = dt2l_v1;\r\n  let vec = dt2l_v3;\r\n\r\n  n.load(v2).sub(v1).normalize();\r\n  vec.load(p).sub(v1);\r\n\r\n  let t = vec.dot(n);\r\n  if (clip) {\r\n    t = Math.min(Math.max(t, 0.0), v1.vectorDistance(v2));\r\n  }\r\n\r\n  n.mulScalar(t).add(v1);\r\n\r\n  if (closest_co_out) {\r\n    closest_co_out[0] = n[0];\r\n    closest_co_out[1] = n[1];\r\n  }\r\n\r\n  if (t_out !== undefined) {\r\n    t_out = t;\r\n  }\r\n\r\n  return n.vectorDistance(p);\r\n}\r\n\r\nlet dt3l_v1 = new Vector3();\r\nlet dt3l_v2 = new Vector3();\r\nlet dt3l_v3 = new Vector3();\r\nlet dt3l_v4 = new Vector3();\r\nlet dt3l_v5 = new Vector3();\r\n\r\nexport function dist_to_line_sqr(p, v1, v2, clip = true) {\r\n  let px = p[0] - v1[0];\r\n  let py = p[1] - v1[1];\r\n  let pz = p.length < 3 ? 0.0 : p[2] - v1[2];\r\n\r\n  pz = pz === undefined ? 0.0 : pz;\r\n\r\n  let v2x = v2[0] - v1[0];\r\n  let v2y = v2[1] - v1[1];\r\n  let v2z = v2.length < 3 ? 0.0 : v2[2] - v1[2];\r\n\r\n  let len = v2x*v2x + v2y*v2y + v2z*v2z;\r\n\r\n  if (len === 0.0) {\r\n    return Math.sqrt(px*px + py*py + pz*pz);\r\n  }\r\n\r\n  let len2 = 1.0/len;\r\n  v2x *= len2;\r\n  v2y *= len2;\r\n  v2z *= len2;\r\n\r\n  let t = px*v2x + py*v2y + pz*v2z;\r\n  if (clip) {\r\n    t = Math.min(Math.max(t, 0.0), len);\r\n  }\r\n\r\n  v2x *= t;\r\n  v2y *= t;\r\n  v2z *= t;\r\n\r\n  return (v2x - px)*(v2x - px) + (v2y - py)*(v2y - py) + (v2z - pz)*(v2z - pz);\r\n}\r\n\r\nexport function dist_to_line(p, v1, v2, clip = true) {\r\n  return Math.sqrt(dist_to_line_sqr(p, v1, v2, clip));\r\n}\r\n\r\n//p cam be 2d, 3d, or 4d point, v1/v2 however must be full homogenous coordinates\r\nlet _cplw_vs4 = util.cachering.fromConstructor(Vector4, 64);\r\nlet _cplw_vs3 = util.cachering.fromConstructor(Vector3, 64);\r\nlet _cplw_vs2 = util.cachering.fromConstructor(Vector2, 64);\r\n\r\nfunction wclip(x1, x2, w1, w2, near) {\r\n  let r1 = near*w1 - x1;\r\n  let r2 = (w1 - w2)*near - (x1 - x2);\r\n\r\n  if (r2 === 0.0) return 0.0;\r\n\r\n  return r1/r2;\r\n}\r\n\r\nfunction clip(a, b, znear) {\r\n  if (a - b === 0.0) return 0.0;\r\n\r\n  return (a - znear)/(a - b);\r\n}\r\n\r\n/*clips v1 and v2 to lie within homogenous projection range\r\n  v1 and v2 are assumed to be projected, pre-division Vector4's\r\n  returns a positive number (how much the line was scaled) if either _v1 or _v2 are\r\n  in front of the near clipping plane otherwise, returns 0\r\n */\r\nexport function clip_line_w(_v1, _v2, znear, zfar) {\r\n  let v1 = _cplw_vs4.next().load(_v1);\r\n  let v2 = _cplw_vs4.next().load(_v2);\r\n\r\n  //are we fully behind the view plane?\r\n  if ((v1[2] < 1.0 && v2[2] < 1.0))\r\n    return false;\r\n\r\n  function doclip1(v1, v2, axis) {\r\n    if (v1[axis]/v1[3] < -1) {\r\n      let t = wclip(v1[axis], v2[axis], v1[3], v2[3], -1);\r\n      v1.interp(v2, t);\r\n    } else if (v1[axis]/v1[3] > 1) {\r\n      let t = wclip(v1[axis], v2[axis], v1[3], v2[3], 1);\r\n      v1.interp(v2, t);\r\n    }\r\n  }\r\n\r\n  function doclip(v1, v2, axis) {\r\n    doclip1(v1, v2, axis);\r\n    doclip1(v2, v1, axis);\r\n  }\r\n\r\n  function dozclip(v1, v2) {\r\n    if (v1[2] < 1) {\r\n      let t = clip(v1[2], v2[2], 1);\r\n      v1.interp(v2, t);\r\n    } else if (v2[2] < 1) {\r\n      let t = clip(v2[2], v1[2], 1);\r\n      v2.interp(v1, t);\r\n    }\r\n  }\r\n\r\n  dozclip(v1, v2, 1);\r\n  doclip(v1, v2, 0);\r\n  doclip(v1, v2, 1);\r\n\r\n  for (let i = 0; i < 4; i++) {\r\n    _v1[i] = v1[i];\r\n    _v2[i] = v2[i];\r\n  }\r\n\r\n  return !(v1[0]/v1[3] === v2[0]/v2[3] || v1[1]/v2[3] === v2[1]/v2[3]);\r\n};\r\n\r\n//clip is optional, true.  clip point to lie within line segment v1->v2\r\nlet _closest_point_on_line_cache = util.cachering.fromConstructor(Vector3, 64);\r\nlet _closest_point_rets = new util.cachering(function () {\r\n  return [0, 0];\r\n}, 64);\r\n\r\nlet _closest_tmps = [new Vector3(), new Vector3(), new Vector3()];\r\n\r\nexport function closest_point_on_line(p, v1, v2, clip = true) {\r\n  let l1 = _closest_tmps[0], l2 = _closest_tmps[1];\r\n  let len;\r\n\r\n\r\n  l1.load(v2).sub(v1);\r\n\r\n  if (clip) {\r\n    len = l1.vectorLength();\r\n  }\r\n\r\n  l1.normalize();\r\n  l2.load(p).sub(v1);\r\n\r\n  let t = l2.dot(l1);\r\n  if (clip) {\r\n    //t = t*(t<0.0) + t*(t>1.0) + (t>1.0);\r\n    t = t < 0.0 ? 0.0 : t;\r\n    t = t > len ? len : t;\r\n  }\r\n\r\n  let co = _closest_point_on_line_cache.next();\r\n  co.load(l1).mulScalar(t).add(v1);\r\n  let ret = _closest_point_rets.next();\r\n\r\n  ret[0] = co;\r\n  ret[1] = t;\r\n\r\n  return ret;\r\n}\r\n\r\n/*given input line (a,d) and tangent t,\r\n  returns a circle that goes through both\r\n  a and d, whose normalized tangent at a is the same\r\n  as normalized t.\r\n  \r\n  note that t need not be normalized, this function\r\n  does that itself*/\r\nlet _circ_from_line_tan_vs = util.cachering.fromConstructor(Vector3, 32);\r\nlet _circ_from_line_tan_ret = new util.cachering(function () {\r\n  return [new Vector3(), 0];\r\n}, 64);\r\n\r\nexport function circ_from_line_tan(a, b, t) {\r\n  let p1 = _circ_from_line_tan_vs.next();\r\n  let t2 = _circ_from_line_tan_vs.next();\r\n  let n1 = _circ_from_line_tan_vs.next();\r\n\r\n  p1.load(a).sub(b);\r\n  t2.load(t).normalize();\r\n  n1.load(p1).normalize().cross(t2).cross(t2).normalize();\r\n\r\n  let ax = p1[0], ay = p1[1], az = p1[2], nx = n1[0], ny = n1[1], nz = n1[2];\r\n  let r = -(ax*ax + ay*ay + az*az);\r\n  let div = (2*(ax*nx + ay*ny + az*nz));\r\n\r\n  if (Math.abs(div) > 0.000001) {\r\n    r /= div;\r\n  } else {\r\n    r = 1000000.0;\r\n  }\r\n\r\n  let ret = _circ_from_line_tan_ret.next();\r\n  ret[0].load(n1).mulScalar(r).add(a)\r\n  ret[1] = r;\r\n\r\n  return ret;\r\n}\r\n\r\n/*given input line (a,d) and tangent t,\r\n  returns a circle that goes through both\r\n  a and d, whose normalized tangent at a is the same\r\n  as normalized t.\r\n\r\n  note that t need not be normalized, this function\r\n  does that itself*/\r\nlet _circ_from_line_tan2d_vs = util.cachering.fromConstructor(Vector3, 32);\r\nlet _circ_from_line_tan2d_ret = new util.cachering(function () {\r\n  return [new Vector2(), 0];\r\n}, 64);\r\n\r\nexport function circ_from_line_tan_2d(a, b, t) {\r\n  a = _circ_from_line_tan2d_vs.next().load(a);\r\n  b = _circ_from_line_tan2d_vs.next().load(b);\r\n  t = _circ_from_line_tan2d_vs.next().load(t);\r\n\r\n  a[2] = b[2] = t[2] = 0.0;\r\n\r\n  let p1 = _circ_from_line_tan2d_vs.next();\r\n  let t2 = _circ_from_line_tan2d_vs.next();\r\n  let n1 = _circ_from_line_tan2d_vs.next();\r\n\r\n  p1.load(a).sub(b);\r\n  t2.load(t).normalize();\r\n  n1.load(p1).normalize().cross(t2).cross(t2).normalize();\r\n\r\n  if (1) {\r\n    let cx, cy, r;\r\n    let x1 = a[0], y1 = a[1];\r\n    let x2 = b[0], y2 = b[1];\r\n    let tanx1 = t[0], tany1 = t[1];\r\n\r\n    let div = (4.0*((x1 - x2)*tany1 - (y1 - y2)*tanx1)**2);\r\n    let div2 = (2.0*(x1 - x2)*tany1 - 2.0*(y1 - y2)*tanx1);\r\n\r\n    if (Math.abs(div) < 0.0001 || Math.abs(div2) < 0.0001) {\r\n      let ret = _circ_from_line_tan2d_ret.next();\r\n\r\n      ret[0].load(a).interp(b, 0.5);\r\n      let dx = a[1] - b[1];\r\n      let dy = b[0] - a[0];\r\n\r\n      r = 1000000.0;\r\n\r\n      ret[0][0] += dx*r;\r\n      ret[0][1] += dy*r;\r\n      ret[1] = r;\r\n\r\n      return ret;\r\n    }\r\n    cx = (((x1 + x2)*(x1 - x2) - (y1 - y2)**2)*tany1 - 2.0*(y1 - y2)*tanx1*x1\r\n    )/div2;\r\n\r\n    cy = (-((y1 + y2)*(y1 - y2) - x2**2 - (x1 - 2.0*x2)*x1)*tanx1 + 2.0*(x1 -\r\n      x2)*tany1*y1)/div2;\r\n\r\n    r = (((y1 - y2)**2 + x2**2 + (x1 - 2.0*x2)*x1)**2*(tanx1**2 + tany1**2)\r\n    )/div;\r\n\r\n    let midx = a[0]*0.5 + b[0]*0.5;\r\n    let midy = a[1]*0.5 + b[1]*0.5;\r\n\r\n    //mirror\r\n    cx = 2.0*midx - cx;\r\n    cy = 2.0*midy - cy;\r\n\r\n    let ret = _circ_from_line_tan2d_ret.next();\r\n    ret[0].loadXY(cx, cy);\r\n    ret[1] = Math.sqrt(r);\r\n\r\n    return ret;\r\n  } else {\r\n    let ax = p1[0], ay = p1[1], az = p1[2], nx = n1[0], ny = n1[1], nz = n1[2];\r\n    let r = -(ax*ax + ay*ay + az*az);\r\n    let div = (2*(ax*nx + ay*ny + az*nz));\r\n\r\n    if (Math.abs(div) > 0.000001) {\r\n      r /= div;\r\n    } else {\r\n      r = 1000000.0;\r\n    }\r\n\r\n    let ret = _circ_from_line_tan2d_ret.next();\r\n    ret[0].load(n1).mulScalar(r).add(a)\r\n    ret[1] = r;\r\n\r\n    return ret;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nlet _gtc_e1 = new Vector3();\r\nlet _gtc_e2 = new Vector3();\r\nlet _gtc_e3 = new Vector3();\r\nlet _gtc_p1 = new Vector3();\r\nlet _gtc_p2 = new Vector3();\r\nlet _gtc_v1 = new Vector3();\r\nlet _gtc_v2 = new Vector3();\r\nlet _gtc_p12 = new Vector3();\r\nlet _gtc_p22 = new Vector3();\r\nlet _get_tri_circ_ret = new util.cachering(function () {\r\n  return [0, 0]\r\n});\r\n\r\nexport function get_tri_circ(a, b, c) {\r\n  let v1 = _gtc_v1;\r\n  let v2 = _gtc_v2;\r\n  let e1 = _gtc_e1;\r\n  let e2 = _gtc_e2;\r\n  let e3 = _gtc_e3;\r\n  let p1 = _gtc_p1;\r\n  let p2 = _gtc_p2;\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    e1[i] = b[i] - a[i];\r\n    e2[i] = c[i] - b[i];\r\n    e3[i] = a[i] - c[i];\r\n  }\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    p1[i] = (a[i] + b[i])*0.5;\r\n    p2[i] = (c[i] + b[i])*0.5;\r\n  }\r\n\r\n  e1.normalize();\r\n\r\n  v1[0] = -e1[1];\r\n  v1[1] = e1[0];\r\n  v1[2] = e1[2];\r\n\r\n  v2[0] = -e2[1];\r\n  v2[1] = e2[0];\r\n  v2[2] = e2[2];\r\n\r\n  v1.normalize();\r\n  v2.normalize();\r\n\r\n  let cent;\r\n  let type;\r\n  for (let i = 0; i < 3; i++) {\r\n    _gtc_p12[i] = p1[i] + v1[i];\r\n    _gtc_p22[i] = p2[i] + v2[i];\r\n  }\r\n\r\n  let isect = line_isect(p1, _gtc_p12, p2, _gtc_p22);\r\n  cent = isect[0];\r\n  type = isect[1];\r\n\r\n  e1.load(a);\r\n  e2.load(b);\r\n  e3.load(c);\r\n\r\n  let r = e1.sub(cent).vectorLength();\r\n  if (r < feps)\r\n    r = e2.sub(cent).vectorLength();\r\n  if (r < feps)\r\n    r = e3.sub(cent).vectorLength();\r\n\r\n  let ret = _get_tri_circ_ret.next();\r\n  ret[0] = cent;\r\n  ret[1] = r;\r\n\r\n  return ret;\r\n};\r\n\r\nexport function gen_circle(m, origin, r, stfeps) {\r\n  let pi = Math.PI;\r\n  let f = -pi/2;\r\n  let df = (pi*2)/stfeps;\r\n  let verts = new Array();\r\n  for (let i = 0; i < stfeps; i++) {\r\n    let x = origin[0] + r*Math.sin(f);\r\n    let y = origin[1] + r*Math.cos(f);\r\n    let v = m.make_vert(new Vector3([x, y, origin[2]]));\r\n    verts.push(v);\r\n    f += df;\r\n  }\r\n  for (let i = 0; i < verts.length; i++) {\r\n    let v1 = verts[i];\r\n    let v2 = verts[(i + 1)%verts.length];\r\n    m.make_edge(v1, v2);\r\n  }\r\n  return verts;\r\n};\r\n\r\nlet cos = Math.cos;\r\nlet sin = Math.sin;\r\n\r\n//axis is optional, 0\r\nexport function rot2d(v1, A, axis) {\r\n  let x = v1[0];\r\n  let y = v1[1];\r\n\r\n  if (axis === 1) {\r\n    v1[0] = x*cos(A) + y*sin(A);\r\n    v1[2] = y*cos(A) - x*sin(A);\r\n  } else {\r\n    v1[0] = x*cos(A) - y*sin(A);\r\n    v1[1] = y*cos(A) + x*sin(A);\r\n  }\r\n}\r\n\r\nexport function makeCircleMesh(gl, radius, stfeps) {\r\n  let mesh = new Mesh();\r\n  let verts1 = gen_circle(mesh, new Vector3(), radius, stfeps);\r\n  let verts2 = gen_circle(mesh, new Vector3(), radius/1.75, stfeps);\r\n  mesh.make_face_complex([verts1, verts2]);\r\n  return mesh;\r\n};\r\n\r\nexport function minmax_verts(verts) {\r\n  let min = new Vector3([1000000000000.0, 1000000000000.0, 1000000000000.0]);\r\n  let max = new Vector3([-1000000000000.0, -1000000000000.0, -1000000000000.0]);\r\n  let __iter_v = __get_iter(verts);\r\n  let v;\r\n  while (1) {\r\n    let __ival_v = __iter_v.next();\r\n    if (__ival_v.done) {\r\n      break;\r\n    }\r\n    v = __ival_v.value;\r\n    for (let i = 0; i < 3; i++) {\r\n      min[i] = Math.min(min[i], v.co[i]);\r\n      max[i] = Math.max(max[i], v.co[i]);\r\n    }\r\n  }\r\n  return [min, max];\r\n};\r\n\r\nexport function unproject(vec, ipers, iview) {\r\n  let newvec = new Vector3(vec);\r\n  newvec.multVecMatrix(ipers);\r\n  newvec.multVecMatrix(iview);\r\n  return newvec;\r\n};\r\n\r\nexport function project(vec, pers, view) {\r\n  let newvec = new Vector3(vec);\r\n  newvec.multVecMatrix(pers);\r\n  newvec.multVecMatrix(view);\r\n  return newvec;\r\n};\r\n\r\nlet _sh_minv = new Vector3();\r\nlet _sh_maxv = new Vector3();\r\nlet _sh_start = [];\r\nlet _sh_end = [];\r\n\r\nlet static_cent_gbw = new Vector3();\r\n\r\nexport function get_boundary_winding(points) {\r\n  let cent = static_cent_gbw.zero();\r\n  if (points.length === 0)\r\n    return false;\r\n  for (let i = 0; i < points.length; i++) {\r\n    cent.add(points[i]);\r\n  }\r\n  cent.divideScalar(points.length);\r\n  let w = 0, totw = 0;\r\n  for (let i = 0; i < points.length; i++) {\r\n    let v1 = points[i];\r\n    let v2 = points[(i + 1)%points.length];\r\n    if (!colinear(v1, v2, cent)) {\r\n      w += winding(v1, v2, cent);\r\n      totw += 1;\r\n    }\r\n  }\r\n  if (totw > 0)\r\n    w /= totw;\r\n  return Math.round(w) === 1;\r\n};\r\n\r\nexport class PlaneOps {\r\n  constructor(normal) {\r\n    let no = normal;\r\n    this.axis = [0, 0, 0];\r\n    this.reset_axis(normal);\r\n  }\r\n\r\n  reset_axis(no) {\r\n    let ax, ay, az;\r\n    let nx = Math.abs(no[0]), ny = Math.abs(no[1]), nz = Math.abs(no[2]);\r\n    if (nz > nx && nz > ny) {\r\n      ax = 0;\r\n      ay = 1;\r\n      az = 2;\r\n    } else if (nx > ny && nx > nz) {\r\n      ax = 2;\r\n      ay = 1;\r\n      az = 0;\r\n    } else {\r\n      ax = 0;\r\n      ay = 2;\r\n      az = 1;\r\n    }\r\n    this.axis = [ax, ay, az];\r\n  }\r\n\r\n  convex_quad(v1, v2, v3, v4) {\r\n    let ax = this.axis;\r\n    v1 = new Vector3([v1[ax[0]], v1[ax[1]], v1[ax[2]]]);\r\n    v2 = new Vector3([v2[ax[0]], v2[ax[1]], v2[ax[2]]]);\r\n    v3 = new Vector3([v3[ax[0]], v3[ax[1]], v3[ax[2]]]);\r\n    v4 = new Vector3([v4[ax[0]], v4[ax[1]], v4[ax[2]]]);\r\n    return convex_quad(v1, v2, v3, v4);\r\n  }\r\n\r\n  line_isect(v1, v2, v3, v4) {\r\n    let ax = this.axis;\r\n    let orig1 = v1, orig2 = v2;\r\n    v1 = new Vector3([v1[ax[0]], v1[ax[1]], v1[ax[2]]]);\r\n    v2 = new Vector3([v2[ax[0]], v2[ax[1]], v2[ax[2]]]);\r\n    v3 = new Vector3([v3[ax[0]], v3[ax[1]], v3[ax[2]]]);\r\n    v4 = new Vector3([v4[ax[0]], v4[ax[1]], v4[ax[2]]]);\r\n    let ret = line_isect(v1, v2, v3, v4, true);\r\n    let vi = ret[0];\r\n    if (ret[1] === LINECROSS) {\r\n      ret[0].load(orig2).sub(orig1).mulScalar(ret[2]).add(orig1);\r\n    }\r\n    return ret;\r\n  }\r\n\r\n  line_line_cross(l1, l2) {\r\n    let ax = this.axis;\r\n    let v1 = l1[0], v2 = l1[1], v3 = l2[0], v4 = l2[1];\r\n    v1 = new Vector3([v1[ax[0]], v1[ax[1]], 0.0]);\r\n    v2 = new Vector3([v2[ax[0]], v2[ax[1]], 0.0]);\r\n    v3 = new Vector3([v3[ax[0]], v3[ax[1]], 0.0]);\r\n    v4 = new Vector3([v4[ax[0]], v4[ax[1]], 0.0]);\r\n    return line_line_cross([v1, v2], [v3, v4]);\r\n  }\r\n\r\n  winding(v1, v2, v3) {\r\n    let ax = this.axis;\r\n    if (v1 === undefined)\r\n      console.trace();\r\n    v1 = new Vector3([v1[ax[0]], v1[ax[1]], 0.0]);\r\n    v2 = new Vector3([v2[ax[0]], v2[ax[1]], 0.0]);\r\n    v3 = new Vector3([v3[ax[0]], v3[ax[1]], 0.0]);\r\n    return winding(v1, v2, v3);\r\n  }\r\n\r\n  colinear(v1, v2, v3) {\r\n    let ax = this.axis;\r\n    v1 = new Vector3([v1[ax[0]], v1[ax[1]], 0.0]);\r\n    v2 = new Vector3([v2[ax[0]], v2[ax[1]], 0.0]);\r\n    v3 = new Vector3([v3[ax[0]], v3[ax[1]], 0.0]);\r\n    return colinear(v1, v2, v3);\r\n  }\r\n\r\n  get_boundary_winding(points) {\r\n    let ax = this.axis;\r\n    let cent = new Vector3();\r\n    if (points.length === 0)\r\n      return false;\r\n    for (let i = 0; i < points.length; i++) {\r\n      cent.add(points[i]);\r\n    }\r\n    cent.divideScalar(points.length);\r\n    let w = 0, totw = 0;\r\n    for (let i = 0; i < points.length; i++) {\r\n      let v1 = points[i];\r\n      let v2 = points[(i + 1)%points.length];\r\n      if (!this.colinear(v1, v2, cent)) {\r\n        w += this.winding(v1, v2, cent);\r\n        totw += 1;\r\n      }\r\n    }\r\n    if (totw > 0)\r\n      w /= totw;\r\n    return Math.round(w) === 1;\r\n  }\r\n}\r\n\r\n/*\r\non factor;\r\n\r\npx := rox + rnx*t;\r\npy := roy + rny*t;\r\npz := roz + rnz*t;\r\n\r\nf1 := (px-pox)*pnx + (py-poy)*pny + (pz-poz)*pnz;\r\nff := solve(f1, t);\r\non fort;\r\npart(ff, 1, 2);\r\noff fort;\r\n\r\n* */\r\nlet _isrp_ret = new Vector3();\r\nlet isect_ray_plane_rets = util.cachering.fromConstructor(Vector3, 256);\r\n\r\nexport function isect_ray_plane(planeorigin, planenormal, rayorigin, raynormal) {\r\n  let po = planeorigin, pn = planenormal, ro = rayorigin, rn = raynormal;\r\n\r\n  let div = (pn[1]*rn[1] + pn[2]*rn[2] + pn[0]*rn[0]);\r\n\r\n  if (Math.abs(div) < 0.000001) {\r\n    return undefined;\r\n  }\r\n\r\n  let t = ((po[1] - ro[1])*pn[1] + (po[2] - ro[2])*pn[2] + (po[0] - ro[0])*pn[0])/div;\r\n  _isrp_ret.load(ro).addFac(rn, t);\r\n\r\n  return isect_ray_plane_rets.next().load(_isrp_ret);\r\n}\r\n\r\nexport function _old_isect_ray_plane(planeorigin, planenormal, rayorigin, raynormal) {\r\n  let p = planeorigin, n = planenormal;\r\n  let r = rayorigin, v = raynormal;\r\n\r\n  let d = p.vectorLength();\r\n  let t = -(r.dot(n) - p.dot(n))/v.dot(n);\r\n  _isrp_ret.load(v);\r\n  _isrp_ret.mulScalar(t);\r\n  _isrp_ret.add(r);\r\n  return _isrp_ret;\r\n};\r\n\r\nexport class Mat4Stack {\r\n  constructor() {\r\n    this.stack = [];\r\n    this.matrix = new Matrix4();\r\n    this.matrix.makeIdentity();\r\n    this.update_func = undefined;\r\n  }\r\n\r\n  set_internal_matrix(mat, update_func) {\r\n    this.update_func = update_func;\r\n    this.matrix = mat;\r\n  }\r\n\r\n  reset(mat) {\r\n    this.matrix.load(mat);\r\n    this.stack = [];\r\n    if (this.update_func !== undefined)\r\n      this.update_func();\r\n  }\r\n\r\n  load(mat) {\r\n    this.matrix.load(mat);\r\n    if (this.update_func !== undefined)\r\n      this.update_func();\r\n  }\r\n\r\n  multiply(mat) {\r\n    this.matrix.multiply(mat);\r\n    if (this.update_func !== undefined)\r\n      this.update_func();\r\n  }\r\n\r\n  identity() {\r\n    this.matrix.loadIdentity();\r\n    if (this.update_func !== undefined)\r\n      this.update_func();\r\n  }\r\n\r\n  push(mat2) {\r\n    this.stack.push(new Matrix4(this.matrix));\r\n    if (mat2 !== undefined) {\r\n      this.matrix.load(mat2);\r\n      if (this.update_func !== undefined)\r\n        this.update_func();\r\n    }\r\n  }\r\n\r\n  pop() {\r\n    let mat = this.stack.pop(this.stack.length - 1);\r\n    this.matrix.load(mat);\r\n    if (this.update_func !== undefined)\r\n      this.update_func();\r\n    return mat;\r\n  }\r\n}\r\n\r\n\r\n/*\r\n\r\non factor;\r\noff period;\r\n\r\nload_package \"avector\";\r\n\r\n\r\na1 := avec(a1x, a1y, a1z);\r\nb1 := avec(b1x, b1y, b1z);\r\nc1 := avec(c1x, c1y, c1z);\r\nd1 := avec(d1x, d1y, d1z);\r\n\r\na1x := 0;\r\na1y := 0;\r\na1z := 0;\r\n\r\na2 := avec(a2x, a2y, a2z);\r\nb2 := avec(b2x, b2y, b2z);\r\nc2 := avec(c2x, c2y, c2z);\r\nd2 := avec(d2x, d2y, d2z);\r\n\r\np1 := a1 + (b1 - a1) * v;\r\np2 := d1 + (c1 - d1) * v;\r\np3 := p1 + (p2 - p1) * u;\r\n\r\np4 := a2 + (b2 - a2) * v;\r\np5 := d2 + (c2 - d2) * v;\r\np6 := p4 + (p5 - p4) * u;\r\n\r\np7 := p3 + (p6 - p3) * w;\r\n\r\nf1 := p7[0] - goalx;\r\nf2 := p7[1] - goaly;\r\nf3 := p7[2] - goalz;\r\n\r\ncomment: solve({f1, f2, f3}, {u, v, w});\r\n\r\non fort;\r\np7;\r\noff fort;\r\n\r\nsub(u=0, v=1, w=0, p7[0]);\r\n\r\n*/\r\n\r\nconst tril_rets = util.cachering.fromConstructor(Vector3, 128);\r\n\r\nfunction lreport() {\r\n  //console.log(...arguments);\r\n}\r\n\r\nexport function trilinear_v3(uvw, boxverts) {\r\n  let [u, v, w] = uvw;\r\n\r\n  const a1x = boxverts[0][0], a1y = boxverts[0][1], a1z = boxverts[0][2];\r\n\r\n  const b1x = boxverts[1][0] - a1x, b1y = boxverts[1][1] - a1y, b1z = boxverts[1][2] - a1z;\r\n  const c1x = boxverts[2][0] - a1x, c1y = boxverts[2][1] - a1y, c1z = boxverts[2][2] - a1z;\r\n  const d1x = boxverts[3][0] - a1x, d1y = boxverts[3][1] - a1y, d1z = boxverts[3][2] - a1z;\r\n\r\n  const a2x = boxverts[4][0] - a1x, a2y = boxverts[4][1] - a1y, a2z = boxverts[4][2] - a1z;\r\n  const b2x = boxverts[5][0] - a1x, b2y = boxverts[5][1] - a1y, b2z = boxverts[5][2] - a1z;\r\n  const c2x = boxverts[6][0] - a1x, c2y = boxverts[6][1] - a1y, c2z = boxverts[6][2] - a1z;\r\n  const d2x = boxverts[7][0] - a1x, d2y = boxverts[7][1] - a1y, d2z = boxverts[7][2] - a1z;\r\n\r\n  const x = (((a2x - b2x)*v - a2x + (c2x - d2x)*v + d2x)*u - ((a2x - b2x)*v - a2x) - (\r\n      ((c1x - d1x)*v + d1x - b1x*v)*u + b1x*v))*w + ((c1x - d1x)*v + d1x - b1x*v)*u +\r\n    b1x*v;\r\n  const y = (((a2y - b2y)*v - a2y + (c2y - d2y)*v + d2y)*u - ((a2y - b2y)*v - a2y) - (\r\n      ((c1y - d1y)*v + d1y - b1y*v)*u + b1y*v))*w + ((c1y - d1y)*v + d1y - b1y*v)*u +\r\n    b1y*v;\r\n  const z = (((a2z - b2z)*v - a2z + (c2z - d2z)*v + d2z)*u - ((a2z - b2z)*v - a2z) - (\r\n      ((c1z - d1z)*v + d1z - b1z*v)*u + b1z*v))*w + ((c1z - d1z)*v + d1z - b1z*v)*u +\r\n    b1z*v;\r\n\r\n  let p = tril_rets.next();\r\n\r\n  p[0] = x + a1x;\r\n  p[1] = y + a1y;\r\n  p[2] = z + a1z;\r\n\r\n  return p;\r\n}\r\n\r\nlet tril_co_rets = util.cachering.fromConstructor(Vector3, 128);\r\nlet tril_co_tmps = util.cachering.fromConstructor(Vector3, 16);\r\nlet tril_mat_1 = new Matrix4();\r\nlet tril_mat_2 = new Matrix4();\r\n\r\nlet wtable = [\r\n  [\r\n    [0.5, 0.5, 0], //u triplet\r\n    [0.5, 0.5, 0], //v triplet\r\n    [0.5, 0.5, 0]  //w triplet\r\n  ],\r\n  [\r\n    [0.5, 0.5, 0],\r\n    [0.0, 0.5, 0.5],\r\n    [0.5, 0.5, 0]\r\n  ],\r\n  [\r\n    [0.0, 0.5, 0.5],\r\n    [0.0, 0.5, 0.5],\r\n    [0.5, 0.5, 0]\r\n  ],\r\n  [\r\n    [0.0, 0.5, 0.5],\r\n    [0.5, 0.5, 0],\r\n    [0.5, 0.5, 0]\r\n  ],\r\n];\r\n\r\nfor (let i = 0; i < 4; i++) {\r\n  let w = wtable[i];\r\n  w = [w[0], w[1], [0.0, 0.5, 0.5]];\r\n  wtable.push(w);\r\n}\r\n\r\nconst pih_tmps = util.cachering.fromConstructor(Vector3, 16);\r\nconst boxfaces_table = [\r\n  [0, 1, 2, 3],\r\n  [7, 6, 5, 4],\r\n  [0, 4, 5, 1],\r\n  [1, 5, 6, 2],\r\n  [2, 6, 7, 3],\r\n  [3, 7, 4, 0]\r\n];\r\n\r\nlet boxfaces_tmp = new Array(6);\r\nfor (let i = 0; i < 6; i++) {\r\n  boxfaces_tmp[i] = new Vector3();\r\n}\r\n\r\nlet boxfacenormals_tmp = new Array(6);\r\nfor (let i = 0; i < 6; i++) {\r\n  boxfacenormals_tmp[i] = new Vector3();\r\n}\r\n\r\nexport function point_in_hex(p, boxverts, boxfacecents = undefined, boxfacenormals = undefined) {\r\n  if (!boxfacecents) {\r\n    boxfacecents = boxfaces_tmp;\r\n\r\n    for (let i = 0; i < 6; i++) {\r\n      let [v1, v2, v3, v4] = boxfaces_table[i];\r\n      v1 = boxverts[v1];\r\n      v2 = boxverts[v2];\r\n      v3 = boxverts[v3];\r\n      v4 = boxverts[v4];\r\n\r\n      boxfacecents[i].load(v1).add(v2).add(v3).add(v4).mulScalar(0.25);\r\n    }\r\n  }\r\n\r\n  if (!boxfacenormals) {\r\n    boxfacenormals = boxfacenormals_tmp;\r\n    for (let i = 0; i < 6; i++) {\r\n      let [v1, v2, v3, v4] = boxfaces_table[i];\r\n      v1 = boxverts[v1];\r\n      v2 = boxverts[v2];\r\n      v3 = boxverts[v3];\r\n      v4 = boxverts[v4];\r\n\r\n      let n = normal_quad(v1, v2, v3, v4);\r\n      boxfacenormals[i].load(n).negate();\r\n    }\r\n  }\r\n\r\n  let t1 = pih_tmps.next();\r\n  let t2 = pih_tmps.next();\r\n\r\n  let cent = pih_tmps.next().zero();\r\n  for (let i = 0; i < 6; i++) {\r\n    cent.add(boxfacecents[i]);\r\n  }\r\n  cent.mulScalar(1.0/6.0);\r\n\r\n  let ret = true;\r\n\r\n  for (let i = 0; i < 6; i++) {\r\n    t1.load(p).sub(boxfacecents[i]);\r\n    t2.load(cent).sub(boxfacecents[i]);\r\n    let n = boxfacenormals[i];\r\n\r\n    if (1) {\r\n      t1.normalize();\r\n      t2.normalize();\r\n\r\n      //console.log(i, \"DOT\", n.dot(t1).toFixed(5), n, t1);\r\n    }\r\n\r\n    if (t1.dot(t2) < 0) {\r\n      //console.log(\"\\n\");\r\n      ret = false;\r\n      return false;\r\n    }\r\n  }\r\n\r\n  //console.log(\"\\n\");\r\n  return ret;\r\n  //return true;\r\n}\r\n\r\nconst boxverts_tmp = new Array(8);\r\nfor (let i = 0; i < 8; i++) {\r\n  boxverts_tmp[i] = new Vector3();\r\n}\r\n\r\nexport function trilinear_co(p, boxverts) {\r\n  let uvw = tril_co_rets.next();\r\n\r\n  uvw.zero();\r\n\r\n  let u = tril_co_tmps.next();\r\n  let v = tril_co_tmps.next();\r\n  let w = tril_co_tmps.next();\r\n\r\n  u.loadXYZ(0.0, 0.5, 1.0);\r\n  v.loadXYZ(0.0, 0.5, 1.0);\r\n  w.loadXYZ(0.0, 0.5, 1.0);\r\n\r\n  let uvw2 = tril_co_tmps.next();\r\n\r\n  for (let step = 0; step < 4; step++) {\r\n    uvw.loadXYZ(u[1], v[1], w[1]);\r\n\r\n    let mini = undefined;\r\n    let mindis = trilinear_v3(uvw, boxverts).vectorDistanceSqr(p);\r\n\r\n    for (let i = 0; i < 8; i++) {\r\n      let [t1, t2, t3] = wtable[i];\r\n\r\n      let u2 = t1[0]*u[0] + t1[1]*u[1] + t1[2]*u[2];\r\n      let v2 = t2[0]*v[0] + t2[1]*v[1] + t2[2]*v[2];\r\n      let w2 = t3[0]*w[0] + t3[1]*w[1] + t3[2]*w[2];\r\n\r\n      let du = Math.abs(u2 - u[1]);\r\n      let dv = Math.abs(v2 - v[1]);\r\n      let dw = Math.abs(w2 - w[1]);\r\n\r\n      uvw.loadXYZ(u2, v2, w2);\r\n      let dis = trilinear_v3(uvw, boxverts).vectorDistanceSqr(p);\r\n\r\n      if (mindis === undefined || dis < mindis) {\r\n        //mindis = dis;\r\n        //mini = i;\r\n      }\r\n\r\n      if (1) {\r\n        let bv = boxverts_tmp;\r\n\r\n        /*\r\n        let dd = 1.0 - 0.001;\r\n\r\n        du *= dd;\r\n        dv *= dd;\r\n        dw *= dd;\r\n        //*/\r\n\r\n        bv[0].loadXYZ(u2 - du, v2 - dv, w2 - dw);\r\n        bv[1].loadXYZ(u2 - du, v2 + dv, w2 - dw);\r\n        bv[2].loadXYZ(u2 + du, v2 + dv, w2 - dw);\r\n        bv[3].loadXYZ(u2 + du, v2 - dv, w2 - dw);\r\n\r\n        bv[4].loadXYZ(u2 - du, v2 - dv, w2 + dw);\r\n        bv[5].loadXYZ(u2 - du, v2 + dv, w2 + dw);\r\n        bv[6].loadXYZ(u2 + du, v2 + dv, w2 + dw);\r\n        bv[7].loadXYZ(u2 + du, v2 - dv, w2 + dw);\r\n\r\n        for (let j = 0; j < 8; j++) {\r\n          bv[j].load(trilinear_v3(bv[j], boxverts));\r\n        }\r\n\r\n        if (point_in_hex(p, bv)) {\r\n          mini = i;\r\n          mindis = dis;\r\n          //console.log(\"DIS\", (dis**0.5).toFixed(3));\r\n          break;\r\n        }\r\n\r\n        //console.log(\"\\n\");\r\n      }\r\n    }\r\n\r\n    if (mini === undefined) {\r\n      lreport(\"mindis:\", (mindis**0.5).toFixed(3));\r\n      break;\r\n    }\r\n\r\n    let [t1, t2, t3] = wtable[mini];\r\n\r\n    let u2 = t1[0]*u[0] + t1[1]*u[1] + t1[2]*u[2];\r\n    let v2 = t2[0]*v[0] + t2[1]*v[1] + t2[2]*v[2];\r\n    let w2 = t3[0]*w[0] + t3[1]*w[1] + t3[2]*w[2];\r\n\r\n    let du = Math.abs(u2 - u[1]);\r\n    let dv = Math.abs(v2 - v[1]);\r\n    let dw = Math.abs(w2 - w[1]);\r\n\r\n    u[0] = u2 - du;\r\n    v[0] = v2 - dv;\r\n    w[0] = w2 - dw;\r\n\r\n    u[1] = u2;\r\n    v[1] = v2;\r\n    w[1] = w2;\r\n\r\n    u[2] = u2 + du;\r\n    v[2] = v2 + dv;\r\n    w[2] = w2 + dw;\r\n\r\n    lreport(\"mindis:\", (mindis**0.5).toFixed(3), u2, v2, w2);\r\n  }\r\n\r\n  uvw.loadXYZ(u[1], v[1], w[1]);\r\n\r\n  //console.log(\"uvw\", uvw);\r\n\r\n  //return uvw;\r\n\r\n  return trilinear_co2(p, boxverts, uvw);\r\n}\r\n\r\n//newton-raphson\r\nexport function trilinear_co2(p, boxverts, uvw) {\r\n  //let uvw = tril_co_rets.next();\r\n  let grad = tril_co_tmps.next();\r\n\r\n  //uvw[0] = uvw[1] = uvw[2] = 0.5;\r\n\r\n  let df = 0.00001;\r\n\r\n  let mat = tril_mat_1;\r\n  let m = mat.$matrix;\r\n  let mat2 = tril_mat_2;\r\n\r\n  let r1 = tril_co_tmps.next();\r\n\r\n  for (let step = 0; step < 55; step++) {\r\n    //let r1 = trilinear_v3(uvw, boxverts).vectorDistance(p);\r\n    let totg = 0;\r\n\r\n    for (let i = 0; i < 3; i++) {\r\n      let axis_error = 0.0;\r\n\r\n      if (uvw[i] < 0) {\r\n        axis_error = -uvw[i];\r\n      } else if (uvw[i] > 1.0) {\r\n        axis_error = uvw[i] - 1.0;\r\n      }\r\n      //r1[i] = trilinear_v3(uvw, boxverts)[i] - p[i];\r\n      r1[i] = trilinear_v3(uvw, boxverts).vectorDistance(p) + 10.0*axis_error;\r\n\r\n      let orig = uvw[i];\r\n\r\n      uvw[i] += df;\r\n      //let r2 = trilinear_v3(uvw, boxverts)[i] - p[i];\r\n\r\n      if (uvw[i] < 0) {\r\n        axis_error = -uvw[i];\r\n      } else if (uvw[i] > 1.0) {\r\n        axis_error = uvw[i] - 1.0;\r\n      } else {\r\n        axis_error = 0.0;\r\n      }\r\n      let r2 = trilinear_v3(uvw, boxverts).vectorDistance(p) + 10.0*axis_error;\r\n      uvw[i] = orig;\r\n\r\n      grad[i] = (r2 - r1[i])/df;\r\n      totg += grad[i]**2;\r\n    }\r\n\r\n    if (totg === 0.0) {\r\n      break;\r\n    }\r\n\r\n    let err = trilinear_v3(uvw, boxverts).vectorDistance(p);\r\n\r\n    if (1) {\r\n      //grad.normalize();\r\n      uvw.addFac(grad, -err/totg*0.85);\r\n    } else {\r\n      mat.makeIdentity();\r\n      m.m11 = grad[0];\r\n      m.m12 = grad[1];\r\n      m.m13 = grad[2];\r\n      m.m22 = m.m33 = m.m44 = 0.0;\r\n\r\n      mat.transpose();\r\n      mat2.load(mat).transpose();\r\n\r\n      //right-indepdenent pseudo inverse\r\n      //mat.multiply(mat2).invert();\r\n      //mat.preMultiply(mat2);\r\n\r\n      //left-independent\r\n      mat.preMultiply(mat2).invert();\r\n      mat.multiply(mat2);\r\n\r\n      grad.load(r1);\r\n      grad.multVecMatrix(mat);\r\n      uvw.addFac(grad, -1.0);\r\n    }\r\n\r\n    lreport(\"error:\", err.toFixed(3), uvw);\r\n\r\n    if (r1.dot(r1)**0.5 < 0.0001) {\r\n      break;\r\n    }\r\n  }\r\n\r\n  lreport(\"\\n\");\r\n\r\n  return uvw;\r\n}\r\n\r\nlet angle_tri_v3_rets = util.cachering.fromConstructor(Vector3, 32);\r\nlet angle_tri_v3_vs = util.cachering.fromConstructor(Vector3, 32);\r\n\r\nexport function tri_angles(v1, v2, v3) {\r\n  let t1 = angle_tri_v3_vs.next().load(v1).sub(v2);\r\n  let t2 = angle_tri_v3_vs.next().load(v3).sub(v2);\r\n  let t3 = angle_tri_v3_vs.next().load(v2).sub(v3);\r\n\r\n  t1.normalize();\r\n  t2.normalize();\r\n  t3.normalize();\r\n\r\n  let th1 = Math.acos(t1.dot(t2)*0.99999);\r\n  t2.negate();\r\n\r\n  let th2 = Math.acos(t2.dot(t3)*0.99999);\r\n  let th3 = Math.PI - (th1 + th2);\r\n\r\n  let ret = angle_tri_v3_rets.next();\r\n\r\n  ret[0] = th1;\r\n  ret[1] = th2;\r\n  ret[2] = th3;\r\n\r\n  return ret;\r\n}\r\n\r\nlet angle_v2_temps = util.cachering.fromConstructor(Vector2, 32);\r\nlet angle_v3_temps = util.cachering.fromConstructor(Vector3, 32);\r\n\r\nexport function angle_between_vecs(v1, vcent, v2) {\r\n  let t1, t2;\r\n\r\n  if (v1.length === 2) {\r\n    t1 = angle_v2_temps.next();\r\n    t2 = angle_v2_temps.next();\r\n  } else {\r\n    t1 = angle_v3_temps.next();\r\n    t2 = angle_v3_temps.next();\r\n  }\r\n\r\n  t1.load(v1).sub(vcent).normalize();\r\n  t2.load(v2).sub(vcent).normalize();\r\n\r\n  let d = t1.dot(t2);\r\n\r\n  /* Handle numerical error. */\r\n  if (d < -1.0) {\r\n    return Math.PI;\r\n  } else if (d > 1.0) {\r\n    return 0.0;\r\n  } else {\r\n    return Math.acos(d);\r\n  }\r\n}\r\n","let _clipdata = {\r\n  name: \"nothing\",\r\n  mime: \"nothing\",\r\n  data: undefined\r\n};\r\n\r\nlet _clipboards = {};\r\n\r\nimport * as ctrlconfig from '../path-controller/config/config.js';\r\n\r\nif (typeof document !== 'undefined') {\r\n  /* spawn clipboard reader */\r\n  window.setInterval(() => {\r\n    if (!document.hasFocus()) {\r\n      return\r\n    }\r\n\r\n    let cb = navigator.clipboard;\r\n    if (!cb || !cb.read) {\r\n      return;\r\n    }\r\n\r\n    cb.read().then((data) => {\r\n      for (let item of data) {\r\n        for (let i = 0; i < item.types.length; i++) {\r\n          let type = item.types[i];\r\n\r\n          if (!(type in _clipboards)) {\r\n            _clipboards[type] = {\r\n              name: type,\r\n              mime: type,\r\n              data: undefined\r\n            };\r\n          }\r\n          ;\r\n\r\n          item.getType(type).then((blob) => new Response(blob).text()).then((text) => {\r\n            _clipboards[type].data = text;\r\n          });\r\n        }\r\n      }\r\n    }).catch(function () {\r\n    });\r\n  }, 200);\r\n}\r\n\r\nlet exports = {\r\n  /** Client code can override this using `.loadConstants`, this is\r\n   *  a simple implementation that just handles color data.\r\n   *\r\n   * `desiredMimes` is either a string, or an array of strings\r\n   */\r\n  getClipboardData(desiredMimes = \"text/plain\") {\r\n    if (typeof desiredMimes === \"string\") {\r\n      desiredMimes = [desiredMimes];\r\n    }\r\n\r\n    for (let m of desiredMimes) {\r\n      let cb = _clipboards[m];\r\n\r\n      if (cb && cb.data) {\r\n        return cb;\r\n      }\r\n    }\r\n  },\r\n\r\n\r\n  /** Client code can override this. This is a simple implementation\r\n   *  that just handles color data\r\n   */\r\n  setClipboardData(name, mime, data) {\r\n    _clipboards[mime] = {\r\n      name: name,\r\n      mime: mime,\r\n      data: data\r\n    };\r\n\r\n    let clipboard = navigator.clipboard;\r\n    if (!clipboard) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      clipboard.write([new ClipboardItem({\r\n        [mime]: new Blob([data], {type: mime})\r\n      })]).catch((error) => {\r\n        //try pushing through text/plain\r\n        if (mime.startsWith(\"text\") && mime !== \"text/plain\") {\r\n          this.setClipboardData(name, \"text/plain\", data);\r\n        } else {\r\n          console.error(error);\r\n        }\r\n      });\r\n    } catch (error) {\r\n      console.log(error.stack);\r\n      console.log(\"failed to write to system clipboard\");\r\n    }\r\n  },\r\n  colorSchemeType: \"light\",\r\n  docManualPath  : \"../simple_docsys/doc_build/\",\r\n  docEditorPath  : \"../simple_docsys.js\",\r\n\r\n  /* Add textboxes to rollar sliders,\r\n     note that  users can also double click them to\r\n     enter text as well\r\n   */\r\n  useNumSliderTextboxes: true,\r\n\r\n  numSliderArrowLimit: 15, /* Threshold to check if numslider arrow was clicked. */\r\n  simpleNumSliders   : false,\r\n\r\n  menusCanPopupAbove: false,\r\n  menu_close_time   : 500,\r\n  doubleClickTime   : 500,\r\n\r\n  /* Timeout for press-and-hold (touch) version of double clicking. */\r\n  doubleClickHoldTime: 750,\r\n  DEBUG              : {\r\n    paranoidEvents      : false,\r\n    screenborders       : false,\r\n    areaContextPushes   : false,\r\n    allBordersMovable   : false,\r\n    doOnce              : false,\r\n    modalEvents         : false,\r\n    areaConstraintSolver: false,\r\n    datapaths           : false,\r\n    lastToolPanel       : false,\r\n\r\n    domEvents        : false,\r\n    domEventAddRemove: false,\r\n\r\n    debugUIUpdatePerf: false, /* Turns async FrameManager.update_intern loop into sync. */\r\n\r\n    screenAreaPosSizeAccesses: false,\r\n    buttonEvents             : false,\r\n\r\n    /*\r\n    customWindowSize: {\r\n      width: 2048, height: 2048\r\n    },\r\n    //*/\r\n  },\r\n\r\n  /* Auto load 1d bspline templates, can hurt startup time. */\r\n  autoLoadSplineTemplates: true,\r\n\r\n  addHelpPickers: true,\r\n\r\n  useAreaTabSwitcher : false,\r\n  autoSizeUpdate     : true,\r\n  showPathsInToolTips: true,\r\n\r\n  enableThemeAutoUpdate: true,\r\n  useNativeToolTips    : true,\r\n  noElectronMenus      : false,\r\n\r\n  loadConstants: function (args) {\r\n    for (let k in args) {\r\n      if (k === \"loadConstants\")\r\n        continue;\r\n\r\n      this[k] = args[k];\r\n    }\r\n\r\n    ctrlconfig.setConfig(this);\r\n  }\r\n};\r\n\r\nexport default exports;\r\nwindow.DEBUG = exports.DEBUG;\r\n\r\nif (typeof document !== 'undefined') {\r\n  let cfg = document.getElementById(\"pathux-config\");\r\n  if (cfg) {\r\n    exports.loadConstants(JSON.parse(cfg.innerText));\r\n  }\r\n}\r\nif (typeof window?.PATHUX_CONFIG !== 'undefined') {\r\n  exports.loadConstants(window.PATHUX_CONFIG)\r\n}\r\n","/*\r\nTHEME REFACTOR:\r\n\r\n* Use CSS as much as possible\r\n* Create a compatibility layer\r\n\r\n*/\r\nimport * as util from \"../path-controller/util/util.js\";\r\nimport {Vector3, Vector4} from '../path-controller/util/vectormath.js';\r\nimport nstructjs from \"../path-controller/util/struct.js\";\r\nimport cconst from '../config/const.js';\r\n\r\nexport let compatMap = {\r\n  BoxMargin       : \"padding\",\r\n  BoxBG           : \"background\",\r\n  BoxRadius       : \"border-radius\",\r\n  background      : \"background-color\",\r\n  defaultWidth    : \"width\",\r\n  defaultHeight   : \"height\",\r\n  DefaultWidth    : \"width\",\r\n  DefaultHeight   : \"height\",\r\n  BoxBorder       : \"border-color\",\r\n  BoxLineWidth    : \"border-width\",\r\n  BoxSubBG        : \"background-color\",\r\n  BoxSub2BG       : \"background-color\",\r\n  DefaultPanelBG  : \"background-color\",\r\n  InnerPanelBG    : \"background-color\",\r\n  Background      : \"background-color\",\r\n  numslider_width : \"width\",\r\n  numslider_height: \"height\",\r\n};\r\n\r\nexport let ColorSchemeTypes = {\r\n  LIGHT: \"light\",\r\n  DARK : \"dark\"\r\n};\r\n\r\nexport function parsepx(css) {\r\n  return parseFloat(css.trim().replace(\"px\", \"\"))\r\n}\r\n\r\nexport function color2css(c, alpha_override) {\r\n  let r = ~~(c[0]*255);\r\n  let g = ~~(c[1]*255);\r\n  let b = ~~(c[2]*255);\r\n  let a = c.length < 4 ? 1.0 : c[3];\r\n\r\n  a = alpha_override !== undefined ? alpha_override : a;\r\n\r\n  if (c.length === 3 && alpha_override === undefined) {\r\n    return `rgb(${r},${g},${b})`;\r\n  } else {\r\n    return `rgba(${r},${g},${b}, ${a})`;\r\n  }\r\n}\r\n\r\nwindow.color2css = color2css;\r\n\r\nlet css2color_rets = util.cachering.fromConstructor(Vector4, 64);\r\nlet basic_colors = {\r\n  'white' : [1, 1, 1],\r\n  'grey'  : [0.5, 0.5, 0.5],\r\n  'gray'  : [0.5, 0.5, 0.5],\r\n  'black' : [0, 0, 0],\r\n  'red'   : [1, 0, 0],\r\n  'yellow': [1, 1, 0],\r\n  'green' : [0, 1, 0],\r\n  'teal'  : [0, 1, 1],\r\n  'cyan'  : [0, 1, 1],\r\n  'blue'  : [0, 0, 1],\r\n  'orange': [1, 0.5, 0.25],\r\n  'brown' : [0.5, 0.4, 0.3],\r\n  'purple': [1, 0, 1],\r\n  'pink'  : [1, 0.5, 0.5]\r\n};\r\n\r\nexport function color2web(color) {\r\n  function tostr(n) {\r\n    n = ~~(n*255);\r\n    let s = n.toString(16);\r\n\r\n    if (s.length > 2) {\r\n      s = s.slice(0, 2);\r\n    }\r\n\r\n    while (s.length < 2) {\r\n      s = \"0\" + s;\r\n    }\r\n\r\n    return s;\r\n  }\r\n\r\n  if (color.length === 3 || color[3] === 1.0) {\r\n    let r = tostr(color[0]);\r\n    let g = tostr(color[1]);\r\n    let b = tostr(color[2]);\r\n\r\n    return \"#\" + r + g + b;\r\n  } else {\r\n    let r = tostr(color[0]);\r\n    let g = tostr(color[1]);\r\n    let b = tostr(color[2]);\r\n    let a = tostr(color[3]);\r\n\r\n    return \"#\" + r + g + b + a;\r\n  }\r\n}\r\n\r\nwindow.color2web = color2web;\r\n\r\nexport function css2color(color) {\r\n  if (!color) {\r\n    return new Vector4([0, 0, 0, 1]);\r\n  }\r\n\r\n  color = (\"\" + color).trim();\r\n\r\n  let ret = css2color_rets.next();\r\n\r\n  if (color[0] === \"#\") {\r\n    color = color.slice(1, color.length);\r\n    let parts = [];\r\n\r\n    for (let i = 0; i < color.length>>1; i++) {\r\n      let part = \"0x\" + color.slice(i*2, i*2 + 2);\r\n      parts.push(parseInt(part));\r\n    }\r\n\r\n    ret.zero();\r\n    let i;\r\n    for (i = 0; i < Math.min(parts.length, ret.length); i++) {\r\n      ret[i] = parts[i]/255.0;\r\n    }\r\n\r\n    if (i < 4) {\r\n      ret[3] = 1.0;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  if (color in basic_colors) {\r\n    ret.load(basic_colors[color]);\r\n    ret[3] = 1.0;\r\n    return ret;\r\n  }\r\n\r\n  const hasAlpha = color.startsWith(\"rgba(\");\r\n  color = color.replace(\"rgba\", \"\").replace(\"rgb\", \"\").replace(/[\\(\\)]/g, \"\").trim().split(\",\")\r\n\r\n  for (let i = 0; i < color.length; i++) {\r\n    ret[i] = parseFloat(color[i]);\r\n    if (i < 3) {\r\n      ret[i] /= 255;\r\n    }\r\n  }\r\n\r\n  if (ret.length === 3) {\r\n    ret.push(1.0);\r\n  }\r\n\r\n  if (!hasAlpha) {\r\n    ret[3] = 1.0;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nwindow.css2color = css2color\r\n\r\nexport function web2color(str) {\r\n  if (typeof str === \"string\" && str.trim()[0] !== \"#\") {\r\n    str = \"#\" + str.trim();\r\n  }\r\n\r\n  return css2color(str);\r\n}\r\n\r\nwindow.web2color = web2color;\r\n\r\nlet validate_pat = /\\#?[0-9a-fA-F]{6}([0-9a-fA-F]{2})?$/;\r\n\r\nexport function validateWebColor(str) {\r\n  if (typeof str !== \"string\" && !(str instanceof String))\r\n    return false;\r\n\r\n  return str.trim().search(validate_pat) === 0;\r\n}\r\n\r\nlet num = \"(([0-9]+\\.[0-9]+)|[0-9a-f]+)\";\r\n\r\nlet validate_rgba = new RegExp(`rgba\\\\(${num},${num},${num},${num}\\\\)$`);\r\nlet validate_rgb = new RegExp(`rgb\\\\(${num},${num},${num}\\\\)$`);\r\n\r\nexport function validateCSSColor(color) {\r\n  if (color.toLowerCase() in basic_colors) {\r\n    return true;\r\n  }\r\n\r\n  let rgba = color.toLowerCase().replace(/[ \\t]/g, \"\");\r\n  rgba = rgba.trim();\r\n\r\n  if (validate_rgba.test(rgba) || validate_rgb.exec(rgba)) {\r\n    return true;\r\n  }\r\n\r\n  return validateWebColor(color);\r\n}\r\n\r\nwindow.validateCSSColor = validateCSSColor;\r\n\r\nexport let theme = {};\r\n\r\nexport function invertTheme() {\r\n  cconst.colorSchemeType = cconst.colorSchemeType === ColorSchemeTypes.LIGHT ? ColorSchemeTypes.DARK\r\n                                                                             : ColorSchemeTypes.LIGHT;\r\n\r\n  function inverted(color) {\r\n    if (Array.isArray(color)) {\r\n      for (let i = 0; i < 3; i++) {\r\n        color[i] = 1.0 - color[i];\r\n      }\r\n\r\n      return color;\r\n    }\r\n\r\n    color = css2color(color);\r\n    return color2css(inverted(color));\r\n  }\r\n\r\n  let bg = document.body.style[\"background-color\"];\r\n  //if (!bg) {\r\n  bg = cconst.colorSchemeType === ColorSchemeTypes.LIGHT ? \"rgb(200,200,200)\" : \"rgb(55, 55, 55)\";\r\n  //} else {\r\n  //  bg = inverted(bg);\r\n  //}\r\n\r\n  document.body.style[\"background-color\"] = bg;\r\n\r\n  for (let style in theme) {\r\n    style = theme[style];\r\n\r\n    for (let k in style) {\r\n      let v = style[k];\r\n\r\n      if (v instanceof CSSFont) {\r\n        v.color = inverted(v.color);\r\n      } else if (typeof v === \"string\") {\r\n        v = v.trim().toLowerCase();\r\n\r\n        let iscolor = v.search(\"rgb\") >= 0;\r\n        iscolor = iscolor || v in basic_colors;\r\n        iscolor = iscolor || validateWebColor(v);\r\n\r\n        if (iscolor) {\r\n          style[k] = inverted(v);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nwindow.invertTheme = invertTheme;\r\n\r\nexport function setColorSchemeType(mode) {\r\n  if (!!mode !== cconst.colorSchemeType) {\r\n    invertTheme();\r\n    cconst.colorSchemeType = mode;\r\n  }\r\n\r\n}\r\n\r\nwindow.validateWebColor = validateWebColor;\r\n\r\nlet _digest = new util.HashDigest();\r\n\r\nexport class CSSFont {\r\n  constructor(args = {}) {\r\n    this._size = args.size ? args.size : 12;\r\n    this.font = args.font;\r\n    this.style = args.style !== undefined ? args.style : \"normal\";\r\n    this.weight = args.weight !== undefined ? args.weight : \"normal\";\r\n    this.variant = args.variant !== undefined ? args.variant : \"normal\";\r\n    this.color = args.color;\r\n  }\r\n\r\n  calcHashUpdate(digest = _digest.reset()) {\r\n    digest.add(this._size || 0);\r\n    digest.add(this.font);\r\n    digest.add(this.style);\r\n    digest.add(this.weight);\r\n    digest.add(this.variant);\r\n    digest.add(this.color);\r\n\r\n    return digest.get();\r\n  }\r\n\r\n  set size(val) {\r\n    this._size = val;\r\n  }\r\n\r\n  get size() {\r\n    if (util.isMobile()) {\r\n      let mul = theme.base.mobileTextSizeMultiplier/visualViewport.scale;\r\n      if (mul) {\r\n        return this._size*mul;\r\n        ;\r\n      }\r\n    }\r\n\r\n    return this._size;\r\n  }\r\n\r\n  copyTo(b) {\r\n    b._size = this._size;\r\n    b.font = this.font;\r\n    b.style = this.style;\r\n    b.color = this.color;\r\n    b.variant = this.variant;\r\n    b.weight = this.weight;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new CSSFont();\r\n    this.copyTo(ret);\r\n    return ret;\r\n  }\r\n\r\n  genCSS(size = this.size) {\r\n    return `${this.style} ${this.variant} ${this.weight} ${size}px ${this.font}`;\r\n  }\r\n\r\n  //deprecated, use genKey()\r\n  hash() {\r\n    return this.genKey();\r\n  }\r\n\r\n  genKey() {\r\n    let color = this.color;\r\n\r\n    if (typeof this.color === \"object\" || typeof this.color === \"function\") {\r\n      color = JSON.stringify(color);\r\n    }\r\n\r\n    return this.genCSS() + \":\" + this.size + \":\" + color;\r\n  }\r\n}\r\n\r\nCSSFont.STRUCT = `\r\nCSSFont {\r\n  size     : float | obj._size;\r\n  font     : string | obj.font || \"\";\r\n  style    : string | obj.font || \"\";\r\n  color    : string | \"\"+obj.color;\r\n  variant  : string | obj.variant || \"\";\r\n  weight   : string | \"\"+obj.weight;\r\n}\r\n`;\r\nnstructjs.register(CSSFont);\r\n\r\nexport function exportTheme(theme1 = theme, addVarDecl = true) {\r\n  let sortkeys = (obj) => {\r\n    let keys = [];\r\n    for (let k in obj) {\r\n      keys.push(k);\r\n    }\r\n    keys.sort();\r\n\r\n    return keys;\r\n  }\r\n\r\n  let s = addVarDecl ? \"var theme = {\\n\" : \"{\\n\";\r\n\r\n  function writekey(v, indent = \"\") {\r\n    if (typeof v === \"string\") {\r\n      if (v.search(\"\\n\") >= 0) {\r\n        v = \"`\" + v + \"`\";\r\n      } else {\r\n        v = \"'\" + v + \"'\";\r\n      }\r\n\r\n      return v;\r\n    } else if (typeof v === \"object\") {\r\n      if (v instanceof CSSFont) {\r\n        return `new CSSFont({\r\n${indent}  font    : ${writekey(v.font)},\r\n${indent}  weight  : ${writekey(v.weight)},\r\n${indent}  variant : ${writekey(v.variant)},\r\n${indent}  style   : ${writekey(v.style)},\r\n${indent}  size    : ${writekey(v._size)},\r\n${indent}  color   : ${writekey(v.color)}\r\n${indent}})`;\r\n      } else {\r\n        let s = \"{\\n\";\r\n\r\n        for (let k of sortkeys(v)) {\r\n          let v2 = v[k];\r\n\r\n          if (k.search(\" \") >= 0 || k.search(\"-\") >= 0) {\r\n            k = \"'\" + k + \"'\";\r\n          }\r\n\r\n          s += indent + \"  \" + k + \" : \" + writekey(v2, indent + \"  \") + \",\\n\";\r\n        }\r\n\r\n        s += indent + \"}\";\r\n        return s;\r\n      }\r\n    } else {\r\n      return \"\" + v;\r\n    }\r\n\r\n    return \"error\";\r\n  }\r\n\r\n  for (let k of sortkeys(theme1)) {\r\n    let k2 = k;\r\n\r\n    if (k.search(/[- \\t.]/) >= 0) {\r\n      k2 = \"'\" + k + \"'\";\r\n    }\r\n    s += \"  \" + k2 + \": \";\r\n\r\n    let v = theme1[k];\r\n    if (typeof v !== \"object\" || v instanceof CSSFont) {\r\n      s += writekey(v, \"  \") + \",\\n\";\r\n    } else {\r\n      s += \" {\\n\"\r\n      let s2 = \"\";\r\n\r\n      let maxwid = 0;\r\n\r\n      for (let k2 of sortkeys(v)) {\r\n        if (k2.search(\"-\") >= 0 || k2.search(\" \") >= 0) {\r\n          k2 = \"'\" + k2 + \"'\";\r\n        }\r\n\r\n        maxwid = Math.max(maxwid, k2.length);\r\n      }\r\n\r\n      for (let k2 of sortkeys(v)) {\r\n        let v2 = v[k2];\r\n\r\n        if (k2.search(\"-\") >= 0 || k2.search(\" \") >= 0) {\r\n          k2 = \"'\" + k2 + \"'\";\r\n        }\r\n\r\n        let pad = \"\";\r\n\r\n        for (let i = 0; i < maxwid - k2.length; i++) {\r\n          pad += \" \";\r\n        }\r\n\r\n        s2 += \"    \" + k2 + pad + \": \" + writekey(v2, \"    \") + \",\\n\";\r\n      }\r\n\r\n      s += s2;\r\n      s += \"  },\\n\\n\"\r\n    }\r\n  }\r\n  s += \"};\\n\";\r\n\r\n  return s;\r\n}\r\n\r\nwindow._exportTheme = exportTheme;\r\n\r\nexport function copyTheme(theme) {\r\n  if (theme instanceof CSSFont) {\r\n    return theme.copy();\r\n  }\r\n\r\n  let ret = {};\r\n  for (let k in theme) {\r\n    let v = theme[k];\r\n\r\n    if (typeof v === \"function\") {\r\n      continue;\r\n    }\r\n\r\n    if (typeof v === \"object\") {\r\n      ret[k] = copyTheme(v);\r\n    } else {\r\n      ret[k] = v;\r\n    }\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n","\"use strict\";\r\n\r\nimport * as util from './util.js';\r\nimport * as simple_events from './simple_events.js';\r\n\r\nexport {keymap, reverse_keymap, keymap_latin_1} from './simple_events.js';\r\n\r\nexport class EventDispatcher {\r\n  constructor() {\r\n    this._cbs = {};\r\n  }\r\n\r\n  _fireEvent(type, data) {\r\n    let stop = false;\r\n\r\n    data = {\r\n      stopPropagation() {\r\n        stop = true;\r\n      },\r\n\r\n      data : data\r\n    };\r\n\r\n    if (type in this._cbs) {\r\n      for (let cb of this._cbs[type]) {\r\n        cb(data);\r\n        if (stop) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  on(type, cb) {\r\n    if (!(type in this._cbs)) {\r\n      this._cbs[type] = [];\r\n    }\r\n\r\n    this._cbs[type].push(cb);\r\n    return this;\r\n  }\r\n\r\n  off(type, cb) {\r\n    if (!(type in this._cbs)) {\r\n      console.warn(\"event handler not in list\", type, cb);\r\n      return this;\r\n    }\r\n\r\n    let stack = this._cbs[type];\r\n    if (stack.indexOf(cb) < 0) {\r\n      console.warn(\"event handler not in list\", type, cb);\r\n      return this;\r\n    }\r\n\r\n    stack.remove(cb);\r\n    return this;\r\n  }\r\n}\r\nexport function copyMouseEvent(e) {\r\n  let ret = {};\r\n  \r\n  function bind(func, obj) {\r\n    return function() {\r\n      return this._orig.apply(func, arguments);\r\n    }\r\n  }\r\n  \r\n  let exclude = new Set([\r\n    //\"prototype\",\r\n    //\"constructor\",\r\n    \"__proto__\"\r\n  ]);\r\n  \r\n  ret._orig = e;\r\n  \r\n  for (let k in e) {\r\n    let v = e[k];\r\n    \r\n    if (exclude.has(k)) {\r\n      continue;\r\n    }\r\n    \r\n    if (typeof v == \"function\") {\r\n      v = bind(v);\r\n    }\r\n    \r\n    ret[k] = v;\r\n  }\r\n\r\n  ret.ctrlKey = e.ctrlKey;\r\n  ret.shiftKey = e.shiftKey;\r\n  ret.altKey = e.altKey;\r\n\r\n  for (let i=0; i<2; i++) {\r\n    let key = i ? \"targetTouches\" : \"touches\";\r\n\r\n    if (e[key]) {\r\n      ret[key] = [];\r\n\r\n      for (let t of e[key]) {\r\n        let t2 = {};\r\n        ret[key].push(t2);\r\n\r\n        for (let k in t) {\r\n          t2[k] = t[k];\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nexport const DomEventTypes = {\r\n  on_mousemove   : 'mousemove',\r\n  on_mousedown   : 'mousedown',\r\n  on_mouseup     : 'mouseup',\r\n  on_touchstart  : 'touchstart',\r\n  on_touchcancel : 'touchcanel',\r\n  on_touchmove   : 'touchmove',\r\n  on_touchend    : 'touchend',\r\n  on_mousewheel  : 'mousewheel',\r\n  on_keydown     : 'keydown',\r\n  on_keyup       : 'keyup',\r\n  on_pointerdown : 'pointerdown',\r\n  on_pointermove : 'pointermove',\r\n  on_pointercancel : 'pointercancel',\r\n  on_pointerup   : 'pointerup',\r\n\r\n  //on_keypress    : 'keypress'\r\n};\r\n\r\nfunction getDom(dom, eventtype) {\r\n  if (eventtype.startsWith(\"key\"))\r\n    return window;\r\n  return dom;\r\n}\r\n\r\nexport let modalStack = [];\r\nexport function isModalHead(owner) {\r\n  return modalStack.length === 0 ||\r\n         modalStack[modalStack.length-1] === owner;\r\n}\r\n\r\nexport class EventHandler {\r\n  constructor() {\r\n    this._modalstate = undefined;\r\n  }\r\n  pushPointerModal(dom, pointerId) {\r\n    if (this._modalstate) {\r\n      console.warn(\"pushPointerModal called twiced!\");\r\n      return;\r\n    }\r\n    \r\n    this._modalstate = simple_events.pushPointerModal(this, dom, pointerId);\r\n  }\r\n  pushModal(dom, _is_root) {\r\n    if (this._modalstate) {\r\n      console.warn(\"pushModal called twiced!\");\r\n      return;\r\n    }\r\n    \r\n    this._modalstate = simple_events.pushModalLight(this);\r\n  }\r\n  \r\n  popModal() {\r\n    if (this._modalstate !== undefined) {\r\n      let modalstate = this._modalstate;\r\n\r\n      //window.setTimeout(() => {\r\n        simple_events.popModalLight(modalstate);\r\n      //});\r\n\r\n      this._modalstate = undefined;\r\n    }\r\n  }\r\n}\r\n\r\nexport function pushModal(dom, handlers) {\r\n  console.warn(\"Deprecated call to pathux.events.pushModal; use api in simple_events.js instead\");\r\n  let h = new EventHandler();\r\n  \r\n  for (let k in handlers) {\r\n    h[k] = handlers[k];\r\n  }\r\n  \r\n  handlers.popModal = () => {\r\n    return h.popModal(dom);\r\n  }\r\n  \r\n  h.pushModal(dom, false);\r\n  \r\n  return h;\r\n}\r\n","import nstructjs from \"../util/struct.js\";\r\nimport * as util from '../util/util.js';\r\n\r\nexport const CurveConstructors = [];\r\nexport const CURVE_VERSION = 1.1;\r\n\r\nexport const CurveFlags = {\r\n  SELECT   : 1,\r\n  TRANSFORM: 2,\r\n};\r\n\r\n\r\nexport const TangentModes = {\r\n  SMOOTH: 1,\r\n  BREAK : 2\r\n};\r\n\r\nexport function getCurve(type, throw_on_error = true) {\r\n  for (let cls of CurveConstructors) {\r\n    if (cls.name === type)\r\n      return cls;\r\n    if (cls.define().name === type)\r\n      return cls;\r\n  }\r\n\r\n  if (throw_on_error) {\r\n    throw new Error(\"Unknown curve type \" + type)\r\n  } else {\r\n    console.warn(\"Unknown curve type\", type);\r\n    return getCurve(\"ease\");\r\n  }\r\n}\r\n\r\nlet _udigest = new util.HashDigest();\r\n\r\nexport class CurveTypeData {\r\n  constructor() {\r\n    this.type = this.constructor.define().typeName;\r\n    this.parent = undefined;\r\n  }\r\n\r\n  get hasGUI() {\r\n    throw new Error(\"get hasGUI(): implement me!\");\r\n  }\r\n\r\n  static register(cls) {\r\n    if (cls.define === CurveTypeData.define) {\r\n      throw new Error(\"missing define() static method\");\r\n    }\r\n\r\n    let def = cls.define();\r\n\r\n    if (!def.name) {\r\n      throw new Error(cls.name + \".define() result is missing 'name' field\");\r\n    }\r\n\r\n    if (!def.typeName) {\r\n      throw new Error(cls.name + \".define() is missing .typeName, which should equal class name; needed for minificaiton\");\r\n    }\r\n\r\n    CurveConstructors.push(cls);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      uiname  : \"Some Curve\",\r\n      name    : \"somecurve\",\r\n      typeName: \"CurveTypeData\"\r\n    }\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    let d = digest;\r\n\r\n    d.add(this.type);\r\n\r\n    return d.get();\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      type: this.type\r\n    }\r\n  }\r\n\r\n  equals(b) {\r\n    return this.type === b.type;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    this.type = obj.type;\r\n\r\n    return this;\r\n  }\r\n\r\n  redraw() {\r\n    if (this.parent)\r\n      this.parent.redraw();\r\n  }\r\n\r\n  makeGUI(container) {\r\n\r\n  }\r\n\r\n  killGUI(container) {\r\n    container.clear();\r\n  }\r\n\r\n  evaluate(s) {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  integrate(s1, quadSteps = 64) {\r\n    let ret = 0.0, ds = s1/quadSteps;\r\n\r\n    for (let i = 0, s = 0; i < quadSteps; i++, s += ds) {\r\n      ret += this.evaluate(s)*ds;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  derivative(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.evaluate(s) - this.evaluate(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.evaluate(s + df) - this.evaluate(s))/df;\r\n    } else {\r\n      return (this.evaluate(s + df) - this.evaluate(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  derivative2(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.derivative(s) - this.derivative(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.derivative(s + df) - this.derivative(s))/df;\r\n    } else {\r\n      return (this.derivative(s + df) - this.derivative(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  inverse(y) {\r\n    let steps = 9;\r\n    let ds = 1.0/steps, s = 0.0;\r\n    let best = undefined;\r\n    let ret = undefined;\r\n\r\n    for (let i = 0; i < steps; i++, s += ds) {\r\n      let s1 = s, s2 = s + ds;\r\n\r\n      let mid;\r\n\r\n      for (let j = 0; j < 11; j++) {\r\n        let y1 = this.evaluate(s1);\r\n        let y2 = this.evaluate(s2);\r\n        mid = (s1 + s2)*0.5;\r\n\r\n        if (Math.abs(y1 - y) < Math.abs(y2 - y)) {\r\n          s2 = mid;\r\n        } else {\r\n          s1 = mid;\r\n        }\r\n      }\r\n\r\n      let ymid = this.evaluate(mid);\r\n\r\n      if (best === undefined || Math.abs(y - ymid) < best) {\r\n        best = Math.abs(y - ymid);\r\n        ret = mid;\r\n      }\r\n    }\r\n\r\n    return ret === undefined ? 0.0 : ret;\r\n  }\r\n\r\n  onActive(parent, draw_transform) {\r\n  }\r\n\r\n  onInactive(parent, draw_transform) {\r\n  }\r\n\r\n  reset() {\r\n\r\n  }\r\n\r\n  destroy() {\r\n  }\r\n\r\n  update() {\r\n    if (this.parent)\r\n      this.parent._on_change();\r\n  }\r\n\r\n  draw(canvas, g, draw_transform) {\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n  }\r\n}\r\n\r\nCurveTypeData.STRUCT = `\r\nCurveTypeData {\r\n  type : string;\r\n}\r\n`;\r\nnstructjs.register(CurveTypeData);\r\n\r\n\r\nconst unitRange = [0, 1];\r\n\r\nexport function evalHermiteTable(table, t, range = unitRange) {\r\n  t = (t - range[0])/(range[1] - range[0]);\r\n\r\n  let s = t*(table.length/4);\r\n  let i = Math.floor(s);\r\n\r\n  s -= i;\r\n  i *= 4;\r\n\r\n  let a = table[i] + (table[i + 1] - table[i])*s;\r\n  let b = table[i + 2] + (table[i + 3] - table[i + 2])*s;\r\n\r\n  return a + (b - a)*s;\r\n  //return table[i] + (table[i + 3] - table[i])*s;\r\n}\r\n\r\nexport function genHermiteTable(evaluate, steps, range = [0, 1]) {\r\n  //console.log(\"building spline approx\");\r\n\r\n  let table = new Array(steps);\r\n\r\n  let [min, max] = range;\r\n\r\n  let eps = 0.0001;\r\n  let dt = ((max - min) - eps*4.001)/(steps - 1);\r\n  let t = min + eps*4;\r\n  let lastdv1, lastf3;\r\n\r\n  for (let j = 0; j < steps; j++, t += dt) {\r\n    //let f1 = evaluate(t - eps*2);\r\n    let f2 = evaluate(t - eps);\r\n    let f3 = evaluate(t);\r\n    let f4 = evaluate(t + eps);\r\n    //let f5 = evaluate(t + eps*2);\r\n\r\n    let dv1 = (f4 - f2)/(eps*2);\r\n    dv1 /= steps;\r\n\r\n    if (j > 0) {\r\n      let j2 = j - 1;\r\n\r\n      table[j2*4] = lastf3;\r\n      table[j2*4 + 1] = lastf3 + lastdv1/3.0;\r\n      table[j2*4 + 2] = f3 - dv1/3.0;\r\n      table[j2*4 + 3] = f3;\r\n    }\r\n\r\n    lastdv1 = dv1;\r\n    lastf3 = f3;\r\n  }\r\n\r\n  return table;\r\n}\r\n","import {PropFlags, PropTypes} from '../toolsys/toolprop_abstract.js';\r\nimport {Quat, Vector2, Vector3, Vector4} from '../util/vectormath.js';\r\nimport * as toolprop_abstract from '../toolsys/toolprop_abstract.js';\r\nimport * as toolprop from '../toolsys/toolprop.js';\r\nimport {print_stack, cachering} from '../util/util.js';\r\nimport {ToolProperty} from '../toolsys/toolprop.js';\r\n\r\nexport const DataFlags = {\r\n  READ_ONLY              : 1,\r\n  USE_CUSTOM_GETSET      : 2,\r\n  USE_FULL_UNDO          : 4, //DataPathSetOp in controller_ops.js saves/loads entire file for undo/redo\r\n  USE_CUSTOM_PROP_GETTER : 8,\r\n  USE_EVAL_MASS_SET_PATHS: 16,\r\n};\r\n\r\n\r\nexport const DataTypes = {\r\n  STRUCT        : 0,\r\n  DYNAMIC_STRUCT: 1,\r\n  PROP          : 2,\r\n  ARRAY         : 3\r\n};\r\n\r\nlet propCacheRings = {};\r\n\r\nexport function getTempProp(type) {\r\n  if (!(type in propCacheRings)) {\r\n    propCacheRings[type] = cachering.fromConstructor(ToolProperty.getClass(type), 32);\r\n  }\r\n\r\n  return propCacheRings[type].next();\r\n}\r\n\r\nexport class DataPathError extends Error {\r\n};\r\n\r\n\r\nexport function getVecClass(proptype) {\r\n  switch (proptype) {\r\n    case PropTypes.VEC2:\r\n      return Vector2;\r\n    case PropTypes.VEC3:\r\n      return Vector3;\r\n    case PropTypes.VEC4:\r\n      return Vector4;\r\n    case PropTypes.QUAT:\r\n      return Quat;\r\n    default:\r\n      throw new Error(\"bad prop type \" + proptype);\r\n  }\r\n}\r\n\r\nexport function isVecProperty(prop) {\r\n  if (!prop || typeof prop !== \"object\" || prop === null)\r\n    return false;\r\n\r\n  let ok = false;\r\n\r\n  ok = ok || prop instanceof toolprop_abstract.Vec2PropertyIF;\r\n  ok = ok || prop instanceof toolprop_abstract.Vec3PropertyIF;\r\n  ok = ok || prop instanceof toolprop_abstract.Vec4PropertyIF;\r\n  ok = ok || prop instanceof toolprop.Vec2Property;\r\n  ok = ok || prop instanceof toolprop.Vec3Property;\r\n  ok = ok || prop instanceof toolprop.Vec4Property;\r\n\r\n  ok = ok || prop.type === PropTypes.VEC2;\r\n  ok = ok || prop.type === PropTypes.VEC3;\r\n  ok = ok || prop.type === PropTypes.VEC4;\r\n  ok = ok || prop.type === PropTypes.QUAT;\r\n\r\n  return ok;\r\n}\r\n\r\nexport class DataPath {\r\n  constructor(path, apiname, prop, type = DataTypes.PROP) {\r\n    this.type = type;\r\n    this.data = prop;\r\n    this.apiname = apiname;\r\n    this.path = path;\r\n    this.flag = 0;\r\n    this.struct = undefined;\r\n\r\n    if (type === DataTypes.PROP && this.data && (\"\" + this.data.uiname).trim().length === 0) {\r\n      this.data.uiname = ToolProperty.makeUIName(apiname);\r\n    }\r\n  }\r\n\r\n   /**\r\n   * Provide a callback to update an enum or flags property dynamically\r\n   * Callback should call enumProp.updateDefinition to update the property.\r\n   *\r\n   * @param metaCB: (enumProp: EnumProperty|FlagsProperty) => void\r\n   */\r\n   dynamicMeta(metaCB) {\r\n     this.data.dynamicMeta(metaCB)\r\n     return this\r\n   }\r\n\r\n  evalMassSetFilter() {\r\n    this.flag |= DataFlags.USE_EVAL_MASS_SET_PATHS;\r\n    return this;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new DataPath();\r\n\r\n    ret.flag = this.flag;\r\n    ret.type = this.type;\r\n    ret.data = this.data;\r\n    ret.apiname = this.apiname;\r\n    ret.path = this.path;\r\n    ret.struct = this.struct;\r\n\r\n    return ret;\r\n  }\r\n\r\n  /** this property should not be treated as something\r\n   *  that should be kept track off in the undo stack*/\r\n  noUndo() {\r\n    this.data.flag |= PropFlags.NO_UNDO;\r\n    return this;\r\n  }\r\n\r\n  setProp(prop) {\r\n    this.data = prop;\r\n  }\r\n\r\n  readOnly() {\r\n    this.flag |= DataFlags.READ_ONLY;\r\n\r\n    if (this.type === DataTypes.PROP) {\r\n      this.data.flag |= PropFlags.READ_ONLY;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  read_only() {\r\n    console.warn(\"DataPath.read_only is deprecated; use readOnly\");\r\n    return this.readOnly();\r\n  }\r\n\r\n  /** used to override tool property settings,\r\n   *  e.g. ranges, units, etc; returns a\r\n   *  base class instance of ToolProperty.\r\n   *\r\n   *  The this context points to the original ToolProperty and contains\r\n   *  a few useful references:\r\n   *\r\n   *  this.dataref - an object instance of this struct type\r\n   *  this.ctx - a context\r\n   *\r\n   *  callback takes one argument, a new (freshly copied of original)\r\n   *  tool property to modify\r\n   *\r\n   * */\r\n  customPropCallback(callback) {\r\n    this.flag |= DataFlags.USE_CUSTOM_PROP_GETTER;\r\n    this.data.flag |= PropFlags.USE_CUSTOM_PROP_GETTER;\r\n    this.propGetter = callback;\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * For the callbacks 'this' points to an internal ToolProperty;\r\n   * Referencing object lives in 'this.dataref'; calling context in 'this.ctx';\r\n   * and the datapath is 'this.datapath'\r\n   **/\r\n  customGetSet(get, set) {\r\n    this.flag |= DataFlags.USE_CUSTOM_GETSET;\r\n\r\n    if (this.type !== DataTypes.DYNAMIC_STRUCT && this.type !== DataTypes.STRUCT) {\r\n      this.data.flag |= PropFlags.USE_CUSTOM_GETSET;\r\n      this.data._getValue = this.data.getValue;\r\n      this.data._setValue = this.data.setValue;\r\n\r\n      if (get)\r\n        this.data.getValue = get;\r\n\r\n      if (set)\r\n        this.data.setValue = set;\r\n    } else {\r\n      this.getSet = {\r\n        get, set\r\n      };\r\n\r\n      this.getSet.dataref = undefined;\r\n      this.getSet.datapath = undefined;\r\n      this.getSet.ctx = undefined;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  customSet(set) {\r\n    this.customGetSet(undefined, set);\r\n    return this;\r\n  }\r\n\r\n  customGet(get) {\r\n    this.customGetSet(get, undefined);\r\n    return this;\r\n  }\r\n\r\n  /**db will be executed with underlying data object\r\n   that contains this path in 'this.dataref'\r\n\r\n   main event is 'change'\r\n   */\r\n  on(type, cb) {\r\n    if (this.type == DataTypes.PROP) {\r\n      this.data.on(type, cb);\r\n    } else {\r\n      throw new Error(\"invalid call to DataPath.on\");\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  off(type, cb) {\r\n    if (this.type === DataTypes.PROP) {\r\n      this.data.off(type, cb);\r\n    }\r\n  }\r\n\r\n  simpleSlider() {\r\n    this.data.flag |= PropFlags.SIMPLE_SLIDER;\r\n    this.data.flag &= ~PropFlags.FORCE_ROLLER_SLIDER;\r\n    return this;\r\n  }\r\n\r\n  rollerSlider() {\r\n    this.data.flag &= ~PropFlags.SIMPLE_SLIDER;\r\n    this.data.flag |= PropFlags.FORCE_ROLLER_SLIDER;\r\n\r\n    return this;\r\n  }\r\n\r\n  checkStrip(state = true) {\r\n    if (state) {\r\n      this.data.flag |= PropFlags.FORCE_ENUM_CHECKBOXES;\r\n    } else {\r\n      this.data.flag &= ~PropFlags.FORCE_ENUM_CHECKBOXES;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  noUnits() {\r\n    this.baseUnit(\"none\");\r\n    this.displayUnit(\"none\");\r\n    return this;\r\n  }\r\n\r\n  baseUnit(unit) {\r\n    this.data.setBaseUnit(unit);\r\n    return this;\r\n  }\r\n\r\n  displayUnit(unit) {\r\n    this.data.setDisplayUnit(unit);\r\n    return this;\r\n  }\r\n\r\n  unit(unit) {\r\n    return this.baseUnit(unit).displayUnit(unit);\r\n  }\r\n\r\n  editAsBaseUnit() {\r\n    this.data.flag |= PropFlags.EDIT_AS_BASE_UNIT;\r\n    return this;\r\n  }\r\n\r\n  range(min, max) {\r\n    this.data.setRange(min, max);\r\n    return this;\r\n  }\r\n\r\n  uiRange(min, max) {\r\n    this.data.setUIRange(min, max);\r\n    return this;\r\n  }\r\n\r\n  decimalPlaces(n) {\r\n    this.data.setDecimalPlaces(n);\r\n    return this;\r\n  }\r\n\r\n  sliderDisplayExp(f) {\r\n    this.data.setSliderDisplayExp(f);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * like other callbacks (until I refactor it),\r\n   * func will be called with a mysterious object that stores\r\n   * the following properties:\r\n   *\r\n   * this.dataref  : owning object reference\r\n   * this.datactx  : ctx\r\n   * this.datapath : datapath\r\n   * */\r\n  uiNameGetter(func) {\r\n    this.ui_name_get = func;\r\n    return this;\r\n  }\r\n\r\n  expRate(exp) {\r\n    this.data.setExpRate(exp);\r\n    return this;\r\n  }\r\n\r\n  slideSpeed(speed) {\r\n    this.data.setSlideSpeed(speed);\r\n    return this;\r\n  }\r\n\r\n  /**adds a slider for moving vector component sliders simultaneously*/\r\n  uniformSlider(state = true) {\r\n    this.data.uniformSlider(state);\r\n\r\n    return this;\r\n  }\r\n\r\n  radix(r) {\r\n    this.data.setRadix(r);\r\n    return this;\r\n  }\r\n\r\n  relativeStep(s) {\r\n    this.data.setRelativeStep(s);\r\n    return this;\r\n  }\r\n\r\n  step(s) {\r\n    this.data.setStep(s);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Tell DataPathSetOp to save/load entire app state for undo/redo\r\n   *\r\n   * */\r\n  fullSaveUndo() {\r\n    this.flag |= DataFlags.USE_FULL_UNDO;\r\n    this.data.flag |= PropFlags.USE_BASE_UNDO;\r\n\r\n    return this;\r\n  }\r\n\r\n  icon(i) {\r\n    this.data.setIcon(i);\r\n    return this;\r\n  }\r\n\r\n  icon2(i) {\r\n    this.data.setIcon2(i);\r\n    return this;\r\n  }\r\n\r\n  icons(icons) { //for enum/flag properties\r\n    this.data.addIcons(icons);\r\n    return this;\r\n  }\r\n\r\n  /** secondary icons (e.g. disabled states) */\r\n  icons2(icons) {\r\n    this.data.addIcons2(icons);\r\n    return this;\r\n  }\r\n\r\n  descriptions(description_map) { //for enum/flag properties\r\n    this.data.addDescriptions(description_map);\r\n    return this;\r\n  }\r\n\r\n  uiNames(uinames) {\r\n    this.data.addUINames(uinames);\r\n    return this;\r\n  }\r\n\r\n  description(d) {\r\n    this.data.description = d;\r\n    return this;\r\n  }\r\n}\r\n\r\nexport const StructFlags = {\r\n  NO_UNDO: 1 //struct and its child structs can't participate in undo\r\n             //via the DataPathToolOp\r\n};\r\n\r\nexport class ListIface {\r\n  getStruct(api, list, key) {\r\n\r\n  }\r\n\r\n  get(api, list, key) {\r\n\r\n  }\r\n\r\n  getKey(api, list, obj) {\r\n\r\n  }\r\n\r\n  getActive(api, list) {\r\n\r\n  }\r\n\r\n  setActive(api, list, val) {\r\n\r\n  }\r\n\r\n  set(api, list, key, val) {\r\n    list[key] = val;\r\n  }\r\n\r\n  getIter() {\r\n\r\n  }\r\n\r\n  filter(api, list, filter) {\r\n\r\n  }\r\n}\r\n\r\nexport class ToolOpIface {\r\n  constructor() {\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"!untitled tool\",\r\n      icon       : -1,\r\n      toolpath   : \"logical_module.tool\", //logical_module need not match up to real module name\r\n      description: undefined,\r\n      is_modal   : false,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n};\r\n\r\n\r\nlet DataAPIClass = undefined;\r\n\r\nexport function setImplementationClass(cls) {\r\n  DataAPIClass = cls;\r\n}\r\n\r\nexport function registerTool(cls) {\r\n  if (DataAPIClass === undefined) {\r\n    throw new Error(\"data api not initialized properly; call setImplementationClass\");\r\n  }\r\n\r\n  return DataAPIClass.registerTool(cls);\r\n}\r\n","/**\r\n see doc_src/context.md\r\n */\r\n\r\nimport * as util from '../util/util.js';\r\n\r\nimport cconst from '../config/config.js';\r\n\r\nlet notifier = undefined;\r\n\r\nexport function setNotifier(cls) {\r\n  notifier = cls;\r\n}\r\n\r\nexport const ContextFlags = {\r\n  IS_VIEW : 1\r\n};\r\n\r\nclass InheritFlag {\r\n  constructor(data) {\r\n    this.data = data;\r\n  }\r\n}\r\n\r\nlet __idgen = 1;\r\n\r\nif (Symbol.ContextID === undefined) {\r\n  Symbol.ContextID = Symbol(\"ContextID\");\r\n}\r\n\r\nif (Symbol.CachedDef === undefined) {\r\n  Symbol.CachedDef = Symbol(\"CachedDef\");\r\n}\r\n\r\nconst _ret_tmp = [undefined];\r\n\r\nexport const OverlayClasses = [];\r\n\r\nexport function makeDerivedOverlay(parent) {\r\n  return class ContextOverlay extends parent {\r\n    constructor(appstate) {\r\n      super(appstate);\r\n\r\n      this.ctx = undefined; //owning context\r\n      this._state = appstate;\r\n    }\r\n\r\n    get state() {\r\n      return this._state;\r\n    }\r\n\r\n    set state(state) {\r\n      this._state = state;\r\n    }\r\n\r\n    onRemove(have_new_file = false) {\r\n    }\r\n\r\n    copy() {\r\n      return new this.constructor(this._state);\r\n    }\r\n\r\n    validate() {\r\n      throw new Error(\"Implement me!\");\r\n    }\r\n\r\n\r\n    //base classes override this\r\n    static contextDefine() {\r\n      throw new Error(\"implement me!\");\r\n      return {\r\n        name: \"\",\r\n        flag: 0\r\n      }\r\n    }\r\n\r\n    //don't override this\r\n    static resolveDef() {\r\n      if (this.hasOwnProperty(Symbol.CachedDef)) {\r\n        return this[Symbol.CachedDef];\r\n      }\r\n\r\n      let def2 = Symbol.CachedDef = {};\r\n\r\n      let def = this.contextDefine();\r\n\r\n      if (def === undefined) {\r\n        def = {};\r\n      }\r\n\r\n      for (let k in def) {\r\n        def2[k] = def[k];\r\n      }\r\n\r\n      if (!(\"flag\" in def)) {\r\n        def2.flag = Context.inherit(0);\r\n      }\r\n\r\n      let parents = [];\r\n      let p = util.getClassParent(this);\r\n\r\n      while (p && p !== ContextOverlay) {\r\n        parents.push(p);\r\n        p = util.getClassParent(p);\r\n      }\r\n\r\n      if (def2.flag instanceof InheritFlag) {\r\n        let flag = def2.flag.data;\r\n        for (let p of parents) {\r\n          let def = p.contextDefine();\r\n\r\n          if (!def.flag) {\r\n            continue;\r\n          } else if (def.flag instanceof InheritFlag) {\r\n            flag |= def.flag.data;\r\n          } else {\r\n            flag |= def.flag;\r\n            //don't go past non-inheritable parents\r\n            break;\r\n          }\r\n        }\r\n\r\n        def2.flag = flag;\r\n      }\r\n\r\n      return def2;\r\n    }\r\n  };\r\n}\r\n\r\nexport const ContextOverlay = makeDerivedOverlay(Object);\r\n\r\nexport const excludedKeys = new Set([\"onRemove\", \"reset\", \"toString\", \"_fix\",\r\n                                     \"valueOf\", \"copy\", \"next\", \"save\", \"load\", \"clear\", \"hasOwnProperty\",\r\n                                     \"toLocaleString\", \"constructor\", \"propertyIsEnumerable\", \"isPrototypeOf\",\r\n                                     \"state\", \"saveProperty\", \"loadProperty\", \"getOwningOverlay\", \"_props\"]);\r\n\r\nexport class LockedContext {\r\n  constructor(ctx, noWarnings) {\r\n    this.props = {};\r\n\r\n    this.state = ctx.state;\r\n    this.api = ctx.api;\r\n    this.toolstack = ctx.toolstack;\r\n\r\n    this.noWarnings = noWarnings;\r\n\r\n    this.load(ctx);\r\n  }\r\n\r\n  toLocked() {\r\n    //just return itself\r\n    return this;\r\n  }\r\n\r\n  error() {\r\n    return this.ctx.error(...arguments);\r\n  }\r\n  warning() {\r\n    return this.ctx.warning(...arguments);\r\n  }\r\n  message() {\r\n    return this.ctx.message(...arguments);\r\n  }\r\n  progbar() {\r\n    return this.ctx.progbar(...arguments);\r\n  }\r\n  progressBar() {\r\n    return this.ctx.progbar !== undefined ? this.ctx.progbar(...arguments) : this.ctx.progressBar(...arguments);\r\n  }\r\n  load(ctx) {\r\n    //let keys = util.getAllKeys(ctx);\r\n    let keys = ctx._props;\r\n\r\n    function wrapget(name) {\r\n      return function(ctx2, data) {\r\n        return ctx.loadProperty(ctx2, name, data);\r\n      }\r\n    }\r\n\r\n    for (let k of keys) {\r\n      let v;\r\n      if (k === \"state\" || k === \"toolstack\" || k === \"api\") {\r\n        continue;\r\n      }\r\n\r\n      if (typeof k === \"string\" && (k.endsWith(\"_save\") || k.endsWith(\"_load\"))) {\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        v = ctx[k];\r\n      } catch (error) {\r\n        if (cconst.DEBUG.contextSystem) {\r\n          console.warn(\"failed to look up property in context: \", k);\r\n        }\r\n        continue;\r\n      }\r\n\r\n      let data, getter;\r\n      let overlay = ctx.getOwningOverlay(k);\r\n\r\n      if (overlay === undefined) {\r\n        //property must no longer be used?\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        if (typeof k === \"string\" && (overlay[k + \"_save\"] && overlay[k + \"_load\"])) {\r\n          data = overlay[k + \"_save\"]();\r\n          getter = overlay[k + \"_load\"];\r\n        } else {\r\n          data = ctx.saveProperty(k);\r\n          getter = wrapget(k);\r\n        }\r\n      } catch (error) {\r\n        //util.print_stack(error);\r\n        console.warn(\"Failed to save context property\", k);\r\n        continue;\r\n      }\r\n\r\n      this.props[k] = {\r\n        data : data,\r\n        get  : getter\r\n      };\r\n    }\r\n\r\n    let defineProp = (name) => {\r\n      Object.defineProperty(this, name, {\r\n        get : function() {\r\n          let def = this.props[name];\r\n          return def.get(this.ctx, def.data)\r\n        }\r\n      })\r\n    };\r\n\r\n    for (let k in this.props) {\r\n      defineProp(k);\r\n    }\r\n\r\n    this.ctx = ctx;\r\n  }\r\n\r\n  setContext(ctx) {\r\n    this.ctx = ctx;\r\n\r\n    this.state = ctx.state;\r\n    this.api = ctx.api;\r\n    this.toolstack = ctx.toolstack;\r\n  }\r\n}\r\n\r\nlet next_key = {};\r\nlet idgen = 1;\r\n\r\nexport class Context {\r\n  constructor(appstate) {\r\n    this.state = appstate;\r\n\r\n    this._props = new Set();\r\n    this._stack = [];\r\n    this._inside_map = {};\r\n  }\r\n\r\n  static isContextSubclass(cls) {\r\n    while (cls) {\r\n      if (cls === Context) {\r\n        return true;\r\n      }\r\n\r\n      cls = cls.__proto__;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  /** chrome's debug console corrupts this._inside_map,\r\n   this method fixes it*/\r\n  _fix() {\r\n    this._inside_map = {};\r\n  }\r\n\r\n  fix() {\r\n    this._fix();\r\n  }\r\n\r\n  error(message, timeout=1500) {\r\n    let state = this.state;\r\n\r\n    console.warn(message);\r\n\r\n    if (state && state.screen) {\r\n      return notifier.error(state.screen, message, timeout);\r\n    }\r\n  }\r\n\r\n  warning(message, timeout=1500) {\r\n    let state = this.state;\r\n\r\n    console.warn(message);\r\n\r\n    if (state && state.screen) {\r\n      return notifier.warning(state.screen, message, timeout);\r\n    }\r\n  }\r\n\r\n  message(msg, timeout=1500) {\r\n    let state = this.state;\r\n\r\n    console.warn(msg);\r\n\r\n    if (state && state.screen) {\r\n      return notifier.message(state.screen, msg, timeout);\r\n    }\r\n  }\r\n\r\n  progbar(msg, perc=0.0, timeout=1500, id=msg) {\r\n    let state = this.state;\r\n\r\n    if (state && state.screen) {\r\n      //progbarNote(screen, msg, percent, color, timeout) {\r\n      return notifier.progbarNote(state.screen, msg, perc, \"green\", timeout, id);\r\n    }\r\n  }\r\n\r\n  validateOverlays() {\r\n    let stack = this._stack;\r\n    let stack2 = [];\r\n\r\n    for (let i=0; i<stack.length; i++) {\r\n      if (stack[i].validate()) {\r\n        stack2.push(stack[i]);\r\n      }\r\n    }\r\n\r\n    this._stack = stack2;\r\n  }\r\n\r\n  hasOverlay(cls) {\r\n    return this.getOverlay(cls) !== undefined;\r\n  }\r\n\r\n  getOverlay(cls) {\r\n    for (let overlay of this._stack) {\r\n      if (overlay.constructor === cls) {\r\n        return overlay;\r\n      }\r\n    }\r\n  }\r\n\r\n  clear(have_new_file=false) {\r\n    for (let overlay of this._stack) {\r\n      overlay.onRemove(have_new_file);\r\n    }\r\n\r\n    this._stack = [];\r\n  }\r\n\r\n  //this is implemented by child classes\r\n  //it should load the same default overlays as in constructor\r\n  reset(have_new_file=false) {\r\n    this.clear(have_new_file);\r\n  }\r\n\r\n  //returns a new context with overriden properties\r\n  //unlike pushOverlay, overrides can be a simple object\r\n  override(overrides) {\r\n    if (overrides.copy === undefined) {\r\n      overrides.copy = function() {\r\n        return Object.assign({}, this);\r\n      }\r\n    }\r\n\r\n    let ctx = this.copy();\r\n    ctx.pushOverlay(overrides);\r\n    return ctx;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new this.constructor(this.state);\r\n\r\n    for (let item of this._stack) {\r\n      ret.pushOverlay(item.copy());\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   Used by overlay property getters.  If returned,\r\n   the next overlay in the struct will have its getter used.\r\n\r\n   Example:\r\n\r\n   class overlay {\r\n      get scene() {\r\n        if (some_reason) {\r\n          return Context.super();\r\n        }\r\n\r\n        return something_else;\r\n      }\r\n    }\r\n   */\r\n  static super() {\r\n    return next_key;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * saves a property into some kind of non-object-reference form\r\n   *\r\n   * */\r\n  saveProperty(key) {\r\n    //console.warn(\"Missing saveProperty implementation in Context; passing through values...\", key)\r\n    return this[key];\r\n  }\r\n\r\n  /**\r\n   *\r\n   * lookup property based on saved data\r\n   *\r\n   * */\r\n  loadProperty(ctx, key, data) {\r\n    //console.warn(\"Missing loadProperty implementation in Context; passing through values...\", key)\r\n    return data;\r\n  }\r\n\r\n  getOwningOverlay(name, _val_out) {\r\n    let inside_map = this._inside_map;\r\n    let stack = this._stack;\r\n\r\n    if (cconst.DEBUG.contextSystem) {\r\n      console.log(name, inside_map);\r\n    }\r\n\r\n    for (let i=stack.length-1; i >= 0; i--) {\r\n      let overlay = stack[i];\r\n      let ret = next_key;\r\n\r\n      if (overlay[Symbol.ContextID] === undefined) {\r\n        throw new Error(\"context corruption\");\r\n      }\r\n\r\n      let ikey = overlay[Symbol.ContextID];\r\n\r\n      if (cconst.DEBUG.contextSystem) {\r\n        console.log(ikey, overlay);\r\n      }\r\n\r\n      //prevent infinite recursion\r\n      if (inside_map[ikey]) {\r\n        continue;\r\n      }\r\n\r\n      if (overlay.__allKeys.has(name)) {\r\n        if (cconst.DEBUG.contextSystem) {\r\n          console.log(\"getting value\");\r\n        }\r\n\r\n        //Chrome's console messes this up\r\n\r\n        inside_map[ikey] = 1;\r\n\r\n        try {\r\n          ret = overlay[name];\r\n        } catch (error) {\r\n\r\n          inside_map[ikey] = 0;\r\n          throw error;\r\n        }\r\n\r\n        inside_map[ikey] = 0;\r\n      }\r\n\r\n      if (ret !== next_key) {\r\n        if (_val_out !== undefined) {\r\n          _val_out[0] = ret;\r\n        }\r\n        return overlay;\r\n      }\r\n    }\r\n\r\n    if (_val_out !== undefined) {\r\n      _val_out[0] = undefined;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  ensureProperty(name) {\r\n    if (this.hasOwnProperty(name)) {\r\n      return;\r\n    }\r\n\r\n    this._props.add(name);\r\n\r\n    Object.defineProperty(this, name, {\r\n      get : function() {\r\n        let ret = _ret_tmp;\r\n        _ret_tmp[0] = undefined;\r\n\r\n        this.getOwningOverlay(name, ret);\r\n        return ret[0];\r\n      }, set : function() {\r\n        throw new Error(\"Cannot set ctx properties\")\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Returns a new context that doesn't\r\n   * contain any direct object references\r\n   * except for .state .datalib and .api, but\r\n   * instead uses those three to look up references\r\n   * on property access.\r\n   * */\r\n  toLocked() {\r\n    return new LockedContext(this);\r\n  }\r\n\r\n  pushOverlay(overlay) {\r\n    if (!overlay.hasOwnProperty(Symbol.ContextID)) {\r\n      overlay[Symbol.ContextID] = idgen++;\r\n    }\r\n\r\n    let keys = new Set();\r\n    for (let key of util.getAllKeys(overlay)) {\r\n      if (!excludedKeys.has(key) && !(typeof key === \"string\" && key[0] === \"_\")) {\r\n        keys.add(key);\r\n      }\r\n    }\r\n\r\n    overlay.ctx = this;\r\n\r\n    if (overlay.__allKeys === undefined) {\r\n      overlay.__allKeys = keys;\r\n    }\r\n\r\n    for (let k of keys) {\r\n      let bad = typeof k === \"symbol\" || excludedKeys.has(k);\r\n      bad = bad || (typeof k === \"string\" && k[0] === \"_\");\r\n      bad = bad || (typeof k === \"string\" && k.endsWith(\"_save\"));\r\n      bad = bad || (typeof k === \"string\" && k.endsWith(\"_load\"));\r\n\r\n      if (bad) {\r\n        continue;\r\n      }\r\n\r\n      this.ensureProperty(k);\r\n    }\r\n\r\n    if (this._stack.indexOf(overlay) >= 0) {\r\n      console.warn(\"Overlay already added once\");\r\n      if (this._stack[this._stack.length-1] === overlay) {\r\n        console.warn(\"  Definitely an error, overlay is already at top of stack\");\r\n        return;\r\n      }\r\n    }\r\n\r\n    this._stack.push(overlay);\r\n  }\r\n\r\n  popOverlay(overlay) {\r\n    if (overlay !== this._stack[this._stack.length-1]) {\r\n      console.warn(\"Context.popOverlay called in error\", overlay);\r\n      return;\r\n    }\r\n\r\n    overlay.onRemove();\r\n    this._stack.pop();\r\n  }\r\n\r\n  removeOverlay(overlay) {\r\n    if (this._stack.indexOf(overlay) < 0) {\r\n      console.warn(\"Context.removeOverlay called in error\", overlay);\r\n      return;\r\n    }\r\n\r\n    overlay.onRemove();\r\n    this._stack.remove(overlay);\r\n  }\r\n\r\n  static inherit(data) {\r\n    return new InheritFlag(data);\r\n  }\r\n\r\n  static register(cls) {\r\n    if (cls[Symbol.ContextID]) {\r\n      console.warn(\"Tried to register same class twice:\", cls);\r\n      return;\r\n    }\r\n\r\n    cls[Symbol.ContextID] = __idgen++;\r\n    OverlayClasses.push(cls);\r\n  }\r\n}\r\n\r\nexport function test() {\r\n  function testInheritance() {\r\n    class Test0 extends ContextOverlay {\r\n      static contextDefine() {\r\n        return {\r\n          flag: 1\r\n        }\r\n      }\r\n    }\r\n\r\n    class Test1 extends Test0 {\r\n      static contextDefine() {\r\n        return {\r\n          flag: 2\r\n        }\r\n      }\r\n    }\r\n\r\n    class Test2 extends Test1 {\r\n      static contextDefine() {\r\n        return {\r\n          flag: Context.inherit(4)\r\n        }\r\n      }\r\n    }\r\n\r\n    class Test3 extends Test2 {\r\n      static contextDefine() {\r\n        return {\r\n          flag: Context.inherit(8)\r\n        }\r\n      }\r\n    }\r\n\r\n    class Test4 extends Test3 {\r\n      static contextDefine() {\r\n        return {\r\n          flag: Context.inherit(16)\r\n        }\r\n      }\r\n    }\r\n\r\n    return Test4.resolveDef().flag === 30;\r\n  }\r\n\r\n  return testInheritance();\r\n}\r\n\r\nif (!test()) {\r\n  throw new Error(\"Context test failed\");\r\n}\r\n","\"use strict\";\r\nimport nstructjs from '../util/struct.js';\r\n\r\n/**\r\n\r\n ToolOps are base operators for modifying application state.\r\n They operate on Contexts and can use the datapath API.\r\n They make up the undo stack.\r\n\r\n ToolOp subclasses handle undo with their undoPre (run before tool execution)\r\n and undo methods.  You can set default handlers (most commonly this is just\r\n saving/reloading the app state) with setDefaultUndoHandlers.\r\n\r\n ToolOps have inputs and outputs (which are ToolProperties) and can also\r\n be modal.\r\n\r\n ## Rules\r\n\r\n Tools are never, EVER allowed to store direct pointers to the application state,\r\n with one exception: tools in modal mode may store such pointers, but they must\r\n delete them when existing modal mode by overriding modalEnd.\r\n\r\n This is to prevent very evil and difficult to debug bugs in the undo stack\r\n and nasty memory leaks.\r\n\r\n ## Example\r\n\r\n <pre>\r\n\r\n const ExampleEnum = {\r\n  ITEM1 : 0,\r\n  ITEM2 : 1\r\n}\r\n\r\n class MyTool extends ToolOp {\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Tool Name\",\r\n      toolpath   : \"my.tool\",\r\n      inputs     : {\r\n          input1 : new IntProperty(),\r\n          input2 : new EnumProperty(0, ExampleEnum)\r\n      },\r\n      outputs    : {\r\n          someoutput : new IntProperty\r\n      }\r\n    }\r\n  }\r\n\r\n  undoPre(ctx) {\r\n    //run before tool starts\r\n  }\r\n\r\n  undo(ctx) {\r\n    //undo handler\r\n  }\r\n\r\n  execPre(ctx) {\r\n    //run right before exec\r\n  }\r\n  exec(ctx) {\r\n    //main execution method\r\n  }\r\n  execPost(ctx) {\r\n    //run right after exec\r\n  }\r\n}\r\n ToolOp.register(MyTool);\r\n\r\n </pre>\r\n */\r\n\r\nimport * as events from '../util/events.js';\r\nimport {keymap} from '../util/simple_events.js';\r\nimport {PropFlags, PropTypes} from './toolprop.js';\r\nimport {DataPath} from '../controller/controller_base.js';\r\nimport * as util from '../util/util.js';\r\nimport {Context} from '../controller/context.js';\r\n\r\nexport let ToolClasses = [];\r\nwindow._ToolClasses = ToolClasses;\r\n\r\nexport function setContextClass(cls) {\r\n  console.warn(\"setContextClass is deprecated\");\r\n}\r\n\r\nexport const ToolFlags = {\r\n  PRIVATE: 1\r\n\r\n};\r\n\r\n\r\nexport const UndoFlags = {\r\n  NO_UNDO      : 2,\r\n  IS_UNDO_ROOT : 4,\r\n  UNDO_BARRIER : 8,\r\n  HAS_UNDO_DATA: 16\r\n};\r\n\r\nclass InheritFlag {\r\n  constructor(slots = {}) {\r\n    this.slots = slots;\r\n  }\r\n}\r\n\r\nlet modalstack = [];\r\n\r\nlet defaultUndoHandlers = {\r\n  undoPre(ctx) {\r\n    throw new Error(\"implement me\");\r\n  },\r\n  undo(ctx) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n}\r\n\r\nexport function setDefaultUndoHandlers(undoPre, undo) {\r\n  if (!undoPre || !undo) {\r\n    throw new Error(\"invalid parameters to setDefaultUndoHandlers\");\r\n  }\r\n\r\n  defaultUndoHandlers.undoPre = undoPre;\r\n  defaultUndoHandlers.undo = undo;\r\n}\r\n\r\nexport class ToolPropertyCache {\r\n  constructor() {\r\n    this.map = new Map();\r\n    this.pathmap = new Map();\r\n    this.accessors = {};\r\n\r\n    this.userSetMap = new Set();\r\n\r\n    this.api = undefined;\r\n    this.dstruct = undefined;\r\n  }\r\n\r\n  static getPropKey(cls, key, prop) {\r\n    return prop.apiname && prop.apiname.length > 0 ? prop.apiname : key;\r\n  }\r\n\r\n  _buildAccessors(cls, key, prop, dstruct, api) {\r\n    let tdef = cls._getFinalToolDef();\r\n\r\n    this.api = api;\r\n    this.dstruct = dstruct;\r\n\r\n    if (!tdef.toolpath) {\r\n      console.warn(\"Bad tool property\", cls, \"it's tooldef was missing a toolpath field\");\r\n      return;\r\n    }\r\n\r\n    let path = tdef.toolpath.trim().split(\".\").filter(f => f.trim().length > 0);\r\n    let obj = this.accessors;\r\n\r\n    let st = dstruct;\r\n    let partial = \"\";\r\n\r\n    for (let i = 0; i < path.length; i++) {\r\n      let k = path[i];\r\n      let pathk = k;\r\n\r\n      if (i === 0) {\r\n        pathk = \"accessors.\" + k;\r\n      }\r\n\r\n      if (i > 0) {\r\n        partial += \".\";\r\n      }\r\n      partial += k;\r\n\r\n      if (!(k in obj)) {\r\n        obj[k] = {};\r\n      }\r\n\r\n      let st2 = api.mapStruct(obj[k], true, k);\r\n      if (!(k in st.pathmap)) {\r\n        st.struct(pathk, k, k, st2);\r\n      }\r\n      st = st2;\r\n\r\n      this.pathmap.set(partial, obj[k]);\r\n\r\n      obj = obj[k];\r\n    }\r\n\r\n    let name = prop.apiname !== undefined && prop.apiname.length > 0 ? prop.apiname : key;\r\n    let prop2 = prop.copy()\r\n\r\n    let dpath = new DataPath(name, name, prop2);\r\n    let uiname = prop.uiname;\r\n\r\n    if (!uiname || uiname.trim().length === 0) {\r\n      uiname = prop.apiname;\r\n    }\r\n    if (!uiname || uiname.trim().length === 0) {\r\n      uiname = key;\r\n    }\r\n\r\n    uiname = ToolProperty.makeUIName(uiname);\r\n\r\n    prop2.uiname = uiname;\r\n    prop2.description = prop2.description || prop2.uiname;\r\n\r\n    st.add(dpath);\r\n\r\n    obj[name] = prop2.getValue();\r\n  }\r\n\r\n  _getAccessor(cls) {\r\n    let toolpath = cls.tooldef().toolpath.trim();\r\n    return this.pathmap.get(toolpath);\r\n  }\r\n\r\n  useDefault(cls, key, prop) {\r\n    key = this.userSetMap.has(cls.tooldef().trim() + \".\" + this.constructor.getPropKey(key));\r\n    key = key.trim();\r\n\r\n    return key;\r\n  }\r\n\r\n  has(cls, key, prop) {\r\n    if (prop.flag & PropFlags.NO_DEFAULT) {\r\n      return false;\r\n    }\r\n\r\n    let obj = this._getAccessor(cls);\r\n\r\n    key = this.constructor.getPropKey(cls, key, prop);\r\n    return obj && key in obj;\r\n  }\r\n\r\n  get(cls, key, prop) {\r\n    if (cls === ToolMacro) {\r\n      return;\r\n    }\r\n\r\n    let obj = this._getAccessor(cls);\r\n    key = this.constructor.getPropKey(cls, key, prop);\r\n\r\n    if (obj) {\r\n      return obj[key];\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  set(cls, key, prop) {\r\n    if (cls === ToolMacro) {\r\n      return;\r\n    }\r\n\r\n    let toolpath = cls.tooldef().toolpath.trim();\r\n    let obj = this._getAccessor(cls);\r\n\r\n    if (!obj) {\r\n      console.warn(\"Warning, toolop \" + cls.name + \" was not in the default map; unregistered?\");\r\n      this._buildAccessors(cls, key, prop, this.dstruct, this.api);\r\n\r\n      obj = this.pathmap.get(toolpath);\r\n    }\r\n\r\n    if (!obj) {\r\n      console.error(\"Malformed toolpath in toolop definition: \" + toolpath);\r\n      return;\r\n    }\r\n\r\n    key = this.constructor.getPropKey(cls, key, prop);\r\n\r\n    //copy prop first in case we're a non-primitive-value type, e.g. vector properties\r\n    obj[key] = prop.copy().getValue();\r\n\r\n    let path = toolpath + \".\" + key;\r\n    this.userSetMap.add(path);\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nexport const SavedToolDefaults = new ToolPropertyCache();\r\n\r\nexport class ToolOp extends events.EventHandler {\r\n  /**\r\n   Main ToolOp constructor.  It reads the inputs/outputs properteis from\r\n   this.constructor.tooldef() and copies them to build this.inputs and this.outputs.\r\n   If inputs or outputs are wrapped in ToolOp.inherit(), it will walk up the class\r\n   chain to fetch parent class properties.\r\n\r\n\r\n   Default input values are loaded from SavedToolDefaults.  If initialized (buildToolSysAPI\r\n   has been called) SavedToolDefaults will have a copy of all the default\r\n   property values of all registered ToolOps.\r\n   **/\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this._pointerId = undefined;\r\n    this._overdraw = undefined;\r\n    this.__memsize = undefined;\r\n\r\n    var def = this.constructor.tooldef();\r\n\r\n    if (def.undoflag !== undefined) {\r\n      this.undoflag = def.undoflag;\r\n    }\r\n\r\n    if (def.flag !== undefined) {\r\n      this.flag = def.flag;\r\n    }\r\n\r\n    this._accept = this._reject = undefined;\r\n    this._promise = undefined;\r\n\r\n    for (var k in def) {\r\n      this[k] = def[k];\r\n    }\r\n\r\n    let getSlots = (slots, key) => {\r\n      if (slots === undefined)\r\n        return {};\r\n\r\n      if (!(slots instanceof InheritFlag)) {\r\n        return slots;\r\n      }\r\n\r\n      slots = {};\r\n      let p = this.constructor;\r\n      let lastp = undefined;\r\n\r\n      while (p !== undefined && p !== Object && p !== ToolOp && p !== lastp) {\r\n        if (p.tooldef) {\r\n          let def = p.tooldef();\r\n\r\n          if (def[key] !== undefined) {\r\n            let slots2 = def[key];\r\n            let stop = !(slots2 instanceof InheritFlag);\r\n\r\n            if (slots2 instanceof InheritFlag) {\r\n              slots2 = slots2.slots;\r\n            }\r\n\r\n            for (let k in slots2) {\r\n              if (!(k in slots)) {\r\n                slots[k] = slots2[k];\r\n              }\r\n            }\r\n\r\n            if (stop) {\r\n              break;\r\n            }\r\n          }\r\n        }\r\n\r\n        lastp = p;\r\n        p = p.prototype.__proto__.constructor;\r\n      }\r\n\r\n      return slots;\r\n    };\r\n\r\n    let dinputs = getSlots(def.inputs, \"inputs\");\r\n    let doutputs = getSlots(def.outputs, \"outputs\");\r\n\r\n    this.inputs = {};\r\n    this.outputs = {};\r\n\r\n    if (dinputs) {\r\n      for (let k in dinputs) {\r\n        let prop = dinputs[k].copy();\r\n        prop.apiname = prop.apiname && prop.apiname.length > 0 ? prop.apiname : k;\r\n\r\n        if (!this.hasDefault(prop, k)) {\r\n          this.inputs[k] = prop;\r\n          continue;\r\n        }\r\n\r\n        try {\r\n          prop.setValue(this.getDefault(prop, k));\r\n        } catch (error) {\r\n          console.log(error.stack);\r\n          console.log(error.message);\r\n        }\r\n\r\n        prop.wasSet = false;\r\n        this.inputs[k] = prop;\r\n      }\r\n    }\r\n\r\n    if (doutputs) {\r\n      for (let k in doutputs) {\r\n        let prop = doutputs[k].copy();\r\n        prop.apiname = prop.apiname && prop.apiname.length > 0 ? prop.apiname : k;\r\n\r\n        this.outputs[k] = prop;\r\n      }\r\n    }\r\n\r\n    this.drawlines = [];\r\n  }\r\n\r\n  /**\r\n   ToolOp definition.\r\n\r\n   An example:\r\n   <pre>\r\n   static tooldef() {\r\n    return {\r\n      uiname   : \"Tool Name\",\r\n      toolpath : \"logical_module.tool\", //logical_module need not match up to a real module\r\n      icon     : -1, //tool's icon, or -1 if there is none\r\n      description : \"tooltip\",\r\n      is_modal : false, //tool is interactive and takes control of events\r\n      hotkey   : undefined,\r\n      undoflag : 0, //see UndoFlags\r\n      flag     : 0,\r\n      inputs   : ToolOp.inherit({\r\n        f32val : new Float32Property(1.0),\r\n        path   : new StringProperty(\"./path\");\r\n      }),\r\n      outputs  : {}\r\n      }\r\n    }\r\n   </pre>\r\n   */\r\n  static tooldef() {\r\n    if (this === ToolOp) {\r\n      throw new Error(\"Tools must implemented static tooldef() methods!\");\r\n    }\r\n\r\n    return {};\r\n  }\r\n\r\n  /** Returns a map of input property values,\r\n   *  e.g. `let {prop1, prop2} = this.getValues()` */\r\n  getInputs() {\r\n    let ret = {};\r\n\r\n    for (let k in this.inputs) {\r\n      ret[k] = this.inputs[k].getValue();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  static Equals(a, b) {\r\n    if (!a || !b) return false;\r\n    if (a.constructor !== b.constructor) return false;\r\n\r\n    let bad = false;\r\n\r\n    for (let k in a.inputs) {\r\n      bad = bad || !(k in b.inputs);\r\n      bad = bad || a.inputs[k].constructor !== b.inputs[k];\r\n      bad = bad || !a.inputs[k].equals(b.inputs[k]);\r\n\r\n      if (bad) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return !bad;\r\n  }\r\n\r\n  static inherit(slots = {}) {\r\n    return new InheritFlag(slots);\r\n  }\r\n\r\n  /**\r\n\r\n   Creates a new instance of this toolop from args and a context.\r\n   This is often use to fill properties with default arguments\r\n   stored somewhere in the context.\r\n\r\n   */\r\n  static invoke(ctx, args) {\r\n    let tool = new this();\r\n\r\n    for (let k in args) {\r\n      if (!(k in tool.inputs)) {\r\n        console.warn(\"Unknown tool argument \" + k);\r\n        continue;\r\n      }\r\n\r\n      let prop = tool.inputs[k];\r\n      let val = args[k];\r\n\r\n      if ((typeof val === \"string\") && prop.type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n        if (val in prop.values) {\r\n          val = prop.values[val];\r\n        } else {\r\n          console.warn(\"Possible invalid enum/flag:\", val);\r\n          continue;\r\n        }\r\n      }\r\n\r\n      tool.inputs[k].setValue(val);\r\n    }\r\n\r\n    return tool;\r\n  }\r\n\r\n  static register(cls) {\r\n    if (ToolClasses.indexOf(cls) >= 0) {\r\n      console.warn(\"Tried to register same ToolOp class twice:\", cls.name, cls);\r\n      return;\r\n    }\r\n\r\n    ToolClasses.push(cls);\r\n  }\r\n\r\n  static _regWithNstructjs(cls, structName = cls.name) {\r\n    if (nstructjs.isRegistered(cls)) {\r\n      return;\r\n    }\r\n\r\n    let parent = cls.prototype.__proto__.constructor;\r\n\r\n    if (!cls.hasOwnProperty(\"STRUCT\")) {\r\n      if (parent !== ToolOp && parent !== ToolMacro && parent !== Object) {\r\n        this._regWithNstructjs(parent);\r\n      }\r\n\r\n      cls.STRUCT = nstructjs.inherit(cls, parent) + '}\\n';\r\n    }\r\n\r\n    nstructjs.register(cls);\r\n  }\r\n\r\n  static isRegistered(cls) {\r\n    return ToolClasses.indexOf(cls) >= 0;\r\n  }\r\n\r\n  static unregister(cls) {\r\n    if (ToolClasses.indexOf(cls) >= 0) {\r\n      ToolClasses.remove(cls);\r\n    }\r\n  }\r\n\r\n  static _getFinalToolDef() {\r\n    let def = this.tooldef();\r\n\r\n    let getSlots = (slots, key) => {\r\n      if (slots === undefined)\r\n        return {};\r\n\r\n      if (!(slots instanceof InheritFlag)) {\r\n        return slots;\r\n      }\r\n\r\n      slots = {};\r\n      let p = this\r\n\r\n      while (p !== undefined && p !== Object && p !== ToolOp) {\r\n        if (p.tooldef) {\r\n          let def = p.tooldef();\r\n\r\n          if (def[key] !== undefined) {\r\n            let slots2 = def[key];\r\n            let stop = !(slots2 instanceof InheritFlag);\r\n\r\n            if (slots2 instanceof InheritFlag) {\r\n              slots2 = slots2.slots;\r\n            }\r\n\r\n            for (let k in slots2) {\r\n              if (!(k in slots)) {\r\n                slots[k] = slots2[k];\r\n              }\r\n            }\r\n\r\n            if (stop) {\r\n              break;\r\n            }\r\n          }\r\n\r\n        }\r\n        p = p.prototype.__proto__.constructor;\r\n      }\r\n\r\n      return slots;\r\n    };\r\n\r\n    let dinputs = getSlots(def.inputs, \"inputs\");\r\n    let doutputs = getSlots(def.outputs, \"outputs\");\r\n\r\n    def.inputs = dinputs;\r\n    def.outputs = doutputs;\r\n\r\n    return def;\r\n  }\r\n\r\n  static onTick() {\r\n    for (let toolop of modalstack) {\r\n      toolop.on_tick();\r\n    }\r\n  }\r\n\r\n  static searchBoxOk(ctx) {\r\n    let flag = this.tooldef().flag;\r\n    let ret = !(flag && (flag & ToolFlags.PRIVATE));\r\n    ret = ret && this.canRun(ctx);\r\n\r\n    return ret;\r\n  }\r\n\r\n  //toolop is an optional instance of this class, may be undefined\r\n  static canRun(ctx, toolop = undefined) {\r\n    return true;\r\n  }\r\n\r\n  /** Called when the undo system needs to destroy\r\n   *  this toolop to save memory*/\r\n  onUndoDestroy() {\r\n\r\n  }\r\n\r\n  /** Used by undo system to limit memory */\r\n  calcMemSize(ctx) {\r\n    if (this.__memsize !== undefined) {\r\n      return this.__memsize;\r\n    }\r\n\r\n    let tot = 0;\r\n\r\n    for (let step = 0; step < 2; step++) {\r\n      let props = step ? this.outputs : this.inputs;\r\n\r\n      for (let k in props) {\r\n        let prop = props[k];\r\n\r\n        let size = prop.calcMemSize();\r\n\r\n        if (isNaN(size) || !isFinite(size)) {\r\n          console.warn(\"Got NaN when calculating mem size for property\", prop);\r\n          continue;\r\n        }\r\n\r\n        tot += size;\r\n      }\r\n    }\r\n\r\n    let size = this.calcUndoMem(ctx);\r\n\r\n    if (isNaN(size) || !isFinite(size)) {\r\n      console.warn(\"Got NaN in calcMemSize\", this);\r\n    } else {\r\n      tot += size;\r\n    }\r\n\r\n    this.__memsize = tot;\r\n\r\n    return tot;\r\n  }\r\n\r\n  loadDefaults(force = true) {\r\n    for (let k in this.inputs) {\r\n      let prop = this.inputs[k];\r\n\r\n      if (!force && prop.wasSet) {\r\n        continue;\r\n      }\r\n\r\n      if (this.hasDefault(prop, k)) {\r\n        prop.setValue(this.getDefault(prop, k));\r\n        prop.wasSet = false;\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  hasDefault(toolprop, key = toolprop.apiname) {\r\n    return SavedToolDefaults.has(this.constructor, key, toolprop);\r\n  }\r\n\r\n  getDefault(toolprop, key = toolprop.apiname) {\r\n    let cls = this.constructor;\r\n\r\n    if (SavedToolDefaults.has(cls, key, toolprop)) {\r\n      return SavedToolDefaults.get(cls, key, toolprop);\r\n    } else {\r\n      return toolprop.getValue();\r\n    }\r\n  }\r\n\r\n  saveDefaultInputs() {\r\n    for (let k in this.inputs) {\r\n      let prop = this.inputs[k];\r\n\r\n      if (prop.flag & PropFlags.SAVE_LAST_VALUE) {\r\n        SavedToolDefaults.set(this.constructor, k, prop);\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  genToolString() {\r\n    let def = this.constructor.tooldef();\r\n    let path = def.toolpath + \"(\";\r\n\r\n    for (let k in this.inputs) {\r\n      let prop = this.inputs[k];\r\n\r\n      path += k + \"=\";\r\n      if (prop.type === PropTypes.STRING)\r\n        path += \"'\";\r\n\r\n      if (prop.type === PropTypes.FLOAT) {\r\n        path += prop.getValue().toFixed(3);\r\n      } else {\r\n        path += prop.getValue();\r\n      }\r\n\r\n      if (prop.type === PropTypes.STRING)\r\n        path += \"'\";\r\n      path += \" \";\r\n    }\r\n    path += \")\";\r\n    return path;\r\n  }\r\n\r\n  on_tick() {\r\n\r\n  }\r\n\r\n  /**default on_keydown implementation for modal tools,\r\n   no need to call super() to execute this if you don't want to*/\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case keymap[\"Enter\"]:\r\n      case keymap[\"Space\"]:\r\n        this.modalEnd(false);\r\n        break;\r\n      case keymap[\"Escape\"]:\r\n        this.modalEnd(true);\r\n        break;\r\n    }\r\n  }\r\n\r\n  //called after undoPre\r\n  calcUndoMem(ctx) {\r\n    console.warn(\"ToolOp.prototype.calcUndoMem: implement me!\");\r\n    return 0;\r\n  }\r\n\r\n  undoPre(ctx) {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  undo(ctx) {\r\n    throw new Error(\"implement me!\");\r\n    //_appstate.loadUndoFile(this._undo);\r\n  }\r\n\r\n  redo(ctx) {\r\n    this._was_redo = true; //also set by toolstack.redo\r\n\r\n    this.undoPre(ctx);\r\n    this.execPre(ctx);\r\n    this.exec(ctx);\r\n    this.execPost(ctx);\r\n  }\r\n\r\n  //for compatibility with fairmotion\r\n  exec_pre(ctx) {\r\n    this.execPre(ctx);\r\n  }\r\n\r\n  execPre(ctx) {\r\n  }\r\n\r\n  exec(ctx) {\r\n  }\r\n\r\n  execPost(ctx) {\r\n\r\n  }\r\n\r\n  /**for use in modal mode only*/\r\n  resetTempGeom() {\r\n    var ctx = this.modal_ctx;\r\n\r\n    for (var dl of this.drawlines) {\r\n      dl.remove();\r\n    }\r\n\r\n    this.drawlines.length = 0;\r\n  }\r\n\r\n  error(msg) {\r\n    console.warn(msg);\r\n  }\r\n\r\n  getOverdraw() {\r\n    if (this._overdraw === undefined) {\r\n      this._overdraw = document.createElement(\"overdraw-x\");\r\n      this._overdraw.start(this.modal_ctx.screen);\r\n    }\r\n\r\n    return this._overdraw;\r\n  }\r\n\r\n  /**for use in modal mode only*/\r\n  makeTempLine(v1, v2, style) {\r\n    let line = this.getOverdraw().line(v1, v2, style);\r\n    this.drawlines.push(line);\r\n    return line;\r\n  }\r\n\r\n  pushModal(node) {\r\n    throw new Error(\"cannot call this; use modalStart\")\r\n  }\r\n\r\n  popModal() {\r\n    throw new Error(\"cannot call this; use modalEnd\");\r\n  }\r\n\r\n  /**returns promise to be executed on modalEnd*/\r\n  modalStart(ctx) {\r\n    if (this.modalRunning) {\r\n      console.warn(\"Warning, tool is already in modal mode consuming events\");\r\n      return this._promise;\r\n    }\r\n\r\n    this.modal_ctx = ctx;\r\n    this.modalRunning = true\r\n\r\n    this._promise = new Promise((accept, reject) => {\r\n      this._accept = accept;\r\n      this._reject = reject;\r\n\r\n      modalstack.push(this);\r\n\r\n      if (this._pointerId !== undefined) {\r\n        super.pushPointerModal(ctx.screen, this._pointerId);\r\n      } else {\r\n        super.pushModal(ctx.screen);\r\n      }\r\n    });\r\n\r\n    return this._promise;\r\n  }\r\n\r\n  /*eek, I've not been using this.\r\n    guess it's a non-enforced contract, I've been naming\r\n    cancel methods 'cancel' all this time.\r\n\r\n    XXX fix\r\n  */\r\n  toolCancel() {\r\n  }\r\n\r\n  modalEnd(was_cancelled) {\r\n    if (this._modalstate) {\r\n      modalstack.pop();\r\n    }\r\n\r\n    if (this._overdraw !== undefined) {\r\n      this._overdraw.end();\r\n      this._overdraw = undefined;\r\n    }\r\n\r\n    if (was_cancelled && this._on_cancel !== undefined) {\r\n      if (this._accept) {\r\n        this._accept(this.modal_ctx, true);\r\n      }\r\n\r\n      this._on_cancel(this);\r\n      this._on_cancel = undefined;\r\n    }\r\n\r\n    this.resetTempGeom();\r\n\r\n    var ctx = this.modal_ctx;\r\n\r\n    this.modal_ctx = undefined;\r\n    this.modalRunning = false;\r\n    this.is_modal = false;\r\n\r\n    super.popModal();\r\n\r\n    this._promise = undefined;\r\n\r\n    if (this._accept) {\r\n      this._accept(ctx, false);//Context, was_cancelled\r\n      this._accept = this._reject = undefined;\r\n    }\r\n\r\n    this.saveDefaultInputs();\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    let outs = this.outputs;\r\n    let ins = this.inputs;\r\n\r\n    this.inputs = {};\r\n    this.outputs = {};\r\n\r\n    for (let pair of ins) {\r\n      this.inputs[pair.key] = pair.val;\r\n    }\r\n\r\n    for (let pair of outs) {\r\n      this.outputs[pair.key] = pair.val;\r\n    }\r\n  }\r\n\r\n  _save_inputs() {\r\n    let ret = [];\r\n    for (let k in this.inputs) {\r\n      ret.push(new PropKey(k, this.inputs[k]));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  _save_outputs() {\r\n    let ret = [];\r\n    for (let k in this.outputs) {\r\n      ret.push(new PropKey(k, this.outputs[k]));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nToolOp.STRUCT = `\r\ntoolsys.ToolOp {\r\n  inputs  : array(toolsys.PropKey) | this._save_inputs();\r\n  outputs : array(toolsys.PropKey) | this._save_outputs();\r\n}\r\n`;\r\nnstructjs.register(ToolOp);\r\n\r\nclass PropKey {\r\n  constructor(key, val) {\r\n    this.key = key;\r\n    this.val = val;\r\n  }\r\n}\r\n\r\nPropKey.STRUCT = `\r\ntoolsys.PropKey {\r\n  key : string;\r\n  val : abstract(ToolProperty);\r\n}\r\n`;\r\nnstructjs.register(PropKey);\r\n\r\nexport class MacroLink {\r\n  constructor(sourcetool_idx, srckey, srcprops = \"outputs\", desttool_idx, dstkey, dstprops = \"inputs\") {\r\n    this.source = sourcetool_idx;\r\n    this.dest = desttool_idx;\r\n\r\n    this.sourceProps = srcprops;\r\n    this.destProps = dstprops;\r\n\r\n    this.sourcePropKey = srckey;\r\n    this.destPropKey = dstkey;\r\n  }\r\n}\r\n\r\nMacroLink.STRUCT = `\r\ntoolsys.MacroLink {\r\n  source         : int;\r\n  dest           : int;\r\n  sourcePropKey  : string;\r\n  destPropKey    : string;\r\n  sourceProps    : string;\r\n  destProps      : string; \r\n}\r\n`;\r\nnstructjs.register(MacroLink);\r\n\r\nexport const MacroClasses = {};\r\nwindow._MacroClasses = MacroClasses;\r\n\r\nlet macroidgen = 0;\r\n\r\n\r\nexport class ToolMacro extends ToolOp {\r\n  constructor() {\r\n    super();\r\n\r\n    this.tools = [];\r\n    this.curtool = 0;\r\n    this.has_modal = false;\r\n    this.connects = [];\r\n    this.connectLinks = [];\r\n\r\n    this._macro_class = undefined;\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname: \"Tool Macro\"\r\n    }\r\n  }\r\n\r\n  //toolop is an optional instance of this class, may be undefined\r\n  static canRun(ctx, toolop = undefined) {\r\n    return true;\r\n  }\r\n\r\n  _getTypeClass() {\r\n    if (this._macro_class && this._macro_class.ready) {\r\n      return this._macro_class;\r\n    }\r\n\r\n    if (!this._macro_class) {\r\n      this._macro_class = class MacroTypeClass extends ToolOp {\r\n        static tooldef() {\r\n          return this.__tooldef;\r\n        }\r\n      }\r\n\r\n      this._macro_class.__tooldef = {\r\n        toolpath: this.constructor.tooldef().toolpath || ''\r\n      };\r\n      this._macro_class.ready = false;\r\n    }\r\n\r\n    if (!this.tools || this.tools.length === 0) {\r\n      /* We've been invoked by ToolOp constructor,\r\n      *  for now just return an empty class  */\r\n      return this._macro_class;\r\n    }\r\n\r\n    let key = \"\";\r\n    for (let tool of this.tools) {\r\n      key = tool.constructor.name + \":\";\r\n    }\r\n\r\n    /* Handle child classes of ToolMacro */\r\n    if (this.constructor !== ToolMacro) {\r\n      key += \":\" + this.constructor.tooldef().toolpath;\r\n    }\r\n\r\n    for (let k in this.inputs) {\r\n      key += k + \":\";\r\n    }\r\n\r\n    if (key in MacroClasses) {\r\n      this._macro_class = MacroClasses[key];\r\n      return this._macro_class;\r\n    }\r\n\r\n    let name = \"Macro(\"\r\n    let i = 0;\r\n    let is_modal;\r\n\r\n    for (let tool of this.tools) {\r\n      let def = tool.constructor.tooldef();\r\n\r\n      if (i > 0) {\r\n        name += \", \";\r\n      } else {\r\n        is_modal = def.is_modal;\r\n      }\r\n\r\n      if (def.uiname) {\r\n        name += def.uiname;\r\n      } else if (def.toolpath) {\r\n        name += def.toolpath;\r\n      } else {\r\n        name += tool.constructor.name;\r\n      }\r\n\r\n      i++;\r\n    }\r\n\r\n    let inputs = {};\r\n\r\n    for (let k in this.inputs) {\r\n      inputs[k] = this.inputs[k].copy().clearEventCallbacks();\r\n      inputs[k].wasSet = false;\r\n    }\r\n\r\n    let tdef = {\r\n      uiname  : name,\r\n      toolpath: key,\r\n      inputs,\r\n      outputs : {},\r\n      is_modal\r\n    };\r\n\r\n    let cls = this._macro_class;\r\n    cls.__tooldef = tdef;\r\n    cls._macroTypeId = macroidgen++;\r\n    cls.ready = true;\r\n\r\n    /*\r\n    let cls = {\r\n      name : key,\r\n      tooldef() {\r\n        return tdef\r\n      },\r\n      _getFinalToolDef() {\r\n        return this.tooldef();\r\n      }\r\n    };//*/\r\n\r\n    MacroClasses[key] = cls;\r\n\r\n    return cls;\r\n  }\r\n\r\n  saveDefaultInputs() {\r\n    for (let k in this.inputs) {\r\n      let prop = this.inputs[k];\r\n\r\n      if (prop.flag & PropFlags.SAVE_LAST_VALUE) {\r\n        SavedToolDefaults.set(this._getTypeClass(), k, prop);\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  hasDefault(toolprop, key = toolprop.apiname) {\r\n    return SavedToolDefaults.has(this._getTypeClass(), key, toolprop);\r\n  }\r\n\r\n  getDefault(toolprop, key = toolprop.apiname) {\r\n    let cls = this._getTypeClass();\r\n\r\n    if (SavedToolDefaults.has(cls, key, toolprop)) {\r\n      return SavedToolDefaults.get(cls, key, toolprop);\r\n    } else {\r\n      return toolprop.getValue();\r\n    }\r\n  }\r\n\r\n  connect(srctool, srcoutput, dsttool, dstinput, srcprops = \"outputs\", dstprops = \"inputs\") {\r\n    if (typeof dsttool === \"function\") {\r\n      return this.connectCB(...arguments);\r\n    }\r\n\r\n    let i1 = this.tools.indexOf(srctool);\r\n    let i2 = this.tools.indexOf(dsttool);\r\n\r\n    if (i1 < 0 || i2 < 0) {\r\n      throw new Error(\"tool not in macro\");\r\n    }\r\n\r\n    //remove linked properties from this.inputs\r\n    if (srcprops === \"inputs\") {\r\n      let tool = this.tools[i1];\r\n\r\n      let prop = tool.inputs[srcoutput];\r\n      if (prop === this.inputs[srcoutput]) {\r\n        delete this.inputs[srcoutput];\r\n      }\r\n    }\r\n\r\n    if (dstprops === \"inputs\") {\r\n      let tool = this.tools[i2];\r\n      let prop = tool.inputs[dstinput];\r\n\r\n      if (this.inputs[dstinput] === prop) {\r\n        delete this.inputs[dstinput];\r\n      }\r\n    }\r\n\r\n    this.connectLinks.push(new MacroLink(i1, srcoutput, srcprops, i2, dstinput, dstprops));\r\n    return this;\r\n  }\r\n\r\n  connectCB(srctool, dsttool, callback, thisvar) {\r\n    this.connects.push({\r\n      srctool : srctool,\r\n      dsttool : dsttool,\r\n      callback: callback,\r\n      thisvar : thisvar\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  add(tool) {\r\n    if (tool.is_modal) {\r\n      this.is_modal = true;\r\n    }\r\n\r\n    for (let k in tool.inputs) {\r\n      let prop = tool.inputs[k];\r\n\r\n      if (!(prop.flag & PropFlags.PRIVATE)) {\r\n        this.inputs[k] = prop;\r\n      }\r\n    }\r\n\r\n    this.tools.push(tool);\r\n\r\n    return this;\r\n  }\r\n\r\n  _do_connections(tool) {\r\n    let i = this.tools.indexOf(tool);\r\n\r\n    for (let c of this.connectLinks) {\r\n      if (c.source === i) {\r\n        let tool2 = this.tools[c.dest];\r\n\r\n        tool2[c.destProps][c.destPropKey].setValue(tool[c.sourceProps][c.sourcePropKey].getValue());\r\n      }\r\n    }\r\n\r\n    for (var c of this.connects) {\r\n      if (c.srctool === tool) {\r\n        c.callback.call(c.thisvar, c.srctool, c.dsttool);\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n  canRun(ctx) {\r\n    if (this.tools.length == 0)\r\n      return false;\r\n\r\n    //poll first tool only in list\r\n    return this.tools[0].constructor.canRun(ctx);\r\n  }//*/\r\n\r\n  modalStart(ctx) {\r\n    //macros obviously can't call loadDefaults in the constructor\r\n    //like normal tool ops can.\r\n    this.loadDefaults(false);\r\n\r\n    this._promise = new Promise((function (accept, reject) {\r\n      this._accept = accept;\r\n      this._reject = reject;\r\n    }).bind(this));\r\n\r\n    this.curtool = 0;\r\n\r\n    let i;\r\n\r\n    for (i = 0; i < this.tools.length; i++) {\r\n      if (this.tools[i].is_modal)\r\n        break;\r\n\r\n      this.tools[i].undoPre(ctx);\r\n      this.tools[i].execPre(ctx);\r\n      this.tools[i].exec(ctx);\r\n      this.tools[i].execPost(ctx);\r\n      this._do_connections(this.tools[i]);\r\n    }\r\n\r\n    var on_modal_end = (function on_modal_end() {\r\n      this._do_connections(this.tools[this.curtool]);\r\n      this.curtool++;\r\n\r\n      while (this.curtool < this.tools.length &&\r\n      !this.tools[this.curtool].is_modal) {\r\n        this.tools[this.curtool].undoPre(ctx);\r\n        this.tools[this.curtool].execPre(ctx);\r\n        this.tools[this.curtool].exec(ctx);\r\n        this.tools[this.curtool].execPost(ctx);\r\n        this._do_connections(this.tools[this.curtool]);\r\n\r\n        this.curtool++;\r\n      }\r\n\r\n      if (this.curtool < this.tools.length) {\r\n        this.tools[this.curtool].undoPre(ctx);\r\n        this.tools[this.curtool].modalStart(ctx).then(on_modal_end);\r\n      } else {\r\n        this._accept(this, false);\r\n      }\r\n    }).bind(this);\r\n\r\n    if (i < this.tools.length) {\r\n      this.curtool = i;\r\n      this.tools[this.curtool].undoPre(ctx);\r\n      this.tools[this.curtool].modalStart(ctx).then(on_modal_end);\r\n    }\r\n\r\n    return this._promise;\r\n  }\r\n\r\n  loadDefaults(force = true) {\r\n    return super.loadDefaults(force);\r\n  }\r\n\r\n  exec(ctx) {\r\n    //macros obviously can't call loadDefaults in the constructor\r\n    //like normal tool ops can.\r\n    //note that this will detect if the user changes property values\r\n\r\n    this.loadDefaults(false);\r\n\r\n    for (var i = 0; i < this.tools.length; i++) {\r\n      this.tools[i].undoPre(ctx);\r\n      this.tools[i].execPre(ctx);\r\n      this.tools[i].exec(ctx);\r\n      this.tools[i].execPost(ctx);\r\n      this._do_connections(this.tools[i]);\r\n    }\r\n  }\r\n\r\n  calcUndoMem(ctx) {\r\n    let tot = 0;\r\n\r\n    for (let tool of this.tools) {\r\n      tot += tool.calcUndoMem(ctx);\r\n    }\r\n\r\n    return tot;\r\n  }\r\n\r\n  calcMemSize(ctx) {\r\n    let tot = 0;\r\n\r\n    for (let tool of this.tools) {\r\n      tot += tool.calcMemSize(ctx);\r\n    }\r\n\r\n    return tot;\r\n  }\r\n\r\n  undoPre() {\r\n    return; //undoPre is handled in exec() or modalStart()\r\n  }\r\n\r\n  undo(ctx) {\r\n    for (var i = this.tools.length - 1; i >= 0; i--) {\r\n      this.tools[i].undo(ctx);\r\n    }\r\n  }\r\n}\r\n\r\nToolMacro.STRUCT = nstructjs.inherit(ToolMacro, ToolOp, \"toolsys.ToolMacro\") + `\r\n  tools        : array(abstract(toolsys.ToolOp));\r\n  connectLinks : array(toolsys.MacroLink);\r\n}\r\n`;\r\nnstructjs.register(ToolMacro);\r\n\r\nexport class ToolStack extends Array {\r\n  constructor(ctx) {\r\n    super();\r\n\r\n    this.memLimit = 512*1024*1024;\r\n    this.enforceMemLimit = false;\r\n\r\n    this.cur = -1;\r\n    this.ctx = ctx;\r\n\r\n    this.modalRunning = 0;\r\n\r\n    this._undo_branch = undefined; //used to save undo branch in case of tool cancel\r\n  }\r\n\r\n  get head() {\r\n    return this[this.cur];\r\n  }\r\n\r\n  limitMemory(maxmem = this.memLimit, ctx = this.ctx) {\r\n    if (maxmem === undefined) {\r\n      throw new Error(\"maxmem cannot be undefined\");\r\n    }\r\n\r\n    let size = this.calcMemSize();\r\n\r\n    let start = 0;\r\n\r\n    while (start < this.cur - 2 && size > maxmem) {\r\n      size -= this[start].calcMemSize(ctx);\r\n      start++;\r\n    }\r\n\r\n    if (start === 0) {\r\n      return size;\r\n    }\r\n\r\n    for (let i = 0; i < start; i++) {\r\n      this[i].onUndoDestroy();\r\n    }\r\n\r\n    this.cur -= start;\r\n\r\n    for (let i = 0; i < this.length - start; i++) {\r\n      this[i] = this[i + start];\r\n    }\r\n    this.length -= start;\r\n\r\n    return this.calcMemSize(ctx);\r\n  }\r\n\r\n  calcMemSize(ctx = this.ctx) {\r\n    let tot = 0;\r\n\r\n    for (let tool of this) {\r\n      try {\r\n        tot += tool.calcMemSize();\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        console.error(\"Failed to execute a calcMemSize method\");\r\n      }\r\n    }\r\n\r\n    return tot;\r\n  }\r\n\r\n  setRestrictedToolContext(ctx) {\r\n    this.toolctx = ctx;\r\n  }\r\n\r\n  reset(ctx) {\r\n    if (ctx !== undefined) {\r\n      this.ctx = ctx;\r\n    }\r\n\r\n    this.modalRunning = 0;\r\n    this.cur = -1;\r\n    this.length = 0;\r\n  }\r\n\r\n  /**\r\n   * runs .undo,.redo if toolstack head is same as tool\r\n   *\r\n   * otherwise, .execTool(ctx, tool) is called.\r\n   *\r\n   * @param compareInputs : check if toolstack head has identical input values, defaults to false\r\n   * */\r\n  execOrRedo(ctx, tool, compareInputs = false) {\r\n    let head = this.head;\r\n\r\n    let ok = compareInputs ? ToolOp.Equals(head, tool) : head && head.constructor === tool.constructor;\r\n\r\n    tool.__memsize = undefined; //reset cache memsize\r\n\r\n    if (ok) {\r\n      //console.warn(\"Same tool detected\");\r\n\r\n      this.undo();\r\n\r\n      //can inputs differ? in that case, execute new tool\r\n      if (!compareInputs) {\r\n        this.execTool(ctx, tool);\r\n      } else {\r\n        this.rerun();\r\n      }\r\n\r\n      return false;\r\n    } else {\r\n      this.execTool(ctx, tool);\r\n      return true;\r\n    }\r\n  }\r\n\r\n  execTool(ctx, toolop, event = undefined) {\r\n    if (this.enforceMemLimit) {\r\n      this.limitMemory(this.memLimit, ctx);\r\n    }\r\n\r\n    if (!toolop.constructor.canRun(ctx, toolop)) {\r\n      console.log(\"toolop.constructor.canRun returned false\");\r\n      return;\r\n    }\r\n\r\n    let tctx = ctx.toLocked();\r\n\r\n    let undoflag = toolop.constructor.tooldef().undoflag;\r\n    if (toolop.undoflag !== undefined) {\r\n      undoflag = toolop.undoflag;\r\n    }\r\n    undoflag = undoflag === undefined ? 0 : undoflag;\r\n\r\n    //if (!(undoflag & UndoFlags.IS_UNDO_ROOT) && !(undoflag & UndoFlags.NO_UNDO)) {\r\n    //tctx = new SavedContext(ctx, ctx.datalib);\r\n    //}\r\n\r\n    toolop.execCtx = tctx;\r\n\r\n    if (!(undoflag & UndoFlags.NO_UNDO)) {\r\n      this.cur++;\r\n\r\n      //save branch for if tool cancel\r\n      this._undo_branch = this.slice(this.cur + 1, this.length);\r\n\r\n      //truncate\r\n      this.length = this.cur + 1;\r\n\r\n      this[this.cur] = toolop;\r\n      toolop.undoPre(tctx);\r\n    }\r\n\r\n    if (toolop.is_modal) {\r\n      ctx = toolop.modal_ctx = ctx;\r\n\r\n      this.modal_running = true;\r\n\r\n      toolop._on_cancel = (function (toolop) {\r\n        if (!(toolop.undoflag & UndoFlags.NO_UNDO)) {\r\n          this[this.cur].undo(ctx);\r\n          this.pop_i(this.cur);\r\n          this.cur--;\r\n        }\r\n      }).bind(this);\r\n\r\n      if (event !== undefined) {\r\n        toolop._pointerId = event.pointerId\r\n      }\r\n      //will handle calling .exec itself\r\n      toolop.modalStart(ctx);\r\n    } else {\r\n      toolop.execPre(tctx);\r\n      toolop.exec(tctx);\r\n      toolop.execPost(tctx);\r\n      toolop.saveDefaultInputs();\r\n    }\r\n  }\r\n\r\n  toolCancel(ctx, tool) {\r\n    if (tool._was_redo) { //also set by toolstack.redo\r\n      //ignore tool cancel requests on redo\r\n      return;\r\n    }\r\n\r\n    if (tool !== this[this.cur]) {\r\n      console.warn(\"toolCancel called in error\", this, tool);\r\n      return;\r\n    }\r\n\r\n    this.undo();\r\n    this.length = this.cur + 1;\r\n\r\n    if (this._undo_branch !== undefined) {\r\n      for (let item of this._undo_branch) {\r\n        this.push(item);\r\n      }\r\n    }\r\n  }\r\n\r\n  undo() {\r\n    if (this.enforceMemLimit) {\r\n      this.limitMemory(this.memLimit);\r\n    }\r\n\r\n    if (this.cur >= 0 && !(this[this.cur].undoflag & UndoFlags.IS_UNDO_ROOT)) {\r\n      let tool = this[this.cur];\r\n\r\n      tool.undo(tool.execCtx);\r\n\r\n      this.cur--;\r\n    }\r\n  }\r\n\r\n  //reruns a tool if it's at the head of the stack\r\n  rerun(tool) {\r\n    if (this.enforceMemLimit) {\r\n      this.limitMemory(this.memLimit);\r\n    }\r\n\r\n    if (tool === this[this.cur]) {\r\n      tool._was_redo = false;\r\n\r\n      if (!tool.execCtx) {\r\n        tool.execCtx = this.ctx;\r\n      }\r\n\r\n      tool.undo(tool.execCtx);\r\n\r\n      tool._was_redo = true; //also set by toolstack.redo\r\n\r\n      tool.undoPre(tool.execCtx);\r\n      tool.execPre(tool.execCtx);\r\n      tool.exec(tool.execCtx);\r\n      tool.execPost(tool.execCtx);\r\n    } else {\r\n      console.warn(\"Tool wasn't at head of stack\", tool);\r\n    }\r\n  }\r\n\r\n  redo() {\r\n    if (this.enforceMemLimit) {\r\n      this.limitMemory(this.memLimit);\r\n    }\r\n\r\n    if (this.cur >= -1 && this.cur + 1 < this.length) {\r\n      //console.log(\"redo!\", this.cur, this.length);\r\n\r\n      this.cur++;\r\n      let tool = this[this.cur];\r\n\r\n\r\n      if (!tool.execCtx) {\r\n        tool.execCtx = this.ctx;\r\n      }\r\n\r\n      tool._was_redo = true;\r\n      tool.redo(tool.execCtx);\r\n\r\n      tool.saveDefaultInputs();\r\n    }\r\n  }\r\n\r\n  save() {\r\n    let data = [];\r\n    nstructjs.writeObject(data, this);\r\n    return data;\r\n  }\r\n\r\n  rewind() {\r\n    while (this.cur >= 0) {\r\n      let last = this.cur;\r\n      this.undo();\r\n\r\n      //prevent infinite loops\r\n      if (last === this.cur) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**cb is a function(ctx), if it returns the value false then playback stops\r\n   promise will still be fulfilled.\r\n\r\n   onstep is a callback, if it returns a promise that promise will be\r\n   waited on, otherwise execution is queue with window.setTimeout().\r\n   */\r\n  replay(cb, onStep) {\r\n    let cur = this.cur;\r\n\r\n    this.rewind();\r\n\r\n    let last = this.cur;\r\n\r\n    let start = util.time_ms();\r\n\r\n    return new Promise((accept, reject) => {\r\n      let next = () => {\r\n        last = this.cur;\r\n\r\n        if (cb && cb(ctx) === false) {\r\n          accept();\r\n          return;\r\n        }\r\n\r\n        if (this.cur < this.length) {\r\n          this.cur++;\r\n          this.rerun();\r\n        }\r\n\r\n        if (last === this.cur) {\r\n          console.warn(\"time:\", (util.time_ms() - start)/1000.0);\r\n          accept(this);\r\n        } else {\r\n          if (onStep) {\r\n            let ret = onStep();\r\n\r\n            if (ret && ret instanceof Promise) {\r\n              ret.then(() => {\r\n                next();\r\n              });\r\n            } else {\r\n              window.setTimeout(() => {\r\n                next();\r\n              })\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      next();\r\n    });\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    for (let item of this._stack) {\r\n      this.push(item);\r\n    }\r\n\r\n    delete this._stack;\r\n  }\r\n\r\n  //note that this makes sure tool classes are registered with nstructjs\r\n  //during save\r\n  _save() {\r\n    for (let tool of this) {\r\n      let cls = tool.constructor;\r\n\r\n      if (!nstructjs.isRegistered(cls)) {\r\n        cls._regWithNstructjs(cls);\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nToolStack.STRUCT = `\r\ntoolsys.ToolStack {\r\n  cur    : int;\r\n  _stack : array(abstract(toolsys.ToolOp)) | this._save();\r\n}\r\n`;\r\nnstructjs.register(ToolStack);\r\n\r\nwindow._testToolStackIO = function () {\r\n  let data = [];\r\n  let cls = _appstate.toolstack.constructor;\r\n\r\n  nstructjs.writeObject(data, _appstate.toolstack);\r\n  data = new DataView(new Uint8Array(data).buffer);\r\n\r\n  let toolstack = nstructjs.readObject(data, cls);\r\n\r\n  _appstate.toolstack.rewind();\r\n\r\n  toolstack.cur = -1;\r\n  toolstack.ctx = _appstate.toolstack.ctx;\r\n  _appstate.toolstack = toolstack;\r\n\r\n  return toolstack;\r\n}\r\n\r\nexport function buildToolOpAPI(api, cls) {\r\n  let st = api.mapStruct(cls, true);\r\n  let def = cls._getFinalToolDef();\r\n\r\n  if (window.DEBUG && window.DEBUG.datapaths) {\r\n    console.log(\"Building api for \", def.toolpath);\r\n  }\r\n\r\n  function makeProp(k) {\r\n    let prop = def.inputs[k];\r\n\r\n    if (prop.flag & (PropFlags.PRIVATE | PropFlags.READ_ONLY)) {\r\n      return;\r\n    }\r\n\r\n    prop.uiname = prop.uiname || ToolProperty.makeUIName(k);\r\n\r\n    let dpath = new DataPath(k, k, prop);\r\n    st.add(dpath);\r\n\r\n    dpath.customGetSet(function () {\r\n      return this.dataref.inputs[k].getValue()\r\n    }, function (val) {\r\n      this.dataref.inputs[k].setValue(val);\r\n    });\r\n  }\r\n\r\n  for (let k in def.inputs) {\r\n    makeProp(k);\r\n  }\r\n\r\n  return st;\r\n}\r\n\r\n/**\r\n * Call this to build the tool property cache data binding API.\r\n *\r\n * If rootCtxClass is not undefined and insertToolDefaultsIntoContext is true\r\n * then \".toolDefaults\" will be automatically added to rootCtxClass's prototype\r\n * if necessary.\r\n */\r\nexport function buildToolSysAPI(api, registerWithNStructjs    = true,\r\n                                rootCtxStruct                 = undefined,\r\n                                rootCtxClass                  = undefined,\r\n                                insertToolDefaultsIntoContext = true) {\r\n  let datastruct = api.mapStruct(ToolPropertyCache, true);\r\n\r\n  for (let cls of ToolClasses) {\r\n    let def = cls._getFinalToolDef();\r\n\r\n    buildToolOpAPI(api, cls);\r\n\r\n    for (let k in def.inputs) {\r\n      let prop = def.inputs[k];\r\n\r\n      if (!(prop.flag & (PropFlags.PRIVATE | PropFlags.READ_ONLY))) {\r\n        SavedToolDefaults._buildAccessors(cls, k, prop, datastruct, api);\r\n      }\r\n    }\r\n  }\r\n\r\n  if (rootCtxStruct) {\r\n    rootCtxStruct.struct(\"toolDefaults\", \"toolDefaults\", \"Tool Defaults\", api.mapStruct(ToolPropertyCache));\r\n    rootCtxStruct.dynamicStruct(\"last_tool\", \"last_tool\", \"Last Tool\");\r\n  }\r\n\r\n  if (rootCtxClass && insertToolDefaultsIntoContext) {\r\n    let inst = new rootCtxClass({});\r\n\r\n    function haveprop(k) {\r\n      return Reflect.ownKeys(inst).indexOf(k) >= 0\r\n        || Reflect.ownKeys(rootCtxClass.prototype).indexOf(k) >= 0;\r\n    }\r\n\r\n    if (!haveprop(\"last_tool\")) {\r\n      Object.defineProperty(rootCtxClass.prototype, \"last_tool\", {\r\n        get() {\r\n          return this.toolstack.head;\r\n        }\r\n      });\r\n\r\n      if (Context.isContextSubclass(rootCtxClass)) {\r\n        rootCtxClass.prototype.last_tool_save = () => ({});\r\n        rootCtxClass.prototype.last_tool_load = () => undefined;\r\n      }\r\n    }\r\n\r\n    if (!haveprop(\"toolDefaults\")) {\r\n      Object.defineProperty(rootCtxClass.prototype, \"toolDefaults\", {\r\n        get() {\r\n          return SavedToolDefaults;\r\n        }\r\n      });\r\n\r\n      if (Context.isContextSubclass(rootCtxClass)) {\r\n        rootCtxClass.prototype.toolDefaults_save = () => ({});\r\n        rootCtxClass.prototype.toolDefaults_load = () => undefined;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (!registerWithNStructjs) {\r\n    return;\r\n  }\r\n\r\n  //register tools with nstructjs\r\n  for (let cls of ToolClasses) {\r\n    try {\r\n      if (!nstructjs.isRegistered(cls)) {\r\n        ToolOp._regWithNstructjs(cls);\r\n      }\r\n    } catch (error) {\r\n      console.log(error.stack);\r\n      console.error(\"Failed to register a tool with nstructjs\");\r\n    }\r\n  }\r\n}\r\n","\"use strict\";\r\n\r\n/**\r\n *\r\n * A not-so-simple 1d bspline curve class.\r\n *\r\n * It's actually a 2d bspline curve class that\r\n * uses a root finding algorithm to find the value\r\n * along the x dimension.\r\n *\r\n * To make things worse, due to the rule that widgets\r\n * cannot store direct references into the data model\r\n * there is a lot of weird event handling code that's\r\n * used by curve widgets to sync their internal curve copy\r\n * and the model.\r\n **/\r\nimport nstructjs from \"../util/struct.js\";\r\nimport config from \"../config/config.js\";\r\nimport { ToolOp } from \"../toolsys/toolsys.js\";\r\n\r\nimport * as util from \"../util/util.js\";\r\n//import * as ui_base from './ui_base.js';\r\nimport * as vectormath from \"../util/vectormath.js\";\r\n//import {EventDispatcher} from \"../util/events.js\";\r\n\r\nlet Vector2 = vectormath.Vector2;\r\n\r\nexport const SplineTemplates = {\r\n  CONSTANT      : 0,\r\n  LINEAR        : 1,\r\n  SHARP         : 2,\r\n  SQRT          : 3,\r\n  SMOOTH        : 4,\r\n  SMOOTHER      : 5,\r\n  SHARPER       : 6,\r\n  SPHERE        : 7,\r\n  REVERSE_LINEAR: 8,\r\n  GUASSIAN      : 9,\r\n};\r\n\r\nconst templates = {\r\n  [SplineTemplates.CONSTANT]: [\r\n    [1, 1],\r\n    [1, 1],\r\n  ],\r\n  [SplineTemplates.LINEAR]: [\r\n    [0, 0],\r\n    [1, 1],\r\n  ],\r\n  [SplineTemplates.SHARP]: [\r\n    [0, 0],\r\n    [0.9999, 0.0001],\r\n    [1, 1],\r\n  ],\r\n  [SplineTemplates.SQRT]: [\r\n    [0, 0],\r\n    [0.05, 0.25],\r\n    [0.15, 0.45],\r\n    [0.33, 0.65],\r\n    [1, 1],\r\n  ],\r\n  [SplineTemplates.SMOOTH]        : [\"DEG\", 3, [0, 0], [1.0 / 3.0, 0], [2.0 / 3.0, 1.0], [1, 1]],\r\n  [SplineTemplates.SMOOTHER]      : [\"DEG\", 6, [0, 0], [1.0 / 2.25, 0], [2.0 / 3.0, 1.0], [1, 1]],\r\n  [SplineTemplates.SHARPER]: [\r\n    [0, 0],\r\n    [0.3, 0.03],\r\n    [0.7, 0.065],\r\n    [0.9, 0.16],\r\n    [1, 1],\r\n  ],\r\n  [SplineTemplates.SPHERE]: [\r\n    [0, 0],\r\n    [0.01953, 0.23438],\r\n    [0.08203, 0.43359],\r\n    [0.18359, 0.625],\r\n    [0.35938, 0.81641],\r\n    [0.625, 0.97656],\r\n    [1, 1],\r\n  ],\r\n  [SplineTemplates.REVERSE_LINEAR]: [\r\n    [0, 1],\r\n    [1, 0],\r\n  ],\r\n  [SplineTemplates.GUASSIAN]: [\"DEG\", 5, [0, 0], [0.17969, 0.007], [0.48958, 0.01172], [0.77995, 0.99609], [1, 1]],\r\n};\r\n\r\n//is initialized below\r\nexport const SplineTemplateIcons = {};\r\n\r\nlet RecalcFlags = {\r\n  BASIS: 1,\r\n  FULL : 2,\r\n  ALL  : 3,\r\n\r\n  //private flag\r\n  FULL_BASIS: 4,\r\n};\r\n\r\nexport function mySafeJSONStringify(obj) {\r\n  return JSON.stringify(obj.toJSON(), function (key) {\r\n    let v = this[key];\r\n\r\n    if (typeof v === \"number\") {\r\n      if (v !== Math.floor(v)) {\r\n        v = parseFloat(v.toFixed(5));\r\n      } else {\r\n        v = v;\r\n      }\r\n    }\r\n\r\n    return v;\r\n  });\r\n}\r\n\r\nexport function mySafeJSONParse(buf) {\r\n  return JSON.parse(buf, (key, val) => {});\r\n}\r\n\r\nwindow.mySafeJSONStringify = mySafeJSONStringify;\r\n\r\nlet bin_cache = {};\r\nwindow._bin_cache = bin_cache;\r\n\r\nlet eval2_rets = util.cachering.fromConstructor(Vector2, 32);\r\n\r\n/*\r\n  I hate these stupid curve widgets.  This horrible one here works by\r\n  root-finding the x axis on a two dimensional b-spline (which works\r\n  surprisingly well).\r\n*/\r\n\r\nfunction bez3(a, b, c, t) {\r\n  let r1 = a + (b - a) * t;\r\n  let r2 = b + (c - b) * t;\r\n\r\n  return r1 + (r2 - r1) * t;\r\n}\r\n\r\nfunction bez4(a, b, c, d, t) {\r\n  let r1 = bez3(a, b, c, t);\r\n  let r2 = bez3(b, c, d, t);\r\n\r\n  return r1 + (r2 - r1) * t;\r\n}\r\n\r\nexport function binomial(n, i) {\r\n  if (i > n) {\r\n    throw new Error(\"Bad call to binomial(n, i), i was > than n\");\r\n  }\r\n\r\n  if (i === 0 || i === n) {\r\n    return 1;\r\n  }\r\n\r\n  let key = \"\" + n + \",\" + i;\r\n\r\n  if (key in bin_cache) return bin_cache[key];\r\n\r\n  let ret = binomial(n - 1, i - 1) + bin(n - 1, i);\r\n  bin_cache[key] = ret;\r\n\r\n  return ret;\r\n}\r\n\r\nwindow.bin = binomial;\r\n\r\nimport { CurveFlags, TangentModes, CurveTypeData } from \"./curve1d_base.js\";\r\nimport {\r\n  BoolProperty,\r\n  EnumProperty,\r\n  FloatProperty,\r\n  IntProperty,\r\n  StringProperty,\r\n  Vec2Property,\r\n} from \"../toolsys/toolprop.js\";\r\n\r\nexport class Curve1dBSplineOpBase extends ToolOp {\r\n  static tooldef() {\r\n    return {\r\n      inputs: {\r\n        dataPath: new StringProperty(),\r\n      },\r\n      outputs: {},\r\n    };\r\n  }\r\n\r\n  _undo = undefined;\r\n\r\n  undoPre(ctx) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n    if (curve1d) {\r\n      this._undo = curve1d.copy();\r\n    } else {\r\n      this._undo = undefined;\r\n    }\r\n  }\r\n\r\n  undo(ctx) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n    if (curve1d) {\r\n      curve1d.load(this._undo);\r\n      curve1d._fireEvent(\"update\", curve1d);\r\n    }\r\n  }\r\n\r\n  getCurve1d(ctx) {\r\n    let { dataPath } = this.getInputs();\r\n\r\n    let curve1d;\r\n    try {\r\n      curve1d = ctx.api.getValue(ctx, dataPath);\r\n    } catch (error) {\r\n      console.error(error.stack);\r\n      console.error(error.message);\r\n      console.error(\"Failed to lookup curve1d property at path \", dataPath);\r\n      return;\r\n    }\r\n\r\n    return curve1d;\r\n  }\r\n\r\n  execPost(ctx) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n    if (curve1d) {\r\n      curve1d._fireEvent(\"update\", curve1d);\r\n    }\r\n  }\r\n}\r\n\r\nexport class Curve1dBSplineResetOp extends Curve1dBSplineOpBase {\r\n  static tooldef() {\r\n    return {\r\n      toolpath: \"curve1d.reset_bspline\",\r\n      inputs  : ToolOp.inherit({}),\r\n      outputs : {},\r\n    };\r\n  }\r\n\r\n  exec(ctx) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n    if (curve1d) {\r\n      curve1d.generators.active.reset();\r\n    }\r\n  }\r\n}\r\n\r\nToolOp.register(Curve1dBSplineResetOp);\r\n\r\nexport class Curve1dBSplineLoadTemplOp extends Curve1dBSplineOpBase {\r\n  static tooldef() {\r\n    return {\r\n      toolpath: \"curve1d.bspline_load_template\",\r\n      inputs: ToolOp.inherit({\r\n        template: new EnumProperty(SplineTemplates.SMOOTH, SplineTemplates),\r\n      }),\r\n      outputs : {},\r\n    };\r\n  }\r\n\r\n  exec(ctx) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n    let { template } = this.getInputs();\r\n\r\n    if (curve1d) {\r\n      curve1d.generators.active.loadTemplate(template);\r\n    }\r\n  }\r\n}\r\n\r\nToolOp.register(Curve1dBSplineLoadTemplOp);\r\n\r\nexport class Curve1dBSplineDeleteOp extends Curve1dBSplineOpBase {\r\n  static tooldef() {\r\n    return {\r\n      toolpath: \"curve1d.bspline_delete_point\",\r\n      inputs  : ToolOp.inherit({}),\r\n      outputs : {},\r\n    };\r\n  }\r\n\r\n  exec(ctx) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n\r\n    if (curve1d) {\r\n      curve1d.generators.active.deletePoint();\r\n    }\r\n  }\r\n}\r\n\r\nToolOp.register(Curve1dBSplineDeleteOp);\r\n\r\nexport class Curve1dBSplineSelectOp extends Curve1dBSplineOpBase {\r\n  static tooldef() {\r\n    return {\r\n      toolpath: \"curve1d.bspline_select_point\",\r\n      inputs: ToolOp.inherit({\r\n        point : new IntProperty(-1),\r\n        state : new BoolProperty(true),\r\n        unique: new BoolProperty(true),\r\n      }),\r\n      outputs : {},\r\n    };\r\n  }\r\n\r\n  exec(ctx) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n\r\n    if (curve1d) {\r\n      let bspline = curve1d.generators.active;\r\n      let { point, state, unique } = this.getInputs();\r\n\r\n      for (let p of bspline.points) {\r\n        if (p.eid === point) {\r\n          if (state) {\r\n            p.flag |= CurveFlags.SELECT;\r\n          } else {\r\n            p.flag &= ~CurveFlags.SELECT;\r\n          }\r\n        } else if (unique) {\r\n          p.flag &= ~CurveFlags.SELECT;\r\n        }\r\n      }\r\n\r\n      curve1d._fireEvent(\"select\", bspline);\r\n    }\r\n  }\r\n}\r\n\r\nToolOp.register(Curve1dBSplineSelectOp);\r\n\r\nexport class Curve1dBSplineAddOp extends Curve1dBSplineOpBase {\r\n  static tooldef() {\r\n    return {\r\n      toolpath: \"curve1d.bspline_add_point\",\r\n      inputs: ToolOp.inherit({\r\n        x: new FloatProperty(),\r\n        y: new FloatProperty(),\r\n      }),\r\n      outputs : {},\r\n    };\r\n  }\r\n\r\n  exec(ctx) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n\r\n    if (curve1d) {\r\n      let { x, y } = this.getInputs();\r\n      curve1d.generators.active.addFromMouse(x, y);\r\n    }\r\n  }\r\n}\r\n\r\nToolOp.register(Curve1dBSplineAddOp);\r\n\r\nexport class BSplineTransformOp extends ToolOp {\r\n  constructor() {\r\n    super();\r\n\r\n    this.first = true;\r\n    this.start_mpos = new Vector2();\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      toolpath: \"curve1d.transform_bspline\",\r\n      inputs: {\r\n        dataPath: new StringProperty(),\r\n        off     : new Vec2Property(),\r\n        dpi     : new FloatProperty(1.0),\r\n      },\r\n      is_modal: true,\r\n      outputs : {},\r\n    };\r\n  }\r\n\r\n  _undo = undefined;\r\n\r\n  storePoints(ctx) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n\r\n    if (curve1d) {\r\n      let bspline = curve1d.generators.active;\r\n      return Array.from(bspline.points).map((p) => p.copy());\r\n    }\r\n\r\n    return [];\r\n  }\r\n\r\n  loadPoints(ctx, ps) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n\r\n    if (curve1d) {\r\n      let bspline = curve1d.generators.active;\r\n\r\n      for (let p1 of bspline.points) {\r\n        for (let p2 of ps) {\r\n          if (p2.eid === p1.eid) {\r\n            p1.co.load(p2.co);\r\n            p1.rco.load(p2.rco);\r\n            p1.sco.load(p2.sco);\r\n          }\r\n        }\r\n      }\r\n\r\n      bspline.parent._fireEvent(\"transform\", bspline);\r\n\r\n      bspline.recalc = RecalcFlags.ALL;\r\n      bspline.updateKnots();\r\n      bspline.update();\r\n      bspline.redraw();\r\n    }\r\n  }\r\n\r\n  undoPre(ctx) {\r\n    this._undo = this.storePoints(ctx);\r\n  }\r\n\r\n  undo(ctx) {\r\n    this.loadPoints(ctx, this._undo);\r\n  }\r\n\r\n  getCurve1d(ctx) {\r\n    let { dataPath } = this.getInputs();\r\n\r\n    let curve1d;\r\n    try {\r\n      curve1d = ctx.api.getValue(ctx, dataPath);\r\n    } catch (error) {\r\n      console.error(error.stack);\r\n      console.error(error.message);\r\n      console.error(\"Failed to lookup curve1d property at path \", dataPath);\r\n      return;\r\n    }\r\n\r\n    return curve1d;\r\n  }\r\n\r\n  finish(cancel = false) {\r\n    let ctx = this.modal_ctx;\r\n    this.modalEnd(cancel);\r\n\r\n    let curve1d = this.getCurve1d(ctx);\r\n    if (curve1d) {\r\n      curve1d.generators.active.fastmode = false;\r\n    }\r\n\r\n    if (cancel) {\r\n      this.undo(ctx);\r\n    }\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    this.finish();\r\n  }\r\n\r\n  modalStart(ctx) {\r\n    super.modalStart(ctx);\r\n\r\n    let curve1d = this.getCurve1d(ctx);\r\n    if (!curve1d) {\r\n      console.log(\"Failed to get curve1d!\");\r\n      return;\r\n    }\r\n\r\n    let bspline = curve1d.generators.active;\r\n    for (let p of bspline.points) {\r\n      p.startco.load(p.co);\r\n    }\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let mpos = new Vector2().loadXY(e.x, e.y);\r\n    if (this.first) {\r\n      this.start_mpos.load(mpos);\r\n      this.first = false;\r\n      return;\r\n    }\r\n\r\n    let curve1d = this.getCurve1d(this.modal_ctx);\r\n    if (curve1d) {\r\n      curve1d.generators.active.fastmode = true;\r\n    }\r\n\r\n    const { dpi } = this.getInputs();\r\n    let off = new Vector2(mpos).sub(this.start_mpos).mulScalar(dpi);\r\n    off[1] = -off[1];\r\n\r\n    this.inputs.off.setValue(off);\r\n\r\n    const bspline = curve1d.generators.active;\r\n    for (let p of bspline.points) {\r\n      p.co.load(p.startco);\r\n    }\r\n\r\n    this.exec(this.modal_ctx);\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    this.finish();\r\n  }\r\n\r\n  exec(ctx) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n    if (!curve1d) {\r\n      return;\r\n    }\r\n\r\n    let bspline = curve1d.generators.active;\r\n    let { off } = this.getInputs();\r\n\r\n    const xRange = curve1d.xRange,\r\n      yRange = curve1d.yRange;\r\n\r\n    for (let p of bspline.points) {\r\n      if (p.flag & CurveFlags.SELECT) {\r\n        p.co.add(off);\r\n        p.co[0] = Math.min(Math.max(p.co[0], xRange[0]), xRange[1]);\r\n        p.co[1] = Math.min(Math.max(p.co[1], yRange[0]), yRange[1]);\r\n      }\r\n    }\r\n\r\n    bspline.parent._fireEvent(\"transform\", bspline);\r\n\r\n    bspline.recalc = RecalcFlags.ALL;\r\n    bspline.updateKnots();\r\n    bspline.update();\r\n    bspline.redraw();\r\n  }\r\n}\r\n\r\nToolOp.register(BSplineTransformOp);\r\n\r\nexport class Curve1DPoint {\r\n  constructor(co) {\r\n    this.co = new Vector2(co);\r\n    this.rco = new Vector2(co);\r\n    this.sco = new Vector2(co);\r\n\r\n    //for transform\r\n    this.startco = new Vector2();\r\n    this.eid = -1;\r\n    this.flag = 0;\r\n\r\n    this.tangent = TangentModes.SMOOTH;\r\n\r\n    Object.seal(this);\r\n  }\r\n\r\n  get 0() {\r\n    throw new Error(\"Curve1DPoint get 0\");\r\n  }\r\n\r\n  get 1() {\r\n    throw new Error(\"Curve1DPoint get 1\");\r\n  }\r\n\r\n  /* Needed for file compatibility. */\r\n  set 0(v) {\r\n    this.co[0] = v;\r\n  }\r\n\r\n  set 1(v) {\r\n    this.co[1] = v;\r\n  }\r\n\r\n  load(b) {\r\n    this.eid = b.eid;\r\n    this.flag = b.flag;\r\n    this.tangent = b.tangent;\r\n\r\n    this.co.load(b.co);\r\n    this.rco.load(b.rco);\r\n    this.sco.load(b.sco);\r\n    this.startco.load(b.startco);\r\n\r\n    return this;\r\n  }\r\n\r\n  set deg(v) {\r\n    console.warn(\"old file data detected\");\r\n  }\r\n\r\n  static fromJSON(obj) {\r\n    let ret = new Curve1DPoint(obj);\r\n\r\n    if (\"0\" in obj) {\r\n      ret.co[0] = obj[0];\r\n      ret.co[1] = obj[1];\r\n    } else {\r\n      ret.co.load(obj.co);\r\n    }\r\n\r\n    ret.startco.load(obj.startco);\r\n    ret.eid = obj.eid;\r\n    ret.flag = obj.flag;\r\n    ret.tangent = obj.tangent;\r\n\r\n    ret.rco.load(obj.rco);\r\n\r\n    return ret;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new Curve1DPoint(this.co);\r\n\r\n    ret.tangent = this.tangent;\r\n    ret.flag = this.flag;\r\n    ret.eid = this.eid;\r\n\r\n    ret.startco.load(this.startco);\r\n    ret.rco.load(this.rco);\r\n    ret.sco.load(this.sco);\r\n\r\n    return ret;\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      co     : this.co,\r\n      eid    : this.eid,\r\n      flag   : this.flag,\r\n      tangent: this.tangent,\r\n\r\n      rco    : this.rco,\r\n      startco: this.startco,\r\n    };\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    this.sco.load(this.co);\r\n    this.rco.load(this.co);\r\n\r\n    splineCache.update(this);\r\n  }\r\n}\r\nCurve1DPoint.STRUCT = `\r\nCurve1DPoint {\r\n  co      : vec2;\r\n  rco     : vec2;\r\n  sco     : vec2;\r\n  startco : vec2;\r\n  eid     : int;\r\n  flag    : int;\r\n  tangent : int;\r\n}\r\n`;\r\nnstructjs.register(Curve1DPoint);\r\n\r\nlet _udigest = new util.HashDigest();\r\n\r\nclass BSplineCache {\r\n  constructor() {\r\n    this.curves = [];\r\n    this.map = new Map();\r\n    this.maxCurves = 32;\r\n    this.gen = 0;\r\n  }\r\n\r\n  limit() {\r\n    if (this.curves.length <= this.maxCurves) {\r\n      return;\r\n    }\r\n\r\n    this.curves.sort((a, b) => b.cache_w - a.cache_w);\r\n    while (this.curves.length > this.maxCurves) {\r\n      let curve = this.curves.pop();\r\n      this.map.delete(curve.calcHashKey());\r\n    }\r\n  }\r\n\r\n  has(curve) {\r\n    let curve2 = this.map.get(curve.calcHashKey());\r\n    return curve2 && curve2.equals(curve);\r\n  }\r\n\r\n  get(curve) {\r\n    let key = curve.calcHashKey();\r\n    curve._last_cache_key = key;\r\n\r\n    let curve2 = this.map.get(key);\r\n    if (curve2 && curve2.equals(curve)) {\r\n      curve2.cache_w = this.gen++;\r\n      return curve2;\r\n    }\r\n\r\n    curve2 = curve.copy();\r\n    curve2._last_cache_key = key;\r\n\r\n    curve2.updateKnots();\r\n    curve2.regen_basis();\r\n    curve2.regen_hermite();\r\n\r\n    this.map.set(curve2);\r\n    this.curves.push(curve2);\r\n\r\n    curve2.cache_w = this.gen++;\r\n\r\n    this.limit();\r\n\r\n    return curve2;\r\n  }\r\n\r\n  _remove(key) {\r\n    let curve = this.map.get(key);\r\n    this.map.delete(key);\r\n    this.curves.remove(curve);\r\n  }\r\n\r\n  update(curve) {\r\n    let key = curve._last_cache_key;\r\n\r\n    if (this.map.has(key)) {\r\n      this._remove(curve);\r\n      this.get(curve);\r\n    }\r\n  }\r\n}\r\n\r\nlet splineCache = new BSplineCache();\r\nwindow._splineCache = splineCache;\r\n\r\nlet _idgen = 1;\r\n\r\nclass BSplineCurve extends CurveTypeData {\r\n  constructor() {\r\n    super();\r\n\r\n    this._bid = _idgen++;\r\n\r\n    this._degOffset = 0;\r\n    this.cache_w = 0;\r\n    this._last_cache_key = 0;\r\n\r\n    this.fastmode = false;\r\n    this.points = [];\r\n    this.length = 0;\r\n    this.interpolating = false;\r\n\r\n    this._ps = [];\r\n    this.hermite = [];\r\n    this.fastmode = false;\r\n\r\n    this.deg = 6;\r\n    this.recalc = RecalcFlags.ALL;\r\n    this.basis_tables = [];\r\n    this.eidgen = new util.IDGen();\r\n\r\n    this.add(0, 0);\r\n    this.add(1, 1);\r\n\r\n    this.mpos = new Vector2();\r\n\r\n    this.on_mousedown = this.on_mousedown.bind(this);\r\n    this.on_mousemove = this.on_mousemove.bind(this);\r\n    this.on_mouseup = this.on_mouseup.bind(this);\r\n    this.on_keydown = this.on_keydown.bind(this);\r\n    this.on_touchstart = this.on_touchstart.bind(this);\r\n    this.on_touchmove = this.on_touchmove.bind(this);\r\n    this.on_touchend = this.on_touchend.bind(this);\r\n    this.on_touchcancel = this.on_touchcancel.bind(this);\r\n  }\r\n\r\n  get hasGUI() {\r\n    return this.uidata !== undefined;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      uiname  : \"B-Spline\",\r\n      name    : \"bspline\",\r\n      typeName: \"BSplineCurve\",\r\n    };\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    let d = digest;\r\n\r\n    super.calcHashKey(d);\r\n\r\n    d.add(this.deg);\r\n    d.add(this.interpolating);\r\n    d.add(this.points.length);\r\n\r\n    for (let p of this.points) {\r\n      let x = ~~(p.co[0] * 1024);\r\n      let y = ~~(p.co[1] * 1024);\r\n\r\n      d.add(x);\r\n      d.add(y);\r\n      d.add(p.tangent); //is an enum\r\n    }\r\n\r\n    return d.get();\r\n  }\r\n\r\n  copyTo(b) {\r\n    b.deg = this.deg;\r\n    b.interpolating = this.interpolating;\r\n    b.fastmode = this.fastmode;\r\n\r\n    for (let p of this.points) {\r\n      let p2 = p.copy();\r\n\r\n      b.points.push(p2);\r\n    }\r\n\r\n    return b;\r\n  }\r\n\r\n  copy() {\r\n    let curve = new BSplineCurve();\r\n    this.copyTo(curve);\r\n    return curve;\r\n  }\r\n\r\n  equals(b) {\r\n    if (b.type !== this.type) {\r\n      return false;\r\n    }\r\n\r\n    let bad = this.points.length !== b.points.length;\r\n\r\n    bad = bad || this.deg !== b.deg;\r\n    bad = bad || this.interpolating !== b.interpolating;\r\n\r\n    if (bad) {\r\n      return false;\r\n    }\r\n\r\n    for (let i = 0; i < this.points.length; i++) {\r\n      let p1 = this.points[i];\r\n      let p2 = b.points[i];\r\n\r\n      if (p1.co.vectorDistance(p2.co) > 0.00001) {\r\n        return false;\r\n      }\r\n\r\n      if (p1.tangent !== p2.tangent) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  remove(p) {\r\n    let ret = this.points.remove(p);\r\n    this.length = this.points.length;\r\n\r\n    return ret;\r\n  }\r\n\r\n  add(x, y, no_update = false) {\r\n    let p = new Curve1DPoint();\r\n    this.recalc = RecalcFlags.ALL;\r\n\r\n    p.eid = this.eidgen.next();\r\n\r\n    p.co.loadXY(x, y);\r\n    p.sco.load(p.co);\r\n    p.rco.load(p.co);\r\n\r\n    this.points.push(p);\r\n    if (!no_update) {\r\n      this.update();\r\n    }\r\n\r\n    this.length = this.points.length;\r\n\r\n    return p;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  _sortPoints() {\r\n    if (!this.interpolating) {\r\n      for (let i = 0; i < this.points.length; i++) {\r\n        this.points[i].rco.load(this.points[i].co);\r\n      }\r\n    }\r\n\r\n    this.points.sort(function (a, b) {\r\n      return a.co[0] - b.co[0];\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  updateKnots(recalc = true, points = this.points) {\r\n    if (recalc) {\r\n      this.recalc = RecalcFlags.ALL;\r\n    }\r\n\r\n    this._sortPoints();\r\n\r\n    this._ps = [];\r\n    if (points.length < 2) {\r\n      return;\r\n    }\r\n    let a = points[0].co[0],\r\n      b = points[points.length - 1].co[0];\r\n\r\n    let degExtra = this.deg;\r\n    this._degOffset = -this.deg;\r\n\r\n    for (let i = 0; i < points.length - 1; i++) {\r\n      this._ps.push(points[i]);\r\n    }\r\n\r\n    if (degExtra) {\r\n      let last = points.length - 1;\r\n      for (let i = 0; i < degExtra; i++) {\r\n        let p = points[last].copy();\r\n        this._ps.push(p);\r\n      }\r\n    }\r\n\r\n    if (!this.interpolating) {\r\n      for (let i = 0; i < this._ps.length; i++) {\r\n        this._ps[i].rco.load(this._ps[i].co);\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < points.length; i++) {\r\n      let p = points[i];\r\n      let x = p.co[0],\r\n        y = p.co[1]; //this.evaluate(x);\r\n\r\n      p.sco[0] = x;\r\n      p.sco[1] = y;\r\n    }\r\n  }\r\n\r\n  toJSON() {\r\n    this._sortPoints();\r\n\r\n    let ret = super.toJSON();\r\n\r\n    ret = Object.assign(ret, {\r\n      points       : this.points.map((p) => p.toJSON()),\r\n      deg          : this.deg,\r\n      interpolating: this.interpolating,\r\n      eidgen       : this.eidgen.toJSON(),\r\n    });\r\n\r\n    return ret;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    this.interpolating = obj.interpolating;\r\n    this.deg = obj.deg;\r\n\r\n    this.length = 0;\r\n    this.points = [];\r\n    this._ps = [];\r\n\r\n    if (obj.range) {\r\n      /* Will be version patched later. */\r\n      this.range = [new Vector2(obj.range[0]), new Vector2(obj.range[1])];\r\n    }\r\n\r\n    this.hightlight = undefined;\r\n    this.eidgen = util.IDGen.fromJSON(obj.eidgen);\r\n    this.recalc = RecalcFlags.ALL;\r\n    this.mpos = [0, 0];\r\n\r\n    for (let i = 0; i < obj.points.length; i++) {\r\n      this.points.push(Curve1DPoint.fromJSON(obj.points[i]));\r\n    }\r\n\r\n    this.updateKnots();\r\n    this.redraw();\r\n\r\n    return this;\r\n  }\r\n\r\n  basis(t, i) {\r\n    if (this.recalc & RecalcFlags.FULL_BASIS) {\r\n      return this._basis(t, i);\r\n    }\r\n\r\n    if (this.recalc & RecalcFlags.BASIS) {\r\n      this.regen_basis();\r\n      this.recalc &= ~RecalcFlags.BASIS;\r\n    }\r\n\r\n    i = Math.min(Math.max(i, 0), this._ps.length - 1);\r\n    t = Math.min(Math.max(t, 0.0), 1.0) * 0.999999999;\r\n\r\n    let table = this.basis_tables[i];\r\n\r\n    let s = t * (table.length / 4) * 0.99999;\r\n\r\n    let j = ~~s;\r\n    s -= j;\r\n\r\n    j *= 4;\r\n\r\n    //return table[j] + (table[j + 3] - table[j])*s; //linear\r\n    return bez4(table[j], table[j + 1], table[j + 2], table[j + 3], s); //cubic\r\n  }\r\n\r\n  reset(empty = false) {\r\n    this.length = 0;\r\n    this.points = [];\r\n    this._ps = [];\r\n\r\n    if (!empty) {\r\n      this.add(0, 0, true);\r\n      this.add(1, 1, true);\r\n    }\r\n\r\n    this.recalc = 1;\r\n    this.updateKnots();\r\n    this.update();\r\n    this.redraw();\r\n\r\n    return this;\r\n  }\r\n\r\n  regen_hermite(steps) {\r\n    if (splineCache.has(this)) {\r\n      console.log(\"loading spline approx from cached bspline data\");\r\n\r\n      this.hermite = splineCache.get(this).hermite;\r\n      return;\r\n    }\r\n\r\n    if (steps === undefined) {\r\n      steps = this.fastmode ? 120 : 340;\r\n    }\r\n\r\n    if (this.interpolating) {\r\n      steps *= 2;\r\n    }\r\n\r\n    this.hermite = new Array(steps);\r\n    let table = this.hermite;\r\n\r\n    let eps = 0.00001;\r\n    let dt = (1.0 - eps * 4.001) / (steps - 1);\r\n    let t = eps * 4;\r\n    let lastdv1, lastf3;\r\n\r\n    for (let j = 0; j < steps; j++, t += dt) {\r\n      let f1 = this._evaluate(t - eps * 2);\r\n      let f2 = this._evaluate(t - eps);\r\n      let f3 = this._evaluate(t);\r\n      let f4 = this._evaluate(t + eps);\r\n      let f5 = this._evaluate(t + eps * 2);\r\n\r\n      let dv1 = (f4 - f2) / (eps * 2);\r\n      dv1 /= steps;\r\n\r\n      if (j > 0) {\r\n        let j2 = j - 1;\r\n\r\n        table[j2 * 4] = lastf3;\r\n        table[j2 * 4 + 1] = lastf3 + lastdv1 / 3.0;\r\n        table[j2 * 4 + 2] = f3 - dv1 / 3.0;\r\n        table[j2 * 4 + 3] = f3;\r\n      }\r\n\r\n      lastdv1 = dv1;\r\n      lastf3 = f3;\r\n    }\r\n  }\r\n\r\n  solve_interpolating() {\r\n    //this.recalc |= RecalcFlags.FULL_BASIS;\r\n\r\n    for (let p of this._ps) {\r\n      p.rco.load(p.co);\r\n    }\r\n\r\n    let points = this.points.concat(this.points);\r\n\r\n    this._evaluate2(0.5);\r\n\r\n    let error1 = (p) => {\r\n      //return p.vectorDistance(this._evaluate2(p.co[0]));\r\n      return this._evaluate(p.co[0]) - p.co[1];\r\n    };\r\n\r\n    let error = (p) => {\r\n      return error1(p);\r\n\r\n      /*\r\n      let err = 0.0;\r\n      for (let p of this.points) {\r\n        //err += error1(p)**2;\r\n        err += Math.abs(error1(p));\r\n      }\r\n\r\n      //return Math.sqrt(err);\r\n      return err;\r\n      //*/\r\n    };\r\n\r\n    let err = 0.0;\r\n    let g = new Vector2();\r\n\r\n    for (let step = 0; step < 25; step++) {\r\n      err = 0.0;\r\n\r\n      for (let p of this._ps) {\r\n        let r1 = error(p);\r\n        const df = 0.000001;\r\n\r\n        err += Math.abs(r1);\r\n\r\n        if (p === this._ps[this._ps.length - 1]) {\r\n          continue;\r\n        }\r\n\r\n        g.zero();\r\n\r\n        for (let i = 0; i < 2; i++) {\r\n          let orig = p.rco[i];\r\n          p.rco[i] += df;\r\n          let r2 = error(p);\r\n          p.rco[i] = orig;\r\n\r\n          g[i] = (r2 - r1) / df;\r\n        }\r\n\r\n        let totgs = g.dot(g);\r\n\r\n        if (totgs < 0.00000001) {\r\n          continue;\r\n        }\r\n\r\n        r1 /= totgs;\r\n        let k = 0.5;\r\n\r\n        p.rco[0] += -r1 * g[0] * k;\r\n        p.rco[1] += -r1 * g[1] * k;\r\n      }\r\n\r\n      let th = this.fastmode ? 0.001 : 0.00005;\r\n      if (err < th) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    //this.recalc &= ~RecalcFlags.FULL_BASIS;\r\n  }\r\n\r\n  regen_basis() {\r\n    if (splineCache.has(this)) {\r\n      console.log(\"loading from cached bspline data\");\r\n\r\n      this.basis_tables = splineCache.get(this).basis_tables;\r\n      return;\r\n    }\r\n\r\n    //let steps = this.fastmode && !this.interpolating ? 64 : 128;\r\n    let steps = this.fastmode ? 64 : 128;\r\n\r\n    if (this.interpolating) {\r\n      steps *= 2;\r\n    }\r\n\r\n    this.basis_tables = new Array(this._ps.length);\r\n\r\n    for (let i = 0; i < this._ps.length; i++) {\r\n      let table = (this.basis_tables[i] = new Array((steps - 1) * 4));\r\n\r\n      let eps = 0.00001;\r\n      let dt = (1.0 - eps * 8) / (steps - 1);\r\n      let t = eps * 4;\r\n      let lastdv1 = 0.0,\r\n        lastf3 = 0.0;\r\n\r\n      for (let j = 0; j < steps; j++, t += dt) {\r\n        let f3 = this._basis(t, i);\r\n        let dv1;\r\n\r\n        if (0) {\r\n          //let f1 = this._basis(t - eps*2, i);\r\n          let f2 = this._basis(t - eps, i);\r\n          let f4 = this._basis(t + eps, i);\r\n          //let f5 = this._basis(t + eps*2, i);\r\n\r\n          dv1 = (f4 - f2) / (eps * 2);\r\n        } else {\r\n          dv1 = this._dbasis(t, i);\r\n        }\r\n\r\n        if (isNaN(dv1)) {\r\n          console.log(\"NaN!\");\r\n          debugger;\r\n          dv1 = this._dbasis(t, i);\r\n        }\r\n        //dv1 = 0.0;\r\n\r\n        //dv1 = 0.0;\r\n        dv1 /= steps;\r\n\r\n        if (j > 0) {\r\n          let j2 = j - 1;\r\n\r\n          table[j2 * 4] = lastf3;\r\n          table[j2 * 4 + 1] = lastf3 + lastdv1 / 3.0;\r\n          table[j2 * 4 + 2] = f3 - dv1 / 3.0;\r\n          table[j2 * 4 + 3] = f3;\r\n        }\r\n\r\n        lastdv1 = dv1;\r\n        lastf3 = f3;\r\n      }\r\n    }\r\n  }\r\n\r\n  _dbasis(t, i) {\r\n    let len = this._ps.length;\r\n    let ps = this._ps;\r\n\r\n    function safe_inv(n) {\r\n      return n === 0 ? 0 : 1.0 / n;\r\n    }\r\n\r\n    /*\r\n    on factor;\r\n\r\n    operator bas;\r\n\r\n    a := (s - ki) / (knn - ki);\r\n    b := (knn1 - s) / (knn1 - kn);\r\n\r\n    f := a*bas(s, j, n-1) + b*bas(s, j+1, n-1);\r\n    df(f, s);\r\n    */\r\n\r\n    function bas(s, i, n) {\r\n      let kn = Math.min(Math.max(i + 1, 0), len - 1);\r\n      let knn = Math.min(Math.max(i + n, 0), len - 1);\r\n      let knn1 = Math.min(Math.max(i + n + 1, 0), len - 1);\r\n      let ki = Math.min(Math.max(i, 0), len - 1);\r\n\r\n      if (n === 0) {\r\n        return s >= ps[ki].rco[0] && s < ps[kn].rco[0] ? 1 : 0;\r\n      } else {\r\n        let a = (s - ps[ki].rco[0]) * safe_inv(ps[knn].rco[0] - ps[ki].rco[0] + 0.0001);\r\n        let b = (ps[knn1].rco[0] - s) * safe_inv(ps[knn1].rco[0] - ps[kn].rco[0] + 0.0001);\r\n\r\n        return a * bas(s, i, n - 1) + b * bas(s, i + 1, n - 1);\r\n      }\r\n    }\r\n\r\n    function dbas(s, j, n) {\r\n      let kn = Math.min(Math.max(j + 1, 0), len - 1);\r\n      let knn = Math.min(Math.max(j + n, 0), len - 1);\r\n      let knn1 = Math.min(Math.max(j + n + 1, 0), len - 1);\r\n      let ki = Math.min(Math.max(j, 0), len - 1);\r\n\r\n      kn = ps[kn].rco[0];\r\n      knn = ps[knn].rco[0];\r\n      knn1 = ps[knn1].rco[0];\r\n      ki = ps[ki].rco[0];\r\n\r\n      if (n === 0) {\r\n        return 0;\r\n        //return s >= ki && s < kn ? 1 : 0;\r\n      } else {\r\n        let div = (ki - knn) * (kn - knn1);\r\n\r\n        if (div === 0.0) {\r\n          return 0.0;\r\n        }\r\n\r\n        return (\r\n          (((ki - s) * dbas(s, j, n - 1) - bas(s, j, n - 1)) * (kn - knn1) -\r\n            ((knn1 - s) * dbas(s, j + 1, n - 1) - bas(s, j + 1, n - 1)) * (ki - knn)) /\r\n          div\r\n        );\r\n      }\r\n    }\r\n\r\n    let deg = this.deg;\r\n    return dbas(t, i + this._degOffset, deg);\r\n  }\r\n\r\n  _basis(t, i) {\r\n    let len = this._ps.length;\r\n    let ps = this._ps;\r\n\r\n    function safe_inv(n) {\r\n      return n === 0 ? 0 : 1.0 / n;\r\n    }\r\n\r\n    function bas(s, i, n) {\r\n      let kp = Math.min(Math.max(i - 1, 0), len - 1);\r\n      let kn = Math.min(Math.max(i + 1, 0), len - 1);\r\n      let knn = Math.min(Math.max(i + n, 0), len - 1);\r\n      let knn1 = Math.min(Math.max(i + n + 1, 0), len - 1);\r\n      let ki = Math.min(Math.max(i, 0), len - 1);\r\n\r\n      if (n === 0) {\r\n        return s >= ps[ki].rco[0] && s < ps[kn].rco[0] ? 1 : 0;\r\n      } else {\r\n        let a = (s - ps[ki].rco[0]) * safe_inv(ps[knn].rco[0] - ps[ki].rco[0] + 0.0001);\r\n        let b = (ps[knn1].rco[0] - s) * safe_inv(ps[knn1].rco[0] - ps[kn].rco[0] + 0.0001);\r\n\r\n        return a * bas(s, i, n - 1) + b * bas(s, i + 1, n - 1);\r\n      }\r\n    }\r\n\r\n    let p = this._ps[i].rco,\r\n      nk,\r\n      pk;\r\n    let deg = this.deg;\r\n\r\n    let b = bas(t, i + this._degOffset, deg);\r\n\r\n    return b;\r\n  }\r\n\r\n  evaluate(t) {\r\n    if (this.points.length === 0) {\r\n      return 0.0;\r\n    }\r\n\r\n    let a = this.points[0].rco,\r\n      b = this.points[this.points.length - 1].rco;\r\n\r\n    if (t < a[0]) return a[1];\r\n    if (t > b[0]) return b[1];\r\n\r\n    if (this.points.length === 2) {\r\n      t = (t - a[0]) / (b[0] - a[0]);\r\n      return a[1] + (b[1] - a[1]) * t;\r\n    }\r\n\r\n    if (this.recalc) {\r\n      this.regen_basis();\r\n\r\n      if (this.interpolating) {\r\n        this.solve_interpolating();\r\n      }\r\n\r\n      this.regen_hermite();\r\n      this.recalc = 0;\r\n    }\r\n\r\n    t *= 0.999999;\r\n\r\n    let table = this.hermite;\r\n    let s = t * (table.length / 4);\r\n\r\n    let i = Math.floor(s);\r\n    s -= i;\r\n\r\n    i *= 4;\r\n\r\n    return table[i] + (table[i + 3] - table[i]) * s;\r\n  }\r\n\r\n  /* Root find t on the x axis of the curve.  This\r\n   * is more intuitive for the user.\r\n   */\r\n  _evaluate(t) {\r\n    let start_t = t;\r\n\r\n    if (this.points.length === 0) {\r\n      return 0;\r\n    }\r\n\r\n    let xmin = this.points[0].rco[0];\r\n    let xmax = this.points[this.points.length - 1].rco[0];\r\n\r\n    let steps = this.fastmode ? 16 : 32;\r\n    let s = xmin,\r\n      ds = (xmax - xmin) / (steps - 1);\r\n\r\n    let miny;\r\n    let mins;\r\n    let mindx;\r\n\r\n    for (let i = 0; i < steps; i++, s += ds) {\r\n      let p = this._evaluate2(s);\r\n\r\n      let dx = Math.abs(p[0] - start_t);\r\n      if (mindx === undefined || dx < mindx) {\r\n        mindx = dx;\r\n        miny = p[1];\r\n        mins = s;\r\n      }\r\n    }\r\n\r\n    let start = mins - ds,\r\n      end = mins + ds;\r\n    s = mins;\r\n\r\n    for (let i = 0; i < 16; i++) {\r\n      let p = this._evaluate2(s);\r\n\r\n      if (p[0] > start_t) {\r\n        end = s;\r\n      } else {\r\n        start = s;\r\n      }\r\n\r\n      s = (start + end) * 0.5;\r\n      miny = p[1];\r\n    }\r\n\r\n    if (miny === undefined) {\r\n      miny = 0;\r\n    }\r\n    return miny;\r\n\r\n    /* newton-raphson\r\n    //t = mins;\r\n    t = s;\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let df = 0.0001;\r\n      let ret1 = this._evaluate2(t < 0.5 ? t : t - df);\r\n      let ret2 = this._evaluate2(t < 0.5 ? t + df : t);\r\n\r\n      let f1 = Math.abs(ret1[0] - start_t);\r\n      let f2 = Math.abs(ret2[0] - start_t);\r\n      let g = (f2 - f1)/df;\r\n\r\n      if (f1 === f2) break;\r\n\r\n      //if (f1 < 0.0005) break;\r\n\r\n      if (f1 === 0.0 || g === 0.0)\r\n        return this._evaluate2(t)[1];\r\n\r\n      let fac = -(f1/g)*0.5;\r\n      if (fac === 0.0) {\r\n        fac = 0.01;\r\n      } else if (Math.abs(fac) > 0.1) {\r\n        fac = 0.1*Math.sign(fac);\r\n      }\r\n\r\n      t += fac;\r\n      let eps = 0.00001;\r\n      t = Math.min(Math.max(t, eps), 1.0 - eps);\r\n    }\r\n\r\n    return this._evaluate2(t)[1];\r\n    */\r\n  }\r\n\r\n  _evaluate2(t) {\r\n    let ret = eval2_rets.next();\r\n\r\n    t *= 0.9999999;\r\n\r\n    let sumx = 0;\r\n    let sumy = 0;\r\n\r\n    let totbasis = 0;\r\n\r\n    for (let i = 0; i < this._ps.length; i++) {\r\n      let p = this._ps[i].rco;\r\n      let b = this.basis(t, i);\r\n\r\n      sumx += b * p[0];\r\n      sumy += b * p[1];\r\n\r\n      totbasis += b;\r\n    }\r\n\r\n    if (totbasis !== 0.0) {\r\n      sumx /= totbasis;\r\n      sumy /= totbasis;\r\n    }\r\n\r\n    ret[0] = sumx;\r\n    ret[1] = sumy;\r\n\r\n    return ret;\r\n  }\r\n\r\n  _wrapTouchEvent(e) {\r\n    return {\r\n      x              : e.touches.length ? e.touches[0].pageX : this.mpos[0],\r\n      y              : e.touches.length ? e.touches[0].pageY : this.mpos[1],\r\n      button         : 0,\r\n      shiftKey       : e.shiftKey,\r\n      altKey         : e.altKey,\r\n      ctrlKey        : e.ctrlKey,\r\n      isTouch        : true,\r\n      commandKey     : e.commandKey,\r\n      stopPropagation: () => e.stopPropagation(),\r\n      preventDefault : () => e.preventDefault(),\r\n    };\r\n  }\r\n\r\n  on_touchstart(e) {\r\n    this.mpos[0] = e.touches[0].pageX;\r\n    this.mpos[1] = e.touches[0].pageY;\r\n\r\n    let e2 = this._wrapTouchEvent(e);\r\n\r\n    this.on_mousemove(e2);\r\n    this.on_mousedown(e2);\r\n  }\r\n\r\n  loadTemplate(templ) {\r\n    if (templ === undefined || !templates[templ]) {\r\n      console.warn(\"Unknown bspline template\", templ);\r\n      return;\r\n    }\r\n\r\n    templ = templates[templ];\r\n\r\n    this.reset(true);\r\n    this.deg = 3.0;\r\n\r\n    for (let i = 0; i < templ.length; i++) {\r\n      let p = templ[i];\r\n\r\n      if (p === \"DEG\") {\r\n        this.deg = templ[i + 1];\r\n        i++;\r\n        continue;\r\n      }\r\n\r\n      this.add(p[0], p[1], true);\r\n    }\r\n\r\n    this.recalc = 1;\r\n    this.updateKnots();\r\n    this.update();\r\n    this.redraw();\r\n\r\n    if (this.parent) {\r\n      this.parent._fireEvent(\"update\", this.parent);\r\n    }\r\n  }\r\n\r\n  on_touchmove(e) {\r\n    this.mpos[0] = e.touches[0].pageX;\r\n    this.mpos[1] = e.touches[0].pageY;\r\n\r\n    let e2 = this._wrapTouchEvent(e);\r\n    this.on_mousemove(e2);\r\n  }\r\n\r\n  on_touchend(e) {\r\n    this.on_mouseup(this._wrapTouchEvent(e));\r\n  }\r\n\r\n  on_touchcancel(e) {\r\n    this.on_touchend(e);\r\n  }\r\n\r\n  deletePoint() {\r\n    for (let i = 0; i < this.points.length; i++) {\r\n      let p = this.points[i];\r\n\r\n      if (p.flag & CurveFlags.SELECT) {\r\n        this.points.remove(p);\r\n        i--;\r\n      }\r\n    }\r\n\r\n    this.updateKnots();\r\n    this.update();\r\n    this.regen_basis();\r\n    this.recalc = RecalcFlags.ALL;\r\n    this.redraw();\r\n  }\r\n\r\n  makeGUI(container, canvas, drawTransform, datapath, onSourceUpdate) {\r\n    console.warn(this._bid, \"makeGUI\", this.uidata, this.uidata ? this.uidata.start_mpos : undefined);\r\n\r\n    let start_mpos;\r\n    if (this.uidata) {\r\n      start_mpos = this.uidata.start_mpos;\r\n    }\r\n\r\n    this.uidata = {\r\n      start_mpos : new Vector2(start_mpos),\r\n      transpoints: [],\r\n\r\n      dom         : container,\r\n      canvas      : canvas,\r\n      g           : canvas.g,\r\n      transforming: false,\r\n      draw_trans  : drawTransform,\r\n      datapath,\r\n    };\r\n\r\n    console.warn(\"Building gui\");\r\n\r\n    canvas.addEventListener(\"touchstart\", this.on_touchstart);\r\n    canvas.addEventListener(\"touchmove\", this.on_touchmove);\r\n    canvas.addEventListener(\"touchend\", this.on_touchend);\r\n    canvas.addEventListener(\"touchcancel\", this.on_touchcancel);\r\n\r\n    canvas.addEventListener(\"mousedown\", this.on_mousedown);\r\n    canvas.addEventListener(\"mousemove\", this.on_mousemove);\r\n    canvas.addEventListener(\"mouseup\", this.on_mouseup);\r\n    canvas.addEventListener(\"keydown\", this.on_keydown);\r\n\r\n    let bstrip = container.row().strip();\r\n\r\n    let makebutton = (strip, k) => {\r\n      let uiname = k[0] + k.slice(1, k.length).toLowerCase();\r\n      uiname = uiname.replace(/_/g, \" \");\r\n\r\n      let icon = strip.iconbutton(-1, uiname, () => {\r\n        if (datapath) {\r\n          row.ctx.api.execTool(row.ctx, \"curve1d.bspline_load_template\", {\r\n            dataPath: datapath,\r\n            template: SplineTemplates[k],\r\n          });\r\n          onSourceUpdate();\r\n        } else {\r\n          this.loadTemplate(SplineTemplates[k]);\r\n        }\r\n      });\r\n\r\n      icon.iconsheet = 0;\r\n      icon.customIcon = SplineTemplateIcons[k];\r\n    };\r\n\r\n    for (let k in SplineTemplates) {\r\n      makebutton(bstrip, k);\r\n    }\r\n\r\n    let row = container.row();\r\n\r\n    let fullUpdate = () => {\r\n      this.updateKnots();\r\n      this.update();\r\n      this.regen_basis();\r\n      this.recalc = RecalcFlags.ALL;\r\n      this.redraw();\r\n    };\r\n\r\n    let Icons = row.constructor.getIconEnum();\r\n\r\n    let icon = Icons.LARGE_X !== undefined ? Icons.LARGE_X : Icons.TINY_X;\r\n    if (Icons.LARGE_X === undefined) {\r\n      console.log(Icons);\r\n      console.error(\"Curve widget expects Icons.LARGE_X icon for delete button.\");\r\n    }\r\n\r\n    row.iconbutton(icon, \"Delete Point\", () => {\r\n      if (datapath) {\r\n        row.ctx.api.execTool(row.ctx, \"curve1d.bspline_delete_point\", {\r\n          dataPath: datapath,\r\n        });\r\n      } else {\r\n        this.deletePoint();\r\n      }\r\n\r\n      onSourceUpdate();\r\n      fullUpdate();\r\n    });\r\n\r\n    row.button(\"Reset\", () => {\r\n      if (datapath) {\r\n        row.ctx.api.execTool(row.ctx, \"curve1d.reset_bspline\", {\r\n          dataPath: datapath,\r\n        });\r\n        onSourceUpdate();\r\n      } else {\r\n        this.reset();\r\n      }\r\n    });\r\n\r\n    let slider = row.simpleslider(undefined, {\r\n      name    : \"Degree\",\r\n      min     : 1,\r\n      max     : 7,\r\n      isInt   : true,\r\n      callback: (slider) => {\r\n        this.deg = Math.floor(slider.value);\r\n        fullUpdate();\r\n      },\r\n    });\r\n    slider.setValue(this.deg);\r\n\r\n    let last_deg = this.deg;\r\n    slider.update.after(() => {\r\n      if (last_deg !== this.deg) {\r\n        console.log(\"degree update\", this.deg);\r\n        last_deg = this.deg;\r\n        slider.setValue(this.deg);\r\n      }\r\n    });\r\n\r\n    /*\r\n    let slider = row.simpleslider(undefined, \"Degree\", this.deg, 1, 6, 1, true, true, (slider) => {\r\n      this.deg = Math.floor(slider.value);\r\n      console.log(slider.value);\r\n\r\n      fullUpdate();\r\n    });*/\r\n\r\n    slider.baseUnit = \"none\";\r\n    slider.displayUnit = \"none\";\r\n\r\n    row = container.row();\r\n    let check = row.check(undefined, \"Interpolating\");\r\n    check.checked = this.interpolating;\r\n\r\n    check.onchange = () => {\r\n      this.interpolating = check.value;\r\n      fullUpdate();\r\n    };\r\n\r\n    return this;\r\n  }\r\n\r\n  killGUI(container, canvas) {\r\n    if (this.uidata !== undefined) {\r\n      let ud = this.uidata;\r\n      this.uidata = undefined;\r\n\r\n      canvas.removeEventListener(\"touchstart\", this.on_touchstart);\r\n      canvas.removeEventListener(\"touchmove\", this.on_touchmove);\r\n      canvas.removeEventListener(\"touchend\", this.on_touchend);\r\n      canvas.removeEventListener(\"touchcancel\", this.on_touchcancel);\r\n\r\n      canvas.removeEventListener(\"mousedown\", this.on_mousedown);\r\n      canvas.removeEventListener(\"mousemove\", this.on_mousemove);\r\n      canvas.removeEventListener(\"mouseup\", this.on_mouseup);\r\n      canvas.removeEventListener(\"keydown\", this.on_keydown);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  start_transform(useSelected = true) {\r\n    let dpi = 1.0 / this.uidata.draw_trans[0];\r\n\r\n    /* Manually set p.startco to avoid trashing it\r\n     * if we're proxying another Curve1D.*/\r\n    for (let p of this.points) {\r\n      p.startco.load(p.co);\r\n    }\r\n\r\n    let transform_op = new BSplineTransformOp();\r\n    transform_op.inputs.dataPath.setValue(this.uidata.datapath);\r\n    transform_op.inputs.dpi.setValue(dpi);\r\n\r\n    this.uidata.dom.ctx.api.execTool(this.uidata.dom.ctx, transform_op);\r\n  }\r\n\r\n  on_mousedown(e) {\r\n    this.uidata.start_mpos.load(this.transform_mpos(e.x, e.y));\r\n    this.fastmode = true;\r\n\r\n    let mpos = this.transform_mpos(e.x, e.y);\r\n    let x = mpos[0],\r\n      y = mpos[1];\r\n    this.do_highlight(x, y);\r\n\r\n    if (this.points.highlight !== undefined) {\r\n      if (!e.shiftKey) {\r\n        for (let i = 0; i < this.points.length; i++) {\r\n          this.points[i].flag &= ~CurveFlags.SELECT;\r\n        }\r\n\r\n        this.points.highlight.flag |= CurveFlags.SELECT;\r\n      } else {\r\n        this.points.highlight.flag ^= CurveFlags.SELECT;\r\n      }\r\n\r\n      if (this.uidata.datapath) {\r\n        let state = e.shiftKey ? !(this.points.highlight.flag & CurveFlags.SELECT) : true;\r\n\r\n        this.uidata.dom.ctx.api.execTool(this.uidata.dom.ctx, \"curve1d.bspline_select_point\", {\r\n          dataPath: this.uidata.datapath,\r\n          state,\r\n          unique: !e.shiftKey,\r\n          point : this.points.highlight.eid,\r\n        });\r\n      }\r\n      this.start_transform();\r\n\r\n      this.updateKnots();\r\n      this.update();\r\n      this.redraw();\r\n    } else {\r\n      let uidata = this.uidata;\r\n\r\n      if (this.uidata.datapath) {\r\n        /*\r\n         * Note: this may not update this particular curve instance,\r\n         * that instance however should update this one via the \"update\"\r\n         * event.\r\n         **/\r\n        let start_mpos = this.uidata.start_mpos;\r\n        this.uidata.dom.ctx.api.execTool(this.uidata.dom.ctx, \"curve1d.bspline_add_point\", {\r\n          dataPath: this.uidata.datapath,\r\n          x       : start_mpos[0],\r\n          y       : start_mpos[1],\r\n        });\r\n      } else {\r\n        this.addFromMouse(this.uidata.start_mpos[0], this.uidata.start_mpos[1]);\r\n        this.parent._fire(\"update\", this.parent);\r\n      }\r\n\r\n      this.updateKnots();\r\n      this.update();\r\n      this.redraw();\r\n\r\n      /* Event system may have regenerated this.uidata (from killGUI,\r\n       * called from the update event handler),\r\n       * restore the one we started with.\r\n       */\r\n\r\n      this.uidata = uidata;\r\n      this.start_transform();\r\n    }\r\n  }\r\n\r\n  load(b) {\r\n    if (this === b) {\r\n      return;\r\n    }\r\n\r\n    this.recalc = RecalcFlags.ALL;\r\n\r\n    this.length = b.points.length;\r\n    this.points.length = 0;\r\n    this.eidgen = b.eidgen.copy();\r\n\r\n    this.deg = b.deg;\r\n    this.interpolating = b.interpolating;\r\n\r\n    for (let p of b.points) {\r\n      let p2 = new Curve1DPoint();\r\n      p2.load(p);\r\n\r\n      if (p === b.points.highlight) {\r\n        this.points.highlight = p2;\r\n      }\r\n\r\n      this.points.push(p2);\r\n    }\r\n\r\n    this.updateKnots();\r\n    this.update();\r\n    this.redraw();\r\n\r\n    return this;\r\n  }\r\n\r\n  addFromMouse(x, y) {\r\n    let p = this.add(x, y);\r\n    p.startco.load(p.co);\r\n    this.points.highlight = p;\r\n\r\n    for (let p2 of this.points) {\r\n      p2.flag &= ~CurveFlags.SELECT;\r\n    }\r\n    p.flag |= CurveFlags.SELECT;\r\n\r\n    this.updateKnots();\r\n    this.update();\r\n    this.redraw();\r\n\r\n    this.points.highlight.flag |= CurveFlags.SELECT;\r\n  }\r\n\r\n  do_highlight(x, y) {\r\n    let trans = this.uidata.draw_trans;\r\n    let mindis = 1e17,\r\n      minp = undefined;\r\n    let limit = 19 / trans[0],\r\n      limitsqr = limit * limit;\r\n\r\n    for (let i = 0; i < this.points.length; i++) {\r\n      let p = this.points[i];\r\n      let dx = x - p.sco[0],\r\n        dy = y - p.sco[1],\r\n        dis = dx * dx + dy * dy;\r\n\r\n      if (dis < mindis && dis < limitsqr) {\r\n        mindis = dis;\r\n        minp = p;\r\n      }\r\n    }\r\n\r\n    if (this.points.highlight !== minp) {\r\n      this.points.highlight = minp;\r\n      this.redraw();\r\n    }\r\n  }\r\n\r\n  do_transform(x, y) {\r\n    let off = new Vector2([x, y]).sub(this.uidata.start_mpos);\r\n\r\n    let xRange = this.parent.xRange;\r\n    let yRange = this.parent.yRange;\r\n\r\n    for (let i = 0; i < this.uidata.transpoints.length; i++) {\r\n      let p = this.uidata.transpoints[i];\r\n      p.co.load(p.startco).add(off);\r\n\r\n      p.co[0] = Math.min(Math.max(p.co[0], xRange[0]), xRange[1]);\r\n      p.co[1] = Math.min(Math.max(p.co[1], yRange[0]), yRange[1]);\r\n    }\r\n\r\n    this.updateKnots();\r\n    this.update();\r\n    this.redraw();\r\n  }\r\n\r\n  transform_mpos(x, y) {\r\n    let r = this.uidata.canvas.getClientRects()[0];\r\n    let dpi = devicePixelRatio; //evil module cycle: UIBase.getDPI();\r\n\r\n    x -= parseInt(r.left);\r\n    y -= parseInt(r.top);\r\n\r\n    x *= dpi;\r\n    y *= dpi;\r\n\r\n    let trans = this.uidata.draw_trans;\r\n\r\n    x = x / trans[0] - trans[1][0];\r\n    y = -y / trans[0] - trans[1][1];\r\n\r\n    return [x, y];\r\n  }\r\n\r\n  on_mousemove(e) {\r\n    if (e.isTouch && this.uidata.transforming) {\r\n      e.preventDefault();\r\n    }\r\n\r\n    let mpos = this.transform_mpos(e.x, e.y);\r\n    let x = mpos[0],\r\n      y = mpos[1];\r\n\r\n    if (this.uidata.transforming) {\r\n      this.do_transform(x, y);\r\n      this.evaluate(0.5);\r\n      //this.update();\r\n      //this.doSave();\r\n    } else {\r\n      this.do_highlight(x, y);\r\n    }\r\n  }\r\n\r\n  end_transform() {\r\n    this.uidata.transforming = false;\r\n    this.fastmode = false;\r\n    this.updateKnots();\r\n    this.update();\r\n\r\n    splineCache.update(this);\r\n  }\r\n\r\n  on_mouseup(e) {\r\n    this.end_transform();\r\n  }\r\n\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case 88: //xkeey\r\n      case 46: //delete\r\n        if (this.points.highlight !== undefined) {\r\n          this.points.remove(this.points.highlight);\r\n          this.recalc = RecalcFlags.ALL;\r\n\r\n          this.points.highlight = undefined;\r\n          this.updateKnots();\r\n          this.update();\r\n\r\n          if (this._save_hook !== undefined) {\r\n            this._save_hook();\r\n          }\r\n        }\r\n        break;\r\n    }\r\n  }\r\n\r\n  draw(canvas, g, draw_trans) {\r\n    g.save();\r\n\r\n    if (this.uidata === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.uidata.canvas = canvas;\r\n    this.uidata.g = g;\r\n    this.uidata.draw_trans = draw_trans;\r\n\r\n    let sz = draw_trans[0],\r\n      pan = draw_trans[1];\r\n    g.lineWidth *= 1.5;\r\n    let strokeStyle = g.strokeStyle;\r\n\r\n    for (let ssi = 0; ssi < 1; ssi++) {\r\n      break; //uncomment to draw basis functions\r\n\r\n      let steps = 512;\r\n      for (let si = 0; si < this.points.length; si++) {\r\n        g.beginPath();\r\n\r\n        let f = 0;\r\n        let df = 1.0 / (steps - 1);\r\n        for (let i = 0; i < steps; i++, f += df) {\r\n          let totbasis = 0;\r\n\r\n          for (let j = 0; j < this.points.length; j++) {\r\n            totbasis += this.basis(f, j);\r\n          }\r\n\r\n          let val = this.basis(f, si);\r\n\r\n          if (ssi) val /= totbasis === 0 ? 1 : totbasis;\r\n\r\n          (i === 0 ? g.moveTo : g.lineTo).call(g, f, ssi ? val : val * 0.5);\r\n        }\r\n\r\n        let color,\r\n          alpha = this.points[si] === this.points.highlight ? 1.0 : 0.7;\r\n\r\n        if (ssi) {\r\n          color = \"rgba(205, 125, 5,\" + alpha + \")\";\r\n        } else {\r\n          color = \"rgba(25, 145, 45,\" + alpha + \")\";\r\n        }\r\n        g.strokeStyle = color;\r\n        g.stroke();\r\n      }\r\n    }\r\n\r\n    g.strokeStyle = strokeStyle;\r\n    g.lineWidth /= 3.0;\r\n\r\n    let w = 0.03;\r\n\r\n    for (let p of this.points) {\r\n      g.beginPath();\r\n\r\n      if (p === this.points.highlight) {\r\n        g.fillStyle = \"green\";\r\n      } else if (p.flag & CurveFlags.SELECT) {\r\n        g.fillStyle = \"red\";\r\n      } else {\r\n        g.fillStyle = \"orange\";\r\n      }\r\n\r\n      g.rect(p.sco[0] - w / 2, p.sco[1] - w / 2, w, w);\r\n\r\n      g.fill();\r\n    }\r\n\r\n    g.restore();\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n\r\n    if (this.highlightPoint >= 0) {\r\n      for (let p of this.points) {\r\n        if (p.eid === this.highlightPoint) {\r\n          this.points.highlight = p;\r\n        }\r\n      }\r\n\r\n      delete this.highlightPoint;\r\n    }\r\n\r\n    this.updateKnots();\r\n    this.recalc = RecalcFlags.ALL;\r\n  }\r\n}\r\n\r\nBSplineCurve.STRUCT =\r\n  nstructjs.inherit(BSplineCurve, CurveTypeData) +\r\n  `\r\n  points         : array(Curve1DPoint);\r\n  highlightPoint : int | this.points.highlight ? this.points.highlight.eid : -1;\r\n  deg            : int;\r\n  eidgen         : IDGen;\r\n  interpolating  : bool;\r\n}\r\n`;\r\nnstructjs.register(BSplineCurve);\r\nCurveTypeData.register(BSplineCurve);\r\n\r\nfunction makeSplineTemplateIcons(size = 64) {\r\n  if (typeof document === \"undefined\") {\r\n    /* inside a web worker? */\r\n    return;\r\n  }\r\n  let dpi = devicePixelRatio;\r\n  size = ~~(size * dpi);\r\n\r\n  for (let k in SplineTemplates) {\r\n    let curve = new BSplineCurve();\r\n    curve.loadTemplate(SplineTemplates[k]);\r\n\r\n    curve.fastmode = true;\r\n\r\n    let canvas = document.createElement(\"canvas\");\r\n    canvas.width = canvas.height = size;\r\n\r\n    let g = canvas.getContext(\"2d\");\r\n    let steps = 64;\r\n\r\n    curve.update();\r\n\r\n    let scale = 0.5;\r\n\r\n    g.translate(-0.5, -0.5);\r\n    g.scale(size * scale, size * scale);\r\n    g.translate(0.5, 0.5);\r\n\r\n    //margin\r\n    let m = 0.0;\r\n\r\n    let tent = (f) => 1.0 - Math.abs(Math.fract(f) - 0.5) * 2.0;\r\n\r\n    for (let i = 0; i < steps; i++) {\r\n      let s = i / (steps - 1);\r\n      let f = 1.0 - curve.evaluate(tent(s));\r\n\r\n      s = s * (1.0 - m * 2.0) + m;\r\n      f = f * (1.0 - m * 2.0) + m;\r\n\r\n      //s += 0.5;\r\n      //f += 0.5;\r\n\r\n      if (i === 0) {\r\n        g.moveTo(s, f);\r\n      } else {\r\n        g.lineTo(s, f);\r\n      }\r\n    }\r\n\r\n    const ls = 7.0;\r\n\r\n    g.lineCap = \"round\";\r\n    g.strokeStyle = \"black\";\r\n    g.lineWidth = (ls * 3 * dpi) / (size * scale);\r\n    g.stroke();\r\n\r\n    g.strokeStyle = \"white\";\r\n    g.lineWidth = (ls * dpi) / (size * scale);\r\n    g.stroke();\r\n\r\n    let url = canvas.toDataURL();\r\n    let img = document.createElement(\"img\");\r\n    img.src = url;\r\n\r\n    SplineTemplateIcons[k] = img;\r\n    SplineTemplateIcons[SplineTemplates[k]] = img;\r\n  }\r\n}\r\n\r\nlet splineTemplatesLoaded = false;\r\n\r\nexport function initSplineTemplates() {\r\n  if (splineTemplatesLoaded) {\r\n    return;\r\n  }\r\n\r\n  splineTemplatesLoaded = true;\r\n\r\n  for (let k in SplineTemplates) {\r\n    let curve = new BSplineCurve();\r\n    curve.loadTemplate(SplineTemplates[k]);\r\n    splineCache.get(curve);\r\n  }\r\n\r\n  makeSplineTemplateIcons();\r\n  window._SplineTemplateIcons = SplineTemplateIcons;\r\n  console.log(\"Loaded 1d spline templates\");\r\n}\r\n\r\n//delay to ensure config is fully loaded\r\nwindow.setTimeout(() => {\r\n  if (config.autoLoadSplineTemplates) {\r\n    initSplineTemplates();\r\n  }\r\n}, 0);\r\n","\"use strict\";\r\n\r\n/*FIXME: not sure this works anymore*/\r\nimport nstructjs from \"../util/struct.js\";\r\n\r\nimport * as util from '../util/util.js';\r\n//import * as ui_base from './ui_base.js';\r\nimport {Vector2, Vector3, Vector4, Matrix4} from '../util/vectormath.js';\r\nimport {EventDispatcher} from \"../util/events.js\";\r\n\r\nexport {getCurve} from './curve1d_base.js';\r\nexport {SplineTemplates, SplineTemplateIcons} from './curve1d_bspline.js';\r\n\r\nexport function mySafeJSONStringify(obj) {\r\n  return JSON.stringify(obj.toJSON(), function (key) {\r\n    let v = this[key];\r\n\r\n    if (typeof v === \"number\") {\r\n      if (v !== Math.floor(v)) {\r\n        v = parseFloat(v.toFixed(5));\r\n      } else {\r\n        v = v;\r\n      }\r\n    }\r\n\r\n    return v;\r\n  });\r\n}\r\n\r\nexport function mySafeJSONParse(buf) {\r\n  return JSON.parse(buf, (key, val) => {\r\n\r\n  });\r\n};\r\n\r\nwindow.mySafeJSONStringify = mySafeJSONStringify;\r\n\r\nexport {CurveConstructors, CURVE_VERSION, CurveTypeData} from './curve1d_base.js';\r\nimport {CurveConstructors, CURVE_VERSION, CurveTypeData} from './curve1d_base.js';\r\n\r\nlet _udigest = new util.HashDigest();\r\n\r\nexport class Curve1D {\r\n  constructor() {\r\n    this._eventCBs = [];\r\n\r\n    this.uiZoom = 1.0;\r\n    this.xRange = new Vector2().loadXY(0.0, 1.0);\r\n    this.yRange = new Vector2().loadXY(0.0, 1.0);\r\n    this.clipToRange = false;\r\n\r\n    this.generators = [];\r\n    this.VERSION = CURVE_VERSION;\r\n\r\n    for (let gen of CurveConstructors) {\r\n      gen = new gen();\r\n\r\n      gen.parent = this;\r\n      this.generators.push(gen);\r\n    }\r\n\r\n    //this.generators.active = this.generators[0];\r\n    this.setGenerator(\"bspline\");\r\n  }\r\n\r\n  get generatorType() {\r\n    return this.generators.active ? this.generators.active.type : undefined;\r\n  }\r\n\r\n  get fastmode() {\r\n    return this._fastmode;\r\n  }\r\n\r\n  set fastmode(val) {\r\n    this._fastmode = val;\r\n\r\n    for (let gen of this.generators) {\r\n      gen.fastmode = val;\r\n    }\r\n  }\r\n\r\n  /** cb_is_dead is a callback that returns true if it\r\n   *  should be removed from the callback list. */\r\n  on(type, cb, owner, cb_is_dead) {\r\n    if (cb_is_dead === undefined) {\r\n      cb_is_dead = () => false;\r\n    }\r\n\r\n    this._eventCBs.push({type, cb, owner, dead: cb_is_dead, once: false});\r\n  }\r\n\r\n  off(type, cb) {\r\n    this._eventCBs = this._eventCBs.filter(cb => cb.cb !== cb);\r\n  }\r\n\r\n  once(type, cb, owner, cb_is_dead) {\r\n    this.on(type, cb, owner, cb_is_dead);\r\n    this._eventCBs[this._eventCBs.length - 1].once = true;\r\n  }\r\n\r\n  subscribed(type, owner) {\r\n    for (let cb of this._eventCBs) {\r\n      if ((!type || cb.type === type) && cb.owner === owner) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  _pruneEventCallbacks() {\r\n    this._eventCBs = this._eventCBs.filter(cb => !cb.dead());\r\n  }\r\n\r\n  _fireEvent(evt, data) {\r\n    this._pruneEventCallbacks();\r\n\r\n    for (let i = 0; i < this._eventCBs.length; i++) {\r\n      let cb = this._eventCBs[i];\r\n\r\n      if (cb.type !== evt) {\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        cb.cb(data);\r\n      } catch (error) {\r\n        console.error(error.stack);\r\n        console.error(error.message);\r\n      }\r\n\r\n      if (cb.once) {\r\n        this._eventCBs.remove(cb);\r\n        i--;\r\n      }\r\n    }\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    let d = digest;\r\n\r\n    for (let g of this.generators) {\r\n      g.calcHashKey(d);\r\n    }\r\n\r\n    return d.get();\r\n  }\r\n\r\n  equals(b) {\r\n    let gen1 = this.generators.active;\r\n    let gen2 = b.generators.active;\r\n\r\n    if (!gen1 || !gen2 || gen1.constructor !== gen2.constructor) {\r\n      return false;\r\n    }\r\n\r\n    return gen1.equals(gen2);\r\n  }\r\n\r\n  load(b) {\r\n    if (b === undefined || b === this) {\r\n      return this;\r\n    }\r\n    /*\r\n    if (b === undefined) {\r\n      return;\r\n    }\r\n\r\n    let buf1 = mySafeJSONStringify(b);\r\n    let buf2 = mySafeJSONStringify(this);\r\n\r\n    if (buf1 === buf2) {\r\n      return;\r\n    }\r\n\r\n    this.loadJSON(JSON.parse(buf1));\r\n    this._on_change();\r\n    this.redraw();\r\n\r\n    return this;*/\r\n\r\n    let json = nstructjs.writeJSON(b, Curve1D);\r\n    let cpy = nstructjs.readJSON(json, Curve1D);\r\n\r\n    let activeCls = cpy.generators.active.constructor;\r\n    let oldGens = this.generators;\r\n\r\n    this.generators = cpy.generators;\r\n\r\n    for (let gen of cpy.generators) {\r\n      /* See if generator provides a .load() method. */\r\n      for (let gen2 of oldGens) {\r\n        if (gen2.constructor === gen.constructor && gen2.load !== undefined) {\r\n          cpy.generators[cpy.generators.indexOf(gen)] = gen2;\r\n\r\n          if (gen2.constructor === activeCls) {\r\n            this.generators.active = gen2;\r\n          }\r\n\r\n          gen2.parent = this;\r\n          gen2.load(gen);\r\n          gen = gen2;\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (gen.constructor === activeCls) {\r\n        this.generators.active = gen;\r\n      }\r\n      gen.parent = this;\r\n    }\r\n\r\n    for (let k in json) {\r\n      if (k === \"generators\") {\r\n        continue;\r\n      }\r\n      if (k.startsWith(\"_\")) {\r\n        continue;\r\n      }\r\n\r\n      let v = cpy[k];\r\n      if (typeof v === \"number\" || typeof v === \"boolean\" || typeof v === \"string\") {\r\n        this[k] = v;\r\n      } else if (v instanceof Vector2 || v instanceof Vector3 || v instanceof Vector4 || v instanceof Matrix4) {\r\n        this[k].load(v);\r\n      }\r\n    }\r\n\r\n    this._on_change();\r\n    this.redraw();\r\n\r\n    return this;\r\n  }\r\n\r\n  copy() {\r\n    let json = nstructjs.writeJSON(this, Curve1D);\r\n    return nstructjs.readJSON(json, Curve1D);\r\n  }\r\n\r\n  _on_change() {\r\n\r\n  }\r\n\r\n  redraw() {\r\n    this._fireEvent(\"draw\", this);\r\n  }\r\n\r\n  setGenerator(type) {\r\n    for (let gen of this.generators) {\r\n      if (gen.constructor.define().name === type\r\n        || gen.type === type\r\n        || gen.constructor.define().typeName === type\r\n        || gen.constructor === type) {\r\n        if (this.generators.active) {\r\n          this.generators.active.onInactive();\r\n        }\r\n\r\n        this.generators.active = gen;\r\n        gen.onActive();\r\n\r\n        return;\r\n      }\r\n    }\r\n\r\n    throw new Error(\"unknown curve type \" + type);\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = {\r\n      generators      : [],\r\n      uiZoom          : this.uiZoom,\r\n      VERSION         : this.VERSION,\r\n      active_generator: this.generatorType,\r\n      xRange          : this.xRange,\r\n      yRange          : this.yRange,\r\n      clipToRange     : this.clipToRange,\r\n    };\r\n\r\n    for (let gen of this.generators) {\r\n      ret.generators.push(gen.toJSON());\r\n    }\r\n\r\n    ret.generators.sort((a, b) => a.type.localeCompare(b.type));\r\n\r\n    return ret;\r\n  }\r\n\r\n  getGenerator(type, throw_on_error = true) {\r\n    for (let gen of this.generators) {\r\n      if (gen.type === type) {\r\n        return gen;\r\n      }\r\n    }\r\n\r\n    //was a new generator registerd?\r\n    for (let cls of CurveConstructors) {\r\n      if (cls.define().typeName === type) {\r\n        let gen = new cls();\r\n        gen.type = type;\r\n        gen.parent = this;\r\n        this.generators.push(gen);\r\n        return gen;\r\n      }\r\n    }\r\n\r\n    if (throw_on_error) {\r\n      throw new Error(\"Unknown generator \" + type + \".\");\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  switchGenerator(type) {\r\n    let gen = this.getGenerator(type);\r\n\r\n    if (gen !== this.generators.active) {\r\n      let old = this.generators.active;\r\n\r\n      this.generators.active = gen;\r\n\r\n      old.onInactive(this);\r\n      gen.onActive(this);\r\n    }\r\n\r\n    return gen;\r\n  }\r\n\r\n  destroy() {\r\n    return this;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    this.VERSION = obj.VERSION;\r\n\r\n    this.uiZoom = parseFloat(obj.uiZoom) || this.uiZoom;\r\n    if (obj.xRange) {\r\n      this.xRange = new Vector2(obj.xRange);\r\n    }\r\n    if (obj.yRange) {\r\n      this.yRange = new Vector2(obj.yRange);\r\n    }\r\n    this.clipToRange = Boolean(obj.clipToRange);\r\n\r\n    //this.generators = [];\r\n    for (let gen of obj.generators) {\r\n      let gen2 = this.getGenerator(gen.type, false);\r\n\r\n      if (!gen2 || !(gen2 instanceof CurveTypeData)) {\r\n        //old curve class?\r\n        console.warn(\"Bad curve generator class:\", gen2);\r\n        if (gen2) {\r\n          this.generators.remove(gen2);\r\n        }\r\n        continue;\r\n      }\r\n\r\n      gen2.parent = undefined;\r\n      gen2.reset();\r\n      gen2.loadJSON(gen);\r\n      gen2.parent = this;\r\n\r\n      if (gen.type === obj.active_generator) {\r\n        this.generators.active = gen2;\r\n      }\r\n\r\n      //this.generators.push(gen2);\r\n    }\r\n\r\n    if (this.VERSION < 1.1) {\r\n      this.#patchRange();\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  evaluate(s) {\r\n    if (this.clipToRange) {\r\n      s = Math.min(Math.max(s, this.xRange[0]), this.xRange[1]);\r\n    }\r\n\r\n    let f;\r\n\r\n    try {\r\n      f = this.generators.active.evaluate(s);\r\n    } catch (error) {\r\n      f = 0.0;\r\n      console.warn(error.stack);\r\n      console.warn(error.message);\r\n    }\r\n\r\n    if (this.clipToRange) {\r\n      f = Math.min(Math.max(f, this.yRange[0]), this.yRange[1]);\r\n    }\r\n\r\n    return f;\r\n  }\r\n\r\n  integrate(s, quadSteps) {\r\n    return this.generators.active.integrate(s, quadSteps);\r\n  }\r\n\r\n  derivative(s) {\r\n    return this.generators.active.derivative(s);\r\n  }\r\n\r\n  derivative2(s) {\r\n    return this.generators.active.derivative2(s);\r\n  }\r\n\r\n  inverse(s) {\r\n    return this.generators.active.inverse(s);\r\n  }\r\n\r\n  reset() {\r\n    this.generators.active.reset();\r\n  }\r\n\r\n  update() {\r\n    return this.generators.active.update();\r\n  }\r\n\r\n  draw(canvas, g, draw_transform) {\r\n    let w = canvas.width, h = canvas.height;\r\n\r\n    g.save();\r\n\r\n    let sz = draw_transform[0], pan = draw_transform[1];\r\n\r\n    g.beginPath();\r\n    g.moveTo(-1, 0);\r\n    g.lineTo(1, 0);\r\n    g.strokeStyle = \"red\";\r\n    g.stroke();\r\n\r\n    g.beginPath();\r\n    g.moveTo(0, -1);\r\n    g.lineTo(0, 1);\r\n    g.strokeStyle = \"green\";\r\n    g.stroke();\r\n\r\n    //g.rect(0, 0, 1, 1);\r\n    //g.fillStyle = \"rgb(50, 50, 50)\";\r\n    //g.fill();\r\n\r\n    let f = this.xRange[0], steps = 64;\r\n    let df = (this.xRange[1] - this.xRange[0])/(steps - 1);\r\n    w = 6.0/sz;\r\n\r\n    let curve = this.generators.active;\r\n\r\n    g.beginPath();\r\n    for (let i = 0; i < steps; i++, f += df) {\r\n      let val = this.evaluate(f);\r\n\r\n      (i === 0 ? g.moveTo : g.lineTo).call(g, f, val, w, w);\r\n    }\r\n\r\n    g.strokeStyle = \"grey\";\r\n    g.stroke();\r\n\r\n    if (this.overlay_curvefunc !== undefined) {\r\n      g.beginPath();\r\n      f = this.xRange[0];\r\n\r\n      for (let i = 0; i < steps; i++, f += df) {\r\n        let val = this.overlay_curvefunc(f);\r\n\r\n        (i === 0 ? g.moveTo : g.lineTo).call(g, f, val, w, w);\r\n      }\r\n\r\n      g.strokeStyle = \"green\";\r\n      g.stroke();\r\n    }\r\n\r\n    this.generators.active.draw(canvas, g, draw_transform);\r\n\r\n    g.restore();\r\n    return this;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    this.generators = [];\r\n    reader(this);\r\n\r\n    if (this.VERSION <= 0.75) {\r\n      this.generators = [];\r\n\r\n      for (let cls of CurveConstructors) {\r\n        this.generators.push(new cls());\r\n      }\r\n\r\n      this.generators.active = this.getGenerator(\"BSplineCurve\");\r\n    }\r\n\r\n    for (let gen of this.generators.concat([])) {\r\n      if (!(gen instanceof CurveTypeData)) {\r\n        console.warn(\"Bad generator data found:\", gen);\r\n        this.generators.remove(gen);\r\n        continue;\r\n      }\r\n\r\n      if (gen.type === this._active) {\r\n        this.generators.active = gen;\r\n      }\r\n    }\r\n\r\n    for (let gen of this.generators) {\r\n      gen.parent = this;\r\n    }\r\n\r\n    if (this.VERSION < 1.1) {\r\n      this.#patchRange();\r\n    }\r\n\r\n    delete this._active;\r\n    this.VERSION = CURVE_VERSION;\r\n  }\r\n\r\n  #patchRange() {\r\n    let range = this.getGenerator(\"BSplineCurve\").range;\r\n    if (range) {\r\n      this.xRange.load(range[0]);\r\n      this.yRange.load(range[1]);\r\n    }\r\n  }\r\n}\r\n\r\n/* Remember to update toJSON() loadJSON api. */\r\nCurve1D.STRUCT = `\r\nCurve1D {\r\n  generators  : array(abstract(CurveTypeData));\r\n  _active     : string | obj.generators.active.type;\r\n  VERSION     : float;\r\n  uiZoom      : float;\r\n  xRange      : vec2;\r\n  yRange      : vec2;\r\n  clipToRange : bool;\r\n}\r\n`;\r\nnstructjs.register(Curve1D);\r\n\r\n","import {Vector2, Matrix4, Quat, Vector3, Vector4} from '../path-controller/util/vectormath.js';\r\nimport * as math from '../path-controller/util/math.js'\r\nimport {color2css, css2color, parsepx} from './ui_theme.js';\r\nimport {Curve1D, getCurve} from \"../path-controller/curve/curve1d.js\";\r\nimport * as util from '../path-controller/util/util.js';\r\n\r\nclass Task {\r\n  constructor(taskcb) {\r\n    this.task = taskcb;\r\n    this.start = util.time_ms();\r\n    this.done = false;\r\n  }\r\n}\r\n\r\nexport class AnimManager {\r\n  constructor() {\r\n    this.tasks = [];\r\n    this.timer = undefined;\r\n\r\n    //all animation tasks that last longer then 10 seconds are terminated\r\n    this.timeOut = 10*1000.0;\r\n  }\r\n\r\n  stop() {\r\n    if (this.timer !== undefined) {\r\n      window.clearInterval(this.timer);\r\n      this.timer = undefined;\r\n    }\r\n  }\r\n\r\n  add(task) {\r\n    this.tasks.push(new Task(task));\r\n  }\r\n\r\n  remove(task) {\r\n    for (let t of this.tasks) {\r\n      if (t.task === task) {\r\n        t.dead = true;\r\n        this.tasks.remove(t);\r\n        return;\r\n      }\r\n    }\r\n  }\r\n\r\n  start() {\r\n    this.timer = window.setInterval(() => {\r\n      for (let t of this.tasks) {\r\n        try {\r\n          t.task();\r\n        } catch (error) {\r\n          t.done = true;\r\n          util.print_stack(error);\r\n        }\r\n\r\n        if (util.time_ms() - t.start > this.timeOut) {\r\n          t.dead = true;\r\n        }\r\n      }\r\n\r\n      for (let i=0; i<this.tasks.length; i++) {\r\n        if (this.tasks[i].done) {\r\n          let t = this.tasks[i];\r\n          this.tasks.remove(t);\r\n          i--;\r\n\r\n          try {\r\n            if (t.task.onend) {\r\n              t.task.onend();\r\n            }\r\n          } catch (error) {\r\n            util.print_stack(error);\r\n          }\r\n        }\r\n      }\r\n    }, 1000/40.0);\r\n  }\r\n}\r\n\r\n\r\nexport const manager = new AnimManager();\r\nmanager.start();\r\n\r\nexport class AbstractCommand {\r\n  constructor() {\r\n    this.cbs = [];\r\n    this.end_cbs = [];\r\n  }\r\n\r\n  start(animator, done) {\r\n\r\n  }\r\n\r\n  exec(animator, done) {\r\n\r\n  }\r\n}\r\n\r\nexport class WaitCommand extends AbstractCommand {\r\n  constructor(ms) {\r\n    super();\r\n    this.ms = ms;\r\n  }\r\n\r\n  start(animator, done) {\r\n    this.time = animator.time;\r\n  }\r\n\r\n  exec(animator, done) {\r\n    if (animator.time - this.time > this.ms) {\r\n      done();\r\n    }\r\n  }\r\n}\r\n\r\nexport class GoToCommand extends AbstractCommand {\r\n  constructor(obj, key, value, time, curve=\"ease\") {\r\n    super();\r\n\r\n    this.object = obj;\r\n    this.key = key;\r\n    this.value = value;\r\n    this.ms = time;\r\n\r\n    if (typeof curve === \"string\") {\r\n      this.curve = new (getCurve(curve))();\r\n    } else {\r\n      this.curve = curve;\r\n    }\r\n  }\r\n\r\n  start(animator, done) {\r\n    this.time = animator.time;\r\n\r\n    let value = this.object[this.key];\r\n\r\n    if (Array.isArray(value)) {\r\n      this.startValue = util.list(value);\r\n    } else {\r\n      this.startValue = value;\r\n    }\r\n  }\r\n\r\n  exec(animator, done) {\r\n    let t = animator.time - this.time;\r\n    let ms = this.ms;\r\n\r\n    if (t > ms) {\r\n      done();\r\n      t = ms;\r\n    }\r\n\r\n    t /= ms;\r\n\r\n    t = this.curve.evaluate(t);\r\n\r\n    if (Array.isArray(this.startValue)) {\r\n      let value = this.object[this.key];\r\n\r\n      for (let i=0; i<this.startValue.length; i++) {\r\n        if (value[i] === undefined || this.value[i] === undefined) {\r\n          continue;\r\n        }\r\n\r\n        value[i] = this.startValue[i] + (this.value[i] - this.startValue[i]) * t;\r\n      }\r\n    } else {\r\n      this.object[this.key] = this.startValue + (this.value - this.startValue) * t;\r\n\r\n    }\r\n  }\r\n}\r\n\r\nexport class SetCommand extends AbstractCommand {\r\n  constructor(obj, key, val) {\r\n    super();\r\n\r\n    this.object = obj;\r\n    this.key = key;\r\n    this.value = val;\r\n  }\r\n\r\n  start(animator, done) {\r\n    this.object[key] = val;\r\n    done();\r\n  }\r\n}\r\n\r\nexport class Command {\r\n  constructor(type, args) {\r\n    this.args = args;\r\n    this.cbs = [];\r\n  }\r\n}\r\n\r\nexport class Animator {\r\n  constructor(owner, method = \"update\") {\r\n    this.on_tick = this.on_tick.bind(this);\r\n    this.on_tick.onend = () => {\r\n      if (this.onend) {\r\n        this.onend();\r\n      }\r\n    }\r\n\r\n    this.commands = [];\r\n    this.owner = owner;\r\n    this._done = false;\r\n    this.method = method;\r\n    this.onend = null;\r\n    this.first = true;\r\n\r\n    this.time = 0.0;\r\n    this.last = util.time_ms();\r\n\r\n    this.bind(owner);\r\n  }\r\n\r\n  bind(owner) {\r\n    this._done = false;\r\n    this.owner = owner;\r\n    //this.owner[this.method].after(this.on_tick);\r\n    manager.add(this.on_tick);\r\n  }\r\n\r\n  wait(ms) {\r\n    this.commands.push(new WaitCommand(ms));\r\n    return this;\r\n  }\r\n\r\n  goto(key, val, timeMs, curve = \"ease\") {\r\n    let cmd = new GoToCommand(this.owner, key, val, timeMs, curve);\r\n    this.commands.push(cmd);\r\n    return this;\r\n  }\r\n\r\n  set(key, val, time) {\r\n    let cmd = new SetCommand(this.owner, key, val);\r\n    this.commands.push(cmd);\r\n    return this;\r\n  }\r\n\r\n  /** Call this while the current command is still being executed. */\r\n  while(cb) {\r\n    this.commands[this.commands.length - 1].cbs.push(cb);\r\n    return this;\r\n  }\r\n\r\n  then(cb) {\r\n    this.commands[this.commands.length-1].end_cbs.push(cb);\r\n    return this;\r\n  }\r\n\r\n  end() {\r\n    if (this._done) {\r\n      return;\r\n    }\r\n\r\n    this._done = true;\r\n    manager.remove(this.on_tick);\r\n    //this.owner.update.remove(this.on_tick);\r\n\r\n    if (this.onend) {\r\n      this.onend();\r\n    }\r\n  }\r\n\r\n  on_tick() {\r\n    if (this._done) {\r\n      throw new Error(\"animation wasn't properly cleaned up\");\r\n    }\r\n\r\n    let dt = util.time_ms() - this.last;\r\n    this.time += dt;\r\n    this.last = util.time_ms();\r\n\r\n    if (this.commands.length === 0) {\r\n      this.end();\r\n      return\r\n    }\r\n\r\n    let cmd = this.commands[0];\r\n    let done = false;\r\n\r\n    function donecb() {\r\n      done = true;\r\n    }\r\n\r\n    if (this.first) {\r\n      this.first = false;\r\n      //console.log(cmd, cmd.start)\r\n      cmd.start(this, donecb);\r\n    }\r\n\r\n    try {\r\n      cmd.exec(this, donecb);\r\n    } catch (error) {\r\n      done = true;\r\n      util.print_stack(error);\r\n    }\r\n\r\n    for (let cb of this.commands[0].cbs) {\r\n      try {\r\n        cb();\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n      }\r\n    }\r\n\r\n    if (done) {\r\n      for (let cb of this.commands[0].end_cbs) {\r\n        try {\r\n          cb();\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n        }\r\n      }\r\n      while (this.commands.length > 0) {\r\n        this.commands.shift();\r\n\r\n        done = false;\r\n\r\n        if (this.commands.length > 0) {\r\n          this.commands[0].start(this, donecb);\r\n        }\r\n\r\n        if (!done) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","export class token {\r\n  constructor(type, val, lexpos, lexlen, lineno, lexer, parser) {\r\n    this.type = type;\r\n    this.value = val;\r\n    this.lexpos = lexpos;\r\n    this.lexlen = lexlen;\r\n    this.lineno = lineno;\r\n    this.lexer = lexer;\r\n    this.parser = parser;\r\n  }\r\n\r\n  setValue(val) {\r\n    this.value = val;\r\n    return this;\r\n  }\r\n\r\n  toString() {\r\n    if (this.value !== undefined)\r\n      return \"token(type=\" + this.type + \", value='\" + this.value + \"')\"\r\n    else\r\n      return \"token(type=\" + this.type + \")\"\r\n  }\r\n}\r\n\r\n//func is optional. it takes a function\r\n//with one parameter, token, and either\r\n//a) returns the token, or b) returns\r\n//undefined, in which case the token\r\n//should be ignored by the lexer\r\nexport class tokdef {\r\n  constructor(name, regexpr, func) {\r\n    this.name = name;\r\n    this.re = regexpr\r\n    this.func = func\r\n  }\r\n}\r\n\r\nexport class PUTLParseError extends Error {\r\n}\r\n\r\n//errfunc is optional.  it requires\r\n//a function that takes one param, lexer,\r\n//and returns true if the lexer\r\n//should propegate an error when an error\r\n//has happened\r\nexport class lexer {\r\n  constructor(tokdef, errfunc) {\r\n    this.tokdef = tokdef;\r\n    this.tokens = new Array();\r\n    this.lexpos = 0;\r\n    this.lexdata = \"\";\r\n    this.lineno = 0;\r\n    this.errfunc = errfunc;\r\n    this.tokints = {}\r\n    this.print_tokens = false;\r\n    this.print_debug = false;\r\n\r\n    for (let i = 0; i < tokdef.length; i++) {\r\n      this.tokints[tokdef[i].name] = i;\r\n    }\r\n\r\n    this.statestack = [[\"__main__\", 0]];\r\n    this.states = {\"__main__\": [tokdef, errfunc]};\r\n    this.statedata = 0; //public variable\r\n  }\r\n\r\n  copy() {\r\n    let ret = new lexer(this.tokdef, this.errfunc);\r\n\r\n    for (let k in this.states) {\r\n      let state = this.states[k];\r\n\r\n      state = [state[0], state[1]];\r\n      ret.states[k] = state;\r\n    }\r\n\r\n    ret.statedata = this.statedata;\r\n\r\n    return ret;\r\n  }\r\n\r\n//errfunc is optional, defines state-specific error function\r\n  add_state(name, tokdef, errfunc) {\r\n    if (errfunc === undefined) {\r\n      errfunc = function (lexer) {\r\n        return true;\r\n      };\r\n    }\r\n\r\n    this.states[name] = [tokdef, errfunc];\r\n  }\r\n\r\n  tok_int(name) {\r\n\r\n  }\r\n\r\n  //statedata is optional.\r\n  //it stores state-specific data in lexer.statedata.\r\n  push_state(state, statedata) {\r\n    this.statestack.push([state, statedata])\r\n\r\n    state = this.states[state];\r\n    this.statedata = statedata;\r\n\r\n    this.tokdef = state[0];\r\n    this.errfunc = state[1];\r\n  }\r\n\r\n  pop_state() {\r\n    let item = this.statestack[this.statestack.length - 1];\r\n    let state = this.states[item[0]];\r\n\r\n    this.tokdef = state[0];\r\n    this.errfunc = state[1];\r\n    this.statedata = item[1];\r\n  }\r\n\r\n  input(str) {\r\n    //go back to main state\r\n    while (this.statestack.length > 1) {\r\n      this.pop_state();\r\n    }\r\n\r\n    this.lexdata = str;\r\n    this.lexpos = 0;\r\n    this.lineno = 0;\r\n    this.tokens = new Array();\r\n\r\n    this.peeked_tokens = [];\r\n  }\r\n\r\n  error() {\r\n    if (this.errfunc !== undefined && !this.errfunc(this))\r\n      return;\r\n\r\n    console.log(\"Syntax error near line \" + this.lineno);\r\n    let next = Math.min(this.lexpos + 8, this.lexdata.length);\r\n    console.log(\"  \" + this.lexdata.slice(this.lexpos, next));\r\n\r\n    throw new PUTLParseError(\"Parse error\");\r\n  }\r\n\r\n  peek() {\r\n    let tok = this.next(true);\r\n\r\n    if (tok === undefined)\r\n      return undefined;\r\n\r\n    this.peeked_tokens.push(tok);\r\n    return tok;\r\n  }\r\n\r\n\r\n  peek_i(i) {\r\n    while (this.peeked_tokens.length <= i) {\r\n      let t = this.peek();\r\n      if (t === undefined)\r\n        return undefined;\r\n    }\r\n\r\n    return this.peeked_tokens[i];\r\n  }\r\n\r\n  at_end() {\r\n    return this.lexpos >= this.lexdata.length && this.peeked_tokens.length === 0;\r\n  }\r\n\r\n  next(ignore_peek) {\r\n    if (ignore_peek !== true && this.peeked_tokens.length > 0) {\r\n      let tok = this.peeked_tokens[0];\r\n\r\n      if (this.print_debug) {\r\n        console.log(\"PEEK_SHIFTING\", \"\" + tok);\r\n      }\r\n\r\n      this.peeked_tokens.shift();\r\n\r\n      if (this.print_tokens) {\r\n        console.log(tok.toString());\r\n      }\r\n\r\n      return tok;\r\n    }\r\n\r\n    if (this.lexpos >= this.lexdata.length)\r\n      return undefined;\r\n\r\n    let ts = this.tokdef;\r\n    let tlen = ts.length;\r\n\r\n    let lexdata = this.lexdata.slice(this.lexpos, this.lexdata.length);\r\n\r\n    let results = []\r\n\r\n    for (let i = 0; i < tlen; i++) {\r\n      let t = ts[i];\r\n\r\n      if (t.re === undefined)\r\n        continue;\r\n\r\n      let res = t.re.exec(lexdata);\r\n\r\n      if (res !== null && res !== undefined && res.index === 0) {\r\n        results.push([t, res]);\r\n      }\r\n    }\r\n\r\n    let max_res = 0;\r\n    let theres = undefined;\r\n    for (let i = 0; i < results.length; i++) {\r\n      let res = results[i];\r\n\r\n      if (res[1][0].length > max_res) {\r\n        theres = res;\r\n        max_res = res[1][0].length;\r\n      }\r\n    }\r\n\r\n    if (theres === undefined) {\r\n      this.error();\r\n      return;\r\n    }\r\n\r\n    let def = theres[0];\r\n\r\n    let lexlen = max_res;\r\n    let tok = new token(def.name, theres[1][0], this.lexpos, lexlen, this.lineno, this, undefined);\r\n    this.lexpos += max_res;\r\n\r\n    if (def.func) {\r\n      tok = def.func(tok)\r\n\r\n      if (tok === undefined) {\r\n        return this.next(ignore_peek);\r\n      }\r\n    }\r\n\r\n    if (this.print_tokens) {\r\n      console.log(tok.toString());\r\n    }\r\n\r\n    if (!ignore_peek && this.print_debug) {\r\n      console.log(\"CONSUME\", tok.toString(), \"\\n\" + getTraceBack());\r\n    }\r\n\r\n    return tok;\r\n  }\r\n}\r\n\r\nexport function getTraceBack(limit, start) {\r\n  try {\r\n    throw new Error();\r\n  } catch (error) {\r\n    let stack = error.stack.split(\"\\n\");\r\n    stack = stack.slice(1, stack.length);\r\n\r\n    if (start === undefined) {\r\n      start = 0;\r\n    }\r\n\r\n    for (let i = 0; i < stack.length; i++) {\r\n      let l = stack[i];\r\n\r\n      let j = l.length - 1;\r\n      while (j > 0 && l[j] !== \"/\") {\r\n        j--;\r\n      }\r\n\r\n      let k = j;\r\n      while (k >= 0 && l[k] !== \"(\") {\r\n        k--;\r\n      }\r\n\r\n      let func = l.slice(0, k).trim();\r\n      let file = l.slice(j + 1, l.length - 1);\r\n\r\n      l = `  ${func} (${file})`;\r\n\r\n      if (l.search(/parseutil\\.js/) >= 0) {\r\n        start = Math.max(start, i);\r\n      }\r\n      stack[i] = l;\r\n    }\r\n\r\n    if (limit !== undefined) {\r\n      stack.length = Math.min(stack.length, limit);\r\n    }\r\n\r\n    if (start !== undefined) {\r\n      stack = stack.slice(start, stack.length);\r\n    }\r\n\r\n    stack = stack.join(\"\\n\");\r\n    return stack;\r\n  }\r\n}\r\n\r\nexport class parser {\r\n  constructor(lexer, errfunc) {\r\n    this.lexer = lexer;\r\n    this.errfunc = errfunc;\r\n    this.start = undefined;\r\n    this.userdata = undefined;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new parser(this.lexer.copy(), this.errfunc);\r\n    ret.start = this.start;\r\n\r\n    return ret;\r\n  }\r\n\r\n\r\n  parse(data, err_on_unconsumed) {\r\n    if (err_on_unconsumed === undefined)\r\n      err_on_unconsumed = true;\r\n\r\n    if (data !== undefined)\r\n      this.lexer.input(data);\r\n\r\n    let ret = this.start(this);\r\n\r\n    if (err_on_unconsumed && !this.lexer.at_end() && this.lexer.next() !== undefined) {\r\n      //console.log(this.lexer.lexdata.slice(this.lexer.lexpos-1, this.lexer.lexdata.length));\r\n      this.error(undefined, \"parser did not consume entire input\");\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  input(data) {\r\n    this.lexer.input(data);\r\n  }\r\n\r\n  error(tok, msg) {\r\n    if (msg === undefined)\r\n      msg = \"\"\r\n\r\n    let estr;\r\n\r\n    if (tok === undefined)\r\n      estr = \"Parse error at end of input: \" + msg\r\n    else\r\n      estr = \"Parse error at line \" + (tok.lineno + 1) + \": \" + msg;\r\n\r\n    let buf = \"1| \"\r\n    let ld = this.lexer.lexdata;\r\n    let l = 1;\r\n    for (let i = 0; i < ld.length; i++) {\r\n      let c = ld[i];\r\n      if (c === '\\n') {\r\n        l++;\r\n        buf += \"\\n\" + l + \"| \"\r\n      } else {\r\n        buf += c;\r\n      }\r\n    }\r\n\r\n    console.log(\"------------------\")\r\n    console.log(buf);\r\n    console.log(\"==================\")\r\n    console.log(estr);\r\n\r\n    if (this.errfunc && !this.errfunc(tok)) {\r\n      return;\r\n    }\r\n\r\n    throw new PUTLParseError(estr);\r\n  }\r\n\r\n  peek() {\r\n    let tok = this.lexer.peek();\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n\r\n    return tok;\r\n  }\r\n\r\n  peek_i(i) {\r\n    let tok = this.lexer.peek_i(i);\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n\r\n    return tok;\r\n  }\r\n\r\n  peeknext() {\r\n    return this.peek_i(0);\r\n  }\r\n\r\n  next() {\r\n    let tok = this.lexer.next();\r\n\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n\r\n    return tok;\r\n  }\r\n\r\n  optional(type) {\r\n    let tok = this.peek_i(0);\r\n\r\n    if (tok && tok.type === type) {\r\n      this.next();\r\n\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  at_end() {\r\n    return this.lexer.at_end();\r\n  }\r\n\r\n  expect(type, msg) {\r\n    let tok = this.next();\r\n\r\n    if (msg === undefined)\r\n      msg = type\r\n\r\n    if (tok === undefined || tok.type != type) {\r\n      this.error(tok, \"Expected \" + msg + \", not \" + tok.type);\r\n    }\r\n\r\n    return tok.value;\r\n  }\r\n}\r\n\r\nfunction test_parser() {\r\n  let basic_types = new set([\r\n    \"int\",\r\n    \"float\",\r\n    \"double\",\r\n    \"vec2\",\r\n    \"vec3\",\r\n    \"vec4\",\r\n    \"mat4\",\r\n    \"string\"]);\r\n\r\n  let reserved_tokens = new set([\r\n    \"int\",\r\n    \"float\",\r\n    \"double\",\r\n    \"vec2\",\r\n    \"vec3\",\r\n    \"vec4\",\r\n    \"mat4\",\r\n    \"string\",\r\n    \"static_string\",\r\n    \"array\"]);\r\n\r\n  function tk(name, re, func) {\r\n    return new tokdef(name, re, func);\r\n  }\r\n\r\n  let tokens = [\r\n    tk(\"ID\", /[a-zA-Z]+[a-zA-Z0-9_]*/, function (t) {\r\n      if (reserved_tokens.has(t.value)) {\r\n        t.type = t.value.toUpperCase();\r\n      }\r\n\r\n      return t;\r\n    }),\r\n    tk(\"OPEN\", /\\{/),\r\n    tk(\"CLOSE\", /}/),\r\n    tk(\"COLON\", /:/),\r\n    tk(\"JSCRIPT\", /\\|/, function (t) {\r\n      let js = \"\"\r\n      let lexer = t.lexer;\r\n      while (lexer.lexpos < lexer.lexdata.length) {\r\n        let c = lexer.lexdata[lexer.lexpos];\r\n        if (c === \"\\n\")\r\n          break;\r\n\r\n        js += c;\r\n        lexer.lexpos++;\r\n      }\r\n\r\n      if (js.endsWith(\";\")) {\r\n        js = js.slice(0, js.length - 1);\r\n        lexer.lexpos--;\r\n      }\r\n\r\n      t.value = js;\r\n      return t;\r\n    }),\r\n\r\n    tk(\"LPARAM\", /\\(/),\r\n    tk(\"RPARAM\", /\\)/),\r\n    tk(\"COMMA\", /,/),\r\n    tk(\"NUM\", /[0-9]/),\r\n    tk(\"SEMI\", /;/),\r\n    tk(\"NEWLINE\", /\\n/, function (t) {\r\n      t.lexer.lineno += 1;\r\n    }),\r\n    tk(\"SPACE\", / |\\t/, function (t) {\r\n      //throw out non-newline whitespace tokens\r\n    })\r\n  ];\r\n\r\n  for (let rt in reserved_tokens) {\r\n    tokens.push(tk(rt.toUpperCase()));\r\n  }\r\n\r\n  /*let a =\r\n  Loop {\r\n    eid : int;\r\n    flag : int;\r\n    index : int;\r\n    type : int;\r\n\r\n    co : vec3;\r\n    no : vec3;\r\n    loop : int | eid(loop);\r\n    edges : array(e, int) | e.eid;\r\n\r\n    loops : array(Loop);\r\n  }\r\n  `;\r\n  */\r\n\r\n  function errfunc(lexer) {\r\n    return true; //throw error\r\n  }\r\n\r\n  let lex = new lexer(tokens, errfunc)\r\n  console.log(\"Testing lexical scanner...\")\r\n\r\n  lex.input(a);\r\n\r\n  let tok;\r\n  while (tok = lex.next()) {\r\n    console.log(tok.toString())\r\n  }\r\n\r\n  let parser = new parser(lex);\r\n  parser.input(a);\r\n\r\n  function p_Array(p) {\r\n    p.expect(\"ARRAY\");\r\n    p.expect(\"LPARAM\");\r\n\r\n    let arraytype = p_Type(p);\r\n    let itername = \"\";\r\n\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = arraytype;\r\n      arraytype = p_Type(p);\r\n    }\r\n\r\n\r\n    p.expect(\"RPARAM\");\r\n\r\n    return {type: \"array\", data: {type: arraytype, iname: itername}};\r\n  }\r\n\r\n  function p_Type(p) {\r\n    let tok = p.peek()\r\n\r\n    if (tok.type === \"ID\") {\r\n      p.next();\r\n      return {type: \"struct\", data: \"\\\"\" + tok.value + \"\\\"\"};\r\n    } else if (basic_types.has(tok.type.toLowerCase())) {\r\n      p.next();\r\n      return {type: tok.type.toLowerCase()};\r\n    } else if (tok.type === \"ARRAY\") {\r\n      return p_Array(p);\r\n    } else {\r\n      p.error(tok, \"invalid type \" + tok.type); //(tok.value === \"\" ? tok.type : tok.value));\r\n    }\r\n  }\r\n\r\n  function p_Field(p) {\r\n    let field = {}\r\n\r\n    console.log(\"-----\", p.peek().type);\r\n\r\n    field.name = p.expect(\"ID\", \"struct field name\");\r\n    p.expect(\"COLON\");\r\n\r\n    field.type = p_Type(p);\r\n    field.set = undefined;\r\n    field.get = undefined;\r\n\r\n    let tok = p.peek();\r\n    if (tok.type === \"JSCRIPT\") {\r\n      field.get = tok.value;\r\n      p.next()\r\n    }\r\n\r\n    tok = p.peek();\r\n    if (tok.type === \"JSCRIPT\") {\r\n      field.set = tok.value;\r\n      p.next();\r\n    }\r\n\r\n    p.expect(\"SEMI\");\r\n\r\n    return field;\r\n  }\r\n\r\n  function p_Struct(p) {\r\n    let st = {}\r\n    st.name = p.expect(\"ID\", \"struct name\")\r\n    st.fields = [];\r\n\r\n    p.expect(\"OPEN\");\r\n\r\n    while (1) {\r\n      if (p.at_end()) {\r\n        p.error(undefined);\r\n      } else if (p.optional(\"CLOSE\")) {\r\n        break;\r\n      } else {\r\n        st.fields.push(p_Field(p));\r\n      }\r\n    }\r\n\r\n    return st;\r\n  }\r\n\r\n  let ret = p_Struct(parser);\r\n\r\n  console.log(JSON.stringify(ret));\r\n}\r\n","import {ToolClasses, ToolOp, ToolFlags, UndoFlags, ToolMacro} from './toolsys.js';\r\nimport {tokdef, lexer, parser, PUTLParseError} from '../util/parseutil.js';\r\nimport {DataPathError} from '../controller/controller_base.js';\r\nimport {cachering} from '../util/util.js';\r\n\r\nexport let ToolPaths = {};\r\n\r\nvar initToolPaths_run = false;\r\n\r\nexport function buildParser() {\r\n  let t = (name, re, func) => new tokdef(name, re, func);\r\n\r\n  let tokens = [\r\n    t('ID', /[a-zA-Z_$]+[a-zA-Z0-9_$]*/, (t) => {\r\n      if (t.value == \"true\" || t.value == \"false\") {\r\n        t.type = \"BOOL\";\r\n        t.value = t.value == \"true\";\r\n      }\r\n\r\n      return t;\r\n    }),\r\n    t('LPAREN', /\\(/),\r\n    t('RPAREN', /\\)/),\r\n    t('LSBRACKET', /\\[/),\r\n    t('RSBRACKET', /\\]/),\r\n    t('DOT', /\\./),\r\n    t('COMMA', /\\,/),\r\n    t('EQUALS', /\\=/),\r\n    t('STRLIT', /\"[^\"]*\"/, (t) => {\r\n      t.value = t.value.slice(1, t.value.length-1);\r\n      return t;\r\n    }),\r\n    t('STRLIT', /'[^']*'/, (t) => {\r\n      t.value = t.value.slice(1, t.value.length-1);\r\n      return t;\r\n    }),\r\n    t('NUMBER', /-?[0-9]+/, (t) => {\r\n      t.value = parseInt(t.value);\r\n      return t;\r\n    }),\r\n    t('NUMBER', /-?[0-9]+\\.[0-9]*/, (t) => {\r\n      t.value = parseFloat(t.value);\r\n      return t;\r\n    }),\r\n    t('WS', /[ \\n\\r\\t]/, (t) => undefined) //ignore whitespace\r\n  ];\r\n\r\n  let lexerror = (t) => {\r\n    console.warn(\"Parse error\");\r\n    return true;\r\n  };\r\n\r\n  let valid_datatypes = {\r\n    \"STRLIT\" : 1, \"NUMBER\" : 1, \"BOOL\" : 1\r\n  };\r\n\r\n  function p_Start(p) {\r\n    let args = {};\r\n\r\n    while (!p.at_end()) {\r\n      let keyword = p.expect(\"ID\");\r\n\r\n      p.expect(\"EQUALS\");\r\n\r\n      let t = p.next();\r\n      if (!(t.type in valid_datatypes)) {\r\n        throw new PUTLParseError(\"parse error: unexpected \" + t.type);\r\n      }\r\n\r\n      args[keyword] = t.value;\r\n    }\r\n\r\n    return args;\r\n  }\r\n\r\n  let lex = new lexer(tokens, lexerror)\r\n  let p = new parser(lex);\r\n  p.start = p_Start;\r\n\r\n  return p;\r\n}\r\n\r\nexport let Parser = buildParser();\r\n/*\r\nlet parse_rets = new cachering(() => return {\r\n  toolclass : undefined,\r\n  args : {}\r\n}, 64);\r\n//*/\r\n\r\nexport function parseToolPath(str, check_tool_exists=true) {\r\n  if (!initToolPaths_run) {\r\n    initToolPaths_run = true;\r\n    initToolPaths();\r\n  }\r\n\r\n  let startstr = str;\r\n\r\n  let i1 = str.search(/\\(/);\r\n  let i2 = str.search(/\\)/);\r\n  let args = \"\";\r\n\r\n  if (i1 >= 0 && i2 >= 0) {\r\n    args = str.slice(i1+1, i2).trim();\r\n    str = str.slice(0, i1).trim();\r\n  }\r\n\r\n  if (!(str in ToolPaths) && check_tool_exists) {\r\n    throw new DataPathError(\"unknown tool \" + str);\r\n  }\r\n\r\n  let ret;\r\n\r\n  try {\r\n    ret = Parser.parse(args);\r\n  } catch (error) {\r\n    console.log(error);\r\n    throw new DataPathError(`\"${startstr}\"\\n  ${error.message}`);\r\n  }\r\n\r\n  return {\r\n    toolclass : ToolPaths[str],\r\n    args      : ret\r\n  };\r\n}\r\n\r\nexport function testToolParser() {\r\n  let ret = parseToolPath(\"view3d.sometool(selectmode=1 str='str' bool=true)\", false);\r\n\r\n  return ret;\r\n}\r\n\r\nwindow.parseToolPath = parseToolPath;\r\n//window._ToolPaths = ToolPaths;\r\n\r\n//tool path parser for simple_toolsys.js\r\nexport function initToolPaths() {\r\n  for (let cls of ToolClasses) {\r\n    if (!cls.hasOwnProperty(\"tooldef\")) { //ignore abstract classes\r\n      continue;\r\n    }\r\n\r\n    let def = cls.tooldef();\r\n    let path = def.toolpath;\r\n\r\n    ToolPaths[path] = cls;\r\n  }\r\n}","import {ToolOp} from '../toolsys/toolsys.js';\r\nimport {print_stack} from '../util/util.js';\r\nimport {PropFlags, PropTypes} from '../toolsys/toolprop_abstract.js';\r\nimport {ToolProperty} from '../toolsys/toolprop.js';\r\nimport {DataPathError, isVecProperty, ListIface} from './controller_base.js';\r\n\r\nexport class ModelInterface {\r\n  constructor() {\r\n    this.prefix = \"\";\r\n  }\r\n\r\n  getToolDef(path) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  getToolPathHotkey(ctx, path) {\r\n    return undefined;\r\n  }\r\n\r\n  get list() {\r\n    throw new Error(\"implement me\");\r\n    return ListIface;\r\n  }\r\n\r\n  createTool(path, inputs = {}, unused = undefined) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  //returns tool class, or undefined if one cannot be found for path\r\n  parseToolPath(path) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  /**\r\n   * runs .undo,.redo if toolstack head is same as tool\r\n   *\r\n   * otherwise, .execTool(ctx, tool) is called.\r\n   *\r\n   * @param compareInputs : check if toolstack head has identical input values, defaults to false\r\n   * */\r\n  execOrRedo(ctx, toolop, compareInputs = false) {\r\n    return ctx.toolstack.execOrRedo(ctx, toolop, compareInputs);\r\n  }\r\n\r\n  execTool(ctx, path, inputs = {}, unused = undefined, event = undefined) {\r\n    return new Promise((accept, reject) => {\r\n      let tool = path;\r\n\r\n      try {\r\n        if (typeof tool == \"string\" || !(tool instanceof ToolOp)) {\r\n          tool = this.createTool(ctx, path, inputs, unused);\r\n        }\r\n      } catch (error) {\r\n        print_stack(error);\r\n        reject(error);\r\n        return;\r\n      }\r\n\r\n      //give client a chance to change tool instance directly\r\n      accept(tool);\r\n\r\n      //execute\r\n      try {\r\n        ctx.toolstack.execTool(ctx, tool, event);\r\n      } catch (error) { //for some reason chrome is suppressing errors\r\n        print_stack(error);\r\n        throw error;\r\n      }\r\n    });\r\n  }\r\n\r\n  //used by simple_controller.js for tagging error messages\r\n  pushReportContext(name) {\r\n\r\n  }\r\n\r\n  //used by simple_controller.js for tagging error messages\r\n  popReportContext() {\r\n\r\n  }\r\n\r\n  static toolRegistered(tool) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  static registerTool(tool) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  //not yet supported by path.ux's controller implementation\r\n  massSetProp(ctx, mass_set_path, value) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  /** takes a mass_set_path and returns an array of individual paths */\r\n  resolveMassSetPaths(ctx, mass_set_path) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  /**\r\n   * @example\r\n   *\r\n   * return {\r\n   *   obj      : [object owning property key]\r\n   *   parent   : [parent of obj]\r\n   *   key      : [property key]\r\n   *   subkey   : used by flag properties, represents a key within the property\r\n   *   value    : [value of property]\r\n   *   prop     : [optional toolprop.ToolProperty representing the property definition]\r\n   *   struct   : [optional datastruct representing the type, if value is an object]\r\n   *   mass_set : mass setter string, if controller implementation supports it\r\n   * }\r\n   */\r\n  resolvePath(ctx, path, ignoreExistence, rootStruct) {\r\n  }\r\n\r\n  setValue(ctx, path, val, rootStruct) {\r\n    let res = this.resolvePath(ctx, path, undefined, rootStruct);\r\n    let prop = res.prop;\r\n\r\n    if (prop !== undefined && (prop.flag & PropFlags.READ_ONLY)) {\r\n      throw new DataPathError(\"Tried to set read only property\");\r\n    }\r\n\r\n    if (prop !== undefined && (prop.flag & PropFlags.USE_CUSTOM_GETSET)) {\r\n      prop.dataref = res.obj;\r\n      prop.ctx = ctx;\r\n      prop.datapath = path;\r\n\r\n      if (res.subkey !== undefined) {\r\n        let val2 = prop.getValue();\r\n        if (typeof val2 === \"object\") {\r\n          val2 = val2.copy();\r\n        }\r\n\r\n        if (prop.type === PropTypes.FLAG) {\r\n          if (val) {\r\n            val2 |= prop.values[res.subkey];\r\n          } else {\r\n            val2 &= ~prop.values[res.subkey];\r\n          }\r\n\r\n          val = val2;\r\n        } else if (prop.type === PropTypes.ENUM) {\r\n          val = prop.values[res.subkey];\r\n        } else {\r\n          val2[res.subkey] = val;\r\n          val = val2;\r\n        }\r\n      }\r\n\r\n      prop.setValue(val);\r\n      return;\r\n    }\r\n\r\n    if (prop !== undefined) {\r\n      if (prop.type === PropTypes.CURVE && !val) {\r\n        throw new DataPathError(\"can't set curve data to nothing\");\r\n      }\r\n\r\n      let use_range = (prop.type & (PropTypes.INT | PropTypes.FLOAT));\r\n\r\n      use_range = use_range || (res.subkey && (prop.type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4)));\r\n      use_range = use_range && prop.range;\r\n      use_range = use_range && !(prop.range[0] === 0.0 && prop.range[1] === 0.0);\r\n      use_range = use_range && typeof val === \"number\";\r\n\r\n      if (use_range) {\r\n        val = Math.min(Math.max(val, prop.range[0]), prop.range[1]);\r\n      }\r\n    }\r\n\r\n    let old = res.obj[res.key];\r\n\r\n    if (res.subkey !== undefined && res.prop !== undefined && res.prop.type === PropTypes.ENUM) {\r\n      let ival = res.prop.values[res.subkey];\r\n\r\n      if (val) {\r\n        res.obj[res.key] = ival;\r\n      }\r\n    } else if (res.prop !== undefined && res.prop.type === PropTypes.FLAG) {\r\n      if (res.subkey !== undefined) {\r\n        let ival = res.prop.values[res.subkey];\r\n\r\n        if (val) {\r\n          res.obj[res.key] |= ival;\r\n        } else {\r\n          res.obj[res.key] &= ~ival;\r\n        }\r\n      } else if (typeof val === \"number\" || typeof val === \"boolean\") {\r\n        val = typeof val === \"boolean\" ? (val & 1) : val;\r\n\r\n        res.obj[res.key] = val;\r\n      } else {\r\n        throw new DataPathError(\"Expected a number for a bitmask property\");\r\n      }\r\n    } else if (res.subkey !== undefined && isVecProperty(res.prop)) {\r\n      if (res.key !== \"\") {\r\n        res.obj[res.key][res.subkey] = val;\r\n      } else {\r\n        res.obj[res.subkey] = val;\r\n      }\r\n    } else if (res.key === \"\" && isVecProperty(res.prop)) {\r\n      for (let i = 0; i < res.obj.length; i++) {\r\n        res.obj[i] = val[i];\r\n      }\r\n    } else if (!(prop !== undefined && prop instanceof ListIface)) {\r\n      res.obj[res.key] = val;\r\n    }\r\n\r\n    if (prop !== undefined && prop instanceof ListIface) {\r\n      prop.set(this, res.obj, res.key, val);\r\n    } else if (prop !== undefined) {\r\n      prop.dataref = res.obj;\r\n      prop.datapath = path;\r\n      prop.ctx = ctx;\r\n\r\n      prop._fire(\"change\", res.obj[res.key], old);\r\n    }\r\n  }\r\n\r\n  getDescription(ctx, path) {\r\n    let rdef = this.resolvePath(ctx, path);\r\n    if (rdef === undefined) {\r\n      throw new DataPathError(\"invalid path \" + path);\r\n    }\r\n\r\n    if (!rdef.prop || !(rdef.prop instanceof ToolProperty)) {\r\n      return \"\";\r\n    }\r\n\r\n    let type = rdef.prop.type;\r\n    let prop = rdef.prop;\r\n\r\n    if (rdef.subkey !== undefined) {\r\n      let subkey = rdef.subkey;\r\n\r\n      if (type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4)) {\r\n        if (prop.descriptions && subkey in prop.descriptions) {\r\n          return prop.descriptions[subkey];\r\n        }\r\n      } else if (type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n        if (!(subkey in prop.values) && subkey in prop.keys) {\r\n          subkey = prop.keys[subkey]\r\n        }\r\n        ;\r\n\r\n        if (prop.descriptions && subkey in prop.descriptions) {\r\n          return prop.descriptions[subkey];\r\n        }\r\n      } else if (type === PropTypes.PROPLIST) {\r\n        let val = tdef.value;\r\n        if (typeof val === \"object\" && val instanceof ToolProperty) {\r\n          return val.description;\r\n        }\r\n      }\r\n    }\r\n\r\n    return rdef.prop.description ? rdef.prop.description : rdef.prop.uiname;\r\n  }\r\n\r\n  validPath(ctx, path, rootStruct) {\r\n    try {\r\n      this.getValue(ctx, path, rootStruct);\r\n      return true;\r\n    } catch (error) {\r\n      if (!(error instanceof DataPathError)) {\r\n        throw error;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  getPropName(ctx, path) {\r\n    let i = path.length - 1;\r\n    while (i >= 0 && path[i] !== \".\") {\r\n      i--;\r\n    }\r\n\r\n    path = path.slice(i + 1, path.length).trim();\r\n\r\n    if (path.endsWith(\"]\")) {\r\n      i = path.length - 1;\r\n      while (i >= 0 && path[i] !== \"[\") {\r\n        i--;\r\n      }\r\n\r\n      path = path.slice(0, i).trim();\r\n\r\n      return this.getPropName(ctx, path);\r\n    }\r\n\r\n    return path;\r\n  }\r\n\r\n  getValue(ctx, path, rootStruct = undefined) {\r\n    if (typeof ctx == \"string\") {\r\n      throw new Error(\"You forgot to pass context to getValue\");\r\n    }\r\n\r\n    let ret = this.resolvePath(ctx, path, undefined, rootStruct);\r\n\r\n    if (ret === undefined) {\r\n      throw new DataPathError(\"invalid path \" + path);\r\n    }\r\n\r\n    let exec = ret.prop !== undefined && (ret.prop.flag & PropFlags.USE_CUSTOM_GETSET);\r\n\r\n    //resolvePath handles the case of vector properties with custom callbacks for us\r\n    //(and possibly all the other cases too, need to check)\r\n    exec = exec && !(ret.prop !== undefined && (ret.prop.type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4 | PropTypes.QUAT)));\r\n\r\n    if (exec) {\r\n      ret.prop.dataref = ret.obj;\r\n      ret.prop.datapath = path;\r\n      ret.prop.ctx = ctx;\r\n\r\n      let val = ret.prop.getValue();\r\n\r\n      if (typeof val === \"string\" && (ret.prop.type & (PropTypes.FLAG | PropTypes.ENUM))) {\r\n        val = ret.prop.values[val];\r\n      }\r\n\r\n      if (ret.subkey && ret.prop.type === PropTypes.ENUM) {\r\n        val = val === ret.prop.values[ret.subkey];\r\n      } else if (ret.subkey && ret.prop.type === PropTypes.FLAG) {\r\n        val = val & ret.prop.values[ret.subkey];\r\n      }\r\n\r\n      return val;\r\n\r\n    }\r\n\r\n    return ret.value;\r\n  }\r\n}\r\n","import {ToolOp, ToolFlags} from \"../toolsys/toolsys.js\";\r\nimport {\r\n  PropTypes, PropFlags, BoolProperty, IntProperty, FloatProperty, FlagProperty,\r\n  EnumProperty, StringProperty, Vec3Property, Vec2Property, Vec4Property,\r\n  QuatProperty, Mat4Property\r\n} from \"../toolsys/toolprop.js\";\r\n\r\nimport * as util from '../util/util.js';\r\nimport {isVecProperty, getVecClass} from \"./controller_base.js\";\r\n\r\nexport class DataPathSetOp extends ToolOp {\r\n  constructor() {\r\n    super();\r\n\r\n    this.propType = -1;\r\n    this._undo = undefined;\r\n  }\r\n\r\n  setValue(ctx, val, object) {\r\n    let prop = this.inputs.prop;\r\n    let path = this.inputs.dataPath.getValue();\r\n\r\n    if (prop.type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n      let rdef = ctx.api.resolvePath(ctx, path);\r\n      if (rdef.subkey !== undefined) {\r\n        let subkey = rdef.subkey;\r\n        if (typeof subkey === \"string\") {\r\n          subkey = rdef.prop.values[subkey];\r\n        }\r\n\r\n        this.inputs.flagBit.setValue(subkey);\r\n        this.inputs.useFlagBit.setValue(true);\r\n      }\r\n\r\n      //if (rdef.subkey !== undefined) {\r\n      //  val = rdef.value;\r\n      //val = !!val;\r\n      //}\r\n    }\r\n\r\n    prop.dataref = object;\r\n    prop.ctx = ctx;\r\n    prop.datapath = path;\r\n\r\n    try {\r\n      prop.setValue(val);\r\n      this.hadError = false;\r\n    } catch (error) {\r\n      console.error(\"Error setting datapath\", path);\r\n      this.hadError = true;\r\n    }\r\n  }\r\n\r\n  static create(ctx, datapath, value, id, massSetPath) {\r\n    let rdef = ctx.api.resolvePath(ctx, datapath);\r\n\r\n    if (rdef === undefined || rdef.prop === undefined) {\r\n      console.warn(\"DataPathSetOp failed\", rdef, rdef.prop);\r\n      return;\r\n    }\r\n\r\n    let prop = rdef.prop;\r\n    let tool = new DataPathSetOp();\r\n\r\n    tool.propType = prop.type;\r\n    tool.inputs.destType.setValue(prop.type);\r\n\r\n    if (prop && (prop.flag & PropFlags.USE_BASE_UNDO)) {\r\n      tool.inputs.fullSaveUndo.setValue(true);\r\n    }\r\n\r\n    let mask = PropTypes.FLAG | PropTypes.ENUM;\r\n    mask |= PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4 | PropTypes.QUAT;\r\n\r\n    if (rdef.subkey !== undefined && (prop.type & mask)) {\r\n      if (prop.type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n        let i = datapath.length - 1;\r\n\r\n        //chope off enum selector\r\n        while (i >= 0 && datapath[i] !== '[' && datapath[i] !== '=') {\r\n          i--;\r\n        }\r\n\r\n        if (i >= 0) {\r\n          if (!value && prop.type === PropTypes.ENUM) {\r\n            /* This is a no-op. */\r\n            return undefined;\r\n          }\r\n\r\n          datapath = datapath.slice(0, i).trim();\r\n        }\r\n\r\n        tool.inputs.prop = new IntProperty();\r\n      } else {\r\n        tool.inputs.prop = new FloatProperty();\r\n      }\r\n\r\n      let subkey = rdef.subkey;\r\n      if (typeof subkey !== \"number\") {\r\n        subkey = rdef.prop.values[subkey];\r\n      }\r\n\r\n      if (prop.type === PropTypes.FLAG) {\r\n        tool.inputs.flagBit.setValue(subkey);\r\n        tool.inputs.useFlagBit.setValue(true);\r\n      }\r\n\r\n      if (prop.type === PropTypes.ENUM) {\r\n        value = subkey;\r\n      } else if (prop.type === PropTypes.FLAG) {\r\n        let value2 = ctx.api.getValue(ctx, datapath);\r\n\r\n        if (typeof value2 !== \"number\") {\r\n          value2 = typeof value2 === \"boolean\" ? (value & 1) : 0;\r\n        }\r\n\r\n        if (value) {\r\n          value2 |= subkey;\r\n        } else {\r\n          value2 &= ~subkey;\r\n        }\r\n\r\n        value = value2;\r\n      }\r\n      //value = rdef.obj[rdef.key];\r\n      //console.log(\"rdef.value\", value);\r\n    } else {\r\n      tool.inputs.prop = prop.copy();\r\n    }\r\n\r\n    tool.inputs.dataPath.setValue(datapath);\r\n\r\n    if (massSetPath) {\r\n      tool.inputs.massSetPath.setValue(massSetPath);\r\n    } else {\r\n      tool.inputs.massSetPath.setValue(\"\");\r\n    }\r\n\r\n    tool.id = id;\r\n\r\n    tool.setValue(ctx, value, rdef.obj);\r\n\r\n    return tool;\r\n  }\r\n\r\n  hash(massSetPath, dataPath, prop, id) {\r\n    massSetPath = massSetPath === undefined ? \"\" : massSetPath;\r\n    massSetPath = massSetPath === null ? \"\" : massSetPath;\r\n\r\n    let ret = \"\" + massSetPath + \":\" + dataPath + \":\" + prop + \":\" + id;\r\n\r\n    return ret;\r\n  }\r\n\r\n  hashThis() {\r\n    return this.hash(this.inputs.massSetPath.getValue(),\r\n      this.inputs.dataPath.getValue(),\r\n      this.propType,\r\n      this.id);\r\n  }\r\n\r\n  undoPre(ctx) {\r\n    if (this.inputs.fullSaveUndo.getValue()) {\r\n      return super.undoPre(ctx);\r\n    }\r\n\r\n    if (this.__ctx)\r\n      ctx = this.__ctx;\r\n\r\n    this._undo = {};\r\n\r\n    let paths = new Set();\r\n\r\n    if (this.inputs.massSetPath.getValue().trim()) {\r\n      let massSetPath = this.inputs.massSetPath.getValue().trim();\r\n\r\n      paths = new Set(ctx.api.resolveMassSetPaths(ctx, massSetPath));\r\n\r\n    }\r\n\r\n    paths.add(this.inputs.dataPath.getValue());\r\n\r\n    for (let path of paths) {\r\n      let val = ctx.api.getValue(ctx, path);\r\n\r\n      if (typeof val === \"object\") {\r\n        val = val.copy();\r\n      }\r\n\r\n      this._undo[path] = val;\r\n    }\r\n\r\n    /*\r\n    for (let path of paths) {\r\n      let rdef = ctx.api.resolvePath(ctx, path);\r\n\r\n      if (rdef === undefined) {\r\n        console.warn(\"Failed to lookup path in DataPathSetOp.undoPre\", path);\r\n        continue;\r\n      }\r\n\r\n      let prop = rdef.prop;\r\n      let value = rdef.value;\r\n\r\n      if (prop.type & (PropTypes.ENUM|PropTypes.FLAG)) {\r\n        this._undo[path] = rdef.obj[rdef.key];\r\n      } else if (isVecProperty(prop)) {\r\n        if (rdef.subkey) {\r\n          this._undo[path] = rdef.value;\r\n        } else {\r\n          let cls = getVecClass(prop.type);\r\n          this._undo[path] = new cls(rdef.value);\r\n        }\r\n      } else {\r\n        let prop2 = prop.copy();\r\n\r\n        prop2.dataref = rdef.obj;\r\n        prop2.datapath = path;\r\n        prop2.ctx = ctx;\r\n\r\n        prop2.setValue(value);\r\n\r\n        this._undo[path] = prop2.getValue();\r\n      }\r\n    }*/\r\n  }\r\n\r\n  undo(ctx) {\r\n    if (this.__ctx)\r\n      ctx = this.__ctx;\r\n\r\n    if (this.inputs.fullSaveUndo.getValue()) {\r\n      return super.undo(ctx);\r\n    }\r\n\r\n    for (let path in this._undo) {\r\n      let rdef = ctx.api.resolvePath(ctx, path);\r\n\r\n      if (rdef.prop !== undefined && (rdef.prop.type & (PropTypes.ENUM | PropTypes.FLAG))) {\r\n        let old = rdef.obj[rdef.key];\r\n\r\n        if (rdef.subkey) {\r\n          let key = rdef.subkey;\r\n\r\n          if (typeof key !== \"number\") {\r\n            key = rdef.prop.values[key];\r\n          }\r\n\r\n          if (rdef.prop.type === PropTypes.FLAG) {\r\n            if (this._undo[path]) {\r\n              rdef.obj[rdef.key] |= key;\r\n            } else {\r\n              rdef.obj[rdef.key] &= ~key;\r\n            }\r\n          } else {\r\n            rdef.obj[rdef.key] = key;\r\n          }\r\n        } else {\r\n          rdef.obj[rdef.key] = this._undo[path];\r\n        }\r\n\r\n        rdef.prop.dataref = rdef.obj;\r\n        rdef.prop.datapath = path;\r\n        rdef.prop.ctx = ctx;\r\n\r\n        rdef.prop._fire(\"change\", rdef.obj[rdef.key], old);\r\n      } else {\r\n        try {\r\n          ctx.api.setValue(ctx, path, this._undo[path]);\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n          console.warn(\"Failed to set property in undo for DataPathSetOp\");\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  exec(ctx) {\r\n    //use saved ctx we got from modal start\r\n    if (this.__ctx) {\r\n      ctx = this.__ctx;\r\n    }\r\n\r\n    let path = this.inputs.dataPath.getValue();\r\n    let massSetPath = this.inputs.massSetPath.getValue().trim();\r\n\r\n    try {\r\n      ctx.api.setValue(ctx, path, this.inputs.prop.getValue());\r\n      this.hadError = false;\r\n    } catch (error) {\r\n      console.log(error.stack);\r\n      console.log(error.message);\r\n      console.log(\"error setting \" + path);\r\n\r\n      this.hadError = true;\r\n    }\r\n\r\n    if (massSetPath) {\r\n      let value = this.inputs.prop.getValue();\r\n      let useFlagBit = this.inputs.useFlagBit.getValue();\r\n\r\n      if (useFlagBit && this.inputs.destType.getValue() === PropTypes.FLAG) {\r\n        let bit = this.inputs.flagBit.getValue();\r\n\r\n        value = !!(value & bit);\r\n      }\r\n      try {\r\n        ctx.api.massSetProp(ctx, massSetPath, value);\r\n      } catch (error) {\r\n        console.log(error.stack);\r\n        console.log(error.message);\r\n        console.log(\"error setting \" + path);\r\n\r\n        this.hadError = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  modalStart(ctx) {\r\n    this.__ctx = ctx.toLocked();\r\n\r\n    //save full, modal ctx\r\n    super.modalStart(this.__ctx);\r\n\r\n    this.exec(this.__ctx);\r\n    this.modalEnd(false);\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname  : \"Property Set\",\r\n      toolpath: \"app.prop_set\",\r\n      icon    : -1,\r\n      flag    : ToolFlags.PRIVATE,\r\n      is_modal: true,\r\n      inputs  : {\r\n        dataPath    : new StringProperty(),\r\n        massSetPath : new StringProperty(),\r\n        fullSaveUndo: new BoolProperty(false),\r\n        flagBit     : new IntProperty(),\r\n        useFlagBit  : new BoolProperty(),\r\n        destType    : new EnumProperty(PropTypes.INT, PropTypes),\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nToolOp.register(DataPathSetOp);\r\n","import nstructjs from \"../util/struct.js\";\r\nimport {CurveFlags, TangentModes, CurveTypeData} from './curve1d_base.js';\r\nimport {Vector2, Vector3, Vector4, Quat, Matrix4} from '../util/vectormath.js';\r\nimport * as util from '../util/util.js';\r\n\r\nlet _udigest = new util.HashDigest();\r\n\r\nfunction feq(a, b) {\r\n  return Math.abs(a - b) < 0.00001;\r\n}\r\n\r\nclass EquationCurve extends CurveTypeData {\r\n  constructor(type) {\r\n    super();\r\n\r\n    this.equation = \"x\";\r\n    this._last_equation = \"\";\r\n    this._last_xrange = new Vector2();\r\n    this._func = undefined;\r\n  }\r\n\r\n  get hasGUI() {\r\n    return this.uidata !== undefined;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      uiname  : \"Equation\",\r\n      name    : \"equation\",\r\n      typeName: \"EquationCurve\"\r\n    }\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    let d = digest;\r\n\r\n    super.calcHashKey(d);\r\n\r\n    d.add(this.equation);\r\n    d.add(this.parent.xRange[0]);\r\n    d.add(this.parent.xRange[1]);\r\n\r\n    return d.get();\r\n  }\r\n\r\n  equals(b) {\r\n    return super.equals(b) && this.equation === b.equation;\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = super.toJSON();\r\n\r\n    return Object.assign(ret, {\r\n      equation: this.equation\r\n    });\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    if (obj.equation !== undefined) {\r\n      this.equation = obj.equation;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  makeGUI(container, canvas, drawTransform) {\r\n    this.uidata = {\r\n      canvas    : canvas,\r\n      g         : canvas.g,\r\n      draw_trans: drawTransform,\r\n    };\r\n\r\n    let row = container.row();\r\n\r\n    let text = this.uidata.textbox = row.textbox(undefined, \"\" + this.equation);\r\n    text.onchange = (val) => {\r\n      console.log(val);\r\n      this.equation = val;\r\n      this.update();\r\n      this.redraw();\r\n    }\r\n\r\n    container.label(\"Equation\");\r\n\r\n  }\r\n\r\n  killGUI(dom, gui, canvas, g, draw_transform) {\r\n    if (this.uidata !== undefined) {\r\n      this.uidata.textbox.remove();\r\n    }\r\n\r\n    this.uidata = undefined;\r\n  }\r\n\r\n  updateTextBox() {\r\n    if (this.uidata && this.uidata.textbox) {\r\n      this.uidata.textbox.text = this.equation;\r\n    }\r\n  }\r\n\r\n  evaluate(s) {\r\n    let update = this.hermite || this._last_equation !== this.equation;\r\n    update = update || this._last_xrange.vectorDistance(this.parent.xRange) > 0.0;\r\n    update = update || !this._func;\r\n\r\n    if (update) {\r\n      this._last_xrange.load(this.parent.xRange);\r\n      this._last_equation = this.equation;\r\n\r\n      this.updateTextBox();\r\n      this.#makeFunc();\r\n\r\n      this._evaluate(0.0);\r\n\r\n      if (this._haserror) {\r\n        console.warn(\"ERROR!\");\r\n        return 0.0;\r\n      }\r\n    }\r\n\r\n    return this._func(s);\r\n  }\r\n\r\n  #makeFunc() {\r\n    this._func = undefined;\r\n\r\n    var sin = Math.sin, cos = Math.cos, pi = Math.PI, PI = Math.PI,\r\n        e                                                = Math.E, E                                    = Math.E, tan                      = Math.tan, abs = Math.abs,\r\n        floor                                            = Math.floor, ceil = Math.ceil, acos = Math.acos,\r\n        asin                                             = Math.asin, atan = Math.atan, cosh         = Math.cos,\r\n        sinh                                             = Math.sinh, log                            = Math.log, pow = Math.pow,\r\n        exp                                              = Math.exp, sqrt = Math.sqrt, cbrt           = Math.cbrt,\r\n        min                                              = Math.min, max = Math.max;\r\n\r\n    var func;\r\n    let code = `\r\n    func = function(x) {\r\n      return ${this.equation};\r\n    }\r\n    `;\r\n    try {\r\n      eval(code);\r\n\r\n      this._haserror = false;\r\n    } catch (error) {\r\n      this._haserror = true;\r\n      console.warn(\"Compile error!\", error.message);\r\n    }\r\n\r\n    this._func = func;\r\n  }\r\n\r\n  _evaluate(s) {\r\n    try {\r\n      let f = this._func(s);\r\n      this._haserror = false;\r\n\r\n      if (isNaN(f)) {\r\n        return 0.0;\r\n      }\r\n    } catch (error) {\r\n      this._haserror = true;\r\n      console.warn(\"ERROR!\");\r\n      return 0.0;\r\n    }\r\n  }\r\n\r\n  derivative(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.evaluate(s) - this.evaluate(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.evaluate(s + df) - this.evaluate(s))/df;\r\n    } else {\r\n      return (this.evaluate(s + df) - this.evaluate(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  derivative2(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.derivative(s) - this.derivative(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.derivative(s + df) - this.derivative(s))/df;\r\n    } else {\r\n      return (this.derivative(s + df) - this.derivative(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  inverse(y) {\r\n    let steps = 9;\r\n    let ds = 1.0/steps, s = 0.0;\r\n    let best = undefined;\r\n    let ret = undefined;\r\n\r\n    for (let i = 0; i < steps; i++, s += ds) {\r\n      let s1 = s, s2 = s + ds;\r\n\r\n      let mid;\r\n\r\n      for (let j = 0; j < 11; j++) {\r\n        let y1 = this.evaluate(s1);\r\n        let y2 = this.evaluate(s2);\r\n        mid = (s1 + s2)*0.5;\r\n\r\n        if (Math.abs(y1 - y) < Math.abs(y2 - y)) {\r\n          s2 = mid;\r\n        } else {\r\n          s1 = mid;\r\n        }\r\n      }\r\n\r\n      let ymid = this.evaluate(mid);\r\n\r\n      if (best === undefined || Math.abs(y - ymid) < best) {\r\n        best = Math.abs(y - ymid);\r\n        ret = mid;\r\n      }\r\n    }\r\n\r\n    return ret === undefined ? 0.0 : ret;\r\n  }\r\n\r\n  onActive(parent, draw_transform) {\r\n  }\r\n\r\n  onInactive(parent, draw_transform) {\r\n  }\r\n\r\n  reset() {\r\n    this.equation = \"x\";\r\n  }\r\n\r\n  destroy() {\r\n  }\r\n\r\n  draw(canvas, g, draw_transform) {\r\n    g.save();\r\n    if (this._haserror) {\r\n\r\n      g.fillStyle = g.strokeStyle = \"rgba(255, 50, 0, 0.25)\";\r\n      g.beginPath();\r\n      g.rect(0, 0, 1, 1);\r\n      g.fill();\r\n\r\n      g.beginPath();\r\n      g.moveTo(0, 0);\r\n      g.lineTo(1, 1);\r\n      g.moveTo(0, 1);\r\n      g.lineTo(1, 0);\r\n\r\n      g.lineWidth *= 3;\r\n      g.stroke();\r\n\r\n      g.restore();\r\n      return;\r\n    }\r\n\r\n    g.restore();\r\n  }\r\n}\r\n\r\nEquationCurve.STRUCT = nstructjs.inherit(EquationCurve, CurveTypeData) + `\r\n  equation : string;\r\n}\r\n`;\r\nnstructjs.register(EquationCurve);\r\nCurveTypeData.register(EquationCurve);\r\n\r\n\r\nclass GuassianCurve extends CurveTypeData {\r\n  constructor(type) {\r\n    super();\r\n\r\n    this.height = 1.0;\r\n    this.offset = 1.0;\r\n    this.deviation = 0.3; //standard deviation\r\n  }\r\n\r\n  get hasGUI() {\r\n    return this.uidata !== undefined;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      uiname  : \"Guassian\",\r\n      name    : \"guassian\",\r\n      typeName: \"GuassianCurve\"\r\n    }\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    super.calcHashKey(digest);\r\n\r\n    let d = digest;\r\n\r\n    d.add(this.height);\r\n    d.add(this.offset);\r\n    d.add(this.deviation);\r\n\r\n    return d.get();\r\n  }\r\n\r\n  equals(b) {\r\n    let r = super.equals(b);\r\n\r\n    r = r && feq(this.height, b.height);\r\n    r = r && feq(this.offset, b.offset);\r\n    r = r && feq(this.deviation, b.deviation);\r\n\r\n    return r;\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = super.toJSON();\r\n\r\n    return Object.assign(ret, {\r\n      height   : this.height,\r\n      offset   : this.offset,\r\n      deviation: this.deviation\r\n    });\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    this.height = obj.height !== undefined ? obj.height : 1.0;\r\n    this.offset = obj.offset;\r\n    this.deviation = obj.deviation;\r\n\r\n    return this;\r\n  }\r\n\r\n  makeGUI(container, canvas, drawTransform) {\r\n    this.uidata = {\r\n      canvas    : canvas,\r\n      g         : canvas.g,\r\n      draw_trans: drawTransform,\r\n    };\r\n\r\n    this.uidata.hslider = container.slider(undefined, \"Height\", this.height, -10, 10, 0.0001);\r\n    this.uidata.hslider.onchange = () => {\r\n      this.height = this.uidata.hslider.value;\r\n      this.redraw();\r\n      this.update();\r\n    }\r\n    this.uidata.oslider = container.slider(undefined, \"Offset\", this.offset, -10, 10, 0.0001);\r\n    this.uidata.oslider.onchange = () => {\r\n      this.offset = this.uidata.oslider.value;\r\n      this.redraw();\r\n      this.update();\r\n    }\r\n    this.uidata.dslider = container.slider(undefined, \"STD Deviation\", this.deviation, -10, 10, 0.0001);\r\n    this.uidata.dslider.onchange = () => {\r\n      this.deviation = this.uidata.dslider.value;\r\n      this.redraw();\r\n      this.update();\r\n    }\r\n\r\n    /*\r\n    this.uidata.oslider = gui.slider(undefined, \"Offset\", this.offset,\r\n      -2.5, 2.5, 0.0001, false, false, (val) => {this.offset = val, this.update(), this.redraw();});\r\n    this.uidata.dslider = gui.slider(undefined, \"STD Deviation\", this.deviation,\r\n      0.0001, 1.25, 0.0001, false, false, (val) => {this.deviation = val, this.update(), this.redraw();});\r\n    //*/\r\n  }\r\n\r\n  killGUI(dom, gui, canvas, g, draw_transform) {\r\n    if (this.uidata !== undefined) {\r\n      this.uidata.hslider.remove();\r\n      this.uidata.oslider.remove();\r\n      this.uidata.dslider.remove();\r\n    }\r\n\r\n    this.uidata = undefined;\r\n  }\r\n\r\n  evaluate(s) {\r\n    let r = this.height*Math.exp(-((s - this.offset)*(s - this.offset))/(2*this.deviation*this.deviation));\r\n    return r;\r\n  }\r\n\r\n  derivative(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.evaluate(s) - this.evaluate(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.evaluate(s + df) - this.evaluate(s))/df;\r\n    } else {\r\n      return (this.evaluate(s + df) - this.evaluate(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  derivative2(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.derivative(s) - this.derivative(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.derivative(s + df) - this.derivative(s))/df;\r\n    } else {\r\n      return (this.derivative(s + df) - this.derivative(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  inverse(y) {\r\n    let steps = 9;\r\n    let ds = 1.0/steps, s = 0.0;\r\n    let best = undefined;\r\n    let ret = undefined;\r\n\r\n    for (let i = 0; i < steps; i++, s += ds) {\r\n      let s1 = s, s2 = s + ds;\r\n\r\n      let mid;\r\n\r\n      for (let j = 0; j < 11; j++) {\r\n        let y1 = this.evaluate(s1);\r\n        let y2 = this.evaluate(s2);\r\n        mid = (s1 + s2)*0.5;\r\n\r\n        if (Math.abs(y1 - y) < Math.abs(y2 - y)) {\r\n          s2 = mid;\r\n        } else {\r\n          s1 = mid;\r\n        }\r\n      }\r\n\r\n      let ymid = this.evaluate(mid);\r\n\r\n      if (best === undefined || Math.abs(y - ymid) < best) {\r\n        best = Math.abs(y - ymid);\r\n        ret = mid;\r\n      }\r\n    }\r\n\r\n    return ret === undefined ? 0.0 : ret;\r\n  }\r\n}\r\n\r\nGuassianCurve.STRUCT = nstructjs.inherit(GuassianCurve, CurveTypeData) + `\r\n  height    : float;\r\n  offset    : float;\r\n  deviation : float;\r\n}\r\n`;\r\nnstructjs.register(GuassianCurve);\r\nCurveTypeData.register(GuassianCurve);\r\n","/*\r\n* Ease\r\n* Visit http://createjs.com/ for documentation, updates and examples.\r\n*\r\n* Copyright (c) 2010 gskinner.com, inc.\r\n*\r\n* Permission is hereby granted, free of charge, to any person\r\n* obtaining a copy of this software and associated documentation\r\n* files (the \"Software\"), to deal in the Software without\r\n* restriction, including without limitation the rights to use,\r\n* copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n* copies of the Software, and to permit persons to whom the\r\n* Software is furnished to do so, subject to the following\r\n* conditions:\r\n*\r\n* The above copyright notice and this permission notice shall be\r\n* included in all copies or substantial portions of the Software.\r\n*\r\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\r\n* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\r\n* OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\r\n* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\r\n* HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\r\n* WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\r\n* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\r\n* OTHER DEALINGS IN THE SOFTWARE.\r\n*/\r\n\r\n/**\r\n* @module TweenJS\r\n*/\r\n\r\n\r\n/**\r\n * The Ease class provides a collection of easing functions for use with TweenJS. It does not use the standard 4 param\r\n * easing signature. Instead it uses a single param which indicates the current linear ratio (0 to 1) of the tween.\r\n *\r\n * Most methods on Ease can be passed directly as easing functions:\r\n *\r\n *      createjs.Tween.get(target).to({x:100}, 500, createjs.Ease.linear);\r\n *\r\n * However, methods beginning with \"get\" will return an easing function based on parameter values:\r\n *\r\n *      createjs.Tween.get(target).to({y:200}, 500, createjs.Ease.getPowIn(2.2));\r\n *\r\n * Please see the <a href=\"http://www.createjs.com/Demos/TweenJS/Tween_SparkTable\">spark table demo</a> for an\r\n * overview of the different ease types on <a href=\"http://tweenjs.com\">TweenJS.com</a>.\r\n *\r\n * <em>Equations derived from work by Robert Penner.</em>\r\n * @class Ease\r\n * @static\r\n **/\r\n\r\n\r\nfunction Ease() {\r\n  throw \"Ease cannot be instantiated.\";\r\n}\r\n\r\nexport default Ease;\r\n\r\n// static methods and properties\r\n/**\r\n * @method linear\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.linear = function(t) { return t; };\r\n\r\n/**\r\n * Identical to linear.\r\n * @method none\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.none = Ease.linear;\r\n\r\n/**\r\n * Mimics the simple -100 to 100 easing in Adobe Flash/Animate.\r\n * @method get\r\n * @param {Number} amount A value from -1 (ease in) to 1 (ease out) indicating the strength and direction of the ease.\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.get = function(amount) {\r\n  if (amount < -1) { amount = -1; }\r\n  else if (amount > 1) { amount = 1; }\r\n  return function(t) {\r\n    if (amount==0) { return t; }\r\n    if (amount<0) { return t*(t*-amount+1+amount); }\r\n    return t*((2-t)*amount+(1-amount));\r\n  };\r\n};\r\n\r\n/**\r\n * Configurable exponential ease.\r\n * @method getPowIn\r\n * @param {Number} pow The exponent to use (ex. 3 would return a cubic ease).\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getPowIn = function(pow) {\r\n  return function(t) {\r\n    return Math.pow(t,pow);\r\n  };\r\n};\r\n\r\n/**\r\n * Configurable exponential ease.\r\n * @method getPowOut\r\n * @param {Number} pow The exponent to use (ex. 3 would return a cubic ease).\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getPowOut = function(pow) {\r\n  return function(t) {\r\n    return 1-Math.pow(1-t,pow);\r\n  };\r\n};\r\n\r\n/**\r\n * Configurable exponential ease.\r\n * @method getPowInOut\r\n * @param {Number} pow The exponent to use (ex. 3 would return a cubic ease).\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getPowInOut = function(pow) {\r\n  return function(t) {\r\n    if ((t*=2)<1) return 0.5*Math.pow(t,pow);\r\n    return 1-0.5*Math.abs(Math.pow(2-t,pow));\r\n  };\r\n};\r\n\r\n/**\r\n * @method quadIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quadIn = Ease.getPowIn(2);\r\n/**\r\n * @method quadOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quadOut = Ease.getPowOut(2);\r\n/**\r\n * @method quadInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quadInOut = Ease.getPowInOut(2);\r\n\r\n/**\r\n * @method cubicIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.cubicIn = Ease.getPowIn(3);\r\n/**\r\n * @method cubicOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.cubicOut = Ease.getPowOut(3);\r\n/**\r\n * @method cubicInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.cubicInOut = Ease.getPowInOut(3);\r\n\r\n/**\r\n * @method quartIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quartIn = Ease.getPowIn(4);\r\n/**\r\n * @method quartOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quartOut = Ease.getPowOut(4);\r\n/**\r\n * @method quartInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quartInOut = Ease.getPowInOut(4);\r\n\r\n/**\r\n * @method quintIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quintIn = Ease.getPowIn(5);\r\n/**\r\n * @method quintOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quintOut = Ease.getPowOut(5);\r\n/**\r\n * @method quintInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quintInOut = Ease.getPowInOut(5);\r\n\r\n/**\r\n * @method sineIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.sineIn = function(t) {\r\n  return 1-Math.cos(t*Math.PI/2);\r\n};\r\n\r\n/**\r\n * @method sineOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.sineOut = function(t) {\r\n  return Math.sin(t*Math.PI/2);\r\n};\r\n\r\n/**\r\n * @method sineInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.sineInOut = function(t) {\r\n  return -0.5*(Math.cos(Math.PI*t) - 1);\r\n};\r\n\r\n/**\r\n * Configurable \"back in\" ease.\r\n * @method getBackIn\r\n * @param {Number} amount The strength of the ease.\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getBackIn = function(amount) {\r\n  return function(t) {\r\n    return t*t*((amount+1)*t-amount);\r\n  };\r\n};\r\n/**\r\n * @method backIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.backIn = Ease.getBackIn(1.7);\r\n\r\n/**\r\n * Configurable \"back out\" ease.\r\n * @method getBackOut\r\n * @param {Number} amount The strength of the ease.\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getBackOut = function(amount) {\r\n  return function(t) {\r\n    return (--t*t*((amount+1)*t + amount) + 1);\r\n  };\r\n};\r\n/**\r\n * @method backOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.backOut = Ease.getBackOut(1.7);\r\n\r\n/**\r\n * Configurable \"back in out\" ease.\r\n * @method getBackInOut\r\n * @param {Number} amount The strength of the ease.\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getBackInOut = function(amount) {\r\n  amount*=1.525;\r\n  return function(t) {\r\n    if ((t*=2)<1) return 0.5*(t*t*((amount+1)*t-amount));\r\n    return 0.5*((t-=2)*t*((amount+1)*t+amount)+2);\r\n  };\r\n};\r\n/**\r\n * @method backInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.backInOut = Ease.getBackInOut(1.7);\r\n\r\n/**\r\n * @method circIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.circIn = function(t) {\r\n  return -(Math.sqrt(1-t*t)- 1);\r\n};\r\n\r\n/**\r\n * @method circOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.circOut = function(t) {\r\n  return Math.sqrt(1-(--t)*t);\r\n};\r\n\r\n/**\r\n * @method circInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.circInOut = function(t) {\r\n  if ((t*=2) < 1) return -0.5*(Math.sqrt(1-t*t)-1);\r\n  return 0.5*(Math.sqrt(1-(t-=2)*t)+1);\r\n};\r\n\r\n/**\r\n * @method bounceIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.bounceIn = function(t) {\r\n  return 1-Ease.bounceOut(1-t);\r\n};\r\n\r\n/**\r\n * @method bounceOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.bounceOut = function(t) {\r\n  if (t < 1/2.75) {\r\n    return (7.5625*t*t);\r\n  } else if (t < 2/2.75) {\r\n    return (7.5625*(t-=1.5/2.75)*t+0.75);\r\n  } else if (t < 2.5/2.75) {\r\n    return (7.5625*(t-=2.25/2.75)*t+0.9375);\r\n  } else {\r\n    return (7.5625*(t-=2.625/2.75)*t +0.984375);\r\n  }\r\n};\r\n\r\n/**\r\n * @method bounceInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.bounceInOut = function(t) {\r\n  if (t<0.5) return Ease.bounceIn (t*2) * .5;\r\n  return Ease.bounceOut(t*2-1)*0.5+0.5;\r\n};\r\n\r\n/**\r\n * Configurable elastic ease.\r\n * @method getElasticIn\r\n * @param {Number} amplitude\r\n * @param {Number} period\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getElasticIn = function(amplitude,period) {\r\n  var pi2 = Math.PI*2;\r\n  return function(t) {\r\n    if (t==0 || t==1) return t;\r\n    var s = period/pi2*Math.asin(1/amplitude);\r\n    return -(amplitude*Math.pow(2,10*(t-=1))*Math.sin((t-s)*pi2/period));\r\n  };\r\n};\r\n/**\r\n * @method elasticIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.elasticIn = Ease.getElasticIn(1,0.3);\r\n\r\n/**\r\n * Configurable elastic ease.\r\n * @method getElasticOut\r\n * @param {Number} amplitude\r\n * @param {Number} period\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getElasticOut = function(amplitude,period) {\r\n  var pi2 = Math.PI*2;\r\n  return function(t) {\r\n    if (t==0 || t==1) return t;\r\n    var s = period/pi2 * Math.asin(1/amplitude);\r\n    return (amplitude*Math.pow(2,-10*t)*Math.sin((t-s)*pi2/period )+1);\r\n  };\r\n};\r\n/**\r\n * @method elasticOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.elasticOut = Ease.getElasticOut(1,0.3);\r\n\r\n/**\r\n * Configurable elastic ease.\r\n * @method getElasticInOut\r\n * @param {Number} amplitude\r\n * @param {Number} period\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getElasticInOut = function(amplitude,period) {\r\n  var pi2 = Math.PI*2;\r\n  return function(t) {\r\n    var s = period/pi2 * Math.asin(1/amplitude);\r\n    if ((t*=2)<1) return -0.5*(amplitude*Math.pow(2,10*(t-=1))*Math.sin( (t-s)*pi2/period ));\r\n    return amplitude*Math.pow(2,-10*(t-=1))*Math.sin((t-s)*pi2/period)*0.5+1;\r\n  };\r\n};\r\n/**\r\n * @method elasticInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.elasticInOut = Ease.getElasticInOut(1,0.3*1.5);\r\n","import nstructjs from \"../util/struct.js\";\r\nimport {CurveConstructors, CurveTypeData} from \"./curve1d_base.js\";\r\nimport Ease from './ease.js';\r\nimport * as util from '../util/util.js';\r\n\r\nfunction bez3(a, b, c, t) {\r\n  var r1 = a + (b - a)*t;\r\n  var r2 = b + (c - b)*t;\r\n\r\n  return r1 + (r2 - r1)*t;\r\n}\r\n\r\nfunction bez4(a, b, c, d, t) {\r\n  var r1 = bez3(a, b, c, t);\r\n  var r2 = bez3(b, c, d, t);\r\n\r\n  return r1 + (r2 - r1)*t;\r\n}\r\n\r\nexport class ParamKey {\r\n  constructor(key, val) {\r\n    this.key = key;\r\n    this.val = val;\r\n  }\r\n}\r\n\r\nParamKey.STRUCT = `\r\nParamKey {\r\n  key : string;\r\n  val : float;\r\n}\r\n`\r\nnstructjs.register(ParamKey);\r\nlet BOOL_FLAG = 1e17;\r\n\r\nlet _udigest = new util.HashDigest();\r\n\r\nexport class SimpleCurveBase extends CurveTypeData {\r\n  constructor() {\r\n    super();\r\n\r\n    this.type = this.constructor.name;\r\n\r\n    let def = this.constructor.define();\r\n    let params = def.params;\r\n\r\n    this.params = {};\r\n    for (let k in params) {\r\n      this.params[k] = params[k][1];\r\n    }\r\n  }\r\n\r\n  get hasGUI() {\r\n    return true;\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    let d = digest;\r\n    super.calcHashKey(d);\r\n\r\n    for (let k in this.params) {\r\n      digest.add(k);\r\n      digest.add(this.params[k]);\r\n    }\r\n\r\n    return d.get();\r\n  }\r\n\r\n  equals(b) {\r\n    if (this.type !== b.type) {\r\n      return false;\r\n    }\r\n\r\n    for (let k in this.params) {\r\n      if (Math.abs(this.params[k] - b.params[k]) > 0.000001) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  redraw() {\r\n    if (this.parent)\r\n      this.parent.redraw();\r\n  }\r\n\r\n  makeGUI(container) {\r\n    let def = this.constructor.define();\r\n    let params = def.params;\r\n\r\n    for (let k in params) {\r\n      let p = params[k];\r\n\r\n      if (p[2] === BOOL_FLAG) {\r\n        let check = container.check(undefined, p[0]);\r\n        check.checked = !!this.params[k];\r\n        check.key = k;\r\n\r\n        let this2 = this;\r\n        check.onchange = function () {\r\n          this2.params[this.key] = this.checked ? 1 : 0;\r\n          this2.update();\r\n          this2.redraw();\r\n        }\r\n      } else {\r\n        let slider = container.slider(undefined, {\r\n          name      : p[0],\r\n          defaultval: this.params[k],\r\n          min       : p[2],\r\n          max       : p[3]\r\n        })\r\n        slider.baseUnit = slider.displayUnit = \"none\";\r\n\r\n        slider.key = k;\r\n\r\n        let this2 = this;\r\n        slider.onchange = function () {\r\n          this2.params[this.key] = this.value;\r\n          this2.update();\r\n          this2.redraw();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  killGUI(container) {\r\n    container.clear();\r\n  }\r\n\r\n  evaluate(s) {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  reset() {\r\n\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  draw(canvas, g, draw_transform) {\r\n    let steps = 128;\r\n    let s = 0, ds = 1.0/(steps - 1);\r\n\r\n    g.beginPath();\r\n    for (let i = 0; i < steps; i++, s += ds) {\r\n      let co = this.evaluate(s);\r\n\r\n      if (i) {\r\n        g.lineTo(co[0], co[1]);\r\n      } else {\r\n        g.moveTo(co[0], co[1]);\r\n      }\r\n    }\r\n\r\n    g.stroke();\r\n  }\r\n\r\n  _saveParams() {\r\n    let ret = [];\r\n    for (let k in this.params) {\r\n      ret.push(new ParamKey(k, this.params[k]));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  toJSON() {\r\n    return Object.assign(super.toJSON(), {\r\n      params: this.params\r\n    });\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    for (let k in obj.params) {\r\n      this.params[k] = obj.params[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n\r\n    let ps = this.params;\r\n    this.params = {};\r\n\r\n    let pdef = this.constructor.define().params;\r\n    if (!pdef) {\r\n      console.warn(\"Missing define function for curve\", this.constructor.name)\r\n      return;\r\n    }\r\n\r\n    for (let pair of ps) {\r\n      if (pair.key in pdef) {\r\n        this.params[pair.key] = pair.val;\r\n      }\r\n    }\r\n\r\n    for (let k in pdef) {\r\n      if (!(k in this.params)) {\r\n        this.params[k] = pdef[k][1];\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nSimpleCurveBase.STRUCT = nstructjs.inherit(SimpleCurveBase, CurveTypeData) + `\r\n  params : array(ParamKey) | obj._saveParams();\r\n}\r\n`;\r\nnstructjs.register(SimpleCurveBase);\r\n\r\nexport class BounceCurve extends SimpleCurveBase {\r\n  static define() {\r\n    return {\r\n      params  : {\r\n        decay : [\"Decay\", 1.0, 0.1, 5.0],\r\n        scale : [\"Scale\", 1.0, 0.01, 10.0],\r\n        freq  : [\"Freq\", 1.0, 0.01, 50.0],\r\n        phase : [\"Phase\", 0.0, -Math.PI*2.0, Math.PI*2.0],\r\n        offset: [\"Offset\", 0.0, -2.0, 2.0]\r\n      },\r\n      name    : \"bounce\",\r\n      uiname  : \"Bounce\",\r\n      typeName: \"BounceCurve\"\r\n\r\n    }\r\n  }\r\n\r\n  _evaluate(t) {\r\n    let params = this.params;\r\n    let decay = params.decay + 1.0;\r\n    let scale = params.scale;\r\n    let freq = params.freq;\r\n    let phase = params.phase;\r\n    let offset = params.offset;\r\n\r\n    t *= freq;\r\n    let t2 = Math.abs(Math.cos(phase + t*Math.PI*2.0))*scale;\r\n    ;//+ (1.0-scale);\r\n\r\n    t2 *= Math.exp(decay*t)/Math.exp(decay);\r\n\r\n    return t2;\r\n  }\r\n\r\n  evaluate(t) {\r\n    let s = this._evaluate(0.0);\r\n    let e = this._evaluate(1.0);\r\n\r\n    return (this._evaluate(t) - s)/(e - s) + this.params.offset;\r\n  }\r\n}\r\n\r\nCurveTypeData.register(BounceCurve);\r\nBounceCurve.STRUCT = nstructjs.inherit(BounceCurve, SimpleCurveBase) + `\r\n}`;\r\nnstructjs.register(BounceCurve);\r\n\r\n\r\nexport class ElasticCurve extends SimpleCurveBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._func = undefined;\r\n    this._last_hash = undefined;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      params  : {\r\n        mode     : [\"Out Mode\", false, BOOL_FLAG, BOOL_FLAG],\r\n        amplitude: [\"Amplitude\", 1.0, 0.01, 10.0],\r\n        period   : [\"Period\", 1.0, 0.01, 5.0]\r\n      },\r\n      name    : \"elastic\",\r\n      uiname  : \"Elastic\",\r\n      typeName: \"ElasticCurve\",\r\n    }\r\n  }\r\n\r\n  evaluate(t) {\r\n    let hash = ~~(this.params.mode*127 + this.params.amplitude*256 + this.params.period*512);\r\n\r\n    if (hash !== this._last_hash || !this._func) {\r\n      this._last_hash = hash;\r\n\r\n      if (this.params.mode) {\r\n        this._func = Ease.getElasticOut(this.params.amplitude, this.params.period);\r\n      } else {\r\n        this._func = Ease.getElasticIn(this.params.amplitude, this.params.period);\r\n      }\r\n    }\r\n    return this._func(t);\r\n  }\r\n}\r\n\r\nCurveTypeData.register(ElasticCurve);\r\nElasticCurve.STRUCT = nstructjs.inherit(ElasticCurve, SimpleCurveBase) + `\r\n}`;\r\nnstructjs.register(ElasticCurve);\r\n\r\n\r\nexport class EaseCurve extends SimpleCurveBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      params  : {\r\n        mode_in  : [\"in\", true, BOOL_FLAG, BOOL_FLAG],\r\n        mode_out : [\"out\", true, BOOL_FLAG, BOOL_FLAG],\r\n        amplitude: [\"Amplitude\", 1.0, 0.01, 4.0]\r\n      },\r\n      name    : \"ease\",\r\n      uiname  : \"Ease\",\r\n      typeName: \"EaseCurve\"\r\n    }\r\n  }\r\n\r\n  evaluate(t) {\r\n    let amp = this.params.amplitude;\r\n    let a1 = this.params.mode_in ? 1.0 - amp : 1.0/3.0;\r\n    let a2 = this.params.mode_out ? amp : 2.0/3.0;\r\n\r\n    return bez4(0.0, a1, a2, 1.0, t);\r\n  }\r\n}\r\n\r\nCurveTypeData.register(EaseCurve);\r\nEaseCurve.STRUCT = nstructjs.inherit(EaseCurve, SimpleCurveBase) + `\r\n}`;\r\nnstructjs.register(EaseCurve);\r\n\r\n\r\nexport class RandCurve extends SimpleCurveBase {\r\n  constructor() {\r\n    super();\r\n    this.random = new util.MersenneRandom();\r\n    this.seed = 0;\r\n  }\r\n\r\n  get seed() {\r\n    return this._seed;\r\n  }\r\n\r\n  set seed(v) {\r\n    this.random.seed(v);\r\n    this._seed = v;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      params  : {\r\n        amplitude: [\"Amplitude\", 1.0, 0.01, 4.0],\r\n        decay    : [\"Decay\", 1.0, 0.0, 5.0],\r\n        in_mode  : [\"In\", true, BOOL_FLAG, BOOL_FLAG]\r\n      },\r\n      name    : \"random\",\r\n      uiname  : \"Random\",\r\n      typeName: \"RandCurve\"\r\n    }\r\n  }\r\n\r\n  evaluate(t) {\r\n    let r = this.random.random();\r\n    let decay = this.params.decay + 1.0;\r\n    let amp = this.params.amplitude;\r\n    let in_mode = this.params.in_mode;\r\n\r\n    if (in_mode) {\r\n      t = 1.0 - t;\r\n    }\r\n    //r *= t;\r\n\r\n    let d;\r\n\r\n    //r *= 0.5;\r\n\r\n    if (in_mode) {\r\n      d = Math.exp(t*decay)/Math.exp(decay);\r\n    } else {\r\n      d = Math.exp(t*decay)/Math.exp(decay);\r\n    }\r\n\r\n    t = t + (r - t)*d;\r\n\r\n    if (in_mode) {\r\n      t = 1.0 - t;\r\n    }\r\n\r\n    return t;\r\n  }\r\n}\r\n\r\nCurveTypeData.register(RandCurve);\r\nRandCurve.STRUCT = nstructjs.inherit(RandCurve, SimpleCurveBase) + `\r\n}`;\r\nnstructjs.register(RandCurve);\r\n\r\n\r\n","import {Curve1D} from './curve1d.js';\r\nimport {ToolProperty, PropTypes, PropFlags} from '../toolsys/toolprop.js';\r\nimport * as nstructjs from '../util/nstructjs_es6.js';\r\n\r\nimport './curve1d_all.js';\r\n\r\nexport class Curve1DProperty extends ToolProperty {\r\n  constructor(curve, apiname, uiname, description, flag, icon) {\r\n    super(PropTypes.CURVE, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.data = new Curve1D();\r\n\r\n    if (curve !== undefined) {\r\n      this.setValue(curve);\r\n    }\r\n\r\n    this.wasSet = false;\r\n  }\r\n\r\n  calcMemSize() {\r\n    //bleh, just return a largish block size\r\n    return 1024;\r\n  }\r\n\r\n  equals(b) {\r\n\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  evaluate(t) {\r\n    return this.data.evaluate(t);\r\n  }\r\n\r\n  setValue(curve) {\r\n    if (curve === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.data.load(curve);\r\n    super.setValue(curve);\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n\r\n    b.setValue(this.data);\r\n  }\r\n}\r\n\r\nCurve1DProperty.STRUCT = nstructjs.inherit(Curve1DProperty, ToolProperty) + `\r\n  data : Curve1D;\r\n}\r\n`;\r\n\r\nnstructjs.register(Curve1DProperty);\r\nToolProperty.internalRegister(Curve1DProperty);\r\n\r\n","/**\r\n\r\n This is the main datapath controller module, inspired by Blender's RNA system.\r\n\r\n Datapaths are special bindings for objects; they store types (e.g. float, int, enumeration, string),\r\n as well as lots of UI-specific metadata (like human-readable names, tooltips, icons, numeric ranges, etc).\r\n\r\n Controller bindings are intended to present a more unified and coherent model of the\r\n application model than may actually exists.  This is inspired by Blender's RNA system, which\r\n hides almost all of Blender's core data structure complexity (Blender is written in C) from\r\n users who e.g. write python scripts, extend the UI, use advanced animation features, or anything else\r\n that uses RNA paths.\r\n\r\n ## Contexts\r\n\r\n The datapath system works in tandem with the context module.  Contexts are client-provided classes\r\n that the datapath API and ToolOps use to communicate with the application state.\r\n\r\n ## Example\r\n\r\n <pre>\r\n\r\n function initMyDataAPI() {\r\n let api = new DataAPI();\r\n\r\n //map MyContextClass to a struct, true tells mapStruct to auto-create\r\n //the struct if it doesn't already exist.\r\n //\r\n //MyContextClass should have a member \"propCache\" pointing at SavedToolDefaults.\r\n let st = api.mapStruct(MyContextClass, true);\r\n\r\n //set fields of struct, e.g. st.int, st.float, st.enum, st.struct, etc\r\n\r\n //build toolsys api\r\n buildToolSysAPI(api);\r\n\r\n //create bindings for default tool operator settings\r\n cstruct.struct(\"propCache\", \"toolDefaults\", \"Tool Defaults\", api.mapStruct(ToolPropertyCache));\r\n\r\n return api;\r\n }\r\n </pre>\r\n */\r\nimport * as toolprop from \"../toolsys/toolprop.js\";\r\nimport * as parseutil from \"../util/parseutil.js\";\r\nimport { print_stack } from \"../util/util.js\";\r\nimport { ToolOp } from \"../toolsys/toolsys.js\";\r\nimport { PropTypes, PropFlags } from \"../toolsys/toolprop.js\";\r\nimport * as util from \"../util/util.js\";\r\n\r\nimport { DataPath, DataFlags, DataTypes, DataPathError, getTempProp } from \"./controller_base.js\";\r\n\r\nexport * from \"./controller_base.js\";\r\n\r\nlet PUTLParseError = parseutil.PUTLParseError;\r\n\r\nlet tk = (name, re, func) => new parseutil.tokdef(name, re, func);\r\nlet tokens = [\r\n  tk(\"ID\", /[a-zA-Z_$]+[a-zA-Z_$0-9]*/),\r\n  tk(\"NUM\", /-?[0-9]+/, (t) => {\r\n    t.value = parseInt(t.value);\r\n    return t;\r\n  }),\r\n  tk(\"NUMBER\", /-?[0-9]+\\.[0-9]*/, (t) => {\r\n    t.value = parseFloat(t.value);\r\n    return t;\r\n  }),\r\n  tk(\"STRLIT\", /'.*?'/, (t) => {\r\n    t.value = t.value.slice(1, t.value.length - 1);\r\n    return t;\r\n  }),\r\n  tk(\"STRLIT\", /\".*?\"/, (t) => {\r\n    t.value = t.value.slice(1, t.value.length - 1);\r\n    return t;\r\n  }),\r\n  tk(\"DOT\", /\\./),\r\n  tk(\"EQUALS\", /(\\=)|(\\=\\=)/),\r\n  tk(\"LSBRACKET\", /\\[/),\r\n  tk(\"RSBRACKET\", /\\]/),\r\n  tk(\"AND\", /\\&/),\r\n  tk(\"WS\", /[ \\t\\n\\r]+/, (t) => undefined), //drop token\r\n];\r\n\r\nlet lexer = new parseutil.lexer(tokens, (t) => {\r\n  console.warn(\"Parse error\", t);\r\n  throw new DataPathError();\r\n});\r\n\r\nexport let pathParser = new parseutil.parser(lexer);\r\n\r\nlet parserStack = new Array(32);\r\nfor (let i = 0; i < parserStack.length; i++) {\r\n  parserStack[i] = pathParser.copy();\r\n}\r\nparserStack.cur = 0;\r\n\r\nimport { setImplementationClass, isVecProperty, ListIface } from \"./controller_base.js\";\r\nimport { initToolPaths, parseToolPath } from \"../toolsys/toolpath.js\";\r\nimport { ModelInterface } from \"./controller_abstract.js\";\r\n\r\nexport { DataPathError, DataFlags } from \"./controller_base.js\";\r\n\r\nimport { ToolClasses } from \"../toolsys/toolsys.js\";\r\nimport { ToolProperty, IntProperty } from \"../toolsys/toolprop.js\";\r\n\r\nlet tool_classes = ToolClasses;\r\n\r\nlet tool_idgen = 1;\r\nSymbol.ToolID = Symbol(\"toolid\");\r\n\r\nfunction toolkey(cls) {\r\n  if (!(Symbol.ToolID in cls)) {\r\n    cls[Symbol.ToolID] = tool_idgen++;\r\n  }\r\n\r\n  return cls[Symbol.ToolID];\r\n}\r\n\r\nlet lt = util.time_ms();\r\nlet lastmsg = undefined;\r\nlet lcount = 0;\r\n\r\nlet reportstack = [\"api\"];\r\n\r\nexport function pushReportName(name) {\r\n  if (reportstack.length > 1024) {\r\n    console.trace(\"eerk, reportstack overflowed\");\r\n    reportstack.length = 0;\r\n    reportstack.push(\"api\");\r\n  }\r\n\r\n  reportstack.push(name);\r\n}\r\n\r\nfunction report(msg) {\r\n  let name = reportstack.length === 0 ? \"api\" : reportstack[reportstack.length - 1];\r\n\r\n  util.console.context(name).warn(msg);\r\n}\r\n\r\nexport function popReportName() {\r\n  reportstack.pop();\r\n}\r\n\r\nexport class DataList extends ListIface {\r\n  constructor(callbacks) {\r\n    super();\r\n\r\n    if (callbacks === undefined) {\r\n      throw new DataPathError(\"missing callbacks argument to DataList\");\r\n    }\r\n\r\n    this.cb = {};\r\n\r\n    if (typeof callbacks === \"object\" && !Array.isArray(callbacks)) {\r\n      for (let k in callbacks) {\r\n        this.cb[k] = callbacks[k];\r\n      }\r\n    } else {\r\n      for (let cb of callbacks) {\r\n        this.cb[cb.name] = cb;\r\n      }\r\n    }\r\n\r\n    let check = (key) => {\r\n      if (!(key in this.cbs)) {\r\n        throw new DataPathError(`Missing ${key} callback in DataList`);\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   Generic list API.\r\n\r\n   * Callbacks is an array of name functions, like so:\r\n   - function getStruct(api, list, key) //return DataStruct type of object in key, key is optional if omitted return base type of all objects?\r\n   - function get(api, list, key)\r\n   - function set(api, list, key, val) //this one has default behavior: list[key] = val\r\n   - function getLength(api, list)\r\n   - function getActive(api, list)\r\n   - function setActive(api, list, key)\r\n   - function getIter(api, list)\r\n   - function getKey(api, list, object) returns object's key in this list, either a string or a number\r\n   * */\r\n\r\n  copy() {\r\n    let ret = new DataList([this.cb.get]);\r\n\r\n    for (let k in this.cb) {\r\n      ret.cb[k] = this.cb[k];\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  get(api, list, key) {\r\n    return this.cb.get(api, list, key);\r\n  }\r\n\r\n  getLength(api, list) {\r\n    this._check(\"getLength\");\r\n    return this.cb.getLength(api, list);\r\n  }\r\n\r\n  _check(cb) {\r\n    if (!(cb in this.cb)) {\r\n      throw new DataPathError(cb + \" not supported by this list\");\r\n    }\r\n  }\r\n\r\n  set(api, list, key, val) {\r\n    if (this.cb.set === undefined) {\r\n      list[key] = val;\r\n    } else {\r\n      this.cb.set(api, list, key, val);\r\n    }\r\n  }\r\n\r\n  getIter(api, list) {\r\n    this._check(\"getIter\");\r\n    return this.cb.getIter(api, list);\r\n  }\r\n\r\n  filter(api, list, bitmask) {\r\n    this._check(\"filter\");\r\n    return this.cb.filter(api, list, bitmask);\r\n  }\r\n\r\n  getActive(api, list) {\r\n    this._check(\"getActive\");\r\n    return this.cb.getActive(api, list);\r\n  }\r\n\r\n  setActive(api, list, key) {\r\n    this._check(\"setActive\");\r\n    this.cb.setActive(api, list, key);\r\n  }\r\n\r\n  getKey(api, list, obj) {\r\n    this._check(\"getKey\");\r\n    return this.cb.getKey(api, list, obj);\r\n  }\r\n\r\n  getStruct(api, list, key) {\r\n    if (this.cb.getStruct !== undefined) {\r\n      return this.cb.getStruct(api, list, key);\r\n    }\r\n\r\n    let obj = this.get(api, list, key);\r\n\r\n    if (obj === undefined) return undefined;\r\n\r\n    return api.getStruct(obj.constructor);\r\n  }\r\n}\r\n\r\nexport class DataStruct {\r\n  constructor(members = [], name = \"unnamed\") {\r\n    this.members = [];\r\n    this.name = name;\r\n    this.pathmap = {};\r\n    this.flag = 0;\r\n    this.dpath = undefined; //owning DataPath\r\n\r\n    this.inheritFlag = 0;\r\n\r\n    for (let m of members) {\r\n      this.add(m);\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this.pathmap = {};\r\n    this.members = [];\r\n\r\n    return this;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new DataStruct();\r\n\r\n    ret.name = this.name;\r\n    ret.flag = this.flag;\r\n    ret.inheritFlag = this.inheritFlag;\r\n\r\n    for (let m of this.members) {\r\n      let m2 = m.copy();\r\n\r\n      //don't copy struct or list references, just\r\n      //direct properties\r\n\r\n      if (m2.type === DataTypes.PROP) {\r\n        m2.data = m2.data.copy();\r\n      }\r\n\r\n      ret.add(m2);\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   * Like .struct, but the type of struct is looked up\r\n   * for objects at runtime.  Note that to work correctly each object\r\n   * must create its own struct definition via api.mapStruct\r\n   *\r\n   * @param path\r\n   * @param apiname\r\n   * @param uiname\r\n   * @param default_struct : default struct if one can't be looked up\r\n   * @returns {*}\r\n   */\r\n  dynamicStruct(path, apiname, uiname, default_struct = undefined) {\r\n    let ret = default_struct ? default_struct : new DataStruct();\r\n\r\n    let dpath = new DataPath(path, apiname, ret, DataTypes.DYNAMIC_STRUCT);\r\n    ret.inheritFlag |= this.inheritFlag;\r\n\r\n    ret.dpath = dpath;\r\n\r\n    this.add(dpath);\r\n    return ret;\r\n  }\r\n\r\n  struct(path, apiname, uiname, existing_struct = undefined) {\r\n    let ret = existing_struct ? existing_struct : new DataStruct();\r\n\r\n    let dpath = new DataPath(path, apiname, ret, DataTypes.STRUCT);\r\n    ret.inheritFlag |= this.inheritFlag;\r\n\r\n    ret.dpath = dpath;\r\n\r\n    this.add(dpath);\r\n    return ret;\r\n  }\r\n\r\n  customGet(getter) {\r\n    this.dpath.customGet(getter);\r\n\r\n    return this;\r\n  }\r\n\r\n  customGetSet(getter, setter) {\r\n    this.dpath.customGetSet(getter, setter);\r\n\r\n    return this;\r\n  }\r\n\r\n  color3(path, apiname, uiname, description) {\r\n    let ret = this.vec3(path, apiname, uiname, description);\r\n\r\n    ret.data.subtype = toolprop.PropSubTypes.COLOR;\r\n    ret.range(0, 1);\r\n    ret.simpleSlider();\r\n\r\n    ret.noUnits();\r\n\r\n    return ret;\r\n  }\r\n\r\n  color4(path, apiname, uiname, description = uiname) {\r\n    let ret = this.vec4(path, apiname, uiname, description);\r\n\r\n    ret.data.subtype = toolprop.PropSubTypes.COLOR;\r\n    ret.range(0, 1);\r\n    ret.simpleSlider();\r\n\r\n    ret.noUnits();\r\n\r\n    return ret;\r\n  }\r\n\r\n  arrayList(path, apiname, structdef, uiname, description) {\r\n    let ret = this.list(path, apiname, [\r\n      function getIter(api, list) {\r\n        return list[Symbol.iterator]();\r\n      },\r\n      function getLength(api, list) {\r\n        return list.length;\r\n      },\r\n      function get(api, list, key) {\r\n        return list[key];\r\n      },\r\n      function set(api, list, key, val) {\r\n        if (typeof key === \"string\") {\r\n          key = parseInt(key);\r\n        }\r\n\r\n        if (key < 0 || key >= list.length) {\r\n          throw new DataPathError(\"Invalid index \" + key);\r\n        }\r\n\r\n        list[key] = val;\r\n      },\r\n      function getKey(api, list, obj) {\r\n        return list.indexOf(obj);\r\n      },\r\n      function getStruct(api, list, key) {\r\n        return structdef;\r\n      },\r\n    ]);\r\n\r\n    return ret;\r\n  }\r\n\r\n  color3List(path, apiname, uiname, description) {\r\n    return this.vectorList(3, path, apiname, uiname, description, toolprop.PropSubTypes.COLOR);\r\n  }\r\n\r\n  color4List(path, apiname, uiname, description) {\r\n    return this.vectorList(4, path, apiname, uiname, description, toolprop.PropSubTypes.COLOR);\r\n  }\r\n\r\n  vectorList(size, path, apiname, uiname, description, subtype) {\r\n    let type;\r\n\r\n    switch (size) {\r\n      case 2:\r\n        type = toolprop.Vec2Property;\r\n        break;\r\n      case 3:\r\n        type = toolprop.Vec3Property;\r\n      case 4:\r\n        type = toolprop.Vec4Property;\r\n    }\r\n\r\n    if (type === undefined) {\r\n      throw new DataPathError(\"Invalid size for vectorList; expected 2 3 or 4\");\r\n    }\r\n\r\n    let prop = new type(undefined, apiname, uiname, description);\r\n\r\n    let pstruct = new DataStruct(undefined, \"Vector\");\r\n    pstruct.vec3(\"\", \"co\", \"Coords\", \"Coordinates\");\r\n\r\n    let ret = this.list(path, apiname, [\r\n      function getIter(api, list) {\r\n        return list[Symbol.iterator]();\r\n      },\r\n      function getLength(api, list) {\r\n        return list.length;\r\n      },\r\n      function get(api, list, key) {\r\n        return list[key];\r\n      },\r\n      function set(api, list, key, val) {\r\n        if (typeof key == \"string\") {\r\n          key = parseInt(key);\r\n        }\r\n\r\n        if (key < 0 || key >= list.length) {\r\n          throw new DataPathError(\"Invalid index \" + key);\r\n        }\r\n\r\n        list[key] = val;\r\n      },\r\n      function getKey(api, list, obj) {\r\n        return list.indexOf(obj);\r\n      },\r\n      function getStruct(api, list, key) {\r\n        return pstruct;\r\n      },\r\n    ]);\r\n\r\n    return ret;\r\n  }\r\n\r\n  bool(path, apiname, uiname, description) {\r\n    let prop = new toolprop.BoolProperty(undefined, apiname, uiname, description);\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  vec2(path, apiname, uiname, description) {\r\n    let prop = new toolprop.Vec2Property(undefined, apiname, uiname, description);\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  vec3(path, apiname, uiname, description) {\r\n    let prop = new toolprop.Vec3Property(undefined, apiname, uiname, description);\r\n    //prop.uiname = uiname;\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  vec4(path, apiname, uiname, description) {\r\n    let prop = new toolprop.Vec4Property(undefined, apiname, uiname, description);\r\n    //prop.uiname = uiname;\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  float(path, apiname, uiname, description) {\r\n    let prop = new toolprop.FloatProperty(0, apiname, uiname, description);\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  textblock(path, apiname, uiname, description) {\r\n    let prop = new toolprop.StringProperty(undefined, apiname, uiname, description);\r\n    prop.multiLine = true;\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  report(path, apiname, uiname, description) {\r\n    let prop = new toolprop.ReportProperty(undefined, apiname, uiname, description);\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  string(path, apiname, uiname, description) {\r\n    let prop = new toolprop.StringProperty(undefined, apiname, uiname, description);\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  int(path, apiname, uiname, description, prop = undefined) {\r\n    if (!prop) {\r\n      prop = new toolprop.IntProperty(0, apiname, uiname, description);\r\n    }\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  curve1d(path, apiname, uiname, description) {\r\n    let prop = new Curve1DProperty(undefined);\r\n\r\n    prop.apiname = apiname;\r\n    prop.uiname = uiname;\r\n    prop.description = description;\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  enum(path, apiname, enumdef, uiname, description) {\r\n    let prop;\r\n\r\n    if (enumdef instanceof toolprop.EnumProperty) {\r\n      prop = enumdef;\r\n    } else {\r\n      prop = new toolprop.EnumProperty(undefined, enumdef, apiname, uiname, description);\r\n    }\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  list(path, apiname, funcs) {\r\n    let array = new DataList(funcs);\r\n\r\n    let dpath = new DataPath(path, apiname, array);\r\n    dpath.type = DataTypes.ARRAY;\r\n\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  flags(path, apiname, enumdef, uiname, description) {\r\n    let prop;\r\n\r\n    if (enumdef === undefined || !(enumdef instanceof toolprop.ToolProperty)) {\r\n      prop = new toolprop.FlagProperty(undefined, enumdef, apiname, uiname, description);\r\n    } else {\r\n      prop = enumdef;\r\n    }\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  remove(m) {\r\n    if (typeof m === \"string\") {\r\n      m = this.pathmap[m];\r\n    }\r\n\r\n    if (!(m.apiname in this.pathmap)) {\r\n      throw new Error(\"Member not in struct \" + m.apiname);\r\n    }\r\n\r\n    delete this.pathmap[m.apiname];\r\n    this.members.remove(m);\r\n  }\r\n\r\n  fromToolProp(path, prop, apiname = prop.apiname.length > 0 ? prop.apiname : path) {\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  add(m) {\r\n    if (m.apiname in this.pathmap) {\r\n      if (window.DEBUG.datapaths) {\r\n        console.warn(\"Overriding existing member '\" + m.apiname + \"' in datapath struct\", this.name);\r\n      }\r\n\r\n      this.remove(this.pathmap[m.apiname]);\r\n    }\r\n\r\n    m.flag |= this.inheritFlag;\r\n\r\n    this.members.push(m);\r\n    m.parent = this;\r\n\r\n    this.pathmap[m.apiname] = m;\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nlet _map_struct_idgen = 1;\r\nlet _map_structs = {};\r\n\r\nwindow._debug__map_structs = _map_structs; //global for debugging purposes only\r\n\r\nlet _dummypath = new DataPath();\r\n\r\nlet DummyIntProperty = new IntProperty();\r\nconst CLS_API_KEY = Symbol(\"dp_map_id\");\r\nconst CLS_API_KEY_CUSTOM = Symbol(\"dp_map_custom\");\r\n\r\nexport class DataAPI extends ModelInterface {\r\n  constructor() {\r\n    super();\r\n\r\n    this.rootContextStruct = undefined;\r\n    this.structs = [];\r\n  }\r\n\r\n  get list() {\r\n    return undefined;\r\n  }\r\n\r\n  static toolRegistered(cls) {\r\n    return ToolOp.isRegistered(cls);\r\n    //let key = toolkey(cls);\r\n    //return key in tool_classes;\r\n  }\r\n\r\n  static registerTool(cls) {\r\n    console.warn(\"Outdated function simple_controller.DataAPI.registerTool called\");\r\n\r\n    return ToolOp.register(cls);\r\n\r\n    //let key = toolkey(cls);\r\n    //\r\n    //if (!(key in tool_classes)) {\r\n    //  tool_classes[key] = cls;\r\n    //}\r\n  }\r\n\r\n  getStructs() {\r\n    return this.structs;\r\n  }\r\n\r\n  setRoot(sdef) {\r\n    this.rootContextStruct = sdef;\r\n  }\r\n\r\n  hasStruct(cls) {\r\n    return cls.hasOwnProperty(CLS_API_KEY);\r\n  }\r\n\r\n  getStruct(cls) {\r\n    return this.mapStruct(cls, false);\r\n  }\r\n\r\n  mergeStructs(dest, src) {\r\n    for (let m of src.members) {\r\n      dest.add(m.copy());\r\n    }\r\n  }\r\n\r\n  inheritStruct(cls, parent, auto_create_parent = false) {\r\n    let st = this.mapStruct(parent, auto_create_parent);\r\n\r\n    if (st === undefined) {\r\n      throw new Error(\"parent has no struct definition\");\r\n    }\r\n\r\n    st = st.copy();\r\n    st.name = cls.name;\r\n\r\n    this._addClass(cls, st);\r\n    return st;\r\n  }\r\n\r\n  /**\r\n   * Look up struct definition for a class.\r\n   *\r\n   * @param cls: the class\r\n   * @param auto_create: If true, automatically create definition if not already existing.\r\n   * @returns {IterableIterator<*>}\r\n   */\r\n\r\n  _addClass(cls, dstruct) {\r\n    let key = _map_struct_idgen++;\r\n    cls[CLS_API_KEY] = key;\r\n\r\n    this.structs.push(dstruct);\r\n\r\n    _map_structs[key] = dstruct;\r\n  }\r\n\r\n  /* Associate cls with a DataStruct\r\n   * via callback, which will be called\r\n   * with an instance of cls as its argument*/\r\n  mapStructCustom(cls, callback) {\r\n    this.mapStruct(cls, true);\r\n    cls[CLS_API_KEY_CUSTOM] = callback;\r\n  }\r\n\r\n  mapStruct(cls, auto_create = true, name = cls.name) {\r\n    let key;\r\n\r\n    if (!cls.hasOwnProperty(CLS_API_KEY)) {\r\n      key = undefined;\r\n    } else {\r\n      key = cls[CLS_API_KEY];\r\n    }\r\n\r\n    if (key === undefined && auto_create) {\r\n      let dstruct = new DataStruct(undefined, name);\r\n      this._addClass(cls, dstruct);\r\n      return dstruct;\r\n    } else if (key === undefined) {\r\n      throw new Error(\"class does not have a struct definition: \" + name);\r\n    }\r\n\r\n    return _map_structs[key];\r\n  }\r\n\r\n  //used for tagging error messages\r\n  pushReportContext(name) {\r\n    pushReportName(name);\r\n  }\r\n\r\n  //used for tagging error messages\r\n  popReportContext() {\r\n    popReportName();\r\n  }\r\n\r\n  /*\r\n  massSetProp operate on lists.  The idea is to\r\n  write a filter str inside a data path, e.g.\r\n\r\n  ctx.api.massSetProp(ctx, \"obj.list[{$.select}].value\", 1);\r\n\r\n\r\n  * */\r\n  massSetProp(ctx, massSetPath, value) {\r\n    for (let path of this.resolveMassSetPaths(ctx, massSetPath)) {\r\n      this.setValue(ctx, path, value);\r\n    }\r\n  }\r\n\r\n  resolveMassSetPaths(ctx, massSetPath) {\r\n    if (massSetPath.startsWith(\"/\")) {\r\n      massSetPath = massSetPath.slice(1, massSetPath.length);\r\n    }\r\n\r\n    let start = massSetPath.search(\"{\");\r\n    let end = massSetPath.search(\"}\");\r\n\r\n    if (start < 0 || end < 0) {\r\n      throw new DataPathError(\"Invalid mass set datapath: \" + massSetPath);\r\n      return;\r\n    }\r\n\r\n    let prefix = massSetPath.slice(0, start - 1);\r\n    let filter = massSetPath.slice(start + 1, end);\r\n    let suffix = massSetPath.slice(end + 2, massSetPath.length);\r\n\r\n    let rdef = this.resolvePath(ctx, prefix);\r\n\r\n    if (!(rdef.prop instanceof DataList)) {\r\n      throw new DataPathError(\"massSetPath expected a path resolving to a DataList: \" + massSetPath);\r\n    }\r\n\r\n    let paths = [];\r\n\r\n    let list = rdef.prop;\r\n    let api = ctx.api;\r\n\r\n    function applyFilter(obj) {\r\n      const forceEval = rdef.dpath.flag & DataFlags.USE_EVAL_MASS_SET_PATHS;\r\n\r\n      if (obj === undefined) {\r\n        return undefined;\r\n      } else if (!forceEval && (typeof obj === \"object\" || typeof obj === \"function\")) {\r\n        let st = api.mapStruct(obj.constructor, false);\r\n\r\n        let path = filter;\r\n        if (path.startsWith(\"$\")) {\r\n          path = path.slice(1, filter.length).trim();\r\n        }\r\n        if (path.startsWith(\".\")) {\r\n          path = path.slice(1, filter.length).trim();\r\n        }\r\n\r\n        try {\r\n          return api.getValue(obj, path, st);\r\n        } catch (error) {\r\n          if (!(error instanceof DataPathError)) {\r\n            util.print_stack(error);\r\n            console.error(\"Error in datapath callback\");\r\n          }\r\n\r\n          return false;\r\n        }\r\n      } else {\r\n        let $ = obj;\r\n        return eval(filter);\r\n      }\r\n    }\r\n\r\n    for (let obj of list.getIter(this, rdef.value)) {\r\n      if (!applyFilter(obj)) {\r\n        continue;\r\n      }\r\n\r\n      let key = \"\" + list.getKey(this, rdef.value, obj);\r\n      let path = `${prefix}[${key}]${suffix}`;\r\n\r\n      /* validate the final path */\r\n      try {\r\n        this.getValue(ctx, path);\r\n      } catch (error) {\r\n        if (!(error instanceof DataPathError)) {\r\n          util.print_stack(error);\r\n          console.error(path + \": Error in datapath API\");\r\n        }\r\n\r\n        continue;\r\n      }\r\n\r\n      paths.push(path);\r\n    }\r\n\r\n    return paths;\r\n  }\r\n\r\n  resolvePath(ctx, inpath, ignoreExistence = false, dstruct = undefined) {\r\n    let parser = parserStack[parserStack.cur++];\r\n    let ret = undefined;\r\n\r\n    if (inpath[0] === \"/\") {\r\n      inpath = inpath.slice(1, inpath.length).trim();\r\n    }\r\n\r\n    try {\r\n      ret = this.resolvePath_intern(ctx, inpath, ignoreExistence, parser, dstruct);\r\n    } catch (error) {\r\n      //throw new DataPathError(\"bad path \" + path);\r\n      if (!(error instanceof DataPathError)) {\r\n        util.print_stack(error);\r\n        report(\"error while evaluating path \" + inpath);\r\n      }\r\n\r\n      if (window.DEBUG && window.DEBUG.datapaths) {\r\n        util.print_stack(error);\r\n      }\r\n\r\n      ret = undefined;\r\n    }\r\n\r\n    parserStack.cur--;\r\n\r\n    if (ret !== undefined && ret.prop && ret.dpath && ret.dpath.flag & DataFlags.USE_CUSTOM_PROP_GETTER) {\r\n      ret.prop = this.getPropOverride(ctx, inpath, ret.dpath, ret.obj);\r\n    }\r\n\r\n    if (ret !== undefined && ret.prop && ret.dpath && ret.dpath.ui_name_get) {\r\n      let dummy = {\r\n        datactx : ctx,\r\n        datapath: inpath,\r\n        dataref : ret.obj,\r\n      };\r\n\r\n      let name = ret.dpath.ui_name_get.call(dummy);\r\n\r\n      ret.prop.uiname = \"\" + name;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  getPropOverride(ctx, path, dpath, obj, prop = dpath.data) {\r\n    prop.ctx = ctx;\r\n    prop.datapath = path;\r\n    prop.dataref = obj;\r\n\r\n    let newprop = getTempProp(prop.type);\r\n    prop.copyTo(newprop);\r\n\r\n    dpath.propGetter.call(prop, newprop);\r\n    prop.ctx = prop.datapath = prop.dataref = undefined;\r\n\r\n    return newprop;\r\n  }\r\n\r\n  /**\r\n   get meta information for a datapath.\r\n\r\n   @param ignoreExistence: don't try to get actual data associated with path,\r\n    just want meta information\r\n   */\r\n  resolvePath_intern(ctx, inpath, ignoreExistence = false, p = pathParser, dstruct = undefined) {\r\n    inpath = inpath.replace(\"==\", \"=\");\r\n\r\n    p.input(inpath);\r\n\r\n    dstruct = dstruct || this.rootContextStruct;\r\n\r\n    let obj = ctx;\r\n    let lastobj = ctx;\r\n    let subkey;\r\n    let lastobj2 = undefined;\r\n    let lastkey = undefined;\r\n    let prop = undefined;\r\n    let lastdpath = undefined;\r\n\r\n    function p_key() {\r\n      let t = p.peeknext();\r\n      if (t.type === \"NUM\" || t.type === \"STRLIT\") {\r\n        p.next();\r\n        return t.value;\r\n      } else {\r\n        throw new PUTLParseError(\"Expected list key\");\r\n      }\r\n    }\r\n\r\n    let _i = 0;\r\n    while (!p.at_end()) {\r\n      let key = p.expect(\"ID\");\r\n      let dpath = dstruct.pathmap[key];\r\n\r\n      lastdpath = dpath;\r\n\r\n      if (dpath === undefined) {\r\n        if (key === \"length\" && prop !== undefined && prop instanceof DataList) {\r\n          prop.getLength(this, obj);\r\n          key = \"length\";\r\n\r\n          prop = DummyIntProperty;\r\n\r\n          prop.name = \"length\";\r\n          prop.flag = PropFlags.READ_ONLY;\r\n\r\n          dpath = _dummypath;\r\n          dpath.type = DataTypes.PROP;\r\n          dpath.data = prop;\r\n          dpath.struct = dpath.parent = dstruct;\r\n          dpath.flag = DataFlags.READ_ONLY;\r\n          dpath.path = \"length\";\r\n\r\n          /*\r\n          parent: lastobj2,\r\n            obj: lastobj,\r\n            value: obj,\r\n            key: lastkey,\r\n            //*/\r\n        } else if (key === \"active\" && prop !== undefined && prop instanceof DataList) {\r\n          let act = prop.getActive(this, obj);\r\n\r\n          if (act === undefined && !ignoreExistence) {\r\n            throw new DataPathError(\"no active elem ent for list\");\r\n          }\r\n\r\n          let actkey = obj !== undefined && act !== undefined ? prop.getKey(this, obj, act) : undefined;\r\n\r\n          dstruct = prop.getStruct(this, obj, actkey);\r\n          if (dstruct === undefined) {\r\n            throw new DataPathError(\"couldn't get data type for \" + inpath + \"'s element '\" + key + \"'\");\r\n          }\r\n\r\n          _dummypath.parent = dpath;\r\n          dpath = _dummypath;\r\n\r\n          lastobj = obj;\r\n          obj = act;\r\n\r\n          dpath.type = DataTypes.STRUCT;\r\n          dpath.data = dstruct;\r\n          dpath.path = key;\r\n\r\n          p.optional(\"DOT\");\r\n\r\n          continue;\r\n        } else {\r\n          throw new DataPathError(inpath + \": unknown property \" + key);\r\n        }\r\n      }\r\n\r\n      let dynstructobj = undefined;\r\n\r\n      if (dpath.type === DataTypes.STRUCT) {\r\n        dstruct = dpath.data;\r\n      } else if (dpath.type === DataTypes.DYNAMIC_STRUCT) {\r\n        let ok = false;\r\n\r\n        if (obj !== undefined) {\r\n          let obj2;\r\n\r\n          if (dpath.flag & DataFlags.USE_CUSTOM_GETSET) {\r\n            let fakeprop = dpath.getSet;\r\n            fakeprop.ctx = ctx;\r\n            fakeprop.dataref = obj;\r\n            fakeprop.datapath = inpath;\r\n\r\n            obj2 = fakeprop.get();\r\n\r\n            fakeprop.ctx = fakeprop.datapath = fakeprop.dataref = undefined;\r\n          } else {\r\n            obj2 = obj[dpath.path];\r\n          }\r\n\r\n          dynstructobj = obj2;\r\n\r\n          if (obj2 !== undefined) {\r\n            if (CLS_API_KEY_CUSTOM in obj2.constructor) {\r\n              dstruct = obj2.constructor[CLS_API_KEY_CUSTOM](obj2);\r\n            } else {\r\n              dstruct = this.mapStruct(obj2.constructor, false);\r\n            }\r\n          } else {\r\n            dstruct = dpath.data;\r\n          }\r\n\r\n          if (dstruct === undefined) {\r\n            dstruct = dpath.data;\r\n          }\r\n\r\n          ok = dstruct !== undefined;\r\n        }\r\n\r\n        if (!ok) {\r\n          throw new DataPathError(\"dynamic struct error for path: \" + inpath);\r\n        }\r\n      } else {\r\n        prop = dpath.data;\r\n      }\r\n\r\n      if (prop && dpath.flag & DataFlags.USE_CUSTOM_PROP_GETTER) {\r\n        prop = this.getPropOverride(ctx, inpath, dpath, obj);\r\n      }\r\n\r\n      if (dpath.path.search(/\\./) >= 0) {\r\n        let keys = dpath.path.split(/\\./);\r\n\r\n        for (let key of keys) {\r\n          lastobj2 = lastobj;\r\n          lastobj = obj;\r\n          lastkey = key;\r\n\r\n          if (obj === undefined && !ignoreExistence) {\r\n            throw new DataPathError(\"no data for \" + inpath);\r\n          } else if (obj !== undefined) {\r\n            obj = obj[key.trim()];\r\n          }\r\n        }\r\n      } else {\r\n        lastobj2 = lastobj;\r\n        lastobj = obj;\r\n\r\n        lastkey = dpath.path;\r\n\r\n        if (dpath.flag & DataFlags.USE_CUSTOM_GETSET) {\r\n          let fakeprop = dpath.getSet;\r\n\r\n          if (!fakeprop && dpath.type === DataTypes.PROP) {\r\n            let prop = dpath.data;\r\n\r\n            prop.ctx = ctx;\r\n            prop.dataref = obj;\r\n            prop.datapath = inpath;\r\n\r\n            try {\r\n              obj = prop.getValue();\r\n            } catch (error) {\r\n              util.print_stack(error);\r\n              obj = undefined;\r\n            }\r\n\r\n            if (typeof obj === \"string\" && prop.type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n              obj = prop.values[obj];\r\n            }\r\n\r\n            prop.ctx = prop.dataref = prop.datapath = undefined;\r\n          } else {\r\n            fakeprop.ctx = ctx;\r\n            fakeprop.dataref = obj;\r\n            fakeprop.datapath = inpath;\r\n\r\n            obj = fakeprop.get();\r\n            fakeprop.ctx = fakeprop.datapath = fakeprop.dataref = undefined;\r\n          }\r\n        } else if (obj === undefined && !ignoreExistence) {\r\n          throw new DataPathError(\"no data for \" + inpath);\r\n        } else if (dpath.type === DataTypes.DYNAMIC_STRUCT) {\r\n          obj = dynstructobj;\r\n        } else if (obj !== undefined && dpath.path !== \"\") {\r\n          obj = obj[dpath.path];\r\n        }\r\n      }\r\n\r\n      let t = p.peeknext();\r\n      if (t === undefined) {\r\n        break;\r\n      }\r\n\r\n      if (t.type === \"DOT\") {\r\n        p.next();\r\n      } else if (t.type === \"EQUALS\" && prop !== undefined && prop.type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n        p.expect(\"EQUALS\");\r\n\r\n        let t2 = p.peeknext();\r\n        let type = t2 && t2.type === \"ID\" ? \"ID\" : \"NUM\";\r\n\r\n        let val = p.expect(type);\r\n\r\n        let val1 = val;\r\n\r\n        if (typeof val == \"string\") {\r\n          val = prop.values[val];\r\n        }\r\n\r\n        if (val === undefined) {\r\n          throw new DataPathError(\"unknown value \" + val1);\r\n        }\r\n\r\n        if (val in prop.keys) {\r\n          subkey = prop.keys[val];\r\n        }\r\n\r\n        key = dpath.path;\r\n        obj = !!(lastobj[key] == val);\r\n      } else if (t.type === \"AND\" && prop !== undefined && prop.type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n        p.expect(\"AND\");\r\n\r\n        let t2 = p.peeknext();\r\n        let type = t2 && t2.type === \"ID\" ? \"ID\" : \"NUM\";\r\n\r\n        let val = p.expect(type);\r\n\r\n        let val1 = val;\r\n\r\n        if (typeof val == \"string\") {\r\n          val = prop.values[val];\r\n        }\r\n\r\n        if (val === undefined) {\r\n          throw new DataPathError(\"unknown value \" + val1);\r\n        }\r\n\r\n        if (val in prop.keys) {\r\n          subkey = prop.keys[val];\r\n        }\r\n\r\n        key = dpath.path;\r\n        obj = !!(lastobj[key] & val);\r\n      } else if (t.type === \"LSBRACKET\" && prop !== undefined && prop.type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n        p.expect(\"LSBRACKET\");\r\n\r\n        let t2 = p.peeknext();\r\n        let type = t2 && t2.type === \"ID\" ? \"ID\" : \"NUM\";\r\n\r\n        let val = p.expect(type);\r\n\r\n        let val1 = val;\r\n\r\n        if (typeof val == \"string\") {\r\n          val = prop.values[val];\r\n        }\r\n\r\n        if (val === undefined) {\r\n          console.warn(inpath, prop.values, val1, prop);\r\n          throw new DataPathError(\"unknown value \" + val1);\r\n        }\r\n\r\n        if (val in prop.keys) {\r\n          subkey = prop.keys[val];\r\n        }\r\n\r\n        let bitfield;\r\n        key = dpath.path;\r\n\r\n        if (!(prop.flag & PropFlags.USE_CUSTOM_GETSET)) {\r\n          bitfield = lastobj ? lastobj[key] : 0;\r\n        } else {\r\n          prop.dataref = lastobj;\r\n          prop.datapath = inpath;\r\n          prop.ctx = ctx;\r\n\r\n          try {\r\n            bitfield = prop.getValue();\r\n          } catch (error) {\r\n            util.print_stack(error);\r\n\r\n            bitfield = NaN;\r\n          }\r\n        }\r\n\r\n        if (lastobj === undefined && !ignoreExistence) {\r\n          throw new DataPathError(\"no data for path \" + inpath);\r\n        } else if (lastobj !== undefined) {\r\n          if (prop.type === PropTypes.ENUM) {\r\n            obj = !!(bitfield === val);\r\n          } else {\r\n            obj = !!(bitfield & val);\r\n          }\r\n        }\r\n\r\n        p.expect(\"RSBRACKET\");\r\n      } else if (t.type === \"LSBRACKET\" && prop !== undefined && isVecProperty(prop)) {\r\n        p.expect(\"LSBRACKET\");\r\n        let num = p.expect(\"NUM\");\r\n        p.expect(\"RSBRACKET\");\r\n\r\n        subkey = num;\r\n\r\n        if (prop !== undefined && !(prop.type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4 | PropTypes.QUAT))) {\r\n          lastobj = obj;\r\n        }\r\n\r\n        obj = obj[num];\r\n      } else if (t.type === \"LSBRACKET\") {\r\n        p.expect(\"LSBRACKET\");\r\n\r\n        if (lastobj && lastkey && typeof lastkey === \"string\" && lastkey.length > 0) {\r\n          lastobj = lastobj[lastkey];\r\n        }\r\n\r\n        lastkey = p_key();\r\n        p.expect(\"RSBRACKET\");\r\n\r\n        if (!(prop instanceof DataList)) {\r\n          throw new DataPathError(\"bad property, not a list\");\r\n        }\r\n\r\n        obj = prop.get(this, lastobj, lastkey);\r\n        dstruct = prop.getStruct(this, lastobj, lastkey);\r\n\r\n        if (!dstruct) {\r\n          throw new DataPathError(inpath + \": list has no entry \" + lastkey);\r\n        }\r\n\r\n        if (p.peeknext() !== undefined && p.peeknext().type === \"DOT\") {\r\n          p.next();\r\n        }\r\n      }\r\n\r\n      if (_i++ > 1000) {\r\n        console.warn(\"infinite loop in resolvePath parser\");\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (prop && prop.type & (PropTypes.ENUM | PropFlags.FLAG)) {\r\n      prop.checkMeta();\r\n    }\r\n\r\n    return {\r\n      dpath  : lastdpath,\r\n      parent : lastobj2,\r\n      obj    : lastobj,\r\n      value  : obj,\r\n      key    : lastkey,\r\n      dstruct: dstruct,\r\n      prop   : prop,\r\n      subkey : subkey,\r\n    };\r\n  }\r\n\r\n  _parsePathOverrides(path) {\r\n    let parts = [\"\", undefined, undefined];\r\n\r\n    const TOOLPATH = 0,\r\n      NAME = 1,\r\n      HOTKEY = 2;\r\n    let part = TOOLPATH;\r\n\r\n    for (let i = 0; i < path.length; i++) {\r\n      let c = path[i];\r\n      let n = i < path.length - 1 ? path[i + 1] : \"\";\r\n\r\n      if (c === \"|\") {\r\n        part = NAME;\r\n        parts[NAME] = \"\";\r\n        continue;\r\n      } else if (c === \":\" && n === \":\") {\r\n        part = HOTKEY;\r\n        parts[HOTKEY] = \"\";\r\n        i++;\r\n        continue;\r\n      }\r\n\r\n      parts[part] += c;\r\n    }\r\n\r\n    return {\r\n      path  : parts[TOOLPATH].trim(),\r\n      uiname: parts[NAME] ? parts[NAME].trim() : undefined,\r\n      hotkey: parts[HOTKEY] ? parts[HOTKEY].trim() : undefined,\r\n    };\r\n  }\r\n\r\n  /** Get tooldef for path, applying any modifications, e.g.:\r\n   *  \"app.some_tool()|Label::CustomHotkeyString\"\r\n   * */\r\n  getToolDef(toolpath) {\r\n    let { path, uiname, hotkey } = this._parsePathOverrides(toolpath);\r\n\r\n    let cls = this.parseToolPath(path);\r\n    if (cls === undefined) {\r\n      throw new DataPathError('unknown path \"' + path + '\"');\r\n    }\r\n\r\n    let def = cls.tooldef();\r\n    if (uiname) {\r\n      def.uiname = uiname;\r\n    }\r\n    if (hotkey) {\r\n      def.hotkey = hotkey;\r\n    }\r\n\r\n    return def;\r\n  }\r\n\r\n  getToolPathHotkey(ctx, toolpath) {\r\n    let { path, uiname, hotkey } = this._parsePathOverrides(toolpath);\r\n\r\n    if (hotkey) {\r\n      return hotkey;\r\n    }\r\n\r\n    try {\r\n      return this.#getToolPathHotkey_intern(ctx, path);\r\n    } catch (error) {\r\n      print_stack(error);\r\n      util.console.context(\"api\").log(\"failed to fetch tool path: \" + path);\r\n\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  #getToolPathHotkey_intern(ctx, path) {\r\n    let screen = ctx.screen;\r\n    let this2 = this;\r\n\r\n    function searchKeymap(keymap) {\r\n      if (keymap === undefined) {\r\n        return undefined;\r\n      }\r\n\r\n      let ret;\r\n\r\n      function search(cb) {\r\n        if (ret) {\r\n          return;\r\n        }\r\n\r\n        for (let hk of keymap) {\r\n          if (typeof hk.action === \"string\" && cb(hk.action)) {\r\n            ret = hk.buildString();\r\n          }\r\n        }\r\n      }\r\n\r\n      search((tool) => tool.trim() === path.trim());\r\n      search((tool) => this2._parsePathOverrides(tool).path === path.trim());\r\n\r\n      return ret;\r\n    }\r\n\r\n    if (screen.sareas.length === 0) {\r\n      return searchKeymap(screen.keymap);\r\n    }\r\n\r\n    //client might have its own area subclass with\r\n    //getActiveArea defined (that's encouraged),\r\n    //which is why we don't just call Area.getActiveArea\r\n    let areacls = screen.sareas[0].area.constructor;\r\n    let area = areacls.getActiveArea();\r\n\r\n    if (area) {\r\n      for (let keymap of area.getKeyMaps()) {\r\n        let ret = searchKeymap(keymap);\r\n\r\n        if (ret !== undefined) {\r\n          return ret;\r\n        }\r\n      }\r\n    }\r\n\r\n    //search all other areas\r\n    for (let sarea of screen.sareas) {\r\n      if (!sarea.area) continue;\r\n\r\n      for (let keymap of sarea.area.getKeyMaps()) {\r\n        let ret = searchKeymap(keymap);\r\n\r\n        if (ret) {\r\n          return ret;\r\n        }\r\n      }\r\n    }\r\n\r\n    return this.keymap ? searchKeymap(this.keymap) : false;\r\n  }\r\n\r\n  parseToolPath(path) {\r\n    try {\r\n      return parseToolPath(path).toolclass;\r\n    } catch (error) {\r\n      if (error instanceof DataPathError) {\r\n        console.warn(\"warning, bad tool path \" + path);\r\n        return undefined;\r\n      } else {\r\n        throw error;\r\n      }\r\n    }\r\n  }\r\n\r\n  parseToolArgs(path) {\r\n    return parseToolPath(path).args;\r\n  }\r\n\r\n  createTool(ctx, path, inputs = {}) {\r\n    let cls;\r\n    let args;\r\n\r\n    if (typeof path == \"string\" || path instanceof String) {\r\n      //parseToolPath will raise DataPathError if path is malformed\r\n      let tpath = parseToolPath(path);\r\n\r\n      cls = tpath.toolclass;\r\n      args = tpath.args;\r\n    } else {\r\n      cls = path;\r\n      args = {};\r\n    }\r\n\r\n    if (!cls) {\r\n      debugger;\r\n      console.error(\"Unknown tool \" + path);\r\n    }\r\n\r\n    args = { ...args };\r\n\r\n    // feed inputs to invoke\r\n    const tooldef = cls._getFinalToolDef();\r\n    if (inputs !== undefined) {\r\n      for (let k in inputs) {\r\n        if (!(k in tooldef.inputs)) {\r\n          console.warn(cls.tooldef().uiname + ': Unknown tool property \"' + k + '\"');\r\n          continue;\r\n        }\r\n\r\n        if (!(k in args)) {\r\n          args[k] = inputs[k];\r\n        }\r\n      }\r\n    }\r\n\r\n    let tool = cls.invoke(ctx, args);\r\n\r\n    if (inputs !== undefined) {\r\n      for (let k in inputs) {\r\n        if (!(k in tool.inputs)) {\r\n          console.warn(cls.tooldef().uiname + ': Unknown tool property \"' + k + '\"');\r\n          continue;\r\n        }\r\n\r\n        tool.inputs[k].setValue(inputs[k]);\r\n      }\r\n    }\r\n\r\n    return tool;\r\n  }\r\n}\r\n\r\nexport function initSimpleController() {\r\n  initToolPaths();\r\n}\r\n\r\nimport { DataPathSetOp } from \"./controller_ops.js\";\r\nimport { Curve1DProperty } from \"../curve/curve1d_toolprop.js\";\r\n\r\nlet dpt = DataPathSetOp;\r\n\r\nexport function getDataPathToolOp() {\r\n  return dpt;\r\n}\r\n\r\nexport function setDataPathToolOp(cls) {\r\n  ToolOp.unregister(DataPathSetOp);\r\n\r\n  if (!ToolOp.isRegistered(cls)) {\r\n    ToolOp.register(cls);\r\n  }\r\n\r\n  dpt = cls;\r\n}\r\n\r\nsetImplementationClass(DataAPI);\r\n","import * as util from '../util/util.js';\r\nimport * as vectormath from '../util/vectormath.js';\r\nimport {Vector3, Vector4} from '../util/vectormath.js';\r\n\r\nlet rgb_to_hsv_rets = new util.cachering(() => [0, 0, 0], 64);\r\n\r\nexport function rgb_to_hsv(r, g, b) {\r\n  let computedH = 0;\r\n  let computedS = 0;\r\n  let computedV = 0;\r\n\r\n  if (r == null || g == null || b == null ||\r\n    isNaN(r) || isNaN(g) || isNaN(b)) {\r\n    throw new Error(`Please enter numeric RGB values! r: ${r} g: ${g} b: ${b}`);\r\n  }\r\n  /*\r\n  if (r<0 || g<0 || b<0 || r>1.0 || g>1.0 || b>1.0) {\r\n   throw new Error('RGB values must be in the range 0 to 1.0');\r\n   return;\r\n  }//*/\r\n\r\n  let minRGB = Math.min(r, Math.min(g, b));\r\n  let maxRGB = Math.max(r, Math.max(g, b));\r\n\r\n  // Black-gray-white\r\n  if (minRGB === maxRGB) {\r\n    computedV = minRGB;\r\n\r\n    let ret = rgb_to_hsv_rets.next();\r\n    ret[0] = 0, ret[1] = 0, ret[2] = computedV;\r\n    return ret;\r\n  }\r\n\r\n  // Colors other than black-gray-white:\r\n  let d = (r === minRGB) ? g - b : ((b === minRGB) ? r - g : b - r);\r\n  let h = (r === minRGB) ? 3 : ((b === minRGB) ? 1 : 5);\r\n\r\n  computedH = (60*(h - d/(maxRGB - minRGB)))/360.0;\r\n  computedS = (maxRGB - minRGB)/maxRGB;\r\n  computedV = maxRGB;\r\n\r\n  let ret = rgb_to_hsv_rets.next();\r\n  ret[0] = computedH, ret[1] = computedS, ret[2] = computedV;\r\n  return ret;\r\n}\r\n\r\nlet hsv_to_rgb_rets = new util.cachering(() => [0, 0, 0], 64);\r\n\r\nexport function hsv_to_rgb(h, s, v) {\r\n  let c = 0, m = 0, x = 0;\r\n  let ret = hsv_to_rgb_rets.next();\r\n\r\n  ret[0] = ret[1] = ret[2] = 0.0;\r\n  h *= 360.0;\r\n\r\n  c = v*s;\r\n  x = c*(1.0 - Math.abs(((h/60.0)%2) - 1.0));\r\n  m = v - c;\r\n  let color;\r\n\r\n  function RgbF_Create(r, g, b) {\r\n    ret[0] = r;\r\n    ret[1] = g;\r\n    ret[2] = b;\r\n\r\n    return ret;\r\n  }\r\n\r\n  if (h >= 0.0 && h < 60.0) {\r\n    color = RgbF_Create(c + m, x + m, m);\r\n  } else if (h >= 60.0 && h < 120.0) {\r\n    color = RgbF_Create(x + m, c + m, m);\r\n  } else if (h >= 120.0 && h < 180.0) {\r\n    color = RgbF_Create(m, c + m, x + m);\r\n  } else if (h >= 180.0 && h < 240.0) {\r\n    color = RgbF_Create(m, x + m, c + m);\r\n  } else if (h >= 240.0 && h < 300.0) {\r\n    color = RgbF_Create(x + m, m, c + m);\r\n  } else if (h >= 300.0) {\r\n    color = RgbF_Create(c + m, m, x + m);\r\n  } else {\r\n    color = RgbF_Create(m, m, m);\r\n  }\r\n\r\n  return color;\r\n}\r\n\r\nlet rgb_to_cmyk_rets = util.cachering.fromConstructor(Vector4, 512);\r\nlet cmyk_to_rgb_rets = util.cachering.fromConstructor(Vector3, 512);\r\n\r\nexport function cmyk_to_rgb(c, m, y, k) {\r\n  let ret = cmyk_to_rgb_rets.next();\r\n\r\n  if (k === 1.0) {\r\n    ret.zero();\r\n    return ret;\r\n  }\r\n\r\n  c = c - c*k + k;\r\n  m = m - m*k + k;\r\n  y = y - y*k + k;\r\n\r\n  ret[0] = 1.0 - c;\r\n  ret[1] = 1.0 - m;\r\n  ret[2] = 1.0 - y;\r\n\r\n  return ret;\r\n}\r\n\r\nexport function rgb_to_cmyk(r, g, b) {\r\n  //CMYK and CMY values from 0 to 1\r\n  let ret = rgb_to_cmyk_rets.next();\r\n\r\n  let C = 1.0 - r;\r\n  let M = 1.0 - g;\r\n  let Y = 1.0 - b;\r\n\r\n  let var_K = 1\r\n\r\n  if (C < var_K) var_K = C\r\n  if (M < var_K) var_K = M\r\n  if (Y < var_K) var_K = Y\r\n  if (var_K === 1) { //Black\r\n    C = 0\r\n    M = 0\r\n    Y = 0\r\n  } else {\r\n    C = (C - var_K)/(1 - var_K)\r\n    M = (M - var_K)/(1 - var_K)\r\n    Y = (Y - var_K)/(1 - var_K)\r\n  }\r\n\r\n  let K = var_K\r\n\r\n  ret[0] = C;\r\n  ret[1] = M;\r\n  ret[2] = Y;\r\n  ret[3] = K;\r\n\r\n  return ret;\r\n}\r\n\r\n","import {CSSFont} from './ui_theme.js';\r\n\r\nexport const DefaultTheme = {\r\n  base: {\r\n    AreaHeaderBG        : 'rgba(200, 200, 200, 0.95)',\r\n    BasePackFlag        : 0,\r\n    BoxDepressed        : 'rgba(130,130,130, 1)',\r\n    BoxHighlight        : 'rgba(151,208,239, 1)',\r\n    \"flex-grow\"         : \"unset\",\r\n    mobileSizeMultiplier: 1.0,\r\n    DefaultText         : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 14,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n    LabelText           : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 14,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n    TitleText           : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 12,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n    'background-color'  : 'rgba(207,207,207, 0.5)',\r\n    'border-color'      : 'rgba(34,34,34, 1)',\r\n    'border-radius'     : 12.010619764585666,\r\n    'focus-border-width': 2,\r\n    oneAxisPadding      : 2,\r\n    padding             : 1,\r\n  },\r\n\r\n  button: {\r\n    DefaultText        : new CSSFont({\r\n      font   : 'poppins',\r\n      weight : 'bold',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 12,\r\n      color  : 'rgba(35,35,35, 1)'\r\n    }),\r\n    'background-color' : 'rgba(238,238,238, 0.8672412740773168)',\r\n    'border-color'     : 'rgba(255,255,255, 1)',\r\n    'border-radius'    : 4,\r\n    'border-style'     : 'solid',\r\n    'border-width'     : 2,\r\n    disabled           : {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgb(109,109,109)'\r\n      }),\r\n      'background-color': 'rgb(19,19,19)',\r\n      'border-color'    : '#f58f8f',\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 1,\r\n    },\r\n    height             : 25,\r\n    highlight          : {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgba(255,255,255, 1)'\r\n      }),\r\n      'background-color': 'rgba(138,222,255, 1)',\r\n      'border-color'    : 'rgba(255,255,255, 1)',\r\n      'border-radius'   : 4,\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 2,\r\n    },\r\n    'highlight-pressed': {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgba(35,35,35, 1)'\r\n      }),\r\n      'background-color': 'rgba(113,113,113, 1)',\r\n      'border-color'    : '#DADCE0',\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 1,\r\n    },\r\n    margin             : 4,\r\n    'margin-left'      : 4,\r\n    'margin-right'     : 4,\r\n    padding            : 1,\r\n    pressed            : {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgba(35,35,35, 1)'\r\n      }),\r\n      'background-color': 'rgba(113,113,113, 1)',\r\n      'border-color'    : '#DADCE0',\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 1,\r\n    },\r\n    width              : 25,\r\n  },\r\n\r\n  checkbox: {\r\n    CheckSide         : 'left',\r\n    height            : 32,\r\n    width             : 32,\r\n    \"background-color\": \"rgb(168,168,168)\",\r\n  },\r\n\r\n  colorfield: {\r\n    circleSize    : 11,\r\n    colorBoxHeight: 24,\r\n    fieldSize     : 400,\r\n    height        : 256,\r\n    hueHeight     : 32,\r\n    width         : 256,\r\n  },\r\n\r\n  colorpickerbutton: {\r\n    height: 32,\r\n    width : 95,\r\n  },\r\n\r\n  curvewidget: {\r\n    CanvasBG    : 'rgb(44,44,44)',\r\n    CanvasHeight: 256,\r\n    CanvasWidth : 256,\r\n  },\r\n\r\n  dropbox: {\r\n    dropTextBG: 'rgba(233,233,233, 1)',\r\n    height    : 25,\r\n    width     : 32,\r\n  },\r\n\r\n  iconbutton: {\r\n    highlight: {\r\n      'background-color': 'rgba(133,182,255,0.8)',\r\n      'border-color'    : 'black',\r\n      'border-radius'   : 5,\r\n      'border-width'    : 1,\r\n      height            : 32,\r\n      'margin-bottom'   : 1,\r\n      'margin-left'     : 2,\r\n      'margin-right'    : 2,\r\n      'margin-top'      : 1,\r\n      padding           : 2,\r\n      width             : 32,\r\n    },\r\n    depressed: {\r\n      'background-color': 'rgba(42,61,77,0.8)',\r\n      'border-color'    : 'black',\r\n      'border-radius'   : 5,\r\n      'border-width'    : 1,\r\n      height            : 32,\r\n      'margin-bottom'   : 1,\r\n      'margin-left'     : 2,\r\n      'margin-right'    : 2,\r\n      'margin-top'      : 1,\r\n      padding           : 2,\r\n      width             : 32,\r\n    },\r\n\r\n    'background-color': 'rgba(15,15,15, 0)',\r\n    'border-color'    : 'black',\r\n    'border-radius'   : 5,\r\n    'border-width'    : 1,\r\n    height            : 32,\r\n    'margin-bottom'   : 1,\r\n    'margin-left'     : 2,\r\n    'margin-right'    : 2,\r\n    'margin-top'      : 1,\r\n    padding           : 2,\r\n    width             : 32,\r\n  },\r\n\r\n  iconcheck: {\r\n    highlight         : {\r\n      'background-color': 'rgba(133,182,255,0.8)',\r\n      'border-color'    : 'black',\r\n      'border-radius'   : 5,\r\n      'border-width'    : 1,\r\n      height            : 32,\r\n      'margin-bottom'   : 1,\r\n      'margin-left'     : 2,\r\n      'margin-right'    : 2,\r\n      'margin-top'      : 1,\r\n      padding           : 2,\r\n      width             : 32,\r\n    },\r\n    depressed         : {\r\n      'background-color': 'rgba(42,61,77,0.8)',\r\n      'border-color'    : 'black',\r\n      'border-radius'   : 5,\r\n      'border-width'    : 1,\r\n      height            : 32,\r\n      'margin-bottom'   : 1,\r\n      'margin-left'     : 2,\r\n      'margin-right'    : 2,\r\n      'margin-top'      : 1,\r\n      padding           : 2,\r\n      width             : 32,\r\n    },\r\n    'background-color': 'rgba(15,15,15, 0)',\r\n    'border-color'    : 'rgba(237,209,209, 1)',\r\n    'border-radius'   : 5,\r\n    'border-width'    : 0,\r\n    drawCheck         : true,\r\n    height            : 32,\r\n    'margin-bottom'   : 1,\r\n    'margin-left'     : 2,\r\n    'margin-right'    : 2,\r\n    'margin-top'      : 1,\r\n    padding           : 2,\r\n    width             : 32,\r\n  },\r\n\r\n  label: {\r\n    LabelText: new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 14,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n  },\r\n\r\n  listbox: {\r\n    ListActive   : 'rgba(200, 205, 215, 1.0)',\r\n    ListHighlight: 'rgba(155, 220, 255, 0.5)',\r\n    height       : 200,\r\n    width        : 110,\r\n  },\r\n\r\n  menu: {\r\n    MenuBG          : 'rgba(250, 250, 250, 1.0)',\r\n    \"item-radius\"   : 0,\r\n    MenuBorder      : '1px solid grey',\r\n    MenuHighlight   : 'rgba(155, 220, 255, 1.0)',\r\n    MenuSeparator   : {\r\n      width             : \"100%\",\r\n      height            : 2,\r\n      padding           : 0,\r\n      margin            : 0,\r\n      border            : \"none\",\r\n      \"background-color\": \"grey\"\r\n    },\r\n    'box-shadow'    : '5px 5px 25px rgba(0,0,0,0.75)',\r\n    MenuSpacing     : 5,\r\n    MenuText        : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 12,\r\n      color  : 'rgba(25, 25, 25, 1.0)'\r\n    }),\r\n    \"padding-top\"   : 0,\r\n    \"padding-left\"  : 0,\r\n    \"padding-right\" : 0,\r\n    \"padding-bottom\": 0,\r\n    'border-color'  : 'grey',\r\n    'border-radius' : 5,\r\n    'border-style'  : 'solid',\r\n    'border-width'  : 1,\r\n  },\r\n\r\n  notification: {\r\n    DefaultText       : new CSSFont({\r\n      font   : 'poppins',\r\n      weight : 'bold',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 12,\r\n      color  : 'rgb(55,55,55)'\r\n    }),\r\n    \"background-color\": \"rgba(72,72,72,0)\",\r\n    \"border-radius\"   : 5,\r\n    \"border-color\"    : \"grey\",\r\n    \"border-width\"    : 1,\r\n    \"border-style\"    : \"solid\",\r\n    ProgressBarBG     : \"rgb(74,148,183)\",\r\n    ProgressBar       : \"rgb(250,132,58)\",\r\n  },\r\n\r\n  numslider: {\r\n    'arrow-color'     : '50%',\r\n    'background-color': 'rgba(219,219,219, 1)',\r\n    'border-color'    : 'rgba(255,255,255, 1)',\r\n    'border-radius'   : 1,\r\n    height            : 22,\r\n    highlight         : {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgb(0,0,0)'\r\n      }),\r\n      'background-color': 'rgba(151,208,239, 1)',\r\n      'border-color'    : 'rgba(255,255,255, 1)',\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 1,\r\n    },\r\n    pressed           : {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgba(0,0,0, 1)'\r\n      }),\r\n      'arrow-color'     : 'rgb(28,28,28)',\r\n      'background-color': 'rgba(178,178,178, 1)',\r\n      'border-color'    : 'rgba(255,255,255, 1)',\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 1,\r\n    },\r\n    width             : 115,\r\n    /*\r\n    'highlight-pressed'            : {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgb(245,245,245)'\r\n      }),\r\n      'background-color': 'rgb(126,126,126)',\r\n      'border-color'    : '#DADCE0',\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 1,\r\n    },*/\r\n  },\r\n\r\n  numslider_simple: {\r\n    SlideHeight       : 10,\r\n    TextBoxWidth      : 45,\r\n    'background-color': 'rgba(219,219,219, 1)',\r\n    height            : 18,\r\n    labelOnTop        : true,\r\n    addLabel          : true,\r\n    width             : 135,\r\n  },\r\n\r\n  numslider_textbox: {\r\n    TextBoxHeight     : 25,\r\n    TextBoxWidth      : 50,\r\n    'background-color': 'rgba(219,219,219, 1)',\r\n    height            : 25,\r\n    labelOnTop        : true,\r\n    addLabel          : false,\r\n    width             : 120,\r\n  },\r\n\r\n  panel: {\r\n    HeaderBorderRadius    : 5.329650280441558,\r\n    HeaderRadius          : 4,\r\n    TitleBackground       : 'rgba(177,219,255, 1)',\r\n    TitleBorder           : 'rgba(104,104,104, 1)',\r\n    TitleText             : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 14,\r\n      color  : 'rgba(0,0,0, 1)'\r\n    }),\r\n    'background-color'    : 'rgba(184,184,184, 0.7594818376068376)',\r\n    'border-color'        : 'rgba(0,0,0, 0.5598061397157866)',\r\n    'border-radius'       : 4,\r\n    'border-style'        : 'groove',\r\n    'border-width'        : 1.141,\r\n    'margin-bottom'       : 0,\r\n    'margin-bottom-closed': 0,\r\n    'margin-left'         : 5.6584810220495445,\r\n    'margin-right'        : 0,\r\n    'margin-top'          : 0,\r\n    'margin-top-closed'   : 0,\r\n    'padding-bottom'      : 0,\r\n    'padding-left'        : 0,\r\n    'padding-right'       : 0,\r\n    'padding-top'         : 0,\r\n  },\r\n\r\n  richtext: {\r\n    DefaultText       : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 16,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n    'background-color': 'rgb(245, 245, 245)',\r\n  },\r\n\r\n  screenborder: {\r\n    'border-inner'   : 'grey',\r\n    'border-outer'   : 'rgba(228,228,228, 1)',\r\n    'border-width'   : 2,\r\n    'mouse-threshold': 8,\r\n  },\r\n\r\n  scrollbars: {\r\n    border  : undefined,\r\n    color   : undefined,\r\n    color2  : undefined,\r\n    contrast: undefined,\r\n    width   : undefined,\r\n  },\r\n\r\n  sidebar: {\r\n    'background-color': 'rgba(55, 55, 55, 0.5)',\r\n  },\r\n\r\n  strip: {\r\n    'background-color': 'rgba(75,75,75, 0.33213141025641024)',\r\n    'border-color'    : 'rgba(0,0,0, 0.31325409987877156)',\r\n    'border-radius'   : 8.76503417507447,\r\n    'border-style'    : 'solid',\r\n    'border-width'    : 1,\r\n    margin            : 2,\r\n    oneAxisPadding    : 2,\r\n    padding           : 1,\r\n    \"flex-grow\"       : \"unset\",\r\n  },\r\n\r\n  tabs: {\r\n    \"focus-on-tab-click\": \"false\",\r\n    \"movable-tabs\"      : \"true\",\r\n    TabPadding_mobile   : 20, //padding perpindicular to the label text\r\n    TabPadding          : 0,\r\n    TabActive           : 'rgba(212,212,212, 1)',\r\n    TabBarRadius        : 6,\r\n    TabHighlight        : 'rgba(50, 50, 50, 0.2)',\r\n    TabInactive         : 'rgba(183,183,183, 1)',\r\n    TabStrokeStyle1     : 'rgba(0,0,0, 1)',\r\n    TabStrokeStyle2     : 'rgba(0,0,0, 1)',\r\n    TabText             : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'bold',\r\n      style  : 'normal',\r\n      size   : 15,\r\n      color  : 'rgba(0,0,0, 1)'\r\n    }),\r\n    'background-color'  : 'rgba(222,222,222, 1)',\r\n  },\r\n\r\n  textbox: {\r\n    DefaultText       : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 14,\r\n      color  : 'rgba(3,3,3, 1)'\r\n    }),\r\n    'border-color'    : \"rgba(0,0,0,0)\",\r\n    'border-width'    : 1,\r\n    \"border-radius\"   : 4,\r\n    \"border-style\"    : \"solid\",\r\n    'background-color': 'rgba(245,245,245, 1)',\r\n  },\r\n\r\n  tooltip: {\r\n    ToolTipText       : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'bold',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 12,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n    'background-color': 'rgba(255,255,255, 1)',\r\n    'border-color'    : 'rgba(139,139,139, 1)',\r\n    'border-radius'   : 3,\r\n    'border-style'    : 'solid',\r\n    'border-width'    : 1,\r\n    padding           : 5,\r\n  },\r\n\r\n  treeview: {\r\n    itemIndent: 10,\r\n    rowHeight : 18,\r\n  },\r\n\r\n  vecPopupButton: {\r\n    height : 18,\r\n    padding: 3,\r\n    width  : 100,\r\n  },\r\n\r\n};\r\n","\"use strict\";\r\n\r\n/*\r\nIcons are defined in spritesheets that live in\r\nthe iconsheet16/32 dom nodes.  Icons are numbered start from\r\nthe upper left sprite tile.\r\n\r\nThis function sets the mapping between icon numbers and names.\r\n\r\nThe following icons should be in the icon sheet and in this map:\r\n\r\nRESIZE      :\r\nSMALL_PLUS  :\r\nTRANSLATE   : for moving things\r\nUI_EXPAND   : panel open icon\r\nUI_COLLAPSE : panel close icon\r\nNOTE_EXCL   : exclamation mark for notifications\r\nHELP        : help symbol\r\n*/\r\nexport function setIconMap(icons) {\r\n  for (let k in icons) {\r\n    Icons[k] = icons[k];\r\n  }\r\n}\r\n\r\nlet a = 0;\r\nexport let Icons = {\r\n  FOLDER: a++,\r\n  FILE  : a++,\r\n  TINY_X: a++,\r\n\r\n  SMALL_PLUS : a++,\r\n  SMALL_MINUS: a++,\r\n  UNDO       : a++,\r\n\r\n  REDO: a++,\r\n  HELP: a++,\r\n\r\n  UNCHECKED   : a++,\r\n  CHECKED     : a++,\r\n  LARGE_CHECK : a++,\r\n  CURSOR_ARROW: a++,\r\n  NOTE_EXCL   : a++,\r\n  SCROLL_DOWN : a++,\r\n  SCROLL_UP   : a++,\r\n  BACKSPACE   : a++,\r\n  LEFT_ARROW  : a++,\r\n  RIGHT_ARROW : a++,\r\n  UI_EXPAND   : a++, //triangle\r\n  UI_COLLAPSE : a++, //triangle\r\n\r\n\r\n  BOLD         : a++,\r\n  ITALIC       : a++,\r\n  UNDERLINE    : a++,\r\n  STRIKETHRU   : a++,\r\n  TREE_EXPAND  : a++,\r\n  TREE_COLLAPSE: a++,\r\n  ZOOM_OUT     : a++,\r\n  ZOOM_IN      : a++,\r\n  LARGE_X      : a++, /* Used for curve widget delete button. */\r\n};\r\n/* used for icon checkboxes with overlayed check marks */\r\nIcons.ENUM_CHECKED = Icons.CHECKED;\r\nIcons.ENUM_UNCHECKED = Icons.UNCHECKED;\r\n\r\n\r\n","let exclude = new Set([\r\n  \"toString\", \"constructor\", \"prototype\", \"__proto__\", \"toLocaleString\",\r\n  \"hasOwnProperty\", \"shadow\"\r\n]);\r\n\r\nlet UIBase = undefined;\r\n\r\n//deal with circular module refrence\r\nexport function _setUIBase(uibase) {\r\n  UIBase = uibase;\r\n}\r\n\r\nlet AspectKeys = Symbol(\"aspect-keys\");\r\n\r\nexport function initAspectClass(object, blacklist = new Set()) {\r\n  let cls = object.constructor;\r\n\r\n  if (!cls[AspectKeys]) {\r\n    cls[AspectKeys] = [];\r\n    let keys = [];\r\n\r\n    let p = object.__proto__;\r\n    while (p) {\r\n      keys = keys.concat(Reflect.ownKeys(p));\r\n      p = p.__proto__;\r\n    }\r\n    keys = new Set(keys);\r\n\r\n    function validProperty(obj, key) {\r\n      let descr = Object.getOwnPropertyDescriptor(obj, key);\r\n\r\n      if (descr && (descr.get || descr.set)) {\r\n        return false;\r\n      }\r\n\r\n      let p = obj.constructor;\r\n      do {\r\n        if (p.prototype) {\r\n          let descr = Object.getOwnPropertyDescriptor(p.prototype, key);\r\n\r\n          if (descr && (descr.set || descr.get)) {\r\n            return false;\r\n          }\r\n        }\r\n\r\n        p = p.__proto__;\r\n      } while (p && p !== p.__proto__);\r\n\r\n      return true;\r\n    }\r\n\r\n    for (let k of keys) {\r\n      let v;\r\n\r\n      if (typeof k === \"string\" && k.startsWith(\"_\")) {\r\n        continue;\r\n      }\r\n\r\n      if (k === \"constructor\") {\r\n        continue;\r\n      }\r\n\r\n      if (blacklist.has(k) || exclude.has(k)) {\r\n        continue;\r\n      }\r\n\r\n      if (!validProperty(object, k)) {\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        v = object[k];\r\n      } catch (error) {\r\n        continue;\r\n      }\r\n\r\n      if (typeof v !== \"function\") {\r\n        continue;\r\n      }\r\n\r\n      cls[AspectKeys].push(k);\r\n    }\r\n  }\r\n\r\n  object.__aspect_methods = new Set();\r\n\r\n  for (let k of cls[AspectKeys]) {\r\n    AfterAspect.bind(object, k);\r\n  }\r\n}\r\n\r\nexport function clearAspectCallbacks(obj) {\r\n  for (let key of obj.__aspect_methods) {\r\n    obj[key].clear();\r\n  }\r\n}\r\n\r\n/**\r\n *\r\n * example:\r\n *\r\n * someobject.update.after(() => {\r\n *   do_something();\r\n *   return someobject.update.value;\r\n * }\r\n *\r\n * */\r\nexport class AfterAspect {\r\n  constructor(owner, key) {\r\n    this.owner = owner;\r\n    this.key = key;\r\n\r\n    this.chain = [[owner[key], false]];\r\n    this.chain2 = [[owner[key], false]];\r\n\r\n    this.root = [[owner[key], false]];\r\n\r\n    let this2 = this;\r\n\r\n    let method = this._method = function () {\r\n      let chain = this2.chain;\r\n      let chain2 = this2.chain2;\r\n\r\n      chain2.length = chain.length;\r\n\r\n      for (let i = 0; i < chain.length; i++) {\r\n        chain2[i] = chain[i];\r\n      }\r\n\r\n      for (let i = 0; i < chain2.length; i++) {\r\n        let [cb, node, once] = chain2[i];\r\n\r\n        if (node) {\r\n          let isDead = !node.isConnected;\r\n\r\n          if (node instanceof UIBase) {\r\n            isDead = isDead || node.isDead();\r\n          }\r\n\r\n          if (isDead) {\r\n            console.warn(\"pruning dead AfterAspect callback\", node);\r\n            chain.remove(chain2[i]);\r\n            continue;\r\n          }\r\n        }\r\n\r\n\r\n        if (once && chain.indexOf(chain2[i]) >= 0) {\r\n          chain.remove(chain2[i]);\r\n        }\r\n\r\n        if (cb && cb.apply) {\r\n          method.value = cb.apply(this, arguments);\r\n          //method.value = Reflect.apply(cb, this, arguments);\r\n          //cb.apply(this, args);\r\n        }\r\n      }\r\n\r\n      let ret = method.value;\r\n      method.value = undefined;\r\n\r\n      return ret;\r\n    };\r\n\r\n    this._method_bound = false;\r\n\r\n    method.after = this.after.bind(this);\r\n    method.once = this.once.bind(this);\r\n    method.remove = this.remove.bind(this);\r\n\r\n    owner[key].after = this.after.bind(this);\r\n    owner[key].once = this.once.bind(this);\r\n    owner[key].remove = this.remove.bind(this);\r\n  }\r\n\r\n  static bind(owner, key) {\r\n    owner.__aspect_methods.add(key);\r\n\r\n    return new AfterAspect(owner, key);\r\n  }\r\n\r\n  remove(cb) {\r\n    for (let item of this.chain) {\r\n      if (item[0] === cb) {\r\n        this.chain.remove(item);\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  once(cb, node) {\r\n    return this.after(cb, node, true);\r\n  }\r\n\r\n  _checkbind() {\r\n    if (!this._method_bound) {\r\n      this.owner[this.key] = this._method;\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this._checkbind();\r\n    this.chain = [[this.root[0][0], this.root[0][1]]];\r\n    this.chain2 = [[this.root[0][0], this.root[0][1]]];\r\n\r\n    return this;\r\n  }\r\n\r\n  before(cb, node, once) {\r\n    this._checkbind();\r\n\r\n    if (cb === undefined) {\r\n      console.warn(\"invalid call to .after(); cb was undefined\");\r\n      return this.owner;\r\n    }\r\n    this.chain = [[cb, node, once]].concat(this.chain);\r\n    return this.owner;\r\n  }\r\n\r\n  after(cb, node, once) {\r\n    this._checkbind();\r\n\r\n    if (cb === undefined) {\r\n      console.warn(\"invalid call to .after(); cb was undefined\");\r\n      return this.owner;\r\n    }\r\n    this.chain.push([cb, node, once]);\r\n    return this.owner;\r\n  }\r\n}\r\n","import * as util from '../util/util.js'\r\n\r\nexport const SocketFlags = {\r\n  UPDATE: 1\r\n};\r\nexport const NodeFlags = {\r\n  UPDATE   : 1,\r\n  SORT_TAG1: 2,\r\n  SORT_TAG2: 4,\r\n};\r\nexport const RecalcFlags = {\r\n  RUN   : 1,\r\n  RESORT: 2\r\n};\r\nexport const SocketTypes = {\r\n  INPUT : \"inputs\",\r\n  OUTPUT: \"outputs\"\r\n};\r\n\r\nlet graphIdGen = 1;\r\n\r\nexport class EventSocket {\r\n  static socketDef = {\r\n    typeName: \"\",\r\n    uiName  : \"\",\r\n    flag    : 0,\r\n  }\r\n\r\n  name = \"\"\r\n  id = graphIdGen++;\r\n  flag = 0;\r\n\r\n  edges = [];\r\n  node = undefined;\r\n\r\n  type = undefined;\r\n\r\n  constructor(node) {\r\n    this.node = node;\r\n  }\r\n\r\n  get value() {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  set value(v) {\r\n    this.flagUpdate();\r\n  }\r\n\r\n  get isUpdated() {\r\n    return this.flag & SocketFlags.UPDATE;\r\n  }\r\n\r\n  copyFrom(b) {\r\n    this.name = b.name;\r\n    this.flag = b.flag;\r\n\r\n    return this;\r\n  }\r\n\r\n  copy() {\r\n    return (new this.constructor()).copyFrom(this);\r\n  }\r\n\r\n  flagUpdate() {\r\n    this.flag |= SocketFlags.UPDATE;\r\n\r\n    if (!this.node) {\r\n      return;\r\n    }\r\n\r\n    if (this.type === SocketTypes.INPUT) {\r\n      this.node.flagUpdate();\r\n    } else {\r\n      for (let sockb of this.edges) {\r\n        sockb.flag |= SocketFlags.UPDATE;\r\n        sockb.node.flagUpdate();\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  flagResort() {\r\n    if (this.node) {\r\n      this.node.flagResort();\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  connect(sockb) {\r\n    this.edges.push(sockb);\r\n    sockb.edges.push(this);\r\n    return this;\r\n  }\r\n\r\n  hasNode(node) {\r\n    for (let sockb of this.edges) {\r\n      if (sockb.node === node || sockb.node.owner === node) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  has(sockb) {\r\n    return this.edges.indexOf(sockb) >= 0;\r\n  }\r\n\r\n  disconnect(sockb = undefined) {\r\n    this.flagResort();\r\n\r\n    if (sockb === undefined) {\r\n      /* Disconnect all. */\r\n      for (let sock of this.edges) {\r\n        sock.flagUpdate();\r\n        sock.edges.remove(this);\r\n      }\r\n\r\n      this.edges.length = 0;\r\n      return this;\r\n    }\r\n\r\n    sockb.flagUpdate();\r\n    this.edges.remove(sockb);\r\n    return this;\r\n  }\r\n}\r\n\r\nconst NodeClasses = [];\r\n\r\n//Interface\r\nexport class NodeCapable {\r\n  graphNode = undefined;\r\n\r\n  static graphNodeDef = {\r\n    typeName: \"\",\r\n    uiName  : \"\",\r\n    flag    : 0,\r\n\r\n    /* Sockets inherit. */\r\n    inputs : {},\r\n    outputs: {}\r\n  };\r\n\r\n  graphExec() {\r\n  }\r\n}\r\n\r\nexport class EventNode {\r\n  owner = undefined;\r\n  inputs = {};\r\n  outputs = {};\r\n  allsockets = [];\r\n  graph = undefined;\r\n  sortIndex = -1;\r\n  id = graphIdGen++;\r\n  flag = 0;\r\n\r\n  static register(cls, def) {\r\n    cls.graphNodeDef = def;\r\n    if (!def.typeName) {\r\n      throw new Error(\"Missing graphNodeDef.typeName\")\r\n    }\r\n\r\n    NodeClasses.push(cls);\r\n\r\n    return def;\r\n  }\r\n\r\n  addSocket(type, key, sock) {\r\n    this[type][key] = sock;\r\n    sock.name = key;\r\n    sock.node = this;\r\n    sock.type = type;\r\n\r\n    return this;\r\n  }\r\n\r\n  static isNodeCapable(cls) {\r\n    return cls.graphNodeDef !== undefined;\r\n  }\r\n\r\n  constructor(owner) {\r\n    this.owner = owner;\r\n\r\n    let cls = owner.constructor;\r\n\r\n    let getSockets = (key) => {\r\n      let socks = {};\r\n\r\n      let p = cls;\r\n      while (p) {\r\n        if (p.graphNodeDef) {\r\n          let socksDef = p.graphNodeDef[key] || {};\r\n\r\n          for (let k in socksDef) {\r\n            if (!(k in socks)) {\r\n              socks[k] = socksDef[k].copy();\r\n              socks[k].name = k;\r\n              socks[k].node = this;\r\n              socks[k].type = key;\r\n\r\n              this.allsockets.push(socks[k]);\r\n            }\r\n          }\r\n        }\r\n        p = p.__proto__;\r\n      }\r\n\r\n      return socks;\r\n    }\r\n\r\n    this.inputs = getSockets(\"inputs\");\r\n    this.outputs = getSockets(\"outputs\");\r\n  }\r\n\r\n  static init(owner) {\r\n    owner.graphNode = new EventNode(owner);\r\n    return owner.graphNode;\r\n  }\r\n\r\n  flagUpdate() {\r\n    this.flag |= NodeFlags.UPDATE;\r\n\r\n    if (this.graph) {\r\n      this.graph.flagUpdate(this);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  flagResort() {\r\n    if (this.graph) {\r\n      this.graph.flagResort(this);\r\n    }\r\n    return this;\r\n  }\r\n}\r\n\r\nexport class EventGraph {\r\n  nodes = [];\r\n  flag = 0;\r\n  nodeIdMap = new Map()\r\n  sockIdMap = new Map()\r\n  sortlist = [];\r\n  queueReq = undefined;\r\n  #skipQueueExec = 0;\r\n\r\n  constructor() {\r\n  }\r\n\r\n  add(node) {\r\n    node = this.eventNode(node);\r\n\r\n    node.graph = this;\r\n    this.nodeIdMap.set(node.id, node);\r\n\r\n    this.nodes.push(node);\r\n    this.flagResort(node);\r\n    this.flagUpdate(node);\r\n  }\r\n\r\n  has(node) {\r\n    node = this.eventNode(node);\r\n    return this.nodeIdMap.has(node.id);\r\n  }\r\n\r\n  eventNode(node) {\r\n    if (!(node instanceof EventNode)) {\r\n      node = node.graphNode;\r\n    }\r\n\r\n    if (node === undefined) {\r\n      console.warn(\"Not an event node:\", arguments[0]);\r\n      throw new Error(\"Not an event node\");\r\n    }\r\n\r\n    return node;\r\n  }\r\n\r\n  remove(node) {\r\n    node = this.eventNode(node);\r\n\r\n    if (node === undefined) {\r\n      throw new Error(\"EventGraph.prototype.remove(): node was undefined\");\r\n    }\r\n\r\n    if (!this.nodeIdMap.get(node.id)) {\r\n      throw new Error(\"Node is not in event graph\");\r\n    }\r\n\r\n    this.nodeIdMap.delete(node.id);\r\n\r\n    for (let sock of Array.from(node.eventNode.allsockets)) {\r\n      this.sockIdMap.delete(sock.id);\r\n\r\n      try {\r\n        sock.disconnect();\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        console.error(\"Failed to disconnect a socket\");\r\n      }\r\n    }\r\n\r\n    node.graph = undefined;\r\n    this.nodes.remove(node);\r\n    this.flagResort();\r\n  }\r\n\r\n  flagResort(node) {\r\n    if (node) {\r\n      node = this.eventNode(node);\r\n    }\r\n\r\n    this.flag |= RecalcFlags.RESORT | RecalcFlags.RUN;\r\n\r\n    return this;\r\n  }\r\n\r\n  flagUpdate(node) {\r\n    node = this.eventNode(node);\r\n\r\n    this.flag |= RecalcFlags.RUN;\r\n\r\n    if (!this.#skipQueueExec) {\r\n      this.queueExec();\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  sort() {\r\n    console.warn(\"Sorting Graph\");\r\n\r\n    this.flag &= ~RecalcFlags.RESORT;\r\n\r\n    for (let n of this.nodes) {\r\n      n.flag &= ~(NodeFlags.SORT_TAG1 | NodeFlags.SORT_TAG2);\r\n    }\r\n\r\n    let sortlist = this.sortlist;\r\n    this.sortlist.length = 0;\r\n\r\n    let dosort = (n) => {\r\n      if (n.flag & NodeFlags.SORT_TAG2) {\r\n        console.error(\"Cycle in event dag!\", n);\r\n        return;\r\n      }\r\n\r\n      n.flag |= NodeFlags.SORT_TAG2;\r\n\r\n      for (let [k, socka] of Object.entries(n.inputs)) {\r\n        for (let sockb of socka.edges) {\r\n          let n2 = sockb.node;\r\n          if (!(n2.flag & NodeFlags.SORT_TAG1)) {\r\n            dosort(n2);\r\n          }\r\n        }\r\n      }\r\n\r\n      n.flag &= ~NodeFlags.SORT_TAG2;\r\n      n.flag |= NodeFlags.SORT_TAG1;\r\n      n.sortIndex = sortlist.length;\r\n      sortlist.push(n);\r\n\r\n      for (let [k, socka] of Object.entries(n.outputs)) {\r\n        for (let sockb of socka.edges) {\r\n          let n2 = sockb.node;\r\n\r\n          if (!(n2.flag & NodeFlags.SORT_TAG1)) {\r\n            dosort(n2);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    for (let n of this.nodes) {\r\n      if (!(n.flag & NodeFlags.SORT_TAG1)) {\r\n        dosort(n);\r\n      }\r\n    }\r\n  }\r\n\r\n  queueExec() {\r\n    console.warn(\"queueExec\", this.queueReq);\r\n\r\n    this.flag |= RecalcFlags.RUN;\r\n\r\n    if (this.queueReq !== undefined) {\r\n      return;\r\n    }\r\n\r\n    this.queueReq = true;\r\n    this.queueReq = window.setTimeout(() => {\r\n      this.queueReq = undefined;\r\n      this.exec();\r\n    }, 0);\r\n  }\r\n\r\n  exec() {\r\n    this.flag &= ~RecalcFlags.RUN;\r\n\r\n    if (this.flag & RecalcFlags.RESORT) {\r\n      this.sort();\r\n    }\r\n\r\n    console.warn(\"Executing Graph\");\r\n\r\n    this.#skipQueueExec++;\r\n\r\n    let sortlist = this.sortlist;\r\n    for (let n of sortlist) {\r\n      if (!(n.flag & NodeFlags.UPDATE)) {\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        n.owner.graphExec();\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        console.error(\"Error during event graph execution\");\r\n      }\r\n\r\n      n.flag &= ~NodeFlags.UPDATE;\r\n\r\n      for (let k in n.inputs) {\r\n        let sock = n.inputs[k];\r\n        sock.flag &= ~SocketFlags.UPDATE;\r\n      }\r\n\r\n      for (let k in n.outputs) {\r\n        let sock = n.outputs[k];\r\n\r\n        if (sock.flag & SocketFlags.UPDATE) {\r\n          for (let sockb of sock.edges) {\r\n            sockb.flag |= SocketFlags.UPDATE;\r\n            sockb.node.flag |= SocketFlags.UPDATE;\r\n          }\r\n\r\n          sock.flag &= ~SocketFlags.UPDATE;\r\n        }\r\n      }\r\n    }\r\n\r\n    this.#skipQueueExec--;\r\n  }\r\n}\r\n\r\nexport const theEventGraph = new EventGraph();\r\n\r\nconst strBoolMap = {\r\n  \"true\" : \"false\",\r\n  \"false\": \"true\",\r\n  \"on\"   : \"off\",\r\n  \"off\"  : \"on\",\r\n  \"yes\"  : \"no\",\r\n  \"no\"   : \"yes\",\r\n}\r\n\r\nexport class DependSocket extends EventSocket {\r\n  static socketDef = {\r\n    typeName: \"depend\",\r\n    uiName  : \"depend\",\r\n    flag    : 0,\r\n  }\r\n\r\n  #value = undefined;\r\n\r\n  get value() {\r\n    return this.#value;\r\n  }\r\n\r\n  set value(v) {\r\n    this.#value = v;\r\n  }\r\n\r\n  copyFrom(b) {\r\n    super.copyFrom(b);\r\n\r\n    this.#value = b.#value;\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nexport const PropSocketModes = {\r\n  REPLACE: 0,\r\n  MIN    : 1,\r\n  MAX    : 2,\r\n}\r\n\r\nexport class PropertySocket extends EventSocket {\r\n  static socketDef = {\r\n    typeName: \"property_socket\",\r\n    uiName  : \"Property Socket\",\r\n    flag    : 0,\r\n  }\r\n\r\n  mixMode = PropSocketModes.REPLACE;\r\n\r\n  #binding = {\r\n    obj: null,\r\n    key: \"\",\r\n  }\r\n\r\n  #callbacks = []; //(newval, oldval) => val\r\n  #invert = false; //Invert bool or number properties\r\n\r\n  oldValue = undefined;\r\n\r\n  mode(mixmode) {\r\n    this.mixMode = mixmode;\r\n    return this;\r\n  }\r\n\r\n  copyFrom(b) {\r\n    super.copyFrom(b);\r\n\r\n    this.#invert = b.#invert;\r\n    this.#callbacks = Array.from(b.#callbacks);\r\n    this.#binding = b.#binding;\r\n\r\n    return this;\r\n  }\r\n\r\n  invert(state = true) {\r\n    this.#invert = state;\r\n    return this;\r\n  }\r\n\r\n  callback(cb) {\r\n    this.#callbacks.push(cb);\r\n    return this;\r\n  }\r\n\r\n  get value() {\r\n    let bind = this.#binding;\r\n    return bind.obj ? bind.obj[bind.key] : undefined;\r\n  }\r\n\r\n  set value(v) {\r\n    let old = this.value;\r\n    if (this.#callbacks.length > 0) {\r\n      for (let cb of this.#callbacks) {\r\n        v = cb(v, old);\r\n      }\r\n    }\r\n\r\n    if (this.#invert && (typeof v === \"number\" || typeof v === \"boolean\" || typeof v === \"undefined\")) {\r\n      v = !v;\r\n    } else if (this.#invert && typeof v === \"string\") {\r\n      let s = v.toLowerCase().trim();\r\n      if (s in strBoolMap) {\r\n        v = strBoolMap[s];\r\n      }\r\n    }\r\n\r\n    let bind = this.#binding;\r\n    if (bind.obj) {\r\n      bind.obj[bind.key] = v;\r\n    } else {\r\n      console.warn(\"Attempt to set unbound property socket\", this);\r\n    }\r\n  }\r\n\r\n  bind(obj, key) {\r\n    this.#binding.obj = obj;\r\n    this.#binding.key = key;\r\n\r\n    return this;\r\n  }\r\n}\r\n","import {contextWrangler} from '../screen/area_wrangler.js';\r\n\r\nlet _ui_base = undefined;\r\n\r\n//avoid circular module references\r\nlet TextBox = undefined;\r\n\r\nexport function _setTextboxClass(cls) {\r\n  TextBox = cls;\r\n}\r\n\r\n//import * as ui_save from './ui_save.js';\r\n\r\n/*\r\nif (window.document && document.body) {\r\n  console.log(\"ensuring body.style.margin/padding are zero\");\r\n  document.body.style[\"margin\"] = \"0px\";\r\n  document.body.style[\"padding\"] = \"0px\";\r\n}\r\n */\r\n\r\nimport {Animator} from \"./anim.js\";\r\nimport './units.js';\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as math from '../path-controller/util/math.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport {\r\n  pushModalLight, popModalLight, copyEvent, pathDebugEvent,\r\n  haveModal, keymap, reverse_keymap, pushPointerModal\r\n} from '../path-controller/util/simple_events.js';\r\nimport {getDataPathToolOp} from '../path-controller/controller/controller.js';\r\nimport * as units from './units.js';\r\nimport {rgb_to_hsv, hsv_to_rgb} from \"../util/colorutils.js\";\r\n\r\nexport * from './ui_theme.js';\r\n\r\nimport {CSSFont, theme, parsepx, compatMap} from \"./ui_theme.js\";\r\n\r\nimport {DefaultTheme} from './theme.js';\r\n\r\n//global list of elements to, hopefully, prevent minification tree shaking\r\n//of live elements\r\nexport let ElementClasses = [];\r\n\r\nexport {theme} from \"./ui_theme.js\";\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nwindow.__cconst = cconst;\r\n\r\nlet Vector4 = vectormath.Vector4;\r\n\r\nexport {Icons} from '../icon_enum.js';\r\nimport {Icons} from '../icon_enum.js';\r\n\r\nexport {setIconMap} from '../icon_enum.js';\r\nimport {setIconMap} from '../icon_enum.js';\r\n\r\nimport {AfterAspect, initAspectClass} from \"./aspect.js\";\r\nimport * as aspect from './aspect.js';\r\n\r\nconst EnumProperty = toolprop.EnumProperty;\r\n\r\nlet Area;\r\nexport let _setAreaClass = (cls) => {\r\n  Area = cls;\r\n}\r\n\r\nexport const ErrorColors = {\r\n  WARNING: \"yellow\",\r\n  ERROR  : \"red\",\r\n  OK     : \"green\"\r\n};\r\n\r\nwindow.__theme = theme;\r\n\r\nlet registered_has_happened = false;\r\nlet tagPrefix = \"\";\r\nconst EventCBSymbol = Symbol(\"wrapped event callback\");\r\n\r\nfunction calcElemCBKey(elem, type, options) {\r\n  return elem._id + \":\" + type + \":\" + JSON.stringify(options || {});\r\n}\r\n\r\n/**\r\n * Sets tag prefix for pathux html elements.\r\n * Must be called prior to loading other modules.\r\n * Since this is tricky, you can alternatively\r\n * add a script tag with the prefix with the id \"pathux-tag-prefix\",\r\n * e.g.<pre> <script type=\"text/plain\" id=\"pathux-tag-prefix\">prefix</script> </pre>\r\n * */\r\nexport function setTagPrefix(prefix) {\r\n  if (registered_has_happened) {\r\n    throw new Error(\"have to call ui_base.setTagPrefix before loading any other path.ux modules\");\r\n  }\r\n\r\n  tagPrefix = \"\" + prefix;\r\n}\r\n\r\nexport function getTagPrefix(prefix) {\r\n  return tagPrefix;\r\n}\r\n\r\nif (typeof document !== 'undefined') {\r\n  let prefix = document.getElementById(\"pathux-tag-prefix\");\r\n  if (prefix) {\r\n    console.log(\"Found pathux-tag-prefix element\");\r\n    prefix = prefix.innerText.trim();\r\n    setTagPrefix(prefix);\r\n  }\r\n}\r\n\r\nimport {ClassIdSymbol} from './ui_consts.js';\r\n\r\nexport {ClassIdSymbol};\r\n\r\nlet class_idgen = 1;\r\n\r\nexport function setTheme(theme2) {\r\n  //merge theme\r\n  for (let k in theme2) {\r\n    let v = theme2[k];\r\n\r\n    if (typeof v !== \"object\") {\r\n      theme[k] = v;\r\n      continue;\r\n    }\r\n\r\n    let v0 = theme[k];\r\n\r\n    if (!(k in theme)) {\r\n      theme[k] = {};\r\n    }\r\n\r\n    for (let k2 in v) {\r\n      //if (v0 && !(k2 in v0)) {\r\n      //  continue;\r\n      //}\r\n\r\n      if (k2 in compatMap) {\r\n        let k3 = compatMap[k2];\r\n\r\n        if (v[k3] === undefined) {\r\n          v[k3] = v[k2];\r\n        }\r\n\r\n        delete v[k2];\r\n        k2 = k3;\r\n      }\r\n\r\n      theme[k][k2] = v[k2];\r\n    }\r\n  }\r\n}\r\n\r\nsetTheme(DefaultTheme);\r\n\r\nlet _last_report = util.time_ms();\r\n\r\nexport function report() {\r\n  if (util.time_ms() - _last_report > 350) {\r\n    console.warn(...arguments);\r\n    _last_report = util.time_ms();\r\n  }\r\n}\r\n\r\n//this function is deprecated\r\nexport function getDefault(key, elem) {\r\n  console.warn(\"Deprecated call to ui_base.js:getDefault\");\r\n\r\n  if (key in theme.base) {\r\n    return theme.base[key];\r\n  } else {\r\n    throw new Error(\"Unknown default \" + key);\r\n  }\r\n}\r\n\r\n//XXX implement me!\r\nexport function IsMobile() {\r\n  console.warn(\"ui_base.IsMobile is deprecated; use util.isMobile instead\")\r\n  return util.isMobile();\r\n};\r\n\r\nlet keys = [\"margin\", \"padding\", \"margin-block-start\", \"margin-block-end\"];\r\nkeys = keys.concat([\"padding-block-start\", \"padding-block-end\"]);\r\n\r\nkeys = keys.concat([\"margin-left\", \"margin-top\", \"margin-bottom\", \"margin-right\"]);\r\nkeys = keys.concat([\"padding-left\", \"padding-top\", \"padding-bottom\", \"padding-right\"]);\r\nexport const marginPaddingCSSKeys = keys;\r\n\r\n\r\nclass _IconManager {\r\n  constructor(image, tilesize, number_of_horizontal_tiles, drawsize) {\r\n    this.tilex = number_of_horizontal_tiles;\r\n    this.tilesize = tilesize;\r\n    this.drawsize = drawsize;\r\n\r\n    this.customIcons = new Map();\r\n\r\n    this.image = image;\r\n    this.promise = undefined;\r\n    this._accept = undefined;\r\n    this._reject = undefined;\r\n  }\r\n\r\n  get ready() {\r\n    return this.image && this.image.width;\r\n  }\r\n\r\n  onReady() {\r\n    if (this.ready) {\r\n      return new Promise((accept, reject) => {\r\n        accept(this);\r\n      });\r\n    }\r\n\r\n    if (this.promise) {\r\n      return this.promise;\r\n    }\r\n\r\n    let onload = this.image.onload;\r\n    this.image.onload = (e) => {\r\n      if (onload) {\r\n        onload.call(this.image, e);\r\n      }\r\n\r\n      if (!this._accept) {\r\n        return;\r\n      }\r\n\r\n      let accept = this._accept;\r\n      this._accept = this._reject = this.promise = undefined;\r\n\r\n      if (this.image.width) {\r\n        accept(this);\r\n      }\r\n    }\r\n\r\n    this.promise = new util.TimeoutPromise((accept, reject) => {\r\n      this._accept = accept;\r\n      this._reject = reject;\r\n    }, 15000, true); /* silently rejects on timeout */\r\n\r\n    this.promise.catch(error => {\r\n      util.print_stack(error);\r\n      this.promise = this._accept = this._reject = undefined;\r\n    });\r\n\r\n    return this.promise;\r\n  }\r\n\r\n  canvasDraw(elem, canvas, g, icon, x = 0, y = 0) {\r\n    let customIcon = this.customIcons.get(icon);\r\n\r\n    if (customIcon) {\r\n      g.drawImage(customIcon.canvas, x, y);\r\n      return;\r\n    }\r\n\r\n    let tx = icon%this.tilex;\r\n    let ty = ~~(icon/this.tilex);\r\n\r\n    let dpi = elem.getDPI();\r\n    let ts = this.tilesize;\r\n    let ds = this.drawsize;\r\n\r\n    if (!this.image) {\r\n      //console.warn(\"Failed to render an iconsheet\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      g.drawImage(this.image, tx*ts, ty*ts, ts, ts, x, y, ds*dpi, ds*dpi);\r\n    } catch (error) {\r\n      console.log(this.image);\r\n      console.error(error.stack);\r\n      console.error(error.message);\r\n      console.error(\"failed to draw an icon\");\r\n    }\r\n  }\r\n\r\n  setCSS(icon, dom, fitsize = undefined) {\r\n    if (!fitsize) {\r\n      fitsize = this.drawsize;\r\n    }\r\n\r\n    if (typeof fitsize === \"object\") {\r\n      fitsize = Math.max(fitsize[0], fitsize[1]);\r\n    }\r\n\r\n    dom.style[\"background\"] = this.getCSS(icon, fitsize);\r\n    if (this.customIcons.has(icon)) {\r\n      dom.style[\"background-size\"] = (fitsize) + \"px\";\r\n    } else {\r\n      dom.style[\"background-size\"] = (fitsize*this.tilex) + \"px\";\r\n    }\r\n\r\n    dom.style[\"background-clip\"] = \"content-box\";\r\n\r\n    if (!dom.style[\"width\"]) {\r\n      dom.style[\"width\"] = this.drawsize + \"px\";\r\n    }\r\n    if (!dom.style[\"height\"]) {\r\n      dom.style[\"height\"] = this.drawsize + \"px\";\r\n    }\r\n  }\r\n\r\n  //icon is an integer\r\n  getCSS(icon, fitsize = this.drawsize) {\r\n    if (icon === -1) { //-1 means no icon\r\n      return '';\r\n    }\r\n\r\n    if (typeof fitsize === \"object\") {\r\n      fitsize = Math.max(fitsize[0], fitsize[1]);\r\n    }\r\n\r\n    let ratio = fitsize/this.tilesize;\r\n\r\n    let customIcon = this.customIcons.get(icon);\r\n    if (customIcon !== undefined) {\r\n      //ratio = fitsize / this.drawsize;\r\n      //let d = this.drawsize*0.25;\r\n      let d = 0.0;\r\n\r\n      let css = `url(\"${customIcon.blobUrl}\")`;\r\n\r\n      return css;\r\n    }\r\n\r\n    let x = (-(icon%this.tilex)*this.tilesize)*ratio;\r\n    let y = (-(~~(icon/this.tilex))*this.tilesize)*ratio;\r\n\r\n    //x = ~~x;\r\n    //y = ~~y;\r\n\r\n    //console.log(this.tilesize, this.drawsize, x, y);\r\n    //let ts = this.tilesize;\r\n    //return `image('${this.image.src}#xywh=${x},${y},${ts},${ts}')`;\r\n    return `url(\"${this.image.src}\") ${x}px ${y}px`;\r\n  }\r\n}\r\n\r\nexport class CustomIcon {\r\n  constructor(manager, key, id, baseImage) {\r\n    this.key = key;\r\n    this.baseImage = baseImage;\r\n    this.images = []\r\n    this.id = id;\r\n    this.manager = manager;\r\n  }\r\n\r\n  regenIcons() {\r\n    let manager = this.manager;\r\n\r\n    let doSheet = (sheet) => {\r\n      let size = sheet.drawsize;\r\n      let canvas = document.createElement(\"canvas\");\r\n      let g = canvas.getContext(\"2d\");\r\n\r\n      canvas.width = canvas.height = size;\r\n      g.drawImage(this.baseImage, 0, 0, size, size);\r\n\r\n      canvas.toBlob((blob) => {\r\n        let blobUrl = URL.createObjectURL(blob);\r\n\r\n        sheet.customIcons.set(this.id, {\r\n          blobUrl,\r\n          canvas\r\n        });\r\n      })\r\n    }\r\n\r\n    for (let sheet of manager.iconsheets) {\r\n      doSheet(sheet);\r\n    }\r\n  }\r\n}\r\n\r\nexport class IconManager {\r\n  /**\r\n   images is a list of dom ids of img tags\r\n\r\n   sizes is a list of tile sizes, one per image.\r\n   you can control the final *draw* size by passing an array\r\n   of [tilesize, drawsize] instead of just a number.\r\n   */\r\n  constructor(images, sizes, horizontal_tile_count) {\r\n    this.iconsheets = [];\r\n    this.tilex = horizontal_tile_count;\r\n\r\n    this.customIcons = new Map();\r\n    this.customIconIDMap = new Map();\r\n\r\n    for (let i = 0; i < images.length; i++) {\r\n      let size, drawsize;\r\n\r\n      if (typeof sizes[i] == \"object\") {\r\n        size = sizes[i][0], drawsize = sizes[i][1];\r\n      } else {\r\n        size = drawsize = sizes[i];\r\n      }\r\n\r\n      if (util.isMobile()) {\r\n        drawsize = ~~(drawsize*theme.base.mobileSizeMultiplier);\r\n      }\r\n\r\n      this.iconsheets.push(new _IconManager(images[i], size, horizontal_tile_count, drawsize));\r\n    }\r\n  }\r\n\r\n  isReady(sheet = 0) {\r\n    return this.iconsheets[sheet].ready;\r\n  }\r\n\r\n  addCustomIcon(key, image) {\r\n    let icon = this.customIcons.get(key);\r\n\r\n    if (!icon) {\r\n      let maxid = 0;\r\n\r\n      for (let k in Icons) {\r\n        maxid = Math.max(maxid, Icons[k] + 1);\r\n      }\r\n      for (let icon of this.customIcons.values()) {\r\n        maxid = Math.max(maxid, icon.id + 1);\r\n      }\r\n\r\n      maxid = Math.max(maxid, 1000); //just to be on the safe side\r\n\r\n      let id = maxid;\r\n      icon = new CustomIcon(this, key, id, image);\r\n\r\n      this.customIcons.set(key, icon);\r\n      this.customIconIDMap.set(id, icon);\r\n    }\r\n\r\n    icon.baseImage = image;\r\n    icon.regenIcons();\r\n\r\n    return icon.id;\r\n  }\r\n\r\n  load(manager2) {\r\n    this.iconsheets = manager2.iconsheets;\r\n    this.tilex = manager2.tilex;\r\n\r\n    return this;\r\n  }\r\n\r\n  reset(horizontal_tile_count) {\r\n    this.iconsheets.length = 0;\r\n    this.tilex = horizontal_tile_count;\r\n  }\r\n\r\n  add(image, size, drawsize = size) {\r\n    this.iconsheets.push(new _IconManager(image, size, this.tilex, drawsize));\r\n    return this;\r\n  }\r\n\r\n  canvasDraw(elem, canvas, g, icon, x = 0, y = 0, sheet = 0) {\r\n    let base = this.iconsheets[sheet];\r\n\r\n    sheet = this.findSheet(sheet);\r\n    let ds = sheet.drawsize;\r\n\r\n    sheet.drawsize = base.drawsize;\r\n    sheet.canvasDraw(elem, canvas, g, icon, x, y);\r\n    sheet.drawsize = ds;\r\n  }\r\n\r\n  findClosestSheet(size) {\r\n    let sheets = this.iconsheets.concat([]);\r\n\r\n    sheets.sort((a, b) => a.drawsize - b.drawsize);\r\n    let sheet;\r\n\r\n    for (let i = 0; i < sheets.length; i++) {\r\n      if (sheets[i].drawsize <= size) {\r\n        sheet = sheets[i];\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (!sheet)\r\n      sheet = sheets[sheets.length - 1];\r\n\r\n    return this.iconsheets.indexOf(sheet);\r\n  }\r\n\r\n  findSheet(sheet) {\r\n    if (sheet === undefined) {\r\n      console.warn(\"sheet was undefined\");\r\n      sheet = 0;\r\n    }\r\n\r\n    let base = this.iconsheets[sheet];\r\n\r\n    /**sigh**/\r\n    let dpi = UIBase.getDPI();\r\n    let minsheet = undefined;\r\n    let goal = dpi*base.drawsize;\r\n\r\n    for (let sheet of this.iconsheets) {\r\n      minsheet = sheet;\r\n\r\n      if (sheet.drawsize >= goal) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return minsheet === undefined ? base : minsheet;\r\n  }\r\n\r\n  getTileSize(sheet = 0) {\r\n    return this.iconsheets[sheet].drawsize;\r\n    return this.findSheet(sheet).drawsize;\r\n  }\r\n\r\n  getRealSize(sheet = 0) {\r\n    return this.iconsheets[sheet].tilesize;\r\n    return this.findSheet(sheet).tilesize;\r\n    //return this.iconsheets[sheet].tilesize;\r\n  }\r\n\r\n  //icon is an integer\r\n  getCSS(icon, sheet = 0) {\r\n    //return this.iconsheets[sheet].getCSS(icon);\r\n    //return this.findSheet(sheet).getCSS(icon);\r\n\r\n    let base = this.iconsheets[sheet];\r\n    sheet = this.findSheet(sheet);\r\n    let ds = sheet.drawsize;\r\n\r\n    sheet.drawsize = base.drawsize;\r\n    let ret = sheet.getCSS(icon);\r\n    sheet.drawsize = ds;\r\n\r\n    return ret;\r\n  }\r\n\r\n  setCSS(icon, dom, sheet = 0, fitsize = undefined) {\r\n    //return this.iconsheets[sheet].setCSS(icon, dom);\r\n\r\n    let base = this.iconsheets[sheet];\r\n    sheet = this.findSheet(sheet);\r\n    let ds = sheet.drawsize;\r\n\r\n    sheet.drawsize = base.drawsize;\r\n    let ret = sheet.setCSS(icon, dom, fitsize);\r\n    sheet.drawsize = ds;\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nlet iconmanager\r\n\r\nif (typeof document !== 'undefined') {\r\n  iconmanager = new IconManager([\r\n    document.getElementById(\"iconsheet16\"),\r\n    document.getElementById(\"iconsheet32\"),\r\n    document.getElementById(\"iconsheet48\")\r\n  ], [16, 32, 64], 16);\r\n} else {\r\n  iconmanager = new IconManager([])\r\n}\r\n\r\nexport {iconmanager}\r\nwindow._iconmanager = iconmanager; //debug global\r\n\r\n//if client code overrides iconsheets, they must follow logical convention\r\n//that the first one is \"small\" and the second is \"large\"\r\nexport let IconSheets = {\r\n  SMALL : 0,\r\n  LARGE : 1,\r\n  XLARGE: 2\r\n};\r\n\r\nexport function iconSheetFromPackFlag(flag) {\r\n  if (flag & PackFlags.CUSTOM_ICON_SHEET) {\r\n    //console.log(\"Custom Icon Sheet:\", flag>>PackFlags.CUSTOM_ICON_SHEET_START);\r\n    return flag>>PackFlags.CUSTOM_ICON_SHEET_START;\r\n  }\r\n\r\n  if ((flag & PackFlags.SMALL_ICON) && !(PackFlags.LARGE_ICON)) {\r\n    return 0//IconSheets.SMALL; //0\r\n  } else {\r\n    return 1//IconSheets.LARGE; //1\r\n  }\r\n}\r\n\r\nexport function getIconManager() {\r\n  return iconmanager;\r\n}\r\n\r\nexport function setIconManager(manager, IconSheetsOverride) {\r\n  iconmanager.load(manager);\r\n\r\n  if (IconSheetsOverride !== undefined) {\r\n    for (let k in IconSheetsOverride) {\r\n      IconSheets[k] = IconSheetsOverride[k];\r\n    }\r\n  }\r\n}\r\n\r\nexport function makeIconDiv(icon, sheet = 0) {\r\n  let size = iconmanager.getRealSize(sheet);\r\n\r\n  let drawsize = iconmanager.getTileSize(sheet);\r\n\r\n  let icontest = document.createElement(\"div\");\r\n\r\n  icontest.style[\"width\"] = icontest.style[\"min-width\"] = drawsize + \"px\";\r\n  icontest.style[\"height\"] = icontest.style[\"min-height\"] = drawsize + \"px\";\r\n\r\n  //icontest.style[\"background-color\"] = \"orange\";\r\n\r\n  icontest.style[\"margin\"] = \"0px\";\r\n  icontest.style[\"padding\"] = \"0px\";\r\n\r\n  iconmanager.setCSS(icon, icontest, sheet);\r\n\r\n  return icontest;\r\n}\r\n\r\nlet Vector2 = vectormath.Vector2;\r\nlet Matrix4 = vectormath.Matrix4;\r\n\r\nexport let dpistack = [];\r\n\r\nexport const UIFlags = {};\r\n\r\nconst internalElementNames = {};\r\nconst externalElementNames = {};\r\n\r\nexport const PackFlags = {\r\n  INHERIT_WIDTH : 1,\r\n  INHERIT_HEIGHT: 2,\r\n  VERTICAL      : 4,\r\n  USE_ICONS     : 8,\r\n  SMALL_ICON    : 16,\r\n  LARGE_ICON    : 32,\r\n\r\n  FORCE_PROP_LABELS         : 64, //force propeties (Container.prototype.prop()) to always have labels\r\n  PUT_FLAG_CHECKS_IN_COLUMNS: 128, //group flag property checkmarks in columns (doesn't apply to icons)\r\n\r\n  WRAP_CHECKBOXES: 256,\r\n\r\n  //internal flags\r\n  STRIP_HORIZ            : 512,\r\n  STRIP_VERT             : 1024,\r\n  STRIP                  : 512 | 1024,\r\n  SIMPLE_NUMSLIDERS      : 2048,\r\n  FORCE_ROLLER_SLIDER    : 4096,\r\n  HIDE_CHECK_MARKS       : (1<<13),\r\n  NO_NUMSLIDER_TEXTBOX   : (1<<14),\r\n  CUSTOM_ICON_SHEET      : 1<<15,\r\n  CUSTOM_ICON_SHEET_START: 20, //custom icon sheet bits are shifted to here\r\n  NO_UPDATE              : 1<<16,\r\n  LABEL_ON_RIGHT         : 1<<17,\r\n};\r\n\r\nlet first = (iter) => {\r\n  if (iter === undefined) {\r\n    return undefined;\r\n  }\r\n\r\n  if (!(Symbol.iterator in iter)) {\r\n    for (let item in iter) {\r\n      return item;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  for (let item of iter) {\r\n    return item;\r\n  }\r\n}\r\n\r\nimport {DataPathError} from '../path-controller/controller/controller.js';\r\nimport {TimeoutPromise} from '../path-controller/util/util.js';\r\nimport {IntProperty, NumberConstraints, PropFlags} from '../path-controller/toolsys/toolprop.js';\r\nimport {\r\n  DependSocket, EventNode, PropertySocket, PropSocketModes, SocketTypes, theEventGraph\r\n} from '../path-controller/dag/eventdag.js';\r\nimport {isNum} from '../path-controller/util/math.js';\r\n\r\nlet _mobile_theme_patterns = [\r\n  /.*width.*/,\r\n  /.*height.*/,\r\n  /.*size.*/,\r\n  /.*margin.*/,\r\n  /.*pad/,\r\n  /.*radius.*/\r\n];\r\n\r\n\r\nlet _idgen = 0;\r\n\r\nwindow._testSetScrollbars = function (color = \"grey\", contrast = 0.5, width = 15, border = \"solid\") {\r\n  let buf = styleScrollBars(color, undefined, contrast, width, border, \"*\");\r\n  CTX.screen.mergeGlobalCSS(buf);\r\n\r\n  //document.body.style[\"overflow\"] = \"scroll\";\r\n\r\n  /*\r\n  if (!window._tsttag) {\r\n    window._tsttag = document.createElement(\"style\");\r\n    document.body.prepend(_tsttag);\r\n  }\r\n\r\n  _tsttag.textContent = buf;\r\n  //*/\r\n\r\n  return buf;\r\n};\r\n\r\nexport function styleScrollBars(color = \"grey\", color2 = undefined, contrast = 0.5, width = 15,\r\n                                border                                                    = \"1px groove black\", selector = \"*\") {\r\n\r\n  if (!color2) {\r\n    let c = css2color(color);\r\n    let a = c.length > 3 ? c[3] : 1.0;\r\n\r\n    c = rgb_to_hsv(c[0], c[1], c[2]);\r\n    let inv = c.slice(0, c.length);\r\n\r\n    inv[2] = 1.0 - inv[2];\r\n    inv[2] += (c[2] - inv[2])*(1.0 - contrast);\r\n\r\n    inv = hsv_to_rgb(inv[0], inv[1], inv[2]);\r\n\r\n    inv.length = 4;\r\n    inv[3] = a;\r\n\r\n    inv = color2css(inv);\r\n    color2 = inv;\r\n  }\r\n\r\n  let buf = `\r\n\r\n${selector} {\r\n  scrollbar-width : ${width <= 16 ? 'thin' : 'auto'};\r\n  scrollbar-color : ${color2} ${color};\r\n}\r\n\r\n${selector}::-webkit-scrollbar {\r\n  width : ${width}px;\r\n  background-color : ${color};\r\n}\r\n\r\n${selector}::-webkit-scrollbar-track {\r\n  background-color : ${color};\r\n  border : ${border};\r\n}\r\n\r\n${selector}::-webkit-scrollbar-thumb {\r\n  background-color : ${color2};\r\n  border : ${border};\r\n}\r\n    `;\r\n\r\n  //console.log(buf);\r\n  return buf;\r\n}\r\n\r\nwindow.styleScrollBars = styleScrollBars;\r\n\r\nlet _digest = new util.HashDigest();\r\n\r\nexport function calcThemeKey(digest = _digest.reset()) {\r\n  for (let k in theme) {\r\n    let obj = theme[k];\r\n\r\n    if (typeof obj !== \"object\") {\r\n      continue;\r\n    }\r\n\r\n    for (let k2 in obj) {\r\n      let v2 = obj[k2];\r\n\r\n      if (typeof v2 === \"number\" || typeof v2 === \"boolean\" || typeof v2 === \"string\") {\r\n        digest.add(v2);\r\n      } else if (typeof v2 === \"object\" && v2 instanceof CSSFont) {\r\n        v2.calcHashUpdate(digest);\r\n      }\r\n    }\r\n  }\r\n\r\n  return digest.get();\r\n}\r\n\r\nexport var _themeUpdateKey = calcThemeKey();\r\n\r\nexport function flagThemeUpdate() {\r\n  _themeUpdateKey = calcThemeKey();\r\n}\r\n\r\nwindow._flagThemeUpdate = flagThemeUpdate;\r\n\r\nlet setTimeoutQueue = new Set();\r\nlet haveTimeout = false;\r\n\r\nfunction timeout_cb() {\r\n  if (setTimeoutQueue.size === 0) {\r\n    haveTimeout = false;\r\n    return;\r\n  }\r\n\r\n  for (let item of new Set(setTimeoutQueue)) {\r\n    let {cb, timeout, time} = item;\r\n    if (util.time_ms() - time < timeout) {\r\n      continue;\r\n    }\r\n\r\n    setTimeoutQueue.delete(item);\r\n\r\n    try {\r\n      cb();\r\n    } catch (error) {\r\n      console.error(error.stack);\r\n    }\r\n  }\r\n\r\n  window.setTimeout(timeout_cb, 0);\r\n}\r\n\r\nexport function internalSetTimeout(cb, timeout) {\r\n  if (timeout > 100) { //call directly\r\n    window.setTimeout(cb, timeout);\r\n    return;\r\n  }\r\n\r\n  setTimeoutQueue.add({\r\n    cb, timeout, time: util.time_ms()\r\n  });\r\n\r\n  if (!haveTimeout) {\r\n    haveTimeout = true;\r\n    window.setTimeout(timeout_cb, 0);\r\n  }\r\n}\r\n\r\nwindow.setTimeoutQueue = setTimeoutQueue;\r\n\r\nif (typeof HTMLElement === 'undefined') {\r\n  // inside a worker?\r\n  window.HTMLElement = class HTMLElement {}\r\n  window.customElements = {\r\n    define: () => {}\r\n  }\r\n  window.devicePixelRatio = 1.0\r\n  window.PointerEvent = class PointerEvent {}\r\n}\r\n\r\nexport class UIBase extends HTMLElement {\r\n  #reflagGraph = false;\r\n\r\n  static graphNodeDef = EventNode.register(this, {\r\n    typeName: this.name,\r\n    uiName  : this.name,\r\n    inputs  : {\r\n      depend: new DependSocket()\r\n    },\r\n    outputs : {\r\n      depend: new DependSocket()\r\n    }\r\n  })\r\n\r\n  graphExec() {\r\n    let node = this.graphNode;\r\n\r\n    if (node.inputs.depend.isUpdated) {\r\n      node.outputs.depend.flagUpdate();\r\n    }\r\n\r\n    for (let k in node.inputs) {\r\n      let sock = node.inputs[k];\r\n\r\n      if (!(sock instanceof PropertySocket)) {\r\n        continue;\r\n      }\r\n\r\n      let val = sock.value;\r\n      let first = true;\r\n\r\n      for (let sockb of sock.edges) {\r\n        if (first) {\r\n          val = sockb.value;\r\n          first = false;\r\n        } else {\r\n          switch (sock.mixMode) {\r\n            case PropSocketModes.REPLACE:\r\n              val = sockb.value;\r\n              break;\r\n            case PropSocketModes.MIN:\r\n              val = Math.min(val, sockb.value);\r\n              break;\r\n            case PropSocketModes.MAX:\r\n              val = Math.max(val, sockb.value);\r\n              break;\r\n          }\r\n        }\r\n      }\r\n\r\n      sock.value = val;\r\n    }\r\n\r\n    function isNumArray(a) {\r\n      if (!Array.isArray(a)) {\r\n        return false;\r\n      }\r\n\r\n      for (let i = 0; i < a.length; i++) {\r\n        if (a[i] !== undefined && typeof a[i] !== \"number\" && typeof a[i] !== \"boolean\") {\r\n          return false;\r\n        }\r\n      }\r\n\r\n      return true;\r\n    }\r\n\r\n    for (let k in node.outputs) {\r\n      let sock = node.outputs[k];\r\n\r\n      if (!(sock instanceof PropertySocket)) {\r\n        continue;\r\n      }\r\n\r\n      let v = sock.value;\r\n      let changed;\r\n      if (typeof v === \"boolean\" || typeof v === \"string\" || typeof v === \"number\") {\r\n        changed = v !== sock.oldValue;\r\n        sock.oldValue = v;\r\n      } else if (typeof v === \"object\") {\r\n        if (isNumArray(v)) {\r\n          if (!sock.oldValue) {\r\n            sock.oldValue = Array.from(v);\r\n          } else {\r\n            if (sock.oldValue.length !== v.length) {\r\n              changed = true;\r\n            } else {\r\n              for (let i = 0; i < sock.oldValue.length; i++) {\r\n                changed = sock.oldValue[i] !== v[i];\r\n              }\r\n            }\r\n\r\n            if (sock.oldValue.length !== v.length) {\r\n              sock.oldValue.length = v.length;\r\n            }\r\n            for (let i = 0; i < v.length; i++) {\r\n              sock.oldValue[i] = v.value[i];\r\n            }\r\n          }\r\n        } else {\r\n          if (sock.oldValue === undefined) {\r\n            sock.oldValue = JSON.stringify(v);\r\n          } else {\r\n            let json = JSON.stringify(v);\r\n            changed = json !== sock.oldValue;\r\n            sock.oldValue = json;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (changed) {\r\n        console.log(\"Propagating prop update\");\r\n        sock.flagUpdate();\r\n      }\r\n    }\r\n  }\r\n\r\n  ensureGraph() {\r\n    console.log(\"Ensure Graph\", this, this.graphNode, this.graphNode.id);\r\n    if (!theEventGraph.has(this)) {\r\n      theEventGraph.add(this);\r\n    }\r\n  }\r\n\r\n  flagPropSocketUpdate(path) {\r\n    let sock = this.getPropertySocket(path, SocketTypes.OUTPUT);\r\n    if (sock) {\r\n      console.warn(`Flag socket \"${path}\" for update`);\r\n      sock.flagUpdate();\r\n    }\r\n    return this;\r\n  }\r\n\r\n  getPropertySocket(prop, socktype) {\r\n    let node = this.graphNode;\r\n    let sockets = socktype === SocketTypes.INPUT ? node.inputs : node.outputs;\r\n\r\n    if (sockets[prop]) {\r\n      return sockets[prop];\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  ensurePropertySocket(prop, socktype) {\r\n    this.ensureGraph();\r\n\r\n    let node = this.graphNode;\r\n    let sockets = socktype === SocketTypes.INPUT ? node.inputs : node.outputs;\r\n\r\n    if (sockets[prop]) {\r\n      return sockets[prop];\r\n    }\r\n\r\n    let sock = new PropertySocket();\r\n    sock.bind(this, prop);\r\n    node.addSocket(socktype, prop, sock);\r\n\r\n    if (prop === \"value\") {\r\n      sock.callback((v) => {\r\n        if (this.getValue) {\r\n          return this.getValue();\r\n        }\r\n\r\n        return this.value;\r\n      });\r\n    }\r\n\r\n    return sock;\r\n  }\r\n\r\n  /*\r\n    widget.dependsOn(\"hidden\", checkbox, \"value\")\r\n   */\r\n  dependsOn(dstProp, source, srcProp, srcCallback = undefined, dstCallback = undefined) {\r\n    let sockdst = this.ensurePropertySocket(dstProp, SocketTypes.INPUT);\r\n    let socksrc = source.ensurePropertySocket(srcProp, SocketTypes.OUTPUT);\r\n\r\n    if (srcCallback) {\r\n      socksrc.callback(srcCallback);\r\n    }\r\n\r\n    sockdst.connect(socksrc);\r\n\r\n    return sockdst;\r\n  }\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    EventNode.init(this);\r\n\r\n    this._modalstack = [];\r\n\r\n    this._tool_tip_abort_delay = undefined;\r\n    this._tooltip_ref = undefined;\r\n\r\n    this._textBoxEvents = false;\r\n\r\n    this._themeOverride = undefined;\r\n\r\n    this._checkTheme = true;\r\n    this._last_theme_update_key = _themeUpdateKey;\r\n\r\n    this._client_disabled_set = undefined;\r\n    //this._parent_disabled_set = 0;\r\n\r\n    this._useNativeToolTips = cconst.useNativeToolTips;\r\n    this._useNativeToolTips_set = false;\r\n    this._has_own_tooltips = undefined;\r\n    this._tooltip_timer = util.time_ms();\r\n\r\n    this.pathUndoGen = 0;\r\n    this._lastPathUndoGen = 0;\r\n    this._useDataPathUndo = undefined;\r\n\r\n    this._active_animations = [];\r\n\r\n    //ref to Link element referencing Screen style node\r\n    //Screen.update_intern sets the contents of this\r\n    this._screenStyleTag = document.createElement(\"style\");\r\n    this._screenStyleUpdateHash = 0;\r\n\r\n    initAspectClass(this, new Set([\"appendChild\", \"animate\", \"shadow\", \"removeNode\", \"prepend\", \"add\", \"init\"]));\r\n\r\n    this.shadow = this.attachShadow({mode: 'open'});\r\n\r\n    if (cconst.DEBUG.paranoidEvents) {\r\n      this.__cbs = [];\r\n    }\r\n\r\n    this.shadow.appendChild(this._screenStyleTag);\r\n    this.shadow._appendChild = this.shadow.appendChild;\r\n\r\n    ///*\r\n    let appendChild = this.shadow.appendChild;\r\n    this.shadow.appendChild = (child) => {\r\n      if (child && typeof child === \"object\" && child instanceof UIBase) {\r\n        child.parentWidget = this;\r\n      }\r\n\r\n      return this.shadow._appendChild(child, ...arguments);\r\n    };\r\n    //*/\r\n\r\n    this._wasAddedToNodeAtSomeTime = false;\r\n\r\n    this.visibleToPick = true;\r\n\r\n    this._override_class = undefined;\r\n    this.parentWidget = undefined;\r\n\r\n    /*\r\n    this.shadow._appendChild = this.shadow.appendChild;\r\n    this.shadow.appendChild = (child) => {\r\n      if (child instanceof UIBase) {\r\n        child.ctx = this.ctx;\r\n        child.parentWidget = this;\r\n\r\n        if (child._useDataPathUndo === undefined) {\r\n          child.useDataPathUndo = this.useDataPathUndo;\r\n        }\r\n      }\r\n\r\n      return this.shadow._appendChild(child);\r\n    };\r\n    //*/\r\n\r\n    let tagname = this.constructor.define().tagname;\r\n    this._id = tagname.replace(/\\-/g, \"_\") + (_idgen++);\r\n\r\n    this.default_overrides = {}; //inherited by child widgets\r\n    this.my_default_overrides = {}; //not inherited to child widgets\r\n    this.class_default_overrides = {};\r\n\r\n    this._last_description = undefined;\r\n    this._description_final = undefined;\r\n\r\n    //getting css to flow down properly can be a pain, so\r\n    //some packing settings are set as bitflags here,\r\n    //see PackFlags\r\n\r\n    /*\r\n    setInterval(() => {\r\n      this.update();\r\n    }, 200);\r\n    //*/\r\n\r\n    this._modaldata = undefined;\r\n    this.packflag = this.getDefault(\"BasePackFlag\");\r\n    this._internalDisabled = false;\r\n    this.__disabledState = false;\r\n    this._disdata = undefined;\r\n    this._ctx = undefined;\r\n\r\n    this._description = undefined;\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n    .DefaultText {\r\n      font: ` + _getFont(this) + `;\r\n    }\r\n    `;\r\n    this.shadow.appendChild(style);\r\n    this._init_done = false;\r\n\r\n    /* Deprecated touch -> mouse event conversion,\r\n       use pointer events instead. */\r\n    let do_touch = (e, type, button) => {\r\n      if (haveModal()) {\r\n        return;\r\n      }\r\n\r\n      button = button === undefined ? 0 : button;\r\n      let e2 = copyEvent(e);\r\n\r\n      if (e.touches.length === 0) {\r\n        //hrm, what to do, what to do. . .\r\n      } else {\r\n        let t = e.touches[0];\r\n\r\n        e2.pageX = t.pageX;\r\n        e2.pageY = t.pageY;\r\n        e2.screenX = t.screenX;\r\n        e2.screenY = t.screenY;\r\n        e2.clientX = t.clientX;\r\n        e2.clientY = t.clientY;\r\n        e2.x = t.x;\r\n        e2.y = t.y;\r\n      }\r\n\r\n      e2.button = button;\r\n\r\n      e2 = new MouseEvent(type, e2);\r\n\r\n      e2.was_touch = true;\r\n      e2.stopPropagation = e.stopPropagation.bind(e);\r\n      e2.preventDefault = e.preventDefault.bind(e);\r\n      e2.touches = e.touches;\r\n\r\n      this.dispatchEvent(e2);\r\n    };\r\n\r\n    this.addEventListener(\"touchstart\", (e) => {\r\n      do_touch(e, \"mousedown\", 0);\r\n    }, {passive: false});\r\n    this.addEventListener(\"touchmove\", (e) => {\r\n      do_touch(e, \"mousemove\");\r\n    }, {passive: false});\r\n    this.addEventListener(\"touchcancel\", (e) => {\r\n      do_touch(e, \"mouseup\", 2);\r\n    }, {passive: false});\r\n    this.addEventListener(\"touchend\", (e) => {\r\n      do_touch(e, \"mouseup\", 0);\r\n    }, {passive: false});\r\n\r\n    if (this.constructor.define().havePickClipboard) {\r\n      this._clipboardHotkeyInit();\r\n    }\r\n  }\r\n\r\n  /*\r\n  set default_overrides(v) {\r\n    console.error(\"default_overrides was set\", v);\r\n    this._default_overrides = v;\r\n  }\r\n\r\n  get default_overrides() {\r\n    return this._default_overrides;\r\n  }//*/\r\n\r\n  get useNativeToolTips() {\r\n    return this._useNativeToolTips;\r\n  }\r\n\r\n  set useNativeToolTips(val) {\r\n    this._useNativeToolTips = val;\r\n    this._useNativeToolTips_set = true;\r\n  }\r\n\r\n  get parentWidget() {\r\n    return this._parentWidget;\r\n  }\r\n\r\n  set parentWidget(val) {\r\n    if (val) {\r\n      this._wasAddedToNodeAtSomeTime = true;\r\n    }\r\n\r\n    this._parentWidget = val;\r\n  }\r\n\r\n  get useDataPathUndo() {\r\n    let p = this;\r\n\r\n    while (p) {\r\n      if (p._useDataPathUndo !== undefined) {\r\n        return p._useDataPathUndo;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    /* Default to true. */\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   causes calls to setPathValue to go through\r\n   toolpath app.datapath_set(path=\"\" newValueJSON=\"\")\r\n\r\n   every child will inherit\r\n   */\r\n  set useDataPathUndo(val) {\r\n    this._useDataPathUndo = val;\r\n  }\r\n\r\n  get description() {\r\n\r\n    return this._description;\r\n  }\r\n\r\n  set description(val) {\r\n    if (val === null) {\r\n      this._description = undefined;\r\n      return;\r\n    }\r\n\r\n    this._description = val;\r\n\r\n    if (val === undefined || val === null) {\r\n      return;\r\n    }\r\n\r\n    if (cconst.showPathsInToolTips && this.hasAttribute(\"datapath\")) {\r\n      let s = \"\" + this._description;\r\n\r\n      let path = this.getAttribute(\"datapath\");\r\n      s += \"\\n    path: \" + path;\r\n\r\n      if (this.hasAttribute(\"mass_set_path\")) {\r\n        let m = this.getAttribute(\"mass_set_path\");\r\n        s += \"\\n    massSetPath: \" + m;\r\n      }\r\n\r\n      this._description_final = s;\r\n    } else {\r\n      this._description_final = this._description;\r\n    }\r\n\r\n    if (cconst.useNativeToolTips) {\r\n      this.title = \"\" + this._description_final;\r\n    }\r\n  }\r\n\r\n  get background() {\r\n    return this.__background;\r\n  }\r\n\r\n  set background(bg) {\r\n    this.__background = bg;\r\n\r\n    this.overrideDefault(\"background-color\", bg, true);\r\n    this.style[\"background-color\"] = bg;\r\n  }\r\n\r\n  get disabled() {\r\n    //hrm, I could just propegate checks upward. . .\r\n\r\n    if (this.parentWidget && this.parentWidget.disabled) {\r\n      return true;\r\n    }\r\n\r\n    return !!this._client_disabled_set || !!this._internalDisabled;// || !!this._parent_disabled_set;\r\n  }\r\n\r\n  set disabled(v) {\r\n    this._client_disabled_set = v;\r\n    this.__updateDisable(this.disabled);\r\n  }\r\n\r\n  get internalDisabled() {\r\n    return this._internalDisabled;\r\n  }\r\n\r\n  set internalDisabled(val) {\r\n    this._internalDisabled = !!val;\r\n\r\n    this.__updateDisable(this.disabled);\r\n  }\r\n\r\n  get ctx() {\r\n    return this._ctx;\r\n  }\r\n\r\n  set ctx(c) {\r\n    this._ctx = c;\r\n\r\n    this._forEachChildWidget((n) => {\r\n      n.ctx = c;\r\n    });\r\n  }\r\n\r\n  get _reportCtxName() {\r\n    return \"\" + this._id;\r\n  }\r\n\r\n  get modalRunning() {\r\n    return this._modaldata !== undefined;\r\n  }\r\n\r\n  static getIconEnum() {\r\n    return Icons;\r\n  }\r\n\r\n  static setDefault(element) {\r\n    return element;\r\n  }\r\n\r\n  /**DEPRECATED\r\n\r\n   scaling ratio (e.g. for high-resolution displays)\r\n   */\r\n  static getDPI() {\r\n    //if (dpistack.length > 0) {\r\n    //  return dpistack[this.dpistack.length-1];\r\n    //} else {\r\n    //if (util.isMobile()) {\r\n    return window.devicePixelRatio; // * visualViewport.scale;\r\n    //}\r\n\r\n    return window.devicePixelRatio;\r\n    //}\r\n  }\r\n\r\n  static prefix(name) {\r\n    return tagPrefix + name;\r\n  }\r\n\r\n  static internalRegister(cls) {\r\n    cls[ClassIdSymbol] = class_idgen++;\r\n\r\n    registered_has_happened = true;\r\n\r\n    internalElementNames[cls.define().tagname] = this.prefix(cls.define().tagname);\r\n    customElements.define(this.prefix(cls.define().tagname), cls);\r\n  }\r\n\r\n  static getInternalName(name) {\r\n    return internalElementNames[name];\r\n  }\r\n\r\n  static createElement(name, internal = false) {\r\n    if (!internal && name in externalElementNames) {\r\n      return document.createElement(name);\r\n    } else if (name in internalElementNames) {\r\n      return document.createElement(internalElementNames[name]);\r\n    } else {\r\n      return document.createElement(name)\r\n    }\r\n  }\r\n\r\n  static register(cls) {\r\n    registered_has_happened = true;\r\n\r\n    cls[ClassIdSymbol] = class_idgen++;\r\n\r\n    ElementClasses.push(cls);\r\n\r\n    externalElementNames[cls.define().tagname] = cls.define().tagname;\r\n    customElements.define(cls.define().tagname, cls);\r\n  }\r\n\r\n  /**\r\n   * Defines core attributes of the class\r\n   *\r\n   * @example\r\n   *\r\n   * static define() {return {\r\n   *   tagname             : \"custom-element-x\",\r\n   *   style               : \"[style class in theme]\"\r\n   *   subclassChecksTheme : boolean //set to true to disable base class invokation of checkTheme()\r\n   *   havePickClipboard   : boolean //whether element supports mouse hover copy/paste\r\n   *   pasteForAllChildren : boolean //mouse hover paste happens even over child widgets\r\n   *   copyForAllChildren  : boolean //mouse hover copy happens even over child widgets\r\n   * }}\r\n   */\r\n  static define() {\r\n    throw new Error(\"Missing define() for ux element\");\r\n  }\r\n\r\n  setUndo(val) {\r\n    this.useDataPathUndo = val;\r\n    return this;\r\n  }\r\n\r\n  set hidden(state) {\r\n    state = !!state;\r\n    super.hidden = state;\r\n\r\n    for (let n of this.shadow.childNodes) {\r\n      n.hidden = state;\r\n    }\r\n\r\n    this._forEachChildWidget((n) => {\r\n      n.hide(state);\r\n    })\r\n  }\r\n\r\n  get hidden() {\r\n    return super.hidden;\r\n  }\r\n\r\n  hide(sethide = true) {\r\n    this.hidden = sethide;\r\n    return this;\r\n  }\r\n\r\n  getElementById(id) {\r\n    let ret;\r\n\r\n    let rec = (n) => {\r\n      if (ret) {\r\n        return;\r\n      }\r\n\r\n      if (n.getAttribute(\"id\") === id || n.id === id) {\r\n        ret = n;\r\n      }\r\n\r\n      if (n instanceof UIBase && n.constructor.define().tagname === \"panelframe-x\") {\r\n        rec(n.contents);\r\n      } else if (n instanceof UIBase && n.constructor.define().tagname === \"tabcontainer-x\") {\r\n        for (let k in n.tabs) {\r\n          let tab = n.tabs[k];\r\n\r\n          if (tab) {\r\n            rec(tab);\r\n          }\r\n        }\r\n      }\r\n\r\n      for (let n2 of n.childNodes) {\r\n        if (n2 instanceof HTMLElement) {\r\n          rec(n2);\r\n\r\n          if (ret) {\r\n            break;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (n.shadow) {\r\n        for (let n2 of n.shadow.childNodes) {\r\n          if (n2 instanceof HTMLElement) {\r\n            rec(n2);\r\n\r\n            if (ret) {\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    rec(this);\r\n\r\n    return ret;\r\n  }\r\n\r\n  unhide() {\r\n    this.hide(false);\r\n  }\r\n\r\n  findArea() {\r\n    let p = this;\r\n\r\n    while (p) {\r\n      if (p instanceof Area) {\r\n        return p;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    return p;\r\n  }\r\n\r\n  addEventListener(type, cb, options) {\r\n    if (cconst.DEBUG.domEventAddRemove) {\r\n      console.log(\"addEventListener\", type, this._id, options);\r\n    }\r\n\r\n    let cb2 = (e) => {\r\n      if (cconst.DEBUG.paranoidEvents) {\r\n        if (this.isDead()) {\r\n          this.removeEventListener(type, cb, options);\r\n          return;\r\n        }\r\n      }\r\n\r\n      if (cconst.DEBUG.domEvents) {\r\n        pathDebugEvent(e);\r\n      }\r\n\r\n      let area = this.findArea();\r\n\r\n      if (area) {\r\n        area.push_ctx_active();\r\n        try {\r\n          let ret = cb(e);\r\n          area.pop_ctx_active();\r\n          return ret;\r\n        } catch (error) {\r\n          area.pop_ctx_active();\r\n          throw error;\r\n        }\r\n      } else {\r\n        if (cconst.DEBUG.areaContextPushes) {\r\n          console.warn(\"Element is not part of an area?\", element);\r\n        }\r\n\r\n        return cb(e);\r\n      }\r\n    };\r\n\r\n    if (!cb[EventCBSymbol]) {\r\n      cb[EventCBSymbol] = new Map();\r\n    }\r\n\r\n    let key = calcElemCBKey(this, type, options);\r\n    cb[EventCBSymbol].set(key, cb2);\r\n\r\n    if (cconst.DEBUG.paranoidEvents) {\r\n      this.__cbs.push([type, cb2, options]);\r\n    }\r\n\r\n    return super.addEventListener(type, cb2, options);\r\n  }\r\n\r\n  removeEventListener(type, cb, options) {\r\n    if (cconst.DEBUG.paranoidEvents) {\r\n      for (let item of this.__cbs) {\r\n        if (item[0] == type && item[1] === cb._cb2 && (\"\" + item[2]) === (\"\" + options)) {\r\n          this.__cbs.remove(item);\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (cconst.DEBUG.domEventAddRemove) {\r\n      console.log(\"removeEventListener\", type, this._id, options);\r\n    }\r\n\r\n    let key = calcElemCBKey(this, type, options);\r\n\r\n    if (!cb[EventCBSymbol] || !cb[EventCBSymbol].has(key)) {\r\n      return super.removeEventListener(type, cb, options);\r\n    } else {\r\n      let cb2 = cb[EventCBSymbol].get(key);\r\n\r\n      let ret = super.removeEventListener(type, cb2, options);\r\n\r\n      cb[EventCBSymbol].delete(key);\r\n      return ret;\r\n    }\r\n  }\r\n\r\n  connectedCallback() {\r\n\r\n  }\r\n\r\n  noMarginsOrPadding() {\r\n    let keys = [\"margin\", \"padding\", \"margin-block-start\", \"margin-block-end\"];\r\n    keys = keys.concat([\"padding-block-start\", \"padding-block-end\"]);\r\n\r\n    keys = keys.concat([\"margin-left\", \"margin-top\", \"margin-bottom\", \"margin-right\"]);\r\n    keys = keys.concat([\"padding-left\", \"padding-top\", \"padding-bottom\", \"padding-right\"]);\r\n\r\n    for (let k of keys) {\r\n      this.style[k] = \"0px\";\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * find owning screen and tell it to update\r\n   * the global tab order\r\n   * */\r\n  regenTabOrder() {\r\n    let screen = this.getScreen();\r\n    if (screen !== undefined) {\r\n      screen.needsTabRecalc = true;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  noMargins() {\r\n    this.style[\"margin\"] = this.style[\"margin-left\"] = this.style[\"margin-right\"] = \"0px\";\r\n    this.style[\"margin-top\"] = this.style[\"margin-bottom\"] = \"0px\";\r\n    return this;\r\n  }\r\n\r\n  noPadding() {\r\n    this.style[\"padding\"] = this.style[\"padding-left\"] = this.style[\"padding-right\"] = \"0px\";\r\n    this.style[\"padding-top\"] = this.style[\"padding-bottom\"] = \"0px\";\r\n    return this;\r\n  }\r\n\r\n  getTotalRect() {\r\n    let found = false;\r\n\r\n    let min = new Vector2([1e17, 1e17]);\r\n    let max = new Vector2([-1e17, -1e17]);\r\n\r\n    let doaabb = (n) => {\r\n      let rs = n.getClientRects();\r\n\r\n      for (let r of rs) {\r\n        min[0] = Math.min(min[0], r.x);\r\n        min[1] = Math.min(min[1], r.y);\r\n        max[0] = Math.max(max[0], r.x + r.width);\r\n        max[1] = Math.max(max[1], r.y + r.height);\r\n\r\n        found = true;\r\n      }\r\n    };\r\n\r\n    doaabb(this);\r\n\r\n    this._forEachChildWidget((n) => {\r\n      doaabb(n);\r\n    });\r\n\r\n    if (found) {\r\n      return {\r\n        width : max[0] - min[0],\r\n        height: max[1] - min[1],\r\n        x     : min[0],\r\n        y     : min[1],\r\n        left  : min[0],\r\n        top   : min[1],\r\n        right : max[0],\r\n        bottom: max[1]\r\n      };\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  parseNumber(value, args = {}) {\r\n    value = (\"\" + value).trim().toLowerCase();\r\n\r\n    let baseUnit = args.baseUnit || this.baseUnit;\r\n    let isInt = args.isInt || this.isInt;\r\n\r\n    let sign = 1.0;\r\n\r\n    if (value.startsWith(\"-\")) {\r\n      value = value.slice(1, value.length).trim();\r\n      sign = -1;\r\n    }\r\n\r\n    let hexre = /-?[0-9a-f]+h$/;\r\n\r\n    if (value.startsWith(\"0b\")) {\r\n      value = value.slice(2, value.length).trim();\r\n      value = parseInt(value, 2);\r\n    } else if (value.startsWith(\"0x\")) {\r\n      value = value.slice(2, value.length).trim();\r\n      value = parseInt(value, 16);\r\n    } else if (value.search(hexre) === 0) {\r\n      value = value.slice(0, value.length - 1).trim();\r\n      value = parseInt(value, 16);\r\n    } else {\r\n      value = units.parseValue(value, baseUnit);\r\n    }\r\n\r\n    if (isInt) {\r\n      value = ~~value;\r\n    }\r\n\r\n    return value*sign;\r\n  }\r\n\r\n  formatNumber(value, args = {}) {\r\n    let baseUnit = args.baseUnit || this.baseUnit;\r\n    let displayUnit = args.displayUnit || this.displayUnit;\r\n    let isInt = args.isInt || this.isInt;\r\n    let radix = args.radix || this.radix || 10;\r\n    let decimalPlaces = args.decimalPlaces || this.decimalPlaces;\r\n\r\n    //console.log(this.baseUnit, this.displayUnit);\r\n\r\n    if (isInt && radix !== 10) {\r\n      let ret = Math.floor(value).toString(radix);\r\n\r\n      if (radix === 2)\r\n        return \"0b\" + ret;\r\n      else if (radix === 16)\r\n        return ret + \"h\";\r\n    }\r\n\r\n    return units.buildString(value, baseUnit, decimalPlaces, displayUnit);\r\n  }\r\n\r\n  setBoxCSS(subkey) {\r\n    let boxcode = '';\r\n\r\n    //debugger;\r\n\r\n    let keys = [\"left\", \"right\", \"top\", \"bottom\"];\r\n\r\n    let sub;\r\n    if (subkey) {\r\n      sub = this.getAttribute(subkey) || {};\r\n    }\r\n\r\n    let def = (key) => {\r\n      if (sub) {\r\n        return this.getSubDefault(subkey, key);\r\n      }\r\n\r\n      return this.getDefault(key);\r\n    }\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let key = i ? \"padding\" : \"margin\";\r\n\r\n      this.style[key] = \"unset\";\r\n\r\n      let val = def(key);\r\n      if (val !== undefined) { //handle default first\r\n        for (let j = 0; j < 4; j++) {\r\n          this.style[key + \"-\" + keys[j]] = val + \"px\";\r\n        }\r\n      }\r\n\r\n      for (let j = 0; j < 4; j++) { //now do box sides\r\n        let key2 = `${key}-${keys[j]}`;\r\n        let val2 = def(key2);\r\n\r\n        if (val2 !== undefined) {\r\n          this.style[key2] = val2 + \"px\";\r\n        }\r\n      }\r\n\r\n    }\r\n\r\n    this.style[\"border-radius\"] = def(\"border-radius\") + \"px\";\r\n    this.style[\"border\"] = `${def(\"border-width\")}px ${def(\"border-style\")} ${def(\"border-color\")}`;\r\n  }\r\n\r\n  genBoxCSS(subkey) {\r\n    let boxcode = '';\r\n\r\n    let keys = [\"left\", \"right\", \"top\", \"bottom\"];\r\n\r\n    let sub;\r\n    if (subkey) {\r\n      sub = this.getAttribute(subkey) || {};\r\n    }\r\n\r\n    let def = (key) => {\r\n      if (sub) {\r\n        return this.getSubDefault(subkey, key);\r\n      }\r\n\r\n      return this.getDefault(key);\r\n    }\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let key = i ? \"padding\" : \"margin\";\r\n\r\n      let val = def(key);\r\n      if (val !== undefined) {\r\n        boxcode += `${key}: ${val} px;\\n`;\r\n      }\r\n\r\n      for (let j = 0; j < 4; j++) {\r\n        let key2 = `${key}-${keys[j]}`;\r\n        let val2 = def(key2);\r\n\r\n        if (val2 !== undefined) {\r\n          boxcode += `${key2}: ${val}px;\\n`;\r\n        }\r\n      }\r\n    }\r\n\r\n    boxcode += `border-radius: ${def(\"border-radius\")}px;\\n`;\r\n    boxcode += `border: ${def(\"border-width\")}px ${def(\"border-style\")} ${def(\"border-color\")};\\n`;\r\n\r\n    return boxcode;\r\n  }\r\n\r\n  setCSS(setBG = true) {\r\n    if (setBG) {\r\n      let bg = this.getDefault(\"background-color\");\r\n      if (bg) {\r\n        this.style[\"background-color\"] = bg;\r\n      }\r\n    }\r\n\r\n    let zoom = this.getZoom();\r\n    if (zoom === 1.0) {\r\n      return;\r\n    }\r\n\r\n    let transform = \"\" + this.style[\"transform\"];\r\n\r\n    //try to preserve user set transform by selectively deleting scale\r\n    //kind of hackish. . .\r\n\r\n    //normalize whitespace\r\n    transform = transform.replace(/[ \\t\\n\\r]+/g, ' ');\r\n    transform = transform.replace(/, /g, ',');\r\n\r\n    //cut out scale\r\n    let transform2 = transform.replace(/scale\\([^)]+\\)/, '').trim();\r\n    this.style[\"transform\"] = transform2 + ` scale(${zoom},${zoom})`;\r\n  }\r\n\r\n  flushSetCSS() {\r\n    //check init\r\n    this._init();\r\n\r\n    this.setCSS();\r\n\r\n    this._forEachChildWidget((c) => {\r\n      if (!(c.packflag & PackFlags.NO_UPDATE)) {\r\n        c.flushSetCSS();\r\n      }\r\n    });\r\n  }\r\n\r\n  /* Why is the DOM API argument order swapped here?*/\r\n  replaceChild(newnode, node) {\r\n    for (let i = 0; i < this.childNodes.length; i++) {\r\n      if (this.childNodes[i] === node) {\r\n        super.replaceChild(newnode, node);\r\n        return true;\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < this.shadow.childNodes.length; i++) {\r\n      if (this.shadow.childNodes[i] === node) {\r\n        this.shadow.replaceChild(newnode, node);\r\n        return true;\r\n      }\r\n    }\r\n\r\n    console.error(\"Unknown child node\", node);\r\n    return false;\r\n  }\r\n\r\n  swapWith(b) {\r\n    let p1 = this.parentNode;\r\n    let p2 = b.parentNode;\r\n\r\n    if (this.parentWidget && (p1 === this.parentWidget.shadow) || p1 === null) {\r\n      p1 = this.parentWidget;\r\n    }\r\n\r\n    if (b.parentWidget && (p2 === b.parentWidget.shadow) || p2 === null) {\r\n      p2 = b.parentWidget;\r\n    }\r\n\r\n    if (!p1 || !p2) {\r\n      console.error(\"Invalid call to UIBase.prototype.swapWith\", this, b, p1, p2);\r\n      return false;\r\n    }\r\n\r\n    let getPos = (n, p) => {\r\n      let i = Array.prototype.indexOf.call(p.childNodes, n);\r\n\r\n      if (i < 0 && p.shadow) {\r\n        p = p.shadow;\r\n        i = Array.prototype.indexOf.call(p.childNodes, n);\r\n      }\r\n\r\n      return [i, p];\r\n    }\r\n\r\n    let [i1, n1] = getPos(this, p1);\r\n    let [i2, n2] = getPos(b, p2);\r\n\r\n    console.log(\"i1, i2, n1, n2\", i1, i2, n1, n2);\r\n\r\n    let tmp1 = document.createElement(\"div\");\r\n    let tmp2 = document.createElement(\"div\");\r\n\r\n    n1.insertBefore(tmp1, this);\r\n    n2.insertBefore(tmp2, b);\r\n\r\n    //HTMLElement.prototype.remove.call(this);\r\n    //HTMLElement.prototype.remove.call(b);\r\n\r\n    n1.replaceChild(b, tmp1);\r\n    n2.replaceChild(this, tmp2);\r\n\r\n    let ptmp = this.parentWidget;\r\n    this.parentWidget = b.parentWidget;\r\n    b.parentWidget = ptmp;\r\n\r\n    tmp1.remove();\r\n    tmp2.remove();\r\n\r\n    return true;\r\n  }\r\n\r\n  traverse(type_or_set) {\r\n    let this2 = this;\r\n\r\n    let classes = type_or_set;\r\n\r\n    let is_set = type_or_set instanceof Set;\r\n    is_set = is_set || type_or_set instanceof util.set;\r\n    is_set = is_set || Array.isArray(type_or_set);\r\n\r\n    if (!is_set) {\r\n      classes = [type_or_set];\r\n    }\r\n\r\n    let visit = new Set();\r\n\r\n    return (function* () {\r\n      let stack = [this2];\r\n\r\n      while (stack.length > 0) {\r\n        let n = stack.pop();\r\n\r\n        visit.add(n);\r\n\r\n        if (!n || !n.childNodes) {\r\n          continue;\r\n        }\r\n\r\n        for (let cls of classes) {\r\n          if (n instanceof cls) {\r\n            yield n;\r\n          }\r\n        }\r\n\r\n        for (let c of n.childNodes) {\r\n          if (!visit.has(c)) {\r\n            stack.push(c);\r\n          }\r\n        }\r\n\r\n        if (n.shadow) {\r\n          for (let c of n.shadow.childNodes) {\r\n            if (!visit.has(c)) {\r\n              stack.push(c);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    })();\r\n  }\r\n\r\n  appendChild(child) {\r\n    if (child instanceof UIBase) {\r\n      child.ctx = this.ctx;\r\n      child.parentWidget = this;\r\n\r\n      child.useDataPathUndo = this.useDataPathUndo;\r\n    }\r\n\r\n    return super.appendChild(child);\r\n  }\r\n\r\n  _clipboardHotkeyInit() {\r\n    this._clipboard_over = false;\r\n    this._last_clipboard_keyevt = undefined;\r\n\r\n    this._clipboard_keystart = () => {\r\n      if (this._clipboard_events) {\r\n        return;\r\n      }\r\n\r\n      this._clipboard_events = true;\r\n      window.addEventListener(\"keydown\", this._clipboard_keydown, {capture: true, passive: false});\r\n    }\r\n\r\n    this._clipboard_keyend = () => {\r\n      if (!this._clipboard_events) {\r\n        return;\r\n      }\r\n\r\n      this._clipboard_events = false;\r\n      window.removeEventListener(\"keydown\", this._clipboard_keydown, {capture: true, passive: false});\r\n    }\r\n\r\n    this._clipboard_keydown = (e, internal_mode) => {\r\n      if (!this.isConnected || !cconst.getClipboardData) {\r\n        this._clipboard_keyend();\r\n        return;\r\n      }\r\n\r\n      if (e === this._last_clipboard_keyevt || !this._clipboard_over) {\r\n        return;\r\n      }\r\n\r\n      /* the user's mouse cursor might not be over the element\r\n      *  if they've tabbed to it */\r\n\r\n      let is_copy = e.keyCode === keymap[\"C\"] && (e.ctrlKey || e.commandKey) && !e.shiftKey && !e.altKey;\r\n      let is_paste = e.keyCode === keymap[\"V\"] && (e.ctrlKey || e.commandKey) && !e.shiftKey && !e.altKey;\r\n\r\n      if (!is_copy && !is_paste) {\r\n        //early out, remember that pickElement is highly expensive to run\r\n        return;\r\n      }\r\n\r\n      //pasteForAllChildren\r\n      if (!internal_mode) {\r\n        let screen = this.ctx.screen;\r\n        let elem = screen.pickElement(screen.mpos[0], screen.mpos[1]);\r\n\r\n        let checkTree = is_paste && this.constructor.define().pasteForAllChildren;\r\n        checkTree = checkTree || (is_copy && this.constructor.define().copyForAllChildren);\r\n\r\n        while (checkTree && !(elem instanceof TextBox) && elem !== this && elem.parentWidget) {\r\n          console.log(\"  \" + elem._id);\r\n\r\n          elem = elem.parentWidget;\r\n        }\r\n\r\n        console.warn(\"COLOR\", this._id, elem._id);\r\n\r\n        if (elem !== this) {\r\n          //remove global keyhandler\r\n          this._clipboard_keyend();\r\n          return;\r\n        }\r\n      } else {\r\n        console.warn(\"COLOR\", this._id);\r\n      }\r\n\r\n      this._last_clipboard_keyevt = e;\r\n\r\n      if (is_copy) {\r\n        this.clipboardCopy();\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n\r\n      if (is_paste) {\r\n        this.clipboardPaste();\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n    }\r\n\r\n    let start = (e) => {\r\n      this._clipboard_over = true;\r\n      this._clipboard_keystart();\r\n    }\r\n\r\n    let stop = (e) => {\r\n      this._clipboard_over = false;\r\n      this._clipboard_keyend();\r\n    }\r\n\r\n    this.doOnce(() => {\r\n      this.tabIndex = 0; //enable self key events when element has focus\r\n    });\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      return this._clipboard_keydown(e, true);\r\n    });\r\n\r\n    this.addEventListener(\"pointerover\", start, {capture: true, passive: true});\r\n    this.addEventListener(\"pointerout\", stop, {capture: true, passive: true});\r\n    this.addEventListener(\"focus\", stop, {capture: true, passive: true});\r\n  }\r\n\r\n  /** set havePickClipboard to true in define() to\r\n   *  enable mouseover pick clipboarding */\r\n  clipboardCopy() {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  clipboardPaste() {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  //delayed init\r\n  init() {\r\n    this._init_done = true;\r\n\r\n    if (!this.hasAttribute(\"id\") && this._id) {\r\n      this.setAttribute(\"id\", this._id);\r\n    }\r\n  }\r\n\r\n  _ondestroy() {\r\n    if (this.tabIndex >= 0) {\r\n      this.regenTabOrder();\r\n    }\r\n\r\n    if (cconst.DEBUG.paranoidEvents) {\r\n      for (let item of this.__cbs) {\r\n        this.removeEventListener(item[0], item[1], item[2]);\r\n      }\r\n\r\n      this.__cbs = [];\r\n    }\r\n\r\n\r\n    if (this.ondestroy !== undefined) {\r\n      this.ondestroy();\r\n    }\r\n  }\r\n\r\n  remove(trigger_on_destroy = true) {\r\n    if (this.tabIndex >= 0) {\r\n      this.regenTabOrder();\r\n    }\r\n\r\n    super.remove();\r\n\r\n    if (trigger_on_destroy) {\r\n      this._ondestroy();\r\n    }\r\n\r\n    if (this.on_remove) {\r\n      this.on_remove();\r\n    }\r\n\r\n    this.parentWidget = undefined;\r\n  }\r\n\r\n  /*\r\n  *\r\n  * called when elements are removed.\r\n  * you should assume the element will be reused later;\r\n  * on_destroy is the callback for when elements are permanently destroyed\r\n  * */\r\n  on_remove() {\r\n\r\n  }\r\n\r\n  removeChild(child, trigger_on_destroy = true) {\r\n    super.removeChild(child);\r\n\r\n    if (trigger_on_destroy) {\r\n      child._ondestroy();\r\n    }\r\n  }\r\n\r\n  flushUpdate(force = false) {\r\n    //check init\r\n    this._init();\r\n\r\n    this.update();\r\n\r\n    this._forEachChildWidget((c) => {\r\n      if (force || !(c.packflag & PackFlags.NO_UPDATE)) {\r\n        if (!c.ctx) {\r\n          c.ctx = this.ctx;\r\n        }\r\n\r\n        c.flushUpdate(force);\r\n      }\r\n    });\r\n  }\r\n\r\n  //used by container nodes\r\n  /**\r\n   * Iterates over all child widgets,\r\n   * including ones that might be inside\r\n   * of normal DOM nodes.\r\n   *\r\n   * This is done by recursing into the dom\r\n   * tree and stopping at any node that's\r\n   * descended from ui_base.UIBase\r\n   **/\r\n  _forEachChildWidget(cb, thisvar) {\r\n    let rec = (n) => {\r\n      if (n instanceof UIBase) {\r\n        if (thisvar !== undefined) {\r\n          cb.call(thisvar, n);\r\n        } else {\r\n          cb(n);\r\n        }\r\n      } else {\r\n        for (let n2 of n.childNodes) {\r\n          rec(n2);\r\n        }\r\n\r\n        if (n.shadow !== undefined) {\r\n          for (let n2 of n.shadow.childNodes) {\r\n            rec(n2);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    for (let n of this.childNodes) {\r\n      rec(n);\r\n    }\r\n\r\n    if (this.shadow) {\r\n      for (let n of this.shadow.childNodes) {\r\n        rec(n);\r\n      }\r\n    }\r\n  }\r\n\r\n  checkInit() {\r\n    return this._init();\r\n  }\r\n\r\n  _init() {\r\n    if (this._init_done) {\r\n      return false;\r\n    }\r\n\r\n    this._init_done = true;\r\n    this.init();\r\n\r\n    return true;\r\n  }\r\n\r\n  getWinWidth() {\r\n    return window.innerWidth;\r\n  }\r\n\r\n  getWinHeight() {\r\n    return window.innerHeight;\r\n  }\r\n\r\n  calcZ() {\r\n    let p = this;\r\n    let n = this;\r\n\r\n    while (n) {\r\n      if (n.style && n.style[\"z-index\"]) {\r\n        let z = parseFloat(n.style[\"z-index\"]);\r\n        return z;\r\n      }\r\n\r\n      n = n.parentNode;\r\n\r\n      if (!n) {\r\n        n = p = p.parentWidget;\r\n      }\r\n    }\r\n\r\n    return 0;\r\n  }\r\n\r\n  pickElement(x, y, args = {}, marginy = 0, nodeclass = UIBase, excluded_classes = undefined) {\r\n    let clip;\r\n    let mouseEvent;\r\n    let isMouseMove, isMouseDown;\r\n\r\n    if (typeof args === \"object\") {\r\n      nodeclass = args.nodeclass || UIBase;\r\n      excluded_classes = args.excluded_classes;\r\n      clip = args.clip;\r\n      mouseEvent = args.mouseEvent;\r\n    } else {\r\n      args = {\r\n        nodeclass       : nodeclass || UIBase,\r\n        excluded_classes: excluded_classes,\r\n        clip            : clip\r\n      }\r\n    }\r\n\r\n    if (mouseEvent) {\r\n      isMouseMove = mouseEvent.type === \"mousemove\" || mouseEvent.type === \"touchmove\" || mouseEvent.type === \"pointermove\";\r\n      isMouseDown = mouseEvent.buttons || (mouseEvent.touches && mouseEvent.touches.length > 0);\r\n    }\r\n\r\n    x -= window.scrollX;\r\n    y -= window.scrollY;\r\n\r\n    let elem = document.elementFromPoint(x, y);\r\n\r\n    if (!elem) {\r\n      return;\r\n    }\r\n\r\n    let path = [elem];\r\n    let lastelem = elem;\r\n    let i = 0;\r\n\r\n    while (elem && elem.shadow) {\r\n      if (i++ > 1000) {\r\n        console.error(\"Infinite loop error\");\r\n        break;\r\n      }\r\n\r\n      elem = elem.shadow.elementFromPoint(x, y);\r\n\r\n      if (elem === lastelem) {\r\n        break;\r\n      }\r\n\r\n      if (elem) {\r\n        path.push(elem);\r\n      }\r\n\r\n      lastelem = elem;\r\n    }\r\n\r\n    path.reverse();\r\n\r\n    //console.warn(path);\r\n\r\n    for (let i = 0; i < path.length; i++) {\r\n      let node = path[i];\r\n      let ok = node instanceof nodeclass;\r\n\r\n      if (excluded_classes) {\r\n        for (let cls of excluded_classes) {\r\n          ok = ok && !(node instanceof cls);\r\n        }\r\n      }\r\n\r\n      if (clip) {\r\n        let rect = node.getBoundingClientRect();\r\n        let clip2 = math.aabb_intersect_2d(clip.pos, clip.size, [rect.x, rect.y], [rect.width, rect.height]);\r\n\r\n        ok = ok && clip2;\r\n      }\r\n\r\n      if (ok) {\r\n        window.elem = node;\r\n        //console.log(node._id);\r\n        return node;\r\n      }\r\n    }\r\n  }\r\n\r\n  __updateDisable(val) {\r\n    if (!!val === !!this.__disabledState) {\r\n      return;\r\n    }\r\n\r\n    this.__disabledState = !!val;\r\n\r\n    if (val && !this._disdata) {\r\n      let style = this.getDefault(\"disabled\") || this.getDefault(\"internalDisabled\") || {\r\n        \"background-color\": this.getDefault(\"DisabledBG\")\r\n      };\r\n\r\n      this._disdata = {\r\n        style   : {},\r\n        defaults: {}\r\n      };\r\n\r\n      for (let k in style) {\r\n        //save old style information\r\n        this._disdata.style[k] = this.style[k];\r\n        this._disdata.defaults[k] = this.default_overrides[k];\r\n\r\n        let v = style[k];\r\n\r\n        if (typeof v === \"object\" && v instanceof CSSFont) {\r\n          this.style[k] = style[k].genCSS();\r\n        } else if (typeof v === \"object\") {\r\n          continue;\r\n        } else {\r\n          this.style[k] = style[k];\r\n        }\r\n        this.default_overrides[k] = style[k];\r\n      }\r\n\r\n      this.__disabledState = !!val;\r\n      this.on_disabled();\r\n    } else if (!val && this._disdata) {\r\n\r\n      //load old style information\r\n      for (let k in this._disdata.style) {\r\n        this.style[k] = this._disdata.style[k];\r\n      }\r\n\r\n      for (let k in this._disdata.defaults) {\r\n        let v = this._disdata.defaults[k];\r\n\r\n        if (v === undefined) {\r\n          delete this.default_overrides[k];\r\n        } else {\r\n          this.default_overrides[k] = v;\r\n        }\r\n      }\r\n\r\n      //this.background = this.style[\"background-color\"];\r\n      this._disdata = undefined;\r\n\r\n      this.__disabledState = !!val;\r\n      this.on_enabled();\r\n    }\r\n\r\n    this.__disabledState = !!val;\r\n\r\n    let visit = (n) => {\r\n      if (n instanceof UIBase) {\r\n        let changed = !!n.__disabledState;\r\n\r\n        /*\r\n        if (val) {\r\n          n._parent_disabled_set = Math.max(n._parent_disabled_set + 1, 0);\r\n        } else {\r\n          n._parent_disabled_set = Math.max(n._parent_disabled_set - 1, 0);\r\n        }//*/\r\n\r\n        n.__updateDisable(n.disabled);\r\n\r\n        changed = changed !== !!n.__disabledState;\r\n        if (changed) {\r\n          n.update();\r\n          n.setCSS();\r\n        }\r\n      }\r\n    };\r\n\r\n    this._forEachChildWidget(visit);\r\n  }\r\n\r\n  on_disabled() {\r\n\r\n  }\r\n\r\n  on_enabled() {\r\n\r\n  }\r\n\r\n  pushModal(handlers = this, autoStopPropagation = true, pointerId = undefined, pointerElem = this) {\r\n    if (this._modaldata !== undefined) {\r\n      console.warn(\"UIBase.prototype.pushModal called when already in modal mode\");\r\n      this.popModal();\r\n    }\r\n\r\n    let _areaWrangler = contextWrangler.copy();\r\n\r\n    contextWrangler.copy(this.ctx);\r\n\r\n    function bindFunc(func) {\r\n      return function () {\r\n        _areaWrangler.copyTo(contextWrangler);\r\n\r\n        return func.apply(handlers, arguments);\r\n      }\r\n    }\r\n\r\n    let handlers2 = {};\r\n    for (let k in handlers) {\r\n      let func = handlers[k];\r\n\r\n      if (typeof func !== \"function\") {\r\n        continue;\r\n      }\r\n\r\n      handlers2[k] = bindFunc(func);\r\n    }\r\n    //this._modalstack.push(this.ctx);\r\n    //this.ctx = this.ctx.toLocked();\r\n\r\n    if (pointerId !== undefined && pointerElem) {\r\n      this._modaldata = pushPointerModal(handlers2, autoStopPropagation);\r\n    } else {\r\n      this._modaldata = pushModalLight(handlers2, autoStopPropagation);\r\n    }\r\n\r\n    return this._modaldata;\r\n  }\r\n\r\n  popModal() {\r\n    if (this._modaldata === undefined) {\r\n      console.warn(\"Invalid call to UIBase.prototype.popModal\");\r\n      return;\r\n    }\r\n\r\n    //this.ctx = this._modalstack.pop();\r\n    popModalLight(this._modaldata);\r\n    this._modaldata = undefined;\r\n  }\r\n\r\n  /** child classes can override this to prevent focus on flash*/\r\n  _flash_focus() {\r\n    this.focus();\r\n  }\r\n\r\n  flash(color, rect_element = this, timems = 355, autoFocus = true) {\r\n    if (typeof color != \"object\") {\r\n      color = css2color(color);\r\n    }\r\n    color = new Vector4(color);\r\n    let csscolor = color2css(color);\r\n\r\n    if (this._flashtimer !== undefined && this._flashcolor !== csscolor) {\r\n      window.setTimeout(() => {\r\n        this.flash(color, rect_element, timems, autoFocus);\r\n      }, 100);\r\n\r\n      return;\r\n    } else if (this._flashtimer !== undefined) {\r\n      return;\r\n    }\r\n\r\n    //let rect = rect_element.getClientRects()[0];\r\n    let rect = rect_element.getBoundingClientRect();\r\n\r\n    if (rect === undefined) {\r\n      return;\r\n    }\r\n\r\n    //okay, dom apparently calls onchange() on .remove, so we have\r\n    //to put the timer code first to avoid loops\r\n    let timer;\r\n    let tick = 0;\r\n    let max = ~~(timems/20);\r\n\r\n    let x = rect.x, y = rect.y;\r\n\r\n    let cb = (e) => {\r\n      if (timer === undefined) {\r\n        return\r\n      }\r\n\r\n      let a = 1.0 - tick/max;\r\n      div.style[\"background-color\"] = color2css(color, a*a*0.5);\r\n\r\n      if (tick > max) {\r\n        window.clearInterval(timer);\r\n\r\n        this._flashtimer = undefined;\r\n        this._flashcolor = undefined;\r\n        timer = undefined;\r\n\r\n        div.remove();\r\n\r\n        if (autoFocus) {\r\n          this._flash_focus();\r\n        }\r\n      }\r\n\r\n      tick++;\r\n    };\r\n\r\n    window.setTimeout(cb, 5);\r\n    this._flashtimer = timer = window.setInterval(cb, 20);\r\n\r\n    let div = document.createElement(\"div\");\r\n\r\n    div.style[\"pointer-events\"] = \"none\";\r\n    div.tabIndex = undefined;\r\n    div.style[\"z-index\"] = \"900\";\r\n    div.style[\"display\"] = \"float\";\r\n    div.style[\"position\"] = UIBase.PositionKey;\r\n    div.style[\"margin\"] = \"0px\";\r\n    div.style[\"left\"] = x + \"px\";\r\n    div.style[\"top\"] = y + \"px\";\r\n\r\n    div.style[\"background-color\"] = color2css(color, 0.5);\r\n    div.style[\"width\"] = rect.width + \"px\";\r\n    div.style[\"height\"] = rect.height + \"px\";\r\n    div.setAttribute(\"class\", \"UIBaseFlash\");\r\n\r\n    let screen = this.getScreen();\r\n    if (screen !== undefined) {\r\n      screen._enterPopupSafe();\r\n    }\r\n\r\n    document.body.appendChild(div);\r\n    if (autoFocus) {\r\n      this._flash_focus();\r\n    }\r\n\r\n    this._flashcolor = csscolor;\r\n\r\n    if (screen !== undefined) {\r\n      screen._exitPopupSafe();\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n  }\r\n\r\n  on_resize(newsize) {\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = {};\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      ret.datapath = this.getAttribute(\"datapath\");\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    if (!this._init_done) {\r\n      this._init();\r\n    }\r\n  }\r\n\r\n  getPathValue(ctx, path) {\r\n    try {\r\n      return ctx.api.getValue(ctx, path);\r\n    } catch (error) {\r\n      //report(\"data path error in ui for\" + path);\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  undoBreakPoint() {\r\n    this.pathUndoGen++;\r\n  }\r\n\r\n  setPathValueUndo(ctx, path, val) {\r\n    this.pathSocketUpdate(ctx, path);\r\n\r\n    let mass_set_path = this.getAttribute(\"mass_set_path\");\r\n    let rdef = ctx.api.resolvePath(ctx, path);\r\n    let prop = rdef.prop;\r\n\r\n    if (ctx.api.getValue(ctx, path) === val) {\r\n      return;\r\n    }\r\n\r\n    let toolstack = this.ctx.toolstack;\r\n    let head = toolstack.head;\r\n\r\n    let bad = head === undefined || !(head instanceof getDataPathToolOp());\r\n    bad = bad || head.hashThis() !== head.hash(mass_set_path, path, prop.type, this._id);\r\n    bad = bad || this.pathUndoGen !== this._lastPathUndoGen;\r\n\r\n    //if (head !== undefined && head instanceof getDataPathToolOp()) {\r\n    //console.log(\"===>\", bad, head.hashThis());\r\n    //console.log(\"    ->\", head.hash(mass_set_path, path, prop.type, this._id));\r\n    //}\r\n\r\n    if (!bad) {\r\n      toolstack.undo();\r\n      head.setValue(ctx, val, rdef.obj);\r\n      toolstack.redo();\r\n    } else {\r\n      this._lastPathUndoGen = this.pathUndoGen;\r\n\r\n      let toolop = getDataPathToolOp().create(ctx, path, val, this._id, mass_set_path);\r\n\r\n      /* getDataPathToolOp.create can return false in case of no-op paths. */\r\n      if (!toolop) {\r\n        return;\r\n      }\r\n\r\n      ctx.toolstack.execTool(this.ctx, toolop);\r\n      head = toolstack.head;\r\n    }\r\n\r\n    if (!head || head.hadError === true) {\r\n      throw new Error(\"toolpath error\");\r\n    }\r\n  }\r\n\r\n  loadNumConstraints(prop = undefined, dom = this, onModifiedCallback = undefined) {\r\n    let modified = false;\r\n\r\n    if (!prop) {\r\n      let path;\r\n\r\n      if (dom.hasAttribute(\"datapath\")) {\r\n        path = dom.getAttribute(\"datapath\");\r\n      }\r\n\r\n      if (path === undefined && this.hasAttribute(\"datapath\")) {\r\n        path = this.getAttribute(\"datapath\");\r\n      }\r\n\r\n      if (typeof path === \"string\") {\r\n        prop = this.getPathMeta(this.ctx, path);\r\n      }\r\n    }\r\n\r\n    let loadAttr = (propkey, domkey = key, thiskey = key) => {\r\n      let old = this[thiskey];\r\n\r\n      if (dom.hasAttribute(domkey)) {\r\n        this[thiskey] = parseFloat(dom.getAttribute(domkey));\r\n      } else if (prop) {\r\n        this[thiskey] = prop[propkey];\r\n      }\r\n\r\n      if (this[thiskey] !== old) {\r\n        modified = true;\r\n      }\r\n    }\r\n\r\n    for (let key of NumberConstraints) {\r\n      let thiskey = key, domkey = key;\r\n\r\n      if (key === \"range\") { //handled later\r\n        continue;\r\n      }\r\n\r\n      loadAttr(key, domkey, thiskey);\r\n    }\r\n\r\n    let oldmin = this.range[0];\r\n    let oldmax = this.range[1];\r\n\r\n    let range = prop ? prop.range : undefined;\r\n    if (range && !dom.hasAttribute(\"min\")) {\r\n      this.range[0] = range[0];\r\n    } else if (dom.hasAttribute(\"min\")) {\r\n      this.range[0] = parseFloat(dom.getAttribute(\"min\"));\r\n    }\r\n\r\n    if (range && !dom.hasAttribute(\"max\")) {\r\n      this.range[1] = range[1];\r\n    } else if (dom.hasAttribute(\"max\")) {\r\n      this.range[1] = parseFloat(dom.getAttribute(\"max\"));\r\n    }\r\n\r\n    if (this.range[0] !== oldmin || this.range[1] !== oldmax) {\r\n      modified = true;\r\n    }\r\n\r\n    let oldint = this.isInt;\r\n\r\n    if (dom.getAttribute(\"integer\")) {\r\n      let val = dom.getAttribute(\"integer\");\r\n      val = (\"\" + val).toLowerCase();\r\n\r\n      //handles anonymouse <numslider-x integer> case\r\n      this.isInt = val === \"null\" || val === \"true\" || val === \"yes\" || val === \"1\";\r\n    } else if (prop && prop instanceof IntProperty) {\r\n      this.isInt = true;\r\n    }\r\n\r\n    if (!this.isInt !== !oldint) {\r\n      modified = true;\r\n    }\r\n\r\n    let oldedit = this.editAsBaseUnit;\r\n\r\n    if (this.editAsBaseUnit === undefined) {\r\n      if (prop && (prop.flag & PropFlags.EDIT_AS_BASE_UNIT)) {\r\n        this.editAsBaseUnit = true;\r\n      } else {\r\n        this.editAsBaseUnit = false;\r\n      }\r\n    }\r\n\r\n    if (!this.editAsBaseUnit !== !oldedit) {\r\n      modified = true;\r\n    }\r\n\r\n    if (modified) {\r\n      this.setCSS();\r\n\r\n      if (onModifiedCallback) {\r\n        onModifiedCallback.call(this);\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n    adds a method call to the event queue,\r\n    but only if that method (for this instance, as differentiated\r\n    by ._id) isn't there already.\r\n\r\n    also, method won't be ran until this.ctx exists\r\n  */\r\n\r\n  pushReportContext(key) {\r\n    if (this.ctx.api.pushReportContext) {\r\n      this.ctx.api.pushReportContext(key);\r\n    }\r\n  }\r\n\r\n  popReportContext() {\r\n    if (this.ctx.api.popReportContext)\r\n      this.ctx.api.popReportContext();\r\n  }\r\n\r\n  pathSocketUpdate(ctx, path) {\r\n    this.flagPropSocketUpdate(\"value\");\r\n    return this;\r\n  }\r\n\r\n  setPathValue(ctx, path, val) {\r\n    this.pathSocketUpdate(ctx, path);\r\n\r\n    if (this.useDataPathUndo) {\r\n      this.pushReportContext(this._reportCtxName);\r\n\r\n      try {\r\n        this.setPathValueUndo(ctx, path, val);\r\n      } catch (error) {\r\n        this.popReportContext();\r\n\r\n        if (!(error instanceof DataPathError)) {\r\n          throw error;\r\n        } else {\r\n          return;\r\n        }\r\n      }\r\n\r\n      this.popReportContext();\r\n      return;\r\n    }\r\n\r\n    this.pushReportContext(this._reportCtxName);\r\n\r\n    try {\r\n      if (this.hasAttribute(\"mass_set_path\")) {\r\n        ctx.api.massSetProp(ctx, this.getAttribute(\"mass_set_path\"), val);\r\n        ctx.api.setValue(ctx, path, val);\r\n      } else {\r\n        ctx.api.setValue(ctx, path, val);\r\n      }\r\n    } catch (error) {\r\n      this.popReportContext();\r\n\r\n      if (!(error instanceof DataPathError)) {\r\n        throw error;\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    this.popReportContext();\r\n  }\r\n\r\n  getPathMeta(ctx, path) {\r\n    this.pushReportContext(this._reportCtxName);\r\n    let ret = ctx.api.resolvePath(ctx, path);\r\n    this.popReportContext();\r\n\r\n    return ret !== undefined ? ret.prop : undefined;\r\n  }\r\n\r\n  getPathDescription(ctx, path) {\r\n    let ret;\r\n    this.pushReportContext(this._reportCtxName);\r\n\r\n    try {\r\n      ret = ctx.api.getDescription(ctx, path);\r\n    } catch (error) {\r\n      this.popReportContext();\r\n\r\n      if (error instanceof DataPathError) {\r\n        //console.warn(\"Invalid data path '\" + path + \"'\");\r\n        return undefined;\r\n      } else {\r\n        throw error;\r\n      }\r\n    }\r\n\r\n    this.popReportContext();\r\n    return ret;\r\n  }\r\n\r\n  getScreen() {\r\n    if (this.ctx !== undefined)\r\n      return this.ctx.screen;\r\n  }\r\n\r\n  isDead() {\r\n    return !this.isConnected;\r\n    let p = this, lastp = this;\r\n\r\n    function find(c, n) {\r\n      for (let n2 of c) {\r\n        if (n2 === n) {\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n\r\n    while (p) {\r\n      lastp = p;\r\n\r\n      let parent = p.parentWidget;\r\n      if (!parent) {\r\n        parent = p.parentElement ? p.parentElement : p.parentNode;\r\n      }\r\n\r\n      if (parent && p && !find(parent.childNodes, p)) {\r\n        if (parent.shadow !== undefined && !find(parent.shadow.childNodes)) {\r\n          return true;\r\n        }\r\n      }\r\n      p = parent;\r\n\r\n      if (p === document.body) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  doOnce(func, timeout = undefined) {\r\n    if (func._doOnce === undefined) {\r\n      func._doOnce_reqs = new Set();\r\n\r\n      func._doOnce = function (thisvar, trace) {\r\n        if (func._doOnce_reqs.has(thisvar._id)) {\r\n          return;\r\n        }\r\n\r\n        func._doOnce_reqs.add(thisvar._id);\r\n\r\n        function f() {\r\n          if (thisvar.isDead()) {\r\n            func._doOnce_reqs.delete(thisvar._id);\r\n\r\n            if (func === thisvar._init || !cconst.DEBUG.doOnce) {\r\n              return;\r\n            }\r\n\r\n            console.warn(\"Ignoring doOnce call for dead element\", thisvar._id, func, trace);\r\n            return;\r\n          }\r\n\r\n          if (!thisvar.ctx) {\r\n            if (cconst.DEBUG.doOnce) {\r\n              console.warn(\"doOnce call is waiting for context...\", thisvar._id, func);\r\n            }\r\n\r\n            internalSetTimeout(f, 0);\r\n            return;\r\n          }\r\n\r\n          func._doOnce_reqs.delete(thisvar._id);\r\n          func.call(thisvar);\r\n        };\r\n\r\n        internalSetTimeout(f, timeout);\r\n      }\r\n    }\r\n\r\n    let trace = new Error().stack;\r\n    func._doOnce(this, trace);\r\n  }\r\n\r\n  float(x = 0, y = 0, zindex = undefined, positionKey = UIBase.PositionKey) {\r\n    this.style.position = positionKey;\r\n\r\n    this.style.left = x + \"px\";\r\n    this.style.top = y + \"px\";\r\n\r\n    if (zindex !== undefined) {\r\n      this.style[\"z-index\"] = zindex\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  _ensureChildrenCtx() {\r\n    let ctx = this.ctx;\r\n    if (ctx === undefined) {\r\n      return;\r\n    }\r\n\r\n    this._forEachChildWidget((n) => {\r\n      n.parentWidget = this;\r\n\r\n      if (n.ctx === undefined) {\r\n        n.ctx = ctx;\r\n      }\r\n\r\n      n._ensureChildrenCtx(ctx);\r\n    });\r\n  }\r\n\r\n  checkThemeUpdate() {\r\n    if (!cconst.enableThemeAutoUpdate) {\r\n      return false;\r\n    }\r\n\r\n    if (_themeUpdateKey !== this._last_theme_update_key) {\r\n      this._last_theme_update_key = _themeUpdateKey;\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  abortToolTips(delayMs = 500) {\r\n    if (this._has_own_tooltips) {\r\n      this._has_own_tooltips.stop_timer();\r\n    }\r\n\r\n    if (this._tooltip_ref) {\r\n      this._tooltip_ref.remove();\r\n      this._tooltip_ref = undefined;\r\n    }\r\n\r\n    this._tool_tip_abort_delay = util.time_ms() + delayMs;\r\n\r\n    return this;\r\n  }\r\n\r\n  updateToolTipHandlers() {\r\n    if (!this._useNativeToolTips_set && !cconst.useNativeToolTips !== !this._useNativeToolTips) {\r\n      this._useNativeToolTips = cconst.useNativeToolTips;\r\n    }\r\n\r\n    if (!!this.useNativeToolTips === !this._has_own_tooltips) {\r\n      return;\r\n    }\r\n\r\n    if (!this.useNativeToolTips) {\r\n      let state = this._has_own_tooltips = {\r\n        start_timer : (e) => {\r\n          this._tooltip_timer = util.time_ms();\r\n          //console.warn(this._id, \"tooltip timer start\", e.type);\r\n        },\r\n        stop_timer  : (e) => {\r\n          //console.warn(this._id, \"tooltip timer end\", util.time_ms()-this._tooltip_timer, e.type);\r\n          this._tooltip_timer = undefined;\r\n        },\r\n        reset_timer : (e) => {\r\n          //console.warn(this._id, \"tooltip timer reset\", util.time_ms()-this._tooltip_timer, e.type);\r\n          if (this._tooltip_timer !== undefined) {\r\n            this._tooltip_timer = util.time_ms();\r\n          }\r\n        },\r\n        start_events: [\r\n          \"mouseover\"\r\n        ],\r\n        reset_events: [\r\n          \"mousemove\", \"mousedown\", \"mouseup\",\r\n          \"touchstart\", \"touchend\", \"keydown\", \"focus\"\r\n        ],\r\n        stop_events : [\r\n          \"mouseleave\", \"blur\", \"mouseout\"\r\n        ],\r\n        handlers    : {}\r\n      }\r\n\r\n      let bind_handler = (type, etype) => {\r\n        let handler = (e) => {\r\n          if (this._tool_tip_abort_delay !== undefined && util.time_ms() < this._tool_tip_abort_delay) {\r\n            this._tooltip_timer = undefined;\r\n            return;\r\n          }\r\n\r\n          state[type](e);\r\n        };\r\n\r\n        if (etype in state.handlers) {\r\n          console.error(type, \"is in handlers already\");\r\n          return;\r\n        }\r\n\r\n        state.handlers[etype] = handler;\r\n        return handler;\r\n      }\r\n\r\n      let i = 0;\r\n      let lists = [state.start_events, state.stop_events, state.reset_events];\r\n\r\n      for (let type of [\"start_timer\", \"stop_timer\", \"reset_timer\"]) {\r\n        for (let etype of lists[i]) {\r\n          this.addEventListener(etype, bind_handler(type, etype), {passive: true});\r\n        }\r\n\r\n        i++;\r\n      }\r\n    } else {\r\n      console.warn(this.id, \"removing tooltip handlers\");\r\n      let state = this._has_own_tooltips;\r\n\r\n      for (let k in this.state.handlers) {\r\n        let handler = this.state.handlers[k];\r\n        this.removeEventListener(k, handler);\r\n      }\r\n\r\n      this._has_own_tooltips = undefined;\r\n      this._tooltip_timer = undefined;\r\n    }\r\n  }\r\n\r\n  updateToolTips() {\r\n    if (this._description_final === undefined || this._description_final === null ||\r\n      this._description_final.trim().length === 0) {\r\n      return;\r\n    }\r\n\r\n    if (!this.ctx || !this.ctx.screen) {\r\n      return;\r\n    }\r\n\r\n    this.updateToolTipHandlers();\r\n\r\n    if (this.useNativeToolTips || this._tooltip_timer === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this._tool_tip_abort_delay !== undefined && util.time_ms() < this._tool_tip_abort_delay) {\r\n      return;\r\n    }\r\n\r\n    this._tool_tip_abort_delay = undefined;\r\n\r\n    let screen = this.ctx.screen;\r\n\r\n    const timelimit = 500;\r\n    let ok = util.time_ms() - this._tooltip_timer > timelimit;\r\n\r\n    let x = screen.mpos[0], y = screen.mpos[1];\r\n\r\n    let r = this.getClientRects();\r\n    r = r ? r[0] : r;\r\n\r\n    if (!r) {\r\n      ok = false;\r\n    } else {\r\n      ok = ok && x >= r.x && x < r.x + r.width;\r\n      ok = ok && y >= r.y && y < r.y + r.height;\r\n    }\r\n\r\n\r\n    //console.log(r);\r\n    if (r) {\r\n      //console.warn(this._id, \"possible tooltip\", x, y, r.x-3, r.y-3, r.width, r.height);\r\n    }\r\n\r\n    ok = ok && !haveModal();\r\n    ok = ok && screen.pickElement(x, y) === this;\r\n    ok = ok && this._description_final;\r\n\r\n    if (ok) {\r\n      //console.warn(\"Showing tooltop\", this.id);\r\n      this._tooltip_ref = _ToolTip.show(this._description_final, this.ctx.screen, x, y);\r\n    } else {\r\n      if (this._tooltip_ref) {\r\n        this._tooltip_ref.remove();\r\n      }\r\n\r\n      this._tooltip_ref = undefined;\r\n    }\r\n\r\n    //console.warn(this._id, \"tooltip timer end\");\r\n    if (util.time_ms() - this._tooltip_timer > timelimit) {\r\n      this._tooltip_timer = undefined;\r\n    }\r\n  }\r\n\r\n  updateEventGraph() {\r\n    if (!this.isConnected) {\r\n      this.#reflagGraph = true;\r\n    } else if (this.#reflagGraph) {\r\n      this.#reflagGraph = false;\r\n\r\n      for (let [k, sock] of Object.entries(this.graphNode.inputs)) {\r\n        sock.flagUpdate();\r\n      }\r\n    }\r\n  }\r\n\r\n  //called regularly\r\n  update() {\r\n    this.updateToolTips();\r\n    this.updateEventGraph();\r\n\r\n    if (this.ctx && this._description === undefined && this.getAttribute(\"datapath\")) {\r\n      let d = this.getPathDescription(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n      this.description = d;\r\n    }\r\n\r\n    if (!this._init_done) {\r\n      this._init();\r\n    }\r\n\r\n    if (this._init_done && !this.constructor.define().subclassChecksTheme) {\r\n      if (this.checkThemeUpdate()) {\r\n        console.log(\"theme update!\");\r\n\r\n        this.setCSS();\r\n      }\r\n    }\r\n  }\r\n\r\n  onadd() {\r\n    //if (this.parentWidget !== undefined) {\r\n    //  this._useDataPathUndo = this.parentWidget._useDataPathUndo;\r\n    //}\r\n\r\n    if (!this._init_done) {\r\n      this.doOnce(this._init);\r\n    }\r\n\r\n    if (this.tabIndex >= 0) {\r\n      this.regenTabOrder();\r\n    }\r\n  }\r\n\r\n  getZoom() {\r\n    if (this.parentWidget !== undefined) {\r\n      return this.parentWidget.getZoom();\r\n    }\r\n\r\n    return 1.0;\r\n  }\r\n\r\n  /**try to use this method\r\n\r\n   scaling ratio (e.g. for high-resolution displays)\r\n   for zoom ratio use getZoom()\r\n   */\r\n  getDPI() {\r\n    if (this.parentWidget !== undefined) {\r\n      return this.parentWidget.getDPI();\r\n    }\r\n\r\n    return UIBase.getDPI();\r\n  }\r\n\r\n  /**\r\n   * for saving ui state.\r\n   * see saveUIData() export\r\n   *\r\n   * should fail gracefully.\r\n   */\r\n  saveData() {\r\n    return {};\r\n  }\r\n\r\n  /**\r\n   * for saving ui state.\r\n   * see saveUIData() export\r\n   *\r\n   * should fail gracefully.\r\n   *\r\n   * also, it doesn't rebuild the object graph,\r\n   * it patches it; for true serialization use\r\n   * the toJSON/loadJSON or STRUCT interfaces.\r\n   */\r\n  loadData(obj) {\r\n    return this;\r\n  }\r\n\r\n  overrideDefault(key, val, localOnly = false) {\r\n    this.my_default_overrides[key] = val;\r\n\r\n    if (!localOnly) {\r\n      this.default_overrides[key] = val;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  overrideClass(style) {\r\n    this._override_class = style;\r\n  }\r\n\r\n  overrideClassDefault(style, key, val) {\r\n    if (!(style in this.class_default_overrides)) {\r\n      this.class_default_overrides[style] = {};\r\n    }\r\n\r\n    this.class_default_overrides[style][key] = val;\r\n  }\r\n\r\n  _doMobileDefault(key, val, obj) {\r\n    if (!util.isMobile())\r\n      return val;\r\n\r\n    const mobilekey = key + \"_mobile\";\r\n    if (obj && mobilekey in obj) {\r\n      return obj[mobilekey];\r\n    }\r\n\r\n    key = key.toLowerCase();\r\n    let ok = false;\r\n\r\n    for (let re of _mobile_theme_patterns) {\r\n      if (key.search(re) >= 0) {\r\n        ok = true;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (ok && theme.base.mobileSizeMultiplier) {\r\n      val *= theme.base.mobileSizeMultiplier;\r\n    }\r\n\r\n    return val;\r\n  }\r\n\r\n  hasDefault(key) {\r\n    let p = this;\r\n\r\n    while (p) {\r\n      if (key in p.default_overrides) {\r\n        return true;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    return this.hasClassDefault(key);\r\n  }\r\n\r\n  hasSubDefault(key, subkey) {\r\n    return this._hasSubDefault(...arguments, theme)\r\n      || this._themeOverride && this._hasSubDefault(...arguments, this._themeOverride);\r\n  }\r\n\r\n  _hasSubDefault(key, subkey) {\r\n    let style = this.getStyleClass();\r\n\r\n    let obj = this.getDefault(key);\r\n\r\n    if (!obj || typeof obj !== \"object\") {\r\n      return false;\r\n    }\r\n\r\n    return subkey in obj;\r\n  }\r\n\r\n  hasClassSubDefault(key, subkey, inherit = true) {\r\n    return this._hasClassSubDefault(key, subkey, inherit, undefined, theme) ||\r\n      this._themeOverride && this._hasClassSubDefault(key, subkey, inherit, undefined, this._themeOverride);\r\n  }\r\n\r\n  _hasClassSubDefault(key, subkey, inherit = true, style = this.getStyleClass(), themeDef) {\r\n    let th = themeDef;\r\n    th = th[style];\r\n\r\n    if (inherit) {\r\n      if (this._hasClassSubDefault(key, subkey, false, themeDef)) {\r\n        return true;\r\n      }\r\n\r\n      let ret = false;\r\n      let def = this.constructor.define();\r\n\r\n      if (def.parentStyle) {\r\n        ret |= this._hasClassSubDefault(key, subkey, false, def.parentStyle, themeDef);\r\n      }\r\n      ret |= this._hasClassSubDefault(key, subkey, false, \"base\", themeDef);\r\n      return ret;\r\n    }\r\n\r\n    if (!th) {\r\n      return false;\r\n    }\r\n\r\n    let obj = th[key];\r\n    if (!obj || typeof obj !== \"object\") {\r\n      return false;\r\n    }\r\n\r\n    return subkey in obj;\r\n  }\r\n\r\n  /** get a sub style from a theme style class.\r\n   *  note that if key is falsy then it just forwards to this.getDefault directly*/\r\n  getSubDefault(key, subkey, backupkey = subkey, defaultval = undefined, inherit = true) {\r\n    /* Check if client code manually overrode a theme key for this instance. */\r\n    if (subkey && subkey in this.my_default_overrides) {\r\n      //return this.getDefault(subkey, undefined, defaultval);\r\n    }\r\n\r\n    if (!key) {\r\n      return this.getDefault(subkey, undefined, defaultval, inherit);\r\n    }\r\n\r\n    let style = this.getDefault(key, undefined, undefined, inherit);\r\n\r\n    if (!style || typeof style !== \"object\" || !(subkey in style)) {\r\n      if (defaultval !== undefined) {\r\n        return defaultval;\r\n      } else if (backupkey) {\r\n        return this.getDefault(backupkey, undefined, undefined, inherit);\r\n      }\r\n    } else {\r\n      return style[subkey];\r\n    }\r\n  }\r\n\r\n  getDefault(key, checkForMobile = true, defaultval = undefined, inherit = true) {\r\n    let ret = this.getDefault_intern(key, checkForMobile, defaultval, inherit);\r\n\r\n    //convert pixel units straight to numbers\r\n    if (typeof ret === \"string\" && ret.trim().toLowerCase().endsWith(\"px\")) {\r\n      let s = ret.trim().toLowerCase();\r\n      s = s.slice(0, s.length - 2).trim();\r\n\r\n      let f = parseFloat(s);\r\n      if (!isNaN(f) && isFinite(f)) {\r\n        return f;\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  getDefault_intern(key, checkForMobile = true, defaultval = undefined, inherit = true) {\r\n    if (this.my_default_overrides[key] !== undefined) {\r\n      let v = this.my_default_overrides[key];\r\n      return checkForMobile ? this._doMobileDefault(key, v, this.my_default_overrides) : v;\r\n    }\r\n\r\n    let p = this;\r\n    while (p) {\r\n      if (p.default_overrides[key] !== undefined) {\r\n        let v = p.default_overrides[key];\r\n        checkForMobile ? this._doMobileDefault(key, v, p.default_overrides) : v;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    return this.getClassDefault(key, checkForMobile, defaultval, inherit);\r\n  }\r\n\r\n  getStyleClass() {\r\n    if (this._override_class !== undefined) {\r\n      return this._override_class;\r\n    }\r\n\r\n    let p = this.constructor, lastp = undefined;\r\n\r\n    while (p && p !== lastp && p !== UIBase && p !== Object) {\r\n      let def = p.define();\r\n\r\n      if (def.style) {\r\n        return def.style;\r\n      }\r\n\r\n      if (!p.prototype || !p.prototype.__proto__)\r\n        break;\r\n\r\n      p = p.prototype.__proto__.constructor;\r\n    }\r\n\r\n    return \"base\";\r\n  }\r\n\r\n  hasClassDefault(key) {\r\n    let style = this.getStyleClass();\r\n\r\n    let p = this;\r\n    while (p) {\r\n      let def = p.class_default_overrides[style];\r\n\r\n      if (def && (key in def)) {\r\n        return true;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    let th = this._themeOverride;\r\n\r\n    if (th && style in th && key in th[style]) {\r\n      return true;\r\n    }\r\n\r\n    if (style in theme && key in theme[style]) {\r\n      return true;\r\n    }\r\n\r\n    return key in theme.base;\r\n  }\r\n\r\n  getClassDefault(key, checkForMobile = true, defaultval = undefined, inherit = true) {\r\n    let style = this.getStyleClass();\r\n\r\n    if (style === \"none\") {\r\n      return undefined;\r\n    }\r\n\r\n    let themeobj;\r\n    let val;\r\n    let p = this;\r\n\r\n    while (p) {\r\n      let def = p.class_default_overrides[style];\r\n\r\n      if (def && (key in def)) {\r\n        themeobj = def;\r\n        val = def[key];\r\n        break;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    if (val === undefined && style in theme && !(key in theme[style]) && !(key in theme.base)) {\r\n      if (window.DEBUG.theme) {\r\n        report(\"Missing theme key \", key, \"for\", style);\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let th = !i ? this._themeOverride : theme;\r\n\r\n      if (!th) {\r\n        continue;\r\n      }\r\n\r\n      if (val === undefined && style in th && key in th[style]) {\r\n        themeobj = th[style];\r\n        val = th[style][key];\r\n      } else if (defaultval !== undefined) {\r\n        themeobj = undefined;\r\n        val = defaultval;\r\n      } else if (val === undefined && inherit) {\r\n        let def = this.constructor.define();\r\n\r\n        if (def.parentStyle && key in th[def.parentStyle]) {\r\n          val = th[def.parentStyle][key];\r\n          themeobj = th[def.parentStyle];\r\n        } else {\r\n          val = th.base[key];\r\n          themeobj = th.base;\r\n        }\r\n      }\r\n    }\r\n\r\n    return checkForMobile ? this._doMobileDefault(key, val, themeobj) : val;\r\n  }\r\n\r\n  overrideTheme(theme) {\r\n    this._themeOverride = theme;\r\n\r\n    this._forEachChildWidget((child) => {\r\n      child.overrideTheme(theme);\r\n    });\r\n\r\n    if (this.ctx) {\r\n      this.flushSetCSS();\r\n      this.flushUpdate();\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  getStyle() {\r\n    console.warn(\"deprecated call to UIBase.getStyle\");\r\n    return this.getStyleClass();\r\n  }\r\n\r\n  /** returns a new Animator instance\r\n   *\r\n   * example:\r\n   *\r\n   * container.animate().goto(\"style.width\", 500, 100, \"ease\");\r\n   * */\r\n  animate(_extra_handlers = {}, domAnimateOptions=undefined) {\r\n    /* User is providing DOM animation data. */\r\n    if (Array.isArray(_extra_handlers)) {\r\n      return super.animate(_extra_handlers, domAnimateOptions)\r\n    }\r\n\r\n    let transform = new DOMMatrix(this.style[\"transform\"]);\r\n\r\n    let update_trans = () => {\r\n      let t = transform;\r\n      let css = \"matrix(\" + t.a + \",\" + t.b + \",\" + t.c + \",\" + t.d + \",\" + t.e + \",\" + t.f + \")\";\r\n      this.style[\"transform\"] = css;\r\n    }\r\n\r\n    let handlers = {\r\n      background_get() {\r\n        return css2color(this.background);\r\n      },\r\n\r\n      background_set(c) {\r\n        if (typeof c !== \"string\") {\r\n          c = color2css(c);\r\n        }\r\n        this.background = c;\r\n      },\r\n\r\n      dx_get() {\r\n        return transform.m41;\r\n      },\r\n      dx_set(x) {\r\n        transform.m41 = x;\r\n        update_trans();\r\n      },\r\n\r\n      dy_get() {\r\n        return transform.m42;\r\n      },\r\n      dy_set(x) {\r\n        transform.m42 = x;\r\n        update_trans();\r\n      }\r\n    }\r\n\r\n    let pixkeys = [\"width\", \"height\", \"left\", \"top\", \"right\", \"bottom\", \"border-radius\",\r\n                   \"border-width\", \"margin\", \"padding\", \"margin-left\", \"margin-right\",\r\n                   \"margin-top\", \"margin-bottom\", \"padding-left\", \"padding-right\", \"padding-bottom\",\r\n                   \"padding-top\"];\r\n    handlers = Object.assign(handlers, _extra_handlers);\r\n\r\n    let makePixHandler = (k, k2) => {\r\n      handlers[k2 + \"_get\"] = () => {\r\n        let s = this.style[k];\r\n\r\n        if (s.endsWith(\"px\")) {\r\n          return parsepx(s);\r\n        } else {\r\n          return 0.0;\r\n        }\r\n      }\r\n\r\n      handlers[k2 + \"_set\"] = (val) => {\r\n        this.style[k] = val + \"px\";\r\n      }\r\n    }\r\n\r\n    for (let k of pixkeys) {\r\n      if (!(k in handlers)) {\r\n        makePixHandler(k, `style.${k}`);\r\n        makePixHandler(k, `style[\"${k}\"]`);\r\n        makePixHandler(k, `style['${k}']`);\r\n      }\r\n    }\r\n\r\n    let handler = {\r\n      get: (target, key, receiver) => {\r\n        console.log(key, handlers[key + \"_get\"], handlers);\r\n\r\n        if ((key + \"_get\") in handlers) {\r\n          return handlers[key + \"_get\"].call(target);\r\n        } else {\r\n          return target[key];\r\n        }\r\n      },\r\n      set: (target, key, val, receiver) => {\r\n        console.log(key);\r\n\r\n        if ((key + \"_set\") in handlers) {\r\n          handlers[key + \"_set\"].call(target, val);\r\n        } else {\r\n          target[key] = val;\r\n        }\r\n\r\n        return true;\r\n      }\r\n    }\r\n\r\n    let proxy = new Proxy(this, handler);\r\n    let anim = new Animator(proxy);\r\n\r\n    anim.onend = () => {\r\n      this._active_animations.remove(anim);\r\n    }\r\n\r\n    this._active_animations.push(anim);\r\n    return anim;\r\n  }\r\n\r\n  abortAnimations() {\r\n    for (let anim of util.list(this._active_animations)) {\r\n      anim.end();\r\n    }\r\n\r\n    this._active_animations = [];\r\n  }\r\n}\r\n\r\nexport function drawRoundBox2(elem, options = {}) {\r\n  drawRoundBox(elem, options.canvas, options.g, options.width, options.height, options.r, options.op, options.color, options.margin, options.no_clear);\r\n}\r\n\r\n/**okay, I need to refactor this function,\r\n it needs to take x, y as well as width, height,\r\n and be usable for more use cases.*/\r\nexport function drawRoundBox(elem, canvas, g, width, height, r      = undefined,\r\n                             op = \"fill\", color = undefined, margin = undefined,\r\n                             no_clear                               = false) {\r\n  width = width === undefined ? canvas.width : width;\r\n  height = height === undefined ? canvas.height : height;\r\n  g.save();\r\n\r\n  let dpi = elem.getDPI();\r\n\r\n  r = r === undefined ? elem.getDefault(\"border-radius\") : r;\r\n\r\n  if (margin === undefined) {\r\n    margin = 1;\r\n  }\r\n\r\n  r *= dpi;\r\n  let r1 = r, r2 = r;\r\n\r\n  if (r > (height - margin*2)*0.5) {\r\n    r1 = (height - margin*2)*0.5;\r\n  }\r\n\r\n  if (r > (width - margin*2)*0.5) {\r\n    r2 = (width - margin*2)*0.5;\r\n  }\r\n\r\n  let bg = color;\r\n\r\n  if (bg === undefined && canvas._background !== undefined) {\r\n    bg = canvas._background;\r\n  } else if (bg === undefined) {\r\n    bg = elem.getDefault(\"background-color\");\r\n  }\r\n\r\n  if (op === \"fill\" && !no_clear) {\r\n    g.clearRect(0, 0, width, height);\r\n  }\r\n\r\n  g.fillStyle = bg;\r\n  //hackish!\r\n  g.strokeStyle = color === undefined ? elem.getDefault(\"border-color\") : color;\r\n\r\n  let w = width, h = height;\r\n\r\n  let th = Math.PI/4;\r\n  let th2 = Math.PI*0.75;\r\n\r\n  g.beginPath();\r\n\r\n  g.moveTo(margin, margin + r1);\r\n  g.lineTo(margin, h - r1 - margin);\r\n\r\n  g.quadraticCurveTo(margin, h - margin, margin + r2, h - margin);\r\n  g.lineTo(w - margin - r2, h - margin);\r\n\r\n  g.quadraticCurveTo(w - margin, h - margin, w - margin, h - margin - r1);\r\n  g.lineTo(w - margin, margin + r1);\r\n\r\n  g.quadraticCurveTo(w - margin, margin, w - margin - r2, margin);\r\n  g.lineTo(margin + r2, margin);\r\n\r\n  g.quadraticCurveTo(margin, margin, margin, margin + r1);\r\n  g.closePath();\r\n\r\n  if (op === \"clip\") {\r\n    g.clip();\r\n  } else if (op === \"fill\") {\r\n    g.fill();\r\n  } else {\r\n    g.stroke();\r\n  }\r\n\r\n  g.restore();\r\n};\r\n\r\nexport function _getFont_new(elem, size, font = \"DefaultText\", do_dpi = true) {\r\n\r\n  font = elem.getDefault(font);\r\n\r\n  return font.genCSS(size);\r\n}\r\n\r\nexport function getFont(elem, size, font = \"DefaultText\", do_dpi = true) {\r\n  return _getFont_new(elem, size, font = \"DefaultText\", do_dpi = true);\r\n}\r\n\r\n//size is optional, defaults to font's default size\r\nexport function _getFont(elem, size, font = \"DefaultText\", do_dpi = true) {\r\n  let dpi = elem.getDPI();\r\n\r\n  let font2 = elem.getDefault(font);\r\n  if (font2 !== undefined) {\r\n    //console.warn(\"New style font detected\", font2, font2.genCSS(size));\r\n    return _getFont_new(elem, size, font, do_dpi);\r\n  }\r\n\r\n  throw new Error(\"unknown font \" + font);\r\n}\r\n\r\nexport function _ensureFont(elem, canvas, g, size) {\r\n  if (canvas.font) {\r\n    g.font = canvas.font;\r\n  } else {\r\n    let font = elem.getDefault(\"DefaultText\");\r\n    g.font = font.genCSS(size);\r\n  }\r\n}\r\n\r\nlet _mc;\r\n\r\nfunction get_measure_canvas() {\r\n  if (_mc !== undefined) {\r\n    return _mc;\r\n  }\r\n\r\n  _mc = document.createElement(\"canvas\");\r\n  _mc.width = 256;\r\n  _mc.height = 256;\r\n  _mc.g = _mc.getContext(\"2d\");\r\n\r\n  return _mc;\r\n}\r\n\r\nexport function measureTextBlock(elem, text, canvas                    = undefined,\r\n                                 g = undefined, size = undefined, font = undefined) {\r\n  let lines = text.split(\"\\n\");\r\n\r\n  let ret = {\r\n    width : 0,\r\n    height: 0\r\n  };\r\n\r\n  if (size === undefined) {\r\n    if (font !== undefined && typeof font === \"object\") {\r\n      size = font.size;\r\n    }\r\n\r\n    if (size === undefined) {\r\n      size = elem.getDefault(\"DefaultText\").size;\r\n    }\r\n  }\r\n\r\n  for (let line of lines) {\r\n    let m = measureText(elem, line, canvas, g, size, font);\r\n\r\n    ret.width = Math.max(ret.width, m.width);\r\n    let h = m.height !== undefined ? m.height : size*1.25;\r\n\r\n    ret.height += h;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nexport function measureText(elem, text, canvas                    = undefined,\r\n                            g = undefined, size = undefined, font = undefined) {\r\n  if (typeof canvas === \"object\" && canvas !== null && !(canvas instanceof HTMLCanvasElement) && canvas.tagName !== \"CANVAS\") {\r\n    let args = canvas;\r\n\r\n    canvas = args.canvas;\r\n    g = args.g;\r\n    size = args.size;\r\n    font = args.font;\r\n\r\n  }\r\n\r\n  if (g === undefined) {\r\n    canvas = get_measure_canvas();\r\n    g = canvas.g;\r\n  }\r\n\r\n  if (font !== undefined) {\r\n    if (typeof font === \"object\" && font instanceof CSSFont) {\r\n      font = font.genCSS(size);\r\n    }\r\n\r\n    g.font = font;\r\n  } else {\r\n    _ensureFont(elem, canvas, g, size);\r\n  }\r\n\r\n  let ret = g.measureText(text);\r\n\r\n  if (size !== undefined) {\r\n    //clear custom font for next time\r\n    g.font = undefined;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n//export function drawText(elem, x, y, text, canvas, g, color=undefined, size=undefined, font=undefined) {\r\nexport function drawText(elem, x, y, text, args = {}) {\r\n  let canvas = args.canvas, g = args.g, color = args.color, font = args.font;\r\n  let size = args.size;\r\n\r\n  if (size === undefined) {\r\n    if (font !== undefined && font instanceof CSSFont) {\r\n      size = font.size;\r\n    } else {\r\n      size = elem.getDefault(\"DefaultText\").size;\r\n    }\r\n  }\r\n\r\n  size *= UIBase.getDPI();\r\n\r\n\r\n  if (color === undefined) {\r\n    if (font && font.color) {\r\n      color = font.color;\r\n    } else {\r\n      color = elem.getDefault(\"DefaultText\").color;\r\n    }\r\n  }\r\n\r\n  if (font === undefined) {\r\n    _ensureFont(elem, canvas, g, size);\r\n  } else if (typeof font === \"object\" && font instanceof CSSFont) {\r\n    g.font = font = font.genCSS(size);\r\n  } else if (font) {\r\n    g.font = font;\r\n  }\r\n\r\n  if (typeof color === \"object\") {\r\n    color = color2css(color);\r\n  }\r\n\r\n\r\n  g.fillStyle = color;\r\n  g.fillText(text, x + 0.5, y + 0.5);\r\n\r\n  if (size !== undefined) {\r\n    //clear custom font for next time\r\n    g.font = undefined;\r\n  }\r\n}\r\n\r\nlet PIDX = 0, PSHADOW = 1, PTOT = 2;\r\n\r\n/**\r\n\r\n Saves UI layout data, like panel layouts, active tabs, etc.\r\n Uses the UIBase.prototype.[save/load]Data interface.\r\n\r\n Note that this is error-tolerant.\r\n */\r\nexport function saveUIData(node, key) {\r\n  if (key === undefined) {\r\n    throw new Error(\"ui_base.saveUIData(): key cannot be undefined\");\r\n  }\r\n\r\n  let paths = [];\r\n\r\n  let rec = (n, path, ni, is_shadow) => {\r\n    path = path.slice(0, path.length); //copy path\r\n\r\n    let pi = path.length;\r\n    for (let i = 0; i < PTOT; i++) {\r\n      path.push(undefined);\r\n    }\r\n\r\n    path[pi] = ni;\r\n    path[pi + 1] = is_shadow ? 1 : 0;\r\n\r\n    if (n instanceof UIBase) {\r\n      let path2 = path.slice(0, path.length);\r\n      let data = n.saveData();\r\n\r\n      let bad = !data;\r\n      bad = bad || (typeof data === \"object\" && Object.keys(data).length === 0);\r\n\r\n      if (!bad) {\r\n        path2.push(data);\r\n\r\n        if (path2[pi + 2]) {\r\n          paths.push(path2);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < n.childNodes.length; i++) {\r\n      let n2 = n.childNodes[i];\r\n\r\n      rec(n2, path, i, false);\r\n    }\r\n\r\n    let shadow = n.shadow;\r\n\r\n    if (!shadow)\r\n      return;\r\n\r\n    for (let i = 0; i < shadow.childNodes.length; i++) {\r\n      let n2 = shadow.childNodes[i];\r\n\r\n      rec(n2, path, i, true);\r\n    }\r\n  }\r\n\r\n  rec(node, [], 0, false);\r\n\r\n  return JSON.stringify({\r\n    key        : key,\r\n    paths      : paths,\r\n    _ui_version: 1\r\n  });\r\n}\r\n\r\nwindow._saveUIData = saveUIData;\r\n\r\nexport function loadUIData(node, buf) {\r\n  if (buf === undefined || buf === null) {\r\n    return;\r\n  }\r\n\r\n  let obj = JSON.parse(buf);\r\n  let key = buf.key;\r\n\r\n  for (let path of obj.paths) {\r\n    let n = node;\r\n\r\n    let data = path[path.length - 1];\r\n    path = path.slice(2, path.length - 1); //in case some api doesn't want me calling .pop()\r\n\r\n    for (let pi = 0; pi < path.length; pi += PTOT) {\r\n      let ni = path[pi], shadow = path[pi + 1];\r\n\r\n      let list;\r\n\r\n      if (shadow) {\r\n        list = n.shadow;\r\n\r\n        if (list) {\r\n          list = list.childNodes;\r\n        }\r\n      } else {\r\n        list = n.childNodes;\r\n      }\r\n\r\n      if (list === undefined || list[ni] === undefined) {\r\n        //console.log(\"failed to load a ui data block\", path);\r\n        n = undefined;\r\n        break;\r\n      }\r\n\r\n      n = list[ni];\r\n    }\r\n\r\n    if (n !== undefined && n instanceof UIBase) {\r\n      n._init(); //ensure init's been called, _init will check if it has\r\n      n.loadData(data);\r\n\r\n      //console.log(n, path, data);\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.PositionKey = \"fixed\";\r\n\r\nwindow._loadUIData = loadUIData;\r\n\r\n//avoid explicit circular references\r\naspect._setUIBase(UIBase);\r\n//ui_save.setUIBase(UIBase);\r\n","\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as simple_toolsys from '../path-controller/toolsys/toolsys.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport {DataPathError} from '../path-controller/controller/controller.js';\r\nimport {Vector3, Vector4, Quat, Matrix4} from '../path-controller/util/vectormath.js';\r\nimport cconst from '../config/const.js';\r\nimport {_themeUpdateKey, CSSFont} from \"../core/ui_base.js\";\r\n\r\nlet keymap = events.keymap;\r\n\r\nlet EnumProperty = toolprop.EnumProperty,\r\n    PropTypes    = toolprop.PropTypes;\r\n\r\nlet UIBase     = ui_base.UIBase,\r\n    PackFlags  = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nlet parsepx = ui_base.parsepx;\r\n\r\ncconst.DEBUG.buttonEvents = true;\r\n\r\nexport class ButtonEventBase extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._auto_depress = true;\r\n    this._highlight = false;\r\n    this._pressed = false;\r\n  }\r\n\r\n  bindEvents() {\r\n    let press_gen = 0;\r\n    let depress;\r\n\r\n    let press = (e) => {\r\n      e.stopPropagation();\r\n\r\n      if (!this.modalRunning) {\r\n        let this2 = this;\r\n\r\n        this.pushModal({\r\n          on_pointerdown(e) {\r\n            this.end(e);\r\n          },\r\n\r\n          on_pointerup(e) {\r\n            this.end(e);\r\n          },\r\n\r\n          on_pointercancel(e) {\r\n            console.warn(\"Pointer cancel in button\");\r\n            this2.popModal();\r\n          },\r\n\r\n          on_keydown(e) {\r\n            switch (e.keyCode) {\r\n              case keymap[\"Enter\"]:\r\n              case keymap[\"Escape\"]:\r\n              case keymap[\"Space\"]:\r\n                this.end();\r\n                break;\r\n            }\r\n          },\r\n\r\n          end(e) {\r\n            if (!this2.modalRunning) {\r\n              return;\r\n            }\r\n\r\n            this2.popModal();\r\n            depress(e);\r\n          }\r\n        }, undefined, e.pointerId);\r\n      }\r\n\r\n      if (cconst.DEBUG.buttonEvents) {\r\n        console.log(\"button press\", this._pressed, this.disabled, e.button);\r\n      }\r\n\r\n      if (this.disabled) return;\r\n\r\n      this._pressed = true;\r\n\r\n      if (this._onpress) {\r\n        this._onpress(this);\r\n      }\r\n\r\n      this._redraw();\r\n\r\n      e.preventDefault();\r\n    };\r\n\r\n    depress = (e) => {\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(\"button depress\", e.button, e.was_touch);\r\n\r\n      if (this._auto_depress) {\r\n        this._pressed = false;\r\n\r\n        if (this.disabled) return;\r\n\r\n        this._redraw();\r\n      }\r\n\r\n      if (e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        if (util.isMobile() || e.type === \"pointerup\" && e.button) {\r\n          return;\r\n        }\r\n      }\r\n\r\n      this._redraw();\r\n\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(\"button click callback:\", this.onclick, this._onpress, this.onpress);\r\n\r\n      if (this.onclick && e && e.pointerType !== \"mouse\") {\r\n        this.onclick(this);\r\n      }\r\n\r\n      this.undoBreakPoint();\r\n    }\r\n\r\n    this.addEventListener(\"click\", () => {\r\n      this._pressed = false;\r\n      this._highlight = false;\r\n      this._redraw();\r\n    });\r\n\r\n    this.addEventListener(\"pointerdown\", press, {captured: true, passive: false});\r\n    this.addEventListener(\"pointerup\", depress, {captured: true, passive: false});\r\n    this.addEventListener(\"pointerover\", (e) => {\r\n      if (this.disabled)\r\n        return;\r\n\r\n      this._highlight = true;\r\n      this._redraw();\r\n    })\r\n\r\n    this.addEventListener(\"pointerout\", (e) => {\r\n      if (this.disabled)\r\n        return;\r\n\r\n      this._highlight = false;\r\n      this._redraw();\r\n    })\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      if (this.disabled) return;\r\n\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(e.keyCode);\r\n\r\n      switch (e.keyCode) {\r\n        case 27: //escape\r\n          this.blur();\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          break;\r\n        case 32: //spacebar\r\n        case 13: //enter\r\n          this.click();\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          break;\r\n      }\r\n    });\r\n\r\n    this.addEventListener(\"focusin\", () => {\r\n      if (this.disabled) return;\r\n\r\n      this._focus = 1;\r\n      this._redraw();\r\n      this.focus();\r\n    });\r\n\r\n    this.addEventListener(\"blur\", () => {\r\n      if (this.disabled) return;\r\n\r\n      this._focus = 0;\r\n      this._redraw();\r\n    });\r\n  }\r\n\r\n  _redraw() {\r\n\r\n  }\r\n}\r\n\r\nexport class Button extends ButtonEventBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.label = document.createElement(\"span\");\r\n    this.label.innerText = \"button\";\r\n    this.shadow.appendChild(this.label);\r\n\r\n    this.label.style[\"pointer-events\"] = \"none\";\r\n\r\n    this._pressed = false;\r\n    this._highlight = false;\r\n    this._pressedTime = 0;\r\n    this._pressedTimeout = 100;\r\n\r\n    this._auto_depress = true;\r\n\r\n    this._last_name = undefined;\r\n    this._last_disabled = undefined;\r\n  }\r\n\r\n  get name() {\r\n    return \"\" + this.getAttribute(\"name\");\r\n  }\r\n\r\n  set name(val) {\r\n    this.setAttribute(\"name\", val);\r\n  }\r\n\r\n  get _pressed() {\r\n    return this.__pressed;\r\n  }\r\n\r\n  set _pressed(v) {\r\n    let changed = !v !== !this._pressed;\r\n\r\n    if (v) {\r\n      this._pressedTime = util.time_ms();\r\n    } else if (changed && util.time_ms() - this._pressedTime < this._pressedTimeout) {\r\n      window.setTimeout(() => {\r\n        this.setCSS();\r\n      }, this._pressedTimeout - (util.time_ms() - this._pressedTime) + 1);\r\n    }\r\n\r\n    this.__pressed = v;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"button-x\",\r\n      style  : \"button\"\r\n    };\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this.tabIndex = 0;\r\n\r\n    this.bindEvents();\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  on_enabled() {\r\n    this.setCSS();\r\n  }\r\n\r\n  on_disabled() {\r\n    this.setCSS();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    if (this.hasDefault(\"pressedTimeout\")) {\r\n      this._pressedTimeout = this.getDefault(\"pressedTimeout\");\r\n    }\r\n\r\n    let subkey = undefined;\r\n\r\n    let pressed = this._pressed;\r\n    if (!pressed && util.time_ms() - this._pressedTime < this._pressedTimeout) {\r\n      pressed = true;\r\n    }\r\n\r\n    if (this.disabled) {\r\n      subkey = \"disabled\";\r\n    } else if (pressed && this._highlight) {\r\n      subkey = \"highlight-pressed\";\r\n    } else if (pressed) {\r\n      subkey = \"pressed\";\r\n    } else if (this._highlight) {\r\n      subkey = \"highlight\";\r\n    }\r\n\r\n    let h = this.getDefault(\"height\");\r\n\r\n    this.setBoxCSS(subkey);\r\n\r\n    this.label.style[\"padding\"] = this.label.style[\"margin\"] = \"0px\";\r\n    this.style[\"background-color\"] = this.getSubDefault(subkey, \"background-color\");\r\n\r\n    let font = this.getSubDefault(subkey, \"DefaultText\");\r\n    this.label.style[\"font\"] = font.genCSS();\r\n    this.label.style[\"color\"] = font.color;\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"align-items\"] = \"center\";\r\n    this.style[\"width\"] = \"max-content\";\r\n    this.style[\"height\"] = h + \"px\";\r\n\r\n    this.style[\"user-select\"] = \"none\";\r\n    this.label.style[\"user-select\"] = \"none\";\r\n  }\r\n\r\n  click() {\r\n    if (this._onpress) {\r\n      let rect = this.getClientRects();\r\n      let x = rect.x + rect.width*0.5;\r\n      let y = rect.y + rect.height*0.5;\r\n\r\n      let e = {\r\n        x                : x, y: y, stopPropagation: () => {\r\n        }, preventDefault: () => {\r\n        }\r\n      };\r\n\r\n      this._onpress(e);\r\n    }\r\n\r\n    super.click();\r\n  }\r\n\r\n  _redraw() {\r\n    this.setCSS();\r\n  }\r\n\r\n  updateDisabled() {\r\n    if (this._last_disabled !== this.disabled) {\r\n      this._last_disabled = this.disabled;\r\n\r\n      //setTimeout(() => {\r\n\r\n      this._redraw();\r\n\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(\"disabled update!\", this.disabled, this.style[\"background-color\"]);\r\n      //}, 100);\r\n    }\r\n  }\r\n\r\n  update() {\r\n    if (this._last_name !== this.name) {\r\n      this.label.innerHTML = this.name;\r\n      this._last_name = this.name;\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.register(Button);\r\n\r\n//use .setAttribute(\"linear\") to disable nonlinear sliding\r\nexport class OldButton extends ButtonEventBase {\r\n  constructor() {\r\n    super();\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    this._last_but_update_key = \"\";\r\n\r\n    this._name = \"\";\r\n    this._namePad = undefined;\r\n    this._leftPad = 5; //extra pad before text\r\n    this._rightPad = 5; //extra pad after text\r\n\r\n    this._last_w = 0;\r\n    this._last_h = 0;\r\n\r\n    this._last_dpi = dpi;\r\n\r\n    this._lastw = undefined;\r\n    this._lasth = undefined;\r\n\r\n    this.dom = document.createElement(\"canvas\");\r\n    this.g = this.dom.getContext(\"2d\");\r\n\r\n    this.dom.setAttribute(\"class\", \"canvas1\");\r\n    this.dom.tabIndex = 0;\r\n\r\n    this._last_bg = undefined;\r\n\r\n    this._last_disabled = false;\r\n    this._auto_depress = true;\r\n\r\n    this.shadow.appendChild(this.dom);\r\n  }\r\n\r\n  get r() {\r\n    return this.getDefault(\"border-radius\");\r\n  }\r\n\r\n  set r(val) {\r\n    this.overrideDefault(\"border-radius\", val);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"old-button-x\",\r\n      style  : \"button\"\r\n    };\r\n  }\r\n\r\n  click() {\r\n    if (this._onpress) {\r\n      let rect = this.getClientRects();\r\n      let x = rect.x + rect.width*0.5;\r\n      let y = rect.y + rect.height*0.5;\r\n\r\n      let e = {\r\n        x                : x, y: y, stopPropagation: () => {\r\n        }, preventDefault: () => {\r\n        }\r\n      };\r\n\r\n      this._onpress(e);\r\n    }\r\n\r\n    super.click();\r\n  }\r\n\r\n  init() {\r\n    let dpi = this.getDPI();\r\n\r\n    //set default dimensions\r\n    let width = ~~(this.getDefault(\"width\")*dpi);\r\n    let height = ~~(this.getDefault(\"height\")*dpi);\r\n\r\n    this.dom.width = width;\r\n    this.dom.height = height;\r\n\r\n    this.dom.style[\"width\"] = (width/dpi) + \"px\";\r\n    this.dom.style[\"height\"] = (height/dpi) + \"px\";\r\n    this.dom.style[\"padding\"] = this.dom.style[\"margin\"] = \"0px\";\r\n\r\n    this._name = undefined;\r\n    this.updateName();\r\n\r\n    this.bindEvents();\r\n    this._redraw();\r\n  }\r\n\r\n  setAttribute(key, val) {\r\n    super.setAttribute(key, val);\r\n\r\n    if (key === \"name\") {\r\n      this.updateName();\r\n      this.updateWidth();\r\n    }\r\n  }\r\n\r\n  old_bindEvents() {\r\n    let press_gen = 0;\r\n\r\n    let press = (e) => {\r\n      e.stopPropagation();\r\n\r\n      if (cconst.DEBUG.buttonEvents) {\r\n        console.log(\"button press\", this._pressed, this.disabled, e.button);\r\n      }\r\n\r\n      if (this.disabled) return;\r\n\r\n      this._pressed = true;\r\n\r\n      if (util.isMobile() && this.onclick && e.button === 0) {\r\n        this.onclick();\r\n      }\r\n\r\n      if (this._onpress) {\r\n        this._onpress(this);\r\n      }\r\n\r\n      this._redraw();\r\n\r\n      e.preventDefault();\r\n    };\r\n\r\n    let depress = (e) => {\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(\"button depress\", e.button, e.was_touch);\r\n\r\n      if (this._auto_depress) {\r\n        this._pressed = false;\r\n\r\n        if (this.disabled) return;\r\n\r\n        this._redraw();\r\n      }\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n\r\n      if (util.isMobile() || e.type === \"pointerup\" && e.button) {\r\n        return;\r\n      }\r\n\r\n      this._redraw();\r\n\r\n      if (cconst.DEBUG.buttonEvents) {\r\n        console.log(\"button click callback:\", this.onclick, this._onpress, this.onpress);\r\n      }\r\n\r\n      if (this.onclick && e.pointerType !== \"mouse\") {\r\n        this.onclick(this);\r\n      }\r\n\r\n      this.undoBreakPoint();\r\n    }\r\n\r\n    this.addEventListener(\"mousedown\", press, {captured: true, passive: false});\r\n    this.addEventListener(\"mouseup\", depress, {captured: true, passive: false});\r\n    this.addEventListener(\"mouseover\", (e) => {\r\n      if (this.disabled)\r\n        return;\r\n\r\n      this._highlight = true;\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    })\r\n\r\n    this.addEventListener(\"mouseout\", (e) => {\r\n      if (this.disabled)\r\n        return;\r\n\r\n      this._highlight = false;\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    })\r\n  }\r\n\r\n  updateDisabled() {\r\n    if (this._last_disabled !== this.disabled) {\r\n      this._last_disabled = this.disabled;\r\n\r\n      //setTimeout(() => {\r\n      this.dom._background = this.getDefault(\"background-color\");\r\n\r\n      this._repos_canvas();\r\n      this._redraw();\r\n\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(\"disabled update!\", this.disabled, this.style[\"background-color\"]);\r\n      //}, 100);\r\n    }\r\n  }\r\n\r\n  updateDefaultSize() {\r\n    const dpi = UIBase.getDPI();\r\n    let height = ~~(this.getDefault(\"height\")) + this.getDefault(\"padding\");\r\n    let size = this.getDefault(\"DefaultText\").size*1.33;\r\n\r\n    if (height === undefined || size === undefined || isNaN(height) || isNaN(size)) {\r\n      return;\r\n    }\r\n\r\n    height = ~~(Math.max(height, size)*dpi);\r\n    let cssHeight = (height/dpi) + \"px\";\r\n\r\n    if (cssHeight !== this.style[\"height\"]) {\r\n      this.style[\"height\"] = cssHeight;\r\n      this.dom.style[\"height\"] = cssHeight;\r\n      this.dom.height = height;\r\n\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _calcUpdateKey() {\r\n    return _themeUpdateKey;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.style[\"user-select\"] = \"none\";\r\n    this.dom.style[\"user-select\"] = \"none\";\r\n\r\n    this.updateDefaultSize();\r\n    this.updateWidth();\r\n    this.updateDPI();\r\n    this.updateName();\r\n    this.updateDisabled();\r\n\r\n    if (this.background !== this._last_bg) {\r\n      this._last_bg = this.background;\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n\r\n    let key = this._calcUpdateKey();\r\n    if (key !== this._last_but_update_key) {\r\n      this._last_but_update_key = key;\r\n\r\n      this.setCSS();\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.updateBorders();\r\n\r\n    let name = this._name;\r\n    if (name === undefined) {\r\n      return;\r\n    }\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let pad = this.getDefault(\"padding\");\r\n    let ts = this.getDefault(\"DefaultText\").size;\r\n\r\n    let tw = ui_base.measureText(this, this._genLabel(), {\r\n      size: ts,\r\n      font: this.getDefault(\"DefaultText\")\r\n    }).width + 2.0*pad + this._leftPad + this._rightPad;\r\n\r\n    if (this._namePad !== undefined) {\r\n      tw += this._namePad;\r\n    }\r\n\r\n    let w = this.getDefault(\"width\");\r\n\r\n    w = Math.max(w, tw);\r\n    w = ~~w;\r\n    this.dom.style[\"width\"] = w + \"px\";\r\n    this.updateBorders();\r\n  }\r\n\r\n  updateBorders(dom=this.dom) {\r\n    let lwid = this.getDefault(\"border-width\");\r\n\r\n    if (lwid) {\r\n      dom.style[\"border-color\"] = this.getDefault(\"border-color\");\r\n      dom.style[\"border-width\"] = lwid + \"px\";\r\n      dom.style[\"border-style\"] = \"solid\";\r\n      dom.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n    } else {\r\n      dom.style[\"border-color\"] = \"none\";\r\n      dom.style[\"border-width\"] = \"0px\";\r\n      dom.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n    }\r\n\r\n  }\r\n\r\n  updateName() {\r\n    if (!this.hasAttribute(\"name\")) {\r\n      return;\r\n    }\r\n\r\n    let name = this.getAttribute(\"name\");\r\n\r\n    if (name !== this._name) {\r\n      this._name = name;\r\n\r\n      this.setCSS();\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  updateWidth(w_add = 0) {\r\n  }\r\n\r\n  _repos_canvas() {\r\n    let dpi = this.getDPI();\r\n\r\n    let w = parsepx(this.dom.style[\"width\"]);\r\n    let h = parsepx(this.dom.style[\"height\"]);\r\n\r\n    let w2 = ~~(w*dpi);\r\n    let h2 = ~~(h*dpi);\r\n\r\n    w = w2/dpi;\r\n    h = h2/dpi;\r\n\r\n    this.dom.width = w2;\r\n    this.dom.style[\"width\"] = w + \"px\";\r\n\r\n    this.dom.height = h2;\r\n    this.dom.style[\"height\"] = h + \"px\";\r\n  }\r\n\r\n  updateDPI() {\r\n    let dpi = this.getDPI();\r\n\r\n    if (this._last_dpi !== dpi) {\r\n      //console.log(\"update dpi\", dpi);\r\n\r\n      this._last_dpi = dpi;\r\n\r\n      this.g.font = undefined; //reset font\r\n\r\n      this.setCSS();\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n\r\n    if (this.style[\"background-color\"]) {\r\n      this.dom._background = this.style[\"background-color\"];\r\n      this.style[\"background-color\"] = \"\";\r\n    }\r\n\r\n    //console.log(\">\", this.dom.style[\"background-color\"], \"-----\");\r\n    //console.log(\"width:\", this.clientWidth)\r\n  }\r\n\r\n  _genLabel() {\r\n    return \"\" + this._name;\r\n  }\r\n\r\n  _getSubKey() {\r\n    if (this._pressed) {\r\n      return 'depressed';\r\n    } else if (this._highlight) {\r\n      return 'highlight';\r\n    } else {\r\n      return undefined; //make getSubDefault forward to getDefault\r\n    }\r\n  }\r\n\r\n  _redraw(draw_text = true) {\r\n    //console.log(\"button draw\");\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let subkey = this._getSubKey();\r\n\r\n    if (this._pressed && this._highlight) {\r\n      this.dom._background = this.getSubDefault(subkey, \"highlight-pressed\", \"BoxHighlight\");\r\n    } else if (this._pressed) {\r\n      this.dom._background = this.getSubDefault(subkey, \"pressed\", \"BoxDepressed\");\r\n    } else if (this._highlight) {\r\n      this.dom._background = this.getSubDefault(subkey, \"highlight\", \"BoxHighlight\");\r\n    } else {\r\n      this.dom._background = this.getSubDefault(subkey, \"background-color\", \"background-color\");\r\n    }\r\n\r\n    ui_base.drawRoundBox(this, this.dom, this.g);\r\n\r\n    //drawn with CSS now\r\n    /*\r\n    let lwid = this.getDefault(\"border-width\");\r\n    if (lwid) {\r\n      this.g.lineWidth = lwid*dpi;\r\n      ui_base.drawRoundBox(this, this.dom, this.g, undefined, undefined, undefined, \"stroke\");\r\n    }\r\n     */\r\n\r\n    this.updateBorders();\r\n\r\n    if (this._focus) {\r\n      let w = this.dom.width, h = this.dom.height;\r\n      let p = 1/dpi;\r\n\r\n      //XXX remove this.g.translate lines after refactoring drawRoundBox, see comment in ui_base.js\r\n      this.g.translate(p, p);\r\n      let lw = this.g.lineWidth;\r\n\r\n\r\n      this.g.lineWidth = this.getDefault(\"focus-border-width\", undefined, 1.0)*dpi;\r\n\r\n      ui_base.drawRoundBox(this, this.dom, this.g, w - p*2, h - p*2, this.r, \"stroke\", this.getDefault(\"BoxHighlight\"));\r\n\r\n      this.g.lineWidth = lw;\r\n      this.g.translate(-p, -p);\r\n    }\r\n\r\n    if (draw_text) {\r\n      this._draw_text();\r\n    }\r\n  }\r\n\r\n  _draw_text() {\r\n    let dpi = this.getDPI();\r\n\r\n    let subkey = this._getSubKey();\r\n\r\n    //if (util.isMobile()) {\r\n    //dpi = dpi; //visualViewport.scale;\r\n    //}\r\n\r\n    let font = this.getSubDefault(subkey, \"DefaultText\");\r\n\r\n    let pad = this.getDefault(\"padding\")*dpi;\r\n    let ts = font.size*dpi;\r\n\r\n    let text = this._genLabel();\r\n\r\n    //console.log(text, \"text\", this._name);\r\n\r\n    let w = this.dom.width, h = this.dom.height;\r\n\r\n    let tw = ui_base.measureText(this, text, undefined, undefined, ts, font).width;\r\n\r\n    let cx = pad*0.5 + this._leftPad*dpi;\r\n    let cy = ts + (h - ts)/3.0;\r\n\r\n    let g = this.g;\r\n\r\n    ui_base.drawText(this, ~~cx, ~~cy, text, {\r\n      canvas: this.dom,\r\n      g     : this.g,\r\n      size  : ts/dpi,\r\n      font  : font\r\n    });\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(OldButton);\r\n","\"use strict\";\r\n\r\nimport * as units from '../core/units.js';\r\nimport * as util from '../path-controller/util/util.js';\r\nimport {Vector2, Vector3, Vector4, Matrix4, Quat} from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nfunction myToFixed(s, n) {\r\n  s = s.toFixed(n);\r\n\r\n  while (s.endsWith('0')) {\r\n    s = s.slice(0, s.length - 1);\r\n  }\r\n  if (s.endsWith(\"\\.\")) {\r\n    s = s.slice(0, s.length - 1);\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nlet keymap = events.keymap;\r\n\r\nlet EnumProperty = toolprop.EnumProperty,\r\n    PropTypes    = toolprop.PropTypes;\r\n\r\nlet UIBase     = ui_base.UIBase,\r\n    PackFlags  = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nlet parsepx = ui_base.parsepx;\r\n\r\nimport {Button} from './ui_button.js';\r\nimport {_setTextboxClass} from '../core/ui_base.js';\r\n\r\nexport class TextBoxBase extends UIBase {\r\n  static define() {\r\n    return {\r\n      modalKeyEvents: true\r\n    }\r\n  }\r\n}\r\n\r\nexport class TextBox extends TextBoxBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._editing = false;\r\n\r\n    this._width = this.getDefault(\"width\") + \"px\";\r\n    this._textBoxEvents = true;\r\n\r\n    let margin = Math.ceil(3*this.getDPI());\r\n\r\n    this._had_error = false;\r\n\r\n    this.decimalPlaces = undefined; //will inherit from property defaults\r\n\r\n    this.baseUnit = undefined; //will automatically use defaults\r\n    this.displayUnit = undefined; //will automatically use defaults\r\n\r\n    this.dom = document.createElement(\"input\");\r\n\r\n    this.dom.tabIndex = 0;\r\n    this.dom.setAttribute(\"tabindex\", 0);\r\n    this.dom.setAttribute(\"tab-index\", 0);\r\n    this.dom.style[\"margin\"] = margin + \"px\";\r\n\r\n    this.dom.setAttribute(\"type\", \"textbox\");\r\n    this.dom.onchange = (e) => {\r\n      this._change(this.dom.value);\r\n    }\r\n\r\n    this.radix = 16;\r\n\r\n    this.dom.oninput = (e) => {\r\n      this._change(this.dom.value);\r\n    }\r\n\r\n    this.shadow.appendChild(this.dom);\r\n\r\n    this.dom.addEventListener(\"focus\", (e) => {\r\n      console.log(\"Textbox focus\", this.isModal);\r\n\r\n      this._focus = 1;\r\n\r\n      if (this.isModal) {\r\n        this._startModal();\r\n        this.setCSS();\r\n      }\r\n    });\r\n\r\n    this.dom.addEventListener(\"blur\", (e) => {\r\n      console.log(\"Textbox blur\");\r\n\r\n      this._focus = 0;\r\n\r\n      if (this._modal) {\r\n        this._endModal(true);\r\n        this.setCSS();\r\n      }\r\n    });\r\n\r\n  }\r\n\r\n  get startSelected() {\r\n    let b = (\"\" + this.getAttribute(\"start-selected\")).toLowerCase();\r\n\r\n    return b === \"yes\" || b === \"true\" || b === \"on\" || b === \"1\";\r\n  }\r\n\r\n  set startSelected(v) {\r\n    this.setAttribute(\"start-selected\", v ? \"true\" : \"false\");\r\n  }\r\n\r\n  /** realtime dom attribute getter, defaults to true in absence of attribute*/\r\n  get realtime() {\r\n    let ret = this.getAttribute(\"realtime\");\r\n\r\n    if (!ret) {\r\n      return true;\r\n    }\r\n\r\n    ret = ret.toLowerCase().trim();\r\n\r\n    return ret === 'yes' || ret === 'true' || ret === 'on';\r\n  }\r\n\r\n  set realtime(val) {\r\n    this.setAttribute('realtime', val ? 'true' : 'false');\r\n  }\r\n\r\n  get isModal() {\r\n    let ret = this.getAttribute(\"modal\");\r\n\r\n    if (!ret) {\r\n      return false;\r\n    }\r\n\r\n    ret = ret.toLowerCase().trim();\r\n\r\n    return ret === 'yes' || ret === 'true' || ret === 'on';\r\n  }\r\n\r\n  set isModal(val) {\r\n    this.setAttribute('modal', val ? 'true' : 'false');\r\n  }\r\n\r\n  _startModal() {\r\n    if (this.startSelected) {\r\n      this.select();\r\n    }\r\n\r\n    console.warn(\"textbox modal\");\r\n\r\n    if (this._modal) {\r\n      this._endModal(true);\r\n    }\r\n\r\n    this._editing = true;\r\n\r\n    let ignore = 0;\r\n\r\n    let finish = (ok) => {\r\n      this._endModal(ok);\r\n    }\r\n\r\n    let keydown = (e) => {\r\n      e.stopPropagation();\r\n\r\n      switch (e.keyCode) {\r\n        case keymap.Enter:\r\n          finish(true);\r\n          break;\r\n        case keymap.Escape:\r\n          finish(false);\r\n          break;\r\n      }\r\n\r\n      return;\r\n      if (ignore) return;\r\n\r\n      let e2 = new KeyboardEvent(e.type, e);\r\n\r\n      ignore = 1;\r\n      this.dom.dispatchEvent(e2);\r\n      ignore = 0;\r\n    };\r\n\r\n    this._modal = true;\r\n    this.pushModal({\r\n      on_mousemove: (e) => {\r\n        e.stopPropagation();\r\n      },\r\n\r\n      on_keydown : keydown,\r\n      on_keypress: keydown,\r\n      on_keyup   : keydown,\r\n\r\n      on_mousedown: (e) => {\r\n        e.stopPropagation();\r\n        console.log(\"mouse down\", e, e.x, e.y);\r\n      }\r\n    }, false)\r\n  }\r\n\r\n  _flash_focus() {\r\n    //don't focus on flash\r\n  }\r\n\r\n  get editing() {\r\n    return this._editing;\r\n  }\r\n\r\n  _endModal(ok) {\r\n    console.log(\"textbox end modal\");\r\n\r\n    this._editing = false;\r\n\r\n    this._modal = false;\r\n    this.popModal();\r\n\r\n    this.blur();\r\n\r\n    if (this.onend) {\r\n      this.onend(ok);\r\n    } else {\r\n      this._updatePathVal(this.dom.value);\r\n    }\r\n\r\n    this.blur();\r\n  }\r\n\r\n  get tabIndex() {\r\n    return this.dom.tabIndex;\r\n  }\r\n\r\n  set tabIndex(val) {\r\n    this.dom.tabIndex = val;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    //set isModal default\r\n    if (!this.hasAttribute('modal')) {\r\n      this.isModal = true;\r\n    }\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"width\"] = this._width;\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  set width(val) {\r\n    if (typeof val === \"number\") {\r\n      val += \"px\";\r\n    }\r\n\r\n    this._width = val;\r\n    this.style[\"width\"] = val;\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.overrideDefault(\"background-color\", this.getDefault(\"background-color\"));\r\n\r\n    this.background = this.getDefault(\"background-color\");\r\n    this.dom.style[\"margin\"] = this.dom.style[\"padding\"] = \"0px\";\r\n\r\n    if (this.getDefault(\"background-color\")) {\r\n      this.dom.style[\"background-color\"] = this.getDefault(\"background-color\");\r\n    }\r\n\r\n    this.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n    this.dom.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n\r\n    let bwid = this.getDefault(\"border-width\");\r\n    let bcolor = this.getDefault(\"border-color\");\r\n    let bstyle = this.getDefault(\"border-style\");\r\n    let border = `${bwid}px ${bstyle} ${bcolor}`\r\n\r\n    this.style[\"border\"] = border;\r\n    this.style[\"border-color\"] = bcolor;\r\n\r\n    if (this._focus) {\r\n      this.dom.style[\"border\"] = `2px dashed ${this.getDefault('focus-border-color')}`;\r\n    } else {\r\n      this.dom.style[\"border\"] = border;\r\n      this.dom.style[\"border-color\"] = bcolor;\r\n    }\r\n\r\n    if (this.style[\"font\"]) {\r\n      this.dom.style[\"font\"] = this.style[\"font\"];\r\n    } else {\r\n      this.dom.style[\"font\"] = this.getDefault(\"DefaultText\").genCSS();\r\n      this.dom.style[\"color\"] = this.getDefault(\"DefaultText\").color;\r\n    }\r\n\r\n    this.dom.style[\"width\"] = \"100%\";\r\n    this.dom.style[\"height\"] = \"100%\";\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.ctx || !this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n    if (this._focus || this._flashtimer !== undefined || (this._had_error && this._focus)) {\r\n      return;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n    if (val === undefined || val === null) {\r\n      this.internalDisabled = true;\r\n      return;\r\n    } else {\r\n      this.internalDisabled = false;\r\n    }\r\n\r\n\r\n    let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    let text = this.text;\r\n\r\n    if (!prop) {\r\n      console.error(\"datapath error \" + this.getAttribute(\"datapath\"), val);\r\n      return;\r\n    }\r\n\r\n    let is_num = prop.type & (PropTypes.FLOAT | PropTypes.INT);\r\n    if (typeof val === \"number\" && (prop.type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4 | PropTypes.QUAT))) {\r\n      is_num = true;\r\n    }\r\n\r\n    if (is_num) {\r\n      let is_int = prop.type === PropTypes.INT;\r\n\r\n      this.radix = prop.radix;\r\n\r\n      let decimalPlaces = this.decimalPlaces !== undefined ? this.decimalPlaces : prop.decimalPlaces;\r\n      if (this.hasAttribute(\"decimalPlaces\")) {\r\n        decimalPlaces = parseInt(this.getAttribute(\"decimalPlaces\"));\r\n      }\r\n\r\n      let baseUnit = this.baseUnit ?? prop.baseUnit;\r\n      if (this.hasAttribute(\"baseUnit\")) {\r\n        baseUnit = this.getAttribute(\"baseUnit\");\r\n      }\r\n\r\n      let displayUnit = this.displayUnit ?? prop.displayUnit;\r\n      if (this.hasAttribute(\"displayUnit\")) {\r\n        displayUnit = this.getAttribute(\"displayUnit\");\r\n      }\r\n\r\n      if (is_int && this.radix === 2) {\r\n        text = val.toString(this.radix);\r\n        text = \"0b\" + text;\r\n      } else if (is_int && this.radix === 16) {\r\n        text += \"h\";\r\n      } else {\r\n        text = units.buildString(val, baseUnit, decimalPlaces, displayUnit);\r\n      }\r\n    } else if (prop !== undefined && prop.type === PropTypes.STRING) {\r\n      text = val;\r\n    }\r\n\r\n    if (this.text !== text) {\r\n      this.text = text;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    if (this.dom.style[\"width\"] !== this.style[\"width\"]) {\r\n      this.dom.style[\"width\"] = this.style[\"width\"];\r\n    }\r\n    if (this.dom.style[\"height\"] !== this.style[\"height\"]) {\r\n      this.dom.style[\"height\"] = this.style[\"height\"];\r\n    }\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  select() {\r\n    this.dom.select();\r\n    //return this.dom.select.apply(this, arguments);\r\n  }\r\n\r\n  focus() {\r\n    return this.dom.focus();\r\n  }\r\n\r\n  blur() {\r\n    return this.dom.blur();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname       : \"textbox-x\",\r\n      style         : \"textbox\",\r\n      modalKeyEvents: true\r\n    };\r\n  }\r\n\r\n  get text() {\r\n    return this.dom.value;\r\n  }\r\n\r\n  set text(value) {\r\n    this.dom.value = value;\r\n  }\r\n\r\n  _prop_update(prop, text) {\r\n    let is_num = prop.type & (PropTypes.FLOAT | PropTypes.INT);\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (typeof val === \"number\" && (prop.type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4 | PropTypes.QUAT))) {\r\n      is_num = true;\r\n    }\r\n\r\n    if (is_num) {\r\n      let is_int = prop.type === PropTypes.INT;\r\n\r\n      this.radix = prop.radix;\r\n\r\n      let decimalPlaces = this.decimalPlaces !== undefined ? this.decimalPlaces : prop.decimalPlaces;\r\n      if (this.hasAttribute(\"decimalPlaces\")) {\r\n        decimalPlaces = parseInt(this.getAttribute(\"decimalPlaces\"));\r\n      }\r\n\r\n      let baseUnit = this.baseUnit ?? prop.baseUnit;\r\n      if (this.hasAttribute(\"baseUnit\")) {\r\n        baseUnit = this.getAttribute(\"baseUnit\");\r\n      }\r\n\r\n      let displayUnit = this.displayUnit ?? prop.displayUnit;\r\n      if (this.hasAttribute(\"displayUnit\")) {\r\n        displayUnit = this.getAttribute(\"displayUnit\");\r\n      }\r\n\r\n      if (!units.isNumber(text.trim())) {\r\n        this.flash(ui_base.ErrorColors.ERROR, this.dom, undefined, false);\r\n        this.focus();\r\n        this.dom.focus();\r\n        this._had_error = true;\r\n      } else {\r\n        let val = units.parseValue(text, baseUnit, displayUnit);\r\n\r\n        if (this._had_error) {\r\n          this.flash(ui_base.ErrorColors.OK, this.dom, undefined, false);\r\n        }\r\n\r\n        this._had_error = false;\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), val);\r\n      }\r\n    } else if (prop.type === PropTypes.STRING) {\r\n      try {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this.text);\r\n\r\n        if (this._had_error) {\r\n          this.flash(ui_base.ErrorColors.OK, this.dom, undefined, false);\r\n          this.dom.focus();\r\n        }\r\n\r\n        this._had_error = false;\r\n      } catch (error) {\r\n        console.log(error.stack);\r\n        console.log(error.message);\r\n        console.warn(\"textbox error!\");\r\n        //this._had_error = true;\r\n\r\n        this.flash(ui_base.ErrorColors.ERROR, this.dom, undefined, false);\r\n        this.dom.focus();\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  _updatePathVal(text) {\r\n    if (this.hasAttribute(\"datapath\") && this.ctx !== undefined) {\r\n      let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n      console.log(prop);\r\n\r\n      if (prop) {\r\n        this._prop_update(prop, text);\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  _change(text) {\r\n    if (this.realtime) {\r\n      this._updatePathVal(text);\r\n    }\r\n\r\n    if (this.onchange) {\r\n      this.onchange(text);\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(TextBox);\r\n\r\n/**\r\n\r\n Returns false if it's safe to call preventDefault.\r\n\r\n Returns true if the element at position x,y is\r\n either a textbox or is draggable.\r\n */\r\nexport function checkForTextBox(screen, x, y) {\r\n  let p = screen.pickElement(x, y);\r\n  //console.log(p, x, y);\r\n\r\n  while (p) {\r\n    //don't prevent draggable elements from dragging\r\n    if (p.draggable) {\r\n      return true;\r\n    }\r\n\r\n    if (p instanceof UIBase) {\r\n      //check immediate children of p\r\n      for (let i = 0; i < 2; i++) {\r\n        let nodes = i ? p.childNodes : p.shadow.childNodes;\r\n\r\n        for (let child of nodes) {\r\n          if (child.draggable) {\r\n            return true;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    let ok = p instanceof TextBoxBase;\r\n    ok = ok || p.constructor.define && p.constructor.define().modalKeyEvents;\r\n\r\n    if (ok) {\r\n      return true;\r\n    }\r\n\r\n    p = p.parentWidget ? p.parentWidget : p.parentNode;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nui_base._setTextboxClass(TextBox);\r\n","\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as toolsys from '../path-controller/toolsys/toolsys.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport {DataPathError} from '../path-controller/controller/controller.js';\r\nimport {Vector3, Vector4, Quat, Matrix4} from '../path-controller/util/vectormath.js';\r\nimport {isNumber, PropFlags} from \"../path-controller/toolsys/toolprop.js\";\r\nimport * as units from '../core/units.js';\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nfunction myToFixed(s, n) {\r\n  s = s.toFixed(n);\r\n\r\n  while (s.endsWith('0')) {\r\n    s = s.slice(0, s.length - 1);\r\n  }\r\n  if (s.endsWith(\"\\.\")) {\r\n    s = s.slice(0, s.length - 1);\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nlet keymap = events.keymap;\r\n\r\nlet EnumProperty = toolprop.EnumProperty,\r\n    PropTypes    = toolprop.PropTypes;\r\n\r\nlet UIBase     = ui_base.UIBase,\r\n    PackFlags  = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nlet parsepx = ui_base.parsepx;\r\n\r\nimport {Button, OldButton} from './ui_button.js';\r\nimport {eventWasTouch, popModalLight, pushModalLight} from '../path-controller/util/simple_events.js';\r\n\r\nexport {Button} from './ui_button.js';\r\n\r\nexport class IconLabel extends UIBase {\r\n  constructor() {\r\n    super();\r\n    this._icon = -1;\r\n    this.iconsheet = 1;\r\n  }\r\n\r\n  get icon() {\r\n    return this._icon;\r\n  }\r\n\r\n  set icon(id) {\r\n    this._icon = id;\r\n    this.setCSS();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"icon-label-x\"\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"margin\"] = this.style[\"padding\"] = \"0px\";\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  setCSS() {\r\n    let size = ui_base.iconmanager.getTileSize(this.iconsheet);\r\n\r\n\r\n    ui_base.iconmanager.setCSS(this.icon, this);\r\n\r\n    this.style[\"width\"] = size + \"px\";\r\n    this.style[\"height\"] = size + \"px\";\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(IconLabel);\r\n\r\nexport class ValueButtonBase extends OldButton {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(val) {\r\n    this._value = val;\r\n\r\n    if (this.ctx && this.hasAttribute(\"datapath\")) {\r\n      this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this._value);\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) return;\r\n    if (this.ctx === undefined) return;\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (val === undefined) {\r\n      let redraw = !this.disabled;\r\n\r\n      this.internalDisabled = true;\r\n\r\n      if (redraw) this._redraw();\r\n\r\n      return;\r\n    } else {\r\n      let redraw = this.disabled;\r\n\r\n      this.internalDisabled = false;\r\n      if (redraw) this._redraw();\r\n    }\r\n\r\n    if (val !== this._value) {\r\n      this._value = val;\r\n      this.updateWidth();\r\n      this._repos_canvas();\r\n      this._redraw();\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    this.updateDataPath();\r\n\r\n    super.update();\r\n  }\r\n}\r\n\r\nexport class Check extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._checked = false;\r\n    this._highlight = false;\r\n    this._focus = false;\r\n\r\n    let shadow = this.shadow;\r\n\r\n    //let form = document.createElement(\"form\");\r\n\r\n    let span = document.createElement(\"span\");\r\n    span.setAttribute(\"class\", \"checkx\");\r\n\r\n    span.style[\"display\"] = \"flex\";\r\n    span.style[\"flex-direction\"] = \"row\";\r\n    span.style[\"margin\"] = span.style[\"padding\"] = \"0px\";\r\n    //span.style[\"background\"] = ui_base.iconmanager.getCSS(1);\r\n\r\n    let sheet = 0;\r\n    let size = ui_base.iconmanager.getTileSize(0);\r\n\r\n    let check = this.canvas = document.createElement(\"canvas\");\r\n    this.g = check.getContext(\"2d\");\r\n\r\n    check.setAttribute(\"id\", check._id);\r\n    check.setAttribute(\"name\", check._id);\r\n\r\n    let mdown = (e) => {\r\n      this._highlight = false;\r\n      this.checked = !this.checked;\r\n    };\r\n\r\n    let mup = (e) => {\r\n      this._highlight = false;\r\n      this.blur();\r\n      this._redraw();\r\n    };\r\n\r\n    let mover = (e) => {\r\n      this._highlight = true;\r\n      this._redraw();\r\n    };\r\n\r\n    let mleave = (e) => {\r\n      this._highlight = false;\r\n      this._redraw();\r\n    };\r\n\r\n    span.addEventListener(\"pointerover\", mover, {passive: true});\r\n    span.addEventListener(\"mousein\", mover, {passive: true});\r\n    span.addEventListener(\"mouseleave\", mleave, {passive: true});\r\n    span.addEventListener(\"pointerout\", mleave, {passive: true});\r\n\r\n    this.addEventListener(\"blur\", (e) => {\r\n      this._highlight = this._focus = false;\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"focusin\", (e) => {\r\n      this._focus = true;\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"focus\", (e) => {\r\n      this._focus = true;\r\n      this._redraw();\r\n    });\r\n\r\n\r\n    span.addEventListener(\"pointerdown\", mdown, {passive: true});\r\n    span.addEventListener(\"pointerup\", mup, {passive: true});\r\n    span.addEventListener(\"pointercancel\", mup, {passive: true});\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Escape\"]:\r\n          this._highlight = undefined;\r\n          this._redraw();\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n\r\n          this.blur();\r\n          break;\r\n        case keymap[\"Enter\"]:\r\n        case keymap[\"Space\"]:\r\n          this.checked = !this.checked;\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          break;\r\n      }\r\n    });\r\n    this.checkbox = check;\r\n\r\n    span.appendChild(check);\r\n\r\n    let label = this._label = document.createElement(\"label\");\r\n    label.setAttribute(\"class\", \"checkx\");\r\n    span.setAttribute(\"class\", \"checkx\");\r\n    label.style[\"align-self\"] = \"center\";\r\n\r\n    let side = this.getDefault(\"CheckSide\");\r\n    if (side === \"right\") {\r\n      span.prepend(label);\r\n    } else {\r\n      span.appendChild(label);\r\n    }\r\n\r\n    shadow.appendChild(span);\r\n  }\r\n\r\n  get internalDisabled() {\r\n    return super.internalDisabled;\r\n  }\r\n\r\n  set internalDisabled(val) {\r\n    if (!!this.internalDisabled === !!val) {\r\n      return;\r\n    }\r\n\r\n    super.internalDisabled = val;\r\n    this._redraw();\r\n  }\r\n\r\n  get value() {\r\n    return this.checked;\r\n  }\r\n\r\n  set value(v) {\r\n    this.checked = v;\r\n  }\r\n\r\n  get checked() {\r\n    return this._checked;\r\n  }\r\n\r\n  set checked(v) {\r\n    v = !!v;\r\n\r\n    if (this._checked !== v) {\r\n      this._checked = v;\r\n\r\n      this.setCSS();\r\n\r\n      //this.dom.checked = v;\r\n      this._redraw();\r\n\r\n      if (this.onclick) {\r\n        this.onclick(v);\r\n      }\r\n      if (this.onchange) {\r\n        this.onchange(v);\r\n      }\r\n\r\n      if (this.hasAttribute(\"datapath\")) {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this._checked);\r\n      }\r\n    }\r\n  }\r\n\r\n  get label() {\r\n    return this._label.textContent;\r\n  }\r\n\r\n  set label(l) {\r\n    this._label.textContent = l;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname    : \"check-x\",\r\n      style      : \"checkbox\",\r\n      parentStyle: \"button\"\r\n    };\r\n  }\r\n\r\n  init() {\r\n    this.tabIndex = 1;\r\n    this.setAttribute(\"class\", \"checkx\");\r\n\r\n\r\n    let style = document.createElement(\"style\");\r\n    //let style = this.cssStyleTag();\r\n\r\n    let color = this.getDefault(\"focus-border-color\");\r\n\r\n    style.textContent = `\r\n      .checkx:focus {\r\n        outline : none;\r\n      }\r\n    `;\r\n\r\n    //document.body.prepend(style);\r\n    this.prepend(style);\r\n  }\r\n\r\n  setCSS() {\r\n    this._label.style[\"font\"] = this.getDefault(\"DefaultText\").genCSS();\r\n    this._label.style[\"color\"] = this.getDefault(\"DefaultText\").color;\r\n\r\n    this._label.style['font'] = 'normal 14px poppins'; // TODO - Jordan - add to settings\r\n\r\n    super.setCSS();\r\n\r\n    //force clear background\r\n    this.style[\"background-color\"] = \"rgba(0,0,0,0)\";\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.getAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    let redraw = false;\r\n\r\n    if (val === undefined) {\r\n      this.internalDisabled = true;\r\n      return;\r\n    } else {\r\n      redraw = this.internalDisabled;\r\n\r\n      this.internalDisabled = false;\r\n    }\r\n\r\n    val = !!val;\r\n\r\n    redraw = redraw || !!this._checked !== !!val;\r\n\r\n    if (redraw) {\r\n      this._checked = val;\r\n      this._repos_canvas();\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _repos_canvas() {\r\n  }\r\n\r\n  _redraw() {\r\n    if (this.canvas === undefined) {\r\n      //flag update\r\n      this._updatekey = \"\";\r\n      return;\r\n    }\r\n\r\n    let canvas = this.canvas, g = this.g;\r\n    let dpi = UIBase.getDPI();\r\n    let tilesize = ui_base.iconmanager.getTileSize(0);\r\n    let pad = this.getDefault(\"padding\");\r\n\r\n    let csize = tilesize + pad*2;\r\n\r\n    canvas.style[\"margin\"] = \"2px\";\r\n    canvas.style[\"width\"] = csize + \"px\";\r\n    canvas.style[\"height\"] = csize + \"px\";\r\n\r\n    csize = ~~(csize*dpi + 0.5);\r\n    tilesize = ~~(tilesize*dpi + 0.5);\r\n\r\n    canvas.width = csize;\r\n    canvas.height = csize;\r\n\r\n    g.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    g.beginPath();\r\n    g.rect(0, 0, canvas.width, canvas.height);\r\n    g.fill();\r\n\r\n    let color;\r\n\r\n    if (!this._checked && this._highlight) {\r\n      color = this.getDefault(\"BoxHighlight\");\r\n    }\r\n\r\n    ui_base.drawRoundBox(this, canvas, g, undefined, undefined, undefined, undefined, color);\r\n    if (this._checked) {\r\n      //canvasDraw(elem, canvas, g, icon, x=0, y=0, sheet=0) {\r\n      let x = (csize - tilesize)*0.5, y = (csize - tilesize)*0.5;\r\n      ui_base.iconmanager.canvasDraw(this, canvas, g, ui_base.Icons.LARGE_CHECK, x, y);\r\n    }\r\n\r\n    if (this._focus) {\r\n      color = this.getDefault(\"focus-border-color\");\r\n      g.lineWidth *= dpi;\r\n      ui_base.drawRoundBox(this, canvas, g, undefined, undefined, undefined, \"stroke\", color);\r\n    }\r\n  }\r\n\r\n  updateDPI() {\r\n    let dpi = UIBase.getDPI();\r\n\r\n    if (dpi !== this._last_dpi) {\r\n      this._last_dpi = dpi;\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateDPI();\r\n\r\n    let ready = ui_base.getIconManager().isReady(0);\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n\r\n    let updatekey = this.getDefault(\"DefaultText\").hash();\r\n    updatekey += this._checked + \":\" + this._label.textContent;\r\n    updatekey += \":\" + ready;\r\n\r\n    if (updatekey !== this._updatekey) {\r\n      this._repos_canvas();\r\n      this.setCSS();\r\n\r\n      this._updatekey = updatekey;\r\n      this._redraw();\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(Check);\r\n\r\nexport class IconButton extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._customIcon = undefined;\r\n\r\n    this._pressed = false;\r\n    this._highlight = false;\r\n    this._draw_pressed = true;\r\n\r\n    this._icon = -1;\r\n    this._icon_pressed = undefined;\r\n    this.iconsheet = 0;\r\n    this.drawButtonBG = true;\r\n\r\n    this._extraIcon = undefined; //draw another icon on top\r\n\r\n    this.extraDom = undefined;\r\n\r\n    //have to put icon in subdiv\r\n    this.dom = document.createElement(\"div\");\r\n    this.shadow.appendChild(this.dom);\r\n\r\n    this._last_iconsheet = undefined;\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Enter\"]:\r\n        case keymap[\"Space\"]:\r\n          this.click();\r\n          break;\r\n      }\r\n    });\r\n  }\r\n\r\n  click() {\r\n    if (this._onpress) {\r\n      let rect = this.getClientRects();\r\n      let x = rect.x + rect.width*0.5;\r\n      let y = rect.y + rect.height*0.5;\r\n\r\n      let e = {x : x, y : y, stopPropagation : () => {}, preventDefault : () => {}};\r\n\r\n      this._onpress(e);\r\n    }\r\n\r\n    super.click();\r\n  }\r\n\r\n  get customIcon() {\r\n    return this._customIcon;\r\n  }\r\n\r\n  set customIcon(domImage) {\r\n    this._customIcon = domImage;\r\n    this.setCSS();\r\n  }\r\n\r\n  get icon() {\r\n    return this._icon;\r\n  }\r\n\r\n  set icon(val) {\r\n    this._icon = val;\r\n    this.setCSS();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"iconbutton-x\",\r\n      style  : \"iconbutton\"\r\n    };\r\n  }\r\n\r\n  _on_press() {\r\n    this._pressed = true;\r\n    this.setCSS();\r\n  }\r\n\r\n  _on_depress() {\r\n    this._pressed = false;\r\n    this.setCSS();\r\n  }\r\n\r\n  updateDefaultSize() {\r\n\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    let def;\r\n    let pstyle = this.getDefault(\"depressed\");\r\n    let hstyle = this.getDefault(\"highlight\");\r\n\r\n    this.noMarginsOrPadding();\r\n\r\n    if (this._pressed && this._draw_pressed) {\r\n      def = k => this.getSubDefault(\"depressed\", k);\r\n    } else if (this._highlight) {\r\n      def = k => this.getSubDefault(\"highlight\", k);\r\n    } else {\r\n      def = k => this.getDefault(k);\r\n    }\r\n\r\n    let loadstyle = (key, addpx) => {\r\n      let val = def(key);\r\n      if (addpx) {\r\n        val = (\"\" + val).trim();\r\n\r\n        if (!val.toLowerCase().endsWith(\"px\")) {\r\n          val += \"px\";\r\n        }\r\n      }\r\n\r\n      this.style[key] = val;\r\n    }\r\n\r\n    let keys = [\"margin\", \"padding\", \"margin-left\", \"margin-right\", \"margin-top\", \"margin-botton\",\r\n                \"padding-left\", \"padding-bottom\", \"padding-top\", \"padding-right\",\r\n                \"border-radius\"]\r\n\r\n    for (let k of keys) {\r\n      loadstyle(k, true);\r\n    }\r\n    loadstyle(\"background-color\", false);\r\n    loadstyle(\"color\", false);\r\n\r\n    let border = `${def(\"border-width\", true)} ${def(\"border-style\", false)} ${def(\"border-color\", false)}`\r\n    this.style[\"border\"] = border;\r\n\r\n    let w = this.getDefault(\"width\");\r\n\r\n    let size = ui_base.iconmanager.getTileSize(this.iconsheet);\r\n    w = size;\r\n\r\n    this.style[\"width\"] = w + \"px\";\r\n    this.style[\"height\"] = w + \"px\";\r\n\r\n    this.dom.style[\"width\"] = w + \"px\";\r\n    this.dom.style[\"height\"] = w + \"px\";\r\n    this.dom.style[\"margin\"] = this.dom.style[\"padding\"] = \"0px\";\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"align-items\"] = \"center\";\r\n\r\n    if (this._customIcon) {\r\n      this.dom.style[\"background-image\"] = `url(\"${this._customIcon.src}\")`\r\n      this.dom.style[\"background-size\"] = \"contain\";\r\n      this.dom.style[\"background-repeat\"] = \"no-repeat\";\r\n    } else {\r\n      let icon = this.icon;\r\n\r\n      if (this._pressed && this._icon_pressed !== undefined) {\r\n        icon = this._icon_pressed;\r\n      }\r\n\r\n      ui_base.iconmanager.setCSS(icon, this.dom, this.iconsheet);\r\n    }\r\n\r\n    if (this._extraIcon !== undefined) {\r\n      let dom;\r\n\r\n      if (!this.extraDom) {\r\n        this.extraDom = dom = document.createElement(\"div\");\r\n\r\n        this.shadow.appendChild(dom);\r\n      } else {\r\n        dom = this.extraDom;\r\n      }\r\n\r\n      dom.style[\"position\"] = \"absolute\";\r\n      dom.style[\"margin\"] = dom.style[\"padding\"] = \"0px\";\r\n      dom.style[\"pointer-events\"] = \"none\";\r\n      dom.style[\"width\"] = size + \"px\";\r\n      dom.style[\"height\"] = size + \"px\";\r\n\r\n      ui_base.iconmanager.setCSS(this._extraIcon, dom, this.iconsheet);\r\n    } else if (this.extraDom) {\r\n      this.extraDom.remove();\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    let press = (e) => {\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n\r\n      if (this.modalRunning) {\r\n        this.popModal();\r\n      }\r\n\r\n      if (!eventWasTouch(e) && e.button !== 0) {\r\n        return;\r\n      }\r\n\r\n      if (1) { //!eventWasTouch(e)) {\r\n        let this2 = this;\r\n\r\n        this.pushModal({\r\n          on_mouseup(e) {\r\n            //touch events aren't fireing onclick automatically the way mouse ones are\r\n\r\n            if (this2.onclick && eventWasTouch(e)) {\r\n              this2.onclick();\r\n            }\r\n            this.end();\r\n          },\r\n          on_touchcancel(e) {\r\n            this.on_mouseup(e);\r\n            this.end();\r\n          },\r\n          on_touchend(e) {\r\n            this.on_mouseup(e);\r\n            this.end();\r\n          },\r\n          on_keydown(e) {\r\n            this.end();\r\n          },\r\n          end() {\r\n            if (this2.modalRunning) {\r\n              this2.popModal();\r\n              this2._on_depress(e)\r\n              this2.setCSS();\r\n            }\r\n          }\r\n        });\r\n      }\r\n\r\n      this._on_press(e);\r\n    }\r\n\r\n    let depress = (e) => {\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n\r\n      this._on_depress();\r\n      this.setCSS();\r\n    }\r\n\r\n    let high = (e) => {\r\n      this._highlight = true;\r\n      this.setCSS();\r\n    }\r\n\r\n    let unhigh = (e) => {\r\n      this._highlight = false;\r\n      this.setCSS();\r\n    }\r\n\r\n    this.tabIndex = 0;\r\n\r\n    this.addEventListener(\"mouseover\", high);\r\n    this.addEventListener(\"mouseexit\", unhigh);\r\n    this.addEventListener(\"mouseleave\", unhigh);\r\n    this.addEventListener(\"focus\", high);\r\n    this.addEventListener(\"blur\", unhigh);\r\n\r\n    this.addEventListener(\"mousedown\", press, {capture: true});\r\n    this.addEventListener(\"mouseup\", depress, {capture: true});\r\n    //this.addEventListener(\"touchstart\", press, {capture: true});\r\n    //this.addEventListener(\"touchcancel\", depress, {capture: true});\r\n    //this.addEventListener(\"touchend\", depress, {capture: true});\r\n    this.setCSS();\r\n\r\n    this.dom.style[\"pointer-events\"] = \"none\";\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    if (this.iconsheet !== this._last_iconsheet) {\r\n      this.setCSS();\r\n      this._last_iconsheet = this.iconsheet;\r\n    }\r\n  }\r\n\r\n  _getsize() {\r\n    let margin = this.getDefault(\"padding\");\r\n\r\n    return ui_base.iconmanager.getTileSize(this.iconsheet) + margin*2;\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(IconButton);\r\n\r\n\r\nexport class IconCheck extends IconButton {\r\n  constructor() {\r\n    super();\r\n\r\n    this._checked = undefined;\r\n    this._drawCheck = undefined;\r\n  }\r\n\r\n  get drawCheck() {\r\n    let ret = this._drawCheck;\r\n\r\n    ret = ret === undefined ? this.getDefault(\"drawCheck\") : ret;\r\n    ret = ret === undefined ? true : ret;\r\n\r\n    return ret;\r\n  }\r\n\r\n  set drawCheck(val) {\r\n    val = !!val;\r\n\r\n    if (val && (this.packflag & PackFlags.HIDE_CHECK_MARKS)) {\r\n      this.packflag &= ~PackFlags.HIDE_CHECK_MARKS;\r\n    }\r\n\r\n    let old = !!this.drawCheck;\r\n    this._drawCheck = val;\r\n\r\n    if (val !== old) {\r\n      this.updateDrawCheck();\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  click() {\r\n    super.click();\r\n    this.checked ^= true;\r\n  }\r\n\r\n  get icon() {\r\n    return this._icon;\r\n  }\r\n\r\n  set icon(val) {\r\n    this._icon = val;\r\n    this.setCSS();\r\n  }\r\n\r\n  get checked() {\r\n    return this._checked;\r\n  }\r\n\r\n  set checked(val) {\r\n    if (!!val !== !!this._checked) {\r\n      this._checked = val\r\n      this._updatePressed(!!val);\r\n      this.setCSS();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(val);\r\n      }\r\n    }\r\n  }\r\n\r\n  get noEmboss() {\r\n    let ret = this.getAttribute(\"no-emboss\");\r\n\r\n    if (!ret) {\r\n      return false;\r\n    }\r\n\r\n    ret = ret.toLowerCase().trim();\r\n\r\n    return ret === 'true' || ret === 'yes' || ret === 'on';\r\n  }\r\n\r\n  set noEmboss(val) {\r\n    this.setAttribute('no-emboss', val ? 'true' : 'false');\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname    : \"iconcheck-x\",\r\n      style      : \"iconcheck\",\r\n      parentStyle: \"iconbutton\"\r\n    };\r\n  }\r\n\r\n  _updatePressed(val) {\r\n    //don't set _pressed if we have a custom icon for press state\r\n    if (this._icon_pressed) {\r\n      this._draw_pressed = false;\r\n    }\r\n\r\n    this._pressed = val;\r\n    this.setCSS();\r\n  }\r\n\r\n  _on_depress() {\r\n    return;\r\n  }\r\n\r\n  _on_press() {\r\n    this.checked ^= true;\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), !!this.checked);\r\n    }\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  updateDefaultSize() {\r\n\r\n  }\r\n\r\n  _calcUpdateKey() {\r\n    return super._calcUpdateKey() + \":\" + this._icon;\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\") || !this.ctx) {\r\n      return;\r\n    }\r\n\r\n    if (this._icon < 0) {\r\n      let rdef;\r\n      try {\r\n        rdef = this.ctx.api.resolvePath(this.ctx, this.getAttribute(\"datapath\"));\r\n      } catch (error) {\r\n        if (error instanceof DataPathError) {\r\n          return;\r\n        } else {\r\n          throw error;\r\n        }\r\n      }\r\n\r\n      if (rdef !== undefined && rdef.prop) {\r\n        let icon, icon2, title;\r\n\r\n        if (rdef.prop.flag & PropFlags.NO_UNDO) {\r\n          this.setUndo(false);\r\n        } else {\r\n          this.setUndo(true);\r\n        }\r\n\r\n        //console.log(\"SUBKEY\", rdef.subkey, rdef.prop.iconmap);\r\n\r\n        if (rdef.subkey && (rdef.prop.type === PropTypes.FLAG || rdef.prop.type === PropTypes.ENUM)) {\r\n          icon = rdef.prop.iconmap[rdef.subkey];\r\n          icon2 = rdef.prop.iconmap2[rdef.subkey];\r\n          title = rdef.prop.descriptions[rdef.subkey];\r\n\r\n          if (!title && rdef.subkey.length > 0) {\r\n            title = rdef.subkey;\r\n            title = title[0].toUpperCase() + title.slice(1, title.length).toLowerCase();\r\n          }\r\n        } else {\r\n          icon2 = rdef.prop.icon2;\r\n          icon = rdef.prop.icon;\r\n          title = rdef.prop.description;\r\n        }\r\n\r\n        if (icon2 !== undefined && icon2 !== -1) {\r\n          this._icon_pressed = icon;\r\n          icon = icon2;\r\n        }\r\n\r\n        if (icon !== undefined && icon !== this.icon)\r\n          this.icon = icon;\r\n        if (title)\r\n          this.description = title;\r\n      }\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (val === undefined) {\r\n      this.internalDisabled = true;\r\n      return;\r\n    } else {\r\n      this.internalDisabled = false;\r\n    }\r\n\r\n    val = !!val;\r\n\r\n    if (val !== !!this._checked) {\r\n      this._checked = val;\r\n      this._updatePressed(!!val);\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  updateDrawCheck() {\r\n    if (this.drawCheck) {\r\n      this._extraIcon = this._checked ? ui_base.Icons.ENUM_CHECKED : ui_base.Icons.ENUM_UNCHECKED;\r\n    } else {\r\n      this._extraIcon = undefined;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    if (this.packflag & PackFlags.HIDE_CHECK_MARKS) {\r\n      this.drawCheck = false;\r\n    }\r\n\r\n    this.updateDrawCheck();\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n\r\n    super.update();\r\n  }\r\n\r\n  _getsize() {\r\n    let margin = this.getDefault(\"padding\");\r\n    return ui_base.iconmanager.getTileSize(this.iconsheet) + margin*2;\r\n  }\r\n\r\n  setCSS() {\r\n    this.updateDrawCheck();\r\n    super.setCSS();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(IconCheck);\r\n\r\nexport class Check1 extends Button {\r\n  constructor() {\r\n    super();\r\n\r\n    this._namePad = 40;\r\n    this._value = undefined;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname    : \"check1-x\",\r\n      parentStyle: \"button\"\r\n    };\r\n  }\r\n\r\n  _redraw() {\r\n    //console.log(\"button draw\");\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let box = 40;\r\n    ui_base.drawRoundBox(this, this.dom, this.g, box);\r\n\r\n    let ts = this.getDefault(\"DefaultText\").size;\r\n\r\n    let text = this._genLabel();\r\n\r\n    //console.log(text, \"text\", this._name);\r\n\r\n    let tw = ui_base.measureText(this, text, this.dom, this.g).width;\r\n    let cx = this.dom.width/2 - tw/2;\r\n    let cy = this.dom.height/2;\r\n\r\n    ui_base.drawText(this, box, cy + ts/2, text, {\r\n      canvas: this.dom, g: this.g\r\n    });\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(Check1);\r\n\r\nexport {checkForTextBox} from './ui_textbox.js';\r\n","export function saveFile(data, filename=\"unnamed\", exts=[], mime=\"application/x-octet-stream\") {\r\n  let blob = new Blob([data], {type : mime});\r\n  let url = URL.createObjectURL(blob);\r\n\r\n  let a = document.createElement(\"a\");\r\n  a.setAttribute(\"href\", url);\r\n  a.setAttribute(\"download\", filename);\r\n\r\n  a.click();\r\n}\r\n\r\n//returns a promise\r\nexport function loadFile(filename=\"unnamed\", exts=[]) {\r\n  let input = document.createElement(\"input\");\r\n  input.type = \"file\";\r\n\r\n  exts = exts.join(\",\");\r\n\r\n  input.setAttribute(\"accept\", exts)\r\n  return new Promise((accept, reject) => {\r\n    input.onchange = function(e) {\r\n      if (this.files === undefined || this.files.length !== 1) {\r\n        reject(\"file load error\");\r\n        return;\r\n      }\r\n\r\n      let file = this.files[0];\r\n      let reader = new FileReader();\r\n\r\n      reader.onload = function(e2) {\r\n        accept(e2.target.result);\r\n      };\r\n\r\n      reader.readAsArrayBuffer(file);\r\n    }\r\n    input.click();\r\n  });\r\n}\r\n\r\nwindow._testLoadFile = function(exts=[\"*.*\"]) {\r\n  loadFile(undefined, exts).then((data) => {\r\n    console.log(\"got file data:\", data);\r\n  });\r\n};\r\n\r\nwindow._testSaveFile = function() {\r\n  let buf = _appstate.createFile();\r\n  //console.log(buf);\r\n  saveFile(buf, \"unnamed.w3d\", [\".w3d\"]);\r\n}","import {Vector2} from \"./vectormath.js\";\r\nimport * as math from './math.js';\r\nimport * as util from './util.js';\r\n\r\nexport class Constraint {\r\n  constructor(name, func, klst, params, k = 1.0) {\r\n    this.glst = [];\r\n    this.klst = klst;\r\n    this.wlst = [];\r\n    this.k = k;\r\n    this.params = params;\r\n    this.name = name;\r\n\r\n    for (let ks of klst) {\r\n      this.glst.push(new Float64Array(ks.length));\r\n      const ws = new Float64Array(ks.length);\r\n\r\n      for (let i = 0; i < ws.length; i++) {\r\n        ws[i] = 1.0;\r\n      }\r\n\r\n      this.wlst.push(ws);\r\n    }\r\n\r\n    this.df = 0.0005;\r\n    this.threshold = 0.0001;\r\n    if (func !== undefined) { /* Happens with subclass-style constraints. */\r\n      this.func = func;\r\n    }\r\n    if (!this.funcDv) {\r\n      this.funcDv = null;\r\n    }\r\n  }\r\n\r\n  postSolve() {\r\n  }\r\n\r\n  evaluate(no_dvs = false) {\r\n    let r1 = this.func(this.params);\r\n\r\n    if (this.funcDv) {\r\n      this.funcDv(this.params, this.glst);\r\n      return r1;\r\n    }\r\n\r\n    if (Math.abs(r1) < this.threshold)\r\n      return 0.0;\r\n\r\n    let df = this.df;\r\n\r\n    if (no_dvs)\r\n      return r1;\r\n\r\n    for (let i = 0; i < this.klst.length; i++) {\r\n      let gs = this.glst[i];\r\n      let ks = this.klst[i];\r\n\r\n      for (let j = 0; j < ks.length; j++) {\r\n        let orig = ks[j];\r\n        ks[j] += df;\r\n        let r2 = this.func(this.params);\r\n        ks[j] = orig;\r\n\r\n        gs[j] = (r2 - r1)/df;\r\n      }\r\n    }\r\n\r\n    return r1;\r\n  }\r\n}\r\n\r\nexport class Solver {\r\n  constructor() {\r\n    this.constraints = [];\r\n    this.gk = 0.99;\r\n    this.simple = false;\r\n    this.randCons = false;\r\n\r\n    /** stop when average constraint error falls below this */\r\n    this.threshold = 0.01;\r\n  }\r\n\r\n  remove(con) {\r\n    this.constraints.remove(con);\r\n  }\r\n\r\n  add(con) {\r\n    this.constraints.push(con);\r\n  }\r\n\r\n  solveStep(gk = this.gk) {\r\n    let err = 0.0;\r\n\r\n    let cons = this.constraints;\r\n    for (let ci = 0; ci < cons.length; ci++) {\r\n      let ri = ci;\r\n      if (this.randCons) {\r\n        ri = ~~(Math.random()*this.constraints.length*0.99999);\r\n      }\r\n\r\n      let con = cons[ri];\r\n\r\n      let r1 = con.evaluate();\r\n\r\n      if (r1 === 0.0)\r\n        continue;\r\n\r\n      err += Math.abs(r1);\r\n      let totgs = 0.0;\r\n\r\n      for (let i = 0; i < con.klst.length; i++) {\r\n        let ks = con.klst[i], gs = con.glst[i];\r\n        for (let j = 0; j < ks.length; j++) {\r\n          totgs += gs[j]*gs[j];\r\n        }\r\n      }\r\n\r\n      if (totgs === 0.0) {\r\n        continue;\r\n      }\r\n\r\n      r1 /= totgs;\r\n\r\n      for (let i = 0; i < con.klst.length; i++) {\r\n        let ks = con.klst[i], gs = con.glst[i], ws = con.wlst[i];\r\n        for (let j = 0; j < ks.length; j++) {\r\n          ks[j] += -r1*gs[j]*con.k*gk*ws[j];\r\n        }\r\n\r\n        con.postSolve();\r\n      }\r\n    }\r\n\r\n    return err;\r\n  }\r\n\r\n  solveStepSimple(gk = this.gk) {\r\n    let err = 0.0;\r\n\r\n    let cons = this.constraints;\r\n    for (let ci = 0; ci < cons.length; ci++) {\r\n      let ri = ci;\r\n      if (this.randCons) {\r\n        ri = ~~(Math.random()*this.constraints.length*0.99999);\r\n      }\r\n\r\n      let con = cons[ri];\r\n\r\n      let r1 = con.evaluate();\r\n\r\n      if (r1 === 0.0)\r\n        continue;\r\n\r\n      err += Math.abs(r1);\r\n      let totgs = 0.0;\r\n\r\n      for (let i = 0; i < con.klst.length; i++) {\r\n        let ks = con.klst[i], gs = con.glst[i];\r\n        for (let j = 0; j < ks.length; j++) {\r\n          totgs += gs[j]*gs[j];\r\n        }\r\n      }\r\n\r\n      if (totgs === 0.0) {\r\n        continue;\r\n      }\r\n\r\n      totgs = 0.0001/Math.sqrt(totgs);\r\n\r\n      for (let i = 0; i < con.klst.length; i++) {\r\n        let ks = con.klst[i], gs = con.glst[i], ws = con.wlst[j];\r\n        for (let j = 0; j < ks.length; j++) {\r\n          ks[j] += -totgs*gs[j]*con.k*gk*ws[j];\r\n        }\r\n      }\r\n\r\n      con.postSolve();\r\n    }\r\n\r\n    return err;\r\n  }\r\n\r\n  solve(steps, gk = this.gk, printError = false) {\r\n    let err = 0.0;\r\n\r\n    for (let i = 0; i < steps; i++) {\r\n      if (this.simple) {\r\n        err = this.solveStepSimple(gk);\r\n      } else {\r\n        err = this.solveStep(gk);\r\n      }\r\n\r\n\r\n      if (printError) {\r\n        console.warn(\"average error:\", (err/this.constraints.length).toFixed(4));\r\n      }\r\n      if (err < this.threshold/this.constraints.length) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return err;\r\n  }\r\n}\r\n","\"use strict\";\r\n\r\nimport {Vector2} from \"./vectormath.js\";\r\nimport * as math from './math.js';\r\nimport * as util from './util.js';\r\n\r\nimport {Constraint, Solver} from './solver.js';\r\n\r\nlet idgen = 0;\r\n\r\nexport class PackNodeVertex extends Vector2 {\r\n  constructor(node, co) {\r\n    super(co);\r\n\r\n    this.node = node;\r\n    this._id = idgen++;\r\n    this.edges = [];\r\n    this._absPos = new Vector2();\r\n  }\r\n\r\n  get absPos() {\r\n    this._absPos.load(this).add(this.node.pos);\r\n    return this._absPos;\r\n  }\r\n\r\n  [Symbol.keystr]() {\r\n    return this._id;\r\n  }\r\n}\r\n\r\nexport class PackNode {\r\n  constructor() {\r\n    this.pos = new Vector2();\r\n    this.vel = new Vector2();\r\n    this.oldpos = new Vector2();\r\n    this._id = idgen++;\r\n    this.size = new Vector2();\r\n    this.verts = [];\r\n  }\r\n\r\n  [Symbol.keystr]() {\r\n    return this._id;\r\n  }\r\n}\r\n\r\nfunction copyGraph(nodes) {\r\n  let ret = [];\r\n  let idmap = {};\r\n\r\n  for (let n of nodes) {\r\n    let n2 = new PackNode();\r\n    n2._id = n._id;\r\n    n2.pos.load(n.pos);\r\n    n2.vel.load(n.vel);\r\n    n2.size.load(n.size);\r\n\r\n    n2.verts = [];\r\n    idmap[n2._id] = n2;\r\n\r\n    for (let v of n.verts) {\r\n      let v2 = new PackNodeVertex(n2, v);\r\n      v2._id = v._id;\r\n      idmap[v2._id] = v2;\r\n\r\n      n2.verts.push(v2);\r\n    }\r\n\r\n    ret.push(n2);\r\n  }\r\n\r\n  for (let n of nodes) {\r\n    for (let v of n.verts) {\r\n      let v2 = idmap[v._id];\r\n\r\n      for (let v3 of v.edges) {\r\n        v2.edges.push(idmap[v3._id]);\r\n      }\r\n    }\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nfunction getCenter(nodes) {\r\n  let cent = new Vector2();\r\n\r\n  for (let n of nodes) {\r\n    cent.add(n.pos);\r\n  }\r\n\r\n  if (nodes.length === 0)\r\n    return cent;\r\n\r\n  cent.mulScalar(1.0 / nodes.length);\r\n\r\n  return cent;\r\n}\r\n\r\nfunction loadGraph(nodes, copy) {\r\n  let idmap = {};\r\n\r\n  for (let i=0; i<nodes.length; i++) {\r\n    nodes[i].pos.load(copy[i].pos);\r\n    nodes[i].oldpos.load(copy[i].oldpos);\r\n    nodes[i].vel.load(copy[i].vel);\r\n  }\r\n}\r\n\r\nexport function graphGetIslands(nodes) {\r\n  let islands = [];\r\n  let visit1 = new util.set();\r\n\r\n  let rec = (n, island) => {\r\n    island.push(n);\r\n    visit1.add(n);\r\n\r\n    for (let v of n.verts) {\r\n      for (let e of v.edges) {\r\n        let n2 = e.node;\r\n        if (n2 !== n && !visit1.has(n2)) {\r\n          rec(n2, island);\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  for (let n of nodes) {\r\n    if (visit1.has(n)) {\r\n      continue;\r\n    }\r\n\r\n    let island = [];\r\n    islands.push(island);\r\n    rec(n, island);\r\n  }\r\n\r\n  return islands;\r\n}\r\n\r\nexport function graphPack(nodes, margin_or_args=15, steps=10, updateCb=undefined) {\r\n  let margin = margin_or_args;\r\n  let speed = 1.0;\r\n\r\n  if (typeof margin === \"object\") {\r\n    let args = margin;\r\n\r\n    margin = args.margin ?? 15;\r\n    steps = args.steps ?? 10;\r\n    updateCb = args.updateCb;\r\n    speed = args.speed ?? 1.0;\r\n  }\r\n\r\n  let orignodes = nodes;\r\n  nodes = copyGraph(nodes);\r\n\r\n  let decay = 1.0;\r\n  let decayi = 0;\r\n\r\n\r\n  let min = new Vector2().addScalar(1e17);\r\n  let max = new Vector2().addScalar(-1e17);\r\n\r\n  let tmp = new Vector2();\r\n  for (let n of nodes) {\r\n    min.min(n.pos);\r\n    tmp.load(n.pos).add(n.size);\r\n    max.max(tmp);\r\n  }\r\n\r\n  let size = new Vector2(max).sub(min);\r\n\r\n  for (let n of nodes) {\r\n    n.pos[0] += (Math.random()-0.5)*5.0/size[0]*speed;\r\n    n.pos[1] += (Math.random()-0.5)*5.0/size[1]*speed;\r\n  }\r\n\r\n  let nodemap = {};\r\n  for (let n of nodes) {\r\n    n.vel.zero();\r\n    nodemap[n._id] = n;\r\n    for (let v of n.verts) {\r\n      nodemap[v._id] = v;\r\n    }\r\n  }\r\n\r\n  let visit = new util.set();\r\n  let verts = new util.set();\r\n  let isect = [];\r\n\r\n  let disableEdges = false;\r\n\r\n  function edge_c(params) {\r\n    let [v1, v2, restlen] = params;\r\n\r\n    if (disableEdges) return 0;\r\n\r\n    return Math.abs(v1.absPos.vectorDistance(v2.absPos) - restlen);\r\n  }\r\n\r\n  let p1 = new Vector2();\r\n  let p2 = new Vector2();\r\n  let s1 = new Vector2();\r\n  let s2 = new Vector2();\r\n\r\n  function loadBoxes(n1, n2, margin1=margin) {\r\n    p1.load(n1.pos);\r\n    p2.load(n2.pos);\r\n    s1.load(n1.size);\r\n    s2.load(n2.size);\r\n\r\n    p1.subScalar(margin1);\r\n    p2.subScalar(margin1);\r\n    s1.addScalar(margin1*2.0);\r\n    s2.addScalar(margin1*2.0);\r\n  }\r\n\r\n  let disableArea = false;\r\n\r\n  function area_c(params) {\r\n    let [n1, n2] = params;\r\n\r\n    if (disableArea)\r\n      return 0.0;\r\n\r\n    loadBoxes(n1, n2);\r\n\r\n    let a1 = n1.size[0]*n1.size[1];\r\n    let a2 = n2.size[0]*n2.size[1];\r\n\r\n    return math.aabb_overlap_area(p1, s1, p2, s2);\r\n    return (math.aabb_overlap_area(p1, s1, p2, s2) / (a1+a2));\r\n  }\r\n\r\n  let lasterr, besterr, best;\r\n  let err;\r\n\r\n  let islands = graphGetIslands(nodes);\r\n  let fakeVerts = [];\r\n  for (let island of islands) {\r\n    let n = island[0];\r\n    let fv = new PackNodeVertex(n);\r\n    fakeVerts.push(fv);\r\n  }\r\n\r\n  let solveStep1 = (gk=1.0) => {\r\n    let solver = new Solver();\r\n\r\n    isect.length = 0;\r\n    visit = new util.set();\r\n\r\n    if (fakeVerts.length > 1) {\r\n      for (let i=1; i<fakeVerts.length; i++) {\r\n        let v1 = fakeVerts[0];\r\n        let v2 = fakeVerts[i];\r\n\r\n        let rlen = 1.0;\r\n\r\n        let con = new Constraint(\"edge_c\", edge_c, [v1.node.pos, v2.node.pos], [v1, v2, rlen]);\r\n        con.k = 0.25;\r\n        solver.add(con);\r\n      }\r\n    }\r\n\r\n    for (let n1 of nodes) {\r\n      for (let v of n1.verts) {\r\n        verts.add(v);\r\n        for (let v2 of v.edges) {\r\n          //hueristic to avoid adding same constraint twice\r\n          if (v2._id < v._id) continue;\r\n\r\n          let rlen = n1.size.vectorLength()*0.0;\r\n\r\n          let con = new Constraint(\"edge_c\", edge_c, [v.node.pos, v2.node.pos], [v, v2, rlen]);\r\n          con.k = 1.0;\r\n          solver.add(con);\r\n        }\r\n      }\r\n\r\n      for (let n2 of nodes) {\r\n        if (n1 === n2) continue;\r\n        let key = Math.min(n1._id, n2._id) + \":\" + Math.max(n1._id, n2._id);\r\n        if (visit.has(key)) continue;\r\n\r\n        loadBoxes(n1, n2);\r\n        let area = math.aabb_overlap_area(p1, s1, p2, s2);\r\n\r\n        if (area > 0.01) {\r\n          let size = decay*(n1.size.vectorLength() + n2.size.vectorLength())*speed;\r\n          //*\r\n          n1.pos[0] += (Math.random() - 0.5)*size;\r\n          n1.pos[1] += (Math.random() - 0.5)*size;\r\n          n2.pos[0] += (Math.random() - 0.5)*size;\r\n          n2.pos[1] += (Math.random() - 0.5)*size;\r\n          //*/\r\n\r\n          isect.push([n1, n2]);\r\n          visit.add(key);\r\n        }\r\n      }\r\n\r\n      for (let [n1, n2] of isect) {\r\n        let con = new Constraint(\"area_c\", area_c, [n1.pos, n2.pos], [n1, n2]);\r\n        solver.add(con);\r\n        con.k = 1.0;\r\n      }\r\n    }\r\n\r\n    return solver;\r\n  };\r\n\r\n  let i = 1;\r\n  let solveStep = (gk=0.5) => {\r\n    let solver = solveStep1();\r\n\r\n    if (i % 40 === 0.0) {\r\n      let c1 = getCenter(nodes);\r\n\r\n      let rfac = 1000.0;\r\n\r\n      if (best) loadGraph(nodes, best);\r\n\r\n      for (let n of nodes) {\r\n        n.pos[0] += (Math.random() - 0.5) * rfac * speed;\r\n        n.pos[1] += (Math.random() - 0.5) * rfac * speed;\r\n        n.vel.zero();\r\n      }\r\n\r\n      let c2 = getCenter(nodes);\r\n      c1.sub(c2);\r\n\r\n      for (let n of nodes) {\r\n        n.pos.add(c1);\r\n      }\r\n    }\r\n\r\n    let err = 1e17;\r\n\r\n    for (let n of nodes) {\r\n      n.oldpos.load(n.pos);\r\n      n.pos.addFac(n.vel, 0.5);\r\n    }\r\n\r\n    disableEdges = false;\r\n    disableArea = true;\r\n    solver.solve(1, gk);\r\n\r\n    //solve so boxes don't overlap\r\n    disableEdges = true;\r\n    disableArea = false;\r\n\r\n    for (let j=0; j<10; j++) {\r\n      solver = solveStep1();\r\n      err = solver.solve(10, gk*speed);\r\n    }\r\n\r\n    for (let n of nodes) {\r\n      n.vel.load(n.pos).sub(n.oldpos);\r\n    }\r\n\r\n    //get error from edge constraints\r\n\r\n    disableEdges = false;\r\n    disableArea = true;\r\n\r\n    err = 0.0;\r\n    for (let con of solver.constraints) {\r\n      err += con.evaluate(true);\r\n    }\r\n\r\n    disableEdges = false;\r\n    disableArea = false;\r\n\r\n    /*\r\n    loadGraph(orignodes, nodes);\r\n    if (updateCb) {\r\n      updateCb();\r\n    }//*/\r\n\r\n    lasterr = err;\r\n\r\n    let add = Math.random()*besterr*Math.exp(-i*0.1);\r\n\r\n    if (besterr === undefined || err < besterr+add) {\r\n      best = copyGraph(nodes);\r\n      besterr = err;\r\n    }\r\n\r\n    i++;\r\n\r\n    return err;\r\n  };\r\n\r\n\r\n  for (let j=0; j<steps; j++) {\r\n    solveStep();\r\n\r\n    decayi++;\r\n    decay = Math.exp(-decayi*0.1);\r\n  }\r\n\r\n  min.zero().addScalar(1e17);\r\n  max.zero().addScalar(-1e17);\r\n\r\n  for (let node of (best ? best : nodes)) {\r\n    min.min(node.pos);\r\n    p2.load(node.pos).add(node.size);\r\n    max.max(p2);\r\n  }\r\n\r\n  for (let node of (best ? best : nodes)) {\r\n    node.pos.sub(min);\r\n  }\r\n\r\n  loadGraph(orignodes, best ? best : nodes);\r\n\r\n  if (updateCb) {\r\n    if (nodes._timer !== undefined) {\r\n      window.clearInterval(nodes._timer);\r\n    }\r\n\r\n    nodes._timer = window.setInterval(() => {\r\n      let time = util.time_ms();\r\n\r\n      while (util.time_ms() - time < 50) {\r\n        let err = solveStep();\r\n      }\r\n\r\n      if (cconst.DEBUG.boxPacker) {\r\n        console.log(\"err\", (besterr / nodes.length).toFixed(2), (lasterr / nodes.length).toFixed(2), \"isects\", isect.length);\r\n      }\r\n\r\n      if (best) loadGraph(orignodes, best);\r\n\r\n      if (updateCb() === false) {\r\n        clearInterval(nodes._timer);\r\n        return;\r\n      }\r\n    }, 100);\r\n\r\n    let timer = nodes._timer;\r\n\r\n    return {\r\n      stop : () => {\r\n        if (best) loadGraph(nodes, best);\r\n\r\n        window.clearInterval(timer);\r\n        nodes._timer = undefined;\r\n      }\r\n    }\r\n  }\r\n}\r\n","\"use strict\";\r\n\r\nimport * as util from \"../path-controller/util/util.js\";\r\nimport cconst from \"../config/const.js\";\r\nimport * as ui_base from \"../core/ui_base.js\";\r\nimport * as toolprop from \"../path-controller/toolsys/toolprop.js\";\r\nimport { OldButton } from \"./ui_button.js\";\r\nimport { DomEventTypes } from \"../path-controller/util/events.js\";\r\n\r\nimport { HotKey, keymap } from \"../path-controller/util/simple_events.js\";\r\nimport { parseToolPath } from \"../path-controller/controller.js\";\r\n\r\nlet EnumProperty = toolprop.EnumProperty,\r\n  PropTypes = toolprop.PropTypes;\r\n\r\nlet UIBase = ui_base.UIBase,\r\n  PackFlags = ui_base.PackFlags,\r\n  IconSheets = ui_base.IconSheets;\r\n\r\nfunction getpx(css) {\r\n  return parseFloat(css.trim().replace(\"px\", \"\"));\r\n}\r\n\r\nfunction debugmenu() {\r\n  if (window.DEBUG && window.DEBUG.menu) {\r\n    console.warn(\"%cmenu:\", \"color:blue\", ...arguments);\r\n  }\r\n}\r\n\r\nexport class Menu extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.parentMenu = undefined;\r\n\r\n    this._was_clicked = false;\r\n\r\n    this.items = [];\r\n    this.autoSearchMode = true;\r\n\r\n    this._ignoreFocusEvents = false;\r\n    this.closeOnMouseUp = true;\r\n\r\n    this._submenu = undefined;\r\n\r\n    this.ignoreFirstClick = false;\r\n\r\n    this.itemindex = 0;\r\n    this.closed = false;\r\n    this.started = false;\r\n    this.activeItem = undefined;\r\n\r\n    this.overrideDefault(\"DefaultText\", this.getDefault(\"MenuText\"));\r\n\r\n    //we have to make a container for any submenus to\r\n    this.container = document.createElement(\"span\");\r\n    this.container.style[\"display\"] = \"flex\";\r\n    this.container.style[\"color\"] = this.getDefault(\"MenuText\").color;\r\n\r\n    //this.container.style[\"background-color\"] = \"red\";\r\n    this.container.setAttribute(\"class\", \"menucon\");\r\n\r\n    this.dom = document.createElement(\"ul\");\r\n    this.dom.setAttribute(\"class\", \"menu\");\r\n    /*\r\n              place-items: start start;\r\n              flex-wrap : nowrap;\r\n              align-content : start;\r\n              place-content : start;\r\n              justify-content : start;\r\n\r\n              align-items : start;\r\n              place-items : start;\r\n              justify-items : start;\r\n    */\r\n\r\n    let style = (this.menustyle = document.createElement(\"style\"));\r\n    this.buildStyle();\r\n\r\n    this.dom.setAttribute(\"tabindex\", -1);\r\n\r\n    //the menu wrangler handles key events\r\n\r\n    this.shadow.appendChild(style);\r\n    this.shadow.appendChild(this.container);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"menu-x\",\r\n      style  : \"menu\",\r\n    };\r\n  }\r\n\r\n  float(x, y, zindex = undefined) {\r\n    let dpi = this.getDPI();\r\n    let rect = this.dom.getClientRects();\r\n    let maxx = this.getWinWidth() - 10;\r\n    let maxy = this.getWinHeight() - 10;\r\n\r\n    if (rect.length > 0) {\r\n      rect = rect[0];\r\n      if (y + rect.height > maxy) {\r\n        y = maxy - rect.height - 1;\r\n      }\r\n\r\n      if (x + rect.width > maxx) {\r\n        x = maxx - rect.width - 1;\r\n      }\r\n    }\r\n\r\n    super.float(x, y, 50);\r\n  }\r\n\r\n  click() {\r\n    if (this._was_clicked) {\r\n      return;\r\n    }\r\n\r\n    if (this.ignoreFirstClick) {\r\n      this.ignoreFirstClick = Math.max(this.ignoreFirstClick - 1, 0);\r\n      return;\r\n    }\r\n\r\n    if (!this.activeItem || this.activeItem._isMenu) {\r\n      return;\r\n    }\r\n\r\n    this._was_clicked = true;\r\n\r\n    if (this.onselect) {\r\n      try {\r\n        this.onselect(this.activeItem._id);\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        console.log(\"Error in menu callback\");\r\n      }\r\n    }\r\n\r\n    this.close();\r\n  }\r\n\r\n  _ondestroy() {\r\n    if (this.started) {\r\n      menuWrangler.popMenu(this);\r\n\r\n      if (this.onclose) {\r\n        this.onclose();\r\n      }\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this.setCSS();\r\n  }\r\n\r\n  close() {\r\n    if (this.closed) {\r\n      return;\r\n    }\r\n\r\n    this.closed = true;\r\n\r\n    if (this.started) {\r\n      menuWrangler.popMenu(this);\r\n    }\r\n\r\n    this.started = false;\r\n\r\n    if (this._popup) {\r\n      this._popup.end();\r\n      this._popup = undefined;\r\n    }\r\n\r\n    this.remove();\r\n    this.dom.remove();\r\n\r\n    if (this.onclose) {\r\n      this.onclose(this);\r\n    }\r\n  }\r\n\r\n  _select(dir, focus = true) {\r\n    if (this.activeItem === undefined) {\r\n      for (let item of this.items) {\r\n        if (!item.hidden) {\r\n          this.setActive(item, focus);\r\n          break;\r\n        }\r\n      }\r\n    } else {\r\n      let i = this.items.indexOf(this.activeItem);\r\n      let item = this.activeItem;\r\n\r\n      do {\r\n        i = (i + dir + this.items.length) % this.items.length;\r\n        item = this.items[i];\r\n\r\n        if (!item.hidden) {\r\n          break;\r\n        }\r\n      } while (item !== this.activeItem);\r\n\r\n      this.setActive(item, focus);\r\n    }\r\n\r\n    if (this.hasSearchBox) {\r\n      this.activeItem.scrollIntoView();\r\n    }\r\n  }\r\n\r\n  selectPrev(focus = true) {\r\n    return this._select(-1, focus);\r\n  }\r\n\r\n  selectNext(focus = true) {\r\n    return this._select(1, focus);\r\n  }\r\n\r\n  start_fancy(prepend, setActive = true) {\r\n    return this.startFancy(prepend, setActive);\r\n  }\r\n\r\n  setActive(item, focus = true) {\r\n    if (this.activeItem === item) {\r\n      return;\r\n    }\r\n\r\n    if (this.activeItem) {\r\n      this.activeItem.style[\"background-color\"] = this.getDefault(\"MenuBG\");\r\n\r\n      if (focus) {\r\n        this.activeItem.blur();\r\n      }\r\n    }\r\n\r\n    if (item) {\r\n      item.style[\"background-color\"] = this.getDefault(\"MenuHighlight\");\r\n\r\n      if (focus) {\r\n        item.focus();\r\n      }\r\n    }\r\n\r\n    this.activeItem = item;\r\n  }\r\n\r\n  startFancy(prepend, setActive = true) {\r\n    this.hasSearchBox = true;\r\n    this.started = true;\r\n    menuWrangler.pushMenu(this);\r\n\r\n    let dom2 = document.createElement(\"div\");\r\n    //let dom2 = document.createElement(\"div\");\r\n\r\n    this.dom.setAttribute(\"class\", \"menu\");\r\n    dom2.setAttribute(\"class\", \"menu\");\r\n\r\n    let sbox = (this.textbox = UIBase.createElement(\"textbox-x\"));\r\n    this.textbox.parentWidget = this;\r\n\r\n    dom2.appendChild(sbox);\r\n    dom2.appendChild(this.dom);\r\n\r\n    dom2.style[\"height\"] = \"300px\";\r\n    this.dom.style[\"height\"] = \"300px\";\r\n    this.dom.style[\"overflow\"] = \"scroll\";\r\n\r\n    if (prepend) {\r\n      this.container.prepend(dom2);\r\n    } else {\r\n      this.container.appendChild(dom2);\r\n    }\r\n\r\n    dom2.parentWidget = this.container;\r\n\r\n    sbox.focus();\r\n    sbox.onchange = () => {\r\n      let t = sbox.text.trim().toLowerCase();\r\n\r\n      for (let item of this.items) {\r\n        item.hidden = true;\r\n        item.remove();\r\n      }\r\n\r\n      for (let item of this.items) {\r\n        let ok = t == \"\";\r\n        ok = ok || item.innerHTML.toLowerCase().search(t) >= 0;\r\n\r\n        if (ok) {\r\n          item.hidden = false;\r\n          this.dom.appendChild(item);\r\n        } else if (item === this.activeItem) {\r\n          this.selectNext(false);\r\n        }\r\n        //item.hidden = !ok;\r\n      }\r\n    };\r\n\r\n    sbox.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case 27: //escape key\r\n          this.close();\r\n          break;\r\n        case 13: //enter key\r\n          this.click(this.activeItem);\r\n          this.close();\r\n          break;\r\n      }\r\n    });\r\n  }\r\n\r\n  start(prepend = false, setActive = true) {\r\n    this.closed = false;\r\n\r\n    this.started = true;\r\n    this.focus();\r\n\r\n    menuWrangler.pushMenu(this);\r\n\r\n    let dokey = (key) => {\r\n      let val = this.getDefault(key);\r\n      if (typeof val === \"number\") {\r\n        val = \"\" + val + \"px\";\r\n      }\r\n\r\n      if (val !== undefined) {\r\n        this.dom.style[key] = val;\r\n      }\r\n    };\r\n\r\n    dokey(\"padding\");\r\n    dokey(\"padding-top\");\r\n    dokey(\"padding-left\");\r\n    dokey(\"padding-right\");\r\n    dokey(\"padding-bottom\");\r\n\r\n    if (this.items.length > 15 && this.autoSearchMode) {\r\n      return this.start_fancy(prepend, setActive);\r\n    }\r\n\r\n    if (prepend) {\r\n      this.container.prepend(this.dom);\r\n    } else {\r\n      this.container.appendChild(this.dom);\r\n    }\r\n\r\n    if (!setActive) return;\r\n\r\n    this.setCSS();\r\n    this.flushUpdate();\r\n\r\n    window.setTimeout(() => {\r\n      this.flushUpdate();\r\n\r\n      //select first child\r\n      //TODO: cache last child entry\r\n\r\n      if (this.activeItem === undefined) {\r\n        this.activeItem = this.dom.childNodes[0];\r\n      }\r\n\r\n      if (this.activeItem === undefined) {\r\n        return;\r\n      }\r\n\r\n      this.activeItem.focus();\r\n    }, 0);\r\n  }\r\n\r\n  addItemExtra(text, id = undefined, hotkey, icon = -1, add = true, tooltip = undefined) {\r\n    let dom = document.createElement(\"span\");\r\n\r\n    dom.style[\"display\"] = \"inline-flex\";\r\n\r\n    dom.hotkey = hotkey;\r\n    dom.icon = icon;\r\n\r\n    let icon_div;\r\n\r\n    if (1) {\r\n      //icon >= 0) {\r\n      icon_div = ui_base.makeIconDiv(icon, IconSheets.SMALL);\r\n    } else {\r\n      let tilesize = ui_base.iconmanager.getTileSize(IconSheets.SMALL);\r\n\r\n      //tilesize *= window.devicePixelRatio;\r\n\r\n      icon_div = document.createElement(\"span\");\r\n      icon_div.style[\"padding\"] = icon_div.style[\"margin\"] = \"0px\";\r\n      icon_div.style[\"width\"] = tilesize + \"px\";\r\n      icon_div.style[\"height\"] = tilesize + \"px\";\r\n    }\r\n\r\n    icon_div.style[\"display\"] = \"inline-flex\";\r\n    icon_div.style[\"margin-right\"] = \"1px\";\r\n    icon_div.style[\"align\"] = \"left\";\r\n\r\n    let span = document.createElement(\"span\");\r\n\r\n    //stupid css doesn't get width right. . .\r\n    span.style[\"font\"] = ui_base.getFont(this, undefined, \"MenuText\");\r\n\r\n    let dpi = this.getDPI();\r\n    let tsize = this.getDefault(\"MenuText\").size;\r\n    //XXX proportional font fail\r\n\r\n    //XXX stupid!\r\n    let canvas = document.createElement(\"canvas\");\r\n    let g = canvas.getContext(\"2d\");\r\n\r\n    g.font = span.style[\"font\"];\r\n\r\n    let rect = span.getClientRects();\r\n\r\n    let twid = Math.ceil(g.measureText(text).width);\r\n    let hwid;\r\n    if (hotkey) {\r\n      dom.hotkey = hotkey;\r\n      g.font = ui_base.getFont(this, undefined, \"HotkeyText\");\r\n      hwid = Math.ceil(g.measureText(hotkey).width / UIBase.getDPI());\r\n      twid += hwid + 8;\r\n    }\r\n\r\n    //let twid = Math.ceil(text.trim().length * tsize / dpi);\r\n\r\n    span.innerText = text;\r\n\r\n    span.style[\"word-wrap\"] = \"none\";\r\n    span.style[\"white-space\"] = \"pre\";\r\n    span.style[\"overflow\"] = \"hidden\";\r\n    span.style[\"text-overflow\"] = \"clip\";\r\n\r\n    span.style[\"width\"] = ~~twid + \"px\";\r\n    span.style[\"padding\"] = \"0px\";\r\n    span.style[\"margin\"] = \"0px\";\r\n\r\n    dom.style[\"width\"] = \"100%\";\r\n\r\n    dom.appendChild(icon_div);\r\n    dom.appendChild(span);\r\n\r\n    if (hotkey) {\r\n      let hotkey_span = document.createElement(\"span\");\r\n      hotkey_span.innerText = hotkey;\r\n      hotkey_span.style[\"display\"] = \"inline-flex\";\r\n\r\n      hotkey_span.style[\"margin\"] = \"0px\";\r\n      hotkey_span.style[\"margin-left\"] = \"auto\";\r\n      hotkey_span.style[\"margin-right\"] = \"0px\";\r\n      hotkey_span.style[\"padding\"] = \"0px\";\r\n\r\n      hotkey_span.style[\"font\"] = ui_base.getFont(this, undefined, \"HotkeyText\");\r\n      hotkey_span.style[\"color\"] = this.getDefault(\"HotkeyTextColor\");\r\n\r\n      //hotkey_span.style[\"width\"] = ~~((hwid + 7)) + \"px\";\r\n      hotkey_span.style[\"width\"] = \"max-content\";\r\n\r\n      //hotkey_span.style[\"background-color\"] = \"rgba(0,0,0,0)\";\r\n\r\n      hotkey_span.style[\"text-align\"] = \"right\";\r\n      hotkey_span.style[\"justify-content\"] = \"right\";\r\n      hotkey_span[\"flex-wrap\"] = \"nowrap\";\r\n      hotkey_span[\"text-wrap\"] = \"nowrap\";\r\n\r\n      //hotkey_span.style[\"border\"] = \"1px solid red\";\r\n\r\n      //hotkey_span.style[\"display\"] = \"inline\";\r\n      //hotkey_span.style[\"float\"] = \"right\";\r\n\r\n      dom.appendChild(hotkey_span);\r\n    }\r\n\r\n    let ret = this.addItem(dom, id, add);\r\n\r\n    ret.hotkey = hotkey;\r\n    ret.icon = icon;\r\n    ret.label = text ? text : ret.innerText;\r\n\r\n    if (tooltip) {\r\n      ret.title = tooltip;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  //item can be menu or text\r\n  addItem(item, id, add = true, tooltip = undefined) {\r\n    id = id === undefined ? item : id;\r\n    let text = item;\r\n\r\n    if (typeof item === \"string\" || item instanceof String) {\r\n      let dom = document.createElement(\"dom\");\r\n      dom.style[\"text-align\"] = \"left\";\r\n\r\n      dom.textContent = item;\r\n      item = dom;\r\n      //return this.addItemExtra(item, id);\r\n    } else {\r\n      text = item.textContent;\r\n    }\r\n\r\n    let li = document.createElement(\"li\");\r\n\r\n    li.setAttribute(\"tabindex\", this.itemindex++);\r\n    li.setAttribute(\"class\", \"menuitem\");\r\n\r\n    if (tooltip !== undefined) {\r\n      li.title = tooltip;\r\n    }\r\n\r\n    if (item instanceof Menu) {\r\n      //let dom = this.addItemExtra(\"\"+item.title, id, \"\", -1, false);\r\n      let dom = document.createElement(\"span\");\r\n      dom.innerHTML = \"\" + item.title;\r\n      dom._id = dom.id = id;\r\n      dom.setAttribute(\"class\", \"menu\");\r\n\r\n      //dom = document.createElement(\"div\");\r\n      //dom.innerText = \"\"+item.title;\r\n\r\n      //dom.style[\"display\"] = \"inline-block\";\r\n      li.style[\"width\"] = \"100%\";\r\n      li.appendChild(dom);\r\n\r\n      li._isMenu = true;\r\n      li._menu = item;\r\n      item.parentMenu = this;\r\n\r\n      item.hidden = false;\r\n      item.container = this.container;\r\n    } else {\r\n      li._isMenu = false;\r\n      li.appendChild(item);\r\n    }\r\n\r\n    li._id = id;\r\n\r\n    this.items.push(li);\r\n\r\n    li.label = text ? text : li.innerText.trim();\r\n\r\n    if (add) {\r\n      li.addEventListener(\"blur\", (e) => {\r\n        if (this._ignoreFocusEvents) {\r\n          return;\r\n        }\r\n\r\n        if (this.activeItem && !this.activeItem._isMenu) {\r\n          this.setActive(undefined, false);\r\n        }\r\n      });\r\n\r\n      let onfocus = (e) => {\r\n        if (this._ignoreFocusEvents) {\r\n          return;\r\n        }\r\n\r\n        let active = this.activeItem;\r\n\r\n        if (this._submenu) {\r\n          this._submenu.close();\r\n          this._submenu = undefined;\r\n        }\r\n\r\n        if (li._isMenu) {\r\n          li._menu.onselect = (item) => {\r\n            this.onselect(item);\r\n            li._menu.close();\r\n            this.close();\r\n          };\r\n\r\n          li._menu.start(false, false);\r\n          this._submenu = li._menu;\r\n        }\r\n\r\n        this.setActive(li, false);\r\n      };\r\n\r\n      let onclick = (e) => {\r\n        onfocus(e);\r\n\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n\r\n        if (this.activeItem !== undefined && this.activeItem._isMenu) {\r\n          //ignore\r\n          return;\r\n        }\r\n\r\n        this.click();\r\n      };\r\n\r\n      li.addEventListener(\"contextmenu\", (e) => e.preventDefault());\r\n      this.addEventListener(\"contextmenu\", (e) => e.preventDefault());\r\n\r\n      li.addEventListener(\"pointerup\", onclick, { capture: true });\r\n      li.addEventListener(\"click\", onclick, { capture: true });\r\n      li.addEventListener(\"pointerdown\", onclick, { capture: true });\r\n\r\n      li.addEventListener(\"focus\", (e) => {\r\n        onfocus(e);\r\n        onfocus(e);\r\n      });\r\n\r\n      li.addEventListener(\"pointermove\", (e) => {\r\n        onfocus(e);\r\n        li.focus();\r\n      });\r\n      li.addEventListener(\"mouseover\", (e) => {\r\n        onfocus(e);\r\n        li.focus();\r\n      });\r\n      li.addEventListener(\"mouseenter\", (e) => {\r\n        onfocus(e);\r\n        li.focus();\r\n      });\r\n\r\n      li.addEventListener(\"pointerover\", (e) => {\r\n        onfocus(e);\r\n        li.focus();\r\n      });\r\n\r\n      this.dom.appendChild(li);\r\n    }\r\n\r\n    return li;\r\n  }\r\n\r\n  _getBorderStyle() {\r\n    let r = this.getDefault(\"border-width\");\r\n    let s = this.getDefault(\"border-style\");\r\n    let c = this.getDefault(\"border-color\");\r\n\r\n    return `${r}px ${s} ${c}`;\r\n  }\r\n\r\n  buildStyle() {\r\n    let pad1 = util.isMobile() ? 2 : 0;\r\n    pad1 += this.getDefault(\"MenuSpacing\");\r\n\r\n    let boxShadow = \"\";\r\n    if (this.hasDefault(\"box-shadow\")) {\r\n      boxShadow = \"box-shadow: \" + this.getDefault(\"box-shadow\") + \";\";\r\n    }\r\n\r\n    let sepcss = this.getDefault(\"MenuSeparator\");\r\n    if (typeof sepcss === \"object\") {\r\n      let s = \"\";\r\n\r\n      for (let k in sepcss) {\r\n        let v = sepcss[k];\r\n\r\n        if (typeof v === \"number\") {\r\n          v = v.toFixed(4) + \"px\";\r\n        }\r\n\r\n        s += `    ${k}: ${v};\\n`;\r\n      }\r\n\r\n      sepcss = s;\r\n    }\r\n\r\n    let itemRadius = 0;\r\n\r\n    if (this.hasDefault(\"item-radius\")) {\r\n      itemRadius = this.getDefault(\"item-radius\");\r\n    } else {\r\n      itemRadius = this.getDefault(\"border-radius\");\r\n    }\r\n\r\n    this.menustyle.textContent = `\r\n        .menucon {\r\n          position:fixed;\r\n          float:left;\r\n          \r\n          border-radius : ${this.getDefault(\"border-radius\")}px;\r\n\r\n          display: block;\r\n          -moz-user-focus: normal;\r\n          ${boxShadow}\r\n        }\r\n        \r\n        ul.menu {\r\n          display        : flex;\r\n          flex-direction : column;\r\n          flex-wrap      : nowrap;\r\n          width          : max-content;\r\n          \r\n          margin : 0px;\r\n          padding : 0px;\r\n          border : ${this._getBorderStyle()};\r\n          border-radius : ${this.getDefault(\"border-radius\")}px;\r\n          -moz-user-focus: normal;\r\n          background-color: ${this.getDefault(\"MenuBG\")};\r\n          color : ${this.getDefault(\"MenuText\").color};\r\n        }\r\n        \r\n        .menuitem {\r\n          display : flex;\r\n          flex-wrap : nowrap;\r\n          flex-direction : row;          \r\n          \r\n          list-style-type:none;\r\n          -moz-user-focus: normal;\r\n          \r\n          margin : 0;\r\n          padding : 0px;\r\n          padding-right: 16px;\r\n          padding-left: 16px;\r\n          padding-top : ${pad1}px;\r\n          padding-bottom : ${pad1}px;\r\n          \r\n          border-radius : ${itemRadius}px;\r\n          \r\n          color : ${this.getDefault(\"MenuText\").color};\r\n          font : ${this.getDefault(\"MenuText\").genCSS()};\r\n          background-color: ${this.getDefault(\"MenuBG\")};\r\n        }\r\n        \r\n        .menuseparator {\r\n          ${sepcss}\r\n        }\r\n        \r\n        .menuitem:focus {\r\n          display : flex;\r\n          text-align: left;\r\n          \r\n          border : none;\r\n          outline : none;\r\n          border-radius : ${itemRadius}px;\r\n          \r\n          background-color: ${this.getDefault(\"MenuHighlight\")};\r\n          color : ${this.getDefault(\"MenuText\").color};\r\n          -moz-user-focus: normal;\r\n        }\r\n      `;\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.buildStyle();\r\n\r\n    this.container.style[\"color\"] = this.getDefault(\"MenuText\").color;\r\n    this.style[\"color\"] = this.getDefault(\"MenuText\").color;\r\n  }\r\n\r\n  seperator() {\r\n    let bar = document.createElement(\"div\");\r\n    bar.setAttribute(\"class\", \"menuseparator\");\r\n\r\n    this.dom.appendChild(bar);\r\n\r\n    return this;\r\n  }\r\n\r\n  menu(title) {\r\n    let ret = UIBase.createElement(\"menu-x\");\r\n\r\n    ret.setAttribute(\"name\", title);\r\n    this.addItem(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  calcSize() {}\r\n}\r\n\r\nMenu.SEP = Symbol(\"menu seperator\");\r\nUIBase.internalRegister(Menu);\r\n\r\nexport class DropBox extends OldButton {\r\n  constructor() {\r\n    super();\r\n\r\n    this.lockTimer = 0;\r\n\r\n    this._template = undefined;\r\n\r\n    this._searchMenuMode = false;\r\n    this.altKey = undefined;\r\n\r\n    this._value = 0;\r\n\r\n    this._last_datapath = undefined;\r\n\r\n    this.r = 5;\r\n    this._menu = undefined;\r\n    this._auto_depress = false;\r\n    //this.prop = new ui_base.EnumProperty(undefined, {}, \"\", \"\", 0);\r\n\r\n    this._onpress = this._onpress.bind(this);\r\n  }\r\n\r\n  get searchMenuMode() {\r\n    return this._searchMenuMode;\r\n  }\r\n\r\n  set searchMenuMode(v) {\r\n    this._searchMenuMode = v;\r\n  }\r\n\r\n  get template() {\r\n    return this._template;\r\n  }\r\n\r\n  set template(v) {\r\n    this._template = v;\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(v) {\r\n    this.setValue(v);\r\n  }\r\n\r\n  get menu() {\r\n    return this._menu;\r\n  }\r\n\r\n  set menu(val) {\r\n    this._menu = val;\r\n\r\n    if (val !== undefined) {\r\n      this._name = val.title;\r\n      this.updateName();\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"dropbox-x\",\r\n      style  : \"dropbox\",\r\n    };\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.setAttribute(\"menu-button\", \"true\");\r\n\r\n    this.updateWidth();\r\n  }\r\n\r\n  setCSS() {\r\n    //do not call parent classes's setCSS here\r\n\r\n    this.style[\"user-select\"] = \"none\";\r\n    this.dom.style[\"user-select\"] = \"none\";\r\n\r\n    let keys;\r\n    if (this.getAttribute(\"simple\")) {\r\n      keys = [\"margin-left\", \"margin-right\", \"padding-left\", \"padding-right\"];\r\n    } else {\r\n      keys = [\r\n        \"margin\",\r\n        \"margin-left\",\r\n        \"margin-right\",\r\n        \"margin-top\",\r\n        \"margin-bottom\",\r\n        \"padding\",\r\n        \"padding-left\",\r\n        \"padding-right\",\r\n        \"padding-top\",\r\n        \"padding-bottom\",\r\n      ];\r\n    }\r\n\r\n    let setDefault = (key) => {\r\n      if (this.hasDefault(key)) {\r\n        this.style[key] = this.getDefault(key, undefined, 0) + \"px\";\r\n      }\r\n    };\r\n\r\n    for (let k of keys) {\r\n      setDefault(k);\r\n    }\r\n  }\r\n\r\n  _genLabel() {\r\n    let s = super._genLabel();\r\n    let ret = \"\";\r\n\r\n    if (s.length === 0) {\r\n      s = \"(error)\";\r\n    }\r\n\r\n    this.altKey = s[0].toUpperCase().charCodeAt(0);\r\n\r\n    for (let i = 0; i < s.length; i++) {\r\n      if (s[i] === \"&\" && i < s.length - 1 && s[i + 1] !== \"&\") {\r\n        this.altKey = s[i + 1].toUpperCase().charCodeAt(0);\r\n      } else if (s[i] === \"&\" && i < s.length - 1 && s[i + 1] === \"&\") {\r\n        continue;\r\n      } else {\r\n        ret += s[i];\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  updateWidth() {\r\n    //let ret = super.updateWidth(10);\r\n    let dpi = this.getDPI();\r\n\r\n    let ts = this.getDefault(\"DefaultText\").size;\r\n    let tw = this.g.measureText(this._genLabel()).width / dpi;\r\n    //let tw = ui_base.measureText(this, this._genLabel(), undefined, undefined, ts).width + 8;\r\n    tw = ~~tw;\r\n\r\n    tw += 15;\r\n\r\n    if (!this.getAttribute(\"simple\")) {\r\n      tw += 35;\r\n    }\r\n\r\n    if (tw !== this._last_w) {\r\n      this._last_w = tw;\r\n      this.dom.style[\"width\"] = tw + \"px\";\r\n      this.style[\"width\"] = tw + \"px\";\r\n      this.width = tw;\r\n\r\n      this.overrideDefault(\"width\", tw);\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n\r\n    return 0;\r\n  }\r\n\r\n  updateBorders() {\r\n    //Do not apply border stlying to the child canvas\r\n    super.updateBorders(this);\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.ctx || !this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let wasError = false;\r\n    let prop, val;\r\n\r\n    try {\r\n      this.pushReportContext(this._reportCtxName);\r\n      prop = this.ctx.api.resolvePath(this.ctx, this.getAttribute(\"datapath\")).prop;\r\n      val = this.ctx.api.getValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n      prop = prop && prop.prop ? prop.prop : prop;\r\n\r\n      this.popReportContext();\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n      wasError = true;\r\n    }\r\n\r\n    if (wasError) {\r\n      this.disabled = true;\r\n      this.setCSS();\r\n      this._redraw();\r\n\r\n      return;\r\n    } else {\r\n      this.disabled = false;\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n\r\n    if (!prop) {\r\n      return;\r\n    }\r\n\r\n    if (this.prop === undefined) {\r\n      this.prop = prop;\r\n    }\r\n\r\n    prop = this.prop;\r\n\r\n    let name = this.getAttribute(\"name\");\r\n\r\n    if (prop.type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n      name = prop.ui_value_names[prop.keys[val]];\r\n    } else {\r\n      name = \"\" + val;\r\n    }\r\n\r\n    if (name !== this.getAttribute(\"name\")) {\r\n      this.setAttribute(\"name\", name);\r\n      this.updateName();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    let path = this.getAttribute(\"datapath\");\r\n\r\n    if (path && path !== this._last_datapath) {\r\n      this._last_datapath = path;\r\n      this.prop = undefined;\r\n\r\n      this.updateDataPath();\r\n    }\r\n\r\n    super.update();\r\n\r\n    let key = this.getDefault(\"dropTextBG\");\r\n    if (key !== this._last_dbox_key) {\r\n      this._last_dbox_key = key;\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n  }\r\n\r\n  _build_menu_template() {\r\n    if (this._menu !== undefined && this._menu.parentNode !== undefined) {\r\n      this._menu.remove();\r\n    }\r\n\r\n    //let name = \"\" + this.getAttribute(\"name\");\r\n    let template = this._template;\r\n\r\n    if (typeof template === \"function\") {\r\n      template = template();\r\n    }\r\n\r\n    this._menu = createMenu(this.ctx, \"\", template);\r\n    return this._menu;\r\n  }\r\n\r\n  _build_menu() {\r\n    if (this._template) {\r\n      this._build_menu_template();\r\n      return;\r\n    }\r\n\r\n    let prop = this.prop;\r\n\r\n    if (this.prop === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this._menu !== undefined && this._menu.parentNode !== undefined) {\r\n      this._menu.remove();\r\n    }\r\n\r\n    let menu = (this._menu = UIBase.createElement(\"menu-x\"));\r\n\r\n    //let name = \"\" + this.getAttribute(\"name\");\r\n    menu.setAttribute(\"name\", \"\");\r\n    menu._dropbox = this;\r\n\r\n    let valmap = {};\r\n    let enummap = prop.values;\r\n    let iconmap = prop.iconmap;\r\n    let uimap = prop.ui_value_names;\r\n    let desr = prop.descriptions || {};\r\n\r\n    for (let k in enummap) {\r\n      let uk = k;\r\n\r\n      valmap[enummap[k]] = k;\r\n\r\n      if (uimap !== undefined && k in uimap) {\r\n        uk = uimap[k];\r\n      }\r\n\r\n      let tooltip = desr[k];\r\n\r\n      //menu.addItem(k, enummap[k], \":\");\r\n      if (iconmap && iconmap[k]) {\r\n        menu.addItemExtra(uk, enummap[k], undefined, iconmap[k], undefined, tooltip);\r\n      } else {\r\n        menu.addItem(uk, enummap[k], undefined, tooltip);\r\n      }\r\n    }\r\n\r\n    menu.onselect = (id) => {\r\n      this._pressed = false;\r\n\r\n      this._pressed = false;\r\n      this._redraw();\r\n\r\n      this._menu = undefined;\r\n\r\n      //check if datapath system will be calling .prop.setValue instead of us\r\n      let callProp = true;\r\n      if (this.hasAttribute(\"datapath\")) {\r\n        let rdef = this.ctx.api.resolvePath(this.ctx, this.getAttribute(\"datapath\"));\r\n        let prop = rdef.dpath.data;\r\n\r\n        callProp = !rdef || !rdef.dpath || !(rdef.dpath.data instanceof ToolProperty);\r\n      }\r\n\r\n      this._value = this._convertVal(id);\r\n\r\n      if (callProp) {\r\n        this.prop.setValue(id);\r\n      }\r\n\r\n      this.setAttribute(\"name\", this.prop.ui_value_names[valmap[id]]);\r\n      if (this.onselect) {\r\n        this.onselect(id);\r\n      }\r\n\r\n      if (this.hasAttribute(\"datapath\") && this.ctx) {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), id);\r\n      }\r\n    };\r\n  }\r\n\r\n  _onpress(e) {\r\n    this.abortToolTips(1000);\r\n\r\n    if (this._menu !== undefined) {\r\n      this.lockTimer = util.time_ms();\r\n\r\n      this._pressed = false;\r\n      this._redraw();\r\n\r\n      let menu = this._menu;\r\n      this._menu = undefined;\r\n      menu.close();\r\n      return;\r\n    }\r\n\r\n    if (util.time_ms() - this.lockTimer < 200) {\r\n      return;\r\n    }\r\n\r\n    this._build_menu();\r\n\r\n    if (this._menu === undefined) {\r\n      return;\r\n    }\r\n\r\n    this._menu.autoSearchMode = false;\r\n\r\n    this._menu._dropbox = this;\r\n    this.dom._background = this.getDefault(\"BoxDepressed\");\r\n    this._background = this.getDefault(\"BoxDepressed\");\r\n    this._redraw();\r\n    this._pressed = true;\r\n    this.setCSS();\r\n\r\n    let onclose = this._menu.onclose;\r\n    this._menu.onclose = () => {\r\n      this.lockTimer = util.time_ms();\r\n\r\n      this._pressed = false;\r\n      this._redraw();\r\n\r\n      let menu = this._menu;\r\n      if (menu) {\r\n        this._menu = undefined;\r\n        menu._dropbox = undefined;\r\n      }\r\n\r\n      if (onclose) {\r\n        onclose.call(menu);\r\n      }\r\n    };\r\n\r\n    let menu = this._menu;\r\n    let screen = this.getScreen();\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let x = e.x,\r\n      y = e.y;\r\n    let rects = this.dom.getBoundingClientRect(); //getClientRects();\r\n\r\n    let rheight = rects.height;\r\n    x = rects.x - window.scrollX;\r\n    y = rects.y + rheight - window.scrollY; // + rects[0].height; // visualViewport.scale;\r\n\r\n    if (!window.haveElectron) {\r\n      //y -= 8;\r\n    }\r\n\r\n    /* need to figure out a better way to pop up a menu\r\n     *  above a given y position */\r\n    if (cconst.menusCanPopupAbove && y > screen.size[1] * 0.5 && !this.searchMenuMode) {\r\n      let con = screen.popup(this, 500, 400, false, 0);\r\n\r\n      con.style[\"z-index\"] = \"-10000\";\r\n      con.style[\"position\"] = UIBase.PositionKey;\r\n      document.body.appendChild(con);\r\n\r\n      con.style[\"visibility\"] = \"hidden\";\r\n\r\n      con.add(menu);\r\n      menu.start();\r\n\r\n      let time = util.time_ms();\r\n\r\n      let timer = window.setInterval(() => {\r\n        if (util.time_ms() - time > 1500) {\r\n          window.clearInterval(timer);\r\n          return;\r\n        }\r\n\r\n        let r = menu.dom.getBoundingClientRect();\r\n\r\n        if (!r || r.height < 55) {\r\n          return;\r\n        }\r\n\r\n        window.clearInterval(timer);\r\n\r\n        y -= r.height + rheight;\r\n\r\n        menu.dom.remove();\r\n        con.remove();\r\n\r\n        let popup = (this._popup = menu._popup = screen.popup(this, x, y, false, 0));\r\n        popup.noMarginsOrPadding();\r\n\r\n        //popup.shadow.appendChild(menu.dom);\r\n        popup.add(menu);\r\n        menu.start();\r\n\r\n        popup.style[\"left\"] = x + \"px\";\r\n        popup.style[\"top\"] = y + \"px\";\r\n        //menu.setCSS();\r\n      }, 1);\r\n\r\n      return;\r\n    }\r\n\r\n    /*\r\n    let w = document.createElement(\"div\");\r\n    w.style[\"width\"] = w.style[\"height\"] = \"15px\";\r\n    w.style[\"background-color\"] = \"red\";\r\n    w.style[\"z-index\"] = \"5000\";\r\n    w.style[\"position\"] = UIBase.PositionKey;\r\n    w.style[\"pointer-events\"] = \"none\";\r\n    w.style[\"left\"] = x + \"px\";\r\n    w.style[\"top\"] = y + \"px\";\r\n\r\n    document.body.appendChild(w);\r\n    //*/\r\n\r\n    let con = (this._popup = menu._popup = screen.popup(this, x, y, false, 0));\r\n    con.noMarginsOrPadding();\r\n\r\n    con.add(menu);\r\n    if (this.searchMenuMode) {\r\n      menu.startFancy();\r\n    } else {\r\n      menu.start();\r\n    }\r\n  }\r\n\r\n  _redraw() {\r\n    if (this.getAttribute(\"simple\")) {\r\n      let color;\r\n\r\n      this.g.clearRect(0, 0, this.dom.width, this.dom.height);\r\n\r\n      if (this._highlight) {\r\n        ui_base.drawRoundBox2(this, { canvas: this.dom, g: this.g, color: this.getDefault(\"BoxHighlight\") });\r\n      }\r\n\r\n      if (this._focus) {\r\n        ui_base.drawRoundBox2(this, {\r\n          canvas: this.dom,\r\n          g: this.g,\r\n          color: this.getDefault(\"BoxHighlight\"),\r\n          op: \"stroke\",\r\n          no_clear: true,\r\n        });\r\n        ui_base.drawRoundBox(this, this.dom, this.g, undefined, undefined, 2, \"stroke\");\r\n      }\r\n\r\n      this._draw_text();\r\n      return;\r\n    }\r\n\r\n    super._redraw(false);\r\n\r\n    let g = this.g;\r\n    let w = this.dom.width,\r\n      h = this.dom.height;\r\n    let dpi = this.getDPI();\r\n\r\n    let p = 10 * dpi;\r\n    let p2 = dpi;\r\n\r\n    //*\r\n    let bg = this.getDefault(\"dropTextBG\");\r\n    if (bg !== undefined) {\r\n      g.fillStyle = bg;\r\n\r\n      g.beginPath();\r\n      g.rect(p2, p2, this.dom.width - p2 - h, this.dom.height - p2 * 2);\r\n      g.fill();\r\n    }\r\n    //*/\r\n\r\n    g.fillStyle = \"rgba(50, 50, 50, 0.2)\";\r\n    g.strokeStyle = \"rgba(50, 50, 50, 0.8)\";\r\n    g.beginPath();\r\n    /*\r\n    g.moveTo(w-p, p);\r\n    g.lineTo(w-(p+h*0.25), h-p);\r\n    g.lineTo(w-(p+h*0.5), p);\r\n    g.closePath();\r\n    //*/\r\n\r\n    let sz = 0.3;\r\n    g.moveTo(w - h * 0.5 - p, p);\r\n    g.lineTo(w - p, p);\r\n    g.moveTo(w - h * 0.5 - p, p + (sz * h) / 3);\r\n    g.lineTo(w - p, p + (sz * h) / 3);\r\n    g.moveTo(w - h * 0.5 - p, p + (sz * h * 2) / 3);\r\n    g.lineTo(w - p, p + (sz * h * 2) / 3);\r\n\r\n    g.lineWidth = 1;\r\n    g.stroke();\r\n\r\n    this._draw_text();\r\n  }\r\n\r\n  _convertVal(val) {\r\n    if (typeof val === \"string\" && this.prop) {\r\n      if (val in this.prop.values) {\r\n        return this.prop.values[val];\r\n      } else if (val in this.prop.keys) {\r\n        return this.prop.keys[val];\r\n      } else {\r\n        return undefined;\r\n      }\r\n    }\r\n\r\n    return val;\r\n  }\r\n\r\n  setValue(val, setLabelOnly = false) {\r\n    if (val === undefined || val === this._value) {\r\n      return;\r\n    }\r\n\r\n    val = this._convertVal(val);\r\n\r\n    if (val === undefined) {\r\n      console.warn(\"Bad val\", arguments[0]);\r\n      return;\r\n    }\r\n\r\n    this._value = val;\r\n\r\n    if (this.prop !== undefined && !setLabelOnly) {\r\n      this.prop.setValue(val);\r\n      let val2 = val;\r\n\r\n      if (val2 in this.prop.keys) val2 = this.prop.keys[val2];\r\n      val2 = this.prop.ui_value_names[val2];\r\n\r\n      this.setAttribute(\"name\", \"\" + val2);\r\n      this._name = \"\" + val2;\r\n    } else {\r\n      this.setAttribute(\"name\", \"\" + val);\r\n      this._name = \"\" + val;\r\n    }\r\n\r\n    if (this.onchange && !setLabelOnly) {\r\n      this.onchange(val);\r\n    }\r\n\r\n    this.setCSS();\r\n    this.updateDataPath();\r\n    this._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(DropBox);\r\n\r\nexport class MenuWrangler {\r\n  constructor() {\r\n    this.screen = undefined;\r\n    this.menustack = [];\r\n\r\n    this.lastPickElemTime = util.time_ms();\r\n\r\n    this._closetimer = 0;\r\n    this.closeOnMouseUp = undefined;\r\n    this.closereq = undefined;\r\n\r\n    this.timer = undefined;\r\n  }\r\n\r\n  get closetimer() {\r\n    return this._closetimer;\r\n  }\r\n\r\n  set closetimer(v) {\r\n    debugmenu(\"set closertime\", v);\r\n    this._closetimer = v;\r\n  }\r\n\r\n  get menu() {\r\n    return this.menustack.length > 0 ? this.menustack[this.menustack.length - 1] : undefined;\r\n  }\r\n\r\n  pushMenu(menu) {\r\n    debugmenu(\"pushMenu\");\r\n\r\n    this.spawnreq = undefined;\r\n\r\n    if (this.menustack.length === 0 && menu.closeOnMouseUp) {\r\n      this.closeOnMouseUp = true;\r\n    }\r\n\r\n    this.menustack.push(menu);\r\n  }\r\n\r\n  popMenu(menu) {\r\n    debugmenu(\"popMenu\");\r\n\r\n    return this.menustack.pop();\r\n  }\r\n\r\n  endMenus() {\r\n    debugmenu(\"endMenus\");\r\n\r\n    for (let menu of this.menustack) {\r\n      menu.close();\r\n    }\r\n\r\n    this.menustack = [];\r\n  }\r\n\r\n  searchKeyDown(e) {\r\n    let menu = this.menu;\r\n\r\n    e.stopPropagation();\r\n    menu._ignoreFocusEvents = true;\r\n    menu.textbox.focus();\r\n    menu._ignoreFocusEvents = false;\r\n\r\n    //if (e.shiftKey || e.altKey || e.ctrlKey || e.commandKey) {\r\n    //  return;\r\n    //}\r\n\r\n    switch (e.keyCode) {\r\n      case keymap[\"Enter\"]: //return key\r\n        menu.click(menu.activeItem);\r\n        break;\r\n      case keymap[\"Escape\"]: //escape key\r\n        menu.close();\r\n        break;\r\n      case keymap[\"Up\"]:\r\n        menu.selectPrev(false);\r\n        break;\r\n      case keymap[\"Down\"]:\r\n        menu.selectNext(false);\r\n        break;\r\n    }\r\n  }\r\n\r\n  on_keydown(e) {\r\n    window.menu = this.menu;\r\n\r\n    if (this.menu === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this.menu.hasSearchBox) {\r\n      return this.searchKeyDown(e);\r\n    }\r\n\r\n    let menu = this.menu;\r\n\r\n    switch (e.keyCode) {\r\n      case keymap[\"Left\"]: //left\r\n      case keymap[\"Right\"]: //right\r\n        if (menu._dropbox) {\r\n          let dropbox = menu._dropbox;\r\n\r\n          if (e.keyCode === keymap[\"Left\"]) {\r\n            dropbox = dropbox.previousElementSibling;\r\n          } else {\r\n            dropbox = dropbox.nextElementSibling;\r\n          }\r\n\r\n          if (dropbox !== undefined && dropbox instanceof DropBox) {\r\n            this.endMenus();\r\n            dropbox._onpress(e);\r\n          }\r\n        }\r\n        break;\r\n      case keymap[\"Up\"]: //up\r\n        menu.selectPrev();\r\n        break;\r\n      case keymap[\"Down\"]: //down\r\n        menu.selectNext();\r\n        break;\r\n      /*\r\n      let item = menu.activeItem;\r\n      if (!item) {\r\n        item = menu.items[0];\r\n      }\r\n\r\n      if (!item) {\r\n        return;\r\n      }\r\n\r\n      let item2;\r\n      let i = menu.items.indexOf(item);\r\n\r\n      if (e.keyCode == 38) {\r\n        i = (i - 1 + menu.items.length) % menu.items.length;\r\n      } else {\r\n        i = (i + 1) % menu.items.length;\r\n      }\r\n\r\n      item2 = menu.items[i];\r\n\r\n      if (item2) {\r\n        menu.setActive(item2);\r\n      }\r\n      break;//*/\r\n      case 13: //return key\r\n      case 32: //space key\r\n        menu.click(menu.activeItem);\r\n        break;\r\n      case 27: //escape key\r\n        menu.close();\r\n        break;\r\n    }\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    if (this.menu === undefined || this.screen === undefined) {\r\n      this.closetimer = util.time_ms();\r\n      return;\r\n    }\r\n\r\n    let screen = this.screen;\r\n    let x = e.pageX,\r\n      y = e.pageY;\r\n\r\n    let element = screen.pickElement(x, y);\r\n\r\n    if (element !== undefined && (element instanceof DropBox || util.isMobile())) {\r\n      this.endMenus();\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    if (this.menu === undefined || this.screen === undefined) {\r\n      this.closetimer = util.time_ms();\r\n      return;\r\n    }\r\n\r\n    let screen = this.screen;\r\n    let x = e.pageX,\r\n      y = e.pageY;\r\n\r\n    let element = screen.pickElement(x, y, undefined, undefined, DropBox);\r\n    if (element !== undefined) {\r\n      this.closeOnMouseUp = false;\r\n    } else {\r\n      element = screen.pickElement(x, y, undefined, undefined, Menu);\r\n\r\n      //closeOnMouseUp\r\n      if (element && this.closeOnMouseUp) {\r\n        element.click();\r\n      }\r\n    }\r\n  }\r\n\r\n  findMenu(x, y) {\r\n    let screen = this.screen;\r\n\r\n    let element = screen.pickElement(x, y);\r\n\r\n    if (element === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (element instanceof Menu) {\r\n      return element;\r\n    }\r\n\r\n    let w = element;\r\n\r\n    while (w) {\r\n      if (w instanceof Menu) {\r\n        //w === this.menu) {\r\n        return w;\r\n        break;\r\n      }\r\n\r\n      w = w.parentWidget;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    if (this.menu && this.menu.hasSearchBox) {\r\n      this.closetimer = util.time_ms();\r\n      this.closereq = undefined;\r\n      return;\r\n    }\r\n\r\n    if (this.menu === undefined || this.screen === undefined) {\r\n      this.closetimer = util.time_ms();\r\n      this.closereq = undefined;\r\n      return;\r\n    }\r\n\r\n    let screen = this.screen;\r\n    let x = e.pageX,\r\n      y = e.pageY;\r\n\r\n    let element;\r\n    let menu = this.menu;\r\n\r\n    if (menu) {\r\n      let r = menu.getBoundingClientRect();\r\n      let pad = 15;\r\n\r\n      if (r && x >= r.x - pad && y >= r.y - pad && x <= r.x + r.width + pad * 2 && y <= r.y + r.height + pad * 2) {\r\n        element = menu;\r\n      }\r\n    }\r\n\r\n    if (!element && util.time_ms() - this.lastPickElemTime > 250) {\r\n      element = screen.pickElement(x, y);\r\n      this.lastPickElemTime = util.time_ms();\r\n    }\r\n\r\n    if (element === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (element instanceof Menu) {\r\n      this.closetimer = util.time_ms();\r\n      this.closereq = undefined;\r\n      return;\r\n    }\r\n\r\n    let destroy = element.hasAttribute(\"menu-button\") && element.hasAttribute(\"simple\");\r\n    destroy = destroy && element.menu !== this.menu;\r\n\r\n    if (destroy) {\r\n      /* check that dropbox doesn't contain our parent menu either */\r\n\r\n      let menu2 = this.menu;\r\n      while (menu2 !== element.menu) {\r\n        menu2 = menu2.parentMenu;\r\n        destroy = destroy && (menu2 === undefined || menu2 !== element.menu);\r\n      }\r\n    }\r\n\r\n    if (destroy) {\r\n      //destroy entire menu stack\r\n      this.endMenus();\r\n\r\n      this.closetimer = util.time_ms();\r\n      this.closereq = undefined;\r\n\r\n      //start new menu\r\n      element._onpress(e);\r\n      return;\r\n    }\r\n\r\n    let ok = false;\r\n\r\n    let w = element;\r\n    while (w) {\r\n      if (w instanceof Menu) {\r\n        //w === this.menu) {\r\n        ok = true;\r\n        break;\r\n      }\r\n\r\n      if (w.hasAttribute(\"menu-button\") && w.menu === this.menu) {\r\n        ok = true;\r\n        break;\r\n      }\r\n\r\n      w = w.parentWidget;\r\n    }\r\n\r\n    if (!ok) {\r\n      this.closereq = this.menu;\r\n    } else {\r\n      this.closetimer = util.time_ms();\r\n      this.closereq = undefined;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    let closetime = cconst.menu_close_time;\r\n    closetime = closetime === undefined ? 50 : closetime;\r\n\r\n    let close = this.closereq && this.closereq === this.menu;\r\n    close = close && util.time_ms() - this.closetimer > closetime;\r\n\r\n    if (close) {\r\n      this.closereq = undefined;\r\n      this.endMenus();\r\n    }\r\n  }\r\n\r\n  startTimer() {\r\n    if (this.timer) {\r\n      this.stopTimer();\r\n    }\r\n\r\n    this.timer = setInterval(() => {\r\n      debugmenu(\"start menu wrangler interval\");\r\n\r\n      this.update();\r\n    }, 150);\r\n  }\r\n\r\n  stopTimer() {\r\n    if (this.timer) {\r\n      debugmenu(\"stop menu wrangler interval\");\r\n\r\n      clearInterval(this.timer);\r\n      this.timer = undefined;\r\n    }\r\n  }\r\n}\r\n\r\nexport let menuWrangler = (window._menuWrangler = new MenuWrangler());\r\nlet wrangerStarted = false;\r\n\r\nexport function startMenuEventWrangling(screen) {\r\n  if (typeof document === \"undefined\") {\r\n    // inside a worker?\r\n    return;\r\n  }\r\n  menuWrangler.screen = screen;\r\n\r\n  if (wrangerStarted) {\r\n    return;\r\n  }\r\n\r\n  wrangerStarted = true;\r\n\r\n  for (let k in DomEventTypes) {\r\n    if (menuWrangler[k] === undefined) {\r\n      continue;\r\n    }\r\n\r\n    let dom = k.search(\"key\") >= 0 ? window : document.body;\r\n    dom = window;\r\n    dom.addEventListener(DomEventTypes[k], menuWrangler[k].bind(menuWrangler), { passive: false, capture: true });\r\n  }\r\n\r\n  menuWrangler.screen = screen;\r\n  menuWrangler.startTimer();\r\n}\r\n\r\nwindow._startMenuEventWrangling = startMenuEventWrangling;\r\n\r\nexport function setWranglerScreen(screen) {\r\n  startMenuEventWrangling(screen);\r\n}\r\n\r\nexport function getWranglerScreen() {\r\n  return menuWrangler.screen;\r\n}\r\n\r\nexport function createMenu(ctx, title, templ) {\r\n  let menu = UIBase.createElement(\"menu-x\");\r\n  menu.ctx = ctx;\r\n  menu.setAttribute(\"name\", title);\r\n\r\n  let SEP = menu.constructor.SEP;\r\n  let id = 0;\r\n  let cbs = {};\r\n\r\n  let doItem = (item) => {\r\n    if (item !== undefined && item instanceof Menu) {\r\n      menu.addItem(item);\r\n    } else if (typeof item == \"string\") {\r\n      let def, hotkey;\r\n\r\n      try {\r\n        def = ctx.api.getToolDef(item);\r\n      } catch (error) {\r\n        menu.addItem(\"(tool path error)\", id++);\r\n        return;\r\n      }\r\n\r\n      //3Extra(text, id=undefined, hotkey, icon=-1, add=true) {\r\n      if (!def.hotkey) {\r\n        try {\r\n          hotkey = ctx.api.getToolPathHotkey(ctx, item);\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n          console.warn(\"error getting hotkey for tool \" + item);\r\n          hotkey = undefined;\r\n        }\r\n      } else {\r\n        hotkey = def.hotkey;\r\n      }\r\n\r\n      menu.addItemExtra(def.uiname, id, hotkey, def.icon);\r\n\r\n      cbs[id] = (function (toolpath) {\r\n        return function () {\r\n          ctx.api.execTool(ctx, toolpath);\r\n        };\r\n      })(item);\r\n\r\n      id++;\r\n    } else if (item === SEP) {\r\n      menu.seperator();\r\n    } else if (typeof item === \"function\" || item instanceof Function) {\r\n      doItem(item());\r\n    } else if (item instanceof Array) {\r\n      //old array-based api for custom entries\r\n      let hotkey = item.length > 2 ? item[2] : undefined;\r\n      let icon = item.length > 3 ? item[3] : undefined;\r\n      let tooltip = item.length > 4 ? item[4] : undefined;\r\n      let id2 = item.length > 5 ? item[5] : id++;\r\n\r\n      if (hotkey !== undefined && hotkey instanceof HotKey) {\r\n        hotkey = hotkey.buildString();\r\n      }\r\n\r\n      menu.addItemExtra(item[0], id2, hotkey, icon, undefined, tooltip);\r\n\r\n      cbs[id2] = (function (cbfunc, arg) {\r\n        return function () {\r\n          cbfunc(arg);\r\n        };\r\n      })(item[1], id2);\r\n    } else if (typeof item === \"object\") {\r\n      //new object-based api for custom entries\r\n      let { name, callback, hotkey, icon, tooltip } = item;\r\n\r\n      let id2 = item.id !== undefined ? item.id : id++;\r\n      if (hotkey !== undefined && hotkey instanceof HotKey) {\r\n        hotkey = hotkey.buildString();\r\n      }\r\n\r\n      menu.addItemExtra(name, id2, hotkey, icon, undefined, tooltip);\r\n\r\n      cbs[id2] = (function (cbfunc, arg) {\r\n        return function () {\r\n          cbfunc(arg);\r\n        };\r\n      })(callback, id2);\r\n    }\r\n  };\r\n\r\n  for (let item of templ) {\r\n    doItem(item);\r\n  }\r\n\r\n  menu.onselect = (id) => {\r\n    cbs[id]();\r\n  };\r\n\r\n  return menu;\r\n}\r\n\r\nexport function startMenu(menu, x, y, searchMenuMode = false, safetyDelay = 55) {\r\n  menuWrangler.endMenus();\r\n\r\n  let screen = menu.ctx.screen;\r\n  let con = (menu._popup = screen.popup(undefined, x, y, false, safetyDelay));\r\n  con.noMarginsOrPadding();\r\n\r\n  con.add(menu);\r\n  if (searchMenuMode) {\r\n    menu.startFancy();\r\n  } else {\r\n    menu.start();\r\n  }\r\n\r\n  menu.flushUpdate();\r\n  menu.flushSetCSS();\r\n\r\n  menu._popup.flushUpdate();\r\n  menu._popup.flushSetCSS();\r\n}\r\n","//bind module to global var to get at it in console.\r\n//\r\n//note that require has an api for handling circular \r\n//module refs, in such cases do not use these vars.\r\n\r\nvar _ui = undefined;\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as units from '../core/units.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from './ui_base.js';\r\nimport * as ui_widgets from '../widgets/ui_widgets.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport '../path-controller/util/html5_fileapi.js';\r\nimport {HotKey} from '../path-controller/util/simple_events.js';\r\nimport {CSSFont} from './ui_theme.js';\r\nimport {theme, iconSheetFromPackFlag} from './ui_base.js';\r\n\r\nimport {createMenu, startMenu} from \"../widgets/ui_menu.js\";\r\n\r\nlet PropFlags = toolprop.PropFlags;\r\nlet PropSubTypes = toolprop.PropSubTypes;\r\n\r\nlet EnumProperty = toolprop.EnumProperty;\r\n\r\nlet Vector2   = vectormath.Vector2,\r\n    UIBase    = ui_base.UIBase,\r\n    PackFlags = ui_base.PackFlags,\r\n    PropTypes = toolprop.PropTypes;\r\n\r\nimport {DataPathError} from '../path-controller/controller/controller_base.js';\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nexport class Label extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._label = \"\";\r\n\r\n    this._lastText = \"\";\r\n\r\n    this.dom = document.createElement(\"div\");\r\n    this.dom.setAttribute(\"class\", \"_labelx\");\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n      div._labelx::selection {\r\n        color: none;\r\n        background: none;\r\n         -webkit-user-select:none;\r\n         user-select:none;\r\n      }\r\n    `;\r\n\r\n    this.shadow.appendChild(style);\r\n    this.shadow.appendChild(this.dom);\r\n\r\n    this.font = \"LabelText\";\r\n  }\r\n\r\n  get font() {\r\n    return this._font;\r\n  }\r\n\r\n  /**Set a font defined in ui_base.defaults\r\n   e.g. DefaultText*/\r\n  set font(fontDefaultName) {\r\n    if (typeof fontDefaultName === \"string\") {\r\n      this._font = this.getDefault(fontDefaultName);\r\n      if (!this._font) {\r\n        console.warn(\"Invalid font\", fontDefaultName);\r\n      }\r\n    } else if (typeof fontDefaultName === \"object\" && fontDefaultName instanceof CSSFont) {\r\n      this._font = fontDefaultName;\r\n    } else {\r\n      console.warn(\"Invalid font\", fontDefaultName);\r\n    }\r\n\r\n    this._updateFont();\r\n  }\r\n\r\n  get text() {\r\n    return this._label;\r\n    //return this.dom.innerText;\r\n  }\r\n\r\n  set text(text) {\r\n    this._label = text;\r\n\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      this.dom.innerText = text;\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"label-x\",\r\n      style  : \"label\"\r\n    };\r\n  }\r\n\r\n  init() {\r\n    this.dom.style[\"width\"] = \"max-content\";\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS(false);\r\n    this.setBoxCSS();\r\n  }\r\n\r\n  on_disabled() {\r\n    super.on_disabled();\r\n    this._enabled_font = this.font;\r\n    this.font = \"DefaultText\";\r\n    this._updateFont();\r\n  }\r\n\r\n  on_enabled() {\r\n    super.on_enabled();\r\n    this.font = this._enabled_font;\r\n    this._updateFont();\r\n  }\r\n\r\n  _updateFont() {\r\n    let font = this._font;\r\n    if (!font) return;\r\n\r\n    this.dom.style[\"font\"] = font.genCSS();\r\n    this.dom.style[\"color\"] = font.color;\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (this.ctx === undefined) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n    let prop = this.getPathMeta(this.ctx, path);\r\n    let val = this.getPathValue(this.ctx, path);\r\n\r\n    if (val === undefined) {\r\n      return;\r\n    }\r\n\r\n    //console.log(path);\r\n    if (prop.type & (PropTypes.INT | PropTypes.FLOAT)) {\r\n      val = units.buildString(val, prop.baseUnit, prop.decimalPlaces, prop.displayUnit);\r\n    }\r\n\r\n    val = \"\" + this._label + \" \" + val;\r\n\r\n    if (val !== this._lastText) {\r\n      this._lastText = val;\r\n      this.dom.innerText = val;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    let key = \"\";\r\n\r\n    if (this._font !== undefined && this._font instanceof CSSFont) {\r\n      key += this._font.genKey();\r\n    }\r\n\r\n    if (key !== this._last_font) {\r\n      this._last_font = key;\r\n      this._updateFont();\r\n    }\r\n\r\n    this.dom.style[\"pointer-events\"] = this.style[\"pointer-events\"];\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n  }\r\n}\r\n\r\nui_base.UIBase.internalRegister(Label);\r\n\r\nexport class Container extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.dataPrefix = '';\r\n    this.massSetPrefix = '';\r\n\r\n    this.inherit_packflag = 0;\r\n\r\n    let style = this.styletag = document.createElement(\"style\")\r\n    style.textContent = `\r\n    `;\r\n\r\n    this.shadow.appendChild(style);\r\n    this.reversed = false;\r\n\r\n    this._prefixstack = [];\r\n    this._mass_prefixstack = [];\r\n  }\r\n\r\n  noUndo() {\r\n    this.setUndo(false);\r\n    return this;\r\n  }\r\n\r\n  set background(bg) {\r\n    this.__background = bg;\r\n\r\n    this.styletag.textContent = `div.containerx {\r\n        background-color : ${bg};\r\n      }\r\n    `;\r\n    this.style[\"background-color\"] = bg;\r\n  }\r\n\r\n  get children() {\r\n    let list = [];\r\n\r\n    this._forEachChildWidget((n) => {\r\n      list.push(n);\r\n    });\r\n\r\n    return list\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"container-x\"\r\n    };\r\n  }\r\n\r\n  /** recursively change path prefix for all children*/\r\n  changePathPrefix(newprefix) {\r\n    let prefix = this.dataPrefix.trim();\r\n    this.dataPrefix = newprefix;\r\n\r\n    if (prefix.length > 0) {\r\n      prefix += \".\";\r\n    }\r\n\r\n    let rec = (n, con) => {\r\n      if (n instanceof Container && n !== this) {\r\n        if (n.dataPrefix.startsWith(prefix)) {\r\n          n.dataPrefix = n.dataPath.slice(prefix.length, n.dataPrefix.length);\r\n          n.dataPrefix = con._joinPrefix(n.dataPrefix);\r\n          con = n;\r\n        }\r\n      }\r\n\r\n      if (n.hasAttribute(\"datapath\")) {\r\n        let path = n.getAttribute(\"datapath\");\r\n\r\n        if (path.startsWith(prefix)) {\r\n          path = path.slice(prefix.length, path.length);\r\n          path = con._joinPrefix(path);\r\n          n.setAttribute(\"datapath\", path);\r\n\r\n          //update helper tooltips\r\n          n.description = n.description;\r\n        }\r\n      }\r\n\r\n      n._forEachChildWidget((n2) => {\r\n        rec(n2, con);\r\n      });\r\n    }\r\n\r\n    rec(this, this);\r\n  }\r\n\r\n  reverse() {\r\n    this.reversed ^= true;\r\n    return this;\r\n  }\r\n\r\n  pushMassSetPrefix(val) {\r\n    this._mass_prefixstack.push(this.massSetPrefix);\r\n    this.massSetPrefix = val;\r\n    return this;\r\n  }\r\n\r\n  pushDataPrefix(val) {\r\n    this._prefixstack.push(this.dataPrefix);\r\n    this.dataPrefix = val;\r\n    return this;\r\n  }\r\n\r\n  popDataPrefix() {\r\n    this.dataPrefix = this._prefixstack.pop();\r\n    return this;\r\n  }\r\n\r\n  popMassSetPrefix() {\r\n    this.massSetPrefix = this._mass_prefixstack.pop();\r\n    return this;\r\n  }\r\n\r\n  saveData() {\r\n    if (this.scrollTop || this.scrollLeft) {\r\n      return {\r\n        scrollTop : this.scrollTop,\r\n        scrollLeft: this.scrollLeft\r\n      }\r\n    } else {\r\n      return {};\r\n    }\r\n  }\r\n\r\n  loadData(obj) {\r\n    if (!obj) return;\r\n\r\n    let x = obj.scrollLeft || 0;\r\n    let y = obj.scrollTop || 0;\r\n\r\n    this.doOnce(() => {\r\n      this.scrollTo(x, y);\r\n    }, 12);\r\n  }\r\n\r\n  init() {\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-direction\"] = this.reversed ? \"column-reverse\" : \"column\";\r\n    this.style[\"flex-wrap\"] = \"nowrap\";\r\n    this.style[\"flex-grow\"] = \"\" + this.getDefault(\"flex-grow\", undefined, \"1\");\r\n\r\n    this.setCSS();\r\n\r\n    super.init();\r\n\r\n    this.setAttribute(\"class\", \"containerx\");\r\n  }\r\n\r\n  /** Returns previous icon flags */\r\n  useIcons(enabled_or_sheet = true) {\r\n    let enabled = !!enabled_or_sheet;\r\n\r\n    let mask = PackFlags.USE_ICONS | PackFlags.SMALL_ICON | PackFlags.LARGE_ICON;\r\n    mask = mask | PackFlags.CUSTOM_ICON_SHEET;\r\n    mask = mask | (255<<PackFlags.CUSTOM_ICON_SHEET_START);\r\n\r\n    let previous = this.packflag & mask;\r\n\r\n    if (!enabled) {\r\n      this.packflag &= ~PackFlags.USE_ICONS;\r\n      this.inherit_packflag &= ~PackFlags.USE_ICONS;\r\n\r\n      return previous;\r\n    }\r\n\r\n    let sheet = enabled_or_sheet;\r\n\r\n    if (sheet === true) {\r\n      sheet = PackFlags.SMALL_ICON;\r\n    } else if (sheet === 1) {\r\n      sheet = PackFlags.LARGE_ICON;\r\n    } else {\r\n      sheet = PackFlags.CUSTOM_ICON_SHEET | (sheet<<(PackFlags.CUSTOM_ICON_SHEET_START));\r\n    }\r\n\r\n    //clear any existing sizing flags\r\n    this.packflag &= ~(PackFlags.SMALL_ICON | PackFlags.LARGE_ICON | PackFlags.CUSTOM_ICON_SHEET);\r\n    this.packflag &= ~(255<<PackFlags.CUSTOM_ICON_SHEET_START);\r\n\r\n    this.packflag |= PackFlags.USE_ICONS | sheet;\r\n    this.inherit_packflag |= PackFlags.USE_ICONS | sheet;\r\n\r\n    return previous;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param mode: flexbox wrap mode, can be wrap, nowrap, or wrap-reverse\r\n   * @returns {Container}\r\n   */\r\n  wrap(mode = \"wrap\") {\r\n    this.style[\"flex-wrap\"] = mode;\r\n    return this;\r\n  }\r\n\r\n  noMarginsOrPadding() {\r\n    super.noMarginsOrPadding();\r\n\r\n    let keys = [\"margin\", \"padding\", \"margin-block-start\", \"margin-block-end\"];\r\n    keys = keys.concat([\"padding-block-start\", \"padding-block-end\"]);\r\n\r\n    for (let k of keys) {\r\n      this.style[k] = \"0px\";\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  setCSS() {\r\n    let rest = '';\r\n\r\n    let add = (style) => {\r\n      if (!this.hasDefault(style)) {\r\n        return;\r\n      }\r\n\r\n      let val = this.getDefault(style);\r\n\r\n      if (val !== undefined) {\r\n        rest += `  ${style} = ${val};\\n`;\r\n        this.style[style] = val;\r\n      }\r\n    }\r\n\r\n    add(\"border-radius\");\r\n    add(\"border-width\");\r\n    add(\"border-top\");\r\n    add(\"border-bottom\");\r\n    add(\"border-left\");\r\n    add(\"border-right\");\r\n\r\n    this.styletag.textContent = `div.containerx {\r\n        background-color : ${this.getDefault(\"background-color\")};\r\n        ${rest}\r\n      }\r\n      `;\r\n  }\r\n\r\n  overrideDefault(key, val) {\r\n    super.overrideDefault(key, val);\r\n    this.setCSS();\r\n\r\n    return this;\r\n  }\r\n\r\n  /*\r\n  * shorthand for:\r\n  *\r\n  * .row().noMarginsOrPadding().oneAxisPadding()\r\n  * */\r\n  strip(themeClass_or_obj = \"strip\", margin1 = this.getDefault(\"oneAxisPadding\"), margin2 = 1, horiz = undefined) {\r\n    let themeClass = themeClass_or_obj;\r\n\r\n    if (typeof themeClass_or_obj === \"object\") {\r\n      let obj = themeClass_or_obj;\r\n\r\n      themeClass = obj.themeClass ?? \"strip\";\r\n      margin1 = obj.margin1 ?? margin1;\r\n      margin2 = obj.margin2 ?? 1;\r\n      horiz = obj.horiz;\r\n    }\r\n\r\n    if (horiz === undefined) {\r\n      horiz = this instanceof RowFrame;\r\n      horiz = horiz || this.style[\"flex-direction\"] === \"row\";\r\n    }\r\n\r\n    let flag = horiz ? PackFlags.STRIP_HORIZ : PackFlags.STRIP_VERT;\r\n\r\n    let strip = (horiz ? this.row() : this.col());\r\n\r\n    if (typeof margin1 !== \"number\") {\r\n      throw new Error(\"margin1 was not a number\");\r\n    }\r\n    if (typeof margin2 !== \"number\") {\r\n      throw new Error(\"margin2 was not a number\");\r\n    }\r\n\r\n    strip.packflag |= flag;\r\n    strip.dataPrefix = this.dataPrefix;\r\n    strip.massSetPrefix = this.massSetPrefix;\r\n\r\n    if (themeClass in theme) {\r\n      strip.overrideClass(themeClass);\r\n      strip.background = strip.getDefault(\"background-color\");\r\n      strip.setCSS();\r\n      strip.overrideClass(themeClass);\r\n\r\n      let lastkey;\r\n\r\n      strip.update.after(function () {\r\n        let bradius = strip.getDefault(\"border-radius\");\r\n        let bline = strip.getDefault(\"border-width\");\r\n        let bstyle = strip.getDefault(\"border-style\") || 'solid';\r\n        let padding = strip.getDefault(\"padding\");\r\n        let bcolor = strip.getDefault(\"border-color\") || \"rgba(0,0,0,0)\";\r\n        let margin = strip.getDefault(\"margin\") || 0;\r\n\r\n        bline = bline === undefined ? 0 : bline;\r\n        bradius = bradius === undefined ? 0 : bradius;\r\n        padding = padding === undefined ? 5 : padding;\r\n\r\n        let bg = strip.getDefault(\"background-color\");\r\n\r\n        let key = \"\" + bradius + \":\" + bline + \":\" + bg + \":\" + padding + \":\";\r\n        key += bstyle + \":\" + padding + \":\" + bcolor + \":\" + margin;\r\n\r\n        if (key !== lastkey) {\r\n          lastkey = key;\r\n\r\n          strip.oneAxisPadding(margin1 + padding, margin2 + padding);\r\n          strip.setCSS();\r\n\r\n          strip.background = bg;\r\n\r\n          strip.style[\"margin\"] = \"\" + margin + \"px\";\r\n          strip.style[\"border\"] = `${bline}px ${bstyle} ${bcolor}`;\r\n          strip.style[\"border-radius\"] = \"\" + bradius + \"px\";\r\n        }\r\n      })\r\n    } else {\r\n      console.warn(this.constructor.name + \".strip(): unknown theme class \" + themeClass);\r\n    }\r\n\r\n    /*\r\n    let prev = strip.previousElementSibling;\r\n    if (prev !== undefined && (prev.packflag & flag)) {\r\n      if (horiz) {\r\n        prev.style[\"padding-right\"] = \"0px\";\r\n      } else {\r\n        prev.style[\"padding-top\"] = \"0px\";\r\n      }\r\n    }//*/\r\n\r\n    return strip;\r\n  }\r\n\r\n  /**\r\n   * tries to set margin along one axis only in smart manner\r\n   * */\r\n  oneAxisMargin(m = this.getDefault(\"oneAxisMargin\"), m2 = 0) {\r\n    this.style[\"margin-top\"] = this.style[\"margin-bottom\"] = \"\" + m + \"px\";\r\n    this.style[\"margin-left\"] = this.style[\"margin-right\"] = \"\" + m2 + \"px\";\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * tries to set padding along one axis only in smart manner\r\n   * */\r\n  oneAxisPadding(axisPadding = this.getDefault(\"oneAxisPadding\"), otherPadding = 0) {\r\n    this.style[\"padding-top\"] = this.style[\"padding-bottom\"] = \"\" + axisPadding + \"px\";\r\n    this.style[\"padding-left\"] = this.style[\"padding-right\"] = \"\" + otherPadding + \"px\";\r\n\r\n    return this;\r\n  }\r\n\r\n  setMargin(m) {\r\n    this.style[\"margin\"] = m + \"px\";\r\n\r\n    return this;\r\n  }\r\n\r\n  setPadding(m) {\r\n    this.style[\"padding\"] = m + \"px\";\r\n\r\n    return this;\r\n  }\r\n\r\n  setSize(width, height) {\r\n    if (width !== undefined) {\r\n      if (typeof width == \"number\")\r\n        this.style[\"width\"] = this.div.style[\"width\"] = ~~width + \"px\";\r\n      else\r\n        this.style[\"width\"] = this.div.style[\"width\"] = width;\r\n    }\r\n\r\n    if (height !== undefined) {\r\n      if (typeof height == \"number\")\r\n        this.style[\"height\"] = this.div.style[\"height\"] = ~~height + \"px\";\r\n      else\r\n        this.style[\"height\"] = this.div.style[\"height\"] = height;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  save() {\r\n  }\r\n\r\n  load() {\r\n  }\r\n\r\n  saveVisibility() {\r\n    localStorage[this.storagePrefix + \"_settings\"] = JSON.stringify(this);\r\n    return this;\r\n  }\r\n\r\n  loadVisibility() {\r\n    let key = this.storagePrefix + \"_settings\";\r\n    let ok = true;\r\n\r\n    if (key in localStorage) {\r\n      console.log(\"loading UI visibility state. . .\");\r\n\r\n      try {\r\n        this.loadJSON(JSON.parse(localStorage[key]));\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        ok = false;\r\n      }\r\n    }\r\n\r\n    return ok;\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = {\r\n      opened: !this.closed\r\n    };\r\n\r\n    return Object.assign(super.toJSON(), ret);\r\n  }\r\n\r\n  _ondestroy() {\r\n    this._forEachChildWidget((n) => {\r\n      n._ondestroy();\r\n    });\r\n\r\n    super._ondestroy();\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    //console.error(\"ui.js:Container.loadJSON: implement me!\");\r\n\r\n    return this;\r\n  }\r\n\r\n  redrawCurves() {\r\n    throw new Error(\"Implement me (properly!)\");\r\n\r\n    if (this.closed)\r\n      return;\r\n\r\n    for (let cw of this.curve_widgets) {\r\n      cw.draw();\r\n    }\r\n  }\r\n\r\n  listen() {\r\n    window.setInterval(() => {\r\n      this.update();\r\n    }, 150);\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  appendChild(child) {\r\n    if (child instanceof ui_base.UIBase) {\r\n      child.ctx = this.ctx;\r\n      child.parentWidget = this;\r\n      this.shadow.appendChild(child);\r\n\r\n      if (child.onadd) {\r\n        child.onadd();\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    return super.appendChild(child);\r\n  }\r\n\r\n  clear(trigger_on_destroy = true) {\r\n    for (let child of this.children) {\r\n      if (child instanceof ui_base.UIBase) {\r\n        child.remove(trigger_on_destroy);\r\n      }\r\n    }\r\n  }\r\n\r\n  removeChild(child, trigger_on_destroy = true) {\r\n    let ret = super.removeChild(child);\r\n\r\n    if (child.on_remove) {\r\n      child.on_remove();\r\n    }\r\n\r\n    if (trigger_on_destroy && child.on_destroy) {\r\n      child.on_destroy();\r\n    }\r\n\r\n    child.parentWidget = undefined;\r\n\r\n    return ret;\r\n  }\r\n\r\n  prepend(child) {\r\n    if (child instanceof UIBase) {\r\n      this._prepend(child);\r\n    } else {\r\n      super.prepend(child);\r\n    }\r\n  }\r\n\r\n  //*\r\n  _prepend(child) {\r\n    return this._add(child, true);\r\n  }//*/\r\n\r\n  add(child) {\r\n    return this._add(child);\r\n  }\r\n\r\n  insert(i, ch) {\r\n    ch.parentWidget = this;\r\n    ch.ctx = this;\r\n\r\n    if (i >= this.shadow.childNodes.length) {\r\n      this.add(ch);\r\n    } else {\r\n      this.shadow.insertBefore(ch, util.list(this.children)[i]);\r\n    }\r\n\r\n    if (ch.onadd) {\r\n      ch.onadd();\r\n    }\r\n  }\r\n\r\n  _add(child, prepend = false) {\r\n    //paranoia check for if we accidentally got a DOM NodeList\r\n    if (child instanceof NodeList) {\r\n      throw new Error(\"eek!\");\r\n    }\r\n\r\n    child.ctx = this.ctx;\r\n    child.parentWidget = this;\r\n    child._useDataPathUndo = this._useDataPathUndo;\r\n\r\n    if (!child._themeOverride && this._themeOverride) {\r\n      child.overrideTheme(this._themeOverride);\r\n    }\r\n\r\n    if (prepend) {\r\n      this.shadow.prepend(child);\r\n    } else {\r\n      this.shadow.appendChild(child);\r\n    }\r\n\r\n    /*\r\n    if (child._ctx) {\r\n      child._init();\r\n    }//*/\r\n\r\n    if (child.onadd)\r\n      child.onadd();\r\n\r\n    return child;\r\n  }\r\n\r\n  //TODO: make sure this works on Electron?\r\n  dynamicMenu(title, list, packflag = 0) {\r\n    //actually, .menu works for now\r\n    return this.menu(title, list, packflag);\r\n  }\r\n\r\n  /**example usage:\r\n\r\n   .menu([\r\n   \"some_tool_path.tool()|CustomLabel\",\r\n   ui_widgets.Menu.SEP,\r\n   \"some_tool_path.another_tool()\",\r\n   \"some_tool_path.another_tool()|CustomLabel::Custom Hotkey String\",\r\n   [\"Name\", () => {console.log(\"do something\")}]\r\n   ])\r\n\r\n   **/\r\n  menu(title, list, packflag = 0) {\r\n    let dbox = UIBase.createElement(\"dropbox-x\");\r\n\r\n    dbox._name = title;\r\n    dbox.setAttribute(\"simple\", true);\r\n    dbox.setAttribute(\"name\", title);\r\n\r\n    if (list instanceof HTMLElement && list.constructor.name === \"Menu\") {\r\n      dbox._build_menu = function () {\r\n        if (this._menu !== undefined && this._menu.parentNode !== undefined) {\r\n          this._menu.remove();\r\n        }\r\n\r\n        this._menu = createMenu(this.ctx, title, list);\r\n        return this._menu;\r\n      }\r\n    } else if (list) {\r\n      dbox.template = list;\r\n    }\r\n\r\n    this._container_inherit(dbox, packflag);\r\n\r\n    this._add(dbox);\r\n    return dbox;\r\n  }\r\n\r\n  toolPanel(path_or_cls, args = {}) {\r\n    let tdef;\r\n    let cls;\r\n\r\n    if (typeof path_or_cls === \"string\") {\r\n      cls = this.ctx.api.parseToolPath(path_or_cls);\r\n    } else {\r\n      cls = path_or_cls;\r\n    }\r\n\r\n    tdef = cls._getFinalToolDef();\r\n\r\n    let packflag = args.packflag || 0;\r\n    let label = args.label || tdef.uiname;\r\n    let createCb = args.createCb || args.create_cb;\r\n    let container = args.container || this.panel(label);\r\n    let defaultsPath = args.defaultsPath || \"toolDefaults\";\r\n\r\n    if (defaultsPath.length > 0 && !defaultsPath.endsWith(\".\")) {\r\n      defaultsPath += \".\";\r\n    }\r\n\r\n    let path = defaultsPath + tdef.toolpath;\r\n\r\n    container.useIcons(false);\r\n\r\n    let inputs = tdef.inputs || {};\r\n    for (let k in inputs) {\r\n      let prop = inputs[k];\r\n\r\n      if (prop.flag & PropFlags.PRIVATE) {\r\n        continue;\r\n      }\r\n\r\n      let apiname = prop.apiname || k;\r\n      let path2 = path + \".\" + apiname;\r\n\r\n      container.prop(path2);\r\n    }\r\n\r\n    container.tool(path_or_cls, packflag, createCb, label);\r\n\r\n    return container;\r\n  }\r\n\r\n  tool(path_or_cls, packflag_or_args = {}, createCb = undefined, label = undefined) {\r\n    let cls;\r\n    let packflag;\r\n\r\n    if (typeof packflag_or_args === \"object\") {\r\n      let args = packflag_or_args;\r\n\r\n      packflag = args.packflag;\r\n      createCb = args.createCb;\r\n      label = args.label;\r\n    } else {\r\n      packflag = packflag_or_args || 0;\r\n    }\r\n\r\n    if (typeof path_or_cls == \"string\") {\r\n      if (path_or_cls.search(/\\|/) >= 0) {\r\n        path_or_cls = path_or_cls.split(\"|\");\r\n\r\n        if (label === undefined && path_or_cls.length > 1) {\r\n          label = path_or_cls[1].trim();\r\n        }\r\n\r\n        path_or_cls = path_or_cls[0].trim();\r\n      }\r\n\r\n      if (this.ctx === undefined) {\r\n        console.warn(\"this.ctx was undefined in tool()\");\r\n        return;\r\n      }\r\n\r\n      cls = this.ctx.api.parseToolPath(path_or_cls);\r\n\r\n      if (cls === undefined) {\r\n        console.warn(\"Unknown tool for toolpath \\\"\" + path_or_cls + \"\\\"\");\r\n        return;\r\n      }\r\n    } else {\r\n      cls = path_or_cls;\r\n    }\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n    let hotkey;\r\n\r\n    if (createCb === undefined) {\r\n      createCb = (cls) => {\r\n        return this.ctx.api.createTool(this.ctx, path_or_cls);\r\n      }\r\n    }\r\n\r\n    let cb = () => {\r\n      console.log(\"tool run\");\r\n\r\n      let toolob = createCb(cls);\r\n      this.ctx.api.execTool(this.ctx, toolob);\r\n    }\r\n\r\n    let def = typeof path_or_cls === \"string\" ? this.ctx.api.getToolDef(path_or_cls) : cls.tooldef();\r\n    let tooltip = def.description === undefined ? def.uiname : def.description;\r\n\r\n    //is there a hotkey hardcoded in the class?\r\n    if (def.hotkey !== undefined) {\r\n      tooltip += \"\\n\\t\" + def.hotkey;\r\n      hotkey = def.hotkey;\r\n    } else { //if not, use getToolPathHotkey api\r\n      let path = path_or_cls;\r\n\r\n      if (typeof path != \"string\") {\r\n        path = def.toolpath;\r\n      }\r\n\r\n      let hotkey = this.ctx.api.getToolPathHotkey(this.ctx, path);\r\n      if (hotkey) {\r\n        tooltip += \"\\n\\tHotkey: \" + hotkey;\r\n      }\r\n    }\r\n\r\n    let ret;\r\n\r\n    if (def.icon !== undefined && (packflag & PackFlags.USE_ICONS)) {\r\n      label = label === undefined ? tooltip : label;\r\n\r\n      ret = this.iconbutton(def.icon, label, cb);\r\n\r\n      ret.iconsheet = iconSheetFromPackFlag(packflag);\r\n      ret.packflag |= packflag;\r\n      ret.description = tooltip;\r\n    } else {\r\n      label = label === undefined ? def.uiname : label;\r\n\r\n      ret = this.button(label, cb);\r\n      ret.description = tooltip;\r\n      ret.packflag |= packflag;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  //supports number types\r\n  textbox(inpath, text, cb = undefined, packflag = 0) {\r\n    let path;\r\n\r\n    if (inpath) {\r\n      path = this._joinPrefix(inpath);\r\n    }\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let ret = UIBase.createElement(\"textbox-x\");\r\n\r\n    if (path !== undefined) {\r\n      ret.setAttribute(\"datapath\", path);\r\n    }\r\n\r\n    ret.ctx = this.ctx;\r\n    ret.parentWidget = this;\r\n    ret._init();\r\n    this._add(ret);\r\n\r\n    ret.setCSS();\r\n    ret.update();\r\n\r\n    ret.packflag |= packflag;\r\n    ret.onchange = cb;\r\n    ret.text = text;\r\n\r\n    return ret;\r\n  }\r\n\r\n  pathlabel(inpath, label = undefined, packflag = 0) {\r\n    let path;\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    if (inpath) {\r\n      path = this._joinPrefix(inpath);\r\n    }\r\n\r\n    let ret = UIBase.createElement(\"label-x\");\r\n\r\n    if (label === undefined && inpath) {\r\n      let rdef = this.ctx.api.resolvePath(this.ctx, path);\r\n      if (rdef) {\r\n        label = rdef.prop.uiname ?? rdef.dpath.apiname;\r\n      } else {\r\n        label = \"(error)\";\r\n      }\r\n    }\r\n\r\n    ret.text = label;\r\n    ret.packflag = packflag;\r\n    ret.setAttribute(\"datapath\", path);\r\n\r\n    this._add(ret);\r\n    ret.setCSS();\r\n\r\n    return ret;\r\n  }\r\n\r\n  label(text) {\r\n    let ret = UIBase.createElement(\"label-x\");\r\n    ret.text = text;\r\n\r\n    this._add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * makes a button for a help picker tool\r\n   * to view tooltips on mobile devices\r\n   * */\r\n  helppicker() {\r\n    let ret = this.iconbutton(ui_base.Icons.HELP, \"Help Picker\", () => {\r\n      this.getScreen().hintPickerTool();\r\n    })\r\n\r\n    if (util.isMobile()) {\r\n      //ret.iconsheet = 2;\r\n      //XXX look up in mobile theme properly\r\n    }\r\n\r\n    if (ret.ctx) {\r\n      ret._init();\r\n      ret.setCSS();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  iconbutton(icon, description, cb, thisvar, packflag = 0) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let ret = UIBase.createElement(\"iconbutton-x\")\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    ret.setAttribute(\"icon\", icon);\r\n    ret.description = description;\r\n    ret.icon = icon;\r\n\r\n    ret.iconsheet = iconSheetFromPackFlag(packflag);\r\n\r\n    ret.onclick = cb;\r\n\r\n    this._add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  button(label, cb, thisvar, id, packflag = 0) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let ret = UIBase.createElement(\"button-x\")\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    ret.setAttribute(\"name\", label);\r\n    ret.setAttribute(\"buttonid\", id); //XXX no longer used?\r\n    ret.onclick = cb;\r\n\r\n    this._add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  _joinPrefix(path, prefix = this.dataPrefix.trim()) {\r\n    if (path === undefined) {\r\n      return undefined;\r\n    }\r\n\r\n    path = path.trim();\r\n    if (path[0] === \"/\") {\r\n      return path;\r\n    }\r\n\r\n    if (prefix.length > 0 && path.length > 0 && !prefix.endsWith(\".\") && !path.startsWith(\".\")) {\r\n      path = \".\" + path;\r\n    }\r\n\r\n    return prefix + path;\r\n  }\r\n\r\n  colorbutton(inpath, packflag, mass_set_path = undefined) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    let ret = UIBase.createElement(\"color-picker-button-x\");\r\n\r\n    if (inpath !== undefined) {\r\n      inpath = this._joinPrefix(inpath);\r\n      ret.setAttribute(\"datapath\", inpath);\r\n    }\r\n\r\n    if (mass_set_path !== undefined) {\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n    }\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  noteframe(packflag = 0) {\r\n    let ret = UIBase.createElement(\"noteframe-x\");\r\n\r\n    ret.packflag |= (this.inherit_packflag & ~PackFlags.NO_UPDATE) | packflag;\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  curve1d(inpath, packflag = 0, mass_set_path = undefined) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    let ret = UIBase.createElement(\"curve-widget-x\");\r\n\r\n    ret.ctx = this.ctx;\r\n    ret.packflag |= packflag;\r\n\r\n    if (inpath) {\r\n      inpath = this._joinPrefix(inpath);\r\n      ret.setAttribute(\"datapath\", inpath);\r\n    }\r\n\r\n    if (mass_set_path)\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n\r\n    this.add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  vecpopup(inpath, packflag = 0, mass_set_path = undefined) {\r\n    let button = UIBase.createElement(\"vector-popup-button-x\");\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n    let name = \"vector\";\r\n\r\n    if (inpath) {\r\n      inpath = this._joinPrefix(inpath);\r\n\r\n      button.setAttribute(\"datapath\", inpath);\r\n      if (mass_set_path) {\r\n        button.setAttribute(\"mass_set_path\", mass_set_path);\r\n      }\r\n\r\n      let rdef = this.ctx.api.resolvePath(this.ctx, inpath);\r\n      if (rdef && rdef.prop) {\r\n        name = rdef.prop.uiname || rdef.prop.name;\r\n      }\r\n    }\r\n\r\n    button.setAttribute(\"name\", name);\r\n    button.packflag |= packflag;\r\n\r\n    this.add(button);\r\n    return button;\r\n  }\r\n\r\n  _getMassPath(ctx, inpath, mass_set_path) {\r\n    if (mass_set_path === undefined && this.massSetPrefix.length > 0) {\r\n      mass_set_path = ctx.api.getPropName(ctx, inpath);\r\n    }\r\n\r\n    if (mass_set_path === undefined) {\r\n      return undefined;\r\n    }\r\n\r\n    return this._joinPrefix(mass_set_path, this.massSetPrefix);\r\n  }\r\n\r\n  prop(inpath, packflag = 0, mass_set_path = undefined) {\r\n    if (!this.ctx) {\r\n      console.warn(this.id + \".ctx was undefined\");\r\n      let p = this.parentWidget;\r\n\r\n      while (p) {\r\n        if (p.ctx) {\r\n          console.warn(\"Fetched this.ctx from parent\");\r\n          this.ctx = p.ctx;\r\n          break;\r\n        }\r\n\r\n        p = p.parentWidget;\r\n      }\r\n\r\n      if (!this.ctx) {\r\n        throw new Error(\"ui.Container.prototype.prop(): this.ctx was undefined\");\r\n      }\r\n    }\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let rdef = this.ctx.api.resolvePath(this.ctx, this._joinPrefix(inpath), true);\r\n\r\n    if (rdef === undefined || rdef.prop === undefined) {\r\n      console.warn(\"Unknown property at path\", this._joinPrefix(inpath), this.ctx.api.resolvePath(this.ctx, this._joinPrefix(inpath), true));\r\n      return;\r\n    }\r\n    //slider(path, name, defaultval, min, max, step, is_int, do_redraw, callback, packflag=0) {\r\n    let prop = rdef.prop;\r\n\r\n    let useDataPathUndo = this.useDataPathUndo && !(prop.flag & PropFlags.NO_UNDO);\r\n\r\n    //console.log(prop, PropTypes, PropSubTypes);\r\n\r\n    function makeUIName(name) {\r\n      if (typeof name === \"number\" && isNaN(name)) {\r\n        console.warn(\"Subkey error in data api\", inpath);\r\n        return \"\" + name;\r\n      }\r\n\r\n      name = \"\" + name;\r\n      name = name[0].toUpperCase() + name.slice(1, name.length).toLowerCase();\r\n      name = name.replace(/_/g, \" \");\r\n      return name;\r\n    }\r\n\r\n    if (prop.type === PropTypes.REPORT) {\r\n      return this.pathlabel(inpath, prop.uiname);\r\n    } else if (prop.type === PropTypes.STRING) {\r\n      let ret;\r\n\r\n      if (prop.flag & PropFlags.READ_ONLY) {\r\n        ret = this.pathlabel(inpath, prop.uiname);\r\n      } else if (prop.multiLine) {\r\n        ret = this.textarea(inpath, rdef.value, packflag, mass_set_path);\r\n        ret.useDataPathUndo = useDataPathUndo;\r\n      } else {\r\n        let strip = this.strip();\r\n\r\n        let uiname = prop.uiname !== undefined ? prop.uiname : ToolProperty.makeUIName(prop.apiname);\r\n\r\n        strip.label(prop.uiname);\r\n\r\n        ret = strip.textbox(inpath);\r\n        ret.useDataPathUndo = useDataPathUndo;\r\n\r\n        if (mass_set_path) {\r\n          ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n        }\r\n      }\r\n\r\n      ret.packflag |= packflag;\r\n      return ret;\r\n    } else if (prop.type === PropTypes.CURVE) {\r\n      let ret = this.curve1d(inpath, packflag, mass_set_path);\r\n      ret.useDataPathUndo = useDataPathUndo;\r\n      return ret;\r\n    } else if (prop.type === PropTypes.INT || prop.type === PropTypes.FLOAT) {\r\n      let ret;\r\n      if (packflag & PackFlags.SIMPLE_NUMSLIDERS) {\r\n        ret = this.simpleslider(inpath, {packflag: packflag});\r\n      } else {\r\n        ret = this.slider(inpath, {packflag: packflag});\r\n      }\r\n\r\n      ret.useDataPathUndo = useDataPathUndo;\r\n      ret.packflag |= packflag;\r\n\r\n      if (mass_set_path) {\r\n        ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n      }\r\n\r\n      return ret;\r\n    } else if (prop.type === PropTypes.BOOL) {\r\n      let ret = this.check(inpath, prop.uiname, packflag, mass_set_path);\r\n      ret.useDataPathUndo = useDataPathUndo;\r\n      return ret;\r\n    } else if (prop.type === PropTypes.ENUM) {\r\n      if (rdef.subkey !== undefined) {\r\n        let subkey = rdef.subkey;\r\n        let name = rdef.prop.ui_value_names[rdef.subkey];\r\n\r\n        if (name === undefined) {\r\n          name = makeUIName(rdef.subkey);\r\n        }\r\n\r\n        let check = this.check(inpath, name, packflag, mass_set_path);\r\n        let tooltip = rdef.prop.descriptions[subkey];\r\n\r\n        check.useDataPathUndo = useDataPathUndo;\r\n\r\n        check.description = tooltip === undefined ? rdef.prop.ui_value_names[subkey] : tooltip;\r\n        check.icon = rdef.prop.iconmap[rdef.subkey];\r\n\r\n        return check;\r\n      }\r\n\r\n      if (!(packflag & PackFlags.USE_ICONS) && !(prop.flag & (PropFlags.USE_ICONS | PropFlags.FORCE_ENUM_CHECKBOXES))) {\r\n        return this.listenum(inpath, {packflag, mass_set_path}).setUndo(useDataPathUndo);\r\n      } else {\r\n        if (prop.flag & PropFlags.USE_ICONS) {\r\n          packflag |= PackFlags.USE_ICONS;\r\n        } else if (prop.flag & PropFlags.FORCE_ENUM_CHECKBOXES) {\r\n          packflag &= ~PackFlags.USE_ICONS;\r\n        }\r\n\r\n        if (packflag & PackFlags.FORCE_PROP_LABELS) {\r\n          let strip = this.strip();\r\n          strip.label(prop.uiname);\r\n\r\n          return strip.checkenum(inpath, undefined, packflag).setUndo(useDataPathUndo);\r\n        } else {\r\n          return this.checkenum(inpath, undefined, packflag).setUndo(useDataPathUndo);\r\n        }\r\n      }\r\n    } else if (prop.type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4)) {\r\n      if (rdef.subkey !== undefined) {\r\n        let ret;\r\n\r\n        if (packflag & PackFlags.SIMPLE_NUMSLIDERS)\r\n          ret = this.simpleslider(inpath, {packflag: packflag});\r\n        else\r\n          ret = this.slider(inpath, {packflag: packflag});\r\n\r\n        ret.packflag |= packflag;\r\n        return ret.setUndo(useDataPathUndo);\r\n      } else if (prop.subtype === PropSubTypes.COLOR) {\r\n        return this.colorbutton(inpath, packflag, mass_set_path).setUndo(useDataPathUndo);\r\n        //return this.colorPicker(inpath, packflag, mass_set_path);\r\n      } else {\r\n        let ret = UIBase.createElement(\"vector-panel-x\");\r\n\r\n        mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n        ret.packflag |= packflag | (this.inherit_packflag & ~PackFlags.NO_UPDATE);\r\n        ret.inherit_packflag |= packflag | (this.inherit_packflag & ~PackFlags.NO_UPDATE);\r\n\r\n        if (inpath) {\r\n          ret.setAttribute(\"datapath\", this._joinPrefix(inpath));\r\n        }\r\n\r\n        if (mass_set_path) {\r\n          ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n        }\r\n\r\n        this.add(ret);\r\n\r\n        return ret.setUndo(useDataPathUndo);\r\n      }\r\n    } else if (prop.type === PropTypes.FLAG) {\r\n      if (rdef.subkey !== undefined) {\r\n        let tooltip = rdef.prop.descriptions[rdef.subkey];\r\n        let name = rdef.prop.ui_value_names[rdef.subkey];\r\n\r\n        if (typeof rdef.subkey === \"number\") {\r\n          name = rdef.prop.keys[rdef.subkey];\r\n          if (name && name in rdef.prop.ui_value_names) {\r\n            name = rdef.prop.ui_value_names[name];\r\n          } else {\r\n            name = makeUIName(name ? name : \"(error)\");\r\n          }\r\n        }\r\n\r\n        if (name === undefined) {\r\n          name = \"(error)\";\r\n        }\r\n\r\n        let ret = this.check(inpath, name, packflag, mass_set_path);\r\n\r\n        ret.icon = rdef.prop.iconmap[rdef.subkey];\r\n\r\n        if (tooltip) {\r\n          ret.description = tooltip;\r\n        }\r\n\r\n        return ret.setUndo(useDataPathUndo);\r\n      } else {\r\n        let con = this;\r\n\r\n        if (packflag & PackFlags.FORCE_PROP_LABELS) {\r\n          con = this.strip();\r\n          con.label(prop.uiname);\r\n        }\r\n\r\n        if (packflag & PackFlags.PUT_FLAG_CHECKS_IN_COLUMNS) {\r\n          let i = 0;\r\n          let row = con.row();\r\n          let col1 = row.col();\r\n          let col2 = row.col();\r\n\r\n          for (let k in prop.values) {\r\n            let name = prop.ui_value_names[k];\r\n            let tooltip = prop.descriptions[k];\r\n\r\n            if (name === undefined) {\r\n              name = makeUIName(k);\r\n            }\r\n\r\n            let con2 = i & 1 ? col1 : col2;\r\n            let check = con2.check(`${inpath}[${k}]`, name, packflag, mass_set_path);\r\n\r\n            if (tooltip) {\r\n              check.description = tooltip;\r\n            }\r\n\r\n            check.setUndo(useDataPathUndo);\r\n\r\n            i++;\r\n          }\r\n\r\n          return row;\r\n        }\r\n\r\n        if (packflag & PackFlags.WRAP_CHECKBOXES) {\r\n          let isrow = this.style[\"flex-direction\"] === \"row\";\r\n          isrow = isrow || this.style[\"flex-direction\"] === \"row-reverse\";\r\n\r\n          let wrapChars;\r\n\r\n          let strip, con;\r\n\r\n          if (isrow) {\r\n            wrapChars = this.getDefault(\"checkRowWrapLimit\", undefined, 24);\r\n            strip = this.col().strip();\r\n            strip.packflag |= packflag;\r\n            strip.inherit_packflag |= packflag;\r\n\r\n            con = strip.row();\r\n          } else {\r\n            wrapChars = this.getDefault(\"checkColWrapLimit\", undefined, 5);\r\n            strip = this.row().strip();\r\n            strip.packflag |= packflag;\r\n            strip.inherit_packflag |= packflag;\r\n\r\n            con = strip.col();\r\n          }\r\n\r\n          let x = 0;\r\n          let y = 0;\r\n\r\n          for (let k in prop.values) {\r\n            let name = prop.ui_value_names[k];\r\n            let tooltip = prop.descriptions[k];\r\n\r\n            if (name === undefined) {\r\n              name = makeUIName(k);\r\n            }\r\n\r\n            let check = con.check(`${inpath}[${k}]`, name, packflag, mass_set_path);\r\n\r\n            if (tooltip) {\r\n              check.description = tooltip;\r\n            }\r\n\r\n            x += name.length;\r\n            y += 1;\r\n\r\n            if (isrow && x > wrapChars) {\r\n              x = 0;\r\n              con = strip.row();\r\n            } else if (!isrow && y > wrapChars) {\r\n              y = 0;\r\n              con = strip.col();\r\n            }\r\n          }\r\n\r\n          return strip;\r\n        }\r\n\r\n        if (con === this) {\r\n          con = this.strip();\r\n        }\r\n\r\n        let rebuild = () => {\r\n          con.clear();\r\n\r\n          for (let k in prop.values) {\r\n            let name = prop.ui_value_names[k];\r\n            let tooltip = prop.descriptions[k];\r\n\r\n            if (name === undefined) {\r\n              name = makeUIName(k);\r\n            }\r\n\r\n            let check = con.check(`${inpath}[${k}]`, name, packflag, mass_set_path);\r\n            check.useDataPathUndo = useDataPathUndo;\r\n\r\n            if (tooltip) {\r\n              check.description = tooltip;\r\n            }\r\n\r\n            check.setUndo(useDataPathUndo);\r\n          }\r\n        }\r\n\r\n        rebuild();\r\n        let last_hash = prop.calcHash();\r\n\r\n        con.update.after(() => {\r\n          let hash = prop.calcHash();\r\n\r\n          if (last_hash !== hash) {\r\n            last_hash = hash;\r\n            console.error(\"Property definition update\");\r\n            rebuild();\r\n          }\r\n        });\r\n\r\n        return con;\r\n      }\r\n    }\r\n  }\r\n\r\n  iconcheck(inpath, icon, name, mass_set_path) {\r\n    let ret = UIBase.createElement(\"iconcheck-x\");\r\n    ret.icon = icon;\r\n    ret.description = name;\r\n\r\n    if (inpath) {\r\n      ret.setAttribute(\"datapath\", inpath);\r\n    }\r\n\r\n    if (mass_set_path) {\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n    }\r\n\r\n    this.add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  check(inpath, name, packflag = 0, mass_set_path = undefined) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let path = inpath !== undefined ? this._joinPrefix(inpath) : undefined;\r\n\r\n    //let prop = this.ctx.getProp(path);\r\n    let ret;\r\n    if (packflag & PackFlags.USE_ICONS) {\r\n      ret = UIBase.createElement(\"iconcheck-x\");\r\n\r\n      ret.iconsheet = iconSheetFromPackFlag(packflag);\r\n    } else {\r\n      ret = UIBase.createElement(\"check-x\");\r\n    }\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    ret.packflag |= packflag;\r\n    ret.label = name;\r\n    ret.noMarginsOrPadding();\r\n\r\n    if (inpath) {\r\n      ret.setAttribute(\"datapath\", path);\r\n    }\r\n\r\n    if (mass_set_path) {\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n    }\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  /*\r\n  *\r\n  * new (optional) form: checkenum(inpath, args)\r\n  * */\r\n  checkenum(inpath, name, packflag, enummap, defaultval, callback, iconmap, mass_set_path) {\r\n    if (typeof name === \"object\" && name !== null) {\r\n      let args = name;\r\n\r\n      name = args.name;\r\n      packflag = args.packflag;\r\n      enummap = args.enummap;\r\n      defaultval = args.defaultval;\r\n      callback = args.callback;\r\n      iconmap = args.iconmap;\r\n      mass_set_path = args.mass_set_path;\r\n    }\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    packflag = packflag === undefined ? 0 : packflag;\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let path = this._joinPrefix(inpath);\r\n\r\n    let has_path = path !== undefined;\r\n    let prop;\r\n    let frame;\r\n\r\n    if (path !== undefined) {\r\n      prop = this.ctx.api.resolvePath(this.ctx, path, true);\r\n\r\n      if (prop !== undefined)\r\n        prop = prop.prop;\r\n    }\r\n\r\n    if (path !== undefined) {\r\n      if (prop === undefined) {\r\n        console.warn(\"Bad path in checkenum\", path);\r\n        return;\r\n      }\r\n\r\n      frame = this.strip();\r\n      frame.oneAxisPadding();\r\n\r\n      if (packflag & PackFlags.USE_ICONS) {\r\n        for (let key in prop.values) {\r\n          let check = frame.check(inpath + \"[\" + key + \"]\", \"\", packflag);\r\n\r\n          check.packflag |= PackFlags.HIDE_CHECK_MARKS;\r\n\r\n          check.icon = prop.iconmap[key];\r\n          check.drawCheck = false;\r\n\r\n          check.style[\"padding\"] = \"0px\";\r\n          check.style[\"margin\"] = \"0px\";\r\n\r\n          check.dom.style[\"padding\"] = \"0px\";\r\n          check.dom.style[\"margin\"] = \"0px\";\r\n\r\n          check.description = prop.descriptions[key];\r\n          //console.log(check.description, key, prop.keys[key], prop.descriptions, prop.keys);\r\n        }\r\n      } else {\r\n        if (name === undefined) {\r\n          name = prop.uiname;\r\n        }\r\n\r\n        frame.label(name).font = \"TitleText\";\r\n\r\n        let checks = {};\r\n\r\n        let ignorecb = false;\r\n\r\n        function makecb(key) {\r\n          return () => {\r\n            if (ignorecb) return;\r\n\r\n            ignorecb = true;\r\n            for (let k in checks) {\r\n              if (k !== key) {\r\n                checks[k].checked = false;\r\n              }\r\n            }\r\n            ignorecb = false;\r\n\r\n            if (callback) {\r\n              callback(key);\r\n            }\r\n          }\r\n        }\r\n\r\n        for (let key in prop.values) {\r\n          let check = frame.check(`${inpath}[${key}]`, prop.ui_value_names[key]);\r\n          checks[key] = check;\r\n\r\n          if (mass_set_path) {\r\n            check.setAttribute(\"mass_set_path\", mass_set_path);\r\n          }\r\n\r\n\r\n          check.description = prop.descriptions[prop.keys[key]];\r\n          if (!check.description) {\r\n            check.description = \"\" + prop.ui_value_names[key];\r\n          }\r\n          check.onchange = makecb(key);\r\n        }\r\n      }\r\n    }\r\n\r\n    return frame;\r\n  }\r\n\r\n  checkenum_panel(inpath, name, packflag = 0, callback = undefined, mass_set_path = undefined, prop = undefined) {\r\n    packflag = packflag === undefined ? 0 : packflag;\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let path = this._joinPrefix(inpath);\r\n    let frame;\r\n\r\n    let has_path = path !== undefined;\r\n\r\n    if (path !== undefined && prop === undefined) {\r\n      prop = this.ctx.api.resolvePath(this.ctx, path, true);\r\n\r\n      if (prop !== undefined)\r\n        prop = prop.prop;\r\n    }\r\n\r\n    if (!name && prop) {\r\n      name = prop.uiname;\r\n    }\r\n\r\n    if (path !== undefined) {\r\n      if (prop === undefined) {\r\n        console.warn(\"Bad path in checkenum\", path);\r\n        return;\r\n      }\r\n\r\n      frame = this.panel(name, name, packflag);\r\n\r\n      frame.oneAxisPadding();\r\n      frame.setCSS.after(frame.background = this.getDefault(\"BoxSub2BG\"));\r\n\r\n      if (packflag & PackFlags.USE_ICONS) {\r\n        for (let key in prop.values) {\r\n          let check = frame.check(inpath + \" == \" + prop.values[key], \"\", packflag);\r\n\r\n          check.icon = prop.iconmap[key];\r\n          check.drawCheck = false;\r\n\r\n          check.style[\"padding\"] = \"0px\";\r\n          check.style[\"margin\"] = \"0px\";\r\n\r\n          check.dom.style[\"padding\"] = \"0px\";\r\n          check.dom.style[\"margin\"] = \"0px\";\r\n\r\n          check.description = prop.descriptions[key];\r\n          //console.log(check.description, key, prop.keys[key], prop.descriptions, prop.keys);\r\n        }\r\n      } else {\r\n        if (name === undefined) {\r\n          name = prop.uiname;\r\n        }\r\n\r\n        frame.label(name).font = \"TitleText\";\r\n\r\n        let checks = {};\r\n\r\n        let ignorecb = false;\r\n\r\n        function makecb(key) {\r\n          return () => {\r\n            if (ignorecb) return;\r\n\r\n            ignorecb = true;\r\n            for (let k in checks) {\r\n              if (k !== key) {\r\n                checks[k].checked = false;\r\n              }\r\n            }\r\n            ignorecb = false;\r\n\r\n            if (callback) {\r\n              callback(key);\r\n            }\r\n          }\r\n        }\r\n\r\n        for (let key in prop.values) {\r\n          let check = frame.check(inpath + \" = \" + prop.values[key], prop.ui_value_names[key]);\r\n          checks[key] = check;\r\n\r\n          if (mass_set_path) {\r\n            check.setAttribute(\"mass_set_path\", mass_set_path);\r\n          }\r\n\r\n\r\n          check.description = prop.descriptions[prop.keys[key]];\r\n          if (!check.description) {\r\n            check.description = \"\" + prop.ui_value_names[key];\r\n          }\r\n          check.onchange = makecb(key);\r\n          //console.log(\"PATH\", path);\r\n        }\r\n      }\r\n    }\r\n\r\n    return frame;\r\n  }\r\n\r\n  /*\r\n    enummap is an object that maps\r\n    ui names to keys, e.g.:\r\n\r\n    ui.listenum(\"color\", \"Color\", {\r\n      RED   : 0,\r\n      GREEN : 1,\r\n      BLUE  : 2\r\n    });\r\n\r\n    path can be undefined, in which case, use callback,\r\n    which gets the current enum as an argument\r\n\r\n    defaultval cannot be undefined\r\n  */\r\n  listenum(inpath, name, enumDef, defaultval, callback, iconmap, packflag = 0) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n    let mass_set_path;\r\n\r\n    if (name && typeof name === \"object\") {\r\n      let args = name;\r\n\r\n      name = args.name;\r\n      enumDef = args.enumDef;\r\n      defaultval = args.defaultval;\r\n      callback = args.callback;\r\n      iconmap = args.iconmap;\r\n      packflag = args.packflag || 0;\r\n      mass_set_path = args.mass_set_path;\r\n    }\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    let path;\r\n    let label = name;\r\n\r\n    if (inpath !== undefined) {\r\n      path = this._joinPrefix(inpath);\r\n    }\r\n\r\n    let ret = UIBase.createElement(\"dropbox-x\")\r\n\r\n    if (enumDef !== undefined) {\r\n      if (enumDef instanceof toolprop.EnumProperty) {\r\n        ret.prop = enumDef;\r\n        label ||= enumDef.uiname || toolprop.ToolProperty.makeUIName(enumDef.apiname);\r\n      } else {\r\n        ret.prop = new toolprop.EnumProperty(defaultval, enumDef, path, name);\r\n      }\r\n\r\n      if (iconmap !== undefined) {\r\n        ret.prop.addIcons(iconmap)\r\n      }\r\n    } else {\r\n      let res = this.ctx.api.resolvePath(this.ctx, path, true);\r\n\r\n      if (res !== undefined) {\r\n        ret.prop = res.prop;\r\n\r\n        name ||= res.prop.uiname;\r\n        label ||= name;\r\n      }\r\n    }\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n    if (path !== undefined) {\r\n      ret.setAttribute(\"datapath\", path);\r\n    }\r\n    if (mass_set_path !== undefined) {\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n    }\r\n\r\n    ret.setAttribute(\"name\", name);\r\n\r\n    if (defaultval) {\r\n      ret.setValue(defaultval);\r\n    }\r\n\r\n    ret.onchange = callback;\r\n    ret.onselect = callback;\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    if (label && packflag & PackFlags.FORCE_PROP_LABELS) {\r\n      const container = this.row();\r\n      let l;\r\n\r\n      if (packflag & PackFlags.LABEL_ON_RIGHT) {\r\n        container._add(ret);\r\n        l = container.label(label);\r\n\r\n        if (!l.style[\"margin-left\"] || l.style[\"margin-left\"] === \"unset\") {\r\n          l.style[\"margin-left\"] = \"5px\";\r\n        }\r\n      } else {\r\n        l = container.label(label);\r\n        container._add(ret);\r\n      }\r\n    } else {\r\n      this._add(ret);\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  getroot() {\r\n    let p = this;\r\n\r\n    while (p.parent !== undefined) {\r\n      p = p.parent;\r\n    }\r\n\r\n    return p;\r\n  }\r\n\r\n  simpleslider(inpath, name, defaultval, min, max, step, is_int, do_redraw, callback, packflag = 0) {\r\n    if (arguments.length === 2 || typeof name === \"object\") {\r\n      let args = Object.assign({}, name);\r\n\r\n      args.packflag = (args.packflag || 0) | PackFlags.SIMPLE_NUMSLIDERS;\r\n      return this.slider(inpath, args);\r\n      //new-style api call\r\n    } else {\r\n      return this.slider(inpath, name, defaultval, min, max, step, is_int, do_redraw, callback, packflag | PackFlags.SIMPLE_NUMSLIDERS);\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * usage: .slider(inpath, {\r\n   *  name : bleh,\r\n   *  defaultval : number,\r\n   *  etc...\r\n   * });\r\n   * */\r\n  slider(inpath, name, defaultval, min, max, step, is_int, do_redraw, callback, packflag = 0) {\r\n    if (arguments.length === 2 || typeof name === \"object\") {\r\n      //new-style api call\r\n\r\n      let args = name;\r\n\r\n      name = args.name;\r\n      defaultval = args.defaultval;\r\n      min = args.min;\r\n      max = args.max;\r\n      step = args.step;\r\n      is_int = args.is_int || args.isInt;\r\n      do_redraw = args.do_redraw;\r\n      callback = args.callback;\r\n      packflag = args.packflag || 0;\r\n    }\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n    let ret;\r\n\r\n    if (inpath) {\r\n      inpath = this._joinPrefix(inpath);\r\n\r\n      let rdef = this.ctx.api.resolvePath(this.ctx, inpath, true);\r\n      if (rdef && rdef.prop && (rdef.prop.flag & PropFlags.SIMPLE_SLIDER)) {\r\n        packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n      }\r\n      if (rdef && rdef.prop && (rdef.prop.flag & PropFlags.FORCE_ROLLER_SLIDER)) {\r\n        packflag |= PackFlags.FORCE_ROLLER_SLIDER;\r\n      }\r\n    }\r\n\r\n    let simple = (packflag & PackFlags.SIMPLE_NUMSLIDERS) || cconst.simpleNumSliders;\r\n    simple = simple && !(packflag & PackFlags.FORCE_ROLLER_SLIDER);\r\n\r\n    let extraTextBox = cconst.useNumSliderTextboxes && !(packflag & PackFlags.NO_NUMSLIDER_TEXTBOX);\r\n\r\n    if (extraTextBox) {\r\n      if (simple) {\r\n        ret = UIBase.createElement(\"numslider-simple-x\");\r\n      } else {\r\n        ret = UIBase.createElement(\"numslider-textbox-x\");\r\n      }\r\n    } else {\r\n      if (simple) {\r\n        ret = UIBase.createElement(\"numslider-simple-x\");\r\n      } else {\r\n        ret = UIBase.createElement(\"numslider-x\");\r\n      }\r\n    }\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    let decimals;\r\n\r\n    if (inpath) {\r\n      ret.setAttribute(\"datapath\", inpath);\r\n    }\r\n\r\n    if (name) {\r\n      ret.setAttribute(\"name\", name);\r\n    }\r\n\r\n    if (min !== undefined) {\r\n      ret.setAttribute(\"min\", min);\r\n    }\r\n    if (max !== undefined) {\r\n      ret.setAttribute(\"max\", max);\r\n    }\r\n\r\n    if (defaultval !== undefined) {\r\n      ret.setValue(defaultval);\r\n    }\r\n\r\n    if (is_int) {\r\n      ret.setAttribute(\"integer\", is_int);\r\n    }\r\n\r\n    if (decimals !== undefined) {\r\n      ret.decimalPlaces = decimals;\r\n    }\r\n\r\n    if (callback) {\r\n      ret.onchange = callback;\r\n    }\r\n\r\n    this._add(ret);\r\n\r\n    if (this.ctx) {\r\n      ret.setCSS();\r\n      ret.update();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  _container_inherit(elem, packflag = 0) {\r\n    //don't inherit NO_UPDATE\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    elem.packflag |= packflag;\r\n    elem.inherit_packflag |= packflag;\r\n    elem.dataPrefix = this.dataPrefix;\r\n    elem.massSetPrefix = this.massSetPrefix;\r\n  }\r\n\r\n  treeview() {\r\n    let ret = UIBase.createElement(\"tree-view-x\");\r\n    ret.ctx = this.ctx;\r\n    this.add(ret);\r\n\r\n    this._container_inherit(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  panel(name, id, packflag = 0, tooltip = undefined) {\r\n    id = id === undefined ? name : id;\r\n\r\n    let ret = UIBase.createElement(\"panelframe-x\");\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    if (tooltip) {\r\n      ret.setHeaderToolTip(tooltip);\r\n    }\r\n\r\n    ret.setAttribute(\"label\", name);\r\n    ret.setAttribute(\"id\", id);\r\n\r\n    this._add(ret);\r\n\r\n\r\n    if (this.ctx) {//check init was called\r\n      ret.ctx = this.ctx;\r\n      ret._init();\r\n      //ret.headerLabel = name;\r\n\r\n      ret.contents.ctx = ret.ctx;\r\n    }\r\n\r\n    ret.contents.dataPrefix = this.dataPrefix;\r\n    ret.contents.massSetPrefix = this.massSetPrefix;\r\n\r\n    return ret;\r\n  }\r\n\r\n  row(packflag = 0) {\r\n    let ret = UIBase.createElement(\"rowframe-x\");\r\n\r\n    this._container_inherit(ret, packflag);\r\n    this._add(ret);\r\n\r\n    ret.ctx = this.ctx;\r\n\r\n    return ret;\r\n  }\r\n\r\n  listbox(packflag = 0) {\r\n    let ret = UIBase.createElement(\"listbox-x\");\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  table(packflag = 0) {\r\n    let ret = UIBase.createElement(\"tableframe-x\");\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  twocol(parentDepth = 1, packflag = 0) {\r\n    let ret = UIBase.createElement(\"two-column-x\");\r\n\r\n    ret.parentDepth = parentDepth;\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  col(packflag = 0) {\r\n    let ret = UIBase.createElement(\"colframe-x\");\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  colorPicker(inpath, packflag_or_args = 0, mass_set_path = undefined, themeOverride = undefined) {\r\n    let packflag;\r\n\r\n    if (typeof packflag_or_args === \"object\") {\r\n      let args = packflag_or_args;\r\n\r\n      packflag = args.packflag !== undefined ? args.packflag : 0;\r\n      mass_set_path = args.massSetPath;\r\n      themeOverride = args.themeOverride;\r\n    }\r\n\r\n    let path;\r\n\r\n    if (inpath) {\r\n      path = this._joinPrefix(inpath);\r\n    }\r\n\r\n    let ret = UIBase.createElement(\"colorpicker-x\");\r\n\r\n    if (themeOverride) {\r\n      ret.overrideClass(themeOverride);\r\n    }\r\n\r\n    packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    ret.ctx = this.ctx;\r\n    ret.parentWidget = this;\r\n    ret._init();\r\n    ret.packflag |= packflag;\r\n    ret.inherit_packflag |= packflag;\r\n    ret.constructor.setDefault(ret);\r\n\r\n    if (path !== undefined) {\r\n      ret.setAttribute(\"datapath\", path);\r\n    }\r\n\r\n    console.warn(\"mass_set_path\", mass_set_path);\r\n    if (mass_set_path) {\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n    }\r\n\r\n    //XXX\r\n    window.colorpicker = ret;\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  textarea(datapath = undefined, value = \"\", packflag = 0, mass_set_path = undefined) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, datapath, mass_set_path);\r\n\r\n    let ret = UIBase.createElement(\"rich-text-editor-x\");\r\n    ret.ctx = this.ctx;\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    if (value !== undefined) {\r\n      ret.value = value;\r\n    }\r\n\r\n    if (datapath)\r\n      ret.setAttribute(\"datapath\", datapath)\r\n    if (mass_set_path)\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path)\r\n\r\n    this.add(ret);\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   * html5 viewer\r\n   * */\r\n  viewer(datapath = undefined, value = \"\", packflag = 0, mass_set_path = undefined) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, datapath, mass_set_path);\r\n\r\n    let ret = UIBase.createElement(\"html-viewer-x\");\r\n    ret.ctx = this.ctx;\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    if (value !== undefined) {\r\n      ret.value = value;\r\n    }\r\n\r\n    if (datapath)\r\n      ret.setAttribute(\"datapath\", datapath)\r\n    if (mass_set_path)\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path)\r\n\r\n    this.add(ret);\r\n    return ret;\r\n  }\r\n\r\n  //\r\n  tabs(position = \"top\", packflag = 0) {\r\n\r\n    let ret = UIBase.createElement(\"tabcontainer-x\");\r\n\r\n    ret.constructor.setDefault(ret);\r\n    ret.setAttribute(\"bar_pos\", position);\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  asDialogFooter() {\r\n    this.style['margin-top'] = '15px';\r\n    this.style['justify-content'] = 'flex-end';\r\n\r\n    return this;\r\n  }\r\n\r\n};\r\n\r\nui_base.UIBase.internalRegister(Container, \"div\");\r\n\r\n\r\nexport class RowFrame extends Container {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: 'rowframe-x'\r\n    };\r\n  }\r\n\r\n  //try to set styling as early as possible\r\n  connectedCallback() {\r\n    super.connectedCallback();\r\n\r\n    this.style['display'] = 'flex';\r\n    this.style['flex-direction'] = this.reversed ? 'row-reverse' : 'row';\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style['display'] = 'flex';\r\n    this.style['flex-direction'] = this.reversed ? 'row-reverse' : 'row';\r\n\r\n    if (!this.style['align-items'] || this.style['align-items'] == '') {\r\n      this.style['align-items'] = 'center';\r\n    }\r\n\r\n    if (this.getDefault(\"slider-style\") === \"simple\") {\r\n      this.packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n      this.inherit_packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n    }\r\n  }\r\n\r\n  oneAxisMargin(m = this.getDefault('oneAxisMargin'), m2 = 0) {\r\n    this.style['margin-left'] = this.style['margin-right'] = m + 'px';\r\n    this.style['margin-top'] = this.style['margin-bottom'] = '' + m2 + 'px';\r\n\r\n    return this;\r\n  }\r\n\r\n  oneAxisPadding(m = this.getDefault('oneAxisPadding'), m2 = 0) {\r\n    this.style['padding-left'] = this.style['padding-right'] = '' + m + 'px';\r\n    this.style['padding-top'] = this.style['padding-bottom'] = '' + m2 + 'px';\r\n\r\n    return this;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(RowFrame);\r\n\r\nexport class ColumnFrame extends Container {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"colframe-x\"\r\n    };\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-direction\"] = \"column\";\r\n    this.style[\"justify-content\"] = \"right\";\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  oneAxisMargin(m = this.getDefault('oneAxisMargin'), m2 = 0) {\r\n    this.style['margin-top'] = this.style['margin-bottom'] = '' + m + 'px';\r\n    this.style['margin-left'] = this.style['margin-right'] = m2 + 'px';\r\n\r\n    return this;\r\n  }\r\n\r\n  oneAxisPadding(m = this.getDefault('oneAxisPadding'), m2 = 0) {\r\n    this.style['padding-top'] = this.style['padding-bottom'] = '' + m + 'px';\r\n    this.style['padding-left'] = this.style['padding-right'] = '' + m2 + 'px';\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ColumnFrame);\r\n\r\n\r\nexport class TwoColumnFrame extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this._colWidth = 256;\r\n    this.parentDepth = 1;\r\n  }\r\n\r\n  get colWidth() {\r\n    if (this.hasAttribute(\"colWidth\")) {\r\n      return parsepx(this.getAttribute(\"colWidth\"));\r\n    }\r\n\r\n    return this._colWidth;\r\n  }\r\n\r\n  set colWidth(v) {\r\n    if (this.hasAttribute(\"colWidth\")) {\r\n      this.setAttribute(\"colWidth\", \"\" + v);\r\n    } else {\r\n      this._colWidth = v;\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"two-column-x\"\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-direction\"] = \"column\";\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    let p = this;\r\n\r\n    for (let i = 0; i < this.parentDepth; i++) {\r\n      p = p.parentWidget ? p.parentWidget : p;\r\n    }\r\n\r\n    if (!p) {\r\n      return;\r\n    }\r\n\r\n    let r = p.getBoundingClientRect();\r\n\r\n    if (!r) {\r\n      return;\r\n    }\r\n\r\n    let style = r.width > this.colWidth*2.0 ? 'row' : 'column';\r\n\r\n    if (this.style[\"flex-direction\"] !== style) {\r\n      this.style[\"flex-direction\"] = style;\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(TwoColumnFrame);\r\n","import * as util from '../path-controller/util/util.js';\r\nimport * as ui from '../core/ui.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport {Icons, css2color, color2css} from '../core/ui_base.js';\r\n\r\nlet UIBase = ui_base.UIBase;\r\n\r\nexport class Note extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    let style = document.createElement(\"style\");\r\n\r\n    this._noteid = undefined;\r\n    this.height = 20;\r\n\r\n    this.showExclMark = true;\r\n\r\n    style.textContent = `\r\n    .notex {\r\n      display : flex;\r\n      flex-direction : row;\r\n      flex-wrap : nowrap;\r\n      height : {this.height}px;\r\n      padding : 0px;\r\n      margin : 0px;\r\n    }\r\n    `;\r\n\r\n    this.dom = document.createElement(\"div\");\r\n    this.dom.setAttribute(\"class\", \"notex\");\r\n    this.color = \"red\";\r\n\r\n    this.shadow.appendChild(style);\r\n    this.shadow.append(this.dom);\r\n    this.setLabel(\"\");\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"note-x\",\r\n      style  : 'notification',\r\n    }\r\n  }\r\n\r\n  setLabel(s) {\r\n    let color = this.color;\r\n    if (this.showExclMark && this.mark === undefined) {\r\n      this.mark = document.createElement(\"div\");\r\n      this.mark.style[\"display\"] = \"flex\";\r\n      this.mark.style[\"flex-direction\"] = \"row\";\r\n      this.mark.style[\"flex-wrap\"] = \"nowrap\";\r\n\r\n      //this.mark.style[\"width\"]\r\n      let sheet = 0;\r\n\r\n      let size = ui_base.iconmanager.getTileSize(sheet);\r\n\r\n      this.mark.style[\"width\"] = \"\" + size + \"px\";\r\n      this.mark.style[\"height\"] = \"\" + size + \"px\";\r\n\r\n      this.dom.appendChild(this.mark);\r\n\r\n      this.ntext = document.createElement(\"div\");\r\n      this.ntext.style[\"display\"] = \"inline-flex\";\r\n      this.ntext.style[\"flex-wrap\"] = \"nowrap\";\r\n\r\n      this.dom.appendChild(this.ntext);\r\n\r\n      ui_base.iconmanager.setCSS(Icons.NOTE_EXCL, this.mark, sheet);\r\n\r\n      //this.mark.style[\"margin\"] = this.ntext.style[\"margin\"] = \"0px\"\r\n      //this.mark.style[\"padding\"] = this.ntext.style[\"padding\"] = \"0px\"\r\n      //this.mark.style[\"background-color\"] = color;\r\n    } else if (!this.showExclMark && this.mark) {\r\n      this.mark.remove();\r\n      this.mark = undefined;\r\n    }\r\n\r\n    let ntext = this.ntext;\r\n    //mark.innerText = \"!\";\r\n    ntext.innerText = \" \" + s;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.setAttribute(\"class\", \"notex\");\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-wrap\"] = \"nowrap\";\r\n    this.style[\"flex-direction\"] = \"row\";\r\n    this.style[\"border-radius\"] = \"7px\";\r\n    this.style[\"padding\"] = \"2px\";\r\n\r\n    this.style[\"color\"] = this.getDefault(\"DefaultText\").color;\r\n    let clr = css2color(this.color);\r\n    clr = color2css([clr[0], clr[1], clr[2], 0.25]);\r\n\r\n    this.style[\"background-color\"] = clr;\r\n    this.setCSS();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS(false);\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(Note);\r\n\r\nexport class ProgBarNote extends Note {\r\n  constructor() {\r\n    super();\r\n\r\n    this._percent = 0.0;\r\n    this.barWidth = 100;\r\n\r\n    let bar = this.bar = document.createElement(\"div\");\r\n    bar.style[\"display\"] = \"flex\";\r\n    bar.style[\"flex-direction\"] = \"row\";\r\n    bar.style[\"width\"] = this.barWidth + \"px\";\r\n    bar.style[\"height\"] = this.height + \"px\";\r\n    bar.style[\"background-color\"] = this.getDefault(\"ProgressBarBG\");\r\n    bar.style[\"border-radius\"] = \"12px\";\r\n    bar.style[\"align-items\"] = \"center\";\r\n    bar.style[\"padding\"] = bar.style[\"margin\"] = \"0px\";\r\n\r\n    let bar2 = this.bar2 = document.createElement(\"div\");\r\n    let w = 50.0;\r\n\r\n    bar2.style[\"display\"] = \"flex\";\r\n    bar2.style[\"flex-direction\"] = \"row\";\r\n    bar2.style[\"height\"] = this.height + \"px\";\r\n    bar2.style[\"background-color\"] = this.getDefault(\"ProgressBar\");\r\n    bar2.style[\"border-radius\"] = \"12px\";\r\n    bar2.style[\"align-items\"] = \"center\";\r\n    bar2.style[\"padding\"] = bar2.style[\"margin\"] = \"0px\";\r\n\r\n    this.bar.appendChild(bar2);\r\n    this.dom.appendChild(this.bar);\r\n  }\r\n\r\n  get percent() {\r\n    return this._percent;\r\n  }\r\n\r\n  set percent(val) {\r\n    this._percent = val;\r\n    this.setCSS();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"note-progress-x\",\r\n      style  : 'notification',\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    let w = ~~(this.percent*this.barWidth + 0.5);\r\n\r\n    this.bar2.style[\"width\"] = w + \"px\";\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ProgBarNote);\r\n\r\nexport class NoteFrame extends ui.RowFrame {\r\n  constructor() {\r\n    super();\r\n    this._h = 20;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"noteframe-x\",\r\n      style  : 'noteframe',\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.noMarginsOrPadding();\r\n\r\n    noteframes.push(this);\r\n    this.background = this.getDefault(\"background-color\");\r\n    this.style['flex-grow'] = 'unset';\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.style[\"width\"] = \"min-contents\";\r\n    this.style[\"height\"] = this._h + \"px\";\r\n  }\r\n\r\n  _ondestroy() {\r\n    if (noteframes.indexOf(this) >= 0) {\r\n      noteframes.remove(this)\r\n    }\r\n\r\n    super._ondestroy();\r\n  }\r\n\r\n  progbarNote(msg, percent, color = \"rgba(255,0,0,0.2)\", timeout = 700, id = msg) {\r\n    let note;\r\n\r\n    for (let child of this.children) {\r\n      if (child._noteid === id) {\r\n        note = child;\r\n        break;\r\n      }\r\n    }\r\n\r\n    let f = (100.0*Math.min(percent, 1.0)).toFixed(1);\r\n\r\n    if (note === undefined) {\r\n      note = this.addNote(msg, color, -1, \"note-progress-x\");\r\n      note._noteid = id;\r\n    }\r\n\r\n    //note.setLabel(msg + \" \" + f + \"%\");\r\n    note.percent = percent;\r\n\r\n    if (percent >= 1.0) {\r\n      //note.setLabel(msg + \" \" + f + \"%\");\r\n\r\n      window.setTimeout(() => {\r\n        note.remove();\r\n      }, timeout);\r\n    }\r\n\r\n    return note;\r\n  }\r\n\r\n  addNote(msg, color = \"rgba(255,0,0,0.2)\", timeout = 1200, tagname = \"note-x\", showExclMark=true) {\r\n    //let note = UIBase.createElement(\"note-x\");\r\n\r\n    //note.ctx = this.ctx;\r\n    //note.background = \"red\";\r\n    //note.dom.innerText = msg;\r\n\r\n    //this._add(note);\r\n\r\n    let note = UIBase.createElement(tagname);\r\n\r\n    note.color = color;\r\n    note.setLabel(msg);\r\n\r\n    note.style[\"text-align\"] = \"center\";\r\n\r\n    note.style[\"font\"] = ui_base.getFont(note, \"DefaultText\");\r\n    note.style[\"color\"] = this.getDefault(\"DefaultText\").color;\r\n    note.showExclMark = showExclMark;\r\n\r\n    this.add(note);\r\n\r\n    this.noMarginsOrPadding();\r\n    note.noMarginsOrPadding();\r\n\r\n    //this.dom.style[\"position\"] = UIBase.PositionKey;\r\n    //this.style[\"position\"] = UIBase.PositionKey;\r\n    //note.style[\"position\"] = UIBase.PositionKey;\r\n\r\n    note.style[\"height\"] = this._h + \"px\";\r\n    note.height = this._h;\r\n\r\n    if (timeout !== -1) {\r\n      window.setTimeout(() => {\r\n        //console.log(\"remove!\");\r\n        note.remove();\r\n      }, timeout);\r\n    }\r\n\r\n    //this.appendChild(note);\r\n    return note;\r\n\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(NoteFrame);\r\n\r\nexport function getNoteFrames(screen) {\r\n  let ret = [];\r\n\r\n  let rec = (n) => {\r\n\r\n    if (n instanceof NoteFrame) {\r\n      ret.push(n);\r\n    }\r\n\r\n    if (n.childNodes !== undefined) {\r\n      for (let node of n.childNodes) {\r\n        rec(node);\r\n      }\r\n    }\r\n\r\n    if (n instanceof ui_base.UIBase && n.shadow !== undefined && n.shadow.childNodes) {\r\n      for (let node of n.shadow.childNodes) {\r\n        rec(node);\r\n      }\r\n    }\r\n  }\r\n\r\n  rec(screen);\r\n  return ret;\r\n}\r\n\r\nexport let noteframes = [];\r\n\r\nexport function sendNote(screen, msg, color, timeout = 3000, showExclMark=true) {\r\n  noteframes = getNoteFrames(screen);\r\n\r\n  for (let frame of noteframes) {\r\n    try {\r\n      frame.addNote(msg, color, timeout, undefined, showExclMark);\r\n    } catch (error) {\r\n      print_stack(error);\r\n      console.log(error.stack, error.message);\r\n      console.log(\"bad notification frame\");\r\n    }\r\n  }\r\n}\r\n\r\nwindow._sendNote = sendNote;\r\n\r\nexport function error(screen, msg, timeout) {\r\n  return sendNote(screen, msg, ui_base.color2css([1.0, 0.0, 0.0, 1.0]), timeout);\r\n}\r\n\r\nexport function warning(screen, msg, timeout) {\r\n  return sendNote(screen, msg, ui_base.color2css([0.78, 0.78, 0.2, 1.0]), timeout);\r\n}\r\n\r\nexport function message(screen, msg, timeout) {\r\n  return sendNote(screen, msg, ui_base.color2css([0.2, 0.9, 0.1, 1.0]), timeout, false);\r\n}\r\n\r\n\r\nexport function progbarNote(screen, msg, percent, color, timeout) {\r\n  noteframes = getNoteFrames(screen);\r\n\r\n  for (let frame of noteframes) {\r\n    try {\r\n      frame.progbarNote(msg, percent, color, timeout);\r\n    } catch (error) {\r\n      print_stack(error);\r\n      console.log(error.stack, error.message);\r\n      console.log(\"bad notification frame\");\r\n    }\r\n  }\r\n}\r\n","import * as ui_base from '../core/ui_base.js'\r\nimport * as util from '../path-controller/util/util.js';\r\nimport {ColumnFrame, RowFrame, Container} from \"../core/ui.js\";\r\nlet UIBase = ui_base.UIBase, Icons = ui_base.Icons;\r\nimport {TextBoxBase} from './ui_textbox.js';\r\nimport {keymap} from \"../path-controller/util/simple_events.js\";\r\n\r\nexport class RichEditor extends TextBoxBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._internalDisabled = false;\r\n    this._value = \"\";\r\n\r\n    this.textOnlyMode = false;\r\n\r\n    this.styletag = document.createElement(\"style\");\r\n    this.styletag.textContent = `\r\n      div.rich-text-editor-x {\r\n        width        :   100%;\r\n        height       :   100%;\r\n        min-height   :   150px;\r\n        overflow     :   scroll;\r\n        padding      :   5px;\r\n        white-space  :   pre-wrap;\r\n      }\r\n      \r\n      rich-text-editor-x {\r\n        display        : flex;\r\n        flex-direction : column;\r\n      }\r\n    `;\r\n\r\n    this.shadow.appendChild(this.styletag);\r\n\r\n    let controls = this.controls = UIBase.createElement(\"rowframe-x\");\r\n\r\n\r\n    let makeicon = (icon, description, cb) => {\r\n      icon = controls.iconbutton(icon, description, cb);\r\n      icon.iconsheet = 1; //use second smallest icon size\r\n      icon.overrideDefault(\"padding\", 3);\r\n\r\n      return icon;\r\n    };\r\n\r\n    makeicon(Icons.BOLD, \"Bold\", () => {\r\n      document.execCommand(\"bold\");\r\n    });\r\n    makeicon(Icons.ITALIC, \"Italic\", () => {\r\n      document.execCommand(\"italic\");\r\n    });\r\n    makeicon(Icons.UNDERLINE, \"Underline\", () => {\r\n      document.execCommand(\"underline\");\r\n    });\r\n    makeicon(Icons.STRIKETHRU, \"Strikethrough\", () => {\r\n      document.execCommand(\"strikeThrough\");\r\n    });\r\n\r\n    controls.background = this.getDefault(\"background-color\");\r\n\r\n    this.shadow.appendChild(controls);\r\n\r\n    this.textarea = document.createElement(\"div\");\r\n    this.textarea.contentEditable = true;\r\n    this.textarea.setAttribute(\"class\", \"rich-text-editor-x\");\r\n\r\n    this.textarea.style[\"font\"] = this.getDefault(\"DefaultText\").genCSS();\r\n    this.textarea.style[\"background-color\"] = this.getDefault(\"background-color\");\r\n    this.textarea.setAttribute(\"white-space\", \"pre-wrap\");\r\n\r\n    this.textarea.addEventListener(\"keydown\", (e) => {\r\n      if (e.keyCode === keymap[\"S\"] && e.shiftKey && (e.ctrlKey || e.commandKey)) {\r\n        this.toggleStrikeThru();\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n    });\r\n\r\n    this.textarea.addEventListener(\"focus\", (e) => {\r\n      this._focus = 1;\r\n      this.setCSS();\r\n    });\r\n    this.textarea.addEventListener(\"blur\", (e) => {\r\n      this._focus = 0;\r\n      this.setCSS();\r\n    });\r\n\r\n    document.execCommand(\"styleWithCSS\", true);\r\n\r\n    window.ta = this;\r\n\r\n    this.textarea.addEventListener(\"selectionchange\", (e) => {\r\n      console.log(\"sel1\");\r\n    });\r\n\r\n    document.addEventListener(\"selectionchange\", (e, b) => {\r\n      console.log(\"sel2\", document.getSelection().startNode, b);\r\n    });\r\n\r\n    this.textarea.addEventListener(\"input\", (e) => {\r\n      if (this.internalDisabled) {\r\n        return;\r\n      }\r\n\r\n      console.log(\"text input\", e);\r\n\r\n      let text;\r\n\r\n      if (this.textOnlyMode) {\r\n        text = this.textarea.innerText;\r\n      } else {\r\n        text = this.textarea.innerHTML;\r\n      }\r\n\r\n      if (this.textOnlyMode && text === this._value) {\r\n        //formatting changed?\r\n        console.log(\"detected formatting change\");\r\n        return;\r\n      }\r\n\r\n      //console.log(\"text changed\", ...arguments);\r\n      let sel = document.getSelection();\r\n      let range = sel.getRangeAt(0);\r\n      //console.log(range.startOffset, range.endOffset, range.startContainer);\r\n\r\n      let node = sel.anchorNode;\r\n      let off = sel.anchorOffset;\r\n\r\n      this._value = text;\r\n\r\n      //sel.collapse(node, off);\r\n\r\n      if (this.hasAttribute(\"datapath\")) {\r\n        let path = this.getAttribute(\"datapath\");\r\n        this.setPathValue(this.ctx, path, this.value);\r\n      }\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this._value);\r\n      }\r\n      if (this.oninput) {\r\n        this.oninput(this._value);\r\n      }\r\n\r\n      this.dispatchEvent(new InputEvent(this));\r\n      this.dispatchEvent(new CustomEvent('change'));\r\n    });\r\n\r\n    this.shadow.appendChild(this.textarea);\r\n  }\r\n\r\n  /**\r\n   * Only available in textOnlyMode.  Called when starting text formatting\r\n  */\r\n  formatStart() {\r\n  }\r\n\r\n  /**\r\n  * Only available in textOnlyMode.  Formats html-formated line.\r\n   *\r\n   * @param line : line to format\r\n   * @parem text : whole text\r\n  * */\r\n  formatLine(line, text) {\r\n    return line;\r\n  }\r\n\r\n  toggleStrikeThru() {\r\n    console.log(\"strike thru!\");\r\n    document.execCommand(\"strikeThrough\");\r\n  }\r\n  /**\r\n   * Only available in textOnlyMode.  Called when starting text formatting\r\n   */\r\n  formatEnd() {\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    window.rc = this;\r\n\r\n    document.execCommand(\"defaultParagraphSeparator\", false, \"div\");\r\n\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  get internalDisabled() {\r\n    return this._internalDisabled;\r\n  }\r\n\r\n  set internalDisabled(val) {\r\n    let changed = !!this._internalDisabled !== !!val;\r\n\r\n    if (changed || 1) {\r\n      this._internalDisabled = !!val;\r\n      super.internalDisabled = val;\r\n\r\n      this.textarea.internalDisabled = val;\r\n      this.textarea.contentEditable = !val;\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  set value(val) {\r\n    this._value = val;\r\n\r\n    if (this.textOnlyMode) {\r\n      let val2 = \"\";\r\n      for (let l of val.split(\"\\n\")) {\r\n        val2 += l + \"<br>\";\r\n      }\r\n      val = val2;\r\n    }\r\n\r\n    this.textarea.innerHTML = val;\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.controls.background = this.getDefault(\"background-color\");\r\n\r\n    if (this._focus) {\r\n      this.textarea.style[\"border\"] = `2px dashed ${this.getDefault('focus-border-color')}`;\r\n    } else {\r\n      this.textarea.style[\"border\"] = \"none\";\r\n    }\r\n\r\n    if (this.style[\"font\"]) {\r\n      this.textarea.style[\"font\"] = this.style[\"font\"];\r\n    } else {\r\n      this.textarea.style[\"font\"] = this.getDefault(\"DefaultText\").genCSS();\r\n    }\r\n\r\n    if (this.style[\"color\"]) {\r\n      this.textarea.style[\"color\"] = this.style[\"color\"];\r\n    }  else {\r\n      this.textarea.style[\"color\"] = this.getDefault(\"DefaultText\").color;\r\n    }\r\n\r\n\r\n    if (this.disabled) {\r\n      this.textarea.style[\"background-color\"] = this.getDefault(\"DisabledBG\");\r\n    } else {\r\n      this.textarea.style[\"background-color\"] = this.getDefault(\"background-color\");\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n    let prop = this.getPathMeta(this.ctx, path);\r\n\r\n    if (prop === undefined) {\r\n      console.warn(\"invalid datapath \" + path);\r\n\r\n      this.internalDisabled = true;\r\n      return;\r\n    }\r\n\r\n    this.internalDisabled = false;\r\n    let value = this.getPathValue(this.ctx, path);\r\n\r\n    if (value !== this._value) {\r\n      console.log(\"text change\");\r\n      this.value = value;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateDataPath();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"rich-text-editor-x\",\r\n    style   : \"richtext\",\r\n    modalKeyEvents : true\r\n  }}\r\n}\r\nUIBase.internalRegister(RichEditor);\r\n\r\nexport class RichViewer extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.contents = document.createElement(\"div\");\r\n    this.contents.style[\"padding\"] = \"10px\";\r\n    this.contents.style[\"margin\"] = \"10px\";\r\n    this.contents.style[\"overflow\"] = \"scroll\";\r\n\r\n    this.shadow.appendChild(this.contents);\r\n    this._value = \"\";\r\n  }\r\n\r\n  hideScrollBars() {\r\n    this.contents.style[\"overflow\"] = \"hidden\"\r\n  }\r\n\r\n  showScrollBars() {\r\n    this.contents.style[\"overflow\"] = \"scroll\"\r\n  }\r\n\r\n  //transforms text into final html form\r\n  //note that client code is allowed to override this directly\r\n  textTransform(text) {\r\n    return text;\r\n  }\r\n  set value(val) {\r\n    this._value = val;\r\n\r\n    this.contents.innerHTML = this.textTransform(val);\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n    let prop = this.getPathMeta(this.ctx, path);\r\n\r\n    if (prop === undefined) {\r\n      console.warn(\"invalid datapath \" + path);\r\n\r\n      this.internalDisabled = true;\r\n      return;\r\n    }\r\n\r\n    this.internalDisabled = false;\r\n    let value = this.getPathValue(this.ctx, path);\r\n\r\n    if (value !== this.value) {\r\n      this.value = value;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateDataPath();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"html-viewer-x\",\r\n    style   : \"html_viewer\"\r\n  }}\r\n}\r\nUIBase.internalRegister(RichViewer);\r\n","\"use strict\";\r\nimport './ui_richedit.js';\r\n\r\nimport * as util from '../util/util.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport {Vector2, Vector3, Vector4, Quat, Matrix4} from '../path-controller/util/vectormath.js';\r\nimport {RowFrame, ColumnFrame} from \"../core/ui.js\";\r\nimport {isNumber, PropFlags} from \"../path-controller/toolsys/toolprop.js\";\r\n\r\nimport './ui_widgets.js';\r\n\r\nlet keymap = events.keymap;\r\n\r\nimport {EnumProperty, PropTypes} from '../path-controller/toolsys/toolprop.js';\r\nimport {UIBase, PackFlags, IconSheets, parsepx} from '../core/ui_base.js';\r\n\r\nimport * as units from '../core/units.js';\r\nimport {ToolProperty} from '../path-controller/toolsys/toolprop.js';\r\nimport {Button} from \"./ui_button.js\";\r\n\r\nexport class VectorPopupButton extends Button {\r\n  constructor() {\r\n    super();\r\n\r\n    this.value = new Vector4();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"vector-popup-button-x\",\r\n    style : \"vecPopupButton\"\r\n  }}\r\n\r\n  _onpress(e) {\r\n    if (e.button && e.button !== 0) {\r\n      return;\r\n    }\r\n\r\n    let panel = UIBase.createElement(\"vector-panel-x\");\r\n    let screen = this.ctx.screen;\r\n\r\n    let popup = screen.popup(this, this);\r\n\r\n    popup.add(panel);\r\n    popup.button(\"ok\", () => {\r\n      popup.end();\r\n    })\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      panel.setAttribute(\"datapath\", this.getAttribute(\"datapath\"));\r\n    }\r\n    if (this.hasAttribute(\"mass_set_path\")) {\r\n      panel.setAttribute(\"mass_set_path\", this.getAttribute(\"mass_set_path\"));\r\n    }\r\n\r\n    popup.flushUpdate();\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let value = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (!value) {\r\n      this.internalDisabled = true;\r\n      return;\r\n    }\r\n\r\n    if (this.internalDisabled) {\r\n      this.internalDisabled = false;\r\n    }\r\n\r\n    if (this.value.length !== value.length) {\r\n      switch (value.length) {\r\n        case 2:\r\n          this.value = new Vector2();\r\n          break;\r\n        case 3:\r\n          this.value = new Vector3();\r\n          break;\r\n        case 4:\r\n          this.value = new Vector4();\r\n          break;\r\n      }\r\n    }\r\n\r\n    if (this.value.vectorDistance(value) > 0.0001) {\r\n      this.value.load(value);\r\n      console.log(\"updated vector popup button value\");\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n    this.updateDataPath();\r\n  }\r\n\r\n}\r\nUIBase.internalRegister(VectorPopupButton);\r\n\r\nexport class VectorPanel extends ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this.range = [-1e17, 1e17];\r\n\r\n    this.name = \"\";\r\n\r\n    this.axes = \"XYZW\";\r\n    this.value = new Vector3();\r\n    this.sliders = [];\r\n    this.hasUniformSlider = false;\r\n\r\n    this.packflag |= PackFlags.FORCE_ROLLER_SLIDER;\r\n\r\n    let makeParam = (key) => {\r\n      Object.defineProperty(this, key, {\r\n        get : function() {\r\n          return this._getNumParam(key);\r\n        },\r\n\r\n        set : function(val) {\r\n          this._setNumParam(key, val);\r\n        }\r\n      });\r\n    };\r\n\r\n    this.__range = [-1e17, 1e17];\r\n    this._range = new Array(2);\r\n\r\n    Object.defineProperty(this._range, 0, {\r\n      get : () => this.__range[0],\r\n      set : (val) => this.__range[0] = val\r\n    });\r\n    Object.defineProperty(this._range, 1, {\r\n      get : () => this.__range[1],\r\n      set : (val) => this.__range[1] = val\r\n    });\r\n\r\n    makeParam(\"isInt\");\r\n    makeParam(\"radix\");\r\n    makeParam(\"decimalPlaces\");\r\n    makeParam(\"baseUnit\");\r\n    makeParam(\"displayUnit\");\r\n    makeParam(\"step\");\r\n    makeParam(\"slideSpeed\");\r\n    makeParam(\"expRate\");\r\n    makeParam(\"stepIsRelative\");\r\n\r\n    window.vp = this;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this.rebuild();\r\n    this.setCSS();\r\n\r\n    this.background = this.getDefault(\"InnerPanelBG\");\r\n  }\r\n\r\n  _getNumParam(key) {\r\n    return this[\"_\"+key];\r\n  }\r\n\r\n  _setNumParam(key, val) {\r\n    if (key === \"range\") {\r\n      this.__range[0] = val[0];\r\n      this.__range[1] = val[1];\r\n\r\n      return;\r\n    }\r\n\r\n    this[\"_\"+key] = val;\r\n\r\n    for (let slider of this.sliders) {\r\n      slider[key] = val;\r\n    }\r\n  }\r\n\r\n  rebuild() {\r\n    this.clear();\r\n\r\n    if (this.name) {\r\n      this.label(this.name);\r\n    }\r\n\r\n    let frame, row;\r\n\r\n    if (this.hasUniformSlider) {\r\n      row = this.row();\r\n      frame = row.col();\r\n    } else {\r\n      frame = this;\r\n    }\r\n\r\n    this.sliders = [];\r\n\r\n    for (let i=0; i<this.value.length; i++) {\r\n      let slider = frame.slider(undefined, {\r\n        name       : this.axes[i],\r\n        defaultval : this.value[i],\r\n        min        : this.range[0],\r\n        max        : this.range[1],\r\n        step       : this.step || 0.001,\r\n        is_int     : this.isInt,\r\n        packflag   : this.packflag\r\n      });\r\n\r\n      slider.addLabel = false;\r\n      slider.labelOnTop = false;\r\n\r\n      //let slider = frame.slider(undefined, this.axes[i], this.value[i], this.range[0], this.range[1], 0.001, this.isInt);\r\n      slider.axis = i;\r\n      let this2 = this;\r\n\r\n      slider.baseUnit = this.baseUnit;\r\n      slider.slideSpeed = this.slideSpeed;\r\n      slider.decimalPlaces = this.decimalPlaces;\r\n      slider.displayUnit = this.displayUnit;\r\n      slider.isInt = this.isInt;\r\n      slider.range = this.__range;\r\n      slider.radix = this.radix;\r\n      slider.step = this.step;\r\n      slider.expRate = this.expRate;\r\n      slider.stepIsRelative= this.stepIsRelative;\r\n\r\n      if (this.stepIsRelative) {\r\n        slider.step = ToolProperty.calcRelativeStep(this.step, this.value[i]);\r\n      }\r\n\r\n      slider.onchange = function(e) {\r\n        this2.value[this.axis] = this.value;\r\n\r\n        if (this2.hasAttribute(\"datapath\")) {\r\n          this2.setPathValue(this2.ctx, this2.getAttribute(\"datapath\"), this2.value);\r\n        }\r\n\r\n        if (this2.uslider) {\r\n          this2.uslider.setValue(this2.uniformValue, false);\r\n        }\r\n\r\n        if (this2.onchange) {\r\n          this2.onchange(this2.value);\r\n        }\r\n      }\r\n\r\n      this.sliders.push(slider);\r\n    }\r\n\r\n    if (this.hasUniformSlider) {\r\n      let uslider = this.uslider = UIBase.createElement(\"numslider-x\");\r\n      row._prepend(uslider);\r\n\r\n      uslider.range = this.range;\r\n      uslider.baseUnit = this.baseUnit;\r\n      uslider.slideSpeed = this.slideSpeed;\r\n      uslider.decimalPlaces = this.decimalPlaces;\r\n      uslider.displayUnit = this.displayUnit;\r\n      uslider.expRate = this.expRate;\r\n      uslider.step = this.step;\r\n      uslider.expRate = this.expRate;\r\n      uslider.isInt = this.isInt;\r\n      uslider.radix = this.radix;\r\n      uslider.decimalPlaces = this.decimalPlaces;\r\n      uslider.stepIsRelative= this.stepIsRelative;\r\n\r\n      uslider.vertical = true;\r\n      uslider.setValue(this.uniformValue, false);\r\n\r\n      this.sliders.push(uslider);\r\n\r\n      uslider.onchange = () => {\r\n        this.uniformValue = uslider.value;\r\n      }\r\n    } else {\r\n      this.uslider = undefined;\r\n    }\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  get uniformValue() {\r\n    let sum = 0.0;\r\n\r\n    for (let i=0; i<this.value.length; i++) {\r\n      sum += isNaN(this.value[i]) ? 0.0 : this.value[i];\r\n    }\r\n\r\n    return sum / this.value.length;\r\n  }\r\n\r\n  set uniformValue(val) {\r\n    let old = this.uniformValue;\r\n    let doupdate = false;\r\n\r\n    if (old === 0.0 || val === 0.0) {\r\n      doupdate = this.value.dot(this.value) !== 0.0\r\n\r\n      this.value.zero();\r\n    } else {\r\n      let ratio = val / old;\r\n      for (let i = 0; i < this.value.length; i++) {\r\n        this.value[i] *= ratio;\r\n      }\r\n\r\n      doupdate = true;\r\n    }\r\n\r\n    if (doupdate) {\r\n      if (this.hasAttribute(\"datapath\")) {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this.value);\r\n      }\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.value);\r\n      }\r\n\r\n      for (let i=0; i<this.value.length; i++) {\r\n        this.sliders[i].setValue(this.value[i], false);\r\n        this.sliders[i]._redraw();\r\n      }\r\n\r\n      if (this.uslider) {\r\n        this.uslider.setValue(val, false);\r\n        this.uslider._redraw();\r\n      }\r\n    }\r\n  }\r\n\r\n  setValue(value) {\r\n    if (!value) {\r\n      return;\r\n    }\r\n\r\n    if (value.length !== this.value.length) {\r\n      switch (value.length) {\r\n        case 2:\r\n          this.value = new Vector2(value);\r\n          break;\r\n        case 3:\r\n          this.value = new Vector3(value);\r\n          break;\r\n        case 4:\r\n          this.value = new Vector4(value);\r\n          break;\r\n        default:\r\n          throw new Error(\"invalid vector size \" + value.length);\r\n      }\r\n\r\n      this.rebuild();\r\n    } else {\r\n      this.value.load(value);\r\n    }\r\n\r\n    if (this.onchange) {\r\n      this.onchange(this.value);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n\r\n    let val = this.getPathValue(this.ctx, path);\r\n    if (val === undefined) {\r\n      this.internalDisabled = true;\r\n      return;\r\n    }\r\n\r\n\r\n    let meta = this.getPathMeta(this.ctx, path);\r\n    let name = meta.uiname !== undefined ? meta.uiname : meta.name;\r\n    if (this.hasAttribute(\"name\")) {\r\n      name = this.getAttribute(\"name\");\r\n    }\r\n\r\n    if (name && name !== this.name) {\r\n      this.name = name;\r\n      this.rebuild();\r\n      return;\r\n    }\r\n\r\n    let loadNumParam = (k, do_rebuild=false) => {\r\n      if (meta && meta[k] !== undefined && this[k] === undefined) {\r\n        this[k] = meta[k];\r\n\r\n        if (this[k] !== meta[k] && do_rebuild) {\r\n          this.doOnce(this.rebuild);\r\n        }\r\n      }\r\n    }\r\n\r\n\r\n    loadNumParam(\"decimalPlaces\");\r\n    loadNumParam(\"baseUnit\");\r\n    loadNumParam(\"slideSpeed\");\r\n    loadNumParam(\"displayUnit\");\r\n    loadNumParam(\"decimalPlaces\");\r\n    loadNumParam(\"isInt\");\r\n    loadNumParam(\"radix\");\r\n    loadNumParam(\"step\");\r\n    loadNumParam(\"expRate\");\r\n    loadNumParam(\"stepIsRelative\");\r\n\r\n    if (meta && meta.hasUniformSlider !== undefined && meta.hasUniformSlider !== this.hasUniformSlider) {\r\n      this.hasUniformSlider = meta.hasUniformSlider;\r\n      this.doOnce(this.rebuild);\r\n    }\r\n\r\n    if (meta && meta.range) {\r\n      let update = this.range[0] !== meta.range[0];\r\n      update= update || this.range[1] !== meta.range[1];\r\n\r\n      this.range[0] = meta.range[0];\r\n      this.range[1] = meta.range[1];\r\n\r\n      if (update) {\r\n        this.doOnce(this.rebuild);\r\n      }\r\n    }\r\n\r\n    this.internalDisabled = false;\r\n\r\n    let length = val.length;\r\n\r\n    if (meta && (meta.flag & PropFlags.USE_CUSTOM_GETSET)) {\r\n      let rdef = this.ctx.api.resolvePath(this.ctx, path);\r\n\r\n      meta.ctx = this.ctx;\r\n      meta.dataref = rdef.obj;\r\n      meta.datapath = path;\r\n\r\n      length = meta.getValue().length;\r\n\r\n      meta.dataref = undefined;\r\n    }\r\n\r\n    if (this.value.length !== length) {\r\n      switch (length) {\r\n        case 2:\r\n          val = new Vector2(val);\r\n          break;\r\n        case 3:\r\n          val = new Vector3(val);\r\n          break;\r\n        case 4:\r\n          val = new Vector4(val);\r\n          break;\r\n        default:\r\n          val = meta.getValue().copy().load(val);\r\n          break;\r\n      }\r\n\r\n      this.value = val;\r\n      this.rebuild();\r\n\r\n      for (let i=0; i<this.value.length; i++) {\r\n        this.sliders[i].setValue(val[i], false);\r\n        this.sliders[i]._redraw();\r\n      }\r\n    } else {\r\n      if (this.value.vectorDistance(val) > 0) {\r\n        this.value.load(val);\r\n\r\n        if (this.uslider) {\r\n          this.uslider.setValue(this.uniformValue, false);\r\n        }\r\n\r\n        for (let i=0; i<this.value.length; i++) {\r\n          this.sliders[i].setValue(val[i], false);\r\n          this.sliders[i]._redraw();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateDataPath();\r\n\r\n    if (this.stepIsRelative) {\r\n      for (let slider of this.sliders) {\r\n        slider.step = ToolProperty.calcRelativeStep(this.step, slider.value);\r\n      }\r\n    }\r\n\r\n    if (this.uslider) {\r\n      this.uslider.step = this.step;\r\n      if (this.stepIsRelative) {\r\n        this.uslider.step = ToolProperty.calcRelativeStep(this.step, this.uniformValue);\r\n      }\r\n\r\n    }\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"vector-panel-x\"\r\n  }}\r\n}\r\nUIBase.internalRegister(VectorPanel);\r\n\r\n\r\nexport class ToolTip extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.visibleToPick = false;\r\n    this.div = document.createElement(\"div\");\r\n\r\n    this.shadow.appendChild(this.div);\r\n    this._start_time = undefined;\r\n    this.timeout = undefined;\r\n  }\r\n\r\n  static show(message, screen, x, y) {\r\n    let ret = UIBase.createElement(this.define().tagname);\r\n\r\n    ret._start_time = util.time_ms();\r\n    ret.timeout = ret.getDefault(\"timeout\");\r\n\r\n    ret.text = message;\r\n    let size = ret._estimateSize();\r\n\r\n    let pad = 5;\r\n    size = [size[0] + pad, size[1] + pad];\r\n\r\n    console.log(size);\r\n    x = Math.min(Math.max(x, 0), screen.size[0] - size[0]);\r\n    y = Math.min(Math.max(y, 0), screen.size[1] - size[1]);\r\n\r\n    let dpi = UIBase.getDPI();\r\n\r\n    x += 10/dpi;\r\n    y += 15/dpi;\r\n\r\n    ret._popup = screen.popup(ret, x, y);\r\n    ret._popup.background = \"rgba(0,0,0,0)\";\r\n    ret._popup.style[\"border\"] = \"none\";\r\n    ret.div.style[\"padding\"] = \"15px\";\r\n\r\n    ret._popup.add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  end() {\r\n    this._popup.end();\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this.setCSS();\r\n  }\r\n\r\n  set text(val) {\r\n    this.div.innerHTML = val.replace(/[\\n]/g, \"<br>\\n\");\r\n  }\r\n\r\n  get text() {\r\n    return this.div.innerHTML;\r\n  }\r\n\r\n  _estimateSize() {\r\n    let text = this.div.textContent;\r\n    let block = ui_base.measureTextBlock(this, text, undefined, undefined, undefined, this.getDefault(\"ToolTipText\"));\r\n\r\n    return [block.width+50, block.height+30];\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    if (util.time_ms() - this._start_time > this.timeout) {\r\n      this.end();\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    let color = this.getDefault(\"background-color\");\r\n    let bcolor = this.getDefault(\"border-color\");\r\n\r\n    this.background = color;\r\n\r\n    let radius = this.getDefault(\"border-radius\", undefined, 5);\r\n    let bstyle = this.getDefault(\"border-style\", undefined, \"solid\");\r\n    let bwidth = this.getDefault(\"border-width\", undefined, 1);\r\n    let padding = this.getDefault(\"padding\", undefined, 15);\r\n\r\n    this.noMarginsOrPadding();\r\n\r\n    this.div.style[\"padding\"] = padding + \"px\";\r\n\r\n    this.div.style[\"background-color\"] = \"rgba(0,0,0,0)\";\r\n    this.div.style[\"border\"] = `${bwidth}px ${bstyle} ${bcolor}`;\r\n    this.div.style[\"border-radius\"] = radius + \"px\";\r\n    this.style[\"border-radius\"] = radius + \"px\";\r\n\r\n    let font = this.getDefault(\"ToolTipText\");\r\n    this.div.style[\"color\"] = font.color;\r\n    this.div.style[\"font\"] = font.genCSS();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"tool-tip-x\",\r\n    style   : \"tooltip\"\r\n  }}\r\n};\r\nUIBase.internalRegister(ToolTip);\r\n\r\nwindow._ToolTip = ToolTip;\r\n","\"use strict\";\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as simple_toolsys from '../path-controller/toolsys/toolsys.js';\r\nimport {ToolTip} from \"../widgets/ui_widgets2.js\";\r\n\r\n/*\r\nwhy am I using a toolstack here at all?  time to remove!\r\n*/\r\n\r\nlet toolstack_getter = function () {\r\n  throw new Error(\"must pass a toolstack getter to registerToolStackGetter\")\r\n}\r\n\r\nexport function registerToolStackGetter(func) {\r\n  toolstack_getter = func;\r\n}\r\n\r\nlet Vector2   = vectormath.Vector2,\r\n    Vector3   = vectormath.Vector3,\r\n    UndoFlags = simple_toolsys.UndoFlags,\r\n    ToolFlags = simple_toolsys.ToolFlags;\r\n\r\nimport {pushModalLight, popModalLight, keymap, pushPointerModal} from \"../util/simple_events.js\";\r\n\r\n//import {keymap} from './events';\r\n\r\nexport class ToolBase extends simple_toolsys.ToolOp {\r\n  constructor(screen) {\r\n    super();\r\n    this.screen = screen;\r\n    //super();\r\n\r\n    this._finished = false;\r\n  }\r\n\r\n  start(elem, pointerId) {\r\n    //toolstack_getter().execTool(this);\r\n    this.modalStart(undefined, elem, pointerId);\r\n  }\r\n\r\n  cancel() {\r\n    this.finish();\r\n  }\r\n\r\n  finish() {\r\n    this._finished = true;\r\n    this.popModal(this.screen);\r\n  }\r\n\r\n  popModal() {\r\n    this.overdraw.end();\r\n    popModalLight(this.modaldata);\r\n    this.modaldata = undefined;\r\n  }\r\n\r\n  modalStart(ctx, elem, pointerId) {\r\n    this.ctx = ctx;\r\n\r\n    if (this.modaldata !== undefined) {\r\n      console.log(\"Error, modaldata was not undefined\");\r\n      popModalLight(this.modaldata);\r\n    }\r\n\r\n    this.overdraw = ui_base.UIBase.createElement(\"overdraw-x\");\r\n    this.overdraw.start(this.screen);\r\n\r\n    let handlers = {};\r\n    let keys = Object.getOwnPropertyNames(this);\r\n    for (let k in this.__proto__) {\r\n      keys.push(k);\r\n    }\r\n    for (let k of Object.getOwnPropertyNames(this.__proto__)) {\r\n      keys.push(k);\r\n    }\r\n\r\n    for (let k in this) {\r\n      keys.push(k);\r\n    }\r\n\r\n    for (let k of keys) {\r\n      if (k.startsWith(\"on\")) {\r\n        handlers[k] = this[k].bind(this);\r\n      }\r\n    }\r\n\r\n    //window.setTimeout(() => {\r\n    if (pointerId !== undefined) {\r\n      handlers.on_pointerdown = handlers.on_pointerdown ?? handlers.on_mousedown;\r\n      handlers.on_pointermove = handlers.on_pointermove ?? handlers.on_mousemove;\r\n      handlers.on_pointerup = handlers.on_pointerup ?? handlers.on_mouseup;\r\n      handlers.on_pointercancel = handlers.on_pointercancel ?? handlers.on_pointerup ?? handlers.on_mouseup;\r\n\r\n      this.modaldata = pushPointerModal(handlers, elem, pointerId);\r\n    } else {\r\n      this.modaldata = pushModalLight(handlers);\r\n    }\r\n    //console.log(\"HANDLERS\", this.modaldata.handlers);\r\n\r\n    //}, 100);\r\n\r\n    //window.addEventListener(\"touchmove\", (e) => {\r\n    //  console.log(\"touchmove\");\r\n    //}, {passive : false});\r\n  }\r\n\r\n  on_pointermove(e) {\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    this.finish();\r\n  }\r\n\r\n  on_keydown(e) {\r\n    console.log(\"s\", e.keyCode);\r\n\r\n    switch (e.keyCode) {\r\n      case keymap.Escape: //esc\r\n        this.cancel();\r\n        break;\r\n      case keymap.Space: //space\r\n      case keymap.Enter: //return\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\nexport class AreaResizeTool extends ToolBase {\r\n  constructor(screen, border, mpos) {\r\n    if (screen === undefined) screen = _appstate.screen; //XXX hackish!\r\n\r\n    super(screen);\r\n\r\n    this.start_mpos = new Vector2(mpos);\r\n\r\n    this.sarea = border.sareas[0];\r\n    if (!this.sarea || border.dead) {\r\n      console.log(border.dead, border);\r\n      throw new Error(\"border corruption\");\r\n    }\r\n\r\n    this.screen = screen;\r\n\r\n    this.side = this.sarea._side(border);\r\n  }\r\n\r\n  get border() {\r\n    return this.sarea._borders[this.side];\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Resize Area\",\r\n      toolpath   : \"screen.area.resize\",\r\n      icon       : ui_base.Icons.RESIZE,\r\n      description: \"change size of area\",\r\n      is_modal   : true,\r\n      undoflag   : UndoFlags.NO_UNDO,\r\n      flag       : 0,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n\r\n  getBorders() {\r\n    let horiz = this.border.horiz;\r\n\r\n    let ret = [];\r\n    let visit = new Set();\r\n\r\n    let rec = (v) => {\r\n      if (visit.has(v._id)) {\r\n        return;\r\n      }\r\n\r\n      visit.add(v._id);\r\n\r\n      for (let border of v.borders) {\r\n        if (border.horiz == horiz && !visit.has(border._id)) {\r\n          visit.add(border._id);\r\n          ret.push(border);\r\n\r\n          rec(border.otherVertex(v));\r\n        }\r\n      }\r\n    }\r\n\r\n    rec(this.border.v1);\r\n    rec(this.border.v2);\r\n\r\n    return ret;\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    this.finish();\r\n  }\r\n\r\n  finish() {\r\n    super.finish();\r\n\r\n    this.screen.snapScreenVerts();\r\n    this.screen.regenBorders();\r\n    this.screen.snapScreenVerts();\r\n    this.screen.loadFromVerts();\r\n  }\r\n\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case keymap[\"Escape\"]:\r\n      case keymap[\"Enter\"]:\r\n      case keymap[\"Space\"]:\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let mpos = new Vector2([e.x, e.y]);\r\n\r\n    mpos.sub(this.start_mpos);\r\n\r\n    let axis = this.border.horiz ? 1 : 0;\r\n\r\n    //console.log(this.border.horiz);\r\n\r\n    this.overdraw.clear();\r\n\r\n    let visit = new Set();\r\n    let borders = this.getBorders();\r\n\r\n    let color = cconst.DEBUG.screenborders ? \"rgba(1.0, 0.5, 0.0, 0.1)\" : \"rgba(1.0, 0.5, 0.0, 1.0)\";\r\n\r\n    let bad = false;\r\n\r\n    for (let border of borders) {\r\n      bad = bad || !this.screen.isBorderMovable(border);\r\n\r\n      border.oldv1 = new Vector2(border.v1);\r\n      border.oldv2 = new Vector2(border.v2);\r\n    }\r\n\r\n    if (bad) {\r\n      console.log(\"border is not movable\");\r\n      return;\r\n    }\r\n\r\n    let check = () => {\r\n      let count = 0;\r\n\r\n      for (let sarea of this.screen.sareas) {\r\n        if (sarea.size[0] < 15 || sarea.size[1] < 15) {\r\n          count++;\r\n        }\r\n      }\r\n\r\n      return count;\r\n    };\r\n\r\n    let badcount = check();\r\n\r\n\r\n    let snapMode = true;\r\n\r\n    let df = mpos[axis];\r\n    let border = this.border;\r\n\r\n    this.screen.moveBorder(border, df, false);\r\n\r\n    for (let border of borders) {\r\n      //if false, stead of forcing areas to fit within screen bounds\r\n      //in snapScreenVerts the screen bounds will be modified instead.\r\n\r\n      if (border.outer) {\r\n        snapMode = false;\r\n      }\r\n\r\n      this.overdraw.line(border.v1, border.v2, color);\r\n    }\r\n\r\n    this.start_mpos[0] = e.x;\r\n    this.start_mpos[1] = e.y;\r\n    this.screen.loadFromVerts();\r\n    this.screen.setCSS();\r\n\r\n    if (check() != badcount) {\r\n      console.log(\"bad\");\r\n\r\n      for (let border of borders) {\r\n        border.v1.load(border.oldv1);\r\n        border.v2.load(border.oldv2);\r\n      }\r\n    }\r\n\r\n\r\n    this.screen.snapScreenVerts(snapMode);\r\n    this.screen.loadFromVerts();\r\n    this.screen.solveAreaConstraints(snapMode);\r\n    this.screen.setCSS();\r\n    this.screen.updateDebugBoxes();\r\n    this.screen._fireResizeCB();\r\n  }\r\n}\r\n\r\n//controller.registerTool(AreaResizeTool);\r\n\r\nexport class SplitTool extends ToolBase {\r\n  constructor(screen) {\r\n    if (screen === undefined) screen = _appstate.screen; //XXX hackish!\r\n\r\n    super(screen);\r\n\r\n    this.done = false;\r\n    this.screen = screen;\r\n    this.ctx = screen.ctx;\r\n    this.sarea = undefined;\r\n    this.t = undefined;\r\n\r\n    this.started = false;\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Split Area\",\r\n      toolpath   : \"screen.area.split\",\r\n      icon       : ui_base.Icons.SMALL_PLUS,\r\n      description: \"split an area in two\",\r\n      is_modal   : true,\r\n      undoflag   : UndoFlags.NO_UNDO,\r\n      flag       : 0,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n\r\n  modalStart(ctx) {\r\n    if (this.started) {\r\n      console.trace(\"double call to modalStart()\");\r\n      return;\r\n    }\r\n\r\n    this.overdraw = ui_base.UIBase.createElement(\"overdraw-x\");\r\n    this.overdraw.start(this.screen);\r\n\r\n    super.modalStart(ctx);\r\n  }\r\n\r\n  cancel() {\r\n    return this.finish(true);\r\n  }\r\n\r\n  finish(canceled = false) {\r\n    if (this.done) {\r\n      return;\r\n    }\r\n\r\n    this.done = true;\r\n    this.overdraw.end();\r\n\r\n    this.popModal(this.screen);\r\n\r\n    if (canceled || !this.sarea) {\r\n      return;\r\n    }\r\n\r\n    let sarea = this.sarea, screen = this.screen;\r\n    let t = this.t;\r\n\r\n    screen.splitArea(sarea, t, this.horiz);\r\n    screen._internalRegenAll();\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let x = e.x, y = e.y;\r\n\r\n    let screen = this.screen;\r\n\r\n    let sarea = screen.findScreenArea(x, y);\r\n\r\n    this.overdraw.clear();\r\n\r\n    if (sarea !== undefined) {\r\n      //x -= sarea.pos[0];\r\n      //y -= sarea.pos[1];\r\n      x = (x - sarea.pos[0])/(sarea.size[0]);\r\n      y = (y - sarea.pos[1])/(sarea.size[1]);\r\n\r\n      let dx = 1.0 - Math.abs(x - 0.5);\r\n      let dy = 1.0 - Math.abs(y - 0.5);\r\n\r\n      this.sarea = sarea;\r\n      let horiz = this.horiz = dx < dy;\r\n\r\n      if (horiz) {\r\n        this.t = y;\r\n        this.overdraw.line([sarea.pos[0], e.y], [sarea.pos[0] + sarea.size[0], e.y]);\r\n      } else {\r\n        this.t = x;\r\n        this.overdraw.line([e.x, sarea.pos[1]], [e.x, sarea.pos[1] + sarea.size[1]]);\r\n      }\r\n    }\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    this.finish();\r\n\r\n    if (e.button) {\r\n      this.stopPropagation();\r\n      this.preventDefault();\r\n    }\r\n  }\r\n\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case keymap.Escape: //esc\r\n        this.cancel();\r\n        break;\r\n      case keymap.Space: //space\r\n      case keymap.Enter: //return\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\n\r\nexport class RemoveAreaTool extends ToolBase {\r\n  constructor(screen, border) {\r\n    if (screen === undefined) screen = _appstate.screen; //XXX hackish!\r\n\r\n    super(screen);\r\n\r\n    this.border = border;\r\n\r\n    this.done = false;\r\n    this.screen = screen;\r\n    this.ctx = screen.ctx;\r\n    this.sarea = undefined;\r\n    this.t = undefined;\r\n\r\n    this.started = false;\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Remove Area\",\r\n      toolpath   : \"screen.area.pick_remove\",\r\n      icon       : ui_base.Icons.SMALL_PLUS,\r\n      description: \"Collapse a window\",\r\n      is_modal   : true,\r\n      undoflag   : UndoFlags.NO_UNDO,\r\n      flag       : 0,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n\r\n  modalStart(ctx) {\r\n    if (this.started) {\r\n      console.trace(\"double call to modalStart()\");\r\n      return;\r\n    }\r\n\r\n    this.overdraw = ui_base.UIBase.createElement(\"overdraw-x\");\r\n    this.overdraw.start(this.screen);\r\n\r\n    super.modalStart(ctx);\r\n  }\r\n\r\n  cancel() {\r\n    return this.finish(true);\r\n  }\r\n\r\n  finish(canceled = false) {\r\n    if (this.done) {\r\n      return;\r\n    }\r\n\r\n    this.done = true;\r\n    this.overdraw.end();\r\n\r\n    this.popModal(this.screen);\r\n\r\n    if (canceled || !this.sarea) {\r\n      return;\r\n    }\r\n\r\n    let sarea = this.sarea, screen = this.screen;\r\n    let t = this.t;\r\n\r\n    if (sarea) {\r\n      screen.collapseArea(sarea, this.border);\r\n      screen._internalRegenAll();\r\n    }\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let x = e.x, y = e.y;\r\n\r\n    let screen = this.screen;\r\n\r\n    let sarea = screen.findScreenArea(x, y);\r\n\r\n    this.overdraw.clear();\r\n\r\n    if (sarea !== undefined) {\r\n      this.sarea = sarea;\r\n      this.overdraw.rect(sarea.pos, sarea.size, \"rgba(0,0,0,0.1)\");\r\n    }\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    this.finish();\r\n\r\n    if (e.button) {\r\n      this.stopPropagation();\r\n      this.preventDefault();\r\n    }\r\n  }\r\n\r\n  on_keydown(e) {\r\n    console.log(\"s\", e.keyCode);\r\n\r\n    switch (e.keyCode) {\r\n      case keymap.Escape: //esc\r\n        this.cancel();\r\n        break;\r\n      case keymap.Space: //space\r\n      case keymap.Enter: //return\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\n//controller.registerTool(SplitTool);\r\n\r\n\r\nexport class AreaDragTool extends ToolBase {\r\n  constructor(screen, sarea, mpos) {\r\n    if (screen === undefined) screen = _appstate.screen; //XXX hackish!\r\n\r\n    super(screen);\r\n\r\n    this.dropArea = false;\r\n    this.excludeAreas = new Set();\r\n    this.cursorbox = undefined;\r\n    this.boxes = [];\r\n    this.boxes.active = undefined;\r\n\r\n    this.sarea = sarea;\r\n    this.start_mpos = new Vector2(mpos);\r\n    this.screen = screen;\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Drag Area\",\r\n      toolpath   : \"screen.area.drag\",\r\n      icon       : ui_base.Icons.TRANSLATE,\r\n      description: \"move or duplicate area\",\r\n      is_modal   : true,\r\n      undoflag   : UndoFlags.NO_UNDO,\r\n      flag       : 0,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n\r\n  finish() {\r\n    super.finish();\r\n\r\n    this.screen.regenBorders();\r\n    this.screen.solveAreaConstraints();\r\n    this.screen.snapScreenVerts();\r\n    this.screen._recalcAABB();\r\n  }\r\n\r\n  getBoxRect(b) {\r\n    let sa = b.sarea;\r\n    let pos, size;\r\n\r\n    if (b.horiz == -1) {\r\n      //replacement mode\r\n      pos = sa.pos;\r\n      size = sa.size;\r\n    } else if (b.horiz) {\r\n      if (b.side == 'b') {\r\n        pos = [sa.pos[0], sa.pos[1] + sa.size[1]*b.t]\r\n        size = [sa.size[0], sa.size[1]*(1.0 - b.t)]\r\n      } else {\r\n        pos = [sa.pos[0], sa.pos[1]];\r\n        size = [sa.size[0], sa.size[1]*b.t]\r\n      }\r\n    } else {\r\n      if (b.side == 'r') {\r\n        pos = [sa.pos[0] + sa.size[0]*b.t, sa.pos[1]]\r\n        size = [sa.size[0]*(1.0 - b.t), sa.size[1]]\r\n      } else {\r\n        pos = [sa.pos[0], sa.pos[1]];\r\n        size = [sa.size[0]*b.t, sa.size[1]]\r\n      }\r\n    }\r\n\r\n    let color = \"rgba(100, 100, 100, 0.2)\";\r\n\r\n    let ret = this.overdraw.rect(pos, size, color);\r\n    ret.style[\"pointer-events\"] = \"none\";\r\n\r\n    return ret;\r\n  }\r\n\r\n  doSplit(b) {\r\n    if (this.sarea) {\r\n      return this.doSplitDrop(b);\r\n    }\r\n\r\n    let src = this.sarea, dst = b.sarea;\r\n    let screen = this.screen;\r\n\r\n    let t = b.t;\r\n\r\n    screen.splitArea(dst, t, b.horiz);\r\n\r\n    screen._internalRegenAll();\r\n  }\r\n\r\n  doSplitDrop(b) {\r\n    //first check if there was no change\r\n    if (b.horiz === -1 && b.sarea === this.sarea) {\r\n      return;\r\n    }\r\n\r\n    let can_rip = false;\r\n    let sa = this.sarea;\r\n    let screen = this.screen;\r\n\r\n    //rip conditions\r\n    can_rip = sa.size[0] === screen.size[0] || sa.size[1] === screen.size[1];\r\n    can_rip = can_rip || this.sarea.floating;\r\n    can_rip = can_rip && b.sarea !== sa;\r\n    can_rip = can_rip && (b.horiz === -1 || !screen.areasBorder(sa, b.sarea));\r\n\r\n    let expand = b.horiz === -1 && b.sarea !== sa && screen.areasBorder(b.sarea, sa);\r\n\r\n    can_rip = can_rip || expand;\r\n\r\n    console.log(\"can_rip:\", can_rip, expand);\r\n\r\n    if (can_rip) {\r\n      screen.removeArea(sa);\r\n      screen.snapScreenVerts();\r\n    }\r\n\r\n    if (b.horiz === -1) {\r\n      //replacement\r\n      let src = this.sarea, dst = b.sarea;\r\n\r\n      if (can_rip && src !== dst) {\r\n        let mm;\r\n\r\n        //handle case of one area \"consuming\" another\r\n        if (expand) {\r\n          mm = screen.minmaxArea(src);\r\n          screen.minmaxArea(dst, mm);\r\n        }\r\n\r\n        console.log(\"replacing. . .\", expand);\r\n\r\n        if (src.floating) {\r\n          let old = dst.editors;\r\n\r\n          dst.editors = [];\r\n          dst.editormap = {};\r\n\r\n          if (dst.area && !(dst.area.constructor.define().areaname in src.editormap)) {\r\n            dst.area.push_ctx_active();\r\n            dst.area.on_area_inactive();\r\n            dst.area.remove();\r\n            dst.area.pop_ctx_active();\r\n          }\r\n\r\n          for (let editor of old) {\r\n            let def = editor.constructor.define();\r\n\r\n            let bad = false;\r\n            //bad = !(def.areaname in src.editormap);\r\n\r\n            for (let editor2 of src.editors) {\r\n              if (editor.constructor === editor2.constructor) {\r\n                bad = true;\r\n                break;\r\n              }\r\n            }\r\n\r\n            if (!bad) {\r\n              dst.editors.push(editor);\r\n              dst.editormap[def.areaname] = editor;\r\n            }\r\n          }\r\n\r\n          for (let editor of src.editors) {\r\n            let def = editor.constructor.define();\r\n\r\n            dst.editormap[def.areaname] = editor;\r\n            dst.editors.push(editor);\r\n\r\n            if (editor.owning_sarea) {\r\n              editor.owning_sarea = dst;\r\n            }\r\n\r\n            if (editor.parentWidget) {\r\n              editor.parentWidget = dst;\r\n            }\r\n          }\r\n\r\n          if (cconst.useAreaTabSwitcher) {\r\n            for (let editor of dst.editors) {\r\n              if (editor.switcher) {\r\n                editor.switcher.flagUpdate();\r\n              }\r\n            }\r\n          }\r\n\r\n          dst.area = src.area;\r\n          dst.shadow.appendChild(src.area);\r\n\r\n          src.area = undefined;\r\n          src.editors = [];\r\n          src.editormap = {};\r\n\r\n          dst.on_resize(dst.size, dst.size);\r\n\r\n          dst.flushSetCSS();\r\n          dst.flushUpdate();\r\n\r\n          screen.removeArea(src);\r\n          screen.snapScreenVerts();\r\n\r\n          return;\r\n        } else {\r\n          screen.replaceArea(dst, src);\r\n        }\r\n\r\n        if (expand) {\r\n          console.log(\"\\nEXPANDING:\", src.size[0], src.size[1]);\r\n\r\n          src.pos[0] = mm.min[0];\r\n          src.pos[1] = mm.min[1];\r\n\r\n          src.size[0] = mm.max[0] - mm.min[0];\r\n          src.size[1] = mm.max[1] - mm.min[1];\r\n\r\n          src.loadFromPosSize();\r\n\r\n          screen._internalRegenAll();\r\n        }\r\n      } else {\r\n        //console.log(\"copying. . .\");\r\n        screen.replaceArea(dst, src.copy());\r\n        screen._internalRegenAll();\r\n      }\r\n    } else {\r\n      let src = this.sarea, dst = b.sarea;\r\n\r\n      let t = b.t;\r\n\r\n      let nsa = screen.splitArea(dst, t, b.horiz);\r\n\r\n      if (b.side === 'l' || b.side === 't') {\r\n        nsa = dst;\r\n      }\r\n\r\n      if (can_rip) {\r\n        //console.log(\"replacing\");\r\n        screen.replaceArea(nsa, src);\r\n      } else {\r\n        //console.log(\"copying\");\r\n        screen.replaceArea(nsa, src.copy());\r\n      }\r\n\r\n      screen._internalRegenAll();\r\n    }\r\n  }\r\n\r\n  makeBoxes(sa) {\r\n    let sz = util.isMobile() ? 100 : 40;\r\n    let cx = sa.pos[0] + sa.size[0]*0.5;\r\n    let cy = sa.pos[1] + sa.size[1]*0.5;\r\n\r\n    let color = this.color = \"rgba(200, 200, 200, 0.55)\";\r\n    let hcolor = this.hcolor = \"rgba(230, 230, 230, 0.75)\";\r\n    let idgen = 0;\r\n    let boxes = this.boxes;\r\n\r\n    let box = (x, y, sz, horiz, t, side) => {\r\n      //console.log(x, y, sz);\r\n\r\n      let b = this.overdraw.rect([x - sz[0]*0.5, y - sz[1]*0.5], sz, color);\r\n      b.style[\"border-radius\"] = \"14px\";\r\n\r\n      boxes.push(b);\r\n\r\n      b.sarea = sa;\r\n\r\n      let style = document.createElement(\"style\")\r\n      let cls = `mybox_${idgen++}`;\r\n\r\n      b.horiz = horiz;\r\n      b.t = t;\r\n      b.side = side;\r\n      b.setAttribute(\"class\", cls);\r\n      b.setAttribute(\"is_box\", true);\r\n\r\n      b.addEventListener(\"pointermove\", this.on_pointermove.bind(this));\r\n\r\n      let onclick = b.onclick = (e) => {\r\n        let type = e.type.toLowerCase();\r\n\r\n        if ((e.type === \"pointerdown\" || e.type === \"pointerup\") && e.button !== 0) {\r\n          return; //another handler will cancel\r\n        }\r\n\r\n        console.log(\"split click\");\r\n\r\n        if (!this._finished) {\r\n          this.finish();\r\n          this.doSplit(b);\r\n\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n        }\r\n      }\r\n\r\n      b.addEventListener(\"click\", onclick);\r\n      b.addEventListener(\"pointerdown\", onclick);\r\n      b.addEventListener(\"pointerup\", onclick);\r\n\r\n      b.addEventListener(\"pointerenter\", (e) => {\r\n        if (this.curbox !== undefined) {\r\n          if (this.curbox.rect) {\r\n            this.curbox.rect.remove()\r\n            this.curbox.rect = undefined;\r\n          }\r\n        }\r\n\r\n        if (b.rect !== undefined) {\r\n          b.rect.remove();\r\n          b.rect = undefined;\r\n        }\r\n\r\n        b.rect = this.getBoxRect(b);\r\n        this.curbox = b;\r\n\r\n        b.setColor(hcolor);\r\n        //b.style[\"background-color\"] = hcolor;\r\n      })\r\n\r\n      b.addEventListener(\"pointerleave\", (e) => {\r\n        if (b.rect) {\r\n          b.rect.remove();\r\n          b.rect = undefined;\r\n        }\r\n\r\n        if (this.curbox === b) {\r\n          this.curbox = undefined;\r\n        }\r\n\r\n        b.setColor(color);\r\n        //b.style[\"background-color\"] = color;\r\n      })\r\n\r\n      style.textContent = `\r\n        .${cls}:hover {\r\n          background-color : orange;\r\n          fill:orange;stroke-width:2\r\n        }\r\n      `\r\n      //console.log(style.textContent);\r\n      b.appendChild(style);\r\n      b.setAttribute(\"class\", cls);\r\n\r\n      return b;\r\n    }\r\n\r\n    let pad = 5;\r\n\r\n    if (this.sarea) {\r\n      box(cx, cy, [sz, sz], -1, -1, -1);\r\n    }\r\n\r\n    box(cx - sz*0.75 - pad, cy, [sz*0.5, sz], false, 0.5, 'l');\r\n    box(cx - sz*1.2 - pad, cy, [sz*0.25, sz], false, 0.3, 'l');\r\n\r\n    box(cx + sz*0.75 + pad, cy, [sz*0.5, sz], false, 0.5, 'r');\r\n    box(cx + sz*1.2 + pad, cy, [sz*0.25, sz], false, 0.7, 'r');\r\n\r\n    box(cx, cy - sz*0.75 - pad, [sz, sz*0.5], true, 0.5, 't');\r\n    box(cx, cy - sz*1.2 - pad, [sz, sz*0.25], true, 0.3, 't');\r\n\r\n    box(cx, cy + sz*0.75 + pad, [sz, sz*0.5], true, 0.5, 'b');\r\n    box(cx, cy + sz*1.2 + pad, [sz, sz*0.25], true, 0.7, 'b');\r\n  }\r\n\r\n  getActiveBox(x, y) {\r\n    for (let n of this.boxes) {\r\n      if (n.hasAttribute && n.hasAttribute(\"is_box\")) {\r\n        let rect = n.getClientRects()[0];\r\n\r\n        //console.log(rect.x, rect.y);\r\n        if (x >= rect.x && y >= rect.y && x < rect.x + rect.width && y < rect.y + rect.height) {\r\n          //console.log(\"found rect\");\r\n          return n;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  on_drag(e) {\r\n    this.on_pointermove(e);\r\n  }\r\n\r\n  on_dragend(e) {\r\n    this.on_pointerup(e);\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let wid = 55;\r\n    let color = \"rgb(200, 200, 200, 0.7)\";\r\n\r\n    //console.trace(\"pointer move!\", e.x, e.y, this.sarea);\r\n\r\n    /*\r\n     manually feed events to boxes so as to work right\r\n     with touch events; note that pushModalLight routes\r\n     touch to pointer events (if no touch handlers are present).\r\n     */\r\n    let n = this.getActiveBox(e.x, e.y);\r\n\r\n    if (n !== undefined) {\r\n      n.setColor(this.hcolor); //\"rgba(250, 250, 250, 0.75)\");\r\n    }\r\n    //console.log(\"pointer move\", n);\r\n\r\n    if (this.boxes.active !== undefined && this.boxes.active !== n) {\r\n      this.boxes.active.setColor(this.color);\r\n      this.boxes.active.dispatchEvent(new PointerEvent(\"pointerleave\", e));\r\n    }\r\n\r\n    if (n !== undefined) {\r\n      n.dispatchEvent(new PointerEvent(\"pointerenter\", e));\r\n    }\r\n\r\n    this.boxes.active = n;\r\n    /*\r\n    let rec = (n) => {\r\n      if (n.hasAttribute && n.hasAttribute(\"is_box\")) {\r\n        let rect = n.getClientRects()[0];\r\n\r\n        console.log(rect.x, rect.y);\r\n        if (x >= rect.x && x >= rect.y && x < rect.x+rect.width && y < rect.y+rect.height) {\r\n          console.log(\"found rect\");\r\n          n.dispatchEvent(\"pointerenter\", new PointerEvent(\"pointerenter\", e));\r\n        }\r\n      }\r\n      if (n === undefined || n.childNodes === undefined) {\r\n        return;\r\n      }\r\n\r\n      for (let n2 of n.childNodes) {\r\n        rec(n2);\r\n      }\r\n      if (n.shadow) {\r\n        for (let n2 of n.shadow.childNodes) {\r\n          rec(n2);\r\n        }\r\n      }\r\n    };\r\n\r\n    rec(this.overdraw);\r\n    //*/\r\n    if (this.sarea === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this.cursorbox === undefined) {\r\n      wid = 25;\r\n      this.cursorbox = this.overdraw.rect([e.x - wid*0.5, e.y - wid*0.5], [wid, wid], color);\r\n      this.cursorbox.style[\"pointer-events\"] = \"none\";\r\n    } else {\r\n      this.cursorbox.style[\"x\"] = (e.x - wid*0.5) + \"px\";\r\n      this.cursorbox.style[\"y\"] = (e.y - wid*0.5) + \"px\";\r\n    }\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    console.log(\"e.button\", e.button, e, e.x, e.y, this.getActiveBox(e.x, e.y));\r\n\r\n    if (e.button) {\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n    } else {\r\n      let box = this.getActiveBox(e.x, e.y);\r\n\r\n      if (box !== undefined) {\r\n        box.onclick(e);\r\n      }\r\n    }\r\n\r\n    this.finish();\r\n  }\r\n\r\n  modalStart(ctx) {\r\n    super.modalStart(...arguments);\r\n\r\n    let screen = this.screen;\r\n\r\n    this.overdraw.clear();\r\n\r\n    if (this.sarea && !this.excludeAreas.has(this.sarea)) {\r\n      let sa = this.sarea;\r\n      let box = this.overdraw.rect(sa.pos, sa.size, \"rgba(100, 100, 100, 0.5)\");\r\n\r\n      box.style[\"pointer-events\"] = \"none\";\r\n    }\r\n\r\n    for (let sa of screen.sareas) {\r\n      if (this.excludeAreas.has(sa)) {\r\n        continue;\r\n      }\r\n\r\n      this.makeBoxes(sa);\r\n    }\r\n  }\r\n\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case keymap[\"Escape\"]:\r\n      case keymap[\"Enter\"]:\r\n      case keymap[\"Space\"]:\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\n\r\nexport class AreaMoveAttachTool extends AreaDragTool {\r\n  constructor(screen, sarea, mpos) {\r\n    super(screen, sarea, mpos);\r\n\r\n    this.excludeAreas = new Set([sarea]);\r\n\r\n    this.dropArea = true;\r\n    this.first = true;\r\n    this.sarea = sarea;\r\n    this.mpos = new Vector2(mpos);\r\n    this.start_mpos2 = new Vector2(mpos);\r\n    this.start_pos = new Vector2(sarea.pos);\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let dx = e.x - this.start_mpos2[0];\r\n    let dy = e.y - this.start_mpos2[1];\r\n\r\n    let sarea = this.sarea;\r\n\r\n    if (this.first) {\r\n      this.start_mpos2 = new Vector2([e.x, e.y]);\r\n      this.first = false;\r\n      return;\r\n    }\r\n\r\n\r\n    sarea.pos[0] = this.start_pos[0] + dx;\r\n    sarea.pos[1] = this.start_pos[1] + dy;\r\n\r\n    sarea.loadFromPosSize();\r\n\r\n    this.mpos.loadXY(e.x, e.y);\r\n    super.on_pointermove(e);\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    super.on_pointerup(e);\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    super.on_pointerdown(e);\r\n  }\r\n\r\n  on_keydown(e) {\r\n    super.on_keydown(e);\r\n  }\r\n}\r\n\r\n//controller.registerTool(AreaDragTool);\r\n\r\nexport class ToolTipViewer extends ToolBase {\r\n  constructor(screen) {\r\n    super(screen);\r\n\r\n    this.tooltip = undefined;\r\n    this.element = undefined;\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Help Tool\",\r\n      toolpath   : \"screen.help_picker\",\r\n      icon       : ui_base.Icons.HELP,\r\n      description: \"view tooltips\",\r\n      is_modal   : true,\r\n      undoflag   : UndoFlags.NO_UNDO,\r\n      flag       : 0,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    this.pick(e);\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    this.pick(e);\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    this.finish();\r\n  }\r\n\r\n  finish() {\r\n    super.finish();\r\n  }\r\n\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case keymap.Escape:\r\n      case keymap.Enter:\r\n      case Keymap.Space:\r\n        if (this.tooltip) {\r\n          this.tooltip.end();\r\n        }\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n\r\n  pick(e) {\r\n    let x = e.x, y = e.y;\r\n\r\n    let ele = this.screen.pickElement(x, y);\r\n    console.log(ele ? ele.tagName : ele);\r\n\r\n    if (ele !== undefined && ele !== this.element && ele.title) {\r\n      if (this.tooltip) {\r\n        this.tooltip.end();\r\n      }\r\n\r\n      this.element = ele;\r\n      let tip = ele.title;\r\n\r\n      this.tooltip = ToolTip.show(tip, this.screen, x, y);\r\n    }\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n  }\r\n}\r\n\r\n","import nstructjs from '../path-controller/util/struct.js';\r\nimport * as ui_base from \"../core/ui_base.js\";\r\nimport * as FrameManager_ops from \"./FrameManager_ops.js\";\r\nimport cconst from \"../config/const.js\";\r\nimport {UIBase} from '../core/ui_base.js';\r\n\r\nimport {Vector2} from '../path-controller/util/vectormath.js';\r\nimport {createMenu, Menu} from '../widgets/ui_menu.js';\r\nimport {popModalLight, pushModalLight} from '../path-controller/util/simple_events.js';\r\n\r\nexport const AreaFlags = {\r\n  HIDDEN                : 1,\r\n  FLOATING              : 2,\r\n  INDEPENDENT           : 4, //area is indpendent of the screen mesh\r\n  NO_SWITCHER           : 8,\r\n  NO_HEADER_CONTEXT_MENU: 16,\r\n  NO_COLLAPSE           : 32,\r\n};\r\n\r\nexport let SnapLimit = 1;\r\n\r\nexport const BORDER_ZINDEX_BASE = 25\r\n\r\nexport function snap(c, snap_limit = SnapLimit) {\r\n  if (Array.isArray(c)) {\r\n    for (let i = 0; i < c.length; i++) {\r\n      c[i] = Math.floor(c[i]/snap_limit)*snap_limit;\r\n    }\r\n  } else {\r\n    c = Math.floor(c/snap_limit)*snap_limit;\r\n  }\r\n\r\n  return c;\r\n}\r\n\r\nexport function snapi(c, snap_limit = SnapLimit) {\r\n  //return snap(c, snap_limit);\r\n\r\n  if (Array.isArray(c)) {\r\n    for (let i = 0; i < c.length; i++) {\r\n      c[i] = Math.ceil(c[i]/snap_limit)*snap_limit;\r\n    }\r\n  } else {\r\n    c = Math.ceil(c/snap_limit)*snap_limit;\r\n  }\r\n\r\n  return c;\r\n}\r\n\r\nexport class ScreenVert extends Vector2 {\r\n  constructor(pos, id, added_id) {\r\n    super(pos);\r\n\r\n    this.added_id = added_id;\r\n    this.sareas = [];\r\n    this.borders = [];\r\n\r\n    this._id = id;\r\n  }\r\n\r\n  static hash(pos, added_id, limit) {\r\n    let x = snap(pos[0], limit);\r\n    let y = snap(pos[1], limit);\r\n\r\n    return \"\" + x + \":\" + y + \": + added_id\";\r\n  }\r\n\r\n  valueOf() {\r\n    return ScreenVert.hash(this, this.added_id);\r\n  }\r\n\r\n  [Symbol.keystr]() {\r\n    return ScreenVert.hash(this, this.added_id);\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n  }\r\n}\r\n\r\nScreenVert.STRUCT = `\r\npathux.ScreenVert {\r\n  0 : float;\r\n  1 : float;\r\n}\r\n`;\r\nnstructjs.register(ScreenVert);\r\n\r\nexport class ScreenHalfEdge {\r\n  constructor(border, sarea) {\r\n    this.sarea = sarea;\r\n    this.border = border;\r\n    this.side = sarea._side(border);\r\n  }\r\n\r\n  get v1() {\r\n    return this.border.v1;\r\n  }\r\n\r\n  get v2() {\r\n    return this.border.v2;\r\n  }\r\n\r\n  [Symbol.keystr]() {\r\n    return this.sarea._id + \":\" + this.border._id;\r\n  }\r\n\r\n}\r\n\r\nexport class ScreenBorder extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.visibleToPick = false;\r\n\r\n    this.screen = undefined;\r\n    this.v1 = undefined;\r\n    this.v2 = undefined;\r\n    this._id = undefined;\r\n\r\n    this._hash = undefined;\r\n\r\n    this.outer = undefined;\r\n\r\n    this.halfedges = []; //all bordering borders, including ones with nonshared verts\r\n    this.sareas = [];\r\n\r\n    this._innerstyle = document.createElement(\"style\");\r\n    this._style = undefined;\r\n\r\n    this.shadow.appendChild(this._innerstyle);\r\n\r\n    this.inner = document.createElement(\"div\");\r\n    //this.inner.innerText = \"sdfsdfsdf\";\r\n    this.shadow.appendChild(this.inner);\r\n\r\n    let call_menu = ScreenBorder.bindBorderMenu(this);\r\n\r\n    this.addEventListener(\"pointerdown\", (e) => {\r\n      let ok = this.movable;\r\n\r\n      if (e.button === 2) {\r\n        call_menu(e);\r\n        return;\r\n      }\r\n\r\n      if (!ok) {\r\n        console.log(\"border is not movable\");\r\n        return;\r\n      }\r\n\r\n      let tool = new FrameManager_ops.AreaResizeTool(this.screen, this, [e.x, e.y]);\r\n\r\n      tool.start();\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }, {capture: true});\r\n  }\r\n\r\n  static bindBorderMenu(elem, usePickElement = false) {\r\n    let on_dblclick = (e) => {\r\n      if (usePickElement && elem.pickElement(e.x, e.y) !== elem) {\r\n        return;\r\n      }\r\n\r\n      let menu = [\r\n        [\"Split Area\", () => {\r\n          elem.ctx.screen.splitTool();\r\n        }],\r\n        Menu.SEP,\r\n        [\"Collapse Area\", () => {\r\n          console.log(\"Collapse Area!\");\r\n          elem.ctx.screen.removeAreaTool(elem instanceof ScreenBorder ? elem : undefined);\r\n        }],\r\n      ];\r\n\r\n      menu = createMenu(elem.ctx, \"\", menu);\r\n      //if (e.button === 2) {\r\n      menu.ignoreFirstClick = 2;\r\n      //}\r\n\r\n      elem.ctx.screen.popupMenu(menu, e.x - 15, e.y - 15);\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n\r\n    elem.addEventListener(\"contextmenu\", (e) => e.preventDefault());\r\n    elem.addEventListener(\"dblclick\", on_dblclick, {capture: true});\r\n\r\n    return on_dblclick;\r\n  }\r\n\r\n  getOtherSarea(sarea) {\r\n    console.log(this.halfedges, this.halfedges.length);\r\n\r\n    for (let he of this.halfedges) {\r\n      console.log(he);\r\n\r\n      let ok = he.sarea !== sarea;\r\n      ok = ok && he.sarea._verts.indexOf(this.v1) >= 0;\r\n      ok = ok && he.sarea._verts.indexOf(this.v2) >= 0;\r\n\r\n      if (ok) {\r\n        return he.sarea;\r\n      }\r\n    }\r\n  }\r\n\r\n  get locked() {\r\n    for (let sarea of this.sareas) {\r\n      let mask = 1<<sarea._borders.indexOf(this);\r\n      let lock = sarea.borderLock & mask;\r\n\r\n      if (lock || (sarea.flag & AreaFlags.NO_COLLAPSE)) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  get dead() {\r\n    return !this.parentNode;\r\n  }\r\n\r\n  get side() {\r\n    throw new Error(\"side accedd\");\r\n  }\r\n\r\n  set side(val) {\r\n    throw new Error(\"side accedd\");\r\n  }\r\n\r\n  get valence() {\r\n    let ret = 0; //this.sareas.length;\r\n    let horiz = this.horiz;\r\n\r\n    let visit = {};\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let sv = i ? this.v2 : this.v1;\r\n      //console.log(sv);\r\n\r\n      for (let sa of sv.borders) {\r\n        if (sa.horiz != this.horiz)\r\n          continue;\r\n        if (sa._id in visit)\r\n          continue;\r\n\r\n        visit[sa._id] = 1;\r\n\r\n        let a0x = Math.min(this.v1[0], this.v2[0]);\r\n        let a0y = Math.min(this.v1[1], this.v2[1]);\r\n        let a1x = Math.max(this.v1[0], this.v2[0]);\r\n        let a1y = Math.max(this.v1[1], this.v2[1]);\r\n\r\n        let b0x = Math.min(sa.v1[0], sa.v2[0]);\r\n        let b0y = Math.min(sa.v1[1], sa.v2[1]);\r\n        let b1x = Math.min(sa.v1[0], sa.v2[0]);\r\n        let b1y = Math.min(sa.v1[1], sa.v2[1]);\r\n\r\n        let ok;\r\n\r\n        let eps = 0.001;\r\n        if (horiz) {\r\n          ok = (a0y <= b1y + eps && a1y >= a0y - eps);\r\n        } else {\r\n          ok = (a0x <= b1x + eps && a1x >= a0x - eps);\r\n        }\r\n\r\n        if (ok) {\r\n          //console.log(\"found\");\r\n          ret += sa.sareas.length;\r\n        }\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  get horiz() {\r\n    let dx = this.v2[0] - this.v1[0];\r\n    let dy = this.v2[1] - this.v1[1];\r\n\r\n    return Math.abs(dx) > Math.abs(dy);\r\n  }\r\n\r\n  static hash(v1, v2) {\r\n    return Math.min(v1._id, v2._id) + \":\" + Math.max(v1._id, v2._id);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"screenborder-x\",\r\n      style  : \"screenborder\"\r\n    };\r\n  }\r\n\r\n  otherVertex(v) {\r\n    if (v === this.v1)\r\n      return this.v2;\r\n    else\r\n      return this.v1;\r\n  }\r\n\r\n  setCSS() {\r\n    this.style[\"pointer-events\"] = this.movable ? \"auto\" : \"none\";\r\n\r\n    if (this._style === undefined) {\r\n      this._style = document.createElement(\"style\");\r\n      this.appendChild(this._style);\r\n    }\r\n\r\n    let dpi = UIBase.getDPI();\r\n\r\n    let pad = this.getDefault(\"mouse-threshold\")/dpi;\r\n    let wid = this.getDefault(\"border-width\");\r\n\r\n    let v1 = this.v1, v2 = this.v2;\r\n    let vec = new Vector2(v2).sub(v1);\r\n\r\n    let x = Math.min(v1[0], v2[0]), y = Math.min(v1[1], v2[1]);\r\n    let w, h;\r\n    let cursor, bstyle;\r\n\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"display\"] = this.horiz ? \"row\" : \"column\";\r\n    this.style[\"justify-content\"] = \"center\";\r\n    this.style[\"align-items\"] = \"center\";\r\n\r\n    if (!this.horiz) {\r\n      this.style[\"padding-left\"] = this.style[\"padding-right\"] = pad + \"px\";\r\n      x -= wid*0.5 + pad;\r\n\r\n      w = wid*2;\r\n      h = Math.abs(vec[1]);\r\n\r\n      cursor = 'e-resize';\r\n      bstyle = \"border-left-style : solid;\\n    border-right-style : solid;\\n\";\r\n      bstyle = \"border-top-style : none;\\n    border-bottom-style : none;\\n\";\r\n    } else {\r\n      this.style[\"padding-top\"] = this.style[\"padding-bottom\"] = pad + \"px\";\r\n      y -= wid*0.5 + pad;\r\n\r\n      w = Math.abs(vec[0]);\r\n      h = wid;\r\n\r\n      cursor = 'n-resize';\r\n      bstyle = \"border-top-style : solid;\\n    border-bottom-style : solid;\\n\";\r\n    }\r\n\r\n\r\n    let color = this.getDefault(\"border-outer\");\r\n    let debug = cconst.DEBUG.screenborders;\r\n\r\n    if (debug) {\r\n      wid = 4;\r\n      let alpha = 1.0;\r\n      let c = this.sareas.length*75;\r\n\r\n      let r = 0, g = 0, b = 0;\r\n\r\n      if (this.movable) {\r\n        b = 255;\r\n      }\r\n      if (this.halfedges.length > 1) {\r\n        g = 255;\r\n      }\r\n      if (this.outer) {\r\n        r = 255;\r\n      }\r\n      color = `rgba(${r}, ${g}, ${b}, ${alpha})`;\r\n    }\r\n\r\n\r\n    let innerbuf = `\r\n        .screenborder_inner_${this._id} {\r\n          ${bstyle}\r\n          ${this.horiz ? 'height' : 'width'} : ${wid}px;\r\n          ${!this.horiz ? 'height' : 'width'} : 100%;\r\n          margin : 0px;\r\n          padding : 0px;\r\n          \r\n          background-color : ${this.getDefault(\"border-inner\")};\r\n          border-color : ${color};\r\n          border-width : ${wid*0.5}px;\r\n          border-style : ${debug && this.outer ? \"dashed\" : \"solid\"};\r\n          pointer-events : none;\r\n        }`;\r\n\r\n    let sbuf = `\r\n        .screenborder_${this._id} {\r\n        }\r\n    `;\r\n\r\n    let ok = this.movable;\r\n    if (!this.outer) {\r\n      for (let sarea of this.sareas) {\r\n        ok = ok || sarea.floating;\r\n      }\r\n    }\r\n\r\n    if (ok) {\r\n      sbuf += `\r\n        .screenborder_${this._id}:hover {\r\n          cursor : ${cursor};\r\n        }\r\n      `;\r\n    }\r\n\r\n    this._style.textContent = sbuf;\r\n    this._innerstyle.textContent = innerbuf;\r\n\r\n    this.setAttribute(\"class\", \"screenborder_\" + this._id);\r\n    this.inner.setAttribute(\"class\", \"screenborder_inner_\" + this._id);\r\n\r\n    this.style[\"position\"] = UIBase.PositionKey;\r\n    this.style[\"left\"] = x + \"px\";\r\n    this.style[\"top\"] = y + \"px\";\r\n    this.style[\"width\"] = w + \"px\";\r\n    this.style[\"height\"] = h + \"px\";\r\n    this.style[\"z-index\"] = \"\" + BORDER_ZINDEX_BASE;\r\n  }\r\n\r\n  valueOf() {\r\n    return ScreenBorder.hash(this.v1, this.v2);\r\n  }\r\n\r\n  [Symbol.keystr]() {\r\n    return ScreenBorder.hash(this.v1, this.v2);\r\n  }\r\n}\r\n\r\nui_base.UIBase.internalRegister(ScreenBorder);\r\n","let _ScreenArea = undefined;\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as ui from '../core/ui.js';\r\nimport * as ui_noteframe from '../widgets/ui_noteframe.js';\r\nimport {haveModal} from '../path-controller/util/simple_events.js';\r\nimport cconst from '../config/const.js';\r\n\r\nimport nstructjs from '../path-controller/util/struct.js';\r\n\r\nlet UIBase = ui_base.UIBase;\r\n\r\nimport {EnumProperty} from \"../path-controller/toolsys/toolprop.js\";\r\n\r\nlet Vector2 = vectormath.Vector2;\r\nlet Screen = undefined;\r\n\r\nimport {AreaFlags, BORDER_ZINDEX_BASE, ScreenBorder, snap, snapi} from './FrameManager_mesh.js';\r\n\r\nexport {AreaFlags};\r\n\r\nexport * from './area_wrangler.js';\r\nimport {getAreaIntName, setAreaTypes, contextWrangler, AreaWrangler, areaclasses} from './area_wrangler.js';\r\n\r\nexport {contextWrangler};\r\n\r\nwindow._contextWrangler = contextWrangler;\r\n\r\nexport const BorderMask = {\r\n  LEFT  : 1,\r\n  BOTTOM: 2,\r\n  RIGHT : 4,\r\n  TOP   : 8,\r\n  ALL   : 1 | 2 | 4 | 8\r\n};\r\n\r\nexport const BorderSides = {\r\n  LEFT  : 0,\r\n  BOTTOM: 1,\r\n  RIGHT : 2,\r\n  TOP   : 3\r\n};\r\n\r\n/**\r\n * Base class for all editors\r\n **/\r\nexport class Area extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    /**\r\n     * -----b4----\r\n     *\r\n     * b1       b3\r\n     *\r\n     * -----b2----\r\n     *\r\n     * */\r\n\r\n    let def = this.constructor.define();\r\n\r\n    //set bits in mask to keep\r\n    //borders from moving\r\n    this.borderLock = def.borderLock || 0;\r\n    this.flag = def.flag || 0;\r\n\r\n    this.inactive = true;\r\n    this.areaDragToolEnabled = true;\r\n\r\n    this.owning_sarea = undefined;\r\n    this._area_id = contextWrangler.idgen++;\r\n\r\n    this.pos = undefined; //set by screenarea parent\r\n    this.size = undefined; //set by screenarea parent\r\n    this.minSize = [5, 5];\r\n    this.maxSize = [undefined, undefined];\r\n\r\n    let appendChild = this.shadow.appendChild;\r\n    this.shadow.appendChild = (child) => {\r\n      appendChild.call(this.shadow, child);\r\n      if (child instanceof UIBase) {\r\n        child.parentWidget = this;\r\n      }\r\n    }\r\n\r\n    let prepend = this.shadow.prepend;\r\n    this.shadow.prepend = (child) => {\r\n      prepend.call(this.shadow, child);\r\n\r\n      if (child instanceof UIBase) {\r\n        child.parentWidget = this;\r\n      }\r\n    };\r\n  }\r\n\r\n  get floating() {\r\n    return ~~(this.flag & AreaFlags.FLOATING);\r\n  }\r\n\r\n  set floating(val) {\r\n    if (val) {\r\n      this.flag |= AreaFlags.FLOATING;\r\n    } else {\r\n      this.flag &= ~AreaFlags.FLOATING;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get active area as defined by push_ctx_active and pop_ctx_active.\r\n   *\r\n   * Type should be an Area subclass, if undefined the last accessed area\r\n   * will be returned.\r\n   * */\r\n  static getActiveArea(type) {\r\n    return contextWrangler.getLastArea(type);\r\n  }\r\n\r\n  static unregister(cls) {\r\n    let def = cls.define();\r\n\r\n    if (!def.areaname) {\r\n      throw new Error(\"Missing areaname key in define()\");\r\n    }\r\n\r\n    if (def.areaname in areaclasses) {\r\n      delete areaclasses[def.areaname];\r\n    }\r\n  }\r\n\r\n  /*\r\n  addEventListener(type, cb, options) {\r\n    let cb2 = (e) => {\r\n      let x, y;\r\n      let screen = this.getScreen();\r\n\r\n      if (!screen) {\r\n        console.warn(\"no screen!\");\r\n        return cb(elem);\r\n      }\r\n\r\n      if (type.startsWith(\"mouse\")) {\r\n        x = e.x; y = e.y;\r\n      } else if (type.startsWith(\"touch\") && e.touches && e.touches.length > 0) {\r\n        x = e.touches[0].pageX; y = e.touches[0].pageY;\r\n      } else if (type.startsWith(\"pointer\")) {\r\n        x = e.x; y = e.y;\r\n      } else {\r\n        if (screen) {\r\n          x = screen.mpos[0];\r\n          y = screen.mpos[1];\r\n        } else {\r\n          x = y = -100;\r\n        }\r\n      }\r\n\r\n      let elem = screen.pickElement(x, y);\r\n      console.log(elem ? elem.tagName : undefined);\r\n\r\n      if (elem === this || elem === this.owning_sarea) {\r\n        return cb(elem);\r\n      }\r\n    };\r\n\r\n    cb.__cb2 = cb2;\r\n    return super.addEventListener(type, cb2, options);\r\n  }\r\n\r\n  removeEventListener(type, cb, options) {\r\n    super.removeEventListener(type, cb.__cb2, options);\r\n  }\r\n  //*/\r\n\r\n  static register(cls) {\r\n    let def = cls.define();\r\n\r\n    if (!def.areaname) {\r\n      throw new Error(\"Missing areaname key in define()\");\r\n    }\r\n\r\n    areaclasses[def.areaname] = cls;\r\n\r\n    ui_base.UIBase.internalRegister(cls);\r\n  }\r\n\r\n  static makeAreasEnum() {\r\n    let areas = {};\r\n    let icons = {};\r\n    let i = 0;\r\n\r\n    for (let k in areaclasses) {\r\n      let cls = areaclasses[k];\r\n      let def = cls.define();\r\n\r\n      if (def.flag & AreaFlags.HIDDEN)\r\n        continue;\r\n\r\n      let uiname = def.uiname;\r\n\r\n      if (uiname === undefined) {\r\n        uiname = k.replace(\"_\", \" \").toLowerCase();\r\n        uiname = uiname[0].toUpperCase() + uiname.slice(1, uiname.length);\r\n      }\r\n\r\n      areas[uiname] = k;\r\n      icons[uiname] = def.icon !== undefined ? def.icon : -1;\r\n    }\r\n\r\n    let prop = new EnumProperty(undefined, areas);\r\n    prop.addIcons(icons);\r\n\r\n    return prop;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname : \"pathux-editor-x\", // tag name, e.g. editor-x\r\n      areaname: undefined, //api name for area type\r\n      flag    : 0, //see AreaFlags\r\n      uiname  : undefined,\r\n      icon    : undefined //icon representing area in MakeHeader's area switching menu. Integer.\r\n    };\r\n  }\r\n\r\n  static newSTRUCT() {\r\n    return UIBase.createElement(this.define().tagname);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"overflow\"] = \"hidden\";\r\n    this.noMarginsOrPadding();\r\n\r\n    let onover = (e) => {\r\n      //console.log(this._area_id, this.ctx.workspace._area_id);\r\n\r\n      //try to trigger correct entry in context area stacks\r\n      this.push_ctx_active();\r\n      this.pop_ctx_active();\r\n    };\r\n\r\n    //*\r\n    super.addEventListener(\"mouseover\", onover, {passive: true});\r\n    super.addEventListener(\"mousemove\", onover, {passive: true});\r\n    super.addEventListener(\"mousein\", onover, {passive: true});\r\n    super.addEventListener(\"mouseenter\", onover, {passive: true});\r\n    super.addEventListener(\"touchstart\", onover, {passive: true});\r\n    super.addEventListener(\"focusin\", onover, {passive: true});\r\n    super.addEventListener(\"focus\", onover, {passive: true});\r\n    //*/\r\n  }\r\n\r\n  _get_v_suffix() {\r\n    if (this.flag & AreaFlags.INDEPENDENT) {\r\n      return this._id;\r\n    } else {\r\n      return \"\";\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Return a list of keymaps used by this editor\r\n   * @returns {Array<KeyMap>}\r\n   */\r\n  getKeyMaps() {\r\n    return this.keymap !== undefined ? [this.keymap] : [];\r\n  }\r\n\r\n  on_fileload(isActiveEditor) {\r\n    contextWrangler.reset();\r\n  }\r\n\r\n  buildDataPath() {\r\n    let p = this;\r\n\r\n    let sarea = this.owning_sarea;\r\n\r\n    if (sarea === undefined || sarea.screen === undefined) {\r\n      console.warn(\"Area.buildDataPath(): Failed to build data path\");\r\n      return \"\";\r\n    }\r\n\r\n    let screen = sarea.screen;\r\n\r\n    let idx1 = screen.sareas.indexOf(sarea);\r\n    let idx2 = sarea.editors.indexOf(this);\r\n\r\n    if (idx1 < 0 || idx2 < 0) {\r\n      throw new Error(\"malformed area data\");\r\n    }\r\n\r\n    let ret = `screen.sareas[${idx1}].editors[${idx2}]`;\r\n    return ret;\r\n  }\r\n\r\n  saveData() {\r\n    return {\r\n      _area_id: this._area_id,\r\n      areaName: this.areaName\r\n    };\r\n  }\r\n\r\n  loadData(obj) {\r\n    let id = obj._area_id;\r\n\r\n    if (id !== undefined && id !== null) {\r\n      this._area_id = id;\r\n    }\r\n  }\r\n\r\n  draw() {\r\n  }\r\n\r\n  copy() {\r\n    console.warn(\"You might want to implement this, Area.prototype.copy based method called\");\r\n    let ret = UIBase.createElement(this.constructor.define().tagname);\r\n    return ret;\r\n  }\r\n\r\n  on_resize(size, oldsize) {\r\n    super.on_resize(size, oldsize);\r\n  }\r\n\r\n  on_area_focus() {\r\n\r\n  }\r\n\r\n  on_area_blur() {\r\n\r\n  }\r\n\r\n  /** called when editors are swapped with another editor type*/\r\n  on_area_active() {\r\n  }\r\n\r\n  /** called when editors are swapped with another editor type*/\r\n  on_area_inactive() {\r\n  }\r\n\r\n  /*\r\n  * This is needed so UI controls can know what their parent area is.\r\n  * For example, a slider with data path \"view2d.zoomfac\" needs to know where\r\n  * to find view2d.\r\n  *\r\n  * Typically this works by adding a field to a ContextOverlay:\r\n  *\r\n  * class ContextOverlay {\r\n  *   get view3d() {\r\n  *     return Area.getActiveArea(View3D);\r\n  *   }\r\n  * }\r\n  *\r\n  * Make sure to wrap event callbacks in push_ctx_active and pop_ctx_active.\r\n  * */\r\n  push_ctx_active(dontSetLastRef = false) {\r\n    contextWrangler.updateLastRef(this.constructor, this);\r\n    contextWrangler.push(this.constructor, this, !dontSetLastRef);\r\n  }\r\n\r\n  /**\r\n   * see push_ctx_active\r\n   * */\r\n  pop_ctx_active(dontSetLastRef = false) {\r\n    contextWrangler.pop(this.constructor, this, !dontSetLastRef);\r\n  }\r\n\r\n  getScreen() {\r\n    //XXX\r\n    //return _appstate.screen;\r\n    throw new Error(\"replace me in Area.prototype\");\r\n  }\r\n\r\n  toJSON() {\r\n    return Object.assign(super.toJSON(), {\r\n      areaname: this.constructor.define().areaname,\r\n      _area_id: this._area_id\r\n    });\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n    this._area_id = obj._area_id;\r\n\r\n    return this;\r\n  }\r\n\r\n  getBarHeight() {\r\n    return this.header.getClientRects()[0].height;\r\n  }\r\n\r\n  makeAreaSwitcher(container) {\r\n    if (cconst.useAreaTabSwitcher) {\r\n      let ret = UIBase.createElement(\"area-docker-x\");\r\n      container.add(ret);\r\n      return ret;\r\n    }\r\n\r\n    let prop = Area.makeAreasEnum();\r\n\r\n    let dropbox = container.listenum(undefined, {\r\n      name    : this.constructor.define().uiname,\r\n      enumDef : prop,\r\n      callback: (id) => {\r\n        let cls = areaclasses[id];\r\n        this.owning_sarea.switch_editor(cls);\r\n      }\r\n    });\r\n\r\n    dropbox.update.after(() => {\r\n      let name = this.constructor.define().uiname;\r\n      let val = prop.values[name];\r\n\r\n      if (dropbox.value !== val && val in prop.keys) {\r\n        val = prop.keys[val];\r\n      }\r\n\r\n      if (dropbox.value !== val) {\r\n        dropbox.setValue(prop.values[name], true);\r\n      }\r\n    });\r\n\r\n    return dropbox;\r\n  }\r\n\r\n  makeHeader(container, add_note_area = true, make_draggable = true) {\r\n    let switcherRow;\r\n    let row;\r\n    let helpRow;\r\n\r\n    if (this.header) {\r\n      this.header.remove()\r\n      this.header = undefined\r\n    }\r\n\r\n    if (!(this.flag & AreaFlags.NO_SWITCHER) && cconst.useAreaTabSwitcher) {\r\n      let col = this.header = container.col();\r\n\r\n      switcherRow = helpRow = col.row();\r\n      row = col.row();\r\n    } else {\r\n      row = helpRow = switcherRow = this.header = container.row();\r\n    }\r\n\r\n    if (!(this.flag & AreaFlags.NO_HEADER_CONTEXT_MENU)) {\r\n      let callmenu = ScreenBorder.bindBorderMenu(this.header, true);\r\n\r\n      this.addEventListener(\"mousedown\", e => {\r\n        if (e.button !== 2 || this.header.pickElement(e.x, e.y) !== this.header) {\r\n          return;\r\n        }\r\n\r\n        callmenu(e);\r\n      });\r\n    }\r\n\r\n    this.header.remove();\r\n    container._prepend(this.header);\r\n\r\n    row.setCSS.after(() => row.background = this.getDefault(\"AreaHeaderBG\"));\r\n\r\n    let rh = ~~(16*this.getDPI());\r\n\r\n    //container.setSize(undefined, rh);\r\n    //row.setSize(undefined, rh);\r\n    //row.setSize(undefined, rh);\r\n\r\n    container.noMarginsOrPadding();\r\n    row.noMarginsOrPadding();\r\n\r\n    row.style[\"width\"] = \"100%\";\r\n    row.style[\"margin\"] = \"0px\";\r\n    row.style[\"padding\"] = \"0px\";\r\n\r\n    if (!(this.flag & AreaFlags.NO_SWITCHER)) {\r\n      if (this.switcher) {\r\n        //add back same switcher\r\n        switcherRow.add(this.switcher);\r\n      } else {\r\n        this.switcher = this.makeAreaSwitcher(cconst.useAreaTabSwitcher ? switcherRow : row);\r\n      }\r\n    }\r\n\r\n    if (util.isMobile() || cconst.addHelpPickers) {\r\n      if (this.helppicker) {\r\n        this.helppicker.remove();\r\n      }\r\n\r\n      this.helppicker = helpRow.helppicker();\r\n      this.helppicker.iconsheet = 0;\r\n    }\r\n\r\n    if (add_note_area) {\r\n      let notef = UIBase.createElement(\"noteframe-x\");\r\n      notef.ctx = this.ctx;\r\n      row._add(notef);\r\n    }\r\n\r\n    /* don't do normal dragging for tab switchers */\r\n    if (cconst.useAreaTabSwitcher) {\r\n      return row;\r\n    }\r\n\r\n    let eventdom = this.header;\r\n\r\n    let mdown = false;\r\n    let mpos = new Vector2();\r\n\r\n    let mpre = (e, pageX, pageY) => {\r\n      if (haveModal()) {\r\n        return;\r\n      }\r\n\r\n      pageX = pageX === undefined ? e.x : pageX;\r\n      pageY = pageY === undefined ? e.y : pageY;\r\n\r\n      let node = this.getScreen().pickElement(pageX, pageY);\r\n\r\n      /*\r\n      while (node) {\r\n        if (node === row) {\r\n          break;\r\n        }\r\n        node = node.parentWidget;\r\n      }//*/\r\n\r\n      //console.log(node === row, node ? node._id : undefined, row._id)\r\n\r\n      if (node !== row) {\r\n        return false;\r\n      }\r\n\r\n      return true;\r\n    }\r\n\r\n    eventdom.addEventListener(\"pointerout\", (e) => {\r\n      //console.log(\"pointerout\", e);\r\n      mdown = false;\r\n    });\r\n    eventdom.addEventListener(\"pointerleave\", (e) => {\r\n      mdown = false;\r\n      //console.log(\"pointerleave\", e);\r\n    });\r\n\r\n    eventdom.addEventListener(\"pointerdown\", (e) => {\r\n      //console.log(\"pointerdown\", e, mpre(e));\r\n\r\n      if (!mpre(e)) return;\r\n\r\n      mpos[0] = e.pageX;\r\n      mpos[1] = e.pageY;\r\n      mdown = true;\r\n    });\r\n\r\n    let last_time = util.time_ms();\r\n\r\n    let do_mousemove = (e, pageX, pageY) => {\r\n      if (haveModal() || !make_draggable) {\r\n        return;\r\n      }\r\n\r\n      let mdown2 = e.buttons !== 0 || (e.touches && e.touches.length > 0);\r\n      mdown2 = mdown2 && mdown;\r\n\r\n      //console.log(\"area drag?\", e, mdown2, e.pageX, e.pageY, mpre(e, pageX, pageY), e.was_touch);\r\n\r\n      //calls to pickElement in mpre are expensive\r\n      if (util.time_ms() - last_time < 250) {\r\n        return;\r\n      }\r\n\r\n      last_time = util.time_ms;\r\n\r\n      if (!mdown2 || !mpre(e, pageX, pageY)) return;\r\n\r\n\r\n      if (e.type === \"mousemove\" && e.was_touch) {\r\n        //okay how are patched events getting here?\r\n        //avoid double call. . .\r\n        return;\r\n      }\r\n\r\n      //console.log(mdown);\r\n      let dx = pageX - mpos[0];\r\n      let dy = pageY - mpos[1];\r\n\r\n      let dis = dx*dx + dy*dy;\r\n      let limit = 7;\r\n\r\n      if (dis > limit*limit) {\r\n        let sarea = this.owning_sarea;\r\n        if (sarea === undefined) {\r\n          console.warn(\"Error: missing sarea ref\");\r\n          return;\r\n        }\r\n\r\n        let screen = sarea.screen;\r\n        if (screen === undefined) {\r\n          console.log(\"Error: missing screen ref\");\r\n          return;\r\n        }\r\n\r\n        if (!this.areaDragToolEnabled) {\r\n          return;\r\n        }\r\n        mdown = false;\r\n        console.log(\"area drag tool!\", e.type, e);\r\n        screen.areaDragTool(this.owning_sarea);\r\n      }\r\n    };\r\n\r\n    //not working on mobile\r\n    //row.setAttribute(\"draggable\", true);\r\n    //row.draggable = true;\r\n    /*\r\n    eventdom.addEventListener(\"dragstart\", (e) => {\r\n      return;\r\n      console.log(\"drag start!\", e);\r\n      e.dataTransfer.setData(\"text/json\", \"SplitAreaDrag\");\r\n\r\n      let canvas = document.createElement(\"canvas\");\r\n      let g = canvas.g;\r\n\r\n      canvas.width = 32;\r\n      canvas.height = 32;\r\n\r\n      e.dataTransfer.setDragImage(canvas, 0, 0);\r\n\r\n      mdown = false;\r\n      console.log(\"area drag tool!\");\r\n      this.getScreen().areaDragTool(this.owning_sarea);\r\n    });\r\n\r\n    eventdom.addEventListener(\"drag\", (e) => {\r\n      console.log(\"drag!\", e);\r\n    });*/\r\n\r\n    eventdom.addEventListener(\"pointermove\", (e) => {\r\n      return do_mousemove(e, e.pageX, e.pageY);\r\n    }, false);\r\n    eventdom.addEventListener(\"pointerup\", (e) => {\r\n      console.log(\"pointerup\", e);\r\n      mdown = false;\r\n    }, false);\r\n    eventdom.addEventListener(\"pointercancel\", (e) => {\r\n      console.log(\"pointercancel\", e);\r\n      mdown = false;\r\n    }, false);\r\n\r\n    return row;\r\n  }\r\n\r\n  setCSS() {\r\n    if (this.size !== undefined) {\r\n      this.style[\"position\"] = UIBase.PositionKey;\r\n      //this.style[\"left\"] = this.pos[0] + \"px\";\r\n      //this.style[\"top\"] = this.pos[1] + \"px\";\r\n      this.style[\"width\"] = this.size[0] + \"px\";\r\n      this.style[\"height\"] = this.size[1] + \"px\";\r\n    }\r\n  }\r\n\r\n  update() {\r\n    //don't update non-active editors\r\n    if (this.owning_sarea === undefined || this !== this.owning_sarea.area) {\r\n      return;\r\n    }\r\n\r\n    super.update();\r\n\r\n    //see FrameManager.js, we use a single update\r\n    //function for everything now\r\n    //this._forEachChildWidget((n) => {\r\n    //  n.update();\r\n    //});\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n  }\r\n\r\n  _isDead() {\r\n    if (this.dead) {\r\n      return true;\r\n    }\r\n\r\n    let screen = this.getScreen();\r\n\r\n    if (screen === undefined)\r\n      return true;\r\n\r\n    if (screen.parentNode === undefined)\r\n      return true;\r\n  }\r\n\r\n  //called by owning ScreenArea on file load\r\n  afterSTRUCT() {\r\n    let f = () => {\r\n      if (this._isDead()) {\r\n        return;\r\n      }\r\n      if (!this.ctx) {\r\n        this.doOnce(f);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        ui_base.loadUIData(this, this.saved_uidata);\r\n        this.saved_uidata = undefined;\r\n      } catch (error) {\r\n        console.log(\"failed to load ui data\");\r\n        util.print_stack(error);\r\n      }\r\n    };\r\n\r\n    this.doOnce(f);\r\n  }\r\n\r\n  _getSavedUIData() {\r\n    return ui_base.saveUIData(this, \"area\");\r\n  }\r\n}\r\n\r\nArea.STRUCT = `\r\npathux.Area { \r\n  flag : int;\r\n  saved_uidata : string | obj._getSavedUIData();\r\n}\r\n`\r\n\r\nnstructjs.register(Area, \"pathux.Area\");\r\nui_base.UIBase.internalRegister(Area);\r\n\r\nexport class ScreenArea extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._flag = undefined;\r\n\r\n    this.flag = 0; /** holds AreaFlags.FLOATING and AreaFlags.INDEPENDENT */\r\n\r\n    this._borders = [];\r\n    this._verts = [];\r\n    this.dead = false;\r\n\r\n    this._sarea_id = contextWrangler.idgen++;\r\n\r\n    this._pos = new Vector2();\r\n    this._size = new Vector2([512, 512]);\r\n\r\n    if (cconst.DEBUG.screenAreaPosSizeAccesses) {\r\n      let wrapVector = (name, axis) => {\r\n        Object.defineProperty(this[name], axis, {\r\n          get: function () {\r\n            return this[\"_\" + axis];\r\n          },\r\n\r\n          set: function (val) {\r\n            console.warn(`ScreenArea.${name}[${axis}] set:`, val);\r\n            this[\"_\" + axis] = val;\r\n          }\r\n        });\r\n      };\r\n\r\n      wrapVector(\"size\", 0);\r\n      wrapVector(\"size\", 1);\r\n      wrapVector(\"pos\", 0);\r\n      wrapVector(\"pos\", 1);\r\n    }\r\n\r\n    this.area = undefined;\r\n    this.editors = [];\r\n    this.editormap = {};\r\n\r\n    this.addEventListener(\"mouseover\", (e) => {\r\n      if (haveModal()) {\r\n        return;\r\n      }\r\n\r\n      //console.log(\"screen area mouseover\");\r\n      let screen = this.getScreen();\r\n      if (screen.sareas.active !== this && screen.sareas.active && screen.sareas.active.area) {\r\n        screen.sareas.active.area.on_area_blur();\r\n      }\r\n\r\n      if (this.area && screen.sareas.active !== this) {\r\n        this.area.on_area_focus();\r\n      }\r\n\r\n      screen.sareas.active = this;\r\n    });\r\n\r\n    //this.addEventListener(\"mouseleave\", (e) => {\r\n    //console.log(\"screen area mouseleave\");\r\n    //});\r\n  }\r\n\r\n  /*\r\n  saveData() {\r\n    return {\r\n      _sarea_id : this._sarea_id,\r\n      pos       : this.pos,\r\n      size      : this.size,\r\n    };\r\n  }\r\n  loadData(obj) {\r\n    super.loadData(obj);\r\n\r\n    let id = obj._sarea_id;\r\n    \r\n    let type = obj.areatype;\r\n    \r\n    if (id !== undefined && id !== null) {\r\n      this._sarea_id = id;\r\n    }\r\n    \r\n    for (let area of this.editors) {\r\n      if (area.areaType == type) {\r\n        console.log(\"             found saved area type\");\r\n        \r\n        this.switch_editor(area.constructor);\r\n      }\r\n    }\r\n    \r\n    this.pos.load(obj.pos);\r\n    this.size.load(obj.size);\r\n  }//*/\r\n\r\n  get floating() {\r\n    return this.flag & AreaFlags.FLOATING;\r\n  }\r\n\r\n  set floating(val) {\r\n    if (val) {\r\n      this.flag |= AreaFlags.FLOATING;\r\n    } else {\r\n      this.flag &= ~AreaFlags.FLOATING;\r\n    }\r\n  }\r\n\r\n  get flag() {\r\n    let flag = this._flag & (AreaFlags.FLOATING | AreaFlags.INDEPENDENT);\r\n\r\n    if (this.area) {\r\n      flag |= this.area.flag;\r\n    }\r\n\r\n    return flag;\r\n  }\r\n\r\n  set flag(v) {\r\n    this._flag &= ~(AreaFlags.FLOATING | AreaFlags.INDEPENDENT);\r\n    this._flag |= v & (AreaFlags.FLOATING | AreaFlags.INDEPENDENT);\r\n\r\n    if (this.area) {\r\n      this.area.flag |= v & ~(AreaFlags.FLOATING | AreaFlags.INDEPENDENT);\r\n    }\r\n  }\r\n\r\n  get borderLock() {\r\n    return this.area !== undefined ? this.area.borderLock : 0;\r\n  }\r\n\r\n  get minSize() {\r\n    return this.area !== undefined ? this.area.minSize : this.size;\r\n  }\r\n\r\n  get maxSize() {\r\n    return this.area !== undefined ? this.area.maxSize : this.size;\r\n  }\r\n\r\n  get pos() {\r\n    return this._pos;\r\n  }\r\n\r\n  set pos(val) {\r\n    if (cconst.DEBUG.screenAreaPosSizeAccesses) {\r\n      console.log(\"ScreenArea set pos\", val);\r\n    }\r\n    this._pos.load(val);\r\n  }\r\n\r\n  get size() {\r\n    return this._size;\r\n  }\r\n\r\n  set size(val) {\r\n    if (cconst.DEBUG.screenAreaPosSizeAccesses) {\r\n      console.log(\"ScreenArea set size\", val);\r\n    }\r\n    this._size.load(val);\r\n  }\r\n\r\n  static newSTRUCT() {\r\n    return UIBase.createElement(\"screenarea-x\");\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"screenarea-x\"\r\n    };\r\n  }\r\n\r\n  _get_v_suffix() {\r\n    return this.area ? this.area._get_v_suffix() : \"\";\r\n  }\r\n\r\n  bringToFront() {\r\n    let screen = this.getScreen();\r\n\r\n    HTMLElement.prototype.remove.call(this);\r\n    screen.sareas.remove(this);\r\n\r\n    screen.appendChild(this);\r\n\r\n    let zindex = BORDER_ZINDEX_BASE + 1;\r\n\r\n    if (screen.style[\"z-index\"]) {\r\n      zindex = parseInt(screen.style[\"z-index\"]) + 1;\r\n    }\r\n\r\n    for (let sarea of screen.sareas) {\r\n      let zindex = sarea.style[\"z-index\"];\r\n      if (sarea.style[\"z-index\"]) {\r\n        zindex = Math.max(zindex, parseInt(sarea.style[\"z-index\"]) + 1);\r\n      }\r\n    }\r\n\r\n    this.style[\"z-index\"] = zindex;\r\n  }\r\n\r\n  _side(border) {\r\n    let ret = this._borders.indexOf(border);\r\n    if (ret < 0) {\r\n      throw new Error(\"border not in screen area\");\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.noMarginsOrPadding();\r\n  }\r\n\r\n  draw() {\r\n    if (this.area && this.area.draw) {\r\n      this.area.push_ctx_active();\r\n      this.area.draw();\r\n      this.area.pop_ctx_active();\r\n    }\r\n  }\r\n\r\n  _isDead() {\r\n    if (this.dead) {\r\n      return true;\r\n    }\r\n\r\n    let screen = this.getScreen();\r\n\r\n    if (screen === undefined)\r\n      return true;\r\n\r\n    if (screen.parentNode === undefined)\r\n      return true;\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = {\r\n      editors  : this.editors,\r\n      _sarea_id: this._sarea_id,\r\n      area     : this.area.constructor.define().areaname,\r\n      pos      : this.pos,\r\n      size     : this.size\r\n    };\r\n\r\n    return Object.assign(super.toJSON(), ret);\r\n  }\r\n\r\n  on_keydown(e) {\r\n    if (this.area.on_keydown) {\r\n      this.area.push_ctx_active();\r\n      this.area.on_keydown(e);\r\n      this.area.pop_ctx_active();\r\n    }\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    if (obj === undefined) {\r\n      console.warn(\"undefined in loadJSON\");\r\n      return;\r\n    }\r\n\r\n    super.loadJSON(obj);\r\n\r\n    this.pos.load(obj.pos);\r\n    this.size.load(obj.size);\r\n\r\n    for (let editor of obj.editors) {\r\n      let areaname = editor.areaname;\r\n\r\n      //console.log(editor);\r\n\r\n      let tagname = areaclasses[areaname].define().tagname;\r\n      let area = UIBase.createElement(tagname);\r\n\r\n      area.owning_sarea = this;\r\n      this.editormap[areaname] = area;\r\n      this.editors.push(this.editormap[areaname]);\r\n\r\n      area.pos = new Vector2(obj.pos);\r\n      area.size = new Vector2(obj.size);\r\n      area.ctx = this.ctx;\r\n\r\n      area.inactive = true;\r\n      area.loadJSON(editor);\r\n      area.owning_sarea = undefined;\r\n\r\n      if (areaname === obj.area) {\r\n        this.area = area;\r\n      }\r\n    }\r\n\r\n    if (this.area !== undefined) {\r\n      this.area.ctx = this.ctx;\r\n      this.area.style[\"width\"] = \"100%\";\r\n      this.area.style[\"height\"] = \"100%\";\r\n      this.area.owning_sarea = this;\r\n      this.area.parentWidget = this;\r\n\r\n      this.area.pos = this.pos;\r\n      this.area.size = this.size;\r\n\r\n      this.area.inactive = false;\r\n      this.shadow.appendChild(this.area);\r\n      this.area.on_area_active();\r\n      this.area.onadd();\r\n    }\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  _ondestroy() {\r\n    super._ondestroy();\r\n\r\n    this.dead = true;\r\n\r\n    for (let editor of this.editors) {\r\n      if (editor === this.area) continue;\r\n\r\n      editor._ondestroy();\r\n    }\r\n  }\r\n\r\n  getScreen() {\r\n    if (this.screen !== undefined) {\r\n      return this.screen;\r\n    }\r\n\r\n    //try to walk up graph, if possible\r\n    let p = this.parentNode;\r\n    let _i = 0;\r\n\r\n    while (p && !(p instanceof Screen) && p !== p.parentNode) {\r\n      p = this.parentNode;\r\n\r\n      if (_i++ > 1000) {\r\n        console.warn(\"infinite loop detected in ScreenArea.prototype.getScreen()\");\r\n        return undefined;\r\n      }\r\n    }\r\n\r\n    return p && p instanceof Screen ? p : undefined;\r\n  }\r\n\r\n  copy(screen) {\r\n    let ret = UIBase.createElement(\"screenarea-x\");\r\n\r\n    ret.screen = screen;\r\n    ret.ctx = this.ctx;\r\n\r\n    ret.pos[0] = this.pos[0];\r\n    ret.pos[1] = this.pos[1];\r\n\r\n    ret.size[0] = this.size[0];\r\n    ret.size[1] = this.size[1];\r\n\r\n    for (let area of this.editors) {\r\n      let cpy = area.copy();\r\n\r\n      cpy.ctx = this.ctx;\r\n\r\n      cpy.parentWidget = ret;\r\n      ret.editors.push(cpy);\r\n      ret.editormap[cpy.constructor.define().areaname] = cpy;\r\n\r\n      if (area === this.area) {\r\n        ret.area = cpy;\r\n      }\r\n    }\r\n\r\n    //console.trace(\"RET.AREA\", this.area, ret.area);\r\n\r\n    ret.ctx = this.ctx;\r\n\r\n    if (ret.area !== undefined) {\r\n      ret.area.ctx = this.ctx;\r\n\r\n      ret.area.pos = ret.pos;\r\n      ret.area.size = ret.size;\r\n      ret.area.owning_sarea = ret;\r\n      ret.area.parentWidget = ret;\r\n\r\n      ret.shadow.appendChild(ret.area);\r\n      //ret.area.onadd();\r\n\r\n      if (ret.area._init_done) {\r\n        ret.area.push_ctx_active();\r\n        ret.area.on_area_active();\r\n        ret.area.pop_ctx_active();\r\n      } else {\r\n        ret.doOnce(() => {\r\n          if (this.dead) {\r\n            return;\r\n          }\r\n          ret._init();\r\n          ret.area._init();\r\n          ret.area.push_ctx_active();\r\n          ret.area.on_area_active();\r\n          ret.area.pop_ctx_active();\r\n        });\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  snapToScreenSize() {\r\n    let screen = this.getScreen();\r\n    let co = new Vector2();\r\n    let changed = 0;\r\n\r\n    for (let v of this._verts) {\r\n      co.load(v);\r\n\r\n      v[0] = Math.min(Math.max(v[0], 0), screen.size[0]);\r\n      v[1] = Math.min(Math.max(v[1], 0), screen.size[1]);\r\n\r\n      if (co.vectorDistance(v) > 0.1) {\r\n        changed = 1;\r\n      }\r\n    }\r\n\r\n    if (changed) {\r\n      this.loadFromVerts();\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Sets screen verts from pos/size\r\n   * */\r\n  loadFromPosSize() {\r\n    if (this.floating && this._verts.length > 0) {\r\n      let p = this.pos, s = this.size;\r\n\r\n      this._verts[0].loadXY(p[0], p[1]);\r\n      this._verts[1].loadXY(p[0], p[1] + s[1]);\r\n      this._verts[2].loadXY(p[0] + s[0], p[1] + s[1]);\r\n      this._verts[3].loadXY(p[0] + s[0], p[1]);\r\n\r\n      for (let border of this._borders) {\r\n        border.setCSS();\r\n      }\r\n\r\n      this.setCSS();\r\n      return;\r\n    }\r\n\r\n    let screen = this.getScreen();\r\n    if (!screen) return;\r\n\r\n    for (let b of this._borders) {\r\n      screen.freeBorder(b);\r\n    }\r\n\r\n    this.makeBorders(screen);\r\n    this.setCSS();\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Sets pos/size from screen verts\r\n   * */\r\n  loadFromVerts() {\r\n    if (this._verts.length == 0) {\r\n      return;\r\n    }\r\n\r\n    let min = new Vector2([1e17, 1e17]);\r\n    let max = new Vector2([-1e17, -1e17]);\r\n\r\n    for (let v of this._verts) {\r\n      min.min(v);\r\n      max.max(v);\r\n    }\r\n\r\n    this.pos[0] = min[0];\r\n    this.pos[1] = min[1];\r\n\r\n    this.size[0] = max[0] - min[0];\r\n    this.size[1] = max[1] - min[1];\r\n\r\n    this.setCSS();\r\n    return this;\r\n  }\r\n\r\n  on_resize(size, oldsize) {\r\n    super.on_resize(size, oldsize);\r\n\r\n    if (this.area !== undefined) {\r\n      this.area.on_resize(size, oldsize);\r\n    }\r\n  }\r\n\r\n  makeBorders(screen) {\r\n    this._borders.length = 0;\r\n    this._verts.length = 0;\r\n\r\n    let p = this.pos, s = this.size;\r\n\r\n    //s = snapi(new Vector2(s));\r\n\r\n    let vs = [\r\n      new Vector2([p[0], p[1]]),\r\n      new Vector2([p[0], p[1] + s[1]]),\r\n      new Vector2([p[0] + s[0], p[1] + s[1]]),\r\n      new Vector2([p[0] + s[0], p[1]])\r\n    ];\r\n\r\n    let floating = this.floating;\r\n\r\n    for (let i = 0; i < vs.length; i++) {\r\n      vs[i] = snap(vs[i]);\r\n      vs[i] = screen.getScreenVert(vs[i], i, floating);\r\n      this._verts.push(vs[i]);\r\n    }\r\n\r\n    for (let i = 0; i < vs.length; i++) {\r\n      let v1 = vs[i], v2 = vs[(i + 1)%vs.length];\r\n\r\n      let b = screen.getScreenBorder(this, v1, v2, i);\r\n\r\n\r\n      for (let j = 0; j < 2; j++) {\r\n        let v = j ? b.v2 : b.v1;\r\n\r\n        if (v.sareas.indexOf(this) < 0) {\r\n          v.sareas.push(this);\r\n        }\r\n      }\r\n\r\n      if (b.sareas.indexOf(this) < 0) {\r\n        b.sareas.push(this);\r\n      }\r\n\r\n      this._borders.push(b);\r\n\r\n      b.movable = screen.isBorderMovable(b);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  setCSS() {\r\n    this.style[\"position\"] = UIBase.PositionKey;\r\n\r\n    this.style[\"left\"] = this.pos[0] + \"px\";\r\n    this.style[\"top\"] = this.pos[1] + \"px\";\r\n\r\n    this.style[\"width\"] = this.size[0] + \"px\";\r\n    this.style[\"height\"] = this.size[1] + \"px\";\r\n\r\n    this.style[\"overflow\"] = \"hidden\";\r\n    this.style[\"contain\"] = \"layout\"; //ensure we have a new positioning stack\r\n\r\n    if (this.area !== undefined) {\r\n      this.area.setCSS();\r\n    }\r\n  }\r\n\r\n  appendChild(child) {\r\n    if (child instanceof Area) {\r\n      let def = child.constructor.define();\r\n      let existing = this.editormap[def.areaname];\r\n\r\n      if (existing && existing !== child) {\r\n        console.warn(\"Warning, replacing an exising editor instance\", child, existing);\r\n\r\n        if (this.area === existing) {\r\n          this.area = child;\r\n        }\r\n\r\n        existing.remove();\r\n        this.editors.remove(existing, true);\r\n        this.editormap[def.areaname] = child;\r\n      }\r\n\r\n      child.ctx = this.ctx;\r\n      child.pos = this.pos;\r\n      child.size = this.size;\r\n\r\n      if (this.editors.indexOf(child) < 0) {\r\n        this.editors.push(child);\r\n      }\r\n\r\n      child.owning_sarea = undefined;\r\n      if (this.area === undefined) {\r\n        this.area = child;\r\n      }\r\n    }\r\n\r\n    super.appendChild(child);\r\n\r\n    if (child instanceof ui_base.UIBase) {\r\n      child.parentWidget = this;\r\n      child.onadd();\r\n    }\r\n  }\r\n\r\n  switch_editor(cls) {\r\n    return this.switchEditor(cls);\r\n  }\r\n\r\n  switchEditor(cls) {\r\n    let def = cls.define();\r\n    let name = def.areaname;\r\n\r\n    //areaclasses[name]\r\n    if (!(name in this.editormap)) {\r\n      this.editormap[name] = UIBase.createElement(def.tagname);\r\n      this.editormap[name].ctx = this.ctx;\r\n      this.editormap[name].parentWidget = this;\r\n      this.editormap[name].owning_sarea = this;\r\n      this.editormap[name].inactive = false;\r\n\r\n      this.editors.push(this.editormap[name]);\r\n    }\r\n\r\n    //var finish = () => {\r\n    if (this.area) {\r\n      //break direct pos/size references for old active area\r\n      this.area.pos = new Vector2(this.area.pos);\r\n      this.area.size = new Vector2(this.area.size);\r\n\r\n      this.area.owning_sarea = undefined;\r\n      this.area.inactive = true;\r\n      this.area.push_ctx_active();\r\n      this.area._init(); //check that init was called\r\n      this.area.on_area_inactive();\r\n      this.area.pop_ctx_active();\r\n\r\n      this.area.remove();\r\n    } else {\r\n      this.area = undefined;\r\n    }\r\n\r\n    this.area = this.editormap[name];\r\n\r\n    this.area.inactive = false;\r\n    this.area.parentWidget = this;\r\n\r\n    //. . .and set references to pos/size\r\n    this.area.pos = this.pos;\r\n    this.area.size = this.size;\r\n    this.area.owning_sarea = this;\r\n    this.area.ctx = this.ctx;\r\n\r\n    this.area.packflag |= this.packflag;\r\n\r\n    this.shadow.appendChild(this.area);\r\n\r\n    this.area.style[\"width\"] = \"100%\";\r\n    this.area.style[\"height\"] = \"100%\";\r\n\r\n    //propegate new size\r\n    this.area.push_ctx_active();\r\n    this.area._init(); //check that init was called\r\n    this.area.on_resize(this.size, this.size);\r\n    this.area.pop_ctx_active();\r\n\r\n    this.area.push_ctx_active();\r\n    this.area.on_area_active();\r\n    this.area.pop_ctx_active();\r\n\r\n    this.regenTabOrder();\r\n    //}\r\n  }\r\n\r\n  _checkWrangler() {\r\n    if (this.ctx)\r\n      contextWrangler._checkWrangler(this.ctx);\r\n  }\r\n\r\n  update() {\r\n    this._checkWrangler();\r\n\r\n    super.update();\r\n\r\n    //flag client controller implementation that\r\n    //this area is active for its type\r\n    if (this.area !== undefined) {\r\n      this.area.owning_sarea = this;\r\n      this.area.parentWidget = this;\r\n      this.area.size = this.size;\r\n      this.area.pos = this.pos;\r\n\r\n      let screen = this.getScreen();\r\n      let oldsize = [this.size[0], this.size[1]];\r\n\r\n      let moved = screen ? screen.checkAreaConstraint(this, true) : 0;\r\n      //*\r\n      if (moved) {\r\n        if (cconst.DEBUG.areaConstraintSolver) {\r\n          console.log(\"screen constraint solve\", moved, this.area.minSize, this.area.maxSize, this.area.tagName, this.size);\r\n        }\r\n\r\n        screen.solveAreaConstraints();\r\n        screen.regenBorders();\r\n        this.on_resize(oldsize);\r\n      }//*/\r\n\r\n      this.area.push_ctx_active(true);\r\n    }\r\n\r\n    this._forEachChildWidget((n) => {\r\n      n.update();\r\n    });\r\n\r\n    if (this.area !== undefined) {\r\n      this.area.pop_ctx_active(true);\r\n    }\r\n  }\r\n\r\n  removeChild(ch) {\r\n    if (ch instanceof Area) {\r\n      ch.owining_sarea = undefined;\r\n      ch.pos = undefined;\r\n      ch.size = undefined;\r\n\r\n      if (this.area === ch && this.editors.length > 1) {\r\n        let i = (this.editors.indexOf(ch) + 1)%this.editors.length;\r\n        this.switchEditor(this.editors[i].constructor);\r\n      } else if (this.area === ch) {\r\n        this.editors = [];\r\n        this.editormap = {};\r\n        this.area = undefined;\r\n\r\n        ch.remove();\r\n        return;\r\n      }\r\n\r\n      let areaname = ch.constructor.define().areaname;\r\n\r\n      this.editors.remove(ch);\r\n      delete this.editormap[areaname];\r\n\r\n      ch.parentWidget = undefined;\r\n    } else {\r\n      return super.removeChild(ch);\r\n    }\r\n  }\r\n\r\n  afterSTRUCT() {\r\n    for (let area of this.editors) {\r\n      area.pos = this.pos;\r\n      area.size = this.size;\r\n      area.owning_sarea = this;\r\n\r\n      area.push_ctx_active();\r\n      area._ctx = this.ctx;\r\n      area.afterSTRUCT();\r\n      area.pop_ctx_active();\r\n    }\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    this.pos = new Vector2(this.pos);\r\n    this.size = new Vector2(this.size);\r\n\r\n    //find active editor\r\n\r\n    let editors = [];\r\n\r\n    for (let area of this.editors) {\r\n      if (!area.constructor || !area.constructor.define || area.constructor === Area) {\r\n        //failed to load this area\r\n        continue;\r\n      }\r\n\r\n      /*\r\n      if (area.constructor === undefined || area.constructor.define === undefined) {\r\n        console.warn(\"Missing class for area\", area, \"maybe buggy loadSTRUCT()?\");\r\n        continue;\r\n      }\r\n      //*/\r\n\r\n      let areaname = area.constructor.define().areaname;\r\n\r\n      area.inactive = true;\r\n      area.owning_sarea = undefined;\r\n      this.editormap[areaname] = area;\r\n\r\n      if (areaname === this.area) {\r\n        this.area = area;\r\n      }\r\n\r\n      /*\r\n      * originally inactive areas weren't supposed to have\r\n      * a reference to their owning ScreenAreas.\r\n      *\r\n      * Unfortunately this will cause isDead() to return true,\r\n      * which might lead to nasty problems.\r\n      * */\r\n      area.parentWidget = this;\r\n\r\n      editors.push(area);\r\n    }\r\n    this.editors = editors;\r\n\r\n    if (typeof this.area !== \"object\") {\r\n      let area = this.editors[0];\r\n\r\n      console.warn(\"Failed to find active area!\", this.area);\r\n\r\n      if (typeof area !== \"object\") {\r\n        for (let k in areaclasses) {\r\n          area = areaclasses[k].define().tagname;\r\n          area = UIBase.createElement(area);\r\n          let areaname = area.constructor.define().areaname;\r\n\r\n          this.editors.push(area);\r\n          this.editormap[areaname] = area;\r\n\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (area) {\r\n        this.area = area;\r\n      }\r\n    }\r\n\r\n    if (this.area !== undefined) {\r\n      this.area.style[\"width\"] = \"100%\";\r\n      this.area.style[\"height\"] = \"100%\";\r\n      this.area.owning_sarea = this;\r\n      this.area.parentWidget = this;\r\n\r\n      this.area.pos = this.pos;\r\n      this.area.size = this.size;\r\n\r\n      this.area.inactive = false;\r\n      this.shadow.appendChild(this.area);\r\n\r\n      let f = () => {\r\n        if (this._isDead()) {\r\n          return;\r\n        }\r\n\r\n        if (!this.ctx && this.parentNode) {\r\n          console.log(\"waiting to start. . .\");\r\n          this.doOnce(f);\r\n          return;\r\n        }\r\n\r\n        this.area.ctx = this.ctx;\r\n        this.area._init(); //ensure init has been called already\r\n        this.area.on_area_active();\r\n        this.area.onadd();\r\n      };\r\n\r\n      this.doOnce(f);\r\n    }\r\n\r\n  }\r\n}\r\n\r\nScreenArea.STRUCT = `\r\npathux.ScreenArea { \r\n  pos      : vec2;\r\n  size     : vec2;\r\n  type     : string;\r\n  hidden   : bool;\r\n  editors  : array(abstract(pathux.Area));\r\n  area     : string | this.area ? this.area.constructor.define().areaname : \"\";\r\n}\r\n`;\r\n\r\nnstructjs.register(ScreenArea, \"pathux.ScreenArea\");\r\nui_base.UIBase.internalRegister(ScreenArea);\r\n\r\nui_base._setAreaClass(Area);\r\n\r\nexport function setScreenClass(cls) {\r\n  Screen = cls;\r\n}\r\n","import {Area} from '../screen/ScreenArea.js';\r\nimport * as nstructjs from '../path-controller/util/struct.js';\r\nimport {UIBase, theme, flagThemeUpdate, saveUIData, loadUIData} from '../core/ui_base.js';\r\nimport {Container} from '../core/ui.js';\r\nimport {validateCSSColor, color2css, css2color, CSSFont} from '../core/ui_theme.js';\r\n\r\nexport class ThemeEditor extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.categoryMap = {};\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"theme-editor-x\",\r\n      style  : \"theme-editor\"\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.build();\r\n  }\r\n\r\n  doFolder(catkey, obj, container = this, panel = undefined, path=undefined) {\r\n    let key = catkey.key;\r\n\r\n    if (!path) {\r\n      path = [key];\r\n    }\r\n\r\n    if (!panel) {\r\n      panel = container.panel(key, undefined, undefined, catkey.help);\r\n      panel.style[\"margin-left\"] = \"15px\";\r\n    }\r\n\r\n    let row2 = panel.row();\r\n    let textbox = row2.textbox(undefined, \"\");\r\n\r\n    let callback = (id) => {\r\n      console.log(\"ID\", id, obj, catkey);\r\n      console.log(textbox, textbox.text, textbox.value);\r\n\r\n      let propkey = (textbox.text || \"\").trim();\r\n\r\n      if (!propkey) {\r\n        console.error(\"Cannot have empty theme property name\");\r\n        return;\r\n      }\r\n\r\n      if (id === \"FLOAT\") {\r\n        obj[propkey] = 0.0;\r\n      } else if (id === \"SUBFOLDER\") {\r\n        obj[propkey] = {test : 0};\r\n      } else if (id === \"COLOR\") {\r\n        obj[propkey] = \"grey\";\r\n      } else if (id === \"FONT\") {\r\n        obj[propkey] = new CSSFont();\r\n      } else if (id === \"STRING\") {\r\n        obj[propkey] = \"\";\r\n      }\r\n\r\n      let uidata = saveUIData(panel, \"theme-panel\");\r\n\r\n      panel.clear();\r\n      this.doFolder(catkey, obj, container, panel, path);\r\n\r\n      loadUIData(panel, uidata);\r\n      panel.flushUpdate();\r\n      panel.flushSetCSS();\r\n\r\n      //doFolder(catkey, obj, container = this, panel=undefined) {\r\n      //this.build();\r\n      if (this.onchange) {\r\n        this.onchange(key, propkey, obj);\r\n      }\r\n    }\r\n\r\n    let menu = row2.menu(\"+\", [\r\n      {name: \"Float\", callback: () => callback(\"FLOAT\")},\r\n      {name: \"Color\", callback: () => callback(\"COLOR\")},\r\n      {name: \"Subfolder\", callback: () => callback(\"SUBFOLDER\")},\r\n      {name: \"Font\", callback: () => callback(\"FONT\")},\r\n      {name: \"String\", callback: () => callback(\"STRING\")},\r\n    ]);\r\n\r\n    let row = panel.row();\r\n    let col1 = row.col();\r\n    let col2 = row.col();\r\n\r\n    let do_onchange = (key, k, obj) => {\r\n      flagThemeUpdate();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(key, k, obj);\r\n      }\r\n\r\n      this.ctx.screen.completeSetCSS();\r\n      this.ctx.screen.completeUpdate();\r\n    };\r\n\r\n    let getpath = (path) => {\r\n      let obj = theme;\r\n\r\n      for (let i = 0; i < path.length; i++) {\r\n        obj = obj[path[i]];\r\n      }\r\n\r\n      return obj;\r\n    }\r\n\r\n    let ok = false;\r\n    let _i = 0;\r\n\r\n    let dokey = (k, v, path) => {\r\n      let col = _i%2 === 0 ? col1 : col2;\r\n\r\n      if (k.toLowerCase().search(\"flag\") >= 0) {\r\n        return; //don't do flags\r\n      }\r\n\r\n      if (typeof v === \"string\") {\r\n        let v2 = v.toLowerCase().trim();\r\n\r\n        let iscolor = validateCSSColor(v2);\r\n\r\n        if (iscolor) {\r\n          let cw = col.colorbutton();\r\n          ok = true;\r\n          _i++;\r\n\r\n          let color = css2color(v2);\r\n          if (color.length < 3) {\r\n            color = [color[0], color[1], color[2], 1.0];\r\n          }\r\n\r\n          try {\r\n            cw.setRGBA(color);\r\n          } catch (error) {\r\n            console.warn(\"Failed to set color \" + k, v2);\r\n          }\r\n\r\n          cw.onchange = () => {\r\n            console.log(\"setting '\" + k + \"' to \" + color2css(cw.rgba), key);\r\n            getpath(path)[k] = color2css(cw.rgba);\r\n\r\n            do_onchange(key, k);\r\n          }\r\n          cw.label = k;\r\n        } else {\r\n          col.label(k);\r\n\r\n          let box = col.textbox();\r\n          box.onchange = () => {\r\n            getpath(path)[k] = box.text;\r\n            do_onchange(key, k);\r\n          }\r\n          box.text = v;\r\n        }\r\n      } else if (typeof v === \"number\") {\r\n        let slider = col.slider(undefined, k, v, 0, 256, 0.01, false);\r\n\r\n        slider.baseUnit = slider.displayUnit = \"none\";\r\n\r\n        ok = true;\r\n        _i++;\r\n\r\n        slider.onchange = () => {\r\n          getpath(path)[k] = slider.value;\r\n\r\n          do_onchange(key, k);\r\n        }\r\n      } else if (typeof v === \"boolean\") {\r\n        let check = col.check(undefined, k);\r\n\r\n        check.value = getpath(path)[k];\r\n\r\n        check.onchange = () => {\r\n          getpath(path)[k] = !!check.value;\r\n          do_onchange(key, k);\r\n        }\r\n      } else if (typeof v === \"object\" && v instanceof CSSFont) {\r\n        let panel2 = col.panel(k);\r\n        ok = true;\r\n        _i++;\r\n\r\n        let textbox = (key) => {\r\n          panel2.label(key);\r\n          let tbox = panel2.textbox(undefined, v[key]);\r\n\r\n          tbox.width = tbox.getDefault(\"width\");\r\n\r\n          tbox.onchange = function () {\r\n            v[key] = this.text;\r\n            do_onchange(key, k);\r\n          }\r\n        }\r\n\r\n        textbox(\"font\");\r\n        textbox(\"variant\");\r\n        textbox(\"weight\");\r\n        textbox(\"style\");\r\n\r\n        let cw = panel2.colorbutton();\r\n        cw.label = \"color\";\r\n        cw.setRGBA(css2color(v.color));\r\n        cw.onchange = () => {\r\n          v.color = color2css(cw.rgba);\r\n          do_onchange(key, k);\r\n        }\r\n\r\n        let slider = panel2.slider(undefined, \"size\", v.size);\r\n        slider.onchange = () => {\r\n          v.size = slider.value;\r\n          do_onchange(key, k);\r\n        }\r\n        slider.setAttribute(\"min\", 1);\r\n        slider.setAttribute(\"max\", 100);\r\n\r\n        slider.baseUnit = slider.displayUnit = \"none\";\r\n\r\n        panel2.closed = true;\r\n      } else if (typeof v === \"object\") {\r\n        /*\r\n          let old = {\r\n            panel, row, col1, col2\r\n          };\r\n\r\n          let path2 = path.slice(0, path.length);\r\n          path2.push(k);\r\n\r\n          panel = panel.panel(k);\r\n          row = panel.row();\r\n          col1 = row.col();\r\n          col2 = row.col();\r\n          for (let k2 in v) {\r\n            let v2 = v[k2];\r\n\r\n            dokey(k2, v2, path2);\r\n          }\r\n\r\n          panel = old.panel;\r\n          row = old.row;\r\n          col1 = old.col1;\r\n          col2 = old.col2;\r\n        */\r\n\r\n        let catkey2 = Object.assign({}, catkey);\r\n        catkey2.key = k;\r\n\r\n        let path2 = path.concat(k);\r\n\r\n        this.doFolder(catkey2, v, panel, undefined, path2);\r\n      }\r\n    };\r\n\r\n    for (let k in obj) {\r\n      let v = obj[k];\r\n\r\n      dokey(k, v, path);\r\n    }\r\n\r\n    if (!ok) {\r\n      panel.remove();\r\n    } else {\r\n      panel.closed = true;\r\n    }\r\n\r\n  }\r\n\r\n  build() {\r\n    let uidata = saveUIData(this, \"theme\");\r\n\r\n    this.clear();\r\n\r\n    let categories = {};\r\n\r\n    for (let k of Object.keys(theme)) {\r\n      let catkey;\r\n\r\n      if (k in this.categoryMap) {\r\n        let cat = this.categoryMap[k];\r\n\r\n        if (typeof cat === \"string\") {\r\n          cat = {\r\n            category: cat,\r\n            help    : \"\",\r\n            key     : k\r\n          }\r\n        }\r\n\r\n        catkey = cat;\r\n      } else {\r\n        catkey = {category: k, help: '', key: k};\r\n      }\r\n\r\n      if (!catkey.key) {\r\n        catkey.key = k;\r\n      }\r\n\r\n      if (!(catkey.category in categories)) {\r\n        categories[catkey.category] = [];\r\n      }\r\n\r\n      categories[catkey.category].push(catkey);\r\n    }\r\n\r\n    function strcmp(a, b) {\r\n      a = a.trim().toLowerCase();\r\n      b = b.trim().toLowerCase();\r\n      return a < b ? -1 : (a === b ? 0 : 1);\r\n    }\r\n\r\n    let keys = Object.keys(categories);\r\n    keys.sort(strcmp);\r\n\r\n    for (let k of keys) {\r\n      let list = categories[k];\r\n      list.sort((a, b) => strcmp(a.key, b.key));\r\n\r\n      let panel = this;\r\n\r\n      if (list.length > 1) {\r\n        panel = this.panel(k);\r\n      }\r\n\r\n      for (let cat of list) {\r\n        let k2 = cat.key;\r\n        let v = theme[k2];\r\n\r\n        if (typeof v === \"object\") {\r\n          this.doFolder(cat, v, panel);\r\n        }\r\n      }\r\n\r\n      if (list.length > 1) {\r\n        panel.closed = true;\r\n      }\r\n    }\r\n\r\n    loadUIData(this, uidata);\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      this.flushSetCSS();\r\n      this.flushUpdate();\r\n    }\r\n\r\n    if (this.ctx && this.ctx.screen) {\r\n      /* Fix panel spacing bug. */\r\n      window.setTimeout(() => {\r\n        this.ctx.screen.completeSetCSS();\r\n      }, 100);\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ThemeEditor);\r\n","import {UIBase, drawText} from \"../core/ui_base.js\";\r\nimport {ValueButtonBase} from \"./ui_widgets.js\";\r\nimport cconst from '../config/const.js';\r\nimport * as ui_base from \"../core/ui_base.js\";\r\nimport * as units from \"../core/units.js\";\r\nimport {Vector2} from \"../path-controller/util/vectormath.js\";\r\nimport {ColumnFrame} from \"../core/ui.js\";\r\nimport * as util from \"../path-controller/util/util.js\";\r\nimport {\r\n  PropTypes, isNumber, PropSubTypes, PropFlags, NumberConstraints, IntProperty\r\n} from \"../path-controller/toolsys/toolprop.js\";\r\nimport {eventWasTouch} from \"../path-controller/util/simple_events.js\";\r\nimport {KeyMap, keymap} from \"../path-controller/util/simple_events.js\";\r\nimport {color2css, css2color} from \"../core/ui_theme.js\";\r\nimport {ThemeEditor} from \"./theme_editor.js\";\r\nimport {Unit} from '../core/units.js';\r\n\r\nexport const sliderDomAttributes = new Set([\r\n  \"min\", \"max\", \"integer\", \"displayUnit\", \"baseUnit\", \"labelOnTop\",\r\n  \"radix\", \"step\", \"expRate\", \"stepIsRelative\", \"decimalPlaces\",\r\n  \"slideSpeed\", \"sliderDisplayExp\"\r\n]);\r\n\r\nfunction updateSliderFromDom(dom, slider = dom) {\r\n  slider.loadNumConstraints(undefined, dom);\r\n}\r\n\r\nexport const SliderDefaults = {\r\n  stepIsRelative  : false,\r\n  expRate         : 1.0 + 1.0/3.0,\r\n  radix           : 10,\r\n  decimalPlaces   : 4,\r\n  baseUnit        : \"none\",\r\n  displayUnit     : \"none\",\r\n  slideSpeed      : 1.0,\r\n  step            : 0.1,\r\n  sliderDisplayExp: 1.0\r\n}\r\n\r\nexport function NumberSliderBase(cls = UIBase, skip = new Set(), defaults = SliderDefaults) {\r\n  skip = new Set(skip);\r\n\r\n  return class NumberSliderBase extends cls {\r\n    constructor() {\r\n      super();\r\n\r\n      for (let key of NumberConstraints) {\r\n        if (skip.has(key)) {\r\n          continue;\r\n        }\r\n\r\n        if (key in defaults) {\r\n          this[key] = defaults[key];\r\n        } else {\r\n          this[key] = undefined;\r\n        }\r\n      }\r\n    }\r\n\r\n    loadNumConstraints(prop, dom) {\r\n      return super.loadNumConstraints(prop, dom, this._redraw);\r\n    }\r\n  }\r\n}\r\n\r\n//use .setAttribute(\"linear\") to disable nonlinear sliding\r\nexport class NumSlider extends NumberSliderBase(ValueButtonBase) {\r\n  constructor() {\r\n    super();\r\n\r\n    this._highlight = undefined;\r\n    this._last_label = undefined;\r\n\r\n    this.mdown = false;\r\n    this.ma = undefined;\r\n\r\n    this.mpos = new Vector2();\r\n    this.start_mpos = new Vector2();\r\n\r\n    this._last_overarrow = false;\r\n\r\n    this._name = \"\";\r\n    this._value = 0.0;\r\n    this.expRate = SliderDefaults.expRate;\r\n\r\n    this.vertical = false;\r\n    this._last_disabled = false;\r\n\r\n    this.range = [-1e17, 1e17];\r\n    this.isInt = false;\r\n    this.editAsBaseUnit = undefined;\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(val) {\r\n    this.setValue(val);\r\n  }\r\n\r\n  /** Current name label.  If set to null label will\r\n   * be pulled from the datapath api.*/\r\n  get name() {\r\n    return this.getAttribute(\"name\") || this._name;\r\n  }\r\n\r\n  /** Current name label.  If set to null label will\r\n   * be pulled from the datapath api.*/\r\n  set name(name) {\r\n    if (name === undefined || name === null) {\r\n      this.removeAttribute(\"name\");\r\n    } else {\r\n      this.setAttribute(\"name\", name);\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname          : \"numslider-x\",\r\n      style            : \"numslider\",\r\n      parentStyle      : \"button\",\r\n      havePickClipboard: true,\r\n    };\r\n  }\r\n\r\n\r\n  updateWidth(force = false) {\r\n    let dpi = UIBase.getDPI();\r\n    let wid = ~~(this.getDefault(\"width\")*dpi);\r\n\r\n    if (force || wid !== this._last_width) {\r\n      this._last_width = wid;\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (!prop) {\r\n      return;\r\n    }\r\n\r\n    let name;\r\n\r\n    if (this.hasAttribute(\"name\")) {\r\n      name = this.getAttribute(\"name\");\r\n    } else {\r\n      name = \"\" + prop.uiname;\r\n    }\r\n\r\n    //lazily load constraints, since there's so much\r\n    //accessing of DOM attributes\r\n    let updateConstraints = false;\r\n\r\n    if (name !== this._name) {\r\n      this._name = name;\r\n      this.setCSS();\r\n      updateConstraints = true;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (val !== this._value) {\r\n      updateConstraints = true;\r\n      /* Note that super.updateDataPath will update .value for us*/\r\n    }\r\n\r\n    if (updateConstraints) {\r\n      this.loadNumConstraints(prop);\r\n    }\r\n\r\n    super.updateDataPath();\r\n  }\r\n\r\n  update() {\r\n    if (!!this._last_disabled !== !!this.disabled) {\r\n      this._last_disabled = !!this.disabled;\r\n      this._redraw();\r\n      this.setCSS();\r\n    }\r\n\r\n    this.updateWidth();\r\n    super.update(); //calls this.updateDataPath\r\n\r\n    updateSliderFromDom(this);\r\n  }\r\n\r\n  clipboardCopy() {\r\n    console.log(\"Copy\", \"\" + this.value);\r\n    cconst.setClipboardData(\"value\", \"text/plain\", \"\" + this.value);\r\n  }\r\n\r\n  clipboardPaste() {\r\n    let data = cconst.getClipboardData(\"text/plain\");\r\n    console.log(\"Paste\", data);\r\n\r\n    if (typeof data == \"object\") {\r\n      data = data.data;\r\n    }\r\n\r\n    let displayUnit = this.editAsBaseUnit ? undefined : this.displayUnit;\r\n    let val = units.parseValue(data, this.baseUnit, displayUnit);\r\n\r\n    if (typeof val === \"number\" && !isNaN(val)) {\r\n      this.setValue(val);\r\n    }\r\n  }\r\n\r\n  swapWithTextbox() {\r\n    let tbox = UIBase.createElement(\"textbox-x\");\r\n\r\n    if (this.modalRunning) {\r\n      this.popModal();\r\n    }\r\n\r\n    this.mdown = false;\r\n    this._pressed = false;\r\n\r\n    tbox.ctx = this.ctx;\r\n    tbox._init();\r\n\r\n    tbox.decimalPlaces = this.decimalPlaces;\r\n    tbox.isInt = this.isInt;\r\n    tbox.editAsBaseUnit = this.editAsBaseUnit;\r\n\r\n    if (this.isInt && this.radix != 10) {\r\n      let text = this.value.toString(this.radix);\r\n      if (this.radix === 2)\r\n        text = \"0b\" + text;\r\n      else if (this.radix === 16)\r\n        text += \"h\";\r\n\r\n      tbox.text = text;\r\n    } else {\r\n      tbox.text = units.buildString(this.value, this.baseUnit, this.decimalPlaces, this.displayUnit);\r\n    }\r\n\r\n    this.parentNode.insertBefore(tbox, this);\r\n    //this.remove();\r\n    this.hidden = true;\r\n    //this.dom.hidden = true;\r\n\r\n    let finish = (ok) => {\r\n      tbox.remove();\r\n      this.hidden = false;\r\n\r\n      if (ok) {\r\n        let val = tbox.text.trim();\r\n\r\n        if (this.isInt && this.radix !== 10) {\r\n          val = parseInt(val);\r\n        } else {\r\n          let displayUnit = this.editAsBaseUnit ? undefined : this.displayUnit;\r\n\r\n          val = units.parseValue(val, this.baseUnit, displayUnit);\r\n        }\r\n\r\n        if (isNaN(val)) {\r\n          console.log(\"Text input error\", val, tbox.text.trim(), this.isInt);\r\n          this.flash(ui_base.ErrorColors.ERROR);\r\n        } else {\r\n          this.setValue(val);\r\n\r\n          if (this.onchange) {\r\n            this.onchange(this);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    tbox.onend = finish;\r\n    tbox.focus();\r\n    tbox.select();\r\n\r\n    //this.shadow.appendChild(tbox);\r\n    return;\r\n  }\r\n\r\n  bindEvents() {\r\n    let dir = this.range && this.range[0] > this.range[1] ? -1 : 1;\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Left\"]:\r\n        case keymap[\"Down\"]:\r\n          this.setValue(this.value - dir*5*this.step);\r\n          break;\r\n        case keymap[\"Up\"]:\r\n        case keymap[\"Right\"]:\r\n          this.setValue(this.value + dir*5*this.step);\r\n          break;\r\n      }\r\n    });\r\n\r\n    let onmousedown = (e) => {\r\n      e.preventDefault();\r\n\r\n      if (this.disabled) {\r\n        this.mdown = false;\r\n        this._pressed = false;\r\n        e.stopPropagation();\r\n\r\n        return;\r\n      }\r\n\r\n      if (e.button) {\r\n        return;\r\n      }\r\n\r\n      this.mdown = true;\r\n      this._pressed = true;\r\n      this._redraw();\r\n\r\n      if (this.overArrow(e.x, e.y)) {\r\n        this._on_click(e);\r\n      } else {\r\n        this.dragStart(e);\r\n        e.stopPropagation();\r\n      }\r\n    }\r\n\r\n    this._on_click = (e) => {\r\n      this.setMpos(e);\r\n\r\n      if (this.disabled) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        return;\r\n      }\r\n\r\n      let step;\r\n\r\n      if (step = this.overArrow(e.x, e.y)) {\r\n        if (e.shiftKey) {\r\n          step *= 0.1;\r\n        }\r\n\r\n        this.setValue(this.value + step);\r\n      }\r\n    }\r\n\r\n    this.addEventListener(\"pointermove\", (e) => {\r\n      this.setMpos(e);\r\n\r\n      if (this.mdown && !this._modaldata && this.mpos.vectorDistance(this.start_mpos) > 13) {\r\n        this.dragStart(e);\r\n      }\r\n    });\r\n\r\n    this.addEventListener(\"dblclick\", (e) => {\r\n      this.setMpos(e);\r\n\r\n      this.mdown = false;\r\n      this._pressed = false;\r\n\r\n      if (this.disabled || this.overArrow(e.x, e.y)) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        return;\r\n      }\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n\r\n      this.swapWithTextbox();\r\n    });\r\n\r\n    this.addEventListener(\"pointerdown\", (e) => {\r\n      this.setMpos(e);\r\n\r\n      if (this.disabled) return;\r\n      onmousedown(e);\r\n    }, {capture: true});\r\n\r\n    this.addEventListener(\"pointerup\", (e) => {\r\n      this.mdown = false;\r\n      this._pressed = false;\r\n      this._redraw();\r\n    })\r\n    /*\r\n    this.addEventListener(\"touchstart\", (e) => {\r\n      if (this.disabled) return;\r\n\r\n      e.x = e.touches[0].screenX;\r\n      e.y = e.touches[0].screenY;\r\n\r\n      this.dragStart(e);\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }, {passive : false});\r\n    //*/\r\n\r\n    //this.addEventListener(\"pointerup\", (e) => {\r\n    //  return onmouseup(e);\r\n    //});\r\n\r\n    this.addEventListener(\"pointerover\", (e) => {\r\n      this.setMpos(e);\r\n      if (this.disabled) return;\r\n\r\n      if (!this._highlight) {\r\n        this._highlight = true;\r\n        this._repos_canvas();\r\n        this._redraw();\r\n      }\r\n    })\r\n\r\n    this.addEventListener(\"blur\", (e) => {\r\n      this._highlight = false;\r\n      this.mdown = false;\r\n    });\r\n\r\n    this.addEventListener(\"pointerout\", (e) => {\r\n      this.setMpos(e);\r\n      if (this.disabled) return;\r\n\r\n      this._highlight = false;\r\n\r\n      this.dom._background = this.getDefault(\"background-color\");\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    })\r\n  }\r\n\r\n  overArrow(x, y) {\r\n    let r = this.getBoundingClientRect();\r\n    let rwidth, rx;\r\n\r\n    if (this.vertical) {\r\n      rwidth = r.height;\r\n      rx = r.y;\r\n      x = y;\r\n    } else {\r\n      rwidth = r.width;\r\n      rx = r.x;\r\n    }\r\n\r\n    x -= rx;\r\n    let sz = this._getArrowSize();\r\n\r\n    let szmargin = sz + cconst.numSliderArrowLimit;\r\n\r\n    let step = this.step || 0.01;\r\n\r\n    if (this.isInt) {\r\n      step = Math.max(step, 1);\r\n    }\r\n\r\n    if (isNaN(step)) {\r\n      console.error(\"NaN step size\", \"step:\", this.step, \"numslider:\", this._id);\r\n      this.flash(\"red\");\r\n      step = this.isInt ? 1 : 0.1;\r\n    }\r\n\r\n    if (x < szmargin) {\r\n      return -step;\r\n    } else if (x > rwidth - szmargin) {\r\n      return step;\r\n    }\r\n\r\n    return 0;\r\n  }\r\n\r\n  doRange() {\r\n    console.warn(\"Deprecated: NumSlider.prototype.doRange, use loadNumConstraints instead!\");\r\n    this.loadNumConstraints();\r\n  }\r\n\r\n  setValue(value, fire_onchange = true, setDataPath = true, checkConstraints = true) {\r\n    value = Math.min(Math.max(value, this.range[0]), this.range[1]);\r\n\r\n    this._value = value;\r\n\r\n    if (this.hasAttribute(\"integer\")) {\r\n      this.isInt = true;\r\n    }\r\n\r\n    if (this.isInt) {\r\n      this._value = Math.floor(this._value);\r\n    }\r\n\r\n    if (checkConstraints) {\r\n      this.loadNumConstraints();\r\n    }\r\n\r\n    if (setDataPath && this.ctx && this.hasAttribute(\"datapath\")) {\r\n      this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this._value);\r\n    }\r\n\r\n    if (fire_onchange && this.onchange) {\r\n      this.onchange(this.value);\r\n    }\r\n\r\n    this._redraw();\r\n  }\r\n\r\n  setMpos(e) {\r\n    this.mpos[0] = e.x;\r\n    this.mpos[1] = e.y;\r\n\r\n    if (!this.mdown) {\r\n      this.start_mpos[0] = e.x;\r\n      this.start_mpos[1] = e.y;\r\n    }\r\n\r\n    let over = this.overArrow(e.x, e.y);\r\n\r\n    if (over !== this._last_overarrow) {\r\n      this._last_overarrow = over;\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  dragStart(e) {\r\n    this.mdown = false;\r\n    this._pressed = true;\r\n\r\n    if (this.disabled) return;\r\n\r\n    if (this.modalRunning) {\r\n      console.log(\"modal already running for numslider\", this);\r\n      return;\r\n    }\r\n\r\n    this.last_time = util.time_ms();\r\n\r\n    let last_background = this.dom._background;\r\n    let cancel;\r\n\r\n    this.ma = new util.MovingAvg(eventWasTouch(e) ? 8 : 2);\r\n\r\n    let startvalue = this.value;\r\n    let value = startvalue;\r\n\r\n    let startx = this.vertical ? e.y : e.x, starty = this.vertical ? e.x : e.y;\r\n    let sumdelta = 0;\r\n\r\n    this.dom._background = this.getDefault(\"BoxDepressed\");\r\n    let fire = () => {\r\n      if (this.onchange) {\r\n        this.onchange(this);\r\n      }\r\n    }\r\n\r\n    let handlers = {\r\n      on_keydown: (e) => {\r\n        switch (e.keyCode) {\r\n          case 27: //escape key\r\n            cancel(true);\r\n          case 13: //enter key\r\n            cancel(false);\r\n            break;\r\n        }\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      },\r\n\r\n      on_pointermove: (e) => {\r\n        if (this.disabled) return;\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        let x = this.ma.add(this.vertical ? e.y : e.x);\r\n        let dx = x - startx;\r\n        startx = x;\r\n\r\n        if (util.time_ms() - this.last_time < 35) {\r\n          return;\r\n        }\r\n        this.last_time = util.time_ms();\r\n\r\n        if (e.shiftKey) {\r\n          dx *= 0.1;\r\n        }\r\n\r\n        dx *= this.vertical ? -1 : 1;\r\n\r\n        sumdelta += Math.abs(dx);\r\n\r\n        value += dx*this.step*0.1*this.slideSpeed;\r\n\r\n        let dvalue = value - startvalue;\r\n        let dsign = Math.sign(dvalue);\r\n\r\n        let expRate = this.expRate;\r\n\r\n        //if (eventWasTouch(e)) {\r\n        //  expRate = (1 + expRate)*0.5;\r\n        //}\r\n\r\n        if (!this.hasAttribute(\"linear\")) {\r\n          dvalue = Math.pow(Math.abs(dvalue), expRate)*dsign;\r\n        }\r\n\r\n        this.value = startvalue + dvalue;\r\n\r\n        /*\r\n        if (e.shiftKey) {\r\n          dx *= 0.1;\r\n          this.value = startvalue2 + dx*0.1*this.step*this.slideSpeed;\r\n          startvalue3 = this.value;\r\n        } else {\r\n          startvalue2 = this.value;\r\n          this.value = startvalue3 + dx*0.1*this.step*this.slideSpeed;\r\n        }*/\r\n\r\n        this.updateWidth();\r\n        this._redraw();\r\n        fire();\r\n      },\r\n\r\n      on_pointerup: (e) => {\r\n        this.setMpos(e);\r\n\r\n        this.undoBreakPoint();\r\n        cancel(false);\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      },\r\n\r\n      on_pointerout: (e) => {\r\n        last_background = this.getDefault(\"background-color\");\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      },\r\n\r\n      on_pointerover: (e) => {\r\n        last_background = this.getDefault(\"BoxHighlight\");\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      },\r\n\r\n      on_pointerdown: (e) => {\r\n        this.popModal();\r\n      },\r\n    };\r\n\r\n    //events.pushModal(this.getScreen(), handlers);\r\n    this.pushModal(handlers);\r\n\r\n    cancel = (restore_value) => {\r\n      this._pressed = false;\r\n\r\n      if (restore_value) {\r\n        this.value = startvalue;\r\n        this.updateWidth();\r\n        fire();\r\n      }\r\n\r\n      this.dom._background = last_background; //ui_base.getDefault(\"background-color\");\r\n      this._redraw();\r\n\r\n      this.popModal();\r\n    }\r\n  }\r\n\r\n  get _pressed() {\r\n    return this.__pressed;\r\n  }\r\n\r\n  set _pressed(v) {\r\n    /* Try to improve usability on pen/touch displays\r\n     * by forcing pressed state to last at least 100ms.\r\n     */\r\n    if (!v) {\r\n      window.setTimeout(() => {\r\n        let redraw = this.__pressed;\r\n\r\n        this.__pressed = false;\r\n        if (redraw) {\r\n          this._redraw();\r\n        }\r\n      }, 100);\r\n    } else {\r\n      this.__pressed = v;\r\n    }\r\n  }\r\n\r\n  setCSS(unused_setBG, fromRedraw) {\r\n    /* Do not call parent class implementation. */\r\n\r\n    let dpi = this.getDPI();\r\n    let ts = this.getDefault(\"DefaultText\").size*UIBase.getDPI();\r\n    let label = this._genLabel();\r\n\r\n    let tw = ui_base.measureText(this, label, {\r\n      size: ts,\r\n      font: this.getDefault(\"DefaultText\")\r\n    }).width/dpi;\r\n\r\n    /* Enforce a minimum size based on final text. */\r\n    tw = Math.max(tw + this._getArrowSize()*1, this.getDefault(\"width\"));\r\n\r\n    tw += ts;\r\n    tw = ~~tw;\r\n\r\n    let w, h;\r\n\r\n    if (this.vertical) {\r\n      w = this.getDefault(\"height\");\r\n      h = tw;\r\n    } else {\r\n      h = this.getDefault(\"height\");\r\n      w = tw;\r\n    }\r\n\r\n    w = ~~(w*dpi);\r\n    h = ~~(h*dpi);\r\n\r\n    this.style[\"width\"] = this.dom.style[\"width\"] = (w/dpi) + \"px\";\r\n    this.style[\"height\"] = this.dom.style[\"height\"] = (h/dpi) + \"px\";\r\n    this.dom.width = w;\r\n    this.dom.height = h;\r\n\r\n    if (!fromRedraw) {\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _repos_canvas() {\r\n    //super._repos_canvas();\r\n  }\r\n\r\n  updateDefaultSize() {\r\n    /* Do nothing, don't invoke parent class method. */\r\n  }\r\n\r\n  updateName(force) {\r\n    if (!this.hasAttribute(\"name\")) {\r\n      return;\r\n    }\r\n\r\n    let name = this.getAttribute(\"name\");\r\n\r\n    if (force || name !== this._name) {\r\n      this._name = name;\r\n      this.setCSS();\r\n    }\r\n\r\n    let label = this._genLabel();\r\n    if (label !== this._last_label) {\r\n      this._last_label = label;\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  _genLabel() {\r\n    let val = this.value;\r\n    let text;\r\n\r\n    if (val === undefined) {\r\n      text = \"error\";\r\n    } else {\r\n      val = val === undefined ? 0.0 : val;\r\n\r\n      if (this.isInt) {\r\n        val = Math.floor(val);\r\n      }\r\n\r\n      val = units.buildString(val, this.baseUnit, this.decimalPlaces, this.displayUnit);\r\n\r\n      text = val;\r\n      if (this._name) {\r\n        text = this._name + \": \" + text;\r\n      } else if (this.hasAttribute(\"name\")) {\r\n        text = \"\" + this.getAttribute(\"name\") + \": \" + text;\r\n      }\r\n    }\r\n\r\n    return text;\r\n  }\r\n\r\n  _redraw(fromCSS) {\r\n    if (!fromCSS) {\r\n      this.setCSS(undefined, true);\r\n    }\r\n\r\n    let g = this.g;\r\n    let canvas = this.dom;\r\n\r\n    let dpi = this.getDPI();\r\n    let disabled = this.disabled;\r\n\r\n    /* Fallback on BoxHighlight for backwards compatibility with\r\n     * old themes. */\r\n\r\n    let over = !this._modaldata && this.overArrow(this.mpos[0], this.mpos[1]);\r\n\r\n    let subkey = undefined;\r\n    let pressed = this._pressed && !over;\r\n\r\n    if (this._highlight && pressed) {\r\n      subkey = \"highlight-pressed\";\r\n    } else if (this._highlight) {\r\n      subkey = \"highlight\";\r\n    } else if (pressed) {\r\n      subkey = \"pressed\";\r\n    }\r\n\r\n    let getDefault = (key, backupval = undefined, subkey2 = subkey) => {\r\n      /* Have highlight-pressed fall back to pressed. */\r\n      if (subkey2 === \"highlight-pressed\" && !this.hasClassSubDefault(subkey2, key, false)) {\r\n        return this.getSubDefault(\"pressed\", key, undefined, backupval);\r\n      }\r\n\r\n      if (!subkey2) {\r\n        return this.getDefault(key, undefined, backupval);\r\n      } else {\r\n        return this.getSubDefault(subkey2, key, undefined, backupval);\r\n      }\r\n    }\r\n\r\n    let r = getDefault(\"border-radius\");\r\n    if (this.isInt) {\r\n      r *= 0.25;\r\n    }\r\n\r\n    let boxbg = getDefault(\"background-color\");\r\n\r\n    ui_base.drawRoundBox(this, this.dom, this.g, undefined, undefined,\r\n      r, \"fill\", disabled ? getDefault(\"DisabledBG\") : boxbg);\r\n    ui_base.drawRoundBox(this, this.dom, this.g, undefined, undefined,\r\n      r, \"stroke\", disabled ? getDefault(\"DisabledBG\") : getDefault(\"border-color\"));\r\n\r\n    let ts = getDefault(\"DefaultText\").size;\r\n    let text = this._genLabel();\r\n\r\n    let cx = ts + this._getArrowSize();\r\n    let cy = this.dom.height/2;\r\n\r\n    this.dom.font = undefined;\r\n\r\n    g.save();\r\n\r\n    let th = Math.PI*0.5;\r\n\r\n    if (this.vertical) {\r\n      g.rotate(th);\r\n\r\n      ui_base.drawText(this, cx, -ts*0.5, text, {\r\n        canvas: this.dom,\r\n        g     : this.g,\r\n        size  : ts,\r\n        font  : getDefault(\"DefaultText\"),\r\n      });\r\n      g.restore();\r\n    } else {\r\n      ui_base.drawText(this, cx, cy + ts/2, text, {\r\n        canvas: this.dom,\r\n        g     : this.g,\r\n        size  : ts,\r\n        font  : getDefault(\"DefaultText\"),\r\n      });\r\n    }\r\n\r\n    let parseArrowColor = (arrowcolor) => {\r\n      arrowcolor = arrowcolor.trim();\r\n      if (arrowcolor.endsWith(\"%\")) {\r\n        arrowcolor = arrowcolor.slice(0, arrowcolor.length - 1).trim();\r\n\r\n        let perc = parseFloat(arrowcolor)/100.0;\r\n        let c = css2color(this.getDefault(\"background-color\"));\r\n\r\n        let f = (c[0] + c[1] + c[2])*perc;\r\n\r\n        f = ~~(f*255);\r\n        arrowcolor = `rgba(${f},${f},${f},0.95)`;\r\n\r\n      }\r\n      return arrowcolor;\r\n    }\r\n\r\n    let arrowcolor_base;\r\n    let arrowcolor;\r\n\r\n    arrowcolor_base = this.getDefault(\"arrow-color\");\r\n    arrowcolor_base = parseArrowColor(arrowcolor_base);\r\n\r\n    if (this._pressed && this._highlight) {\r\n      arrowcolor = this.getSubDefault(\"highlight-pressed\", \"arrow-color\", null, undefined, false);\r\n\r\n      if (!arrowcolor) {\r\n        arrowcolor = this.getSubDefault(\"pressed\", \"arrow-color\");\r\n      }\r\n\r\n      if (!arrowcolor) {\r\n        arrowcolor = \"33%\";\r\n      }\r\n    } else if (this._pressed) {\r\n      arrowcolor = this.getSubDefault(\"pressed\", \"arrow-color\", \"arrow-color\", \"33%\");\r\n    } else if (this._highlight) {\r\n      if (!this.hasClassSubDefault(\"highlight\", \"arrow-color\", false)) {\r\n        if (this.hasClassSubDefault(\"highlight\", \"background-color\", false)) {\r\n          arrowcolor = this.getSubDefault(\"highlight\", \"background-color\");\r\n        } else {\r\n          arrowcolor = this.getDefault(\"BoxHighlight\");\r\n        }\r\n\r\n        arrowcolor = css2color(arrowcolor);\r\n        let base = this.getSubDefault(\"pressed\", \"arrow-color\", undefined, \"33%\");\r\n        base = css2color(base);\r\n\r\n        arrowcolor.interp(base, 0.25);\r\n        arrowcolor = color2css(arrowcolor);\r\n      } else {\r\n        arrowcolor = this.getSubDefault(\"highlight\", \"arrow-color\");\r\n      }\r\n    } else {\r\n      arrowcolor = getDefault(\"arrow-color\", \"33%\");\r\n    }\r\n\r\n    if (this._pressed) {\r\n//      arrowcolor = this.getSubDefault(\"pressed\", \"arrow-color\");\r\n    }\r\n\r\n    arrowcolor = parseArrowColor(arrowcolor);\r\n\r\n\r\n    let d = 7, w = canvas.width, h = canvas.height;\r\n    let sz = this._getArrowSize();\r\n\r\n    if (this.vertical) {\r\n      g.beginPath();\r\n      g.moveTo(w*0.5, d);\r\n      g.lineTo(w*0.5 + sz*0.5, d + sz);\r\n      g.lineTo(w*0.5 - sz*0.5, d + sz);\r\n\r\n      g.fillStyle = over < 0 ? arrowcolor : arrowcolor_base;\r\n      g.fill();\r\n\r\n      g.beginPath();\r\n      g.moveTo(w*0.5, h - d);\r\n      g.lineTo(w*0.5 + sz*0.5, h - sz - d);\r\n      g.lineTo(w*0.5 - sz*0.5, h - sz - d);\r\n\r\n      g.fillStyle = over > 0 ? arrowcolor : arrowcolor_base;\r\n      g.fill();\r\n    } else {\r\n      g.beginPath();\r\n      g.moveTo(d, h*0.5);\r\n      g.lineTo(d + sz, h*0.5 + sz*0.5);\r\n      g.lineTo(d + sz, h*0.5 - sz*0.5);\r\n\r\n      g.fillStyle = over < 0 ? arrowcolor : arrowcolor_base;\r\n      g.fill();\r\n\r\n      g.beginPath();\r\n      g.moveTo(w - d, h*0.5);\r\n      g.lineTo(w - sz - d, h*0.5 + sz*0.5);\r\n      g.lineTo(w - sz - d, h*0.5 - sz*0.5);\r\n\r\n      g.fillStyle = over > 0 ? arrowcolor : arrowcolor_base;\r\n      g.fill();\r\n    }\r\n\r\n    g.fill();\r\n  }\r\n\r\n  _getArrowSize() {\r\n    return UIBase.getDPI()*10;\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(NumSlider);\r\n\r\n\r\nexport class NumSliderSimpleBase extends NumberSliderBase(UIBase) {\r\n  constructor() {\r\n    super();\r\n\r\n    this.baseUnit = undefined;\r\n    this.displayUnit = undefined;\r\n    this.editAsBaseUnit = undefined;\r\n    this.sliderDisplayExp = undefined;\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.g = this.canvas.getContext(\"2d\");\r\n\r\n    this.canvas.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.highlight = false;\r\n    this.isInt = false;\r\n\r\n    this.shadow.appendChild(this.canvas);\r\n    this.range = [0, 1];\r\n\r\n    /** if not undefined defines subrange of visible slider */\r\n    this.uiRange = undefined;\r\n\r\n    this.step = 0.1;\r\n    this._value = 0.5;\r\n    this.ma = undefined;\r\n    this._focus = false;\r\n\r\n    this.modal = undefined;\r\n\r\n    this._last_slider_key = '';\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(val) {\r\n    this.setValue(val);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname    : \"numslider-simple-base-x\",\r\n      style      : \"numslider_simple\",\r\n      parentStyle: \"button\"\r\n    }\r\n  }\r\n\r\n  setValue(val, fire_onchange = true, setDataPath = true) {\r\n    val = Math.min(Math.max(val, this.range[0]), this.range[1]);\r\n\r\n    if (this.isInt) {\r\n      val = Math.floor(val);\r\n    }\r\n\r\n    if (this._value !== val) {\r\n      this._value = val;\r\n      this._redraw();\r\n\r\n      if (this.onchange && fire_onchange) {\r\n        this.onchange(val);\r\n      }\r\n\r\n      if (setDataPath && this.getAttribute(\"datapath\")) {\r\n        let path = this.getAttribute(\"datapath\");\r\n        this.setPathValue(this.ctx, path, this._value);\r\n      }\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n\r\n    if (!path || path === \"null\" || path === \"undefined\") {\r\n      return;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, path);\r\n\r\n    if (this.isInt) {\r\n      val = Math.floor(val);\r\n    }\r\n\r\n    if (val !== this._value) {\r\n      let prop = this.getPathMeta(this.ctx, path);\r\n      if (!prop) {\r\n        return;\r\n      }\r\n\r\n      this.loadNumConstraints(prop);\r\n      this.setValue(val, true, false);\r\n    }\r\n  }\r\n\r\n  _setFromMouse(e) {\r\n    let rect = this.getClientRects()[0];\r\n    if (rect === undefined) {\r\n      return;\r\n    }\r\n\r\n    let x = e.x - rect.left;\r\n    let dpi = UIBase.getDPI();\r\n    let co = this._getButtonPos();\r\n\r\n    let val = this._invertButtonX(x*dpi);\r\n    this.value = val;\r\n  }\r\n\r\n  _startModal(e) {\r\n    if (this.disabled) {\r\n      return;\r\n    }\r\n\r\n    if (e !== undefined) {\r\n      this._setFromMouse(e);\r\n    }\r\n    let dom = window;\r\n    let evtargs = {capture: false};\r\n\r\n    if (this.modal) {\r\n      console.warn(\"Double call to _startModal!\");\r\n      return;\r\n    }\r\n\r\n    this.ma = new util.MovingAvg(eventWasTouch(e) ? 4 : 2);\r\n    let handlers;\r\n\r\n    let end = () => {\r\n      if (handlers === undefined) {\r\n        return;\r\n      }\r\n\r\n      this.popModal();\r\n      handlers = undefined;\r\n    };\r\n\r\n    handlers = {\r\n      pointermove: (e) => {\r\n        let x = e.x, y = e.y;\r\n\r\n        x = this.ma.add(x);\r\n\r\n        let e2 = new MouseEvent(e, {\r\n          x, y\r\n        });\r\n        this._setFromMouse(e);\r\n      },\r\n\r\n      pointerover : (e) => {\r\n      },\r\n      pointerout  : (e) => {\r\n      },\r\n      pointerleave: (e) => {\r\n      },\r\n      pointerenter: (e) => {\r\n      },\r\n      blur        : (e) => {\r\n      },\r\n      focus       : (e) => {\r\n      },\r\n\r\n      pointerup: (e) => {\r\n        this.undoBreakPoint();\r\n        end();\r\n      },\r\n\r\n      keydown: (e) => {\r\n        switch (e.keyCode) {\r\n          case keymap[\"Enter\"]:\r\n          case keymap[\"Space\"]:\r\n          case keymap[\"Escape\"]:\r\n            end();\r\n        }\r\n      }\r\n    };\r\n\r\n    function makefunc(f) {\r\n      return (e) => {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n\r\n        return f(e);\r\n      }\r\n    }\r\n\r\n    for (let k in handlers) {\r\n      handlers[k] = makefunc(handlers[k]);\r\n    }\r\n\r\n    this.pushModal(handlers);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    if (!this.hasAttribute(\"tab-index\")) {\r\n      this.setAttribute(\"tab-index\", 0);\r\n    }\r\n\r\n    this.updateSize();\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      let dt = this.range[1] > this.range[0] ? 1 : -1;\r\n\r\n      switch (e.keyCode) {\r\n        case keymap[\"Left\"]:\r\n        case keymap[\"Right\"]:\r\n          let fac = this.step;\r\n\r\n          if (e.shiftKey) {\r\n            fac *= 0.1;\r\n          }\r\n\r\n          if (this.isInt) {\r\n            fac = Math.max(fac, 1);\r\n          }\r\n\r\n          this.value += e.keyCode === keymap[\"Left\"] ? -dt*fac : dt*fac;\r\n\r\n          break;\r\n      }\r\n    });\r\n\r\n    this.addEventListener(\"focusin\", () => {\r\n      if (this.disabled) return;\r\n\r\n      this._focus = 1;\r\n      this._redraw();\r\n      this.focus();\r\n    });\r\n\r\n    this.addEventListener(\"pointerdown\", (e) => {\r\n      if (this.disabled) {\r\n        return;\r\n      }\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n      this._startModal(e);\r\n    });\r\n\r\n    this.addEventListener(\"pointerin\", (e) => {\r\n      this.setHighlight(e);\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"pointerout\", (e) => {\r\n      this.highlight = false;\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"pointerover\", (e) => {\r\n      this.setHighlight(e);\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"pointermove\", (e) => {\r\n      this.setHighlight(e);\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"pointerleave\", (e) => {\r\n      this.highlight = false;\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"blur\", (e) => {\r\n      this._focus = 0;\r\n      this.highlight = false;\r\n      this._redraw();\r\n    });\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  setHighlight(e) {\r\n    this.highlight = this.isOverButton(e) ? 2 : 1;\r\n  }\r\n\r\n  _redraw() {\r\n    let g = this.g, canvas = this.canvas;\r\n    let w = canvas.width, h = canvas.height;\r\n    let dpi = UIBase.getDPI();\r\n\r\n    let color = this.getDefault(\"background-color\");\r\n    let sh = ~~(this.getDefault(\"SlideHeight\")*dpi + 0.5);\r\n\r\n    g.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    g.fillStyle = color;\r\n\r\n    let y = (h - sh)*0.5;\r\n\r\n    let r = this.getDefault(\"border-radius\");\r\n\r\n    g.translate(0, y);\r\n    ui_base.drawRoundBox(this, this.canvas, g, w, sh, r, \"fill\", color, undefined, true);\r\n\r\n    let bcolor = this.getDefault('border-color');\r\n    ui_base.drawRoundBox(this, this.canvas, g, w, sh, r, \"stroke\", bcolor, undefined, true);\r\n    g.translate(0, -y);\r\n\r\n    if (this.sliderDisplayExp && this.sliderDisplayExp !== 1.0) {\r\n      g.strokeStyle = this.getDefault(\"SliderDivColor\")\r\n        || this.getDefault(\"border-color\")\r\n        || \"grey\";\r\n\r\n      let steps = 8;\r\n      let t = 0.0, dt = 1.0/(steps - 1);\r\n\r\n      g.beginPath();\r\n      for (let i = 0; i < steps; i++, t += dt) {\r\n        let t2 = Math.pow(t, this.sliderDisplayExp);\r\n\r\n        let x = t2*w;\r\n        g.moveTo(x, y);\r\n        g.lineTo(x, h - y);\r\n      }\r\n      g.stroke();\r\n    }\r\n\r\n    if (this.highlight === 1) {\r\n      color = this.getDefault(\"BoxHighlight\");\r\n    } else {\r\n      color = this.getDefault(\"border-color\");\r\n    }\r\n\r\n    //g.strokeStyle = color;\r\n    //g.stroke();\r\n\r\n    let co = this._getButtonPos();\r\n\r\n    g.beginPath();\r\n\r\n    if (this.highlight === 2) {\r\n      color = this.getDefault(\"BoxHighlight\");\r\n    } else {\r\n      color = this.getDefault(\"border-color\");\r\n    }\r\n\r\n    g.arc(co[0], co[1], Math.abs(co[2]), -Math.PI, Math.PI);\r\n    g.fill();\r\n\r\n    g.strokeStyle = color;\r\n    g.stroke();\r\n\r\n    g.beginPath();\r\n    g.setLineDash([4, 4]);\r\n\r\n    if (this._focus) {\r\n      g.strokeStyle = this.getDefault(\"BoxHighlight\");\r\n      g.arc(co[0], co[1], co[2] - 4, -Math.PI, Math.PI);\r\n      g.stroke();\r\n    }\r\n\r\n    g.setLineDash([]);\r\n  }\r\n\r\n  isOverButton(e) {\r\n    let x = e.x, y = e.y;\r\n    let rect = this.getClientRects()[0];\r\n\r\n    if (!rect) {\r\n      return false;\r\n    }\r\n\r\n    x -= rect.left;\r\n    y -= rect.top;\r\n\r\n    let co = this._getButtonPos();\r\n\r\n    let dpi = UIBase.getDPI();\r\n    let dv = new Vector2([co[0]/dpi - x, co[1]/dpi - y]);\r\n    let dis = dv.vectorLength();\r\n\r\n    return dis < co[2]/dpi;\r\n  }\r\n\r\n  _invertButtonX(x) {\r\n    let w = this.canvas.width;\r\n    let dpi = UIBase.getDPI();\r\n    let sh = ~~(this.getDefault(\"SlideHeight\")*dpi + 0.5);\r\n    let boxw = this.canvas.height - 4;\r\n    let w2 = w - boxw;\r\n\r\n    let range = this.uiRange || this.range;\r\n\r\n    x = (x - boxw*0.5)/w2;\r\n    if (this.sliderDisplayExp) {\r\n      x = Math.max(x, 0.0);\r\n      x = Math.pow(x, 1.0/this.sliderDisplayExp);\r\n    }\r\n    x = x*(range[1] - range[0]) + range[0];\r\n\r\n    return x;\r\n  }\r\n\r\n  _getButtonPos() {\r\n    let w = this.canvas.width;\r\n    let dpi = UIBase.getDPI();\r\n    let sh = ~~(this.getDefault(\"SlideHeight\")*dpi + 0.5);\r\n    let x = this._value;\r\n\r\n    let range = this.uiRange || this.range;\r\n\r\n    x = (x - range[0])/(range[1] - range[0]);\r\n\r\n    if (this.sliderDisplayExp) {\r\n      x = Math.pow(x, this.sliderDisplayExp);\r\n    }\r\n\r\n    let boxw = this.canvas.height - 4;\r\n    let w2 = w - boxw;\r\n\r\n    x = x*w2 + boxw*0.5;\r\n\r\n    return [x, boxw*0.5, boxw*0.5];\r\n  }\r\n\r\n  setCSS() {\r\n    //UIBase.setCSS does annoying things with background-color\r\n    //super.setCSS();\r\n\r\n    const dpi = UIBase.getDPI();\r\n    this.style[\"min-width\"] = this.getDefault(\"width\") + \"px\";\r\n    this.style[\"width\"] = this.getDefault(\"width\") + \"px\";\r\n\r\n    this.canvas.style[\"width\"] = \"\" + (this.canvas.width/dpi) + \"px\";\r\n    this.canvas.style[\"height\"] = \"\" + (this.canvas.height/dpi) + \"px`\";\r\n\r\n    this.canvas.height = this.getDefault(\"height\")*UIBase.getDPI();\r\n\r\n    this._redraw();\r\n  }\r\n\r\n  updateSize() {\r\n    if (this.canvas === undefined) {\r\n      return;\r\n    }\r\n\r\n    let rect = this.getClientRects()[0];\r\n\r\n    if (rect === undefined) {\r\n      return;\r\n    }\r\n\r\n    let dpi = UIBase.getDPI();\r\n    let canvas = this.canvas;\r\n    let w = ~~(rect.width*dpi), h = ~~(rect.height*dpi);\r\n\r\n    if (w !== canvas.width || h !== canvas.height) {\r\n      this.canvas.width = w;\r\n      this.canvas.height = h;\r\n\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _ondestroy() {\r\n    if (this.modalRunning) {\r\n      this.popModal();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    /*\r\n    if (this.checkThemeUpdate()) {\r\n      this._redraw();\r\n    }\r\n    */\r\n\r\n    let key = \"\" + this.getDefault(\"width\") + \":\" + this.getDefault(\"height\") + \":\" + this.getDefault(\"SlideHeight\");\r\n\r\n    if (key !== this._last_slider_key) {\r\n      this._last_slider_key = key;\r\n\r\n      this.flushUpdate();\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n\r\n    if (this.getAttribute(\"tab-index\") !== this.tabIndex) {\r\n      this.tabIndex = this.getAttribute(\"tab-index\");\r\n    }\r\n\r\n    this.updateSize();\r\n    this.updateDataPath();\r\n    updateSliderFromDom(this);\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(NumSliderSimpleBase);\r\n\r\nexport class SliderWithTextbox extends ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this._value = 0;\r\n    this._name = undefined;\r\n    this._lock_textbox = false;\r\n    this._labelOnTop = undefined;\r\n\r\n    this._last_label_on_top = undefined;\r\n\r\n    this.container = this;\r\n\r\n    this.textbox = UIBase.createElement(\"textbox-x\");\r\n    this.textbox.width = 55;\r\n    this._numslider = undefined;\r\n\r\n    this.textbox.overrideDefault(\"width\", this.getDefault(\"TextBoxWidth\"));\r\n    this.textbox.setAttribute(\"class\", \"numslider_simple_textbox\");\r\n    this.textbox.startSelected = true;\r\n\r\n    this._last_value = undefined;\r\n  }\r\n\r\n  get addLabel() {\r\n    if (this.hasAttribute(\"add-label\")) {\r\n      let val = (\"\" + this.getAttribute(\"add-label\")).toLowerCase();\r\n      return val === \"true\" || val === \"yes\";\r\n    }\r\n\r\n    return this.getDefault(\"addLabel\");\r\n  }\r\n\r\n  set addLabel(v) {\r\n    this.setAttribute(\"add-label\", v ? \"true\" : \"false\");\r\n\r\n    if (this.addLabel && !this.l) {\r\n      this.doOnce(this.rebuild);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * whether to put label on top or to the left of sliders\r\n   *\r\n   * If undefined value will be either this.getAtttribute(\"labelOnTop\"),\r\n   * if \"labelOnTop\" attribute exists, or it will be this.getDefault(\"labelOnTop\")\r\n   * (theme default)\r\n   **/\r\n  get labelOnTop() {\r\n    let ret = this._labelOnTop;\r\n\r\n    if (ret === undefined && this.hasAttribute(\"labelOnTop\")) {\r\n      let val = this.getAttribute(\"labelOnTop\");\r\n      if (typeof val === \"string\") {\r\n        val = val.toLowerCase();\r\n        ret = val === \"true\" || val === \"yes\";\r\n      } else {\r\n        ret = !!val;\r\n      }\r\n    }\r\n\r\n    if (ret === undefined) {\r\n      ret = this.getDefault(\"labelOnTop\");\r\n    }\r\n\r\n    return !!ret;\r\n  }\r\n\r\n  set labelOnTop(v) {\r\n    this._labelOnTop = v;\r\n  }\r\n\r\n  get numslider() {\r\n    return this._numslider;\r\n  }\r\n\r\n  //child classes set this in their constructors\r\n  set numslider(v) {\r\n    this._numslider = v;\r\n    this.textbox.range = this._numslider.range;\r\n  }\r\n\r\n  get editAsBaseUnit() {\r\n    return this.numslider.editAsBaseUnit;\r\n  }\r\n\r\n  set editAsBaseUnit(v) {\r\n    this.numslider.editAsBaseUnit = v;\r\n  }\r\n\r\n  get range() {\r\n    return this.numslider.range;\r\n  }\r\n\r\n  set range(v) {\r\n    this.numslider.range = v;\r\n  }\r\n\r\n  get step() {\r\n    return this.numslider.step;\r\n  }\r\n\r\n  set step(v) {\r\n    this.numslider.step = v;\r\n  }\r\n\r\n  get expRate() {\r\n    return this.numslider.expRate;\r\n  }\r\n\r\n  set expRate(v) {\r\n    this.numslider.expRate = v;\r\n  }\r\n\r\n  get decimalPlaces() {\r\n    return this.numslider.decimalPlaces;\r\n  }\r\n\r\n  set decimalPlaces(v) {\r\n    this.numslider.decimalPlaces = v;\r\n  }\r\n\r\n  get isInt() {\r\n    return this.numslider.isInt;\r\n  }\r\n\r\n  set isInt(v) {\r\n    this.numslider.isInt = v;\r\n  }\r\n\r\n  get slideSpeed() {\r\n    return this.numslider.slideSpeed;\r\n  }\r\n\r\n  set slideSpeed(v) {\r\n    this.numslider.slideSpeed = v;\r\n  }\r\n\r\n  get sliderDisplayExp() {\r\n    return this.numslider.sliderDisplayExp;\r\n  }\r\n\r\n  set sliderDisplayExp(v) {\r\n    this.numslider.sliderDisplayExp = v;\r\n  }\r\n\r\n  get radix() {\r\n    return this.numslider.radix;\r\n  }\r\n\r\n  set radix(v) {\r\n    this.numslider.radix = v;\r\n  }\r\n\r\n  get stepIsRelative() {\r\n    return this.numslider.stepIsRelative;\r\n  }\r\n\r\n  set stepIsRelative(v) {\r\n    this.numslider.stepIsRelative = v;\r\n  }\r\n\r\n  get displayUnit() {\r\n    return this.numslider.displayUnit;\r\n  }\r\n\r\n  set displayUnit(val) {\r\n    let update = val !== this.displayUnit;\r\n\r\n    this.numslider.displayUnit = this.textbox.displayUnit = val;\r\n\r\n    if (update) {\r\n      //this.numslider._redraw();\r\n      this.updateTextBox();\r\n    }\r\n  }\r\n\r\n  get baseUnit() {\r\n    return this.textbox.baseUnit;\r\n  }\r\n\r\n  set baseUnit(val) {\r\n    let update = val !== this.baseUnit;\r\n\r\n    this.numslider.baseUnit = this.textbox.baseUnit = val;\r\n\r\n    if (update) {\r\n      //this.slider._redraw();\r\n      this.updateTextBox();\r\n    }\r\n  }\r\n\r\n  get realTimeTextBox() {\r\n    let ret = this.getAttribute(\"realtime\");\r\n\r\n    if (!ret) {\r\n      return false;\r\n    }\r\n\r\n    ret = ret.toLowerCase().trim();\r\n\r\n    return ret === 'true' || ret === 'on' || ret === 'yes';\r\n  }\r\n\r\n  set realTimeTextBox(val) {\r\n    this.setAttribute(\"realtime\", val ? \"true\" : \"false\");\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(val) {\r\n    this.setValue(val);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.rebuild();\r\n    window.setTimeout(() => this.updateTextBox(), 500);\r\n  }\r\n\r\n  rebuild() {\r\n    this._last_label_on_top = this.labelOnTop;\r\n\r\n    this.container.clear();\r\n\r\n    if (!this.labelOnTop) {\r\n      this.container = this.row();\r\n    } else {\r\n      this.container = this;\r\n    }\r\n\r\n    if (this.hasAttribute(\"name\")) {\r\n      this._name = this.getAttribute(\"name\");\r\n    } else {\r\n      this._name = \"slider\";\r\n    }\r\n\r\n\r\n    if (this.addLabel) {\r\n      this.l = this.container.label(this._name);\r\n      this.l.overrideClass(\"numslider_textbox\");\r\n      this.l.font = \"TitleText\";\r\n      this.l.style[\"display\"] = \"float\";\r\n      this.l.style[\"position\"] = \"relative\";\r\n    }\r\n\r\n    let strip = this.container.row();\r\n    //strip.style['justify-content'] = 'space-between';\r\n    strip.add(this.numslider);\r\n\r\n    let path = this.hasAttribute(\"datapath\") ? this.getAttribute(\"datapath\") : undefined;\r\n\r\n    let textbox = this.textbox;\r\n    this.textbox.overrideDefault(\"width\", this.getDefault(\"TextBoxWidth\"));\r\n\r\n    let apply_textbox = () => {\r\n      let text = textbox.text;\r\n\r\n      if (!units.isNumber(text)) {\r\n        textbox.flash(\"red\");\r\n        return;\r\n      } else {\r\n        textbox.flash(\"green\");\r\n\r\n        let displayUnit = this.editAsBaseUnit ? undefined : this.displayUnit;\r\n\r\n        let f = units.parseValue(text, this.baseUnit, displayUnit);\r\n\r\n        if (isNaN(f)) {\r\n          this.flash(\"red\");\r\n          return;\r\n        }\r\n\r\n        if (this.isInt) {\r\n          f = Math.floor(f);\r\n        }\r\n\r\n        this._lock_textbox = 1;\r\n        this.setValue(f);\r\n        this._lock_textbox = 0;\r\n\r\n      }\r\n    };\r\n\r\n    if (this.realTimeTextBox) {\r\n      textbox.onchange = apply_textbox;\r\n    }\r\n\r\n    textbox.onend = apply_textbox;\r\n\r\n    textbox.ctx = this.ctx;\r\n    textbox.packflag |= this.inherit_packflag;\r\n    textbox.overrideDefault(\"width\", this.getDefault(\"TextBoxWidth\"));\r\n\r\n    textbox.style[\"height\"] = (this.getDefault(\"height\") - 2) + \"px\";\r\n    textbox._init();\r\n\r\n    strip.add(textbox);\r\n\r\n    textbox.setCSS();\r\n    this.linkTextBox();\r\n\r\n    let in_onchange = 0;\r\n\r\n    this.numslider.onchange = (val) => {\r\n      this._value = this.numslider.value;\r\n      this.updateTextBox();\r\n\r\n      if (in_onchange) {\r\n        return;\r\n      }\r\n\r\n      if (this.onchange !== undefined) {\r\n        in_onchange++;\r\n        try {\r\n          if (this.onchange) {\r\n            this.onchange(this);\r\n          }\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n        }\r\n      }\r\n\r\n      in_onchange--;\r\n    }\r\n  }\r\n\r\n  updateTextBox() {\r\n    if (!this._init_done) {\r\n      return;\r\n    }\r\n\r\n    if (this._lock_textbox > 0 || this.textbox.editing)\r\n      return;\r\n\r\n    this.textbox.text = this.formatNumber(this._value);\r\n    this.textbox.update();\r\n\r\n    updateSliderFromDom(this, this.numslider);\r\n  }\r\n\r\n  linkTextBox() {\r\n    this.updateTextBox();\r\n\r\n    let onchange = this.numslider.onchange;\r\n    this.numslider.onchange = (e) => {\r\n      this._value = e.value;\r\n      this.updateTextBox();\r\n\r\n      onchange(e);\r\n    }\r\n  }\r\n\r\n  setValue(val, fire_onchange = true) {\r\n    this._value = val;\r\n    this.numslider.setValue(val, fire_onchange);\r\n    this.updateTextBox();\r\n  }\r\n\r\n  updateName() {\r\n    let name = this.getAttribute(\"name\");\r\n\r\n    if (!name && this.hasAttribute(\"datapath\")) {\r\n      let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n      if (prop) {\r\n        name = prop.uiname;\r\n      }\r\n    }\r\n\r\n    if (!name) {\r\n      name = \"[error]\";\r\n    }\r\n\r\n    if (name !== this._name) {\r\n      this._name = name;\r\n      if (this.l) {\r\n        this.l.text = name;\r\n      }\r\n    }\r\n  }\r\n\r\n  updateLabelOnTop() {\r\n    if (this.labelOnTop !== this._last_label_on_top) {\r\n      this._last_label_on_top = this.labelOnTop;\r\n      this.rebuild();\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.ctx || !this.getAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"))\r\n\r\n    if (!prop) {\r\n      return;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n    if (val !== this._last_value) {\r\n      this._last_value = this._value = val;\r\n      this.updateTextBox();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    this.updateLabelOnTop();\r\n    super.update();\r\n\r\n    this.updateDataPath();\r\n    let redraw = false;\r\n\r\n    updateSliderFromDom(this, this.numslider);\r\n    updateSliderFromDom(this, this.textbox);\r\n\r\n    if (redraw) {\r\n      this.setCSS();\r\n      this.numslider.setCSS();\r\n      this.numslider._redraw();\r\n    }\r\n\r\n    this.updateName();\r\n\r\n    this.numslider.description = this.description;\r\n    this.textbox.description = this.title; //get full, transformed toolip\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.numslider.setAttribute(\"datapath\", this.getAttribute(\"datapath\"));\r\n      this.textbox.setAttribute(\"datapath\", this.getAttribute(\"datapath\"));\r\n    }\r\n\r\n    if (this.hasAttribute(\"mass_set_path\")) {\r\n      this.numslider.setAttribute(\"mass_set_path\", this.getAttribute(\"mass_set_path\"))\r\n      this.textbox.setAttribute(\"mass_set_path\", this.getAttribute(\"mass_set_path\"));\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n    this.textbox.setCSS();\r\n    //textbox.style[\"margin\"] = \"5px\";\r\n\r\n  }\r\n}\r\n\r\nexport class NumSliderSimple extends SliderWithTextbox {\r\n  constructor() {\r\n    super();\r\n\r\n    this.numslider = UIBase.createElement(\"numslider-simple-base-x\");\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"numslider-simple-x\",\r\n      style  : \"numslider_simple\"\r\n    }\r\n  }\r\n\r\n  _redraw() {\r\n    this.numslider._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(NumSliderSimple);\r\n\r\nexport class NumSliderWithTextBox extends SliderWithTextbox {\r\n  constructor() {\r\n    super();\r\n\r\n    this.numslider = UIBase.createElement(\"numslider-x\");\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"numslider-textbox-x\",\r\n      style  : \"numslider_textbox\"\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    if (this.hasAttribute(\"name\")) {\r\n      let name = this.getAttribute(\"name\");\r\n\r\n      if (name !== this.numslider.name) {\r\n        this.numslider.setAttribute(\"name\", name);\r\n        this.numslider._redraw();\r\n      }\r\n    }\r\n  }\r\n\r\n  _redraw() {\r\n    this.numslider._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(NumSliderWithTextBox);\r\n\r\n","//stores xml sources\r\nimport {isNumber} from '../path-controller/toolsys/toolprop.js';\r\n\r\nlet pagecache = new Map()\r\nimport {PackFlags, UIBase} from '../core/ui_base.js';\r\nimport {sliderDomAttributes} from '../widgets/ui_numsliders.js';\r\nimport * as util from '../util/util.js';\r\nimport {Menu} from '../widgets/ui_menu.js';\r\nimport {Icons} from '../core/ui_base.js';\r\nimport {Container} from '../core/ui.js';\r\n\r\nexport var domTransferAttrs = new Set([\"id\", \"title\", \"tab-index\"]);\r\nexport var domEventAttrs = new Set([\"click\", \"mousedown\", \"mouseup\", \"mousemove\", \"keydown\", \"keypress\"]);\r\n\r\nexport function parseXML(xml) {\r\n  let parser = new DOMParser()\r\n  xml = `<root>${xml}</root>`;\r\n  return parser.parseFromString(xml.trim(), \"application/xml\");\r\n}\r\n\r\nlet num_re = /[0-9]+$/;\r\n\r\nfunction getIconFlag(elem) {\r\n  if (!elem.hasAttribute(\"useIcons\")) {\r\n    return 0;\r\n  }\r\n\r\n  let attr = elem.getAttribute(\"useIcons\");\r\n\r\n  if (typeof attr === \"string\") {\r\n    attr = attr.toLowerCase().trim();\r\n  }\r\n\r\n  if (attr === \"false\" || attr === \"no\") {\r\n    return 0;\r\n  }\r\n\r\n  if (attr === \"true\" || attr === \"yes\") {\r\n    return PackFlags.USE_ICONS;\r\n  } else if (attr === \"small\") {\r\n    return PackFlags.SMALL_ICON | PackFlags.USE_ICONS;\r\n  } else if (attr === \"large\") {\r\n    return PackFlags.LARGE_ICON | PackFlags.USE_ICONS;\r\n  } else {\r\n    let isnum = typeof attr === \"number\";\r\n    let sheet = attr;\r\n\r\n    if (typeof sheet === \"string\" && sheet.search(num_re) === 0) {\r\n      sheet = parseInt(sheet);\r\n      isnum = true;\r\n    }\r\n\r\n    if (!isnum) {\r\n      return PackFlags.USE_ICONS;\r\n    }\r\n\r\n    let flag = PackFlags.USE_ICONS | PackFlags.CUSTOM_ICON_SHEET;\r\n    flag |= ((sheet - 1)<<PackFlags.CUSTOM_ICON_SHEET_START);\r\n\r\n    return flag;\r\n  }\r\n\r\n  return 0;\r\n}\r\n\r\nfunction getPackFlag(elem) {\r\n  let packflag = getIconFlag(elem);\r\n\r\n  if (elem.hasAttribute(\"drawChecks\")) {\r\n    if (!getbool(elem, \"drawChecks\")) {\r\n      packflag |= PackFlags.HIDE_CHECK_MARKS;\r\n    } else {\r\n      packflag &= ~PackFlags.HIDE_CHECK_MARKS;\r\n    }\r\n  }\r\n\r\n  if (getbool(elem, \"simpleSlider\")) {\r\n    packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n  }\r\n  if (getbool(elem, \"rollarSlider\")) {\r\n    packflag |= PackFlags.FORCE_ROLLER_SLIDER;\r\n  }\r\n\r\n  return packflag;\r\n}\r\n\r\nfunction myParseFloat(s) {\r\n  s = '' + s;\r\n  s = s.trim().toLowerCase();\r\n\r\n  if (s.endsWith(\"px\")) {\r\n    s = s.slice(0, s.length - 2);\r\n  }\r\n\r\n  return parseFloat(s);\r\n}\r\n\r\nfunction getbool(elem, attr) {\r\n  let ret = elem.getAttribute(attr);\r\n  if (!ret) {\r\n    return false;\r\n  }\r\n\r\n  ret = ret.toLowerCase();\r\n  return ret === \"1\" || ret === \"true\" || ret === \"yes\";\r\n}\r\n\r\nfunction getfloat(elem, attr, defaultval) {\r\n  if (!elem.hasAttribute(attr)) {\r\n    return defaultval;\r\n  }\r\n\r\n  return myParseFloat(elem.getAttribute(attr));\r\n}\r\n\r\n/*\r\n**\r\n*\r\n* a customHandler can be a callback, or the string \"default\", e.g.\r\n*\r\n* xmlpage.customHandlers[\"homegig-element-x\"] = \"default\".\r\n*\r\n* The default case simply suppresses the warning that would otherwise\r\n* be printed to the console.\r\n* */\r\nexport const customHandlers = {};\r\n\r\nclass Handler {\r\n  constructor(ctx, container) {\r\n    this.container = container;\r\n    this.stack = [];\r\n    this.ctx = ctx;\r\n    this.codefuncs = {};\r\n\r\n    this.templateVars = {};\r\n\r\n    let attrs = util.list(sliderDomAttributes);\r\n\r\n    //note that useIcons, showLabel and sliderMode are PackFlag bits and are inherited through that system\r\n\r\n    this.inheritDomAttrs = {};\r\n    this.inheritDomAttrKeys = new Set(attrs);\r\n  }\r\n\r\n  push() {\r\n    this.stack.push(this.container);\r\n    this.stack.push(new Set(this.inheritDomAttrKeys));\r\n    this.stack.push(Object.assign({}, this.inheritDomAttrs));\r\n  }\r\n\r\n  pop() {\r\n    this.inheritDomAttrs = this.stack.pop();\r\n    this.inheritDomAttrKeys = this.stack.pop();\r\n    this.container = this.stack.pop();\r\n  }\r\n\r\n  handle(elem) {\r\n    if (elem.constructor === XMLDocument || elem.nodeName === 'root') {\r\n      for (let child of elem.childNodes) {\r\n        this.handle(child);\r\n      }\r\n\r\n      window.tree = elem\r\n      return;\r\n    } else if (elem.constructor === Text || elem.constructor === Comment) {\r\n      return;\r\n    }\r\n\r\n    let tagname = \"\" + elem.tagName;\r\n\r\n    if (tagname in customHandlers) {\r\n      customHandlers[tagname](this, elem);\r\n    } else if (this[tagname]) {\r\n      this[tagname](elem);\r\n    } else {\r\n      let elem2 = UIBase.createElement(tagname.toLowerCase());\r\n\r\n      window.__elem = elem;\r\n      //transfer DOM attributes\r\n      for (let k of elem.getAttributeNames()) {\r\n        elem2.setAttribute(k, elem.getAttribute(k));\r\n      }\r\n\r\n      if (elem2 instanceof UIBase) {\r\n        if (!elem2.hasAttribute(\"datapath\") && elem2.hasAttribute(\"path\")) {\r\n          elem2.setAttribute(\"datapath\", elem2.getAttribute(\"path\"));\r\n        }\r\n\r\n        if (elem2.hasAttribute(\"datapath\")) {\r\n          let path = elem2.getAttribute(\"datapath\");\r\n          path = this.container._joinPrefix(path);\r\n          elem2.setAttribute(\"datapath\", path);\r\n        }\r\n\r\n        if (elem2.hasAttribute(\"massSetPath\") || this.container.massSetPrefix) {\r\n          let massSetPath = \"\";\r\n\r\n          if (elem2.hasAttribute(\"massSetPath\")) {\r\n            massSetPath = elem2.getAttribute(\"massSetPath\");\r\n          }\r\n\r\n          let path = elem2.getAttribute(\"datapath\");\r\n\r\n          path = this.container._getMassPath(this.container.ctx, path, massSetPath);\r\n          elem2.setAttribute(\"massSetPath\", path);\r\n          elem2.setAttribute(\"mass_set_path\", path);\r\n        }\r\n\r\n        this.container.add(elem2);\r\n        this._style(elem, elem2);\r\n\r\n        if (elem2 instanceof Container) {\r\n          this.push();\r\n\r\n          this.container = elem2;\r\n          this._container(elem, elem2, true);\r\n          this.visit(elem);\r\n\r\n          this.pop();\r\n\r\n          return;\r\n        }\r\n      } else {\r\n        console.warn(\"Unknown element \" + elem.tagName + \" (\" + elem.constructor.name + \")\");\r\n        let elem2 = document.createElement(elem.tagName.toLowerCase());\r\n\r\n        for (let attr of elem.getAttributeNames()) {\r\n          elem2.setAttribute(attr, elem.getAttribute(attr));\r\n        }\r\n\r\n        this._basic(elem, elem2);\r\n\r\n        this.container.shadow.appendChild(elem2);\r\n\r\n        if (!(elem2 instanceof UIBase)) {\r\n          elem2.pathux_ctx = this.container.ctx;\r\n        } else {\r\n          elem2.ctx = this.container.ctx;\r\n        }\r\n      }\r\n\r\n      this.visit(elem);\r\n    }\r\n  }\r\n\r\n  _style(elem, elem2) {\r\n    let style = {};\r\n\r\n    //try to handle class attribute, at least somewhat\r\n\r\n    if (elem.hasAttribute(\"class\")) {\r\n      elem2.setAttribute(\"class\", elem.getAttribute(\"class\"));\r\n\r\n      let cls = elem2.getAttribute(\"class\").trim();\r\n      let keys = [\r\n        cls,\r\n        (elem2.tagName.toLowerCase() + \".\" + cls).trim(),\r\n        \"#\" + elem.getAttribute(\"id\").trim()\r\n      ];\r\n\r\n      for (let sheet of document.styleSheets) {\r\n        for (let rule of sheet.rules) {\r\n          for (let k of keys) {\r\n            if (rule.selectorText.trim() === k) {\r\n              for (let k2 of rule.styleMap.keys()) {\r\n                let val = rule.style[k2]\r\n\r\n                style[k2] = val;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (elem.hasAttribute(\"style\")) {\r\n      let stylecode = elem.getAttribute(\"style\");\r\n\r\n      stylecode = stylecode.split(\";\");\r\n\r\n      for (let row of stylecode) {\r\n        row = row.trim();\r\n\r\n        let i = row.search(/\\:/);\r\n        if (i >= 0) {\r\n          let key = row.slice(0, i).trim();\r\n          let val = row.slice(i + 1, row.length).trim();\r\n\r\n          style[key] = val;\r\n        }\r\n      }\r\n    }\r\n\r\n    let keys = Object.keys(style);\r\n    if (keys.length === 0) {\r\n      return;\r\n    }\r\n\r\n    function setStyle() {\r\n      for (let k of keys) {\r\n        elem2.style[k] = style[k];\r\n      }\r\n    }\r\n\r\n    if (elem2 instanceof UIBase) {\r\n      elem2.setCSS.after(() => {\r\n        setStyle();\r\n      });\r\n    }\r\n\r\n    setStyle();\r\n  }\r\n\r\n  visit(node) {\r\n    for (let child of node.childNodes) {\r\n      this.handle(child)\r\n    }\r\n  }\r\n\r\n  _getattr(elem, k) {\r\n    let val = elem.getAttribute(k);\r\n\r\n    if (!val) {\r\n      return val;\r\n    }\r\n\r\n    if (val.startsWith(\"##\")) {\r\n      val = val.slice(2, val.length).trim();\r\n\r\n      if (!(val in this.templateVars)) {\r\n        console.error(`unknown template variable '${val}'`);\r\n        val = '';\r\n      } else {\r\n        val = this.templateVars[val];\r\n      }\r\n    }\r\n\r\n    return val;\r\n  }\r\n\r\n  _basic(elem, elem2) {\r\n    this._style(elem, elem2);\r\n\r\n    for (let k of elem.getAttributeNames()) {\r\n      if (k.startsWith(\"custom\")) {\r\n        elem2.setAttribute(k, this._getattr(elem, k));\r\n      }\r\n    }\r\n\r\n    let codeattrs = [];\r\n\r\n    for (let k of elem.getAttributeNames()) {\r\n      let val = \"\"+elem.getAttribute(k);\r\n\r\n      if (val.startsWith('ng[')) {\r\n        val = val.slice(3, val.endsWith(\"]\") ? val.length-1 : val.length);\r\n\r\n        codeattrs.push([k, \"ng\", val]);\r\n      }\r\n    }\r\n\r\n    for (let k of domEventAttrs) {\r\n      let k2 = 'on' + k;\r\n\r\n      if (elem.hasAttribute(k2)) {\r\n        codeattrs.push([k, \"dom\", elem.getAttribute(k2)]);\r\n      }\r\n    }\r\n\r\n    for (let [k, eventType, id] of codeattrs) {\r\n      if (!(id in this.codefuncs)) {\r\n        console.error(\"Unknown code fragment \" + id);\r\n        continue;\r\n      }\r\n\r\n      if (eventType === \"dom\") {\r\n        //click events usually don't go through normal\r\n        //dom event system\r\n        if (k === 'click') {\r\n          let onclick = elem2.onclick;\r\n          let func = this.codefuncs[id];\r\n\r\n          elem2.onclick = function () {\r\n            if (onclick) {\r\n              onclick.apply(this, arguments);\r\n            }\r\n\r\n            return func.apply(this, arguments);\r\n          }\r\n        } else {\r\n          elem2.addEventListener(k, this.codefuncs[id]);\r\n        }\r\n      } else if (eventType === \"ng\") {\r\n        elem2.addEventListener(k, this.codefuncs[id]);\r\n      }\r\n    }\r\n\r\n\r\n    for (let k of domTransferAttrs) {\r\n      if (elem.hasAttribute(k)) {\r\n        elem2.setAttribute(k, elem.getAttribute(k));\r\n      }\r\n    }\r\n\r\n    for (let k in this.inheritDomAttrs) {\r\n      if (!elem.hasAttribute(k)) {\r\n        elem.setAttribute(k, this.inheritDomAttrs[k]);\r\n      }\r\n    }\r\n\r\n    for (let k of sliderDomAttributes) {\r\n      if (elem.hasAttribute(k)) {\r\n        elem2.setAttribute(k, elem.getAttribute(k));\r\n      }\r\n    }\r\n\r\n    if (!(elem2 instanceof UIBase)) {\r\n      return;\r\n    }\r\n\r\n    if (elem.hasAttribute(\"theme-class\")) {\r\n      elem2.overrideClass(elem.getAttribute(\"theme-class\"));\r\n\r\n      if (elem2._init_done) {\r\n        elem2.setCSS();\r\n        elem2.flushUpdate();\r\n      }\r\n    }\r\n\r\n    if (elem.hasAttribute(\"useIcons\") && typeof elem2.useIcons === \"function\") {\r\n      let val = elem.getAttribute(\"useIcons\").trim().toLowerCase();\r\n\r\n      if (val === \"small\" || val === \"true\" || val === \"yes\") {\r\n        val = true;\r\n      } else if (val === \"large\") {\r\n        val = 1;\r\n      } else if (val === \"false\" || val === \"no\") {\r\n        val = false;\r\n      } else {\r\n        val = parseInt(val) - 1;\r\n      }\r\n\r\n      elem2.useIcons(val);\r\n    }\r\n\r\n    if (elem.hasAttribute(\"sliderTextBox\")) {\r\n      let textbox = getbool(elem, \"sliderTextBox\");\r\n\r\n      if (textbox) {\r\n        elem2.packflag &= ~PackFlags.NO_NUMSLIDER_TEXTBOX;\r\n        elem2.inherit_packflag &= ~PackFlags.NO_NUMSLIDER_TEXTBOX;\r\n      } else {\r\n        elem2.packflag |= PackFlags.NO_NUMSLIDER_TEXTBOX;\r\n        elem2.inherit_packflag |= PackFlags.NO_NUMSLIDER_TEXTBOX;\r\n      }\r\n\r\n      //console.error(\"textBox\", textbox, elem2, elem.getAttribute(\"sliderTextBox\"), elem2.packflag);\r\n    }\r\n\r\n    if (elem.hasAttribute(\"sliderMode\")) {\r\n      let sliderMode = elem.getAttribute(\"sliderMode\");\r\n\r\n      if (sliderMode === \"slider\") {\r\n        elem2.packflag &= ~PackFlags.FORCE_ROLLER_SLIDER;\r\n        elem2.inherit_packflag &= ~PackFlags.FORCE_ROLLER_SLIDER;\r\n\r\n        elem2.packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n        elem2.inherit_packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n      } else if (sliderMode === \"roller\") {\r\n        elem2.packflag &= ~PackFlags.SIMPLE_NUMSLIDERS;\r\n        elem2.packflag |= PackFlags.FORCE_ROLLER_SLIDER;\r\n\r\n        elem2.inherit_packflag &= ~PackFlags.SIMPLE_NUMSLIDERS;\r\n        elem2.inherit_packflag |= PackFlags.FORCE_ROLLER_SLIDER;\r\n      }\r\n\r\n      //console.error(\"sliderMode\", sliderMode, elem2, elem2.packflag & (PackFlags.SIMPLE_NUMSLIDERS | PackFlags.FORCE_ROLLER_SLIDER));\r\n    }\r\n\r\n    if (elem.hasAttribute(\"showLabel\")) {\r\n      let state = getbool(elem, \"showLabel\");\r\n\r\n      if (state) {\r\n        elem2.packflag |= PackFlags.FORCE_PROP_LABELS;\r\n        elem2.inherit_packflag |= PackFlags.FORCE_PROP_LABELS;\r\n      } else {\r\n        elem2.packflag &= ~PackFlags.FORCE_PROP_LABELS;\r\n        elem2.inherit_packflag &= ~PackFlags.FORCE_PROP_LABELS;\r\n      }\r\n    }\r\n\r\n    function doBox(key) {\r\n      if (elem.hasAttribute(key)) {\r\n        let val = elem.getAttribute(key).toLowerCase().trim();\r\n\r\n        if (val.endsWith(\"px\")) {\r\n          val = val.slice(0, val.length - 2).trim();\r\n        }\r\n\r\n        if (val.endsWith(\"%\")) {\r\n          //eek! don't support at all?\r\n          //or use aspect overlay?\r\n\r\n          console.warn(`Relative styling of '${key}' may be unstable for this element`, elem);\r\n\r\n          elem.setCSS.after(function () {\r\n            this.style[key] = val;\r\n          });\r\n        } else {\r\n          val = parseFloat(val);\r\n\r\n          if (isNaN(val) || typeof val !== \"number\") {\r\n            console.error(`Invalid style ${key}:${elem.getAttribute(key)}`);\r\n            return;\r\n          }\r\n\r\n          elem2.overrideDefault(key, val);\r\n          elem2.setCSS();\r\n          elem2.style[key] = \"\" + val + \"px\";\r\n        }\r\n      }\r\n    }\r\n\r\n    doBox(\"width\");\r\n    doBox(\"height\");\r\n    doBox(\"margin\");\r\n    doBox(\"padding\");\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let key = i ? \"margin\" : \"padding\";\r\n\r\n      doBox(key + \"-bottom\");\r\n      doBox(key + \"-top\");\r\n      doBox(key + \"-left\");\r\n      doBox(key + \"-right\");\r\n    }\r\n  }\r\n\r\n  _handlePathPrefix(elem, con) {\r\n    if (elem.hasAttribute(\"path\")) {\r\n      let prefix = con.dataPrefix;\r\n      let path = elem.getAttribute(\"path\").trim();\r\n\r\n      if (prefix.length > 0) {\r\n        prefix += \".\";\r\n      }\r\n\r\n      prefix += path;\r\n      con.dataPrefix = prefix;\r\n    }\r\n\r\n    if (elem.hasAttribute(\"massSetPath\")) {\r\n      let prefix = con.massSetPrefix;\r\n      let path = elem.getAttribute(\"massSetPath\").trim();\r\n\r\n      if (prefix.length > 0) {\r\n        prefix += \".\";\r\n      }\r\n\r\n      prefix += path;\r\n      con.massSetPrefix = prefix;\r\n    }\r\n  }\r\n\r\n  _container(elem, con, ignorePathPrefix=false) {\r\n    for (let k of this.inheritDomAttrKeys) {\r\n      if (elem.hasAttribute(k)) {\r\n        this.inheritDomAttrs[k] = elem.getAttribute(k);\r\n      }\r\n    }\r\n\r\n    let packflag = getPackFlag(elem);\r\n\r\n    con.packflag |= packflag;\r\n    con.inherit_packflag |= packflag;\r\n\r\n    this._basic(elem, con);\r\n\r\n    if (!ignorePathPrefix) {\r\n      this._handlePathPrefix(elem, con);\r\n    }\r\n  }\r\n  noteframe(elem) {\r\n    let ret = this.container.noteframe();\r\n\r\n    if (ret) {\r\n      this._basic(elem, ret);\r\n    }\r\n  }\r\n\r\n  cell(elem) {\r\n    this.push();\r\n    this.container = this.container.cell();\r\n    this._container(elem, this.container);\r\n    this.visit(elem);\r\n    this.pop();\r\n  }\r\n\r\n  table(elem) {\r\n    this.push();\r\n    this.container = this.container.table();\r\n    this._container(elem, this.container);\r\n    this.visit(elem);\r\n    this.pop();\r\n  }\r\n\r\n  panel(elem) {\r\n    let title = \"\" + elem.getAttribute(\"label\")\r\n    let closed = getbool(elem, \"closed\")\r\n\r\n    this.push()\r\n    this.container = this.container.panel(title);\r\n    this.container.closed = closed;\r\n\r\n    this._container(elem, this.container);\r\n\r\n    this.visit(elem)\r\n\r\n    this.pop();\r\n  }\r\n\r\n  pathlabel(elem) {\r\n    this._prop(elem, \"pathlabel\")\r\n  }\r\n\r\n  /**\r\n   handle a code element, which are wrapped in functions\r\n   */\r\n  code(elem) {\r\n    window._codelem = elem;\r\n\r\n    let buf = '';\r\n\r\n    for (let elem2 of elem.childNodes) {\r\n      if (elem2.nodeName === \"#text\") {\r\n        buf += elem2.textContent + '\\n';\r\n      }\r\n    }\r\n\r\n    var func, $scope = this.templateScope;\r\n\r\n    buf = `\r\nfunc = function() {\r\n  ${buf};\r\n}\r\n    `;\r\n\r\n    eval(buf);\r\n\r\n    let id = \"\" + elem.getAttribute(\"id\");\r\n\r\n    this.codefuncs[id] = func;\r\n  }\r\n\r\n  textbox(elem) {\r\n    if (elem.hasAttribute(\"path\")) {\r\n      this._prop(elem, 'textbox');\r\n    } else {\r\n      //let elem2 = this.container.textbox();\r\n      //this._basic(elem, elem2);\r\n    }\r\n  }\r\n\r\n  label(elem) {\r\n    let elem2 = this.container.label(elem.innerHTML);\r\n    this._basic(elem, elem2);\r\n  }\r\n\r\n  colorfield(elem) {\r\n    this._prop(elem, \"colorfield\");\r\n  }\r\n\r\n  /** simpleSliders=true enables simple sliders */\r\n  prop(elem) {\r\n    this._prop(elem, \"prop\")\r\n  }\r\n\r\n  _prop(elem, key) {\r\n    let packflag = getPackFlag(elem);\r\n    let path = elem.getAttribute(\"path\");\r\n\r\n    let elem2;\r\n    if (key === 'pathlabel') {\r\n      elem2 = this.container.pathlabel(path, elem.innerHTML, packflag);\r\n    } else if (key === 'textbox') {\r\n      elem2 = this.container.textbox(path, undefined, undefined, packflag);\r\n\r\n      elem2.update();\r\n\r\n      //make textboxes non-modal by default\r\n      if (elem.hasAttribute(\"modal\")) {\r\n        elem2.setAttribute(\"modal\", elem.getAttribute(\"modal\"));\r\n      }\r\n\r\n      if (elem.hasAttribute(\"realtime\")) {\r\n        elem2.setAttribute(\"realtime\", elem.getAttribute(\"realtime\"));\r\n      }\r\n    } else if (key === \"colorfield\") {\r\n      elem2 = this.container.colorPicker(path, {\r\n        packflag,\r\n        themeOverride: elem.hasAttribute(\"theme-class\") ? elem.getAttribute(\"theme-class\") : undefined\r\n      });\r\n    } else {\r\n      elem2 = this.container[key](path, packflag);\r\n    }\r\n\r\n    if (!elem2) {\r\n      elem2 = document.createElement(\"span\");\r\n      elem2.innerHTML = \"error\";\r\n      this.container.shadow.appendChild(elem2);\r\n    } else {\r\n      this._basic(elem, elem2);\r\n\r\n      if (elem.hasAttribute(\"massSetPath\") || this.container.massSetPrefix) {\r\n        let mpath = elem.getAttribute(\"massSetPath\");\r\n        if (!mpath) {\r\n          mpath = elem.getAttribute(\"path\");\r\n        }\r\n\r\n        mpath = this.container._getMassPath(this.container.ctx, path, mpath);\r\n\r\n        elem2.setAttribute(\"mass_set_path\", mpath);\r\n      }\r\n    }\r\n  }\r\n\r\n  strip(elem) {\r\n    this.push();\r\n\r\n    let dir;\r\n    if (elem.hasAttribute(\"mode\")) {\r\n      dir = elem.getAttribute(\"mode\").toLowerCase().trim();\r\n      dir = dir === \"horizontal\";\r\n    }\r\n\r\n    let margin1 = getfloat(elem, \"margin1\", undefined);\r\n    let margin2 = getfloat(elem, \"margin2\", undefined);\r\n\r\n    this.container = this.container.strip(undefined, margin1, margin2, dir);\r\n    this._container(elem, this.container);\r\n    this.visit(elem);\r\n\r\n    this.pop();\r\n  }\r\n\r\n  column(elem) {\r\n    this.push();\r\n    this.container = this.container.col();\r\n    this._container(elem, this.container);\r\n    this.visit(elem);\r\n    this.pop();\r\n  }\r\n\r\n  row(elem) {\r\n    this.push();\r\n    this.container = this.container.row();\r\n    this._container(elem, this.container);\r\n    this.visit(elem);\r\n    this.pop();\r\n  }\r\n\r\n  toolPanel(elem) {\r\n    this.tool(elem, \"toolPanel\");\r\n  }\r\n\r\n  tool(elem, key = \"tool\") {\r\n    let path = elem.getAttribute(\"path\");\r\n    let packflag = getPackFlag(elem);\r\n\r\n    let noIcons = false, iconflags;\r\n\r\n    if (getbool(elem, \"useIcons\")) {\r\n      packflag |= PackFlags.USE_ICONS;\r\n    } else if (elem.hasAttribute(\"useIcons\")) {\r\n      packflag &= ~PackFlags.USE_ICONS;\r\n      noIcons = true;\r\n    }\r\n\r\n    let label = (\"\" + elem.textContent).trim()\r\n    if (label.length > 0) {\r\n      path += \"|\" + label;\r\n    }\r\n\r\n    if (noIcons) {\r\n      iconflags = this.container.useIcons(false);\r\n    }\r\n\r\n    let elem2 = this.container[key](path, packflag);\r\n\r\n    if (elem2) {\r\n      this._basic(elem, elem2);\r\n    } else {\r\n      elem2 = document.createElement(\"strip\")\r\n      elem2.innerHTML = \"error\"\r\n      this.container.shadow.appendChild(elem2);\r\n      this._basic(elem, elem2);\r\n    }\r\n\r\n    if (noIcons) {\r\n      this.container.inherit_packflag |= iconflags;\r\n      this.container.packflag |= iconflags;\r\n    }\r\n  }\r\n\r\n  dropbox(elem) {\r\n    return this.menu(elem, true);\r\n  }\r\n\r\n  menu(elem, isDropBox = false) {\r\n    let packflag = getPackFlag(elem);\r\n    let title = elem.getAttribute(\"name\")\r\n\r\n    let list = [];\r\n\r\n    for (let child of elem.childNodes) {\r\n      if (child.tagName === \"tool\") {\r\n        let path = child.getAttribute(\"path\");\r\n        let label = child.innerHTML.trim();\r\n\r\n        if (label.length > 0) {\r\n          path += \"|\" + label;\r\n        }\r\n\r\n        list.push(path);\r\n      } else if (child.tagName === \"sep\") {\r\n        list.push(Menu.SEP);\r\n      } else if (child.tagName === \"item\") {\r\n        let id, icon, hotkey, description;\r\n\r\n        if (child.hasAttribute(\"id\")) {\r\n          id = child.getAttribute(\"id\");\r\n        }\r\n\r\n        if (child.hasAttribute(\"icon\")) {\r\n          icon = child.getAttribute(\"icon\").toUpperCase().trim();\r\n          icon = Icons[icon];\r\n        }\r\n\r\n        if (child.hasAttribute(\"hotkey\")) {\r\n          hotkey = child.getAttribute(\"hotkey\");\r\n        }\r\n\r\n        if (child.hasAttribute(\"description\")) {\r\n          description = child.getAttribute(\"description\");\r\n        }\r\n\r\n        list.push({\r\n          name: child.innerHTML.trim(),\r\n          id, icon, hotkey, description\r\n        });\r\n      }\r\n    }\r\n\r\n    let ret = this.container.menu(title, list, packflag);\r\n    if (isDropBox) {\r\n      ret.removeAttribute(\"simple\");\r\n    }\r\n\r\n    if (elem.hasAttribute(\"id\")) {\r\n      ret.setAttribute(\"id\", elem.getAttribute(\"id\"));\r\n    }\r\n\r\n    this._basic(elem, ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  button(elem) {\r\n    let title = elem.innerHTML.trim();\r\n\r\n    let ret = this.container.button(title);\r\n\r\n    if (elem.hasAttribute(\"id\")) {\r\n      ret.setAttribute(\"id\", elem.getAttribute(\"id\"));\r\n    }\r\n\r\n    this._basic(elem, ret);\r\n  }\r\n\r\n  iconbutton(elem) {\r\n    let title = elem.innerHTML.trim();\r\n\r\n    let icon = elem.getAttribute(\"icon\");\r\n    if (icon) {\r\n      icon = UIBase.getIconEnum()[icon];\r\n    }\r\n    let ret = this.container.iconbutton(icon, title);\r\n\r\n    if (elem.hasAttribute(\"id\")) {\r\n      ret.setAttribute(\"id\", elem.getAttribute(\"id\"));\r\n    }\r\n\r\n    this._basic(elem, ret);\r\n  }\r\n\r\n  tab(elem) {\r\n    this.push();\r\n\r\n    let title = \"\" + elem.getAttribute(\"label\");\r\n\r\n    let tabs = this.container;\r\n\r\n    this.container = this.container.tab(title);\r\n\r\n    if (elem.hasAttribute(\"overflow\")) {\r\n      this.container.setAttribute(\"overflow\", elem.getAttribute(\"overflow\"));\r\n    }\r\n\r\n    if (elem.hasAttribute(\"overflow-y\")) {\r\n      this.container.setAttribute(\"overflow-y\", elem.getAttribute(\"overflow-y\"));\r\n    }\r\n\r\n    this._container(elem, this.container)\r\n    this.visit(elem);\r\n\r\n    this.pop();\r\n  }\r\n\r\n  tabs(elem) {\r\n    let pos = elem.getAttribute(\"pos\") || \"left\"\r\n\r\n    this.push();\r\n\r\n    let tabs = this.container.tabs(pos)\r\n    this.container = tabs;\r\n\r\n    if (elem.hasAttribute(\"movable-tabs\")) {\r\n      tabs.setAttribute(\"movable-tabs\", elem.getAttribute(\"movable-tabs\"));\r\n    }\r\n\r\n    this._container(elem, tabs);\r\n    this.visit(elem);\r\n\r\n    this.pop();\r\n  }\r\n}\r\n\r\nexport function initPage(ctx, xml, parentContainer = undefined, templateVars = {}, templateScope = {}) {\r\n  let tree = parseXML(xml);\r\n  let container = UIBase.createElement(\"container-x\");\r\n\r\n  container.ctx = ctx;\r\n  if (ctx) {\r\n    container._init();\r\n  }\r\n\r\n  if (parentContainer) {\r\n    parentContainer.add(container);\r\n  }\r\n\r\n  let handler = new Handler(ctx, container);\r\n\r\n  handler.templateVars = Object.assign({}, templateVars);\r\n  handler.templateScope = templateScope;\r\n\r\n  handler.handle(tree);\r\n\r\n  return container;\r\n\r\n}\r\n\r\nexport function loadPage(ctx, url, parentContainer_or_args = undefined, loadSourceOnly = false,\r\n                         modifySourceCB, templateVars, templateScope) {\r\n  let source;\r\n  let parentContainer;\r\n\r\n  if (parentContainer_or_args !== undefined && !(parentContainer_or_args instanceof HTMLElement)) {\r\n    let args = parentContainer_or_args;\r\n\r\n    parentContainer = args.parentContainer;\r\n    loadSourceOnly = args.loadSourceOnly;\r\n    modifySourceCB = args.modifySourceCB;\r\n    templateVars = args.templateVars;\r\n    templateScope = args.templateScope;\r\n  } else {\r\n    parentContainer = parentContainer_or_args;\r\n  }\r\n\r\n  if (pagecache.has(url)) {\r\n    source = pagecache.get(url);\r\n\r\n    if (modifySourceCB) {\r\n      source = modifySourceCB(source);\r\n    }\r\n\r\n    return new Promise((accept, reject) => {\r\n      if (loadSourceOnly) {\r\n        accept(source);\r\n      } else {\r\n        accept(initPage(ctx, source, parentContainer, templateVars, templateScope));\r\n      }\r\n    });\r\n  } else {\r\n    return new Promise((accept, reject) => {\r\n      fetch(url).then(res => res.text()).then(data => {\r\n        pagecache.set(url, data);\r\n\r\n        if (modifySourceCB) {\r\n          data = modifySourceCB(data);\r\n        }\r\n\r\n        if (loadSourceOnly) {\r\n          accept(data);\r\n        } else {\r\n          accept(initPage(ctx, data, parentContainer, templateVars, templateScope));\r\n        }\r\n      });\r\n    });\r\n  }\r\n}\r\n","import {CurveConstructors} from \"./curve1d_base.js\";\r\nimport {EnumProperty} from \"../toolsys/toolprop.js\";\r\n\r\nexport function makeGenEnum() {\r\n  let enumdef = {};\r\n  let uinames = {};\r\n  let icons = {};\r\n\r\n  for (let cls of CurveConstructors) {\r\n    let def = cls.define();\r\n\r\n    let uiname = def.uiname;\r\n    uiname = uiname === undefined ? def.name : uiname;\r\n\r\n    enumdef[def.name] = cls.name;\r\n    uinames[def.name] = uiname;\r\n    icons[def.name] = def.icon !== undefined ? def.icon : -1;\r\n  }\r\n\r\n  //return enumdef;\r\n  return new EnumProperty(undefined, enumdef).addUINames(uinames).addIcons(icons);\r\n}\r\n","import {UIBase, Icons, saveUIData, loadUIData} from '../core/ui_base.js';\r\nimport {ColumnFrame, RowFrame} from \"../core/ui.js\";\r\nimport * as util from '../path-controller/util/util.js';\r\nimport {Vector2, Vector3} from \"../path-controller/util/vectormath.js\";\r\nimport {Curve1D, mySafeJSONStringify} from \"../path-controller/curve/curve1d.js\";\r\nimport {makeGenEnum} from '../path-controller/curve/curve1d_utils.js';\r\n\r\nexport class Curve1DWidget extends ColumnFrame {\r\n  #in_onchange = false;\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.useDataPathUndo = false;\r\n\r\n    this._on_draw = this._on_draw.bind(this);\r\n    this.drawTransform = [1.0, [0, 0]];\r\n\r\n    this._value = new Curve1D();\r\n    this.checkCurve1dEvents();\r\n\r\n    this.#in_onchange = 0;\r\n\r\n    this._value._on_change = (msg) => {\r\n      if (this.#in_onchange) {\r\n        return;\r\n      }\r\n\r\n      /* Prevent infinite recursion. */\r\n      this.#in_onchange++;\r\n\r\n      try {\r\n        if (this.hasAttribute(\"datapath\")) {\r\n          let path = this.getAttribute(\"datapath\");\r\n          if (this._value !== undefined) {\r\n            let val = this.getPathValue(this.ctx, path);\r\n\r\n            if (val) {\r\n              val.load(this._value);\r\n              this.setPathValue(this.ctx, path, val);\r\n            } else {\r\n              val = this._value.copy();\r\n              this.setPathValue(this.ctx, path, val);\r\n            }\r\n          }\r\n        }\r\n\r\n        if (this.onchange) {\r\n          this.onchange(this._value);\r\n        }\r\n      } catch (error) {\r\n        if (window.DEBUG && window.DEBUG.datapath) {\r\n          console.error(error.stack);\r\n          console.error(error.message);\r\n        }\r\n      }\r\n\r\n      this.#in_onchange--;\r\n\r\n      if (this.#in_onchange < 0) {\r\n        console.warn(\"this.#in_onchange was negative\");\r\n        this.#in_onchange = 0;\r\n      }\r\n    };\r\n\r\n    this._gen_type = undefined;\r\n    this._lastGen = undefined;\r\n\r\n    this._last_dpi = undefined;\r\n    this.canvas = document.createElement(\"canvas\");\r\n\r\n    this.g = this.canvas.getContext(\"2d\");\r\n    this.canvas.g = this.g;\r\n\r\n    window.cw = this;\r\n    this.shadow.appendChild(this.canvas);\r\n  }\r\n\r\n  /**\r\n   * Checks if a curve1d instance exists at dom attribute \"datapath\"\r\n   * and if it does adds curve1d event handlers to it.\r\n   *\r\n   * Note: it's impossible to know for sure that a widget is truly dead,\r\n   * e.g. it could be hidden in a panel or something.  Curve1d's event\r\n   * handling system takes a callback that checks if a callback should\r\n   * be removed, which we provide by testing this.isConnected.\r\n   *\r\n   * Since this is not robust we have to check regularly if we need to add\r\n   * Curve1D event handlers, which is why this function exists.\r\n   */\r\n  checkCurve1dEvents() {\r\n    if (!this._value.subscribed(\"draw\", this)) {\r\n      this._value.on(\"draw\", this._on_draw, this, () => !this.isConnected);\r\n    }\r\n\r\n    if (this.ctx && this.hasAttribute(\"datapath\")) {\r\n      let curve1d;\r\n\r\n      try {\r\n        curve1d = this.ctx.api.getValue(this.ctx, this.getAttribute(\"datapath\"));\r\n      } catch (error) {\r\n        if (window.DEBUG && window.DEBUG.datapath) {\r\n          console.error(error.stack);\r\n          console.error(error.message);\r\n        }\r\n      }\r\n\r\n      if (!curve1d) {\r\n        this.disabled = true;\r\n        return;\r\n      }\r\n\r\n      if (this.disabled) {\r\n        this.disabled = false;\r\n      }\r\n\r\n      if (!curve1d.subscribed(undefined, this)) {\r\n        curve1d.on(\"select\", (bspline1) => {\r\n          let bspline2 = this._value.getGenerator(\"BSplineCurve\");\r\n\r\n          for (let i = 0; i < bspline1.points.length; i++) {\r\n            if (i >= bspline2.length) {\r\n              break;\r\n            }\r\n            bspline2.points[i].flag = bspline1.points[i].flag;\r\n          }\r\n\r\n          bspline2.redraw();\r\n        });\r\n\r\n        curve1d.on(\"transform\", (bspline1) => {\r\n          let bspline2 = this._value.getGenerator(\"BSplineCurve\");\r\n\r\n          for (let i = 0; i < bspline1.points.length; i++) {\r\n            if (i >= bspline2.length) {\r\n              break;\r\n            }\r\n            bspline2.points[i].co.load(bspline1.points[i].co);\r\n          }\r\n\r\n          bspline2.update();\r\n          bspline2.updateKnots();\r\n          bspline2.redraw();\r\n        });\r\n\r\n        curve1d.on(\"update\", () => {\r\n          console.log(\"datapath curve1d update!\");\r\n          this._value.load(curve1d);\r\n          this.rebuild();\r\n        }, this, () => !this.isConnected);\r\n      }\r\n    }\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  _on_draw(e) {\r\n    let curve = e.data;\r\n\r\n    //console.log(\"draw\");\r\n    this._redraw();\r\n  }\r\n\r\n  set value(val) {\r\n    this._value.load(val);\r\n    this.update();\r\n    this._redraw();\r\n  }\r\n\r\n  _on_change() {\r\n    if (this.onchange) {\r\n      this.onchange(this);\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.useDataPathUndo = false;\r\n    let row = this.row();\r\n\r\n    let prop = makeGenEnum();\r\n\r\n    prop.setValue(this.value.generatorType);\r\n\r\n    this.dropbox = row.listenum(undefined, \"Type\", prop, this.value.generatorType, (id) => {\r\n      console.warn(\"SELECT\", id, prop.keys[id]);\r\n\r\n      this.value.setGenerator(id);\r\n      this.value._on_change(\"curve type change\");\r\n    });\r\n    this.dropbox._init();\r\n\r\n    row.iconbutton(Icons.ZOOM_OUT, \"Zoom Out\", () => {\r\n      let curve = this._value;\r\n      if (!curve) return;\r\n      //if (isNaN(curve.uiZoom))\r\n      //  curve.uiZoom = 1.0;\r\n\r\n      curve.uiZoom *= 0.9;\r\n      if (this.getAttribute(\"datapath\")) {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), curve);\r\n      }\r\n\r\n      this._redraw();\r\n    }).iconsheet = 0;\r\n    row.iconbutton(Icons.ZOOM_IN, \"Zoom In\", () => {\r\n      let curve = this._value;\r\n      if (!curve) return;\r\n      //if (isNaN(curve.uiZoom))\r\n      //  curve.uiZoom = 1.0;\r\n\r\n      curve.uiZoom *= 1.1;\r\n      if (this.getAttribute(\"datapath\")) {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), curve);\r\n      }\r\n\r\n      this._redraw();\r\n\r\n    }).iconsheet = 0;\r\n\r\n    this.container = this.col();\r\n\r\n    let panel = this.panel(\"Range\");\r\n\r\n    let clipCheck = panel.check(undefined, \"Clip To Range\");\r\n    clipCheck.onchange = (val) => {\r\n      this._value.clipToRange = val;\r\n      this._on_change();\r\n      this._redraw();\r\n    }\r\n    clipCheck.checked = this._value.clipToRange;\r\n\r\n    let xmin = panel.slider(undefined, \"X Min\", this._value.xRange[0], -10, 10, 0.1, false, undefined, (val) => {\r\n      this._value.xRange[0] = val.value;\r\n      this._on_change();\r\n      this._redraw();\r\n    });\r\n\r\n    let xmax = panel.slider(undefined, \"X Max\", this._value.xRange[1], -10, 10, 0.1, false, undefined, (val) => {\r\n      this._value.xRange[1] = val.value;\r\n      this._on_change();\r\n      this._redraw();\r\n    });\r\n\r\n    let ymin = panel.slider(undefined, \"Y Min\", this._value.yRange[0], -10, 10, 0.1, false, undefined, (val) => {\r\n      this._value.yRange[0] = val.value;\r\n      this._on_change();\r\n      this._redraw();\r\n    });\r\n\r\n    let ymax = panel.slider(undefined, \"Y Max\", this._value.yRange[1], -10, 10, 0.1, false, undefined, (val) => {\r\n      this._value.yRange[1] = val.value;\r\n      this._on_change();\r\n      this._redraw();\r\n    });\r\n\r\n    let last_update_key = \"\";\r\n    this.container.update.after(() => {\r\n      const xRange = this._value.xRange;\r\n      const yRange = this._value.yRange;\r\n      let key = \"\" + xRange[0] + \":\" + xRange[1]\r\n        + \":\" + yRange[0] + \":\" + yRange[1] + \":\" + this._value.clipToRange;\r\n\r\n      clipCheck.checked = this._value.clipToRange;\r\n\r\n      if (key !== last_update_key) {\r\n        last_update_key = key;\r\n\r\n        xmin.setValue(xRange[0]);\r\n        xmax.setValue(xRange[1]);\r\n\r\n        ymin.setValue(yRange[0]);\r\n        ymax.setValue(yRange[1]);\r\n      }\r\n    });\r\n\r\n    xmin.displayUnit = xmin.baseUnit = \"none\";\r\n    ymin.displayUnit = ymin.baseUnit = \"none\";\r\n    xmax.displayUnit = xmax.baseUnit = \"none\";\r\n    ymax.displayUnit = ymax.baseUnit = \"none\";\r\n\r\n    panel.closed = false;\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.style[\"width\"] = \"min-contents\";\r\n    this.style[\"height\"] = \"min-contents\";\r\n    this.updateSize();\r\n  }\r\n\r\n  updateSize() {\r\n    let dpi = UIBase.getDPI();\r\n    let w = ~~(this.getDefault(\"CanvasWidth\")*dpi);\r\n    let h = ~~(this.getDefault(\"CanvasHeight\")*dpi);\r\n\r\n    let bad = w !== this.canvas.width || h !== this.canvas.height;\r\n    bad = bad || dpi !== this._last_dpi;\r\n\r\n    if (!bad) {\r\n      return;\r\n    }\r\n\r\n    this._last_dpi = dpi;\r\n    this.canvas.width = w;\r\n    this.canvas.height = h;\r\n\r\n    this.canvas.style[\"width\"] = (w/dpi) + \"px\";\r\n    this.canvas.style[\"height\"] = (h/dpi) + \"px\";\r\n\r\n    this._redraw();\r\n  }\r\n\r\n  _redraw() {\r\n    //forcibly clear canvas, works better then clearRect\r\n    this.canvas.width = this.canvas.width;\r\n    this.canvas.height = this.canvas.height;\r\n\r\n    let canvas = this.canvas, g = this.g;\r\n\r\n    //g.clearRect(0, 0, canvas.width, canvas.height);\r\n    g.beginPath();\r\n    g.rect(0, 0, canvas.width, canvas.height);\r\n    g.fillStyle = this.getDefault(\"CanvasBG\");\r\n    g.fill();\r\n\r\n    g.save();\r\n\r\n    let zoom = this._value.uiZoom;\r\n    let scale = Math.max(canvas.width, canvas.height);\r\n\r\n    g.lineWidth /= scale;\r\n\r\n    this.drawTransform[0] = scale*zoom;\r\n    this.drawTransform[1][0] = 0.0;\r\n    this.drawTransform[1][1] = -1.0;\r\n\r\n    this.drawTransform[1][0] -= 0.5 - 0.5/zoom;\r\n    this.drawTransform[1][1] += 0.5 - 0.5/zoom;\r\n\r\n    //g.scale(scale, scale);\r\n\r\n    g.scale(this.drawTransform[0], -this.drawTransform[0]);\r\n    g.translate(this.drawTransform[1][0], this.drawTransform[1][1]);\r\n\r\n    g.lineWidth /= zoom;\r\n\r\n    this._value.draw(this.canvas, this.g, this.drawTransform);\r\n    g.restore();\r\n  }\r\n\r\n  rebuild() {\r\n    let ctx = this.ctx;\r\n    if (ctx === undefined || this.container === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.checkCurve1dEvents();\r\n\r\n    let uidata = saveUIData(this.container, \"curve1d\");\r\n\r\n    this._gen_type = this.value.generatorType;\r\n    let col = this.container;\r\n\r\n    if (this._lastGen !== undefined) {\r\n      this._lastGen.killGUI(col, this.canvas);\r\n    }\r\n\r\n    let onchange = this.dropbox.onchange;\r\n    this.dropbox.onchange = undefined\r\n    this.dropbox.setValue(this.value.generatorType);\r\n    this.dropbox.onchange = onchange;\r\n\r\n    col.clear();\r\n\r\n    let onSourceUpdate = () => {\r\n      if (!this.hasAttribute(\"datapath\")) {\r\n        return;\r\n      }\r\n\r\n      let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n      this._value.load(val);\r\n      this.rebuild();\r\n    };\r\n\r\n    let dpath = this.hasAttribute(\"datapath\") ? this.getAttribute(\"datapath\") : undefined;\r\n    let gen = this.value.generators.active;\r\n\r\n    /* Turn off data path callbacks. */\r\n    this.#in_onchange++;\r\n    try {\r\n      gen.makeGUI(col, this.canvas, this.drawTransform, dpath, onSourceUpdate);\r\n\r\n      loadUIData(this.container, uidata);\r\n      for (let i = 0; i < 4; i++) {\r\n        col.flushUpdate();\r\n      }\r\n    } catch (error) {\r\n      console.warn(error.stack);\r\n      console.warn(error.message);\r\n    }\r\n\r\n    this.#in_onchange--;\r\n\r\n    this._lastGen = gen;\r\n    this._redraw();\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n    let val = this.getPathValue(this.ctx, path);\r\n\r\n    if (this._lastu === undefined) {\r\n      this._lastu = 0;\r\n    }\r\n\r\n    if (val && !val.equals(this._value) && util.time_ms() - this._lastu > 200) {\r\n      this._lastu = util.time_ms();\r\n\r\n      this._value.load(val);\r\n      this.update();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  updateGenUI() {\r\n    let bad = this._lastGen !== this.value.generators.active;\r\n\r\n    if (bad) {\r\n      this.rebuild();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.checkCurve1dEvents();\r\n    this.updateDataPath();\r\n    this.updateSize();\r\n    this.updateGenUI();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"curve-widget-x\",\r\n      style  : \"curvewidget\"\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(Curve1DWidget);\r\n","//bind module to global var to get at it in console.\r\n//\r\n//note that require has an api for handling circular\r\n//module refs, in such cases do not use these vars.\r\n\r\nimport {CSSFont} from \"../core/ui_base.js\";\r\n\r\nvar _ui = undefined;\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as ui_widgets from './ui_widgets.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport '../path-controller/util/html5_fileapi.js';\r\nimport {ColumnFrame, RowFrame, Container} from \"../core/ui.js\";\r\n\r\nlet PropFlags = toolprop.PropFlags;\r\nlet PropSubTypes = toolprop.PropSubTypes;\r\n\r\nlet EnumProperty = toolprop.EnumProperty;\r\n\r\nlet Vector2   = vectormath.Vector2,\r\n    UIBase    = ui_base.UIBase,\r\n    PackFlags = ui_base.PackFlags,\r\n    PropTypes = toolprop.PropTypes;\r\n\r\n\r\n//methods to forward to this.contents\r\nlet forward_keys = new Set([\r\n  \"row\", \"col\", \"strip\", \"noteframe\", \"helppicker\", \"vecpopup\",\r\n  \"tabs\", \"table\", \"menu\", \"listbox\", \"panel\",\r\n  \"pathlabel\", \"label\", \"listenum\", \"check\", \"iconcheck\",\r\n  \"button\", \"iconbutton\", \"colorPicker\", \"twocol\",\r\n  \"treeview\", \"slider\", \"simpleslider\", \"curve1d\",\r\n  \"noteframe\", \"vecpopup\",\r\n  \"prop\", \"tool\", \"toolPanel\", \"textbox\", \"dynamicMenu\",\r\n  \"add\", \"prepend\", \"useIcons\", \"noMarginsOrPadding\", \"wrap\"\r\n]);\r\n\r\nexport class PanelFrame extends ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this.titleframe = super.row();\r\n\r\n    this.contents = super.col();\r\n    this.contents._remove = this.contents.remove;\r\n    this.contents.remove = () => {\r\n      this.remove();\r\n    };\r\n\r\n    this._panel = this; //compatibility alias\r\n\r\n    this.contents._panel = this;\r\n    this.iconcheck = UIBase.createElement(\"iconcheck-x\");\r\n    this.iconcheck.noEmboss = true;\r\n\r\n    Object.defineProperty(this.contents, \"closed\", {\r\n      get: () => {\r\n        return this.closed;\r\n      },\r\n\r\n      set: (v) => {\r\n        this.closed = v;\r\n      }\r\n    })\r\n\r\n    Object.defineProperty(this.contents, \"title\", {\r\n      get: () => this.titleframe.getAttribute(\"title\"),\r\n      set: (v) => this.setHeaderToolTip(v)\r\n    });\r\n\r\n    this.packflag = this.inherit_packflag = 0;\r\n\r\n    this._closed = false;\r\n\r\n    this.makeHeader();\r\n  }\r\n\r\n  get inherit_packflag() {\r\n    if (!this.contents) return;\r\n    return this.contents.inherit_packflag;\r\n  }\r\n\r\n  set inherit_packflag(val) {\r\n    if (!this.contents) return;\r\n    this.contents.inherit_packflag = val;\r\n  }\r\n\r\n  get packflag() {\r\n    if (!this.contents) return;\r\n    return this.contents.packflag;\r\n  }\r\n\r\n  set packflag(val) {\r\n    if (!this.contents) return;\r\n    this.contents.packflag = val;\r\n  }\r\n\r\n  appendChild(child) {\r\n    return this.contents.shadow.appendChild(child);\r\n  }\r\n\r\n  get headerLabel() {\r\n    return this.__label.text;\r\n  }\r\n\r\n  set headerLabel(v) {\r\n    this.__label.text = v;\r\n    this.__label._updateFont();\r\n\r\n    if (this.hasAttribute(\"label\")) {\r\n      this.setAttribute(\"label\", v);\r\n    }\r\n\r\n    if (this.ctx) {\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  get dataPrefix() {\r\n    return this.contents ? this.contents.dataPrefix : \"\";\r\n  }\r\n\r\n  set dataPrefix(v) {\r\n    if (this.contents) {\r\n      this.contents.dataPrefix = v;\r\n    }\r\n  }\r\n\r\n  get closed() {\r\n    return this._closed;\r\n  }\r\n\r\n  set closed(val) {\r\n    let update = !!val !== !!this.closed;\r\n    this._closed = val;\r\n\r\n    //console.log(\"closed set\", update);\r\n    if (update) {\r\n      this._updateClosed(true);\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname            : \"panelframe-x\",\r\n      style              : \"panel\",\r\n      subclassChecksTheme: true\r\n    };\r\n  }\r\n\r\n  setHeaderToolTip(tooltip) {\r\n    this.titleframe.setAttribute(\"title\", tooltip);\r\n\r\n    this.titleframe._forEachChildWidget((child) => {\r\n      child.setAttribute(\"title\", tooltip);\r\n    });\r\n  }\r\n\r\n  saveData() {\r\n    let ret = {\r\n      closed: this._closed\r\n    };\r\n\r\n    return Object.assign(super.saveData(), ret);\r\n  }\r\n\r\n  loadData(obj) {\r\n    if (!(\"closed\" in obj)) {\r\n      this.closed = obj._closed;\r\n    } else {\r\n      this.closed = obj.closed;\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this.contents.clear();\r\n    return this;\r\n  }\r\n\r\n  makeHeader() {\r\n    let row = this.titleframe;\r\n\r\n    let iconcheck = this.iconcheck;\r\n\r\n    if (!iconcheck) {\r\n      return;\r\n    }\r\n\r\n    iconcheck.overrideDefault(\"padding\", 0);\r\n\r\n    iconcheck.noMarginsOrPadding();\r\n\r\n    iconcheck.overrideDefault(\"highlight\", {\r\n      \"background-color\" : iconcheck.getSubDefault(\"highlight\", \"background-color\")\r\n    });\r\n\r\n    iconcheck.overrideDefault(\"background-color\", \"rgba(0,0,0,0)\");\r\n    iconcheck.overrideDefault(\"BoxDepressed\", \"rgba(0,0,0,0)\");\r\n    iconcheck.overrideDefault(\"border-color\", \"rgba(0,0,0,0)\");\r\n\r\n    iconcheck.ctx = this.ctx;\r\n    iconcheck._icon_pressed = ui_base.Icons.UI_EXPAND;\r\n    iconcheck._icon = ui_base.Icons.UI_COLLAPSE;\r\n    iconcheck.drawCheck = false;\r\n    iconcheck.iconsheet = ui_base.IconSheets.SMALL;\r\n    iconcheck.checked = this._closed;\r\n\r\n    this.iconcheck.onchange = (e) => {\r\n      this.closed = this.iconcheck.checked;\r\n    };\r\n\r\n    row._add(iconcheck);\r\n\r\n    //stupid css, let's just hackishly put \" \" to create spacing2\r\n\r\n    let onclick = (e) => {\r\n      iconcheck.checked = !iconcheck.checked;\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n    };\r\n\r\n    let label = this.__label = row.label(this.getAttribute(\"label\"));\r\n\r\n    this.__label.font = \"TitleText\";\r\n\r\n    label._updateFont();\r\n\r\n    label.noMarginsOrPadding();\r\n    label.addEventListener(\"mousedown\", onclick);\r\n    label.addEventListener(\"touchdown\", onclick);\r\n\r\n    let bs = this.getDefault(\"border-style\");\r\n\r\n    row.background = this.getDefault(\"TitleBackground\");\r\n    row.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n    row.style[\"border\"] = `${this.getDefault(\"border-width\")}px ${bs} ${this.getDefault(\"border-color\")}`;\r\n\r\n    row.style[\"padding-right\"] = \"20px\";\r\n    row.style[\"padding-left\"] = \"5px\";\r\n    row.style[\"padding-top\"] = this.getDefault(\"padding-top\") + \"px\";\r\n    row.style[\"padding-bottom\"] = this.getDefault(\"padding-bottom\") + \"px\";\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.background = this.getDefault(\"background-color\");\r\n    this.style[\"width\"] = \"100%\";\r\n\r\n    this.contents.ctx = this.ctx;\r\n    if (!this._closed) {\r\n      super.add(this.contents);\r\n      this.contents.flushUpdate();\r\n    }\r\n\r\n    this.contents.dataPrefix = this.dataPrefix;\r\n\r\n    //con.style[\"margin-left\"] = \"5px\";\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    if (!this.titleframe || !this.__label) {\r\n      return;\r\n    }\r\n\r\n    let getDefault = (key, defval) => {\r\n      let val = this.getDefault(key);\r\n      return val !== undefined ? val : defval;\r\n    };\r\n\r\n    let bs = this.getDefault(\"border-style\");\r\n\r\n    let header_radius = this.getDefault(\"HeaderRadius\");\r\n    if (header_radius === undefined) {\r\n      header_radius = this.getDefault(\"border-radius\");\r\n    }\r\n\r\n    let boxmargin = getDefault(\"padding\", 0);\r\n\r\n    let paddingleft = getDefault(\"padding-left\", 0);\r\n    let paddingright = getDefault(\"padding-right\", 0);\r\n\r\n    paddingleft += boxmargin;\r\n    paddingright += boxmargin;\r\n\r\n    this.titleframe.background = this.getDefault(\"TitleBackground\");\r\n    this.titleframe.style[\"border-radius\"] = header_radius + \"px\";\r\n    this.titleframe.style[\"border\"] = `${this.getDefault(\"border-width\")}px ${bs} ${this.getDefault(\"TitleBorder\")}`;\r\n    this.style[\"border\"] = `${this.getDefault(\"border-width\")}px ${bs} ${this.getDefault(\"border-color\")}`;\r\n    this.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n\r\n    this.titleframe.style[\"padding-top\"] = this.getDefault(\"padding-top\") + \"px\";\r\n    this.titleframe.style[\"padding-bottom\"] = this.getDefault(\"padding-bottom\") + \"px\";\r\n    this.titleframe.style[\"padding-left\"] = paddingleft + \"px\";\r\n    this.titleframe.style[\"padding-right\"] = paddingright + \"px\";\r\n    this.titleframe.style[\"margin-bottom\"] = \"0px\";\r\n    this.titleframe.style[\"margin-top\"] = \"0px\";\r\n\r\n    this.__label.style[\"border\"] = \"unset\";\r\n    this.__label.style[\"border-radius\"] = \"unset\";\r\n\r\n    let bg = this.getDefault(\"background-color\");\r\n\r\n    this.background = bg;\r\n    this.contents.background = bg;\r\n    this.contents.parentWidget = this;\r\n    this.contents.style[\"background-color\"] = bg;\r\n    this.style[\"background-color\"] = bg;\r\n\r\n    let margintop, marginbottom;\r\n\r\n    if (this._closed) {\r\n      margintop = getDefault('margin-top-closed', 0);\r\n      marginbottom = getDefault('margin-bottom-closed', 5);\r\n    } else {\r\n      margintop = getDefault('margin-top', 0);\r\n      marginbottom = getDefault('margin-bottom', 0);\r\n    }\r\n\r\n    let marginleft = getDefault('margin-left', 0);\r\n    let marginright = getDefault('margin-right', 0);\r\n\r\n    this.style['margin-left'] = marginleft + \"px\";\r\n    this.style['margin-right'] = marginright + \"px\";\r\n\r\n    this.style['margin-top'] = margintop + \"px\";\r\n    this.style['margin-bottom'] = marginbottom + \"px\";\r\n\r\n    //this.style[\"padding-left\"] = paddingleft + \"px\";\r\n    //this.style[\"padding-right\"] = paddingright + \"px\";\r\n\r\n    this.__label._updateFont();\r\n  }\r\n\r\n  on_disabled() {\r\n    super.on_disabled();\r\n\r\n    this.__label._updateFont();\r\n    this.setCSS();\r\n  }\r\n\r\n  on_enabled() {\r\n    super.on_enabled();\r\n\r\n    this.__label.setCSS();\r\n    this.__label.style[\"color\"] = this.style[\"color\"];\r\n    this.setCSS();\r\n  }\r\n\r\n  update() {\r\n    let text = this.getAttribute(\"label\");\r\n\r\n    let update = text !== this.__label.text;\r\n\r\n    if (this.checkThemeUpdate()) {\r\n      update = true;\r\n      this._setVisible(this.closed, true);\r\n      this.setCSS();\r\n      this.flushSetCSS();\r\n    }\r\n\r\n    if (update) {\r\n      this.headerLabel = this.getAttribute(\"label\")\r\n\r\n      this.__label._updateFont();\r\n      this.setCSS();\r\n    }\r\n\r\n    super.update();\r\n  }\r\n\r\n  _onchange(isClosed) {\r\n    if (this.onchange) {\r\n      this.onchange(isClosed);\r\n    }\r\n\r\n    if (this.contents.onchange) {\r\n      this.contents.onchange(isClosed);\r\n    }\r\n  }\r\n\r\n  //catch setAttribute so we can detect label update\r\n  //even if close and updates disabled\r\n  setAttribute(key, value) {\r\n    let ret = super.setAttribute(key, value);\r\n\r\n    if (this.ctx) {\r\n      this.update();\r\n      this.flushUpdate();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  get noUpdateClosedContents() {\r\n    if (!this.hasAttribute(\"update-closed-contents\")) {\r\n      return false;\r\n    }\r\n\r\n    let ret = this.getAttribute(\"update-closed-contents\");\r\n    return ret === \"true\" || ret === \"on\";\r\n  }\r\n\r\n  set noUpdateClosedContents(v) {\r\n    this.setAttribute(\"update-closed-contents\", v ? \"true\" : \"false\");\r\n  }\r\n\r\n  _setVisible(isClosed, changed) {\r\n    changed = changed || !!isClosed !== !!this._closed;\r\n\r\n    this._state = isClosed;\r\n\r\n    if (isClosed) {\r\n      this.contents.style.display = \"none\";\r\n\r\n      //this.contents._remove();\r\n      //this.contents.hide(true);\r\n      if (!this.noUpdateClosedContents) {\r\n        this.contents.packflag |= PackFlags.NO_UPDATE;\r\n      }\r\n    } else {\r\n      //this.contents.hide(false);\r\n      this.contents.style.display = \"flex\";\r\n      this.contents.packflag &= ~PackFlags.NO_UPDATE;\r\n      this.contents.flushUpdate();\r\n    }\r\n\r\n    this.contents.hidden = isClosed;\r\n\r\n    if (this.parentWidget) {\r\n      this.parentWidget.flushUpdate();\r\n    } else {\r\n      this.flushUpdate();\r\n    }\r\n\r\n    if (changed) {\r\n      this._onchange(isClosed);\r\n    }\r\n\r\n    /*\r\n    for (let c of this.shadow.childNodes) {\r\n      if (c !== this.titleframe) {\r\n        c.hidden = state;\r\n      }\r\n    }*/\r\n  }\r\n\r\n  _updateClosed(changed) {\r\n    this._setVisible(this._closed, changed);\r\n\r\n    if (this.iconcheck) {\r\n      this.iconcheck.checked = this._closed;\r\n    }\r\n  }\r\n}\r\n\r\n\r\nlet makeForward = (k) => {\r\n  return function() {\r\n    return this.contents[k](...arguments);\r\n  }\r\n};\r\n\r\nfor (let k of forward_keys) {\r\n  PanelFrame.prototype[k] = makeForward(k);\r\n}\r\n\r\nUIBase.internalRegister(PanelFrame);\r\n","\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as ui from '../core/ui.js';\r\nimport {PropTypes} from '../path-controller/toolsys/toolprop.js';\r\nimport {keymap} from '../path-controller/util/simple_events.js';\r\nimport cconst from '../config/const.js';\r\nimport {color2web, web2color, validateWebColor} from \"../core/ui_base.js\";\r\n\r\nlet Vector2 = vectormath.Vector2,\r\n    Vector3 = vectormath.Vector3,\r\n    Vector4 = vectormath.Vector4,\r\n    Matrix4 = vectormath.Matrix4;\r\n\r\nexport {rgb_to_hsv, hsv_to_rgb} from \"../path-controller/util/colorutils.js\";\r\nimport {rgb_to_hsv, hsv_to_rgb, cmyk_to_rgb, rgb_to_cmyk} from \"../path-controller/util/colorutils.js\";\r\nimport {contextWrangler} from '../screen/area_wrangler.js';\r\n\r\nlet UIBase     = ui_base.UIBase,\r\n    PackFlags  = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nlet UPW = 1.25, VPW = 0.75;\r\n\r\n//*\r\nlet sample_rets = new util.cachering(() => [0, 0], 64);\r\n\r\nexport function inv_sample(u, v) {\r\n  let ret = sample_rets.next();\r\n\r\n  ret[0] = Math.pow(u, UPW);\r\n  ret[1] = Math.pow(v, VPW);\r\n\r\n  return ret;\r\n}\r\n\r\nexport function sample(u, v) {\r\n  let ret = sample_rets.next();\r\n\r\n  ret[0] = Math.pow(u, 1.0/UPW);\r\n  ret[1] = Math.pow(v, 1.0/VPW);\r\n\r\n  return ret;\r\n}\r\n\r\n//*/\r\n\r\n/* shared methods for clipboard handling */\r\nfunction colorClipboardCopy() {\r\n  let rgba = this.getRGBA();\r\n\r\n  let r = rgba[0]*255;\r\n  let g = rgba[1]*255;\r\n  let b = rgba[2]*255;\r\n  let a = rgba[3];\r\n\r\n  let data = `rgba(${r.toFixed(4)}, ${g.toFixed(4)}, ${b.toFixed(4)}, ${a.toFixed(4)})`;\r\n  //cconst.setClipboardData(\"color\", \"text/css\", data);\r\n\r\n  cconst.setClipboardData(\"color\", \"text/plain\", data);\r\n}\r\n\r\nfunction colorClipboardPaste() {\r\n  let data = cconst.getClipboardData(\"text/plain\");\r\n\r\n  if (!data || !validateCSSColor(\"\" + data.data)) {// || data.mime !== \"text/css\") {\r\n    return;\r\n  }\r\n\r\n  let color;\r\n\r\n  try {\r\n    color = css2color(data.data);\r\n  } catch (error) {\r\n    //not a color\r\n    console.log(error.stack);\r\n    console.log(error.message);\r\n  }\r\n\r\n  if (color) {\r\n    if (color.length < 4) {\r\n      color.push(1.0);\r\n    }\r\n\r\n    this.setRGBA(color);\r\n  }\r\n}\r\n\r\nlet fieldrand = new util.MersenneRandom(0);\r\n\r\nlet huefields = {};\r\n\r\nexport function getHueField(width, height, dpi) {\r\n  let key = width + \":\" + height + \":\" + dpi.toFixed(4);\r\n\r\n  if (key in huefields) {\r\n    return huefields[key];\r\n  }\r\n\r\n  let field = new ImageData(width, height);\r\n  let idata = field.data;\r\n\r\n  for (let i = 0; i < width*height; i++) {\r\n    let ix = i%width, iy = ~~(i/width);\r\n    let idx = i*4;\r\n\r\n    let rgb = hsv_to_rgb(ix/width, 1, 1);\r\n\r\n    idata[idx] = rgb[0]*255;\r\n    idata[idx + 1] = rgb[1]*255;\r\n    idata[idx + 2] = rgb[2]*255;\r\n    idata[idx + 3] = 255;\r\n  }\r\n\r\n  //*\r\n  let canvas = document.createElement(\"canvas\");\r\n  canvas.width = field.width;\r\n  canvas.height = field.height;\r\n  let g = canvas.getContext(\"2d\");\r\n  g.putImageData(field, 0, 0);\r\n  field = canvas;\r\n  //*/\r\n\r\n  huefields[key] = field;\r\n  return field;\r\n}\r\n\r\nlet fields = {};\r\n\r\nexport function getFieldImage(fieldsize, width, height, hsva) {\r\n  fieldrand.seed(0);\r\n\r\n  /* render field at half res and upscale via canvas2d */\r\n  let width2 = width>>1;\r\n  let height2 = height>>1;\r\n  let fieldsize2 = fieldsize>>1;\r\n\r\n  let hue = hsva[0];\r\n  let hue_rgb = hsv_to_rgb(hue, 1.0, 1.0);\r\n  let key = fieldsize + \":\" + width2 + \":\" + height2 + \":\" + hue.toFixed(5);\r\n\r\n  if (key in fields)\r\n    return fields[key];\r\n\r\n  let size2 = fieldsize2;\r\n  let valpow = 0.75;\r\n\r\n  let image = {\r\n    width : width,\r\n    height: height,\r\n    image : new ImageData(fieldsize2, fieldsize2),\r\n\r\n    x2sat: (x) => {\r\n      return Math.min(Math.max(x/width, 0), 1);\r\n    },\r\n    y2val: (y) => {\r\n      y = 1.0 - Math.min(Math.max(y/height, 0), 1);\r\n\r\n      return y === 0.0 ? 0.0 : y**valpow;\r\n    },\r\n    sat2x: (s) => {\r\n      return s*width;\r\n    },\r\n    val2y: (v) => {\r\n      if (v === 0)\r\n        return height;\r\n\r\n      v = v**(1.0/valpow);\r\n      return (1.0 - v)*height;\r\n    }\r\n  };\r\n\r\n  image.params = {\r\n    box: {\r\n      x     : 0,\r\n      y     : 0,\r\n      width : width,\r\n      height: height\r\n    }\r\n  };\r\n\r\n  let idata = image.image.data;\r\n  for (let i = 0; i < idata.length; i += 4) {\r\n    let i2 = i/4;\r\n    let x = i2%size2, y = ~~(i2/size2);\r\n\r\n    let v = 1.0 - (y/size2);\r\n    let s = (x/size2);\r\n\r\n    let rgb = hsv_to_rgb(hsva[0], s, v**valpow);\r\n\r\n    idata[i] = rgb[0]*255;\r\n    idata[i + 1] = rgb[1]*255;\r\n    idata[i + 2] = rgb[2]*255;\r\n    idata[i + 3] = 255;\r\n  }\r\n\r\n  //*\r\n  let image2 = document.createElement(\"canvas\");\r\n  image2.width = size2;\r\n  image2.height = size2;\r\n  let g = image2.getContext(\"2d\");\r\n  g.putImageData(image.image, 0, 0);\r\n  //*/\r\n  image.canvas = image2;\r\n  image.scale = width/size2;\r\n\r\n  fields[key] = image;\r\n  return image;\r\n}\r\n\r\n\r\nlet _update_temp = new Vector4();\r\n\r\nexport class SimpleBox {\r\n  constructor(pos = [0, 0], size = [1, 1]) {\r\n    this.pos = new Vector2(pos);\r\n    this.size = new Vector2(size);\r\n    this.r = 0;\r\n  }\r\n}\r\n\r\nexport class HueField extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.g = this.canvas.getContext(\"2d\");\r\n    this.shadow.appendChild(this.canvas);\r\n\r\n    let setFromXY = (x, y) => {\r\n      let dpi = this.getDPI();\r\n      let pad = this._getPad();\r\n\r\n      let w = this.canvas.width/dpi - pad*2.0;\r\n      x -= pad;\r\n\r\n      let h = x/w;\r\n      h = Math.min(Math.max(h, 0.0), 1.0);\r\n\r\n      this.hsva[0] = h;\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.hsva);\r\n      }\r\n\r\n      this._redraw();\r\n    };\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Left\"]:\r\n        case keymap[\"Right\"]:\r\n          let sign = e.keyCode === keymap[\"Left\"] ? -1 : 1;\r\n\r\n          this.hsva[0] = Math.min(Math.max(this.hsva[0] + 0.05*sign, 0.0), 1.0);\r\n          this._redraw();\r\n\r\n          if (this.onchange) {\r\n            this.onchange();\r\n          }\r\n          break;\r\n      }\r\n    });\r\n\r\n    this.addEventListener(\"mousedown\", (e) => {\r\n      if (this.modalRunning) {\r\n        return;\r\n      }\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n\r\n      let rect = this.canvas.getClientRects()[0];\r\n      let x = e.clientX - rect.x, y = e.clientY - rect.y;\r\n\r\n      setFromXY(x, y);\r\n\r\n      this.pushModal({\r\n        on_mousemove: (e) => {\r\n          let rect = this.canvas.getClientRects()[0];\r\n          let x = e.clientX - rect.x, y = e.clientY - rect.y;\r\n\r\n          setFromXY(x, y);\r\n        },\r\n        on_mousedown: (e) => {\r\n          this.popModal();\r\n        },\r\n        on_mouseup  : (e) => {\r\n          this.popModal();\r\n        },\r\n        on_keydown  : (e) => {\r\n          if (e.keyCode === keymap[\"Enter\"] || e.keyCode === keymap[\"Escape\"] || e.keyCode === keymap[\"Space\"]) {\r\n            this.popModal();\r\n          }\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n\r\n  static define() {\r\n    return {\r\n      tagname          : \"huefield-x\",\r\n      style            : \"colorfield\",\r\n      havePickClipboard: true\r\n    };\r\n  }\r\n\r\n  getRGBA() {\r\n    let rgb = hsv_to_rgb(this.hsva[0], this.hsva[1], this.hsva[2]);\r\n    return new Vector4().loadXYZW(rgb[0], rgb[1], rgb[2], this.hsva[3]);\r\n  }\r\n\r\n  setRGBA(rgba) {\r\n    let hsv = rgb_to_hsv(rgba[0], rgba[1], rgba[2]);\r\n    this.hsva.loadXYZW(hsv[0], hsv[1], hsv[2], rgba[3]);\r\n\r\n    this._redraw();\r\n\r\n    if (this.onchange) {\r\n      this.onchange(this.hsva);\r\n    }\r\n  }\r\n\r\n  clipboardCopy() {\r\n    colorClipboardCopy.apply(this, arguments);\r\n  }\r\n\r\n  clipboardPaste() {\r\n    colorClipboardPaste.apply(this, arguments);\r\n  }\r\n\r\n  _getPad() {\r\n    return Math.max(this.getDefault(\"circleSize\"), 15);\r\n  }\r\n\r\n  _redraw() {\r\n    let g = this.g, canvas = this.canvas;\r\n    let dpi = this.getDPI();\r\n\r\n    let w = this.getDefault(\"width\");\r\n    let h = this.getDefault(\"hueHeight\");\r\n\r\n    canvas.width = ~~(w*dpi);\r\n    canvas.height = ~~(h*dpi);\r\n\r\n    canvas.style[\"width\"] = w + \"px\";\r\n    canvas.style[\"height\"] = h + \"px\";\r\n\r\n    /* create horizontal padding to make selection of\r\n     *  endpoint hue easier */\r\n\r\n    let rselector = ~~(this._getPad()*dpi); //~~(this.getDefault(\"circleSize\")*dpi);\r\n    let r_circle = this.getDefault(\"circleSize\")*dpi;\r\n\r\n    let w2 = canvas.width, h2 = canvas.height;\r\n\r\n    w2 -= rselector*2.0;\r\n\r\n    //g.drawImage(getHueField(w2, h2, dpi), 0, 0, w2, h2, rselector*2, 0, w2, h2);\r\n    g.drawImage(getHueField(w2, h2, dpi), 0, 0, w2, h2, rselector, 0, w2, h2);\r\n\r\n    let x = this.hsva[0]*w2 + rselector;\r\n    let y = canvas.height*0.5;\r\n\r\n    g.beginPath();\r\n    g.arc(x, y, r_circle, -Math.PI, Math.PI);\r\n    g.closePath();\r\n\r\n    g.strokeStyle = \"white\";\r\n    g.lineWidth = 3*dpi;\r\n    g.stroke();\r\n\r\n    g.strokeStyle = \"grey\";\r\n    g.lineWidth = 1*dpi;\r\n    g.stroke();\r\n\r\n    if (this.disabled) {\r\n      g.beginPath();\r\n      g.fillStyle = \"rgba(25,25,25,0.75)\"\r\n      g.rect(0, 0, this.canvas.width, this.canvas.height);\r\n      g.fill();\r\n    }\r\n  }\r\n\r\n  on_disabled() {\r\n    this._redraw();\r\n  }\r\n\r\n  on_enabled() {\r\n    this._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(HueField);\r\n\r\nexport class SatValField extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.hsva = [0, 0, 0, 1];\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.g = this.canvas.getContext(\"2d\");\r\n    this.shadow.appendChild(this.canvas);\r\n\r\n    this.onchange = undefined;\r\n\r\n    let setFromXY = (x, y) => {\r\n      let field = this._getField();\r\n      let r = ~~(this.getDefault(\"circleSize\")*this.getDPI());\r\n\r\n      let sat = field.x2sat(x - r);\r\n      let val = field.y2val(y - r);\r\n\r\n      this.hsva[1] = sat;\r\n      this.hsva[2] = val;\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.hsva);\r\n      }\r\n\r\n      this._redraw();\r\n    };\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Left\"]:\r\n        case keymap[\"Right\"]: {\r\n          let sign = e.keyCode === keymap[\"Left\"] ? -1 : 1;\r\n\r\n          this.hsva[1] = Math.min(Math.max(this.hsva[1] + 0.05*sign, 0.0), 1.0);\r\n          this._redraw();\r\n\r\n          if (this.onchange) {\r\n            this.onchange(this.hsva);\r\n          }\r\n\r\n          break;\r\n        }\r\n\r\n        case keymap[\"Up\"]:\r\n        case keymap[\"Down\"]: {\r\n          let sign = e.keyCode === keymap[\"Down\"] ? -1 : 1;\r\n\r\n          this.hsva[2] = Math.min(Math.max(this.hsva[2] + 0.05*sign, 0.0), 1.0);\r\n          this._redraw();\r\n\r\n          if (this.onchange) {\r\n            this.onchange(this.hsva);\r\n          }\r\n          break;\r\n        }\r\n      }\r\n    });\r\n\r\n    this.canvas.addEventListener(\"mousedown\", (e) => {\r\n      if (this.modalRunning) {\r\n        return;\r\n      }\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n\r\n      let rect = this.canvas.getClientRects()[0];\r\n      let x = e.clientX - rect.x, y = e.clientY - rect.y;\r\n\r\n      setFromXY(x, y);\r\n\r\n      this.pushModal({\r\n        on_pointermove(e) {\r\n          this.on_mousemove(e);\r\n        },\r\n        on_mousemove: (e) => {\r\n          let rect = this.canvas.getClientRects()[0];\r\n          if (rect === undefined) {\r\n            return;\r\n          }\r\n\r\n          let x = e.clientX - rect.x, y = e.clientY - rect.y;\r\n\r\n          setFromXY(x, y);\r\n        },\r\n        on_mousedown: (e) => {\r\n          this.popModal();\r\n        },\r\n        on_mouseup  : (e) => {\r\n          this.popModal();\r\n        },\r\n        on_keydown  : (e) => {\r\n          if (e.keyCode === keymap[\"Enter\"] || e.keyCode === keymap[\"Escape\"] || e.keyCode === keymap[\"Space\"]) {\r\n            this.popModal();\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    this.canvas.addEventListener(\"touchstart\", (e) => {\r\n      if (this.modalRunning) {\r\n        return;\r\n      }\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n\r\n      let rect = this.canvas.getClientRects()[0];\r\n      let x = e.touches[0].clientX - rect.x, y = e.touches[0].clientY - rect.y;\r\n\r\n      setFromXY(x, y);\r\n\r\n      this.pushModal({\r\n        on_mousemove  : (e) => {\r\n          let rect = this.canvas.getClientRects()[0];\r\n          let x, y;\r\n\r\n          if (e.touches && e.touches.length) {\r\n            x = e.touches[0].clientX - rect.x;\r\n            y = e.touches[0].clientY - rect.y;\r\n          } else {\r\n            x = e.x;\r\n            y = e.y;\r\n          }\r\n\r\n          setFromXY(x, y);\r\n        },\r\n        on_touchmove  : (e) => {\r\n          let rect = this.canvas.getClientRects()[0];\r\n          let x = e.touches[0].clientX - rect.x, y = e.touches[0].clientY - rect.y;\r\n\r\n          setFromXY(x, y);\r\n        },\r\n        on_mousedown  : (e) => {\r\n          this.popModal();\r\n        },\r\n        on_touchcancel: (e) => {\r\n          this.popModal();\r\n        },\r\n        on_touchend   : (e) => {\r\n          this.popModal();\r\n        },\r\n        on_mouseup    : (e) => {\r\n          this.popModal();\r\n        },\r\n        on_keydown    : (e) => {\r\n          if (e.keyCode === keymap[\"Enter\"] || e.keyCode === keymap[\"Escape\"] || e.keyCode === keymap[\"Space\"]) {\r\n            this.popModal();\r\n          }\r\n        }\r\n      });\r\n    })\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname          : \"satvalfield-x\",\r\n      style            : \"colorfield\",\r\n      havePickClipboard: true\r\n    };\r\n  }\r\n\r\n  getRGBA() {\r\n    let rgb = hsv_to_rgb(this.hsva[0], this.hsva[1], this.hsva[2]);\r\n    return new Vector4().loadXYZW(rgb[0], rgb[1], rgb[2], this.hsva[3]);\r\n  }\r\n\r\n  setRGBA(rgba) {\r\n    let hsv = rgb_to_hsv(rgba[0], rgba[1], rgba[2]);\r\n    this.hsva.loadXYZW(hsv[0], hsv[1], hsv[2], rgba[3]);\r\n\r\n    this.update(true);\r\n    this._redraw();\r\n\r\n    if (this.onchange) {\r\n      this.onchange(this.hsva);\r\n    }\r\n  }\r\n\r\n  clipboardCopy() {\r\n    colorClipboardCopy.apply(this, arguments);\r\n  }\r\n\r\n  clipboardPaste() {\r\n    colorClipboardPaste.apply(this, arguments);\r\n  }\r\n\r\n  _getField() {\r\n    let dpi = this.getDPI();\r\n    let canvas = this.canvas;\r\n    let r = this.getDefault(\"circleSize\");\r\n    let w = this.getDefault(\"width\");\r\n    let h = this.getDefault(\"height\");\r\n\r\n    //r = ~~(r*dpi);\r\n\r\n    return getFieldImage(this.getDefault(\"fieldSize\"), w - r*2, h - r*2, this.hsva);\r\n  }\r\n\r\n  update(force_update = false) {\r\n    super.update();\r\n\r\n    if (force_update) {\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _redraw() {\r\n    let g = this.g, canvas = this.canvas;\r\n    let dpi = this.getDPI();\r\n\r\n    let w = this.getDefault(\"width\");\r\n    let h = this.getDefault(\"height\");\r\n\r\n    canvas.width = ~~(w*dpi);\r\n    canvas.height = ~~(h*dpi);\r\n\r\n    canvas.style[\"width\"] = w + \"px\";\r\n    canvas.style[\"height\"] = h + \"px\";\r\n    //SatValField\r\n\r\n    let rselector = ~~(this.getDefault(\"circleSize\")*dpi);\r\n\r\n    let field = this._getField()\r\n    let image = field.canvas;\r\n\r\n    g.globalAlpha = 1.0;\r\n    g.beginPath();\r\n    g.rect(0, 0, canvas.width, canvas.height);\r\n    g.fillStyle = \"rgb(200, 200, 200)\";\r\n    g.fill();\r\n\r\n    g.beginPath();\r\n\r\n    let steps = 17;\r\n    let dx = canvas.width/steps;\r\n    let dy = canvas.height/steps;\r\n\r\n    for (let i = 0; i < steps*steps; i++) {\r\n      let x = (i%steps)*dx, y = (~~(i/steps))*dy;\r\n\r\n      if (i%2 === 0) {\r\n        continue;\r\n      }\r\n      g.rect(x, y, dx, dy);\r\n    }\r\n\r\n    g.fillStyle = \"rgb(110, 110, 110)\";\r\n    g.fill();\r\n\r\n    g.globalAlpha = this.hsva[3];\r\n    g.drawImage(image, 0, 0, image.width, image.height, rselector, rselector, canvas.width - rselector*2, canvas.height - rselector*2);\r\n\r\n    let hsva = this.hsva;\r\n\r\n    let x = field.sat2x(hsva[1])*dpi + rselector;\r\n    let y = field.val2y(hsva[2])*dpi + rselector;\r\n    let r = rselector;\r\n\r\n    g.beginPath();\r\n    g.arc(x, y, r, -Math.PI, Math.PI);\r\n    g.closePath();\r\n\r\n    g.strokeStyle = \"white\";\r\n    g.lineWidth = 3*dpi;\r\n    g.stroke();\r\n\r\n    g.strokeStyle = \"grey\";\r\n    g.lineWidth = 1*dpi;\r\n    g.stroke();\r\n\r\n    if (this.disabled) {\r\n      g.beginPath();\r\n      g.fillStyle = \"rgba(25,25,25,0.75)\";\r\n      g.rect(0, 0, this.canvas.width, this.canvas.height);\r\n      g.fill();\r\n    }\r\n  }\r\n\r\n  on_disabled() {\r\n    this._redraw();\r\n  }\r\n\r\n  on_enabled() {\r\n    this._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(SatValField);\r\n\r\nexport class ColorField extends ui.ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this.hsva = new Vector4([0.05, 0.6, 0.15, 1.0]);\r\n    this.rgba = new Vector4([0, 0, 0, 0]);\r\n\r\n    this._recalcRGBA();\r\n\r\n    this._lastThemeStyle = this.constructor.define().style;\r\n\r\n    /*\r\n    this.hbox = new SimpleBox();\r\n    this.svbox = new SimpleBox();\r\n    //*/\r\n\r\n    this._last_dpi = undefined;\r\n\r\n    let satvalfield = this.satvalfield = UIBase.createElement(\"satvalfield-x\");\r\n    satvalfield.hsva = this.hsva;\r\n\r\n    let huefield = this.huefield = UIBase.createElement(\"huefield-x\");\r\n    huefield.hsva = this.hsva;\r\n\r\n    huefield.onchange = (e) => {\r\n      this.satvalfield._redraw();\r\n      this._recalcRGBA();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.rgba);\r\n      }\r\n    };\r\n\r\n    satvalfield.onchange = (e) => {\r\n      this._recalcRGBA();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.rgba);\r\n      }\r\n    };\r\n\r\n    this._add(satvalfield);\r\n    this._add(huefield);\r\n    //this.shadow.appendChild(canvas);\r\n    //this.shadow.appendChild(huecanvas);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"colorfield-x\",\r\n      style  : \"colorfield\"\r\n    };\r\n  }\r\n\r\n  setCMYK(c, m, y, k) {\r\n    let rgb = cmyk_to_rgb(c, m, y, k);\r\n    let hsv = rgb_to_hsv(rgb[0], rgb[1], rgb[2]);\r\n\r\n    this.setHSVA(hsv[0], hsv[1], hsv[2], this.hsva[3]);\r\n  }\r\n\r\n  getCMYK() {\r\n    let rgb = hsv_to_rgb(this.hsva[0], this.hsva[1], this.hsva[2]);\r\n    return rgb_to_cmyk(rgb[0], rgb[1], rgb[2]);\r\n  }\r\n\r\n  setHSVA(h, s, v, a = 1.0, fire_onchange = true) {\r\n    this.hsva[0] = h;\r\n    this.hsva[1] = s;\r\n    this.hsva[2] = v;\r\n    this.hsva[3] = a;\r\n\r\n    this._recalcRGBA();\r\n    this.update(true);\r\n\r\n    if (this.onchange && fire_onchange) {\r\n      this.onchange(this.hsva, this.rgba);\r\n    }\r\n  }\r\n\r\n  _recalcRGBA() {\r\n    let ret = hsv_to_rgb(this.hsva[0], this.hsva[1], this.hsva[2]);\r\n\r\n    this.rgba[0] = ret[0];\r\n    this.rgba[1] = ret[1];\r\n    this.rgba[2] = ret[2];\r\n    this.rgba[3] = this.hsva[3];\r\n\r\n    return this;\r\n  }\r\n\r\n  updateDPI(force_update = false, _in_update = false) {\r\n    let dpi = this.getDPI();\r\n\r\n    let update = force_update;\r\n    update = update || dpi != this._last_dpi;\r\n\r\n    if (update) {\r\n      this._last_dpi = dpi;\r\n\r\n      if (!_in_update)\r\n        this._redraw();\r\n\r\n      return true;\r\n    }\r\n  }\r\n\r\n  getRGBA() {\r\n    let rgb = hsv_to_rgb(this.hsva[0], this.hsva[1], this.hsva[2]);\r\n    return new Vector4().loadXYZW(rgb[0], rgb[1], rgb[2], this.hsva[3]);\r\n  }\r\n\r\n  setRGBA(r, g, b, a = 1.0, fire_onchange = true) {\r\n    if (typeof r === \"object\") {\r\n      g = r[1];\r\n      b = r[2];\r\n      a = r[3];\r\n      r = r[0];\r\n    }\r\n\r\n    let hsv = rgb_to_hsv(r, g, b);\r\n\r\n    this.hsva[0] = hsv[0];\r\n    this.hsva[1] = hsv[1];\r\n    this.hsva[2] = hsv[2];\r\n    this.hsva[3] = a;\r\n\r\n    this._recalcRGBA();\r\n    this.update(true);\r\n\r\n    if (this.onchange && fire_onchange) {\r\n      this.onchange(this.hsva, this.rgba);\r\n    }\r\n  }\r\n\r\n  updateThemeOverride() {\r\n    let theme = this.getStyleClass();\r\n    if (theme === this._lastThemeStyle) {\r\n      return false;\r\n    }\r\n\r\n    this._lastThemeStyle = theme;\r\n    this.huefield.overrideClass(theme);\r\n    this.satvalfield.overrideClass(theme);\r\n\r\n    for (let i=0; i<3; i++) {\r\n      this.flushSetCSS();\r\n      this.flushUpdate();\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  update(force_update = false) {\r\n    super.update();\r\n\r\n    this.updateThemeOverride();\r\n\r\n    let redraw = this.updateDPI(force_update, true);\r\n    redraw = redraw || force_update;\r\n\r\n    if (redraw) {\r\n      this.satvalfield.update(true);\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.style[\"flex-grow\"] = this.getDefault(\"flex-grow\");\r\n  }\r\n\r\n  _redraw() {\r\n    this.satvalfield._redraw();\r\n    this.huefield._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ColorField);\r\n\r\nexport class ColorPicker extends ui.ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this._lastThemeStyle = this.constructor.define().style;\r\n  }\r\n\r\n  //*\r\n  get hsva() {\r\n    return this.field.hsva;\r\n  }\r\n\r\n  get rgba() {\r\n    return this.field.rgba;\r\n  }//*/\r\n\r\n  set description(val) {\r\n    //do not allow setting description of the colorpicker container\r\n  }\r\n\r\n  static setDefault(node) {\r\n    let tabs, colorsPanel = node;\r\n\r\n    if (node.getClassDefault(\"usePanels\")) {\r\n      let panel = colorsPanel = node.panel(\"Color\");\r\n      tabs = panel.tabs();\r\n      panel.closed = true;\r\n\r\n      panel.style[\"flex-grow\"] = \"unset\";\r\n\r\n      /* force compactness */\r\n      panel.titleframe.style[\"flex-grow\"] = \"unset\";\r\n      //panel.titleframe.style[\"align-items\"] = \"unset\";\r\n    } else {\r\n      tabs = node.tabs();\r\n    }\r\n\r\n    node.cssText = node.textbox();\r\n    node.cssText.onchange = (val) => {\r\n      let ok = validateWebColor(val);\r\n      if (!ok) {\r\n        node.cssText.flash(\"red\");\r\n        return;\r\n      } else {\r\n        node.cssText.flash(\"green\");\r\n      }\r\n\r\n      val = val.trim();\r\n\r\n      let color = web2color(val);\r\n\r\n      node._no_update_textbox = true;\r\n      node.field.setRGBA(color[0], color[1], color[2], color[3]);\r\n      node._setSliders();\r\n\r\n      node._no_update_textbox = false;\r\n    };\r\n\r\n    //tabs.overrideDefault(\"background-color\", node.getDefault(\"background-color\"));\r\n\r\n    let tab = tabs.tab(\"HSV\");\r\n\r\n    node.h = tab.slider(undefined, \"Hue\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let hsva = node.hsva;\r\n      node.setHSVA(e.value, hsva[1], hsva[2], hsva[3]);\r\n    });\r\n\r\n    node.s = tab.slider(undefined, \"Saturation\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let hsva = node.hsva;\r\n      node.setHSVA(hsva[0], e.value, hsva[2], hsva[3]);\r\n    });\r\n    node.v = tab.slider(undefined, \"Value\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let hsva = node.hsva;\r\n      node.setHSVA(hsva[0], hsva[1], e.value, hsva[3]);\r\n    });\r\n    node.a = tab.slider(undefined, \"Alpha\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let hsva = node.hsva;\r\n      node.setHSVA(hsva[0], hsva[1], hsva[2], e.value);\r\n    });\r\n\r\n    node.h.baseUnit = node.h.displayUnit = \"none\";\r\n    node.s.baseUnit = node.s.displayUnit = \"none\";\r\n    node.v.baseUnit = node.v.displayUnit = \"none\";\r\n    node.a.baseUnit = node.a.displayUnit = \"none\";\r\n\r\n    tab = tabs.tab(\"RGB\");\r\n\r\n    node.r = tab.slider(undefined, \"R\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let rgba = node.rgba;\r\n      node.setRGBA(e.value, rgba[1], rgba[2], rgba[3]);\r\n    });\r\n    node.g = tab.slider(undefined, \"G\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let rgba = node.rgba;\r\n      node.setRGBA(rgba[0], e.value, rgba[2], rgba[3]);\r\n    });\r\n    node.b = tab.slider(undefined, \"B\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let rgba = node.rgba;\r\n      node.setRGBA(rgba[0], rgba[1], e.value, rgba[3]);\r\n    });\r\n    node.a2 = tab.slider(undefined, \"Alpha\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let rgba = node.rgba;\r\n      node.setRGBA(rgba[0], rgba[1], rgba[2], e.value);\r\n    });\r\n\r\n    node.r.baseUnit = node.r.displayUnit = \"none\";\r\n    node.g.baseUnit = node.g.displayUnit = \"none\";\r\n    node.b.baseUnit = node.b.displayUnit = \"none\";\r\n    node.a2.baseUnit = node.a2.displayUnit = \"none\";\r\n\r\n    if (!node.getDefault(\"noCMYK\")) {\r\n      tab = tabs.tab(\"CMYK\")\r\n      let cmyk = node.getCMYK();\r\n\r\n      let makeCMYKSlider = (label, idx) => {\r\n        let slider = tab.slider(undefined, {\r\n          name      : label,\r\n          min       : 0.0,\r\n          max       : 1.0,\r\n          is_int    : false,\r\n          defaultval: cmyk[idx],\r\n          callback  : (e) => {\r\n            let cmyk = node.getCMYK();\r\n            cmyk[idx] = e.value;\r\n            node.setCMYK(cmyk[0], cmyk[1], cmyk[2], cmyk[3]);\r\n          },\r\n          step      : 0.001\r\n        });\r\n\r\n        slider.baseUnit = slider.displayUnit = \"none\";\r\n\r\n        return slider;\r\n      }\r\n\r\n      node.cmyk = [\r\n        makeCMYKSlider(\"C\", 0),\r\n        makeCMYKSlider(\"M\", 1),\r\n        makeCMYKSlider(\"Y\", 2),\r\n        makeCMYKSlider(\"K\", 3),\r\n      ];\r\n    }\r\n\r\n    node._setSliders();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname            : \"colorpicker-x\",\r\n      style              : \"colorfield\",\r\n      havePickClipboard  : true,\r\n      copyForAllChildren : true,\r\n      pasteForAllChildren: true,\r\n    };\r\n  }\r\n\r\n  clipboardCopy() {\r\n    colorClipboardCopy.apply(this, arguments);\r\n  }\r\n\r\n  clipboardPaste() {\r\n    colorClipboardPaste.apply(this, arguments);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.field = UIBase.createElement(\"colorfield-x\");\r\n    this.field.setAttribute(\"class\", \"colorpicker\");\r\n\r\n    this.field.packflag |= this.inherit_packflag;\r\n    this.field.packflag |= this.packflag;\r\n\r\n    this.field.onchange = () => {\r\n      this._setDataPath();\r\n      this._setSliders();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.field.rgba);\r\n      }\r\n    };\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n      .colorpicker {\r\n        background-color : ${this.getDefault(\"background-color\")};\r\n      }\r\n    `;\r\n\r\n    this._style = style;\r\n\r\n    let cb = this.colorbox = document.createElement(\"div\");\r\n    cb.style[\"width\"] = \"100%\";\r\n    cb.style[\"height\"] = this.getDefault(\"colorBoxHeight\") + \"px\";\r\n    cb.style[\"background-color\"] = \"black\";\r\n\r\n    this.shadow.appendChild(style);\r\n    this.field.ctx = this.ctx;\r\n\r\n    this.add(this.colorbox);\r\n    this.add(this.field);\r\n\r\n    this.style[\"width\"] = this.getDefault(\"width\") + \"px\";\r\n  }\r\n\r\n  updateColorBox() {\r\n    let r = this.field.rgba[0], g = this.field.rgba[1], b = this.field.rgba[2];\r\n    //let a = this.field.rgba[3];\r\n\r\n    r = ~~(r*255);\r\n    g = ~~(g*255);\r\n    b = ~~(b*255);\r\n\r\n    let css = `rgb(${r},${g},${b})`;\r\n    this.colorbox.style[\"background-color\"] = css;\r\n  }\r\n\r\n  _setSliders() {\r\n    if (this.h === undefined) {\r\n      //setDefault() wasn't called\r\n      console.warn(\"colorpicker ERROR\");\r\n      return;\r\n    }\r\n\r\n    let hsva = this.field.hsva;\r\n    this.h.setValue(hsva[0], false);\r\n    this.s.setValue(hsva[1], false);\r\n    this.v.setValue(hsva[2], false);\r\n    this.a.setValue(hsva[3], false);\r\n\r\n    let rgba = this.field.rgba;\r\n\r\n    this.r.setValue(rgba[0], false);\r\n    this.g.setValue(rgba[1], false);\r\n    this.b.setValue(rgba[2], false);\r\n    this.a2.setValue(rgba[3], false);\r\n\r\n    if (this.cmyk) {\r\n      let cmyk = this.field.getCMYK();\r\n\r\n      for (let i = 0; i < 4; i++) {\r\n        this.cmyk[i].setValue(cmyk[i], false);\r\n      }\r\n    }\r\n\r\n    this.updateColorBox();\r\n\r\n    if (!this._no_update_textbox) {\r\n      this.cssText.text = color2web(this.field.rgba);\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (val === undefined) {\r\n      //console.warn(\"Bad datapath\", this.getAttribute(\"datapath\"));\r\n      this.internalDisabled = true;\r\n      return;\r\n    }\r\n\r\n    this.internalDisabled = false;\r\n\r\n    _update_temp.load(val);\r\n\r\n    if (prop.type === PropTypes.VEC3) {\r\n      _update_temp[3] = 1.0;\r\n    }\r\n\r\n    if (_update_temp.vectorDistance(this.field.rgba) > 0.01) {\r\n      this.field.setRGBA(_update_temp[0], _update_temp[1], _update_temp[2], _update_temp[3], false);\r\n      this._setSliders();\r\n      this.field.update(true);\r\n    }\r\n  }\r\n\r\n  updateThemeOverride() {\r\n    let theme = this.getStyleClass();\r\n    if (theme === this._lastThemeStyle) {\r\n      return false;\r\n    }\r\n\r\n    this._lastThemeStyle = theme;\r\n    this.field.overrideClass(theme);\r\n\r\n    this.flushSetCSS();\r\n    this.flushUpdate();\r\n\r\n    return true;\r\n  }\r\n\r\n  update() {\r\n    this.updateThemeOverride();\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n\r\n    super.update();\r\n  }\r\n\r\n  _setDataPath() {\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n      if (prop === undefined) {\r\n        console.warn(\"Bad data path for color field:\", this.getAttribute(\"datapath\"));\r\n      }\r\n\r\n      let val = this.field.rgba;\r\n      if (prop !== undefined && prop.type === PropTypes.VEC3) {\r\n        val = new Vector3();\r\n        val.load(this.field.rgba);\r\n      }\r\n\r\n      this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), val);\r\n    }\r\n  }\r\n\r\n  getCMYK() {\r\n    return this.field.getCMYK();\r\n  }\r\n\r\n  setCMYK(c, m, y, k) {\r\n    this.field.setCMYK(c, m, y, k);\r\n    this._setSliders();\r\n    this._setDataPath();\r\n  }\r\n\r\n  setHSVA(h, s, v, a) {\r\n    this.field.setHSVA(h, s, v, a);\r\n    this._setSliders();\r\n    this._setDataPath();\r\n  }\r\n\r\n  getRGBA() {\r\n    return this.field.getRGBA();\r\n  }\r\n\r\n  setRGBA(r, g, b, a) {\r\n    this.field.setRGBA(r, g, b, a)\r\n    this._setSliders();\r\n    this._setDataPath();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ColorPicker);\r\n\r\n\r\nexport class ColorPickerButton extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._highlight = false;\r\n    this._depress = false;\r\n    this._label = \"error\";\r\n\r\n    this.customLabel = undefined;\r\n\r\n    this.rgba = new Vector4([1, 1, 1, 1]);\r\n\r\n    this.labelDom = document.createElement(\"span\");\r\n    this.labelDom.textContent = this._label;\r\n    this.dom = document.createElement(\"canvas\");\r\n    this.g = this.dom.getContext(\"2d\");\r\n\r\n    this.shadow.appendChild(this.labelDom);\r\n    this.shadow.appendChild(this.dom);\r\n  }\r\n\r\n  get label() {\r\n    return this._label;\r\n  }\r\n\r\n  set label(val) {\r\n    this._label = val;\r\n    this.labelDom.textContent = val;\r\n  }\r\n\r\n  get font() {\r\n    return this._font;\r\n  }\r\n\r\n  set font(val) {\r\n    this._font = val;\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  get noLabel() {\r\n    let ret = \"\" + this.getAttribute(\"no-label\");\r\n    ret = ret.toLowerCase();\r\n\r\n    return ret === \"true\" || ret === \"yes\" || ret === \"on\";\r\n  }\r\n\r\n  set noLabel(v) {\r\n    if (this.labelDom) {\r\n      this.labelDom.hidden = true; //will be deleted later\r\n    }\r\n\r\n    this.setAttribute(\"no-label\", v ? \"true\" : \"false\");\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname          : \"color-picker-button-x\",\r\n      style            : \"colorpickerbutton\",\r\n      havePickClipboard: true\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this._font = \"DefaultText\"; //this.getDefault(\"defaultFont\");\r\n\r\n    let enter = (e) => {\r\n      this._highlight = true;\r\n      this._redraw();\r\n    }\r\n\r\n    let leave = (e) => {\r\n      this._highlight = false;\r\n      this._redraw();\r\n    }\r\n\r\n    this.addEventListener(\"pointerover\", enter, {capture: true, passive: true});\r\n    this.addEventListener(\"pointerout\", leave, {capture: true, passive: true});\r\n    this.addEventListener(\"focus\", leave, {capture: true, passive: true});\r\n\r\n\r\n    this.addEventListener(\"mousedown\", (e) => {\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n\r\n      this.click(e);\r\n    });\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  clipboardCopy() {\r\n    colorClipboardCopy.apply(this, arguments);\r\n  }\r\n\r\n  clipboardPaste() {\r\n    colorClipboardPaste.apply(this, arguments);\r\n  }\r\n\r\n  getRGBA() {\r\n    return this.rgba;\r\n  }\r\n\r\n  click(e) {\r\n    this.abortToolTips(4000);\r\n    console.warn(\"CLICK COLORPICKER\");\r\n    this.blur();\r\n\r\n    if (this.onclick) {\r\n      this.onclick(e);\r\n    }\r\n\r\n    let colorpicker = this.ctx.screen.popup(this, this);\r\n    let ctx = contextWrangler.makeSafeContext(this.ctx);\r\n\r\n    colorpicker.ctx = ctx;\r\n    colorpicker.useDataPathUndo = this.useDataPathUndo;\r\n\r\n    let path = this.hasAttribute(\"datapath\") ? this.getAttribute(\"datapath\") : undefined;\r\n\r\n    let widget = colorpicker.colorPicker(path, undefined, this.getAttribute(\"mass_set_path\"));\r\n\r\n    widget.ctx = ctx;\r\n    widget._init();\r\n    widget.setRGBA(this.rgba[0], this.rgba[1], this.rgba[2], this.rgba[3]);\r\n\r\n    widget.style[\"padding\"] = \"20px\";\r\n\r\n    let onchange = () => {\r\n      this.rgba.load(widget.rgba);\r\n      this.redraw();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this);\r\n      }\r\n    }\r\n\r\n    widget.onchange = onchange;\r\n\r\n    colorpicker.style[\"background-color\"] = widget.getDefault(\"background-color\");\r\n    //colorpicker.style[\"border-radius\"] = \"25px\";\r\n    colorpicker.style[\"border-width\"] = widget.getDefault(\"border-width\");\r\n  }\r\n\r\n  setRGBA(val) {\r\n    let a = this.rgba[3];\r\n\r\n    let old = new Vector4(this.rgba);\r\n\r\n    this.rgba.load(val);\r\n\r\n    if (val.length < 4) {\r\n      this.rgba[3] = a;\r\n    }\r\n\r\n    if (this.rgba.vectorDistance(old) < 0.001) {\r\n      return;\r\n    }\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this.rgba);\r\n    }\r\n\r\n    if (this.onchange) {\r\n      this.onchange();\r\n    }\r\n\r\n    this._redraw();\r\n    return this;\r\n  }\r\n\r\n  on_disabled() {\r\n    this.setCSS();\r\n    this._redraw();\r\n  }\r\n\r\n  _redraw() {\r\n    let canvas = this.dom, g = this.g;\r\n\r\n    g.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    if (this.disabled) {\r\n      let color = \"rgb(55, 55, 55)\";\r\n\r\n      g.save();\r\n\r\n      ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"fill\", color);\r\n      ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"clip\");\r\n      let steps = 5;\r\n      let dt = canvas.width/steps, t = 0;\r\n\r\n      g.beginPath();\r\n      g.lineWidth = 2;\r\n      g.strokeStyle = \"black\";\r\n\r\n      for (let i = 0; i < steps; i++, t += dt) {\r\n        g.moveTo(t, 0);\r\n        g.lineTo(t + dt, canvas.height);\r\n        g.moveTo(t + dt, 0);\r\n        g.lineTo(t, canvas.height);\r\n      }\r\n\r\n      g.stroke();\r\n      g.restore();\r\n      return;\r\n    }\r\n\r\n    //do checker pattern for alpha\r\n    g.save();\r\n\r\n    let grid1 = \"rgb(100, 100, 100)\";\r\n    let grid2 = \"rgb(175, 175, 175)\";\r\n\r\n    ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"clip\");\r\n    ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"fill\", grid1);\r\n\r\n    let cellsize = 10;\r\n    let totx = Math.ceil(canvas.width/cellsize), toty = Math.ceil(canvas.height/cellsize);\r\n\r\n    ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"clip\", undefined, undefined, true);\r\n    g.clip();\r\n\r\n    g.beginPath();\r\n    for (let x = 0; x < totx; x++) {\r\n      for (let y = 0; y < toty; y++) {\r\n        if ((x + y) & 1) {\r\n          continue;\r\n        }\r\n\r\n        g.rect(x*cellsize, y*cellsize, cellsize, cellsize);\r\n      }\r\n    }\r\n\r\n    g.fillStyle = grid2;\r\n    g.fill();\r\n\r\n    //g.fillStyle = \"orange\";\r\n    //g.beginPath();\r\n    //g.rect(0, 0, canvas.width, canvas.height);\r\n    //g.fill();\r\n\r\n    let color = color2css(this.rgba);\r\n    ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"fill\", color, undefined, true);\r\n    //drawRoundBox(elem, canvas, g, width, height, r=undefined, op=\"fill\", color=undefined, pad=undefined) {\r\n\r\n    if (this._highlight) {\r\n      //let color = \"rgba(200, 200, 255, 0.5)\";\r\n      let color = this.getDefault(\"BoxHighlight\");\r\n      ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"fill\", color);\r\n    }\r\n\r\n    g.restore();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    let w = this.getDefault(\"width\");\r\n    let h = this.getDefault(\"height\");\r\n    let dpi = this.getDPI();\r\n\r\n    this.style[\"width\"] = \"min-contents\" + \"px\";\r\n    this.style[\"height\"] = h + \"px\";\r\n\r\n    this.style[\"flex-direction\"] = \"row\";\r\n    this.style[\"display\"] = \"flex\";\r\n\r\n    this.labelDom.style[\"color\"] = this.getDefault(this._font).color;\r\n    this.labelDom.style[\"font\"] = ui_base.getFont(this, undefined, this._font, false);\r\n\r\n    let canvas = this.dom;\r\n\r\n    canvas.style[\"width\"] = w + \"px\";\r\n    canvas.style[\"height\"] = h + \"px\";\r\n    canvas.width = ~~(w*dpi);\r\n    canvas.height = ~~(h*dpi);\r\n\r\n    this.style[\"background-color\"] = \"rgba(0,0,0,0)\";\r\n    this._redraw();\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!(this.hasAttribute(\"datapath\"))) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n    let prop = this.getPathMeta(this.ctx, path);\r\n\r\n    if ((prop === undefined || prop.data === undefined) && cconst.DEBUG.verboseDataPath) {\r\n      console.log(\"bad path\", path);\r\n      return;\r\n    } else if (prop === undefined) {\r\n      let redraw = !this.disabled;\r\n\r\n      this.internalDisabled = true;\r\n\r\n      if (redraw) {\r\n        this._redraw();\r\n      }\r\n      return;\r\n    }\r\n\r\n    let redraw = this.disabled;\r\n\r\n    this.internalDisabled = false;\r\n\r\n    if (this.customLabel === undefined && prop.uiname !== this._label) {\r\n      this.label = prop.uiname;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, path);\r\n\r\n    if (val === undefined) {\r\n      redraw = redraw || this.disabled !== true;\r\n\r\n      this.internalDisabled = true;\r\n\r\n      if (redraw) {\r\n        this._redraw();\r\n      }\r\n\r\n    } else {\r\n      this.internalDisabled = false;\r\n\r\n      let dis;\r\n\r\n      if (val.length === 3) {\r\n        dis = Vector3.prototype.vectorDistance.call(val, this.rgba);\r\n      } else {\r\n        dis = this.rgba.vectorDistance(val);\r\n      }\r\n\r\n      if (dis > 0.0001) {\r\n        if (prop.type === PropTypes.VEC3) {\r\n          this.rgba.load(val);\r\n          this.rgba[3] = 1.0;\r\n        } else {\r\n          this.rgba.load(val);\r\n        }\r\n\r\n        redraw = true;\r\n      }\r\n\r\n      if (redraw) {\r\n        this._redraw();\r\n      }\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    if (this.noLabel && this.labelDom.isConnected) {\r\n      this.labelDom.remove();\r\n    }\r\n\r\n    if (this.customLabel !== undefined && this.customLabel !== this._label) {\r\n      this.label = this.customLabel;\r\n    }\r\n\r\n    for (let i = 0; i < this.rgba.length; i++) {\r\n      if (this.rgba[i] === undefined) {\r\n        console.warn(\"corrupted color or alpha detected\", this.rgba);\r\n        this.rgba[i] = 1.0;\r\n      }\r\n    }\r\n\r\n    let key = \"\" + this.rgba[0].toFixed(4) + \" \" + this.rgba[1].toFixed(4) + \" \" + this.rgba[2].toFixed(4) + \" \" + this.rgba[3].toFixed(4);\r\n    key += this.disabled;\r\n\r\n    if (key !== this._last_key) {\r\n      this._last_key = key;\r\n      this.redraw();\r\n    }\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n  }\r\n\r\n  redraw() {\r\n    this._redraw();\r\n  }\r\n};\r\nUIBase.internalRegister(ColorPickerButton);\r\n","\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as ui from '../core/ui.js';\r\nimport {loadUIData, saveUIData} from '../core/ui_base.js';\r\nimport {keymap} from '../path-controller/util/events.js';\r\n\r\nlet UIBase      = ui_base.UIBase,\r\n    PackFlags   = ui_base.PackFlags,\r\n    IconSheets  = ui_base.IconSheets,\r\n    iconmanager = ui_base.iconmanager;\r\n\r\nexport let tab_idgen = 1;\r\nlet debug = false;\r\nlet Vector2 = vectormath.Vector2;\r\n\r\nfunction getpx(css) {\r\n  return parseFloat(css.trim().replace(\"px\", \"\"))\r\n}\r\n\r\nlet FAKE_TAB_ID = Symbol(\"fake_tab_id\");\r\n\r\n\r\nclass TabDragEvent extends PointerEvent {\r\n}\r\n\r\n\r\n/* subclass HTMLElement so tabs can be used as the .target\r\n*  member of events*/\r\nexport class TabItem extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.name = name;\r\n    this.icon = undefined;\r\n    this.tooltip = \"\";\r\n    this.movable = true;\r\n    this.tbar = undefined;\r\n\r\n    this.ontabclick = null;\r\n    this.ontabdragstart = null;\r\n    this.ontabdragmove = null;\r\n    this.ontabdragend = null;\r\n\r\n    let helper = (key) => {\r\n      let key2 = \"on\" + key;\r\n\r\n      this.addEventListener(key, (e) => {\r\n        if (this[key2]) {\r\n          return this[key2](e);\r\n        }\r\n      });\r\n    }\r\n\r\n    helper(\"tabclick\");\r\n    helper(\"tabdragstart\");\r\n    helper(\"tabdragmove\");\r\n    helper(\"tabdragend\");\r\n\r\n    this.dom = undefined;\r\n    this.extra = undefined;\r\n    this.extraSize = undefined;\r\n\r\n    this.size = new Vector2();\r\n    this.pos = new Vector2();\r\n\r\n    this.abssize = new Vector2();\r\n    this.abspos = new Vector2();\r\n\r\n\r\n    this.addEventListener(\"pointerdown\", (e) => {\r\n      this.parentWidget.on_pointerdown(e);\r\n    });\r\n\r\n    this.addEventListener(\"pointermove\", (e) => {\r\n      this.parentWidget.on_pointermove(e);\r\n    });\r\n\r\n    this.addEventListener(\"pointerup\", (e) => {\r\n      this.parentWidget.on_pointerup(e);\r\n    });\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap.Enter:\r\n        case keymap.Space:\r\n          this.parentWidget.setActive(this, e);\r\n          break;\r\n      }\r\n    });\r\n  }\r\n\r\n  init() {\r\n    this.tabIndex = 1;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"tab-item-x\"\r\n    }\r\n  }\r\n\r\n  sendEvent(type, forwardEvent) {\r\n    let cls;\r\n\r\n    if (type === \"tabdragstart\" || type === \"tabdragend\") {\r\n      cls = TabDragEvent;\r\n    } else if (forwardEvent && forwardEvent instanceof Event) {\r\n      cls = forwardEvent.constructor;\r\n    } else {\r\n      cls = PointerEvent;\r\n    }\r\n\r\n    let e2 = {};\r\n\r\n    if (forwardEvent) {\r\n      for (let k in forwardEvent) {\r\n        if (k === \"defaultPrevented\" || k === \"cancelBubble\") {\r\n          continue;\r\n        }\r\n\r\n        e2[k] = forwardEvent[k];\r\n      }\r\n    }\r\n\r\n    e2.target = this;\r\n\r\n    e2 = new cls(type, e2);\r\n\r\n    this.dispatchEvent(e2);\r\n    return e2;\r\n  }\r\n\r\n  getClientRects() {\r\n    let r = this.tbar.getClientRects()[0];\r\n\r\n    let s = this.abssize, p = this.abspos;\r\n\r\n    s.load(this.size);\r\n    p.load(this.pos);\r\n\r\n    if (r) {\r\n      p[0] += r.x;\r\n      p[1] += r.y;\r\n    }\r\n\r\n    return [{\r\n      x  : p[0], y: p[1], width: s[0], height: s[1], left: p[0],\r\n      top: p[1], right: p[0] + s[0], bottom: p[1] + s[1]\r\n    }];\r\n  }\r\n\r\n  setCSS() {\r\n    let dpi = UIBase.getDPI();\r\n    let x = this.pos[0]/dpi;\r\n    let y = this.pos[1]/dpi;\r\n    let w = this.size[0]/dpi;\r\n    let h = this.size[1]/dpi;\r\n\r\n    if (this == this.parentWidget.tabs.active) {\r\n      this.style[\"focus-border-width\"] = \"0px\";\r\n    } else {\r\n      this.style[\"focus-border-width\"] = \"2px\";\r\n    }\r\n\r\n    this.style[\"background-color\"] = \"transparent\";\r\n\r\n    this.style[\"margin\"] = this.style[\"padding\"] = \"0px\";\r\n    this.style[\"position\"] = \"absolute\";\r\n    this.style[\"pointer-events\"] = \"auto\";\r\n\r\n    this.style[\"left\"] = x + \"px\";\r\n    this.style[\"top\"] = y + \"px\";\r\n    this.style[\"width\"] = w + \"px\";\r\n    this.style[\"height\"] = h + \"px\";\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(TabItem);\r\n\r\nexport class ModalTabMove extends events.EventHandler {\r\n  constructor(tab, tbar, dom) {\r\n    super();\r\n\r\n    this.dom = dom;\r\n    this.tab = tab;\r\n    this.tbar = tbar;\r\n    this.first = true;\r\n\r\n    this.droptarget = undefined;\r\n    this.start_mpos = new Vector2();\r\n    this.mpos = undefined;\r\n\r\n    this.dragtab = undefined;\r\n    this.dragstate = false;\r\n    this.finished = false;\r\n  }\r\n\r\n  finish() {\r\n    if (debug) if (debug) console.log(\"finish\");\r\n\r\n    if (this.finished) {\r\n      return;\r\n    }\r\n\r\n    this.finished = true;\r\n\r\n    if (this.tbar.tool === this) {\r\n      this.tbar.tool = undefined;\r\n    }\r\n\r\n    this.popModal(this.dom);\r\n    this.tbar.update(true);\r\n  }\r\n\r\n  popModal() {\r\n    if (this.dragcanvas !== undefined) {\r\n      this.dragcanvas.remove();\r\n    }\r\n    let ret = super.popModal(...arguments);\r\n\r\n    this.tab.sendEvent(\"tabdragend\");\r\n\r\n    return ret;\r\n  }\r\n\r\n  on_pointerenter(e) {\r\n  }\r\n\r\n  on_pointerleave(e) {\r\n  }\r\n\r\n  on_pointerstart(e) {\r\n  }\r\n\r\n  on_pointerend(e) {\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    this.finish();\r\n  }\r\n\r\n  on_pointercancel(e) {\r\n    this.finish();\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    this.finish();\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    return this._on_move(e, e.x, e.y);\r\n  }\r\n\r\n  _dragstate(e, x, y) {\r\n    this.dragcanvas.style[\"left\"] = x + \"px\";\r\n    this.dragcanvas.style[\"top\"] = y + \"px\";\r\n\r\n    let ctx = this.tbar.ctx;\r\n    let screen = ctx.screen;\r\n    let elem = screen.pickElement(x, y);\r\n\r\n    let e2 = new DragEvent(\"dragenter\", this.dragevent);\r\n    if (elem !== this.droptarget) {\r\n      let e2 = new DragEvent(\"dragexit\", this.dragevent);\r\n      if (this.droptarget) {\r\n        this.droptarget.dispatchEvent(e2);\r\n      }\r\n\r\n      e2 = new DragEvent(\"dragover\", this.dragevent);\r\n      this.droptarget = elem;\r\n      if (elem) {\r\n        elem.dispatchEvent(e2);\r\n      }\r\n    }\r\n    //console.log(elem);\r\n  }\r\n\r\n  _on_move(e, x, y) {\r\n    let r = this.tbar.getClientRects()[0];\r\n    let dpi = UIBase.getDPI();\r\n\r\n    if (r === undefined) {\r\n      //element was removed during/before move\r\n      this.finish();\r\n      return;\r\n    }\r\n\r\n    if (this.dragstate) {\r\n      this._dragstate(e, x, y);\r\n      return;\r\n    }\r\n\r\n    x -= r.x;\r\n    y -= r.y;\r\n\r\n    let dx, dy;\r\n\r\n    x *= dpi;\r\n    y *= dpi;\r\n\r\n    if (this.first) {\r\n      this.first = false;\r\n      this.start_mpos[0] = x;\r\n      this.start_mpos[1] = y;\r\n    }\r\n    if (this.mpos === undefined) {\r\n      this.mpos = [0, 0];\r\n      dx = dy = 0;\r\n    } else {\r\n      dx = x - this.mpos[0];\r\n      dy = y - this.mpos[1];\r\n    }\r\n\r\n    if (debug) console.log(x, y, dx, dy);\r\n\r\n    let tab = this.tab, tbar = this.tbar;\r\n    let axis = tbar.horiz ? 0 : 1;\r\n    let distx, disty;\r\n\r\n    if (tbar.horiz) {\r\n      tab.pos[0] += dx;\r\n      disty = Math.abs(y - this.start_mpos[1]);\r\n    } else {\r\n      tab.pos[1] += dy;\r\n      disty = Math.abs(x - this.start_mpos[0]);\r\n    }\r\n\r\n    let limit = 50;\r\n    let csize = tbar.horiz ? this.tbar.canvas.width : this.tbar.canvas.height;\r\n\r\n    let dragok = tab.pos[axis] + tab.size[axis] < -limit || tab.pos[axis] >= csize + limit;\r\n    dragok = dragok || disty > limit*1.5;\r\n    dragok = dragok && (this.tbar.draggable || this.tbar.getAttribute(\"draggable\"));\r\n\r\n    //console.log(dragok, disty, this.tbar.draggable);\r\n\r\n    if (dragok) {\r\n      this.dragstate = true;\r\n      this.dragevent = new DragEvent(\"dragstart\", {\r\n        dataTransfer: new DataTransfer()\r\n      });\r\n\r\n      this.dragtab = tab;\r\n      let g = this.tbar.g;\r\n      this.dragimg = g.getImageData(~~tab.pos[0], ~~tab.pos[1], ~~tab.size[0], ~~tab.size[1]);\r\n      this.dragcanvas = document.createElement(\"canvas\");\r\n      let g2 = this.drag_g = this.dragcanvas.getContext(\"2d\");\r\n\r\n      this.dragcanvas.visibleToPick = false;\r\n      this.dragcanvas.width = ~~tab.size[0];\r\n      this.dragcanvas.height = ~~tab.size[1];\r\n      this.dragcanvas.style[\"width\"] = (tab.size[0]/dpi) + \"px\";\r\n      this.dragcanvas.style[\"height\"] = (tab.size[1]/dpi) + \"px\";\r\n      this.dragcanvas.style[\"position\"] = UIBase.PositionKey;\r\n      this.dragcanvas.style[\"left\"] = e.x + \"px\";\r\n      this.dragcanvas.style[\"top\"] = e.y + \"px\";\r\n      this.dragcanvas.style[\"z-index\"] = \"500\";\r\n      document.body.appendChild(this.dragcanvas);\r\n      g2.putImageData(this.dragimg, 0, 0);\r\n\r\n\r\n      this.tbar.dispatchEvent(this.dragevent);\r\n\r\n      return;\r\n    }\r\n\r\n    let ti = tbar.tabs.indexOf(tab);\r\n    let next = ti < tbar.tabs.length - 1 ? tbar.tabs[ti + 1] : undefined;\r\n    let prev = ti > 0 ? tbar.tabs[ti - 1] : undefined;\r\n\r\n    if (next !== undefined && next.movable && tab.pos[axis] > next.pos[axis]) {\r\n      tbar.swapTabs(tab, next);\r\n    } else if (prev !== undefined && prev.movable && tab.pos[axis] < prev.pos[axis] + prev.size[axis]*0.5) {\r\n      tbar.swapTabs(tab, prev);\r\n    }\r\n\r\n    tbar.update(true);\r\n\r\n    this.mpos[0] = x;\r\n    this.mpos[1] = y;\r\n\r\n    let e2 = tab.sendEvent(\"tabdragmove\", e);\r\n\r\n    if (e2.defaultPrevented) {\r\n      this.finish();\r\n    }\r\n  }\r\n\r\n  on_keydown(e) {\r\n    if (debug) console.log(e.keyCode);\r\n\r\n    switch (e.keyCode) {\r\n      case keymap.Escape: //escape\r\n      case keymap.Space: //space\r\n      case keymap.Enter: //enter\r\n      case keymap.Tab: //tab\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\nexport class TabBar extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    let style = document.createElement(\"style\");\r\n    let canvas = document.createElement(\"canvas\");\r\n\r\n    this.iconsheet = 0;\r\n    this.movableTabs = true;\r\n\r\n    this.tabFontScale = 1.0;\r\n\r\n    this.tabs = [];\r\n    this.tabs.active = undefined;\r\n    this.tabs.highlight = undefined;\r\n\r\n    this._last_style_key = undefined;\r\n\r\n    canvas.style[\"width\"] = \"145px\";\r\n    canvas.style[\"height\"] = \"45px\";\r\n\r\n    this.r = this.getDefault(\"TabBarRadius\", undefined, 8);\r\n\r\n    this.canvas = canvas;\r\n    this.g = canvas.getContext(\"2d\");\r\n\r\n    this.canvas.style[\"touch-action\"] = \"none\";\r\n\r\n    style.textContent = `\r\n    `;\r\n\r\n    this.shadow.appendChild(style);\r\n    this.shadow.appendChild(canvas);\r\n\r\n    this._last_dpi = undefined;\r\n    this._last_pos = undefined;\r\n\r\n    this.horiz = true;\r\n    this.onchange = null;\r\n    this.onselect = null; //onselect is like onchange, but fires even if tab hasn't changed\r\n\r\n    let mx, my;\r\n\r\n    this.canvas.addEventListener(\"pointermove\", (e) => {\r\n      this.on_pointermove(e);\r\n    }, false);\r\n\r\n\r\n    this.canvas.addEventListener(\"pointerdown\", (e) => {\r\n      this.on_pointerdown(e);\r\n    });\r\n  }\r\n\r\n  _doelement(e, mx, my) {\r\n    for (let tab of this.tabs) {\r\n      let ok;\r\n\r\n      if (this.horiz) {\r\n        ok = mx >= tab.pos[0] && mx <= tab.pos[0] + tab.size[0];\r\n      } else {\r\n        ok = my >= tab.pos[1] && my <= tab.pos[1] + tab.size[1];\r\n      }\r\n\r\n      if (ok && this.tabs.highlight !== tab) {\r\n        this.tabs.highlight = tab;\r\n        this.update(true);\r\n      }\r\n    }\r\n  }\r\n\r\n  _domouse(e) {\r\n    let r = this.canvas.getClientRects()[0];\r\n\r\n    let mx = e.x - r.x;\r\n    let my = e.y - r.y;\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    mx *= dpi;\r\n    my *= dpi;\r\n\r\n    this._doelement(e, mx, my);\r\n\r\n    const is_mdown = e.type === \"mousedown\" || e.type == \"pointerdown\";\r\n    if (is_mdown && this.onselect && this._fireOnSelect().defaultPrevented) {\r\n      e.preventDefault();\r\n    }\r\n  }\r\n\r\n  _doclick(e) {\r\n    this._domouse(e);\r\n\r\n    if (e.defaultPrevented) {\r\n      return;\r\n    }\r\n\r\n    if (debug) console.log(\"mdown\");\r\n\r\n    if (e.button !== 0) {\r\n      return;\r\n    }\r\n\r\n    let ht = this.tabs.highlight;\r\n\r\n    let acte = {};\r\n    for (let k in e) {\r\n      if (k === \"defaultPrevented\" || k === \"cancelBubble\") {\r\n        continue;\r\n      }\r\n\r\n      acte[k] = e[k];\r\n    }\r\n\r\n    acte.target = ht;\r\n    acte.pointerId = e.pointerId;\r\n\r\n    acte = new PointerEvent(\"tabactive\", acte);\r\n\r\n    let e2 = ht.sendEvent(\"tabclick\", e);\r\n\r\n    if (e2.defaultPrevented) {\r\n      acte.preventDefault();\r\n    }\r\n\r\n    if (ht !== undefined && this.tool === undefined) {\r\n      this.setActive(ht, acte);\r\n\r\n      if (this.movableTabs && !acte.defaultPrevented) {\r\n        this._startMove(ht, e);\r\n      }\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    this._doclick(e);\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let r = this.canvas.getClientRects()[0];\r\n    this._domouse(e);\r\n\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n  }\r\n\r\n  on_pointerup(e) {\r\n\r\n  }\r\n\r\n\r\n  static setDefault(e) {\r\n    e.setAttribute(\"bar_pos\", \"top\");\r\n    e.updatePos(true);\r\n\r\n    return e;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"tabbar-x\",\r\n      style  : \"tabs\"\r\n    };\r\n  }\r\n\r\n  _ensureNoModal() {\r\n    if (this.tool) {\r\n      this.tool.finish();\r\n      this.tool = undefined;\r\n    }\r\n  }\r\n\r\n  get tool() {\r\n    return this._tool;\r\n  }\r\n\r\n  set tool(v) {\r\n    //console.warn(\"SET TOOL\", v, this._id);\r\n    this._tool = v;\r\n  }\r\n\r\n  _startMove(tab = this.tabs.active, event, pointerId = event ? event.pointerId : undefined, pointerElem = tab) {\r\n    if (this.movableTabs) {\r\n      let e2 = tab.sendEvent(\"tabdragstart\", event);\r\n\r\n      if (e2.defaultPrevented) {\r\n        return;\r\n      }\r\n\r\n      if (this.tool) {\r\n        this.tool.finish();\r\n      }\r\n\r\n      let edom = this.getScreen();\r\n      let tool = this.tool = new ModalTabMove(tab, this, edom);\r\n\r\n      if (event && pointerElem && pointerId !== undefined) {\r\n        tool.pushPointerModal(pointerElem, pointerId);\r\n      } else {\r\n        tool.pushModal(edom, false);\r\n      }\r\n    }\r\n  }\r\n\r\n  _fireOnSelect() {\r\n    let e = this._makeOnSelectEvt();\r\n\r\n    if (this.onselect) {\r\n      this.onselect(e);\r\n    }\r\n\r\n    return e;\r\n  }\r\n\r\n  _makeOnSelectEvt() {\r\n    return {\r\n      tab             : this.tabs.highlight,\r\n      defaultPrevented: false,\r\n      preventDefault() {\r\n        this.defaultPrevented = true;\r\n      }\r\n    }\r\n    /*\r\n      return new MouseEvent(\"mousedown\", {\r\n        target : [this.tabs.highlight],\r\n        tab : \"sdfdsf\"\r\n      });\r\n\r\n   */\r\n  }\r\n\r\n  getTab(name_or_id) {\r\n    for (let tab of this.tabs) {\r\n      if (tab.id === name_or_id || tab.name === name_or_id)\r\n        return tab;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  clear() {\r\n    for (let t of this.tabs) {\r\n      if (t.dom) {\r\n        t.dom.remove();\r\n      }\r\n\r\n      t.remove();\r\n    }\r\n\r\n    this.tabs = [];\r\n    this.setCSS();\r\n    this._redraw();\r\n  }\r\n\r\n  saveData() {\r\n    let taborder = [];\r\n\r\n    for (let tab of this.tabs) {\r\n      taborder.push(tab.name);\r\n    }\r\n\r\n    let act = this.tabs.active !== undefined ? this.tabs.active.name : \"null\";\r\n\r\n    return {\r\n      taborder: taborder,\r\n      active  : act\r\n    };\r\n  }\r\n\r\n  loadData(obj) {\r\n    if (!obj.taborder) {\r\n      return;\r\n    }\r\n\r\n    let tabs = this.tabs;\r\n    let active = undefined;\r\n    let ntabs = [];\r\n\r\n    ntabs.active = undefined;\r\n    ntabs.highlight = undefined;\r\n\r\n    for (let tname of obj.taborder) {\r\n      let tab = this.getTab(tname);\r\n\r\n      if (tab === undefined) {\r\n        continue;\r\n      }\r\n\r\n      if (tab.name === obj.active) {\r\n        active = tab;\r\n      }\r\n\r\n      ntabs.push(tab);\r\n    }\r\n\r\n    for (let tab of tabs) {\r\n      if (ntabs.indexOf(tab) < 0) {\r\n        ntabs.push(tab);\r\n      }\r\n    }\r\n\r\n    this.tabs = ntabs;\r\n\r\n    try {\r\n      if (active !== undefined) {\r\n        this.setActive(active);\r\n      } else if (this.tabs.length > 0) {\r\n        this.setActive(this.tabs[0]);\r\n      }\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n    }\r\n\r\n    this.update(true);\r\n\r\n    return this;\r\n  }\r\n\r\n  swapTabs(a, b) {\r\n    let tabs = this.tabs;\r\n\r\n    let ai = tabs.indexOf(a);\r\n    let bi = tabs.indexOf(b);\r\n\r\n    tabs[ai] = b;\r\n    tabs[bi] = a;\r\n\r\n    this.update(true);\r\n  }\r\n\r\n  addIconTab(icon, id, tooltip, movable = true) {\r\n    let tab = this.addTab(\"\", id, tooltip, movable);\r\n    tab.icon = icon;\r\n\r\n    return tab;\r\n  }\r\n\r\n  addTab(name, id, tooltip = \"\", movable) {\r\n    let tab = UIBase.createElement(\"tab-item-x\", true);\r\n\r\n    this.shadow.appendChild(tab);\r\n    tab.parentWidget = this;\r\n\r\n\r\n    tab.name = name;\r\n    tab.id = id;\r\n    tab.tooltip = tooltip;\r\n    tab.movable = movable;\r\n    tab.tbar = this;\r\n\r\n    this.tabs.push(tab);\r\n    this.update(true);\r\n\r\n    if (this.tabs.length === 1) {\r\n      this.setActive(this.tabs[0]);\r\n    }\r\n\r\n    return tab;\r\n  }\r\n\r\n  updatePos(force_update = false) {\r\n    let pos = this.getAttribute(\"bar_pos\");\r\n\r\n    if (pos !== this._last_pos || force_update) {\r\n      this._last_pos = pos;\r\n\r\n      this.horiz = pos === \"top\" || pos === \"bottom\";\r\n      if (debug) console.log(\"tab bar position update\", this.horiz);\r\n\r\n      if (this.horiz) {\r\n        this.style[\"width\"] = \"100%\";\r\n        delete this.style[\"height\"];\r\n      } else {\r\n        this.style[\"height\"] = \"100%\";\r\n        delete this.style[\"width\"];\r\n      }\r\n\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  updateDPI(force_update = false) {\r\n    let dpi = this.getDPI();\r\n\r\n    if (dpi !== this._last_dpi) {\r\n      if (debug) console.log(\"DPI update!\");\r\n      this._last_dpi = dpi;\r\n\r\n      this.updateCanvas(true);\r\n    }\r\n  }\r\n\r\n  updateCanvas(force_update = false) {\r\n    let canvas = this.canvas;\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let rwidth = getpx(this.canvas.style[\"width\"]);\r\n    let rheight = getpx(this.canvas.style[\"height\"]);\r\n\r\n    let width = ~~(rwidth*dpi);\r\n    let height = ~~(rheight*dpi);\r\n\r\n    let update = force_update;\r\n    update = update || canvas.width !== width || canvas.height !== height;\r\n\r\n    if (update) {\r\n      canvas.width = width;\r\n      canvas.height = height;\r\n\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _getFont(tsize) {\r\n    let font = this.getDefault(\"TabText\");\r\n\r\n    if (this.tabFontScale !== 1.0) {\r\n      font = font.copy();\r\n      font.size *= this.tabFontScale;\r\n    }\r\n\r\n    return font;\r\n  }\r\n\r\n  _layout() {\r\n    if ((!this.ctx || !this.ctx.screen) && !this.isDead()) {\r\n      this.doOnce(this._layout);\r\n    }\r\n\r\n    let g = this.g;\r\n\r\n    if (debug) console.log(\"tab layout\");\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let font = this._getFont();\r\n    let tsize = (font.size*dpi);\r\n\r\n    g.font = font.genCSS(tsize);\r\n\r\n    let axis = this.horiz ? 0 : 1;\r\n\r\n    let pad = 4*dpi + Math.ceil(tsize*0.25);\r\n    let hpad = this.getDefault(\"TabPadding\", undefined, 0.0);\r\n\r\n    let x = pad;\r\n    let y = 0.0;\r\n\r\n    let h = tsize + Math.ceil(tsize*0.5) + hpad;\r\n    let iconsize = iconmanager.getTileSize(this.iconsheet);\r\n    let have_icons = false;\r\n\r\n    for (let tab of this.tabs) {\r\n      if (tab.icon !== undefined) {\r\n        have_icons = true;\r\n        h = Math.max(h, iconsize + 4);\r\n        break;\r\n      }\r\n    }\r\n\r\n    let r1 = this.parentWidget ? this.parentWidget.getClientRects()[0] : undefined;\r\n    let r2 = this.canvas.getClientRects()[0];\r\n\r\n    let rx = 0, ry = 0;\r\n    if (r2) {\r\n      rx = r2.x;//r2.x - r1.x;\r\n      ry = r2.y; //r2.y - r1.y;\r\n    }\r\n\r\n    let ti = -1;\r\n\r\n    let makeTabWatcher = (tab) => {\r\n      if (tab.watcher) {\r\n        clearInterval(tab.watcher.timer);\r\n      }\r\n\r\n      let watcher = () => {\r\n        let dead = this.tabs.indexOf(tab) < 0;\r\n        dead = dead || this.isDead();\r\n\r\n        if (dead) {\r\n          if (tab.dom)\r\n            tab.dom.remove();\r\n          tab.dom = undefined;\r\n\r\n          if (tab.watcher.timer)\r\n            clearInterval(tab.watcher.timer);\r\n        }\r\n      };\r\n\r\n      tab.watcher = watcher;\r\n      tab.watcher.timer = window.setInterval(watcher, 750);\r\n\r\n      return tab.watcher.timer;\r\n    };\r\n\r\n    let haveTabDom = false;\r\n    for (let tab of this.tabs) {\r\n      if (tab.extra) {\r\n        haveTabDom = true;\r\n      }\r\n    }\r\n\r\n    if (haveTabDom && this.ctx && this.ctx.screen && !this._size_cb) {\r\n      this._size_cb = () => {\r\n        if (this.isDead()) {\r\n          this.ctx.screen.removeEventListener(\"resize\", this._size_cb);\r\n          this._size_cb = undefined;\r\n          return;\r\n        }\r\n        if (!this.ctx) return;\r\n\r\n        this._layout();\r\n        this._redraw();\r\n      };\r\n\r\n      this.ctx.screen.addEventListener(\"resize\", this._size_cb);\r\n    }\r\n\r\n    for (let tab of this.tabs) {\r\n      ti++;\r\n\r\n      if (tab.extra && !tab.dom) {\r\n\r\n        tab.dom = document.createElement(\"div\");\r\n        tab.dom.style[\"margin\"] = tab.dom.style[\"padding\"] = \"0px\";\r\n\r\n        //XXX breaks mobile\r\n        //let z = this.calcZ();\r\n        //tab.dom.style[\"z-index\"] = z - 1 - ti;\r\n\r\n        document.body.appendChild(tab.dom);\r\n        tab.dom.style[\"position\"] = UIBase.PositionKey;\r\n        tab.dom.style[\"display\"] = \"flex\";\r\n        tab.dom.style[\"flex-direction\"] = this.horiz ? \"row\" : \"column\";\r\n\r\n        tab.dom.style[\"pointer-events\"] = \"none\";\r\n\r\n        if (!this.horiz) {\r\n          tab.dom.style[\"width\"] = (tab.size[0]/dpi) + \"px\";\r\n          tab.dom.style[\"height\"] = (tab.size[1]/dpi) + \"px\";\r\n          tab.dom.style[\"left\"] = (rx + tab.pos[0]/dpi) + \"px\";\r\n          tab.dom.style[\"top\"] = (ry + tab.pos[1]/dpi) + \"px\";\r\n        } else {\r\n          tab.dom.style[\"width\"] = (tab.size[0]/dpi) + \"px\";\r\n          tab.dom.style[\"height\"] = (tab.size[1]/dpi) + \"px\";\r\n          tab.dom.style[\"left\"] = (rx + tab.pos[0]/dpi) + \"px\";\r\n          tab.dom.style[\"top\"] = (ry + tab.pos[1]/dpi) + \"px\";\r\n        }\r\n\r\n        let font = this._getFont();\r\n        tab.dom.style[\"font\"] = font.genCSS();\r\n        tab.dom.style[\"color\"] = font.color;\r\n\r\n        tab.dom.appendChild(tab.extra);\r\n\r\n        //tab.dom.style[\"background-color\"] = \"red\";\r\n\r\n        makeTabWatcher(tab);\r\n      }\r\n\r\n      let w = g.measureText(tab.name).width;\r\n\r\n      if (tab.extra) {\r\n        w += tab.extraSize || tab.extra.getClientRects()[0].width;\r\n\r\n      }\r\n\r\n      if (tab.icon !== undefined) {\r\n        w += iconsize;\r\n      }\r\n\r\n      //don't interfere with tab dragging\r\n      let bad = this.tool !== undefined && tab === this.tabs.active;\r\n\r\n      if (!bad) {\r\n        tab.pos[axis] = x;\r\n        tab.pos[axis ^ 1] = y;\r\n      }\r\n\r\n      //tab.size = [0, 0];\r\n      tab.size[axis] = w + pad*2;\r\n      tab.size[axis ^ 1] = h;\r\n\r\n      x += w + pad*2;\r\n    }\r\n\r\n    x = (~~(x + pad))/dpi;\r\n    h = (~~h)/dpi;\r\n\r\n\r\n    if (this.horiz) {\r\n      this.canvas.style[\"width\"] = x + \"px\";\r\n      this.canvas.style[\"height\"] = h + \"px\";\r\n    } else {\r\n      this.canvas.style[\"height\"] = x + \"px\";\r\n      this.canvas.style[\"width\"] = h + \"px\";\r\n    }\r\n\r\n    for (let tab of this.tabs) {\r\n      tab.setCSS();\r\n    }\r\n\r\n    //this.canvas.width = x;\r\n  }\r\n\r\n  /** tab is a TabItem instance */\r\n  setActive(tab, event) {\r\n    if (tab.noSwitch) {\r\n      return;\r\n    }\r\n\r\n    let update = tab !== this.tabs.active;\r\n    this.tabs.active = tab;\r\n\r\n    if (update) {\r\n      if (!util.isMobile() && this.getDefault(\"focus-on-tab-click\")) {\r\n        tab.focus({preventScroll: true, focusVisible: false});\r\n      }\r\n\r\n      if (this.onchange)\r\n        this.onchange(tab, event);\r\n\r\n      this.update(true);\r\n    }\r\n  }\r\n\r\n  _redraw() {\r\n    let g = this.g;\r\n\r\n    let activecolor = this.getDefault(\"TabActive\") || \"rgba(0,0,0,0)\";\r\n\r\n    if (debug) console.log(\"tab draw\");\r\n\r\n    g.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n\r\n    let dpi = this.getDPI();\r\n    let font = this._getFont();\r\n\r\n    let tsize = font.size;\r\n    let iconsize = iconmanager.getTileSize(this.iconsheet);\r\n\r\n    tsize = (tsize*dpi);\r\n    g.font = font.genCSS(tsize);\r\n\r\n    g.lineWidth = 2;\r\n    g.strokeStyle = this.getDefault(\"TabStrokeStyle1\");\r\n\r\n    let r = this.r*dpi;\r\n    this._layout();\r\n    let tab;\r\n\r\n    const draw_text = (name, x2, y2) => {\r\n      let hpad = this.getDefault(\"TabPadding\", undefined, 0.0);\r\n      if (this.horiz) {\r\n        y2 += hpad*0.5;\r\n      } else {\r\n        y2 -= hpad*0.5;\r\n      }\r\n\r\n      g.fillText(tab.name, x2, y2);\r\n    };\r\n\r\n    let ti = -1;\r\n    for (tab of this.tabs) {\r\n      ti++;\r\n\r\n      if (tab === this.tabs.active)\r\n        continue;\r\n\r\n      let x = tab.pos[0], y = tab.pos[1];\r\n      let w = tab.size[0], h = tab.size[1];\r\n      //let tw = g.measureText(tab.name).width;\r\n      let tw = ui_base.measureText(this, tab.name, this.canvas, g, tsize, font).width;\r\n\r\n      let x2 = x + (tab.size[this.horiz ^ 1] - tw)*0.5;\r\n      let y2 = y + tsize;\r\n\r\n      if (tab === this.tabs.highlight) {\r\n        let p = 2;\r\n\r\n        g.beginPath();\r\n        g.rect(x + p, y + p, w - p*2, h - p*2);\r\n        g.fillStyle = this.getDefault(\"TabHighlight\");\r\n        g.fill();\r\n      }\r\n\r\n      g.fillStyle = this.getDefault(\"TabText\").color;\r\n\r\n      if (!this.horiz) {\r\n        let x3 = 0, y3 = y2;\r\n\r\n        g.save();\r\n        g.translate(x3, y3);\r\n        g.rotate(Math.PI/2);\r\n        g.translate(x3 - tsize, -y3 - tsize*0.5);\r\n      }\r\n\r\n      if (tab.icon !== undefined) {\r\n        iconmanager.canvasDraw(this, this.canvas, g, tab.icon, x, y, this.iconsheet);\r\n        x2 += iconsize + 4;\r\n      }\r\n\r\n      draw_text(tab.name, x2, y2);\r\n\r\n      if (!this.horiz) {\r\n        g.restore();\r\n      }\r\n\r\n      let prev = this.tabs[Math.max(ti - 1 + this.tabs.length, 0)];\r\n      let next = this.tabs[Math.min(ti + 1, this.tabs.length - 1)];\r\n\r\n      if (tab !== this.tabs[this.tabs.length - 1] && prev !== this.tabs.active && next !== this.tabs.active) {\r\n        g.beginPath();\r\n        if (this.horiz) {\r\n          g.moveTo(x + w, h - 5);\r\n          g.lineTo(x + w, 5);\r\n        } else {\r\n          g.moveTo(w - 5, y + h);\r\n          g.lineTo(5, y + h);\r\n        }\r\n        g.strokeStyle = this.getDefault(\"TabStrokeStyle1\");\r\n        g.stroke();\r\n      }\r\n    }\r\n\r\n    let th = tsize;\r\n\r\n    //draw active tab\r\n    tab = this.tabs.active;\r\n    if (tab) {\r\n      let x = tab.pos[0], y = tab.pos[1];\r\n      let w = tab.size[0], h = tab.size[1];\r\n      //let tw = g.measureText(tab.name).width;\r\n      let tw = ui_base.measureText(this, tab.name, this.canvas, g, tsize, font).width;\r\n\r\n      if (this.horiz) {\r\n        h += 2;\r\n      } else {\r\n        w += 2;\r\n      }\r\n\r\n      let x2 = x + (tab.size[this.horiz ^ 1] - tw)*0.5;\r\n      let y2 = y + tsize;\r\n\r\n      if (tab === this.tabs.active) {\r\n        /*\r\n        let x = !this.horiz ? tab.y : tab.x;\r\n        let y = !this.horiz ? tab.x : tab.y;\r\n        let w = !this.horiz ? tab.size[1] : tab.size[0];\r\n        let h = !this.horiz ? tab.size[0] : tab.size[1];\r\n\r\n        if (!this.horiz) {\r\n          //g.save();\r\n          //g.translate(0, y);\r\n          //g.rotate(Math.PI/16);\r\n          //g.translate(0, -y);\r\n        }//*/\r\n\r\n        g.beginPath();\r\n        //g.lineWidth *= 5;\r\n        let ypad = 2;\r\n\r\n        g.strokeStyle = this.getDefault(\"TabStrokeStyle2\");\r\n        g.fillStyle = activecolor;\r\n        let r2 = r*1.5;\r\n\r\n        if (this.horiz) {\r\n          g.moveTo(x - r, h);\r\n          g.quadraticCurveTo(x, h, x, h - r);\r\n          g.lineTo(x, r2);\r\n          g.quadraticCurveTo(x, ypad, x + r2, ypad)\r\n          g.lineTo(x + w - r2, ypad);\r\n          g.quadraticCurveTo(x + w, 0, x + w, r2);\r\n          g.lineTo(x + w, h - r2);\r\n          g.quadraticCurveTo(x + w, h, x + w + r, h);\r\n\r\n          g.stroke()\r\n          //\r\n          g.closePath()\r\n        } else {\r\n          g.moveTo(w, y - r);\r\n          g.quadraticCurveTo(w, y, w - r, y);\r\n          ///*\r\n          g.lineTo(r2, y);\r\n          g.quadraticCurveTo(ypad, y, ypad, y + r2);\r\n          g.lineTo(ypad, y + h - r2);\r\n          g.quadraticCurveTo(0, y + h, r2, y + h);\r\n          g.lineTo(w - r2, y + h);\r\n          g.quadraticCurveTo(w, y + h, w, y + h + r);\r\n          //*/\r\n          g.stroke()\r\n          //\r\n          g.closePath()\r\n        }\r\n\r\n        let cw = this.horiz ? this.canvas.width : this.canvas.height;\r\n\r\n        let worig = g.lineWidth;\r\n\r\n        g.lineWidth *= 0.5;\r\n\r\n        g.fill();\r\n        //g.stroke();\r\n\r\n        g.lineWidth = worig;\r\n\r\n        if (!this.horiz) {\r\n          let x3 = 0, y3 = y2;\r\n\r\n          g.save();\r\n          g.translate(x3, y3);\r\n          g.rotate(Math.PI/2);\r\n          g.translate(-x3 - tsize, -y3 - tsize*0.5);\r\n        }\r\n\r\n        g.fillStyle = this.getDefault(\"TabText\").color;\r\n\r\n        draw_text(tab.name, x2, y2);\r\n\r\n        if (!this.horiz) {\r\n          g.restore();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  removeTab(tab) {\r\n    this.tabs.remove(tab);\r\n    if (tab === this.tabs.active) {\r\n      this.tabs.active = this.tabs[0];\r\n    }\r\n\r\n    this._layout();\r\n    this._redraw();\r\n    this.setCSS();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS(false);\r\n\r\n    /* create a no stacking context */\r\n    this.style[\"contain\"] = \"layout\";\r\n\r\n    this.r = this.getDefault(\"TabBarRadius\", undefined, 8);\r\n\r\n    let r = this.r !== undefined ? this.r : 3;\r\n\r\n    this.style[\"touch-action\"] = \"none\";\r\n\r\n    this.canvas.style[\"background-color\"] = this.getDefault(\"TabInactive\");\r\n    this.canvas.style[\"border-radius\"] = r + \"px\";\r\n    //this.style[\"background-color\"] = this.getDefault(\"TabInactive\");\r\n  }\r\n\r\n  updateStyle() {\r\n    let key = \"\" + this.getDefault(\"background-color\");\r\n    key += this.getDefault(\"TabActive\");\r\n    key += this.getDefault(\"TabInactive\");\r\n    key += this.getDefault(\"TabBarRadius\");\r\n    key += this.getDefault(\"TabStrokeStyle1\");\r\n    key += this.getDefault(\"TabStrokeStyle2\");\r\n    key += this.getDefault(\"TabHighlight\");\r\n    key += JSON.stringify(this.getDefault(\"TabText\"));\r\n    key += this.tabFontScale;\r\n\r\n    if (key !== this._last_style_key) {\r\n      this._last_style_key = key;\r\n\r\n      this._layout();\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  update(force_update = false) {\r\n    let rect = this.getClientRects()[0];\r\n    if (rect) {\r\n      let key = Math.floor(rect.x*4.0) + \":\" + Math.floor(rect.y*4.0);\r\n      if (key !== this._last_p_key) {\r\n        this._last_p_key = key;\r\n\r\n        //console.log(\"tab bar autobuild\");\r\n        this._layout();\r\n      }\r\n    }\r\n    super.update();\r\n\r\n    this.updateStyle();\r\n    this.updatePos(force_update);\r\n    this.updateDPI(force_update);\r\n    this.updateCanvas(force_update);\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(TabBar);\r\n\r\nexport class TabContainer extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._last_style_key = \"\";\r\n\r\n    this.dataPrefix = \"\";\r\n\r\n    this.inherit_packflag = 0;\r\n    this.packflag = 0;\r\n\r\n    this.tabFontScale = 1.0;\r\n\r\n    this.tbar = UIBase.createElement(\"tabbar-x\");\r\n    this.tbar.parentWidget = this;\r\n    this.tbar.setAttribute(\"class\", \"_tbar_\" + this._id);\r\n    this.tbar.constructor.setDefault(this.tbar);\r\n    this.tbar.tabFontScale = this.tabFontScale;\r\n\r\n    this._remakeStyle();\r\n\r\n    this.tabs = {};\r\n\r\n    this._last_horiz = undefined;\r\n    this._last_bar_pos = undefined;\r\n    this._tab = undefined;\r\n\r\n    let div = document.createElement(\"div\");\r\n    div.setAttribute(\"class\", `_tab_${this._id}`);\r\n    div.appendChild(this.tbar);\r\n    this.shadow.appendChild(div);\r\n\r\n    this.tbar.parentWidget = this;\r\n\r\n    this.tbar.onselect = (e) => {\r\n      if (this.onselect) {\r\n        this.onselect(e);\r\n      }\r\n    };\r\n\r\n    this.tbar.onchange = (tab, event) => {\r\n      if (this._tab) {\r\n        HTMLElement.prototype.remove.call(this._tab);\r\n      }\r\n\r\n      this._tab = this.tabs[tab.id];\r\n      //this._tab = document.createElement(\"div\");\r\n      //this._tab.innerText = \"SDfdsfsdyay\";\r\n\r\n      this._tab.parentWidget = this;\r\n\r\n      //ensure we get full update convergence when switching\r\n      //tabs\r\n      for (let i = 0; i < 2; i++) {\r\n        this._tab.flushUpdate();\r\n      }\r\n\r\n      let div = document.createElement(\"div\");\r\n\r\n      this.tbar.setCSS.once(() => div.style[\"background-color\"] = this.getDefault(\"background-color\"), div);\r\n\r\n      div.setAttribute(\"class\", `_tab_${this._id}`);\r\n      div.appendChild(this._tab);\r\n\r\n      this.shadow.appendChild(div);\r\n\r\n      if (this.onchange) {\r\n        this.onchange(tab, event);\r\n      }\r\n    }\r\n  }\r\n\r\n  get movableTabs() {\r\n    let attr;\r\n\r\n    if (!this.hasAttribute(\"movable-tabs\")) {\r\n      attr = this.getDefault(\"movable-tabs\");\r\n\r\n      if (attr === undefined || attr === null) {\r\n        attr = \"true\";\r\n      }\r\n\r\n      if (typeof attr === \"boolean\" || typeof attr === \"number\") {\r\n        attr = attr ? \"true\" : \"false\";\r\n      }\r\n    } else {\r\n      attr = \"\" + this.getAttribute(\"movable-tabs\");\r\n    }\r\n\r\n    attr = attr.toLowerCase();\r\n\r\n    return attr === \"true\";\r\n  }\r\n\r\n  set movableTabs(val) {\r\n    val = !!val;\r\n\r\n    this.setAttribute(\"movable-tabs\", val ? \"true\" : \"false\");\r\n    this.tbar.movableTabs = this.movableTabs;\r\n  }\r\n\r\n  get hideScrollBars() {\r\n    let attr = (\"\" + this.getAttribute(\"hide-scrollbars\")).toLowerCase();\r\n    return attr === \"true\" || attr === \"yes\";\r\n  }\r\n\r\n  set hideScrollBars(val) {\r\n    val = !!val;\r\n\r\n    this.setAttribute(\"hide-scrollbars\", \"\" + val);\r\n  }\r\n\r\n  static setDefault(e) {\r\n    e.setAttribute(\"bar_pos\", \"top\");\r\n\r\n    return e;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"tabcontainer-x\",\r\n      style  : \"tabs\"\r\n    };\r\n  }\r\n\r\n  _startMove(tab = this.tbar.tabs.active, event) {\r\n    return this.tbar._startMove(tab, event);\r\n  }\r\n\r\n  _ensureNoModal() {\r\n    return this.tbar._ensureNoModal();\r\n  }\r\n\r\n  saveData() {\r\n    let json = super.saveData() || {};\r\n    json.tabs = {};\r\n\r\n    for (let k in this.tabs) {\r\n      let tab = this.tabs[k];\r\n\r\n      if (k === this.tbar.tabs.active.id) {\r\n        //no need to save active tab here\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        json.tabs[tab.id] = JSON.parse(saveUIData(tab, \"tab\"));\r\n      } catch (error) {\r\n        console.error(\"Failed to save tab UI layout\", tab.id);\r\n      }\r\n    }\r\n\r\n    return json;\r\n  }\r\n\r\n  loadData(json) {\r\n    if (!json.tabs) {\r\n      return;\r\n    }\r\n\r\n    for (let k in json.tabs) {\r\n      if (!(k in this.tabs)) {\r\n        continue;\r\n      }\r\n\r\n      let uidata = JSON.stringify(json.tabs[k]);\r\n      loadUIData(this.tabs[k], uidata);\r\n    }\r\n  }\r\n\r\n  enableDrag() {\r\n    this.tbar.draggable = this.draggable = true;\r\n    this.tbar.addEventListener(\"dragstart\", (e) => {\r\n      this.dispatchEvent(new DragEvent(\"dragstart\", e));\r\n    });\r\n    this.tbar.addEventListener(\"dragover\", (e) => {\r\n      this.dispatchEvent(new DragEvent(\"dragover\", e));\r\n    });\r\n    this.tbar.addEventListener(\"dragexit\", (e) => {\r\n      this.dispatchEvent(new DragEvent(\"dragexit\", e));\r\n    });\r\n    /*\r\n    let doms = [this, this.tbar, this.tbar.canvas];\r\n    for (let dom of doms) {\r\n      dom.setAttribute(\"draggable\", \"true\");\r\n      dom.draggable = true;\r\n\r\n      dom.addEventListener(\"dragstart\", (e) => {\r\n        console.log(\"drag start\", e);\r\n      });\r\n\r\n      dom.addEventListener(\"drag\", (e) => {\r\n        console.log(\"drag\", e);\r\n      });\r\n    }*/\r\n  }\r\n\r\n  clear() {\r\n    this.tbar.clear();\r\n    if (this._tab !== undefined) {\r\n      HTMLElement.prototype.remove.call(this._tab);\r\n      this._tab = undefined;\r\n    }\r\n\r\n    this.tabs = {};\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.background = this.getDefault(\"background-color\");\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.background = this.getDefault(\"background-color\");\r\n    this._remakeStyle();\r\n  }\r\n\r\n  _remakeStyle() {\r\n    let horiz = this.tbar.horiz;\r\n    let display = \"flex\";\r\n    let flexDir = !horiz ? \"row\" : \"column\";\r\n    let bgcolor = this.__background; //this.getDefault(\"background-color\");\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n      ._tab_${this._id} {\r\n        display : ${display};\r\n        flex-direction : ${flexDir};\r\n        margin : 0px;\r\n        padding : 0px;\r\n        align-self : flex-start;\r\n        ${!horiz ? \"vertical-align : top;\" : \"\"}\r\n      }\r\n      \r\n      ._tbar_${this._id} {\r\n        list-style-type : none;\r\n        align-self : flex-start;\r\n        background-color : ${bgcolor};\r\n        flex-direction : ${flexDir};\r\n        ${!horiz ? \"vertical-align : top;\" : \"\"}\r\n      }\r\n    `;\r\n\r\n    if (this._style)\r\n      this._style.remove();\r\n    this._style = style;\r\n\r\n    this.shadow.prepend(style);\r\n  }\r\n\r\n  icontab(icon, id, tooltip) {\r\n    let t = this.tab(\"\", id, tooltip);\r\n    t._tab.icon = icon;\r\n\r\n    return t;\r\n  }\r\n\r\n  removeTab(tab) {\r\n    let tab2 = tab._tab;\r\n    this.tbar.removeTab(tab2);\r\n    tab.remove();\r\n  }\r\n\r\n  tab(name, id = undefined, tooltip = undefined, movable = true) {\r\n    if (id === undefined) {\r\n      id = tab_idgen++;\r\n    }\r\n\r\n    let col = UIBase.createElement(\"colframe-x\");\r\n\r\n    this.tabs[id] = col;\r\n\r\n    col.dataPrefix = this.dataPrefix;\r\n\r\n    col.ctx = this.ctx;\r\n    col._tab = this.tbar.addTab(name, id, tooltip, movable);\r\n\r\n    col.inherit_packflag |= this.inherit_packflag;\r\n    col.packflag |= this.packflag;\r\n\r\n    //let cls = this.tbar.horiz ? ui.ColumnFrame : ui.RowFrame;\r\n\r\n    col.parentWidget = this;\r\n\r\n    if (col.ctx) {\r\n      col._init();\r\n    }\r\n\r\n    col.setCSS();\r\n\r\n    if (this._tab === undefined) {\r\n      this.setActive(col);\r\n    }\r\n\r\n    col.noSwitch = function () {\r\n      this._tab.noSwitch = true;\r\n      return this;\r\n    }\r\n\r\n    function defineTabEvent(key) {\r\n      key = \"on\" + key;\r\n\r\n      Object.defineProperty(col, key, {\r\n        get() {\r\n          return this._tab[key];\r\n        },\r\n        set(v) {\r\n          this._tab[key] = v;\r\n        }\r\n      });\r\n    }\r\n\r\n    defineTabEvent(\"tabclick\");\r\n    defineTabEvent(\"tabdragmove\");\r\n    defineTabEvent(\"tabdragstart\");\r\n    defineTabEvent(\"tabdragend\");\r\n\r\n    return col;\r\n  }\r\n\r\n  setActive(tab) {\r\n    if (typeof tab === \"string\") {\r\n      tab = this.getTab(tab);\r\n    }\r\n\r\n    if (!tab) {\r\n      return;\r\n    }\r\n\r\n    if (tab._tab !== this.tbar.tabs.active) {\r\n      this.tbar.setActive(tab._tab);\r\n    }\r\n  }\r\n\r\n  getTabCount() {\r\n    return this.tbar.tabs.length;\r\n  }\r\n\r\n  moveTab(tab, i) {\r\n    tab = tab._tab;\r\n\r\n    let tab2 = this.tbar.tabs[i];\r\n\r\n    if (tab !== tab2) {\r\n      this.tbar.swapTabs(tab, tab2);\r\n    }\r\n\r\n    this.tbar.setCSS();\r\n    this.tbar._layout();\r\n    this.tbar._redraw();\r\n  }\r\n\r\n  getTab(name_or_id) {\r\n    if (name_or_id in this.tabs) {\r\n      return this.tabs[name_or_id];\r\n    }\r\n\r\n    for (let k in this.tabs) {\r\n      let t = this.tabs[k];\r\n\r\n      if (t.name === name_or_id) {\r\n        return t;\r\n      }\r\n    }\r\n\r\n    throw new Error(\"Unknown tab \" + name_or_id);\r\n  }\r\n\r\n  updateBarPos() {\r\n    let barpos = this.getAttribute(\"bar_pos\");\r\n\r\n    if (barpos !== this._last_bar_pos) {\r\n      this.horiz = barpos === \"top\" || barpos === \"bottom\";\r\n      this._last_bar_pos = barpos;\r\n\r\n      this.tbar.setAttribute(\"bar_pos\", barpos);\r\n      this.tbar.update(true);\r\n      this.update();\r\n    }\r\n  }\r\n\r\n  updateHoriz() {\r\n    let horiz = this.tbar.horiz;\r\n\r\n    if (this._last_horiz !== horiz) {\r\n      this._last_horiz = horiz;\r\n      this._remakeStyle();\r\n    }\r\n  }\r\n\r\n  updateStyle() {\r\n    let key = \"\" + this.getDefault(\"background-color\");\r\n\r\n    if (key !== this._last_style_key) {\r\n      this._last_style_key = key;\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  getActive() {\r\n    return this.tbar.tabs.active;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.tbar.movableTabs = this.movableTabs;\r\n\r\n    if (this._tab !== undefined) {\r\n      this._tab.update();\r\n    }\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-direction\"] = !this.horiz ? \"row\" : \"column\";\r\n\r\n    this.tbar.tabFontScale = this.tabFontScale;\r\n\r\n    this.updateStyle();\r\n    this.updateHoriz();\r\n    this.updateBarPos();\r\n    this.tbar.update();\r\n\r\n    let act = this.tbar.tabs.active;\r\n\r\n    if (act && !this.hideScrollBars) {\r\n      let container = this.tabs[act.id];\r\n\r\n      //propegate overflow-y to tab container as a whole\r\n\r\n      if (container.hasAttribute(\"overflow-y\") && this.style[\"overflow-y\"] !== container.getAttribute(\"overflow-y\")) {\r\n        this.style[\"overflow-y\"] = container.getAttribute(\"overflow-y\");\r\n        //container.style[\"overflow-y\"] = \"unset\";\r\n      } else if (!container.hasAttribute(\"overflow-y\")) {\r\n        this.style[\"overflow-y\"] = this.getDefault(\"overflow-y\") || \"unset\";\r\n      }\r\n\r\n      if (container.hasAttribute(\"overflow\") && this.style[\"overflow\"] !== container.getAttribute(\"overflow\")) {\r\n        this.style[\"overflow\"] = container.getAttribute(\"overflow\");\r\n        //container.style[\"overflow-y\"] = \"unset\";\r\n      } else if (!container.hasAttribute(\"overflow\")) {\r\n        this.style[\"overflow\"] = this.getDefault(\"overflow\") || \"unset\";\r\n      }\r\n    } else if (this.hideScrollBars) {\r\n      this.style[\"overflow\"] = this.style[\"overflow-y\"] = \"unset\";\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(TabContainer);\r\n","//bind module to global var to get at it in console.\r\n//\r\n//note that require has an api for handling circular\r\n//module refs, in such cases do not use these vars.\r\n\r\nimport {Container} from \"../core/ui.js\";\r\n\r\nvar _ui = undefined;\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_curvewidget from './ui_curvewidget.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as ui_widgets from './ui_widgets.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\n\r\nlet PropFlags = toolprop.PropFlags;\r\nlet PropSubTypes = toolprop.PropSubTypes;\r\n\r\nlet EnumProperty = toolprop.EnumProperty;\r\n\r\nlet Vector2 = vectormath.Vector2,\r\n  UIBase = ui_base.UIBase,\r\n  PackFlags = ui_base.PackFlags,\r\n  PropTypes = toolprop.PropTypes;\r\n\r\n\r\nconst list = util.list;\r\n\r\nexport class TableRow extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.dom.remove();\r\n    this.dom = document.createElement(\"tr\");\r\n\r\n    //kind of dumb, but this.dom doesn't live within this element itself, bleh\r\n    //this.shadow.appendChild(this.dom);\r\n    this.dom.setAttribute(\"class\", \"containerx\");\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"tablerow-x\"\r\n  };}\r\n\r\n  _add(child) {\r\n    child.ctx = this.ctx;\r\n    child.parentWidget = this;\r\n\r\n    let td = document.createElement(\"td\");\r\n    td.appendChild(child);\r\n\r\n    this.dom.appendChild(td);\r\n    child.onadd();\r\n  }\r\n};\r\nUIBase.internalRegister(TableRow);\r\n\r\nexport class TableFrame extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.dom = document.createElement(\"table\");\r\n    this.shadow.appendChild(this.dom);\r\n    this.dom.setAttribute(\"class\", \"containerx\");\r\n\r\n    //this.dom.style[\"display\"] = \"block\";\r\n  }\r\n\r\n  update() {\r\n    //this.style[\"display\"] = \"inline-block\";\r\n    super.update();\r\n  }\r\n\r\n  _add(child) {\r\n    child.ctx = this.ctx;\r\n    child.parentWidget = this;\r\n    this.dom.appendChild(child);\r\n    child.onadd();\r\n  }\r\n\r\n  add(child) {\r\n    this._add(child);\r\n  }\r\n\r\n  row() {\r\n    let tr = document.createElement(\"tr\");\r\n    let cls = \"table-tr\";\r\n\r\n    tr.setAttribute(\"class\", cls);\r\n    this.dom.appendChild(tr);\r\n    let this2 = this;\r\n\r\n    function maketd() {\r\n      let td = document.createElement(\"td\");\r\n      tr.appendChild(td);\r\n\r\n      td.style[\"margin\"] = tr.style[\"margin\"];\r\n      td.style[\"padding\"] = tr.style[\"padding\"];\r\n\r\n      let container = UIBase.createElement(\"rowframe-x\");\r\n\r\n      container.ctx = this2.ctx;\r\n      container.parentWidget = this2;\r\n      container.setAttribute(\"class\", cls);\r\n\r\n      td.setAttribute(\"class\", cls);\r\n      td.appendChild(container);\r\n\r\n      return container;\r\n    }\r\n\r\n    //hrm wish I could subclass html elements easier\r\n    let ret = {\r\n      _tr : tr,\r\n\r\n      style : tr.style,\r\n\r\n      focus : function(args) {\r\n        tr.focus(args);\r\n      },\r\n\r\n      blur : function(args) {\r\n        tr.blur(args);\r\n      },\r\n\r\n      remove : () => {\r\n        tr.remove();\r\n      },\r\n\r\n      addEventListener : function(type, cb, arg) {\r\n        tr.addEventListener(type, cb, arg);\r\n      },\r\n\r\n      removeEventListener : function(type, cb, arg) {\r\n        tr.removeEventListener(type, cb, arg);\r\n      },\r\n\r\n      setAttribute : function(attr, val) {\r\n        if (attr == \"class\") {\r\n          cls = val;\r\n        }\r\n\r\n        tr.setAttribute(attr, val);\r\n      },\r\n\r\n      scrollTo : function() {\r\n        return this._tr.scrollTo(...arguments);\r\n      },\r\n\r\n      scrollIntoView : function() {\r\n        return this._tr.scrollIntoView(...arguments);\r\n      },\r\n\r\n      clear : function() {\r\n        for (let node of list(tr.childNodes)) {\r\n          tr.removeChild(node);\r\n        }\r\n      }\r\n    };\r\n\r\n    function makefunc(f) {\r\n      ret[f] = function() {\r\n        let container = maketd();\r\n\r\n        container.background = tr.style[\"background-color\"]; //\"rgba(0,0,0,0)\";\r\n        return container[f].apply(container, arguments);\r\n      }\r\n    }\r\n\r\n    let _bg = \"\";\r\n\r\n    //need to implement proper proxy here!\r\n    Object.defineProperty(ret, \"tabIndex\", {\r\n      set : function(f) {\r\n        tr.tabIndex = f;\r\n      },\r\n\r\n      get : function(f) {\r\n        return tr.tabIndex;\r\n      }\r\n    });\r\n\r\n    Object.defineProperty(ret, \"background\", {\r\n      set : function(bg) {\r\n        _bg = bg;\r\n        tr.style[\"background-color\"] = bg;\r\n\r\n        for (let node of tr.childNodes) {\r\n          if (node.childNodes.length > 0) {\r\n            node.childNodes[0].background = bg;\r\n            node.style[\"background-color\"] = bg;\r\n          }\r\n        }\r\n      }, get : function() {\r\n        return _bg;\r\n      }\r\n    });\r\n\r\n    /*\r\n    Object.defineProperty(ret, \"class\", {\r\n      set(bg) {\r\n        tr.class = bg;\r\n      }\r\n    });//*/\r\n\r\n    ret.cell = () => {\r\n      let container = maketd();\r\n      container.background = tr.style[\"background-color\"];\r\n      return container;\r\n    };\r\n    \r\n    //makefunc(\"cell\");\r\n    makefunc(\"label\");\r\n    makefunc(\"tool\");\r\n    makefunc(\"prop\");\r\n    makefunc(\"pathlabel\");\r\n    makefunc(\"button\");\r\n    makefunc(\"iconbutton\");\r\n    makefunc(\"textbox\");\r\n    makefunc(\"col\");\r\n    makefunc(\"row\");\r\n    makefunc(\"table\");\r\n    makefunc(\"listenum\");\r\n    makefunc(\"check\");\r\n\r\n    return ret;\r\n  }\r\n\r\n  clear() {\r\n    super.clear();\r\n    for (let child of list(this.dom.childNodes)) {\r\n      child.remove();\r\n    }\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"tableframe-x\"\r\n  };}\r\n}\r\nUIBase.internalRegister(TableFrame);\r\n\r\n","\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as simple_toolsys from '../path-controller/toolsys/toolsys.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\n\r\nimport {TableFrame} from './ui_table.js';\r\nimport {Container, ColumnFrame, RowFrame} from '../core/ui.js';\r\nimport {keymap} from '../path-controller/util/events.js';\r\n\r\nlet EnumProperty = toolprop.EnumProperty,\r\n    PropTypes    = toolprop.PropTypes;\r\n\r\nlet UIBase     = ui_base.UIBase,\r\n    PackFlags  = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nfunction getpx(css) {\r\n  return parseFloat(css.trim().replace(\"px\", \"\"))\r\n}\r\n\r\nclass ListItem extends RowFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    let highlight = () => {\r\n      //console.log(\"listitem mouseover\");\r\n      this.highlight = true;\r\n      this.setBackground();\r\n    };\r\n\r\n    let unhighlight = () => {\r\n      //console.log(\"listitem mouseleave\");\r\n      this.highlight = false;\r\n      this.setBackground();\r\n    };\r\n\r\n    this.addEventListener(\"mouseover\", highlight);\r\n    this.addEventListener(\"mousein\", highlight);\r\n\r\n    this.addEventListener(\"mouseleave\", unhighlight);\r\n    this.addEventListener(\"mouseout\", unhighlight);\r\n    this.addEventListener(\"blur\", unhighlight);\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n      .listitem {\r\n        -moz-user-focus: normal;\r\n        moz-user-focus: normal;\r\n        user-focus: normal;\r\n      }\r\n    `;\r\n\r\n    this.shadowRoot.prepend(style);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"listitem-x\",\r\n      style  : \"listbox\"\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.setAttribute(\"class\", \"listitem\");\r\n\r\n    this.style[\"width\"] = \"100%\";\r\n    this.style[\"height\"] = this.getDefault(\"ItemHeight\") + \"px\";\r\n    this.style[\"flex-grow\"] = \"unset\";\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  setBackground() {\r\n    if (this.highlight && this.is_active) {\r\n      this.background = this.getDefault(\"ListActiveHighlight\");\r\n    } else if (this.highlight) {\r\n      this.background = this.getDefault(\"ListHighlight\");\r\n    } else if (this.is_active) {\r\n      this.background = this.getDefault(\"ListActive\");\r\n    } else {\r\n      this.background = this.getDefault(\"background-color\");\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.setBackground();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ListItem);\r\n\r\nclass ListBox extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.items = [];\r\n    this.idmap = {};\r\n    this.items.active = undefined;\r\n    this.highlight = false;\r\n    this.is_active = false;\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n      .listbox {\r\n        -moz-user-focus: normal;\r\n        moz-user-focus: normal;\r\n        user-focus: normal;\r\n      }\r\n    `;\r\n    this.shadow.prepend(style);\r\n\r\n    this.onkeydown = (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Up\"]:\r\n        case keymap[\"Down\"]:\r\n          if (this.items.length == 0)\r\n            return;\r\n\r\n          if (this.items.active === undefined) {\r\n            this.setActive(this.items[0]);\r\n            return;\r\n          }\r\n\r\n          let i = this.items.indexOf(this.items.active);\r\n          let dir = e.keyCode == keymap[\"Up\"] ? -1 : 1;\r\n\r\n          i = Math.max(Math.min(i + dir, this.items.length - 1), 0);\r\n          this.setActive(this.items[i]);\r\n\r\n          break;\r\n      }\r\n    };\r\n\r\n    //this.addEventListener(\"keydown\", on_keydown);\r\n\r\n    //this._table =  this.table();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"listbox-x\",\r\n      style  : \"listbox\"\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.setCSS();\r\n\r\n    this.style[\"width\"] = this.getDefault(\"width\") + \"px\";\r\n    this.style[\"height\"] = this.getDefault(\"height\") + \"px\";\r\n    this.style[\"overflow\"] = \"scroll\";\r\n\r\n    //this.setAttribute(\"class\", \"listbox\");\r\n    //this.setAttribute(\"tabindex\", 0);\r\n    //this.tabIndex = 0;\r\n  }\r\n\r\n  addItem(name, id) {\r\n    let item = UIBase.createElement(\"listitem-x\");\r\n\r\n    item._id = id === undefined ? this.items.length : id;\r\n    this.idmap[item._id] = item;\r\n\r\n    //item.addEventListener(\"keydown\", this.onkeydown);\r\n    this.tabIndex = 1;\r\n    this.setAttribute(\"tabindex\", 1);\r\n\r\n    this.add(item);\r\n    this.items.push(item);\r\n\r\n    item.label(name);\r\n    let this2 = this;\r\n\r\n    item.onclick = function () {\r\n      this2.setActive(this);\r\n      this.setBackground();\r\n    };\r\n\r\n    return item;\r\n  }\r\n\r\n  removeItem(item) {\r\n    if (typeof item == \"number\") {\r\n      item = this.idmap[item];\r\n    }\r\n\r\n    item.remove();\r\n    delete this.idmap[item._id];\r\n    this.items.remove(item);\r\n  }\r\n\r\n  setActive(item) {\r\n    if (typeof item == \"number\") {\r\n      item = this.idmap[item];\r\n    }\r\n\r\n    //console.log(\"set active!\");\r\n\r\n    if (item === this.items.active) {\r\n      return;\r\n    }\r\n\r\n    if (this.items.active !== undefined) {\r\n      this.items.active.highlight = false;\r\n      this.items.active.is_active = false;\r\n      this.items.active.setBackground();\r\n    }\r\n\r\n    this.items.active = item;\r\n\r\n    if (item) {\r\n      item.is_active = true;\r\n\r\n      item.setBackground();\r\n      item.scrollIntoViewIfNeeded();\r\n    }\r\n\r\n    if (this.onchange) {\r\n      this.onchange(item ? item._id : undefined, item);\r\n    }\r\n  }\r\n\r\n  clear() {\r\n\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ListBox);\r\n","import {UIBase} from '../core/ui_base.js';\r\nimport * as util from '../path-controller/util/util.js';\r\nimport {keymap} from '../path-controller/util/simple_events.js';\r\n\r\nexport class ProgressCircle extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.g = this.canvas.getContext(\"2d\");\r\n\r\n    this.shadow.appendChild(this.canvas);\r\n    this.size = 150;\r\n    this.animreq = undefined;\r\n    this._value = 0.0;\r\n    this.startTime = util.time_ms();\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this.flagRedraw();\r\n    this.update();\r\n\r\n    //enable keyboard focus\r\n    this.tabIndex = 0;\r\n    this.setAttribute(\"tab-index\", 0);\r\n    this.setAttribute(\"tabindex\", 0);\r\n\r\n    let onkey = (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Escape\"]:\r\n          if (this.oncancel) {\r\n            this.oncancel(this);\r\n          }\r\n          break;\r\n      }\r\n    }\r\n\r\n    this.addEventListener(\"keydown\", onkey);\r\n    this.canvas.addEventListener(\"keydown\", onkey);\r\n  }\r\n\r\n  flagRedraw() {\r\n    if (this.animreq !== undefined) {\r\n      return;\r\n    }\r\n\r\n    this.animreq = requestAnimationFrame(() => {\r\n      this.animreq = undefined;\r\n      this.draw();\r\n    })\r\n  }\r\n\r\n  draw() {\r\n    let c = this.canvas, g = this.g;\r\n\r\n    let clr1 = \"rgb(68,69,83)\";\r\n    let clr2 = \"rgb(141,154,196)\";\r\n    let clr3 = \"rgb(214,110,54)\";\r\n\r\n    let t = (util.time_ms() - this.startTime) / 1000.0;\r\n\r\n    g.save();\r\n    g.clearRect(0, 0, c.width, c.height);\r\n\r\n    g.lineWidth /= c.width*0.5;\r\n    g.scale(c.width, c.height);\r\n    g.translate(0.5, 0.5);\r\n\r\n    g.fillStyle = clr2;\r\n    g.strokeStyle = clr1;\r\n\r\n    g.beginPath();\r\n    g.moveTo(0, 0);\r\n    g.arc(0, 0, 0.45, Math.PI, -Math.PI);\r\n    //g.closePath()\r\n\r\n    g.moveTo(0, 0);\r\n    g.arc(0, 0, 0.2, Math.PI, -Math.PI);\r\n    //g.closePath()\r\n\r\n    g.clip(\"evenodd\");\r\n\r\n    g.beginPath();\r\n    g.arc(0, 0, 0.45, -Math.PI, Math.PI);\r\n    g.fill();\r\n    g.stroke();\r\n\r\n    g.beginPath();\r\n    g.arc(0, 0, 0.2, Math.PI, -Math.PI);\r\n    g.stroke();\r\n\r\n    g.beginPath();\r\n\r\n    let th = this._value*Math.PI*2.0;\r\n\r\n    let steps = 12;\r\n    let dth = (Math.PI*2.0) / steps;\r\n    let lwid = g.lineWidth;\r\n    g.lineWidth *= 3;\r\n\r\n    for (let i=0; i<steps; i++) {\r\n      let th1 = i * dth;\r\n      th1 += t;\r\n\r\n      let r1 = 0.2;\r\n      let r2 = 0.45;\r\n      let th2 = th1 + dth*0.5;\r\n\r\n      g.beginPath();\r\n      g.moveTo(Math.cos(th1)*r1, Math.sin(th1)*r1);\r\n      g.lineTo(Math.cos(th2)*r2, Math.sin(th2)*r2);\r\n      g.strokeStyle = \"rgba(255,255,255,0.5)\";\r\n      g.stroke();\r\n    }\r\n\r\n    g.lineWidth = lwid;\r\n\r\n    g.beginPath();\r\n    g.moveTo(0, 0);\r\n    g.arc(0, 0, 0.4, Math.PI, -Math.PI);\r\n    //g.closePath()\r\n\r\n    g.clip(\"evenodd\");\r\n\r\n    g.beginPath();\r\n    g.fillStyle = clr3;\r\n    g.moveTo(0, 0);\r\n    g.arc(0, 0, 0.45, 0, th);\r\n    g.lineTo(0, 0);\r\n    g.fill();\r\n\r\n    g.strokeStyle = \"rgb(141,154,196)\";\r\n    g.stroke();\r\n\r\n    g.restore();\r\n  }\r\n\r\n  set value(percent) {\r\n    this._value = percent;\r\n    this.flagRedraw();\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  startTimer() {\r\n    if (this.timer !== undefined) {\r\n      return;\r\n    }\r\n\r\n    this.focus();\r\n\r\n    window.setInterval(() => {\r\n      if (!this.isConnected) {\r\n        this.endTimer();\r\n        return;\r\n      }\r\n\r\n      this.flagRedraw();\r\n    }, 50);\r\n  }\r\n\r\n  endTimer() {\r\n    if (this.timer !== undefined) {\r\n      window.clearInterval(this.timer);\r\n    }\r\n    this.timer = undefined;\r\n  }\r\n\r\n  update() {\r\n    if (!this.isConnected && this.timer) {\r\n      this.endTimer();\r\n    }\r\n\r\n    let size = ~~(this.size*UIBase.getDPI());\r\n\r\n    if (size !== this.canvas.width) {\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    let c = this.canvas;\r\n\r\n    let size = ~~(this.size*UIBase.getDPI());\r\n\r\n    if (c.width !== size) {\r\n      c.width = c.height = size;\r\n\r\n      size /= UIBase.getDPI();\r\n      c.style[\"width\"] = size + \"px\";\r\n      c.style[\"height\"] = size + \"px\";\r\n\r\n      c.style[\"display\"] = \"flex\";\r\n\r\n      this.style[\"width\"] = size + \"px\";\r\n      this.style[\"height\"] = size + \"px\";\r\n\r\n      //forcibly redraw in this case, do not queue with flagRedraw\r\n      this.draw();\r\n    }\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"align-items\"] = \"center\";\r\n    this.style[\"justify-content\"] = \"center\";\r\n    this.style[\"width\"] = \"100%\";\r\n    this.style[\"height\"] = \"100%\";\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname : \"progress-circle-x\"\r\n    }\r\n  }\r\n}\r\nUIBase.register(ProgressCircle);\r\n","import {PackFlags, UIBase} from \"../core/ui_base.js\";\r\nimport {ColumnFrame} from \"../core/ui.js\";\r\nimport {PropTypes, PropFlags} from \"../path-controller/toolsys/toolprop.js\";\r\n\r\nimport {UndoFlags, ToolFlags} from \"../path-controller/toolsys/toolsys.js\";\r\nimport {DataPath, DataTypes} from \"../path-controller/controller/controller.js\";\r\n\r\nimport {ToolProperty} from '../path-controller/toolsys/toolprop.js';\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport cconst from '../config/const.js';\r\n\r\nconst LastKey = Symbol(\"LastToolPanelId\");\r\nlet tool_idgen = 0;\r\n\r\nexport function getLastToolStruct(ctx) {\r\n  let ret = ctx.state._last_tool;\r\n\r\n  if (!ret) {\r\n    ret = ctx.toolstack.head;\r\n  } else {\r\n    let msg = \"Passing the last tool to last-tool-panel via appstate._last_tool is deprecated;\";\r\n    msg += \"\\nctx.toolstack.head is now used instead.\";\r\n\r\n    console.warn(msg);\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nconst last_tool_eventmap = [];\r\n//window.last_tool_eventmap = last_tool_eventmap;\r\n\r\n/* Try to avoid memory leaks when last tool panels are hidden. */\r\nwindow.setInterval(() => {\r\n  for (const entry of last_tool_eventmap) {\r\n    const panel = entry.panel;\r\n    if (!panel.isConnected || panel.hidden) {\r\n      if (window.DEBUG && window.DEBUG.lastToolPanel) {\r\n        console.log(\"Disconnecting last tool panel from toolstack.\");\r\n      }\r\n\r\n      panel.unlinkEvents();\r\n      panel.needsRebuild = true;\r\n      break;\r\n    }\r\n  }\r\n}, 500);\r\n\r\n/*\r\n*\r\n* This panel shows the most recently executed ToolOp's\r\n* settings.  It assumes that recent toolops are accessible\r\n* in ctx.last_tool.\r\n* */\r\nexport class LastToolPanel extends ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this.ignoreOnChange = false;\r\n    this.on_change = null;\r\n    this._tool_id = undefined;\r\n    this.useDataPathUndo = false;\r\n    this.needsRebuild = false;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.useDataPathUndo = false;\r\n    this.rebuild();\r\n  }\r\n\r\n  /** client code can subclass and override this method */\r\n  getToolStackHead(ctx) {\r\n    //don't process the root toolop\r\n    let bad = ctx.toolstack.length === 0 || ctx.toolstack.cur >= ctx.toolstack.length;\r\n    bad = bad || ctx.toolstack.cur < 0;\r\n    bad = bad || ctx.toolstack[ctx.toolstack.cur].undoflag & UndoFlags.IS_UNDO_ROOT;\r\n\r\n    if (bad) {\r\n      return undefined;\r\n    }\r\n\r\n    return ctx.toolstack[ctx.toolstack.cur];\r\n  }\r\n\r\n  rebuild() {\r\n    let ctx = this.ctx;\r\n    if (ctx === undefined) {\r\n      this._tool_id = -1; //wait for .ctx\r\n      return;\r\n    }\r\n\r\n    this.needsRebuild = false;\r\n\r\n    this.clear();\r\n\r\n    this.label(\"Recent Command Settings\");\r\n\r\n    let tool = this.getToolStackHead(ctx);\r\n\r\n    if (!tool) {\r\n      this.setCSS();\r\n      return;\r\n    }\r\n\r\n    let def = tool.constructor.tooldef();\r\n    let name = def.uiname !== undefined ? def.uiname : def.name;\r\n\r\n    let panel = this.panel(def.uiname);\r\n\r\n    this.on_change = () => {\r\n      if (this.ignoreOnChange) {\r\n        return;\r\n      }\r\n\r\n      if (tool.modalRunning) {\r\n        return;\r\n      }\r\n\r\n      if (tool === ctx.toolstack.head) {\r\n        this.ignoreOnChange = true;\r\n        ctx.toolstack.rerun(tool);\r\n        this.ignoreOnChange = false;\r\n      } else {\r\n        this.unlinkEvents();\r\n      }\r\n    };\r\n\r\n    this.buildTool(ctx, tool, panel);\r\n    this.flushUpdate();\r\n    this.flushUpdate();\r\n  }\r\n\r\n  unlinkEvents() {\r\n    for (const entry of Array.from(last_tool_eventmap)) {\r\n      if (entry.panel === this || !entry.panel.isConnected) {\r\n        entry.prop.off(\"change\", entry.cb);\r\n        last_tool_eventmap.remove(entry);\r\n\r\n        if (entry.panel !== this) {\r\n          entry.panel.needsRebuild = true;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /** client code can subclass and override this method */\r\n  buildTool(ctx, tool, panel) {\r\n    if (tool.flag & ToolFlags.PRIVATE) {\r\n      return;\r\n    }\r\n\r\n    this.unlinkEvents();\r\n    this.last_tool = tool;\r\n\r\n    panel.useDataPathUndo = false;\r\n    for (let k in tool.inputs) {\r\n      let prop = tool.inputs[k];\r\n\r\n      if (prop.flag & (PropFlags.PRIVATE | PropFlags.READ_ONLY)) {\r\n        continue;\r\n      }\r\n\r\n      prop.on(\"change\", this.on_change);\r\n      last_tool_eventmap.push({\r\n        panel: this,\r\n        cb   : this.on_change,\r\n        prop\r\n      })\r\n\r\n      let path = `last_tool.${k}`;\r\n      let uiname = prop.uiname ?? ToolProperty.makeUIName(k);\r\n\r\n      panel.label(uiname);\r\n      let packflag = 0;\r\n\r\n      /* Default to roller number sliders. */\r\n      if (!(prop.flag & PropFlags.SIMPLE_SLIDER)) {\r\n        packflag |= PackFlags.FORCE_ROLLER_SLIDER;\r\n      }\r\n\r\n      let ret = panel.prop(path, packflag);\r\n\r\n      if (ret) {\r\n        //ret.onchange = function() {\r\n        //ctx.toolstack.rerun(tool);\r\n        //}\r\n      }\r\n    }\r\n    this.setCSS();\r\n\r\n    //console.log(\"Building last tool settings\");\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n    let ctx = this.ctx;\r\n\r\n    if (!ctx) {\r\n      return;\r\n    }\r\n\r\n    let tool = this.getToolStackHead(ctx);\r\n\r\n    this.needsRebuild |= tool && (!(LastKey in tool) || tool[LastKey] !== this._tool_id);\r\n\r\n    if (this.needsRebuild) {\r\n      tool[LastKey] = tool_idgen++;\r\n      this._tool_id = tool[LastKey];\r\n\r\n      this.rebuild();\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"last-tool-panel-x\"\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(LastToolPanel);\r\n","export const mimeMap = {\r\n  \".js\"  : \"application/javascript\",\r\n  \".json\": \"text/json\",\r\n  \".html\": \"text/html\",\r\n  \".txt\" : \"text/plain\",\r\n  \".jpg\" : \"image/jpeg\",\r\n  \".png\" : \"image/png\",\r\n  \".tiff\": \"image/tiff\",\r\n  \".gif\" : \"image/gif\",\r\n  \".bmp\" : \"image/bitmap\",\r\n  \".tga\" : \"image/targa\",\r\n  \".svg\" : \"image/svg+xml\",\r\n  \".xml\" : \"text/xml\",\r\n  \".webp\": \"image/webp\",\r\n  \"svg\"  : \"image/svg+xml\",\r\n  \"txt\"  : \"text/plain\",\r\n  \"html\" : \"text/html\",\r\n  \"css\"  : \"text/css\",\r\n  \"ts\"   : \"application/typescript\",\r\n  \"py\"   : \"application/python\",\r\n  \"c\"    : \"application/c\",\r\n  \"cpp\"  : \"application/cpp\",\r\n  \"cc\"   : \"application/cpp\",\r\n  \"h\"    : \"application/c\",\r\n  \"hh\"   : \"application/cpp\",\r\n  \"hpp\"  : \"application/cpp\",\r\n  \"sh\"   : \"application/bash\",\r\n  \"mjs\"  : \"application/javascript\",\r\n  \"cjs\"  : \"application/javascript\",\r\n  \"gif\"  : \"image/gif\"\r\n};\r\n\r\nexport var textMimes = new Set([\r\n  \"application/javascript\", \"application/x-javscript\",\r\n  \"image/svg+xml\", \"application/xml\"\r\n]);\r\n\r\nexport function isMimeText(mime) {\r\n  if (!mime) {\r\n    return false;\r\n  }\r\n\r\n  if (mime.startsWith(\"text\")) {\r\n    return true;\r\n  }\r\n\r\n  return textMimes.has(mime);\r\n}\r\n\r\nexport function getExtension(path) {\r\n  if (!path) {\r\n    return \"\";\r\n  }\r\n\r\n  let i = path.length;\r\n  while (i > 0 && path[i] !== \".\") {\r\n    i--;\r\n  }\r\n\r\n  return path.slice(i, path.length).trim().toLowerCase();\r\n}\r\n\r\nexport function getMime(path) {\r\n  let ext = getExtension(path);\r\n  if (ext in mimeMap) {\r\n    return mimeMap[ext];\r\n  }\r\n\r\n  return \"application/x-octet-stream\";\r\n}\r\n\r\nexport class PlatformAPI {\r\n  static writeFile(data, handle, mime) {\r\n    throw new Error(\"implement me\");\r\n    //returns a promise\r\n  }\r\n\r\n  static resolveURL(path, base = location.href) {\r\n    base = base.trim();\r\n\r\n    if (path.startsWith(\"./\")) {\r\n      path = path.slice(2, path.length).trim();\r\n    }\r\n\r\n    while (path.startsWith(\"/\")) {\r\n      path = path.slice(1, path.length).trim();\r\n    }\r\n\r\n    while (base.endsWith(\"/\")) {\r\n      base = base.slice(0, base.length - 1).trim();\r\n    }\r\n\r\n    let exts = [\"html\", \"txt\", \"js\", \"php\", \"cgi\"]\r\n    for (let ext of exts) {\r\n      ext = \".\" + ext;\r\n      if (base.endsWith(ext)) {\r\n        let i = base.length - 1;\r\n        while (i > 0 && base[i] !== \"/\") {\r\n          i--;\r\n        }\r\n\r\n        base = base.slice(0, i).trim();\r\n      }\r\n    }\r\n\r\n    while (base.endsWith(\"/\")) {\r\n      base = base.slice(0, base.length - 1).trim();\r\n    }\r\n\r\n    path = (base + \"/\" + path).split(\"/\")\r\n    let path2 = [];\r\n\r\n    for (let i = 0; i < path.length; i++) {\r\n      if (path[i] === \"..\") {\r\n        path2.pop();\r\n      } else {\r\n        path2.push(path[i]);\r\n      }\r\n    }\r\n\r\n    return path2.join(\"/\");\r\n  }\r\n\r\n  //returns a promise that resolves to a FilePath that can be used for re-saving.\r\n  static showOpenDialog(title, args = new FileDialogArgs()) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  //returns a promise\r\n  static showSaveDialog(title, savedata_cb, args = new FileDialogArgs()) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  //returns a promise.  if mime is a text type, a string will be fed to the promise,\r\n  //otherwise it will be an ArrayBuffer\r\n  static readFile(path, mime) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n}\r\n\r\nexport class FileDialogArgs {\r\n  constructor() {\r\n    this.multi = false; //allow selecting multiple files\r\n    this.addToRecentList = false; //update recent file list\r\n\r\n    /* example for filters:\r\n    [{\r\n      name : \"Images\",\r\n      mime : \"image/png\"\r\n      extensions : \"[\"png\", \"jpg\"]\r\n    }]\r\n    * */\r\n    this.filters = []\r\n  }\r\n}\r\n\r\n/*a file path, some platforms may not return real payhs*/\r\nexport class FilePath {\r\n  constructor(data, filename = \"unnamed\") {\r\n    this.data = data;\r\n    this.filename = filename;\r\n  }\r\n}\r\n","let promise;\r\n\r\nif (window.haveElectron) {\r\n  promise = import('./electron/electron_api.js');\r\n} else {\r\n  promise = import('./web/web_api.js');\r\n}\r\n\r\nexport var platform;\r\n\r\npromise.then((module) => {\r\n  platform = module.platform;\r\n  promise = undefined;\r\n});\r\n\r\nexport function getPlatformAsync() {\r\n  if (promise) {\r\n    return new Promise((accept, reject) => {\r\n      promise.then(mod => {\r\n        accept(mod.platform);\r\n      });\r\n    });\r\n  }\r\n\r\n  return new Promise((accept, reject) => {\r\n    accept(platform);\r\n  })\r\n}\r\n","\"use strict\";\r\n\r\nlet _nativeTheme;\r\n\r\nfunction getNativeTheme() {\r\n  if (_nativeTheme) {\r\n    return _nativeTheme;\r\n  }\r\n\r\n  let remote = getElectron().remote;\r\n  if (!remote) { /* Newer electron version with no remote, client must provide it */\r\n    ipcRenderer.invoke(\"nativeTheme\");\r\n  } else {\r\n    _nativeTheme = remote.nativeTheme;\r\n  }\r\n\r\n  return _nativeTheme;\r\n}\r\n\r\nfunction getElectronVersion() {\r\n  let key = navigator.userAgent;\r\n  let i = key.search(\"Electron\");\r\n  key = key.slice(i + 9, key.length);\r\n\r\n  i = key.search(/[ \\t]/);\r\n  if (i >= 0) {\r\n    key = key.slice(0, i);\r\n  }\r\n\r\n  key = key.trim();\r\n  key = key.split(\".\").map(f => parseInt(f));\r\n\r\n  return key;\r\n}\r\n\r\n/*\r\n* wrap require to keep angular from auto-importing\r\n* this api in browsers\r\n* */\r\nfunction getElectron() {\r\n  return require('electron');\r\n}\r\n\r\nfunction myRequire(mod) {\r\n  return globalThis.require(mod);\r\n}\r\n\r\nimport {Menu, DropBox} from '../../widgets/ui_menu.js';\r\nimport {getIconManager} from \"../../core/ui_base.js\";\r\nimport cconst from \"../../config/const.js\";\r\nimport * as util from '../../util/util.js';\r\n\r\nimport {FileDialogArgs, FilePath} from '../platform_base.js';\r\n\r\nfunction getFilename(path) {\r\n  let filename = path.replace(/\\\\/g, \"/\");\r\n  let i = filename.length - 1;\r\n  while (i >= 0 && filename[i] !== \"/\") {\r\n    i--;\r\n  }\r\n\r\n  if (filename[i] === \"/\") {\r\n    i++;\r\n  }\r\n\r\n  if (i > 0) {\r\n    filename = filename.slice(i, filename.length).trim();\r\n  }\r\n\r\n  return filename;\r\n}\r\n\r\nlet _menu_init = false;\r\nlet _init = false;\r\n\r\nimport {mimeMap} from '../platform_base.js';\r\n\r\nlet electron_menu_idgen = 1;\r\nlet ipcRenderer;\r\n\r\nexport class ElectronMenu extends Array {\r\n  constructor(args = {}) {\r\n    super();\r\n\r\n    this._ipcId = electron_menu_idgen++;\r\n\r\n    for (let k in args) {\r\n      this[k] = args[k];\r\n    }\r\n  }\r\n\r\n  insert(i, item) {\r\n    this.length++;\r\n\r\n    let j = this.length - 1;\r\n    while (j > i) {\r\n      this[j] = this[j - 1];\r\n      j--;\r\n    }\r\n    this[i] = item;\r\n\r\n    return this;\r\n  }\r\n\r\n  static setApplicationMenu(menu) {\r\n    initElectronIpc();\r\n\r\n    ipcRenderer.invoke(\"set-menu-bar\", menu);\r\n  }\r\n\r\n  closePopup() {\r\n    ipcRenderer.invoke(\"close-menu\", this._ipcId);\r\n  }\r\n\r\n  append(item) {\r\n    this.push(item);\r\n  }\r\n\r\n  popup(args) {\r\n    let {x, y, callback} = args;\r\n\r\n    callback = wrapRemoteCallback(\"popup_menu_click\", callback);\r\n\r\n    const {ipcRenderer} = require('electron')\r\n    ipcRenderer.invoke(\"popup-menu\", this, x, y, callback);\r\n  }\r\n}\r\n\r\nlet callbacks = {};\r\nlet keybase = 1;\r\n\r\nexport function wrapRemoteCallback(key, callback) {\r\n  key = \"remote_\" + key + (keybase++);\r\n  callbacks[key] = callback;\r\n\r\n  return key;\r\n}\r\n\r\nlet ipcInit = false;\r\n\r\nfunction initElectronIpc() {\r\n  if (ipcInit) {\r\n    return;\r\n  }\r\n\r\n  ipcInit = true;\r\n  ipcRenderer = require('electron').ipcRenderer;\r\n\r\n  ipcRenderer.on('invoke-menu-callback', (event, key, args) => {\r\n    //console.error(\"Electron menu callback\", key, args);\r\n    callbacks[key].apply(undefined, args);\r\n  });\r\n\r\n  ipcRenderer.on(\"nativeTheme\", (event, module) => {\r\n    _nativeTheme = Object.assign({}, module);\r\n    _nativeTheme._themeSource = _nativeTheme.themeSource;\r\n\r\n    Object.defineProperty(_nativeTheme, \"themeSource\", {\r\n      get() {\r\n        return this._themeSource;\r\n      },\r\n      set(v) {\r\n        ipcRenderer.invoke(\"nativeTheme.setThemeSource\", v);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n\r\nexport class ElectronMenuItem {\r\n  constructor(args) {\r\n    for (let k in args) {\r\n      this[k] = args[k];\r\n    }\r\n\r\n    if (this.click) {\r\n      this.click = wrapRemoteCallback(\"menu_click\", this.click);\r\n    }\r\n  }\r\n}\r\n\r\nfunction patchDropBox() {\r\n  initElectronIpc();\r\n\r\n  if (cconst.noElectronMenus) {\r\n    return;\r\n  }\r\n\r\n  //haveElectron = false;\r\n  //return;\r\n  DropBox.prototype._onpress = function _onpress(e) {\r\n    if (this._menu !== undefined) {\r\n      this._menu.close();\r\n      this._menu = undefined;\r\n      this._pressed = false;\r\n      this._redraw();\r\n      return;\r\n    }\r\n\r\n    this._build_menu();\r\n\r\n    let emenu = buildElectronMenu(this._menu);\r\n\r\n    this._menu.close = () => {\r\n      emenu.closePopup(); //getCurrentWindow);\r\n    };\r\n\r\n    //console.log(\"menu dropbox click\", this._menu);\r\n\r\n    if (this._menu === undefined) {\r\n      return;\r\n    }\r\n\r\n    this._menu._dropbox = this;\r\n    this.dom._background = this.getDefault(\"BoxDepressed\");\r\n    this._background = this.getDefault(\"BoxDepressed\");\r\n    this._redraw();\r\n    this._pressed = true;\r\n    this.setCSS();\r\n\r\n    let onclose = this._menu.onclose;\r\n    this._menu.onclose = () => {\r\n      this._pressed = false;\r\n      this._redraw();\r\n\r\n      let menu = this._menu;\r\n      if (menu) {\r\n        this._menu = undefined;\r\n        menu._dropbox = undefined;\r\n      }\r\n\r\n      if (onclose) {\r\n        onclose.call(menu);\r\n      }\r\n    }\r\n\r\n    let menu = this._menu;\r\n    let screen = this.getScreen();\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let x = e.x, y = e.y;\r\n    let rects = this.dom.getClientRects();\r\n\r\n    x = rects[0].x;\r\n    y = rects[0].y + Math.ceil(rects[0].height);\r\n\r\n    x = ~~x;\r\n    y = ~~y;\r\n\r\n    emenu.popup({\r\n      x       : x,\r\n      y       : y,\r\n      callback: () => {\r\n\r\n        if (this._menu) {\r\n          this._menu.onclose();\r\n        }\r\n      }\r\n    })\r\n  };\r\n}\r\n\r\nlet on_tick = () => {\r\n  let nativeTheme = getNativeTheme();\r\n\r\n  if (nativeTheme) {\r\n    let mode = nativeTheme.shouldUseDarkColors ? \"dark\" : \"light\";\r\n\r\n    if (mode !== cconst.colorSchemeType) {\r\n      nativeTheme.themeSource = cconst.colorSchemeType;\r\n    }\r\n  }\r\n}\r\n\r\nexport function checkInit() {\r\n  if (window.haveElectron && !_init) {\r\n    _init = true;\r\n\r\n\r\n    patchDropBox();\r\n    setInterval(on_tick, 350);\r\n  }\r\n}\r\n\r\nexport let iconcache = {};\r\n\r\nfunction makeIconKey(icon, iconsheet, invertColors) {\r\n  return \"\" + icon + \":\" + iconsheet + \":\" + invertColors;\r\n}\r\n\r\nexport function getNativeIcon(icon, iconsheet = 0, invertColors = false, size = 16) {\r\n  //let key = makeIconKey(icon, iconsheet, invertColors);\r\n  //if (key in iconcache) {\r\n  //  return iconcache[key];\r\n  //}\r\n\r\n  let icongen;\r\n\r\n  try {\r\n    icongen = myRequire(\"./icogen.js\");\r\n  } catch (error) {\r\n    icongen = myRequire(\"./icogen.cjs\");\r\n  }\r\n\r\n\r\n  window.icongen = icongen;\r\n  let nativeImage = getElectron().nativeImage;\r\n\r\n  let manager = getIconManager();\r\n  let sheet = manager.findSheet(iconsheet);\r\n  let images = [];\r\n\r\n  let sizes = icongen.GetRequiredICOImageSizes();\r\n\r\n  //for (let size of sizes) {\r\n  if (1) {\r\n    let iconsheet = manager.findClosestSheet(size);\r\n    let tilesize = manager.getTileSize(iconsheet);\r\n\r\n    let canvas = document.createElement(\"canvas\");\r\n    let g = canvas.getContext(\"2d\");\r\n\r\n    canvas.width = canvas.height = size;\r\n\r\n    if (invertColors) {\r\n      g.filter = \"invert(100%)\";\r\n    }\r\n\r\n    let scale = size/tilesize;\r\n    g.scale(scale, scale);\r\n\r\n    manager.canvasDraw({getDPI: () => 1.0}, canvas, g, icon, 0, 0, iconsheet);\r\n\r\n    let header = \"data:image/png;base64,\";\r\n    let data = canvas.toDataURL();\r\n\r\n    data = data.slice(header.length, data.length);\r\n    data = Buffer.from(data, \"base64\");\r\n\r\n    myRequire(\"fs\").writeFileSync(\"./myicon2.png\", data);\r\n\r\n    images.push(data);\r\n  }\r\n  //}\r\n\r\n  //let ico = icongen.GenerateICO(images);\r\n  //icon = nativeImage.createFromBuffer(ico);\r\n  //icon = nativeImage.createFromBitmap(ico);\r\n  //myRequire(\"fs\").writeFileSync(\"myicon2.ico\", ico);\r\n  return \"myicon2.png\"\r\n  return icon;\r\n  return undefined\r\n\r\n  window._icon = icon;\r\n  return icon;\r\n}\r\n\r\nlet map = {\r\n  CTRL   : \"Control\",\r\n  ALT    : \"Alt\",\r\n  SHIFT  : \"Shift\",\r\n  COMMAND: \"Command\"\r\n};\r\n\r\nexport function buildElectronHotkey(hk) {\r\n  hk = hk.trim().replace(/[ \\t-]+/g, \"+\");\r\n  for (let k in map) {\r\n    hk = hk.replace(k, map[k]);\r\n  }\r\n\r\n  return hk;\r\n}\r\n\r\nexport function buildElectronMenu(menu) {\r\n  let electron = getElectron().remote;\r\n\r\n  initElectronIpc();\r\n\r\n  //let ElectronMenu = electron.Menu;\r\n  //let ElectronMenuItem = electron.MenuItem;\r\n\r\n  let emenu = new ElectronMenu();\r\n\r\n  let buildItem = (item) => {\r\n    if (item._isMenu) {\r\n      let menu2 = item._menu;\r\n\r\n      return new ElectronMenuItem({\r\n        submenu: buildElectronMenu(item._menu),\r\n        label  : menu2.getAttribute(\"title\")\r\n      });\r\n    }\r\n\r\n\r\n    let hotkey = item.hotkey;\r\n    let icon = item.icon;\r\n    let label = \"\" + item.label;\r\n\r\n    if (hotkey && typeof hotkey !== \"string\") {\r\n      hotkey = buildElectronHotkey(hotkey);\r\n    } else {\r\n      hotkey = \"\" + hotkey;\r\n    }\r\n\r\n    if (icon < 0) {\r\n      icon = undefined;\r\n    }\r\n\r\n    let args = {\r\n      id                 : \"\" + item._id,\r\n      label              : label,\r\n      accelerator        : hotkey,\r\n      icon               : icon ? getNativeIcon(icon) : undefined,\r\n      click              : function () {\r\n        menu.onselect(item._id);\r\n      },\r\n      registerAccelerator: false\r\n    };\r\n\r\n    return new ElectronMenuItem(args);\r\n  }\r\n\r\n  for (let item of menu.items) {\r\n    //buildItem(item);\r\n    emenu.append(buildItem(item));\r\n\r\n  }\r\n\r\n  return emenu;\r\n}\r\n\r\nexport function initMenuBar(menuEditor, override = false) {\r\n  checkInit();\r\n\r\n  if (!window.haveElectron) {\r\n    return;\r\n  }\r\n\r\n  if (_menu_init && !override) {\r\n    return;\r\n  }\r\n\r\n  _menu_init = true;\r\n\r\n  //let win = electron.getCurrentWindow();\r\n\r\n  let menu = new ElectronMenu();\r\n\r\n  let _roles = new Set([\"undo\", \"redo\", \"cut\", \"copy\", \"paste\", \"delete\", \"about\",\r\n                        \"quit\", \"open\", \"save\", \"load\", \"paste\", \"cut\", \"zoom\"]);\r\n  let roles = {};\r\n  for (let k of _roles) {\r\n    roles[k] = k;\r\n  }\r\n\r\n  roles = Object.assign(roles, {\r\n    \"select all\": \"selectAll\",\r\n    \"file\"      : \"fileMenu\",\r\n    \"edit\"      : \"editMenu\",\r\n    \"view\"      : \"viewMenu\",\r\n    \"app\"       : \"appMenu\",\r\n    \"help\"      : \"help\",\r\n    \"zoom in\"   : \"zoomIn\",\r\n    \"zoom out\"  : \"zoomOut\"\r\n  });\r\n\r\n  /*\r\n  let item = new MenuItem({\r\n    label : \"Label\",\r\n    tooltip : \"Tooltip\",\r\n    icon : getNativeIcon(0),\r\n    accelerator : \"Control+Z\",\r\n    checked : true,\r\n    id : 0,\r\n    role : undefined,\r\n    click : (arg) => {\r\n      console.log(\"menu click!\", arg)\r\n    },\r\n    submenu : undefined,\r\n    role :  undo, redo, cut, copy, paste, pasteAndMatchStyle, delete, selectAll, reload,\r\n            forceReload, toggleDevTools, resetZoom, zoomIn, zoomOut, togglefullscreen, window,\r\n             minimize, close, help, about, services, hide, hideOthers, unhide, quit, startSpeaking,\r\n             stopSpeaking, close, minimize, zoom, front, appMenu, fileMenu, editMenu, viewMenu, recentDocuments,\r\n              toggleTabBar, selectNextTab, selectPreviousTab, mergeAllWindows, clearRecentDocuments, moveTabToNewWindow\r\n               or windowMenu - Define the action of the menu item, when specified the click property will be ignored.\r\n                See roles.\r\n\r\n  });//*/\r\n\r\n\r\n  let header = menuEditor.header;\r\n  for (let dbox of header.traverse(DropBox)) {\r\n    dbox._build_menu();\r\n    dbox.update();\r\n\r\n    dbox._build_menu();\r\n    let menu2 = dbox._menu;\r\n    menu2.ctx = dbox.ctx;\r\n    menu2._init();\r\n    menu2.update();\r\n\r\n    let title = dbox._genLabel();\r\n    let args = {\r\n      label  : title,\r\n      tooltip: dbox.description,\r\n      submenu: buildElectronMenu(menu2)\r\n    };\r\n\r\n    menu.insert(0, new ElectronMenuItem(args));\r\n  }\r\n\r\n\r\n  ElectronMenu.setApplicationMenu(menu);\r\n  //win.setMenu(menu);\r\n}\r\n\r\nimport {PlatformAPI, isMimeText} from '../platform_base.js';\r\n\r\nexport class platform extends PlatformAPI {\r\n  static showOpenDialog(title, args = new FileDialogArgs()) {\r\n    console.log(args.filters);\r\n\r\n    let eargs = {\r\n      defaultPath: args.defaultPath,\r\n      filters    : this._sanitizeFilters(args.filters ?? []),\r\n      properties : [\r\n        \"openFile\", \"showHiddenFiles\", \"createDirectory\"\r\n      ]\r\n    }\r\n\r\n    if (args.multi) {\r\n      eargs.properties.push(\"multiSelections\");\r\n    }\r\n\r\n    if (!args.addToRecentList) {\r\n      eargs.properties.push(\"dontAddToRecent\");\r\n    }\r\n\r\n    initElectronIpc();\r\n\r\n    return new Promise((accept, reject) => {\r\n      ipcRenderer.invoke('show-open-dialog', eargs, wrapRemoteCallback(\"open-dialog\", (ret) => {\r\n        if (ret.canceled || ret.cancelled) {\r\n          reject(\"cancel\");\r\n        } else {\r\n          accept(ret.filePaths.map(f => new FilePath(f, getFilename(f))));\r\n        }\r\n      }), wrapRemoteCallback(\"show-open-dialog\", (error) => {\r\n        reject(error);\r\n      }));\r\n    });\r\n  }\r\n\r\n  static _sanitizeFilters(filters) {\r\n    let filters2 = [];\r\n\r\n    for (let filter of filters) {\r\n      if (Array.isArray(filter)) {\r\n        let ext = filter[0];\r\n\r\n        filter = {extensions: filter};\r\n\r\n        ext = ext.replace(/\\./g, \"\").trim().toLowerCase();\r\n        if (ext in mimeMap) {\r\n          filter.mime = mimeMap[ext];\r\n        }\r\n\r\n        filter.name = ext;\r\n      }\r\n\r\n      console.log(filter.extensions);\r\n      filter.extensions = filter.extensions.map(f => f.startsWith(\".\") ? f.slice(1, f.length) : f);\r\n\r\n      filters2.push(filter);\r\n    }\r\n\r\n    return filters2;\r\n  }\r\n\r\n  static showSaveDialog(title, filedata_cb, args = new FileDialogArgs()) {\r\n    console.log(args.filters);\r\n\r\n    let eargs = {\r\n      defaultPath: args.defaultPath,\r\n      filters    : this._sanitizeFilters(args.filters ?? []),\r\n      properties : [\r\n        \"openFile\", \"showHiddenFiles\", \"createDirectory\"\r\n      ]\r\n    }\r\n\r\n    if (args.multi) {\r\n      eargs.properties.push(\"multiSelections\");\r\n    }\r\n\r\n    if (!args.addToRecentList) {\r\n      eargs.properties.push(\"dontAddToRecent\");\r\n    }\r\n\r\n    return new Promise((accept, reject) => {\r\n      initElectronIpc();\r\n\r\n      let onthen = (ret) => {\r\n        if (ret.canceled) {\r\n          reject(\"cancel\");\r\n        } else {\r\n          let path = ret.filePath;\r\n          let filedata = filedata_cb();\r\n\r\n          if (filedata instanceof ArrayBuffer) {\r\n            filedata = new Uint8Array(filedata);\r\n          }\r\n\r\n          require('fs').writeFileSync(path, filedata);\r\n          console.log(\"saved file\", filedata);\r\n\r\n          accept(new FilePath(path, getFilename(path)));\r\n        }\r\n      }\r\n\r\n      let oncatch = (error) => {\r\n        reject(error);\r\n      }\r\n\r\n      ipcRenderer.invoke('show-save-dialog', eargs, wrapRemoteCallback('dialog', onthen), wrapRemoteCallback('dialog', oncatch));\r\n\r\n    });\r\n  }\r\n\r\n  static readFile(path, mime) {\r\n    return new Promise((accept, reject) => {\r\n      let fs = require('fs');\r\n\r\n      if (isMimeText(mime)) {\r\n        accept(fs.readFileSync(path.data, \"utf8\"));\r\n      } else {\r\n        accept(fs.readFileSync(path.data).buffer);\r\n      }\r\n    });\r\n  }\r\n\r\n  static writeFile(data, handle, mime) {\r\n    return new Promise((accept, reject) => {\r\n      let fs = require('fs');\r\n\r\n      fs.writeFileSync(handle.data, data);\r\n      accept(handle);\r\n    });\r\n  }\r\n}\r\n","\"use strict\";\r\nexport const SVG_URL = 'http://www.w3.org/2000/svg';\r\n\r\nimport * as util from './util.js';\r\nimport * as vectormath from './vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as ui from '../core/ui.js';\r\nimport * as math from './math.js';\r\n\r\nconst Vector2 = vectormath.Vector2;\r\n\r\nexport class CanvasOverdraw extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.shadow.appendChild(this.canvas);\r\n    this.g = this.canvas.getContext(\"2d\");\r\n\r\n    this.screen = undefined;\r\n    this.shapes = [];\r\n    this.otherChildren = []; //non-svg elements\r\n    this.font = undefined;\r\n\r\n    let style = document.createElement(\"style\")\r\n    style.textContent = `\r\n      .overdrawx {\r\n        pointer-events : none;\r\n      }\r\n    `;\r\n\r\n    this.shadow.appendChild(style);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname : 'screen-overdraw-canvas-x'\r\n    }\r\n  }\r\n\r\n  startNode(node, screen) {\r\n    if (screen) {\r\n      this.screen = screen;\r\n      this.ctx = screen.ctx;\r\n    }\r\n\r\n    if (!this.parentNode) {\r\n      node.appendChild(this);\r\n    }\r\n\r\n    this.style[\"display\"] = \"float\";\r\n    this.style[\"z-index\"] = this.zindex_base;\r\n\r\n    this.style[\"position\"] = \"absolute\";\r\n    this.style[\"left\"] = \"0px\";\r\n    this.style[\"top\"] = \"0px\";\r\n\r\n    this.style[\"width\"] = \"100%\" //screen.size[0] + \"px\";\r\n    this.style[\"height\"] = \"100%\" //screen.size[1] + \"px\";\r\n\r\n    this.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.svg = document.createElementNS(SVG_URL, \"svg\");\r\n    this.svg.style[\"width\"] = \"100%\";\r\n    this.svg.style[\"height\"] = \"100%\";\r\n\r\n    this.svg.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.shadow.appendChild(this.svg);\r\n    //this.style[\"background-color\"] = \"green\";\r\n  }\r\n\r\n  start(screen) {\r\n    this.screen = screen;\r\n    this.ctx = screen.ctx;\r\n\r\n    screen.parentNode.appendChild(this);\r\n\r\n    this.style[\"display\"] = \"float\";\r\n    this.style[\"z-index\"] = this.zindex_base;\r\n\r\n    this.style[\"position\"] = \"absolute\";\r\n    this.style[\"left\"] = \"0px\";\r\n    this.style[\"top\"] = \"0px\";\r\n\r\n    this.style[\"width\"] = screen.size[0] + \"px\";\r\n    this.style[\"height\"] = screen.size[1] + \"px\";\r\n\r\n    this.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.svg = document.createElementNS(SVG_URL, \"svg\");\r\n    this.svg.style[\"width\"] = \"100%\";\r\n    this.svg.style[\"height\"] = \"100%\";\r\n\r\n    this.shadow.appendChild(this.svg);\r\n\r\n    //this.style[\"background-color\"] = \"green\";\r\n  }\r\n}\r\n\r\nexport class Overdraw extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.visibleToPick = false;\r\n\r\n    this.screen = undefined;\r\n    this.shapes = [];\r\n    this.otherChildren = []; //non-svg elements\r\n    this.font = undefined;\r\n\r\n    let style = document.createElement(\"style\")\r\n    style.textContent = `\r\n      .overdrawx {\r\n        pointer-events : none;\r\n      }\r\n    `;\r\n\r\n    this.shadow.appendChild(style);\r\n\r\n    this.zindex_base = 1000;\r\n  }\r\n\r\n  startNode(node, screen, cssPosition=\"relative\") {\r\n    if (screen) {\r\n      this.screen = screen;\r\n      this.ctx = screen.ctx;\r\n    }\r\n\r\n    if (!this.parentNode) {\r\n      node.appendChild(this);\r\n    }\r\n\r\n    this.style[\"z-index\"] = this.zindex_base;\r\n\r\n    this.style[\"position\"] = cssPosition;\r\n\r\n    //this.style[\"left\"] = \"0px\";\r\n    //this.style[\"top\"] = \"0px\";\r\n    this.style[\"margin\"] = this.style[\"padding\"] = \"0px\";\r\n\r\n    this.style[\"width\"] = \"100%\" //screen.size[0] + \"px\";\r\n    this.style[\"height\"] = \"100%\" //screen.size[1] + \"px\";\r\n\r\n    this.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.svg = document.createElementNS(SVG_URL, \"svg\");\r\n    this.svg.style[\"width\"] = \"100%\";\r\n    this.svg.style[\"height\"] = \"100%\";\r\n\r\n    this.svg.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.shadow.appendChild(this.svg);\r\n    //this.style[\"background-color\"] = \"green\";\r\n  }\r\n\r\n  start(screen) {\r\n    this.screen = screen;\r\n    this.ctx = screen.ctx;\r\n\r\n    screen.parentNode.appendChild(this);\r\n\r\n    this.style[\"display\"] = \"float\";\r\n    this.style[\"z-index\"] = this.zindex_base;\r\n\r\n    this.style[\"position\"] = \"absolute\";\r\n    this.style[\"left\"] = \"0px\";\r\n    this.style[\"top\"] = \"0px\";\r\n\r\n    this.style[\"width\"] = screen.size[0] + \"px\";\r\n    this.style[\"height\"] = screen.size[1] + \"px\";\r\n\r\n    this.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.svg = document.createElementNS(SVG_URL, \"svg\");\r\n    this.svg.style[\"width\"] = \"100%\";\r\n    this.svg.style[\"height\"] = \"100%\";\r\n\r\n    this.shadow.appendChild(this.svg);\r\n\r\n    //this.style[\"background-color\"] = \"green\";\r\n  }\r\n\r\n  clear() {\r\n    for (let child of util.list(this.svg.childNodes)) {\r\n      child.remove();\r\n    }\r\n\r\n    for (let child of this.otherChildren) {\r\n      child.remove();\r\n    }\r\n\r\n    this.otherChildren.length = 0;\r\n  }\r\n\r\n  drawTextBubbles(texts, cos, colors) {\r\n    let boxes = [];\r\n    let elems = [];\r\n\r\n    let cent = new Vector2();\r\n\r\n    for (let i=0; i<texts.length; i++) {\r\n      let co = cos[i];\r\n      let text = texts[i];\r\n      let color;\r\n\r\n      if (colors !== undefined) {\r\n        color = colors[i];\r\n      }\r\n\r\n      cent.add(co);\r\n      let box = this.text(texts[i], co[0], co[1], {color : color});\r\n\r\n      boxes.push(box);\r\n      let font = box.style[\"font\"];\r\n      let pat = /[0-9]+px/;\r\n      let size = font.match(pat)[0];\r\n\r\n      //console.log(\"size\", size);\r\n\r\n      if (size === undefined) {\r\n        size = this.getDefault(\"DefaultText\").size;\r\n      } else {\r\n        size = ui_base.parsepx(size);\r\n      }\r\n\r\n      //console.log(size);\r\n      let tsize = ui_base.measureTextBlock(this, text, undefined, undefined, size, font);\r\n\r\n      box.minsize = [\r\n        ~~tsize.width,\r\n        ~~tsize.height\r\n      ];\r\n\r\n      let pad = ui_base.parsepx(box.style[\"padding\"]);\r\n\r\n      box.minsize[0] += pad*2;\r\n      box.minsize[1] += pad*2;\r\n\r\n      let x = ui_base.parsepx(box.style[\"left\"]);\r\n      let y = ui_base.parsepx(box.style[\"top\"]);\r\n\r\n      box.grads = new Array(4);\r\n      box.params = [x, y, box.minsize[0], box.minsize[1]];\r\n      box.startpos = new Vector2([x, y]);\r\n\r\n      box.setCSS = function() {\r\n        this.style[\"padding\"] = \"0px\";\r\n        this.style[\"margin\"] = \"0px\";\r\n        this.style[\"left\"] = ~~this.params[0] + \"px\";\r\n        this.style[\"top\"] = ~~this.params[1] + \"px\";\r\n        this.style[\"width\"] = ~~this.params[2] + \"px\";\r\n        this.style[\"height\"] = ~~this.params[3] + \"px\";\r\n      };\r\n\r\n      box.setCSS();\r\n      //console.log(box.params);\r\n      elems.push(box);\r\n    }\r\n\r\n    if (boxes.length === 0) {\r\n      return;\r\n    }\r\n\r\n    cent.mulScalar(1.0 / boxes.length);\r\n\r\n    function error() {\r\n      let p1 = [0, 0], p2 = [0, 0];\r\n      let s1 = [0, 0], s2 = [0, 0];\r\n\r\n      let ret = 0.0;\r\n\r\n      for (let box1 of boxes) {\r\n        for (let box2 of boxes) {\r\n          if (box2 === box1) {\r\n            continue;\r\n          }\r\n\r\n          s1[0] = box1.params[2];\r\n          s1[1] = box1.params[3];\r\n          s2[0] = box2.params[2];\r\n          s2[1] = box2.params[3];\r\n\r\n          let overlap = math.aabb_overlap_area(box1.params, s1, box2.params, s2);\r\n          ret += overlap;\r\n        }\r\n\r\n        ret += box1.startpos.vectorDistance(box1.params)*0.25;\r\n      }\r\n\r\n      return ret;\r\n    }\r\n\r\n    function solve() {\r\n      //console.log(\"ERROR\", error());\r\n      let r1 = error();\r\n      if (r1 === 0.0) {\r\n        return;\r\n      }\r\n\r\n      let df = 0.0001;\r\n      let totgs = 0.0;\r\n\r\n      for (let box of boxes) {\r\n        for (let i=0; i<box.params.length; i++) {\r\n          let orig = box.params[i];\r\n          box.params[i] += df;\r\n          let r2 = error();\r\n          box.params[i] = orig;\r\n\r\n          box.grads[i] = (r2 - r1) / df;\r\n          totgs += box.grads[i]**2;\r\n        }\r\n      }\r\n\r\n      if (totgs === 0.0) {\r\n        return;\r\n      }\r\n\r\n      r1 /= totgs;\r\n      let k = 0.4;\r\n\r\n      for (let box of boxes) {\r\n        for (let i = 0; i < box.params.length; i++) {\r\n          box.params[i] += -r1*box.grads[i]*k;\r\n        }\r\n\r\n        box.params[2] = Math.max(box.params[2], box.minsize[0]);\r\n        box.params[3] = Math.max(box.params[3], box.minsize[1]);\r\n\r\n        box.setCSS();\r\n      }\r\n    }\r\n\r\n    for (let i=0; i<15; i++) {\r\n      solve();\r\n    }\r\n\r\n    for (let box of boxes) {\r\n      elems.push(this.line(box.startpos, box.params));\r\n    }\r\n\r\n    return elems;\r\n  }\r\n\r\n  text(text, x, y, args={}) {\r\n    args = Object.assign({}, args);\r\n\r\n    if (args.font === undefined) {\r\n      if (this.font !== undefined)\r\n        args.font = this.font;\r\n      else\r\n        args.font = this.getDefault(\"DefaultText\").genCSS();\r\n    }\r\n\r\n    if (!args[\"background-color\"]) {\r\n      args[\"background-color\"] = \"rgba(75, 75, 75, 0.75)\";\r\n    }\r\n\r\n    args.color = args.color ? args.color : \"white\";\r\n    if (typeof args.color === \"object\") {\r\n      args.color = ui_base.color2css(args.color);\r\n    }\r\n\r\n    args[\"padding\"] = args[\"padding\"] === undefined ? \"5px\" : args[\"padding\"];\r\n    args[\"border-color\"] = args[\"border-color\"] ? args[\"border-color\"] : \"grey\";\r\n    args[\"border-radius\"] = args[\"border-radius\"] ? args[\"border-radius\"] : \"25px\";\r\n    args[\"border-width\"] = args[\"border-width\"] !== undefined ? args[\"border-width\"] : \"2px\";\r\n\r\n    if (typeof args[\"border-width\"] === \"number\") {\r\n      args[\"border-width\"] = \"\" + args[\"border-width\"] + \"px\";\r\n    }\r\n    if (typeof args[\"border-radius\"] === \"number\") {\r\n      args[\"border-radius\"] = \"\" + args[\"border-radius\"] + \"px\";\r\n    }\r\n\r\n    //not sure I need SVG for this. . .\r\n    let box = document.createElement(\"div\")\r\n\r\n    box.setAttribute(\"class\", \"overdrawx\");\r\n\r\n    box.style[\"position\"] = \"fixed\";\r\n    box.style[\"width\"] = \"min-contents\";\r\n    box.style[\"height\"] = \"min-contents\";\r\n    box.style[\"border-width\"] = args[\"border-width\"]\r\n    box.style[\"border-radius\"] = \"25px\";\r\n    box.style[\"pointer-events\"] = \"none\";\r\n    box.style[\"z-index\"] = this.zindex_base + 1;\r\n    box.style[\"background-color\"] = args[\"background-color\"];\r\n    box.style[\"padding\"] = args[\"padding\"];\r\n\r\n    box.style[\"left\"] = x + \"px\";\r\n    box.style[\"top\"] = y + \"px\";\r\n\r\n    box.style[\"display\"] = \"flex\";\r\n    box.style[\"justify-content\"] = \"center\";\r\n    box.style[\"align-items\"] = \"center\";\r\n\r\n    box.innerText = text;\r\n    box.style[\"font\"] = args.font;\r\n    box.style[\"color\"] = args.color;\r\n\r\n    this.otherChildren.push(box);\r\n    this.shadow.appendChild(box);\r\n\r\n    return box;\r\n  }\r\n\r\n  circle(p, r, stroke=\"black\", fill=\"none\") {\r\n    let circle = document.createElementNS(SVG_URL, \"circle\");\r\n    circle.setAttribute(\"cx\", p[0]);\r\n    circle.setAttribute(\"cy\", p[1]);\r\n    circle.setAttribute(\"r\", r);\r\n\r\n    if (fill) {\r\n      circle.setAttribute(\"style\", `stroke:${stroke};stroke-width:2;fill:${fill}`);\r\n    } else {\r\n      circle.setAttribute(\"style\", `stroke:${stroke};stroke-width:2`);\r\n    }\r\n\r\n    this.svg.appendChild(circle);\r\n\r\n    return circle;\r\n  }\r\n\r\n  line(v1, v2, color=\"black\") {\r\n    let line = document.createElementNS(SVG_URL, \"line\");\r\n    line.setAttribute(\"x1\", v1[0]);\r\n    line.setAttribute(\"y1\", v1[1]);\r\n    line.setAttribute(\"x2\", v2[0]);\r\n    line.setAttribute(\"y2\", v2[1]);\r\n    line.setAttribute(\"style\", `stroke:${color};stroke-width:2`);\r\n\r\n    this.svg.appendChild(line);\r\n    return line;\r\n  }\r\n\r\n  rect(p, size, color=\"black\") {\r\n    let line = document.createElementNS(SVG_URL, \"rect\");\r\n    line.setAttribute(\"x\", p[0]);\r\n    line.setAttribute(\"y\", p[1]);\r\n    line.setAttribute(\"width\", size[0]);\r\n    line.setAttribute(\"height\", size[1]);\r\n    line.setAttribute(\"style\", `fill:${color};stroke-width:2`);\r\n\r\n    line.setColor = (color) => {\r\n      line.setAttribute(\"style\", `fill:${color};stroke-width:2`);\r\n    };\r\n\r\n    this.svg.appendChild(line);\r\n    return line;\r\n  }\r\n\r\n  end() {\r\n    this.clear();\r\n    this.remove();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"overdraw-x\",\r\n    style   : \"overdraw\"\r\n  };}\r\n}\r\n\r\nui_base.UIBase.internalRegister(Overdraw);\r\n","import '../util/ScreenOverdraw.js';\r\nimport {UIBase, Icons} from '../core/ui_base.js';\r\nimport {Container} from '../core/ui.js';\r\nimport {pushModalLight, popModalLight, keymap} from '../path-controller/util/simple_events.js';\r\nimport {parsepx} from '../core/ui_theme.js';\r\nimport {Vector2} from '../path-controller/util/vectormath.js';\r\nimport * as math from '../path-controller/util/math.js';\r\n\r\nexport class TreeItem extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.treeParent = undefined;\r\n    this.treeChildren = [];\r\n    this.treeView = undefined;\r\n    this.treeDepth = 0;\r\n\r\n    this.header = this.row();\r\n\r\n    this._icon1 = this.header.iconbutton(Icons.TREE_COLLAPSE);\r\n    this._icon1.iconsheet = 0;\r\n    this._icon1.drawButtonBG = false;\r\n\r\n    this._icon2 = undefined;\r\n\r\n    this._icon1.onclick = () => {\r\n      if (this.opened) {\r\n        this.close();\r\n      }  else {\r\n        this.open();\r\n      }\r\n    }\r\n\r\n    this.opened = true;\r\n\r\n    this._label = this.header.label(\"unlabeled\");\r\n    this._labelText = \"unlabeled\";\r\n  }\r\n\r\n  set icon(id) {\r\n    if (this._icon2) {\r\n      this._icon2 = id;\r\n    } else {\r\n      this._icon2 = UIBase.createElement(\"icon-label-x\");\r\n      this._icon2.icon = id;\r\n      this._icon2.iconsheet = 0;\r\n\r\n\r\n      this.header.insert(1, this._icon2);\r\n    }\r\n  }\r\n\r\n  get icon() {\r\n    if (this._icon2)\r\n      return this._icon2.icon;\r\n    else\r\n      return -1;\r\n  }\r\n\r\n  open() {\r\n    this._icon1.icon = Icons.TREE_COLLAPSE;\r\n    this.opened = true;\r\n    this.treeView._open(this);\r\n  }\r\n\r\n  close() {\r\n    this._icon1.icon = Icons.TREE_EXPAND;\r\n    this.opened = false;\r\n    this.treeView._close(this);\r\n  }\r\n\r\n  set text(b) {\r\n    if (typeof b === \"string\") {\r\n      this._label.text = b;\r\n      this._labelText = b;\r\n    } else if (b instanceof HTMLElement) {\r\n      this._label.remove();\r\n      this.header.add(b);\r\n\r\n      this._label = b;\r\n      this._labelText = b;\r\n    }\r\n  }\r\n\r\n  get text() {\r\n    return this._labelText;\r\n  }\r\n\r\n\r\n  item(name, args={}) {\r\n    args.treeParent = this;\r\n    return this.parentWidget.item(name, args);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"tree-item-x\",\r\n    style   : \"treeview\"\r\n  }}\r\n}\r\nUIBase.internalRegister(TreeItem);\r\n\r\nexport class TreeView extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.items = [];\r\n    this.strokes = [];\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-direction\"] = \"column\";\r\n\r\n    //this.shadow.appendChild(this.overdraw);\r\n\r\n    this.overdraw = UIBase.createElement(\"overdraw-x\");\r\n    console.log(this.overdraw.startNode);\r\n    this.overdraw.startNode(this);\r\n\r\n    this.style[\"margin\"] = this.style[\"padding\"] = \"0px\";\r\n\r\n    this.updateOverdraw();\r\n  }\r\n\r\n  _forAllChildren(item, cb) {\r\n    let visit = (n) => {\r\n      cb(n);\r\n\r\n      for (let c of n.treeChildren) {\r\n        visit(c);\r\n      }\r\n    }\r\n\r\n    for (let c of item.treeChildren) {\r\n      visit(c);\r\n    }\r\n  }\r\n\r\n  _open(item) {\r\n    this._forAllChildren(item, (c) => {\r\n      if (c.opened) {\r\n        c.unhide();\r\n      }\r\n    })\r\n\r\n    this._makeStrokes();\r\n  }\r\n\r\n  _close(item) {\r\n    this._forAllChildren(item, (c) => {\r\n      c.hide();\r\n    })\r\n\r\n    this._makeStrokes();\r\n  }\r\n\r\n  _makeStrokes() {\r\n    if (!this.overdraw) {\r\n      //this.doOnce(this._makeStrokes);\r\n      return;\r\n    }\r\n\r\n    for (let elem of this.strokes) {\r\n      elem.remove();\r\n    }\r\n    this.strokes.length = 0;\r\n\r\n    let hidden = (item) => {\r\n      return item.hidden;\r\n      let p = item;\r\n\r\n      while (p) {\r\n        if (!p.opened)\r\n          return true;\r\n        p = p.treeParent;\r\n      }\r\n\r\n      return false;\r\n    }\r\n\r\n    let items = this.items;\r\n    if (items.length == 0) {\r\n      return;\r\n    }\r\n\r\n    this.overdraw.clear();\r\n\r\n    let next = (i) => {\r\n      i++;\r\n\r\n      while (i < items.length && hidden(items[i])) {\r\n        i++;\r\n        continue;\r\n      }\r\n\r\n      return i;\r\n    }\r\n\r\n    let i = 0;\r\n    if (hidden(items[i]))\r\n      i = next(i);\r\n\r\n    let origin = this.overdraw.getBoundingClientRect();\r\n    let overdraw = this.overdraw;\r\n\r\n    let line = function(x1, y1, x2, y2) {\r\n      let ox = origin.x, oy = origin.y;\r\n\r\n      x1 -= ox; y1 -= oy;\r\n      x2 -= ox; y2 -= oy;\r\n\r\n      overdraw.line([x1, y1], [x2, y2]);\r\n    }\r\n\r\n    console.log(\"making lines\", i);\r\n\r\n    let indent = this.getDefault(\"itemIndent\");\r\n    let rowh = this.getDefault(\"rowHeight\");\r\n\r\n    let getx = (depth) => {\r\n      return (depth+2.2)*indent + origin.x;\r\n    }\r\n\r\n    this.overdraw.style[\"z-index\"] = \"0\";\r\n\r\n    let prev = undefined;\r\n\r\n    for (; i<items.length; i = next(i)) {\r\n      let item = this.items[i];\r\n      let item2 = next(i);\r\n      item2 = item2 < items.length ? items[item2] : undefined;\r\n\r\n      let r = item._icon1.getBoundingClientRect();\r\n\r\n      if (!r) continue;\r\n\r\n      let x1 = getx(item.treeDepth);\r\n      let y1 = origin.y + (i+1)*rowh - rowh*0.25;\r\n\r\n\r\n      if (item2 && item2.treeDepth > item.treeDepth) {//} && (!prev || prev.treeDepth !== item.treeDepth)) {\r\n        let y2 = y1 + rowh*0.75;\r\n\r\n        line(x1, y1, x1, y2)\r\n        line(x1, y2, getx(item2.treeDepth)-3, y2);\r\n\r\n      } else if (item2 && item2.treeDepth === item.treeDepth) {\r\n        line(x1, y1, x1, y1+rowh*0.5)\r\n      }\r\n\r\n      prev = item;\r\n    }\r\n  }\r\n\r\n  updateOverdraw() {\r\n    let mm = new math.MinMax(2);\r\n    let ok = false;\r\n\r\n    for (let item of this.items) {\r\n      if (item.hidden) {\r\n        //continue;\r\n      }\r\n\r\n      for (let r of item.getClientRects()) {\r\n        //console.log(r.y);\r\n        mm.minmax([r.x, r.y]);\r\n        mm.minmax([r.x+r.width, r.y+r.height]);\r\n        ok = true;\r\n      }\r\n    }\r\n\r\n    if (!ok) {\r\n      return;\r\n    }\r\n\r\n    let r = this.getClientRects()[0];\r\n    if (!r) return;\r\n\r\n    let x = r.left;\r\n    let y = r.top;// - r.y;\r\n\r\n    let od = this.overdraw;\r\n    let w = mm.max[0] - mm.min[0];\r\n    let h = mm.max[1] - mm.min[1];\r\n\r\n    od.style[\"margin\"] = \"0px\";\r\n    od.style[\"padding\"] = \"0px\";\r\n    od.svg.style[\"margin\"] = \"0px\";\r\n\r\n    od.style[\"position\"] = UIBase.PositionKey;\r\n\r\n    od.style[\"width\"] = (r.width-1) + \"px\";\r\n    od.style[\"height\"] = (r.height-1) + \"px\";\r\n\r\n    od.style[\"left\"] = x + \"px\";\r\n    od.style[\"top\"] =  y + \"px\";\r\n\r\n    //od.style[\"background-color\"] = \"rgba(50, 50, 50, 0.25)\";\r\n    //od.svg.style[\"background-color\"] = \"rgba(50, 50, 50, 0.25)\";\r\n\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateOverdraw();\r\n  }\r\n\r\n  item(name, args={icon : undefined}) {\r\n    let ret = UIBase.createElement(\"tree-item-x\");\r\n    this.add(ret);\r\n    ret._init();\r\n\r\n    ret.text = name;\r\n\r\n    if (args.icon) {\r\n      ret.icon = args.icon;\r\n    }\r\n\r\n    ret.treeParent = args.treeParent;\r\n    ret.treeView = this;\r\n\r\n    //ret.style[\"margin-bottom\"] = ret.style[\"margin-top\"] = \"0px\";\r\n    //ret.style[\"padding-bottom\"] = ret.style[\"padding-top\"] = \"0px\";\r\n    ret.style[\"max-height\"] = this.getDefault(\"rowHeight\") + \"px\";\r\n\r\n    if (ret.treeParent) {\r\n      ret.treeParent.treeChildren.push(ret);\r\n      ret.treeDepth = ret.treeParent.treeDepth + 1;\r\n    }\r\n\r\n    let p = ret.treeParent;\r\n    let i = 1;\r\n    while (p) {\r\n      p = p.treeParent;\r\n      i++;\r\n    }\r\n\r\n    ret.style[\"margin-left\"] = (i*this.getDefault(\"itemIndent\")) + \"px\";\r\n    this.items.push(ret);\r\n\r\n    this.doOnce(() => {\r\n      this._makeStrokes();\r\n    });\r\n\r\n    return ret;\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"tree-view-x\",\r\n    style   : \"treeview\"\r\n  }}\r\n}\r\nUIBase.internalRegister(TreeView);\r\n\r\n","import {UIBase, Icons} from '../core/ui_base.js';\r\nimport {Container} from '../core/ui.js';\r\nimport {pushModalLight, popModalLight, keymap} from '../path-controller/util/simple_events.js';\r\nimport {parsepx} from '../core/ui_theme.js';\r\n\r\nfunction startDrag(box) {\r\n  if (box._modal) {\r\n    popModalLight(box._modal);\r\n    box._modal = undefined;\r\n    return;\r\n  }\r\n\r\n  let first = true;\r\n  let lastx = 0;\r\n  let lasty = 0;\r\n\r\n  let handlers = {\r\n    on_mousemove(e) {\r\n      let x = e.x, y = e.y;\r\n\r\n      if (first) {\r\n        lastx = x;\r\n        lasty = y;\r\n        first = false;\r\n\r\n        return;\r\n      }\r\n\r\n      let dx = x - lastx;\r\n      let dy = y - lasty;\r\n\r\n      let hx = parsepx(box.style[\"left\"]);\r\n      let hy = parsepx(box.style[\"top\"]);\r\n\r\n      hx += dx;\r\n      hy += dy;\r\n\r\n      console.log(hx, hy);\r\n\r\n      box.style[\"left\"] = hx + \"px\";\r\n      box.style[\"top\"] = hy + \"px\";\r\n\r\n      lastx = x;\r\n      lasty = y;\r\n    },\r\n\r\n    end() {\r\n      if (box._modal) {\r\n        popModalLight(box._modal);\r\n        box._modal = undefined;\r\n      }\r\n    },\r\n\r\n    on_mouseup(e) {\r\n      this.end();\r\n    },\r\n\r\n    on_keydown(e) {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Escape\"]:\r\n        case keymap[\"Return\"]:\r\n          this.end();\r\n          break;\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  box._modal = pushModalLight(handlers);\r\n}\r\n\r\nexport class DragBox extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this._done = false;\r\n    this.header = UIBase.createElement(\"rowframe-x\");\r\n    this.contents = UIBase.createElement(\"container-x\");\r\n\r\n    this.header.style[\"border-radius\"] = \"20px\";\r\n\r\n    this.header.parentWidget = this;\r\n    this.contents.parentWidget = this;\r\n\r\n    this.shadow.appendChild(this.header);\r\n    this.shadow.appendChild(this.contents);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    let header = this.header;\r\n\r\n    header.ctx = this.ctx;\r\n    this.contents.ctx = this.ctx;\r\n    header._init();\r\n    this.contents._init();\r\n\r\n    this.style[\"min-width\"] = \"350px\";\r\n    header.style[\"height\"] = \"35px\";\r\n\r\n    let icon = header.iconbutton(Icons.DELETE, \"Hide\", () => {\r\n      this.end();\r\n    });\r\n    icon.iconsheet = 0; //use small icons\r\n\r\n    this.addEventListener(\"mousedown\", (e) => {\r\n      console.log(\"start drag\");\r\n      startDrag(this);\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n\r\n    }, {capture : false})\r\n\r\n    header.background = this.getDefault(\"background-color\");\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  add() {\r\n    return this.contents.add(...arguments);\r\n  }\r\n\r\n  prepend(n) {\r\n    return this.contents.prepend(n);\r\n  }\r\n\r\n  appendChild(n) {\r\n    return this.contents.appendChild(n);\r\n  }\r\n  col() {\r\n    return this.contents.col(...arguments);\r\n  }\r\n\r\n  row() {\r\n    return this.contents.row(...arguments);\r\n  }\r\n\r\n  strip() {\r\n    return this.contents.strip(...arguments);\r\n  }\r\n  button() {\r\n    return this.contents.button(...arguments);\r\n  }\r\n  iconbutton() {\r\n    return this.contents.iconbutton(...arguments);\r\n  }\r\n  iconcheck() {\r\n    return this.contents.iconcheck(...arguments);\r\n  }\r\n  tool() {\r\n    return this.contents.tool(...arguments);\r\n  }\r\n  menu() {\r\n    return this.contents.menu(...arguments);\r\n  }\r\n  prop() {\r\n    return this.contents.prop(...arguments);\r\n  }\r\n  listenum() {\r\n    return this.contents.listenum(...arguments);\r\n  }\r\n  check() {\r\n    return this.contents.check(...arguments);\r\n  }\r\n  iconenum() {\r\n    return this.contents.iconenum(...arguments);\r\n  }\r\n  slider() {\r\n    return this.contents.slider(...arguments);\r\n  }\r\n  simpleslider() {\r\n    return this.contents.simpleslider(...arguments);\r\n  }\r\n  curve() {\r\n    return this.contents.curve(...arguments);\r\n  }\r\n  textbox() {\r\n    return this.contents.textbox(...arguments);\r\n  }\r\n  textarea() {\r\n    return this.contents.textarea(...arguments);\r\n  }\r\n  viewer() {\r\n    return this.contents.viewer(...arguments);\r\n  }\r\n  panel() {\r\n    return this.contents.panel(...arguments);\r\n  }\r\n  tabs() {\r\n    return this.contents.tabs(...arguments);\r\n  }\r\n  table() {\r\n    return this.contents.table(...arguments);\r\n  }\r\n\r\n\r\n  end() {\r\n    if (this._done) {\r\n      return;\r\n    }\r\n    this.remove();\r\n\r\n    if (this._onend) {\r\n      this._onend();\r\n    }\r\n\r\n    if (this.onend) {\r\n      this.onend();\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.background = this.getDefault(\"background-color\");\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"drag-box-x\",\r\n    style   : \"panel\"\r\n  }}\r\n}\r\nUIBase.internalRegister(DragBox);\r\n","import {UIBase, saveUIData, loadUIData} from '../core/ui_base.js';\r\n\r\nimport * as util from \"../path-controller/util/util.js\"\r\nimport cconst from \"../config/const.js\";\r\nimport * as nstructjs from \"../path-controller/util/struct.js\";\r\n\r\nimport {Vector2} from '../path-controller/util/vectormath.js';\r\nimport {Container} from \"../core/ui.js\";\r\nimport {Area} from \"./ScreenArea.js\";\r\nimport {Icons} from \"../core/ui_base.js\";\r\n\r\nimport {startMenu} from \"../widgets/ui_menu.js\";\r\nimport {getAreaIntName, setAreaTypes, AreaWrangler, areaclasses} from './area_wrangler.js';\r\n\r\nlet ignore = 0;\r\n\r\nfunction dockerdebug() {\r\n  if (cconst.DEBUG.areadocker) {\r\n    console.warn(...arguments);\r\n  }\r\n}\r\n\r\nwindow.testSnapScreenVerts = function (arg) {\r\n  let screen = CTX.screen;\r\n\r\n  screen.unlisten();\r\n  screen.on_resize([screen.size[0] - 75, screen.size[1]], screen.size);\r\n  screen.on_resize = screen.updateSize = () => {\r\n  };\r\n\r\n  let p = CTX.propsbar;\r\n  p.pos[0] += 50;\r\n  p.owning_sarea.loadFromPosSize();\r\n  screen.regenBorders();\r\n\r\n  screen.size[0] = window.innerWidth - 5;\r\n\r\n  screen.snapScreenVerts(arg);\r\n}\r\n\r\nexport class AreaDocker extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this._last_update_key = undefined;\r\n    this.mpos = new Vector2();\r\n    this.needsRebuild = true;\r\n    this.ignoreChange = 0;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"area-docker-x\",\r\n      style  : \"areadocker\"\r\n    }\r\n  }\r\n\r\n  rebuild() {\r\n    if (!this.parentWidget) {\r\n      return;\r\n    }\r\n\r\n    let sarea = this.getArea().parentWidget;\r\n    if (!sarea) {\r\n      this.needsRebuild = true;\r\n      return;\r\n    }\r\n\r\n    this.needsRebuild = false;\r\n    this.ignoreChange++;\r\n\r\n    dockerdebug(\"Rebuild\", this.getArea());\r\n\r\n    let uidata = sarea.switcherData = saveUIData(this, \"switcherTabs\");\r\n\r\n    this.clear();\r\n\r\n    let tabs = this.tbar = this.tabs()\r\n    tabs.onchange = this.tab_onchange.bind(this);\r\n\r\n    let tab;\r\n\r\n    dockerdebug(sarea._id, sarea.area ? sarea.area._id : \"(no active area)\", sarea.editors)\r\n\r\n    sarea.switcherData = uidata;\r\n\r\n    for (let editor of sarea.editors) {\r\n      let def = editor.constructor.define();\r\n      let name = def.uiname;\r\n\r\n      if (!name) {\r\n        name = def.areaname || def.tagname.replace(/-x/, '');\r\n        name = ToolProperty.makeUIName(name);\r\n      }\r\n\r\n      let tab = tabs.tab(name, editor._id);\r\n\r\n      let start_mpos = new Vector2();\r\n      let mpos = new Vector2();\r\n\r\n      tab._tab.addEventListener(\"tabdragstart\", (e) => {\r\n        if (e.x !== 0 && e.y !== 0) {\r\n          start_mpos.loadXY(e.x, e.y);\r\n          this.mpos.loadXY(e.x, e.y);\r\n        } else {\r\n          start_mpos.load(this.mpos);\r\n        }\r\n\r\n        dockerdebug(\"tab drag start!\", start_mpos, e);\r\n      });\r\n      tab._tab.addEventListener(\"tabdragmove\", (e) => {\r\n        this.mpos.loadXY(e.x, e.y);\r\n\r\n        let rect = this.tbar.tbar.canvas.getBoundingClientRect();\r\n\r\n        let x = e.x, y = e.y;\r\n\r\n        let m = 8;\r\n        if (x < rect.x - m || x > rect.x + rect.width + m || y < rect.y - m || y >= rect.y + rect.height + m) {\r\n          dockerdebug(\"tab detach!\");\r\n          e.preventDefault(); //end dragging\r\n          this.detach(e);\r\n        }\r\n      });\r\n      tab._tab.addEventListener(\"tabdragend\", (e) => {\r\n\r\n        this.mpos.loadXY(e.x, e.y);\r\n        dockerdebug(\"tab drag end!\", e);\r\n      });\r\n    }\r\n\r\n    tab = this.tbar.icontab(Icons.SMALL_PLUS, \"add\", \"Add Editor\", false).noSwitch();\r\n    dockerdebug(\"Add Menu Tab\", tab);\r\n\r\n    let icon = this.addicon = tab._tab;\r\n\r\n    icon.ontabclick = e => this.on_addclick(e);\r\n    icon.setAttribute(\"menu-button\", \"true\");\r\n    icon.setAttribute(\"simple\", \"true\");\r\n\r\n    this.loadTabData(uidata);\r\n\r\n    this.ignoreChange--;\r\n  }\r\n\r\n  detach(event) {\r\n    this.tbar._ensureNoModal();\r\n\r\n    let area = this.getArea();\r\n    let sarea = this.ctx.screen.floatArea(area);\r\n\r\n    sarea.size.min([300, 300]);\r\n    sarea.loadFromPosSize();\r\n\r\n    let mpos = event ? new Vector2([event.x, event.y]) : this.mpos;\r\n\r\n    dockerdebug(\"EVENT\", event);\r\n\r\n    if (event && event instanceof PointerEvent) {\r\n      this.ctx.screen.moveAttachTool(sarea, mpos, document.body, event.pointerId);\r\n    } else {\r\n      this.ctx.screen.moveAttachTool(sarea, mpos);\r\n    }\r\n  }\r\n\r\n  loadTabData(uidata) {\r\n    this.ignoreChange++;\r\n    loadUIData(this, uidata);\r\n    this.ignoreChange--;\r\n  }\r\n\r\n  on_addclick(e) {\r\n    let mpos = new Vector2([e.x, e.y]);\r\n\r\n    if (this.addicon.menu && !this.addicon.menu.closed) {\r\n      this.addicon.menu.close();\r\n    } else {\r\n      this.addTabMenu(e.target, mpos);\r\n    }\r\n  }\r\n\r\n  tab_onchange(tab, event) {\r\n    if (this.ignoreChange) {\r\n      return;\r\n    }\r\n\r\n    dockerdebug(\"EVENT\", event);\r\n\r\n    if (event && (!(event instanceof PointerEvent) || event.pointerType === \"mouse\")) {\r\n      //event.preventDefault(); //prevent tab dragging\r\n    }\r\n\r\n    this.select(tab.id, event);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"touch-action\"] = \"none\";\r\n\r\n    this.addEventListener(\"pointermove\", (e) => {\r\n      this.mpos.loadXY(e.x, e.y);\r\n    });\r\n\r\n    this.rebuild();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n  }\r\n\r\n  getArea() {\r\n    let p = this.parentWidget;\r\n    let lastp = p;\r\n\r\n    let name = UIBase.getInternalName(\"screenarea-x\");\r\n    while (p && p.tagName.toLowerCase() !== name) {\r\n      lastp = p;\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    return lastp\r\n  }\r\n\r\n  flagUpdate() {\r\n    this.needsRebuild = true;\r\n    return this;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    let active = this.tbar.getActive();\r\n    let area = this.getArea();\r\n\r\n    let key = this.parentWidget._id;\r\n    for (let area2 of area.parentWidget.editors) {\r\n      key += area2._id + \":\";\r\n    }\r\n\r\n    if (key !== this._last_update_key) {\r\n      this._last_update_key = key;\r\n      this.needsRebuild = true;\r\n    }\r\n\r\n    if (this.needsRebuild) {\r\n      this.rebuild();\r\n      return;\r\n    }\r\n\r\n    if (this.addicon) {\r\n      let tabs = this.tbar.tbar.tabs;\r\n      let idx = tabs.indexOf(this.addicon);\r\n      if (idx !== tabs.length - 1) {\r\n        this.tbar.tbar.swapTabs(this.addicon, tabs[tabs.length - 1]);\r\n\r\n      }\r\n    }\r\n\r\n    if (!active || active._id !== area._id) {\r\n      this.ignoreChange++;\r\n\r\n      try {\r\n        this.tbar.setActive(area._id);\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        this.needsRebuild = true;\r\n      }\r\n\r\n      this.ignoreChange--;\r\n    }\r\n\r\n    window.tabs = this.tbar;\r\n\r\n    this.ignoreChange = 0;\r\n  }\r\n\r\n  select(areaId, event) {\r\n    dockerdebug(\"Tab Select!\", areaId);\r\n\r\n    this.ignoreChange++;\r\n\r\n    let area = this.getArea();\r\n    let sarea = area.parentWidget;\r\n\r\n    let uidata = saveUIData(this.tbar, \"switcherTabs\");\r\n    let newarea;\r\n\r\n    for (let area2 of sarea.editors) {\r\n      if (area2._id === areaId) {\r\n        newarea = area2;\r\n        sarea.switchEditor(area2.constructor);\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (newarea === area || !newarea.switcher) {\r\n      return;\r\n    }\r\n\r\n    //this.ctx.screen.completeSetCSS();\r\n    //this.ctx.screen.completeUpdate();\r\n    sarea.flushSetCSS();\r\n    sarea.flushUpdate();\r\n\r\n    newarea = sarea.area;\r\n\r\n    /* unswap switchers to avoid a bug in Chrome where\r\n    *  touch-action appears to not be respected due to our\r\n    *  swapping elements */\r\n\r\n    let parentw = area.switcher.parentWidget;\r\n    let newparentw = newarea.switcher.parentWidget;\r\n\r\n    let parent = area.switcher.parentNode;\r\n    let newparent = newarea.switcher.parentNode;\r\n\r\n    area.switcher = newarea.switcher;\r\n    newarea.switcher = this;\r\n\r\n    HTMLElement.prototype.remove.call(area.switcher);\r\n    HTMLElement.prototype.remove.call(newarea.switcher);\r\n\r\n    if (parent instanceof UIBase) {\r\n      parent.shadow.appendChild(area.switcher);\r\n    } else {\r\n      parent.appendChild(area.switcher);\r\n    }\r\n\r\n    if (newparent instanceof UIBase) {\r\n      newparent.shadow.prepend(newarea.switcher);\r\n    } else {\r\n      newparent.prepend(newarea.switcher);\r\n    }\r\n\r\n    area.switcher.parentWidget = parentw;\r\n    newarea.switcher.parentWidget = newparentw;\r\n\r\n    area.switcher.tbar._ensureNoModal();\r\n    newarea.switcher.tbar._ensureNoModal();\r\n\r\n    newarea.switcher.loadTabData(uidata);\r\n    area.switcher.loadTabData(uidata);\r\n\r\n    newarea.switcher.setCSS();\r\n    newarea.switcher.update();\r\n\r\n    if (event && (event instanceof PointerEvent || event instanceof MouseEvent || event instanceof TouchEvent)) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n      newarea.switcher.tbar._startMove(undefined, event);\r\n    }\r\n\r\n    //console.log(this._id);\r\n\r\n    sarea.switcherData = uidata;\r\n    this.ignoreChange--;\r\n  }\r\n\r\n  addTabMenu(tab, mpos) {\r\n    let rect = tab.getClientRects()[0];\r\n\r\n    dockerdebug(tab, tab.getClientRects());\r\n\r\n    if (!mpos) {\r\n      mpos = this.ctx.screen.mpos;\r\n    }\r\n\r\n    let menu = UIBase.createElement(\"menu-x\");\r\n\r\n    menu.closeOnMouseUp = false;\r\n    menu.ctx = this.ctx;\r\n    menu._init();\r\n\r\n    let prop = Area.makeAreasEnum();\r\n    let sarea = this.getArea().parentWidget;\r\n\r\n    if (!sarea) {\r\n      return;\r\n    }\r\n\r\n    for (let k in Object.assign({}, prop.values)) {\r\n      let ok = true;\r\n      for (let area of sarea.editors) {\r\n        if (area.constructor.define().uiname === k) {\r\n          ok = false;\r\n        }\r\n      }\r\n\r\n      if (!ok) {\r\n        continue;\r\n      }\r\n\r\n      let icon = prop.iconmap[k];\r\n      menu.addItemExtra(k, prop.values[k], undefined, icon);\r\n    }\r\n\r\n    if (!rect) {\r\n      console.warn(\"no rect!\");\r\n      return;\r\n    }\r\n\r\n    dockerdebug(mpos[0], mpos[1], rect.x, rect.y);\r\n\r\n    menu.onselect = (val) => {\r\n      dockerdebug(\"menu select\", val, this.getArea().parentWidget);\r\n\r\n      this.addicon.menu = undefined;\r\n\r\n      let sarea = this.getArea().parentWidget;\r\n      if (sarea) {\r\n        let cls = areaclasses[val];\r\n\r\n        this.ignoreChange++;\r\n        let area, ud;\r\n\r\n        try {\r\n          let uidata = saveUIData(this.tbar, \"switcherTabs\");\r\n          sarea.switchEditor(cls);\r\n\r\n          dockerdebug(\"switching\", cls);\r\n          area = sarea.area;\r\n          area._init();\r\n\r\n          if (area.switcher) {\r\n            area.switcher.rebuild();\r\n            area.switcher.loadTabData(uidata);\r\n            sarea.switcherData = uidata;\r\n          }\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n          throw error;\r\n        } finally {\r\n          this.ignoreChange = Math.max(this.ignoreChange - 1, 0);\r\n        }\r\n\r\n        dockerdebug(\"AREA\", area.switcher, area);\r\n\r\n        if (area.switcher) {\r\n          this.ignoreChange++;\r\n\r\n          try {\r\n            area.parentWidget = sarea;\r\n            area.owning_sarea = sarea;\r\n            area.switcher.parentWidget = area;\r\n            area.switcher.ctx = area.ctx;\r\n            area.switcher._init();\r\n            area.switcher.update();\r\n\r\n            dockerdebug(\"loading data\", ud);\r\n            area.switcher.loadTabData(ud);\r\n\r\n            area.switcher.rebuild(); //make sure plus tab is at end\r\n            area.flushUpdate();\r\n          } catch (error) {\r\n            throw error;\r\n          } finally {\r\n            this.ignoreChange = Math.max(this.ignoreChange - 1, 0);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    this.addicon.menu = menu;\r\n\r\n    startMenu(menu, mpos[0] - 35, rect.y + rect.height, false, 0);\r\n    return menu;\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(AreaDocker);\r\n","import {ToolTipViewer} from \"./FrameManager_ops.js\";\r\n\r\nlet _FrameManager = undefined;\r\nimport '../widgets/dragbox.js';\r\nimport '../widgets/ui_widgets2.js';\r\nimport '../widgets/ui_panel.js';\r\nimport '../widgets/ui_treeview.js';\r\n\r\nimport {DataPathError, nstructjs} from '../path-controller/controller.js';\r\n\r\nimport '../util/ScreenOverdraw.js';\r\nimport cconst from '../config/const.js';\r\nimport {haveModal, pushModalLight, popModalLight, _setScreenClass} from '../path-controller/util/simple_events.js';\r\nimport * as util from '../path-controller/util/util.js';\r\nimport '../widgets/ui_curvewidget.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as ScreenArea from './ScreenArea.js';\r\nimport * as FrameManager_ops from './FrameManager_ops.js';\r\nimport * as math from '../path-controller/util/math.js';\r\nimport * as ui_menu from '../widgets/ui_menu.js';\r\nimport '../path-controller/util/struct.js';\r\nimport {KeyMap, HotKey} from '../path-controller/util/simple_events.js';\r\nimport {keymap} from \"../path-controller/util/simple_events.js\";\r\n\r\nimport {AreaDocker} from './AreaDocker.js';\r\n\r\nimport {snap, snapi, ScreenBorder, ScreenVert, ScreenHalfEdge, SnapLimit} from \"./FrameManager_mesh.js\";\r\n\r\nexport {ScreenBorder, ScreenVert, ScreenHalfEdge} from \"./FrameManager_mesh.js\";\r\nimport {theme, PackFlags} from '../core/ui_base.js';\r\nimport * as FrameManager_mesh from './FrameManager_mesh.js';\r\nimport {makePopupArea} from \"../widgets/ui_dialog.js\";\r\n\r\nlet Area = ScreenArea.Area;\r\n\r\nimport '../widgets/ui_widgets.js';\r\nimport '../widgets/ui_tabs.js';\r\nimport '../widgets/ui_colorpicker2.js';\r\nimport '../widgets/ui_noteframe.js';\r\nimport '../widgets/ui_listbox.js';\r\nimport '../widgets/ui_table.js';\r\nimport {AreaFlags, setScreenClass} from \"./ScreenArea.js\";\r\nimport {checkForTextBox} from '../widgets/ui_textbox.js';\r\nimport {startMenu} from '../widgets/ui_menu.js';\r\n\r\nfunction list(iter) {\r\n  let ret = [];\r\n\r\n  for (let item of iter) {\r\n    ret.push(item);\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nui_menu.startMenuEventWrangling();\r\n\r\nlet _events_started = false;\r\n\r\nexport function registerToolStackGetter(func) {\r\n  FrameManager_ops.registerToolStackGetter(func);\r\n}\r\n\r\nlet Vector2         = vectormath.Vector2,\r\n    UIBase          = ui_base.UIBase,\r\n    styleScrollBars = ui_base.styleScrollBars;\r\n\r\nlet update_stack = new Array(8192);\r\nupdate_stack.cur = 0;\r\n\r\nlet screen_idgen = 0;\r\n\r\nexport function purgeUpdateStack() {\r\n  for (let i = 0; i < update_stack.length; i++) {\r\n    update_stack[i] = undefined;\r\n  }\r\n}\r\n\r\n/**\r\n * Base class for app workspaces\r\n *\r\n attributes:\r\n\r\n inherit-scale : don't resize to fit whole screen, use cssbox scaling\r\n\r\n */\r\nexport class Screen extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.snapLimit = 1;\r\n    this.fullScreen = true;\r\n\r\n    //all widget shadow DOMs reference this style tag,\r\n    //or rather they copy it\r\n    this.globalCSS = document.createElement(\"style\");\r\n    this.shadow.prepend(this.globalCSS);\r\n\r\n    this._do_updateSize = true;\r\n    this._resize_callbacks = [];\r\n\r\n    this.allBordersMovable = cconst.DEBUG.allBordersMovable;\r\n    this.needsBorderRegen = true;\r\n\r\n    this._popup_safe = 0;\r\n\r\n    //if true, will test all areas for keymaps on keypress,\r\n    //not just the active one\r\n    this.testAllKeyMaps = false;\r\n\r\n    this.needsTabRecalc = true;\r\n    this._screen_id = screen_idgen++;\r\n\r\n    this._popups = [];\r\n\r\n    this._ctx = undefined;\r\n\r\n    this.keymap = new KeyMap();\r\n\r\n    this.size = new Vector2([window.innerWidth, window.innerHeight]);\r\n    this.pos = new Vector2();\r\n    this.oldpos = new Vector2();\r\n\r\n    this.idgen = 0;\r\n    this.sareas = [];\r\n    this.sareas.active = undefined;\r\n    this.mpos = [0, 0];\r\n\r\n    this.screenborders = [];\r\n    this.screenverts = [];\r\n    this._vertmap = {};\r\n    this._edgemap = {};\r\n    this._idmap = {};\r\n\r\n    //effective bounds of screen\r\n    this._aabb = [new Vector2(), new Vector2()];\r\n\r\n    let on_mousemove = (e, x, y) => {\r\n      //let elem = this.pickElement(x, y, 1, 1, ScreenArea.ScreenArea);\r\n      let dragging = e.type === \"mousemove\" || e.type === \"touchmove\" || e.type === \"pointermove\";\r\n      dragging = dragging && (e.buttons || (e.touches && e.touches.length > 0));\r\n\r\n      /*\r\n      make sure active area is up to date.\r\n      but don't call pickElement too often as it's slow\r\n      */\r\n      if (!dragging && Math.random() > 0.9) {\r\n        let elem = this.pickElement(x, y, {\r\n          sx        : 1,\r\n          sy        : 1,\r\n          nodeclass : ScreenArea.ScreenArea,\r\n          mouseEvent: e\r\n        });\r\n\r\n        if (0) {\r\n          let elem2 = this.pickElement(x, y, 1, 1);\r\n          console.log(\"\" + this.sareas.active, elem2 ? elem2.tagName : undefined, elem !== undefined);\r\n        }\r\n\r\n        if (elem !== undefined) {\r\n          if (elem.area) {\r\n            //make sure context area stacks are up to date\r\n            elem.area.push_ctx_active();\r\n            elem.area.pop_ctx_active();\r\n          }\r\n\r\n          this.sareas.active = elem;\r\n        }\r\n      }\r\n\r\n      this.mpos[0] = x;\r\n      this.mpos[1] = y;\r\n    }\r\n    this.shadow.addEventListener(\"mousemove\", (e) => {\r\n      return on_mousemove(e, e.x, e.y);\r\n    }, {passive: true});\r\n\r\n    /*UIBase forwards touch events already\r\n    this.shadow.addEventListener(\"touchmove\", (e) => {\r\n      if (e.touches.length === 0) {\r\n        return;\r\n      }\r\n\r\n      return on_mousemove(e, e.touches[0].pageX, e.touches[0].pagesY);\r\n    }, {passive : true});\r\n    */\r\n  }\r\n\r\n  get borders() {\r\n    let this2 = this;\r\n\r\n    return (function* () {\r\n      for (let k in this2._edgemap) {\r\n        yield this2._edgemap[k];\r\n      }\r\n    })();\r\n  }\r\n\r\n  get listening() {\r\n    return this.listen_timer !== undefined;\r\n  }\r\n\r\n  get ctx() {\r\n    return this._ctx;\r\n  }\r\n\r\n  set ctx(val) {\r\n    this._ctx = val;\r\n\r\n    //fully recurse tree\r\n    let rec = (n) => {\r\n      if (n instanceof UIBase) {\r\n        n.ctx = val;\r\n      }\r\n\r\n      for (let n2 of n.childNodes) {\r\n        rec(n2);\r\n      }\r\n\r\n      if (n.shadow) {\r\n        for (let n2 of n.shadow.childNodes) {\r\n          rec(n2);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let n of this.childNodes) {\r\n      rec(n);\r\n    }\r\n\r\n    for (let n of this.shadow.childNodes) {\r\n      rec(n);\r\n    }\r\n  }\r\n\r\n  static fromJSON(obj, schedule_resize = false) {\r\n    let ret = UIBase.createElement(this.define().tagname);\r\n    return ret.loadJSON(obj, schedule_resize);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"pathux-screen-x\"\r\n    };\r\n  }\r\n\r\n  static newSTRUCT() {\r\n    return UIBase.createElement(this.define().tagname);\r\n  }\r\n\r\n  setPosSize(x, y, w, h) {\r\n    this.pos[0] = x;\r\n    this.pos[1] = y;\r\n    this.size[0] = w;\r\n    this.size[1] = h;\r\n\r\n    this.setCSS();\r\n    this._internalRegenAll();\r\n  }\r\n\r\n  setSize(w, h) {\r\n    this.size[0] = w;\r\n    this.size[1] = h;\r\n\r\n    this.setCSS();\r\n    this._internalRegenAll();\r\n  }\r\n\r\n  setPos(x, y) {\r\n    this.pos[0] = x;\r\n    this.pos[1] = y;\r\n\r\n    this.setCSS();\r\n    this._internalRegenAll();\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    if (this.hasAttribute(\"listen\")) {\r\n      this.listen();\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {*} style May be a string, a CSSStyleSheet instance, or a style tag\r\n   * @returns Promise fulfilled when style has been merged\r\n   */\r\n  mergeGlobalCSS(style) {\r\n    return new Promise((accept, reject) => {\r\n      let sheet;\r\n\r\n      let finish = () => {\r\n        let sheet2 = this.globalCSS.sheet;\r\n        if (!sheet2) {\r\n          this.doOnce(finish);\r\n          return;\r\n        }\r\n\r\n        let map = {};\r\n        for (let rule of sheet2.rules) {\r\n          map[rule.selectorText] = rule;\r\n        }\r\n\r\n        for (let rule of sheet.rules) {\r\n          let k = rule.selectorText;\r\n          if (k in map) {\r\n            let rule2 = map[k];\r\n\r\n            if (!rule.styleMap) { //handle firefox\r\n              for (let k in rule.style) {\r\n                let desc = Object.getOwnPropertyDescriptor(rule.style, k);\r\n\r\n                if (!desc || !desc.writable) {\r\n                  continue;\r\n                }\r\n                let v = rule.style[k];\r\n\r\n                if (v) {\r\n                  rule2.style[k] = rule.style[k];\r\n                }\r\n              }\r\n              continue;\r\n            }\r\n            for (let [key, val] of list(rule.styleMap.entries())) {\r\n              if (1 || rule2.styleMap.has(key)) {\r\n                //rule2.styleMap.delete(key);\r\n                let sval = \"\";\r\n\r\n                if (Array.isArray(val)) {\r\n                  for (let item of val) {\r\n                    sval += \" \" + val;\r\n                  }\r\n                  sval = sval.trim();\r\n                } else {\r\n                  sval = (\"\" + val).trim();\r\n                }\r\n\r\n                rule2.style[key] = sval;\r\n                rule2.styleMap.set(key, val);\r\n              } else {\r\n                rule2.styleMap.append(key, val);\r\n              }\r\n            }\r\n          } else {\r\n            sheet2.insertRule(rule.cssText);\r\n          }\r\n        }\r\n      }\r\n\r\n      if (typeof style === \"string\") {\r\n        try { //stupid firefox\r\n          sheet = new CSSStyleSheet();\r\n        } catch (error) {\r\n          sheet = undefined;\r\n        }\r\n\r\n        if (sheet && sheet.replaceSync) {\r\n          sheet.replaceSync(style);\r\n          finish();\r\n        } else {\r\n          let tag = document.createElement(\"style\");\r\n          tag.textContent = style;\r\n          document.body.appendChild(tag);\r\n\r\n          let cb = () => {\r\n            if (!tag.sheet) {\r\n              this.doOnce(cb);\r\n              return;\r\n            }\r\n\r\n            sheet = tag.sheet;\r\n            finish();\r\n            tag.remove();\r\n          };\r\n\r\n          this.doOnce(cb)\r\n        }\r\n      } else if (!(style instanceof CSSStyleSheet)) {\r\n        sheet = style.sheet;\r\n        finish();\r\n      } else {\r\n        sheet = style;\r\n        finish();\r\n      }\r\n    });\r\n  }\r\n\r\n  newScreenArea() {\r\n    let ret = UIBase.createElement(\"screenarea-x\");\r\n    ret.ctx = this.ctx;\r\n\r\n    if (ret.ctx) {\r\n      ret.init();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  copy() {\r\n    let ret = UIBase.createElement(this.constructor.define().tagname);\r\n    ret.ctx = this.ctx;\r\n    ret._init();\r\n\r\n    for (let sarea of this.sareas) {\r\n      let sarea2 = sarea.copy(ret);\r\n\r\n      sarea2._ctx = this.ctx;\r\n      sarea2.screen = ret;\r\n      sarea2.parentWidget = ret;\r\n\r\n      ret.appendChild(sarea2);\r\n    }\r\n\r\n    for (let sarea of ret.sareas) {\r\n      sarea.ctx = this.ctx;\r\n      sarea.area.ctx = this.ctx;\r\n\r\n      sarea.area.push_ctx_active();\r\n      sarea._init();\r\n      sarea.area._init();\r\n      sarea.area.pop_ctx_active();\r\n\r\n      for (let area of sarea.editors) {\r\n        area.ctx = this.ctx;\r\n\r\n        area.push_ctx_active();\r\n        area._init();\r\n        area.pop_ctx_active();\r\n      }\r\n    }\r\n\r\n    ret.update();\r\n    ret.regenBorders();\r\n    ret.setCSS();\r\n\r\n    return ret;\r\n  }\r\n\r\n  findScreenArea(x, y) {\r\n    for (let i = this.sareas.length - 1; i >= 0; i--) {\r\n      let sarea = this.sareas[i];\r\n\r\n      let ok = x >= sarea.pos[0] && x <= sarea.pos[0] + sarea.size[0];\r\n      ok = ok && (y >= sarea.pos[1] && y <= sarea.pos[1] + sarea.size[1]);\r\n\r\n      if (ok) {\r\n        return sarea;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param x\r\n   * @param y\r\n   * @param args arguments : {sx, sy, nodeclass, excluded_classes}\r\n   */\r\n  pickElement(x, y, args, marginy, nodeclass, excluded_classes) {\r\n    let marginx;\r\n\r\n    if (typeof args === \"object\") {\r\n      nodeclass = args.nodeclass;\r\n      excluded_classes = args.excluded_classes;\r\n    } else {\r\n      args = {\r\n        nodeclass,\r\n        excluded_classes\r\n      };\r\n    }\r\n\r\n    if (!this.ctx) {\r\n      console.warn(\"no ctx in screen\");\r\n      return;\r\n    }\r\n\r\n    let ret;\r\n    for (let i = this._popups.length - 1; i >= 0; i--) {\r\n      let popup = this._popups[i];\r\n      ret = ret || popup.pickElement(x, y, args);\r\n    }\r\n    ret = ret || super.pickElement(x, y, args);\r\n\r\n    return ret;\r\n  }\r\n\r\n  _enterPopupSafe() {\r\n    if (this._popup_safe === undefined) {\r\n      this._popup_safe = 0;\r\n    }\r\n\r\n    this._popup_safe++;\r\n  }\r\n\r\n  * _allAreas() {\r\n    for (let sarea of this.sareas) {\r\n      for (let area of sarea.editors) {\r\n        yield [area, area._area_id, sarea];\r\n      }\r\n    }\r\n  }\r\n\r\n  _exitPopupSafe() {\r\n    this._popup_safe = Math.max(this._popup_safe - 1, 0);\r\n  }\r\n\r\n  popupMenu(menu, x, y) {\r\n    startMenu(menu, x, y);\r\n\r\n    for (let i = 0; i < 3; i++) {\r\n      menu.flushSetCSS();\r\n      menu.flushUpdate();\r\n    }\r\n\r\n    return menu;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param popupDelay : if non-zero, wait for popup to layout for popupDelay miliseconds,\r\n   *                     then move the popup so it's fully inside the window (if it's outsize).\r\n   *\r\n   * */\r\n  popup(owning_node, elem_or_x, y, closeOnMouseOut = true, popupDelay = 5) {\r\n    let ret = this._popup(...arguments);\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      ret.flushUpdate();\r\n      ret.flushSetCSS();\r\n    }\r\n\r\n    if (popupDelay === 0) {\r\n      return ret;\r\n    }\r\n\r\n    let z = ret.style[\"z-index\"];\r\n\r\n    ret.style[\"z-index\"] = \"-10\";\r\n\r\n    let cb = () => {\r\n      let rect = ret.getClientRects()[0];\r\n      let size = this.size;\r\n\r\n      if (!rect) {\r\n        this.doOnce(cb);\r\n        return;\r\n      }\r\n\r\n      //console.log(\"rect\", rect);\r\n\r\n      if (rect.bottom > size[1]) {\r\n        ret.style[\"top\"] = (size[1] - rect.height - 10) + \"px\";\r\n      } else if (rect.top < 0) {\r\n        ret.style[\"top\"] = \"10px\";\r\n      }\r\n      if (rect.right > size[0]) {\r\n        ret.style[\"left\"] = (size[0] - rect.width - 10) + \"px\";\r\n      } else if (rect.left < 0) {\r\n        ret.style[\"left\"] = \"10px\";\r\n      }\r\n\r\n\r\n      ret.style[\"z-index\"] = z;\r\n\r\n      ret.flushUpdate();\r\n      ret.flushSetCSS();\r\n    }\r\n\r\n    setTimeout(cb, popupDelay);\r\n    //this.doOnce(cb);\r\n\r\n    return ret;\r\n  }\r\n\r\n  draggablePopup(x, y) {\r\n    let ret = UIBase.createElement(\"drag-box-x\");\r\n    ret.ctx = this.ctx;\r\n    ret.parentWidget = this;\r\n    ret._init();\r\n\r\n    this._popups.push(ret);\r\n\r\n    ret._onend = () => {\r\n      if (this._popups.indexOf(ret) >= 0) {\r\n        this._popups.remove(ret);\r\n      }\r\n    }\r\n\r\n    ret.style[\"z-index\"] = 205;\r\n    ret.style[\"position\"] = UIBase.PositionKey;\r\n    ret.style[\"left\"] = x + \"px\";\r\n    ret.style[\"top\"] = y + \"px\";\r\n\r\n    document.body.appendChild(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  /** makes a popup at x,y and returns a new container-x for it */\r\n  _popup(owning_node, elem_or_x, y, closeOnMouseOut = true) {\r\n    let x;\r\n\r\n    let sarea = this.sareas.active;\r\n\r\n    let w = owning_node;\r\n    while (w) {\r\n      if (w instanceof ScreenArea.ScreenArea) {\r\n        sarea = w;\r\n        break;\r\n      }\r\n      w = w.parentWidget;\r\n    }\r\n\r\n    if (typeof elem_or_x === \"object\") {\r\n      let r = elem_or_x.getClientRects()[0];\r\n\r\n      x = r.x;\r\n      y = r.y;\r\n    } else {\r\n      x = elem_or_x;\r\n    }\r\n\r\n    x += window.scrollX;\r\n    y += window.scrollY;\r\n\r\n    let container = UIBase.createElement(\"container-x\");\r\n\r\n    container.ctx = this.ctx;\r\n    container._init();\r\n\r\n    let remove = container.remove;\r\n    container.remove = () => {\r\n      if (this._popups.indexOf(container) >= 0) {\r\n        this._popups.remove(container);\r\n      }\r\n\r\n      return remove.apply(container, arguments);\r\n    };\r\n\r\n    container.overrideClass(\"popup\");\r\n\r\n    container.background = container.getDefault(\"background-color\");\r\n    container.style[\"border-radius\"] = container.getDefault(\"border-radius\") + \"px\";\r\n    container.style[\"border-color\"] = container.getDefault(\"border-color\");\r\n    container.style[\"border-style\"] = container.getDefault(\"border-style\");\r\n    container.style[\"border-width\"] = container.getDefault(\"border-width\") + \"px\";\r\n    container.style[\"box-shadow\"] = container.getDefault(\"box-shadow\");\r\n\r\n    container.style[\"position\"] = UIBase.PositionKey;\r\n    container.style[\"z-index\"] = \"2205\";\r\n    container.style[\"left\"] = x + \"px\";\r\n    container.style[\"top\"] = y + \"px\";\r\n    container.style[\"margin\"] = \"0px\";\r\n\r\n    container.parentWidget = this;\r\n\r\n    let mm = new math.MinMax(2);\r\n    let p = new Vector2();\r\n\r\n    let _update = container.update;\r\n    container.update.after(() => {\r\n      container.style[\"z-index\"] = \"2205\";\r\n    });\r\n\r\n    /*causes weird bugs\r\n    container.update = () => {\r\n      _update.call(container);\r\n\r\n      let rects = container.getClientRects();\r\n      mm.reset();\r\n\r\n      for (let r of rects) {\r\n        p[0] = r.x;\r\n        p[1] = r.y;\r\n        mm.minmax(p);\r\n\r\n        p[0] += r.width;\r\n        p[1] += r.height;\r\n        mm.minmax(p);\r\n      }\r\n\r\n      let x = mm.min[0], y = mm.min[1];\r\n\r\n      x = Math.min(x, this.size[0]-(mm.max[0]-mm.min[0]));\r\n      y = Math.min(y, this.size[1]-(mm.max[1]-mm.min[1]));\r\n\r\n      container.style[\"left\"] = x + \"px\";\r\n      container.style[\"top\"] = y + \"px\";\r\n    }//*/\r\n\r\n    document.body.appendChild(container);\r\n    //this.shadow.appendChild(container);\r\n    this.setCSS();\r\n\r\n    this._popups.push(container);\r\n\r\n    let touchpick, mousepick, keydown;\r\n\r\n    let done = false;\r\n    let end = () => {\r\n      if (this._popup_safe) {\r\n        return;\r\n      }\r\n\r\n      if (done) return;\r\n\r\n      //this.ctx.screen.removeEventListener(\"touchstart\", touchpick, true);\r\n      //this.ctx.screen.removeEventListener(\"touchmove\", touchpick, true);\r\n      this.ctx.screen.removeEventListener(\"mousedown\", mousepick, true);\r\n      this.ctx.screen.removeEventListener(\"mousemove\", mousepick, {passive: true});\r\n      this.ctx.screen.removeEventListener(\"mouseup\", mousepick, true);\r\n      window.removeEventListener(\"keydown\", keydown);\r\n\r\n      done = true;\r\n      container.remove();\r\n    };\r\n\r\n    container.end = end;\r\n\r\n    let _remove = container.remove;\r\n    container.remove = function () {\r\n      if (arguments.length == 0) {\r\n        end();\r\n      }\r\n      _remove.apply(this, arguments);\r\n    };\r\n\r\n    container._ondestroy = () => {\r\n      end();\r\n    };\r\n\r\n    let bad_time = util.time_ms();\r\n    let last_pick_time = util.time_ms();\r\n\r\n    mousepick = (e, x, y, do_timeout = true) => {\r\n      if (!container.isConnected) {\r\n        end();\r\n        return;\r\n      }\r\n\r\n      if (sarea && sarea.area) {\r\n        sarea.area.push_ctx_active();\r\n        sarea.area.pop_ctx_active();\r\n      }\r\n      //console.log(\"=======================================================popup touch start\");\r\n      //console.log(e);\r\n\r\n      if (util.time_ms() - last_pick_time < 350) {\r\n        return;\r\n      }\r\n      last_pick_time = util.time_ms();\r\n\r\n      x = x === undefined ? e.x : x;\r\n      y = y === undefined ? e.y : y;\r\n\r\n      //let elem = this.pickElement(x, y, 2, 2, undefined, [ScreenBorder]);\r\n      let elem = this.pickElement(x, y, {\r\n        sx              : 2,\r\n        sy              : 2,\r\n        excluded_classes: [ScreenBorder],\r\n        mouseEvent      : e\r\n      });\r\n\r\n      let startelem = elem;\r\n\r\n      if (elem === undefined) {\r\n        if (closeOnMouseOut) {\r\n          end();\r\n        }\r\n        return;\r\n      }\r\n\r\n      let ok = false;\r\n      let elem2 = elem;\r\n\r\n      while (elem) {\r\n        if (elem === container) {\r\n          ok = true;\r\n          break;\r\n        }\r\n        elem = elem.parentWidget;\r\n      }\r\n\r\n      if (!ok) {\r\n        do_timeout = !do_timeout || (util.time_ms() - bad_time > 100);\r\n\r\n        if (closeOnMouseOut && do_timeout) {\r\n          end();\r\n        }\r\n      } else {\r\n        bad_time = util.time_ms();\r\n      }\r\n    };\r\n\r\n    touchpick = (e) => {\r\n      let x = e.touches[0].pageX, y = e.touches[0].pageY;\r\n\r\n      return mousepick(e, x, y, false);\r\n    };\r\n\r\n    keydown = (e) => {\r\n      if (!container.isConnected) {\r\n        window.removeEventListener(\"keydown\", keydown);\r\n        return;\r\n      }\r\n\r\n      switch (e.keyCode) {\r\n        case keymap[\"Escape\"]:\r\n          end();\r\n          break;\r\n      }\r\n    };\r\n\r\n    //this.ctx.screen.addEventListener(\"touchstart\", touchpick, true);\r\n    //this.ctx.screen.addEventListener(\"touchmove\", touchpick, true);\r\n    this.ctx.screen.addEventListener(\"mousedown\", mousepick, true);\r\n    this.ctx.screen.addEventListener(\"mousemove\", mousepick, {passive: true});\r\n    this.ctx.screen.addEventListener(\"mouseup\", mousepick, true);\r\n    window.addEventListener(\"keydown\", keydown);\r\n\r\n    /*\r\n    container.addEventListener(\"mouseleave\", (e) => {\r\n      console.log(\"popup mouse leave\");\r\n      if (closeOnMouseOut)\r\n        end();\r\n    });\r\n    container.addEventListener(\"mouseout\", (e) => {\r\n      console.log(\"popup mouse out\");\r\n      if (closeOnMouseOut)\r\n        end();\r\n    });\r\n    //*/\r\n\r\n    this.calcTabOrder();\r\n\r\n    return container;\r\n  }\r\n\r\n  _recalcAABB(save = true) {\r\n    let mm = new math.MinMax(2);\r\n\r\n    for (let v of this.screenverts) {\r\n      mm.minmax(v);\r\n    }\r\n\r\n    if (save) {\r\n      this._aabb[0].load(mm.min);\r\n      this._aabb[1].load(mm.max);\r\n    }\r\n\r\n    return [new Vector2(mm.min), new Vector2(mm.max)];\r\n  }\r\n\r\n  //XXX look at if this is referenced anywhere\r\n  load() {\r\n  }\r\n\r\n  //XXX look at if this is referenced anywhere\r\n  save() {\r\n  }\r\n\r\n  popupArea(area_class) {\r\n    return makePopupArea(area_class, this);\r\n  }\r\n\r\n  remove(trigger_destroy = true) {\r\n    this.unlisten();\r\n\r\n    if (trigger_destroy) {\r\n      return super.remove();\r\n    } else {\r\n      HTMLElement.prototype.remove.call(this);\r\n    }\r\n  }\r\n\r\n  unlisten() {\r\n    if (this.listen_timer !== undefined) {\r\n      window.clearInterval(this.listen_timer);\r\n      this.listen_timer = undefined;\r\n    }\r\n  }\r\n\r\n  checkCSSSize() {\r\n    let w = this.style.width.toLowerCase().trim();\r\n    let h = this.style.height.toLowerCase().trim();\r\n\r\n    if (w.endsWith(\"px\") && h.endsWith(\"px\")) {\r\n      w = parseFloat(w.slice(0, w.length - 2).trim());\r\n      h = parseFloat(h.slice(0, h.length - 2).trim());\r\n\r\n      if (w !== this.size[0] || h !== this.size[1]) {\r\n        this.on_resize([this.size[0], this.size[1]], [w, h]);\r\n        this.size[0] = w;\r\n        this.size[1] = h;\r\n      }\r\n    }\r\n  }\r\n\r\n  getBoolAttribute(attr, defaultval = false) {\r\n    if (!this.hasAttribute(attr)) {\r\n      return defaultval;\r\n    }\r\n\r\n    let ret = this.getAttribute(attr);\r\n\r\n    if (typeof ret === \"number\") {\r\n      return !!ret;\r\n    } else if (typeof ret === \"string\") {\r\n      ret = ret.toLowerCase().trim();\r\n      ret = ret === \"true\" || ret === \"1\" || ret === \"yes\";\r\n    }\r\n\r\n    return !!ret;\r\n  }\r\n\r\n  updateSize() {\r\n    if (this.getBoolAttribute(\"inherit-scale\") || !this.fullScreen || !cconst.autoSizeUpdate) {\r\n      this.checkCSSSize();\r\n      return;\r\n    }\r\n\r\n    let width = window.innerWidth;\r\n    let height = window.innerHeight;\r\n\r\n    let ratio = window.outerHeight/window.innerHeight;\r\n    let scale = visualViewport.scale;\r\n\r\n    let pad = 4;\r\n    width = visualViewport.width*scale - pad;\r\n    height = visualViewport.height*scale - pad;\r\n\r\n    let ox = visualViewport.offsetLeft;\r\n    let oy = visualViewport.offsetTop;\r\n\r\n    if (cconst.DEBUG.customWindowSize) {\r\n      let s = cconst.DEBUG.customWindowSize;\r\n      width = s.width;\r\n      height = s.height;\r\n      ox = 0;\r\n      oy = 0;\r\n      window._DEBUG = cconst.DEBUG;\r\n    }\r\n\r\n    let key = this._calcSizeKey(width, height, ox, oy, devicePixelRatio, scale);\r\n\r\n    /* CSS IS EVIL! WHY DOES BODY HAVE A MARGIN? */\r\n    document.body.style.margin = document.body.style.padding = \"0px\";\r\n    document.body.style[\"transform-origin\"] = \"top left\";\r\n    document.body.style[\"transform\"] = `translate(${ox}px,${oy}px) scale(${1.0/scale})`;\r\n\r\n    //document.body.style[\"transform\"] = `scale(${1.0 / scale}, ${1.0 / scale})`; // translate(${ox*scale2}px, ${oy*scale2}px)`;\r\n\r\n    if (key !== this._last_ckey1) {\r\n      //console.log(\"resizing\", key, this._last_ckey1);\r\n      this._last_ckey1 = key;\r\n\r\n      this.on_resize(this.size, [width, height], false);\r\n      this.on_resize(this.size, this.size, false);\r\n\r\n      let scale = visualViewport.scale;\r\n\r\n\r\n      this.regenBorders();\r\n\r\n      this.setCSS();\r\n      this.completeUpdate();\r\n    }\r\n  }\r\n\r\n  listen(args = {updateSize: true}) {\r\n    ui_menu.setWranglerScreen(this);\r\n\r\n    let ctx = this.ctx;\r\n    startEvents(() => ctx.screen);\r\n\r\n    if (this.listen_timer !== undefined) {\r\n      return; //already listening\r\n    }\r\n\r\n    this._do_updateSize = args.updateSize !== undefined ? args.updateSize : true;\r\n\r\n    this.listen_timer = window.setInterval(() => {\r\n      if (this.isDead()) {\r\n        console.log(\"dead screen\");\r\n        this.unlisten();\r\n        return;\r\n      }\r\n\r\n      this.update();\r\n    }, 150);\r\n  }\r\n\r\n  _calcSizeKey(w, h, x, y, dpi, scale) {\r\n    if (arguments.length !== 6) {\r\n      throw new Error(\"eek\");\r\n    }\r\n\r\n    let s = \"\";\r\n    for (let i = 0; i < arguments.length; i++) {\r\n      s += arguments[i].toFixed(0) + \":\";\r\n    }\r\n\r\n    return s;\r\n  }\r\n\r\n  _ondestroy() {\r\n    if (ui_menu.getWranglerScreen() === this) {\r\n      //ui_menu.setWranglerScreen(undefined);\r\n    }\r\n\r\n    this.unlisten();\r\n\r\n    //unlike other ondestroy functions, this one physically dismantles the DOM tree\r\n    let recurse = (n, second_pass, parent) => {\r\n      if (n.__pass === second_pass) {\r\n        console.warn(\"CYCLE IN DOM TREE!\", n, parent);\r\n        return;\r\n      }\r\n\r\n      n.__pass = second_pass;\r\n\r\n      n._forEachChildWidget(n2 => {\r\n        if (n === n2)\r\n          return;\r\n        recurse(n2, second_pass, n);\r\n\r\n        try {\r\n          if (!second_pass && !n2.__destroyed) {\r\n            n2.__destroyed = true;\r\n            n2._ondestroy();\r\n          }\r\n        } catch (error) {\r\n          print_stack(error);\r\n          console.log(\"failed to exectue an ondestroy callback\");\r\n        }\r\n\r\n        n2.__destroyed = true;\r\n\r\n        try {\r\n          if (second_pass) {\r\n            n2.remove();\r\n          }\r\n        } catch (error) {\r\n          print_stack(error);\r\n          console.log(\"failed to remove element after ondestroy callback\");\r\n        }\r\n      });\r\n    };\r\n\r\n    let id = ~~(Math.random()*1024*1024);\r\n\r\n    recurse(this, id);\r\n    recurse(this, id + 1);\r\n  }\r\n\r\n  destroy() {\r\n    this._ondestroy();\r\n  }\r\n\r\n  clear() {\r\n    this._ondestroy();\r\n\r\n    this.sareas = [];\r\n    this.sareas.active = undefined;\r\n\r\n    for (let child of list(this.childNodes)) {\r\n      child.remove();\r\n    }\r\n    for (let child of list(this.shadow.childNodes)) {\r\n      child.remove();\r\n    }\r\n  }\r\n\r\n  _test_save() {\r\n    let obj = JSON.parse(JSON.stringify(this));\r\n    console.log(JSON.stringify(this));\r\n\r\n    this.loadJSON(obj);\r\n  }\r\n\r\n  loadJSON(obj, schedule_resize = false) {\r\n    this.clear();\r\n    super.loadJSON();\r\n\r\n    for (let sarea of obj.sareas) {\r\n      let sarea2 = UIBase.createElement(\"screenarea-x\");\r\n\r\n      sarea2.ctx = this.ctx;\r\n      sarea2.screen = this;\r\n\r\n      this.appendChild(sarea2);\r\n\r\n      sarea2.loadJSON(sarea);\r\n    }\r\n\r\n    this.regenBorders();\r\n    this.setCSS();\r\n\r\n    if (schedule_resize) {\r\n      window.setTimeout(() => {\r\n        this.on_resize(this.size, [window.innerWidth, window.innerHeight]);\r\n      }, 50);\r\n    }\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = {\r\n      sareas: this.sareas\r\n    };\r\n\r\n    ret.size = this.size;\r\n    ret.idgen = this.idgen;\r\n\r\n    return Object.assign(super.toJSON(), ret);\r\n  }\r\n\r\n  getHotKey(toolpath) {\r\n    let test = (keymap) => {\r\n      for (let hk of keymap) {\r\n        if (typeof hk.action != \"string\")\r\n          continue;\r\n\r\n        if (hk.action.trim().startsWith(toolpath.trim())) {\r\n          return hk;\r\n        }\r\n      }\r\n    };\r\n\r\n    let ret = test(this.keymap);\r\n    if (ret)\r\n      return ret;\r\n\r\n    if (this.sareas.active && this.sareas.active.keymap) {\r\n      let area = this.sareas.active.area;\r\n\r\n      for (let keymap of area.getKeyMaps()) {\r\n        ret = test(keymap);\r\n\r\n        if (ret)\r\n          return ret;\r\n      }\r\n    }\r\n\r\n    if (ret === undefined) {\r\n      //just to be safe, check all areas in case the\r\n      //context is confused as to which area is currently \"active\"\r\n\r\n      for (let sarea of this.sareas) {\r\n        let area = sarea.area;\r\n\r\n        for (let keymap of area.getKeyMaps()) {\r\n          ret = test(keymap);\r\n\r\n          if (ret) {\r\n            return ret;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  addEventListener(type, cb, options) {\r\n    if (type === \"resize\") {\r\n      this._resize_callbacks.push(cb);\r\n    } else {\r\n      return super.addEventListener(type, cb, options);\r\n    }\r\n  }\r\n\r\n  removeEventListener(type, cb, options) {\r\n    if (type === \"resize\") {\r\n      if (this._resize_callbacks.indexOf(cb) >= 0)\r\n        this._resize_callbacks.remove(cb);\r\n    } else {\r\n      return super.removeEventListener(type, cb, options);\r\n    }\r\n  }\r\n\r\n  execKeyMap(e) {\r\n    let handled = false;\r\n\r\n    if (window.DEBUG && window.DEBUG.keymap) {\r\n      console.warn(\"execKeyMap called\", e.keyCode, document.activeElement.tagName);\r\n    }\r\n\r\n    if (this.sareas.active) {\r\n      let area = this.sareas.active.area;\r\n\r\n      if (!area) {\r\n        return;\r\n      }\r\n\r\n      area.push_ctx_active();\r\n\r\n      for (let keymap of area.getKeyMaps()) {\r\n        if (keymap === undefined) {\r\n          continue;\r\n        }\r\n\r\n        if (keymap.handle(area.ctx, e)) {\r\n          handled = true;\r\n          break;\r\n        }\r\n      }\r\n\r\n      area.pop_ctx_active();\r\n    }\r\n\r\n    handled = handled || this.keymap.handle(this.ctx, e);\r\n\r\n    if (!handled && this.testAllKeyMaps) {\r\n      for (let sarea of this.sareas) {\r\n        if (handled) {\r\n          break;\r\n        }\r\n\r\n        sarea.area.push_ctx_active();\r\n\r\n        for (let keymap of sarea.area.getKeyMaps()) {\r\n          if (keymap.handle(sarea.area.ctx, e)) {\r\n            handled = true;\r\n            break;\r\n          }\r\n        }\r\n\r\n        sarea.area.pop_ctx_active();\r\n      }\r\n    }\r\n\r\n    return handled;\r\n  }\r\n\r\n  calcTabOrder() {\r\n    let nodes = [];\r\n    let visit = {};\r\n\r\n    let rec = (n) => {\r\n      let bad = n.tabIndex < 0 || n.tabIndex === undefined || n.tabIndex === null;\r\n      bad = bad || !(n instanceof UIBase);\r\n\r\n      if (n._id in visit || n.hidden) {\r\n        return;\r\n      }\r\n\r\n      visit[n._id] = 1;\r\n\r\n      if (!bad) {\r\n        n.__pos = n.getClientRects()[0];\r\n        if (n.__pos) {\r\n          nodes.push(n);\r\n        }\r\n      }\r\n\r\n      n._forEachChildWidget((n2) => {\r\n        rec(n2);\r\n      });\r\n    };\r\n\r\n    for (let sarea of this.sareas) {\r\n      rec(sarea);\r\n    }\r\n\r\n    for (let popup of this._popups) {\r\n      rec(popup);\r\n    }\r\n\r\n    //console.log(\"nodes2\", nodes2);\r\n    for (let i = 0; i < nodes.length; i++) {\r\n      let n = nodes[i];\r\n\r\n      n.tabIndex = i + 1;\r\n      //console.log(n.tabIndex);\r\n    }\r\n  }\r\n\r\n  drawUpdate() {\r\n    if (window.redraw_all !== undefined) {\r\n      window.redraw_all();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    let move = [];\r\n    for (let child of this.childNodes) {\r\n      if (child instanceof ScreenArea) {\r\n        move.push(child);\r\n      }\r\n    }\r\n\r\n    for (let child of move) {\r\n      console.warn(\"moved screen area to shadow\");\r\n\r\n      HTMLElement.prototype.remove.call(child);\r\n      this.shadow.appendChild(child);\r\n    }\r\n\r\n    if (this._do_updateSize) {\r\n      this.updateSize();\r\n    }\r\n\r\n    if (this.needsTabRecalc) {\r\n      this.needsTabRecalc = false;\r\n      this.calcTabOrder();\r\n    }\r\n\r\n    outer: for (let sarea of this.sareas) {\r\n      for (let b of sarea._borders) {\r\n        let movable = this.isBorderMovable(b);\r\n\r\n        if (movable !== b.movable) {\r\n          console.log(\"detected change in movable borders\");\r\n          this.regenBorders();\r\n          break outer;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (this._update_gen) {\r\n      let ret;\r\n\r\n      /*\r\n      if (cconst.DEBUG.debugUIUpdatePerf) {\r\n          for (ret = this._update_gen.next(); !ret.done; ret = this._update_gen.next()) {}\r\n\r\n        this._update_gen = this.update_intern();\r\n        return;\r\n      }\r\n      //*/\r\n\r\n      try {\r\n        ret = this._update_gen.next();\r\n      } catch (error) {\r\n        if (!(error instanceof DataPathError)) {\r\n          util.print_stack(error);\r\n          console.log(\"error in update_intern tasklet\");\r\n        }\r\n        return;\r\n      }\r\n\r\n      if (ret !== undefined && ret.done) {\r\n        this._update_gen = undefined;\r\n      }\r\n    } else {\r\n      this._update_gen = this.update_intern();\r\n    }\r\n  }\r\n\r\n  purgeUpdateStack() {\r\n    this._update_gen = undefined;\r\n    purgeUpdateStack();\r\n  }\r\n\r\n  completeSetCSS() {\r\n    let rec = (n) => {\r\n      n.setCSS();\r\n\r\n      if (n.packflag & PackFlags.NO_UPDATE) {\r\n        return;\r\n      }\r\n\r\n      n._forEachChildWidget((c) => {\r\n        rec(c);\r\n      })\r\n    }\r\n\r\n    rec(this);\r\n  }\r\n\r\n  completeUpdate() {\r\n    for (let step of this.update_intern()) {\r\n    }\r\n  }\r\n\r\n  updateScrollStyling() {\r\n    let s = theme.scrollbars;\r\n\r\n    if (!s || !s.color) return;\r\n\r\n    let key = \"\" + s.color + \":\" + s.color2 + \":\" + s.border + \":\" + s.contrast + \":\" + s.width;\r\n\r\n    if (key !== this._last_scrollstyle_key) {\r\n      this._last_scrollstyle_key = key;\r\n\r\n      //console.log(\"updating scrollbar styling\");\r\n\r\n      this.mergeGlobalCSS(styleScrollBars(s.color, s.color2, s.contrast, s.width, s.border, \"*\"));\r\n    }\r\n  }\r\n\r\n  //XXX race condition warning\r\n  update_intern() {\r\n    this.updateScrollStyling();\r\n\r\n    let popups = this._popups;\r\n\r\n    let cssText = \"\";\r\n    let sheet = this.globalCSS.sheet;\r\n    if (sheet) {\r\n      for (let rule of sheet.rules) {\r\n        cssText += rule.cssText + \"\\n\";\r\n      }\r\n\r\n      window.cssText = cssText\r\n    }\r\n    let cssTextHash = util.strhash(cssText);\r\n\r\n    if (this.needsBorderRegen) {\r\n      this.needsBorderRegen = false;\r\n      this.regenBorders();\r\n    }\r\n\r\n    super.update();\r\n    let this2 = this;\r\n\r\n    //ensure each area has proper ctx set\r\n    for (let sarea of this.sareas) {\r\n      if (!sarea.ctx) {\r\n        sarea.ctx = this.ctx;\r\n      }\r\n    }\r\n\r\n    return (function* () {\r\n      let stack = update_stack;\r\n      stack.cur = 0;\r\n\r\n      let lastn = this2;\r\n\r\n      function push(n) {\r\n        stack[stack.cur++] = n;\r\n      }\r\n\r\n      function pop(n) {\r\n        if (stack.cur < 0) {\r\n          throw new Error(\"Screen.update(): stack overflow!\");\r\n        }\r\n\r\n        return stack[--stack.cur];\r\n      }\r\n\r\n      let ctx = this2.ctx;\r\n\r\n      let SCOPE_POP = Symbol(\"pop\");\r\n      let AREA_CTX_POP = Symbol(\"pop2\");\r\n\r\n      let scopestack = [];\r\n      let areastack = [];\r\n\r\n      let t = util.time_ms();\r\n      push(this2);\r\n\r\n      for (let p of popups) {\r\n        push(p);\r\n      }\r\n\r\n      while (stack.cur > 0) {\r\n        let n = pop();\r\n\r\n        if (n === undefined) {\r\n          //console.log(\"eek!\", stack.length);\r\n          continue;\r\n        } else if (n === SCOPE_POP) {\r\n          scopestack.pop();\r\n          continue;\r\n        } else if (n === AREA_CTX_POP) {\r\n          //console.log(\"POP\", areastack[areastack.length-1].constructor.name);\r\n          areastack.pop().pop_ctx_active(ctx, true);\r\n          continue;\r\n        }\r\n\r\n        if (n instanceof Area) {\r\n          //console.log(\"PUSH\", n.constructor.name);\r\n          areastack.push(n);\r\n          n.push_ctx_active(ctx, true);\r\n          push(AREA_CTX_POP);\r\n        }\r\n\r\n        if (!n.hidden && n !== this2 && n instanceof UIBase) {\r\n          if (!n._ctx) {\r\n            n._ctx = ctx;\r\n          }\r\n\r\n          if (n._screenStyleUpdateHash !== cssTextHash) {\r\n            n._screenStyleTag.textContent = cssText;\r\n            n._screenStyleUpdateHash = cssTextHash;\r\n          }\r\n\r\n          if (scopestack.length > 0 && scopestack[scopestack.length - 1]) {\r\n            n.parentWidget = scopestack[scopestack.length - 1];\r\n\r\n            //if (n.parentWidget && n._useDataPathUndo === undefined && n.parentWidget._useDataPathUndo !== undefined) {\r\n            //  n._useDataPathUndo = n.parentWidget._useDataPathUndo;\r\n            //}\r\n          }\r\n\r\n          n.update();\r\n        }\r\n\r\n        if (util.time_ms() - t > 20) {\r\n          yield;\r\n          t = util.time_ms();\r\n        }\r\n\r\n        for (let n2 of n.childNodes) {\r\n          if (!(n2 instanceof UIBase) || !(n2.packflag & PackFlags.NO_UPDATE)) {\r\n            push(n2);\r\n          }\r\n        }\r\n\r\n        if (n.shadow === undefined) {\r\n          continue;\r\n        }\r\n\r\n        for (let n2 of n.shadow.childNodes) {\r\n          if (!(n2 instanceof UIBase) || !(n2.packflag & PackFlags.NO_UPDATE)) {\r\n            push(n2);\r\n          }\r\n        }\r\n\r\n        if (n instanceof UIBase) {\r\n          if (!(n.packflag & PackFlags.NO_UPDATE)) {\r\n            scopestack.push(n);\r\n            push(SCOPE_POP);\r\n          }\r\n        }\r\n      }\r\n    })();\r\n  }\r\n\r\n  //load pos/size from screenverts\r\n  loadFromVerts() {\r\n    let old = [0, 0];\r\n    for (let sarea of this.sareas) {\r\n      old[0] = sarea.size[0];\r\n      old[1] = sarea.size[1];\r\n\r\n      sarea.loadFromVerts();\r\n      sarea.on_resize(old);\r\n      sarea.setCSS();\r\n    }\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  /** merges sarea into the screen area opposite to sarea*/\r\n  collapseArea(sarea, border) {\r\n    let sarea2;\r\n\r\n    if (!border) {\r\n      for (let b of sarea._borders) {\r\n        let sarea2 = b.getOtherSarea(sarea);\r\n\r\n        if (sarea2 && !b.locked) {\r\n          border = b;\r\n          break;\r\n        }\r\n      }\r\n    } else if (border.locked) {\r\n      console.warn(\"Cannot remove screen border\");\r\n    }\r\n\r\n    console.warn(\"SAREA2\", border, sarea2, sarea2 !== sarea);\r\n\r\n    if (border) {\r\n      sarea2 = border.getOtherSarea(sarea);\r\n\r\n      if (!sarea2) {\r\n        console.error(\"Error merging sarea\");\r\n        return;\r\n      }\r\n\r\n      let size1 = new Vector2(sarea.pos).add(sarea.size);\r\n      let size2 = new Vector2(sarea2.pos).add(sarea2.size);\r\n\r\n      sarea2.pos.min(sarea.pos);\r\n      sarea2.size.load(size1).max(size2).sub(sarea2.pos);\r\n\r\n      sarea2.loadFromPosSize();\r\n    }\r\n\r\n    this.sareas.remove(sarea);\r\n    sarea.remove();\r\n\r\n    this.regenScreenMesh();\r\n    this._internalRegenAll();\r\n\r\n    return this;\r\n  }\r\n\r\n  splitArea(sarea, t = 0.5, horiz = true) {\r\n    let w = sarea.size[0], h = sarea.size[1];\r\n    let x = sarea.pos[0], y = sarea.size[1];\r\n    let s1, s2;\r\n\r\n    if (!horiz) {\r\n      s1 = sarea;\r\n      if (s1.ctx === undefined) {\r\n        s1.ctx = this.ctx;\r\n      }\r\n      s2 = s1.copy(this);\r\n\r\n      s1.size[0] *= t;\r\n      s2.size[0] *= (1.0 - t);\r\n\r\n      s2.pos[0] += w*t;\r\n    } else {\r\n      s1 = sarea;\r\n      if (s1.ctx === undefined) {\r\n        s1.ctx = this.ctx;\r\n      }\r\n      s2 = s1.copy(this);\r\n\r\n      s1.size[1] *= t;\r\n      s2.size[1] *= (1.0 - t);\r\n\r\n      s2.pos[1] += h*t;\r\n    }\r\n\r\n    s2.ctx = this.ctx;\r\n    this.appendChild(s2);\r\n\r\n    s1.on_resize(s1.size);\r\n    s2.on_resize(s2.size);\r\n\r\n    this.regenBorders();\r\n    this.solveAreaConstraints();\r\n\r\n    s1.setCSS();\r\n    s2.setCSS();\r\n\r\n    this.setCSS();\r\n\r\n    //XXX not sure if this is right place to do this or really necassary\r\n    if (s2.area !== undefined)\r\n      s2.area.onadd();\r\n\r\n    return s2;\r\n  }\r\n\r\n  setCSS() {\r\n    if (!this.getBoolAttribute(\"inherit-scale\")) {\r\n      this.style[\"width\"] = this.size[0] + \"px\";\r\n      this.style[\"height\"] = this.size[1] + \"px\";\r\n    }\r\n\r\n    this.style[\"overflow\"] = \"hidden\";\r\n\r\n    //call setCSS on borders\r\n    for (let key in this._edgemap) {\r\n      let b = this._edgemap[key];\r\n\r\n      b.setCSS();\r\n    }\r\n  }\r\n\r\n  regenScreenMesh(snapLimit = SnapLimit) {\r\n    this.snapLimit = snapLimit;\r\n\r\n    this.regenBorders();\r\n  }\r\n\r\n  regenBorders_stage2() {\r\n    for (let b of this.screenborders) {\r\n      b.halfedges = []\r\n    }\r\n\r\n    function hashHalfEdge(border, sarea) {\r\n      return border._id + \":\" + sarea._id;\r\n    }\r\n\r\n    function has_he(border, border2, sarea) {\r\n      for (let he of border.halfedges) {\r\n        if (border2 === he.border && sarea === he.sarea) {\r\n          return true;\r\n        }\r\n      }\r\n\r\n      return false;\r\n    }\r\n\r\n    for (let b1 of this.screenborders) {\r\n      for (let sarea of b1.sareas) {\r\n        let he = new ScreenHalfEdge(b1, sarea);\r\n        b1.halfedges.push(he);\r\n      }\r\n\r\n      let axis = b1.horiz ? 1 : 0;\r\n\r\n      let min = Math.min(b1.v1[axis], b1.v2[axis]);\r\n      let max = Math.max(b1.v1[axis], b1.v2[axis]);\r\n\r\n      for (let b2 of this.walkBorderLine(b1)) {\r\n        if (b1 === b2) {\r\n          continue;\r\n        }\r\n\r\n        let ok = b2.v1[axis] >= min && b2.v1[axis] <= max;\r\n        ok = ok || (b2.v2[axis] >= min && b2.v2[axis] <= max);\r\n\r\n        for (let sarea of b2.sareas) {\r\n          let ok2 = ok && !has_he(b2, b1, sarea);\r\n          if (ok2) {\r\n            let he2 = new ScreenHalfEdge(b2, sarea);\r\n            b1.halfedges.push(he2);\r\n          }\r\n        }\r\n\r\n      }\r\n    }\r\n\r\n\r\n    for (let b of this.screenborders) {\r\n      let movable = true;\r\n\r\n      for (let sarea of b.sareas) {\r\n        movable = movable && this.isBorderMovable(b);\r\n      }\r\n\r\n      b.movable = movable;\r\n    }\r\n  }\r\n\r\n  hasBorder(b) {\r\n    return b._id in this._idmap;\r\n  }\r\n\r\n  killScreenVertex(v) {\r\n    this.screenverts.remove(v);\r\n\r\n    delete this._edgemap[ScreenVert.hash(v, undefined, this.snapLimit)];\r\n    delete this._idmap[v._id];\r\n\r\n    return this;\r\n  }\r\n\r\n  freeBorder(b, sarea) {\r\n    if (b.sareas.indexOf(sarea) >= 0) {\r\n      b.sareas.remove(sarea);\r\n    }\r\n\r\n    let dels = [];\r\n\r\n    for (let he of b.halfedges) {\r\n      if (he.sarea === sarea) {\r\n        dels.push([b, he]);\r\n      }\r\n\r\n      for (let he2 of he.border.halfedges) {\r\n        if (he2 === he)\r\n          continue;\r\n\r\n        if (he2.sarea === sarea) {\r\n          dels.push([he.border, he2]);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let d of dels) {\r\n      if (d[0].halfedges.indexOf(d[1]) < 0) {\r\n        console.warn(\"Double remove detected; use util.set?\");\r\n        continue;\r\n      }\r\n\r\n      d[0].halfedges.remove(d[1]);\r\n    }\r\n\r\n    if (b.sareas.length === 0) {\r\n      this.killBorder(b);\r\n    }\r\n  }\r\n\r\n  killBorder(b) {\r\n    console.log(\"killing border\", b._id, b);\r\n\r\n    if (this.screenborders.indexOf(b) < 0) {\r\n      console.log(\"unknown border\", b);\r\n      b.remove();\r\n      return;\r\n    }\r\n\r\n    this.screenborders.remove(b);\r\n\r\n    let del = [];\r\n\r\n    for (let he of b.halfedges) {\r\n      if (he === he2)\r\n        continue;\r\n\r\n      for (let he2 of he.border.halfedges) {\r\n        if (he2.border === b) {\r\n          del.push([he.border, he2]);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let d of del) {\r\n      d[0].halfedges.remove(d[1]);\r\n    }\r\n\r\n    delete this._edgemap[ScreenBorder.hash(b.v1, b.v2)];\r\n    delete this._idmap[b._id];\r\n\r\n    b.v1.borders.remove(b);\r\n    b.v2.borders.remove(b);\r\n\r\n    if (b.v1.borders.length === 0) {\r\n      this.killScreenVertex(b.v1);\r\n    }\r\n    if (b.v2.borders.length === 0) {\r\n      this.killScreenVertex(b.v2);\r\n    }\r\n\r\n    b.remove();\r\n\r\n    return this;\r\n  }\r\n\r\n  //XXX rename to regenScreenMesh\r\n  regenBorders() {\r\n    for (let b of this.screenborders) {\r\n      b.remove();\r\n    }\r\n\r\n    this._idmap = {};\r\n    this.screenborders = [];\r\n    this._edgemap = {};\r\n    this._vertmap = {};\r\n    this.screenverts = []\r\n\r\n    for (let sarea of this.sareas) {\r\n      if (sarea.hidden) continue;\r\n\r\n      sarea.makeBorders(this);\r\n    }\r\n\r\n    for (let key in this._edgemap) {\r\n      let b = this._edgemap[key];\r\n\r\n      b.setCSS();\r\n    }\r\n\r\n    this.regenBorders_stage2();\r\n    this._recalcAABB();\r\n\r\n    for (let b of this.screenborders) {\r\n      b.outer = this.isBorderOuter(b);\r\n      b.movable = this.isBorderMovable(b);\r\n      b.setCSS();\r\n    }\r\n\r\n    this.updateDebugBoxes();\r\n  }\r\n\r\n  _get_debug_overlay() {\r\n    if (!this._debug_overlay) {\r\n      this._debug_overlay = UIBase.createElement(\"overdraw-x\");\r\n      let s = this._debug_overlay;\r\n\r\n      s.startNode(this, this);\r\n    }\r\n\r\n    return this._debug_overlay;\r\n  }\r\n\r\n  updateDebugBoxes() {\r\n    if (cconst.DEBUG.screenborders) {\r\n      let overlay = this._get_debug_overlay();\r\n      overlay.clear();\r\n\r\n      for (let b of this.screenborders) {\r\n        overlay.line(b.v1, b.v2, \"red\");\r\n      }\r\n      let del = [];\r\n      for (let child of document.body.childNodes) {\r\n        if (child.getAttribute && child.getAttribute(\"class\") === \"__debug\") {\r\n          del.push(child);\r\n        }\r\n      }\r\n      for (let n of del) {\r\n        n.remove();\r\n      }\r\n\r\n      let box = (x, y, s, text, color = \"red\") => {\r\n        x -= s*0.5;\r\n        y -= s*0.5;\r\n\r\n        x = Math.min(Math.max(x, 0.0), this.size[0] - s);\r\n        y = Math.min(Math.max(y, 0.0), this.size[1] - s);\r\n\r\n        let ret = UIBase.createElement(\"div\");\r\n        ret.setAttribute(\"class\", \"__debug\");\r\n\r\n\r\n        ret.style[\"position\"] = UIBase.PositionKey;\r\n        ret.style[\"left\"] = x + \"px\";\r\n        ret.style[\"top\"] = y + \"px\";\r\n        ret.style[\"height\"] = s + \"px\";\r\n        ret.style[\"width\"] = s + \"px\";//\"200px\";\r\n        ret.style[\"z-index\"] = \"1000\";\r\n        ret.style[\"pointer-events\"] = \"none\";\r\n        ret.style[\"padding\"] = ret.style[\"margin\"] = \"0px\";\r\n        ret.style['display'] = \"float\";\r\n        ret.style[\"background-color\"] = color;\r\n        document.body.appendChild(ret);\r\n\r\n        let colors = [\r\n          \"orange\",\r\n          \"black\",\r\n          \"white\",\r\n        ];\r\n\r\n        for (let i = 2; i >= 0; i--) {\r\n          ret = UIBase.createElement(\"div\");\r\n\r\n          ret.setAttribute(\"class\", \"__debug\");\r\n\r\n          ret.style[\"position\"] = UIBase.PositionKey;\r\n          ret.style[\"left\"] = x + \"px\";\r\n          ret.style[\"top\"] = y + \"px\";\r\n          ret.style[\"height\"] = s + \"px\";\r\n          ret.style[\"width\"] = \"250px\";//\"200px\";\r\n          ret.style[\"z-index\"] = \"\" + (1005 - i - 1);\r\n          ret.style[\"pointer-events\"] = \"none\";\r\n          ret.style[\"color\"] = colors[i];\r\n\r\n          let w = (i)*2;\r\n          ret.style[\"-webkit-text-stroke-width\"] = w + \"px\";\r\n          ret.style[\"-webkit-text-stroke-color\"] = colors[i];\r\n          ret.style[\"text-stroke-width\"] = w + \"px\";\r\n          ret.style[\"text-stroke-color\"] = colors[i];\r\n\r\n          ret.style[\"padding\"] = ret.style[\"margin\"] = \"0px\";\r\n          ret.style['display'] = \"float\";\r\n          ret.style[\"background-color\"] = \"rgba(0,0,0,0)\";\r\n          ret.innerText = \"\" + text;\r\n          document.body.appendChild(ret);\r\n        }\r\n\r\n      };\r\n\r\n      for (let v of this.screenverts) {\r\n        box(v[0], v[1], 10*v.borders.length, \"\" + v.borders.length, \"rgba(255,0,0,0.5)\");\r\n      }\r\n\r\n      for (let b of this.screenborders) {\r\n        for (let he of b.halfedges) {\r\n          let txt = `${he.side}, ${b.sareas.length}, ${b.halfedges.length}`;\r\n          let p = new Vector2(b.v1).add(b.v2).mulScalar(0.5);\r\n          let size = 10*b.halfedges.length;\r\n\r\n          let wadd = 25 + size*0.5;\r\n          let axis = b.horiz & 1;\r\n\r\n          if (p[axis] > he.sarea.pos[axis]) {\r\n            p[axis] -= wadd;\r\n          } else {\r\n            p[axis] += wadd;\r\n          }\r\n          box(p[0], p[1], size, txt, \"rgba(155,255,75,0.5)\")\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  checkAreaConstraint(sarea, checkOnly = false) {\r\n    let min = sarea.minSize, max = sarea.maxSize;\r\n    let vs = sarea._verts;\r\n    let chg = 0.0;\r\n    let mask = 0;\r\n\r\n    let moveBorder = (sidea, sideb, dh) => {\r\n      let b1 = sarea._borders[sidea];\r\n      let b2 = sarea._borders[sideb];\r\n      let bad = 0;\r\n\r\n      for (let i = 0; i < 2; i++) {\r\n        let b = i ? b2 : b1;\r\n        let bad2 = sarea.borderLock & (1<<sidea);\r\n\r\n        bad2 = bad2 || !b.movable;\r\n        bad2 = bad2 || this.isBorderOuter(b);\r\n\r\n        if (bad2)\r\n          bad |= 1<<i;\r\n      }\r\n\r\n      if (bad === 0) {\r\n        this.moveBorder(b1, dh*0.5);\r\n        this.moveBorder(b2, -dh*0.5);\r\n      } else if (bad === 1) {\r\n        this.moveBorder(b2, -dh);\r\n      } else if (bad === 2) {\r\n        this.moveBorder(b1, dh);\r\n      } else if (bad === 3) {\r\n        //both borders are bad, yet we need to move anyway. . .\r\n        //console.warn(\"got case of two borders being bad\");\r\n\r\n        if (!this.isBorderOuter(b1)) {\r\n          this.moveBorder(b1, dh);\r\n        } else if (!this.isBorderOuter(b2)) {\r\n          this.moveBorder(b2, -dh);\r\n        } else {\r\n          this.moveBorder(b1, dh*0.5);\r\n          this.moveBorder(b2, -dh*0.5);\r\n        }\r\n      }\r\n    };\r\n\r\n    if (max[0] !== undefined && sarea.size[0] > max[0]) {\r\n      let dh = (sarea.size[0] - max[0]);\r\n      chg += Math.abs(dh);\r\n      mask |= 1;\r\n\r\n      moveBorder(0, 2, dh);\r\n    }\r\n\r\n    if (min[0] !== undefined && sarea.size[0] < min[0]) {\r\n      let dh = (min[0] - sarea.size[0]);\r\n      chg += Math.abs(dh);\r\n      mask |= 2;\r\n\r\n      moveBorder(2, 0, dh);\r\n    }\r\n\r\n\r\n    if (max[1] !== undefined && sarea.size[1] > max[1]) {\r\n      let dh = (sarea.size[1] - max[1]);\r\n      chg += Math.abs(dh);\r\n      mask |= 4;\r\n\r\n      moveBorder(3, 1, dh);\r\n    }\r\n\r\n    if (min[1] !== undefined && sarea.size[1] < min[1]) {\r\n      let dh = (min[1] - sarea.size[1]);\r\n      chg += Math.abs(dh);\r\n      mask |= 8;\r\n\r\n      moveBorder(1, 3, dh);\r\n    }\r\n\r\n    if (sarea.pos[0] + sarea.size[0] > this.size[0]) {\r\n      mask |= 16;\r\n      let dh = ((this.size[0] - sarea.size[0]) - sarea.pos[0]);\r\n\r\n      chg += Math.abs(dh);\r\n\r\n      if (sarea.floating) {\r\n        sarea.pos[0] = this.size[0] - sarea.size[0];\r\n        sarea.loadFromPosSize();\r\n      } else {\r\n        this.moveBorder(sarea._borders[0], dh);\r\n        this.moveBorder(sarea._borders[2], dh);\r\n      }\r\n    }\r\n\r\n    if (chg === 0.0) {\r\n      return false;\r\n    }\r\n\r\n    return mask;\r\n  }\r\n\r\n  walkBorderLine(b) {\r\n    let visit = new util.set();\r\n    let ret = [b];\r\n    visit.add(b);\r\n\r\n    let rec = (b, v) => {\r\n      for (let b2 of v.borders) {\r\n        if (b2 === b) {\r\n          continue;\r\n        }\r\n\r\n        if (b2.horiz === b.horiz && !visit.has(b2)) {\r\n          visit.add(b2);\r\n          ret.push(b2);\r\n          rec(b2, b2.otherVertex(v));\r\n        }\r\n      }\r\n    }\r\n\r\n    rec(b, b.v1);\r\n    let ret2 = ret;\r\n    ret = [];\r\n\r\n    rec(b, b.v2);\r\n    ret2.reverse();\r\n\r\n    return ret2.concat(ret);\r\n  }\r\n\r\n  moveBorderWithoutVerts(halfedge, df) {\r\n    let side = halfedge.side;\r\n    let sarea = halfedge.sarea;\r\n\r\n    switch (side) {\r\n      case 0:\r\n        sarea.pos[0] += df;\r\n        sarea.size[0] -= df;\r\n        break;\r\n      case 1:\r\n        sarea.size[1] += df;\r\n        break;\r\n      case 2:\r\n        sarea.size[0] += df;\r\n        break;\r\n      case 3:\r\n        sarea.pos[1] += df;\r\n        sarea.size[1] -= df;\r\n        break;\r\n    }\r\n  }\r\n\r\n  moveBorder(b, df, strict = true) {\r\n    return this.moveBorderSimple(b, df, strict);\r\n  }\r\n\r\n  moveBorderSimple(b, df, strict = true) {\r\n    let axis = b.horiz & 1;\r\n    let axis2 = axis ^ 1;\r\n\r\n    let min = Math.min(b.v1[axis2], b.v2[axis2]);\r\n    let max = Math.max(b.v1[axis2], b.v2[axis2]);\r\n\r\n    let test = (v) => {\r\n      return v[axis2] >= min && v[axis2] <= max;\r\n    };\r\n\r\n    let vs = new util.set();\r\n\r\n    for (let b2 of this.walkBorderLine(b)) {\r\n      if (strict && !test(b2.v1) && !test(b2.v2)) {\r\n        return false;\r\n      }\r\n\r\n      vs.add(b2.v1);\r\n      vs.add(b2.v2);\r\n    }\r\n\r\n    for (let v of vs) {\r\n      v[axis] += df;\r\n    }\r\n\r\n    for (let v of vs) {\r\n      for (let b of v.borders) {\r\n        for (let sarea of b.sareas) {\r\n          sarea.loadFromVerts();\r\n        }\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  moveBorderUnused(b, df, strict = true) {\r\n    if (!b) {\r\n      console.warn(\"missing border\");\r\n      return false;\r\n    }\r\n\r\n    let axis = b.horiz & 1;\r\n\r\n    let vs = new util.set();\r\n\r\n    let visit = new util.set();\r\n\r\n    let axis2 = axis ^ 1;\r\n\r\n    let min = Math.min(b.v1[axis2], b.v2[axis2]);\r\n    let max = Math.max(b.v1[axis2], b.v2[axis2]);\r\n\r\n    let test = (v) => {\r\n      return v[axis2] >= min && v[axis2] <= max;\r\n    };\r\n\r\n    let first = true;\r\n    let found = false;\r\n    let halfedges = new util.set();\r\n    let borders = new util.set();\r\n\r\n    for (let b2 of this.walkBorderLine(b)) {\r\n      /*\r\n      if (first) {\r\n        first = false;\r\n        df = Math.max(Math.abs(df), FrameManager_mesh.SnapLimit) * Math.sign(df);\r\n      }\r\n      found = true;\r\n      for (let sarea of b2.sareas) {\r\n        halfedges.add(new ScreenHalfEdge(b2, sarea))\r\n      }\r\n      vs.add(b2.v1);\r\n      vs.add(b2.v2);\r\n      continue;\r\n      //*/\r\n\r\n      if (!strict) {\r\n        vs.add(b2.v1);\r\n        vs.add(b2.v2);\r\n        continue;\r\n      }\r\n\r\n\r\n      let t1 = test(b2.v1), t2 = test(b2.v2);\r\n\r\n      if (!t1 || !t2) {\r\n        found = true;\r\n\r\n        if (first) {\r\n          first = false;\r\n          df = Math.max(Math.abs(df), FrameManager_mesh.SnapLimit)*Math.sign(df);\r\n        }\r\n      }\r\n      if (!t1 && !t2) {\r\n        continue;\r\n      }\r\n\r\n      borders.add(b2);\r\n\r\n      //make dummy half edges to keep track of border/sarea pairs\r\n      //and especailly what the border side is\r\n      for (let sarea of b2.sareas) {\r\n        halfedges.add(new ScreenHalfEdge(b2, sarea))\r\n      }\r\n\r\n      vs.add(b2.v1);\r\n      vs.add(b2.v2);\r\n    }\r\n\r\n    for (let b2 of this.walkBorderLine(b)) {\r\n      if (borders.has(b2)) {\r\n        continue;\r\n      }\r\n\r\n      for (let he of b2.halfedges) {\r\n        borders.remove(he.border);\r\n        if (halfedges.has(he)) {\r\n          halfedges.remove(he);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let v of vs) {\r\n      let ok = v[axis2] >= min && v[axis2] <= max;\r\n\r\n      if (!ok && strict) {\r\n        //   return false;\r\n      }\r\n    }\r\n\r\n    if (!found || !strict) {\r\n      for (let v of vs) {\r\n        v[axis] += df;\r\n      }\r\n    } else {\r\n      let borders = new util.set();\r\n\r\n      for (let he of halfedges) {\r\n        borders.add(he.border);\r\n        this.moveBorderWithoutVerts(he, df);\r\n      }\r\n\r\n      for (let he of halfedges) {\r\n        he.sarea.loadFromPosSize();\r\n      }\r\n\r\n      for (let b of borders) {\r\n        let sareas = b.sareas.slice(0, b.sareas.length);\r\n\r\n        this.killBorder(b);\r\n        for (let sarea of sareas) {\r\n          sarea.loadFromPosSize();\r\n        }\r\n      }\r\n\r\n      return halfedges.length > 0;\r\n    }\r\n\r\n\r\n    for (let sarea of b.sareas) {\r\n      sarea.loadFromVerts();\r\n    }\r\n\r\n    for (let he of b.halfedges) {\r\n      he.sarea.loadFromVerts();\r\n\r\n      for (let sarea of he.border.sareas) {\r\n        sarea.loadFromVerts();\r\n        for (let b2 of sarea._borders) {\r\n          b2.setCSS();\r\n        }\r\n      }\r\n    }\r\n\r\n    b.setCSS();\r\n\r\n    return true;\r\n  }\r\n\r\n  solveAreaConstraints(snapArgument = true) {\r\n    let repeat = false;\r\n    let found = false;\r\n\r\n    let time = util.time_ms();\r\n\r\n    for (let i = 0; i < 10; i++) {\r\n      repeat = false;\r\n\r\n      for (let sarea of this.sareas) {\r\n        if (sarea.hidden) continue;\r\n\r\n        repeat = repeat || this.checkAreaConstraint(sarea);\r\n      }\r\n\r\n      found = found || repeat;\r\n\r\n      if (repeat) {\r\n        for (let sarea of this.sareas) {\r\n          sarea.loadFromVerts();\r\n        }\r\n\r\n        this.snapScreenVerts(snapArgument);\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (found) {\r\n      this.snapScreenVerts(snapArgument);\r\n      if (cconst.DEBUG.areaConstraintSolver) {\r\n        time = util.time_ms() - time;\r\n\r\n        console.log(`enforced area constraint ${time.toFixed(2)}ms`);\r\n      }\r\n      this._recalcAABB();\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  snapScreenVerts(fitToSize = true) {\r\n    let this2 = this;\r\n\r\n    function* screenverts() {\r\n      for (let v of this2.screenverts) {\r\n        let ok = 0;\r\n\r\n        for (let sarea of v.sareas) {\r\n          if (!(sarea.flag & AreaFlags.INDEPENDENT)) {\r\n            ok = 1;\r\n          }\r\n        }\r\n\r\n        if (ok) {\r\n          yield v;\r\n        }\r\n      }\r\n    }\r\n\r\n    let mm = new math.MinMax(2);\r\n    for (let v of screenverts()) {\r\n      mm.minmax(v);\r\n    }\r\n\r\n    let min = mm.min, max = mm.max;\r\n\r\n    //snap(min);\r\n    //snapi(max);\r\n\r\n    if (fitToSize) {\r\n      //fit entire screen to, well, the entire screen (size)\r\n      let vec = new Vector2(max).sub(min);\r\n      let sz = new Vector2(this.size);\r\n\r\n      sz.div(vec);\r\n\r\n      for (let v of screenverts()) {\r\n        v.sub(min).mul(sz);\r\n        //snap(v.sub(min).mul(sz));//.add(this.pos);\r\n      }\r\n\r\n      for (let v of screenverts()) {\r\n        v[0] += this.pos[0];\r\n        v[1] += this.pos[1];\r\n      }\r\n\r\n      //this.pos.zero();\r\n    } else {\r\n      for (let v of screenverts()) {\r\n        //snap(v);\r\n      }\r\n\r\n      [min, max] = this._recalcAABB();\r\n\r\n      //snap(min);\r\n      //snapi(max);\r\n\r\n      this.size.load(max).sub(min);\r\n      //this.pos.zero();\r\n      //this.pos.load(min);\r\n    }\r\n\r\n    let found = 1;\r\n\r\n    for (let sarea of this.sareas) {\r\n      if (sarea.hidden) continue;\r\n\r\n      let old = new Vector2(sarea.size);\r\n      let oldpos = new Vector2(sarea.pos);\r\n\r\n      sarea.loadFromVerts();\r\n\r\n      found = found || old.vectorDistance(sarea.size) > 1;\r\n      found = found || oldpos.vectorDistance(sarea.pos) > 1;\r\n\r\n      sarea.on_resize(old);\r\n    }\r\n\r\n    if (found) {\r\n      //this.regenBorders();\r\n      this._recalcAABB();\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  on_resize(oldsize, newsize = this.size, _set_key = true) {\r\n    //console.warn(\"resizing\");\r\n\r\n    if (_set_key) {\r\n      this._last_ckey1 = this._calcSizeKey(newsize[0], newsize[1], this.pos[0], this.pos[1], devicePixelRatio, visualViewport.scale);\r\n    }\r\n\r\n    let ratio = [newsize[0]/oldsize[0], newsize[1]/oldsize[1]];\r\n\r\n    let offx = this.pos[0] - this.oldpos[0];\r\n    let offy = this.pos[1] - this.oldpos[1];\r\n\r\n    this.oldpos.load(this.pos);\r\n\r\n    //console.log(\"resize!\", ratio);\r\n\r\n    for (let v of this.screenverts) {\r\n      v[0] *= ratio[0];\r\n      v[1] *= ratio[1];\r\n      v[0] += offx;\r\n      v[1] += offy;\r\n    }\r\n\r\n    let min = [1e17, 1e17], max = [-1e17, -1e17];\r\n    let olds = [];\r\n\r\n    for (let sarea of this.sareas) {\r\n      olds.push([sarea.size[0], sarea.size[1]]);\r\n\r\n      sarea.loadFromVerts();\r\n    }\r\n\r\n    this.size[0] = newsize[0];\r\n    this.size[1] = newsize[1];\r\n\r\n    this.snapScreenVerts();\r\n    this.solveAreaConstraints();\r\n    this._recalcAABB();\r\n\r\n\r\n    let i = 0;\r\n    for (let sarea of this.sareas) {\r\n      sarea.on_resize(sarea.size, olds[i]);\r\n      sarea.setCSS();\r\n      i++;\r\n    }\r\n\r\n    this.regenBorders();\r\n    this.setCSS();\r\n    this.calcTabOrder();\r\n\r\n    this._fireResizeCB(oldsize);\r\n  }\r\n\r\n  _fireResizeCB(oldsize = this.size) {\r\n    for (let cb of this._resize_callbacks) {\r\n      cb(oldsize);\r\n    }\r\n  }\r\n\r\n  getScreenVert(pos, added_id = \"\", floating = false) {\r\n    let key = ScreenVert.hash(pos, added_id, this.snapLimit);\r\n\r\n    if (floating || !(key in this._vertmap)) {\r\n      let v = new ScreenVert(pos, this.idgen++, added_id);\r\n\r\n      this._vertmap[key] = v;\r\n      this._idmap[v._id] = v;\r\n\r\n      this.screenverts.push(v);\r\n    }\r\n\r\n    return this._vertmap[key];\r\n  }\r\n\r\n  isBorderOuter(border) {\r\n    let sides = 0;\r\n\r\n    for (let he of border.halfedges) {\r\n      sides |= 1<<he.side;\r\n    }\r\n\r\n    let bits = 0;\r\n    for (let i = 0; i < 4; i++) {\r\n      bits += (sides & (1<<i)) ? 1 : 0;\r\n    }\r\n\r\n    let ret = bits < 2;\r\n    let floating = false;\r\n\r\n    for (let sarea of border.sareas) {\r\n      floating = floating || sarea.floating;\r\n    }\r\n\r\n    if (floating) {\r\n      //check if border is on screen limits\r\n      let axis = border.horiz ? 1 : 0;\r\n\r\n      ret = Math.abs(border.v1[axis] - this.pos[axis]) < 4;\r\n      ret = ret || Math.abs(border.v1[axis] - this.pos[axis] - this.size[axis]) < 4;\r\n    }\r\n\r\n    border.outer = ret;\r\n    return ret;\r\n  }\r\n\r\n  isBorderMovable(b, limit = 5) {\r\n    if (this.allBordersMovable)\r\n      return true;\r\n\r\n    for (let he of b.halfedges) {\r\n      if (he.sarea.borderLock & (1<<he.side)) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    let ok = !this.isBorderOuter(b);\r\n\r\n    for (let sarea of b.sareas) {\r\n      if (sarea.floating) {\r\n        ok = true;\r\n        break;\r\n      }\r\n    }\r\n\r\n    return ok;\r\n  }\r\n\r\n  getScreenBorder(sarea, v1, v2, side) {\r\n    let suffix = sarea._get_v_suffix();\r\n\r\n    if (!(v1 instanceof ScreenVert)) {\r\n      v1 = this.getScreenVert(v1, suffix);\r\n    }\r\n\r\n    if (!(v2 instanceof ScreenVert)) {\r\n      v2 = this.getScreenVert(v2, suffix);\r\n    }\r\n\r\n    let hash = ScreenBorder.hash(v1, v2);\r\n\r\n    if (!(hash in this._edgemap)) {\r\n      let sb = this._edgemap[hash] = UIBase.createElement(\"screenborder-x\");\r\n\r\n      sb._hash = hash;\r\n      sb.screen = this;\r\n      sb.v1 = v1;\r\n      sb.v2 = v2;\r\n      sb._id = this.idgen++;\r\n\r\n      v1.borders.push(sb);\r\n      v2.borders.push(sb);\r\n\r\n      sb.ctx = this.ctx;\r\n\r\n      this.screenborders.push(sb);\r\n      this.appendChild(sb);\r\n\r\n      sb.setCSS();\r\n\r\n      this._edgemap[hash] = sb;\r\n      this._idmap[sb._id] = sb;\r\n    }\r\n\r\n    return this._edgemap[hash];\r\n  }\r\n\r\n  minmaxArea(sarea, mm = undefined) {\r\n    if (mm === undefined) {\r\n      mm = new math.MinMax(2);\r\n    }\r\n\r\n    for (let b of sarea._borders) {\r\n      mm.minmax(b.v1);\r\n      mm.minmax(b.v2);\r\n    }\r\n\r\n    return mm;\r\n  }\r\n\r\n  //does sarea1 border sarea2?\r\n  areasBorder(sarea1, sarea2) {\r\n    for (let b of sarea1._borders) {\r\n      for (let sa of b.sareas) {\r\n        if (sa === sarea2)\r\n          return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  //regenerates borders, sets css and calls this.update\r\n\r\n  replaceArea(dst, src) {\r\n    if (dst === src)\r\n      return;\r\n\r\n    src.pos[0] = dst.pos[0];\r\n    src.pos[1] = dst.pos[1];\r\n    src.size[0] = dst.size[0];\r\n    src.size[1] = dst.size[1];\r\n\r\n    src.floating = dst.floating;\r\n    src._borders = dst._borders;\r\n    src._verts = dst._verts;\r\n\r\n    if (this.sareas.indexOf(src) < 0) {\r\n      this.sareas.push(src);\r\n      this.shadow.appendChild(src);\r\n    }\r\n\r\n    if (this.sareas.active === dst) {\r\n      this.sareas.active = src;\r\n    }\r\n\r\n    //this.sareas.remove(dst);\r\n    //dst.remove();\r\n\r\n    this.sareas.remove(dst);\r\n    dst.remove();\r\n\r\n    this.regenScreenMesh();\r\n    this.snapScreenVerts();\r\n    this._updateAll();\r\n  }\r\n\r\n  _internalRegenAll() {\r\n    this.snapScreenVerts();\r\n    this._recalcAABB();\r\n    this.calcTabOrder();\r\n    this.setCSS();\r\n\r\n    this.completeUpdate();\r\n    this.completeSetCSS();\r\n    this.completeUpdate();\r\n  }\r\n\r\n  _updateAll() {\r\n    for (let sarea of this.sareas) {\r\n      sarea.setCSS();\r\n    }\r\n    this.setCSS();\r\n    this.update();\r\n  }\r\n\r\n  removeArea(sarea) {\r\n    if (this.sareas.indexOf(sarea) < 0) {\r\n      console.warn(sarea, \"<- Warning: tried to remove unknown area\");\r\n      return;\r\n    }\r\n\r\n    this.sareas.remove(sarea);\r\n    sarea.remove();\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      this.snapScreenVerts();\r\n      this.regenScreenMesh();\r\n    }\r\n\r\n    this._updateAll();\r\n    this.drawUpdate();\r\n  }\r\n\r\n  appendChild(child) {\r\n    /*\r\n    if (child instanceof UIBase) {\r\n      if (child._useDataPathUndo === undefined) {\r\n        child.useDataPathUndo = this.useDataPathUndo;\r\n      }\r\n    }*/\r\n\r\n    if (child instanceof ScreenArea.ScreenArea) {\r\n      child.screen = this;\r\n      child.ctx = this.ctx;\r\n      child.parentWidget = this;\r\n\r\n      this.sareas.push(child);\r\n\r\n      if (child.size.dot(child.size) === 0) {\r\n        child.size[0] = this.size[0];\r\n        child.size[1] = this.size[1];\r\n      }\r\n\r\n      if (!child._has_evts) {\r\n        child._has_evts = true;\r\n\r\n        let onfocus = (e) => {\r\n          this.sareas.active = child;\r\n        }\r\n\r\n        let onblur = (e) => {\r\n          //XXX this is causing bugs\r\n\r\n          //if (this.sareas.active === child) {\r\n          //  this.sareas.active = undefined;\r\n          //}\r\n        }\r\n\r\n        child.addEventListener(\"focus\", onfocus);\r\n        child.addEventListener(\"mouseenter\", onfocus);\r\n        child.addEventListener(\"blur\", onblur);\r\n        child.addEventListener(\"mouseleave\", onblur);\r\n      }\r\n\r\n      this.regenBorders();\r\n      child.setCSS();\r\n      this.drawUpdate();\r\n      child._init();\r\n    }\r\n\r\n    return this.shadow.appendChild(child);\r\n    //return super.appendChild(child);\r\n  }\r\n\r\n  add(child) {\r\n    return this.appendChild(child);\r\n  }\r\n\r\n  hintPickerTool() {\r\n    (new FrameManager_ops.ToolTipViewer(this)).start();\r\n  }\r\n\r\n  removeAreaTool(border) {\r\n    let tool = new FrameManager_ops.RemoveAreaTool(this, border);\r\n    //let tool = new FrameManager_ops.AreaDragTool(this, undefined, this.mpos);\r\n    tool.start();\r\n  }\r\n\r\n  moveAttachTool(sarea, mpos = this.mpos, elem, pointerId) {\r\n    let tool = new FrameManager_ops.AreaMoveAttachTool(this, sarea, mpos);\r\n    tool.start(elem, pointerId);\r\n  }\r\n\r\n  splitTool() {\r\n    let tool = new FrameManager_ops.SplitTool(this);\r\n    //let tool = new FrameManager_ops.AreaDragTool(this, undefined, this.mpos);\r\n    tool.start();\r\n  }\r\n\r\n  areaDragTool(sarea = this.sareas.active) {\r\n    if (sarea === undefined) {\r\n      console.warn(\"no active screen area\");\r\n      return;\r\n    }\r\n\r\n    let mpos = this.mpos;\r\n    let tool = new FrameManager_ops.AreaDragTool(this, this.sareas.active, mpos);\r\n\r\n    tool.start();\r\n  }\r\n\r\n  makeBorders() {\r\n    for (let sarea of this.sareas) {\r\n      sarea.makeBorders(this);\r\n    }\r\n  }\r\n\r\n  cleanupBorders() {\r\n    let del = new Set();\r\n\r\n    for (let b of this.screenborders) {\r\n      if (b.halfedges.length === 0) {\r\n        del.add(b);\r\n      }\r\n    }\r\n\r\n    for (let b of del) {\r\n      delete this._edgemap[b._hash];\r\n      HTMLElement.prototype.remove.call(b);\r\n    }\r\n  }\r\n\r\n  mergeBlankAreas() {\r\n    for (let b of this.screenborders) {\r\n      if (b.locked) {\r\n        continue;\r\n      }\r\n\r\n      let blank, sarea;\r\n\r\n      for (let he of b.halfedges) {\r\n        if (!he.sarea.area) {\r\n          blank = he.sarea;\r\n          sarea = b.getOtherSarea(blank);\r\n\r\n          let axis = b.horiz ^ 1;\r\n\r\n          if (blank && sarea && blank.size[axis] !== sarea.size[axis]) {\r\n            blank = sarea = undefined;\r\n          }\r\n\r\n          if (blank && sarea) {\r\n            break;\r\n          } else {\r\n            blank = undefined;\r\n            sarea = undefined;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (blank && sarea && blank !== sarea) {\r\n        this.collapseArea(blank, b);\r\n      }\r\n    }\r\n\r\n    this.cleanupBorders();\r\n  }\r\n\r\n  floatArea(area) {\r\n    let sarea = area.parentWidget;\r\n\r\n    /* already floating? */\r\n    if (sarea.floating) {\r\n      return sarea;\r\n    }\r\n\r\n    sarea.editors.remove(area);\r\n    delete sarea.editormap[area.constructor.define().areaname];\r\n    sarea.area = undefined;\r\n\r\n    HTMLElement.prototype.remove.call(area);\r\n\r\n    let sarea2 = UIBase.createElement(\"screenarea-x\", true);\r\n    sarea2.floating = true;\r\n\r\n    sarea2.pos = new Vector2(sarea.pos);\r\n    sarea2.pos.addScalar(5);\r\n\r\n    sarea2.size = new Vector2(sarea.size);\r\n\r\n    sarea2.editors.push(area);\r\n    sarea2.editormap[area.constructor.define().areaname] = area;\r\n\r\n    sarea2.shadow.appendChild(area);\r\n    sarea2.area = area;\r\n\r\n    area.push_ctx_active();\r\n    area.pop_ctx_active();\r\n\r\n    area.pos = sarea2.pos;\r\n    area.size = sarea2.size;\r\n    area.parentWidget = sarea2;\r\n    area.owning_sarea = sarea2;\r\n\r\n    sarea.flushSetCSS();\r\n    sarea.flushUpdate();\r\n\r\n    sarea2.flushSetCSS();\r\n    sarea2.flushUpdate();\r\n\r\n    this.appendChild(sarea2);\r\n\r\n    if (sarea.editors.length > 0) {\r\n      let area2 = sarea.editors[0];\r\n      sarea.switch_editor(area2.constructor);\r\n\r\n      sarea.flushSetCSS();\r\n      sarea.flushUpdate();\r\n    }\r\n\r\n    sarea2.loadFromPosSize();\r\n    sarea2.bringToFront();\r\n\r\n    this.mergeBlankAreas();\r\n    this.cleanupBorders();\r\n\r\n    return sarea2;\r\n  }\r\n\r\n  on_keydown(e) {\r\n    if (checkForTextBox(this, this.mpos[0], this.mpos[1])) {\r\n      console.log(\"textbox detected\");\r\n      return;\r\n    }\r\n\r\n    if (!haveModal() && this.execKeyMap(e)) {\r\n      e.preventDefault();\r\n      return;\r\n    }\r\n\r\n    if (!haveModal() && this.sareas.active !== undefined && this.sareas.active.on_keydown) {\r\n      let area = this.sareas.active;\r\n      return this.sareas.active.on_keydown(e);\r\n    }\r\n  }\r\n\r\n  on_keyup(e) {\r\n    if (!haveModal() && this.sareas.active !== undefined && this.sareas.active.on_keyup) {\r\n      return this.sareas.active.on_keyup(e);\r\n    }\r\n  }\r\n\r\n  on_keypress(e) {\r\n    if (!haveModal() && this.sareas.active !== undefined && this.sareas.active.on_keypress) {\r\n      return this.sareas.active.on_keypress(e);\r\n    }\r\n  }\r\n\r\n  draw() {\r\n    for (let sarea of this.sareas) {\r\n      sarea.draw();\r\n    }\r\n  }\r\n\r\n  afterSTRUCT() {\r\n    for (let sarea of this.sareas) {\r\n      sarea._ctx = this.ctx;\r\n      sarea.afterSTRUCT();\r\n    }\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    this.clear();\r\n\r\n    reader(this);\r\n\r\n    //handle old files that might have saved as simple arrays\r\n    this.size = new Vector2(this.size);\r\n\r\n    let sareas = this.sareas;\r\n    this.sareas = [];\r\n\r\n    /*\r\n    let push = this.sareas.push;\r\n\r\n    this.sareas.push = function(item) {\r\n      console.error(\"this.sareas.push\", item);\r\n      push.call(this, item);\r\n    }\r\n    */\r\n\r\n    for (let sarea of sareas) {\r\n      sarea.screen = this;\r\n      sarea.parentWidget = this;\r\n\r\n      this.appendChild(sarea);\r\n    }\r\n\r\n    this.regenBorders();\r\n    this.setCSS();\r\n\r\n    this.doOnce(() => {\r\n      this.loadUIData(this.uidata);\r\n      this.uidata = undefined;\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  test_struct(appstate = _appstate) {\r\n    let data = [];\r\n    //let scripts = nstructjs.write_scripts();\r\n    nstructjs.manager.write_object(data, this);\r\n    data = new DataView(new Uint8Array(data).buffer);\r\n\r\n    let screen2 = nstructjs.manager.read_object(data, this.constructor);\r\n    screen2.ctx = this.ctx;\r\n\r\n    for (let sarea of screen2.sareas) {\r\n      sarea.screen = screen2;\r\n      sarea.ctx = this.ctx;\r\n      sarea.area.ctx = this.ctx;\r\n    }\r\n\r\n    let parent = this.parentElement;\r\n    this.remove();\r\n\r\n    appstate.screen = screen2;\r\n\r\n    parent.appendChild(screen2);\r\n\r\n    //for (let \r\n    screen2.regenBorders();\r\n    screen2.update();\r\n    screen2.listen();\r\n\r\n    screen2.doOnce(() => {\r\n      screen2.on_resize(screen2.size, [window.innerWidth, window.innerHeight]);\r\n    });\r\n\r\n    console.log(data)\r\n    return screen2;\r\n  }\r\n\r\n  saveUIData() {\r\n    try {\r\n      return ui_base.saveUIData(this, \"screen\");\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n      console.log(\"Failed to save UI state data\");\r\n    }\r\n  }\r\n\r\n  loadUIData(str) {\r\n    try {\r\n      ui_base.loadUIData(this, str);\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n      console.log(\"Failed to load UI state data\");\r\n    }\r\n  }\r\n}\r\n\r\nScreen.STRUCT = `\r\npathux.Screen { \r\n  size  : vec2;\r\n  pos   : vec2;\r\n  sareas : array(pathux.ScreenArea);\r\n  idgen : int;\r\n  uidata : string | obj.saveUIData();\r\n}\r\n`;\r\n\r\nnstructjs.register(Screen);\r\nui_base.UIBase.internalRegister(Screen);\r\n\r\nScreenArea.setScreenClass(Screen);\r\n_setScreenClass(Screen);\r\n\r\nlet get_screen_cb;\r\nlet _on_keydown;\r\n\r\nlet start_cbs = [];\r\nlet stop_cbs = [];\r\nlet keyboardDom = window;\r\n\r\nlet key_event_opts;\r\n\r\nexport function startEvents(getScreenFunc) {\r\n  get_screen_cb = getScreenFunc;\r\n\r\n  if (_events_started) {\r\n    return;\r\n  }\r\n\r\n  _events_started = true;\r\n\r\n  _on_keydown = (e) => {\r\n    /* Prevent browser from unfocuing the page with the alt key.\r\n     * Happens during touch/pen event handing in Chrome (Oct2023).\r\n     */\r\n    if (e.keyCode === keymap[\"Alt\"]) {\r\n      e.preventDefault();\r\n    }\r\n\r\n    let screen = get_screen_cb();\r\n\r\n    return screen.on_keydown(e);\r\n  };\r\n\r\n  window.addEventListener(\"keydown\", _on_keydown, key_event_opts);\r\n\r\n  for (let cb of start_cbs) {\r\n    cb();\r\n  }\r\n}\r\n\r\nexport function stopEvents() {\r\n  window.removeEventListener(\"keydown\", _on_keydown, key_event_opts);\r\n  _on_keydown = undefined;\r\n  _events_started = false;\r\n\r\n  for (let cb of stop_cbs) {\r\n    try {\r\n      cb();\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n    }\r\n  }\r\n\r\n  return get_screen_cb;\r\n}\r\n\r\nexport function setKeyboardDom(dom) {\r\n  let started = _events_started;\r\n  if (started) {\r\n    stopEvents();\r\n  }\r\n\r\n  keyboardDom = dom;\r\n\r\n  if (started) {\r\n    startEvents(get_screen_cb);\r\n  }\r\n}\r\n\r\n/** Sets options passed to addEventListener() for on_keydown hotkey handler */\r\nexport function setKeyboardOpts(opts) {\r\n  key_event_opts = opts;\r\n}\r\n\r\nexport function _onEventsStart(cb) {\r\n  start_cbs.push(cb);\r\n}\r\n\r\nexport function _onEventsStop(cb) {\r\n  stop_cbs.push(cb);\r\n}\r\n\r\n/*\r\ndocument.addEventListener(\"touchstart\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"touchmove\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"scroll\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"resize\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"pointerdown\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"pointerstart\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"pointermove\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\n*/\r\n","import {AreaFlags} from \"../screen/ScreenArea.js\";\r\nimport {keymap} from \"../path-controller/util/simple_events.js\";\r\n\r\nexport function makePopupArea(area_class, screen, args={}) {\r\n  let sarea = UIBase.createElement(\"screenarea-x\");\r\n\r\n  let width = args.width || (screen.size[0]*0.7);\r\n  let height = args.height || (screen.size[1]*0.7);\r\n  let addEscapeKeyHandler = args.addEscapeKeyHandler !== undefined ? args.addEscapeKeyHandler : true;\r\n\r\n  sarea.ctx = screen.ctx;\r\n  sarea.size[0] = width;\r\n  sarea.size[1] = height;\r\n  sarea.pos[0] = 100;\r\n  sarea.pos[1] = 100;\r\n\r\n  sarea.pos[0] = Math.min(sarea.pos[0], screen.size[0] - sarea.size[0] - 2);\r\n  sarea.pos[1] = Math.min(sarea.pos[1], screen.size[1] - sarea.size[1] - 2);\r\n\r\n  sarea.switch_editor(area_class);\r\n\r\n  sarea.overrideClass(\"popup\");\r\n  sarea.style[\"background-color\"] = sarea.getDefault(\"background-color\");\r\n  sarea.style[\"border-radius\"] = sarea.getDefault(\"border-radius\") + \"px\";\r\n  sarea.style[\"border-color\"] = sarea.getDefault(\"border-color\");\r\n  sarea.style[\"border-style\"] = sarea.getDefault(\"border-style\");\r\n  sarea.style[\"border-width\"] = sarea.getDefault(\"border-width\") + \"px\";\r\n\r\n  sarea.flag |= AreaFlags.FLOATING | AreaFlags.INDEPENDENT;\r\n\r\n  screen.appendChild(sarea);\r\n  sarea.setCSS();\r\n\r\n  if (addEscapeKeyHandler) {\r\n    sarea.on_keydown = (e) => {\r\n      if (e.keyCode === keymap.Escape) {\r\n        screen.removeArea(sarea);\r\n      }\r\n    }\r\n  }\r\n\r\n  sarea.bringToFront();\r\n\r\n  return sarea;\r\n}","import {Area, contextWrangler} from '../screen/ScreenArea.js';\r\nimport {nstructjs} from '../path-controller/controller.js';\r\nimport {UIBase} from '../core/ui_base.js';\r\nimport {Container} from '../core/ui.js';\r\nimport {parsepx} from '../core/ui_base.js';\r\nimport {Icons} from '../core/ui_base.js';\r\nimport * as util from '../util/util.js';\r\n\r\nlet sidebar_hash = new util.HashDigest();\r\n\r\nexport class SideBar extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.header = this.row();\r\n    this.header.style[\"height\"] = \"45px\";\r\n\r\n    this._last_resize_key = undefined;\r\n\r\n    this._closed = false;\r\n\r\n    this.closeIcon = this.header.iconbutton(Icons.RIGHT_ARROW, \"Close/Open sidebar\", () => {\r\n      console.log(\"click!\");\r\n      this.closed = !this._closed;\r\n    });\r\n\r\n    this._openWidth = undefined;\r\n    this.needsSetCSS = true;\r\n    this.tabbar = this.tabs(\"left\");\r\n    //this.tabbar.style[\"flex-grow\"] = \"8\";\r\n  }\r\n\r\n  saveData() {\r\n    return {\r\n      closed : this.closed\r\n    }\r\n  }\r\n\r\n  loadData(obj) {\r\n    this.closed = obj.closed;\r\n  }\r\n\r\n  set closed(val) {\r\n    if (!!this._closed === !!val) {\r\n      return;\r\n    }\r\n\r\n    if (this._openWidth === undefined && !this._closed && val) {\r\n      this._openWidth = this.width;\r\n    }\r\n\r\n    console.log(\"animate!\");\r\n    let w = val ? 50 : this._openWidth;\r\n    this.animate().goto(\"width\", w, 500);\r\n\r\n\r\n    if (val) {\r\n      this.closeIcon.icon = Icons.LEFT_ARROW;\r\n    } else {\r\n      this.closeIcon.icon = Icons.RIGHT_ARROW;\r\n    }\r\n\r\n    this._closed = val;\r\n  }\r\n\r\n  get closed() {\r\n    return this._closed;\r\n  }\r\n\r\n  get width() {\r\n    return parsepx(\"\" + this.getAttribute(\"width\"));\r\n  }\r\n\r\n  set width(val) {\r\n    this.setAttribute(\"width\", \"\" + val + \"px\");\r\n    this.update();\r\n  }\r\n\r\n  get height() {\r\n    return parsepx(\"\" + this.getAttribute(\"height\"));\r\n  }\r\n\r\n  set height(val) {\r\n    this.setAttribute(\"height\", \"\" + val + \"px\");\r\n    this.update();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"sidebar-base-x\",\r\n      style  : \"sidebar\"\r\n    }\r\n  }\r\n\r\n  tab(name) {\r\n    return this.tabbar.tab(name);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    let closed = this._closed;\r\n    this._closed = false;\r\n\r\n    if (!this.getAttribute(\"width\")) {\r\n      this.width = 300;\r\n    }\r\n    if (!this.getAttribute(\"height\")) {\r\n      this.height = 700;\r\n    }\r\n\r\n    this.setCSS();\r\n\r\n    if (closed) {\r\n      this.closed = true;\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    if (!this.parentWidget) {\r\n      return;\r\n    }\r\n\r\n    let editor = this.parentWidget;\r\n\r\n    //happens when editors are inactive\r\n    if (!editor.pos || !editor.size) {\r\n      return;\r\n    }\r\n\r\n    this.needsSetCSS = false;\r\n\r\n    let w = this.width, h = this.height;\r\n\r\n    w = isNaN(w) ? 500 : w;\r\n    h = isNaN(h) ? 500 : h;\r\n\r\n    h = Math.min(h, editor.size[1]-25);\r\n\r\n    this.style[\"position\"] = \"absolute\";\r\n    this.style[\"width\"] = w + \"px\";\r\n    this.style[\"height\"] = h + \"px\";\r\n    this.style[\"z-index\"] = \"100\";\r\n    this.style[\"overflow\"] = \"scroll\";\r\n\r\n    this.style[\"background-color\"] = this.getDefault(\"AreaHeaderBG\");\r\n\r\n    this.tabbar.style[\"height\"] = (h - 45) + \"px\";\r\n    this.style[\"left\"] = (editor.size[0] - w) + \"px\";\r\n  }\r\n\r\n  update() {\r\n    sidebar_hash.reset();\r\n    sidebar_hash.add(this.width);\r\n    sidebar_hash.add(this.height);\r\n\r\n    let key = sidebar_hash.get();\r\n    if (key !== this._last_resize_key) {\r\n      this._last_resize_key = key;\r\n      this.needsSetCSS = true;\r\n    }\r\n\r\n    if (this.needsSetCSS) {\r\n      this.setCSS();\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.register(SideBar);\r\n\r\nexport class Editor extends Area {\r\n  constructor() {\r\n    super();\r\n\r\n    this.container = UIBase.createElement(\"container-x\");\r\n    this.container.parentWidget = this;\r\n    this.shadow.appendChild(this.container);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      areaname: \"areaname\",\r\n      tagname : \"tagname-x\"\r\n    }\r\n  }\r\n\r\n  static defineAPI(api, strct) {\r\n    return strct;\r\n  }\r\n\r\n  /** \\param makeMenuBar function(ctx, container, menuBarEditor)\r\n   *\r\n   * example:\r\n   *\r\n   * function makeMenuBar(ctx, container, menuBarEditor) {\r\n   *\r\n   *  container.menu(\"File\", [\r\n   *    \"app.new()\",\r\n   *    simple.Menu.SEP,\r\n   *    \"app.save()\",\r\n   *    \"app.save(forceDialog=true)|Save As\",\r\n   *    \"app.open\"\r\n   *  ]);\r\n   * }\r\n   * */\r\n  static registerAppMenu(makeMenuBar) {\r\n    if (this !== Editor) {\r\n      throw new Error(\"must call registerAppMenu from simple.Editor base class\");\r\n    }\r\n\r\n    this.makeMenuBar = makeMenuBar;\r\n  }\r\n\r\n  /** Registers class with Area system\r\n   *  and nstructjs.  Uses nstructjs.inlineRegister\r\n   *  to handle inheritance.\r\n   **/\r\n  static register(cls) {\r\n    if (!cls.hasOwnProperty(\"define\")) {\r\n      throw new Error(\"missing define() method\");\r\n    }\r\n\r\n    if (!cls.hasOwnProperty(\"STRUCT\")) {\r\n      cls.STRUCT = nstructjs.inherit(cls, this) + `\\n}`;\r\n      nstructjs.register(cls);\r\n    } else {\r\n      /* inlineRegister handles inheritance. */\r\n      cls.STRUCT = nstructjs.inlineRegister(cls, cls.STRUCT);\r\n    }\r\n\r\n    super.register(cls);\r\n  }\r\n\r\n  makeSideBar() {\r\n    if (this.sidebar) {\r\n      this.sidebar.remove();\r\n    }\r\n\r\n    let sidebar = this.sidebar = UIBase.createElement(\"sidebar-base-x\");\r\n    sidebar.parentWidget = this;\r\n    sidebar.ctx = this.ctx;\r\n    this.shadow.appendChild(sidebar);\r\n\r\n    if (this.ctx) {\r\n      sidebar._init();\r\n\r\n      this.sidebar.flushSetCSS();\r\n      this.sidebar.flushUpdate();\r\n    }\r\n\r\n\r\n    return this.sidebar;\r\n  }\r\n\r\n  on_resize(size, oldsize) {\r\n    super.on_resize(size, oldsize);\r\n\r\n    if (this.sidebar) {\r\n      if (this.ctx && this.pos) {\r\n        this.sidebar.setCSS();\r\n      } else {\r\n        this.sidebar.needsSetCSS = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  static findEditor(cls) {\r\n    return contextWrangler.getLastArea(cls);\r\n  }\r\n  \r\n  getScreen() {\r\n    return this.ctx.screen;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.makeHeader(this.container);\r\n  }\r\n\r\n  /** creates default header and puts it in this.header */\r\n  makeHeader(container, add_note_area = true, make_draggable = true) {\r\n    return super.makeHeader(container, add_note_area, make_draggable);\r\n  }\r\n\r\n  /** called regularly */\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  /** */\r\n  setCSS() {\r\n    super.setCSS();\r\n  }\r\n}\r\n\r\n","let text = `\r\n<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\r\n<svg\r\n   xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\r\n   xmlns:cc=\"http://creativecommons.org/ns#\"\r\n   xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"\r\n   xmlns:svg=\"http://www.w3.org/2000/svg\"\r\n   xmlns=\"http://www.w3.org/2000/svg\"\r\n   xmlns:xlink=\"http://www.w3.org/1999/xlink\"\r\n   xmlns:sodipodi=\"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\"\r\n   xmlns:inkscape=\"http://www.inkscape.org/namespaces/inkscape\"\r\n   width=\"512\"\r\n   height=\"512\"\r\n   id=\"svg16099\"\r\n   version=\"1.1\"\r\n   inkscape:version=\"1.0 (4035a4fb49, 2020-05-01)\"\r\n   sodipodi:docname=\"iconsheet.svg\"\r\n   inkscape:export-filename=\"C:\\dev\\allshape\\src\\datafiles\\iconsheet16.png\"\r\n   inkscape:export-xdpi=\"45\"\r\n   inkscape:export-ydpi=\"45\">\r\n  <defs\r\n     id=\"defs16101\">\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1587\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1307\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1303\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1299\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1295\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1291\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1231\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1186\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1182\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4974\"\r\n       is_visible=\"true\" />\r\n    <linearGradient\r\n       id=\"linearGradient5481\">\r\n      <stop\r\n         id=\"stop4865\"\r\n         offset=\"0\"\r\n         style=\"stop-color:#e66700;stop-opacity:1;\" />\r\n      <stop\r\n         style=\"stop-color:#f47712;stop-opacity:1;\"\r\n         offset=\"0.52777779\"\r\n         id=\"stop4867\" />\r\n      <stop\r\n         id=\"stop4869\"\r\n         offset=\"1\"\r\n         style=\"stop-color:#f8bb8a;stop-opacity:1;\" />\r\n    </linearGradient>\r\n    <linearGradient\r\n       id=\"linearGradient17116-6\">\r\n      <stop\r\n         id=\"stop4860\"\r\n         offset=\"0\"\r\n         style=\"stop-color:#b3a500;stop-opacity:1;\" />\r\n      <stop\r\n         id=\"stop4862\"\r\n         offset=\"1\"\r\n         style=\"stop-color:#eaa500;stop-opacity:1;\" />\r\n    </linearGradient>\r\n    <linearGradient\r\n       id=\"linearGradient17116\">\r\n      <stop\r\n         id=\"stop4853\"\r\n         offset=\"0\"\r\n         style=\"stop-color:#b3a500;stop-opacity:1;\" />\r\n      <stop\r\n         id=\"stop4855\"\r\n         offset=\"1\"\r\n         style=\"stop-color:#eaa500;stop-opacity:1;\" />\r\n    </linearGradient>\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4290\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4286\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4122\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4118\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4194\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect3225\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect5012\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect5008\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4108\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect3264\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect5465\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4613\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4609\"\r\n       is_visible=\"true\" />\r\n    <linearGradient\r\n       id=\"linearGradient5609\">\r\n      <stop\r\n         id=\"stop5611\"\r\n         offset=\"0\"\r\n         style=\"stop-color:#0089e6;stop-opacity:1;\" />\r\n      <stop\r\n         style=\"stop-color:#1280f4;stop-opacity:1;\"\r\n         offset=\"0.52777779\"\r\n         id=\"stop5613\" />\r\n      <stop\r\n         id=\"stop5615\"\r\n         offset=\"1\"\r\n         style=\"stop-color:#d4eefc;stop-opacity:1;\" />\r\n    </linearGradient>\r\n    <linearGradient\r\n       id=\"linearGradient5481-8\">\r\n      <stop\r\n         style=\"stop-color:#ffc700;stop-opacity:1\"\r\n         offset=\"0\"\r\n         id=\"stop5483\" />\r\n      <stop\r\n         id=\"stop5491\"\r\n         offset=\"0.52777779\"\r\n         style=\"stop-color:#ffc700;stop-opacity:1\" />\r\n      <stop\r\n         style=\"stop-color:#ffa41c;stop-opacity:1\"\r\n         offset=\"1\"\r\n         id=\"stop5485\" />\r\n    </linearGradient>\r\n    <inkscape:perspective\r\n       sodipodi:type=\"inkscape:persp3d\"\r\n       inkscape:vp_x=\"-108.10967 : 516.24314 : 1\"\r\n       inkscape:vp_y=\"0 : 323.31882 : 0\"\r\n       inkscape:vp_z=\"57.429562 : 516.24314 : 1\"\r\n       inkscape:persp3d-origin=\"-25.340056 : 488.65327 : 1\"\r\n       id=\"perspective18342\" />\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0.0\"\r\n       refX=\"0.0\"\r\n       id=\"Arrow2Send\"\r\n       style=\"overflow:visible;\">\r\n      <path\r\n         id=\"path17173\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.62500000;stroke-linejoin:round;\"\r\n         d=\"M 8.7185878,4.0337352 L -2.2072895,0.016013256 L 8.7185884,-4.0017078 C 6.9730900,-1.6296469 6.9831476,1.6157441 8.7185878,4.0337352 z \"\r\n         transform=\"scale(0.3) rotate(180) translate(-2.3,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Mend\"\r\n       orient=\"auto\"\r\n       refY=\"0.0\"\r\n       refX=\"0.0\"\r\n       id=\"Arrow2Mend\"\r\n       style=\"overflow:visible;\">\r\n      <path\r\n         id=\"path17167\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.62500000;stroke-linejoin:round;\"\r\n         d=\"M 8.7185878,4.0337352 L -2.2072895,0.016013256 L 8.7185884,-4.0017078 C 6.9730900,-1.6296469 6.9831476,1.6157441 8.7185878,4.0337352 z \"\r\n         transform=\"scale(0.6) rotate(180) translate(0,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow1Send\"\r\n       orient=\"auto\"\r\n       refY=\"0.0\"\r\n       refX=\"0.0\"\r\n       id=\"Arrow1Send\"\r\n       style=\"overflow:visible;\">\r\n      <path\r\n         id=\"path17155\"\r\n         d=\"M 0.0,0.0 L 5.0,-5.0 L -12.5,0.0 L 5.0,5.0 L 0.0,0.0 z \"\r\n         style=\"fill-rule:evenodd;stroke:#000000;stroke-width:1.0pt;\"\r\n         transform=\"scale(0.2) rotate(180) translate(6,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Lend\"\r\n       orient=\"auto\"\r\n       refY=\"0.0\"\r\n       refX=\"0.0\"\r\n       id=\"Arrow2Lend\"\r\n       style=\"overflow:visible;\">\r\n      <path\r\n         id=\"path17161\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.62500000;stroke-linejoin:round;\"\r\n         d=\"M 8.7185878,4.0337352 L -2.2072895,0.016013256 L 8.7185884,-4.0017078 C 6.9730900,-1.6296469 6.9831476,1.6157441 8.7185878,4.0337352 z \"\r\n         transform=\"scale(1.1) rotate(180) translate(1,0)\" />\r\n    </marker>\r\n    <linearGradient\r\n       id=\"linearGradient17126\">\r\n      <stop\r\n         style=\"stop-color:#008080;stop-opacity:1;\"\r\n         offset=\"0\"\r\n         id=\"stop17128\" />\r\n      <stop\r\n         style=\"stop-color:#00b3b3;stop-opacity:1;\"\r\n         offset=\"1\"\r\n         id=\"stop17130\" />\r\n    </linearGradient>\r\n    <linearGradient\r\n       id=\"linearGradient17116-6-9\">\r\n      <stop\r\n         style=\"stop-color:#b3a500;stop-opacity:1;\"\r\n         offset=\"0\"\r\n         id=\"stop17118\" />\r\n      <stop\r\n         style=\"stop-color:#eaa500;stop-opacity:1;\"\r\n         offset=\"1\"\r\n         id=\"stop17120\" />\r\n    </linearGradient>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-2\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-2\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-6\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-8\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-7\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-6\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-8\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-9\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-79\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-5\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-3\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-1\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-33\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-4\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-1\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-3\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <linearGradient\r\n       inkscape:collect=\"always\"\r\n       xlink:href=\"#linearGradient5481-5\"\r\n       id=\"linearGradient5489-4\"\r\n       x1=\"355.89935\"\r\n       y1=\"17.125025\"\r\n       x2=\"380.47559\"\r\n       y2=\"17.125025\"\r\n       gradientUnits=\"userSpaceOnUse\" />\r\n    <linearGradient\r\n       id=\"linearGradient5481-5\">\r\n      <stop\r\n         style=\"stop-color:#e66700;stop-opacity:1;\"\r\n         offset=\"0\"\r\n         id=\"stop5483-2\" />\r\n      <stop\r\n         id=\"stop5491-9\"\r\n         offset=\"0.52777779\"\r\n         style=\"stop-color:#f47712;stop-opacity:1;\" />\r\n      <stop\r\n         style=\"stop-color:#f8bb8a;stop-opacity:1;\"\r\n         offset=\"1\"\r\n         id=\"stop5485-9\" />\r\n    </linearGradient>\r\n    <linearGradient\r\n       y2=\"17.125025\"\r\n       x2=\"380.47559\"\r\n       y1=\"17.125025\"\r\n       x1=\"355.89935\"\r\n       gradientUnits=\"userSpaceOnUse\"\r\n       id=\"linearGradient5588\"\r\n       xlink:href=\"#linearGradient5609\"\r\n       inkscape:collect=\"always\"\r\n       gradientTransform=\"matrix(1.2151103,0,0,1.1804992,-207.06775,536.98221)\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4108-1\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4108-4\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4108-9\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect3225-1\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect3225-4\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4122-2\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4122-7\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1587-6\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4194-5\"\r\n       is_visible=\"true\" />\r\n  </defs>\r\n  <sodipodi:namedview\r\n     id=\"base\"\r\n     pagecolor=\"#9c9c9c\"\r\n     bordercolor=\"#666666\"\r\n     borderopacity=\"1.0\"\r\n     inkscape:pageopacity=\"0\"\r\n     inkscape:pageshadow=\"2\"\r\n     inkscape:zoom=\"3.8325453\"\r\n     inkscape:cx=\"144.17961\"\r\n     inkscape:cy=\"49.96269\"\r\n     inkscape:document-units=\"px\"\r\n     inkscape:current-layer=\"layer1\"\r\n     showgrid=\"true\"\r\n     inkscape:window-width=\"1606\"\r\n     inkscape:window-height=\"962\"\r\n     inkscape:window-x=\"177\"\r\n     inkscape:window-y=\"71\"\r\n     inkscape:window-maximized=\"0\"\r\n     inkscape:snap-global=\"false\"\r\n     inkscape:pagecheckerboard=\"true\"\r\n     inkscape:document-rotation=\"0\">\r\n    <inkscape:grid\r\n       type=\"xygrid\"\r\n       id=\"grid16107\"\r\n       empspacing=\"1\"\r\n       visible=\"true\"\r\n       enabled=\"true\"\r\n       snapvisiblegridlinesonly=\"false\"\r\n       spacingx=\"32\"\r\n       spacingy=\"32\"\r\n       dotted=\"false\"\r\n       originx=\"0\"\r\n       originy=\"0\" />\r\n  </sodipodi:namedview>\r\n  <metadata\r\n     id=\"metadata16104\">\r\n    <rdf:RDF>\r\n      <cc:Work\r\n         rdf:about=\"\">\r\n        <dc:format>image/svg+xml</dc:format>\r\n        <dc:type\r\n           rdf:resource=\"http://purl.org/dc/dcmitype/StillImage\" />\r\n        <dc:title />\r\n      </cc:Work>\r\n    </rdf:RDF>\r\n  </metadata>\r\n  <g\r\n     inkscape:label=\"Layer 1\"\r\n     inkscape:groupmode=\"layer\"\r\n     id=\"layer1\"\r\n     transform=\"translate(0,-540.36218)\">\r\n    <ellipse\r\n       style=\"opacity:0.79203539;fill:url(#linearGradient5588);fill-opacity:1;stroke:#3c3c3c;stroke-width:1.1393038;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1\"\r\n       id=\"path3171-8\"\r\n       cx=\"240.32063\"\r\n       cy=\"557.19836\"\r\n       rx=\"14.353489\"\r\n       ry=\"14.165989\" />\r\n    <flowRoot\r\n       xml:space=\"preserve\"\r\n       id=\"flowRoot5564\"\r\n       style=\"font-style:normal;font-weight:normal;line-height:0.01%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none\"\r\n       transform=\"matrix(0.64571833,0,0,0.61432912,8.6966653,558.72048)\"><flowRegion\r\n         id=\"flowRegion5566\"\r\n         style=\"font-family:sans-serif\"><rect\r\n           id=\"rect5568\"\r\n           width=\"78.749992\"\r\n           height=\"72.5\"\r\n           x=\"346.24997\"\r\n           y=\"-21.999973\"\r\n           style=\"font-family:sans-serif\" /></flowRegion><flowPara\r\n         id=\"flowPara5570\"\r\n         style=\"font-weight:bold;font-size:40px;line-height:1.25;font-family:sans-serif;-inkscape-font-specification:'Sans Bold'\">?</flowPara></flowRoot>\r\n    <path\r\n       style=\"fill:none;stroke:#ec6900;stroke-width:4.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;marker-mid:none;marker-end:none\"\r\n       d=\"m 187.1235,559.26606 c -3.71166,-5.87882 -12.04056,-10.0009 -18.86169,0.34701\"\r\n       id=\"path4144-1\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\" />\r\n    <path\r\n       style=\"fill:#ec6900;fill-opacity:1;stroke:none;stroke-width:0.001;stroke-miterlimit:4;stroke-dasharray:none\"\r\n       d=\"m 170.01417,560.40163 2.05175,2.63036 -9.89352,4.33226 2.83717,-13.08504 z\"\r\n       id=\"path5370-7\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <path\r\n       style=\"fill:none;stroke:#1f9000;stroke-width:4.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;marker-mid:none;marker-end:none\"\r\n       d=\"m 197.1805,559.70121 c 3.69186,-5.88365 11.97631,-10.00911 18.76103,0.3473\"\r\n       id=\"path4144-1-9\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\" />\r\n    <path\r\n       style=\"fill:#1f9000;fill-opacity:1;stroke:none\"\r\n       d=\"m 213.95021,560.59037 -2.0408,2.63252 9.84072,4.33582 -2.82203,-13.09579 z\"\r\n       id=\"path5370-7-4\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <rect\r\n       style=\"fill:#000000;fill-opacity:1;stroke:none\"\r\n       id=\"rect3224\"\r\n       width=\"23.641272\"\r\n       height=\"8.4057856\"\r\n       x=\"487.73776\"\r\n       y=\"552.41565\" />\r\n    <path\r\n       style=\"fill:none;stroke:#000000;stroke-width:5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"M 498.18023,567.81152 484.7754,556.20378 498.93081,545.77569\"\r\n       id=\"path4074\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccc\" />\r\n    <path\r\n       style=\"fill:#000000;fill-opacity:1;stroke:none\"\r\n       d=\"m 17.866009,585.82436 -0.09,-4.53232 -14.5167501,7.49748 14.5683701,7.84238 z\"\r\n       id=\"path5370-5-0-6-5\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <path\r\n       style=\"fill:#000000;fill-opacity:1;stroke:none\"\r\n       d=\"m 46.366429,592.31275 0.0109,4.6129 14.90287,-7.37024 -14.68289,-8.23782 z\"\r\n       id=\"path5370-5-1-2\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <rect\r\n       style=\"opacity:0.94690265;fill:#000000;fill-opacity:1;stroke:none\"\r\n       id=\"rect5558-3-3\"\r\n       width=\"10.726034\"\r\n       height=\"5.6689787\"\r\n       x=\"-3.0812507\"\r\n       y=\"587.85645\"\r\n       transform=\"matrix(1,0,0.06880209,0.99763033,0,0)\" />\r\n    <rect\r\n       style=\"opacity:0.94690265;fill:#000000;fill-opacity:1;stroke:none\"\r\n       id=\"rect5558-1\"\r\n       width=\"10.540748\"\r\n       height=\"5.5710502\"\r\n       x=\"-22.93788\"\r\n       y=\"587.9295\"\r\n       transform=\"matrix(1,0,0.06880209,0.99763033,0,0)\" />\r\n    <path\r\n       style=\"fill:#2e2e2e;fill-opacity:1;stroke:none;stroke-width:0.685581\"\r\n       d=\"m 71.46269,592.27473 0.01481,6.27371 20.268436,-10.02379 -19.969263,-11.20374 z\"\r\n       id=\"path5370-5-1-2-1\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <path\r\n       style=\"fill:#2e2e2e;fill-opacity:1;stroke:none;stroke-width:0.685581\"\r\n       d=\"m 108.87703,578.56977 -6.27262,0.11779 10.35514,20.10117 10.87444,-20.15049 z\"\r\n       id=\"path5370-5-1-2-1-7\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <path\r\n       style=\"fill:#000000;fill-opacity:1;stroke:#363636;stroke-width:2.23946524;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 69.769603,567.95981 5.60449,-5.39601\"\r\n       id=\"path5452-5-5-1-7\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\"\r\n       inkscape:transform-center-x=\"3.061478\"\r\n       inkscape:transform-center-y=\"-0.63275351\" />\r\n    <path\r\n       style=\"fill:#000000;fill-opacity:1;stroke:#363636;stroke-width:2.23946524;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 75.172083,567.8747 -5.47097,-5.53134\"\r\n       id=\"path5452-5-5-1-7-4\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\"\r\n       inkscape:transform-center-x=\"3.196728\"\r\n       inkscape:transform-center-y=\"-0.78552851\" />\r\n    <path\r\n       style=\"fill:#ffe87e;fill-opacity:1;stroke:#a58000;stroke-width:1.02573335px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 36.512525,599.08328 -0.0847,-15.30469 14.76623,-0.079 1.13455,-5.3121 h 6.7663 l 0.52197,5.56549 h 2.38874 l -0.0349,15.41642 z\"\r\n       id=\"path4607\"\r\n       inkscape:path-effect=\"#path-effect4609\"\r\n       inkscape:original-d=\"m 36.512525,599.08328 -0.0847,-15.30469 14.76623,-0.079 1.13455,-5.3121 h 6.7663 l 0.52197,5.56549 h 2.38874 l -0.0349,15.41642 z\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccccccccc\"\r\n       transform=\"translate(-33.065965,-31.819347)\" />\r\n    <path\r\n       style=\"fill:#dfc449;fill-opacity:1;stroke:#a58000;stroke-width:1.04236829px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 38.651325,583.64804 2.27904,-5.34039 8.11475,0.19058 1.53729,4.93611 z\"\r\n       id=\"path5463\"\r\n       inkscape:path-effect=\"#path-effect5465\"\r\n       inkscape:original-d=\"m 38.651325,583.64804 2.27904,-5.34039 8.11475,0.19058 1.53729,4.93611 z\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccccc\"\r\n       transform=\"translate(-33.065965,-31.819347)\" />\r\n    <path\r\n       style=\"fill:#d7f0fb;fill-opacity:1;stroke:#4f4f4f;stroke-width:1.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;stroke-miterlimit:4;stroke-dasharray:none\"\r\n       d=\"m 71.789265,599.90744 0.17512,-24.69199 h 15.41061 l 4.378,4.90337 0.17513,19.96374 z\"\r\n       id=\"path3262\"\r\n       inkscape:path-effect=\"#path-effect3264\"\r\n       inkscape:original-d=\"m 71.789265,599.90744 0.17512,-24.69199 h 15.41061 l 4.378,4.90337 0.17513,19.96374 z\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cccccc\"\r\n       transform=\"translate(-33.561281,-31.819347)\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 73.190225,596.58015 16.81157,-0.35024\"\r\n       id=\"path4106\"\r\n       inkscape:path-effect=\"#path-effect4108\"\r\n       inkscape:original-d=\"m 73.190225,596.58015 16.81157,-0.35024\"\r\n       inkscape:connector-curvature=\"0\"\r\n       transform=\"translate(-33.561281,-31.819347)\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 73.540465,591.50166 16.81157,-0.35024\"\r\n       id=\"path4106-7\"\r\n       inkscape:path-effect=\"#path-effect4108-1\"\r\n       inkscape:original-d=\"m 73.540465,591.50166 16.81157,-0.35024\"\r\n       inkscape:connector-curvature=\"0\"\r\n       transform=\"translate(-33.561281,-31.819347)\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 73.365345,586.59829 16.81157,-0.35024\"\r\n       id=\"path4106-0\"\r\n       inkscape:path-effect=\"#path-effect4108-4\"\r\n       inkscape:original-d=\"m 73.365345,586.59829 16.81157,-0.35024\"\r\n       inkscape:connector-curvature=\"0\"\r\n       transform=\"translate(-33.561281,-31.819347)\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 73.365345,582.22027 16.81157,-0.35024\"\r\n       id=\"path4106-4\"\r\n       inkscape:path-effect=\"#path-effect4108-9\"\r\n       inkscape:original-d=\"m 73.365345,582.22027 16.81157,-0.35024\"\r\n       inkscape:connector-curvature=\"0\"\r\n       transform=\"translate(-33.561281,-31.819347)\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#f1f1f1;stroke-width:4.65793133;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 103.19489,558.19446 16.18158,0.0627\"\r\n       id=\"path5452-5-5-1-7-7\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\"\r\n       inkscape:transform-center-x=\"3.6534509\"\r\n       inkscape:transform-center-y=\"-5.3788766\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#f4f4f4;stroke-width:4.65793133;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 111.38254,565.89244 -0.15492,-16.18101\"\r\n       id=\"path5452-5-5-1-7-4-4\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\"\r\n       inkscape:transform-center-x=\"3.6340509\"\r\n       inkscape:transform-center-y=\"-5.8027516\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#f1f1f1;stroke-width:4.54087734;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 135.53124,558.66024 15.77493,0.0612\"\r\n       id=\"path5452-5-5-1-7-7-1\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\"\r\n       inkscape:transform-center-x=\"3.561639\"\r\n       inkscape:transform-center-y=\"-5.2436726\" />\r\n    <path\r\n       style=\"fill:#bfbfbf;fill-opacity:1;stroke:#ffffff;stroke-width:1.39999998;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 273.79736,565.92624 4.84986,4.15066 7.44379,-12.0346 -3.26109,-1.20718 -4.82074,8.91974 -2.46038,-2.39761 z\"\r\n       id=\"path1157\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccccccc\" />\r\n    <path\r\n       style=\"fill:#ff9d00;fill-opacity:1;stroke:#808080;stroke-width:0.78749156px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 306.19903,566.65065 4.84985,4.15066 7.4438,-12.0346 -3.26109,-1.20718 -4.82075,8.91974 -2.46037,-2.39761 z\"\r\n       id=\"path1157-6\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccccccc\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:4.85740042;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 419.41366,537.85807 12.87326,7.64338 12.79438,-7.33068\"\r\n       id=\"path1585\"\r\n       inkscape:connector-curvature=\"0\"\r\n       inkscape:path-effect=\"#path-effect1587\"\r\n       inkscape:original-d=\"m 419.41366,537.85807 12.87326,7.64338 c 4.40656,-2.37267 3.01422,-8.5404 12.79438,-7.33068\"\r\n       sodipodi:nodetypes=\"ccc\"\r\n       transform=\"matrix(0.82348572,0,0,0.82348572,75.604975,111.95505)\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:4.85740042;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 419.41366,537.85807 12.87326,7.64338 12.79438,-7.33068\"\r\n       id=\"path1585-6\"\r\n       inkscape:connector-curvature=\"0\"\r\n       inkscape:path-effect=\"#path-effect1587-6\"\r\n       inkscape:original-d=\"m 419.41366,537.85807 12.87326,7.64338 c 4.40656,-2.37267 3.01422,-8.5404 12.79438,-7.33068\"\r\n       sodipodi:nodetypes=\"ccc\"\r\n       transform=\"matrix(-0.82326686,0.01898429,-0.01898429,-0.82326686,829.82733,995.45395)\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#ffffff;stroke-width:1.4972775px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 325.7796,560.88703 9.22114,7.89176 14.15308,-22.88169 -6.20039,-2.29524 -9.16581,16.95932 -4.67796,-4.55863 z\"\r\n       id=\"path1157-6-7\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccccccc\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:none\"\r\n       d=\"m 338.27455,603.35315 -4.55847,-12.13972 -4.42325,4.14941 0.29119,-21.42993 14.0532,13.84869 -5.29334,1.40046 4.98485,11.66133 z\"\r\n       id=\"path4192-0\"\r\n       inkscape:path-effect=\"#path-effect4194-5\"\r\n       inkscape:original-d=\"m 338.27455,603.35315 -4.55847,-12.13972 -4.42325,4.14941 0.29119,-21.42993 14.0532,13.84869 -5.29334,1.40046 c 11.73953,18.68506 2.52594,6.89719 4.98485,11.66133 z\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cccccccc\"\r\n       transform=\"rotate(-9.319008,159.52768,371.93318)\" />\r\n    <text\r\n       xml:space=\"preserve\"\r\n       style=\"font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:17.712px;line-height:0%;font-family:'MV Boli';-inkscape-font-specification:'MV Boli';letter-spacing:0px;word-spacing:0px;fill:#ffdc00;fill-opacity:1;stroke:none;stroke-width:1.476\"\r\n       x=\"179.14906\"\r\n       y=\"751.84772\"\r\n       id=\"text3255-0\"\r\n       transform=\"matrix(1.2141217,-0.1513943,0.23126622,0.79480305,0,0)\"><tspan\r\n         sodipodi:role=\"line\"\r\n         id=\"tspan3257-0\"\r\n         x=\"179.14906\"\r\n         y=\"751.84772\"\r\n         style=\"font-size:44.4154px;line-height:1.25;stroke-width:1.476\">!</tspan></text>\r\n    <text\r\n       xml:space=\"preserve\"\r\n       style=\"font-style:normal;font-weight:normal;font-size:32.4516px;line-height:1.25;font-family:sans-serif;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.81129\"\r\n       x=\"131.62856\"\r\n       y=\"599.63672\"\r\n       id=\"text1309\"><tspan\r\n         sodipodi:role=\"line\"\r\n         id=\"tspan1307\"\r\n         x=\"131.62856\"\r\n         y=\"599.63672\"\r\n         style=\"font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:sans-serif;-inkscape-font-specification:'sans-serif Bold';stroke-width:0.81129\">B</tspan></text>\r\n    <text\r\n       id=\"text1309-2\"\r\n       y=\"658.43152\"\r\n       x=\"153.61592\"\r\n       style=\"font-style:normal;font-weight:normal;font-size:41.6588px;line-height:1.25;font-family:sans-serif;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.04147\"\r\n       xml:space=\"preserve\"\r\n       transform=\"scale(1.0962314,0.91221617)\"><tspan\r\n         style=\"font-style:italic;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:serif;-inkscape-font-specification:'serif Bold Italic';stroke-width:1.04147\"\r\n         y=\"658.43152\"\r\n         x=\"153.61592\"\r\n         id=\"tspan1307-4\"\r\n         sodipodi:role=\"line\">i</tspan></text>\r\n    <text\r\n       xml:space=\"preserve\"\r\n       style=\"font-style:normal;font-weight:normal;font-size:38.431px;line-height:1.25;font-family:sans-serif;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.960773\"\r\n       x=\"264.23669\"\r\n       y=\"522.23657\"\r\n       id=\"text1309-0-9\"\r\n       transform=\"scale(0.87011438,1.1492742)\"><tspan\r\n         sodipodi:role=\"line\"\r\n         id=\"tspan1307-3-4\"\r\n         x=\"264.23669\"\r\n         y=\"522.23657\"\r\n         style=\"font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:sans-serif;-inkscape-font-specification:'sans-serif Bold';stroke-width:0.960773\"><tspan\r\n           style=\"font-weight:normal;stroke-width:0.960773\"\r\n           id=\"tspan1365\">s</tspan></tspan></text>\r\n    <text\r\n       xml:space=\"preserve\"\r\n       style=\"font-style:normal;font-weight:normal;font-size:31.7797px;line-height:1.25;font-family:sans-serif;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.794494\"\r\n       x=\"195.07664\"\r\n       y=\"596.5979\"\r\n       id=\"text1309-0-2\"\r\n       transform=\"scale(0.99519471,1.0048285)\"><tspan\r\n         sodipodi:role=\"line\"\r\n         id=\"tspan1307-3-1\"\r\n         x=\"195.07664\"\r\n         y=\"596.5979\"\r\n         style=\"font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:sans-serif;-inkscape-font-specification:'sans-serif Bold';stroke-width:0.794494\">U</tspan></text>\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:3.47724;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 194.05959,600.03363 25.702,0.14808\"\r\n       id=\"path1375\" />\r\n    <path\r\n       id=\"path1375-2\"\r\n       d=\"m 227.04774,587.38832 25.63991,0.14772\"\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:3.46884;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       inkscape:transform-center-x=\"1.1856386\"\r\n       inkscape:transform-center-y=\"-0.33875464\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#484848;stroke-width:1.623;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 262.93706,592.38036 0.0134,5.70131 18.41916,-9.10923 -18.14729,-10.18151 z\"\r\n       id=\"path5370-5-1-2-1-4\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <path\r\n       inkscape:connector-curvature=\"0\"\r\n       id=\"path5370-5-1-2-1-4-0\"\r\n       d=\"m 301.44451,581.20782 -5.70129,0.0197 9.12976,18.40899 10.16128,-18.15862 z\"\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#484848;stroke-width:1.623;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\" />\r\n    <ellipse\r\n       style=\"fill:none;stroke:#242424;stroke-width:2.80047;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:20;stroke-opacity:1\"\r\n       id=\"path1040\"\r\n       ry=\"8.7032747\"\r\n       rx=\"8.4312963\"\r\n       cy=\"583.49023\"\r\n       cx=\"331.71524\" />\r\n    <path\r\n       style=\"fill:none;stroke:#242424;stroke-width:6;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 336.4644,589.47097 10.10632,10.66173\"\r\n       id=\"path1042\"\r\n       sodipodi:nodetypes=\"cc\" />\r\n    <path\r\n       style=\"fill:none;stroke:#242424;stroke-width:2.17621;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 325.36075,583.26941 12.63506,0.34484\"\r\n       id=\"path1044\" />\r\n    <ellipse\r\n       cx=\"364.00839\"\r\n       cy=\"584.36328\"\r\n       rx=\"9.6165609\"\r\n       ry=\"9.9267731\"\r\n       id=\"path1040-0\"\r\n       style=\"fill:none;stroke:#242424;stroke-width:3.19416;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:20;stroke-opacity:1\" />\r\n    <path\r\n       sodipodi:nodetypes=\"cc\"\r\n       id=\"path1042-6\"\r\n       d=\"m 369.73697,590.7899 10.89694,10.89694\"\r\n       style=\"fill:none;stroke:#242424;stroke-width:6;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\" />\r\n    <path\r\n       id=\"path1044-4\"\r\n       d=\"m 357.64269,584.09303 12.63506,0.34484\"\r\n       style=\"fill:none;stroke:#242424;stroke-width:2.17621;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\" />\r\n    <path\r\n       style=\"fill:none;stroke:#242424;stroke-width:2.17621;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 363.94156,590.78154 0.20796,-12.63806\"\r\n       id=\"path1044-4-9\" />\r\n  </g>\r\n</svg>\r\n`.trim();\r\n\r\ntext = btoa(text);\r\nexport let iconSvg = `data:image/svg+xml;base64,` + text;","\"use strict\";\r\n\r\nimport {iconSvg} from './iconsheet.js';\r\n\r\nexport const Icons = {\r\n  FOLDER        : 0, //file folder\r\n  FILE          : 1,\r\n  TINY_X        : 2, //'x' in bottom left corner\r\n  SMALL_PLUS    : 3,\r\n  SMALL_MINUS   : 4,\r\n  UNDO          : 5,\r\n  REDO          : 6,\r\n  HELP          : 7,\r\n  ENUM_UNCHECKED: 8, //overlaid on icon checkboxes when unchecked\r\n  ENUM_CHECKED  : 9, //overlaid on icon checkboxes when checked\r\n  LARGE_CHECK   : 10, //default check mark for non-icon checkboxes\r\n  CURSOR_ARROW  : 11,\r\n  NOTE_EXCL     : 12, //notification exclamation mark\r\n  SCROLL_DOWN   : 13,\r\n  SCROLL_UP     : 14,\r\n  BACKSPACE     : 15,\r\n  LEFT_ARROW    : 16,\r\n  RIGHT_ARROW   : 17,\r\n  UI_EXPAND     : 18, //triangle\r\n  UI_COLLAPSE   : 19, //triangle\r\n  BOLD          : 20,\r\n  ITALIC        : 21,\r\n  UNDERLINE     : 22,\r\n  STRIKETHRU    : 23,\r\n  TREE_EXPAND   : 24,\r\n  TREE_COLLAPSE : 25,\r\n  ZOOM_OUT      : 26,\r\n  ZOOM_IN       : 27\r\n};\r\n\r\nexport function loadDefaultIconSheet() {\r\n  let iconSheet = document.createElement(\"img\");\r\n  iconSheet.src = iconSvg;\r\n\r\n  return iconSheet;\r\n}\r\n\r\n\r\n","import nstructjs from '../path-controller/util/struct.js';\r\n\r\nimport {UIBase} from '../core/ui_base.js';\r\n\r\nexport class FileHeader {\r\n  constructor(version, magic, flags) {\r\n    this.magic = magic;\r\n    this.flags = flags;\r\n    this.version_major = version ? version[0] : 0;\r\n    this.version_minor = version ? version[1] : 0;\r\n    this.version_micro = version ? version[2] : 0;\r\n    this.schema = nstructjs.write_scripts();\r\n  }\r\n}\r\n\r\nFileHeader.STRUCT = `\r\nsimple.FileHeader {\r\n  magic         : static_string[4];\r\n  version_major : short;\r\n  version_minor : short;\r\n  version_micro : short;\r\n  flags         : short;\r\n  schema        : string; \r\n}\r\n`;\r\nnstructjs.register(FileHeader);\r\n\r\nexport class FileFull extends FileHeader {\r\n  constructor(version, magic, flags) {\r\n    super(version, magic, flags);\r\n    this.objects = [];\r\n  }\r\n}\r\n\r\nFileFull.STRUCT = nstructjs.inherit(FileFull, FileHeader) + `\r\n  objects : array(abstract(Object));\r\n  screen  : abstract(Object);\r\n}\r\n`;\r\nnstructjs.register(FileFull);\r\n\r\n\r\nexport class FileArgs {\r\n  constructor(args = {}) {\r\n    this.ext = args.ext || \".data\";\r\n    this.magic = args.magic || \"STRT\";\r\n    this.doScreen = args.doScreen !== undefined ? args.doScreen : true;\r\n    this.resetOnLoad = args.resetOnLoad !== undefined ? args.resetOnLoad : true;\r\n    this.useJSON = args.useJSON !== undefined ? args.useJSON : false;\r\n    this.version = args.version !== undefined ? args.version : 0;\r\n    this.fileFlags = args.fileFlags !== undefined ? args.fileFlags : 0;\r\n    this.fromFileOp = false; /* SimpleSaveOp and SimpleOpenOp set this to true */\r\n  }\r\n}\r\n\r\nexport class EmptyStruct {\r\n\r\n}\r\nEmptyStruct.STRUCT = `\r\nEmptyStruct {\r\n}\r\n`;\r\nnstructjs.register(EmptyStruct);\r\n\r\nexport function saveFile(appstate, args, objects) {\r\n  if (args.useJSON === undefined) {\r\n    args.useJSON = appstate.saveFilesInJSON;\r\n  }\r\n\r\n  args = new FileArgs(args);\r\n\r\n  let version = args.version;\r\n  if (typeof version === \"number\") {\r\n    if (version === Math.floor(version)) {\r\n      version = [version, 0, 0];\r\n    } else {\r\n      let major = ~~version;\r\n      let minor = ~~(Math.fract(version)*10.0);\r\n      let micro = (Math.fract(version) - minor) * 100.0;\r\n\r\n      version = [major, minor, micro];\r\n    }\r\n  }\r\n\r\n  let file = new FileFull(version, args.magic, args.fileFlags);\r\n\r\n  if (args.doScreen) {\r\n    file.screen = appstate.screen;\r\n  } else {\r\n    file.screen = new EmptyStruct();\r\n  }\r\n\r\n  for (let ob of objects) {\r\n    file.objects.push(ob);\r\n  }\r\n\r\n  if (args.useJSON) {\r\n    return nstructjs.writeJSON(file);\r\n  } else {\r\n    let data = [];\r\n    nstructjs.writeObject(data, file);\r\n    return (new Uint8Array(data)).buffer;\r\n  }\r\n}\r\n\r\nexport function loadFile(appstate, args, data) {\r\n  let header;\r\n\r\n  if (args.useJSON === undefined) {\r\n    args.useJSON = appstate.saveFilesInJSON;\r\n  }\r\n\r\n  args = new FileArgs(args);\r\n\r\n  if (!args.useJSON) {\r\n    if (data instanceof Array) {\r\n      data = (new Uint8Array(data)).buffer;\r\n    }\r\n\r\n    if (data instanceof Uint8Array) {\r\n      data = data.buffer;\r\n    }\r\n\r\n    if (data instanceof ArrayBuffer) {\r\n      data = new DataView(data);\r\n    }\r\n\r\n    header = nstructjs.readObject(data, FileHeader);\r\n  } else {\r\n    if (typeof data === \"string\") {\r\n      data = JSON.parse(data);\r\n    }\r\n\r\n    header = nstructjs.readJSON(data, FileHeader);\r\n  }\r\n\r\n  if (header.magic !== args.magic) {\r\n    throw new Error(\"invalid file\");\r\n  }\r\n\r\n  let istruct = new nstructjs.STRUCT();\r\n  istruct.parse_structs(header.schema);\r\n\r\n  let ret;\r\n\r\n  if (!args.useJSON) {\r\n    ret = istruct.readObject(data, FileFull);\r\n  } else {\r\n    ret = istruct.readJSON(data, FileFull);\r\n  }\r\n\r\n  if (args.resetOnLoad) {\r\n    appstate.reset();\r\n  }\r\n\r\n  if (args.doScreen) {\r\n    if (appstate.screen) {\r\n      appstate.screen.unlisten();\r\n      appstate.screen.remove();\r\n    }\r\n\r\n    ret.screen.ctx = appstate.ctx;\r\n\r\n    if (!(ret.screen instanceof appstate.screenClass)) {\r\n      let screen = UIBase.createElement(appstate.screenClass.define().tagname);\r\n      screen.ctx = appstate.ctx;\r\n\r\n      for (let sarea of ret.screen.sareas) {\r\n        screen.appendChild(sarea);\r\n\r\n        sarea.area.afterSTRUCT();\r\n        sarea.area.on_fileload();\r\n      }\r\n\r\n      ret.screen = screen;\r\n    }\r\n\r\n    appstate.screen = ret.screen;\r\n\r\n    document.body.appendChild(appstate.screen);\r\n    appstate.screen.listen();\r\n  }\r\n\r\n  return ret;\r\n}","import {Editor} from './editor.js';\r\nimport {UIBase} from '../core/ui_base.js';\r\nimport {nstructjs} from '../path-controller/controller.js';\r\nimport {AreaFlags} from '../screen/ScreenArea.js';\r\n\r\n/** see ./editor.js:Editor.registerAppMenu */\r\n\r\nexport class MenuBarEditor extends Editor {\r\n  constructor() {\r\n    super();\r\n\r\n    this.updateHeight();\r\n    this.borderLock = 1 | 2 | 4 | 8;\r\n    this.areaDragToolEnabled = false;\r\n\r\n    this._height = 25;\r\n\r\n    this.needsRebuild = false;\r\n  }\r\n\r\n  get height() {\r\n    return this._height;\r\n  }\r\n\r\n  set height(v) {\r\n    this._height = v;\r\n    this.updateHeight();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname : \"simple-menu-editor-x\",\r\n      areaname: \"menu\",\r\n      uiname  : \"Menu Bar\",\r\n      icon    : -1,\r\n      //hide in editor list\r\n      flag    : AreaFlags.HIDDEN | AreaFlags.NO_HEADER_CONTEXT_MENU | AreaFlags.NO_COLLAPSE | AreaFlags.NO_SWITCHER\r\n    }\r\n  }\r\n\r\n  updateHeight(force = false) {\r\n    if (!this.header)\r\n      return;\r\n\r\n    if (window.haveElectron) {\r\n      this.maxSize[1] = this.minSize[1] = 1;\r\n      electron_api.initMenuBar(this);\r\n      return;\r\n    }\r\n\r\n    if (this._height === undefined) {\r\n      let rect = this.header.getClientRects()[0];\r\n\r\n      if (rect) {\r\n        this._height = rect.height;\r\n      }\r\n    }\r\n\r\n    let update = force || this._height !== this.minSize[1];\r\n    this.minSize[1] = this.maxSize[1] = this._height;\r\n\r\n    if (update && this.ctx && this.getScreen()) {\r\n      this.getScreen().solveAreaConstraints();\r\n    }\r\n  }\r\n\r\n  makeMenuBar(container) {\r\n    if (Editor.makeMenuBar) {\r\n      Editor.makeMenuBar(this.ctx, container, this);\r\n    }\r\n  }\r\n\r\n  flagRebuild() {\r\n    this.needsRebuild = true;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.background = this.getDefault(\"AreaHeaderBG\");\r\n\r\n    this.menuRow = this.header.row();\r\n    this.makeMenuBar(this.menuRow);\r\n\r\n    this.doOnce(() => {\r\n      if (window.haveElectron) {\r\n        this.height = 1;\r\n        electron_api.initMenuBar(this);\r\n      }\r\n    });\r\n\r\n    this.updateHeight(true);\r\n    this.flushUpdate();\r\n  }\r\n\r\n  rebuild() {\r\n    this.needsRebuild = false;\r\n\r\n    this.menuRow.clear();\r\n    this.makeMenuBar(this.menuRow);\r\n    this.flushUpdate();\r\n  }\r\n\r\n  update() {\r\n    if (this.needsRebuild) {\r\n      this.rebuild();\r\n    }\r\n  }\r\n}\r\n\r\nMenuBarEditor.STRUCT = nstructjs.inherit(MenuBarEditor, Editor, \"MenuBarEditor\") + `\r\n}\r\n`;\r\n\r\nexport function registerMenuBarEditor() {\r\n  Editor.register(MenuBarEditor);\r\n}\r\n","import * as platform from '../platforms/platform.js';\r\n\r\nimport {ToolOp, UndoFlags} from '../path-controller/toolsys/toolsys.js';\r\nimport {ToolProperty, BoolProperty, StringProperty} from '../path-controller/toolsys/toolprop.js';\r\n\r\nimport {sendNote, error, warning, message} from '../widgets/ui_noteframe.js';\r\n\r\nexport class SimpleAppNewOp extends ToolOp {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : \"New\",\r\n      toolpath: \"app.new\",\r\n      inputs  : {},\r\n      undoflag: UndoFlags.NO_UNDO\r\n    }\r\n  }\r\n\r\n  exec(ctx) {\r\n    _appstate.createNewFile();\r\n  }\r\n}\r\n\r\nexport class SimpleAppSaveOp extends ToolOp {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : \"Save\",\r\n      toolpath: \"app.save\",\r\n      inputs  : {\r\n        forceDialog: new BoolProperty()\r\n      },\r\n      undoflag: UndoFlags.NO_UNDO\r\n    }\r\n  }\r\n\r\n  exec(ctx) {\r\n    let ext = _appstate.fileExt;\r\n    let useJSON = _appstate.startArgs.saveFilesInJSON;\r\n\r\n    _appstate.saveFile({\r\n      doScreen  : true,\r\n      useJSON,\r\n      fromFileOp: true\r\n    }).then(data => {\r\n\r\n      function save() {\r\n        return data;\r\n      }\r\n\r\n      platform.platform.showSaveDialog(\"Save As\", save, {\r\n        multi          : false,\r\n        addToRecentList: true,\r\n        filters        : [{\r\n          name      : \"File\",\r\n          mime      : useJSON ? \"text/json\" : \"application/x-octet-stream\",\r\n          extensions: [\".\" + ext.toLowerCase()]\r\n        }]\r\n      }).then(path => {\r\n        _appstate.currentFileRef = path;\r\n        message(\"File saved\");\r\n      }).catch(err => {\r\n        if (typeof err === \"object\" && err.message) {\r\n          err = err.message;\r\n        }\r\n\r\n        error(\"Failed to save file \" + err);\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\nexport class SimpleAppOpenOp extends ToolOp {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : \"Open\",\r\n      toolpath: \"app.open\",\r\n      inputs  : {\r\n        forceDialog: new BoolProperty()\r\n      },\r\n      undoflag: UndoFlags.NO_UNDO\r\n    }\r\n  }\r\n\r\n  exec(ctx) {\r\n    let ext = _appstate.fileExt;\r\n    let useJSON = _appstate.startArgs.saveFilesInJSON;\r\n    let mime = useJSON ? \"text/json\" : \"application/x-octet-stream\";\r\n\r\n    platform.platform.showOpenDialog(\"Open File\", {\r\n      multi          : false,\r\n      addToRecentList: true,\r\n      filters        : [{\r\n        name      : \"File\",\r\n        mime,\r\n        extensions: [\".\" + ext.toLowerCase()]\r\n      }]\r\n    }).then(paths => {\r\n      for (let path of paths) {\r\n        platform.platform.readFile(path, mime).then(data => {\r\n          console.log(\"got data!\", data);\r\n\r\n          _appstate.loadFile(data, {useJSON, doScreen: true, fromFileOp: true})\r\n            .catch(err => {\r\n              error(\"File error: \" + err.message);\r\n            });\r\n        });\r\n      }\r\n    }).catch(error => {\r\n      ctx.error(error.message);\r\n    })\r\n  }\r\n}\r\n\r\nexport function register() {\r\n  ToolOp.register(SimpleAppSaveOp);\r\n  ToolOp.register(SimpleAppOpenOp);\r\n  ToolOp.register(SimpleAppNewOp);\r\n}\r\n","import nstructjs from '../path-controller/util/struct.js';\r\nimport {Context, ContextOverlay, makeDerivedOverlay} from '../path-controller/controller/context.js';\r\n\r\nexport const DataModelClasses = [];\r\nimport {buildToolSysAPI, SavedToolDefaults, ToolStack} from '../path-controller/toolsys/toolsys.js';\r\nimport {DataAPI} from '../path-controller/controller/controller.js';\r\nimport {Screen} from '../screen/FrameManager.js';\r\nimport {areaclasses, contextWrangler} from '../screen/area_wrangler.js';\r\nimport * as util from '../util/util.js';\r\nimport {Editor} from './editor.js';\r\n\r\nimport {Vector2} from '../path-controller/util/vectormath.js';\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nexport class DataModel {\r\n  static defineAPI(api, strct) {\r\n    return strct;\r\n  }\r\n\r\n  /** Automatically registers cls with nstructjs\r\n   *  and handles STRUCT inheritance.\r\n   */\r\n  static register(cls) {\r\n    if (!cls.hasOwnProperty(\"defineAPI\")) {\r\n      //  throw new Error(cls.name + \"is missing a defineAPI method\");\r\n    }\r\n\r\n    DataModelClasses.push(cls);\r\n\r\n    if (cls.hasOwnProperty(\"STRUCT\") && !nstructjs.isRegistered(cls)) {\r\n      cls.STRUCT = nstructjs.inlineRegister(cls, cls.STRUCT);\r\n    }\r\n  }\r\n}\r\n\r\nclass EmptyContextClass extends Context {\r\n  static defineAPI(api, strct) {\r\n  }\r\n}\r\n\r\nimport * as ui_noteframe from '../widgets/ui_noteframe.js';\r\n\r\n/**\r\n * Extend the client-provided context class\r\n * with a few standard methods and properties\r\n *\r\n * */\r\nfunction GetContextClass(ctxClass) {\r\n  let ok = 0;\r\n  let cls = ctxClass;\r\n  while (cls) {\r\n    if (cls === Context) {\r\n      ok = 1;\r\n    } else if (cls === ContextOverlay) {\r\n      ok = 2;\r\n    }\r\n\r\n    cls = cls.__proto__;\r\n  }\r\n\r\n  if (ok === 1) {\r\n    return ctxClass;\r\n  }\r\n\r\n  let OverlayDerived;\r\n\r\n  if (ok === 2) {\r\n    OverlayDerived = ctxClass;\r\n  } else {\r\n    OverlayDerived = makeDerivedOverlay(ctxClass);\r\n  }\r\n\r\n  class Overlay extends OverlayDerived {\r\n    constructor(state) {\r\n      super(state);\r\n    }\r\n\r\n    get screen() {\r\n      return this.state.screen;\r\n    }\r\n\r\n    get activeArea() {\r\n      return contextWrangler.getLastArea()\r\n    }\r\n\r\n    get api() {\r\n      return this.state.api;\r\n    }\r\n\r\n    get toolstack() {\r\n      return this.state.toolstack;\r\n    }\r\n\r\n    get toolDefaults() {\r\n      return SavedToolDefaults;\r\n    }\r\n\r\n    get last_tool() {\r\n      return this.toolstack.head;\r\n    }\r\n\r\n    message(msg, timeout = 2500) {\r\n      return ui_noteframe.message(this.screen, msg, timeout);\r\n    }\r\n\r\n    error(msg, timeout = 2500) {\r\n      return ui_noteframe.error(this.screen, msg, timeout);\r\n    }\r\n\r\n    warning(msg, timeout = 2500) {\r\n      return ui_noteframe.warning(this.screen, msg, timeout);\r\n    }\r\n\r\n    progressBar(msg, percent, color, timeout = 1000) {\r\n      return ui_noteframe.progbarNote(this.screen, msg, percent, color, timeout);\r\n    }\r\n  }\r\n\r\n  Context.register(Overlay);\r\n\r\n  return class ContextDerived extends Context {\r\n    constructor(state) {\r\n      super(state);\r\n\r\n      this.pushOverlay(new Overlay(state))\r\n    }\r\n\r\n    static defineAPI(api, st) {\r\n      st.dynamicStruct('activeArea', 'activeArea', 'Active Area')\r\n      return Overlay.defineAPI(api, st);\r\n    }\r\n  }\r\n}\r\n\r\nexport function makeAPI(ctxClass) {\r\n  let api = new DataAPI();\r\n\r\n  for (let cls of DataModelClasses) {\r\n    if (cls.defineAPI) {\r\n      cls.defineAPI(api, api.mapStruct(cls, true));\r\n    }\r\n  }\r\n\r\n  for (let k in areaclasses) {\r\n    areaclasses[k].defineAPI(api, api.mapStruct(areaclasses[k], true));\r\n  }\r\n\r\n  if (ctxClass.defineAPI) {\r\n    ctxClass.defineAPI(api, api.mapStruct(ctxClass, true));\r\n  } else {\r\n    throw new Error(\"Context class should have a defineAPI static method\");\r\n  }\r\n\r\n  api.rootContextStruct = api.mapStruct(ctxClass, api.mapStruct(ctxClass, true));\r\n\r\n  buildToolSysAPI(api, false, api.rootContextStruct, ctxClass, true);\r\n\r\n  return api;\r\n}\r\n\r\nimport {Icons, loadDefaultIconSheet} from './icons.js';\r\nimport {IconManager, setIconManager, setIconMap, setTheme, UIBase} from '../core/ui_base.js';\r\nimport {FileArgs, loadFile, saveFile} from './file.js';\r\nimport {HotKey, KeyMap} from '../path-controller/util/simple_events.js';\r\nimport {initSplineTemplates} from '../path-controller/curve/curve1d_bspline.js';\r\nimport {MenuBarEditor, registerMenuBarEditor} from './menubar.js';\r\nimport {register} from './app_ops.js';\r\n\r\nexport class StartArgs {\r\n  constructor() {\r\n    this.singlePage = true;\r\n\r\n    this.DEBUG = {}\r\n    this.icons = Icons;\r\n    this.iconsheet = undefined; //will default to loadDefaultIconSheet();\r\n    this.iconSizes = [16, 24, 32, 48];\r\n    this.iconTileSize = 32;\r\n    this.iconsPerRow = 16;\r\n    this.theme = undefined; //see scripts/core/theme.js\r\n\r\n    this.registerSaveOpenOps = true;\r\n\r\n    this.autoLoadSplineTemplates = true;\r\n    this.showPathsInToolTips = true;\r\n    this.enableThemeAutoUpdate = false;\r\n    this.addHelpPickers = false;\r\n    this.useNumSliderTextboxes = true;\r\n    this.numSliderArrowLimit = cconst.numSliderArrowLimit;\r\n    this.simpleNumSliders = cconst.simpleNumSliders;\r\n  }\r\n}\r\n\r\nexport class SimpleScreen extends Screen {\r\n  constructor() {\r\n    super();\r\n\r\n    this.keymap = new KeyMap([\r\n      new HotKey(\"Z\", [\"CTRL\"], () => {\r\n        this.ctx.toolstack.undo(this.ctx);\r\n      }),\r\n      new HotKey(\"Z\", [\"CTRL\", \"SHIFT\"], () => {\r\n        this.ctx.toolstack.redo(this.ctx);\r\n      }),\r\n    ])\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"simple-screen-x\"\r\n    }\r\n  }\r\n\r\n  init() {\r\n    if (this.ctx.state.startArgs.registerSaveOpenOps) {\r\n      this.keymap.add(new HotKey(\"S\", [\"CTRL\"], \"app.save()\"));\r\n      this.keymap.add(new HotKey(\"O\", [\"CTRL\"], \"app.open()\"));\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.style[\"position\"] = UIBase.PositionKey;\r\n    this.style[\"left\"] = this.pos[0] + \"px\";\r\n    this.style[\"top\"] = this.pos[1] + \"px\";\r\n  }\r\n}\r\n\r\nUIBase.register(SimpleScreen);\r\n\r\nexport class AppState {\r\n  /** ctxClass is the context class.  It can be either a simple class\r\n   *  or a subclass of the more complex path.ux Context class.  Note that\r\n   *  using Context will avoid subtle undo stack errors caused by the context\r\n   *  changing after a tool is run (this is why Context has a serialization\r\n   *  mechanism).\r\n   *\r\n   *  Path.ux will actually subclass ctxClass and add a few standard methods\r\n   *  and properties, see GetContextClass.*/\r\n  constructor(ctxClass, screenClass = SimpleScreen) {\r\n    this._ctxClass = ctxClass;\r\n\r\n    ctxClass = GetContextClass(ctxClass);\r\n\r\n    this.startArgs = undefined;\r\n    this.currentFileRef = undefined; //current file path/ref\r\n\r\n    this.api = makeAPI(ctxClass);\r\n    this.ctx = new ctxClass(this);\r\n    this.ctx._state = this;\r\n    this.toolstack = new ToolStack();\r\n    this.screenClass = screenClass;\r\n    this.screen = undefined;\r\n\r\n    this.fileMagic = \"STRT\";\r\n    this.fileVersion = [0, 0, 1];\r\n    this._fileExt = \"data\";\r\n    this._fileExtSet = false;\r\n    this.saveFilesInJSON = false; /* save files in nstructjs-json */\r\n\r\n    this.defaultEditorClass = undefined; //if undefined, the first non-menubar editor will be used\r\n  }\r\n\r\n\r\n  get fileExt() {\r\n    return this._fileExt;\r\n  }\r\n\r\n  set fileExt(ext) {\r\n    this._fileExt = ext;\r\n    this._fileExtSet = true;\r\n  }\r\n\r\n  /** resets the undo stack */\r\n  reset() {\r\n    this.toolstack.reset();\r\n  }\r\n\r\n  /** Create a new file. See this.makeScreen() if you wish\r\n   *  to create a new screen at this time, and this.reset()\r\n   *  if you wish to reset the undo stack*/\r\n  createNewFile() {\r\n    console.warn(\"appstate.createNewFile: implement me, using default hack\");\r\n    let state = new this.constructor(this.ctx._ctxClass);\r\n\r\n    state.api = this.api;\r\n    state.ctx = this.ctx;\r\n    state.startArgs = this.startArgs;\r\n    state.saveFilesInJSON = this.saveFilesInJSON;\r\n\r\n    state.toolstack = this.toolstack;\r\n    state.toolstack.reset();\r\n\r\n    this.screen.unlisten();\r\n    this.screen.remove();\r\n\r\n    for (let k in state) {\r\n      this[k] = state[k];\r\n    }\r\n\r\n    this.makeScreen();\r\n  }\r\n\r\n  saveFileSync(objects, args = {}) {\r\n    args = new FileArgs(Object.assign({\r\n      magic  : this.fileMagic,\r\n      version: this.fileVersion,\r\n      ext    : this.fileExt\r\n    }, args));\r\n\r\n    return saveFile(this, args, objects);\r\n  }\r\n\r\n  /** Serialize the application state. Takes\r\n   *  a list of objects to save (with nstructjs);\r\n   *  Subclasses should override this, like so:\r\n   *\r\n   *  saveFile(args={}) {\r\n   *    let objects = app state;\r\n   *    return super.saveFile(objects, args);\r\n   *  }\r\n   **/\r\n  saveFile(objects, args = {}) {\r\n    args = new FileArgs(Object.assign({\r\n      magic  : this.fileMagic,\r\n      version: this.fileVersion,\r\n      ext    : this.fileExt\r\n    }, args));\r\n\r\n    return new Promise((accept, reject) => {\r\n      accept(this.saveFileSync(objects, args));\r\n    });\r\n  }\r\n\r\n  loadFileSync(data, args = {}) {\r\n    args = new FileArgs(Object.assign({\r\n      magic  : this.fileMagic,\r\n      version: this.fileVersion,\r\n      ext    : this.fileExt\r\n    }, args));\r\n\r\n    let ret = loadFile(this, args, data);\r\n\r\n    if (args.doScreen) {\r\n      try {\r\n        this.ensureMenuBar();\r\n      } catch (error) {\r\n        console.error(error.stack);\r\n        console.error(error.message);\r\n        console.error(\"Failed to add menu bar\");\r\n      }\r\n\r\n      this.screen.completeSetCSS();\r\n      this.screen.completeUpdate();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   *  Loads a new file. The default behavior is a\r\n   *  complete state reset (you can control this\r\n   *  with args.reset_toolstack, args.reset_context\r\n   *  and args.doScreen).\r\n   *\r\n   *  As the base class cannot know just what to do\r\n   *  with the loaded data (the objects parameter\r\n   *  passed to saveFile) it is recommended you\r\n   *  override this function like so:\r\n   *\r\n   *  loadFile(data, args) {\r\n   *    return super.loadFile(data, args).then(fileData) => {\r\n   *      // load fileData.objects into appropriate properties\r\n   *      // this is the same objects array originally passed\r\n   *      // to this.saveFile\r\n   *      this.data = fileData.objects;\r\n   *    });\r\n   *  }\r\n   *\r\n   *  @param {ArrayBuffer|JSON|DataView} data\r\n   *  @param {FileArgs} args\r\n   *  */\r\n  loadFile(data, args = {}) {\r\n    return new Promise((accept, reject) => {\r\n      accept(this.loadFileSync(data, args));\r\n    });\r\n  }\r\n\r\n  ensureMenuBar() {\r\n    let screen = this.screen;\r\n    let ok = false;\r\n\r\n    for (let sarea of screen.sareas) {\r\n      if (sarea.area instanceof MenuBarEditor) {\r\n        ok = true;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (ok) {\r\n      return;\r\n    }\r\n\r\n    if (!Editor.makeMenuBar) {\r\n      /* don't make menu bar if Editor.registerAppMenu hasn't been called */\r\n      return;\r\n    }\r\n\r\n    /* ensure screen size is up to date */\r\n    screen.update();\r\n\r\n    let sarea = UIBase.createElement(\"screenarea-x\");\r\n\r\n    screen.appendChild(sarea);\r\n\r\n    let h = 55;\r\n    let min = new Vector2().addScalar(1e17);\r\n    let max = new Vector2().addScalar(-1e17);\r\n    let tmp = new Vector2();\r\n\r\n    for (let sarea2 of screen.sareas) {\r\n      if (sarea2 === sarea) {\r\n        continue;\r\n      }\r\n\r\n      min.min(sarea2.pos);\r\n      tmp.load(sarea2.pos).add(sarea2.size);\r\n      max.max(tmp);\r\n    }\r\n\r\n    let scale = (max[1] - min[1] - h)/(max[1] - min[1]);\r\n\r\n    for (let sarea2 of screen.sareas) {\r\n      if (sarea2 === sarea) {\r\n        continue;\r\n      }\r\n\r\n      sarea2.pos[1] *= scale;\r\n      sarea2.size[1] *= scale;\r\n      sarea2.pos[1] += h;\r\n    }\r\n\r\n    sarea.pos.zero();\r\n    sarea.size[0] = screen.size[0];\r\n    sarea.size[1] = h;\r\n\r\n    screen.regenScreenMesh();\r\n    screen.snapScreenVerts();\r\n\r\n    sarea.switch_editor(MenuBarEditor);\r\n\r\n    screen.solveAreaConstraints();\r\n\r\n    screen.completeSetCSS();\r\n    screen.completeUpdate();\r\n  }\r\n\r\n  makeScreen() {\r\n    if (this.screen) {\r\n      this.screen.unlisten();\r\n      this.screen.remove();\r\n    }\r\n\r\n    let screen = this.screen = UIBase.createElement(this.screenClass.define().tagname);\r\n    let sarea = UIBase.createElement(\"screenarea-x\");\r\n\r\n    screen.ctx = this.ctx;\r\n    sarea.ctx = this.ctx;\r\n\r\n    document.body.appendChild(screen);\r\n\r\n    let cls = this.defaultEditorClass;\r\n\r\n    if (!cls) {\r\n      for (let k in areaclasses) {\r\n        cls = areaclasses[k];\r\n\r\n        if (cls !== MenuBarEditor) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    sarea.switch_editor(cls);\r\n    screen.appendChild(sarea);\r\n\r\n    screen._init();\r\n    screen.listen();\r\n    screen.update();\r\n    screen.completeSetCSS();\r\n    screen.completeUpdate();\r\n\r\n    if (Editor.makeMenuBar) {\r\n      this.ensureMenuBar();\r\n    }\r\n  }\r\n\r\n  start(args = new StartArgs()) {\r\n    nstructjs.validateStructs();\r\n\r\n    let args2 = new StartArgs();\r\n\r\n    let methodsCheck = [\r\n      \"saveFile\", \"createNewFile\", \"loadFile\"\r\n    ];\r\n\r\n    for (let method of methodsCheck) {\r\n      let m1 = AppState.prototype[method];\r\n      let m2 = this[method];\r\n\r\n      if (m1 === m2) {\r\n        console.warn(`Warning: it is recommended to override .${method} when subclassing simple.AppState`);\r\n      }\r\n    }\r\n\r\n    document.body.style[\"touch-action\"] = \"none\";\r\n\r\n    registerMenuBarEditor();\r\n\r\n    for (let k in args2) {\r\n      if (args[k] === undefined) {\r\n        args[k] = args2[k];\r\n      }\r\n    }\r\n\r\n    if (args.registerSaveOpenOps) {\r\n      register();\r\n    }\r\n\r\n    if (!args.iconsheet) {\r\n      args.iconsheet = loadDefaultIconSheet();\r\n    }\r\n\r\n    this.startArgs = args;\r\n\r\n    cconst.loadConstants(args);\r\n\r\n    if (args.autoLoadSplineTemplates) {\r\n      initSplineTemplates();\r\n    }\r\n\r\n    let sizes = [];\r\n    let images = [];\r\n\r\n    for (let size of args.iconSizes) {\r\n      sizes.push([args.iconTileSize, size]);\r\n      images.push(args.iconsheet);\r\n    }\r\n\r\n    window.iconsheet = args.iconsheet;\r\n\r\n\r\n    let iconManager = new IconManager(images, sizes, args.iconsPerRow);\r\n    setIconManager(iconManager);\r\n    setIconMap(args.icons);\r\n\r\n    if (args.theme) {\r\n      setTheme(args.theme);\r\n    }\r\n\r\n    document.body.style[\"margin\"] = \"0px\";\r\n    document.body.style[\"padding\"] = \"0px\";\r\n\r\n    if (args.singlePage) {\r\n      document.body.style[\"overflow\"] = \"hidden\";\r\n    }\r\n\r\n    this.makeScreen();\r\n\r\n    Object.defineProperty(window, \"C\", {\r\n      get() {\r\n        return this._appstate.ctx;\r\n      }\r\n    });\r\n\r\n    nstructjs.validateStructs();\r\n\r\n    if (this.saveFilesInJSON && !this._fileExtSet) {\r\n      this._fileExt = \"json\";\r\n    }\r\n\r\n    if (this._fileExt.startsWith(\".\")) {\r\n      this._fileExt = this._fileExt.slice(1, this._fileExt.length).trim();\r\n    }\r\n  }\r\n}\r\n","\r\nexport class SimpleContext {\r\n  constructor() {\r\n\r\n  }\r\n\r\n  static getContextClass() {\r\n    let props = {};\r\n\r\n    let rec = (cls) => {\r\n      let prototype = cls.prototype;\r\n\r\n      if (cls.__proto__ !== Object.__proto__) {\r\n        rec(cls);\r\n      }\r\n\r\n      for (let k in cls) {\r\n        let descr = Object.getOwnPropertyDescriptor(prototype, k);\r\n\r\n        if (descr) {\r\n          props[k] = descr;\r\n        }\r\n      }\r\n    }\r\n\r\n    console.log(props);\r\n\r\n    for (let k in props) {\r\n      if (k.search(\"_save\") >= 0 || k.search(\"_load\") >= 0) {\r\n        continue;\r\n      }\r\n\r\n    }\r\n  }\r\n}","import {PlatformAPI, isMimeText} from '../platform_base.js';\r\nimport {saveFile, loadFile} from '../../path-controller/util/html5_fileapi.js';\r\n\r\nimport {FileDialogArgs, FilePath} from '../platform_base.js';\r\n\r\nimport {mimeMap} from '../platform_base.js';\r\n\r\nexport function getWebFilters(filters=[]) {\r\n  let types = [];\r\n\r\n  for (let item of filters) {\r\n    let mime = item.mime;\r\n    let exts = [];\r\n\r\n    for (let ext of item.extensions) {\r\n      ext = \".\" + ext;\r\n      if (ext.toLowerCase() in mimeMap) {\r\n        mime = mime !== undefined ? mime : mimeMap[ext.toLowerCase()];\r\n      }\r\n\r\n      exts.push(ext);\r\n    }\r\n\r\n    if (!mime) {\r\n      mime = \"application/x-octet-stream\";\r\n    }\r\n\r\n    types.push({\r\n      description: item.name,\r\n      accept     : {\r\n        [mime]: exts\r\n      }\r\n    });\r\n  }\r\n\r\n  return types;\r\n}\r\n\r\nexport class platform extends PlatformAPI {\r\n  //returns a promise\r\n  static showOpenDialog(title, args = new FileDialogArgs()) {\r\n    let types = getWebFilters(args.filters);\r\n\r\n    return new Promise((accept, reject) => {\r\n      try {\r\n        window.showOpenFilePicker({\r\n          multiple: args.multi,\r\n          types\r\n        }).then(arg => {\r\n          let paths = [];\r\n\r\n          for (let file of arg) {\r\n            paths.push(new FilePath(file, file.name));\r\n          }\r\n\r\n          accept(paths);\r\n        });\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n    });\r\n    /*\r\n    let exts = [];\r\n\r\n    for (let list of args.filters) {\r\n      for (let ext of list.extensions) {\r\n        exts.push(ext);\r\n      }\r\n    }\r\n\r\n    return new Promise((accept, reject) => {\r\n      loadFile(args.defaultPath, exts).then((file) => {\r\n        accept([new FilePath(file)]);\r\n      });\r\n    });*/\r\n  }\r\n\r\n  static writeFile(data, handle, mime) {\r\n    handle = handle.data;\r\n\r\n    return handle.createWritable().then((file) => {\r\n      file.write(data);\r\n      file.close();\r\n    });\r\n  }\r\n\r\n  static showSaveDialog(title, savedata_cb, args = new FileDialogArgs()) {\r\n    if (!window.showSaveFilePicker) {\r\n      return this.showSaveDialog_old(...arguments);\r\n    }\r\n\r\n    let types = getWebFilters(args.filters);\r\n\r\n    return new Promise((accept, reject) => {\r\n      let fname;\r\n      let saveHandle;\r\n\r\n      try {\r\n        saveHandle = window.showSaveFilePicker({types});\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n\r\n      let handle;\r\n\r\n      saveHandle.then((handle1) => {\r\n        handle = handle1;\r\n\r\n        fname = handle.name;\r\n        console.log(\"saveHandle\", handle);\r\n        return handle.createWritable();\r\n      }).then((file) => {\r\n        let savedata = savedata_cb();\r\n\r\n        if (savedata instanceof Uint8Array || savedata instanceof DataView) {\r\n          savedata = savedata.buffer;\r\n        }\r\n\r\n        file.write(savedata);\r\n        file.close();\r\n\r\n        let path = new FilePath(handle, fname);\r\n        accept(path);\r\n      });\r\n    });\r\n  }\r\n\r\n  //returns a promise\r\n  static showSaveDialog_old(title, savedata, args = new FileDialogArgs()) {\r\n\r\n    let exts = [];\r\n\r\n    for (let list of args.filters) {\r\n      if (!Array.isArray(list) && list.filters) {\r\n        list = list.filters;\r\n      }\r\n\r\n      for (let ext of list) {\r\n        exts.push(ext);\r\n      }\r\n    }\r\n\r\n    return new Promise((accept, reject) => {\r\n      saveFile(savedata);\r\n\r\n      window.setTimeout(() => {\r\n        accept(\"undefined\");\r\n      });\r\n    });\r\n  }\r\n\r\n  //path is a FilePath instance, for web this is the actual file data\r\n  static readFile(path, mime = \"\") {\r\n    if (mime === \"\") {\r\n      mime = path.filename;\r\n      let i = mime.length-1;\r\n\r\n      while (i > 0 && mime[i] !== \".\") {\r\n        i--;\r\n      }\r\n\r\n      mime = mime.slice(i, mime.length).trim().toLowerCase();\r\n      if (mime in mimeMap) {\r\n        mime = mimeMap[mime];\r\n      }\r\n    }\r\n\r\n    return new Promise((accept, reject) => {\r\n      path.data.getFile().then((file) => {\r\n        console.log(\"file!\", file);\r\n\r\n        let promise;\r\n\r\n        if (isMimeText(mime)) {\r\n          promise = file.text();\r\n        } else {\r\n          promise = file.arrayBuffer();\r\n        }\r\n\r\n        promise.then(data => {\r\n          accept(data);\r\n        });\r\n      });\r\n    });\r\n\r\n    return new Promise((accept, reject) => {\r\n      let data = path.data;\r\n\r\n      if (isMimeText(mime)) {\r\n        let s = '';\r\n        data = new Uint8Array(data);\r\n\r\n        for (let i = 0; i < data.length; i++) {\r\n          s += String.fromCharCode(data[i]);\r\n        }\r\n\r\n        data = s;\r\n      }\r\n\r\n      accept(data);\r\n    });\r\n  }\r\n}\r\n","import './path-controller/util/polyfill.js';\r\n\r\nexport * from './xmlpage/xmlpage.js';\r\n\r\nexport * from './core/ui_base.js';\r\nexport * from './core/ui.js';\r\nexport * from './widgets/ui_widgets.js';\r\nexport * from './widgets/ui_widgets2.js';\r\nexport * from './core/ui_theme.js';\r\nexport * from './core/units.js';\r\nexport * from './widgets/ui_button.js';\r\nexport * from './widgets/ui_richedit.js';\r\nexport * from './widgets/ui_curvewidget.js';\r\nexport * from './widgets/ui_panel.js';\r\nexport * from './widgets/ui_colorpicker2.js';\r\nexport * from './widgets/ui_tabs.js';\r\nexport * from './widgets/ui_listbox.js';\r\nexport * from './widgets/ui_menu.js';\r\nexport * from './widgets/ui_progress.js';\r\nexport * from './widgets/ui_table.js';\r\nexport * from './widgets/ui_noteframe.js';\r\nexport * from './widgets/ui_numsliders.js';\r\nexport * from './widgets/ui_lasttool.js';\r\nexport * from './widgets/ui_textbox.js';\r\nexport * from './path-controller/util/graphpack.js';\r\n//export * from './docbrowser/docbrowser.js';\r\n\r\nexport * from './path-controller/util/html5_fileapi.js';\r\nexport * from './path-controller/controller.js';\r\n\r\nimport * as controller from './path-controller/controller.js';\r\n\r\nexport {controller};\r\n\r\nimport * as ui_noteframe from './widgets/ui_noteframe.js';\r\n\r\ncontroller.setNotifier(ui_noteframe);\r\n\r\nexport {\r\n  PlatformAPI, getMime, isMimeText, mimeMap, textMimes, FileDialogArgs, FilePath\r\n} from './platforms/platform_base.js';\r\n\r\nimport * as platform from './platforms/platform.js';\r\n\r\nexport {platform};\r\n\r\nimport * as electron_api from './platforms/electron/electron_api.js';\r\n\r\nexport {electron_api};\r\n\r\nexport * from './widgets/theme_editor.js';\r\nexport * from './widgets/ui_treeview.js';\r\n\r\nexport * from './screen/FrameManager.js';\r\nexport * from './screen/ScreenArea.js';\r\nexport * from './util/ScreenOverdraw.js';\r\n\r\nimport cconst from './config/const.js';\r\n\r\nexport {cconst};\r\n\r\nimport * as simple from './simple/simple.js';\r\n\r\nexport {simple};\r\n"],"names":["window","global","globalThis","self","visitgen","destroyAllCSS","visit","n","__visit","tagName","textContents","style","k","error","childNodes","c","document","head","body","sheet","styleSheets","i","rules","length","removeRule","eventDebugModule","start","debugEventLists","debugEventList","this","_addEventListener","EventTarget","prototype","addEventListener","_removeEventListener","removeEventListener","_dispatchEvent","dispatchEvent","onadd","onrem","ondispatch","add","type","data","push","a","arguments","event","thisvar","line","filename","replace","filepath","location","origin","ownerpath","apply","cb","args","pruneConnected","list","e","Node","isConnected","undefined","_debug_event_listeners","_disable_all_listeners","console","warn","EventSource","visualViewport","width","innerWidth","height","innerHeight","offsetLeft","offsetTop","pageLeft","pageTop","scale","Array","set","array","src","dst","count","RangeError","len","Math","min","Object","defineProperty","enumerable","configurable","Float64Array","Float32Array","Uint8Array","Uint8ClampedArray","Int32Array","Int16Array","Int8Array","reject","func","filter","item","Symbol","iterator","keystr","fract","f","floor","tent","abs","sign","pop_i","idx","Error","remove","suppress_error","indexOf","trace","String","contains","substr","search","Number","Boolean","key","colormap","black","red","green","yellow","blue","magenta","cyan","white","reset","grey","orange","pink","brown","lightred","peach","tab","chr","t","termColorMap","termColor","s","toString","termPrint","tok","value","tokdef","s2","tokens","mintk","mini","minslice","mintype","ok","tk","slice","match","chunk","cur","stack","out","pop","iter","ret","util","freeze","__proto__","print_lines","ld","lineno","col","printColors","token","buf","lines","split","istart","max","iend","color","l","colstr","token$1","constructor","val","lexpos","lexer","parser","tokdef$1","name","regexpr","example","re","startsWith","endsWith","trim","PUTIL_ParseError","msg","super","lexer$2","errfunc","lexdata","colmap","printTokens","linestart","linemap","tokints","statestack","states","__main__","statedata","logger","log","add_state","tok_int","push_state","state","pop_state","input","str","peeked_tokens","safepos","peek","next","peeknext","at_end","ignore_peek","shift","ts","tlen","results","res","exec","index","theres","max_res","def","parser$1","parse","err_on_unconsumed","estr","optional","expect","test_parser","basic_types","Set","reserved_tokens","has","toUpperCase","js","rt","lex","p_Type","p","toLowerCase","arraytype","itername","iname","p_Array","p_Field","field","get","st","fields","p_Struct","JSON","stringify","struct_parseutil","NStruct","id","StructEnum","INT","FLOAT","DOUBLE","STRING","STATIC_STRING","STRUCT","TSTRUCT","ARRAY","ITER","SHORT","BYTE","BOOL","ITERKEYS","UINT","USHORT","STATIC_ARRAY","SIGNED_BYTE","OPTIONAL","ArrayTypes","ValueTypes","StructTypes","int","uint","ushort","float","double","string","static_string","struct","abstract","short","byte","bool","iterkeys","sbyte","StructTypeMap","gen_tabstr$2","stripComments","strlit","strs","mode","escape","StructParser","forEach","p_Iter","p_IterKeys","size","p_StaticArray","num","maxlength","p_Static_String","jsonKeyword","p_Abstract","tname","DATAREF","p_DataRef","p_Optional","p_ID_or_num","is_opt","check","comment","struct_parse","struct_parser","struct_typesystem","STRUCT_ENDIAN","setBinaryEndian","temp_dataview","DataView","ArrayBuffer","uint8_view","buffer","unpack_context","pack_byte","pack_sbyte","pack_bytes","bytes","pack_int","setInt32","pack_uint","setUint32","pack_ushort","setUint16","pack_float","setFloat32","pack_double","setFloat64","pack_short","setInt16","encode_utf8","arr","charCodeAt","uc","decode_utf8","sum","j","fromCharCode","test_utf8","truncate_utf8","maxlen","last_codepoint","last2","incode","_static_sbuf_ss","pack_static_string","_static_sbuf","pack_string","unpack_bytes","dview","uctx","unpack_byte","getUint8","unpack_sbyte","getInt8","unpack_int","getInt32","unpack_uint","getUint32","unpack_ushort","getUint16","unpack_float","getFloat32","unpack_double","getFloat64","unpack_short","getInt16","_static_arr_us","unpack_string","slen","_static_arr_uss","unpack_static_string","done","struct_binpack","warninglvl$1","debug","_static_envcode_null$1","packer_debug$1","packer_debug_start$1","packer_debug_end$1","packdebug_tablevel","_get_pack_debug","packer_debug","packer_debug_start","packer_debug_end","warninglvl","cachering","tot","fromConstructor","cls","gen_tabstr$1","setWarningMode2","isNaN","setDebugMode2","funcname","StructFieldTypes","StructFieldTypeMap","packNull","manager","toJSON","obj","fromJSON","instance","formatJSON$1","tlvl","formatJSON","validateJSON$1","_abstractKey","validateJSON","unpack_field","define","unpack","fakeFields","fmt_type","format","do_pack","typeid","pack","_ws_env$1","StructFieldType","useHelperJS","register","StructIntField","StructFloatField","StructDoubleField","StructStringField","StructStaticStringField","StructStructField","stt","get_struct","write_struct","validateJSONIntern","readJSON","formatJSON_intern","writeJSON","unpackInto","dest","cls2","get_struct_cls","read_object","field2","StructTStructField","keywords","structName","parentcls","struct_ids","get_struct_id","struct_cls","formatArrayJson","type2","formatCtx","addComments","StructArrayField","d","env","val2","_env_call","fakeField","process","exit","json","StructIterField","starti","call","StructShortField","StructByteField","StructSignedByteField","StructBoolField","StructIterKeysField","StructUintField","StructUshortField","StructStaticArrayField","StructOptionalField","exists","_sintern2","structEval","eval","setStructEval","_struct_eval","TokSymbol","buildJSONParser","nfloat3","nfloatexp","numre","RegExp","numreTest","tests","test","char","parseFloat","tokinfo","p_Start","throwError","first","p_Object","jsonParser","nGlobal","printContext","l2","globals","DEBUG","updateDEBUG","keys","sintern2","struct_eval","truncateDollarSign$1","JSONError","printCodeLines","code","printEvalError","setTruncateDollarSign","v","_truncateDollarSign","unmangle","_static_envcode_null","gen_tabstr","update_debug_data","setWarningMode","setDebugMode","_ws_env","haveCodeGen","nbtoa","natob","define_empty_class","scls","create","loadSTRUCT","reader","newSTRUCT","idgen","allowOverriding","structs","compiled_code","null_natives","define_null_native","jsonUseColors","jsonBuf","inherit","child","parent","fmt_struct","Super","bad","chain_fromSTRUCT","fromSTRUCT","obj2","concat","getOwnPropertySymbols","formatStruct","internal_only","no_helper_js","setClassKeyword","keyword","nameKeyword","script","load","new","after","from","validateStructs","onerror","getType","parse_structs","defined_classes","struct2","clsmap","dummy","registerGraph","srcSTRUCT","recStruct","recArray","add_class","st2","mergeScripts","stc","stp","fieldset","inlineRegister","structScript","hasOwnProperty","unregister","isRegistered","envcode","fullcode","code2","err","use_helper_js","thestruct","t1","tinyeval","write_object","readObject","cls_or_struct_id","writeObject","json2","isArray","assign","objInstance","this2","was_run","flen","makeLoader","useInternalParser","useColors","consoleLogger","jsonLogger","message","keyTestJson","f2","basetype","validate","StructClass","deriveStructManager","_json_parser","_util","NewSTRUCT","write_scripts","nManager","include_code","nl","buf2","i2","versionToInt","mul","versionCoerce","major","minor","micro","btoa","Buffer","atob","ver_pat","ver","parseInt","versionLessThan","b","FileParams","magic","ext","blocktypes","version","Block","type_magic","FileeError","FileHelper","params","fp","unpack_ctx","read","dataview","FileError","scripts","blocks","dviewlen","byteLength","bdata","datalen","bstruct","block","doVersions","old","write","data2","writeBase64","makeBlock","readBase64","base64","struct_filehelper","truncateDollarSign","setEndian","getEndian","setAllowOverriding","__uctx","class_or_struct_id","impl","phones","iPhone","BlackBerry","HTC","Nexus","Dell","Motorola","Samsung","LG","Sony","Asus","NokiaLumia","Micromax","Palm","Vertu","Pantech","Fly","Wiko","iMobile","SimValley","Wolfgang","Alcatel","Nintendo","Amoi","INQ","OnePlus","GenericPhone","tablets","iPad","NexusTablet","GoogleTablet","SamsungTablet","Kindle","SurfaceTablet","HPTablet","AsusTablet","BlackBerryTablet","HTCtablet","MotorolaTablet","NookTablet","AcerTablet","ToshibaTablet","LGTablet","FujitsuTablet","PrestigioTablet","LenovoTablet","DellTablet","YarvikTablet","MedionTablet","ArnovaTablet","IntensoTablet","IRUTablet","MegafonTablet","EbodaTablet","AllViewTablet","ArchosTablet","AinolTablet","NokiaLumiaTablet","SonyTablet","PhilipsTablet","CubeTablet","CobyTablet","MIDTablet","MSITablet","SMiTTablet","RockChipTablet","FlyTablet","bqTablet","HuaweiTablet","NecTablet","PantechTablet","BronchoTablet","VersusTablet","ZyncTablet","PositivoTablet","NabiTablet","KoboTablet","DanewTablet","TexetTablet","PlaystationTablet","TrekstorTablet","PyleAudioTablet","AdvanTablet","DanyTechTablet","GalapadTablet","MicromaxTablet","KarbonnTablet","AllFineTablet","PROSCANTablet","YONESTablet","ChangJiaTablet","GUTablet","PointOfViewTablet","OvermaxTablet","HCLTablet","DPSTablet","VistureTablet","CrestaTablet","MediatekTablet","ConcordeTablet","GoCleverTablet","ModecomTablet","VoninoTablet","ECSTablet","StorexTablet","VodafoneTablet","EssentielBTablet","RossMoorTablet","iMobileTablet","TolinoTablet","AudioSonicTablet","AMPETablet","SkkTablet","TecnoTablet","JXDTablet","iJoyTablet","FX2Tablet","XoroTablet","ViewsonicTablet","VerizonTablet","OdysTablet","CaptivaTablet","IconbitTablet","TeclastTablet","OndaTablet","JaytechTablet","BlaupunktTablet","DigmaTablet","EvolioTablet","LavaTablet","AocTablet","MpmanTablet","CelkonTablet","WolderTablet","MediacomTablet","MiTablet","NibiruTablet","NexoTablet","LeaderTablet","UbislateTablet","PocketBookTablet","KocasoTablet","HisenseTablet","Hudl","TelstraTablet","GenericTablet","oss","AndroidOS","BlackBerryOS","PalmOS","SymbianOS","WindowsMobileOS","WindowsPhoneOS","iOS","iPadOS","MeeGoOS","MaemoOS","JavaOS","webOS","badaOS","BREWOS","uas","Chrome","Dolfin","Opera","Skyfire","Edge","IE","Firefox","Bolt","TeaShark","Blazer","Safari","WeChat","UCBrowser","baiduboxapp","baidubrowser","DiigoBrowser","Mercury","ObigoBrowser","NetFront","GenericBrowser","PaleMoon","props","Mobile","Build","Version","VendorID","iPod","Coast","Fennec","NokiaBrowser","MQQBrowser","MicroMessenger","SamsungBrowser","Iron","Tizen","Webkit","Gecko","Trident","Presto","Goanna","Android","BREW","Java","Symbian","utils","Bot","MobileBot","DesktopMode","TV","WebKit","Console","Watch","fullPattern","shortPattern","tabletPattern","hasOwnProp","equalIC","containsIC","valueLC","convertPropsToRegExp","object","MobileDetect","userAgent","maxPhoneWidth","ua","prepareUserAgent","_cache","FALLBACK_PHONE","FALLBACK_TABLET","FALLBACK_MOBILE","values","verPos","mobileDetectRules","substring","oss0","findMatch","findMatches","result","getVersionStr","propertyName","patterns","getVersion","prepareVersionNo","NaN","numbers","join","isMobileFallback","detectMobileBrowsers","isTabletFallback","prepareDetectionCache","cache","mobile","phone","tablet","phoneSized","isPhoneSized","mobileGrade","$isMobile","os","is","detectOS","getDeviceSmallerSide","screen","userAgents","versionStr","pattern","grade","_impl","module","exports","factory","amd","keyStrBase64","keyStrUriSafe","baseReverseDic","getBaseValue","alphabet","character","charAt","getInput","lzstring","compressToBase64","_compress","decompressFromBase64","_decompress","compressToUTF16","decompressFromUTF16","compressed","compressToUint8Array","uncompressed","compress","TotalLen","current_value","decompressFromUint8Array","decompress","compressToEncodedURIComponent","decompressFromEncodedURIComponent","bitsPerChar","getCharFromInt","ii","context_dictionary","context_dictionaryToCreate","context_c","context_wc","context_w","context_enlargeIn","context_dictSize","context_numBits","context_data","context_data_val","context_data_position","pow","resetValue","getNextValue","w","bits","resb","maxpower","power","dictionary","enlargeIn","dictSize","numBits","entry","position","f64tmp","u16tmp","Uint16Array","isDenormal","_isDenormal","teal","gray","MovingAvg","used","sample","timers","mdetect","mret","pollTimer","interval","time_ms","isMobile","navigator","SmartConsoleContext","random","sqrt","r","g","__console","timeInterval","timeIntervalAll","_last","last","_data","_data_length","maxCache","hash","dohash","h","WeakSet","recurse","strhash","getAllKeys","clearCache","_getData","time","_check","SmartConsole","contexts","context","tm","EmptySlot","getClassParent","iterable","searchItem","getOwnPropertyDescriptors","proto","formatNumberUI","isInt","decimals","Infinity","toFixed","performance","now","Date","getMilliseconds","color2css","merge","obja","objb","debug_cacherings","_cacherings","_clear_all_cacherings","kill_all","copy","Reflect","ownKeys","ch","_nonvector_cacherings","_stale_cacherings","sort","gen","isprivate","private","SetIter","items","set$2","freelist","equals","setb","clear","map","reduce","initial","ignore_existence","HashIter","_items","_hash_null","hashtable","_keys","key2","IDGenInternalIDGen","IDGen","__cur","_debug","_internalID","isFinite","_cur","max_cur","get_callstack","print_stack","fetch_file","path","url","req","XMLHttpRequest","Promise","accept","open","onreadystatechange","status","readyState","response","statusText","send","_int32","x","nstructjs","MersenneRandom","seed","mt","Uint32Array","extract_number","nrandom","fill","twist","y","_mt","smallstr_hashes","MAXINT","hashsizes","FTAKEN","FKEY","FVAL","FTOT","digestcache","FastHash","cursize","resize","table","valueOf","probe","_i","test_fasthash","ImageReader","load_image","doaccept","createElement","promise","files","FileReader","onload","target","image","Image","canvas","getContext","drawImage","idata","getImageData","readAsDataURL","click","then","HashDigest","cachedDigest","hashjoin","_test_hash2","NullItem","MapIter","ownermap","finish","itercur","_list","map$1","iterstack","validateId","_test_map","m","delete","item2","UndefinedTag","IDMap","iteritem","_test_idmap","HW","HELEM","HTOT","heaplog","MinHeapQueue","iterw","heap","end","witer","depth","ceil","swap","n1","n2","testHeapQueue","list1","Queue","initialSize","queue","enqueue","qlen","clearData","dequeue","_testQueue","steps","samples","ArrayPool","pools","Map","pool","DivLogger","elemId","maxLines","elem","update","getElementById","innerHTML","description","k2","PendingTimeoutPromises","TimeoutPromise","callback","timeout","silent","accept2","_accept2","bind","reject2","_reject2","rejected","_promise","_accept","_reject","wrapPromise","catch","undefinedForGC","setInterval","EulerOrders","XYZ","XZY","YXZ","YZX","ZXY","ZYX","makeCompiledVectormathCode","es6exports","doExports","classes","Vector2","Vector3","Vector4","lens","Quat","modecode","nstructjscode","indent","pad","zero","internal_matrix","Matrix4","sin","cos","asin","exp","acos","atan2","atan","PI","E","DOT_NORM_SNAP_LIMIT","M_SQRT2","FLT_EPSILON","basic_funcs","negate","combine","interp","addFac","sub","div","mulScalar","divScalar","addScalar","subScalar","minScalar","maxScalar","clamp","bounded_acos","fac","pi","make_norm_safe_dot","_dot","dot","getBaseVector","BaseVector","vec","vectorsize","vectorDotDistance","vectorDistance","vectorDistanceSqr","line2","init_swizzle","Function","vectorLength","swapAxes","axis1","axis2","sinterp","v2","l1","normalize","perpSwap","tmp","F64BaseVector","F32BaseVector","I32BaseVector","I16BaseVector","I8BaseVector","UI32BaseVector","UI16BaseVector","UI8BaseVector","myclamp","makeVector4","structType","temp1","temp2","temp3","temp4","static","toCSS","loadXYZW","z","loadXYZ","normalizedDot4","v1","v3","v4","normalizedDot3","center","mulVecQuat","q","t0","t2","multVecMatrix","matrix","$matrix","m41","m11","m21","m31","m42","m12","m22","m32","m43","m13","m23","m33","m44","m14","m24","m34","cross","preNormalizedAngle","th","_v3nd_n1_normalizedDot","_v3nd_n2_normalizedDot","_v3nd4_n1_normalizedDot4","_v3nd4_n2_normalizedDot4","makeVector3","customConstructorCode","bundlehelper","constructorCode","makeVector2","initVector2","co","loadJSON","loadXY","rot2d","A","axis","isPersp","w2","vectorLengthSqr","_quat_vs3_temps","util.cachering","lookat_cache_vs3","lookat_cache_vs4","lookat_cache_ms","euler_rotate_mats","makenormalcache","temp_mats","preMultTemp","makeUnitQuat","isZero","mulQuat","qt","conjugate","dotWithQuat","q2","invert","conjugate_qt","mulscalar","nq2","mulScalarWithFactor","angle","si","last3","toMatrix","q0","q1","q3","qda","qdb","qdc","qaa","qab","qac","qbb","qbc","qcc","matrixToQuat","wmat","mat","r1","r2","r3","tr","axisAngleToQuat","nor","phi","rotationBetweenVecs","quatInterp","quat2","omega","sinom","sc1","sc2","quat","cosom","$_v3nd_n1_normalizedDot","$_v3nd_n2_normalizedDot","$_v3nd4_n1_normalizedDot4","$_v3nd4_n2_normalizedDot4","$_v3nd4_n1_normalizedDot3","$_v3nd4_n2_normalizedDot3","Matrix4$2","clone","addToHashDigest","m1","m2","loadColumn","have4","copyColumnTo","copyColumn","makeIdentity","getAsArray","getAsFloat32Array","setUniform","ctx","loc","transpose","setUniformArray","setUniformWebGLArray","uniformMatrix4fv","determinant","_determinant4x4","det","_makeAdjoint","translate","multiply","preTranslate","preMultiply","preScale","euler_rotate_order","order","xmat","ymat","zmat","euler_rotate","dec","rotate","sinA","cosA","sinA2","x2","y2","z2","flat","clearTranslation","set_w_to_one","setTranslation","resetW","makeNormalMatrix","normal","up","mm","mm2","divide","divisor","ortho","left","right","bottom","top","near","far","tx","ty","tz","frustum","B","C","D","orthographic","aspect","zscale","perspective","fovy","zNear","zFar","tan","lookat","pos","zvec","yvec","xvec","makeRotationOnly","l3","alignAxis","inputs","transformMatrix","getValue","mat2","rot","decompose","axes","getAsVecs","axis3","loadFromVecs","_translate","_rotate","_scale","_skew","_perspective","rmat","_determinant2x2","_determinant3x3","a1","a2","a3","b1","b2","b3","c1","c2","c3","d1","d2","d3","a4","b4","c4","d4","__mat","testmat","PropTypes","ENUM","FLAG","VEC2","VEC3","VEC4","MATRIX4","QUAT","PROPLIST","STRSET","CURVE","FLOAT_ARRAY","REPORT","PropSubTypes","COLOR","PropFlags","SELECT","PRIVATE","LABEL","USE_ICONS","USE_CUSTOM_GETSET","SAVE_LAST_VALUE","READ_ONLY","SIMPLE_SLIDER","FORCE_ROLLER_SLIDER","USE_BASE_UNDO","EDIT_AS_BASE_UNIT","NO_UNDO","USE_CUSTOM_PROP_GETTER","FORCE_ENUM_CHECKBOXES","NO_DEFAULT","ToolPropertyIF","subtype","apiname","uiname","flag","icon","copyTo","_fire","arg1","arg2","on","off","setValue","setStep","step","setRange","setUnit","unit","setUIRange","setIcon","StringPropertyIF","NumPropertyIF","IntPropertyIF","setRadix","radix","FloatPropertyIF","setDecimalPlaces","EnumPropertyIF","valid_values","ui_value_names","iconmap","uin","addIcons","FlagPropertyIF","Vec2PropertyIF","Vec3PropertyIF","Vec4PropertyIF","ListPropertyIF","prop","StringSetPropertyIF","definition","destructive","soft_fail","addUINames","addDescriptions","Curve1DPropertyIF","curve","FLT_EPSILONE","myfloor","normString","myToFixed","Units","Unit","getUnit","unitDefine","toInternal","fromInternal","buildString","MeterUnit","InchUnit","foot_re","FootUnit","parts","vft","vin","square_foot_re","SquareFootUnit","MileUnit","DegreeUnit","RadianUnit","setBaseUnit","baseUnit","setMetric","isMetric","_getBaseUnit","numre1","numre2","hexre1","hexre2","binre","expre","intre","isnumber","parseValueIntern","base","parseValue","displayUnit","isNumber","PixelUnit","PercentUnit","convert","unita","unitb","decimalPlaces","unitConvert","_parseValueTest","_buildStringTest","NumberConstraintsBase","IntegerConstraints","util.list","FloatConstrinats","NumberConstraints","setPropTypes","types","customPropertyTypes","PropClasses","customPropTypeBase","wordmap","sel","unsel","eid","defaultRadix","defaultDecimalPlaces","OnceTag","ToolProperty","PROP_TYPE_ID","wasSet","icon2","callbacks","internalRegister","getClass","setDefaultRadix","setDefaultDecimalPlaces","makeUIName","lastc","ischar","upper","lower","subst","word","calcRelativeStep","logBase","report","util.termColor","setDescription","setUIName","calcMemSize","strlen","saveLastValue","ignoreLastValue","clearEventCallbacks","once","cb2","range","uiRange","getStep","stepIsRelative","setRelativeStep","noUnits","setDisplayUnit","setFlag","setIcon2","FloatArrayProperty","StringProperty","multiLine","NumProperty","_NumberPropertyBase","sliderDisplayExp","slideSpeed","expRate","ui_range","setSliderDisplayExp","setSlideSpeed","setExpRate","IntProperty","ReportProperty","BoolProperty","FloatProperty","EnumKeyPair","key_is_int","val_is_int","EnumProperty","string_or_int","dynamicMetaCB","descriptions","iconmap2","dynamicMeta","metaCB","checkMeta","calcHash","digest","util.HashDigest","updateDefinition","enumdef_or_prop","enumdef","addIcons2","meta","api_update","_loadMap","_saveMap","_values","_ui_value_names","_iconmap","_iconmap2","_descriptions","data_is_int","_is_data_int","FlagProperty","bitmask","VecPropertyBase","hasUniformSlider","uniformSlider","Vec2Property","Vec3Property","isColor","Vec4Property","QuatProperty","Mat4Property","ListProperty","splice","deleteCount","newItems","deletedItems","psize","prop1","prop2","getListItem","setListItem","StringSetProperty","util.set","config","doubleClickTime","autoLoadSplineTemplates","doubleClickHoldTime","setConfig","modalstack","singleMouseCBs","Screen","ContextAreaClass","debugDomEvents","cbsymbol","thsymbol","init","et","getkey","options","singletonMouseEvents","ddd","testSingleMouseUpEvent","singleMouseEvent","_mpos","doSingleCbs","touches","pageX","pageY","copyEvent","util.print_stack","capture","isLeftClick","button","DoubleClickHandler","down","dblEvent","start_mpos","_on_mouseup","_on_mousemove","mdown","mpos","devicePixelRatio","mousedown","isMouseDown","cpy","util.time_ms","cconst","ondblclick","abort","buttons","pathDebugEvent","extra","__prevdef","preventDefault","__stopprop","stopPropagation","eventWasTouch","sourceCapabilities","firesTouchEvents","was_touch","TouchEvent","PointerEvent","pointerType","getOwnPropertyNames","original","_setScreenClass","findScreen","rec","_setModalAreaClass","pushPointerModal","pointerId","autoStopPropagation","pushModalLight","handlers","last_mpos","touchmap","touchstart","touchmove","touchend","touchcancel","handleAreaContext","sarea","findScreenArea","area","push_ctx_active","pop_ctx_active","make_default_touchhandler","domEvents","e2","clientX","clientY","screenX","screenY","make_handler","found","handler","settings","passive","make_pointer","pointer","setPointerCapture","popModalLight","lock","modalEvents","unlock","releasePointerCapture","haveModal","_findScreen","_haveModal","keymap_latin_1","Space","Escape","Enter","Return","Up","Down","Left","Right","Num0","Num1","Num2","Num3","Num4","Num5","Num6","Num7","Num8","Num9","Home","End","Delete","Backspace","Insert","PageUp","PageDown","Tab","NumPlus","NumMinus","Shift","Ctrl","Control","Alt","keymap_latin_1_rev","keymap","reverse_keymap","HotKey","modifiers","action","mods","api","execTool","KeyMap","hotkeys","pathid","hk","handle","shiftKey","altKey","ctrlKey","commandKey","keyCode","ClassIdSymbol","ScreenClass","setScreenClass","getAreaIntName","AreaTypes","TEST_CANVAS_EDITOR","setAreaTypes","areaclasses","theWrangler","AreaWrangler","stacks","lasts","lastArea","locked","_last_screen_id","makeSafeContext","wrangler","Proxy","contextWrangler","stack1","_checkWrangler","_id","findInstance","pushLastRef","updateLastRef","getLastArea","dtvtmps","quad_co_rets2","quad_bilinear","u","quad_uv_2d","u1","u2","v2x","v2y","v3x","v3y","v4x","v4y","C1","C2","dx","dy","ClosestModes","CLOSEST","START","END","ENDPOINTS","ALL","advs","AbstractCurve","evaluate","derivative","curvature","ClosestCurveRets","cvrets","cvarrays","util.ArrayPool","cvtmp","closestPoint","poly_normal_tmps","pncent","normal_poly","vs","normal_tri","normal_quad","cent","barycentric_v2_rets","calc_proj_refs","dihedral_v3_sqr","bx","by","bz","cx","cy","cz","dz","tet_area_tmps","tet_volume","calc_projection_axes","no","ax","ay","az","_avtmps","inrect_3d","aabb_isect_line_3d","inside","closest_point_on_line","aabb_isect_cylinder_3d","radius","barycentric_v2","_linedis2","v1x","v1y","v1z","v2z","closest_p_tri_rets","uv","dist","cpt_v1","cpt_v2","cpt_v3","cpt_v4","cpt_v5","cpt_v6","cpt_p","cpt_n","cpt_mat","cpt_mat2","cpt_b","closest_point_on_quad","uvw","closest_point_on_tri","ax1","ax2","op","ax3","dist_to_tri_v3_old","planedis","p1","p2","p3","pp","dis","tmp2","linedis3d","point_in_tri","dist_to_tri_v3","_dt3s_n","dist_to_tri_v3_sqr","nx","ny","nz","feps","bx2","by2","cx2","cy2","x1","y1","z1","s1","s3","mask","lx","ly","lz","tri_area_temps","tri_area","aabb_overlap_area","pos1","size1","pos2","size2","aabb_isect_2d","aabb_isect_3d","aabb_intersect_vs","aabb_intersect_rets","aabb_intersect_2d","test_aabb_intersect_2d","setAttribute","appendChild","clearRect","sz","beginPath","rect","fillStyle","timer","stop","_timer","clearInterval","rate","aabb_intersect_vs3","aabb_intersect_3d","min1","max1","min2","max2","aabb_union","aabb_union_2d","init_prototype","$_mh","$_swapt","COLINEAR","LINECROSS","COLINEAR_ISECT","_cross_vec1","_cross_vec2","SQRT2","FEPS_DATA","F16","F32","F64","FEPS","FLOAT_MIN","FLOAT_MAX","Matrix4UI","_static_grp_points4","_static_grp_points8","get_rect_points","cs","get_rect_lines","ps","$vs_simple_tri_aabb_isect","simple_tri_aabb_isect","isect","MinMax","totaxis","_min","_max","_static_mr_co","_static_mr_cs","minmax_rect","minmax","winding_axis","up_axis","xaxis","yaxis","x3","winding","zero_z","tol","dx1","dy1","dx2","inrect_2d","$ps_aabb_isect_line_2d","aabb_isect_line_2d","point_in_aabb_2d","point_in_aabb","line_line_cross","expand_rect2d","margin","expand_line","colinear","limit","distLimit","colinear2d","precise","dy2","_llc_l1","_llc_l2","_llc_l3","_llc_l4","lli_v1","lli_v2","lli_v3","lli_v4","_zero_cn","_tmps_cn","_rets_cn","corner_normal","vec1","vec2","normalizedDot","line_line_isect","test_segment","xa1","xa2","ya1","ya2","xb1","xb2","yb1","yb2","w1","w3","w4","_asi_v1","_asi_v2","_asi_v3","_asi_v4","_asi_v5","_asi_v6","_asi2d_v1","_asi2d_v2","_asi2d_v3","_asi2d_v4","_asi2d_v5","_asi2d_v6","aabb_sphere_isect_2d","mvec","dist_to_line_2d","asi_rect","aabb_sphere_isect_vs","aabb_sphere_isect","i3","aabb_sphere_dist","mindis","convex_quad","$e1_normal_tri","$e3_normal_tri","$e2_normal_tri","isNum","_normal_tri_rets","y3","z3","$n2_normal_quad","_q1","_q2","_q3","normal_quad_old","_len","_li_vi","line_isect","calc_t","vi","dt2l_v1","dt2l_v2","dt2l_v3","dt2l_v4","dt2l_v5","clip","closest_co_out","t_out","dt3l_v1","dt3l_v2","dt3l_v3","dt3l_v4","dt3l_v5","dist_to_line_sqr","px","py","pz","len2","dist_to_line","_cplw_vs4","_cplw_vs3","_cplw_vs2","wclip","znear","clip_line_w","_v1","_v2","zfar","doclip1","doclip","dozclip","_closest_point_on_line_cache","_closest_point_rets","_closest_tmps","_circ_from_line_tan_vs","_circ_from_line_tan_ret","circ_from_line_tan","_circ_from_line_tan2d_vs","_circ_from_line_tan2d_ret","circ_from_line_tan_2d","tanx1","tany1","div2","_gtc_e1","_gtc_e2","_gtc_e3","_gtc_p1","_gtc_p2","_gtc_v1","_gtc_v2","_gtc_p12","_gtc_p22","_get_tri_circ_ret","get_tri_circ","e1","e3","gen_circle","stfeps","df","verts","make_vert","make_edge","makeCircleMesh","gl","mesh","Mesh","verts1","verts2","make_face_complex","minmax_verts","__iter_v","__get_iter","__ival_v","unproject","ipers","iview","newvec","project","pers","view","_sh_minv","_sh_maxv","_sh_start","_sh_end","static_cent_gbw","get_boundary_winding","points","divideScalar","totw","round","PlaneOps","reset_axis","orig1","orig2","_isrp_ret","isect_ray_plane_rets","isect_ray_plane","planeorigin","planenormal","rayorigin","raynormal","po","pn","ro","rn","_old_isect_ray_plane","Mat4Stack","update_func","set_internal_matrix","identity","loadIdentity","tril_rets","lreport","trilinear_v3","boxverts","a1x","a1y","a1z","b1x","b1y","b1z","c1x","c1y","c1z","d1x","d1y","d1z","a2x","a2y","a2z","b2x","b2y","b2z","c2x","c2y","c2z","d2x","d2y","d2z","tril_co_rets","tril_co_tmps","tril_mat_1","tril_mat_2","wtable","pih_tmps","boxfaces_table","boxfaces_tmp","boxfacenormals_tmp","point_in_hex","boxfacecents","boxfacenormals","boxverts_tmp","trilinear_co","t3","du","dv","dw","bv","trilinear_co2","grad","totg","axis_error","orig","angle_tri_v3_rets","angle_tri_v3_vs","tri_angles","th1","th2","th3","angle_v2_temps","angle_v3_temps","angle_between_vecs","vcent","_clipdata","mime","_clipboards","hasFocus","clipboard","blob","Response","text","getClipboardData","desiredMimes","setClipboardData","ClipboardItem","Blob","colorSchemeType","docManualPath","docEditorPath","useNumSliderTextboxes","numSliderArrowLimit","simpleNumSliders","menusCanPopupAbove","menu_close_time","paranoidEvents","screenborders","areaContextPushes","allBordersMovable","doOnce","areaConstraintSolver","datapaths","lastToolPanel","domEventAddRemove","debugUIUpdatePerf","screenAreaPosSizeAccesses","buttonEvents","addHelpPickers","useAreaTabSwitcher","autoSizeUpdate","showPathsInToolTips","enableThemeAutoUpdate","useNativeToolTips","noElectronMenus","loadConstants","ctrlconfig.setConfig","cfg","innerText","PATHUX_CONFIG","compatMap","BoxMargin","BoxBG","BoxRadius","background","defaultWidth","defaultHeight","DefaultWidth","DefaultHeight","BoxBorder","BoxLineWidth","BoxSubBG","BoxSub2BG","DefaultPanelBG","InnerPanelBG","Background","numslider_width","numslider_height","ColorSchemeTypes","LIGHT","DARK","parsepx","css","alpha_override","css2color_rets","basic_colors","purple","color2web","tostr","css2color","part","hasAlpha","web2color","validate_pat","validateWebColor","validate_rgba","validate_rgb","validateCSSColor","rgba","theme","invertTheme","inverted","bg","CSSFont","iscolor","setColorSchemeType","_digest","_size","font","weight","variant","calcHashUpdate","util.isMobile","mobileTextSizeMultiplier","genCSS","genKey","exportTheme","theme1","addVarDecl","sortkeys","writekey","maxwid","copyTheme","_exportTheme","EventDispatcher","_cbs","_fireEvent","copyMouseEvent","_orig","exclude","DomEventTypes","on_mousemove","on_mousedown","on_mouseup","on_touchstart","on_touchcancel","on_touchmove","on_touchend","on_mousewheel","on_keydown","on_keyup","on_pointerdown","on_pointermove","on_pointercancel","on_pointerup","getDom","dom","eventtype","modalStack","isModalHead","owner","EventHandler","_modalstate","simple_events.pushPointerModal","pushModal","_is_root","simple_events.pushModalLight","popModal","simple_events.popModalLight","CurveConstructors","CURVE_VERSION","CurveFlags","TRANSFORM","TangentModes","SMOOTH","BREAK","getCurve","throw_on_error","_udigest","CurveTypeData","typeName","hasGUI","calcHashKey","redraw","makeGUI","container","killGUI","integrate","quadSteps","ds","derivative2","inverse","best","mid","ymid","onActive","draw_transform","onInactive","destroy","_on_change","draw","unitRange","evalHermiteTable","genHermiteTable","lastdv1","lastf3","eps","dt","f3","dv1","j2","DataFlags","USE_FULL_UNDO","USE_EVAL_MASS_SET_PATHS","DataTypes","DYNAMIC_STRUCT","PROP","propCacheRings","getTempProp","DataPathError","getVecClass","proptype","isVecProperty","toolprop_abstract.Vec2PropertyIF","toolprop_abstract.Vec3PropertyIF","toolprop_abstract.Vec4PropertyIF","toolprop.Vec2Property","toolprop.Vec3Property","toolprop.Vec4Property","DataPath","evalMassSetFilter","noUndo","setProp","readOnly","read_only","customPropCallback","propGetter","customGetSet","_getValue","_setValue","getSet","dataref","datapath","customSet","customGet","simpleSlider","rollerSlider","checkStrip","editAsBaseUnit","uiNameGetter","ui_name_get","speed","relativeStep","fullSaveUndo","icons","icons2","description_map","uiNames","uinames","StructFlags","ListIface","getStruct","getKey","getActive","setActive","getIter","ToolOpIface","tooldef","toolpath","is_modal","outputs","DataAPIClass","notifier","setImplementationClass","registerTool","setNotifier","ContextFlags","IS_VIEW","InheritFlag$1","__idgen","ContextID","CachedDef","_ret_tmp","OverlayClasses","makeDerivedOverlay","ContextOverlay","appstate","_state","onRemove","have_new_file","contextDefine","resolveDef","def2","Context","parents","util.getClassParent","InheritFlag","excludedKeys","LockedContext","noWarnings","toolstack","toLocked","warning","progbar","progressBar","_props","wrapget","ctx2","loadProperty","getter","contextSystem","overlay","getOwningOverlay","saveProperty","defineProp","setContext","next_key","_stack","_inside_map","isContextSubclass","_fix","fix","perc","progbarNote","validateOverlays","stack2","hasOverlay","getOverlay","override","overrides","pushOverlay","_val_out","inside_map","ikey","__allKeys","ensureProperty","util.getAllKeys","popOverlay","removeOverlay","Test0","Test1","Test2","Test3","testInheritance","ToolClasses","setContextClass","_ToolClasses","ToolFlags","UndoFlags","IS_UNDO_ROOT","UNDO_BARRIER","HAS_UNDO_DATA","slots","defaultUndoHandlers","undoPre","undo","setDefaultUndoHandlers","ToolPropertyCache","pathmap","accessors","userSetMap","dstruct","getPropKey","_buildAccessors","tdef","_getFinalToolDef","partial","pathk","mapStruct","dpath","_getAccessor","useDefault","ToolMacro","SavedToolDefaults","ToolOp","events.EventHandler","_pointerId","_overdraw","__memsize","undoflag","getSlots","lastp","slots2","dinputs","doutputs","hasDefault","getDefault","drawlines","getInputs","Equals","invoke","tool","_regWithNstructjs","onTick","toolop","on_tick","searchBoxOk","canRun","onUndoDestroy","calcUndoMem","loadDefaults","force","toolprop","saveDefaultInputs","genToolString","modalEnd","redo","_was_redo","execPre","execPost","exec_pre","resetTempGeom","modal_ctx","dl","getOverdraw","makeTempLine","node","modalStart","modalRunning","toolCancel","was_cancelled","_on_cancel","outs","ins","pair","_save_inputs","PropKey","_save_outputs","MacroLink","sourcetool_idx","srckey","srcprops","desttool_idx","dstkey","dstprops","source","sourceProps","destProps","sourcePropKey","destPropKey","MacroClasses","_MacroClasses","macroidgen","tools","curtool","has_modal","connects","connectLinks","_macro_class","_getTypeClass","ready","__tooldef","_macroTypeId","connect","srctool","srcoutput","dsttool","dstinput","connectCB","i1","_do_connections","on_modal_end","ToolStack","memLimit","enforceMemLimit","_undo_branch","limitMemory","maxmem","setRestrictedToolContext","toolctx","execOrRedo","compareInputs","rerun","tctx","execCtx","modal_running","save","rewind","replay","onStep","setTimeout","_save","buildToolOpAPI","makeProp","buildToolSysAPI","registerWithNStructjs","rootCtxStruct","rootCtxClass","insertToolDefaultsIntoContext","datastruct","dynamicStruct","inst","haveprop","last_tool_save","last_tool_load","toolDefaults_save","toolDefaults_load","_testToolStackIO","_appstate","vectormath.Vector2","SplineTemplates","CONSTANT","LINEAR","SHARP","SQRT","SMOOTHER","SHARPER","SPHERE","REVERSE_LINEAR","GUASSIAN","templates","SplineTemplateIcons","RecalcFlags","BASIS","FULL","FULL_BASIS","mySafeJSONStringify","mySafeJSONParse","bin_cache","_bin_cache","eval2_rets","bez3","bez4","binomial","bin","Curve1dBSplineOpBase","dataPath","_undo","curve1d","getCurve1d","Curve1dBSplineResetOp","generators","active","Curve1dBSplineLoadTemplOp","template","loadTemplate","Curve1dBSplineDeleteOp","deletePoint","Curve1dBSplineSelectOp","point","unique","bspline","Curve1dBSplineAddOp","addFromMouse","BSplineTransformOp","dpi","storePoints","loadPoints","rco","sco","recalc","updateKnots","cancel","fastmode","startco","xRange","yRange","Curve1DPoint","tangent","seal","deg","splineCache","BSplineCache","curves","maxCurves","cache_w","curve2","_last_cache_key","regen_basis","regen_hermite","_remove","_splineCache","_idgen","BSplineCurve","_bid","_degOffset","interpolating","_ps","hermite","basis_tables","eidgen","util.IDGen","uidata","no_update","_sortPoints","degExtra","hightlight","basis","_basis","empty","_evaluate","f4","solve_interpolating","_evaluate2","error1","totgs","_dbasis","safe_inv","bas","kn","knn","knn1","ki","dbas","start_t","miny","mins","mindx","xmin","xmax","sumx","sumy","totbasis","_wrapTouchEvent","isTouch","templ","drawTransform","onSourceUpdate","transpoints","transforming","draw_trans","bstrip","row","strip","makebutton","iconbutton","iconsheet","customIcon","fullUpdate","Icons","getIconEnum","LARGE_X","TINY_X","slider","simpleslider","last_deg","checked","onchange","start_transform","useSelected","transform_op","transform_mpos","do_highlight","highlight","minp","limitsqr","do_transform","getClientRects","trans","end_transform","_save_hook","lineWidth","strokeStyle","restore","highlightPoint","makeSplineTemplateIcons","moveTo","lineTo","ls","lineCap","stroke","toDataURL","img","splineTemplatesLoaded","initSplineTemplates","_SplineTemplateIcons","Curve1D","_eventCBs","uiZoom","clipToRange","VERSION","setGenerator","generatorType","_fastmode","cb_is_dead","dead","subscribed","_pruneEventCallbacks","evt","gen1","gen2","activeCls","oldGens","active_generator","localeCompare","getGenerator","switchGenerator","patchRange","overlay_curvefunc","_active","Task","taskcb","task","AnimManager","tasks","timeOut","onend","AbstractCommand","cbs","end_cbs","animator","WaitCommand","ms","GoToCommand","startValue","SetCommand","Command","Animator","method","commands","_done","wait","goto","timeMs","cmd","donecb","lexlen","lexer$1","print_tokens","print_debug","PUTLParseError","peek_i","getTraceBack","file","userdata","ToolPaths","initToolPaths_run","buildParser","valid_datatypes","STRLIT","NUMBER","Parser","parseToolPath","check_tool_exists","initToolPaths","startstr","toolclass","testToolParser","ModelInterface","prefix","getToolDef","getToolPathHotkey","createTool","unused","pushReportContext","popReportContext","toolRegistered","massSetProp","mass_set_path","resolveMassSetPaths","resolvePath","ignoreExistence","rootStruct","subkey","use_range","ival","getDescription","rdef","validPath","getPropName","DataPathSetOp","propType","flagBit","useFlagBit","hadError","massSetPath","destType","value2","hashThis","__ctx","paths","feq","EquationCurve","equation","_last_equation","_last_xrange","_func","textbox","label","gui","updateTextBox","makeFunc","_haserror","cosh","sinh","cbrt","GuassianCurve","offset","deviation","hslider","oslider","dslider","Ease","linear","none","amount","getPowIn","getPowOut","getPowInOut","quadIn","quadOut","quadInOut","cubicIn","cubicOut","cubicInOut","quartIn","quartOut","quartInOut","quintIn","quintOut","quintInOut","sineIn","sineOut","sineInOut","getBackIn","backIn","getBackOut","backOut","getBackInOut","backInOut","circIn","circOut","circInOut","bounceIn","bounceOut","bounceInOut","getElasticIn","amplitude","period","pi2","elasticIn","getElasticOut","elasticOut","getElasticInOut","elasticInOut","ParamKey","BOOL_FLAG","SimpleCurveBase","defaultval","_saveParams","pdef","BounceCurve","decay","freq","phase","ElasticCurve","_last_hash","EaseCurve","mode_in","mode_out","amp","RandCurve","util.MersenneRandom","_seed","in_mode","Curve1DProperty","nstructjs.inherit","nstructjs.register","parseutil.PUTLParseError","parseutil.tokdef","parseutil.lexer","pathParser","parseutil.parser","parserStack","tool_classes","tool_idgen","toolkey","ToolID","lt","lastmsg","lcount","reportstack","pushReportName","util.console","popReportName","DataList","getLength","DataStruct","members","inheritFlag","default_struct","existing_struct","setter","color3","vec3","toolprop.PropSubTypes","color4","vec4","arrayList","structdef","color3List","vectorList","color4List","pstruct","toolprop.BoolProperty","toolprop.FloatProperty","textblock","toolprop.StringProperty","toolprop.ReportProperty","toolprop.IntProperty","enum","toolprop.EnumProperty","funcs","flags","toolprop.ToolProperty","toolprop.FlagProperty","fromToolProp","_map_struct_idgen","_map_structs","_debug__map_structs","_dummypath","DummyIntProperty","CLS_API_KEY","CLS_API_KEY_CUSTOM","DataAPI","rootContextStruct","getStructs","setRoot","sdef","hasStruct","mergeStructs","inheritStruct","auto_create_parent","_addClass","mapStructCustom","auto_create","suffix","applyFilter","forceEval","$","inpath","resolvePath_intern","getPropOverride","datactx","newprop","lastobj2","lastkey","lastdpath","lastobj","p_key","dynstructobj","act","actkey","fakeprop","val1","bitfield","_parsePathOverrides","hotkey","getToolPathHotkey_intern","searchKeymap","sareas","getActiveArea","getKeyMaps","parseToolArgs","tpath","initSimpleController","dpt","getDataPathToolOp","setDataPathToolOp","rgb_to_hsv_rets","rgb_to_hsv","computedH","computedS","computedV","minRGB","maxRGB","hsv_to_rgb_rets","hsv_to_rgb","RgbF_Create","rgb_to_cmyk_rets","cmyk_to_rgb_rets","cmyk_to_rgb","rgb_to_cmyk","M","Y","var_K","K","DefaultTheme","AreaHeaderBG","BasePackFlag","BoxDepressed","BoxHighlight","mobileSizeMultiplier","DefaultText","LabelText","TitleText","oneAxisPadding","padding","disabled","pressed","checkbox","CheckSide","colorfield","circleSize","colorBoxHeight","fieldSize","hueHeight","colorpickerbutton","curvewidget","CanvasBG","CanvasHeight","CanvasWidth","dropbox","dropTextBG","depressed","iconcheck","drawCheck","listbox","ListActive","ListHighlight","menu","MenuBG","MenuBorder","MenuHighlight","MenuSeparator","border","MenuSpacing","MenuText","notification","ProgressBarBG","ProgressBar","numslider","numslider_simple","SlideHeight","TextBoxWidth","labelOnTop","addLabel","numslider_textbox","TextBoxHeight","panel","HeaderBorderRadius","HeaderRadius","TitleBackground","TitleBorder","richtext","screenborder","scrollbars","color2","contrast","sidebar","tabs","TabPadding_mobile","TabPadding","TabActive","TabBarRadius","TabHighlight","TabInactive","TabStrokeStyle1","TabStrokeStyle2","TabText","tooltip","ToolTipText","treeview","itemIndent","rowHeight","vecPopupButton","setIconMap","FOLDER","FILE","SMALL_PLUS","SMALL_MINUS","UNDO","REDO","HELP","UNCHECKED","CHECKED","LARGE_CHECK","CURSOR_ARROW","NOTE_EXCL","SCROLL_DOWN","SCROLL_UP","BACKSPACE","LEFT_ARROW","RIGHT_ARROW","UI_EXPAND","UI_COLLAPSE","BOLD","ITALIC","UNDERLINE","STRIKETHRU","TREE_EXPAND","TREE_COLLAPSE","ZOOM_OUT","ZOOM_IN","ENUM_CHECKED","ENUM_UNCHECKED","UIBase","_setUIBase","uibase","AspectKeys","initAspectClass","blacklist","validProperty","descr","getOwnPropertyDescriptor","__aspect_methods","AfterAspect","clearAspectCallbacks","chain","chain2","root","_method","isDead","_method_bound","_checkbind","before","SocketFlags","UPDATE","NodeFlags","SORT_TAG1","SORT_TAG2","RUN","RESORT","SocketTypes","INPUT","OUTPUT","graphIdGen","EventSocket","uiName","edges","flagUpdate","isUpdated","copyFrom","sockb","flagResort","hasNode","disconnect","sock","NodeClasses","NodeCapable","graphNode","graphExec","EventNode","allsockets","graph","sortIndex","graphNodeDef","addSocket","isNodeCapable","getSockets","socks","socksDef","EventGraph","nodes","nodeIdMap","sockIdMap","sortlist","queueReq","skipQueueExec","eventNode","queueExec","dosort","socka","entries","theEventGraph","strBoolMap","true","false","yes","DependSocket","PropSocketModes","REPLACE","MIN","MAX","PropertySocket","mixMode","binding","oldValue","mixmode","_ui_base","TextBox","_setTextboxClass","ElementClasses","__cconst","vectormath.Vector4","Area","_setAreaClass","ErrorColors","WARNING","ERROR","OK","__theme","registered_has_happened","tagPrefix","EventCBSymbol","calcElemCBKey","setTagPrefix","getTagPrefix","class_idgen","setTheme","theme2","k3","_last_report","IsMobile","marginPaddingCSSKeys","_IconManager","tilesize","number_of_horizontal_tiles","drawsize","tilex","customIcons","onReady","util.TimeoutPromise","canvasDraw","getDPI","setCSS","fitsize","getCSS","ratio","blobUrl","CustomIcon","baseImage","images","regenIcons","doSheet","toBlob","URL","createObjectURL","iconsheets","IconManager","sizes","horizontal_tile_count","customIconIDMap","isReady","addCustomIcon","maxid","manager2","findSheet","findClosestSheet","sheets","minsheet","goal","getTileSize","getRealSize","iconmanager","_iconmanager","IconSheets","SMALL","LARGE","XLARGE","iconSheetFromPackFlag","PackFlags","CUSTOM_ICON_SHEET","CUSTOM_ICON_SHEET_START","SMALL_ICON","getIconManager","setIconManager","IconSheetsOverride","makeIconDiv","icontest","vectormath.Matrix4","dpistack","UIFlags","internalElementNames","externalElementNames","INHERIT_WIDTH","INHERIT_HEIGHT","VERTICAL","LARGE_ICON","FORCE_PROP_LABELS","PUT_FLAG_CHECKS_IN_COLUMNS","WRAP_CHECKBOXES","STRIP_HORIZ","STRIP_VERT","STRIP","SIMPLE_NUMSLIDERS","HIDE_CHECK_MARKS","NO_NUMSLIDER_TEXTBOX","NO_UPDATE","LABEL_ON_RIGHT","_mobile_theme_patterns","styleScrollBars","selector","inv","_testSetScrollbars","CTX","mergeGlobalCSS","calcThemeKey","_themeUpdateKey","flagThemeUpdate","_flagThemeUpdate","setTimeoutQueue","haveTimeout","timeout_cb","internalSetTimeout","HTMLElement","customElements","reflagGraph","depend","isNumArray","changed","ensureGraph","flagPropSocketUpdate","getPropertySocket","socktype","sockets","ensurePropertySocket","dependsOn","dstProp","srcProp","srcCallback","dstCallback","sockdst","socksrc","_modalstack","_tool_tip_abort_delay","_tooltip_ref","_textBoxEvents","_themeOverride","_checkTheme","_last_theme_update_key","_client_disabled_set","_useNativeToolTips","_useNativeToolTips_set","_has_own_tooltips","_tooltip_timer","pathUndoGen","_lastPathUndoGen","_useDataPathUndo","_active_animations","_screenStyleTag","_screenStyleUpdateHash","shadow","attachShadow","__cbs","_appendChild","parentWidget","_wasAddedToNodeAtSomeTime","visibleToPick","_override_class","tagname","default_overrides","my_default_overrides","class_default_overrides","_last_description","_description_final","_modaldata","packflag","_internalDisabled","__disabledState","_disdata","_ctx","_description","textContent","_getFont","_init_done","do_touch","MouseEvent","havePickClipboard","_clipboardHotkeyInit","_parentWidget","useDataPathUndo","hasAttribute","getAttribute","title","__background","overrideDefault","__updateDisable","internalDisabled","_forEachChildWidget","_reportCtxName","setDefault","element","getInternalName","internal","setUndo","hidden","hide","sethide","contents","unhide","findArea","_cb2","connectedCallback","noMarginsOrPadding","regenTabOrder","getScreen","needsTabRecalc","noMargins","noPadding","getTotalRect","doaabb","rs","parseNumber","units.parseValue","formatNumber","units.buildString","setBoxCSS","getSubDefault","genBoxCSS","boxcode","setBG","zoom","getZoom","transform","transform2","flushSetCSS","_init","replaceChild","newnode","swapWith","parentNode","getPos","tmp1","insertBefore","ptmp","traverse","type_or_set","is_set","_clipboard_over","_last_clipboard_keyevt","_clipboard_keystart","_clipboard_events","_clipboard_keydown","_clipboard_keyend","internal_mode","is_copy","is_paste","pickElement","checkTree","pasteForAllChildren","copyForAllChildren","clipboardCopy","clipboardPaste","tabIndex","_ondestroy","ondestroy","trigger_on_destroy","on_remove","removeChild","flushUpdate","checkInit","getWinWidth","getWinHeight","calcZ","marginy","nodeclass","excluded_classes","mouseEvent","isMouseMove","scrollX","scrollY","elementFromPoint","lastelem","reverse","getBoundingClientRect","clip2","math.aabb_intersect_2d","defaults","on_disabled","on_enabled","pointerElem","_areaWrangler","bindFunc","handlers2","_flash_focus","focus","flash","rect_element","timems","autoFocus","csscolor","_flashtimer","_flashcolor","tick","PositionKey","_enterPopupSafe","_exitPopupSafe","on_resize","newsize","getPathValue","undoBreakPoint","setPathValueUndo","pathSocketUpdate","loadNumConstraints","onModifiedCallback","modified","getPathMeta","loadAttr","propkey","domkey","thiskey","oldmin","oldmax","oldint","oldedit","setPathValue","getPathDescription","_doOnce","_doOnce_reqs","zindex","positionKey","_ensureChildrenCtx","checkThemeUpdate","abortToolTips","delayMs","stop_timer","updateToolTipHandlers","start_timer","reset_timer","start_events","reset_events","stop_events","bind_handler","etype","lists","updateToolTips","_ToolTip","show","updateEventGraph","subclassChecksTheme","saveData","loadData","localOnly","overrideClass","overrideClassDefault","_doMobileDefault","mobilekey","hasClassDefault","hasSubDefault","_hasSubDefault","getStyleClass","hasClassSubDefault","_hasClassSubDefault","themeDef","parentStyle","backupkey","checkForMobile","getDefault_intern","getClassDefault","themeobj","overrideTheme","getStyle","animate","_extra_handlers","domAnimateOptions","DOMMatrix","update_trans","background_get","background_set","dx_get","dx_set","dy_get","dy_set","pixkeys","makePixHandler","proxy","receiver","anim","abortAnimations","_mc","drawRoundBox2","drawRoundBox","no_clear","_background","quadraticCurveTo","closePath","_getFont_new","do_dpi","getFont","_ensureFont","get_measure_canvas","measureTextBlock","measureText","HTMLCanvasElement","drawText","fillText","PIDX","PSHADOW","PTOT","saveUIData","ni","is_shadow","path2","_ui_version","loadUIData","_saveUIData","_loadUIData","aspect._setUIBase","events.keymap","toolprop.PropTypes","ui_base.UIBase","ui_base.PackFlags","ui_base.IconSheets","ui_base.parsepx","ButtonEventBase","_auto_depress","_highlight","_pressed","bindEvents","depress","_redraw","onclick","_onpress","onpress","captured","blur","_focus","Button","_pressedTime","_pressedTimeout","_last_name","_last_disabled","__pressed","updateDisabled","OldButton","_last_but_update_key","_name","_namePad","_leftPad","_rightPad","_last_w","_last_h","_last_dpi","_lastw","_lasth","_last_bg","updateName","updateWidth","old_bindEvents","_repos_canvas","updateDefaultSize","cssHeight","_calcUpdateKey","updateDPI","updateBorders","tw","ui_base.measureText","_genLabel","lwid","w_add","h2","_getSubKey","draw_text","ui_base.drawRoundBox","lw","_draw_text","ui_base.drawText","TextBoxBase","modalKeyEvents","_editing","_width","_had_error","_change","oninput","isModal","_startModal","_modal","_endModal","startSelected","realtime","select","keydown","on_keypress","editing","_updatePathVal","bwid","bcolor","updateDataPath","is_num","is_int","_prop_update","units.isNumber","ui_base.ErrorColors","checkForTextBox","draggable","ui_base._setTextboxClass","IconLabel","_icon","ui_base.iconmanager","ValueButtonBase","_value","Check","_checked","span","mup","mover","mleave","_label","prepend","_updatekey","csize","ui_base.Icons","ui_base.getIconManager","updatekey","IconButton","_customIcon","_draw_pressed","_icon_pressed","drawButtonBG","_extraIcon","extraDom","_last_iconsheet","domImage","_on_press","_on_depress","loadstyle","addpx","high","unhigh","_getsize","IconCheck","_drawCheck","updateDrawCheck","_updatePressed","noEmboss","Check1","saveFile","exts","loadFile","readAsArrayBuffer","_testLoadFile","_testSaveFile","createFile","Constraint","klst","glst","wlst","ks","ws","threshold","funcDv","postSolve","no_dvs","gs","Solver","constraints","gk","simple","randCons","con","solveStep","cons","ci","ri","solveStepSimple","solve","printError","PackNodeVertex","_absPos","absPos","PackNode","vel","oldpos","copyGraph","idmap","getCenter","loadGraph","graphGetIslands","islands","visit1","island","graphPack","margin_or_args","updateCb","orignodes","decayi","nodemap","disableEdges","edge_c","restlen","loadBoxes","margin1","lasterr","besterr","disableArea","area_c","math.aabb_overlap_area","fakeVerts","fv","solveStep1","solver","rlen","rfac","boxPacker","getpx","debugmenu","Menu","parentMenu","_was_clicked","autoSearchMode","_ignoreFocusEvents","closeOnMouseUp","_submenu","ignoreFirstClick","itemindex","closed","started","activeItem","menustyle","buildStyle","maxx","maxy","_isMenu","onselect","close","menuWrangler","popMenu","onclose","_popup","_select","dir","hasSearchBox","scrollIntoView","selectPrev","selectNext","start_fancy","startFancy","pushMenu","dom2","sbox","dokey","addItemExtra","icon_div","ui_base.makeIconDiv","ui_base.getFont","hwid","twid","hotkey_span","addItem","li","_menu","onfocus","_getBorderStyle","pad1","boxShadow","sepcss","itemRadius","seperator","bar","calcSize","SEP","DropBox","lockTimer","_template","_searchMenuMode","_last_datapath","searchMenuMode","wasError","_last_dbox_key","_build_menu_template","createMenu","_build_menu","_dropbox","valmap","enummap","uimap","desr","uk","callProp","_convertVal","rects","rheight","haveElectron","popup","ui_base.drawRoundBox2","setLabelOnly","MenuWrangler","menustack","lastPickElemTime","_closetimer","closereq","closetimer","spawnreq","endMenus","searchKeyDown","previousElementSibling","nextElementSibling","findMenu","menu2","closetime","startTimer","stopTimer","_menuWrangler","wrangerStarted","startMenuEventWrangling","setWranglerScreen","getWranglerScreen","doItem","id2","cbfunc","arg","startMenu","safetyDelay","_startMenuEventWrangling","_ui","toolprop.PropFlags","Label","_lastText","_font","fontDefaultName","_updateFont","_enabled_font","_last_font","Container","dataPrefix","massSetPrefix","inherit_packflag","styletag","reversed","_prefixstack","_mass_prefixstack","children","changePathPrefix","newprefix","_joinPrefix","pushMassSetPrefix","pushDataPrefix","popDataPrefix","popMassSetPrefix","scrollTop","scrollLeft","scrollTo","useIcons","enabled_or_sheet","enabled","previous","wrap","rest","themeClass_or_obj","margin2","horiz","themeClass","RowFrame","bradius","bline","bstyle","oneAxisMargin","axisPadding","otherPadding","setMargin","setPadding","setSize","saveVisibility","localStorage","storagePrefix","loadVisibility","opened","redrawCurves","listen","on_destroy","_prepend","_add","insert","NodeList","dynamicMenu","dbox","_container_inherit","toolPanel","path_or_cls","createCb","create_cb","defaultsPath","packflag_or_args","toolob","pathlabel","helppicker","hintPickerTool","colorbutton","_getMassPath","noteframe","vecpopup","textarea","checkenum","listenum","col1","col2","wrapChars","isrow","rebuild","last_hash","frame","checks","ignorecb","makecb","checkenum_panel","enumDef","getroot","do_redraw","setHeaderToolTip","twocol","parentDepth","colorPicker","themeOverride","colorpicker","viewer","asDialogFooter","ColumnFrame","TwoColumnFrame","_colWidth","colWidth","Note","_noteid","showExclMark","append","setLabel","mark","ntext","clr","ProgBarNote","_percent","barWidth","bar2","percent","NoteFrame","ui.RowFrame","_h","noteframes","note","addNote","getNoteFrames","sendNote","ui_base.color2css","_sendNote","RichEditor","textOnlyMode","controls","makeicon","execCommand","contentEditable","toggleStrikeThru","ta","getSelection","startNode","getRangeAt","anchorNode","anchorOffset","InputEvent","CustomEvent","formatStart","formatLine","formatEnd","rc","RichViewer","hideScrollBars","showScrollBars","textTransform","VectorPopupButton","VectorPanel","sliders","makeParam","_getNumParam","_setNumParam","__range","_range","vp","uslider","uniformValue","vertical","doupdate","loadNumParam","do_rebuild","ToolTip","_start_time","_estimateSize","ui_base.measureTextBlock","bwidth","toolstack_getter","registerToolStackGetter","vectormath.Vector3","simple_toolsys.UndoFlags","simple_toolsys.ToolFlags","ToolBase","simple_toolsys.ToolOp","_finished","overdraw","modaldata","AreaResizeTool","side","_side","_borders","RESIZE","getBorders","borders","otherVertex","snapScreenVerts","regenBorders","loadFromVerts","isBorderMovable","oldv1","oldv2","badcount","snapMode","moveBorder","outer","solveAreaConstraints","updateDebugBoxes","_fireResizeCB","SplitTool","canceled","splitArea","_internalRegenAll","RemoveAreaTool","collapseArea","AreaDragTool","dropArea","excludeAreas","cursorbox","boxes","TRANSLATE","_recalcAABB","getBoxRect","sa","doSplit","doSplitDrop","can_rip","floating","areasBorder","expand","removeArea","minmaxArea","editors","editormap","areaname","on_area_inactive","editor","editor2","owning_sarea","switcher","replaceArea","loadFromPosSize","nsa","makeBoxes","hcolor","box","curbox","setColor","getActiveBox","on_drag","on_dragend","wid","AreaMoveAttachTool","start_mpos2","start_pos","ToolTipViewer","pick","Keymap","ele","tip","AreaFlags","HIDDEN","FLOATING","INDEPENDENT","NO_SWITCHER","NO_HEADER_CONTEXT_MENU","NO_COLLAPSE","SnapLimit","BORDER_ZINDEX_BASE","snap","snap_limit","snapi","ScreenVert","added_id","ScreenHalfEdge","ScreenBorder","_hash","halfedges","_innerstyle","_style","inner","call_menu","bindBorderMenu","movable","FrameManager_ops.AreaResizeTool","usePickElement","on_dblclick","splitTool","removeAreaTool","popupMenu","getOtherSarea","he","_verts","borderLock","valence","sv","a0x","a0y","cursor","alpha","innerbuf","sbuf","_ScreenArea","_contextWrangler","BorderMask","LEFT","BOTTOM","RIGHT","TOP","BorderSides","inactive","areaDragToolEnabled","_area_id","minSize","maxSize","makeAreasEnum","areas","onover","_get_v_suffix","on_fileload","isActiveEditor","buildDataPath","idx1","idx2","areaName","oldsize","on_area_focus","on_area_blur","on_area_active","dontSetLastRef","getBarHeight","header","makeAreaSwitcher","switch_editor","makeHeader","add_note_area","make_draggable","switcherRow","helpRow","callmenu","notef","eventdom","mpre","last_time","do_mousemove","mdown2","areaDragTool","_isDead","afterSTRUCT","ui_base.loadUIData","saved_uidata","_getSavedUIData","ui_base.saveUIData","ScreenArea","_flag","_sarea_id","_pos","wrapVector","bringToFront","snapToScreenSize","freeBorder","makeBorders","getScreenVert","getScreenBorder","existing","switchEditor","moved","checkAreaConstraint","owining_sarea","ui_base._setAreaClass","ThemeEditor","categoryMap","build","doFolder","catkey","help","row2","do_onchange","completeSetCSS","completeUpdate","getpath","cw","setRGBA","panel2","tbox","catkey2","categories","cat","category","strcmp","sliderDomAttributes","updateSliderFromDom","SliderDefaults","NumberSliderBase","skip","NumSlider","_last_label","ma","_last_overarrow","removeAttribute","_last_width","updateConstraints","swapWithTextbox","onmousedown","overArrow","_on_click","dragStart","setMpos","rwidth","rx","szmargin","_getArrowSize","doRange","fire_onchange","setDataPath","checkConstraints","over","last_background","util.MovingAvg","startvalue","startx","sumdelta","fire","dvalue","dsign","on_pointerout","on_pointerover","restore_value","unused_setBG","fromRedraw","fromCSS","backupval","subkey2","boxbg","arrowcolor_base","arrowcolor","parseArrowColor","NumSliderSimpleBase","modal","_last_slider_key","_setFromMouse","_getButtonPos","_invertButtonX","makefunc","pointermove","pointerover","pointerout","pointerleave","pointerenter","pointerup","updateSize","setHighlight","isOverButton","sh","arc","setLineDash","boxw","SliderWithTextbox","_lock_textbox","_labelOnTop","_last_label_on_top","_numslider","_last_value","realTimeTextBox","apply_textbox","linkTextBox","in_onchange","updateLabelOnTop","NumSliderSimple","NumSliderWithTextBox","pagecache","domTransferAttrs","domEventAttrs","parseXML","xml","DOMParser","parseFromString","num_re","getIconFlag","attr","isnum","getPackFlag","getbool","myParseFloat","getfloat","customHandlers","Handler","codefuncs","templateVars","attrs","inheritDomAttrs","inheritDomAttrKeys","XMLDocument","nodeName","tree","Text","Comment","elem2","__elem","getAttributeNames","_container","_basic","pathux_ctx","rule","selectorText","styleMap","stylecode","setStyle","_getattr","codeattrs","eventType","sliderMode","doBox","_handlePathPrefix","ignorePathPrefix","cell","_prop","_codelem","$scope","templateScope","mpath","column","iconflags","noIcons","isDropBox","initPage","parentContainer","loadPage","parentContainer_or_args","loadSourceOnly","modifySourceCB","fetch","makeGenEnum","Curve1DWidget","_on_draw","checkCurve1dEvents","_gen_type","_lastGen","bspline1","bspline2","clipCheck","ymin","ymax","last_update_key","_lastu","updateGenUI","forward_keys","PanelFrame","titleframe","_panel","_closed","headerLabel","__label","_updateClosed","bs","defval","header_radius","boxmargin","paddingleft","paddingright","margintop","marginbottom","marginleft","marginright","_setVisible","_onchange","isClosed","noUpdateClosedContents","display","makeForward","UPW","VPW","sample_rets","inv_sample","colorClipboardCopy","getRGBA","colorClipboardPaste","fieldrand","huefields","getHueField","ImageData","rgb","putImageData","getFieldImage","fieldsize","hsva","width2","height2","fieldsize2","hue","valpow","x2sat","y2val","sat2x","val2y","image2","_update_temp","SimpleBox","HueField","setFromXY","_getPad","hsv","rselector","r_circle","SatValField","_getField","sat","force_update","globalAlpha","ColorField","ui.ColumnFrame","_recalcRGBA","_lastThemeStyle","satvalfield","huefield","setCMYK","setHSVA","getCMYK","_in_update","updateThemeOverride","ColorPicker","colorsPanel","cssText","_no_update_textbox","_setSliders","cmyk","makeCMYKSlider","_setDataPath","colorbox","updateColorBox","ColorPickerButton","_depress","customLabel","labelDom","noLabel","leave","widget","cellsize","totx","toty","verboseDataPath","_last_key","tab_idgen","FAKE_TAB_ID","TabDragEvent","TabItem","tbar","ontabclick","ontabdragstart","ontabdragmove","ontabdragend","helper","extraSize","abssize","abspos","sendEvent","forwardEvent","Event","ModalTabMove","droptarget","dragtab","dragstate","finished","dragcanvas","on_pointerenter","on_pointerleave","on_pointerstart","on_pointerend","_on_move","_dragstate","DragEvent","dragevent","disty","dragok","dataTransfer","DataTransfer","dragimg","g2","drag_g","ti","prev","swapTabs","defaultPrevented","TabBar","movableTabs","tabFontScale","_last_style_key","_last_pos","_doelement","mx","my","_domouse","_fireOnSelect","_doclick","ht","acte","_startMove","updatePos","_ensureNoModal","_tool","edom","_makeOnSelectEvt","getTab","name_or_id","taborder","ntabs","ai","bi","addIconTab","addTab","updateCanvas","tsize","_layout","hpad","iconsize","have_icons","ry","makeTabWatcher","watcher","haveTabDom","_size_cb","noSwitch","preventScroll","focusVisible","activecolor","ypad","worig","removeTab","updateStyle","_last_p_key","TabContainer","_remakeStyle","_last_horiz","_last_bar_pos","_tab","enableDrag","flexDir","bgcolor","icontab","tab2","defineTabEvent","getTabCount","moveTab","updateBarPos","barpos","updateHoriz","TableRow","td","TableFrame","maketd","_tr","_bg","ListItem","setBackground","unhighlight","shadowRoot","is_active","ListBox","onkeydown","removeItem","scrollIntoViewIfNeeded","ProgressCircle","animreq","startTime","flagRedraw","onkey","oncancel","requestAnimationFrame","dth","endTimer","LastKey","getLastToolStruct","_last_tool","last_tool_eventmap","unlinkEvents","needsRebuild","LastToolPanel","ignoreOnChange","on_change","_tool_id","getToolStackHead","buildTool","last_tool","mimeMap","svg","txt","html","cpp","cc","hh","hpp","mjs","cjs","gif","textMimes","isMimeText","getExtension","getMime","PlatformAPI","writeFile","resolveURL","href","showOpenDialog","FileDialogArgs","showSaveDialog","savedata_cb","readFile","multi","addToRecentList","filters","FilePath","platform","getPlatformAsync","mod","resolve","electron_api$1","web_api","_nativeTheme","getNativeTheme","remote","getElectron","nativeTheme","ipcRenderer","getElectronVersion","require","myRequire","getFilename","_menu_init","electron_menu_idgen","ElectronMenu","_ipcId","setApplicationMenu","initElectronIpc","closePopup","wrapRemoteCallback","keybase","ipcInit","_themeSource","themeSource","ElectronMenuItem","patchDropBox","emenu","buildElectronMenu","shouldUseDarkColors","iconcache","makeIconKey","invertColors","getNativeIcon","icongen","nativeImage","GetRequiredICOImageSizes","writeFileSync","CTRL","ALT","SHIFT","COMMAND","buildElectronHotkey","buildItem","submenu","accelerator","registerAccelerator","initMenuBar","menuEditor","_roles","roles","edit","app","eargs","defaultPath","_sanitizeFilters","properties","cancelled","filePaths","filters2","extensions","filedata_cb","filePath","filedata","fs","readFileSync","SVG_URL","CanvasOverdraw","shapes","otherChildren","zindex_base","createElementNS","Overdraw","cssPosition","drawTextBubbles","texts","colors","elems","pat","minsize","grads","startpos","box1","box2","circle","TreeItem","treeParent","treeChildren","treeView","treeDepth","_icon1","_icon2","_labelText","_open","_close","TreeView","strokes","updateOverdraw","_forAllChildren","_makeStrokes","ox","oy","rowh","getx","math.MinMax","od","startDrag","lastx","lasty","hx","hy","DragBox","DELETE","iconenum","_onend","ignore","_FrameManager","dockerdebug","areadocker","testSnapScreenVerts","unlisten","propsbar","AreaDocker","_last_update_key","ignoreChange","getArea","switcherData","tab_onchange","detach","addicon","on_addclick","loadTabData","floatArea","moveAttachTool","addTabMenu","area2","areaId","newarea","parentw","newparentw","newparent","ud","makePopupArea","area_class","addEscapeKeyHandler","ScreenArea.Area","ui_menu.startMenuEventWrangling","_events_started","FrameManager_ops.registerToolStackGetter","ui_base.styleScrollBars","update_stack","screen_idgen","get_screen_cb","_on_keydown","purgeUpdateStack","snapLimit","fullScreen","globalCSS","_do_updateSize","_resize_callbacks","needsBorderRegen","_popup_safe","testAllKeyMaps","_screen_id","_popups","screenverts","_vertmap","_edgemap","_idmap","_aabb","dragging","sx","sy","ScreenArea.ScreenArea","listening","listen_timer","schedule_resize","setPosSize","setPos","sheet2","rule2","desc","writable","sval","insertRule","CSSStyleSheet","replaceSync","tag","newScreenArea","sarea2","_allAreas","owning_node","elem_or_x","closeOnMouseOut","popupDelay","draggablePopup","touchpick","mousepick","bad_time","last_pick_time","do_timeout","calcTabOrder","popupArea","trigger_destroy","checkCSSSize","getBoolAttribute","outerHeight","customWindowSize","_DEBUG","_calcSizeKey","_last_ckey1","ui_menu.setWranglerScreen","startEvents","ui_menu.getWranglerScreen","second_pass","__pass","__destroyed","_test_save","getHotKey","execKeyMap","handled","activeElement","__pos","drawUpdate","redraw_all","move","_update_gen","update_intern","updateScrollStyling","_last_scrollstyle_key","popups","cssTextHash","util.strhash","SCOPE_POP","AREA_CTX_POP","scopestack","areastack","regenScreenMesh","regenBorders_stage2","has_he","border2","walkBorderLine","he2","hasBorder","killScreenVertex","dels","killBorder","del","isBorderOuter","_get_debug_overlay","_debug_overlay","wadd","checkOnly","chg","sidea","sideb","dh","bad2","ret2","moveBorderWithoutVerts","halfedge","strict","moveBorderSimple","moveBorderUnused","FrameManager_mesh.SnapLimit","snapArgument","repeat","fitToSize","_set_key","offx","offy","olds","sides","sb","sarea1","_updateAll","_has_evts","onblur","FrameManager_ops.ToolTipViewer","FrameManager_ops.RemoveAreaTool","FrameManager_ops.AreaMoveAttachTool","FrameManager_ops.SplitTool","FrameManager_ops.AreaDragTool","cleanupBorders","mergeBlankAreas","blank","test_struct","screen2","parentElement","ScreenArea.setScreenClass","start_cbs","stop_cbs","keyboardDom","key_event_opts","getScreenFunc","stopEvents","setKeyboardDom","setKeyboardOpts","opts","_onEventsStart","_onEventsStop","sidebar_hash","SideBar","_last_resize_key","closeIcon","_openWidth","needsSetCSS","tabbar","Editor","defineAPI","strct","registerAppMenu","makeMenuBar","makeSideBar","findEditor","iconSvg","loadDefaultIconSheet","iconSheet","FileHeader","version_major","version_minor","version_micro","schema","FileFull","objects","FileArgs","doScreen","resetOnLoad","useJSON","fileFlags","fromFileOp","EmptyStruct","saveFilesInJSON","ob","istruct","screenClass","MenuBarEditor","updateHeight","_height","electron_api","flagRebuild","menuRow","registerMenuBarEditor","SimpleAppNewOp","createNewFile","SimpleAppSaveOp","forceDialog","fileExt","startArgs","platform.platform","currentFileRef","SimpleAppOpenOp","DataModelClasses","DataModel","EmptyContextClass","GetContextClass","ctxClass","OverlayDerived","Overlay","activeArea","toolDefaults","ui_noteframe.message","ui_noteframe.error","ui_noteframe.warning","ui_noteframe.progbarNote","makeAPI","StartArgs","singlePage","iconSizes","iconTileSize","iconsPerRow","registerSaveOpenOps","SimpleScreen","AppState","_ctxClass","fileMagic","fileVersion","_fileExt","_fileExtSet","defaultEditorClass","makeScreen","saveFileSync","loadFileSync","ensureMenuBar","args2","methodsCheck","SimpleContext","getContextClass","getWebFilters","controller.setNotifier","ui_noteframe","showOpenFilePicker","multiple","createWritable","showSaveFilePicker","showSaveDialog_old","fname","saveHandle","handle1","savedata","getFile","arrayBuffer"],"mappings":"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"}